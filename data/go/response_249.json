[{"tags": ["arrays", "pointers", "go"], "comments": [{"owner": {"reputation": 4490, "user_id": 8146571, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mlHzf.jpg?s=128&g=1", "display_name": "Dzenis H.", "link": "https://stackoverflow.com/users/8146571/dzenis-h"}, "edited": false, "score": 0, "creation_date": 1571269659, "post_id": 58422946, "comment_id": 103188263, "body": "Welcome to SO :) Please take some time when posting a question. Make it look good, make it as clear as possible, and also give your best to format it well. Thanks."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1571269911, "post_id": 58422946, "comment_id": 103188320, "body": "Your expectation is exactly what happens: <a href=\"https://play.golang.org/p/UMl2PltLKtq\" rel=\"nofollow noreferrer\">play.golang.org/p/UMl2PltLKtq</a>"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1571310888, "post_id": 58422946, "comment_id": 103203170, "body": "Adding the line <code>fmt.Printf(&quot;%p %p\\n&quot;,&amp;a, &amp;a1)</code> after <code>a1 := a</code> may help explain what&#39;s going on."}], "answers": [{"tags": [], "owner": {"reputation": 585, "user_id": 6044698, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/75a2287041af2123d1885e78473a5bc8?s=128&d=identicon&r=PG&f=1", "display_name": "jano", "link": "https://stackoverflow.com/users/6044698/jano"}, "is_accepted": false, "score": 1, "last_activity_date": 1571314424, "last_edit_date": 1571314424, "creation_date": 1571305147, "answer_id": 58429509, "question_id": 58422946, "link": "https://stackoverflow.com/questions/58422946/golang-pointer-in-array/58429509#58429509", "title": "Golang pointer in Array", "body": "<p>If the question is <strong>why the values in the original array did not get modified</strong> then the answer is it is <strong>because iteration item introduced in <code>range</code> is a copy of original item</strong>. To fix your issue you could do something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for i := range array {\n  res = append(res, &amp;array[i])\n}\n</code></pre>\n\n<p>Check out this references:</p>\n\n<ol>\n<li><a href=\"https://golang.org/ref/spec#For_clause\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#For_clause</a></li>\n<li><a href=\"https://github.com/golang/go/wiki/Range#gotchas\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Range#gotchas</a></li>\n<li><a href=\"https://tour.golang.org/moretypes/16\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/16</a></li>\n<li><a href=\"https://github.com/golang/go/issues/22791#issuecomment-345391395\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/22791#issuecomment-345391395</a></li>\n<li><a href=\"https://www.ardanlabs.com/blog/2017/06/for-range-semantics.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2017/06/for-range-semantics.html</a></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 8104831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/122212c015b1d42d9e5f4c6a19f38f24?s=128&d=identicon&r=PG&f=1", "display_name": "applekim", "link": "https://stackoverflow.com/users/8104831/applekim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1571314424, "creation_date": 1571268820, "last_edit_date": 1571274566, "question_id": 58422946, "link": "https://stackoverflow.com/questions/58422946/golang-pointer-in-array", "title": "Golang pointer in Array", "body": "<p>I want to know why this code can not change the value in the array</p>\n\n<p>I try to modify the element in the array by pointer. Not by index. </p>\n\n<pre><code>import \"fmt\"\n\nfunc main() {\n    array := []Type{}\n\n    array = append(array, Type{2})\n    array = append(array, Type{3})\n    array = append(array, Type{4})\n    array = append(array, Type{5})\n\n    res := []*Type{}\n\n    for _, a := range array {\n        a1 := a\n        res = append(res, &amp;a1)\n    }\n    for _,v := range res {\n        v1 := v\n        v1.number++\n    }\n    for _, t := range res {\n        fmt.Print(t.number)\n    }\n}\ntype Type struct {\n    number int32\n}\n</code></pre>\n\n<p>My expect result should be 3,4,5,6. But the result did not change, so I want to know the detail reason. I am new to Go. Please tell me detail</p>\n"}, {"tags": ["go", "casting"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 6, "creation_date": 1571269379, "post_id": 58422904, "comment_id": 103188191, "body": "<a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Assignability</a> The second bullet point allows the assignment of values of type RuleConf to variables of type map[GlobalRuleName]int and vice versa. None of the points apply to string and GlobalRuleName."}, {"owner": {"reputation": 369, "user_id": 3576684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2beb681ae0941477036f45967ab2378b?s=128&d=identicon&r=PG&f=1", "display_name": "peaxol", "link": "https://stackoverflow.com/users/3576684/peaxol"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571271817, "post_id": 58422904, "comment_id": 103188671, "body": "Thanks Peter. As per the second bullet: <code>x&#39;s type V and T have identical underlying types and at least one of V or T is not a defined type.</code>  Not clear on why this is not applicable to string and GlobalRuleName? They share the underlying type. And string is inbuilt, so not a defined type?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 3, "creation_date": 1571275093, "post_id": 58422904, "comment_id": 103189297, "body": "Both <code>string</code> and <code>GlobalRuleName</code> are defined types. See <a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#String_types</a> which says &quot;The predeclared string type is string; <b>it is a defined type</b>.&quot; (Emphasis mine.)"}, {"owner": {"reputation": 369, "user_id": 3576684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2beb681ae0941477036f45967ab2378b?s=128&d=identicon&r=PG&f=1", "display_name": "peaxol", "link": "https://stackoverflow.com/users/3576684/peaxol"}, "edited": false, "score": 0, "creation_date": 1571337590, "post_id": 58422904, "comment_id": 103217511, "body": "Thanks Torek, that clears it up for me. I got confused because <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_definitions</a> mentioned <code>The new type is called a defined type</code>, so I thought only new user specified types fall in that category."}], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": false, "score": 0, "last_activity_date": 1571285617, "last_edit_date": 1571285617, "creation_date": 1571284946, "answer_id": 58424730, "question_id": 58422904, "link": "https://stackoverflow.com/questions/58422904/type-conversion-in-golang/58424730#58424730", "title": "Type conversion in golang", "body": "<p>You first piece of code works because you have already declared your variable <code>dummyRuleName</code> to be of type <code>GlobalRuleName</code> before the assignment. That way the compiler knows <code>dummyRuleName</code> can be used as the key in <code>RuleConf</code>.</p>\n\n<p>Go is strongly typed language. There is no automatic type casting between different types of variable. You need to explicitly type the variables to make them assignable to each other, even if the underlying type is the same. For example,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var foo GlobalRuleName\nfoo = \"foo\" // because \"foo\" string literal is not a defined type\ndemoName(foo)\n</code></pre>\n\n<p>or</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>foo := GlobalRuleName(\"foo\")\ndemoName(foo)\n</code></pre>\n\n<p>You can also cast the variable <a href=\"https://play.golang.org/p/54_GZ2PvOq1\" rel=\"nofollow noreferrer\">when used</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>foo := \"foo\"\ndemoName(GlobalRuleName(foo))\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 3576684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2beb681ae0941477036f45967ab2378b?s=128&d=identicon&r=PG&f=1", "display_name": "peaxol", "link": "https://stackoverflow.com/users/3576684/peaxol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571285617, "creation_date": 1571268435, "last_edit_date": 1571269168, "question_id": 58422904, "link": "https://stackoverflow.com/questions/58422904/type-conversion-in-golang", "title": "Type conversion in golang", "body": "<p>I am a newbie to golang. I have created a couple of custom types and am confused on their behavior differences - I am missing something in my understanding. I searched for a few stack overflow links like <a href=\"https://stackoverflow.com/questions/46861613/golang-type-conversion-converting-mapstringstring-to-mapsomestructstring\">Golang : Type conversion - Converting map[string]string to map[someStruct]string</a> but they are not quite addressing this.</p>\n\n<p>My first custom type is a string and other is a map of this custom type to ints.\nSample code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype GlobalRuleName string\ntype RuleConf map[GlobalRuleName]int\n\nfunc demo(ruleConf RuleConf) {\n    fmt.Printf(\"ruleConf is %+v\", ruleConf)\n}\n\nfunc main() {\n    var dummyRuleName GlobalRuleName\n    dummyRuleName = \"dummy\"\n\n    dummyRuleConf := make(map[GlobalRuleName]int)\n    dummyRuleConf[dummyRuleName] = 23\n    demo(dummyRuleConf)\n\n}\n\n</code></pre>\n\n<p>This runs fine with output\n<code>ruleConf is map[dummy:23]</code>\n My confusion is why is the variable dummyRuleConf automatically recognized as type ruleConf by Go? I expected demo function to throw an error saying type expected ruleConf.</p>\n\n<p>This does not work with strings the same way. For eg: If I declare a function accepting a GlobalRuleName and pass it a string, it errors out. Sample code below:</p>\n\n<pre><code>func demoName(name GlobalRuleName) {\n    fmt.Printf(\"name is %+v\", name)\n\n}\n\nand then within main \nfoo := \"foo\"\ndemoName(foo)\n./prog.go:30:10: cannot use foo (type string) as type GlobalRuleName in argument to demoName\n\n</code></pre>\n\n<p>Complete go playground link here: <a href=\"https://play.golang.org/p/WWO1H5MgLyJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WWO1H5MgLyJ</a></p>\n\n<p>Why was it able to understand that the dummyRuleConf map declaration matched the custom type for ruleConf but not do so for the string?</p>\n\n<p>Fyi - i created a custom type for strings because it makes my code easier to understand. I read on other SO posts that this is not recommended in Go, will get rid of it.</p>\n\n<p>I need to create the custom type for the map since I want to write methods on that type.</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1571268239, "post_id": 58422762, "comment_id": 103187938, "body": "If you want to copy environment variable sets around, I&#39;d suggest the canonical NUL-delimited-list format used by <code>&#47;proc&#47;&lt;pid&gt;&#47;environ</code>. It&#39;s easy to parse in <i>any</i> language, Python or Go included, and you don&#39;t need any custom tools to generate it if you&#39;re running on the Linux kernel, since the OS itself exports the set (at least, as it existed at process startup time)."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1571268531, "post_id": 58422762, "comment_id": 103188017, "body": "(and if you <i>do</i> need to generate it yourself, <code>for k, v in os.environ.items(): print(&#39;%s=%s\\0&#39;  % (k,v), end=&#39;&#39;)</code> ain&#39;t hard)."}, {"owner": {"reputation": 129, "user_id": 1498043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PyxIy.jpg?s=128&g=1", "display_name": "olivier.va", "link": "https://stackoverflow.com/users/1498043/olivier-va"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1571268653, "post_id": 58422762, "comment_id": 103188049, "body": "I am not looking to work with environment variables here, just the variables defined in global scope of a Python script. Your comment did remind me that it needs to be cross platform."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1571268750, "post_id": 58422762, "comment_id": 103188080, "body": "I&#39;m used to &quot;exported&quot; meaning &quot;exported&quot; <i>to the environment</i>, as performed by the <code>export</code> shell command, various <code>setenv()</code> calls, etc. If you&#39;re using it in a different context, it&#39;s not clear to me what the intent is."}, {"owner": {"reputation": 263593, "user_id": 674039, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/leoFi.gif?s=128&g=1", "display_name": "wim", "link": "https://stackoverflow.com/users/674039/wim"}, "edited": false, "score": 0, "creation_date": 1571269128, "post_id": 58422762, "comment_id": 103188146, "body": "What do you mean by &quot;the information should remain in memory only&quot; and &quot;variables exposed by Python scripts&quot;? Scripts don&#39;t expose variables - they just run, maybe print some stuff to stdout or stderr, and then exit with an integer return code. The way that that Python objects are stored in memory is not so simple for go code to just reach in and read them..."}, {"owner": {"reputation": 129, "user_id": 1498043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PyxIy.jpg?s=128&g=1", "display_name": "olivier.va", "link": "https://stackoverflow.com/users/1498043/olivier-va"}, "edited": false, "score": 0, "creation_date": 1571270639, "post_id": 58422762, "comment_id": 103188444, "body": "I edited my description to address the questions you have and added a small example of a python script that contains the variables to which I want access in Golang. I am not looking to intertwine Golang and Python at all, I just want to run the Python script with Golang and get the values of those variables in Golang after running the script. I hope this clarifies things!"}, {"owner": {"reputation": 263593, "user_id": 674039, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/leoFi.gif?s=128&g=1", "display_name": "wim", "link": "https://stackoverflow.com/users/674039/wim"}, "edited": false, "score": 1, "creation_date": 1571277990, "post_id": 58422762, "comment_id": 103189864, "body": "Now, that sounds much more reasonable. So, you can just do as you originally suggested - json dump the relevant keys and values to stdout at the end of the Python script (you would need to modify the script directly, or write a wrapper around it)"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1571286028, "post_id": 58422762, "comment_id": 103191517, "body": "They are of different runtime environments. Golang cannot directly access variables in Python&#39;s runtime. Vica versa. You can, however, program them to pass on variable values through standard I/O or environment variables. The key is to determine the proper format for information exchanges."}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 1498043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PyxIy.jpg?s=128&g=1", "display_name": "olivier.va", "link": "https://stackoverflow.com/users/1498043/olivier-va"}, "edited": false, "score": 1, "creation_date": 1571310075, "post_id": 58425076, "comment_id": 103202690, "body": "Exactly the solution that I created yesterday as well, but I accept your answer nonetheless as it is correct and works. The dump_globals() you demonstrated here is something I did not think about. It gave me the idea to provide a python module which exposes a function like that which users could simply import and call. Thanks!"}], "tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 2, "last_activity_date": 1571289027, "last_edit_date": 1571289027, "creation_date": 1571287527, "answer_id": 58425076, "question_id": 58422762, "link": "https://stackoverflow.com/questions/58422762/how-do-i-make-variables-from-a-python-module-available-in-go/58425076#58425076", "title": "How do I make variables from a Python module available in Go?", "body": "<p>They are of different runtime environments. Golang cannot directly access variables in Python's runtime. Vica versa. You can, however, program them to pass on variable values through standard I/O or environment variables. The key is to determine the proper format for information exchanges. </p>\n\n<p>For example, if the python script takes arguments as input and print the result, encoded as JSON, to the stdout. Then you can call the script with proper arguments, and decode the stdout as JSON.</p>\n\n<p>Such as:</p>\n\n<h3>range.py</h3>\n\n<pre class=\"lang-py prettyprint-override\"><code>import json\nimport sys\n\ndef toNum(str):\n    return int(str)\n\ndef main(argv):\n    # Basically called range() with all the arguments from script call\n    print(json.dumps(list(range(*map(toNum, argv)))))\n\nif __name__ == '__main__':\n    main(sys.argv[1:])\n</code></pre>\n\n<h3>main.go</h3>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc pythonRange(start, stop, step int) (c []byte, err error) {\n    return exec.Command(\n        \"python3\",\n        \"./range.py\",\n        fmt.Sprintf(\"%d\", start),\n        fmt.Sprintf(\"%d\", stop),\n        fmt.Sprintf(\"%d\", step),\n    ).Output()\n}\n\nfunc main() {\n    var arr []int\n\n    // get the output of the python script\n    result, err := pythonRange(1, 10, 1)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // decode the stdout of the python script\n    // as a json array of integer\n    err = json.Unmarshal(result, &amp;arr)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // show the result with log.Printf\n    log.Printf(\"%#v\", arr)\n}\n</code></pre>\n\n<h2>Output global variables</h2>\n\n<p>To output global variables in Python as JSON object:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import json\n\ndef dump_globals():\n    # Basically called range() with all the arguments from script call\n    vars = dict()\n    for (key, value) in globals().items():\n        if key.startswith(\"__\") and key.endswith(\"__\"):\n            continue # skip __varname__ variables\n        try:\n            json.dumps(value) # test if value is json serializable\n            vars[key] = value\n        except:\n            continue\n    print(json.dumps(vars))\n\nfoo = \"foo\"\nbar = \"bar\"\n\ndump_globals()\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{\"foo\": \"foo\", \"bar\": \"bar\"}\n</code></pre>\n\n<p>You can use a main() similar to the last one for this script:</p>\n\n<pre><code>\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc pythonGetVars() (c []byte, err error) {\n    return exec.Command(\n        \"python3\",\n        \"./dump_globals.py\",\n    ).Output()\n}\n\nfunc main() {\n    var vars map[string]interface{}\n\n    // get the output of the python script\n    result, err := pythonGetVars()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // decode the json object\n    err = json.Unmarshal(result, &amp;vars)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // show the result with log.Printf\n    fmt.Printf(\"%#v\", vars)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>map[string]interface {}{\"bar\":\"bar\", \"foo\":\"foo\"}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 1498043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PyxIy.jpg?s=128&g=1", "display_name": "olivier.va", "link": "https://stackoverflow.com/users/1498043/olivier-va"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 1, "accepted_answer_id": 58425076, "answer_count": 1, "score": 0, "last_activity_date": 1571289027, "creation_date": 1571267109, "last_edit_date": 1571270851, "question_id": 58422762, "link": "https://stackoverflow.com/questions/58422762/how-do-i-make-variables-from-a-python-module-available-in-go", "title": "How do I make variables from a Python module available in Go?", "body": "<p>I am building a tool in Go which needs to provide a way to resolve variables declared in the global scope of Python scripts. In the future I would like to extend this to Node.js as well. It needs to be cross-platform.</p>\n\n<p>Basically, if someone were to have the following Python code:</p>\n\n<pre><code>#!/usr/bin/env python\n\nhello = \"world\"\nsome_var = \"one\"\nanother_var = \"two\"\nvar_three = some_func()\n</code></pre>\n\n<p>I would like to have access to these variable keys and values in my Golang code. In case of the function, I would like to have access to the value it returns.</p>\n\n<p>My current idea is to run the script with the Golang <code>exec.Command</code> function and have the variables printed to its stdout in some format (e.g. JSON), which in turn can be parsed with Golang. Thoughts?</p>\n"}, {"tags": ["go", "go-packages"], "answers": [{"comments": [{"owner": {"reputation": 1720, "user_id": 6205738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08adf9353636c19dc5a4e45df11d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Saty", "link": "https://stackoverflow.com/users/6205738/saty"}, "edited": false, "score": 0, "creation_date": 1571656278, "post_id": 58471988, "comment_id": 103300982, "body": "Thanks @norbjd! It turned out I had tried all combinations except the <code>...</code> ones which I mentioned in the question itself. :|  BTW when I use <code>...vendor...</code> I don&#39;t get expected results. But I do get expected results for all other combinations like <code>...X...</code>. Is it the case for you as well? What&#39;s so special about <code>vendor</code>?"}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 1720, "user_id": 6205738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08adf9353636c19dc5a4e45df11d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Saty", "link": "https://stackoverflow.com/users/6205738/saty"}, "edited": false, "score": 1, "creation_date": 1571740322, "post_id": 58471988, "comment_id": 103333196, "body": "If you are talking about <code>vendor</code> directory (generated by <code>go mod vendor</code>), it is not a package itself, it is just a directory with a local copy of all your external dependencies."}], "tags": [], "owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "is_accepted": true, "score": 1, "last_activity_date": 1571566570, "creation_date": 1571566570, "answer_id": 58471988, "question_id": 58422294, "link": "https://stackoverflow.com/questions/58422294/how-to-list-all-non-standard-custom-packages-in-go/58471988#58471988", "title": "How to list all non-standard/custom packages in Go?", "body": "<p>You can use the <code>...</code> syntax in <code>pattern</code> field of the <code>Load()</code> function.</p>\n\n<h3>Example</h3>\n\n<p>My Go module requires <a href=\"https://godoc.org/github.com/hashicorp/go-multierror\" rel=\"nofollow noreferrer\"><code>github.com/hashicorp/go-multierror</code></a> package :</p>\n\n<pre><code>module mymodule\n\nrequire github.com/hashicorp/go-multierror v1.0.0\n</code></pre>\n\n<p>So, the following code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/tools/go/packages\"\n)\n\nfunc main() {\n    pkgs, err := packages.Load(nil, \"github.com/hashicorp...\")\n    if err == nil {\n        for _, pkg := range pkgs {\n            fmt.Println(pkg.ID)\n        }\n    }\n}\n</code></pre>\n\n<p>returns all the required packages starting with <code>github.com/hashicorp</code> (even transitive ones) :</p>\n\n<pre><code>github.com/hashicorp/errwrap\ngithub.com/hashicorp/go-multierror\n</code></pre>\n\n<p>Note that you can also use <code>...</code> anywhere in your pattern (<code>...hashicorp...</code>, <code>...ha...corp...</code>, <code>github.com/...</code>).</p>\n"}], "owner": {"reputation": 1720, "user_id": 6205738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08adf9353636c19dc5a4e45df11d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Saty", "link": "https://stackoverflow.com/users/6205738/saty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 58471988, "answer_count": 1, "score": 0, "last_activity_date": 1571566570, "creation_date": 1571263658, "question_id": 58422294, "link": "https://stackoverflow.com/questions/58422294/how-to-list-all-non-standard-custom-packages-in-go", "title": "How to list all non-standard/custom packages in Go?", "body": "<p>As mentioned <a href=\"https://stackoverflow.com/questions/55807322/can-i-list-all-standard-go-packages/56199212\">here</a> one can get all the standard Go packages using <a href=\"https://godoc.org/golang.org/x/tools/go/packages\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tools/go/packages</a> 's <code>Load()</code> function in which one can give \"pattern\" as input. </p>\n\n<p><code>pkgs, err := packages.Load(nil, pattern)</code></p>\n\n<p>For example, if <code>pattern = \"std\"</code> then it returns all the standard packages.</p>\n\n<p>But, if I want to get a list of custom/user-defined packages having custom patterns such as only the vendor folders of the form <code>github.com/X/Y/vendor/...</code> then how exactly I can specify the pattern? </p>\n\n<p>I have tried using <code>/vendor/</code>, <code>github.com/X/Y/vendor/</code> and some other combinations as <code>pattern</code> in the <code>Load()</code> function. None of them have worked. </p>\n"}, {"tags": ["go", "long-polling"], "answers": [{"comments": [{"owner": {"reputation": 1214, "user_id": 324529, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c40e55b6c00933f80a9487eb3573344?s=128&d=identicon&r=PG", "display_name": "TerryMatula", "link": "https://stackoverflow.com/users/324529/terrymatula"}, "edited": false, "score": 0, "creation_date": 1571324817, "post_id": 58422398, "comment_id": 103211561, "body": "This is great. Thanks! I&#39;m new-ish to Go, so I have a couple of questions. Cuould this be done in a loop, so if I have 20 urls I wouldn&#39;t need to hardcode the goroutine? Also, how do think this would scale, to something like 10 thousand users? Thanks again!"}, {"owner": {"reputation": 3682, "user_id": 35439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c99d027e3da3a80fa9e7af16f386f5d0?s=128&d=identicon&r=PG", "display_name": "tonys", "link": "https://stackoverflow.com/users/35439/tonys"}, "reply_to_user": {"reputation": 1214, "user_id": 324529, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c40e55b6c00933f80a9487eb3573344?s=128&d=identicon&r=PG", "display_name": "TerryMatula", "link": "https://stackoverflow.com/users/324529/terrymatula"}, "edited": false, "score": 1, "creation_date": 1571332744, "post_id": 58422398, "comment_id": 103215459, "body": "Updated the answer to use a loop. In terms of scaling - subscribe() calls itself recursively and to the best of my knowledge Go doesn&#39;t implement tail call optimization so you would run out of memory fairly quickly with the code as it stands. Alternative techniques like task queues + scheduler or a technology that supports push (e.g. websockets) would scale better than long polling."}, {"owner": {"reputation": 1214, "user_id": 324529, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c40e55b6c00933f80a9487eb3573344?s=128&d=identicon&r=PG", "display_name": "TerryMatula", "link": "https://stackoverflow.com/users/324529/terrymatula"}, "edited": false, "score": 0, "creation_date": 1571336179, "post_id": 58422398, "comment_id": 103216902, "body": "For some reason, if I just pass the <code>url</code> to the subscribe function, it would only trigger the 2nd element in the array. When I set a new variable <code>newUrl := url</code> and used THAT in function, it worked.  Unfortunately, I&#39;m not in control of the url that&#39;s sending the information, so I&#39;m stuck with longpolling (or something similar). Thanks again!"}, {"owner": {"reputation": 3682, "user_id": 35439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c99d027e3da3a80fa9e7af16f386f5d0?s=128&d=identicon&r=PG", "display_name": "tonys", "link": "https://stackoverflow.com/users/35439/tonys"}, "reply_to_user": {"reputation": 1214, "user_id": 324529, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c40e55b6c00933f80a9487eb3573344?s=128&d=identicon&r=PG", "display_name": "TerryMatula", "link": "https://stackoverflow.com/users/324529/terrymatula"}, "edited": false, "score": 0, "creation_date": 1571339750, "post_id": 58422398, "comment_id": 103218429, "body": "Ooops, sorry - fixed a typo: should have been <code>subscribe(url)</code> not <code>subscribe(urls[0])</code>"}], "tags": [], "owner": {"reputation": 3682, "user_id": 35439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c99d027e3da3a80fa9e7af16f386f5d0?s=128&d=identicon&r=PG", "display_name": "tonys", "link": "https://stackoverflow.com/users/35439/tonys"}, "is_accepted": true, "score": 2, "last_activity_date": 1571339705, "last_edit_date": 1571339705, "creation_date": 1571264420, "answer_id": 58422398, "question_id": 58422268, "link": "https://stackoverflow.com/questions/58422268/how-can-you-longpoll-multiple-urls-in-go/58422398#58422398", "title": "How can you longpoll multiple urls in Go?", "body": "<p>I <em>think</em> what you're asking is for the <code>subscribe</code> functions to be run in parallel. One way is to wrap them in <em>goroutines</em> and wait for all the <em>goroutines</em> to finish:</p>\n\n<pre><code>func main() {\n    ...\n    ...\n    var wg sync.WaitGroup\n\n    wg.Add(len(urls))\n\n    for _, url := range(urls) {\n        go func() {\n            defer wg.Done()\n            subscribe(url)\n        }()\n    }\n\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 1214, "user_id": 324529, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c40e55b6c00933f80a9487eb3573344?s=128&d=identicon&r=PG", "display_name": "TerryMatula", "link": "https://stackoverflow.com/users/324529/terrymatula"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 58422398, "answer_count": 1, "score": 0, "last_activity_date": 1571339705, "creation_date": 1571263484, "question_id": 58422268, "link": "https://stackoverflow.com/questions/58422268/how-can-you-longpoll-multiple-urls-in-go", "title": "How can you longpoll multiple urls in Go?", "body": "<p>Here's what I have thus far:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc subscribe(urls Urls) []byte {\n    req, err := http.NewRequest(\"GET\", urls.Url, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req.Header.Set(\"authentication\", \"Bearer \" + urls.Token)\n\n    http_client := &amp;http.Client{}\n    res, err := http_client.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer res.Body.Close()\n\n    resourceResp, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(string(resourceResp))\n\n    var data map[string]interface{}\n\n    error := json.Unmarshal([]byte(resourceResp), &amp;data)\n    if error != nil {\n        log.Fatal(error)\n    }\n\n    return subscribe(urls)\n}\n\ntype Urls struct {\n    Url string\n    Token string\n}\n\nfunc main() {\n    var urls [2]Urls\n\n    urls[0] = Urls{\n        Url: \"https://example.com/users/8\",\n        Token: \"abcdefg\",\n    }\n\n    urls[1] = Urls{\n        Url:   \"https://example.com/users/9\",\n        Token: \"hijklmnop\",\n    }\n\n    subscribe(urls[0])\n    subscribe(urls[1])\n}\n</code></pre>\n\n<p>The end goal is to \"subscribe\" to the multiple urls and pull any updated data (eventually adding it to a queue, but one step at a time). After that, reestablish the connection.  Right now, only the first subscribe gets run.  Thanks!</p>\n"}, {"tags": ["go", "goa"], "answers": [{"tags": [], "owner": {"reputation": 788, "user_id": 6661361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa148415c5b15036813bc3a60128a68?s=128&d=identicon&r=PG", "display_name": "Gerardo Roza", "link": "https://stackoverflow.com/users/6661361/gerardo-roza"}, "is_accepted": true, "score": 0, "last_activity_date": 1571489769, "creation_date": 1571489769, "answer_id": 58463906, "question_id": 58422259, "link": "https://stackoverflow.com/questions/58422259/static-files-not-served-correctly-when-using-wildcard/58463906#58463906", "title": "static files not served correctly when using wildcard", "body": "<p>As per the answer in the Github issue (#2321), it seems there was an error in the docs, and we should use curly braces in the pattern:</p>\n\n<blockquote>\n  <p>Thank you for the report, there is a typo in the docs, the path in the design needs to be /static/{*filepath} instead (with curly braces surrounding the wildcard).</p>\n</blockquote>\n"}], "owner": {"reputation": 788, "user_id": 6661361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa148415c5b15036813bc3a60128a68?s=128&d=identicon&r=PG", "display_name": "Gerardo Roza", "link": "https://stackoverflow.com/users/6661361/gerardo-roza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 58463906, "answer_count": 1, "score": 0, "last_activity_date": 1571489769, "creation_date": 1571263429, "question_id": 58422259, "link": "https://stackoverflow.com/questions/58422259/static-files-not-served-correctly-when-using-wildcard", "title": "static files not served correctly when using wildcard", "body": "<p>Using <a href=\"https://goa.design/\" rel=\"nofollow noreferrer\">GOA</a>, I defined a service to serve static files using a wildcard (as described in <a href=\"https://godoc.org/goa.design/goa/dsl#Files\" rel=\"nofollow noreferrer\">the documentation</a>):</p>\n\n<pre><code>var _ = Service(\"static\", func() { \n    Files(\"/static/*filepath\", \"./static/\")\n})\n</code></pre>\n\n<p>But when I run the service, the endpoint <strong>always</strong> retrieves all the content it finds in the <em>./static/</em> directory, it seems it doesn't take into account the wildcard section at all.</p>\n\n<p>For example, if I have <em>./static/uploads/file1.jpg</em> and I request <em>localhost/static/uploads/file1.jpg</em> or <em>localhost/static/anything</em> , then the service retrieves the following:</p>\n\n<pre><code>&lt;pre&gt;\n&lt;a href=\"uploads/\"&gt;uploads/&lt;/a&gt;\n&lt;/pre&gt;\n</code></pre>\n\n<p>Digging into the code, I believe the problem is in the generated <em>/gen/http/static/server/server.go</em> file:</p>\n\n<pre><code>// Mount configures the mux to serve the static endpoints.\nfunc Mount(mux goahttp.Muxer, h *Server) {\n    MountCORSHandler(mux, h.CORS)\n    MountStatic(mux, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, \"./static/\")\n    }))\n}\n\n// MountStatic configures the mux to serve GET request made to\n// \"/static/*filepath\".\nfunc MountStatic(mux goahttp.Muxer, h http.Handler) {\n    mux.Handle(\"GET\", \"/static/*filepath\", handleStaticOrigin(h).ServeHTTP)\n}\n</code></pre>\n\n<p>For what I see, the generated code is serving what we passed as base path no matter what, it doesn't take into account if we configured a wildcard at all (it only uses it to match the request, but not to customize the file that we'll serve).</p>\n\n<p>I believe this was working ok in v2, I found this issue in the process of migrating to v3.</p>\n\n<p>As I said, this seems like a bug in GOA, but maybe I'm missing something here. I created an issue in the repo to obtain more information (<a href=\"https://github.com/goadesign/goa/issues/2321\" rel=\"nofollow noreferrer\">#2321</a>)</p>\n"}, {"tags": ["go", "amazon-ec2"], "comments": [{"owner": {"reputation": 2267, "user_id": 5372462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa59f1ce77e8b10f9a970839226b28de?s=128&d=identicon&r=PG&f=1", "display_name": "ofirule", "link": "https://stackoverflow.com/users/5372462/ofirule"}, "edited": false, "score": 0, "creation_date": 1571261473, "post_id": 58421908, "comment_id": 103186133, "body": "Did you open port 8080 in your security group?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1571265032, "post_id": 58421908, "comment_id": 103187169, "body": "Which address does your server bind to?"}, {"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 0, "creation_date": 1571333204, "post_id": 58421908, "comment_id": 103215679, "body": "ofirule, I may not understand your question. I allow outbound traffic to all ports. Inbound traffic is allowed on ports 80 and 8080."}, {"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 0, "creation_date": 1571333300, "post_id": 58421908, "comment_id": 103215717, "body": "bserdar, I don&#39;t know how to answer that... It&#39;s a domain name, bound to an Amazon elastic IP, but I&#39;m a novice at admin stuff so I may have misunderstood the question."}], "owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571333347, "creation_date": 1571261099, "last_edit_date": 1571333347, "question_id": 58421908, "link": "https://stackoverflow.com/questions/58421908/how-do-i-run-simple-go-servers-on-2-ports-on-an-ec2-instance", "title": "How do I run simple Go servers on 2 ports on an EC2 instance?", "body": "<p><strong>EDIT:</strong> I didn't make clear that this works fine on port 80 but not port 8080.</p>\n\n<p>I have a simple server to test OAuth2 written in Golang. It defaults to port 80. I compile it, then run like this:</p>\n\n<pre><code>$ sudo setcap 'cap_net_bind_service=+ep' ./c3\n$ nohup ./c3\n</code></pre>\n\n<p>Works like a charm.</p>\n\n<p>My goal is to show how it works differently depending on configuration, and I'd like the vendor's support team to be able to log onto either version, simply depending on whether they append :8080 to the site's URL.</p>\n\n<p>I have a -port option, so I open another terminal, log into EC2, and run this:</p>\n\n<pre><code>$ sudo setcap 'cap_net_bind_service=+ep' ./c3\n$ nohup ./c3 -port=8080\n</code></pre>\n\n<p>This doesn't connect to mysite.com:8080 and I can't figure out why. The program just hangs.</p>\n\n<p>My security group rules allow all outbound traffic. Inbound is restricted to 80, 8080, 22, and 443.</p>\n"}, {"tags": ["go", "environment-variables"], "comments": [{"owner": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 2, "creation_date": 1571261543, "post_id": 58421829, "comment_id": 103186155, "body": "<i>&quot;If I export ... before running main.go it works fine&quot;</i> That&#39;s the way to do it. Only exported variables become available in child processes. This has nothing to do with go, zsh or mac os. You can try it simply by running <code>echo $PSQL_URL</code> in a sub process. See <a href=\"https://stackoverflow.com/questions/1158091/defining-a-variable-with-or-without-export\" title=\"defining a variable with or without export\">stackoverflow.com/questions/1158091/&hellip;</a>"}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571261608, "post_id": 58421829, "comment_id": 103186171, "body": "But I have to export it everytime I run the program. Is there not a way to make it persistent ? I&#39;m used to set my env variables in <code>&#47;etc&#47;environment</code> in linux and <code>os.Getenv</code> can read them just fine"}, {"owner": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 1, "creation_date": 1571261820, "post_id": 58421829, "comment_id": 103186213, "body": "I don&#39;t know how the terminal/shell inside VSCode works, sorry. Is it an actual shell and you do something like <code>go build; .&#47;command</code> in it to run the app?"}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571261971, "post_id": 58421829, "comment_id": 103186273, "body": "oh... I see. I used to <code>go build</code> all the time on linux. Whereas <code>go run main.go</code> uses shell variables. Thanks for the heads up !"}, {"owner": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571262099, "post_id": 58421829, "comment_id": 103186311, "body": "<code>go run main.go</code> likely works just fine as well. The point I wanted to get was to whether the terminal sessions that VSCode creates are short-living (e.g. only exist for one build) or whether it&#39;s a single session across the lifetime of VSCode. There might be a VSCode specific solution."}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571262325, "post_id": 58421829, "comment_id": 103186385, "body": "hmm actually tested after a reboot and it does not matter if I use the regular terminal / vscode terminal (it is an actual shell) - nor if I use the binary created from <code>go build</code>. Kinda confused, still looking"}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571262451, "post_id": 58421829, "comment_id": 103186426, "body": "Tried to echo $PSQL_URL in a sub process and it returns the proper variable."}, {"owner": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571262695, "post_id": 58421829, "comment_id": 103186498, "body": "Maybe we are talking about two different things here. I have an example app that just does <code>fmt.Println(os.Getenv(&quot;FOO&quot;))</code>. I can do <code>export FOO=&quot;foo&quot;</code> <i>once</i> and call the command multiple times after that (in the same shell) and see the value of the env variable every time. I.e <code>export FOO=&quot;foo&quot;; .&#47;test; .&#47;test; .&#47;test</code>. (note: normal terminal, not vscode) What are you doing?"}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571263220, "post_id": 58421829, "comment_id": 103186670, "body": "Let&#39;s say I open a new terminal and then try to run <code>fmt.Println(os.Getenv(&quot;PSQL_URL&quot;))</code> from <code>.&#47;main</code>. Printed variable will be an empty string. If I export <code>PSQL_URL=&quot;toto@url&quot;</code> then run main it will work just fine. What I usually do on my linux computer is setting environment variables  in <code>&#47;etc&#47;environment</code> and I never have to export, hence my surprise reading your comment."}, {"owner": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 1, "creation_date": 1571263387, "post_id": 58421829, "comment_id": 103186730, "body": "Ah, I think I understand now. You want this env variable to exist &quot;automatically&quot; for every shell you are starting, is that correct? In that case, add <code>export PSQL_URL=&quot;...&quot;</code> to your <code>~&#47;.zshrc</code> file. This file is read whenver zsh is started."}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 699354, "user_id": 218196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4P5DY.jpg?s=128&g=1", "display_name": "Felix Kling", "link": "https://stackoverflow.com/users/218196/felix-kling"}, "edited": false, "score": 0, "creation_date": 1571263511, "post_id": 58421829, "comment_id": 103186764, "body": "thanks guys. My mistake was that in my <code>~&#47;.zshrc</code> I had <code>PSQL_URL=&quot;...&quot;</code> but not <code>export PSQL_URL=&quot;...&quot;</code>, should work now."}], "answers": [{"comments": [{"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "edited": false, "score": 0, "creation_date": 1571261344, "post_id": 58421911, "comment_id": 103186089, "body": "All from the same terminal session (inside VSCode), using default zsh. I&#39;m a bit lost as to how solve this"}], "tags": [], "owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "is_accepted": true, "score": 1, "last_activity_date": 1571263351, "last_edit_date": 1571263351, "creation_date": 1571261112, "answer_id": 58421911, "question_id": 58421829, "link": "https://stackoverflow.com/questions/58421829/how-to-get-os-env-variable-on-osx/58421911#58421911", "title": "How to get os env variable on OSX?", "body": "<p>That's the correct way of reading an env variable in <code>go</code>.</p>\n\n<p>The only thing that comes to my mind about what might be happening  is that you have two different terminal sessions. In one of them you set <code>PSQL_URL</code> (you are running the <code>echo</code> in this one) and in the other not (you are running your <code>go</code> app here).</p>\n\n<p>EDIT</p>\n\n<p>Expanded now with the your comments and Felix's, the problem here is that you export a variable, but don't make it permanent, so when you start a new session the variable doesn't exist. What you need to do is edit your <code>~/.zshrc</code> and add <code>export PSQL_URL=foo</code>, this way, whenever you start a new terminal session, the variable will be loaded.</p>\n"}], "owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 58421911, "answer_count": 1, "score": 0, "last_activity_date": 1571263773, "creation_date": 1571260608, "last_edit_date": 1571263773, "question_id": 58421829, "link": "https://stackoverflow.com/questions/58421829/how-to-get-os-env-variable-on-osx", "title": "How to get os env variable on OSX?", "body": "<p>OSX Catalina &amp; zsh as my terminal.</p>\n\n<p>I have a command to start a psql connection :</p>\n\n<pre><code>db, err := pgx.Connect(context.Background(), os.Getenv(\"PSQL_URL\"))\n</code></pre>\n\n<p>But the <code>os.Getenv(\"PSQL_URL\")</code> is an empty string.</p>\n\n<p>How to make sure go program can read my environment variable ?</p>\n\n<p>In the terminal, if I <code>echo $PSQL_URL</code> I get the proper <code>postgresql://aod:toto@localhost/dbname</code></p>\n\n<p>If I export <code>PSQL_URL=\"postgresql://aod:toto@localhost/dbname\"</code> before running main.go it works fine</p>\n\n<p>I'm looking for a persistent way of doing it.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My mistake was as follow : \nInside <code>~/.zhsrc</code> I did set \n<code>PSQL_URL=\"postgresql://aod:toto@localhost</code> </p>\n\n<p>instead of </p>\n\n<p><code>export PSQL_URL=\"postgresql://aod:toto@localhost\"</code></p>\n"}, {"tags": ["go", "avro"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1571261365, "post_id": 58421152, "comment_id": 103186098, "body": "I know nothing about avro however on their doc page <a href=\"https://avro.apache.org/docs/current/gettingstartedpython.html\" rel=\"nofollow noreferrer\">avro.apache.org/docs/current/gettingstartedpython.html</a>  it says <code>Data in Avro is always stored with its corresponding schema, meaning we can always read a serialized item, regardless of whether we know the schema ahead of time</code>  and it references a file xxx.avsc which is the schema file I would say ... so you might want to look into creating the schema file"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 3801397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9caf262f9a6d123c7a987844bb4e8747?s=128&d=identicon&r=PG&f=1", "display_name": "sergeyfo", "link": "https://stackoverflow.com/users/3801397/sergeyfo"}, "is_accepted": false, "score": 1, "last_activity_date": 1589787690, "creation_date": 1589787690, "answer_id": 61864660, "question_id": 58421152, "link": "https://stackoverflow.com/questions/58421152/how-to-create-an-avro-file-using-go/61864660#61864660", "title": "How to create an AVRO file using Go?", "body": "<p>Avro defines the data encoding format only which can be packaged as messages or files. So, for file storage should use Avro OCF - Avro Object Container Files. Here is a working <a href=\"https://pkg.go.dev/github.com/hamba/avro/ocf?tab=doc#example-NewEncoder\" rel=\"nofollow noreferrer\">hamba avro ocf encoder example</a>.</p>\n\n<p>In my code I've encoded multiple rows to upload it to BigQuery (error checks, init, and close are omitted for clarity):</p>\n\n<pre><code>f, err := os.Open(\"/your/avro/file.avro\")\nenc, err := ocf.NewEncoder(schema, w, ocf.WithCodec(ocf.Snappy))\nfor _, item := range items {\n    enc.Encode(item)\n}\n</code></pre>\n"}], "owner": {"reputation": 331, "user_id": 6659081, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e382882d8aa699902cc33ba6d1543dba?s=128&d=identicon&r=PG&f=1", "display_name": "Daniela", "link": "https://stackoverflow.com/users/6659081/daniela"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1589787690, "creation_date": 1571257324, "last_edit_date": 1571260633, "question_id": 58421152, "link": "https://stackoverflow.com/questions/58421152/how-to-create-an-avro-file-using-go", "title": "How to create an AVRO file using Go?", "body": "<p>I'm trying to create an AVRO file using Go. So far I tried a couple of libraries and I have some code.</p>\n\n<p>The problem is that I can work with the data but don't know how to serialize it to store it. Here's the code I got from <code>github.com/hamba/avro</code> with some small modifications.</p>\n\n<pre><code>import (\n  \"fmt\"\n  \"github.com/hamba/avro\"\n  \"log\"\n)\n\ntype SimpleRecord struct {\n        A int64  `avro:\"a\"`\n        B string `avro:\"b\"`\n}\n\nfunc main() {\n    schema, err := avro.Parse(`{\n        \"type\": \"record\",\n        \"name\": \"simple\",\n        \"namespace\": \"hamba\",\n        \"fields\" : [\n            {\"name\": \"a\", \"type\": \"long\"},\n            {\"name\": \"b\", \"type\": \"string\"}\n        ]\n    }`)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    in := SimpleRecord{A: 27, B: \"foo\"}\n\n    data, err := avro.Marshal(schema, in)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(data)\n}\n</code></pre>\n\n<p>This block of code prints:</p>\n\n<pre><code>[54 6 102 111 111]\n</code></pre>\n\n<p>This line corresponds to the avro encoding of the data. And it seems like this is all I need to store, but I don't know how to create the file itself.</p>\n\n<p>I tried:</p>\n\n<pre><code>mode := int(0644)\n    permissions := os.FileMode(mode)\n    err = ioutil.WriteFile(\"file.avro\", data, permissions)\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>And it generates a file. However, when I try to read it as an AVRO file using Python fastavro library, I get the error <code>ValueError: cannot read header - is it an avro file?</code>.</p>\n\n<p>But according to the docs (<a href=\"https://godoc.org/github.com/hamba/avro#example-Marshal\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/hamba/avro#example-Marshal</a>): \"Marshal returns the Avro encoding of v.\" <code>Marshal(schema Schema, v interface{}) ([]byte, error)</code>, so <code>data</code> should be of type <code>[]byte</code>.</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571253414, "post_id": 58420252, "comment_id": 103182780, "body": "Because <code>String</code> isn&#39;t defined on <code>EmailAddress</code>, it&#39;s defined on <code>EmailAddress.Address</code>."}, {"owner": {"reputation": 702, "user_id": 3777314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/600103728/picture?type=large", "display_name": "ocket8888", "link": "https://stackoverflow.com/users/3777314/ocket8888"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571253555, "post_id": 58420252, "comment_id": 103182829, "body": "Then why can I call <code>EmailAddress.String</code> above that?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571253790, "post_id": 58420252, "comment_id": 103182931, "body": "I believe this is a pointer receiver problem. What happens if you make <code>From</code> and <code>To</code> a <code>*EmailAddress</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571253839, "post_id": 58420252, "comment_id": 103182956, "body": "... or just pass in <code>&amp;f</code> instead of <code>f</code> to <code>Execute</code>."}, {"owner": {"reputation": 702, "user_id": 3777314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/600103728/picture?type=large", "display_name": "ocket8888", "link": "https://stackoverflow.com/users/3777314/ocket8888"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571253918, "post_id": 58420252, "comment_id": 103182989, "body": "<i>&quot;or just pass in <code>&amp;f</code> instead of <code>f</code> to <code>Execute</code>&quot;</i> - that did it, @mkopriva you wanna write an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1571255155, "creation_date": 1571255155, "answer_id": 58420686, "question_id": 58420252, "link": "https://stackoverflow.com/questions/58420252/go-template-cant-call-method-on-field/58420686#58420686", "title": "Go template can&#39;t call method on field", "body": "<p>Since <a href=\"https://golang.org/pkg/net/mail/#Address.String\" rel=\"nofollow noreferrer\"><code>String</code></a> is defined with a pointer receiver you need to pass an \"addressable\" instance of <code>mail.Address</code> to the template to be able to execute that method.</p>\n\n<p>You can do this by passing in a pointer to <code>f</code>.</p>\n\n<pre><code>if err := tmpl.Execute(&amp;buff, &amp;f); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Or you can do it by passing in pointer to <code>EmailAddress</code>.</p>\n\n<pre><code>type emailFormatter struct {\n    From *EmailAddress\n    To   *EmailAddress\n}\n\n// ...\n\nf := emailFormatter{\n    To:   &amp;to,\n    From: &amp;from,\n}\n\n// ...\n\nif err := tmpl.Execute(&amp;buff, f); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Or by passing in a pointer to <code>mail.Address</code>.</p>\n\n<pre><code>type EmailAddress struct{ *mail.Address }\n\n// ...\n\nto := EmailAddress{\n    &amp;mail.Address{\n        Address: \"em@i.l\",\n        Name: \"\",\n    },\n}\nfrom := EmailAddress{\n    &amp;mail.Address{\n        Address: \"no-reply@test.quest\",\n        Name: \"\",\n    },\n}\n\nf := emailFormatter{\n    To:   to,\n    From: from,\n}\n\n// ...\n\nif err := tmpl.Execute(&amp;buff, f); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<hr>\n\n<p>Note that the reason you don't need to do that in the Go code is because there the compiler does it for you.</p>\n\n<p>For example:</p>\n\n<pre><code>fmt.Println(to.String())\n</code></pre>\n\n<p>becomes:</p>\n\n<pre><code>fmt.Println((&amp;to).String())\n</code></pre>\n\n<blockquote>\n  <p>A method call x.m() is valid if the method set of (the type of) x\n  contains m and the argument list can be assigned to the parameter list\n  of m. <strong>If x is addressable and &amp;x's method set contains m, x.m() is\n  shorthand for (&amp;x).m()</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 702, "user_id": 3777314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/600103728/picture?type=large", "display_name": "ocket8888", "link": "https://stackoverflow.com/users/3777314/ocket8888"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 58420686, "answer_count": 1, "score": 0, "last_activity_date": 1571255155, "creation_date": 1571253242, "last_edit_date": 1571253823, "question_id": 58420252, "link": "https://stackoverflow.com/questions/58420252/go-template-cant-call-method-on-field", "title": "Go template can&#39;t call method on field", "body": "<p>I have a wrapper around <code>net/mail.Address</code> that provides some marshalling logic. I'm trying to use it in a template, but I keep getting <code>can't evaluate field String in type EmailAddress</code>. The template docs say:</p>\n\n<blockquote>\n  <p>The name of a niladic method of the data, preceded by a period,\n  such as</p>\n  \n  <p>&nbsp;&nbsp;.Method</p>\n  \n  <p>The result is the value of invoking the method with dot as the\n  receiver, dot.Method().</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Method invocations may be chained and combined with fields and keys\n  to any depth:</p>\n  \n  <p>&nbsp;&nbsp;.Field1.Key1.Method1.Field2.Key2.Method2</p>\n</blockquote>\n\n<p>So with that in mind I've written this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"html/template\"\n    \"net/mail\"\n    \"os\"\n)\n\ntype EmailAddress struct{ mail.Address }\n\ntype emailFormatter struct {\n    From         EmailAddress\n    To           EmailAddress\n}\n\nvar tmpl = template.Must(template.New(\"Sample Text\").Parse(\"From: {{.From.String}}\\r\" + `\nTo: {{.To.String}}` + \"\\r\" + `\nContent-Type: text/html` + \"\\r\" + `\nSubject: Sample Text` + \"\\r\\n\\r\" + `\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;title&gt;Sample Text&lt;/title&gt;\n    &lt;meta charset=\"utf-8\"/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    Sample Text\n&lt;/body&gt;\n&lt;/html&gt;\n`));\n\nfunc main() {\n    to := EmailAddress{\n        mail.Address{\n            Address: \"em@i.l\",\n            Name: \"\",\n        },\n    }\n    from := EmailAddress{\n        mail.Address{\n            Address: \"no-reply@test.quest\",\n            Name: \"\",\n        },\n    }\n\n    fmt.Println(to.String()) //outputs (as expected) \"&lt;em@i.l&gt;\"\n    fmt.Println(from.String()) //outputs (as expected) \"&lt;no-reply@test.quest&gt;\"\n\n    f := emailFormatter{\n        To: to,\n        From: from,\n    }\n\n    var buff bytes.Buffer\n    if err := tmpl.Execute(&amp;buff, f); err != nil {\n        fmt.Printf(\"Error: %v\\n\", err)\n        os.Exit(1)\n    }\n    fmt.Println(buff.String())\n}\n\n</code></pre>\n\n<p>I've separately verified that calling <code>EmailAddress.String</code> is totally legal, so I can't figure out why the only output of this is:</p>\n\n<pre><code>Error: template: Sample Text:1:13: executing \"Sample Text\" at &lt;.From.String&gt;: can't evaluate field String in type main.EmailAddress\n</code></pre>\n\n<h1>EDIT</h1>\n\n<p>At a commenter's suggestion I changed the calls from <code>.From.String</code> and <code>.To.String</code> to <code>.From.Address.String</code> and <code>.To.Address.String</code>, because</p>\n\n<blockquote>\n  <p><em>\"<code>String</code> isn't defined on <code>EmailAddress</code>, it's defined on <code>EmailAddress.Address</code>\"</em></p>\n</blockquote>\n\n<p>but the result is the same:</p>\n\n<pre><code>Error: template: Sample Text:1:13: executing \"Sample Text\" at &lt;.From.Address.String&gt;: can't evaluate field String in type mail.Address\n</code></pre>\n"}, {"tags": ["go", "url", "urlencode"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1571249655, "post_id": 58419348, "comment_id": 103181114, "body": "Use <a href=\"https://godoc.org/net/url#QueryEscape\" rel=\"nofollow noreferrer\">url.QueryEscape</a>  (<a href=\"https://play.golang.org/p/84x4WVMlzaU\" rel=\"nofollow noreferrer\">example</a>)."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1571250279, "post_id": 58419348, "comment_id": 103181387, "body": "FTR: Go supports repeated query parameters just fine (url.Values is a <code>map[string][]string</code> for this reason): <a href=\"https://play.golang.org/p/ykpj0wn9CcI\" rel=\"nofollow noreferrer\">play.golang.org/p/ykpj0wn9CcI</a>. I have never seen the order of parameters matter, but yes, Go won&#39;t necessarily preserve them if you parse the URL (also due to using a map)."}], "answers": [{"tags": [], "owner": {"reputation": 416, "user_id": 4338221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7476d44d6543112948e5c5a49a0bd89?s=128&d=identicon&r=PG", "display_name": "Francisco Arias", "link": "https://stackoverflow.com/users/4338221/francisco-arias"}, "is_accepted": true, "score": 14, "last_activity_date": 1613554442, "last_edit_date": 1613554442, "creation_date": 1571262046, "answer_id": 58422036, "question_id": 58419348, "link": "https://stackoverflow.com/questions/58419348/is-there-a-urlencode-function-in-golang/58422036#58422036", "title": "Is there a urlencode() function in golang?", "body": "<p>Yeah you can do it with functions like these ones here:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;encoding/base64&quot;\n    &quot;fmt&quot;\n    &quot;net/url&quot;\n)\n\nfunc main() {\n    s := &quot;enc*de Me Plea$e&quot;\n    fmt.Println(EncodeParam(s))\n    fmt.Println(EncodeStringBase64(s))\n}\n\nfunc EncodeParam(s string) string {\n    return url.QueryEscape(s)\n}\n\nfunc EncodeStringBase64(s string) string {\n    return base64.StdEncoding.EncodeToString([]byte(s))\n}\n</code></pre>\n"}], "owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7497, "favorite_count": 1, "closed_date": 1571295621, "accepted_answer_id": 58422036, "answer_count": 1, "score": 6, "last_activity_date": 1613554442, "creation_date": 1571249501, "question_id": 58419348, "link": "https://stackoverflow.com/questions/58419348/is-there-a-urlencode-function-in-golang", "closed_reason": "Duplicate", "title": "Is there a urlencode() function in golang?", "body": "<p>Many languages, such as JavaScript and PHP, have a <code>urlencode()</code> function which one can use to encode the content of a query string parameter.</p>\n\n<pre><code>\"example.com?value=\" + urlencode(\"weird string &amp; number: 123\")\n</code></pre>\n\n<p>This ensures that the <code>&amp;</code>, <code>%</code>, spaces, etc. get encoded so your URL remains valid.</p>\n\n<p>I see that golang offers a URL package and it has an <a href=\"https://golang.org/pkg/net/url/#Values.Encode\" rel=\"noreferrer\">Encode() function</a> for <em>query string values</em>. This works great, but in my situation, it would require me to parse the URL and I would prefer to not do that.</p>\n\n<p>My URLs are declared by the client and not changing the order and potential duplicated parameters (which is a legal thing in a URL) could be affected. So I use a <code>Replace()</code> like so:</p>\n\n<pre><code>func tweak(url string) string {\n  url.Replace(\"@VALUE@\", new_value, -1)\n  return url\n}\n</code></pre>\n\n<p>The <code>@VALUE@</code> is expected to be used as the value of a query string parameter as in:</p>\n\n<pre><code>example.com?username=@VALUE@\n</code></pre>\n\n<p>So, what I'd like to do is this:</p>\n\n<pre><code>  url.Replace(\"@VALUE@\", urlencode(new_value), -1)\n</code></pre>\n\n<p>Is there such a function readily accessible in Golang?</p>\n"}, {"tags": ["linux", "bash", "shell", "go", "terminal"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571248703, "post_id": 58419112, "comment_id": 103180718, "body": "Bash built-in commands (unsurprisingly) only work when interpreted by bash. Try <code>exec.Command(&quot;bash -c &#39;the command&#39;&quot;)</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1571248794, "post_id": 58419112, "comment_id": 103180764, "body": "It is not possible to implement <code>go run trial.go cd ..</code> as you expect because a process cannot change the current working directory of an ancestor process."}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "edited": false, "score": 1, "creation_date": 1571248900, "post_id": 58419112, "comment_id": 103180806, "body": "<code>exec.Command</code> can be used to execute commands, that is, programs that are accessible in the filesystem via a path. Bash built-ins are not commands. They are not accessible via a path in the filesystem. They only exist with a running Bash process."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571259818, "post_id": 58419112, "comment_id": 103185543, "body": "Aside from that, it sounds like a <i>horrible</i> idea to wrap a shell in Go. The only reason I can imagine is to emulate something like rsh or ssh - which would be reinventing the wheel, to put it polite."}], "answers": [{"tags": [], "owner": {"reputation": 661, "user_id": 5948056, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208535833893814/picture?type=large", "display_name": "programandoconro", "link": "https://stackoverflow.com/users/5948056/programandoconro"}, "is_accepted": false, "score": 1, "last_activity_date": 1571326521, "last_edit_date": 1571326521, "creation_date": 1571325177, "answer_id": 58435791, "question_id": 58419112, "link": "https://stackoverflow.com/questions/58419112/execute-any-command-in-bash/58435791#58435791", "title": "Execute any command in bash", "body": "<p>This works for 'one word' commands, maybe you can fix it to work with more words. Hope is useful. </p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"log\"\n\"os/exec\"\n)\n\nfunc main() {\n    for {\n    fmt.Println(\"Please introduce one word command (ls for example)\")\n    var command string\n    fmt.Scan(&amp;command)\n\n    out, err := exec.Command(command).Output()\n    if err != nil {\n            log.Fatal(err)\n    }\n    fmt.Printf(\"Your output is: %s/n\",out)\n    }\n }\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 9269033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ebc2e2fd7313438ac77f405c1a2816?s=128&d=identicon&r=PG&f=1", "display_name": "Biswajit", "link": "https://stackoverflow.com/users/9269033/biswajit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1571326521, "creation_date": 1571248526, "last_edit_date": 1571295598, "question_id": 58419112, "link": "https://stackoverflow.com/questions/58419112/execute-any-command-in-bash", "title": "Execute any command in bash", "body": "<p>I want a Go program to run a command (including built in commands) in the bash terminal as well as display it in the terminal itself like</p>\n\n<pre><code>$ls\ntrial.go output.txt hello.txt\n$pwd\n/home/bb/cc\n$go run trial.go pwd\n/home/bb/cc\n$go run trial.go cd ..\n$pwd\n/home/bb\n</code></pre>\n\n<p>As, you can see, the golang script takes the command as input, and executes it in the same terminal and environment and also displays the output</p>\n\n<p>I tried the below code but it does not work for the built-in commands</p>\n\n<pre><code>cmd := exec.Command(\"&lt;the input command&gt;\")\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    err := cmd.Run()\n    if err != nil {\n        log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n    }\n</code></pre>\n\n<p>In simple words, the input string is going to be pasted in the terminal and is executed.</p>\n"}, {"tags": ["python", "go", "grpc", "proto"], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 0, "creation_date": 1571301170, "post_id": 58418910, "comment_id": 103197469, "body": "Thank you, I will test it today. Can you tell me, however, why the path that you say is wrong works?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 0, "creation_date": 1571325338, "post_id": 58418910, "comment_id": 103211870, "body": "You can import any <code>.proto</code> file from any location using any relative path. As long as the compiler can match the <code>INCLUDE</code> path with the relative import path to a real file it will work. So clearly on one of your OSes the file path <code>github.com&#47;golang&#47;protobuf&#47;ptypes&#47;timestamp&#47;timestamp.proto</code> exists somewhere where the protoc compiler&#39;s <code>INCLUDE</code> path."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 0, "creation_date": 1571325474, "post_id": 58418910, "comment_id": 103211946, "body": "The reason I said your <code>github.ibm.com&#47;...</code> path is &quot;wrong&quot;, is because <code>timestamp.proto</code> is such a standard definition, it really should be imported from your gRPC toolkit install. This ensure you are using consistent definitions e.g. if you are using syntax <code>proto3</code> you want to make sure you have standard imports that also use <code>proto3</code> etc."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1571325202, "last_edit_date": 1571325202, "creation_date": 1571247634, "answer_id": 58418910, "question_id": 58418450, "link": "https://stackoverflow.com/questions/58418450/generating-python-and-go-code-from-the-same-proto-file-problem-with-imports/58418910#58418910", "title": "Generating Python and Go code from the same .proto file - problem with imports", "body": "<p>This proto path is wrong:</p>\n\n<pre><code>import \"github.com/golang/protobuf/ptypes/timestamp/timestamp.proto\"; // WRONG path\n</code></pre>\n\n<p>This is the correct import path no matter what language you are using - Go or Python etc:</p>\n\n<pre><code>import \"google/protobuf/timestamp.proto\"; // correct path for any language (go, python etc)\n</code></pre>\n\n<hr>\n\n<p>This <code>timestamp.proto</code> file is located by the <code>protoc-gen-go</code> tool (when generating Go code) using its default <code>INCLUDE_PATH</code>.</p>\n\n<p>For example, on my Mac for instance, the default <code>INCLUDE_PATH</code> is:</p>\n\n<pre><code>/usr/local/Cellar/protobuf/3.7.1/include\n</code></pre>\n\n<p>with the full proto file path being:</p>\n\n<pre><code>/usr/local/Cellar/protobuf/3.7.1/include/google/protobuf/timestamp.proto\n</code></pre>\n\n<p>You can see other standard proto definitions that come with your gRPC installation like <code>duration.proto</code>:</p>\n\n<pre><code>$ pwd # my default gRPC include path\n/usr/local/Cellar/protobuf/3.7.1/include\n\n$ find . -name \"*.proto\"\n\n./google/protobuf/timestamp.proto\n./google/protobuf/field_mask.proto\n./google/protobuf/api.proto\n./google/protobuf/duration.proto\n./google/protobuf/struct.proto\n./google/protobuf/wrappers.proto\n./google/protobuf/source_context.proto\n./google/protobuf/any.proto\n./google/protobuf/type.proto\n./google/protobuf/empty.proto\n./google/protobuf/compiler/plugin.proto\n./google/protobuf/descriptor.proto\n</code></pre>\n\n<p>Provided you have installed the gRPC toolkit (and its headers) in the correct location, as per the <a href=\"https://github.com/protocolbuffers/protobuf/releases\" rel=\"nofollow noreferrer\">install docs</a>, then the above directory hierarchy should match for any OS build.</p>\n\n<p>P.S. this <a href=\"https://stackoverflow.com/a/56554322/1218512\">question</a> explains how to set an explicit <code>INCLUDE_PATH</code> when using the proto-compiler.</p>\n"}], "owner": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 58418910, "answer_count": 1, "score": 1, "last_activity_date": 1571325202, "creation_date": 1571245715, "question_id": 58418450, "link": "https://stackoverflow.com/questions/58418450/generating-python-and-go-code-from-the-same-proto-file-problem-with-imports", "title": "Generating Python and Go code from the same .proto file - problem with imports", "body": "<p>I'm having hard time generating the code for Python and Go using shared .proto file. The problematic part is that I am utilising the <code>timestamp.proto</code> (by google) which needs to be imported differently depending on what language the generated code should be in.</p>\n\n<p>The Python code generator requires this form:</p>\n\n<pre><code>import \"google/protobuf/timestamp.proto\";\n</code></pre>\n\n<p>While Go code generator requires this:</p>\n\n<pre><code>import \"github.com/golang/protobuf/ptypes/timestamp/timestamp.proto\";\n</code></pre>\n\n<p>Is it possible to make this import work for both languages? How?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1571247227, "post_id": 58417924, "comment_id": 103180077, "body": "This isn&#39;t a type declaration. It it were it would start with the <code>type</code> keyword, not with <code>var</code>."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1571243864, "creation_date": 1571243864, "answer_id": 58417983, "question_id": 58417924, "link": "https://stackoverflow.com/questions/58417924/what-does-this-type-declaration-do/58417983#58417983", "title": "What does this type declaration do?", "body": "<p>It is a way to enforce that <code>Buffer</code> will be an <code>io.Writer</code>. If, through refactoring, etc. <code>Buffer</code> no longer implements <code>io.Writer</code>, then this will give a compile error.</p>\n"}], "owner": {"reputation": 259, "user_id": 682712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de3007e5e13c2d1f68197fffc5340cea?s=128&d=identicon&r=PG&f=1", "display_name": "snw", "link": "https://stackoverflow.com/users/682712/snw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "closed_date": 1571243900, "accepted_answer_id": 58417983, "answer_count": 1, "score": -3, "last_activity_date": 1571245302, "creation_date": 1571243566, "question_id": 58417924, "link": "https://stackoverflow.com/questions/58417924/what-does-this-type-declaration-do", "closed_reason": "Duplicate", "title": "What does this type declaration do?", "body": "<p>Reading through the source for <a href=\"https://github.com/bet365/jingo\" rel=\"nofollow noreferrer\">jingo</a>, and stubble upon this code:</p>\n\n<pre><code>var _ io.Writer = &amp;Buffer{} // commit to compatibility with io.Writer\n</code></pre>\n\n<p>The comment is not really helping me; what does this code enforce? Assume I am familiar with interface in go.</p>\n\n<p><a href=\"https://github.com/bet365/jingo/blob/master/buffer.go#L20\" rel=\"nofollow noreferrer\">source code</a></p>\n"}, {"tags": ["go", "websocket", "protocols", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1571245083, "post_id": 58417606, "comment_id": 103179102, "body": "Thanks for your answer ! However, if I have to accept the &#171; protocol &#187;, how do I manage to make this one as a token? Because I would like hey to be replaced by my token or something as \u2018auth:token\u2019"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1571245656, "post_id": 58417606, "comment_id": 103179370, "body": "@Emixam23 Write application code to negotiate the protocol by selecting whatever value is in the Sec-Websocket-Protocol request header (example: <code>h := http.Header{&quot;Sec-Websocket-Protocol&quot;: req.Header[&quot;Sec-Websocket-Protocol&quot;]} )</code>  Note that the subprotocol name must be a valid <a href=\"https://tools.ietf.org/html/rfc2616\" rel=\"nofollow noreferrer\">RFC 2616 token</a>.  The value <code>auth:token</code> is not an a valid RFC 2616 token because it contains a &quot;:&quot;."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1571254263, "post_id": 58417606, "comment_id": 103183150, "body": "ALright ! it took me some time to understand from your answer but I could make it work as expected. When you add protocols from client side, if one of them is present in the upgrader, then it doesn&#39;t automatically close the connection :) Thanks again"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1571254886, "last_edit_date": 1571254886, "creation_date": 1571242316, "answer_id": 58417606, "question_id": 58417479, "link": "https://stackoverflow.com/questions/58417479/sec-websocket-protocol-issues/58417606#58417606", "title": "Sec-Websocket-Protocol issues", "body": "<p>If a client requests subprotocols and the server does not agree to one of those subprotocols, then the client is required to close the connection. A client uses the Sec-Websocket-Protocol header to request one or more subprotocols. A server uses the Sec-Websocket-Protocol response header to agree to a protocol.  the See the <a href=\"https://tools.ietf.org/html/rfc6455#section-1.9\" rel=\"nofollow noreferrer\">RFC</a> for more on this topic. </p>\n\n<p>Fix the problem by agreeing to one of the protocols requested by the client. There are a couple of ways to do this.</p>\n\n<p>The first is to use the built-in protocol negotiation feature:</p>\n\n<pre><code>var upgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n    Subprotocols: []string{ \"hey\" },  // &lt;-- add this line\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n</code></pre>\n\n<p>The second is to negotiate the protocol in application code before the call to Upgrade.  Call <a href=\"https://godoc.org/github.com/gorilla/websocket#Subprotocols\" rel=\"nofollow noreferrer\">websocket.Subprotocols</a> to get the requested protocols, select one of the protocols and specify that protocol in the header argument to Upgrade.</p>\n\n<pre><code>h := http.Header{}\nfor _, sub := range websocket.Subprotocols(req) {\n   if sub == \"hey\" {\n      h.Set(\"Sec-Websocket-Protocol\", \"hey\")\n      break\n   }\n}\nconn, err := upgrader.Upgrade(w, r, h)\n</code></pre>\n\n<p>Separate from this issue, the application should <code>defer conn.Close()</code> after successful upgrade.  </p>\n\n<p>Also, the error handling logic can be simplified. The application should exit the read loop on any error returned from ReadMessage. There's no point in writing a message after the connection errors. The ReadMessage method returns a non-nil message on success.</p>\n\n<pre><code>for {\n    // Read message from browser\n    _, msg, err := conn.ReadMessage()\n    if err != nil {\n         fmt.Println(err.Error())\n          fmt.Println(\"disconnected\")\n          return\n    }\n    WriteOutgoingMessage(conn, userID.Hex() + \" \" + string(msg))\n}\n</code></pre>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 58417606, "answer_count": 1, "score": 0, "last_activity_date": 1571254886, "creation_date": 1571241886, "last_edit_date": 1571243099, "question_id": 58417479, "link": "https://stackoverflow.com/questions/58417479/sec-websocket-protocol-issues", "title": "Sec-Websocket-Protocol issues", "body": "<p>I am facing an issue with Go while using the WebSockets protocol. If I connect to my API, everything works fine. If I add \"protocol\" such as \"Hey\", it begins to loop multiple times and finishes by getting an error <code>*github.com/gorilla/websocket.CloseError</code>: \"Code 1006, Text Unexpected EOF\".</p>\n\n<p>I definitely don't get why it acts like this when I send <code>Sec-Websocket-Protocol</code> among the connection.</p>\n\n<p>There is my code:</p>\n\n<p><code>main.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/golang/glog\"\n    \"github.com/grpc-ecosystem/grpc-gateway/runtime\"\n    stacktracer \"gitlab.com/eyes-eyes/internals-stacktracer\"\n    \"gitlab.com/eyesbank/go-web-sockets-server/handlers\"\n    \"net/http\"\n)\n\nconst webSocketsAddr = \"0.0.0.0:8082\"\n\n// main is the starting point of the current micro service.\nfunc main() {\n\n    // Setting the service name\n    stacktracer.SetServiceName(\"Hello 'X' (Web Sockets)\")\n\n    // Initializing the HTTP errors handling\n    runtime.HTTPError = stacktracer.DefaultHTTPError\n\n    if err := RunWebSocketsServer(); err != nil {\n        glog.Fatal(err)\n    }\n\n}\n\n//\n// WebSocket\n//\n\nfunc RunWebSocketsServer() error {\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        handlers.HandleUserSocket(w, r)\n    })\n\n    fmt.Println(webSocketsAddr)\n\n    return http.ListenAndServe(webSocketsAddr, nil)\n}\n\nfunc RunWebSocketsTLSServer() error {\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        handlers.HandleUserSocket(w, r)\n    })\n\n    fmt.Println(webSocketsAddr)\n\n    return http.ListenAndServeTLS(webSocketsAddr, \"server.crt\", \"server.key\", nil)\n}\n</code></pre>\n\n<p><code>handler.go</code></p>\n\n<pre><code>package handlers\n\nimport (\n    \"fmt\"\n    \"github.com/gorilla/websocket\"\n    stacktracer \"gitlab.com/eyes-eyes/internals-stacktracer\"\n    \"gitlab.com/eyes-eyes/internals-stacktracer/structs\"\n    \"go.mongodb.org/mongo-driver/bson/primitive\"\n    \"log\"\n    \"net/http\"\n)\n\nvar upgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\nfunc HandleUserSocket(w http.ResponseWriter, r *http.Request) {\n\n    var userID = primitive.NewObjectID()\n    conn, err := upgrader.Upgrade(w, r, nil) // error ignored for sake of simplicity\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    } else {\n        WriteOutgoingMessage(conn, \"Welcome \"+userID.Hex())\n    }\n\n    fmt.Println(r.Header[\"Sec-Websocket-Protocol\"])\n    if len(r.Header[\"Sec-Websocket-Protocol\"]) &gt; 0 {\n        WriteOutgoingMessage(conn, userID.Hex() + \" \" + string(r.Header[\"Sec-Websocket-Protocol\"][0]))\n    }\n\n    for {\n        // Read message from browser\n        _, msg, err := conn.ReadMessage()\n        if err != nil {\n            if err != nil {\n                switch err.(type) {\n                case *websocket.CloseError:\n                    fmt.Println(\"disconnected\")\n                    return\n                default:\n                    _ = conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n                    fmt.Println(err.Error())\n                    fmt.Println(\"disconnected\")\n                    return\n                }\n            }\n        }\n\n        if msg != nil {\n            WriteOutgoingMessage(conn, userID.Hex() + \" \" + string(msg))\n        }\n    }\n}\n\nfunc WriteOutgoingMessage(conn *websocket.Conn, message string) *structs.StackTrace {\n\n    // Write message back to browser\n    if err := conn.WriteMessage(websocket.TextMessage, []byte(\"Got: \\\"\"+message+\"\\\"\")); err != nil {\n        err = conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        if err != nil {\n            return stacktracer.NewStackTrace(500, err.Error(), nil)\n        }\n    }\n\n    return nil\n\n}\n</code></pre>\n"}, {"tags": ["go", "formatting", "duration"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1571234945, "post_id": 58414820, "comment_id": 103173441, "body": "<a href=\"https://github.com/golang/go/blob/2bbb57c9d4/src/time/time.go#L700-L703\" rel=\"nofollow noreferrer\">The precision for milliseconds is hardcoded to 6 decimals</a> and time.Duration doesn&#39;t implement fmt.Formatter, so you&#39;ll have to write your own formatting function. You can start by copying time.Duration.String and then modify it to suit your needs."}], "answers": [{"comments": [{"owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "edited": false, "score": 0, "creation_date": 1571237154, "post_id": 58415530, "comment_id": 103174929, "body": "Thanks. So far as I can tell, these examples lop off the units - so I cant tell if the process took 123 seconds or 123 millseconds. Obviously fmtTime() can be amended to retain units (at least in simple cases) but I thought it worth mentioning."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "edited": false, "score": 0, "creation_date": 1571239962, "post_id": 58415530, "comment_id": 103176655, "body": "@RedGrittyBrick you&#39;re right. I fixed the code to add the unit."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1571239941, "last_edit_date": 1571239941, "creation_date": 1571235509, "answer_id": 58415530, "question_id": 58414820, "link": "https://stackoverflow.com/questions/58414820/limiting-significant-digits-in-formatted-durations/58415530#58415530", "title": "Limiting significant digits in formatted durations", "body": "<p><code>%v</code> is using Duration.String(), so you either have to write a custom format function, something like:</p>\n\n<pre><code>func fmtTime(in time.Duration, prec int) string {\n  s := in.String()\n  ix := strings.IndexRune(s, '.')\n  if ix == -1 {\n    return s\n  }\n  unit:=len(s)\n  for i,x:=range s[:ix+1] {\n     if !unicode.IsDigit(x) {\n       unit=i+ix+1\n       break\n     }\n  }\n  if prec == 0 {\n     return s[:ix]+s[unit:]\n  }\n  if prec&gt;len(s)-ix-(len(s)-unit)-1 {\n     prec=len(s)-ix-(len(s)-unit)-1\n  }\n  return s[:ix+prec+1]+s[unit:]\n}\n\nfunc main() {\n   ...\n   fmt.Printf(\"%v\\n\", fmtTime(time.Since(started), 3))\n}\n</code></pre>\n\n<p>Or you can define a new type with a formatter, and use the new type to print:</p>\n\n<pre><code>type FmtDuration time.Duration\n\nfunc (d FmtDuration) Format(f fmt.State, c rune) {\n   prec,_ := f.Precision()\n   f.Write([]byte(fmtTime(time.Duration(d), prec)))\n}\n\nfunc main() {\n   fmt.Printf(\"%.2v\", FmtDuration(time.Since(started)))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1578579760, "last_edit_date": 1578579760, "creation_date": 1571235620, "answer_id": 58415564, "question_id": 58414820, "link": "https://stackoverflow.com/questions/58414820/limiting-significant-digits-in-formatted-durations/58415564#58415564", "title": "Limiting significant digits in formatted durations", "body": "<p><strong>Foreword:</strong> I released this utility in <a href=\"https://github.com/icza/gox\" rel=\"nofollow noreferrer\"><code>github.com/icza/gox</code></a>, see <a href=\"https://godoc.org/github.com/icza/gox/timex#Round\" rel=\"nofollow noreferrer\"><code>timex.Round()</code></a>.</p>\n\n<hr>\n\n<p>I don't think there's a <em>simple</em> way because when printed using the default format (e.g. <code>%v</code>), <a href=\"https://golang.org/pkg/time/#Duration.String\" rel=\"nofollow noreferrer\"><code>Duration.String()</code></a> is called to produce the string representation. It returns a <code>string</code> value, so formatting options like number of fraction digits are not applicable anymore.</p>\n\n<p>One way to control the resulting fraction digits is to truncate or round the duration before printing it, using <a href=\"https://golang.org/pkg/time/#Duration.Truncate\" rel=\"nofollow noreferrer\"><code>Duration.Truncate()</code></a> or <a href=\"https://golang.org/pkg/time/#Duration.Round\" rel=\"nofollow noreferrer\"><code>Duration.Round()</code></a>.</p>\n\n<p>Of course the unit to which the duration should be truncated or rounded to depends on the duration's value, but the logic is not that hard:</p>\n\n<pre><code>var divs = []time.Duration{\n    time.Duration(1), time.Duration(10), time.Duration(100), time.Duration(1000)}\n\nfunc round(d time.Duration, digits int) time.Duration {\n    switch {\n    case d &gt; time.Second:\n        d = d.Round(time.Second / divs[digits])\n    case d &gt; time.Millisecond:\n        d = d.Round(time.Millisecond / divs[digits])\n    case d &gt; time.Microsecond:\n        d = d.Round(time.Microsecond / divs[digits])\n    }\n    return d\n}\n</code></pre>\n\n<p>Let's test it with different durations:</p>\n\n<pre><code>ds := []time.Duration{\n    time.Hour + time.Second + 123*time.Millisecond, // 1h0m1.123s\n    time.Hour + time.Second + time.Microsecond,     // 1h0m1.000001s\n    123456789 * time.Nanosecond,                    // 123.456789ms\n    123456 * time.Nanosecond,                       // 123.456\u00b5s\n    123 * time.Nanosecond,                          // 123ns\n}\n\nfor _, d := range ds {\n    fmt.Printf(\"%-15v\", d)\n    for digits := 0; digits &lt;= 3; digits++ {\n        fmt.Printf(\"%-15v\", round(d, digits))\n\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/Zin5dYybbUZ\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>duration       0 digits       1 digit        2 digits       3 digits\n-----------------------------------------------------------------------\n1h0m1.123s     1h0m1s         1h0m1.1s       1h0m1.12s      1h0m1.123s     \n1h0m1.000001s  1h0m1s         1h0m1s         1h0m1s         1h0m1s         \n123.456789ms   123ms          123.5ms        123.46ms       123.457ms      \n123.456\u00b5s      123\u00b5s          123.5\u00b5s        123.46\u00b5s       123.456\u00b5s      \n123ns          123ns          123ns          123ns          123ns       \n</code></pre>\n"}], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 58415564, "answer_count": 2, "score": 4, "last_activity_date": 1578579760, "creation_date": 1571233381, "question_id": 58414820, "link": "https://stackoverflow.com/questions/58414820/limiting-significant-digits-in-formatted-durations", "title": "Limiting significant digits in formatted durations", "body": "<p>I am timing some unpredictable I/O. This code</p>\n\n<pre><code>started := time.Now()\ntime.Sleep(123456789 * time.Nanosecond) // unpredictable process    \nfmt.Printf(\"%v\", time.Since(started))\n</code></pre>\n\n<p>Produces</p>\n\n<pre><code>123.456789ms\n</code></pre>\n\n<p>I like the automatic selection and printing of unit scale (ms, \u03bcs, ns etc) because I don't know in advance whether the timed operation takes microseconds, milliseconds or seconds to complete.</p>\n\n<p>I don't like the precision - I'd prefer to report only two or three significant digits. Is there a <em>simple</em> way to limit the precision in the formatting directive <code>%v</code> or similar?</p>\n"}, {"tags": ["go", "buffalo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571229932, "post_id": 58413605, "comment_id": 103170204, "body": "What have you tried? Include your code. What problems did you encounter?"}, {"owner": {"reputation": 105, "user_id": 5530710, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BEvlv.jpg?s=128&g=1", "display_name": "Odohi David", "link": "https://stackoverflow.com/users/5530710/odohi-david"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571230091, "post_id": 58413605, "comment_id": 103170313, "body": "On the documentation for buffalo, only one to one, and one-to-many relationship was specified. That is reason for the question."}], "answers": [{"tags": [], "owner": {"reputation": 2830, "user_id": 856070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3aeef5f536776e6a56b1581a2a0fee?s=128&d=identicon&r=PG", "display_name": "jcfollower", "link": "https://stackoverflow.com/users/856070/jcfollower"}, "is_accepted": true, "score": 3, "last_activity_date": 1571229846, "creation_date": 1571229846, "answer_id": 58413627, "question_id": 58413605, "link": "https://stackoverflow.com/questions/58413605/specify-many-to-many-relationship-in-buffalo-model/58413627#58413627", "title": "Specify many-to-many relationship in buffalo model", "body": "<p>gobuffalo many_to_many ...</p>\n\n<pre><code>type Organization struct {\n    ID               int                `json:\"id\" db:\"id\"`\n    Users            Users              `many_to_many:\"user_organizations\"`\n}\n\n\ntype User struct {\n    ID                int                `json:\"id\" db:\"id\"`\n    Organizations     Organizations      `many_to_many:\"user_organizations\" json:\"-\"`\n}\n\n\ntype UserOrganization struct {\n    ID             int          `json:\"id\" db:\"id\"`\n    OrganizationID int          `json:\"organization_id\" db:\"organization_id\"`\n    UserID         int          `json:\"user_id\" db:\"user_id\"`\n    User           User         `belongs_to:\"users\"`\n    Organization   Organization `belongs_to:\"organizations\"`\n}\n</code></pre>\n\n<p>Each of these structs are in their own models/*.go file</p>\n\n<p><a href=\"https://gobuffalo.io/en/docs/db/relations\" rel=\"nofollow noreferrer\">https://gobuffalo.io/en/docs/db/relations</a></p>\n"}], "owner": {"reputation": 105, "user_id": 5530710, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BEvlv.jpg?s=128&g=1", "display_name": "Odohi David", "link": "https://stackoverflow.com/users/5530710/odohi-david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 58413627, "answer_count": 1, "score": 0, "last_activity_date": 1571229846, "creation_date": 1571229754, "question_id": 58413605, "link": "https://stackoverflow.com/questions/58413605/specify-many-to-many-relationship-in-buffalo-model", "title": "Specify many-to-many relationship in buffalo model", "body": "<p>Please does anyone know how to specify a many-to-many relationship in buffalo models?</p>\n"}, {"tags": ["go", "design-patterns", "circular-dependency"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1571228925, "post_id": 58413344, "comment_id": 103169612, "body": "Put your types in a separate, shared package, with no dependencies."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1571229234, "post_id": 58413344, "comment_id": 103169763, "body": "Why do they need to be separate packages, or why are you trying to do the same thing in 2 different packages?"}, {"owner": {"reputation": 901, "user_id": 1922287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fafa15e29be87252bac078ac6a2a12f7?s=128&d=identicon&r=PG", "display_name": "laurids", "link": "https://stackoverflow.com/users/1922287/laurids"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1571229613, "post_id": 58413344, "comment_id": 103169988, "body": "@JimB I have many packages and they all need to save stuff on the db. Are you saying it would be better to break the <code>database</code> interface into every single package that only saves its own things instead of having just one, centralized database package?"}, {"owner": {"reputation": 901, "user_id": 1922287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fafa15e29be87252bac078ac6a2a12f7?s=128&d=identicon&r=PG", "display_name": "laurids", "link": "https://stackoverflow.com/users/1922287/laurids"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571233266, "post_id": 58413344, "comment_id": 103172294, "body": "@Flimzy thank you, that makes sense. Reading your other comment I wonder why coupling different packages to a shared type package is better than spreading the db code across packages?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571233999, "post_id": 58413344, "comment_id": 103172776, "body": "Why is <code>foo</code> calling <code>database.saveOnDb</code>? Usually you&#39;d have something depending on both packages so that it can use the <code>foo</code> type and save it to the database. But it&#39;s hard to offer much advice with so little information."}, {"owner": {"reputation": 901, "user_id": 1922287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fafa15e29be87252bac078ac6a2a12f7?s=128&d=identicon&r=PG", "display_name": "laurids", "link": "https://stackoverflow.com/users/1922287/laurids"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571234816, "post_id": 58413344, "comment_id": 103173363, "body": "@Adrian <code>foo</code> is calling <code>database.saveOnDb</code> to save itself, and <code>database</code> is an interface so I can mock it for tests. I don&#39;t understand what you meant in the rest of your comment though"}], "answers": [{"tags": [], "owner": {"reputation": 102, "user_id": 3886935, "user_type": "registered", "profile_image": "https://graph.facebook.com/734980351/picture?type=large", "display_name": "Raymond Jones", "link": "https://stackoverflow.com/users/3886935/raymond-jones"}, "is_accepted": false, "score": 1, "last_activity_date": 1571230191, "creation_date": 1571230191, "answer_id": 58413734, "question_id": 58413344, "link": "https://stackoverflow.com/questions/58413344/how-to-avoid-dependency-cycles-with-shared-packages/58413734#58413734", "title": "How to avoid dependency cycles with shared packages?", "body": "<p>Database should not depend on foo, it should be abstract enough.</p>\n\n<p>Rather than <code>saveOnDb(foo.myfoo)</code> could you use an interface?</p>\n\n<pre><code>type somefoo interface{}\n\nsaveOnDb(somefoo)\n</code></pre>\n\n<p>then call it</p>\n\n<pre><code>database.saveOnDb(myfoo)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1571232035, "post_id": 58414159, "comment_id": 103171520, "body": "This is a step in the wrong direction. It means spreading your db code across packages. This is not good design."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571236711, "post_id": 58414159, "comment_id": 103174636, "body": "The db code is in the db package. Code about your types, including instantiating them, should go with the types (wherever they live) IMO. How you structure your packages is a function of taste and the problem domain, there isn&#39;t one true way to structure go packages."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571237191, "post_id": 58414159, "comment_id": 103174952, "body": "There&#39;s no &quot;one true way&quot;, but there are obvious design smells. And spreading database code across packages is one of the smelliest, and most obvious violations of SOLID principles. Of course, if you don&#39;t care about or desire clean code, then do whatever you want."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571238145, "post_id": 58414159, "comment_id": 103175585, "body": "How do you propose that <code>foo</code> know how to write to the database, then?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571243048, "post_id": 58414159, "comment_id": 103178152, "body": "So then your <code>foo.Create()</code> et al, are just wrappers for <code>db.XXX</code>, so you haven&#39;t solved anything. You&#39;ve only added redirection."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": -3, "last_activity_date": 1571238741, "last_edit_date": 1571238741, "creation_date": 1571231468, "answer_id": 58414159, "question_id": 58413344, "link": "https://stackoverflow.com/questions/58413344/how-to-avoid-dependency-cycles-with-shared-packages/58414159#58414159", "title": "How to avoid dependency cycles with shared packages?", "body": "<p>Another way to approach this is to put foo in charge of saving to the database instead, so foo calls the db package, and other packages just call foo.Save and don't care about the db package. So instead of: </p>\n\n<pre><code>database.saveOnDb(myfoo)\n</code></pre>\n\n<p>If you want to save fields of a foo have this method on an instance of foo which uses the database package to save internally:</p>\n\n<pre><code>foo.Save()\n</code></pre>\n\n<p>And also in foos (or foo) package you'll probably want </p>\n\n<pre><code>foos.Create()\nfoos.Find()\nfoos.FindAll() \n</code></pre>\n\n<p>Which know all about foos and how to return them - the db package should not know that, so it should not import foo. </p>\n\n<p>Your database package definitely shouldn't know about specific types, it should know about talking to the database. Also have a look at some orms if you prefer a more generic solution (but this will require using interface{} a lot). </p>\n"}], "owner": {"reputation": 901, "user_id": 1922287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fafa15e29be87252bac078ac6a2a12f7?s=128&d=identicon&r=PG", "display_name": "laurids", "link": "https://stackoverflow.com/users/1922287/laurids"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1571238741, "creation_date": 1571228887, "question_id": 58413344, "link": "https://stackoverflow.com/questions/58413344/how-to-avoid-dependency-cycles-with-shared-packages", "title": "How to avoid dependency cycles with shared packages?", "body": "<p>I know this gets asked a lot but I still don't understand how to fix it. Say I have this structure:</p>\n\n<pre><code>foo\n- foos.go      // custom foo type\ndatabase\n- database.go  // interface\n- postgres.go  // implementation\n</code></pre>\n\n<p>In <code>database.go</code> I need to import <code>foo</code>, so I can <code>saveOnDb(foo.myfoo)</code>, and in <code>foos.go</code> I need to import <code>database</code>, so I can <code>database.saveOnDb(myfoo)</code>.</p>\n\n<p>This doesn't compile because of the import cycle. What would the correct design be?</p>\n"}, {"tags": ["arrays", "loops", "for-loop", "go", "slice"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1571240759, "post_id": 58412911, "comment_id": 103177094, "body": "the <code>slice</code> inside the loop is <b>block</b> scoped"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1571228221, "creation_date": 1571228221, "answer_id": 58413135, "question_id": 58412911, "link": "https://stackoverflow.com/questions/58412911/how-to-use-list-with-for-loops-in-go/58413135#58413135", "title": "How to use list with for loops in go", "body": "<p>You don't store the result of <code>append()</code> in your \"original\" <code>slice</code>, because you use <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a> instead of <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assignment</a>:</p>\n\n<pre><code>slice := append(slice, i)\n</code></pre>\n\n<p>The short variable declaration (since it's in a different block than the original <code>slice</code> variable) <strong>creates a new variable</strong> (shadowing the outer <code>slice</code>), and inside the loop you print this new variable. So the result of each append is only visible inside the loop body, and is lost when the iteration ends. Instead use assignment:</p>\n\n<pre><code>slice = append(slice, i)\n</code></pre>\n\n<p>However, when you do this, you'll get an infinite loop, because your loop condition is <code>i &lt; len(slice)</code>, and <code>slice</code> grows in every iteration.</p>\n\n<p>Instead you should do something like this (evaluate <code>len(slice)</code> once and store it):</p>\n\n<pre><code>for i, length := 0, len(slice); i &lt; length; i++ {\n    slice = append(slice, i)\n    fmt.Println(slice)\n}\n</code></pre>\n\n<p>And output will be (try it on the <a href=\"https://play.golang.org/p/hlXa-sJUya-\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[5 4 3 2 1 0]\n[5 4 3 2 1 0 1]\n[5 4 3 2 1 0 1 2]\n[5 4 3 2 1 0 1 2 3]\n[5 4 3 2 1 0 1 2 3 4]\n[5 4 3 2 1 0 1 2 3 4]\n</code></pre>\n\n<p>Note that you would get the same result if you'd use <code>for range</code>, because that only evaluates the slice once:</p>\n\n<pre><code>for i := range slice {\n    slice = append(slice, i)\n    fmt.Println(slice)\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/-oSCsqBComq\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 171, "user_id": 10137925, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CyIAP.png?s=128&g=1", "display_name": "TheSmartMonkey", "link": "https://stackoverflow.com/users/10137925/thesmartmonkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 58413135, "answer_count": 1, "score": 1, "last_activity_date": 1571228386, "creation_date": 1571227550, "last_edit_date": 1571228386, "question_id": 58412911, "link": "https://stackoverflow.com/questions/58412911/how-to-use-list-with-for-loops-in-go", "title": "How to use list with for loops in go", "body": "<p>I want to append numbers to a list but my slice update the value only in the for loop.</p>\n\n<p>How do I update it outside?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>slice := []int{5,4,3,2,1}\n\nfor i := 0; i &lt; len(slice); i++ {\n    slice := append(slice, i)\n    fmt.Println(slice)\n}\n\nfmt.Println(slice)\n</code></pre>\n\n<p>Actual result</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>[5 4 3 2 1 0]\n[5 4 3 2 1 1]\n[5 4 3 2 1 2]\n[5 4 3 2 1 3]\n[5 4 3 2 1 4]\n[5 4 3 2 1]\n</code></pre>\n\n<p>Expected result</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>[5 4 3 2 1 0]\n[5 4 3 2 1 1]\n[5 4 3 2 1 2]\n[5 4 3 2 1 3]\n[5 4 3 2 1 4]\n[5 4 3 2 1 0 1 2 3 4]\n</code></pre>\n\n<p>This code works in Python but in go there is something I don't catch</p>\n"}, {"tags": ["go", "serial-port"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571227657, "post_id": 58412829, "comment_id": 103168869, "body": "Related/duplicate: <a href=\"https://stackoverflow.com/q/49260737/13860\">stackoverflow.com/q/49260737/13860</a>"}, {"owner": {"reputation": 2561, "user_id": 11476836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c679da3a7b9adc6f980fb698e3f46b0b?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos G.", "link": "https://stackoverflow.com/users/11476836/marcos-g"}, "edited": false, "score": 0, "creation_date": 1571286391, "post_id": 58412829, "comment_id": 103191609, "body": "Looks like a driver issue, type <code>dmesg | grep &#47;dev&#47;tty*</code> right after plugging the device in to see if the driver is loaded or you are getting any errors"}, {"owner": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "edited": false, "score": 0, "creation_date": 1571611482, "post_id": 58412829, "comment_id": 103288292, "body": "Can you post the output of <code>lsusb -v</code> regarding your device?"}, {"owner": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "edited": false, "score": 0, "creation_date": 1571611572, "post_id": 58412829, "comment_id": 103288302, "body": "Maybe it&#39;s a permissions issue? It&#39;s common with serial devices on linux. Check that your user has permissions to access /dev/ttyACM1. Also check that you&#39;re handling errors properly in the Go code, you should be able to see the permission denied error if that&#39;s the issue."}], "owner": {"reputation": 23, "user_id": 11379280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70b7adfa2fdef3c842470d149fc74c7?s=128&d=identicon&r=PG&f=1", "display_name": "Elykov Alexandr", "link": "https://stackoverflow.com/users/11379280/elykov-alexandr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571227295, "creation_date": 1571227295, "question_id": 58412829, "link": "https://stackoverflow.com/questions/58412829/connect-to-usb-device", "title": "Connect to usb device", "body": "<p>I have a device that connected to my pc over usb-B. And I have a piece of code that can work with it on windows.</p>\n\n<p>On windows we get COM name by vid and pid and use <code>tarm/serial</code> package for connection. But I can't connect to the device on linux same way neither via <code>ttyACM0</code> nor <code>ttyACM1</code></p>\n\n<p>I'm trying to do:</p>\n\n<pre><code>&amp;serial.Config{\n            Name: \"/dev/ttyACM1\",\n            Baud: configuration.ReceiptPrinterBaud,\n            ReadTimeout: time.Second * 2,\n        },\n</code></pre>\n\n<p>But when I read from port with <code>(p *Port) Read()</code>, I'm getting nothing.\nObviously, I just send bytes to nowhere. How can I interact with the device on linux like on windows?</p>\n"}, {"tags": ["mongodb", "performance", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571218749, "post_id": 58410216, "comment_id": 103164046, "body": "You execute 1 thousand queries, averaging 3.5 ms (this includes network transfer back and forth, database execution, result handling, session copying and closing). <b>What is considered good?</b> Given what&#39;s happening under the hood, I don&#39;t think it&#39;s bad. Use the same session if you want better performance."}, {"owner": {"reputation": 47, "user_id": 11931913, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rJ0QzGLdSOk/AAAAAAAAAAI/AAAAAAAAJAU/lihvCXDIg3U/photo.jpg?sz=128", "display_name": "\u0415\u0433\u043e\u0440 \u041a\u043e\u0437\u0435\u043b\u044c\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/11931913/%d0%95%d0%b3%d0%be%d1%80-%d0%9a%d0%be%d0%b7%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b9"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571219077, "post_id": 58410216, "comment_id": 103164209, "body": "I also tried insert 1000 documents to localhost database. 1000 inserts = 36 seconds. But in official speed performance speed is the difference"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1571219126, "post_id": 58410216, "comment_id": 103164234, "body": "I would also execute an <code>mgo.Dial()</code> call before starting the timer, to make sure your session is ready."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1571221538, "post_id": 58410216, "comment_id": 103165493, "body": "And you preclude the possibility that it is your code behaving badly? I would not. Disclose the code and we can find out where the problem is. Hint: If that was the general experience, nobody would use the mongo driver. Not even MongoDB Inc. And all their tools (<code>mongodump</code> etc) are written in Go."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571352228, "post_id": 58410216, "comment_id": 103222754, "body": "Furthermore, you a looking up <code>id</code> (not <code>_id</code>, mind you). That basically means a <a href=\"https://stackoverflow.com/questions/21667173/what-is-a-collection-scan-in-mongodb\">collection scan</a> is happening. Gist: MongoDB needs to open each and every document, read it, compare the value of the field <code>id</code> with 1. Btw, your code does not even compile - I have the feeling that you withhold information either accidentally or intentionally. If code is missing, that precludes us from helping you properly."}], "answers": [{"comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1579555630, "post_id": 58413538, "comment_id": 105798556, "body": "where are you defining Data{}  ?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1579629406, "post_id": 58413538, "comment_id": 105827283, "body": "@ScottStensland To be fair, I did not, since I thought it would be too obvious. Will add it."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1579629475, "last_edit_date": 1592644375, "creation_date": 1571229564, "answer_id": 58413538, "question_id": 58410216, "link": "https://stackoverflow.com/questions/58410216/golang-mongo-driver-performance/58413538#58413538", "title": "Golang mongo driver performance", "body": "<blockquote>\n<p><strong>Important</strong></p>\n<p>Much to my dismay, I cannot suggest to use mgo any more, since it seems to be <a href=\"https://github.com/globalsign/mgo/issues/371#issuecomment-527873696\" rel=\"nofollow noreferrer\">no longer maintained as of the time of this writing</a>.</p>\n</blockquote>\n<p>I was curious and compiled a little benchmark of my own. It uses a single instance MongoDB via docker:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ docker run -d --name mongobench -p 27017:27017 mongo\n731e5f57d677718244c2304a992abd44a5a4bbad6f1fd8e5a23e53b3c4f9ada4\n</code></pre>\n<blockquote>\n<p>Note: The hash you get will be different.</p>\n</blockquote>\n<p>As per the benchmark, it is twofold: simple insert and bulk inserts. Bulk inserts are the preferred way of dealing with mass insertions.</p>\n<p>It tests both the mgo driver and the mongo-go-driver:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package mongobench\n\n// Use\n//  docker run -d --name mongobench -p 27017:27017 mongo\n// to create a suitable test instance and access it via\n//  docker exec -it mongobench mongo\n\nimport (\n    &quot;context&quot;\n    &quot;log&quot;\n    &quot;testing&quot;\n\n    &quot;github.com/globalsign/mgo&quot;\n    &quot;github.com/globalsign/mgo/bson&quot;\n    &quot;go.mongodb.org/mongo-driver/mongo&quot;\n    &quot;go.mongodb.org/mongo-driver/mongo/options&quot;\n)\n\ntype Data struct {\n    ID      primitive.ObjectID `bson:&quot;_id&quot;`\n    Counter int\n}\n\nconst DefaultHost = &quot;localhost:27017&quot;\nconst DefaultDB = &quot;test&quot;\nconst DefaultCollection = &quot;bench&quot;\n\nvar sess *mgo.Session\nvar client *mongo.Client\n\nfunc init() {\n    var err error\n\n    sess, err = mgo.Dial(DefaultHost)\n    if err != nil {\n        log.Fatalf(&quot;setting up session: %s&quot;, err)\n    }\n\n    client, err = mongo.NewClient(options.Client().ApplyURI(&quot;mongodb://&quot; + DefaultHost))\n    if err != nil {\n        log.Fatalf(&quot;setting up client: %s&quot;, err)\n    }\n\n    if err = client.Connect(context.Background()); err != nil {\n        log.Fatalf(&quot;connecting with client: %s&quot;, err)\n    }\n}\nfunc BenchmarkMgoInsert(b *testing.B) {\n\n    c := sess.DB(DefaultDB).C(&quot;simple&quot;)\n    if _, err := c.RemoveAll(bson.M{}); err != nil {\n        b.Logf(&quot;cleaning collection 'simple': %s&quot;, err)\n        b.FailNow()\n    }\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n        if err := c.Insert(&amp;Data{ID: bson.NewObjectId(), Counter: i}); err != nil {\n            b.Logf(&quot;error inserting: %s&quot;, err)\n            b.FailNow()\n        }\n    }\n}\n\nfunc BenchmarkMgoBulk(b *testing.B) {\n    c := sess.DB(DefaultDB).C(&quot;bulk&quot;)\n    if _, err := c.RemoveAll(bson.M{}); err != nil {\n        b.Logf(&quot;cleaning collection 'simple': %s&quot;, err)\n        b.FailNow()\n    }\n\n    b.ResetTimer()\n\n    bulk := c.Bulk()\n\n    for i := 0; i &lt; b.N; i++ {\n        bulk.Insert(&amp;Data{ID: bson.NewObjectId(), Counter: i})\n    }\n\n    if _, err := bulk.Run(); err != nil {\n        b.Logf(&quot;executing bulk: %s&quot;, err)\n        b.FailNow()\n    }\n}\n\nfunc BenchmarkMongoInsert(b *testing.B) {\n    c := client.Database(DefaultDB).Collection(&quot;mongosimple&quot;)\n    if _, err := c.DeleteMany(context.Background(), bson.M{}); err != nil {\n        b.Logf(&quot;cleaning collection 'mongosimple': %s&quot;, err)\n        b.FailNow()\n    }\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n        c.InsertOne(context.Background(), &amp;Data{ID: bson.NewObjectId(), Counter: i})\n    }\n}\n\nfunc BenchmarkMongoBulk(b *testing.B) {\n\n    c := client.Database(DefaultDB).Collection(&quot;mongobulk&quot;)\n    if _, err := c.DeleteMany(context.Background(), bson.M{}); err != nil {\n        b.Logf(&quot;cleaning collection 'mongosimple': %s&quot;, err)\n        b.FailNow()\n    }\n\n    d := make([]mongo.WriteModel, b.N)\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n        d[i] = mongo.NewInsertOneModel().SetDocument(Data{ID: bson.NewObjectId(), Counter: i})\n    }\n\n    if _, err := c.BulkWrite(context.Background(), d); err != nil {\n        b.Logf(&quot;inserting bulk: %s&quot;, err)\n        b.FailNow()\n    }\n\n}\n</code></pre>\n<pre><code>goos: darwin\ngoarch: amd64\npkg: github.com/mwmahlberg/so-mongobench\nBenchmarkMgoInsert-4            1164       1100919 ns/op        1501 B/op         44 allocs/op\nBenchmarkMgoBulk-4            201560          6512 ns/op         258 B/op          4 allocs/op\nBenchmarkMongoInsert-4          1171       1019140 ns/op        3642 B/op         66 allocs/op\nBenchmarkMongoBulk-4          181040          7251 ns/op        1151 B/op         15 allocs/op\n</code></pre>\n<p>What we can see is that both drivers are orders of magnitude faster than what you describe, hence it is safe to assume that it is not the driver causing the delays.</p>\n"}], "owner": {"reputation": 47, "user_id": 11931913, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rJ0QzGLdSOk/AAAAAAAAAAI/AAAAAAAAJAU/lihvCXDIg3U/photo.jpg?sz=128", "display_name": "\u0415\u0433\u043e\u0440 \u041a\u043e\u0437\u0435\u043b\u044c\u0441\u043a\u0438\u0439", "link": "https://stackoverflow.com/users/11931913/%d0%95%d0%b3%d0%be%d1%80-%d0%9a%d0%be%d0%b7%d0%b5%d0%bb%d1%8c%d1%81%d0%ba%d0%b8%d0%b9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1324, "favorite_count": 0, "accepted_answer_id": 58413538, "answer_count": 1, "score": 3, "last_activity_date": 1579629475, "creation_date": 1571218584, "question_id": 58410216, "link": "https://stackoverflow.com/questions/58410216/golang-mongo-driver-performance", "title": "Golang mongo driver performance", "body": "<p>I have written some code for testing mongodb. \nBut its speed is so bad.\nWhat is wrong with is?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func mgoSpeedTest(N int) int64 {\n    session, err := mgo.Dial(MongoHost)\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    start := time.Now()\n    for i := 0; i &lt; N; i++ {\n        sessionCopy := session.Copy()\n        c := session.DB(MongoDB).C(MongoCol)\n        _, err = c.Find(bson.M{\"id\": 1}).Count()\n        if err != nil {\n            log.Fatal(err)\n        }\n        sessionCopy.Close()\n    }\n    t := time.Now()\n    elapsed := t.Sub(start)\n    return elapsed.Milliseconds()\n}\n\nfunc main() {\n    // speed test\n    N := 1000\n    ms = mgoSpeedTest(N)\n    println(fmt.Sprintf(\"mgo: %d\", ms))\n}\n</code></pre>\n\n<p>Answer ~~ 3500ms\nI tried to use mongo-client but speed is the same ~3700-3800</p>\n"}, {"tags": ["go", "stream", "pipe", "exec"], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1571223057, "creation_date": 1571223057, "answer_id": 58411570, "question_id": 58410078, "link": "https://stackoverflow.com/questions/58410078/should-i-wait-on-command-when-using-stdoutpipe-when-using-exec-command/58411570#58411570", "title": "Should I wait on command when using StdoutPipe when using exec.Command?", "body": "<blockquote>\n  <p>But at the same time it is unclear if I need to call this when using StdoutPipe.</p>\n</blockquote>\n\n<p>Yes you still need to <code>Wait()</code> to consider cmd instances ended completely.</p>\n\n<p>However, to pipe the stdout stream, its close signal suffices to detect the end of copy.</p>\n\n<p>The doc says</p>\n\n<blockquote>\n  <p>StdoutPipe returns a pipe that will be connected to the command's\n  standard output when the command starts.</p>\n  \n  <p><strong>Wait will close the pipe after seeing the command exit</strong>, so most\n  callers need not close the pipe themselves; however, an implication is\n  that it is incorrect to call Wait before all reads from the pipe have\n  completed. For the same reason, it is incorrect to call Run when using\n  StdoutPipe. See the example for idiomatic usage.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>Will go clean up the command after the stdout pipe is exhausted and the command has exited or </p>\n</blockquote>\n\n<p>yes.</p>\n\n<blockquote>\n  <p>do I need to rethink my abstractions here?</p>\n</blockquote>\n\n<p>no.</p>\n\n<p>your code is ok.</p>\n"}], "owner": {"reputation": 5145, "user_id": 600545, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d34ee2348ea695f1a5b3408e11e2dca0?s=128&d=identicon&r=PG", "display_name": "romeovs", "link": "https://stackoverflow.com/users/600545/romeovs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571223057, "creation_date": 1571218153, "last_edit_date": 1571218827, "question_id": 58410078, "link": "https://stackoverflow.com/questions/58410078/should-i-wait-on-command-when-using-stdoutpipe-when-using-exec-command", "title": "Should I wait on command when using StdoutPipe when using exec.Command?", "body": "<p>I'm building a small audio application for personal use and need to pipe to some external tools.</p>\n\n<p>I want to structure my program around <code>io.ReadCloser</code>s that I transform and pipe in to PulseAudios <code>paplay</code> command.</p>\n\n<p>A simplified example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"os/exec\"\n)\n\nfunc main () {\n  speech, err := Say(\"Hello world!\")\n  if err != nil {\n    log.Fatal(err)\n  }\n\n  err = Play(speech)\n  if err != nil {\n    log.Fatal(err)\n  }\n}\n\n// Say creates a stream containing text as a text-to-speech wav audio stream.\nfunc Say(text string) (io.ReadCloser, error) {\n  speak := exec.Command(\"espeak\", \"--stdout\", text)\n\n  out, err := speak.StdoutPipe()\n  if err != nil {\n    return nil, err\n  }\n\n  return out, speak.Start()\n}\n\n// Play a wav audio stream.\nfunc Play(s io.ReadCloser) error {\n  play := exec.Command(\"paplay\")\n\n  play.Stdin = s\n  play.Stderr = os.Stderr\n\n  return play.Run()\n}\n</code></pre>\n\n<p>This is a simplified example, but I'd like to create wav streams using different commands, concatenate them and pipe them to <code>paplay</code>.</p>\n\n<p>The go docs on <a href=\"https://godoc.org/os/exec#Cmd.Wait\" rel=\"nofollow noreferrer\"><code>exec.Cmd</code></a> specify that I need to call <code>Wait</code> on each command to ensure the resources allocated for running the command are cleared:</p>\n\n<blockquote>\n  <p>Wait releases any resources associated with the Cmd.</p>\n</blockquote>\n\n<p>But at the same time it is unclear if I need to call this when using <a href=\"https://godoc.org/os/exec#Cmd.StdoutPipe\" rel=\"nofollow noreferrer\"><code>StdoutPipe</code></a>.</p>\n\n<p>Will go clean up the command after the stdout pipe is exhausted and the command has exited or do I need to rethink my abstractions here?</p>\n"}, {"tags": ["loops", "go", "reverse"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571218586, "post_id": 58409976, "comment_id": 103163938, "body": "You loop from 97 up until 122, incrementing the loop variable. Change the 2 numbers and decrement instead of increment."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571218752, "post_id": 58409976, "comment_id": 103164049, "body": "Instead of <code>for i := 97; i &lt; 123; i++</code> use <code>for i := 123; i &gt; 97; i--</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1571220081, "post_id": 58409976, "comment_id": 103164731, "body": "@Flimzy <code>for i := 122; i &gt;= 97; i-- {}</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1571220506, "post_id": 58409976, "comment_id": 103164984, "body": "@icza: You&#39;re right... the 2 hard problems in computer science: cache invalidation, naming things, and off-by-1 errors."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1571230356, "creation_date": 1571230356, "answer_id": 58413786, "question_id": 58409976, "link": "https://stackoverflow.com/questions/58409976/best-way-to-reverse-the-loop/58413786#58413786", "title": "Best way to reverse the loop", "body": "<blockquote>\n  <p>I output the alphabet and want to make it reverse.</p>\n</blockquote>\n\n<hr>\n\n<p>If you write the program in idiomatic Go, the solution should be obvious.</p>\n\n<pre><code>package main\n\nimport \"github.com/01-edu/z01\"\n\nfunc main() {\n    // forward\n    for i := 'a'; i &lt;= 'z'; i++ {\n        z01.PrintRune(i)\n    }\n    z01.PrintRune('\\n')\n\n    // reverse\n    for i := 'z'; i &gt;= 'a'; i-- {\n        z01.PrintRune(i)\n    }\n    z01.PrintRune('\\n')\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/hPt7rqzxLok\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hPt7rqzxLok</a></p>\n\n<p>Output:</p>\n\n<pre><code>abcdefghijklmnopqrstuvwxyz\nzyxwvutsrqponmlkjihgfedcba\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9774481, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "azamat", "link": "https://stackoverflow.com/users/9774481/azamat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 58413786, "answer_count": 1, "score": -2, "last_activity_date": 1571230356, "creation_date": 1571217810, "last_edit_date": 1571222597, "question_id": 58409976, "link": "https://stackoverflow.com/questions/58409976/best-way-to-reverse-the-loop", "title": "Best way to reverse the loop", "body": "<p>I am trying to learn Go. I have a block of code. For example, if I output the alphabet and want to make it reverse. How do I do it for the loop? </p>\n\n<pre><code>package main\n\nimport \"github.com/01-edu/z01\"\n\nfunc main() {\n    i := 97\n    for i &lt; 123 {\n        z01.PrintRune(rune(i))\n        i++\n    }\n    z01.PrintRune('\\n')\n}\n</code></pre>\n\n<p>P.S. I understood the code. Thanks all for your comments. I am not deleting, this thread might be useful for someone new in programming like me.</p>\n"}, {"tags": ["go", "struct", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1571211090, "post_id": 58407994, "comment_id": 103159893, "body": "<code>PCDCOrderAsset.ParentInfo</code> is not a struct, it does not have a <code>PCOrderID</code> field. It&#39;s a slice, its elements do, e.g. <code>pcdcorder.ParentInfo[0].PCOrderID</code>. Whether this is what you want we can&#39;t tell."}, {"owner": {"reputation": 353, "user_id": 10858059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce89c807fce647a7b9e9e4aa995a05df?s=128&d=identicon&r=PG&f=1", "display_name": "Abhirock", "link": "https://stackoverflow.com/users/10858059/abhirock"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571211442, "post_id": 58407994, "comment_id": 103160079, "body": "Thanks@icza I think you right its slice, sorry I am new to it so I thought like that, could you please make it answer of this query. Its resolve my issue. thanks a lot I tried same way but I didn&#39;t provide ParentInfo[0] I used as ParentInfo[ ]."}, {"owner": {"reputation": 353, "user_id": 10858059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce89c807fce647a7b9e9e4aa995a05df?s=128&d=identicon&r=PG&f=1", "display_name": "Abhirock", "link": "https://stackoverflow.com/users/10858059/abhirock"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571211551, "post_id": 58407994, "comment_id": 103160128, "body": "sorry I am new to go so I didn&#39;t understand the slice one why should I got -1. no logic to give it"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1571211643, "creation_date": 1571211643, "answer_id": 58408182, "question_id": 58407994, "link": "https://stackoverflow.com/questions/58407994/getting-error-while-access-the-struct-type-of-array-element-as-undefined-type/58408182#58408182", "title": "Getting error while access the struct type of array element as undefined (type []ParentIDInfo has no field or method PCOrderID)", "body": "<p><code>PCDCOrderAsset.ParentInfo</code> is not a struct, it does not have a <code>PCOrderID</code> field. It's a slice (of element type <code>ParentIDInfo</code>), so its elements do, e.g. <code>pcdcorder.ParentInfo[0].PCOrderID</code>.</p>\n\n<p>Whether this is what you want we can't tell. <code>pcdcorder.ParentInfo[0].PCOrderID</code> gives you the <code>PCOrderID</code> field of the first element of the slice. Based on your question this may or may not be what you want. You may want to append all IDs (one from each element). Also note that if the slice is empty (its length is 0), then <code>pcdcorder.ParentInfo[0]</code> would result in a runtime panic. You could avoid that by first checking its length and only index it if its not empty.</p>\n\n<p>In case you'd want to add ids of all elements, you could use a <code>for</code> loop to do that, e.g.:</p>\n\n<pre><code>for i := range pcdorder.ParentInfo {\n    keyfarmercas = append(keyfarmercas, pcdcorder.ParentInfo[i].PCOrderID)\n}\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 10858059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce89c807fce647a7b9e9e4aa995a05df?s=128&d=identicon&r=PG&f=1", "display_name": "Abhirock", "link": "https://stackoverflow.com/users/10858059/abhirock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 58408182, "answer_count": 1, "score": 0, "last_activity_date": 1571211653, "creation_date": 1571210960, "last_edit_date": 1571211653, "question_id": 58407994, "link": "https://stackoverflow.com/questions/58407994/getting-error-while-access-the-struct-type-of-array-element-as-undefined-type", "title": "Getting error while access the struct type of array element as undefined (type []ParentIDInfo has no field or method PCOrderID)", "body": "<p>I am new to golang and I have one issue which I think community can help me to solve it.</p>\n\n<p>I have one data structure like below </p>\n\n<pre><code>     type ParentIDInfo struct {\n    PCOrderID      string         `json:\"PCorderId\",omitempty\"`\n    TableVarieties TableVarietyDC `json:\"tableVariety\",omitempty\"`\n    ProduceID      string         `json:\"PRID\",omitempty\"`\n}\n\ntype PCDCOrderAsset struct {\n    PcID         string              `json:\"PCID\",omitempty\"`\n    DcID         string              `json:\"DCID\",omitempty\"`\n    RequiredDate string              `json:\"requiredDate\",omitempty\"`\n    Qty          uint64              `json:\"QTY\",omitempty\"`\n    OrderID      string              `json:\"ORDERID\",omitempty\"`\n    Status       string              `json:\"STATUS\",omitempty\"`\n    Produce      string              `json:\"Produce\",omitempty\"`\n    Variety      string              `json:\"VARIETY\",omitempty\"`\n    Transports   []TransportaionPCDC `json:\"Transportaion\",omitempty\"`\n    ParentInfo   []ParentIDInfo        `json:\"ParentInfo\",omitempty\"`\n</code></pre>\n\n<p>So I have issue to access the <strong>PCOrderID</strong> which inside the <strong>[]ParentIDInfo</strong> . I have tried below however I getting error as \"pcdcorder.ParentInfo.PCOrderID undefined (type []ParentIDInfo has no field or method PCOrderID)\"</p>\n\n<pre><code>keyfarmercas = append(keyfarmercas, pcdcorder.ParentInfo.PCOrderID)\n</code></pre>\n\n<p>Any help will be very good </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "kubernetes-helm"], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 0, "last_activity_date": 1571271599, "creation_date": 1571271599, "answer_id": 58423231, "question_id": 58407968, "link": "https://stackoverflow.com/questions/58407968/render-error-when-parsing-configmap-in-helm-package/58423231#58423231", "title": "Render error when parsing configmap in helm package", "body": "<p>The <a href=\"https://godoc.org/text/template\" rel=\"nofollow noreferrer\">Go text/template documentation</a> kind of hints at your actual error message: in <code>.Values.foo.bar</code> expressions, each of the parts needs to be a valid Go name, which can't include hyphens.  Conventionally value names are camelCased, so you can change both the variable reference and the name of the value to <code>admUsers</code> (capital \"U\", no hyphen).</p>\n\n<p>The multiple layers of <code>tpl</code> are confusing and probably unnecessary if your <code>userName</code> and <code>password</code> will always be simple strings.  You're also not required to assign the iterator of a <code>range</code> to anything, and (unlike standard Go) if you assign only one variable it will be the value.</p>\n\n<p>I'd probably write this loop as:</p>\n\n<pre><code>{{/* Protect against .Values.ere being missing entirely */}}\n{{- $ere := .Values.ere | default dict -}}\n{{- range $ere.admUsers }}\n&lt;User Name=\"{{ .userName }}\" Password=\"{{ .password }}\" /&gt;\n{{- end }}\n</code></pre>\n\n<p>If you want it to be possible to put template syntax in the <code>values.yaml</code> file for the user names and passwords, you need to construct an appropriate expression for <code>tpl</code>; you can't nest the template syntax the way you've shown.</p>\n\n<pre><code>{{- $top := . -}}\n{{- $ere := .Values.ere | default dict -}}\n{{- range $ere.admUsers }}\n&lt;User Name=\"{{ tpl .userName $top }}\" Password=\"{{ tpl .password $top }}\" /&gt;\n{{- end }}\n</code></pre>\n\n<p>If you wanted to construct a string like <code>{{ .userName }}</code> and evaluate it you <em>could</em>, but putting curly braces in templates gets tricky.  I think the inner body of your loop is equivalent to my first form (it ultimately prints out the <code>userName</code> and <code>password</code> of each element in the loop).</p>\n"}], "owner": {"reputation": 137, "user_id": 7739984, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1JGv9sE2Wm4/AAAAAAAAAAI/AAAAAAAAC4c/zvUt6naNWlk/photo.jpg?sz=128", "display_name": "Lucky Tyagi", "link": "https://stackoverflow.com/users/7739984/lucky-tyagi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1549, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571271599, "creation_date": 1571210863, "question_id": 58407968, "link": "https://stackoverflow.com/questions/58407968/render-error-when-parsing-configmap-in-helm-package", "title": "Render error when parsing configmap in helm package", "body": "<p>I have a helm package whose values.yaml contains something like:</p>\n\n<pre><code>ere:\n  adm-users:\n  - userName: test1\n    password: test2\n  - useName: user3\n    password: user4\n</code></pre>\n\n<p>and I want to include these values in an xml file dynamically for which in the deployment.yaml i've included a configmap. My configmap contains something like:</p>\n\n<pre><code>data:\n  PoolServer.xml: {{ tpl (.Files.Get \"files/config/PoolServer.xml\") . | nindent 4 }}\n</code></pre>\n\n<p>Inside my PoolServer.xml I have this content:</p>\n\n<pre><code>{{- range $index, $val := .Values.ere.adm-users }}\n&lt;User Name=\"{{ tpl \"{{ $val.userName }}\" $ }} \" Password=\"{{ tpl \"{{ $val.password }}\" $ }}\" /&gt;\n{{- end }\n</code></pre>\n\n<p>This is what it looks like after i did quite a few changes but it doesn't seem to work.</p>\n\n<p>When i lint it fails with error:</p>\n\n<pre><code>[ERROR] templates/: render error in \"eric-em-ere/templates/deployment-ere.yaml\": template: eric-em-ere/templates/deployment-ere.yaml:25:28: executing \"eric-em-ere/templates/deployment-ere.yaml\" at &lt;include (print $.Tem...&gt;: error calling include: template: eric-em-ere/templates/configmap.yaml:14:21: executing \"eric-em-ere/templates/configmap.yaml\" at &lt;tpl (.Files.Get \"fil...&gt;: error calling tpl: Error during tpl function execution for \"&lt;User Name=\\\"{{ .Values.ere.adm-users.userName }}\\\" Password=\\\"{{ .Values.ere.adm-users.password }}\\\" /&gt;\\r\\n\": parse error in \"eric-em-ere/templates/deployment-ere.yaml\": template: eric-em-ere/templates/deployment-ere.yaml:1: bad character U+002D '-'\n</code></pre>\n\n<p>Please help me point out what am i doing wrong here.</p>\n"}, {"tags": ["go", "cryptography", "rsa", "pem"], "comments": [{"owner": {"reputation": 17201, "user_id": 9014097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2dJaU.png?s=128&g=1", "display_name": "Topaco", "link": "https://stackoverflow.com/users/9014097/topaco"}, "edited": false, "score": 2, "creation_date": 1571216931, "post_id": 58407722, "comment_id": 103163004, "body": "Your private key seems to be a Pkcs8-key, but it has the wrong start- and end-line which should be <code>-----BEGIN PRIVATE KEY-----</code> and <code>-----END PRIVATE KEY-----</code>. Your public key seems to be a public Pkcs1-key, but not an X.509-key. I suspect that the <code>MarshalPKIXPublicKey</code>-method must be used to generate an X.509-key whose start- and end-line is <code>-----BEGIN PUBLIC KEY-----</code> and <code>-----END PUBLIC KEY-----</code>. For an overview of the different formats see <a href=\"https://stackoverflow.com/a/49878687/9014097\">here</a> and <a href=\"https://tls.mbed.org/kb/cryptography/asn1-key-structures-in-der-and-pem\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 134, "user_id": 8282064, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/T2xuy.jpg?s=128&g=1", "display_name": "mait.taim", "link": "https://stackoverflow.com/users/8282064/mait-taim"}, "edited": false, "score": 0, "creation_date": 1571220163, "post_id": 58407722, "comment_id": 103164786, "body": "The PEM header and footer are indeed correct the way you do it. Also what you suspected proved to be right. Thx a lot"}], "owner": {"user_type": "does_not_exist", "display_name": "user12169961"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 509, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571210052, "creation_date": 1571210052, "question_id": 58407722, "link": "https://stackoverflow.com/questions/58407722/saving-privatekey-pkcs8-publickey-x509-into-pem-files-and-reading-them-in", "title": "Saving Privatekey (PKCS8) &amp; Publickey (X509) into PEM Files and reading them in Java", "body": "<p>I am generating a key pair in Koltin and saving them into two files, when trying to read these files in any other language than go, it causes and error \"Invalid key format\".</p>\n\n<p>Here the go Code which generates the keys, encodes them and saves them into pem files. The privatekey should be PKCS8 encoded and the publickey X509 encoded.</p>\n\n<pre><code>func ExportPublicKeyAsPemStr(pubkey *rsa.PublicKey) string {\n    pubkeyPem := string(pem.EncodeToMemory(&amp;pem.Block{Type: \"RSA PUBLIC KEY\",Bytes: x509.MarshalPKCS1PublicKey(pubkey)}))\n    err := createFile(\"C:/tmp/publickey.pub\", pubkeyPem)\n    if err != nil {\n        panic(err)\n    }\n    return pubkeyPem\n}\nfunc ExportPrivateKeyAsPemStr(privatekey *rsa.PrivateKey) string {\n    privatekeyBytes, err := x509.MarshalPKCS8PrivateKey(privatekey)\n    if err != nil {\n        panic(err)\n    }\n    privatekeyPem := string(pem.EncodeToMemory(&amp;pem.Block{Type: \"RSA PRIVATE KEY\",Bytes: privatekeyBytes}))\n    err = createFile(\"C:/tmp/privatekey.key\", privatekeyPem)\n    if err != nil {\n        panic(err)\n    }\n    return privatekeyPem\n}\nfunc ExportMsgAsPemStr(msg []byte) string {\n    msgPem := string(pem.EncodeToMemory(&amp;pem.Block{Type: \"MESSAGE\",Bytes: msg}))\n    err := createFile(\"C:/tmp/message.pem\", msgPem)\n    if err != nil {\n        panic(err)\n    }\n    return msgPem\n}\nfunc main() {\n    bits := 2048\n    flag.Parse()\n    //args := flag.Args()\n    //m:=args[0]\n    bobPrivateKey, _ := rsa.GenerateKey(rand.Reader,bits)\n\n    bobPublicKey := &amp;bobPrivateKey.PublicKey\n    fmt.Printf(\"%s\\n\",  ExportPrivateKeyAsPemStr(bobPrivateKey))\n    fmt.Printf(\"%s\\n\", ExportPublicKeyAsPemStr(bobPublicKey))\n    message := []byte(\"This is a message with confidential text\")\n    label := []byte(\"\")\n    hash := sha256.New()\n    ciphertext, _ := rsa.EncryptOAEP(hash, rand.Reader, bobPublicKey, message,label)\n    fmt.Printf(\"%s\\n\",ExportMsgAsPemStr(ciphertext))\n    plainText, _:= rsa.DecryptOAEP(hash, rand.Reader, bobPrivateKey, ciphertext, label)\n    fmt.Printf(\"RSA decrypted to [%s]\", plainText)\n}\n\nfunc createFile(name string, data string) error {\n    f, err := os.Create(name)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    _, err = f.WriteString(data)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Here some sample content of the two pem files:\nPrivatekey:</p>\n\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDB6TI3vNW8+aDx\nyzkI5AFIge6O8qPN2DSS7btnwx3AkMWmLg2PY6y5ocs0riZpSKV7fFCJ9+JVhC2r\ncSmV6EGaq4r6mHrcX26m/5YMNk+93k1E30Q3JlFyoSkTB2zzt8qKP0rvvimMcI56\nuyRiI0LuGdlUqQZ4c0yhyimyHms4vdc6IY3PBFF7V+AKpWkyTmWlUffx987rRp9l\njefz27dsqqv31JvJhBVtQVTAjMSB/vuV0cw6VIBrTBWK5i/zj6NqKp18MEJrugpj\nBPqMErKx0Q3oMQ4iIhW1/+kuyyIYoSInTAERqX03nEp+0XETjsZUK6xUxDOtaeFQ\nqMhN9F6lAgMBAAECggEAeSFeIFlSv0DE3CZR047yikO4LQ2/a3fSp7Hf7pqA/Giz\nPvLnv5nJLRC3qonbLsuVrATlHrp9ZWQzTzRagO1cBe2A3Lfhj8YBjkp8hdZri7TR\nWeOKblT+bffke6GY2soFuMR+4DJPLA6nwl0jBjb2uVvmWi9X/mgwB6UM1NqRqhg9\nrT0Ct0vd5tBtMsEdl5pY7MRaEIfkM4pOC9ZOqv1791EXnO4io5qQgwOYhSJdOb/4\nxavs3gUs+qbJr2dF67vk9RimCNetBdWe917As8QC42JZJcjLupeFwnqRgYGk7ByX\n/gkP+rv3XOFr16UZe3RmDBPfxNdQIQYM2LmlUG5XRQKBgQDObRXQCO/YOZSqfgJZ\nbHo82qY8dv1jR89+SS6JowVbMODaEZnrfCjfediOuiw1siw6bHKoOwXpVZnPoYUa\ndrvdM7S86d/54mBNMU9XqecWsybmlIovnlcob0+zUMUKoaW0jf+xgu8zkwYrtNKW\nrmaSYylyKDjrSL4Zo6HufDUe+wKBgQDweq/U+9XL6ev0ejTww88w5SbD5d7rqGCQ\naSdHvv/Gig8zHic7PM8c+mfrdVKBMQ2Zpls6nynnEhIrjzbqomQzQzAtnT1heJtP\nuCe7V8BM3T79Nel01U05A9O1wEny4pJS1mEKQSgxg0OxNrU27TcNFljaltq0dx3q\nEEyxUrWG3wKBgHIadk4yQnGhEn5TfPT1M3Rj4DPYCiRQ028ZALJv/Ev17rRbulsi\nnG07KutqGXns7Om2fIJlbdUWzhipTavdKecR57vtAzNbYKQKt7LbZbN0f/JA9Ulx\nGvhs3v9djC1eQPxW6ZmzqIk3odeS8jz8VhJg4c4KUbwsz3fYrW/oFGz1AoGAdoJv\nro1hAjnIX1XuSwykSZtULExXPFlhJSm9At18nTIiZXWhrc683rIEjoPl4ebzpdnW\nsaAIfWhpbfAJBz56FM0yq/gGbMeL+pBtfCS1juulhBGSeFI52TQqnDIj/z9rDsm5\nTt1nWmcu7+FfEq96ZsexiB+5rh/ZrSTVNrnk3Y8CgYA6sBJ7MNjAVzNG194djt9G\nTIVpqvi1vb4WoCQENq6jYDj4y4T4wLX6R3ABlqyOHMnKZwAOXsfk2FRDMg51Vb+0\nlAqpBk9cDhNr4Ez0Kwqmx9yZg9ENpie7dQ1/u7Lb1pDr8agAuupa2/lo3CJLSYi7\n+IiJDPwv3xIzDpA5Dy1aTg==\n-----END RSA PRIVATE KEY-----\n</code></pre>\n\n<p>Publickey:</p>\n\n<pre><code>-----BEGIN RSA PUBLIC KEY-----\nMIIBCgKCAQEAwekyN7zVvPmg8cs5COQBSIHujvKjzdg0ku27Z8MdwJDFpi4Nj2Os\nuaHLNK4maUile3xQiffiVYQtq3EplehBmquK+ph63F9upv+WDDZPvd5NRN9ENyZR\ncqEpEwds87fKij9K774pjHCOerskYiNC7hnZVKkGeHNMocopsh5rOL3XOiGNzwRR\ne1fgCqVpMk5lpVH38ffO60afZY3n89u3bKqr99SbyYQVbUFUwIzEgf77ldHMOlSA\na0wViuYv84+jaiqdfDBCa7oKYwT6jBKysdEN6DEOIiIVtf/pLssiGKEiJ0wBEal9\nN5xKftFxE47GVCusVMQzrWnhUKjITfRepQIDAQAB\n-----END RSA PUBLIC KEY-----\n</code></pre>\n\n<p>Now if I for example enter them into this <a href=\"https://www.devglan.com/online-tools/rsa-encryption-decryption\" rel=\"nofollow noreferrer\">website</a> or <a href=\"https://jwt.io/\" rel=\"nofollow noreferrer\">this one</a>(Algorithm RS256) I get an InvalidKeyException...</p>\n\n<p>Could someone tell what I am doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1571210652, "post_id": 58407693, "comment_id": 103159699, "body": "Your program quits before it had chance to do anything else, but print 3 lines and start 3 goroutines."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1571241028, "post_id": 58407693, "comment_id": 103177233, "body": "you&#39;re closing the channel immediately after starting 3 routines that send to an unbuffered channel... the second routine <i>will</i> attempt to send on a closed channel, and all 3 routines will attempt to write <code>C</code> to the channel"}], "answers": [{"comments": [{"owner": {"reputation": 533, "user_id": 4314787, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/100000371520650/picture?type=large", "display_name": "DK2", "link": "https://stackoverflow.com/users/4314787/dk2"}, "edited": false, "score": 0, "creation_date": 1571210792, "post_id": 58407868, "comment_id": 103159760, "body": "It was simple version of my code. I really need to use goruutine to do heavy work."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 533, "user_id": 4314787, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/100000371520650/picture?type=large", "display_name": "DK2", "link": "https://stackoverflow.com/users/4314787/dk2"}, "edited": false, "score": 0, "creation_date": 1571210857, "post_id": 58407868, "comment_id": 103159787, "body": "Both proposed solutions are using goroutines."}, {"owner": {"reputation": 533, "user_id": 4314787, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/100000371520650/picture?type=large", "display_name": "DK2", "link": "https://stackoverflow.com/users/4314787/dk2"}, "edited": false, "score": 0, "creation_date": 1571211171, "post_id": 58407868, "comment_id": 103159937, "body": "second code you proposed seems not working with this error &quot;fatal error: all goroutines are asleep - deadlock!&quot;"}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 3, "last_activity_date": 1571211667, "last_edit_date": 1571211667, "creation_date": 1571210539, "answer_id": 58407868, "question_id": 58407693, "link": "https://stackoverflow.com/questions/58407693/cannot-get-value-from-channel/58407868#58407868", "title": "Cannot get value from channel", "body": "<p>It's possible your channel is closed before you add the values in the channel (<code>close</code> is called before the first line of your goroutines). Then of course there will be nothing to read in the channel.\nInstead of using goroutines to add values in the channel, you could switch to a buffered channel like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport (\n    \"fmt\"\n)\nfunc main() {\n    inputs := []string{\"A\", \"B\", \"C\"}\n    c := make(chan string, len(inputs))\n    for _, s := range inputs {\n        fmt.Println( \"input : \", s)\n        c &lt;- s \n    }\n    close(c)\n    // recive\n    for i := range c {\n        fmt.Println(\"output\", i)\n    }\n}\n</code></pre>\n\n<p>Or you can use a WaitGroup like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport (\n    \"fmt\"\n    \"sync\"\n)\nfunc main() {\n    var wg sync.WaitGroup\n    inputs := []string{\"A\", \"B\", \"C\"}\n    c := make(chan string)\n    for _, s := range inputs {\n        fmt.Println( \"input : \", s)\n        wg.Add(1)\n        go func(s string) {\n            c &lt;- s\n            wg.Done()\n        }(s)\n    }\n    go func(){\n        wg.Wait()\n        close(c)\n    }()\n\n    // recive\n    for i := range c {\n        fmt.Println(\"output\", i)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "is_accepted": false, "score": 1, "last_activity_date": 1571212438, "last_edit_date": 1571212438, "creation_date": 1571211361, "answer_id": 58408122, "question_id": 58407693, "link": "https://stackoverflow.com/questions/58407693/cannot-get-value-from-channel/58408122#58408122", "title": "Cannot get value from channel", "body": "<p>There are couple of things to notice in your code. </p>\n\n<p>First one is usage of <code>s</code> variable from for-loop in a closure. </p>\n\n<pre><code>go func() {\n            c &lt;- s \n        }()\n</code></pre>\n\n<p>Here you could end up with inconsistent values as you don't know when these goroutines are going to execute. For all you know, you could end up writing \"C\" to the channel three times. If you want to use it with separate goroutines, use it like this:</p>\n\n<pre><code>go func(str string) {\n                c &lt;- str \n            }(s)\n</code></pre>\n\n<p>As for values not being retrieved from the channel, channel gets closed before anything can be retrieved from it.  You can write something like this:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc main() {\n    c := make( chan string)\n    go func(){\n      for _, s := range []string{\"A\", \"B\", \"C\"} {\n        fmt.Println( \"input : \", s)\n        c &lt;- s \n      }\n      close( c)\n    }()\n    // recive\n    for i := range c {\n        fmt.Println(\"output\", i)\n    }\n}\n</code></pre>\n\n<p>But even that will give you an output like this (and even this might vary) :</p>\n\n<pre><code>input :  A\ninput :  B\noutput A\noutput B\ninput :  C\noutput C\n</code></pre>\n\n<p>To get the output you wanted you will probably need to use a buffered channel and some sort of mechanism to prevent reading until everything is written to the channel. Maybe something like this:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"sync\"\n)\nfunc main() {\n    c := make( chan string,3)\n    var wg sync.WaitGroup\n    wg.Add(3)\n    for _, s := range []string{\"A\", \"B\", \"C\"} {\n        fmt.Println( \"input : \", s)\n        c &lt;- s \n    }\n\n\n    go func(w *sync.WaitGroup){\n      // recive\n      for i := range c {\n        fmt.Println(\"output\", i)\n        w.Done()\n      }\n    }(&amp;wg)\n\n    wg.Wait()\n    close(c)\n}\n</code></pre>\n"}], "owner": {"reputation": 533, "user_id": 4314787, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/100000371520650/picture?type=large", "display_name": "DK2", "link": "https://stackoverflow.com/users/4314787/dk2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 58407868, "answer_count": 2, "score": 1, "last_activity_date": 1571212438, "creation_date": 1571209950, "last_edit_date": 1571211423, "question_id": 58407693, "link": "https://stackoverflow.com/questions/58407693/cannot-get-value-from-channel", "title": "Cannot get value from channel", "body": "<p>I insert some values to channel. after that I tried to get it out from channel but it does not get out any value and exit. Anyone know WHY?</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc main() {\n    c := make( chan string)\n    for _, s := range []string{\"A\", \"B\", \"C\"} {\n        fmt.Println( \"input : \", s)\n        go func() {\n            c &lt;- s \n        }()\n    }\n    close( c)\n    // recive\n    for i := range c {\n        fmt.Println(\"output\", i)\n    }\n}\n</code></pre>\n\n<p>Expect output</p>\n\n<pre><code>input :  A\ninput :  B\ninput :  C\noutput : A\noutput : B\noutput : C\n</code></pre>\n\n<p>Current output</p>\n\n<pre><code>input :  A\ninput :  B\ninput :  C\n</code></pre>\n"}, {"tags": ["go", "file-read"], "comments": [{"owner": {"reputation": 34787, "user_id": 1092711, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/x6e4H.jpg?s=128&g=1", "display_name": "Pavlo", "link": "https://stackoverflow.com/users/1092711/pavlo"}, "edited": false, "score": 1, "creation_date": 1571210040, "post_id": 58407633, "comment_id": 103159381, "body": "This might help: <a href=\"https://stackoverflow.com/questions/17863821/how-to-read-last-lines-from-a-big-file-with-go-every-10-secs\" title=\"how to read last lines from a big file with go every 10 secs\">stackoverflow.com/questions/17863821/&hellip;</a>"}, {"owner": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "reply_to_user": {"reputation": 34787, "user_id": 1092711, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/x6e4H.jpg?s=128&g=1", "display_name": "Pavlo", "link": "https://stackoverflow.com/users/1092711/pavlo"}, "edited": false, "score": 0, "creation_date": 1571210926, "post_id": 58407633, "comment_id": 103159814, "body": "@Pavlo Thank you, the link question is for getting the last few lines from file, I think my problem is how to locate the special chars line first, then I could use the answers from the link."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1571211237, "post_id": 58407633, "comment_id": 103159978, "body": "Have you tried something?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571214918, "post_id": 58407633, "comment_id": 103161885, "body": "If you have no idea at all how many bytes follow the separator then you have no choice but to read the whole file. If you do, <a href=\"https://golang.org/pkg/os/#File.Seek\" rel=\"nofollow noreferrer\">seek</a> to some offset from the end and start reading from there. Or guess the offset (like 70% of the file size, for instance), and if you don&#39;t find the separator after the guessed offset resort to searching from the beginning."}, {"owner": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1571216702, "post_id": 58407633, "comment_id": 103162897, "body": "@\u0417\u0435\u043b\u0451\u043d\u044b\u0439 Yes, my current way is looking for <code>\\n</code> from the end and backward, until I get the line for  my special characters."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571216322, "post_id": 58408175, "comment_id": 103162702, "body": "this is not efficient at all. You should not load the entire file content in memory, but process it by chunks. Your algorithm is O(n), where n is the size of the file."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571219807, "post_id": 58408175, "comment_id": 103164573, "body": "@mh-cbon did you read my answer at the beginning? And yes, not for file, but for string that is one of the most efficient methods. BTW, I am building a backward reader just like you, but your code look confusing and long for something simple."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571221135, "post_id": 58408175, "comment_id": 103165303, "body": "i will be more than happy to read at your final solution and compare with mine."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571221176, "post_id": 58408175, "comment_id": 103165321, "body": "@mh-cbon - You should look at all my answers for C and VB, a lot of them read file backward. This wouldn&#39;t be the first one."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571221272, "post_id": 58408175, "comment_id": 103165365, "body": "then it should not be a problem for you to show something we can read and benchmark. still waiting."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571231454, "post_id": 58408175, "comment_id": 103171133, "body": "@mh-cbon - I finished my method. It is okay though. Don&#39;t worry about what I said earlier. Your code is fine, it is just another variety. I gave you a thumb up even though I haven&#39;t even tested it yet."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571240911, "post_id": 58408175, "comment_id": 103177179, "body": "hey, i gave it a check, this new solution is much better. It passes my own tests. However, notes that because your function returns the tail content, this algorithm requires to keep in memory that much content. Thus in worst scenario, if the file is big, and the search is found at the begin rather than end, most of the file will end up in memory. Also, in my opinion you should read more than 512 bytes blocks. IO is cheap, but slow, it is better to read larger chunks. I also wonder how often it calls for bytes.Index, hard to tell, a deeper check using pprof would give some proper details."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571241455, "post_id": 58408175, "comment_id": 103177443, "body": "@mh-cbon - I ended up coming up with the solution of checking between two chunks properly. You think I should alter the answer as the total code or keep it like right now?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571241776, "post_id": 58408175, "comment_id": 103177589, "body": "i think it is better to edit and keep only your last version."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571241832, "post_id": 58408175, "comment_id": 103177615, "body": "@mh-cbon - thank you. I agree and I will do that right now."}, {"owner": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "edited": false, "score": 0, "creation_date": 1571284394, "post_id": 58408175, "comment_id": 103191161, "body": "@KevinNg, your code runs well, I tested it on my machine with one &gt;80,000 lines file, the the special string at  line 70, 000 and  79,900 (means the small part contains 10,000 lines or 100 lines), both have good performance, (~200ms and ~100ms), Thank you!"}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "edited": false, "score": 0, "creation_date": 1571351178, "post_id": 58408175, "comment_id": 103222498, "body": "@donnior - Thank you for your comment and you are welcome."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "edited": false, "score": 0, "creation_date": 1571353081, "post_id": 58408175, "comment_id": 103222934, "body": "@donnior - I forgot to mention that my code was written in a general usage way. If you want it to run faster, there are options depend on your usage case. If you are working with small files, it is actually better to just load the entire file into memory. If you working with large file, you can always change per read to 1024, 2048, 4096 depend on how much memory you want to expend. Besides that, if you want to write what you found to disc right away without needing the found in string format, just return the joined byte array together without converting it to string. Then write that to disc."}, {"owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "reply_to_user": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "edited": false, "score": 0, "creation_date": 1571353172, "post_id": 58408175, "comment_id": 103222953, "body": "@donnior - also another option to make this much faster is instead of calling Index, you search the byte array by yourself. But that would require extensive debugging."}], "tags": [], "owner": {"reputation": 2040, "user_id": 7449706, "user_type": "registered", "profile_image": "https://graph.facebook.com/1302265936460934/picture?type=large", "display_name": "Kevin Ng", "link": "https://stackoverflow.com/users/7449706/kevin-ng"}, "is_accepted": false, "score": 1, "last_activity_date": 1571242815, "last_edit_date": 1571242815, "creation_date": 1571211611, "answer_id": 58408175, "question_id": 58407633, "link": "https://stackoverflow.com/questions/58407633/effective-way-to-read-specific-content-from-the-end-of-text-file-with-golang/58408175#58408175", "title": "Effective way to read specific content from the end of text file with Golang", "body": "<p>Note that, I misread your question and thought that it was about reading from string. I updated my answer, but I also like my string reading method. Thus, I will keep it here. Go below to see the new answer.</p>\n\n<p>The routines to solve your problem is simple if the special chars are always the same.</p>\n\n<p>1st: Look for the Index of that special chars string.<br>\n2nd: If found, add that index to the length of that special chars string.<br>\n3rd: Then get all the content from that (index of special chars string + length of special chars string) to the end of the content.<br></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    var str = `\nthis is the very large \npart, contains lots lines.\n\n#SPECIAL CHARS START#\na\n...\nthis is the small part the the end, \ncontain several lines, but \nwe do not know how many lines\nthis part contains\n`   \n    var specialStr = \"#SPECIAL CHARS START#\";\n    var lengthOfSpecial = len(specialStr);\n    var indexOf = strings.Index(str, specialStr);\n    var contentAfter string;\n\n    if ( indexOf != -1 ){\n        // If found get content\n        indexOf += lengthOfSpecial;\n        contentAfter = str[indexOf:];    \n    } else {\n        // If not content after empty.\n        contentAfter = \"\";\n    }\n\n    fmt.Print(contentAfter);\n}\n</code></pre>\n\n<hr>\n\n<h2><strong>New Answer</strong></h2>\n\n<p>Sorry, I haven't written much Golang in such a long time. Thus, I can only come up with the code below. I even forgot that you don't need \";\" at the end of the line :).</p>\n\n<p>Like the other answer already mention. It is nothing new to read file from backward, it just how you do it. When it comes to the code, it is very simple. </p>\n\n<p>You start from the back of the file, read each chunk of the file to the defined size. Then search for that special char. If you don't find the special chars string, you save the result into a data holding slice and continue. If you found that special chars string then you get only what after the need to find string and save into the holding slice. Then break out from the read loop. After you finish with everything, you join and return that data holding slice as a string.</p>\n\n<p>Sound simple? There is one issue and how I dealt with it, I wrote very detail in the note of the code for that part. You kind of have to think about what to do there. So what is the problem? <strong>If you read the file chunk by chunk, expect what you are looking for could be split up by two chunks.</strong> Thus, that has to be taken into consideration. </p>\n\n<p>Note that I use bytes slices and worked directly in bytes. Secondarily, the byte holdings slice index size composition first and its index is utilized from high to low because you don't want to append and then reverse it after. Also, \"perRead\" can't be smaller than the size of the length of the find string.</p>\n\n<p>Also, how do you want to deal with errors? Whether to exit, return a dual value, etc... is up to you. Also, take note that, I assumed all the files that you are going to read will have that special chars. Otherwise, you can just simply keep track of if you found that specials char string in the file or not. If not just return an empty string. If found, compose and return the result string.</p>\n\n<p>Note that, I ended up finding a solution to properly check a small piece from two consecutive read chunks. I documented that into the code before the \"var halfpart\" declaration.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"os\"\nimport \"bytes\"\n\nfunc getLog(fileName string, findStr string) string {\n  const perRead int64 = 512\n\n  file, err := os.Open(fileName)\n  if err != nil {\n    // error code go here for open file error.\n      os.Exit(1)\n  }\n  stat, err := file.Stat()\n  if err != nil {\n    // error code go here for getting file stat.\n      os.Exit(1)\n  }\n\n  // Convert specialChar to find to bytes for fast searching.\n  var findBytes = []byte(findStr)\n  var findLength = len(findBytes)\n  // The length of findStr can't be larger than a read.\n  if int64(findLength) &gt; perRead { os.Exit(1) }\n\n  var lastRead = stat.Size()\n  var contents = make([][]byte, lastRead / perRead + 1)\n  var lastIndex = len(contents) - 1\n  var saveIndex = lastIndex\n\n  for {\n    var readBytes []byte\n\n    if ( lastRead == 0 ){ break }\n    if ( lastRead - perRead &gt; -1 ){\n      readBytes =  make([]byte, perRead )\n      lastRead = lastRead - perRead\n    } else {\n      readBytes = make([]byte, lastRead - 0)\n      lastRead = 0\n    }\n\n    _, err = file.ReadAt(readBytes, lastRead)\n    if ( err != nil ){\n      // error code go here for reading error\n      // This method can't never encounter an eof error\n      os.Exit(1);\n    }\n\n    var indexOf = bytes.Index(readBytes, findBytes)\n\n    if indexOf != -1 {\n      contents[saveIndex] = readBytes[indexOf + findLength:]\n      saveIndex -= 1\n      break\n    } else {\n      if saveIndex &lt; lastIndex {\n        // So for here, take a small chunk of the beginning of last found(equal to findStr's length) \n        // add to a small ended chunk of this found(equal to findStr's length)\n        // However, if this found is less than findStr length,// Then grab whatever available.\n        var halfpart []byte\n        if len(readBytes) &lt; findLength {\n          halfpart = append(readBytes, contents[saveIndex + 1][:findLength]...)\n        } else {\n          halfpart = append(readBytes[len(readBytes) - findLength:], contents[saveIndex + 1][:findLength]...)\n        }\n\n        var indexOf2 = bytes.Index(halfpart, findBytes)\n        if indexOf2 != -1 {\n          saveIndex = saveIndex + 1\n          contents[saveIndex] = append(halfpart[indexOf2 + findLength:], contents[saveIndex][findLength:]...)\n          saveIndex -= 1\n          break\n        }\n      }\n      contents[saveIndex] = readBytes\n      saveIndex -= 1\n    }\n  }\n\n  for i := saveIndex; i &gt; -1; i-- {\n    contents[saveIndex] = []byte{}\n  }\n\n  return string(bytes.Join(contents,[]byte{}))\n}\n\nfunc main() {\n  var fileName = \"test.txt\"\n  var findStr = \"#SPECIAL CHARS START#\"\n  fmt.Println(getLog(fileName, findStr))\n}\n</code></pre>\n\n<p>test.txt content:</p>\n\n<pre><code>Note that, I misread your question and thought that it was about reading from string. I will update this answer tomorrow.\n\nThe routines to solve your problem is simple if the special chars are always the same.\n\n1st: Look for the Index of that special chars string.\n2nd: If found, add that index to the length of that special chars string.\n3rd: Then get all the content from that (index of special chars string + length of special chars string) to the end of the content.\n#SPECIAL CHARS START#\nThe header lines were kept separate because they looked like mail\nheaders and I have mailmode on.  The same thing applies to Bozo's\nquoted text.  Mailmode doesn't screw things up very often, but since\nmost people are usually converting non-mail, it's off by default.\n\nParagraphs are handled ok.  In fact, this one is here just to\ndemonstrate that.\n\nTHIS LINE IS VERY IMPORTANT!\n(Ok, it wasn't *that* important)\n\n\nEXAMPLE HEADER\n==============\n\nSince this is the first header noticed (all caps, underlined with an\n\"=\"), it will be a level 1 header.  It gets an anchor named\n\"section_1\".\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571222013, "post_id": 58409491, "comment_id": 103165716, "body": "for completeness, a bug is hidden in this code at <code>i := bytes.Index(buf, b.Sep)</code> and there is a version of this algorithm that does not require a separator. Both are left as exercises to the interested reader."}, {"owner": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "edited": false, "score": 0, "creation_date": 1571222415, "post_id": 58409491, "comment_id": 103165911, "body": "Thanks a lot, I will test it tomorrow and make feedback."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 2, "last_activity_date": 1571307532, "last_edit_date": 1571307532, "creation_date": 1571216240, "answer_id": 58409491, "question_id": 58407633, "link": "https://stackoverflow.com/questions/58407633/effective-way-to-read-specific-content-from-the-end-of-text-file-with-golang/58409491#58409491", "title": "Effective way to read specific content from the end of text file with Golang", "body": "<p>This solution implements a backward reader.</p>\n\n<p>It reads a file starting from the end by block of <code>b.Len</code> bytes, then it look forwards for a separator, currently <code>\\n</code> within the block, it then advances the starting offset by <code>SepIndex</code> (this is to prevent having the search string being split over two consecutive read). Before proceeding to the next block read, it lookups for the <code>search</code> string within the block read, if found, it returns its starting position within the file and stops.\nOtherwise, it reduces the start offset by <code>b.Len</code> then read next block.</p>\n\n<p>For as long as your search string is in the last 40% of the file, you should get better performance, <strong>but</strong> this is to be battle tested.</p>\n\n<p>If your search string is within the last 10%, i am confident you will get a win.</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"time\"\n\n    \"github.com/mattetti/filebuffer\"\n)\n\nfunc main() {\n\n    var search string\n    var sep string\n    var verbose bool\n    flag.StringVar(&amp;search, \"search\", \"findme\", \"search word\")\n    flag.StringVar(&amp;sep, \"sep\", \"\\n\", \"separator for the search detection\")\n    flag.BoolVar(&amp;verbose, \"v\", false, \"verbosity\")\n    flag.Parse()\n\n    d := make(chan struct{})\n    b := &amp;bytes.Buffer{}\n    go func() {\n        io.Copy(b, os.Stdin)\n        d &lt;- struct{}{}\n    }()\n    &lt;-time.After(time.Millisecond)\n    select {\n    case &lt;-d:\n    default:\n        os.Stdin.Close()\n    }\n\n    readSize := 1024\n    if b.Len() &lt; 1 {\n        input := fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), readSize-5), search)\n        input += input\n        b.WriteString(input)\n    }\n\n    bsearch := []byte(search)\n    s, err := bytesSearch(b.Bytes())\n    if err != nil {\n        log.Fatal(err)\n    }\n    if verbose {\n        s.logger = log.New(os.Stderr, \"\", log.LstdFlags)\n    }\n    s.Buffer = make([]byte, readSize)\n    s.Sep = []byte(sep)\n    got, err := s.Index(bsearch)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Index \", got)\n    got, err = s.Index2(bsearch)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Index \", got)\n\n}\n\ntype tailSearch struct {\n    F      io.ReadSeeker\n    Buffer []byte\n    Sep    []byte\n    start  int64\n    logger interface {\n        Println(...interface{})\n    }\n}\n\nfunc fileSearch(f *os.File) (ret tailSearch, err error) {\n    ret.F = f\n    st, err := f.Stat()\n    if err != nil {\n        return\n    }\n    ret.start = st.Size()\n    ret.Sep = []byte(\"\\n\")\n    return ret, nil\n}\n\nfunc bytesSearch(b []byte) (ret tailSearch, err error) {\n    ret.F = filebuffer.New(b)\n    ret.start = int64(len(b))\n    ret.Sep = []byte(\"\\n\")\n    return\n}\n\nfunc (b tailSearch) Index(search []byte) (int64, error) {\n\n    if b.Buffer == nil {\n        b.Buffer = make([]byte, 1024, 1024)\n    }\n    buf := b.Buffer\n    blen := len(b.Buffer)\n\n    hasended := false\n    for !hasended {\n        if b.logger != nil {\n            b.logger.Println(\"a start\", b.start)\n        }\n        offset := b.start - int64(blen)\n        if offset &lt; 0 {\n            offset = 0\n            hasended = true\n        }\n        _, err := b.F.Seek(offset, 0)\n        if err != nil {\n            hasended = true\n        }\n        n, err := b.F.Read(buf)\n        if b.logger != nil {\n            b.logger.Println(\"f n\", n, \"err\", err)\n        }\n        if err != nil {\n            hasended = true\n        }\n        buf = buf[:n]\n        b.start -= int64(n)\n        if b.logger != nil {\n            b.logger.Println(\"g start\", b.start)\n        }\n        if b.start &gt; 0 {\n            i := bytes.Index(buf, b.Sep)\n            if b.logger != nil {\n                b.logger.Println(\"h sep\", i)\n            }\n            if i &gt; -1 {\n                b.start += int64(i)\n                buf = buf[i:]\n                if b.logger != nil {\n                    b.logger.Println(\"i start\", b.start)\n                }\n            }\n        }\n        if e := bytes.LastIndex(buf, search); e &gt; -1 {\n            return b.start + int64(e), nil\n        }\n    }\n\n    return -1, nil\n}\n\nfunc (b tailSearch) Index2(search []byte) (int64, error) {\n\n    if b.Buffer == nil {\n        b.Buffer = make([]byte, 1024, 1024)\n    }\n    buf := b.Buffer\n    blen := len(b.Buffer)\n\n    hasended := false\n    for !hasended {\n        if b.logger != nil {\n            b.logger.Println(\"a start\", b.start)\n        }\n        offset := b.start - int64(blen)\n        if offset &lt; 0 {\n            offset = 0\n            hasended = true\n        }\n        _, err := b.F.Seek(offset, 0)\n        if err != nil {\n            hasended = true\n        }\n\n        n, err := b.F.Read(buf)\n        if b.logger != nil {\n            b.logger.Println(\"f n\", n, \"err\", err)\n        }\n        if err != nil {\n            hasended = true\n        }\n        buf = buf[:n]\n        b.start -= int64(n)\n\n        if b.logger != nil {\n            b.logger.Println(\"g start\", b.start)\n        }\n\n        for i := 1; i &lt; len(search); i++ {\n            if bytes.HasPrefix(buf, search[i:]) {\n                e := i - len(search)\n                b.start += int64(e)\n                buf = buf[e:]\n            }\n        }\n        if b.logger != nil {\n            b.logger.Println(\"g start\", b.start)\n        }\n\n        if e := bytes.LastIndex(buf, search); e &gt; -1 {\n            return b.start + int64(e), nil\n        }\n    }\n\n    return -1, nil\n}\n</code></pre>\n\n<p>main_test.go</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"strings\"\n    \"testing\"\n)\n\nfunc TestOne(t *testing.T) {\n\n    type test struct {\n        search  []byte\n        readLen int\n        input   string\n        sep     []byte\n        want    int64\n    }\n\n    search := []byte(\"find me\")\n    blockLen := 1024\n    tests := []test{\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%stail content\", search),\n            want:    0,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"\"),\n            want:    -1,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   strings.Repeat(\"nop\\n\", 10000),\n            want:    -1,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), blockLen-5), search),\n            want:    1019,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), blockLen), search),\n            want:    1024,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), blockLen+10), search),\n            want:    1034,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), (blockLen*2)+10), search),\n            want:    2058,\n        },\n        test{\n            search:  search,\n            sep:     []byte(\"\\n\"),\n            readLen: blockLen,\n            input:   fmt.Sprintf(\"%s%s%stail content\", bytes.Repeat([]byte(\" \"), (blockLen*2)+10), search, search),\n            want:    2065,\n        },\n    }\n\n    for i, test := range tests {\n        s, err := bytesSearch([]byte(test.input))\n        if err != nil {\n            t.Fatal(err)\n        }\n        s.Buffer = make([]byte, test.readLen)\n        s.Sep = test.sep\n        got, err := s.Index(test.search)\n        if err != nil {\n            t.Fatal(err)\n        }\n        if got != test.want {\n            t.Fatalf(\"invalid index at %v got %v wanted %v\", i, got, test.want)\n        }\n        got, err = s.Index2(test.search)\n        if err != nil {\n            t.Fatal(err)\n        }\n        if got != test.want {\n            t.Fatalf(\"invalid index at %v got %v wanted %v\", i, got, test.want)\n        }\n    }\n\n}\n</code></pre>\n\n<p>bench_test.go</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"testing\"\n\n    \"github.com/mattetti/filebuffer\"\n)\n\nfunc BenchmarkIndex(b *testing.B) {\n    search := []byte(\"find me\")\n    blockLen := 1024\n    input := fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), blockLen-5), search)\n    input += input\n    s := tailSearch{}\n    s.F = filebuffer.New([]byte(input))\n    s.Buffer = make([]byte, blockLen)\n    for i := 0; i &lt; b.N; i++ {\n        s.start = int64(len(input))\n        _, err := s.Index(search)\n        if err != nil {\n            b.Fatal(err)\n        }\n    }\n}\n\nfunc BenchmarkIndex2(b *testing.B) {\n    search := []byte(\"find me\")\n    blockLen := 1024\n    input := fmt.Sprintf(\"%s%stail content\", bytes.Repeat([]byte(\" \"), blockLen-5), search)\n    input += input\n    s := tailSearch{}\n    s.F = filebuffer.New([]byte(input))\n    s.Buffer = make([]byte, blockLen)\n    for i := 0; i &lt; b.N; i++ {\n        s.start = int64(len(input))\n        _, err := s.Index2(search)\n        if err != nil {\n            b.Fatal(err)\n        }\n    }\n}\n</code></pre>\n\n<p>testing</p>\n\n<pre><code>$ go test -v\n=== RUN   TestOne\n--- PASS: TestOne (0.00s)\nPASS\nok      test/backwardsearch 0.002s\n$ go test -bench=. -benchmem -v\n=== RUN   TestOne\n--- PASS: TestOne (0.00s)\ngoos: linux\ngoarch: amd64\npkg: test/backwardsearch\nBenchmarkIndex-4        20000000           108 ns/op           0 B/op          0 allocs/op\nBenchmarkIndex2-4       10000000           167 ns/op           0 B/op          0 allocs/op\nPASS\nok      test/backwardsearch 4.129s\n$ echo \"rrrrfindme\" | go run main.go -v\n2019/10/17 12:17:04 a start 11\n2019/10/17 12:17:04 f n 11 err &lt;nil&gt;\n2019/10/17 12:17:04 g start 0\nIndex  4\n2019/10/17 12:17:04 a start 11\n2019/10/17 12:17:04 f n 11 err &lt;nil&gt;\n2019/10/17 12:17:04 g start 0\n2019/10/17 12:17:04 g start 0\nIndex  4\n$ cat bench_test.go | go run main.go -search main\nIndex  8\nIndex  8\n$ go run main.go \nIndex  2056\nIndex  2056\n</code></pre>\n"}], "owner": {"reputation": 1023, "user_id": 416767, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/cd468d9f1ad97f81b7a94999ca66f962?s=128&d=identicon&r=PG", "display_name": "donnior", "link": "https://stackoverflow.com/users/416767/donnior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1927, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1571307532, "creation_date": 1571209768, "last_edit_date": 1571219591, "question_id": 58407633, "link": "https://stackoverflow.com/questions/58407633/effective-way-to-read-specific-content-from-the-end-of-text-file-with-golang", "title": "Effective way to read specific content from the end of text file with Golang", "body": "<p>I have a large text log file, which contains two parts separated by some special characters, just like</p>\n\n<pre><code>...\nthis is the very large \npart, contains lots lines.\n\n#SPECIAL CHARS START#\n\n...\nthis is the small part the the end, \ncontain several lines, but \nwe do not know how many lines\nthis part contains\n\n</code></pre>\n\n<p>My requirement is get the small part text content which after <code>#SPECIAL CHARS START#</code> and to the end\uff0c how can I get it effectively with Golang?</p>\n\n<p>UPDATED: \nmy current solution is get line by line from the end of the file and remember the cursor, if the line contains special charactors, break the loop and alreay get the cursor</p>\n\n<pre><code>func getBackwardLine(file *os.File, start int64) (string, int64) {\n    line := \"\"\n    cursor :=start\n    stat, _ := file.Stat()\n    filesize := stat.Size()\n\n    for { \n        cursor--\n        file.Seek(cursor, io.SeekEnd)\n\n        char := make([]byte, 1)\n        file.Read(char)\n\n        if cursor != -1 &amp;&amp; (char[0] == 10 || char[0] == 13) { \n            break\n        }\n\n        line = fmt.Sprintf(\"%s%s\", string(char), line) \n\n        if cursor == -filesize { \n            break\n        }\n    }\n    return line, cursor\n\n}\n\nfunc main() {\n    file, err := os.Open(\"some.log\")\n    if err != nil {\n        os.Exit(1)\n    }\n    defer file.Close()\n\n    var cursor int64 = 0\n    var line = \"\"\n\n    for {  \n        line, cursor = getBackwardLine(file, cursor)\n        fmt.Println(line)\n        if(strings.Contains(line, \"#SPECIAL CHARS START#\")) {\n            break\n        }\n    }\n\n\n    fmt.Println(cursor)  //now we get the cursor for the start of special characters\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "pgx"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571209395, "post_id": 58406657, "comment_id": 103159071, "body": "Related / possible duplicate: <a href=\"https://stackoverflow.com/questions/30867337/golang-order-by-issue-with-mysql/30867686?r=SearchResults#30867686\">Golang ORDER BY issue with MySql</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "is_accepted": true, "score": 0, "last_activity_date": 1571207488, "creation_date": 1571207488, "answer_id": 58407045, "question_id": 58406657, "link": "https://stackoverflow.com/questions/58406657/how-to-use-a-variable-to-fetch-different-table-with-pgx-driver/58407045#58407045", "title": "How to use a variable to fetch different table with pgx driver?", "body": "<p>That is not intention of bind variables. \nIt should be used for data input on query reuse. \nIf table is not known, query can not be parsed and execution plan reused. \nSo, your option is to substitute string. \n<br><br> <strong>Warning:</strong> If table name comes from external source, be sure to check that it is proper identifier (hint: protect from SQL injection)</p>\n"}], "owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 58407045, "answer_count": 1, "score": 0, "last_activity_date": 1571207488, "creation_date": 1571205657, "last_edit_date": 1571206641, "question_id": 58406657, "link": "https://stackoverflow.com/questions/58406657/how-to-use-a-variable-to-fetch-different-table-with-pgx-driver", "title": "How to use a variable to fetch different table with pgx driver?", "body": "<p>Here is a function to fetch for french proverbs :</p>\n\n<pre><code>func (r *proverbRepo) SelectFrByDegree(search string) (proverbs []domain.Proverb, err error) {\n    rows, err := r.Db.Query(context.Background(), `SELECT ID, proverb\n        FROM proverbs_fr \n        WHERE proverb % $1\n        ORDER BY proverb &lt;-&gt; $1 DESC LIMIT 5\n    `, search)\n    if err != nil {\n        return\n    }\n\n    for rows.Next() {\n        var prov domain.Proverb\n        err = rows.Scan(&amp;prov.ID, &amp;prov.Literal)\n        if err != nil {\n            return\n        }\n        proverbs = append(proverbs, prov)\n    }\n    return\n}\n</code></pre>\n\n<p>Sometimes I want to fetch another proverb table from per say proverbs_bzh table. Is it possible to fetch a different table with a variable name ?</p>\n\n<pre><code>SELECT * FROM $1\n</code></pre>\n\n<p>for instance...</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 0, "creation_date": 1571202704, "post_id": 58406074, "comment_id": 103156497, "body": "Something like this: <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">github.com/codegangsta/gin</a> ?"}, {"owner": {"reputation": 23, "user_id": 1571172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48ed8955534e47b3752c693badc0618?s=128&d=identicon&r=PG", "display_name": "artourer", "link": "https://stackoverflow.com/users/1571172/artourer"}, "reply_to_user": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 0, "creation_date": 1571204739, "post_id": 58406074, "comment_id": 103157154, "body": "Yes, thanks. But it looks like strange, when I run &quot;gin --all -i run main.go&quot; handly after connect to docker with &quot;docker exec -it machninename /bin/bash&quot; it works, but If I write it command in dockerfile like &quot;RUN [&quot;gin&quot;, &quot;--all&quot;, &quot;-i&quot;, &quot;run&quot;, &quot;main.go&quot;]&quot; it build once and don&#39;t recompile after changes."}, {"owner": {"reputation": 23, "user_id": 1571172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48ed8955534e47b3752c693badc0618?s=128&d=identicon&r=PG", "display_name": "artourer", "link": "https://stackoverflow.com/users/1571172/artourer"}, "reply_to_user": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 2, "creation_date": 1571207291, "post_id": 58406074, "comment_id": 103158081, "body": "I found, if I mark file changed in docker terminal with command &quot;touch&quot; it works. But if I change files in editor from host machine (windows) it doesn&#39;t work. It seems trouble docker on windows"}], "answers": [{"tags": [], "owner": {"reputation": 3090, "user_id": 8482479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f1bdec0f687e7cabaf47d93cea8d59?s=128&d=identicon&r=PG&f=1", "display_name": "b0gusb", "link": "https://stackoverflow.com/users/8482479/b0gusb"}, "is_accepted": true, "score": 0, "last_activity_date": 1571230829, "last_edit_date": 1571230829, "creation_date": 1571216178, "answer_id": 58409472, "question_id": 58406074, "link": "https://stackoverflow.com/questions/58406074/how-i-can-make-autorestarts-golang-application-in-docker-container/58409472#58409472", "title": "How I can make autorestarts golang application in Docker container?", "body": "<p>Most file monitoring tools on Linux use as their preferred mechanism <a href=\"http://man7.org/linux/man-pages/man7/inotify.7.html\" rel=\"nofollow noreferrer\">inotify</a>. The tool you mentioned <a href=\"https://github.com/mitranim/gow\" rel=\"nofollow noreferrer\">mitranim/gow</a> seems to fall into the same category.</p>\n\n<p>The issue is that a change to the filesystem in Windows does not cause the Linux guest to publish the event. This is kind of expected because Windows doesn't \"know\" a watch has been set, and therefore cannot notify the Linux container when a file has changed. It is a common problem for virtualized environments or other cross-platform / over-the-network file system sharing solutions.</p>\n\n<p>There is similar issue you might want to have a look to: <a href=\"https://github.com/docker/for-win/issues/56\" rel=\"nofollow noreferrer\">Inotify on shared drives does not work</a></p>\n\n<p>A possible solution to the problem is to use polling. <code>nodemon</code> has a <code>legacyWatch</code> flag and can run any command when a file changes:</p>\n\n<blockquote>\n  <p>In some networked environments (such as a container running nodemon\n  reading across a mounted drive), you will need to use the legacyWatch:\n  true which enables Chokidar's polling.</p>\n</blockquote>\n\n<p>Example:</p>\n\n<pre><code>nodemon --legacy-watch &lt;working-dir&gt; -e go --exec \"go run main.go\"\n</code></pre>\n\n<p>Or use <code>nodemon</code> in combination with other monitoring tools by having <code>nodemon</code> touching a file when it detects a file change (kind of a hack):</p>\n\n<pre><code>nodemon --legacy-watch &lt;working-dir&gt; -e go --exec \"touch main.go\"\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 1571172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c48ed8955534e47b3752c693badc0618?s=128&d=identicon&r=PG", "display_name": "artourer", "link": "https://stackoverflow.com/users/1571172/artourer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 58409472, "answer_count": 1, "score": 2, "last_activity_date": 1571230829, "creation_date": 1571202433, "question_id": 58406074, "link": "https://stackoverflow.com/questions/58406074/how-i-can-make-autorestarts-golang-application-in-docker-container", "title": "How I can make autorestarts golang application in Docker container?", "body": "<p>I have the Docker container with Golang and Mongo. I want to make telegram bot, and I want to auto recompile/rerun my go application when I change source code.\nI tried to use <a href=\"https://github.com/mitranim/gow,\" rel=\"nofollow noreferrer\">mitranim/gow</a> but it didn't work.</p>\n\n<p>What I need to use for auto rerun my go application after change source code? I need anything seems nodemon for nodejs, but for go</p>\n\n<p>Here my <a href=\"https://pastebin.com/Btn27wQ7\" rel=\"nofollow noreferrer\">docker-compose</a> and <a href=\"https://pastebin.com/Btn27wQ7\" rel=\"nofollow noreferrer\">dockerfile</a> configs.</p>\n\n<pre><code>My host machine is win10\n</code></pre>\n"}, {"tags": ["go", "grpc", "amazon-kinesis"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1571201898, "post_id": 58405738, "comment_id": 103156315, "body": "Are you intending on having your grpc functions called via grpc?  Or only via your kinesis consumer?"}, {"owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1571202651, "post_id": 58405738, "comment_id": 103156488, "body": "@sberry only via the kinesis consumer. I&#39;m studying here what to do, but the idea is the consumer will call the <code>grpc</code> functions. Another idea is to implement one server that will consume from the different streams, and use the grpc client to call the corresponding server. What are your thoughts on those ideas?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1571202812, "post_id": 58405738, "comment_id": 103156518, "body": "Why have a grpc server at all then?  You are going to be calling a function over tcp/http2 instead in process."}, {"owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1571202963, "post_id": 58405738, "comment_id": 103156556, "body": "True. How would you implement the consumer inside the server then?"}, {"owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1571203119, "post_id": 58405738, "comment_id": 103156591, "body": "@sberry for example, I can use a consumer such as <a href=\"https://github.com/harlow/kinesis-consumer\" rel=\"nofollow noreferrer\">github.com/harlow/kinesis-consumer</a> ... how am I going to pass the consumed record to the server for processing?"}], "owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571200447, "creation_date": 1571199801, "last_edit_date": 1571200447, "question_id": 58405738, "link": "https://stackoverflow.com/questions/58405738/add-handler-for-the-grpc-server-in-golang", "title": "Add handler for the gRPC server in Golang", "body": "<p>I have the following <code>server/server.go</code> definition for my <code>gRPC</code> server:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n\n    \"github.com/golang/glog\"\n    pb \"github.com/go-grpc-tutorial/pb\"\n    \"golang.org/x/net/context\"\n    \"google.golang.org/grpc\"\n    \"net\"\n)\n\n// Implements of EchoServiceServer\n\ntype echoServer struct{}\n\nfunc newEchoServer() pb.EchoServiceServer {\n    return new(echoServer)\n}\n\nfunc (s *echoServer) Echo(ctx context.Context, msg *pb.Message) (*pb.Message, error) {\n    glog.Info(msg)\n    return msg, nil\n}\n\nfunc Run() error {\n    listen, err := net.Listen(\"tcp\", \":50051\")\n    if err != nil {\n        return err\n    }\n    server := grpc.NewServer()\n    pb.RegisterEchoServiceServer(server, newEchoServer())\n    server.Serve(listen)\n    return nil\n}\n\nfunc main() {\n    flag.Parse()\n    defer glog.Flush()\n\n    if err := Run(); err != nil {\n        glog.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>I want the server to listen from a <code>Kinesis</code> stream, so whenever a message is posted to the <code>Kinesis</code> stream, it will consume that message and send it to the <code>Echo()</code> method.\nSo, I'm envisioning something like:</p>\n\n<pre><code>func handleKinesis(s *echoServer) error {\n    // wait until a message is published to the kinesis stream\n    records, err := readFromKinesis() // not implemented here\n    if err != nil {\n      return err\n    }\n    for _, record := records {\n       message := string(record.Data)\n       _, _ = s.Echo(context.Background(), &amp;pb.Message{msg: message})\n    }\n}\n</code></pre>\n\n<p>And the <code>handleKinesis</code> would run in the background, just listening for new <code>Kinesis</code> messages, and then call the <code>echoServer</code> to process that message.\nHow can I accomplish that? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1571199616, "post_id": 58405662, "comment_id": 103155823, "body": "In your <code>main</code> function, try adding <code>fmt.Printf()</code> calls to print out the values of <code>play</code> and <code>computerPlay</code> in a couple of places.  What values do those variables have?"}, {"owner": {"reputation": 2292, "user_id": 4502035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38a1b21c3e83f9d10aaa56c93f6150a?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/4502035/andreas"}, "edited": false, "score": 0, "creation_date": 1571199712, "post_id": 58405662, "comment_id": 103155844, "body": "You might want to use a <a href=\"https://stackoverflow.com/questions/25385173/what-is-a-debugger-and-how-can-it-help-me-diagnose-problems\">debugger</a> for that or look at <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">How to debug small programs</a>"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1571200308, "post_id": 58405662, "comment_id": 103155976, "body": "If instead of doing <code>fmt.Printf</code> directly inside your <code>func ShowResult</code>, you return the result string for print (i.e. <code>fmt.Printf(ShowResult(computerPlay, play))</code>), your <code>func ShowResult</code> can be easily tested with <a href=\"https://medium.com/rungo/unit-testing-made-easy-in-go-25077669318\" rel=\"nofollow noreferrer\">unit test</a>. That way you get to check the output of certain inputs matches your expectation."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1571203312, "post_id": 58405662, "comment_id": 103156661, "body": "<code>if humanPlay == 0 &amp;&amp; humanPlay == 0 </code> s/b <code>if humanPlay == 0 &amp;&amp; computerPlay == 0</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1162, "user_id": 448451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/70942ebe4f297a2c29e013181122e813?s=128&d=identicon&r=PG", "display_name": "Keenan Gebze", "link": "https://stackoverflow.com/users/448451/keenan-gebze"}, "is_accepted": true, "score": 0, "last_activity_date": 1571281633, "last_edit_date": 1571281633, "creation_date": 1571205682, "answer_id": 58406662, "question_id": 58405662, "link": "https://stackoverflow.com/questions/58405662/go-lang-rock-paper-scissors-game/58406662#58406662", "title": "Go-lang Rock Paper Scissors game", "body": "<p>The problem is that you use a pass by value parameter instead of pass by reference parameter in your PlayerPlay function.</p>\n\n<ul>\n<li><p>Function in golang are always passed by value (either 'primitive' or pointer). Pass by value parameters are immutable. It will be allocated new space in memory, different from the <code>var play</code>.</p></li>\n<li><p>In your <code>PlayerPlay()</code> function, the <code>fmt.Scanln(&amp;play)</code> attempts to read and copy the value of <em>the newly alocated space</em> and successfully did so, but in a wrong reference (not on your <code>var play</code>).</p></li>\n<li><p>Thus, the <code>var play</code> variable will remain unchanged, in its default value (for int its 0). And you end up always choosing.</p></li>\n</ul>\n\n<p>What you need to do is change your <code>PlayerPlay()</code> function to accept reference type, and fill it with reference of the <code>var play</code> so that the <code>fmt.Scanln()</code> could mutates the <code>var play</code>.</p>\n\n<p>Eg.</p>\n\n<pre><code>func PlayerPlay(play *int) {\n    fmt.Scanln(play)\n}\n</code></pre>\n\n<p>And use them like so,</p>\n\n<pre><code>  var play int\n  PlayerPlay(&amp;play)\n</code></pre>\n\n<p>Notice the <code>&amp;</code> symbol is used to obtain the reference (pointer) of the value.</p>\n"}], "owner": {"reputation": 13, "user_id": 12224043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89c01202488e2a7ecf98e521a8253007?s=128&d=identicon&r=PG&f=1", "display_name": "Trick", "link": "https://stackoverflow.com/users/12224043/trick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 58406662, "answer_count": 1, "score": 1, "last_activity_date": 1571281633, "creation_date": 1571199135, "last_edit_date": 1571199700, "question_id": 58405662, "link": "https://stackoverflow.com/questions/58405662/go-lang-rock-paper-scissors-game", "title": "Go-lang Rock Paper Scissors game", "body": "<p>Our project is to make a functional Rock Paper Scissors game using Go. I figured this would be a great place to ask for some pointers on some obvious mistakes I could be making. </p>\n\n<p>I am having several problems.</p>\n\n<ol>\n<li>No matter user input the program says I am always entering in \"rock.</li>\n<li>No matter what I input the program also always tells me it is a \"tie\"</li>\n</ol>\n\n<p>So it's quite apparent to me I am having issues with my if/else statements but I am unsure where and what exactly it is. Also I know my <code>PlayerPlay</code> func is ugly but for some reason when I originally had my display menu in there it would keep looping back to my menu without proceeding through the rest of the program. </p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"math/rand\"\n        \"time\"\n)\n\nfunc ComputerPlay() int {\n\n    return rand.Intn(2) + 1\n}\n\nfunc PlayerPlay(play int) int {\n\n    fmt.Scanln(&amp;play)\n\n    return play\n}\n\nfunc PrintPlay(playerName string, play int) {\n\n    fmt.Printf(\"%s picked \", playerName)\n\n    if play == 0 {\n        fmt.Printf(\"rock\\n\")\n    } else if play == 1 {\n        fmt.Printf(\"paper\\n\")\n    } else if play == 2 {\n        fmt.Printf(\"scissors\\n\")\n    }\n\n\n\n    fmt.Printf(\"Computer has chose \")\n            switch ComputerPlay() {\n            case 0:\n                    fmt.Println(\"rock\\n\")\n            case 1:\n                    fmt.Println(\"paper\\n\")\n            case 2:\n                    fmt.Println(\"scissors\\n\")\n}\n\n}\n\n\nfunc ShowResult(computerPlay int, humanPlay int){\n\n    var play int\n    computerPlay = ComputerPlay()\n    humanPlay = PlayerPlay(play)\n\n        if humanPlay == 0 &amp;&amp; humanPlay == 0 {\n        fmt.Printf(\"It's a tie\\n\")\n    } else if humanPlay == 0 &amp;&amp; computerPlay == 1 {\n        fmt.Printf(\" Rock loses to paper\\n\")\n    }   else if humanPlay == 0 &amp;&amp; computerPlay == 2 {\n        fmt.Printf(\"Rock beats scissors\\n\")\n    }   else if humanPlay == 1 &amp;&amp; computerPlay == 0 {\n        fmt.Printf(\" Paper beats rock\\n\")\n    }   else if humanPlay == 1 &amp;&amp; computerPlay == 1 {\n        fmt.Printf(\"It's a tie!\\n\")\n    }   else if humanPlay == 1 &amp;&amp; computerPlay == 2 {\n        fmt.Printf(\"Paper loses to scissors\\n\")\n    } else if humanPlay == 2 &amp;&amp; computerPlay == 0 {\n        fmt.Printf(\"Scissors loses to rock\\n\")\n    } else if humanPlay == 2 &amp;&amp; computerPlay == 1 {\n        fmt.Printf(\" Scissors beats paper\\n\")\n    } else if humanPlay == 2 &amp;&amp; computerPlay == 2 {\n        fmt.Printf(\" It's a tie!\\n\")\n    }\n\n\n}\n\nfunc main() {\n        rand.Seed(time.Now().UnixNano())\n\n        fmt.Printf(\"Welcome to Rock, Paper, Scissors\\n\\n\")\n        fmt.Printf(\"What is your name?\\n\")\n        var playerName string\n        fmt.Scanln(&amp;playerName)\n\n        fmt.Printf(\"Choose\\n\")\n        fmt.Printf(\"0. Rock\\n\")\n        fmt.Printf(\"1. paper\\n\")\n        fmt.Printf(\"2. scissors\\n\")\n        fmt.Printf(\"Your choice -&gt; \")\n        var play int\n        PlayerPlay(play)\n        PrintPlay(playerName, play)\n\n        var computerPlay int\n        ComputerPlay()\n        ShowResult(computerPlay, play)\n\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "revel", "array-indexing"], "comments": [{"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1571200471, "post_id": 58405589, "comment_id": 103156014, "body": "Have you try passing your own <code>add</code> function to the template data?"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1571200740, "post_id": 58405589, "comment_id": 103156073, "body": "You can assign a variable &quot;add&quot; to your controller&#39;s <a href=\"https://godoc.org/github.com/revel/revel#Controller.ViewArgs\" rel=\"nofollow noreferrer\">ViewArgs</a> that returns a +1 value of the input number."}], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 0, "last_activity_date": 1571202186, "creation_date": 1571202186, "answer_id": 58406044, "question_id": 58405589, "link": "https://stackoverflow.com/questions/58405589/how-index-starts-with-1-in-revel-framework/58406044#58406044", "title": "How index starts with 1 in revel Framework", "body": "<p>You can pass a custom function into your controller's <a href=\"https://godoc.org/github.com/revel/revel#Controller.ViewArgs\" rel=\"nofollow noreferrer\">ViewArgs</a> as a variable.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>controller.ViewArgs[\"addOne\"] = func (i int64) {\n    return i+1\n}\n</code></pre>\n\n<p>You can then use <code>$.addOne</code> to access the function in a loop. To use it as a function, you have to add a <code>call</code> keyword before it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>  &lt;tr&gt;\n      &lt;td&gt;rank&lt;/td&gt;\n      &lt;td&gt;abc&lt;/td&gt;\n  &lt;/tr&gt;\n  {{ range $index, $abc := .abc }}\n     &lt;tr&gt;\n      &lt;td&gt;{{call $.addOne $index}}&lt;/td&gt; // $index + 1\n      &lt;td&gt;{{$abc}}&lt;/td&gt;\n     &lt;/tr&gt;\n  {{end}}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12223723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gz_gewiE2Ws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDGdj0CeGAzGgekty8F86mgdLjMw/photo.jpg?sz=128", "display_name": "Revllll\u01421", "link": "https://stackoverflow.com/users/12223723/revllll%c5%821"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 58406044, "answer_count": 1, "score": 0, "last_activity_date": 1571202186, "creation_date": 1571198478, "last_edit_date": 1571198987, "question_id": 58405589, "link": "https://stackoverflow.com/questions/58405589/how-index-starts-with-1-in-revel-framework", "title": "How index starts with 1 in revel Framework", "body": "<pre><code>  &lt;tr&gt;\n      &lt;td&gt;rank&lt;/td&gt;\n      &lt;td&gt;abc&lt;/td&gt;\n  &lt;/tr&gt;\n  {{ range $index,$abc := .abc }}\n     &lt;tr&gt;\n      &lt;td&gt;{{$index}}&lt;/td&gt; // 0\n      &lt;td&gt;{{$abc}}&lt;/td&gt;\n     &lt;/tr&gt;\n  {{end}}\n</code></pre>\n\n<blockquote>\n  <ol>\n  <li><p>how to {{$index}} starts with 1</p>\n  \n  <p>{{add $index 1}} - unction \"add\" not defined</p>\n  \n  <p>{{$index + 1}}   - illegal number syntax: \"+\"</p></li>\n  </ol>\n</blockquote>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 1, "last_activity_date": 1571195698, "creation_date": 1571195698, "answer_id": 58405235, "question_id": 58405039, "link": "https://stackoverflow.com/questions/58405039/why-not-all-key-from-revel-json-response-are-capitalized/58405235#58405235", "title": "Why not all key from Revel JSON response are capitalized?", "body": "<p>You are missing a double quote after the tag <code>message</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Response struct {\n    Message string `json:\"message`\n    Data    string `json:\"data\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1571195698, "creation_date": 1571194101, "question_id": 58405039, "link": "https://stackoverflow.com/questions/58405039/why-not-all-key-from-revel-json-response-are-capitalized", "title": "Why not all key from Revel JSON response are capitalized?", "body": "<p>I'm trying to understand how to implement POST request using Revel framework.</p>\n\n<p><a href=\"https://i.stack.imgur.com/8waVY.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8waVY.jpg\" alt=\"enter image description here\"></a></p>\n\n<p><strong>models/login.go</strong></p>\n\n<pre><code>package models\n\ntype LoginParam struct {\n    Username string `form:\"username\" json:\"username\"`\n    Password string `form:\"password\" json:\"password\"`\n}\n\ntype Response struct {\n    Message string `json:\"message`\n    Data    string `json:\"data\"`\n}\n</code></pre>\n\n<p><strong>app/controllers/login.go</strong></p>\n\n<pre><code>package controllers\n\nimport (\n    \"mytestapi/app/models\"\n    \"encoding/json\"\n    \"log\"\n    \"strconv\"\n\n    \"github.com/revel/revel\"\n)\n\ntype Login struct {\n    *revel.Controller\n}\n\nfunc (c Login) DoLogin() revel.Result {\n    var login models.LoginParam\n    var res models.Response\n\n    err := json.NewDecoder(c.Request.GetBody()).Decode(&amp;login)\n\n    if err != nil {\n        log.Fatal(\"JSON decode error: \", err)\n    }\n\n    res.Message = \"OK\"\n    res.Data = login.Username + \" \" + login.Password\n\n    defer c.Request.Destroy()\n    return c.RenderJSON(res)\n}\n</code></pre>\n\n<p>Postman gives this output:</p>\n\n<blockquote>\n  <p>{   \"Message\": \"OK\",   \"data\": \"foo barzzzz\" }</p>\n</blockquote>\n\n<p>Almost correct. On the JSON output, <strong>M</strong>essage instead of <strong>m</strong>essage is printed.\nWhy Message is capitalized, and data is not?</p>\n"}, {"tags": ["go", "transactions", "go-echo", "boltdb"], "answers": [{"comments": [{"owner": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "edited": false, "score": 0, "creation_date": 1571205256, "post_id": 58404740, "comment_id": 103157352, "body": "If so, the lock must be released after goroutine exit, and newer goroutine can acquire it.Is there a situation that causes the lock to be unavailable? like above stack."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "edited": false, "score": 1, "creation_date": 1571205592, "post_id": 58404740, "comment_id": 103157466, "body": "The most likely causes of &quot;stuck&quot; locks are programmer errors, such as failing to release a lock, or getting into a deadlock situation. You can build fancy lock systems that <i>do</i> track ownership and so on, to help find issues like this. They tend to be a bit expensive at run-time. Note that in Go, you&#39;ll have to invent your own &quot;threads&quot; and &quot;thread IDs&quot;. See, e.g., <a href=\"https://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">github.com/jwells131313/goethe</a>"}, {"owner": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "edited": false, "score": 0, "creation_date": 1571214290, "post_id": 58404740, "comment_id": 103161530, "body": "Thank you for response, I will check my code again."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1571191143, "creation_date": 1571191143, "answer_id": 58404740, "question_id": 58404431, "link": "https://stackoverflow.com/questions/58404431/how-to-detect-the-goroutine-that-occupies-the-lock/58404740#58404740", "title": "How to detect the goroutine that occupies the lock?", "body": "<p>Goroutines have no external ID.</p>\n\n<p>Locks can be acquired in one goroutine and released in another, by design.  Thus, if a lock is held, it's not held <em>by</em> a Goroutine: anyone can unlock it, and there is no ID to record as to who locked it.</p>\n\n<p>(Hence, the answer is that just using the provided mutex, you can't see who's hogging it.)</p>\n"}], "owner": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 58404740, "answer_count": 1, "score": -1, "last_activity_date": 1571198161, "creation_date": 1571188321, "question_id": 58404431, "link": "https://stackoverflow.com/questions/58404431/how-to-detect-the-goroutine-that-occupies-the-lock", "title": "How to detect the goroutine that occupies the lock?", "body": "<p>I made a HTTP server with <code>Echo</code> and store data use <code>storm</code> and data model like this:</p>\n\n<blockquote>\n  <p>project1(bucket)</p>\n  \n  <p>&emsp;device_type_1(bucket)</p>\n  \n  <p>&emsp;&emsp;device_1(kv)</p>\n  \n  <p>&emsp;&emsp;device_2(kv)</p>\n  \n  <p>&emsp;device_type_2(bucket)</p>\n  \n  <p>&emsp;&emsp;device_1(kv)</p>\n  \n  <p>&emsp;&emsp;device_2(kv)</p>\n  \n  <p>project2(bucket)</p>\n  \n  <p>&emsp;...</p>\n</blockquote>\n\n<p>In addition to updating the database, there are some other things to do after receive HTTP request, so I use transaction like this:</p>\n\n<pre><code>tx, err := db.Begin(true)\nif err != nil {\n  return\n}\ndefer tx.Rollback()\n\n// for simplicity\nprojectBkt := tx.From(\"project1\")\nprojectBkt.Save(&amp;project)\n\n\n// other things\n.......\n\n\nif err := tx.Commit(); err != nil {\n  return\n}\n</code></pre>\n\n<p>A high probability of lock waiting while bolt transaction committing, and stack looks like this:</p>\n\n<pre><code>goroutine 53 [semacquire, 5 minutes]:\nsync.runtime_SemacquireMutex(0xc000002560, 0x16a7f00, 0x0)\n        C:/Go/src/runtime/sema.go:71 +0x4e\nsync.(*RWMutex).Lock(0xc000002558)\n        C:/Go/src/sync/rwmutex.go:103 +0xc0\ngo.etcd.io/bbolt.(*DB).mmap(0xc0000023c0, 0x20000, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/db.go:246 +0x65\ngo.etcd.io/bbolt.(*DB).allocate(0xc0000023c0, 0x1, 0x0, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/db.go:846 +0x24b\ngo.etcd.io/bbolt.(*Tx).allocate(0xc000e98fc0, 0x1, 0x0, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/tx.go:454 +0x79\ngo.etcd.io/bbolt.(*node).spill(0xc0001539d0, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/node.go:368 +0x3f0\ngo.etcd.io/bbolt.(*Bucket).spill(0xc0001cb740, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/bucket.go:541 +0x73a\ngo.etcd.io/bbolt.(*Bucket).spill(0xc000e98fd8, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/bucket.go:508 +0x64f\ngo.etcd.io/bbolt.(*Tx).Commit(0xc000e98fc0, 0x0, 0x0)\n        D:/data/Go/pkg/mod/go.etcd.io/bbolt@v1.3.0/tx.go:163 +0x1bf\ngithub.com/asdine/storm.(*node).Commit(0xc0001cb380, 0x0, 0x0)\n        D:/data/Go/pkg/mod/github.com/asdine/storm@v2.1.2+incompatible/transaction.go:46 +0x5c\n.....\n</code></pre>\n\n<p>The question is how can I detect the goroutine that occupies the lock so I can check the whole operation sequence?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1571185249, "post_id": 58404065, "comment_id": 103153181, "body": "The <code>int</code> type can only be used for whole numbers (also called &quot;integers&quot;) such as <code>1</code>, <code>5</code>, <code>600</code>, etc.  It can&#39;t be used for a fraction (that is, anything with a dot in it) such as <code>1.333</code>. You will need to use <code>float32</code> or <code>float64</code> for that. It&#39;s not clear from the code why you want <code>a</code> to be an <code>int</code> (you&#39;re only printing it, and not doing anything else with it)."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1571210744, "creation_date": 1571210744, "answer_id": 58407938, "question_id": 58404065, "link": "https://stackoverflow.com/questions/58404065/constant-truncated-to-integer-error-during-type-conversion-of-float-constant-to/58407938#58407938", "title": "constant truncated to integer error during type conversion of float constant to int", "body": "<p>The conversion of constants follows different rules than the conversion of non-constants.</p>\n\n<p>First non-constants:</p>\n\n<blockquote>\n  <p>Conversions between numeric types</p>\n  \n  <p>For the conversion of non-constant numeric values, the following rules\n  apply:</p>\n  \n  <ol>\n  <li>...</li>\n  <li><strong>When converting a floating-point number to an integer, the fraction is discarded (truncation towards zero).</strong></li>\n  <li>...</li>\n  </ol>\n</blockquote>\n\n<p>So this is possible:</p>\n\n<pre><code>var f = float64(1.333)\nvar i = int(f)\n</code></pre>\n\n<hr>\n\n<p>Now constants:</p>\n\n<blockquote>\n  <p>A constant value x can be converted to type T if x is <strong>representable</strong> by\n  a value of T.</p>\n</blockquote>\n\n<p>Then, in the documentation, there's a list of example expressions, one of them being this:</p>\n\n<pre><code>int(1.2) // illegal: 1.2 cannot be represented as an int\n</code></pre>\n\n<p>On representability</p>\n\n<blockquote>\n  <p>A constant x is representable by a value of type T if one of the\n  following conditions applies:</p>\n  \n  <ul>\n  <li>x is in the set of values determined by T.</li>\n  <li>T is a floating-point type and x can be rounded to T's precision without overflow. Rounding uses IEEE 754 round-to-even rules but with an IEEE negative zero further simplified to an unsigned zero. Note that constant values never result in an IEEE negative zero, NaN, or infinity.</li>\n  <li>T is a complex type, and x's components real(x) and imag(x) are representable by values of T's component type (float32 or float64).</li>\n  </ul>\n</blockquote>\n\n<p>None of the 3 conditions applies to the expression <code>var a int = int(1.333)</code> and therefore it is illegal.</p>\n\n<hr>\n\n<p>Read more about <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Conversions</a> and <a href=\"https://golang.org/ref/spec#Representability\" rel=\"nofollow noreferrer\">Representability</a></p>\n"}], "owner": {"reputation": 453, "user_id": 6588772, "user_type": "registered", "profile_image": "https://graph.facebook.com/609778875823934/picture?type=large", "display_name": "Charan Reddy", "link": "https://stackoverflow.com/users/6588772/charan-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 775, "favorite_count": 0, "accepted_answer_id": 58407938, "answer_count": 1, "score": 0, "last_activity_date": 1571210744, "creation_date": 1571184468, "last_edit_date": 1571209242, "question_id": 58404065, "link": "https://stackoverflow.com/questions/58404065/constant-truncated-to-integer-error-during-type-conversion-of-float-constant-to", "title": "constant truncated to integer error during type conversion of float constant to int", "body": "<p>The following code is raising the error  \"<strong>Constant truncated to integer</strong> \" on the line \"<strong>var a int = int(1.333)</strong>\".I am new to GO and not able to figure out the actual problem.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    var x, y int = 3, 4\n    const k float64=2.2\n    var a int = int(1.333)\n    var f float64 = math.Sqrt(float64(x*x+y*y))\n    var z uint = uint(f)\n    fmt.Println(x, y, z,a)\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "load-data-infile"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1571180170, "post_id": 58403567, "comment_id": 103152106, "body": "Look at <code>SHOW PROCESSLIST</code> to see what&#39;s going on. Cutting the connection does not necessarily mean the server has nothing to do."}, {"owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1571180367, "post_id": 58403567, "comment_id": 103152154, "body": "<code>SHOW PROCESSLIST</code> shows only one SELECT query running"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1571180422, "post_id": 58403567, "comment_id": 103152174, "body": "<a href=\"https://www.mysql.com/products/workbench/\" rel=\"nofollow noreferrer\">MySQL Workbench</a> may give more detail. Sometimes there&#39;s background processing that has to be done for InnoDB tables, index updates, etc. It can be normal for the server to need some time to settle down after importing a lot of data. The <a href=\"http://dba.stackexchange.com\">DBA site</a> may be able to help with queries like this. You may need to adjust server tuning parameters in order to get better performance."}, {"owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1571180921, "post_id": 58403567, "comment_id": 103152322, "body": "Thanks, will post my question there and do some investigation with MySQL Workbench."}], "owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571180040, "creation_date": 1571180040, "question_id": 58403567, "link": "https://stackoverflow.com/questions/58403567/golang-load-data-slows-database-sql-operations", "title": "Golang LOAD DATA slows database/sql operations", "body": "<p>I'm loading multiple files into the database using the <code>LOAD DATA LOCAL INFILE</code> command combined with <code>database/sql</code> driver like this:</p>\n\n<pre><code>mysql.RegisterLocalFile(fileName)\n_, err = dbConnection.Exec(loadDataCommand)\n</code></pre>\n\n<p>This works as expected after the load has finished I run some SELECT queries (I'm reusing <code>dbConnection</code> for those SELECT queries and all other queries) on newly loaded data and this is where the problem occurs. The above mentioned SELECT queries are unusually slow (due to high CPU usage).</p>\n\n<p>While running LOAD DATA database CPU usage spikes which is expected but after the LOAD DATA finishes CPU usage should drop but it doesn't unless I close and reopen <code>dbConnection</code> CPU usage stays high.</p>\n\n<p>This is how I'm \"reseting\" the database connection:</p>\n\n<pre><code>_ = dbConnection.Close()\ndbConnection, err = sql.Open(databaseDriver, databaseUser+\":\"+databasePassword+\"@tcp(\"+databaseAddress+\":3306)/\"+databaseName+\"?multiStatements=true\")\n</code></pre>\n\n<p>Why is this happening? The above code is running on a development database so there are no other connections to it.</p>\n"}, {"tags": ["go", "file-permissions"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1571177305, "post_id": 58403134, "comment_id": 103151411, "body": "Almost all calls to <code>os.Mkdir</code> should pass <code>0777</code> as the second argument. You don&#39;t need <code>os.ModeDir</code> as it&#39;s implied by the make-directory function. The low 3 bits are Unix-style permissions; it&#39;s up to the OS to translate them to whatever the OS uses. On Unix-like systems, the current umask will take away any unwanted permissions, so you should usually grant all permissions to everyone to start."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1571177374, "post_id": 58403134, "comment_id": 103151434, "body": "Exceptions to this rule include, e.g., a mail message handler, where you might assume user-level privacy and use mode <code>0700</code>: rwx for user, nothing for group or other. A typical umask is <code>002</code> or <code>022</code>, to take away other, and maybe group, write permission."}], "answers": [{"comments": [{"owner": {"reputation": 484, "user_id": 7367458, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Fo9f20mtkGs/AAAAAAAAAAI/AAAAAAAABLk/hatpI770yr8/photo.jpg?sz=128", "display_name": "imans77", "link": "https://stackoverflow.com/users/7367458/imans77"}, "edited": false, "score": 0, "creation_date": 1610197056, "post_id": 58403214, "comment_id": 116058940, "body": "after hours of searching and trial error, this one truely solved my problem! PS: I was using <code>662</code>, <code>420</code>, <code>666</code>, <code>777</code>, but none of them worked, especially for <code>directories</code>"}], "tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": true, "score": 5, "last_activity_date": 1571177200, "creation_date": 1571177200, "answer_id": 58403214, "question_id": 58403134, "link": "https://stackoverflow.com/questions/58403134/go-permission-denied-when-trying-to-create-a-file-in-a-newly-created-directory/58403214#58403214", "title": "Go &quot;permission denied&quot; when trying to create a file in a newly created directory?", "body": "<p>I found that I am able to create files in the directory if I set the permission to <code>0777</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n    \"path\"\n)\n\nfunc main() {\n    dir := \"test_dir\"\n\n    os.Mkdir(dir, 0777)\n\n    fileName := path.Join(dir, \"file.txt\")\n\n    ioutil.WriteFile(fileName, []byte(\"foobar\"), 0666)\n}\n</code></pre>\n\n<p>Now the file is created with the expected content:</p>\n\n<pre><code>&gt; cat test_dir/file.txt \nfoobar\u23ce \n</code></pre>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4294, "favorite_count": 0, "accepted_answer_id": 58403214, "answer_count": 1, "score": 4, "last_activity_date": 1618303825, "creation_date": 1571176402, "question_id": 58403134, "link": "https://stackoverflow.com/questions/58403134/go-permission-denied-when-trying-to-create-a-file-in-a-newly-created-directory", "title": "Go &quot;permission denied&quot; when trying to create a file in a newly created directory?", "body": "<p>I'm trying to create a directory using <code>os.Mkdir()</code> and then create files in it, similar to this script:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"path\"\n)\n\nfunc main() {\n    dir := \"test_dir\"\n\n    os.Mkdir(dir, os.ModeDir)\n\n    fileName := path.Join(dir, \"file.txt\")\n\n    _, err := os.Create(fileName)\n    if err != nil {\n        log.Fatalf(\"create file: %v\", err)\n    }\n}\n</code></pre>\n\n<p>However, if I run this, I get</p>\n\n<pre><code>&gt; go run fileperms.go\n2019/10/15 14:44:02 create file: open test_dir/file.txt: permission denied\nexit status 1\n</code></pre>\n\n<p>It is not immediately clear to me from <a href=\"https://golang.org/pkg/os/#FileMode\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#FileMode</a> how to specify the <code>FileMode</code> in order to allow the same script to create files in the newly-created directory. How can I achieve this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1208, "user_id": 5246655, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153185527849891/picture?type=large", "display_name": "amwill04", "link": "https://stackoverflow.com/users/5246655/amwill04"}, "edited": false, "score": 0, "creation_date": 1571179859, "post_id": 58403382, "comment_id": 103152035, "body": "seems crazy that <code>pointB.Lat * math.Pi &#47; 180 !== pointB.Lat * (math.Pi &#47; 180)</code> also"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1208, "user_id": 5246655, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153185527849891/picture?type=large", "display_name": "amwill04", "link": "https://stackoverflow.com/users/5246655/amwill04"}, "edited": false, "score": 1, "creation_date": 1571181310, "post_id": 58403382, "comment_id": 103152413, "body": "@amwill04 that&#39;s not Go related, that&#39;s the imprecision of IEEE-754 64-bit. Here&#39;s <a href=\"https://play.golang.com/p/RrMYh53Aq0x\" rel=\"nofollow noreferrer\">go</a> and here&#39;s <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d76f8a48492c9394955eeeab85d8da9e\" rel=\"nofollow noreferrer\">rust</a>. I don&#39;t have the links but js and swift return the same thing for me as go and rust. You can try other languages."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1571178490, "creation_date": 1571178490, "answer_id": 58403382, "question_id": 58403028, "link": "https://stackoverflow.com/questions/58403028/floating-point-precision-golang/58403382#58403382", "title": "Floating point precision golang", "body": "<p>This has to do with <em>untyped</em> <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">constants</a>. An <em>untyped</em> floating point constant can hold a value with a much higher precission than a <em>typed</em> <code>float64</code> constant.</p>\n\n<p>So on the second line, in your <em>typed</em> constant expression the multiplication yields a float with a precision much smaller than the multiplication in the <em>untyped</em> constant expression on line one.</p>\n\n<blockquote>\n  <p>Implementation restriction: Although numeric constants have arbitrary\n  precision in the language, a compiler may implement them using an\n  internal representation with limited precision. That said, every\n  implementation must:</p>\n  \n  <ul>\n  <li>Represent integer constants with at least 256 bits.</li>\n  <li><strong>Represent floating-point constants, including the parts of a complex constant, with a mantissa of at least 256 bits and a signed binary exponent of at least 16 bits.</strong></li>\n  <li>Give an error if unable to represent an integer constant precisely.</li>\n  <li>Give an error if unable to represent a floating-point or complex constant due to overflow.\n  Round to the nearest representable constant if unable to represent a floating-point or complex constant due to limits on precision.</li>\n  </ul>\n</blockquote>\n\n<p>See related: <a href=\"https://stackoverflow.com/a/57512022/965900\">https://stackoverflow.com/a/57512022/965900</a></p>\n"}], "owner": {"reputation": 1208, "user_id": 5246655, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153185527849891/picture?type=large", "display_name": "amwill04", "link": "https://stackoverflow.com/users/5246655/amwill04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 58403382, "answer_count": 1, "score": 0, "last_activity_date": 1571178490, "creation_date": 1571175785, "question_id": 58403028, "link": "https://stackoverflow.com/questions/58403028/floating-point-precision-golang", "title": "Floating point precision golang", "body": "<p>Was curious as to why the following produces two different values.</p>\n\n<pre><code>    fmt.Println(51.231576 * math.Pi / 180) // 0.8941596821857065\n    fmt.Println(float64(51.231576) * math.Pi / 180) //0.8941596821857064\n</code></pre>\n\n<p>I understand this is tiny differences but would like to understand why.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1571174118, "creation_date": 1571174118, "answer_id": 58402740, "question_id": 58402699, "link": "https://stackoverflow.com/questions/58402699/extend-struct-definition-golang/58402740#58402740", "title": "Extend Struct definition golang", "body": "<p>You can do:</p>\n\n<pre><code>type B A\n</code></pre>\n\n<p>However, if you do this, any methods you defined for <code>A</code> will not be available for <code>B</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 12001311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f404604ec6c1461bb058c259004bd6?s=128&d=identicon&r=PG&f=1", "display_name": "Teja", "link": "https://stackoverflow.com/users/12001311/teja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 58402740, "answer_count": 1, "score": 0, "last_activity_date": 1571174118, "creation_date": 1571173877, "question_id": 58402699, "link": "https://stackoverflow.com/questions/58402699/extend-struct-definition-golang", "title": "Extend Struct definition golang", "body": "<p>I want to extend a struct definition from that of the other</p>\n\n<pre><code>type A struct {\n    name string\n}\n\ntype B struct {\n    A\n}\n</code></pre>\n\n<p>So here A is a sub struct of B. But I do not want that. Instead I want the B's definition to be the same as A without any nesting</p>\n\n<pre><code>    var a A\n    var b B\n    fmt.Printf(\"%v, %v \\t\", a, b)\n\n    a.name = \"john\"\n    b.name = \"rick\"\n\n    fmt.Printf(\"%v, %v \\t\", a, b)\n\n</code></pre>\n\n<p>So output of this is <code>{john} {{rick}}</code>. I want it to be <code>{john}{rick}</code></p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-build"], "comments": [{"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1571176175, "post_id": 58401806, "comment_id": 103151082, "body": "What&#39;s your <code>go.mod</code> file?"}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "reply_to_user": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1571176355, "post_id": 58401806, "comment_id": 103151136, "body": "I have messed up! I know! Can you tell me this thing when I&#39;m trying to build the app I&#39;m getting this error from the main.go <code>cannot load appname&#47;auth: cannot find module providing package appname&#47;auth</code>"}], "answers": [{"comments": [{"owner": {"reputation": 690, "user_id": 7298873, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/038j2.jpg?s=128&g=1", "display_name": "monkrus", "link": "https://stackoverflow.com/users/7298873/monkrus"}, "edited": false, "score": 2, "creation_date": 1587317177, "post_id": 58408040, "comment_id": 108458374, "body": "As a final step, you can also run <code>go mod verify</code> to check that all the dependencies are installed correctly."}], "tags": [], "owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "is_accepted": false, "score": 2, "last_activity_date": 1571211106, "creation_date": 1571211106, "answer_id": 58408040, "question_id": 58401806, "link": "https://stackoverflow.com/questions/58401806/errors-parsing-go-mod-how-to-deploy-go-app-on-app-engine-with-cloud-build/58408040#58408040", "title": "errors parsing go.mod How to deploy go app on App Engine with Cloud build?", "body": "<p>As explained in the error message, the require package path must have this format <code>require module/path v1.2.3</code></p>\n\n<p>In your go.mod, you have this:</p>\n\n<pre><code>require github.com/spf13/viper\n</code></pre>\n\n<p>You have the <code>module/path</code> but you don't have the version!</p>\n\n<p><a href=\"https://github.com/spf13/viper/releases\" rel=\"nofollow noreferrer\">Go the the viper github project and take the release version that you want</a>. For example</p>\n\n<pre><code>require github.com/spf13/viper v1.4.0\n</code></pre>\n\n<p>You can also try to perform a <code>go mod tidy</code> for automatically building and cleaning your <code>go.mod</code> file</p>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1065, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571211106, "creation_date": 1571169262, "question_id": 58401806, "link": "https://stackoverflow.com/questions/58401806/errors-parsing-go-mod-how-to-deploy-go-app-on-app-engine-with-cloud-build", "title": "errors parsing go.mod How to deploy go app on App Engine with Cloud build?", "body": "<p>So I have this Go app which is running fine on the localhost but I want to host on the google cloud and the cloud is already setup. The whole dir tree looks like this.</p>\n\n<pre><code>gocode\n---bin\n---pkg\n---src\n  ---cloud.google.com\n  ---github.com\n  ...\n  ---appname\n    ---auth\n    ---database\n    ...\n    ---main.go\n    ---app.yaml\n    ---cloudbuild.yaml\n    ---go.mod\n</code></pre>\n\n<p>Here is the <strong>app.yaml</strong></p>\n\n<pre><code>runtime: go112\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>Here is the <strong>cloudbuild.yaml</strong></p>\n\n<pre><code>steps:\n\n- name: 'golang'\n  args: ['go', 'build', '.']\n  env: ['GO111MODULE=on']\n\n- name: 'gcr.io/cloud-builders/go'\n  args: ['get', '-d', 'appname']\n  env: ['GOPATH=/gopath/','MODE=dev']\n  volumes:\n  - name: 'go'\n    path: '/gopath'\n\n- name: 'gcr.io/cloud-builders/gcloud'\n  args: ['app', 'deploy']\n  env: ['GOPATH=/gopath/','MODE=dev']\n  volumes:\n  - name: 'go'\n    path: '/gopath'\n</code></pre>\n\n<p>Here is the <strong>go.mod</strong></p>\n\n<pre><code>module github.com/Raj-Varun/appname-API/\n\nrequire github.com/spf13/viper\n</code></pre>\n\n<p>When I'm running <code>gcloud builds submit --config cloudbuild.yaml .</code> I'm getting this error</p>\n\n<pre><code>tarting Step #0\nStep #0: Pulling image: golang\nStep #0: Using default tag: latest\nStep #0: latest: Pulling from library/golang\nStep #0: Digest: sha256:a50a9364e9170ab5f5b03389ed33b9271b4a7b6bbb0ab41c4035adb3078927bc\nStep #0: Status: Downloaded newer image for golang:latest\nStep #0: docker.io/library/golang:latest\nStep #0: go: errors parsing go.mod:\nStep #0: /workspace/go.mod:3: usage: require module/path v1.2.3\nFinished Step #0\nERROR\nERROR: build step 0 \"golang\" failed: exit status 1\n</code></pre>\n"}, {"tags": ["go", "gorilla", "go-swagger"], "answers": [{"tags": [], "owner": {"reputation": 354, "user_id": 5021929, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7349ff1bba3e2057405fd1a4a29e3892?s=128&d=identicon&r=PG", "display_name": "Wuzi", "link": "https://stackoverflow.com/users/5021929/wuzi"}, "is_accepted": false, "score": 0, "last_activity_date": 1571309662, "creation_date": 1571309662, "answer_id": 58430948, "question_id": 58401330, "link": "https://stackoverflow.com/questions/58401330/how-to-serve-websocket-with-go-swagger/58430948#58430948", "title": "How to serve websocket with go-swagger?", "body": "<p>casualjim helped me at Github:</p>\n\n<p>You can put it in a middleware and hook it up in configure_XXX</p>\n\n<pre><code>func mountWebSockets(next http.Handler) http.HandlerFunc {\n   return func(w http.ResponseWriter, r *http.Request) {\n       if r.URL.Path == \"/ws\" {\n            chat.ServeWs(hub, w, r)\n           return\n       }\n       next.ServeHTTP(w, r)\n   }\n}\n</code></pre>\n\n<p>Source: <a href=\"https://github.com/go-swagger/go-swagger/issues/2083#issuecomment-542764897\" rel=\"nofollow noreferrer\">https://github.com/go-swagger/go-swagger/issues/2083#issuecomment-542764897</a></p>\n"}], "owner": {"reputation": 354, "user_id": 5021929, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7349ff1bba3e2057405fd1a4a29e3892?s=128&d=identicon&r=PG", "display_name": "Wuzi", "link": "https://stackoverflow.com/users/5021929/wuzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 392, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571309662, "creation_date": 1571167105, "last_edit_date": 1571228470, "question_id": 58401330, "link": "https://stackoverflow.com/questions/58401330/how-to-serve-websocket-with-go-swagger", "title": "How to serve websocket with go-swagger?", "body": "<p>I'm trying to serve a chat websocket within my go-swagger API. I'm using this example: <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket/tree/master/examples/chat</a></p>\n\n<p>I tried attaching it to the http when the server starts, but after further reading I see that this can't work:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func configureServer(s *http.Server, scheme, addr string) {\n  hub := chat.NewHub()\n\n  go hub.Run()\n  http.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n    chat.ServeWs(hub, w, r)\n  })\n}\n</code></pre>\n\n<p>Then I tried using a custom server and changing server.Serve() to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>hub := chat.NewHub()\ngo hub.Run()\n\nhttp.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n  chat.ServeWs(hub, w, r)\n})\n\nif err := http.ListenAndServe(\":8080\", api.Serve(nil)); err != nil {\n  log.Fatalln(err)\n}\n</code></pre>\n\n<p>But also realized why this won't work.</p>\n\n<blockquote>\n  <p>Error during WebSocket handshake: Unexpected response code: 404</p>\n</blockquote>\n\n<p>After some reading I'm starting to understand why the /ws was never found:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>hub := chat.NewHub()\ngo hub.Run()\n\nmux := http.NewServeMux()\nmux.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n  chat.ServeWs(hub, w, r)\n})\n\nserver.SetHandler(mux)\nif err := server.Serve(); err != nil {\n  log.Fatalln(err)\n}\n</code></pre>\n\n<p>Now the websockets works but the rest api doesn't, I can see why but I don't how to make both of them work.\nI'm fairly new to golang so i'm struggling with this.</p>\n\n<p>How could I do that?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["xml", "go", "kubernetes-helm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571167601, "post_id": 58401133, "comment_id": 103147975, "body": "You forgot to mention <i>how</i> it is &quot;failing&quot;. What error are you getting? What output do you expect and what did you get instead?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1571172291, "post_id": 58401133, "comment_id": 103149763, "body": "What have you tried so far? What is the exact problem with your attempt?"}], "owner": {"reputation": 137, "user_id": 7739984, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1JGv9sE2Wm4/AAAAAAAAAAI/AAAAAAAAC4c/zvUt6naNWlk/photo.jpg?sz=128", "display_name": "Lucky Tyagi", "link": "https://stackoverflow.com/users/7739984/lucky-tyagi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 230, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571204296, "creation_date": 1571166144, "last_edit_date": 1571204296, "question_id": 58401133, "link": "https://stackoverflow.com/questions/58401133/go-templating-in-xml-file", "title": "Go templating in xml file", "body": "<p>I'm taking an input via values.yaml in a helm package and trying to use the value in an xml file. But it is failing. Please point out what it is that i'm doing wrong.\nValues.yaml contains:</p>\n\n<pre><code>ere:\n  AdmServerPort: \"9090\"\n</code></pre>\n\n<p>In the file I've used it as:</p>\n\n<pre><code>&lt;Argument Name=\"Port\" Value=\"{{ .Values.ere.AdmServerPort | default \"9090\" }}\"/&gt;\n</code></pre>\n\n<p>I'm using configmap to put this inside my pod after editing dynamically. Please Help. Thanks in advance!</p>\n\n<p><strong>EDIT:</strong>\nI didn't paste the error as it contains whole xml. I tried helm upgrade and it failed with render error. Also i tried changing the lines which i modified (which are only these mentioned lines) as it was working before for sure. But it didn't help.</p>\n\n<pre><code>Error: UPGRADE FAILED: render error in \"eric-em-ere/templates/deployment-ere.yaml\": template: eric-em-ere/templates/deployment-ere.yaml:25:28: executing \"eric-em-ere/templates/deployment-ere.yaml\" at &lt;include (print $.Tem...&gt;: error calling include: template: eric-em-ere/templates/configmap.yaml:14:22: executing                                                   \"eric-em-ere/templates/configmap.yaml\" at &lt;tpl (.Files.Get \"fil...&gt;: error calling tpl: Error during tpl function execution for \"&lt;PoolServer&gt;...\n</code></pre>\n\n<p>whole error goes on with xml template and ends with:</p>\n\n<pre><code>: parse error in \"eric-em-ere/templates/deployment-ere.yaml\": template: eric-em-ere/templates/deployment-ere.yaml:36: bad character U+002D '-'\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571155352, "post_id": 58398540, "comment_id": 103142734, "body": "Which side is that output coming from, client or server?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1571156228, "post_id": 58398540, "comment_id": 103143209, "body": "The application logs all of <code>data</code>, even though <code>conn.Read(data)</code> may have only filled part of <code>data</code>.  Use the length returned from the call to conn.Read."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1571158155, "post_id": 58398540, "comment_id": 103144062, "body": "You are ignoring the number of bytes read. That&#39;s required to use a network connection correctly. You are also writing each line concurrently for no reason, and it&#39;s possible you could start interleaving writes."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 7355692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a5189c70c8f4bad4239eaea01d878e25?s=128&d=identicon&r=PG&f=1", "display_name": "AnirbanMukherjee", "link": "https://stackoverflow.com/users/7355692/anirbanmukherjee"}, "is_accepted": false, "score": 0, "last_activity_date": 1571164837, "creation_date": 1571164837, "answer_id": 58400822, "question_id": 58398540, "link": "https://stackoverflow.com/questions/58398540/incomplete-byte-with-net-conn-read/58400822#58400822", "title": "incomplete []byte with net.conn.Read()", "body": "<p>The conn.read() returns the numner of bytes it was actually able to read in. What you get back from the read() depends a lot of multiple factors including tcp buffers, etc. If you want to print out formatted text, you need to read in until a '\\n', and then go on to read the next line. TCP provides a continuous stream of data from the peer end. You need to fins out a way to read the correct bytes, and the correct number of them.</p>\n"}], "owner": {"reputation": 11, "user_id": 12221519, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAwEyOz0UNGo-eYp-JpFDO7lZ7X8WSkZMPncPOZ=k-s128", "display_name": "\u8bb8\u749f\u6960", "link": "https://stackoverflow.com/users/12221519/%e8%ae%b8%e7%92%9f%e6%a5%a0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571164837, "creation_date": 1571154836, "last_edit_date": 1571161014, "question_id": 58398540, "link": "https://stackoverflow.com/questions/58398540/incomplete-byte-with-net-conn-read", "title": "incomplete []byte with net.conn.Read()", "body": "<p>I am coding a socket web with <code>Golang</code>, I want to send data in client with goroutine and read data in server with goroutine too.\npart of my code:</p>\n\n<p>client:</p>\n\n<pre><code>    buf := bufio.NewReader(file)\n    var toWrite [][]byte\n    for {\n        w, _, end := buf.ReadLine()\n        if end == io.EOF {\n            break\n        }\n        toWrite = append(toWrite, w)\n    }\n\n    var wg sync.WaitGroup\n    wg.Add(len(toWrite))\n\n    for _, word := range toWrite {\n        w := word\n\n        go func() {\n            defer wg.Done()\n            conn.Write(append(w, byte('\\n')))\n            log.Info(string(w), \"\\n\")\n        }()\n\n    }\n    wg.Wait()\n\n</code></pre>\n\n<p>server:</p>\n\n<pre><code>    for {\n        conn, err := listen.Accept()\n        defer conn.Close()\n\n        if err != nil {\n            log.Fatal(\"accept err: \", err)\n            break\n        }\n        go func() {\n            data := make([]byte, 1024)\n            for {\n                _, err := conn.Read(data)\n                if err != nil {\n                    break\n                }\n                log.Info(string(data))\n            }\n        }()\n    }\n\n</code></pre>\n\n<p>However, when I run them in my terminal, sometimes it shows some incomplete words</p>\n\n<pre><code>INFO[2019-10-15T23:36:11+08:00] increased\nbased\nUp\np       // no \"p\" in my file\nUp\nUp\nUp\nUp\n\nUp\nUp\nUp\nUp\nUp\nUp\nUp\n</code></pre>\n\n<p>(there is a lot of \"Up\" in the file I opened in client)\nis there a way to fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1571154460, "post_id": 58398394, "comment_id": 103142262, "body": "Don&#39;t. Go is a statically-typed language with no generics or dynamic types. What are you actually trying to do that you think you would need this? Creating a slice of a type is already shorter than the function call you showed."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1571154649, "post_id": 58398394, "comment_id": 103142366, "body": "Give more context on what you are trying to do. What will you do with the slice?  What size and capacity should the slice have?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571154699, "post_id": 58398394, "comment_id": 103142397, "body": "I concur with this-^^^^ also. You can do it what you want with the <code>reflect</code> package - but unless you are writing some generic framework, stay away from this path. Even Rob Pike - the co-inventor of <code>go</code> - recommends to stay away from <code>reflect</code> - and he&#39;s written more reflect code than anyone would care to."}, {"owner": {"reputation": 595, "user_id": 4071273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0f60079441b95b7a8f749147436d62?s=128&d=identicon&r=PG&f=1", "display_name": "Crepi", "link": "https://stackoverflow.com/users/4071273/crepi"}, "edited": false, "score": 0, "creation_date": 1571155137, "post_id": 58398394, "comment_id": 103142628, "body": "He doesn&#39;t have to use reflect, he can just return slice of interfaces: func getDynamicSlice(in interface{}) (out []interface{}) { \tout = make([]interface{},1) \tout[0] = in \treturn }"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1571155638, "post_id": 58398394, "comment_id": 103142879, "body": "<code>interface{}</code> is another slippery slope that should be avoided."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571155697, "post_id": 58398394, "comment_id": 103142909, "body": "<a href=\"https://golang.org/pkg/builtin/#make\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#make</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1571155860, "post_id": 58398394, "comment_id": 103143013, "body": "For what it&#39;s worth, <code>reflect.New(reflect.SliceOf(reflect.TypeOf(v))).Elem().Inter&zwnj;&#8203;face()</code> returns a slice of v&#39;s type.  That may or may not be useful given the greater context of the problem."}, {"owner": {"reputation": 1, "user_id": 12221475, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBprA9lw8Xa5kkBu5ODjyEMnm5fNw8a_aTJ_vucdw=k-s128", "display_name": "Alex Schetinin", "link": "https://stackoverflow.com/users/12221475/alex-schetinin"}, "edited": false, "score": 0, "creation_date": 1571209711, "post_id": 58398394, "comment_id": 103159226, "body": "Thank you for the answers, I will give more context. I&#39;m creating worker that queries db, process the data and send to kafka. The idea is to make the code generic so it would work with different queries. I&#39;m using <code>dbx.Select</code> that receives struct slice as parameter, I would like this slice to be dynamic depending on which table i&#39;m querying."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1571206085, "last_edit_date": 1571206085, "creation_date": 1571162975, "answer_id": 58400412, "question_id": 58398394, "link": "https://stackoverflow.com/questions/58398394/create-slice-with-dynamic-struct/58400412#58400412", "title": "Create slice with dynamic struct", "body": "<p>You could use a type switch:</p>\n\n<pre><code>func getStruct(i interface{}) interface{} {\n    switch s := i.(type) {\n    case MyStruct:\n        // do something here with type MyStruct\n        s.ID = 3\n        return s\n    case MyOtherStruct:\n        // ...\n        s.Name = \"abc\"\n        return s\n    }\n    return i\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iTlYP9yYuQw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iTlYP9yYuQw</a></p>\n\n<p>BUT you should handle this carefully, because Go is strictly with types. You should respect this.</p>\n\n<p>When you call that function you should use then a type assertion, to get the correct type again:</p>\n\n<pre><code>s, ok := getStruct(MyStruct{}).(MyStruct)\nif !ok {\n    // ...\n}\nfmt.Println(s)\n</code></pre>\n\n<h3>Some more Information about that pattern</h3>\n\n<p>Because a lot of comments under the question are about not using <code>interface{}</code> I want to write something more about the use case here. Interfaces in general have no concrete type information. It does not matter if you are using <code>interface{}</code> or <code>io.Reader</code>. Both interfaces does not allow you to access parameters of the value under the interface. You should always think about this, when you are talking about empty interfaces.</p>\n\n<p>So if your function returns an interface you will allways have this kind of problem. I think almost everybody already made a lot of functions, which are returning an interface. Because <code>error</code> is also just an interface. So the whole error handling can use type-switches like this.</p>\n"}], "owner": {"reputation": 1, "user_id": 12221475, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBprA9lw8Xa5kkBu5ODjyEMnm5fNw8a_aTJ_vucdw=k-s128", "display_name": "Alex Schetinin", "link": "https://stackoverflow.com/users/12221475/alex-schetinin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571206085, "creation_date": 1571154252, "question_id": 58398394, "link": "https://stackoverflow.com/questions/58398394/create-slice-with-dynamic-struct", "title": "Create slice with dynamic struct", "body": "<p>I'm trying to create function that receives empty struct and returns slice of that struct type.</p>\n\n<p>For example -</p>\n\n<pre><code>type MyStruct struct {\n  Id            int\n}\ntype MyOtherStruct struct {\n  Name          string\n}\n\ngetDynamicSlice(MyStruct{}) // will return []MyStruct{}\ngetDynamicSlice(MyOtherStruct{}) // will return []MyOtherStruct{}\n</code></pre>\n\n<p>What would be the best way to implement such function in Go?</p>\n"}, {"tags": ["typescript", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1571154189, "post_id": 58398287, "comment_id": 103142125, "body": "Running TypeScript (JavaScript) in Go would require an interpreter. These exist, but note that it&#39;s probably going to be slower, consume more memory, and be harder to use than it would to just write it in Go."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1571166751, "post_id": 58398287, "comment_id": 103147634, "body": "Ok I understand that the front-end is not the best place for a busines logic. But I don&#39;t understand your task. If you move the business logic from the browser to the server I think there is still a lot of to do at the front-end."}, {"owner": {"reputation": 73, "user_id": 1841089, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLtfS.jpg?s=128&g=1", "display_name": "Saiful Shubho", "link": "https://stackoverflow.com/users/1841089/saiful-shubho"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571236950, "post_id": 58398287, "comment_id": 103174799, "body": "@Adrian I know it is better to write in Go. We would like to do some work like field validation in both Client and Server and the logic is essentially the same. I was hoping to avoid code duplication as it would be harder to maintain."}], "answers": [{"tags": [], "owner": {"reputation": 306, "user_id": 11948273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1da02f7ef7d9268c6b67b5baf8276867?s=128&d=identicon&r=PG&f=1", "display_name": "The Wayward Developer", "link": "https://stackoverflow.com/users/11948273/the-wayward-developer"}, "is_accepted": true, "score": 1, "last_activity_date": 1571356020, "creation_date": 1571356020, "answer_id": 58442113, "question_id": 58398287, "link": "https://stackoverflow.com/questions/58398287/how-to-use-typescript-in-go/58442113#58442113", "title": "How to use typescript in go", "body": "<p>You can write the duplicated logic in <a href=\"https://github.com/AssemblyScript/assemblyscript\" rel=\"nofollow noreferrer\">AssemblyScript</a>, a strict subset of TypeScript, compile it to WebAssembly, and then run it in Go with a runtime like <a href=\"https://github.com/wasmerio/go-ext-wasm\" rel=\"nofollow noreferrer\">Wasmer</a>.</p>\n\n<p>Keep in mind though that AssemblyScript is still under development.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 3229231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0f8a11044da37a98cac98eff32f1b3c?s=128&d=identicon&r=PG", "display_name": "viferga", "link": "https://stackoverflow.com/users/3229231/viferga"}, "is_accepted": false, "score": 1, "last_activity_date": 1598344770, "last_edit_date": 1598344770, "creation_date": 1598297129, "answer_id": 63567520, "question_id": 58398287, "link": "https://stackoverflow.com/questions/58398287/how-to-use-typescript-in-go/63567520#63567520", "title": "How to use typescript in go", "body": "<p>You can use <a href=\"https://github.com/metacall/core\" rel=\"nofollow noreferrer\">MetaCall</a>, a library that provides inter-language foreign function interfaces which I've been working on it during several years. Basically it allows you to call TypeScript functions from Go without using WebAssembly. The calls are done in the same process so you can still get good performance and use standard TypeScript instead a subset of the language.</p>\n<p>The TypeScript support is still under development but you can see a working example of calling TypeScript functions from Go <a href=\"https://github.com/metacall/golang-typescript-example\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>With this approach you probably can create a common repository or npm package with the TypeScript logic as a library, and then import it in the Front-end and Back-end at the same time.</p>\n<p>You can install MetaCall following <a href=\"https://github.com/metacall/install\" rel=\"nofollow noreferrer\">this instructions</a>. Once you have it installed, you can import your npm package in your Go project by using:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>metacall npm install your-package\n</code></pre>\n<p>Or adding it with git as a <a href=\"https://git-scm.com/book/en/v2/Git-Tools-Submodules\" rel=\"nofollow noreferrer\">sub-module</a>.</p>\n<p>Later on you can import the TypeScript library as in the <a href=\"https://github.com/metacall/golang-typescript-example/blob/a4c8b47d57b3ff6f6bc6d9c20b3a9cc55553a383/main.go#L21\" rel=\"nofollow noreferrer\">example</a>. You do not need to transpile it, MetaCall will take care of it. Remember to <a href=\"https://github.com/metacall/golang-typescript-example/blob/a4c8b47d57b3ff6f6bc6d9c20b3a9cc55553a383/main.go#L6\" rel=\"nofollow noreferrer\">import MetaCall</a> in your Go code and run <code>go mod tidy</code>.</p>\n<p>Just as a reminder, the example compiles MetaCall by hand, and the install script downloads a pre-built version.</p>\n"}], "owner": {"reputation": 73, "user_id": 1841089, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/HLtfS.jpg?s=128&g=1", "display_name": "Saiful Shubho", "link": "https://stackoverflow.com/users/1841089/saiful-shubho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 0, "accepted_answer_id": 58442113, "answer_count": 2, "score": -1, "last_activity_date": 1598344770, "creation_date": 1571153884, "question_id": 58398287, "link": "https://stackoverflow.com/questions/58398287/how-to-use-typescript-in-go", "title": "How to use typescript in go", "body": "<p>I am trying to create an Angular app which uses a golang REST API server. There are some business logics which are written in typescript used in front-end. Some of these need to be used in the back-end. To avoid writing the same logic in golang, I was wondering if it is possible to run typescript code in golang? I found SWIG to run C++ code in golang but I did not find anything for typescript. I am aware that I can run golang code in Angular using webassembly or other tools but I am not allowed to write those codes in golang. </p>\n"}, {"tags": ["go", "delve"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1571151611, "creation_date": 1571151611, "answer_id": 58397624, "question_id": 58397522, "link": "https://stackoverflow.com/questions/58397522/how-do-i-pass-arguments-to-dlv-debug/58397624#58397624", "title": "How do I pass arguments to dlv debug", "body": "<p>Per <code>dlv --help</code>:</p>\n\n<pre><code>Pass flags to the program you are debugging using `--`, for example:\n\n`dlv exec ./hello -- server --config conf/config.toml`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1007, "user_id": 1632519, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4169b372ce9a0bf75abf2282a4e9808f?s=128&d=identicon&r=PG", "display_name": "Philippe", "link": "https://stackoverflow.com/users/1632519/philippe"}, "is_accepted": true, "score": 0, "last_activity_date": 1571225132, "last_edit_date": 1571225132, "creation_date": 1571151994, "answer_id": 58397737, "question_id": 58397522, "link": "https://stackoverflow.com/questions/58397522/how-do-i-pass-arguments-to-dlv-debug/58397737#58397737", "title": "How do I pass arguments to dlv debug", "body": "<p>One can pass arguments to <code>dlv debug</code> the same way you do with <code>dlv exec</code>. Eg.:</p>\n\n<p><code>dlv debug -- -foo -bar</code></p>\n"}], "owner": {"reputation": 1007, "user_id": 1632519, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4169b372ce9a0bf75abf2282a4e9808f?s=128&d=identicon&r=PG", "display_name": "Philippe", "link": "https://stackoverflow.com/users/1632519/philippe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 58397737, "answer_count": 2, "score": -3, "last_activity_date": 1571225132, "creation_date": 1571151327, "last_edit_date": 1571152094, "question_id": 58397522, "link": "https://stackoverflow.com/questions/58397522/how-do-i-pass-arguments-to-dlv-debug", "title": "How do I pass arguments to dlv debug", "body": "<p>How do I pass arguments to the debugged program when I invoke delve like this: <code>dlv debug</code>? I want to use <code>dlv debug</code> instead of <code>dlv exec</code> because <code>dlv exec</code> doesn't always find all sources.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1571149505, "post_id": 58396632, "comment_id": 103139371, "body": "You&#39;re on the right track, but you need to assign os.Stdin, os.Stdout and os.Stderr to cmd&#39;s respective fields."}, {"owner": {"reputation": 980, "user_id": 2173983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/KXsYQ.jpg?s=128&g=1", "display_name": "Fuechter", "link": "https://stackoverflow.com/users/2173983/fuechter"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1571158445, "post_id": 58396632, "comment_id": 103144165, "body": "Do you have some links about this? I tried to find about, but I didn&#39;t anything :("}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1571161103, "post_id": 58396632, "comment_id": 103145243, "body": "Do not put tags in the title--especially not twice"}, {"owner": {"reputation": 980, "user_id": 2173983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/KXsYQ.jpg?s=128&g=1", "display_name": "Fuechter", "link": "https://stackoverflow.com/users/2173983/fuechter"}, "edited": false, "score": 0, "creation_date": 1571164595, "post_id": 58396632, "comment_id": 103146720, "body": "Okay, thank you :)"}], "answers": [{"tags": [], "owner": {"reputation": 980, "user_id": 2173983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/KXsYQ.jpg?s=128&g=1", "display_name": "Fuechter", "link": "https://stackoverflow.com/users/2173983/fuechter"}, "is_accepted": true, "score": 0, "last_activity_date": 1571705218, "creation_date": 1571705218, "answer_id": 58495763, "question_id": 58396632, "link": "https://stackoverflow.com/questions/58396632/how-open-other-tools-like-htop-vim-by-oss-package/58495763#58495763", "title": "How open other tools like htop, vim by os&#39;s package", "body": "<p>I did resolve with instance of <code>os</code> like <code>os.Stdin</code> or <code>os.Stdout</code></p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"log\"\n  \"os/exec\"\n)\n\nfunc main() {\n  // render the termui\n  path := \"SomeFile.bash\"\n  cmd := exec.Command(\"vim\", path)\n\n  cmd.Stderr = os.Stderr\n  cmd.Stdin = os.Stdin\n  cmd.Stdout = os.Stdout\n\n  err := cmd.Run()\n\n  if err != nil {\n    log.Fatal(err)\n  } \n}\n\n</code></pre>\n\n<p>Thanks @Peter by commentary :)</p>\n"}], "owner": {"reputation": 980, "user_id": 2173983, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/KXsYQ.jpg?s=128&g=1", "display_name": "Fuechter", "link": "https://stackoverflow.com/users/2173983/fuechter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 58495763, "answer_count": 1, "score": -2, "last_activity_date": 1571705218, "creation_date": 1571148464, "last_edit_date": 1571161109, "question_id": 58396632, "link": "https://stackoverflow.com/questions/58396632/how-open-other-tools-like-htop-vim-by-oss-package", "title": "How open other tools like htop, vim by os&#39;s package", "body": "<p>I'm writing a new project like a CLI with Go and I'm using the package <a href=\"https://github.com/gizak/termui\" rel=\"nofollow noreferrer\">termui</a>, but in a time, I need that CLI open a file with editor like VIM without exit the current CLI, when close the VIM I can back to current CLI. Is it possible?</p>\n\n<p>I've tried with this example below:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"log\"\n  \"os/exec\"\n)\n\nfunc main() {\n  // render the termui\n  path := \"SomeFile.bash\"\n  cmd := exec.Command(\"vim\", path)\n\n  err := cmd.Run()\n\n  if err != nil {\n    log.Fatal(err)\n  } \n}\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "amqp"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571152245, "post_id": 58396449, "comment_id": 103141002, "body": "do you want the <code>SomeAMQPMethod</code> method to essentially be a wrapper to <code>SomeRPCMethod</code>? And the <code>AMQPRequest</code> is converted to a <code>Request</code>?"}, {"owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571152452, "post_id": 58396449, "comment_id": 103141146, "body": "@colminator I would like to write some kind of plugin which will generate consumer and producer by this definition. This code will have nothing common with GRPC endpoints."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571154046, "post_id": 58396449, "comment_id": 103142048, "body": "I&#39;m not sure I follow. The <code>protoc-gen-go</code> tool will generate Go code for a <code>.proto</code> file definition like the one you have above. Provided all the <code>Message</code> (aka types) are defined this Go code will include client and server interfaces. These are typically used in gRPC implementations - but the interfaces could be implemented natively, mimicking a client-server model, without hitting any network. Is this the direction you are looking at?"}, {"owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571155445, "post_id": 58396449, "comment_id": 103142776, "body": "@colminator I know that protoc is used for generating gRPC server and client. I would like to do almost the same but for amqp. I don&#39;t wont to generate an amqp-rpoxy which will listen events and then send messages to gRPC endpoint. In the example above I would like to generate common gRPC code for <code>rpc</code> method directive and I would like to write a plugin which will process <code>amqp</code> method directive and will generate special code for consumer and producer."}, {"owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571155675, "post_id": 58396449, "comment_id": 103142899, "body": "As a work example where I would like to use this: for example I would like to create some <code>mailService</code> with consumer which will process messages for sending emails and also I would like to have gRPC endpoint which will return success/fail statistic. Basically I would like to use this proto file like common server definition."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571155873, "post_id": 58396449, "comment_id": 103143020, "body": "So you <i>do</i> want gRPC definitions created. But you also want add supplemental methods (for <code>amqp</code>)?"}, {"owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571156849, "post_id": 58396449, "comment_id": 103143495, "body": "I want gRPC definitions for <code>rpc</code> methods and only consumer definitions for <code>amqp</code>. I mean I don&#39;t want generate gRPC definition for <code>amqp</code>"}, {"owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571157454, "post_id": 58396449, "comment_id": 103143752, "body": "I say so because I saw as people generate HTTP endpoint which is just a proxy to gRPC endpoint. I don&#39;t want to do the same but with AMQP instead of HTTP. But if I won&#39;t find the solution how to properly process <code>amqp</code> keyword I&#39;ll definitely try to implement AMQP proxy"}], "answers": [{"tags": [], "owner": {"reputation": 27, "user_id": 1143342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc21bcdb344d777423ed3b5fb116d8ec?s=128&d=identicon&r=PG", "display_name": "vicosanz", "link": "https://stackoverflow.com/users/1143342/vicosanz"}, "is_accepted": false, "score": 0, "last_activity_date": 1571173348, "creation_date": 1571173348, "answer_id": 58402598, "question_id": 58396449, "link": "https://stackoverflow.com/questions/58396449/is-it-possible-to-add-custom-method-type-to-protobuf-service/58402598#58402598", "title": "Is it possible to add custom method type to protobuf service?", "body": "<p>I think you must use standard definitions in order to build a portable proto file. At end of the day that is the final goal of GRPC</p>\n"}], "owner": {"reputation": 1628, "user_id": 4472973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100001955044366/picture?type=large", "display_name": "Nikita Leshchev", "link": "https://stackoverflow.com/users/4472973/nikita-leshchev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 455, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1571173348, "creation_date": 1571147897, "question_id": 58396449, "link": "https://stackoverflow.com/questions/58396449/is-it-possible-to-add-custom-method-type-to-protobuf-service", "title": "Is it possible to add custom method type to protobuf service?", "body": "<p>When you describe service with protobuf, you can add rpc methods. Is it possible to write some extension to use custom method type like:</p>\n\n<pre><code>service SomeService {\n    rpc SomeRPCMethod(Request) returns (Response);\n    amqp SomeAMQPMethod(AMQPRequest);\n}\n</code></pre>\n\n<p>I found some information according to extending methods and service options but nothing about custom method types.</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571147119, "post_id": 58396143, "comment_id": 103137900, "body": "It sounds like the file you&#39;re using doesn&#39;t exist. But you didn&#39;t include that part of your code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571148796, "post_id": 58396143, "comment_id": 103138942, "body": "Why are you setting max age to 0?"}], "answers": [{"comments": [{"owner": {"reputation": 595, "user_id": 4071273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0f60079441b95b7a8f749147436d62?s=128&d=identicon&r=PG&f=1", "display_name": "Crepi", "link": "https://stackoverflow.com/users/4071273/crepi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571148401, "post_id": 58396569, "comment_id": 103138710, "body": "Because it tries to delete session that isn&#39;t saved yet. MaxAge &lt;= 0 should be used for existing sessions."}, {"owner": {"reputation": 595, "user_id": 4071273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0f60079441b95b7a8f749147436d62?s=128&d=identicon&r=PG&f=1", "display_name": "Crepi", "link": "https://stackoverflow.com/users/4071273/crepi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571148703, "post_id": 58396569, "comment_id": 103138881, "body": "It&#39;s not, it deletes only for &lt;= 0. This error occurs when you call Save on new session with MaxAge &lt;=0."}, {"owner": {"reputation": 1019, "user_id": 922653, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/74674ffbf8adf72c0398a64d0615f128?s=128&d=identicon&r=PG", "display_name": "Colselaw", "link": "https://stackoverflow.com/users/922653/colselaw"}, "edited": false, "score": 0, "creation_date": 1571149013, "post_id": 58396569, "comment_id": 103139074, "body": "Right - this is what I&#39;m seeing - I set the <code>MaxAge</code> for the store to <code>0</code> <b>because</b> I want the session cookie to expire when the user closes the browser. However, setting it to 0 tries to delete the file before it has an ID.  Maybe if there were separate options for the session expiration (say, 15 minutes) and setting the cookie so that it does not have an expiration (so it will be removed when the browser closes)."}, {"owner": {"reputation": 595, "user_id": 4071273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0f60079441b95b7a8f749147436d62?s=128&d=identicon&r=PG&f=1", "display_name": "Crepi", "link": "https://stackoverflow.com/users/4071273/crepi"}, "edited": false, "score": 0, "creation_date": 1571149269, "post_id": 58396569, "comment_id": 103139235, "body": "Try using CookieStore instead of FilesystemStore (with MaxAge = 0)."}, {"owner": {"reputation": 1019, "user_id": 922653, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/74674ffbf8adf72c0398a64d0615f128?s=128&d=identicon&r=PG", "display_name": "Colselaw", "link": "https://stackoverflow.com/users/922653/colselaw"}, "edited": false, "score": 0, "creation_date": 1571155898, "post_id": 58396569, "comment_id": 103143037, "body": "Marking this one as the answer - per the API, it&#39;s exactly correct. The only remaining problem is that the API uses a cookie to send the session ID, but I can&#39;t set the cookie expiration independent of the session expiration - that&#39;s the API&#39;s fault. (Of course, the documentation does warn that the filesystem store is not fully-baked)."}], "tags": [], "owner": {"reputation": 595, "user_id": 4071273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e0f60079441b95b7a8f749147436d62?s=128&d=identicon&r=PG&f=1", "display_name": "Crepi", "link": "https://stackoverflow.com/users/4071273/crepi"}, "is_accepted": true, "score": 0, "last_activity_date": 1571148835, "last_edit_date": 1571148835, "creation_date": 1571148285, "answer_id": 58396569, "question_id": 58396143, "link": "https://stackoverflow.com/questions/58396143/gorilla-sessions-fails-to-save-new-session-when-maxage-is-0/58396569#58396569", "title": "gorilla/sessions fails to save new session when MaxAge is 0", "body": "<p>If you check <a href=\"https://github.com/gorilla/sessions/blob/400b592ab70b9f8ee876cf47bc6c794d255dd4aa/store.go#L210\" rel=\"nofollow noreferrer\"><code>Save</code> method</a>, you'll see that it tries to delete sessions with <code>MaxAge &lt;= 0</code>. You actually mark sessions that needs to be removed that way.\nSince you're creating session with <code>s.store.Get(r, \"session-name\")</code>, it will use MaxAge from that store, and you should set it to some value bigger than 0.</p>\n\n<p>Doc for setting MaxAge says:</p>\n\n<blockquote>\n  <p>Individual sessions can be deleted by setting Options.MaxAge\n   = -1 for that session.</p>\n</blockquote>\n\n<p>But in Save you can see:</p>\n\n<blockquote>\n  <p>If the Options.MaxAge of the session is &lt;= 0 then the session file\n  will be deleted from the store path.</p>\n</blockquote>\n\n<p>So, setting it to 0 is the same as setting it -1 or any other negative value.</p>\n"}], "owner": {"reputation": 1019, "user_id": 922653, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/74674ffbf8adf72c0398a64d0615f128?s=128&d=identicon&r=PG", "display_name": "Colselaw", "link": "https://stackoverflow.com/users/922653/colselaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 58396569, "answer_count": 1, "score": -1, "last_activity_date": 1571148835, "creation_date": 1571146839, "last_edit_date": 1571147054, "question_id": 58396143, "link": "https://stackoverflow.com/questions/58396143/gorilla-sessions-fails-to-save-new-session-when-maxage-is-0", "title": "gorilla/sessions fails to save new session when MaxAge is 0", "body": "<p>I'm using gorilla/sessions in a toy app, and I want to use the FilesystemStore, but if I set the <code>MaxAge</code> option to 0 for the store, it attempts to remove the session when saving it, but if the session is new, it doesn't have an ID:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    sess, err := s.store.Get(r, \"session-name\")\n    if err != nil {\n        log.Printf(\"error getting session %v\", err)\n        http.Error(w, \"session\", http.StatusInternalServerError)\n        return\n    }\n\n    sess.Values[\"name\"] = r.FormValue(\"name\")\n    if err = sess.Save(r, w); err != nil {\n        log.Printf(\"error saving session %v\", err)\n        http.Error(w, \"saving\", http.StatusInternalServerError)\n        return\n    }\n\n    http.Redirect(w, r, \"/view\", http.StatusFound)\n</code></pre>\n\n<p>And the error I get is:</p>\n\n<pre><code>2019/10/15 09:22:03 error saving session remove sessions\\session_: The system cannot find the file specified.\n</code></pre>\n\n<p>Looking at the Gorilla code, it seems the Gorilla code tries to delete the session from the store before determining if the session has an ID.</p>\n\n<p>Is mine a problem with Gorilla, or with how I'm using it?</p>\n\n<p>Things work fine when not setting <code>MaxAge</code> to <code>0</code>, but then I'll have to manage the cookies myself.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571142481, "post_id": 58394599, "comment_id": 103134986, "body": "How are you executing the update statement? Please include that code. And keep in mind that you should not ignore errors and you should close <code>rows</code> after you&#39;re done with them. Also I&#39;m curious to know how many is 20W."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571143374, "post_id": 58394599, "comment_id": 103135508, "body": "... additionally if the actual code is executed in <code>main</code> just like in the question, then you need to synchronize your goroutines... This is becuase after the <code>for rows.Next() {</code> loop is done, <code>main</code> will exit and it will <i>not</i> wait for any <code>updateRowForSomeReason</code> executing goroutines that haven&#39;t yet finished their job effectively killing them mid-process."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571144050, "post_id": 58394599, "comment_id": 103135901, "body": "@TangMonk please make sure, when providing code in the question, that that code is as close as possible to your actual code, the ideal would be that the code in question can be used to reproduce the error, otherwise we will be here all day pointing out what&#39;s wrong with the code in the question while your actual code has a completely different problem. In <code>updateRowForSomeReason</code> you&#39;re discarding rows with <code>_, err := db.Query</code> but on the next line after the error checking you have <code>for rows.Next() {</code>... so which is it? are you keeping the rows or are you discarding them?"}, {"owner": {"reputation": 2034, "user_id": 2695642, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/95dOY.png?s=128&g=1", "display_name": "TangMonk", "link": "https://stackoverflow.com/users/2695642/tangmonk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1571144453, "post_id": 58394599, "comment_id": 103136183, "body": "@mkopriva, sorry, I simplified code for easily reading with careless"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571144731, "post_id": 58394599, "comment_id": 103136368, "body": "the <code>*sql.Rows</code> object returned from <code>db.Query</code> needs to be <a href=\"https://golang.org/pkg/database/sql/#Rows.Close\" rel=\"nofollow noreferrer\">closed</a> after work with it is done. The idiomatic way to do this is after your check the error returned from Query you add the statement <code>defer rows.Close()</code>. See <a href=\"https://golang.org/pkg/database/sql/#example_DB_Query_multipleResultSets\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/&hellip;</a> and <a href=\"https://golang.org/pkg/database/sql/#example_DB_QueryContext\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#example_DB_QueryContext</a>"}, {"owner": {"reputation": 2034, "user_id": 2695642, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/95dOY.png?s=128&g=1", "display_name": "TangMonk", "link": "https://stackoverflow.com/users/2695642/tangmonk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1571145116, "post_id": 58394599, "comment_id": 103136623, "body": "@mkopriva, really thanks for you advice, I tried to add <code>select {}</code> to end of <code>main()</code> function for avoid program terminate halfway, the <code>database is closed</code> error disappeared"}, {"owner": {"reputation": 16850, "user_id": 172642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2a18a04255beea3beff827eecedd64?s=128&d=identicon&r=PG", "display_name": "gavinb", "link": "https://stackoverflow.com/users/172642/gavinb"}, "edited": false, "score": 0, "creation_date": 1571145410, "post_id": 58394599, "comment_id": 103136809, "body": "What is the UPDATE statement doing? You could be running out of resources, since you&#39;re working with potentially very large result sets and doing nested queries in program memory."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571151542, "post_id": 58394599, "comment_id": 103140585, "body": "This seems likely due to not closing results."}], "answers": [{"tags": [], "owner": {"reputation": 16850, "user_id": 172642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2a18a04255beea3beff827eecedd64?s=128&d=identicon&r=PG", "display_name": "gavinb", "link": "https://stackoverflow.com/users/172642/gavinb"}, "is_accepted": false, "score": 3, "last_activity_date": 1571146228, "creation_date": 1571146228, "answer_id": 58395951, "question_id": 58394599, "link": "https://stackoverflow.com/questions/58394599/how-to-avoid-sql-connection-close-if-thousands-of-goroutine-try-to-access-the-da/58395951#58395951", "title": "How to avoid sql connection close if thousands of Goroutine try to access the database", "body": "<p>This doesn't seem to be a Go problem as such, more a question of how to optimally structure your SQL within your code. You're taking a result set from executing a query on 2,000,000 rows:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT id FROM chapters where title = 'custom_type'\")\n</code></pre>\n\n<p>then executing another query <em>for each row</em> in this result set:</p>\n\n<pre><code>row, err := db.Query(fmt.Sprintf(\"SELECT id FROM chapters where parent_id = %v\", id))  \n</code></pre>\n\n<p>and then executing some more code <em>for each of those</em>, apparently one by one:</p>\n\n<pre><code>for rows.Next() {\n   // ignore update code for simplify\n}\n</code></pre>\n\n<p>This is effectively two levels of nesting of statements, which is very inefficient way to load all these results into program memory and then execute independent UPDATE statements:</p>\n\n<pre><code>SELECT\n     +----&gt;SELECT\n                +----&gt;UPDATE\n</code></pre>\n\n<p>Instead, you could be doing all the work in the database itself, which would be much more efficient. You don't show what the <code>UPDATE</code> statement is, but this is the key part. Let's say you want to set a <code>publish</code> flag. You could do something like this:</p>\n\n<pre><code>UPDATE chapters\n    SET publish=true\n    WHERE parent_id in\n        (SELECT id FROM chapters\n         WHERE title='custom_type')\n    RETURNING id;\n</code></pre>\n\n<p>By using a nested query, you can combine <em>all</em> of the three separate queries into one single query. The database has all the information it needs to optimise the operation and build the most efficient query plan, and you are only executing a <strong>single</strong> <code>db.Query</code> operation. The <code>RETURNING</code> clause lets you retrieve a list of the ids that ended up being updated in the operation. So the code would be as simple as:</p>\n\n<pre><code>func main(){\n    rows, err := db.Query(\"UPDATE chapters SET publish=true WHERE parent_id in\" +\n                          \"(SELECT id FROM chapters WHERE title='custom_type')\" +\n                          \"RETURNING id;\")\n    if err != nil {\n       panic(err)\n    }\n\n    for rows.Next() {\n        var id int\n        _ = rows.Scan(&amp;id)\n        fmt.Println(id)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2034, "user_id": 2695642, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/95dOY.png?s=128&g=1", "display_name": "TangMonk", "link": "https://stackoverflow.com/users/2695642/tangmonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571146228, "creation_date": 1571142155, "last_edit_date": 1571144466, "question_id": 58394599, "link": "https://stackoverflow.com/questions/58394599/how-to-avoid-sql-connection-close-if-thousands-of-goroutine-try-to-access-the-da", "title": "How to avoid sql connection close if thousands of Goroutine try to access the database", "body": "<p>I have a chapter table have about 2000000 rows, I want to to update each row for some specific conditions:</p>\n\n<pre><code>func main(){\n    rows, err := db.Query(\"SELECT id FROM chapters where title = 'custom_type'\")\n    if err != nil {\n       panic(err)\n    }\n\n    for rows.Next() {\n        var id int\n        _ = rows.Scan(&amp;id)\n        fmt.Println(id)\n        go updateRowForSomeReason(id)\n    }\n}\n\nfunc updateRowForSomeReason(id int) {\n    row, err := db.Query(fmt.Sprintf(\"SELECT id FROM chapters where parent_id = %v\", id))  \n    if err != nil {\n        panic(err)  &lt;----- // here is the panic occurs \n    }\n    for rows.Next() {\n       // ignore update code for simplify\n    }\n}\n</code></pre>\n\n<p>Inside <code>updateRowForSomeReason</code>, I execute update statement for each row.</p>\n\n<p>It will works with few seconds, after that the error will print:</p>\n\n<pre><code>323005 \n323057 \n323125 \n323244 \n323282 \n323342 \n323459 \n323498 \n323556 \n323618 \n323693 \n325343 \n325424 \n325468 \n325624 \n325816 \n326001 \n326045 \n326082 \n326226 \n326297 \npanic: sql: database is closed\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 513, "user_id": 5507931, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/14d9f9a2bc7be5a6990f11f7218a625c?s=128&d=identicon&r=PG&f=1", "display_name": "Yura", "link": "https://stackoverflow.com/users/5507931/yura"}, "edited": false, "score": 0, "creation_date": 1571137114, "post_id": 58393015, "comment_id": 103132082, "body": "I simply didn&#39;t need <code>_id</code>. Great thanks (despite it&#39;s forbidden:) )"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1571136871, "creation_date": 1571136871, "answer_id": 58393015, "question_id": 58392811, "link": "https://stackoverflow.com/questions/58392811/converting-mongodb-max-result-to-golang-data/58393015#58393015", "title": "Converting MongoDB $max result to golang data", "body": "<p>Using <code>bson.D</code> already works as you presented. The problem may be you can't \"easily\" get out the <code>max</code> and <code>cnt</code> values.</p>\n\n<p>Model your result document with a struct like this:</p>\n\n<pre><code>type result struct {\n    Max   int `bson:\"max\"`\n    Count int `bson:\"cnt\"\n}\n</code></pre>\n\n<p>Although <code>cnt</code> is not produced by the example code you provided.</p>\n\n<p>And then:</p>\n\n<pre><code>var res result\nerr := cursor.Decode(&amp;res)\n</code></pre>\n"}], "owner": {"reputation": 513, "user_id": 5507931, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/14d9f9a2bc7be5a6990f11f7218a625c?s=128&d=identicon&r=PG&f=1", "display_name": "Yura", "link": "https://stackoverflow.com/users/5507931/yura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 1, "accepted_answer_id": 58393015, "answer_count": 1, "score": 1, "last_activity_date": 1571136904, "creation_date": 1571136247, "last_edit_date": 1571136904, "question_id": 58392811, "link": "https://stackoverflow.com/questions/58392811/converting-mongodb-max-result-to-golang-data", "title": "Converting MongoDB $max result to golang data", "body": "<p>I try to get max values from MongoDB collection from my Go code. \nWhat type should I use to decode result? </p>\n\n<p>When I use <code>bson.D{}</code> as <code>val2</code> type the result looks like <code>[{_id &lt;nil&gt;} {max 66} {cnt 14}]</code>.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>    filter := []bson.M{{\n        \"$group\": bson.M{\n            \"_id\": nil,\n            \"max\": bson.M{\"$max\": \"$hellid\"},\n        }},\n    }\n\n    cursor, err := collection.Aggregate(ctx, filter)\n\n    for cursor.Next(ctx) {\n        val2 := ???\n        err := cursor.Decode(&amp;val2)\n        fmt.Printf(\"cursor: %v, value: %v\\n\", cursor.Current, val2)\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "go", "raspberry-pi"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571136522, "post_id": 58391519, "comment_id": 103131803, "body": "<a href=\"https://github.com/go-pigpio/pigpio/issues/1\" rel=\"nofollow noreferrer\">An issue</a> in the <code>pigpio</code> project mirroring this question."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1571136432, "creation_date": 1571136432, "answer_id": 58392867, "question_id": 58391519, "link": "https://stackoverflow.com/questions/58391519/trying-to-extend-golang-pigpio-wrapper-functions-gpiowaveaddgeneric/58392867#58392867", "title": "trying to extend golang pigpio wrapper functions gpioWaveAddGeneric", "body": "<p>I have no idea what do you mean by using the verb \"extend\",\nbut if you merely trying to <em>use</em> that library in your own code,\nthe appearance of an unqualified type name <code>Pulse</code> in your code looks quite suspiciously:\nto use a package, you first <code>import</code> it and then refer to the symbols it <em>exports</em> using the form <code>packagename.Symbol</code>.</p>\n\n<p>That is, in this very case you should have done something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"github.com/go-pigpio/pigpio\"\n\nfunc gpioWaveAddGeneric(numPulses uint, pulse *pigpio.Pulse) (err error) {\n</code></pre>\n\n<p>If you <em>really</em> are trying to extend that libary \u2014 by writing custom code <em>in</em> it \u2014 then it's perfectly sensible to use unqualified names but\nthen a possible hunch to why it does not work may be the appearance of a so-called \"build constraint\"</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// +build ignore\n</code></pre>\n\n<p>in the file containing the definition of the Go type <code>Pulse</code> (search the repository for the \"type Pulse\" substring).</p>\n\n<p><a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">The documentation</a> explicitly states that the file containing such a constraint is excluded from the build (that is, is not compiled at all), and that means neither the code of that package itself, nor its clients do not see the symbol <code>Pulse</code> at all.</p>\n\n<p>Why is that, is out of the scope of the present discussion; I'd ask the package's author. (Well, <a href=\"https://github.com/go-pigpio/pigpio/blame/master/pigpio/pigpio-godefs.go\" rel=\"nofollow noreferrer\">blaming that file</a> tells that it was actually born right with that constraint; it may suggest the author did not think the file is complete and/or fit for being used.)</p>\n"}], "owner": {"reputation": 1, "user_id": 12219604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52b809142662ee7c0eb8c4dfa20fda4c?s=128&d=identicon&r=PG&f=1", "display_name": "MeisterPilaf", "link": "https://stackoverflow.com/users/12219604/meisterpilaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571136432, "creation_date": 1571131870, "last_edit_date": 1571135688, "question_id": 58391519, "link": "https://stackoverflow.com/questions/58391519/trying-to-extend-golang-pigpio-wrapper-functions-gpiowaveaddgeneric", "title": "trying to extend golang pigpio wrapper functions gpioWaveAddGeneric", "body": "<p>Good Day, </p>\n\n<p>I tried to extend this <a href=\"https://github.com/go-pigpio/pigpio\" rel=\"nofollow noreferrer\">library</a> on GitHub but it does not work and I got this error. <code>pigpio.go:319:48: undefined: Pulse</code></p>\n\n<p>This is the function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func gpioWaveAddGeneric(numPulses uint, pulse *Pulse) (err error) {\n totalPulses := int(C.gpioWaveAddGeneric(\n   C.unsigned(numPulses), &amp;pulse[0]))\n if totalPulses &gt; 0 {\n   // totalPulses = the new total number of pulses in the current waveform   \n   // if OK, otherwise PI_TOO_MANY_PULSES$\n  } else {\n    // handle erroer err = Errno(totalPulses)\n  }\n  return\n}\n</code></pre>\n\n<p>I hope someone can help me. Thank you so much!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571135377, "post_id": 58390767, "comment_id": 103131170, "body": "Do you <i>need</i> to emulate browser or would it suffice to merely to a HTTP request to a resource in the intranet?"}, {"owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571189450, "post_id": 58390767, "comment_id": 103153964, "body": "Need emulate browser"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571243933, "post_id": 58390767, "comment_id": 103178594, "body": "OK, a couple more questions: 1) Was &quot;ntl&quot; in your question meant to indicate &quot;NTLM&quot;? 2) What happens when you navigate that <code>url</code> &quot;the normal way&quot;\u2014using a browser on your desktop? Does the server authenticate you &quot;transparently&quot;\u2014without asking anything,\u2014or does it post a pop-up dialogue asking you to enter the user name and a password? Or does <i>the site page</i> display some sort of login form asking you to provide your credentials?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571244082, "post_id": 58390767, "comment_id": 103178669, "body": "(As you can see, your question does not fit for the StackOverflow format; it&#39;s strictly <a href=\"https://stackoverflow.com/help/on-topic\">off-topic</a> here. It&#39;s better to ask such questions on <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">the mailing list</a> or, say, on <a href=\"https://www.reddit.com/r/golang\" rel=\"nofollow noreferrer\"><code>r&#47;golang</code></a> or <a href=\"https://github.com/golang/go/wiki#the-go-community\" rel=\"nofollow noreferrer\">other venues</a> suitable for such free-form questions implying multiple back-and-forth conversations.)"}, {"owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1571286636, "post_id": 58390767, "comment_id": 103191657, "body": "1. Oh sorry, ntl is NTLM 2. Server authenticate me &quot;transparently&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 8340, "user_id": 1645712, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/48781792c1fb7d61086b4fb612938c13?s=128&d=identicon&r=PG", "display_name": "gusto2", "link": "https://stackoverflow.com/users/1645712/gusto2"}, "is_accepted": false, "score": 0, "last_activity_date": 1571316228, "creation_date": 1571316228, "answer_id": 58432976, "question_id": 58390767, "link": "https://stackoverflow.com/questions/58390767/how-to-open-browser-with-ntlm-auth/58432976#58432976", "title": "How to open browser with NTLM auth", "body": "<blockquote>\n  <p>How to open url with ntl auth or login, pass? Thanks <br/>\n  1. Oh sorry, ntl is NTLM 2. Server authenticate me \"transparently\"</p>\n</blockquote>\n\n<p>I will assume the user is authenticated against an AD domain. </p>\n\n<p>First - the <a href=\"https://msdn.microsoft.com/en-us/library/cc236621.aspx\" rel=\"nofollow noreferrer\">NTLM</a> protocol is not so simple as e.g. basic authentication. It is a multiple-step protocol involving some system/user specific data. Client and server need to exchange a few challenge/answer data in a Negotiation HTTP header.</p>\n\n<p>I'd suggest to use an out-of-box library; e.g <a href=\"https://github.com/Azure/go-ntlmssp\" rel=\"nofollow noreferrer\">go-ntlmssp</a> or <a href=\"https://github.com/jcmturner/gokrb5\" rel=\"nofollow noreferrer\">gokrb5</a>. </p>\n\n<p>Note: when using SPNEGO (NTLM over HTTP) authentication, depending on the AD settings, if a user/service principal has too many roles, the Negotiation HTTP header may get VERY large. If you have any default limit for HTTP headers, you may watch if you don't reach the limit.</p>\n"}], "owner": {"reputation": 11, "user_id": 8224773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ae33c2a13b44acd049c5e651382e47b?s=128&d=identicon&r=PG&f=1", "display_name": "Shirokovea", "link": "https://stackoverflow.com/users/8224773/shirokovea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571316228, "creation_date": 1571129539, "last_edit_date": 1571296180, "question_id": 58390767, "link": "https://stackoverflow.com/questions/58390767/how-to-open-browser-with-ntlm-auth", "title": "How to open browser with NTLM auth", "body": "<p>I'm trying emulate browser, open intranet url and get status code 401. How to open url with ntl auth or login, pass?\nThanks</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/headzoo/surf.v1\"\n        \"fmt\"\n)\n\nfunc main() {\n    bow := surf.NewBrowser()\n    bow.AddRequestHeader(\"Accept\", \"text/html\")\n    bow.AddRequestHeader(\"Accept-Charset\", \"utf8\")\n    err := bow.Open(url)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(bow.StatusCode())\n}\n</code></pre>\n"}, {"tags": ["go", "redis", "interface"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1571133139, "last_edit_date": 1571133139, "creation_date": 1571132461, "answer_id": 58391679, "question_id": 58389247, "link": "https://stackoverflow.com/questions/58389247/how-to-extract-data-from-redis-do-result/58391679#58391679", "title": "How to extract data from redis Do() result", "body": "<p>This is specific to the <a href=\"https://redis.io/commands/memory-stats\" rel=\"nofollow noreferrer\"><code>MEMORY STATS</code></a> redis command. Its result is an array, <em>\"the information about memory usage is provided as metrics and their respective values \"</em>.</p>\n\n<p>Since there is no \"predefined\" type to model this, simply use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type-assertion</a> to acquire the slice in Go, iterate over it, and look for the key you're interested in: <code>\"total.allocated\"</code>. The subsequent slice element will be the value you're looking for.</p>\n\n<p>This is how you can do it:</p>\n\n<pre><code>result, err := client.Do(\"MEMORY\", \"STATS\").Result()\nif err != nil {\n    // Handle error\n    return\n}\nif stats, ok := result.([]interface{}); ok {\n    for i := 0; i &lt; len(stats); i += 2 {\n        if stats[i] == \"total.allocated\" &amp;&amp; i+1 &lt; len(stats) {\n            fmt.Println(\"total allocated memory:\", stats[i+1])\n        }\n    }\n}\n</code></pre>\n\n<p>We can simplify the loop if we loop until <code>len-1</code> (instead of <code>len</code>), so we don't have to check if <code>i+1</code> is valid index:</p>\n\n<pre><code>for i, max := 0, len(stats)-1; i &lt; max; i += 2 {\n    if stats[i] == \"total.allocated\" {\n        fmt.Println(\"total allocated memory:\", stats[i+1])\n    }\n}\n</code></pre>\n\n<p>The value of total allocated memory is a value of type <code>int64</code>. If you need it as a number, use another type-assertion:</p>\n\n<pre><code>allocated := stats[i+1].(int64)\n</code></pre>\n\n<p>Or to be safe:</p>\n\n<pre><code>if allocated, ok := stats[i+1].(int64); ok {\n    // Use allocated\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 39563, "user_id": 3160475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8989da0a2c491338617b07df53e60c?s=128&d=identicon&r=PG", "display_name": "Itamar Haber", "link": "https://stackoverflow.com/users/3160475/itamar-haber"}, "is_accepted": false, "score": 0, "last_activity_date": 1571145979, "creation_date": 1571145979, "answer_id": 58395859, "question_id": 58389247, "link": "https://stackoverflow.com/questions/58389247/how-to-extract-data-from-redis-do-result/58395859#58395859", "title": "How to extract data from redis Do() result", "body": "<p>Redigo has a helper just for that: <a href=\"https://github.com/gomodule/redigo/blob/master/redis/reply.go#L377\" rel=\"nofollow noreferrer\">https://github.com/gomodule/redigo/blob/master/redis/reply.go#L377</a></p>\n\n<p>In pseudo-Golang it looks like this:</p>\n\n<pre><code>result, err := redis.StringMap(client.Do(\"MEMORY\", \"STATS\"), err)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12218907, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5vtklqJMqtQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfZAkDOuSoAcGOQ15sKfi-Qrbor5Q/photo.jpg?sz=128", "display_name": "nivviv", "link": "https://stackoverflow.com/users/12218907/nivviv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 58391679, "answer_count": 2, "score": 1, "last_activity_date": 1571145979, "creation_date": 1571124087, "last_edit_date": 1571124123, "question_id": 58389247, "link": "https://stackoverflow.com/questions/58389247/how-to-extract-data-from-redis-do-result", "title": "How to extract data from redis Do() result", "body": "<p>Given I have: <code>\"github.com/go-redis/redis\"</code> package and I use it's method to fire custom Redis cmd: <a href=\"https://godoc.org/github.com/go-redis/redis#Client.Do\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/go-redis/redis#Client.Do</a></p>\n\n<p>I end up with:</p>\n\n<pre><code>result, err := client.Do(\"MEMORY\", \"STATS\").Result()\n</code></pre>\n\n<p><code>result</code> is looking as follows:</p>\n\n<pre><code>&lt;interface {}&gt;\n data:&lt;[]interface {}&gt; (length: 52, cap: 52)\n  [0]:&lt;interface {}&gt;\n   data:\"peak.allocated\"\n  [1]:&lt;interface {}&gt;\n   data:4957760\n  [2]:&lt;interface {}&gt;\n    data:\"total.allocated\"\n  [3]:&lt;interface {}&gt;\n    data:855632\n  [4]:&lt;interface {}&gt;\n  //... and so on\n</code></pre>\n\n<p>Basically, it's a interface with a data property, and within data we have more interfaces (even are keys, and odd's are values).</p>\n\n<p>I would like to type it so I can get value of <code>\"total.allocated\"</code>. </p>\n\n<p>What's the correct way to do it?</p>\n"}, {"tags": ["go", "idioms", "newtype"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 2, "creation_date": 1571107640, "post_id": 58386332, "comment_id": 103120357, "body": "This sort of thing is often done to create enum-like types (i.e., by declaring the type and defining constants of that type) and/or so that methods can be defined on the type."}, {"owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1571109898, "post_id": 58386332, "comment_id": 103120860, "body": "&gt; so that methods can be defined on the type  Yeah, this is also a valid reason for doing this in the other languages I mentioned, esp. the ones where overriding implementations (esp. on types you don&#39;t own) is not a thing :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571145670, "post_id": 58386332, "comment_id": 103136990, "body": "This is not at all unusual. For example: <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Duration</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1571187538, "post_id": 58386916, "comment_id": 103153651, "body": "Assuming I have a <code>type X uint</code> and a <code>type Y uint</code>, does the type system prevent me from e.g. adding an <code>X</code> and a <code>Y</code>? In other statically typed languages this is an important safety feature of &quot;newtypes&quot;."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 2, "creation_date": 1571193786, "post_id": 58386916, "comment_id": 103154749, "body": "That&#39;s right. You cannot add variables of type X to type Y unless you do proper <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">type casting</a> explicitly."}], "tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": false, "score": 1, "last_activity_date": 1571122411, "last_edit_date": 1571122411, "creation_date": 1571110814, "answer_id": 58386916, "question_id": 58386332, "link": "https://stackoverflow.com/questions/58386332/is-it-idiomatic-to-use-new-type-wrappers-in-go-for-ids/58386916#58386916", "title": "Is it idiomatic to use new type wrappers in Go for IDs?", "body": "<p>Go supports <a href=\"https://tour.golang.org/basics/14\" rel=\"nofollow noreferrer\">type inference</a> on compiler level. There is no runtime cost in the compiled binary.</p>\n\n<p>With this type definition</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UserID uint64\n</code></pre>\n\n<p>Both of the following should result in the same binary:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>uid := UserID(1)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var uid UserID = 1\n</code></pre>\n\n<p>And to my experience, development environment can understand both equally well. And they are both humanly-readable. I think I see more of the first one in production code than the second one.</p>\n\n<p>As @AndySchweig mentioned in comment, this is usually used when the variable is a Enum like value.</p>\n\n<pre><code>type UserType uint\n\nconst (\n  TypeVisitor UserType = 1\n  TypeNormal = 2\n  TypeAdmin = 3\n)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type UserType uint\n\nconst (\n  TypeVisitor UserType = iota\n  TypeNormal\n  TypeAdmin\n)\n</code></pre>\n\n<p>The exported const would make code much more readable:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nswitch userType {\n  case mylib.TypeVisitor:\n    // do something\n  case mylib.TypeNormal:\n    // do something\n  case mylib.TypeAdmin:\n    // do something\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1259, "user_id": 1814775, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ea9a58ab403c34bc21cde3a006d2e6d8?s=128&d=identicon&r=PG", "display_name": "lloydmeta", "link": "https://stackoverflow.com/users/1814775/lloydmeta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571122411, "creation_date": 1571105909, "last_edit_date": 1571122390, "question_id": 58386332, "link": "https://stackoverflow.com/questions/58386332/is-it-idiomatic-to-use-new-type-wrappers-in-go-for-ids", "title": "Is it idiomatic to use new type wrappers in Go for IDs?", "body": "<p>In other statically-typed languages like Haskell, Scala, or Rust, sometimes for things like identifiers, one would wrap them in special types to help the compiler catch errors (e.g. preventing you from passing in another in-scope <code>String</code>) and to improve readability of the code by encoding responsibility at the type-level.</p>\n\n<p>Some examples:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype UserId = UserId Integer\n</code></pre>\n\n<p>or </p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>case class UserId(value: Long) extends AnyVal\n</code></pre>\n\n<p>or </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct UserId(u64);\n</code></pre>\n\n<p>All of these offer (usually) no runtime costs and little added clutter for improved peace of mind and dev-time documentation at the type level.</p>\n\n<p>Go also has this ability:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UserId uint64\n</code></pre>\n\n<p>My question is not whether or not this is possible, but whether this is something that is widespread and/or considered idiomatic or not in Go, and why.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 1, "creation_date": 1571111210, "post_id": 58385923, "comment_id": 103121131, "body": "Take a look at this project <a href=\"https://github.com/canthefason/go-watcher\" rel=\"nofollow noreferrer\">github.com/canthefason/go-watcher</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1571123999, "creation_date": 1571123999, "answer_id": 58389224, "question_id": 58385923, "link": "https://stackoverflow.com/questions/58385923/goland-run-re-run-command-from-button-click/58389224#58389224", "title": "Goland run/re-run command from button click", "body": "<p>You can read <a href=\"https://www.jetbrains.com/help/go/running-applications.html\" rel=\"nofollow noreferrer\">the help article</a> on how to run applications/tests directly from the IDE, without having to type the <code>go run</code> command.</p>\n\n<p>As a quick reference: </p>\n\n<blockquote>\n  <p>In the left gutter of the editor, click the Run application icon the Run Application icon and select Run &lt; method_name > in &lt; file_name >.</p>\n</blockquote>\n"}], "owner": {"reputation": 4418, "user_id": 603774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GEUS9.jpg?s=128&g=1", "display_name": "Ali Mamedov", "link": "https://stackoverflow.com/users/603774/ali-mamedov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 58389224, "answer_count": 1, "score": 0, "last_activity_date": 1571123999, "creation_date": 1571101972, "last_edit_date": 1571102836, "question_id": 58385923, "link": "https://stackoverflow.com/questions/58385923/goland-run-re-run-command-from-button-click", "title": "Goland run/re-run command from button click", "body": "<p>I am using <code>go run</code> command to execute my go file manually.</p>\n\n<p>Running <code>main.go</code> file in <code>web</code> directory: <code>go run ./cmd/web</code></p>\n\n<p>After any changes: <kbd>Ctrl</kbd> + <kbd>C</kbd> and then <code>go run ./cmd/web</code> again</p>\n\n<p>Is there a way to do It from button in Goland? Or maybe automatically when go code changes?</p>\n"}, {"tags": ["go", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": false, "score": 1, "last_activity_date": 1571101709, "creation_date": 1571101709, "answer_id": 58385882, "question_id": 58385863, "link": "https://stackoverflow.com/questions/58385863/how-to-use-the-default-struct-tag-with-gos-envconfig-library/58385882#58385882", "title": "How to use the &#39;default&#39; struct tag with Go&#39;s envconfig library?", "body": "<p>A little experimentation showed that both <code>config</code> and <code>foo</code> should be capitalized (to <code>Config</code> and <code>Foo</code>, respectively). The following program,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/kelseyhightower/envconfig\"\n)\n\ntype Config struct {\n    Foo string `default:\"bar\"`\n}\n\nfunc main() {\n    var cfg Config\n    if err := envconfig.Process(\"app\", &amp;cfg); err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(cfg.Foo)\n}\n</code></pre>\n\n<p>produces <code>bar</code> as expected:</p>\n\n<pre><code>&gt; go run use_envconfig.go\nbar\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "is_accepted": true, "score": 2, "last_activity_date": 1571103220, "creation_date": 1571103220, "answer_id": 58386060, "question_id": 58385863, "link": "https://stackoverflow.com/questions/58385863/how-to-use-the-default-struct-tag-with-gos-envconfig-library/58386060#58386060", "title": "How to use the &#39;default&#39; struct tag with Go&#39;s envconfig library?", "body": "<p>In your answer you accidentally fixed the problem. It's not <code>config</code> that needs to be capitalized. It is <code>Foo</code>. The following works: <a href=\"https://play.golang.com/p/7tBUjHlJRS1\" rel=\"nofollow noreferrer\">Demo</a>. </p>\n\n<pre><code>type config struct {\n    Foo string `default:\"bar\"`\n}\n</code></pre>\n\n<p>In Go, only the capitalized fields are accessible outside the current package. Envconfig can only access capitalized fields. Think of those as private and public properties. </p>\n\n<p>Lowercase is private, Uppercase is public.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 1, "accepted_answer_id": 58386060, "answer_count": 2, "score": 2, "last_activity_date": 1571103220, "creation_date": 1571101484, "question_id": 58385863, "link": "https://stackoverflow.com/questions/58385863/how-to-use-the-default-struct-tag-with-gos-envconfig-library", "title": "How to use the &#39;default&#39; struct tag with Go&#39;s envconfig library?", "body": "<p>I'm trying to use the <code>envconfig</code> library, <a href=\"https://github.com/kelseyhightower/envconfig\" rel=\"nofollow noreferrer\">https://github.com/kelseyhightower/envconfig</a>, in a program where most of the configuration variables have default values which I would only like to override if specific environment variables are set.</p>\n\n<p>I've tried to run the following example program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/kelseyhightower/envconfig\"\n)\n\ntype config struct {\n    foo string `default:\"bar\"`\n}\n\nfunc main() {\n    var cfg config\n    if err := envconfig.Process(\"app\", &amp;cfg); err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(cfg.foo)\n}\n</code></pre>\n\n<p>without the <code>APP_FOO</code> environment variable set:</p>\n\n<pre><code>&gt; echo $APP_FOO\n\n</code></pre>\n\n<p>However, this does not print <code>bar</code> as I would expect it to:</p>\n\n<pre><code>&gt; go run use_envconfig.go \n\n</code></pre>\n\n<p>I don't see how my implementation is different from the documented example at <a href=\"https://github.com/kelseyhightower/envconfig#struct-tag-support\" rel=\"nofollow noreferrer\">https://github.com/kelseyhightower/envconfig#struct-tag-support</a> to which the following comment pertains:</p>\n\n<blockquote>\n  <p>If envconfig can't find an environment variable value for <code>MYAPP_DEFAULTVAR</code>, it will populate it with \"foobar\" as a default value.</p>\n</blockquote>\n\n<p>How can I make this program so that the <code>cfg</code>'s value of <code>foo</code> is <code>bar</code> unless I set the <code>APP_FOO</code> environment variable?</p>\n"}, {"tags": ["arrays", "algorithm", "performance", "go", "optimization"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1571097099, "post_id": 58385366, "comment_id": 103118536, "body": "I&#39;d strongly suggest reading the <a href=\"http://meta.programmers.stackexchange.com/questions/6166/open-letter-to-students-with-homework-problems\">Open letter to students with homework problems</a>.  ;)  Furthermore  <code>arr</code> is <i>not</i> an array, but a slice - an apparently small, but interesting difference."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1571097389, "post_id": 58385366, "comment_id": 103118607, "body": "I don&#39;t think you can make the operation of accessing all values in an array any less expensive than a loop. But you can try to make if faster by processing it with multiple goroutines concurrently. Go would try to make use of all the cores to run those goroutines parallelly."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1571098434, "post_id": 58385366, "comment_id": 103118786, "body": "@KoalaYeung Concurrency != parallelism. ;)"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1571101726, "post_id": 58385366, "comment_id": 103119309, "body": "@MarkusWMahlberg: Sure. And I don&#39;t think my comment confused the two."}, {"owner": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571527419, "post_id": 58385366, "comment_id": 103271910, "body": "@MarkusWMahlberg this wasn&#39;t a homework problem I&#39;m just trying to get used to go and have been doing problems like this on hackerrank/leetcode. I was genuinely trying to learn how to do this better. :)"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "edited": false, "score": 0, "creation_date": 1571527631, "post_id": 58385401, "comment_id": 103271943, "body": "In order to split out the original slice a for loop would still be the only way even after sorting correct?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "edited": false, "score": 0, "creation_date": 1571538460, "post_id": 58385401, "comment_id": 103273164, "body": "If the original slice was sorted, you can use binary search to locate the 0&#39;s. If the original slice is not sorted, you have to look at each and every element using a for-loop."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1571097083, "creation_date": 1571097083, "answer_id": 58385401, "question_id": 58385366, "link": "https://stackoverflow.com/questions/58385366/whats-the-best-way-to-count-occurences-of-positive-negative-and-0-values-in-a/58385401#58385401", "title": "What&#39;s the best way to count occurences of positive, negative, and 0 values in an unsorted array?", "body": "<p>If your input structure is an unsorted array, then O(n) is the best you can do, that is, go through the array, comparing each element once.</p>\n\n<p>You may, if it is an option, work with two arrays and an integer, one array for negatives, one array for positives, and an integer to count the number of zeros. Then, counting would no longer be necessary, and you can simply get the length of the arrays.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1571101437, "last_edit_date": 1571101437, "creation_date": 1571100615, "answer_id": 58385759, "question_id": 58385366, "link": "https://stackoverflow.com/questions/58385366/whats-the-best-way-to-count-occurences-of-positive-negative-and-0-values-in-a/58385759#58385759", "title": "What&#39;s the best way to count occurences of positive, negative, and 0 values in an unsorted array?", "body": "<p>You are pretty much at the optimum solution. I implemented @bserdar's suggestion of sorting first and ran a benchmark against it.</p>\n\n<blockquote>\n  <p>Note: this is an extremely crude implementation. Take it with a pound of salt. </p>\n</blockquote>\n\n<p>Package and import omitted for readability.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var slice = []int{2, 5, 6, 7, 8, 2, 4, 1, 1, 1, 2, -2, -2, 2, 2, 3, -1, 0, 0, 0, 0, 2, 5, 4, 9, 8, 7, 2, -3, -7}\n\nfunc orig(s []int) (negative, zero, positive int) {\n    for _, v := range s {\n        if v &gt; 0 {\n            positive++\n        } else if v &lt; 0 {\n            negative++\n        } else if v == 0 {\n            zero++\n        }\n    }\n    return\n}\n\nfunc sorted(s []int) (negative, zero, positive int) {\n    // We do not want to modify the input slice,\n    // so we need to create a copy of it\n    sortedSlice := make([]int, len(s))\n    copy(sortedSlice, s)\n    sort.Ints(sortedSlice)\n    return preSorted(sortedSlice)\n}\n\nfunc preSorted(s []int) (int, int, int) {\n    var z, p int\n    var zfound bool\n    for i := 0; i &lt; len(s); i++ {\n        if s[i] &lt; 0 {\n            continue\n        } else if !zfound &amp;&amp; s[i] == 0 {\n            zfound = true\n            z = i\n        } else if s[i] &gt; 0 {\n            p = i\n            break\n        }\n    }\n    return z, p - z, len(s) - p\n}\n</code></pre>\n\n<p>The test code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func BenchmarkOrig(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        orig(slice)\n    }\n}\n\nfunc BenchmarkLongOrig(b *testing.B) {\n    var slice = make([]int, 10000000)\n    for i := 0; i &lt; 10000000; i++ {\n        slice[i] = rand.Intn(10)\n        if rand.Intn(2) == 0 {\n            slice[i] = slice[i] * -1\n        }\n    }\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        orig(slice)\n    }\n}\nfunc BenchmarkSorted(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        sorted(slice)\n    }\n}\n\nfunc BenchmarkLongSorted(b *testing.B) {\n    var slice = make([]int, 10000000)\n    for i := 0; i &lt; 10000000; i++ {\n        slice[i] = rand.Intn(10)\n        if rand.Intn(2) == 0 {\n            slice[i] = slice[i] * -1\n        }\n    }\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        sorted(slice)\n    }\n}\n\nfunc BenchmarkPresorted(b *testing.B) {\n    cp := make([]int, len(slice))\n    copy(cp, slice)\n    sort.Ints(cp)\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        preSorted(cp)\n    }\n}\n\nfunc BenchmarkLongPresorted(b *testing.B) {\n    var slice = make([]int, 10000000)\n    for i := 0; i &lt; 10000000; i++ {\n        slice[i] = rand.Intn(10)\n        if rand.Intn(2) == 0 {\n            slice[i] = slice[i] * -1\n        }\n    }\n    sort.Ints(slice)\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        sorted(slice)\n    }\n}\n</code></pre>\n\n<p>The according benchmark:</p>\n\n<pre><code>goos: darwin\ngoarch: amd64\nBenchmarkOrig-4             27271665            38.4 ns/op         0 B/op          0 allocs/op\nBenchmarkLongOrig-4               21      50343196 ns/op           0 B/op          0 allocs/op\nBenchmarkSorted-4            1405150           852 ns/op         272 B/op          2 allocs/op\nBenchmarkLongSorted-4              2     536973066 ns/op    80003104 B/op          2 allocs/op\nBenchmarkPresorted-4        100000000           10.9 ns/op         0 B/op          0 allocs/op\nBenchmarkLongPresorted-4           5     248698010 ns/op    80003104 B/op          2 allocs/op\n</code></pre>\n\n<p><strong>EDIT</strong> Found a slightly more efficient way of returning the count. Instead of creating new slices, we calculate the length of each subslice. That makes a presorted very efficient when the slice is smaller. But at 10M, simply counting seems to be the most efficient.</p>\n\n<p>qed</p>\n"}, {"tags": [], "owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "is_accepted": false, "score": 0, "last_activity_date": 1571111501, "last_edit_date": 1571111501, "creation_date": 1571108714, "answer_id": 58386668, "question_id": 58385366, "link": "https://stackoverflow.com/questions/58385366/whats-the-best-way-to-count-occurences-of-positive-negative-and-0-values-in-a/58386668#58386668", "title": "What&#39;s the best way to count occurences of positive, negative, and 0 values in an unsorted array?", "body": "<p>The fastest way would be to:</p>\n\n<p>a) make sure the array/slice is using the smallest data type possible (to reduce the amount of RAM and number of cache lines touched; to pack more values into a single SIMD register, and to reduce the amount of shifting I'm going to suggest later) - e.g. for the values you've shown in the question you could/should be using <code>int8</code> (and not <code>int</code>).</p>\n\n<p>b) add zeros to the end to pad the array/slice to a multiple of however many elements the CPU can do at once using SIMD (e.g. 32 elements if you're using <code>int8</code> on an 80x86 CPU that supports AVX2). This mostly just avoids a messy hassle when you get near the end of the array/slice.</p>\n\n<p>c) using SIMD in a loop:</p>\n\n<ul>\n<li>load a group of values into a SIMD register</li>\n<li>copy the group to another SIMD register</li>\n<li>use \"unsigned shift right\" then \"AND\" on the entire group of numbers so that the lowest bit in each number contains the original number's sign bit</li>\n<li>add the result of this to a \"group of counters of negative numbers\" in a different SIMD register</li>\n<li>use a sequence of \"shift\" and \"OR\", to merge all bits of a number into a single bit, to get \"1 if original number was non-zero, 0 if original numbers was zero\"</li>\n<li>add the result of this to a \"group of counters of non-zero numbers\" in a different SIMD register</li>\n</ul>\n\n<p>d) After all that (outside the loop):</p>\n\n<ul>\n<li><p>calculate the count of negative numbers by doing a \"horizontal add\" of the \"group of counters of negative numbers\"</p></li>\n<li><p>calculate the count of positive numbers by doing a \"horizontal add\" of the \"group of counters of non-zero numbers\", then subtracting the count of negative numbers</p></li>\n<li><p>calculate the count of zeros by doing \"zeros = all_numbers - negative_numbers - positive_numbers - padding_zeros\"</p></li>\n</ul>\n\n<p>Of course to do anything well you need inline assembly, which means that you'll want something like <a href=\"https://godoc.org/github.com/slimsag/rand/simd\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/slimsag/rand/simd</a> (that does the inline assembly for you in a nice portable way).</p>\n\n<p>Note 1: for large arrays/slices (but not small arrays/slices) you'll also want to use multiple CPUs in parallel (e.g. have N threads/goroutines if there's N CPUs, and split the array/slice into N pieces where each thread/goroutine does one piece, then add the counts from each piece before doing \"step d)\").</p>\n\n<p>Note 2: For larger amounts of data; my algorithm is \"O(n)\", and because your original algorithm is only \"O(n)\" I'd expect my algorithm to be up to 100 times faster on modern hardware. However, for very small amounts of data, because \"O(n)\" is not linear, I'd expect your algorithm to be faster than mine.</p>\n"}], "owner": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1571111501, "creation_date": 1571096743, "question_id": 58385366, "link": "https://stackoverflow.com/questions/58385366/whats-the-best-way-to-count-occurences-of-positive-negative-and-0-values-in-a", "title": "What&#39;s the best way to count occurences of positive, negative, and 0 values in an unsorted array?", "body": "<p>The below works but how would I optimize this? I imagine looping through the array would become expensive as it grows.\nI could create a map of the original array to store the number of occurrences for each value and then check those values for +/-/0 in another loop but that's even worse.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    arr := []int{2, 5, 6, 7, 8, 2, 4, 1, 1, 1, 2, -2, -2, 2, 2, 3, -1, 0, 0, 0, 0, 2, 5, 4, 9, 8, 7, 2, -3, -7}\n    var p, n, z int = 0, 0, 0\n    for _, v := range arr {\n        if v &gt; 0 {\n            p++\n        } else if v &lt; 0 {\n            n++\n        } else if v == 0 {\n            z++\n        }\n    }\n    fmt.Println(p, n, z)\n}\n</code></pre>\n"}, {"tags": ["docker", "security", "go", "race-condition", "gvisor"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 12216171, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB27b904HUDv0MKTIWI6yY65e_wk52g7mgKlONWow=k-s128", "display_name": "ChangHo Seo", "link": "https://stackoverflow.com/users/12216171/changho-seo"}, "edited": false, "score": 0, "creation_date": 1571247386, "post_id": 58399485, "comment_id": 103180150, "body": "That&#39;s my question after write in stack overflow :). but Thank you for search and answer for me!"}], "tags": [], "owner": {"reputation": 273, "user_id": 10817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04517ba4c854fb53dbc14b4cae73717b?s=128&d=identicon&r=PG", "display_name": "prattmic", "link": "https://stackoverflow.com/users/10817/prattmic"}, "is_accepted": true, "score": 1, "last_activity_date": 1571158782, "creation_date": 1571158782, "answer_id": 58399485, "question_id": 58382208, "link": "https://stackoverflow.com/questions/58382208/how-gvisor-can-protect-host-from-dirty-cow-poc/58399485#58399485", "title": "How gVisor can protect host from dirty cow PoC?", "body": "<p>From the gVisor mailing list:</p>\n\n<blockquote>\n  <p>gVisor does do locking on the memory manager in order to avoid the DirtyCow race condition. However, there is nothing fundamental about gVisor's Sentry that protects it from potentially harmful race conditions besides good coding practices and testing.</p>\n  \n  <p>gVisor's more fundamental protection is in fact that the Sentry has two layers of isolation from the host. It runs as a user-space process in a locked down Linux container. So even IF an attacker finds a bug that allows them to execute code in the Sentry, the attacker would need an independent bug in the small Linux attack surface that is available in the Linux container. This protection applies to many types of security issues and not just DirtyCow.</p>\n</blockquote>\n\n<p>-<a href=\"https://groups.google.com/d/msg/gvisor-users/ze-6LpPoDcQ/Y1jScf32CQAJ\" rel=\"nofollow noreferrer\">https://groups.google.com/d/msg/gvisor-users/ze-6LpPoDcQ/Y1jScf32CQAJ</a></p>\n"}], "owner": {"reputation": 13, "user_id": 12216171, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mB27b904HUDv0MKTIWI6yY65e_wk52g7mgKlONWow=k-s128", "display_name": "ChangHo Seo", "link": "https://stackoverflow.com/users/12216171/changho-seo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 58399485, "answer_count": 1, "score": 1, "last_activity_date": 1571158782, "creation_date": 1571077591, "last_edit_date": 1571078240, "question_id": 58382208, "link": "https://stackoverflow.com/questions/58382208/how-gvisor-can-protect-host-from-dirty-cow-poc", "title": "How gVisor can protect host from dirty cow PoC?", "body": "<p>I'm trying to figure out how gVisor can prevent dirty cow vulnerability PoC.</p>\n\n<p>so I read code in sentry in gVisor and it seems madvise() in sentry has locking so sentry can avoid race condition.</p>\n\n<p><strong>in pkg/sentry/mm/syscalls.go</strong></p>\n\n<pre><code>// Decommit implements the semantics of Linux's madvise(MADV_DONTNEED).\nfunc (mm *MemoryManager) Decommit(addr usermem.Addr, length uint64) error {\n...\nmm.mappingMu.RLock()\ndefer mm.mappingMu.RUnlock()\nmm.activeMu.Lock()\ndefer mm.activeMu.Unlock()\n...\n</code></pre>\n\n<p>But I'm expecting there will be a structural reason why the gVisor has avoided a dirty cow vulnerability.</p>\n\n<p>So I watched several videos and documents from gVisor, but they just demonstrated that gVisor can prevent from situation which write on read-only file.</p>\n\n<p>And sadly, I couldn't found other reasons that how they can protected Read-only file from exploit code in those videos.</p>\n\n<p>Does it mean same problem will be occurred just like normal docker if sentry also have a race condition in same point?</p>\n\n<p>if so, Sentry will try to write to file as a root, and same problem will occur I think.</p>\n\n<p>Or are there more fundamental reason which I missed?</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1571076959, "post_id": 58382056, "comment_id": 103112369, "body": "Which line is triggering your nil dereference?"}, {"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571077105, "post_id": 58382056, "comment_id": 103112417, "body": "@Adrian i&#39;ve updated my question, thx!"}, {"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571078430, "post_id": 58382056, "comment_id": 103112928, "body": "@Adrian any reason for the downvote?"}], "answers": [{"tags": [], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "is_accepted": false, "score": 0, "last_activity_date": 1571078416, "creation_date": 1571078416, "answer_id": 58382399, "question_id": 58382056, "link": "https://stackoverflow.com/questions/58382056/golang-rabbitmq-channel-consume-sigsegv/58382399#58382399", "title": "golang rabbitmq channel.consume SIGSEGV", "body": "<p>The error is now obvious to me.  In the constructor function, do not close the connection/channel.  i.e. </p>\n\n<pre><code>    conn, err := amqp.Dial(options.AMQPConnectionURL)\n    if err != nil {\n        logger.Fatalf(\"%s: %s\", \"Can't connect to AMQP\", err)\n    }\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>    conn, err := amqp.Dial(options.AMQPConnectionURL)\n    if err != nil {\n        logger.Fatalf(\"%s: %s\", \"Can't connect to AMQP\", err)\n    }\n    defer conn.Close()\n    ```\n</code></pre>\n"}], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571078416, "creation_date": 1571076741, "last_edit_date": 1571077040, "question_id": 58382056, "link": "https://stackoverflow.com/questions/58382056/golang-rabbitmq-channel-consume-sigsegv", "title": "golang rabbitmq channel.consume SIGSEGV", "body": "<p>Folks,\n  Am trying to write a wrapper library for the rabbitmq implementation.   For some strange reason, I am not able to consume from an existing queue.</p>\n\n<p><code>msgs, err := w.AMQP.Channel.Consume(</code> is causing:</p>\n\n<pre><code>2019-10-14T13:58:56.462-0400    info    worker/worker.go:27     [Initializing NewWorker]\n2019-10-14T13:58:56.462-0400    debug   worker/worker.go:43     Starting Worker\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x14d024e]\n</code></pre>\n\n<p>The <a href=\"https://www.rabbitmq.com/tutorials/tutorial-three-go.html\" rel=\"nofollow noreferrer\">docs example</a> I followed is simple, and the interface to the rabbitmq driver is simple.  I dont see why im getting a <code>invalid memory address</code> error.</p>\n\n<p>My implementation is identical to how the article lays it out, for reference, here is all the code i have:</p>\n\n<pre><code>// StartConsumingTlcFHVDrivers subscribes to queue and starts to do it's job\nfunc (w *Worker) StartConsuming() {\n    queueName := w.options.Rabbit.AMQP.QueueName\n    w.logger.Debugf(\"Starting %s Worker\", queueName)\n\n    msgs, err := w.AMQP.Channel.Consume(\n        queueName,\n        \"\",\n        false,\n        false,\n        false,\n        false,\n        nil,\n    )\n    if err != nil {\n        logger.Fatalf(\"Could not register consumer, err:%s\", err)\n    }\n\n    forever := make(chan bool)\n\n    go func() {\n        for d := range msgs {\n            w.logger.Infof(\"Received a message: %s\", d.Body)\n        }\n    }()\n\n    w.logger.Infof(\"Waiting for messages on %s\", queueName)\n    &lt;-forever\n}\n</code></pre>\n\n<p>Before I finish the wrapper with my own interface, im setting up the client this way:</p>\n\n<pre><code>import \"\"github.com/streadway/amqp\"\"\n\ntype Client struct {\n    options Options\n    logger  ilogger.Logger\n    metrics imetrics.Client\n    Channel amqp.Channel\n}\n\nfunc NewRabbitClient(logger ilogger.Logger, metrics imetrics.Client, options Options) *Client {\n    var err error\n    conn, err := amqp.Dial(options.AMQPConnectionURL)\n    if err != nil {\n        logger.Fatalf(\"%s: %s\", \"Can't connect to AMQP\", err)\n    }\n    defer conn.Close()\n\n    // create a dedicated channel per queue\n    channel, err := conn.Channel()\n    if err != nil {\n        logger.Fatalf(\"%s: %s\", \"Can't create a amqpChannel\", err)\n    }\n    defer channel.Close()\n\n    // declare an Exchange\n    err = channel.ExchangeDeclare(options.ExchangeName, options.ExchangeType, true, false, false, false, nil)\n\n    // declare a Queue\n    _, err = channel.QueueDeclare(options.QueueName, true, false, false, false, nil)\n    if err != nil {\n        logger.Fatalf(\"Could not declare %s queue, err:%s\", options.QueueName, err)\n    }\n\n    // bind a Queue to the Exchange\n    err = channel.QueueBind(options.QueueName, \"\", options.ExchangeName, false, nil)\n\n    // Qos on the Channel\n    err = channel.Qos(1, 0, false)\n    if err != nil {\n        logger.Fatalf(\"Could not configure QoS, err:%s\", err)\n    }\n\n    return &amp;Client{\n        metrics: metrics,\n        logger:  logger,\n        options: options,\n        Channel: *channel,\n    }\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "go-modules", "go-get"], "comments": [{"owner": {"reputation": 3863, "user_id": 7252805, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7x3Z0.png?s=128&g=1", "display_name": "sheldonzy", "link": "https://stackoverflow.com/users/7252805/sheldonzy"}, "edited": false, "score": 0, "creation_date": 1571072916, "post_id": 58381015, "comment_id": 103110736, "body": "What is the reason you cd into this directory? Any reason you are not defining  WORKDIR?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1571074707, "post_id": 58381015, "comment_id": 103111468, "body": "<code>RUN cd ...anything...</code> doesn&#39;t do anything useful (unless it&#39;s part of a compound command; <code>RUN cd ...anything... &amp;&amp; do_something_else</code>, for example, can be useful, since it puts <code>do_something_else</code> in the <code>anything</code> directory, even though it doesn&#39;t change the working directory of a separate/subsequent <code>RUN</code>). Each <code>RUN</code> command happens inside a new and unique shell that isn&#39;t used for anything else, so <code>cd</code> -- which changes the state of the <i>current shell</i> -- has no lasting effect."}, {"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1571078384, "post_id": 58381015, "comment_id": 103112920, "body": "@CharlesDuffy Thanks, I am aware that <code>RUN cd ...</code> doesn&#39;t do anything useful and in its original form this command is paired with <code>&amp;&amp;</code> and subsequent commands, I just left it in this simplified form to show only what was needed to reproduce the error message."}], "answers": [{"tags": [], "owner": {"reputation": 1649, "user_id": 6855531, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153677140887260/picture?type=large", "display_name": "paltaa", "link": "https://stackoverflow.com/users/6855531/paltaa"}, "is_accepted": false, "score": 2, "last_activity_date": 1571074446, "creation_date": 1571074446, "answer_id": 58381573, "question_id": 58381015, "link": "https://stackoverflow.com/questions/58381015/in-docker-cant-cd-into-directory-installed-with-go-get/58381573#58381573", "title": "In Docker, can&#39;t cd into directory installed with &quot;go get&quot;?", "body": "<p>First of all, in docker you are building a container, so trying to cd into a directory in your pc its not possible. Use the WORKDIR command, also id recomend to git clone into a repository and there create the Dockerfile, and then COPY everything in there to a directory inside the docker for example:</p>\n\n<pre><code>COPY . /app\nWORKDIR /app/where_you_want_to_cd\nRUN whatever_you_want_to_run\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3863, "user_id": 7252805, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7x3Z0.png?s=128&g=1", "display_name": "sheldonzy", "link": "https://stackoverflow.com/users/7252805/sheldonzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1571076851, "last_edit_date": 1571076851, "creation_date": 1571076492, "answer_id": 58382008, "question_id": 58381015, "link": "https://stackoverflow.com/questions/58381015/in-docker-cant-cd-into-directory-installed-with-go-get/58382008#58382008", "title": "In Docker, can&#39;t cd into directory installed with &quot;go get&quot;?", "body": "<p>You can set this path to be your WORKDIR, and the follow up command would be easy.</p>\n\n<p>From the <a href=\"https://docs.docker.com/engine/reference/builder\" rel=\"nofollow noreferrer\">docker builder reference</a>, each RUN command is run independently. So doing <code>RUN cd</code> does not have any effect on the next RUN command. </p>\n\n<p>The following Dockerfile works:</p>\n\n<pre><code>FROM golang:latest\n\nENV GO111MODULE on\nRUN go get github.com/micromdm/scep\nWORKDIR /go/src/github.com/micromdm/scep\n</code></pre>\n\n<p>You need here the <code>GO111MODULE</code> since in the <code>go.mod</code> of that module isn't defined the go version, so you need to activate it yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": false, "score": 1, "last_activity_date": 1571078575, "creation_date": 1571078575, "answer_id": 58382424, "question_id": 58381015, "link": "https://stackoverflow.com/questions/58381015/in-docker-cant-cd-into-directory-installed-with-go-get/58382424#58382424", "title": "In Docker, can&#39;t cd into directory installed with &quot;go get&quot;?", "body": "<p>It turns out that the resulting code is located not in <code>/go/src</code>, but in <code>/go/pkg</code>.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1571078575, "creation_date": 1571071845, "question_id": 58381015, "link": "https://stackoverflow.com/questions/58381015/in-docker-cant-cd-into-directory-installed-with-go-get", "title": "In Docker, can&#39;t cd into directory installed with &quot;go get&quot;?", "body": "<p>I'm trying to build a Docker container which downloads the source of <a href=\"https://github.com/micromdm/scep\" rel=\"nofollow noreferrer\">https://github.com/micromdm/scep</a> and using the <code>go get</code> command and <code>cd</code>s into the resulting directory in order to perform some follow-up commands (namely, <code>make deps</code>, <code>make build</code>, and <code>COPY</code>ing the relevant resulting binary into the container's <code>PATH</code>).</p>\n\n<p>So far I've tried this <code>Dockerfile</code>:</p>\n\n<pre><code>FROM golang:latest\nENV GO111MODULE on\nRUN [\"go\", \"get\", \"github.com/micromdm/scep\"]\nRUN cd $GOPATH/src/github.com/micromdm/scep\n</code></pre>\n\n<p>However, if I try to run this I get the following error:</p>\n\n<pre><code>&gt; docker build . --tag loadtest\nSending build context to Docker daemon  4.608kB\nStep 1/4 : FROM golang:latest\n ---&gt; 52b59e9ead8e\nStep 2/4 : ENV GO111MODULE on\n ---&gt; Using cache\n ---&gt; 28335bf0142b\nStep 3/4 : RUN [\"go\", \"get\", \"github.com/micromdm/scep\"]\n ---&gt; Using cache\n ---&gt; 86760bf0c490\nStep 4/4 : RUN cd $GOPATH/src/github.com/micromdm/scep\n ---&gt; Running in b86fc3ab0ab8\n/bin/sh: 1: cd: can't cd to /go/src/github.com/micromdm/scep\nThe command '/bin/sh -c cd $GOPATH/src/github.com/micromdm/scep' returned a non-zero code: 2\n</code></pre>\n\n<p>If I try the command without setting the <code>GO111MODULE</code> environment variable to <code>on</code>, I get his error:</p>\n\n<pre><code>&gt; docker build . --tag loadtest\nSending build context to Docker daemon  4.608kB\nStep 1/3 : FROM golang:latest\n ---&gt; 52b59e9ead8e\nStep 2/3 : RUN [\"go\", \"get\", \"github.com/micromdm/scep\"]\n ---&gt; Running in 8cb54311a416\npackage github.com/micromdm/scep: no Go files in /go/src/github.com/micromdm/scep\nThe command 'go get github.com/micromdm/scep' returned a non-zero code: 1\n</code></pre>\n\n<p>Following <a href=\"https://github.com/ponzu-cms/ponzu/issues/204\" rel=\"nofollow noreferrer\">https://github.com/ponzu-cms/ponzu/issues/204</a>, I also tried running it with a <code>...</code> at the end,</p>\n\n<pre><code>FROM golang:latest\nRUN [\"go\", \"get\", \"github.com/micromdm/scep/...\"]\nRUN cd $GOPATH/src/github.com/micromdm/scep \\\n</code></pre>\n\n<p>but this results in</p>\n\n<pre><code>&gt; docker build . --tag loadtest\nSending build context to Docker daemon  4.608kB\nStep 1/3 : FROM golang:latest\n ---&gt; 52b59e9ead8e\nStep 2/3 : RUN [\"go\", \"get\", \"github.com/micromdm/scep/...\"]\n ---&gt; Running in 961bae3bb455\n# github.com/micromdm/scep/scep\nsrc/github.com/micromdm/scep/scep/scep.go:318:17: p7.EncryptionAlgorithm undefined (type *pkcs7.PKCS7 has no field or method EncryptionAlgorithm)\nsrc/github.com/micromdm/scep/scep/scep.go:449:26: too many arguments in call to pkcs7.Encrypt\nsrc/github.com/micromdm/scep/scep/scep.go:449:53: undefined: pkcs7.WithEncryptionAlgorithm\nsrc/github.com/micromdm/scep/scep/scep.go:542:26: too many arguments in call to pkcs7.Encrypt\nsrc/github.com/micromdm/scep/scep/scep.go:542:54: undefined: pkcs7.WithEncryptionAlgorithm\nThe command 'go get github.com/micromdm/scep/...' returned a non-zero code: 2\n</code></pre>\n\n<p>Any ideas about how I could achieve downloading the package and <code>cd</code>ing into the resulting directory?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571065140, "post_id": 58379116, "comment_id": 103107263, "body": "<code>mgo.DialInfo</code> uses mongo authentication, not ssh credentials. Your &quot;I need to SSH into Linux box using username and password&quot; is an ssh tunnel. See <a href=\"https://godoc.org/golang.org/x/crypto/ssh\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/ssh</a>"}], "answers": [{"comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571145064, "post_id": 58384973, "comment_id": 103136590, "body": "Is it even possible to set up a replicaset if the db listens on local interface only? OP never mentioned repset or sharding. I agree the idea of using ssh tunneling here is pretty bad and should be used as a last resort."}, {"owner": {"reputation": 29, "user_id": 12200705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea915b1a5da826de423556fd58a20f48?s=128&d=identicon&r=PG&f=1", "display_name": "Test", "link": "https://stackoverflow.com/users/12200705/test"}, "edited": false, "score": 0, "creation_date": 1571147568, "post_id": 58384973, "comment_id": 103138192, "body": "@Markus W Mahlberg - Fantastic, but code is on a windows machine which needs to connect to Linux MongoDb, any suggestions?"}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "reply_to_user": {"reputation": 29, "user_id": 12200705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea915b1a5da826de423556fd58a20f48?s=128&d=identicon&r=PG&f=1", "display_name": "Test", "link": "https://stackoverflow.com/users/12200705/test"}, "edited": false, "score": 1, "creation_date": 1571150672, "post_id": 58384973, "comment_id": 103140064, "body": "@Test you still can set up a tunnel from windows using <a href=\"https://www.putty.org/\" rel=\"nofollow noreferrer\">putty</a>. Please keep in mind that in any way setting up a tunnel by 3rd party app you lose control on it from your go app. Tunnels are not quite reliable and it will be user&#39;s responsibility to ensure the tunnel is up and remains open."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571154421, "post_id": 58384973, "comment_id": 103142240, "body": "@AlexBlex you can use different ports, and potentially use ha-proxy to forward those ports to different hosts (on which you&#39;d have to do the same) - way more complicated than a proper deploymemt, but it would work. And using MongoDB without a replset really makes no sense. An embedded KV store would make much more sense because less overhead and less constraints with the added bonus of the ability to optimize everything to the application&#39;s needs."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571155215, "post_id": 58384973, "comment_id": 103142665, "body": "Replicas are quite expensive. Standalone mongo has a number of advantages  comparing to a KV storage - aggregation, indexes, capped collections to name a few. I believe there are quite a few usecases where it makes sense to have a standalone instance. More sense than connect to it using ssh tunnels anyway =)"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571155349, "post_id": 58384973, "comment_id": 103142733, "body": "@AlexBlex  You can index in bolt, too.  A bit manual work, but well worth it reducing complexity, no? ;) And capped collections are pretty easy to implement, too."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1571155880, "post_id": 58384973, "comment_id": 103143025, "body": "Yes, of course. It&#39;s possible to write own KV implementation if you go a step further. Some companies go as far as creating own languages to write own implementation of their KV storages =)"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 1, "last_activity_date": 1571094142, "last_edit_date": 1571094142, "creation_date": 1571093378, "answer_id": 58384973, "question_id": 58379116, "link": "https://stackoverflow.com/questions/58379116/connect-from-go-to-remote-linux-mongodb-no-auth/58384973#58384973", "title": "Connect from Go to remote Linux MongoDb (no auth)", "body": "<p>An ssh tunnel is a a viable, though sometimes tricky measure to protect a service.</p>\n\n<p>The tricky part is that the tunnel might collapse and you have little you can do when this happens, since the tunnel is created outside your application.</p>\n\n<p>However, for MongoDB, it additionally comes with some rather nasty side effects: You would need to fiddle a lot with settings and DNS to get a replica set up and running, let alone sharding.</p>\n\n<p>It would be better if you enabled authentication (it is not that hard) and TLS as well as proper security measures and <strong><em>then</em></strong> bind your MongoDB server to either 0.0.0.0 or the IP address you use to connect to the machine.</p>\n\n<blockquote>\n  <p>Side note: Make sure you have a brute force blocker like <a href=\"https://www.fail2ban.org/wiki/index.php/Main_Page\" rel=\"nofollow noreferrer\">fail2ban</a> or <a href=\"https://github.com/denyhosts/denyhosts\" rel=\"nofollow noreferrer\">denyhosts</a> installed, configured to protect MongoDB and <strong><em>tested</em></strong> if you do so.</p>\n</blockquote>\n\n<p>If the sum of the above seems too complicated, you should think <strong><em>VERY</em></strong> thoroughly about wether you should not rather use a hosted MongoDB service like <a href=\"https://www.mongodb.com/cloud/atlas\" rel=\"nofollow noreferrer\">MongoDB Inc's Atlas</a> or <a href=\"https://mlab.com/plans/pricing/\" rel=\"nofollow noreferrer\">mLab</a>.</p>\n\n<p>Nevertheless, here is how you can do it:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ssh user@linuxhost -N -f -L 27017:127.0.0.1:27017\nPassword:\n</code></pre>\n\n<p>Enter the password. The process will get into background, and you can check wether it is still running via</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ ps ax | grep ssh\n</code></pre>\n\n<p>This opens an ssh tunnel to the remote host, opening the port 27017 (the first port on the machine you run the command on, and tunnels it through the ssh connections to 127.0.0.1 (the localhost adress of the remote host) on port 27017.</p>\n\n<p>Now, you can simply set <code>&amp;mgo.DialInfo{Addrs:[]string{\"127.0.0.1:27017\"}}</code></p>\n\n<blockquote>\n  <p><strong>Note</strong></p>\n  \n  <p>In case it was not clear by now: I <strong><em>strongly (!!!)</em></strong> advice against using an ssh tunnel. It makes creating a replicaset rather complicated and excludes sharding pretty much. Learn how to <strong><em>properly</em></strong> manage MongoDB.\n  <a href=\"https://university.mongodb.com\" rel=\"nofollow noreferrer\">MongoDB University</a> offers free courses, and they are pretty damn good.</p>\n  \n  <p>You. Have. Been. Warned.</p>\n</blockquote>\n"}], "owner": {"reputation": 29, "user_id": 12200705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea915b1a5da826de423556fd58a20f48?s=128&d=identicon&r=PG&f=1", "display_name": "Test", "link": "https://stackoverflow.com/users/12200705/test"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 58384973, "answer_count": 1, "score": 0, "last_activity_date": 1571094142, "creation_date": 1571064236, "last_edit_date": 1571065384, "question_id": 58379116, "link": "https://stackoverflow.com/questions/58379116/connect-from-go-to-remote-linux-mongodb-no-auth", "title": "Connect from Go to remote Linux MongoDb (no auth)", "body": "<p>Upon logging in to Linux box, no authentication is required to connect with MongoDB.</p>\n\n<p>How to connect from Go code to such MongoDB instance? I need to SSH into Linux box using username and password, and then connect to MongoDB.</p>\n\n<p>Tried below code but it throws: \"no reachable servers\"</p>\n\n<p>From the command prompt, I am able to ping Linux machine IP address and my IDE can connect to internet as well.</p>\n\n<pre><code>    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{\"&lt;LINUX_IP_ADDRESS&gt;\"},\n        Timeout:  60 * time.Second,\n        Database: \"&lt;MONGODB_DATABASE_NAME&gt;\",\n        Username: \"&lt;LINUX_USERNAME&gt;\",\n        Password: \"&lt;LINUX_PASSWORD&gt;\",\n    }\n\n    mongoSession, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        log.Fatalf(\"CreateSession: %s\\n\", err)\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "edited": false, "score": 2, "creation_date": 1571061944, "post_id": 58378459, "comment_id": 103105529, "body": "just a wild guess, although the message says it clearly: you are mixing US and international format. That&#39;s why <code>27</code> is out of month range."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1571061965, "post_id": 58378459, "comment_id": 103105537, "body": "Your input: <code>&quot;27-09-2019&quot;</code>, in that, <code>27</code> is the day, <code>09</code> is the month, so you have to use the layout: <code>&quot;02-01-2006&quot;</code> and not <code>&quot;01-02-2006&quot;</code>."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1571062891, "post_id": 58378459, "comment_id": 103106034, "body": "Yes, but I had it working like this for a while, so, I am a bit surprised not to have met this error before...."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571081253, "post_id": 58378459, "comment_id": 103114014, "body": "@JuliatzindelToro Then it looks you didn&#39;t have any samples with days &gt; 12."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1571127597, "post_id": 58378459, "comment_id": 103127025, "body": "@icza Yep, I guess so"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1571061943, "creation_date": 1571061943, "answer_id": 58378497, "question_id": 58378459, "link": "https://stackoverflow.com/questions/58378459/parsing-date-is-giving-error-month-out-of-range-in-go/58378497#58378497", "title": "Parsing date is giving error: month out of range in Go", "body": "<p><a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">Per the documentation</a>, the layout parameter to <code>Parse</code> is the canonical date \"Mon Jan 2 15:04:05 -0700 MST 2006\" represented in the desired format. That means the layout you gave is MM-DD-YYYY, when your data appears to be DD-MM-YYYY. If that is the case, your layout string should be <code>02-01-2006</code>.</p>\n\n<pre><code>myStringDate := \"27-09-2019\"\ndate, err := time.Parse(\"02-01-2006\", myStringDate)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qUEDtcG1v3W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qUEDtcG1v3W</a></p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 58378497, "answer_count": 1, "score": -2, "last_activity_date": 1571061943, "creation_date": 1571061798, "question_id": 58378459, "link": "https://stackoverflow.com/questions/58378459/parsing-date-is-giving-error-month-out-of-range-in-go", "title": "Parsing date is giving error: month out of range in Go", "body": "<p>I have a date:</p>\n\n<pre><code>myStringDate = \"27-09-2019\"\n</code></pre>\n\n<p>that is a string, and I need to convert to time.Time in Go.</p>\n\n<p>So, I do:</p>\n\n<pre><code>date, err = time.Parse(\"01-02-2006\", myStringDate)\n</code></pre>\n\n<p>And I get an error:</p>\n\n<pre><code>data:&lt;*time.ParseError&gt;(0xc000098140)\n:&lt;time.ParseError&gt;\nLayout:\"01-02-2006\"\nValue:\"27-09-2019\"\nLayoutElem:\"01\"\nValueElem:\"-09-2019\"\nMessage:\": month out of range\"\n</code></pre>\n\n<p>Nevertheless, the layout I use to parse it seems OK. </p>\n\n<p>I am parsing several files, all coming from the same sources, and the other file can be parsed without any problems</p>\n\n<p>What point am I missing ?</p>\n"}, {"tags": ["angular", "go", "heroku", "safari"], "answers": [{"tags": [], "owner": {"reputation": 1266, "user_id": 8035711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54251e31927388d864e8f2fc49fdce27?s=128&d=identicon&r=PG", "display_name": "keser", "link": "https://stackoverflow.com/users/8035711/keser"}, "is_accepted": true, "score": 0, "last_activity_date": 1571058949, "creation_date": 1571058949, "answer_id": 58377648, "question_id": 58377155, "link": "https://stackoverflow.com/questions/58377155/angular-cant-find-variable-cache/58377648#58377648", "title": "Angular can&#39;t find variable cache", "body": "<p>There is a variable named:</p>\n\n<pre><code>declare var Cache: {prototype: Cache; new():Cache}\n</code></pre>\n\n<p>in <code>lib.dom.d.ts</code> file. I was using this variable instead of my <code>cache.ts</code> model. So silly of me...\n If you have a cache model too, put this at top of your *.module.ts file</p>\n\n<pre><code>import {Cache} from 'path-to-cache-file'\n</code></pre>\n"}], "owner": {"reputation": 1266, "user_id": 8035711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54251e31927388d864e8f2fc49fdce27?s=128&d=identicon&r=PG", "display_name": "keser", "link": "https://stackoverflow.com/users/8035711/keser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 58377648, "answer_count": 1, "score": 0, "last_activity_date": 1571058949, "creation_date": 1571057153, "last_edit_date": 1571057761, "question_id": 58377155, "link": "https://stackoverflow.com/questions/58377155/angular-cant-find-variable-cache", "title": "Angular can&#39;t find variable cache", "body": "<p>My Angular app works fine on everything when I run it locally, but if I deploy it on Heroku - in a Go server, aot is disabled on angular build on Chrome and Opera - both on mobile, linux and osx - but it throws an error on safari:</p>\n\n<pre><code>ReferenceError: Can't find variable: Cache\n</code></pre>\n\n<p>When I have a closer look at the error, I suppose it is from my module providers. Because it takes me to:</p>\n\n<pre><code> main-es2015[...].js\n\n[...], IP, KM, {\n            provide: Cache, // error\n            useClass: KM,\n            multi: !0\n        }],\n</code></pre>\n\n<p>Corresponding app.module.ts part</p>\n\n<pre><code>providers: [\n    {provide: HTTP_INTERCEPTORS, useClass: JwtInterceptor, multi: true},\n    {provide: HTTP_INTERCEPTORS, useClass: ErrorInterceptorService, multi: true},\n    {provide: HTTP_INTERCEPTORS, useClass: CachingInterceptor, multi: true},\n    ApplicationStateService,\n    CacheMapService,\n    {provide: Cache, useClass: CacheMapService, multi: true}\n  ],\n</code></pre>\n\n<p>Cache provider wasn't multi, made it multi but made no difference</p>\n"}, {"tags": ["go", "constants", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1571056657, "post_id": 58376730, "comment_id": 103102628, "body": "The answer to the same question you linked says you may create a <i>variable</i> of slice type. Isn&#39;t that a good fit for you?"}], "answers": [{"comments": [{"owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "edited": false, "score": 0, "creation_date": 1571064967, "post_id": 58377051, "comment_id": 103107166, "body": "Excellent, thank you! Implied in your answer, but perhaps worth calling out specifically -  that the <code>var</code> construct works within package scope. The <code>:=</code> style does <i>not</i> work in package scope."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12206905"}, "is_accepted": true, "score": 1, "last_activity_date": 1571056797, "creation_date": 1571056797, "answer_id": 58377051, "question_id": 58376730, "link": "https://stackoverflow.com/questions/58376730/best-way-to-init-an-unchanging-byte-slice/58377051#58377051", "title": "Best way to init an unchanging byte slice", "body": "<p>Declare <code>transparentGif</code> as a package-level variable and use that variable in the function. </p>\n\n<pre><code>var transparentGif = []byte(\"GIF89a\\x01\\x00\\x01\\x00\\x80\\x00\\x00\\xff\\xff\\xff\" +\n        \"\\xff\\xff\\xff\\x21\\xf9\\x04\\x01\\x0a\\x00\\x01\\x00\\x2c\\x00\\x00\\x00\\x00\" +\n        \"\\x01\\x00\\x01\\x00\\x00\\x02\\x02\\x4c\\x01\\x00\\x3b\\x00\")\n\nfunc doStuff() {\n    fmt.Printf(\"Your gif is\\n%s\\n\", hex.Dump(transparentGif))\n}\n</code></pre>\n\n<p>This does add a declaration to the package scope, but is otherwise  neat and tidy. Callers of <code>doStuff</code> are forced to know about this detail if an argument is added as suggested in the question.</p>\n"}], "owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 58377051, "answer_count": 1, "score": 0, "last_activity_date": 1571064734, "creation_date": 1571055780, "last_edit_date": 1571064734, "question_id": 58376730, "link": "https://stackoverflow.com/questions/58376730/best-way-to-init-an-unchanging-byte-slice", "title": "Best way to init an unchanging byte slice", "body": "<p>In Go, you can initialise a byte slice as follows (<a href=\"https://play.golang.org/p/tDO1hgJ6dj9\" rel=\"nofollow noreferrer\">try it on Go Playground</a>)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/hex\"\n)\n\n// doStuff will be called many times in actual application, so we want this to be efficient\nfunc doStuff() {\n    transparentGif := []byte(\"GIF89a\\x01\\x00\\x01\\x00\\x80\\x00\\x00\\xff\\xff\\xff\" +\n        \"\\xff\\xff\\xff\\x21\\xf9\\x04\\x01\\x0a\\x00\\x01\\x00\\x2c\\x00\\x00\\x00\\x00\" +\n        \"\\x01\\x00\\x01\\x00\\x00\\x02\\x02\\x4c\\x01\\x00\\x3b\\x00\")\n    // This will be returned by a web service in actuality, but here we just hex dump it    \n    fmt.Printf(\"Your gif is\\n%s\\n\", hex.Dump(transparentGif))\n}\n\nfunc main() {\n    doStuff()\n}\n</code></pre>\n\n<p>In this case, the data does not need to change, so it would have been nicer (and hopefully more efficient) to initialise it as a constant, near to the function it actually gets used in.</p>\n\n<p>However, as <a href=\"https://stackoverflow.com/questions/13137463/declare-a-constant-array\">this question</a> makes clear, there is no such thing as a const slice in Go.</p>\n\n<p>Is there a more efficient way to do this while keeping the scope small? Ideally with the concatenation and memory allocation done once only.</p>\n\n<p>As far as I know, I'd have to create the slice outside of the function scope then pass it in as a parameter, i.e. widen the scope.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-rds"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1578866938, "post_id": 58392661, "comment_id": 105569160, "body": "could you tell please where did you get &quot;SecretArn&quot; field?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1579049334, "post_id": 58392661, "comment_id": 105635757, "body": "I&#39;m getting BadRequestException: Access denied for user (using password: YES), have you got that error?"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1579077359, "post_id": 58392661, "comment_id": 105642179, "body": "@JohnBalvinArias Please elaborate on it. When you are getting this error?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1579106623, "post_id": 58392661, "comment_id": 105657941, "body": "I was using rds -&gt; aurora -&gt; serverless and wasn&#39;t working with any advice on internet, I tried the command: telnet [enpoint] [port] but it didn&#39;t connect,  but then I change to rds -&gt; mysql , then it worked"}], "tags": [], "owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "is_accepted": true, "score": 3, "last_activity_date": 1578900701, "last_edit_date": 1578900701, "creation_date": 1571135683, "answer_id": 58392661, "question_id": 58376371, "link": "https://stackoverflow.com/questions/58376371/unable-to-run-sql-query-on-aws-rds-using-golang-sdk/58392661#58392661", "title": "Unable to run SQL query on AWS RDS using golang SDK", "body": "<p>Finally, the issue is resolved.</p>\n\n<p>Actually there were multiple issues with it. </p>\n\n<ol>\n<li>At first, I was getting below error - \n\n<blockquote>\n  <p>BadRequestException: Invalid cluster arn:\n  arn:aws:rds:us-east-2:9xxxxxxxx9:db:database-1\n          status code: 400, request id: a7744d7c-4f19-232f-8bf1-c25662968d55</p>\n</blockquote></li>\n</ol>\n\n<p>this is because I was using wrong ResourceArn. Follow this to find the ResourceArn - </p>\n\n<p>RDS --> databases</p>\n\n<p><a href=\"https://i.stack.imgur.com/cDt8c.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cDt8c.png\" alt=\"enter image description here\"></a></p>\n\n<p>and make sure the ARN has cluster in it like below - </p>\n\n<p><em>arn:aws:rds:us-east-2:9xxxxxxxx9:<strong>cluster</strong>:database-1</em></p>\n\n<p>This is what I was missing.</p>\n\n<ol start=\"2\">\n<li>Then I got below error - </li>\n</ol>\n\n<blockquote>\n  <p>BadRequestException: HttpEndpoint is not enabled for cluster database-2. Please refer to <a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html#data-api.troubleshooting\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html#data-api.troubleshooting</a>\n          status code: 400, request id: f6ceef3e-c43c-43a3-a5f2-aeafdedd9b71</p>\n</blockquote>\n\n<p>This error is solved by enabling data API. Details are in the above link.</p>\n\n<p><strong><em>EDIT</em></strong></p>\n\n<p><strong>How to get the SecretARN</strong></p>\n\n<p>For getting the SecretARN you have to create a <code>secret</code> using <a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html\" rel=\"nofollow noreferrer\">Secret Manager</a>. AWS Secrets Manager is an AWS service that makes it easier for you to manage secrets. Secrets can be database credentials, passwords, third-party API keys, and even arbitrary text. You can store and control access to these secrets centrally by using the Secrets Manager console, the Secrets Manager command-line interface (CLI), or the Secrets Manager API and SDKs.</p>\n\n<p>Follow this <a href=\"https://aws.amazon.com/blogs/security/rotate-amazon-rds-database-credentials-automatically-with-aws-secrets-manager/\" rel=\"nofollow noreferrer\">link</a> to create a secret for RDS. For getting started you can disable the automatic rotation of the <code>secret</code>.</p>\n"}], "owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1529, "favorite_count": 1, "accepted_answer_id": 58392661, "answer_count": 1, "score": 0, "last_activity_date": 1578900701, "creation_date": 1571054546, "last_edit_date": 1571054952, "question_id": 58376371, "link": "https://stackoverflow.com/questions/58376371/unable-to-run-sql-query-on-aws-rds-using-golang-sdk", "title": "Unable to run SQL query on AWS RDS using golang SDK", "body": "<p>I am new to AWS and working on Relational Database Service(RDS) for the first time. </p>\n\n<p>I have created a database(MySQL) on RDS from the AWS console. Now I am trying to create some tables in the database and to simply insert and retrieve data from it using <strong>Golang SDK</strong>. I have created the below code in Golang to run a SQL query, but I am getting an error as below.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/rdsdataservice\"\n)\n\nfunc main() {\n\n    // Initialize a session in us-east-2 \n    sess, _ := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-2\")},\n    )\n\n\n    // Sending a request using the ExecuteStatementRequest method.\n\n    SQLStatement := `CREATE TABLE Persons (\n        PersonID int,\n        LastName varchar(255),\n        FirstName varchar(255),\n        Address varchar(255),\n        City varchar(255)\n    );`\n\n    // Create RDS service client\n    rdsdataservice_client := rdsdataservice.New(sess)\n\n    req, resp := rdsdataservice_client.ExecuteStatementRequest(&amp;rdsdataservice.ExecuteStatementInput{\n        Database:    aws.String(\"database-1\"),\n        ResourceArn: aws.String(\"arn:aws:rds:us-east-2:9xxxxxxxx9:db:database-1\"),\n        SecretArn:   aws.String(\"arn:aws:secretsmanager:us-east-2:9xxxxxxxx9:secret:RDS_Credentials-IZOXv0\"),\n        Sql:         aws.String(SQLStatement),\n    })\n\n    err1 := req.Send()\n    if err1 == nil { // resp is now filled\n        fmt.Println(\"Response:\", resp)\n    } else {\n        fmt.Println(\"error:\", err1)\n    }\n\n}\n</code></pre>\n\n<p>I am getting below error -</p>\n\n<pre><code>BadRequestException: Invalid cluster arn: arn:aws:rds:us-east-2:9xxxxxxxx9:db:database-1\n        status code: 400, request id: a7744d7c-4f19-232f-8bf1-c25662968d55\n</code></pre>\n\n<p>I will appreciate if anyone can help me to find the issue.</p>\n\n<p>I am using the following API reference documentation - <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/rdsdataservic\" rel=\"nofollow noreferrer\">link</a>. I doubt that these API's are only for Aurora database and not for others. Please correct me if I am wrong and suggest the correct API's references.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1571071532, "last_edit_date": 1571071532, "creation_date": 1571065047, "answer_id": 58379349, "question_id": 58376089, "link": "https://stackoverflow.com/questions/58376089/best-way-to-remove-selected-elements-from-slice/58379349#58379349", "title": "Best way to remove selected elements from slice", "body": "<blockquote>\n  <p>I have a slice A and another slice B. Slice A contains n elements and\n  slice B is a subset of slice A where each element is a pointer to\n  Slice A.</p>\n  \n  <p>What would be the cheapest method to remove all elements from A which\n  is referred in B.</p>\n</blockquote>\n\n<p>A and B may have duplicates and may not be sorted.</p>\n\n<hr>\n\n<p>For example, growth rate O(n),</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc remove(a []int, b []*int) []int {\n    d := make(map[*int]bool, len(b))\n    for _, e := range b {\n        d[e] = true\n    }\n    var c []int\n    if len(a) &gt;= len(d) {\n        c = make([]int, 0, len(a)-len(d))\n    }\n    for i := range a {\n        if !d[&amp;a[i]] {\n            c = append(c, a[i])\n        }\n    }\n    return c\n}\n\nfunc main() {\n    a := []int{0, 1, 2, 3, 4, 5, 6, 7}\n    fmt.Println(a)\n    b := []*int{&amp;a[1], &amp;a[3], &amp;a[3], &amp;a[7], &amp;a[4]}\n    a = remove(a, b)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/-RpkH51FSt2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-RpkH51FSt2</a></p>\n\n<p>Output:</p>\n\n<pre><code>[0 1 2 3 4 5 6 7]\n[0 2 5 6]\n</code></pre>\n"}], "owner": {"reputation": 3635, "user_id": 440621, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/0ace3707d59b250045159a8493d8a6ea?s=128&d=identicon&r=PG", "display_name": "Akhil K Nambiar", "link": "https://stackoverflow.com/users/440621/akhil-k-nambiar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 1, "accepted_answer_id": 58379349, "answer_count": 1, "score": 4, "last_activity_date": 1571072396, "creation_date": 1571053511, "question_id": 58376089, "link": "https://stackoverflow.com/questions/58376089/best-way-to-remove-selected-elements-from-slice", "title": "Best way to remove selected elements from slice", "body": "<p>I have a slice A and another slice B. Slice A contains n elements and slice B is a subset of slice A where each element is a pointer to Slice A.</p>\n\n<p>What would be the cheapest method to remove all elements from A which is referred in B.</p>\n\n<p>After bit of googling only method I can think of is to reslice slice A for each element in B. Is that is only method or is there a simpler one?</p>\n"}, {"tags": ["go", "google-calendar-api", "icalendar"], "answers": [{"comments": [{"owner": {"reputation": 3177, "user_id": 5466534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765ecc1e505cbca0c50fc71fb23c2901?s=128&d=identicon&r=PG&f=1", "display_name": "Sahith Vibudhi", "link": "https://stackoverflow.com/users/5466534/sahith-vibudhi"}, "edited": false, "score": 0, "creation_date": 1571123743, "post_id": 58389110, "comment_id": 103125057, "body": "I do not think that the second ics is being ignored by clients, because the I was able to change desc &amp; event title using the file."}], "tags": [], "owner": {"reputation": 4084, "user_id": 1960599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5357badb7283d50e2dad00f62142946?s=128&d=identicon&r=PG", "display_name": "Arnaud Quillaud", "link": "https://stackoverflow.com/users/1960599/arnaud-quillaud"}, "is_accepted": false, "score": 1, "last_activity_date": 1571123523, "creation_date": 1571123523, "answer_id": 58389110, "question_id": 58373498, "link": "https://stackoverflow.com/questions/58373498/how-to-remove-user-from-attendee-list-in-ics/58389110#58389110", "title": "How to remove user from Attendee list in .ics?", "body": "<p>It looks like your DTSTAMP and LAST-MODIFIED values are \"backward\" in the sense that the updated invite has an earlier timestamp than the original one.</p>\n\n<p>First invite:</p>\n\n<pre><code>DTSTAMP:20191014T085551Z\n</code></pre>\n\n<p>Updated invite:</p>\n\n<pre><code>DTSTAMP:20191014T085422Z\n</code></pre>\n\n<p>As a consequence this second ics is likely to be ignored by clients as per <a href=\"https://tools.ietf.org/html/rfc5546#section-2.1.5\" rel=\"nofollow noreferrer\">https://tools.ietf.org/html/rfc5546#section-2.1.5</a></p>\n"}], "owner": {"reputation": 3177, "user_id": 5466534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/765ecc1e505cbca0c50fc71fb23c2901?s=128&d=identicon&r=PG&f=1", "display_name": "Sahith Vibudhi", "link": "https://stackoverflow.com/users/5466534/sahith-vibudhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1589116489, "creation_date": 1571044191, "last_edit_date": 1571049621, "question_id": 58373498, "link": "https://stackoverflow.com/questions/58373498/how-to-remove-user-from-attendee-list-in-ics", "title": "How to remove user from Attendee list in .ics?", "body": "<p>I am using .ics file to send calendar invite to google users from my app, when a user is removed from the attendees in my app, </p>\n\n<ul>\n<li>I am resending the .ics with updated attendees list to attendees who are still in the meeting.</li>\n<li>send the removed attendees new .ics with cancel event.</li>\n</ul>\n\n<p>however, the removed attendees are still showing in the event for other users. </p>\n\n<p>how do I remove attendees from event using ICS?</p>\n\n<p>first .ics:</p>\n\n<pre><code>BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:MyDemoApp\nMETHOD:REQUEST\nBEGIN:VEVENT\nUID:useremovetest1jdfshsdpfh\nSEQUENCE:0\nCREATED:20191014T085551Z\nDTSTAMP:20191014T085551Z\nLAST-MODIFIED:20191014T085551Z\nDTSTART:20191014T112347Z\nDTEND:20191014T113547Z\nSUMMARY:user remove test - 2\nLOCATION:@my-dev-env\nDESCRIPTION:some dummy desc \nATTENDEE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT;RSVP=\n true:mailto:user1@gmail.com\nATTENDEE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT;RSVP=\n true:mailto:user2@gmail.com\nATTENDEE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT;RSVP=\n true:mailto:user3@gmail.com\nORGANIZER;CN=Invitation - user remove test - 2:user1@gmail.com\nEND:VEVENT\nEND:VCALENDAR\n</code></pre>\n\n<p>.ics when a attendee is removed:</p>\n\n<pre><code>BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:MyDemoApp\nMETHOD:REQUEST\nBEGIN:VEVENT\nUID:useremovetest1jdfshsdpfh\nSEQUENCE:0\nCREATED:20191014T085422Z\nDTSTAMP:20191014T085422Z\nLAST-MODIFIED:20191014T085422Z\nDTSTART:20191014T112347Z\nDTEND:20191014T113547Z\nSUMMARY:user remove test - 2\nLOCATION:@my-dev-env\nDESCRIPTION:some dummy desc - update\nATTENDEE;ROLE=REQ-PARTICIPANT;RSVP=true;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-AC\n TION:mailto:user1@gmail.com\nATTENDEE;CUTYPE=INDIVIDUAL;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIPANT;RSVP=\n true:mailto:TION:mailto:user2@gmail.com\nORGANIZER;CN=Invitation - user remove test - 2:user1@gmail.com\nEND:VEVENT\nEND:VCALENDAR\n</code></pre>\n\n<p>user2@gmail.com still stays in the attendee list. however, title, desc etc are updating successfully.</p>\n"}, {"tags": ["authentication", "go", "cookies", "session-cookies"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 4, "creation_date": 1571040096, "post_id": 58372356, "comment_id": 103094236, "body": "How should we know without your code or the website in question?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 0, "creation_date": 1571041991, "post_id": 58372356, "comment_id": 103095167, "body": "And please show us the REST request and the response of your server"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1571045309, "post_id": 58372356, "comment_id": 103096861, "body": "&quot;Is it possible that this website checks for what ip adress was cookies made for?&quot; Yes, of course that&#39;s possible. Along with a million other ways to bind a cookie to a particular device. I&#39;m not sure what kind of help you expect from us. Obviously we can&#39;t tell you how to correctly interact with some unknown site. Your best bet is probably to let the server do the login, though."}], "owner": {"reputation": 1191, "user_id": 1531195, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d5c7a3ac216586cbed4d12113697fde6?s=128&d=identicon&r=PG", "display_name": "Graykos", "link": "https://stackoverflow.com/users/1531195/graykos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571039817, "creation_date": 1571039817, "question_id": 58372356, "link": "https://stackoverflow.com/questions/58372356/using-same-cookies-from-different-source", "title": "Using same cookies from different source", "body": "<p>I got a website with some useful data for me.\nIt has no open api.\nWhat I want to do is to make a golang server, which will fetch this data once an hour and make some kind of analytics for me and then push it to my phone. But this data is only accessible for logged in users.\nI made an app, where I open a login page, and then I grab cookies after I login and pass them to my server, so it can use them once on hour to make a requests to get those data.\nBut this seem to be not working.\nWhat am I missing? Is it possible that this website checks for what ip adress was cookies made for?</p>\n"}, {"tags": ["go", "lua", "goroutine"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 3, "creation_date": 1571028091, "post_id": 58369885, "comment_id": 103090100, "body": "Incidentally, <a href=\"https://www.cs.hmc.edu/~oneill/papers/Sieve-JFP.pdf\" rel=\"nofollow noreferrer\">this is <i>not</i> the Sieve of Eratosthenes</a>. It&#39;s commonly mistaken for the Sieve of Eratosthenes, but it&#39;s actually trial division, and a particularly inefficient form of trial division, since it keeps testing for divisors even when it passes the square root of a number."}, {"owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "edited": false, "score": 1, "creation_date": 1571028247, "post_id": 58369885, "comment_id": 103090128, "body": "If you remove the <code>fmt.Print</code> statements your code runs almost instantly."}, {"owner": {"reputation": 1400, "user_id": 637902, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e18d21f51ab456d57a0b81a80537c82a?s=128&d=identicon&r=PG", "display_name": "PeopleMoutainPeopleSea", "link": "https://stackoverflow.com/users/637902/peoplemoutainpeoplesea"}, "edited": false, "score": 0, "creation_date": 1571108393, "post_id": 58369885, "comment_id": 103120518, "body": "Thanks for pointing out efficiency issue of this implementation.  But that is intentional. What I want to see is the go routine performance as compared with coroutine in other languages."}, {"owner": {"reputation": 1400, "user_id": 637902, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e18d21f51ab456d57a0b81a80537c82a?s=128&d=identicon&r=PG", "display_name": "PeopleMoutainPeopleSea", "link": "https://stackoverflow.com/users/637902/peoplemoutainpeoplesea"}, "edited": false, "score": 0, "creation_date": 1571108423, "post_id": 58369885, "comment_id": 103120526, "body": "I wil edit the question a little bit.  thanks all."}], "answers": [{"comments": [{"owner": {"reputation": 1400, "user_id": 637902, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e18d21f51ab456d57a0b81a80537c82a?s=128&d=identicon&r=PG", "display_name": "PeopleMoutainPeopleSea", "link": "https://stackoverflow.com/users/637902/peoplemoutainpeoplesea"}, "edited": false, "score": 0, "creation_date": 1571107601, "post_id": 58370156, "comment_id": 103120350, "body": "Thanks for pointing out that most slowness is caused by print I/O. I ran programs by time ./sieve &gt; log.  The problem is the lua script has print I/O too. Does that mean lua&#39;s print I/O is faster?"}, {"owner": {"reputation": 1400, "user_id": 637902, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e18d21f51ab456d57a0b81a80537c82a?s=128&d=identicon&r=PG", "display_name": "PeopleMoutainPeopleSea", "link": "https://stackoverflow.com/users/637902/peoplemoutainpeoplesea"}, "edited": false, "score": 0, "creation_date": 1571108077, "post_id": 58370156, "comment_id": 103120453, "body": "The program intentionally uses go routine to simulate entities exchange messages with each other. The purpose is to test the performance of go routine, compared coroutine in other languages."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 7, "last_activity_date": 1571031121, "last_edit_date": 1571031121, "creation_date": 1571027656, "answer_id": 58370156, "question_id": 58369885, "link": "https://stackoverflow.com/questions/58369885/why-this-go-program-is-so-slow/58370156#58370156", "title": "Why this Go program is so slow?", "body": "<p>Meaningless microbenchmarks produce meaningless results.</p>\n\n<p>You are timing print I/O.</p>\n\n<p>You are incurring go routine and channel overhead for a small amount of work.</p>\n\n<hr>\n\n<p>Here is a prime number sieve program in Go.</p>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +46be01f4e0 Sun Oct 13 01:48:30 2019 +0000 linux/amd64\n$ go build sumprimes.go &amp;&amp; time ./sumprimes\n5736396\n29.96\u00b5s   \nreal    0m0.001s\nuser    0m0.001s\nsys     0m0.000s\n</code></pre>\n\n<p><code>sumprimes.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nconst (\n    prime    = 0x00\n    notprime = 0xFF\n)\n\nfunc oddPrimes(n uint64) (sieve []uint8) {\n    sieve = make([]uint8, (n+1)/2)\n    sieve[0] = notprime\n    p := uint64(3)\n    for i := p * p; i &lt;= n; i = p * p {\n        for j := i; j &lt;= n; j += 2 * p {\n            sieve[j/2] = notprime\n        }\n        for p += 2; sieve[p/2] == notprime; p += 2 {\n        }\n    }\n    return sieve\n}\n\nfunc sumPrimes(n uint64) uint64 {\n    sum := uint64(0)\n    if n &gt;= 2 {\n        sum += 2\n    }\n    for i, p := range oddPrimes(n) {\n        if p == prime {\n            sum += 2*uint64(i) + 1\n        }\n    }\n    return sum\n}\n\nfunc main() {\n    start := time.Now()\n\n    var n uint64 = 10000\n    sum := sumPrimes(n)\n    fmt.Println(sum)\n\n    fmt.Println(time.Since(start))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 4, "last_activity_date": 1571028240, "creation_date": 1571028240, "answer_id": 58370215, "question_id": 58369885, "link": "https://stackoverflow.com/questions/58369885/why-this-go-program-is-so-slow/58370215#58370215", "title": "Why this Go program is so slow?", "body": "<p>Most of the time is spent in <code>fmt.Printf</code>.</p>\n\n<p>Taking out the line:</p>\n\n<pre><code>fmt.Printf(\"id: %d, number: %d, myprime: %d, number mod myprime: %d\\n\", sieve.id, number, myprime, number%myprime)\n</code></pre>\n\n<p>reduces runtime from ~5.4 seconds to ~0.64 seconds on one test I ran.</p>\n\n<p>Taking out the unnecessary <code>sync.WaitGroup</code>s reduces the time a bit further, to ~0.48 seconds.  <a href=\"https://play.golang.org/p/gBJ3RScehxG\" rel=\"nofollow noreferrer\">See the version without <code>sync.WaitGroup</code> here.</a>  You're still doing a lot of channel operations, which languages with yield-value-from-coroutine operators do not need (though they have their own issues instead).  This is not a good way to implement primality testing.</p>\n"}], "owner": {"reputation": 1400, "user_id": 637902, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e18d21f51ab456d57a0b81a80537c82a?s=128&d=identicon&r=PG", "display_name": "PeopleMoutainPeopleSea", "link": "https://stackoverflow.com/users/637902/peoplemoutainpeoplesea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1571108961, "creation_date": 1571024951, "last_edit_date": 1571108961, "question_id": 58369885, "link": "https://stackoverflow.com/questions/58369885/why-this-go-program-is-so-slow", "title": "Why this Go program is so slow?", "body": "<p>I just read some short tutorials of Go and wrote a simple program sieve. Sieve uses sieve algorithm to print all the prime number that is smaller than 10000, which create a lot of go routines. I got the correct results but the program is very slow (5 seconds on my machine). I also wrote lua script and python script which implemented the same algorithm, and runs a lot faster (both are about 1 second on my machine).</p>\n\n<p>Note that the purpose is to have idea of go routine's performance compared with coroutine in other languages, for example lua. The implementation is very inefficient, some comments pointed out that it's not correct way to implement Sieve of Eratosthenes. Yes, that's intentional.  Some other replies pointed out that slowness is caused by print I/O. So I commented out print lines. </p>\n\n<p>My question is why my sieve program implemented in Go is so slow?\nHere is the code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"sync\"\n)\n\n\ntype Sieve struct {\n  id int;\n  msg_queue chan int;\n  wg *sync.WaitGroup;\n}\n\n\nfunc NewSieve(id int) *Sieve {\n  sieve := new(Sieve)\n  sieve.id = id\n  sieve.msg_queue = make(chan int)\n  sieve.wg = new(sync.WaitGroup)\n  sieve.wg.Add(1)\n  return sieve\n}\n\n\nfunc (sieve *Sieve) run() {\n  defer sieve.wg.Done()\n\n  myprime := &lt;-sieve.msg_queue\n  if myprime == 0 {\n    return\n  }\n  // fmt.Printf(\"Sieve (%d) is for prime number %d.\\n\", sieve.id, myprime)\n\n  next_sieve := NewSieve(sieve.id + 1)\n  go next_sieve.run()\n  for {\n    number := &lt;-sieve.msg_queue\n    if number == 0 {\n      next_sieve.msg_queue &lt;- number;\n      next_sieve.wg.Wait()\n      return\n    } else if number % myprime != 0 {\n      // fmt.Printf(\"id: %d, number: %d, myprime: %d, number mod myprime: %d\\n\", sieve.id, number, myprime, number % myprime)\n      next_sieve.msg_queue &lt;- number\n    }\n  }\n}\n\n\nfunc driver() {\n  first := NewSieve(2)\n  go first.run()\n  for n := 2; n &lt;= 10000; n++ {\n    first.msg_queue &lt;- n\n  }\n  first.msg_queue &lt;- 0\n  first.wg.Wait()\n}\n\n\nfunc main() {\n  driver()\n}\n</code></pre>\n\n<p>As a comparison, here is the code of sieve.lua</p>\n\n<pre><code>function sieve(id)\n  local myprime = coroutine.yield()\n  // print(string.format(\"Sieve (%d) is for prime number %d\", id, myprime))\n\n  local next_sieve = coroutine.create(sieve)\n  coroutine.resume(next_sieve, id + 1)\n\n  while true do\n    local number = coroutine.yield()\n    if number % myprime ~= 0 then\n      // print(string.format(\"id: %d, number: %d, myprime: %d, number mod myprime: %d\", id, number, myprime, number % myprime))\n      coroutine.resume(next_sieve, number)\n    end\n  end\nend\n\n\nfunction driver()\n  local first = coroutine.create(sieve)\n  coroutine.resume(first, 2)\n  local n\n  for n = 2, 10000 do\n    coroutine.resume(first, n)\n  end\nend\n\ndriver()\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1571174879, "last_edit_date": 1571174879, "creation_date": 1571022345, "answer_id": 58369615, "question_id": 58369504, "link": "https://stackoverflow.com/questions/58369504/mongodb-connection-pool-in-golang-official-driver/58369615#58369615", "title": "MongoDB connection pool in Golang official driver", "body": "<p>Have you tried the MaxPoolSize option:</p>\n\n<pre><code>clientOptions = clientOptions.SetMaxPoolSize(50)\n</code></pre>\n\n<p>I haven't tried this in the official mongo driver, but the mgo driver has a similar option that works as expected.</p>\n"}, {"comments": [{"owner": {"reputation": 1062, "user_id": 12386821, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C2HVm.jpg?s=128&g=1", "display_name": "Jaimil Patel", "link": "https://stackoverflow.com/users/12386821/jaimil-patel"}, "edited": false, "score": 0, "creation_date": 1591149341, "post_id": 62161565, "comment_id": 109943566, "body": "Answers that contains only links will be delete in future so please post your answers with code and its explanation."}], "tags": [], "owner": {"reputation": 1, "user_id": 8010060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fdfab80374961037d67e63c530298b3?s=128&d=identicon&r=PG", "display_name": "Dabnis", "link": "https://stackoverflow.com/users/8010060/dabnis"}, "is_accepted": false, "score": 0, "last_activity_date": 1591132649, "creation_date": 1591132649, "answer_id": 62161565, "question_id": 58369504, "link": "https://stackoverflow.com/questions/58369504/mongodb-connection-pool-in-golang-official-driver/62161565#62161565", "title": "MongoDB connection pool in Golang official driver", "body": "<p>REM** The default poolSize is 100 see <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#ClientOptions.SetMaxPoolSize\" rel=\"nofollow noreferrer\">Golang driver docs</a></p>\n"}], "owner": {"reputation": 935, "user_id": 12210341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xjW3SjdB334/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDCeLd_NjF7rK-LtBQC82BnurApg/photo.jpg?sz=128", "display_name": "max ", "link": "https://stackoverflow.com/users/12210341/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1684, "favorite_count": 0, "accepted_answer_id": 58369615, "answer_count": 2, "score": 1, "last_activity_date": 1591132649, "creation_date": 1571021278, "question_id": 58369504, "link": "https://stackoverflow.com/questions/58369504/mongodb-connection-pool-in-golang-official-driver", "title": "MongoDB connection pool in Golang official driver", "body": "<p>I have two go files in project</p>\n\n<ol>\n<li>main.go</li>\n</ol>\n\n<p>This files creates http server and mongoDB connection and a method which will allow to reuse the connection using following</p>\n\n<pre><code>func ConnectMongoDB() {\n\n    ctx, _ := context.WithTimeout(context.Background(), 30*time.Second)\n\n    // user Connection database\n\n    // Set client options\n    clientOptions := options.Client().ApplyURI(\"mongodb+srv://localhost:27017/demo\")\n\n    // Connect to MongoDB\n    userclient, err = mongo.Connect(ctx, clientOptions)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Check the connection\n    err = userclient.Ping(ctx, nil)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Connected to user MongoDB!\")\n\n}\n\n//GetMongoDBClient , return mongo client for CRUD operations\nfunc GetMongoDBClient() *mongo.Client {\n\n    return userclient\n}\n\n</code></pre>\n\n<ol start=\"2\">\n<li>query.go</li>\n</ol>\n\n<p>This file then define database and then fire query on it</p>\n\n<pre><code>client := GetMongoDBClient()\n\ncollection := client.Database(\"demo\").Collection(\"user\")\n\nerr := collection.FindOne(context.TODO(), filter).Decode(&amp;user)\n\n</code></pre>\n\n<p>When I fired 200 requests , i got email from Atlas saying that i have exceeded my 80 connection limit quota. How to make use of connection pooling here?</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1571015572, "creation_date": 1571015572, "answer_id": 58368991, "question_id": 58368947, "link": "https://stackoverflow.com/questions/58368947/how-do-i-know-that-all-my-goroutines-are-indeed-waiting-for-a-condition-using-go/58368991#58368991", "title": "How do I know that all my goroutines are indeed waiting for a condition using golang&#39;s sync package", "body": "<p>All your goroutines did wake up. However, your program terminates before they can run. You don't need the second broadcast. It is sufficient if you simply wait after the first broadcast, so the goroutines can get a chance to run before the program terminates.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 1339559, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bf8734c148b8be82342fb2f3894eff8?s=128&d=identicon&r=PG", "display_name": "Rahul", "link": "https://stackoverflow.com/users/1339559/rahul"}, "edited": false, "score": 0, "creation_date": 1571032134, "post_id": 58369619, "comment_id": 103090991, "body": "Excellent. I made some comments on yname&#39;s answer. Would be excellent if you could review. Would help me to understand things better!"}, {"owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "edited": false, "score": 0, "creation_date": 1571115915, "post_id": 58369619, "comment_id": 103122099, "body": "From documentation it looks like it&#39;s better to use <code>for</code> when checking for condition instead of <code>if</code>: <a href=\"https://golang.org/pkg/sync/#Cond.Wait\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#Cond.Wait</a>"}, {"owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "edited": false, "score": 0, "creation_date": 1571115993, "post_id": 58369619, "comment_id": 103122114, "body": "It would be also nice to know how to do that with <code>start</code> not being global var (I guess <code>counter</code> in this example represents some shared resource and is inevitable)"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1571160164, "post_id": 58369619, "comment_id": 103144880, "body": "You would normally check the condition in a <code>for</code> loop in a situation where the condition changes over time (i.e., the condition might become true after which a broadcast or signal would be done but then the condition becomes false again). In this case, since <code>start</code> is set to <code>true</code> exactly once and the <code>Broadcast</code> is done afterwards, the <code>if</code> is good enough. About how to share the state, it would be more common to have <code>start</code> as well as the mutex and condition variable in some structure that those functions are methods on. However it&#39;s done, state must be shared for this to work."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1571022392, "creation_date": 1571022392, "answer_id": 58369619, "question_id": 58368947, "link": "https://stackoverflow.com/questions/58368947/how-do-i-know-that-all-my-goroutines-are-indeed-waiting-for-a-condition-using-go/58369619#58369619", "title": "How do I know that all my goroutines are indeed waiting for a condition using golang&#39;s sync package", "body": "<p>You have a problem in that the <code>Broadcast</code> is not guaranteed to wake up all the goroutines since it only wakes up goroutines that are already waiting, and there's a small window between <code>wg.Done()</code> and <code>cond.Wait()</code>. Normally, a condition variable would be used with something that represents the \"condition\" that you're using for synchronization. In this case, you could have a <code>bool</code> package variable that indicates whether it's OK for the goroutines to continue. <code>main</code> would set that and then do a broadcast to tell the goroutines to continue. For example:</p>\n\n<pre><code>package main\n\n    import (\n    \"fmt\"\n    \"sync\"\n)\n\nvar counter int\nvar start bool\n\nfunc worker(wg *sync.WaitGroup, cond *sync.Cond, id int) {\n    fmt.Println(\"Starting Goroutine ID:\", id)\n    // Get a lock and wait\n    cond.L.Lock()\n    fmt.Println(\"Goroutine with ID: \", id, \"obtained a lock\")\n    // Do some processing with the shared resource and wait\n    counter++\n    if !start {\n        cond.Wait()\n    }\n    cond.L.Unlock()\n    fmt.Println(\"Goroutine ID:\", id, \"signalled. Continuing...\")\n    wg.Done() // Worker is completely done\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    cond := sync.NewCond(&amp;sync.Mutex{})\n    counter = 0\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go worker(&amp;wg, cond, i)\n    }\n\n    cond.L.Lock()\n    start = true\n    cond.Broadcast()\n    cond.L.Unlock()\n\n    wg.Wait() // Wait until all workers are done\n    fmt.Println(\"Final value of the counter is\", counter)\n}\n</code></pre>\n\n<p>The addition of the <code>start</code> variable makes it impossible for the goroutines to not continue when <code>main</code> tells them to.</p>\n"}], "owner": {"reputation": 159, "user_id": 1339559, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/9bf8734c148b8be82342fb2f3894eff8?s=128&d=identicon&r=PG", "display_name": "Rahul", "link": "https://stackoverflow.com/users/1339559/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1571022392, "creation_date": 1571014917, "question_id": 58368947, "link": "https://stackoverflow.com/questions/58368947/how-do-i-know-that-all-my-goroutines-are-indeed-waiting-for-a-condition-using-go", "title": "How do I know that all my goroutines are indeed waiting for a condition using golang&#39;s sync package", "body": "<p>I have an application where I am creating multiple goroutines to perform a certain task concurrently. All worker goroutines wait for a condition/event to occur and once the event is triggered, they begin their execution. After creating all goroutines, the main thread should know that all goroutines are indeed in waiting state before sending a broadcast signal.</p>\n\n<p>I know this can be done using channels (which is something that is recommended) but I also found go's sync package interesting. Just trying to figure out how to achieve the same functionality using the sync package instead of channels</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar counter int\n\nfunc worker(wg *sync.WaitGroup, cond *sync.Cond, id int) {\n    fmt.Println(\"Starting Goroutine ID:\", id)\n    // Get a lock and wait\n    cond.L.Lock()\n    defer cond.L.Unlock()\n    fmt.Println(\"Goroutine with ID: \", id, \"obtained a lock\")\n    // Do some processing with the shared resource and wait\n    counter++\n    wg.Done()\n    cond.Wait()\n    fmt.Println(\"Goroutine ID:\", id, \"signalled. Continuing...\")\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    cond := sync.NewCond(&amp;sync.Mutex{})\n    counter = 0\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go worker(&amp;wg, cond, i)\n    }\n\n    wg.Wait() // Wait()'ing only until the counter is incremented\n    // How to make sure that all goroutines you created are indeed wait()'ing ?????\n    cond.Broadcast()\n    time.Sleep(2 * time.Second)\n    cond.Broadcast()\n    fmt.Println(\"Final value of the counter is\", counter)\n}\n\n</code></pre>\n\n<p>If I don't use the below statements in the last 3 lines (except the fmt.Println)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    time.Sleep(2 * time.Second)\n    cond.Broadcast()\n</code></pre>\n\n<p>I get the below output..</p>\n\n<pre><code>Starting Goroutine ID: 4\nGoroutine with ID:  4 obtained a lock\nStarting Goroutine ID: 3\nGoroutine with ID:  3 obtained a lock\nStarting Goroutine ID: 1\nGoroutine with ID:  1 obtained a lock\nStarting Goroutine ID: 0\nGoroutine with ID:  0 obtained a lock\nStarting Goroutine ID: 2\nGoroutine with ID:  2 obtained a lock\nFinal value of the counter is 5\nGoroutine ID: 3 signalled. Continuing...\n</code></pre>\n\n<p>Ideally every goroutine should be able to print</p>\n\n<pre><code>Goroutine ID: 3 signalled. Continuing...\n</code></pre>\n\n<p>with the corresponding goroutine id. We are not able to print that because not all goroutines are signalled as some of them are not even in the wait state. That is the reason I added time.Sleep which is not a practical solution.</p>\n\n<p>My question is..How can I know that all goroutines are actually waiting on the condition cond.Wait()..Channels is a solution but I want to know how I could do this using go's sync package?</p>\n"}, {"tags": ["html", "go", "goquery"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571039083, "post_id": 58368892, "comment_id": 103093744, "body": "What have you tried so far? What is your specific problem? And be aware of the <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY problem</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 1, "last_activity_date": 1571040205, "creation_date": 1571040205, "answer_id": 58372463, "question_id": 58368892, "link": "https://stackoverflow.com/questions/58368892/find-text-in-html-using-golangs-colly-goquery/58372463#58372463", "title": "find text in html using Golang&#39;s colly/goquery", "body": "<p>This code would get you the numbers as string parts with the space included. You need to trim those and parse as numbers. </p>\n\n<p><strong>Update:</strong> The code now trims the lines and parses as float.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/PuerkitoBio/goquery\"\n    \"log\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    html := `&lt;body&gt;\n &lt;a href=\"/xxxx/aaaa\" &gt; AAAA &lt;/a&gt;,  125.00  &lt;br&gt;\n &lt;a href=\"/xxxx/bbbb\" &gt; BBBB &lt;/a&gt;,  235.20  &lt;br&gt;\n &lt;a href=\"/xxxx/cccc\" &gt; CCCC &lt;/a&gt;,  145.04  &lt;br&gt;\n&lt;/body&gt;`\n\n    reader := strings.NewReader(html)\n\n    doc, err := goquery.NewDocumentFromReader(reader)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    justText := doc.Text()\n    lines := strings.Split(justText, \"\\n\")\n    for _, line := range lines {\n        if len(line) &gt; 0 {\n            parts := strings.Split(line, \",\")\n            number, err := strconv.ParseFloat(strings.TrimSpace(parts[1]), 64)\n            if err != nil {\n                fmt.Println(err)\n            } else {\n                fmt.Println(number)\n            }\n        }\n    }\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10740759, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t-1mdUk88Uc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hwkHHUMm385XbYxcmGTDQaXGMXcg/mo/photo.jpg?sz=128", "display_name": "geert van kempen", "link": "https://stackoverflow.com/users/10740759/geert-van-kempen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1571040205, "creation_date": 1571014112, "question_id": 58368892, "link": "https://stackoverflow.com/questions/58368892/find-text-in-html-using-golangs-colly-goquery", "title": "find text in html using Golang&#39;s colly/goquery", "body": "<p>How can I use colly/goquery to find the numerical values in this html snippet:</p>\n\n<pre><code>&lt;body&gt;\n &lt;a href=\"/xxxx/aaaa\" &gt; AAAA &lt;/a&gt;,  125.00  &lt;br&gt;\n &lt;a href=\"/xxxx/bbbb\" &gt; BBBB &lt;/a&gt;,  235.20  &lt;br&gt;\n &lt;a href=\"/xxxx/cccc\" &gt; CCCC &lt;/a&gt;,  145.04  &lt;br&gt;\n&lt;/body&gt;\n</code></pre>\n"}, {"tags": ["dictionary", "go", "struct", "type-declaration", "golang-migrate"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1571008085, "last_edit_date": 1571008085, "creation_date": 1571007252, "answer_id": 58368406, "question_id": 58368348, "link": "https://stackoverflow.com/questions/58368348/declarate-and-using-map-in-structs/58368406#58368406", "title": "Declarate and using map in structs", "body": "<p>The type (<code>map[int]string</code>) must be used in a composite literal expression for a struct field value:</p>\n\n<pre><code>var questions = []survey.Question{\n    {\n        Label:        \"Quest\u00e3o 1\",\n        Instructions: \"Instru\u00e7\u00e3o\",\n        Options: map[int]string{\n            1: \"Op1\",\n            2: \"Op2\",\n        },\n        Answer: map[int]string{\n            1: \"Op1\",\n        },\n    },\n}\n</code></pre>\n\n<p>The type in a composite literal expression can only be elided on slice elements (as it is with the elements of the <code>[]survey.Question</code>), map keys and map values.</p>\n\n<p><a href=\"https://play.golang.org/p/hCSXDY9d1ps\" rel=\"nofollow noreferrer\">Run it on the Go playground</a>.</p>\n"}], "owner": {"reputation": 25, "user_id": 11278848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb962c6c211576c9afebb6711e6b4eb5?s=128&d=identicon&r=PG&f=1", "display_name": "vfbraton", "link": "https://stackoverflow.com/users/11278848/vfbraton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 58368406, "answer_count": 1, "score": -2, "last_activity_date": 1571015201, "creation_date": 1571006713, "last_edit_date": 1571015201, "question_id": 58368348, "link": "https://stackoverflow.com/questions/58368348/declarate-and-using-map-in-structs", "title": "Declarate and using map in structs", "body": "<p>I'am so very noob in golang and started only a fews days ago.</p>\n\n<p>Actually I'm trying make a simple exercise for get used to the golang syntax.</p>\n\n<p>I have this in main.go:</p>\n\n\n\n<pre><code>package main \n\nimport(\n    \"fmt\"\n    // \"stringa\"\n    \"main/survey\"\n)\n\nfunc main() {\n    var questions = []survey.Question{\n        {\n            Label: \"Quest\u00e3o 1\",\n            Instructions : \"Instru\u00e7\u00e3o\",\n            Options : {\n                1 : \"Op1\",\n                2 : \"Op2\",\n            },\n            Answer: {\n                1 : \"Op1\",\n            },\n        },\n    }\n    fmt.Println(questions[0].Label)\n}\n</code></pre>\n\n<p>And I try make a simple structures, but i know. that problems is solveld if I use an interface, but if in next steps I will need using maps in structure...</p>\n\n<p>PS: this is a sample struct I have used:</p>\n\n\n\n<pre><code>package survey\n\nimport(\n    // \"fmt\"\n    // \"strings\"\n    // \"strconv\"\n)\n\n// This is a simple Question in a survey code\ntype Question struct {\n    // This is a label for the quetsion\n    Label string\n    // This is a instructions and is not required\n    Instructions string\n    // this is a multiple options answer\n    Options map[int]string\n    // this is a answer correct response\n    Answer map[int]string\n}\n</code></pre>\n\n<p>Finally the question is:</p>\n\n<p><strong>How can I use map in parameters from inside the struct and write this in the declaration?</strong></p>\n"}, {"tags": ["go", "import", "path"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1571003223, "post_id": 58368003, "comment_id": 103086214, "body": "See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> for a tutorial on how to structure and import Go code."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1571003096, "creation_date": 1571003096, "answer_id": 58368043, "question_id": 58368003, "link": "https://stackoverflow.com/questions/58368003/how-to-import-files-from-current-directory-in-go/58368043#58368043", "title": "How to import files from current directory in go", "body": "<p>You cannot import a file. You can import a package. So, lets say your main is the package \"github.com/mypackage\", then you should import \"github.com/mypackage/Controllers/Event\".</p>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 5691194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aFX0rVGCYmE/AAAAAAAAAAI/AAAAAAAAAQs/psudKJGjCtQ/photo.jpg?sz=128", "display_name": "Vaibhav Khandelwal", "link": "https://stackoverflow.com/users/5691194/vaibhav-khandelwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1571654157, "last_edit_date": 1571654157, "creation_date": 1571028334, "answer_id": 58370225, "question_id": 58368003, "link": "https://stackoverflow.com/questions/58368003/how-to-import-files-from-current-directory-in-go/58370225#58370225", "title": "How to import files from current directory in go", "body": "<p>Go supports package level import. You can import a package by adding it to the import statement at the beginning of the file. </p>\n\n<p>In your case, you should do something like this-</p>\n\n<pre><code>import (\n    \"log\"\n    \"net/http\"\n\n    \"Controllers/Event/EventController\"\n)\n</code></pre>\n\n<p>Also, you should remove first \"/\" from the file name </p>\n\n<p><code>_ /Controllers/Event/EventController.go\" //problem here</code> </p>\n\n<p>because your <em>Controllers</em> folder is at the same level as <em>Main.go</em> file. You should always give relative path in the import statements.</p>\n\n<p>In this way, you can use any file which is listed under <em>EventController</em> folder.</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10122576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f169de8bc70ea8dd5cf6ba6ab685c9e?s=128&d=identicon&r=PG&f=1", "display_name": "WillYum", "link": "https://stackoverflow.com/users/10122576/willyum"}, "edited": false, "score": 0, "creation_date": 1571338907, "post_id": 58370457, "comment_id": 103218045, "body": "Thank you man for giving time to answer me, just to add on this that it&#39;s good to know how to create a module in your project so you can have your own project directory. <a href=\"https://medium.com/mindorks/create-projects-independent-of-gopath-using-go-modules-802260cdfb51\" rel=\"nofollow noreferrer\">medium.com/mindorks/&hellip;</a>. This link can help anyone to build a module."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12206905"}, "is_accepted": true, "score": 2, "last_activity_date": 1571030110, "creation_date": 1571030110, "answer_id": 58370457, "question_id": 58368003, "link": "https://stackoverflow.com/questions/58368003/how-to-import-files-from-current-directory-in-go/58370457#58370457", "title": "How to import files from current directory in go", "body": "<p>There are a few issues:</p>\n\n<ul>\n<li>Packages are imported, not files (as noted in other answers)</li>\n<li>File absolute import paths are not valid as the error states. An application can use file relative import paths (the path starts with \"./\") or a path relative to the Go workspace.  See the <a href=\"https://golang.org/cmd/go/#hdr-Import_path_syntax\" rel=\"nofollow noreferrer\">go command doc</a> for info on the syntax. Import paths relative to the Go workspace are the preferred form.</li>\n<li>It is idiomatic to use lowercase names for packages (and their corresponding directories). The camel case names in the question are workable, but it's better to go with the flow.</li>\n</ul>\n\n<p>The document <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> is a nice tutorial on how to do this. </p>\n\n<p>Here's how to reorganize the code given the above. This assumes that main.go is in a package with import path \"myapp\".  Change this import path to whatever you want.</p>\n\n<pre><code>-- main.go --\n\npackage main\n\nimport (\n    \"log\"\n    _ \"myapp/controllers/event\"\n)\n\nfunc main() {\n    log.Println(\"hello from main\")\n}\n\n-- go.mod --\n\nmodule myapp\n\n-- controllers/event/eventController.go --\n\npackage event\n\nimport \"log\"\n\nfunc init() {\n    log.Println(\"hello from controllers/event\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BpZ6aLdH3KJ\" rel=\"nofollow noreferrer\">Run this example on the Go playground</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 10122576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f169de8bc70ea8dd5cf6ba6ab685c9e?s=128&d=identicon&r=PG&f=1", "display_name": "WillYum", "link": "https://stackoverflow.com/users/10122576/willyum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1921, "favorite_count": 0, "accepted_answer_id": 58370457, "answer_count": 3, "score": -2, "last_activity_date": 1571654157, "creation_date": 1571002633, "last_edit_date": 1592644375, "question_id": 58368003, "link": "https://stackoverflow.com/questions/58368003/how-to-import-files-from-current-directory-in-go", "title": "How to import files from current directory in go", "body": "<h1>Intro</h1>\n<p>I'm trying to import my <code>EventController.go</code> to my <code>main.go</code> file.</p>\n<h2>Directory:</h2>\n<pre><code>\n\u251c\u2500\u2500\u2500Controllers\n\u2502    \u2514\u2500\u2500\u2500Event\n\u2502        \u2514\u2500\u2500\u2500EventController.go\n\u251c\u2500\u2500\u2500Models\n\u251c\u2500\u2500\u2500Routes\n\u2502\n\u2514 Main.go   \n</code></pre>\n<h2>Problem:</h2>\n<pre><code>import (\n    &quot;log&quot;\n    &quot;net/http&quot;\n\n    _ &quot;/Controllers/Event/EventController.go&quot; //problem here\n)\n</code></pre>\n<p>error : <code>cannot import absolute path</code></p>\n<p>I read some documentation but the thing is I see that I'm doing it correctly, though i learnt about $GOPATH bbut I want to use the local directory thing.</p>\n<p>What am I doing wrong and what's this error about</p>\n<h3>NOTE: I want add that I'm using windows as os</h3>\n<p>Thank you.</p>\n"}, {"tags": ["go", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1570987427, "creation_date": 1570987427, "answer_id": 58366011, "question_id": 58365947, "link": "https://stackoverflow.com/questions/58365947/dynamic-bson-creation-in-golang-mongodb-driver/58366011#58366011", "title": "Dynamic BSON creation in Golang MongoDb driver", "body": "<p><code>bson.A</code> is simply an array:</p>\n\n<pre><code>var idarr bson.A\nfor _,x:=range ids {\n   a=append(a,primitive.ObjectIDFromHex(x))\n}\ninQuery:=bson.D{\"$in\":idarr}\n</code></pre>\n"}], "owner": {"reputation": 935, "user_id": 12210341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xjW3SjdB334/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDCeLd_NjF7rK-LtBQC82BnurApg/photo.jpg?sz=128", "display_name": "max ", "link": "https://stackoverflow.com/users/12210341/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 58366011, "answer_count": 1, "score": 1, "last_activity_date": 1570988727, "creation_date": 1570986951, "last_edit_date": 1570988727, "question_id": 58365947, "link": "https://stackoverflow.com/questions/58365947/dynamic-bson-creation-in-golang-mongodb-driver", "title": "Dynamic BSON creation in Golang MongoDb driver", "body": "<p>I am using following BSON for a filter query. </p>\n\n<pre><code>id1, _ := primitive.ObjectIDFromHex(\"5da34e9037c3bed2f5409489\")\nid2, _ := primitive.ObjectIDFromHex(\"5da3511c37c3bed2f540948a\")\n\nfilter := bson.D{{\"_id\", bson.D{{\"$in\", bson.A{id1, id2}}}}}\n</code></pre>\n\n<p>We have only id1 and id2 for now, but in future there will be id3 , id4.</p>\n\n<p>How to create dynamic BSON and pass it in filter?</p>\n"}, {"tags": ["database", "mongodb", "go", "database-connection"], "answers": [{"comments": [{"owner": {"reputation": 3137, "user_id": 661327, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/11c3ac04d669661020cf80a822cd9620?s=128&d=identicon&r=PG", "display_name": "Robert Reiz", "link": "https://stackoverflow.com/users/661327/robert-reiz"}, "edited": false, "score": 1, "creation_date": 1594062235, "post_id": 58366440, "comment_id": 110989430, "body": "I&#39;m coming from Ruby and I&#39;m a bit shocked by the amount of ugly code that is needed to handle a DB connection. Is there really no better way to do it? Maybe a library which is abstracting all this ugly details away?"}], "tags": [], "owner": {"reputation": 442, "user_id": 2666708, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001247574760/picture?type=large", "display_name": "Prateek Bhuwania", "link": "https://stackoverflow.com/users/2666708/prateek-bhuwania"}, "is_accepted": true, "score": 6, "last_activity_date": 1570992320, "last_edit_date": 1570992320, "creation_date": 1570990443, "answer_id": 58366440, "question_id": 58365838, "link": "https://stackoverflow.com/questions/58365838/how-to-reuse-mongodb-connection-in-go/58366440#58366440", "title": "How to reuse MongoDB connection in Go", "body": "<p>I do it this way. Do it once at the service start and then pass the MongoDatastore object around to orchestrator, service layers and repository layers. I am using the \"github.com/mongodb/mongo-go-driver/mongo\" driver for mongo. I think it internally monitors and recycles idle connections. Hence, we don't have to bother about broken connections as long as reference to the mongo.Client object is not lost.</p>\n\n<pre><code>\nconst CONNECTED = \"Successfully connected to database: %v\"\n\ntype MongoDatastore struct {\n    db      *mongo.Database\n    Session *mongo.Client\n    logger  *logrus.Logger\n}\n\nfunc NewDatastore(config config.GeneralConfig, logger *logrus.Logger) *MongoDatastore {\n\n    var mongoDataStore *MongoDatastore\n    db, session := connect(config, logger)\n    if db != nil &amp;&amp; session != nil {\n\n        // log statements here as well\n\n        mongoDataStore = new(MongoDatastore)\n        mongoDataStore.db = db\n        mongoDataStore.logger = logger\n        mongoDataStore.Session = session\n        return mongoDataStore\n    }\n\n    logger.Fatalf(\"Failed to connect to database: %v\", config.DatabaseName)\n\n    return nil\n}\n\nfunc connect(generalConfig config.GeneralConfig, logger *logrus.Logger) (a *mongo.Database, b *mongo.Client) {\n    var connectOnce sync.Once\n    var db *mongo.Database\n    var session *mongo.Client\n    connectOnce.Do(func() {\n        db, session = connectToMongo(generalConfig, logger)\n    })\n\n    return db, session\n}\n\nfunc connectToMongo(generalConfig config.GeneralConfig, logger *logrus.Logger) (a *mongo.Database, b *mongo.Client) {\n\n    var err error\n    session, err := mongo.NewClient(generalConfig.DatabaseHost)\n    if err != nil {\n        logger.Fatal(err)\n    }\n    session.Connect(context.TODO())\n    if err != nil {\n        logger.Fatal(err)\n    }\n\n    var DB = session.Database(generalConfig.DatabaseName)\n    logger.Info(CONNECTED, generalConfig.DatabaseName)\n\n    return DB, session\n}\n\n</code></pre>\n\n<p>You may now create your repository as below:-</p>\n\n<pre><code>type TestRepository interface{\n    Find(ctx context.Context, filters interface{}) []Document, error\n}\n\ntype testRepository struct {\n    store      *datastore.MongoDatastore\n}\n\nfunc (r *testRepository) Find(ctx context.Context , filters interface{}) []Document, error{\n    cur, err := r.store.GetCollection(\"some_collection_name\").Find(ctx, filters)\n    if err != nil {\n        return nil, err\n    }\n    defer cur.Close(ctx)\n    var result = make([]models.Document, 0)\n    for cur.Next(ctx) {\n        var currDoc models.Document\n        err := cur.Decode(&amp;currDoc)\n        if err != nil {\n            //log here\n            continue\n        }\n        result = append(result, currDoc)\n    }\n    return result, err\n}\n\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4233, "user_id": 1063653, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cfbfb15f60df712bdd013c4423a4774e?s=128&d=identicon&r=PG", "display_name": "Shadoweb", "link": "https://stackoverflow.com/users/1063653/shadoweb"}, "edited": false, "score": 0, "creation_date": 1593246350, "post_id": 59119371, "comment_id": 110716607, "body": "And how exactly can you export that CNX to another package?"}, {"owner": {"reputation": 207, "user_id": 7717578, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-0HbkmqP4BP0/AAAAAAAAAAI/AAAAAAAADmQ/1mMLv4bVaW4/photo.jpg?sz=128", "display_name": "Etienne Berube", "link": "https://stackoverflow.com/users/7717578/etienne-berube"}, "edited": false, "score": 0, "creation_date": 1612922520, "post_id": 59119371, "comment_id": 116916095, "body": "Every variable, function, interface or struct that starts with a capital is deemed public and is available to other packages. You just need to use it with the package name in front. For instance, if we assume the above code is in a package <code>db</code>, you can access it as <code>db.CNX</code>"}, {"owner": {"reputation": 103, "user_id": 7055315, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MLBi1.png?s=128&g=1", "display_name": "Illud", "link": "https://stackoverflow.com/users/7055315/illud"}, "reply_to_user": {"reputation": 4233, "user_id": 1063653, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cfbfb15f60df712bdd013c4423a4774e?s=128&d=identicon&r=PG", "display_name": "Shadoweb", "link": "https://stackoverflow.com/users/1063653/shadoweb"}, "edited": false, "score": 0, "creation_date": 1613014513, "post_id": 59119371, "comment_id": 116947534, "body": "@Shadoweb Hello, you just import this package or function example,            import myConnection &quot;yourDbConnectionPath&quot;      the i used like this      collection := myConnection.CNX.Database(&quot;tasks&quot;).Collection(&quot;task&quot;)"}], "tags": [], "owner": {"reputation": 103, "user_id": 7055315, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MLBi1.png?s=128&g=1", "display_name": "Illud", "link": "https://stackoverflow.com/users/7055315/illud"}, "is_accepted": false, "score": 1, "last_activity_date": 1575155070, "last_edit_date": 1575155070, "creation_date": 1575141117, "answer_id": 59119371, "question_id": 58365838, "link": "https://stackoverflow.com/questions/58365838/how-to-reuse-mongodb-connection-in-go/59119371#59119371", "title": "How to reuse MongoDB connection in Go", "body": "<p>I solved it doing this</p>\n\n<pre><code>var CNX = Connection()\nfunc Connection() *mongo.Client {\n    // Set client options\n    clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n\n    // Connect to MongoDB\n    client, err := mongo.Connect(context.TODO(), clientOptions)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Check the connection\n    err = client.Ping(context.TODO(), nil)\n\n    if err != nil {\n    log.Fatal(err)\n    }\n\n    fmt.Println(\"Connected to MongoDB!\")\n\n    return client\n  }\n\n//calll connection\n func main() {\n      collection := db.CNX.Database(\"tasks\").Collection(\"task\")\n }\n\noutput \"Connected to MongoDB!\"\n</code></pre>\n"}], "owner": {"reputation": 1623, "user_id": 3080315, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dca9f77ce600fbae2b1cd16df56dba3e?s=128&d=identicon&r=PG&f=1", "display_name": "jz22", "link": "https://stackoverflow.com/users/3080315/jz22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4564, "favorite_count": 3, "accepted_answer_id": 58366440, "answer_count": 2, "score": 6, "last_activity_date": 1598122697, "creation_date": 1570986167, "question_id": 58365838, "link": "https://stackoverflow.com/questions/58365838/how-to-reuse-mongodb-connection-in-go", "title": "How to reuse MongoDB connection in Go", "body": "<p>I would like to connect my server that was written in Go with a MongoDB but I'm not sure how to do it in an efficient way. A couple of examples I found implemented it like shown below.</p>\n\n<p><strong>libs/mongodb/client.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package mongodb\n\nimport (\n    \"context\"\n    \"log\"\n    \"project/keys\"\n\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\nfunc GetClient() *mongo.Database {\n    client, err := mongo.Connect(\n        context.Background(),\n        options.Client().ApplyURI(keys.GetKeys().MONGO_URI),\n    )\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return client.Database(keys.GetKeys().MONGO_DB_NAME)\n}\n</code></pre>\n\n<p><strong>services/user/findOne.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package userservices\n\nimport (\n    \"context\"\n    \"log\"\n    \"project/libs/mongodb\"\n    \"project/models\"\n\n    \"go.mongodb.org/mongo-driver/bson\"\n)\n\nfunc FindOne(filter bson.M) (models.User, error) {\n    var user models.User\n\n    collection := mongodb.GetClient().Collection(\"users\")\n    result := collection.FindOne(context.TODO(), filter)\n\n    if result.Err() != nil {\n        return user, result.Err()\n    }\n\n    if err := result.Decode(&amp;user); err != nil {\n        log.Println(\"Failed to decode user with error:\", err)\n        return user, err\n    }\n\n    return user, nil\n}\n</code></pre>\n\n<p>The <code>GetClient</code> function returns a database instance that is then used throughout the app. This seems to work, but I'm wondering if this really is best practice as it seems to create a new connection every time a new client is requested as shown in the second code snippet or is that assumption incorrect? I also thought about converting <code>GetClient</code> to a singleton, that always returns the same database instance but how would a lost connection be handled in that case? Thank you</p>\n"}, {"tags": ["git", "go", "versioning", "go-modules"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570997443, "post_id": 58364988, "comment_id": 103085031, "body": "Have you pushed tag <code>v1.4.0</code> to GitHub, or did you merely create it in your own local repository? (Note that <code>go list -m all</code> <i>does not</i> show <code>v1.4.0</code> available!)"}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1570997477, "post_id": 58364988, "comment_id": 103085037, "body": "First thing that comes to mind: git tag only shows local tags; are you sure you pushed v1.4.0 ? See also <a href=\"https://github.com/golang/go/wiki/Modules#daily-workflow\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules#daily-workflow</a>"}, {"owner": {"reputation": 35, "user_id": 12209979, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qsMsoyq4tXk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reB-dMsS9tTedukf3gG2tnpqwcwNA/photo.jpg?sz=128", "display_name": "Clavianus Juneardo", "link": "https://stackoverflow.com/users/12209979/clavianus-juneardo"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1571019081, "post_id": 58364988, "comment_id": 103088675, "body": "@torek yes i&#39;ve pushed tag v1.4.0, now I realize I need to wait about 20 minutes after the new tag released. is that normal?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1571019171, "post_id": 58364988, "comment_id": 103088687, "body": "I&#39;m not sure what&#39;s normal, as I have not actually started using Go modules yet."}, {"owner": {"reputation": 35, "user_id": 12209979, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qsMsoyq4tXk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reB-dMsS9tTedukf3gG2tnpqwcwNA/photo.jpg?sz=128", "display_name": "Clavianus Juneardo", "link": "https://stackoverflow.com/users/12209979/clavianus-juneardo"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1571019996, "post_id": 58364988, "comment_id": 103088819, "body": "@torek kay thanks!"}, {"owner": {"reputation": 35, "user_id": 12209979, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qsMsoyq4tXk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reB-dMsS9tTedukf3gG2tnpqwcwNA/photo.jpg?sz=128", "display_name": "Clavianus Juneardo", "link": "https://stackoverflow.com/users/12209979/clavianus-juneardo"}, "reply_to_user": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1571020035, "post_id": 58364988, "comment_id": 103088827, "body": "@marco.m yes i&#39;ve pushed it, thanks for the reading, gonna check it."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571040217, "post_id": 58364988, "comment_id": 103094278, "body": "It is pushed: <a href=\"https://github.com/ClavinJune/testng/tree/v1.4.0\" rel=\"nofollow noreferrer\">github.com/ClavinJune/testng/tree/v1.4.0</a> However, and I am not sure wether that matters, but note the camel case in the owner name. Never had that before."}, {"owner": {"reputation": 35, "user_id": 12209979, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qsMsoyq4tXk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reB-dMsS9tTedukf3gG2tnpqwcwNA/photo.jpg?sz=128", "display_name": "Clavianus Juneardo", "link": "https://stackoverflow.com/users/12209979/clavianus-juneardo"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1571054012, "post_id": 58364988, "comment_id": 103101271, "body": "@MarkusWMahlberg the I think the github username is case insensitive, because I&#39;ve tried with the exact username too and it still not works."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": true, "score": 0, "last_activity_date": 1584041839, "creation_date": 1584041839, "answer_id": 60660853, "question_id": 58364988, "link": "https://stackoverflow.com/questions/58364988/go-module-not-downloading-latest-minor-version/60660853#60660853", "title": "Go Module Not Downloading Latest Minor Version", "body": "<p>If you are using the default public proxy (<code>proxy.golang.org</code>), it has a cache on the mapping from <code>latest</code> to a specific version.</p>\n\n<p>If you want to fetch a specific version, you can either pass that version explicitly to <code>go get</code>:</p>\n\n<pre><code>go get -d github.com/clavinjune/testng@v1.4.0\n</code></pre>\n\n<p>or temporarily set <code>GONOPROXY</code> to bypass the cache:</p>\n\n<pre><code>GONOPROXY=github.com/clavinjune go get -d github.com/clavinjune/testng@latest\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 12209979, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qsMsoyq4tXk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reB-dMsS9tTedukf3gG2tnpqwcwNA/photo.jpg?sz=128", "display_name": "Clavianus Juneardo", "link": "https://stackoverflow.com/users/12209979/clavianus-juneardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 985, "favorite_count": 1, "accepted_answer_id": 60660853, "answer_count": 1, "score": 0, "last_activity_date": 1584041839, "creation_date": 1570980232, "last_edit_date": 1570997171, "question_id": 58364988, "link": "https://stackoverflow.com/questions/58364988/go-module-not-downloading-latest-minor-version", "title": "Go Module Not Downloading Latest Minor Version", "body": "<p>I am using <code>go version 1.13.1</code>, and now I cannot update my dependecy module to the latest minor version using <code>go mod</code>, I made simple repo for learning dependency management on <code>github.com/clavinjune/testng</code> and made a project that depends on it called <code>moduser</code>.</p>\n\n<p>The latest minor version of <code>testng</code> is <code>v1.4.0</code></p>\n\n<pre><code>\u250c\u2500[ ~/Public/testng ]\u2500[ git:master ]\n\u2514\u2500[ 22:09:19 ] $ git tag -l\nv1.0.0\nv1.1.0\nv1.2.0\nv1.3.0\nv1.4.0\n</code></pre>\n\n<p>and <code>moduser</code> still using <code>v1.3.0</code></p>\n\n<pre><code>\u250c\u2500[ ~/Public/moduser ]\n\u2514\u2500[ 22:09:06 ] $ go list -m all\nmoduser\ngithub.com/clavinjune/testng v1.3.0\n</code></pre>\n\n<p>when I want to update the dependency I run this command</p>\n\n<pre><code>\u250c\u2500[ ~/Public/moduser ]\n\u2514\u2500[ 22:20:17 ] $ go get -v -u github.com/clavinjune/testng\n\u250c\u2500[ ~/Public/moduser ]\n\u2514\u2500[ 22:20:28 ] $ go get -v -u github.com/clavinjune/testng@latest\n</code></pre>\n\n<p>But it doesn't downloading the <code>v1.4.0</code>.</p>\n\n<p>Is there any wrong command that I run ?</p>\n"}, {"tags": ["android", "go", "rsa"], "comments": [{"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 0, "creation_date": 1570973421, "post_id": 58363906, "comment_id": 103078979, "body": "Your first go snippet looks ok.  Can you post the public.pem file so we can check.  Have you verified that in your Java <code>keyBytes</code> is not empty?"}, {"owner": {"reputation": 41, "user_id": 12209477, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--hwb6Qto7Yc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjdK2fZQ11y64BPrENB-wIsaI4pA/photo.jpg?sz=128", "display_name": "Elisabetta Angelo", "link": "https://stackoverflow.com/users/12209477/elisabetta-angelo"}, "reply_to_user": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 0, "creation_date": 1571206993, "post_id": 58363906, "comment_id": 103157961, "body": "i check keyBytes but it&#39;s not empty"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 12209477, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--hwb6Qto7Yc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjdK2fZQ11y64BPrENB-wIsaI4pA/photo.jpg?sz=128", "display_name": "Elisabetta Angelo", "link": "https://stackoverflow.com/users/12209477/elisabetta-angelo"}, "is_accepted": true, "score": 2, "last_activity_date": 1571208530, "creation_date": 1571208530, "answer_id": 58407294, "question_id": 58363906, "link": "https://stackoverflow.com/questions/58363906/use-rsa-between-android-and-go/58407294#58407294", "title": "Use RSA between android and go", "body": "<p>I fix it !</p>\n\n<p>I generate public and private key with this Go code :</p>\n\n<pre><code>/*\n * Genarate rsa keys.\n*/\n\npackage main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/gob\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    reader := rand.Reader\n    bitSize := 2048\n\n    key, err := rsa.GenerateKey(reader, bitSize)\n    checkError(err)\n\n    publicKey := key.PublicKey\n\n    saveGobKey(\"private.key\", key)\n    savePEMKey(\"private.pem\", key)\n\n    saveGobKey(\"public.key\", publicKey)\n    savePublicPEMKey(\"public.pem\", publicKey)\n}\n\nfunc saveGobKey(fileName string, key interface{}) {\n    outFile, err := os.Create(fileName)\n    checkError(err)\n    defer outFile.Close()\n\n    encoder := gob.NewEncoder(outFile)\n    err = encoder.Encode(key)\n    checkError(err)\n}\n\nfunc savePEMKey(fileName string, key *rsa.PrivateKey) {\n    outFile, err := os.Create(fileName)\n    checkError(err)\n    defer outFile.Close()\n\n    var privateKey = &amp;pem.Block{\n        Type:  \"PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }\n\n    err = pem.Encode(outFile, privateKey)\n    checkError(err)\n}\n\nfunc savePublicPEMKey(fileName string, pubkey rsa.PublicKey) {\n    asn1Bytes, err := x509.MarshalPKIXPublicKey(&amp;pubkey)\n    checkError(err)\n\n    var pemkey = &amp;pem.Block{\n        Type:  \"PUBLIC KEY\",\n        Bytes: asn1Bytes,\n    }\n\n    pemfile, err := os.Create(fileName)\n    checkError(err)\n    defer pemfile.Close()\n\n    err = pem.Encode(pemfile, pemkey)\n    checkError(err)\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        fmt.Println(\"Fatal error \", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>and then i encrypt my message in android with generated public key in GO:</p>\n\n<pre><code>static PublicKey serveruk;\n\n\npublic final static String chi=\"RSA/ECB/OAEPPadding\";\n\npublic final static String RSA = \"RSA\";\n\nprivate final static int CRYPTO_BITS = 512;\n\n\nString pubPEM = \"public key from public.pem\";\n\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n\n    stringToPublicKeytoserver(pubPEM);\n    Log.e(\"ENCODED\", enc4golang(\"Please hide me !\"));\n\n}\n\n\npublic static PublicKey stringToPublicKeytoserver(String publicKeyString)\n{\n    try {\n        publicKeyString = publicKeyString.replace(\"-----BEGIN PUBLIC KEY-----\", \"\");\n        publicKeyString = publicKeyString.replace(\"-----END PUBLIC KEY-----\", \"\");\n        byte[] keyBytes = Base64.decode(publicKeyString, Base64.DEFAULT);\n        X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);\n        KeyFactory keyFactory = KeyFactory.getInstance(RSA);\n        serveruk=keyFactory.generatePublic(spec);\n        return serveruk;\n    } catch (NoSuchAlgorithmException | InvalidKeySpecException e) {\n        e.printStackTrace();\n        return null;\n    }\n}\n\n\nprivate static byte[] enc4golang(String text, PublicKey pubRSA) throws Exception{\n    Cipher cipher = Cipher.getInstance(chi);\n    cipher.init(Cipher.ENCRYPT_MODE, pubRSA);\n    return cipher.doFinal(text.getBytes(\"UTF-8\")); //i also advice you to use: .getBytes(\"UTF-8\"); instead of data.getBytes();\n}\n\n\npublic final static String enc4golang(String text){\n    try {\n        return Base64.encodeToString(enc4golang(text, serveruk) ,Base64.DEFAULT);  //send this string to golang\n    }\n    catch(Exception e)\n    {\n        e.printStackTrace();\n    }\n    return null;\n}\n</code></pre>\n\n<p>and then i decrypt it with this GO code:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/sha1\"\n    \"crypto/x509\"\n    \"encoding/base64\"\n    \"encoding/pem\"\n)\n\nfunc main(){\n\n    const priPEM = `private key from private.pem`\n\n    const pubPEM = `public key from public.pem`\n\n    base64DecodeBytes, err := base64.StdEncoding.DecodeString(\"encrypted data from android\")\n    if err != nil {\n        panic(err)\n    }\n    privateKeyBlock, _ := pem.Decode([]byte(priPEM))\n    var pri *rsa.PrivateKey\n    pri, parseErr := x509.ParsePKCS1PrivateKey(privateKeyBlock.Bytes)\n    if parseErr != nil {\n        panic(parseErr)\n    }\n    decryptedData, decryptErr := rsa.DecryptOAEP(sha1.New(), rand.Reader, pri, base64DecodeBytes, nil)\n    if decryptErr != nil {\n        panic(decryptErr)\n    }\n\n    print(string(decryptedData))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 12209477, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--hwb6Qto7Yc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcjdK2fZQ11y64BPrENB-wIsaI4pA/photo.jpg?sz=128", "display_name": "Elisabetta Angelo", "link": "https://stackoverflow.com/users/12209477/elisabetta-angelo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1993, "favorite_count": 0, "accepted_answer_id": 58407294, "answer_count": 1, "score": 2, "last_activity_date": 1571208530, "creation_date": 1570972362, "last_edit_date": 1571206850, "question_id": 58363906, "link": "https://stackoverflow.com/questions/58363906/use-rsa-between-android-and-go", "title": "Use RSA between android and go", "body": "<p>In a chat project with go and android, I want to use RSA for encryption</p>\n\n<p>I found solution in <a href=\"https://stackoverflow.com/questions/54306500/how-to-use-rsa-between-go-and-android\">this question</a>, and work find, but i need to change private and public key for each user !</p>\n\n<p>How can i create private and public key in go for sending to android ?</p>\n\n<p>I try many ways but in android give error when i want parse public key\nAndroid</p>\n\n<pre><code>    public static PublicKey stringToPublicKeytoserver(String publicKeyString)\n    {\n        try {\n            publicKeyString = publicKeyString.replace(\"-----BEGIN PUBLIC KEY-----\", \"\");\n            publicKeyString = publicKeyString.replace(\"-----END PUBLIC KEY-----\", \"\");\n            byte[] keyBytes = Base64.decode(publicKeyString, Base64.DEFAULT);\n            X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);\n            KeyFactory keyFactory = KeyFactory.getInstance(RSA);\n            serveruk=keyFactory.generatePublic(spec);\n            return serveruk;\n        } catch (NoSuchAlgorithmException | InvalidKeySpecException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n</code></pre>\n\n<p>Android Error</p>\n\n<blockquote>\n  <p>java.security.spec.InvalidKeySpecException: com.android.org.conscrypt.OpenSSLX509CertificateFactory$ParsingException: Error parsing public key</p>\n</blockquote>\n\n<p>Key Generation</p>\n\n<pre><code>   // Generate RSA Keys\n   miryanPrivateKey, err := rsa.GenerateKey(rand.Reader, 1024)\n   fatal(err)\n\n\n   // save PEM file\n   pemfile, err := os.Create(\"public.pem\")\n\n   if err != nil {\n       fmt.Println(err)\n       os.Exit(1)\n   }\n\n   //publi := &amp;miryanPrivateKey.PublicKey\n\n   // http://golang.org/pkg/encoding/pem/#Block\n\n   var pemkey = &amp;pem.Block{\n       Type : \"PUBLIC KEY\",\n       Bytes : x509.MarshalPKCS1PublicKey(&amp;miryanPrivateKey.PublicKey)}\n\n   err = pem.Encode(pemfile, pemkey)\n\n   if err != nil {\n       fmt.Println(err)\n       os.Exit(1)\n   }\n\n   pemfile.Close()\n   //and even i use function to convert toPKCS8\n   byt, _:= MarshalPKCS8PublicKey(&amp;miryanPrivateKey.PublicKey)\n\n   var pemkey = &amp;pem.Block{\n       Type : \"PUBLIC KEY\",\n       Bytes : byt}\n\n   func MarshalPKCS8PublicKey(key *rsa.PublicKey) ([]byte, error) {\n   var pkey PKCS8Key\n   pkey.Version = 0\n   pkey.PrivateKeyAlgorithm = make([]asn1.ObjectIdentifier, 1)\n   pkey.PrivateKeyAlgorithm[0] = asn1.ObjectIdentifier{1, 2, 840, 113549, 1, 1, 1}\n   pkey.PrivateKey = x509.MarshalPKCS1PublicKey(key)\n   return asn1.Marshal(pkey)\n}\n</code></pre>\n\n<p>i think my main problem is, go use pkcs1 but android use pkcs8</p>\n\n<p>public.pem</p>\n\n<pre><code>-----BEGIN PUBLIC KEY-----\nMIGfAgEAMAsGCSqGSIb3DQEBAQSBjDCBiQKBgQDh1jHGdbo/QLeA1y5lC2YSSoal\nhPBLWxz7OYpNj5pZDcuqrJFfhEvv1CGvBR0bKB/3hTpUYAPiswI+OH2BcHks0+Ef\nN/KZYjPQQsB1gJByENTPvdQwlDIJVW8cDhij7jMMwq/TOs+ijudCUojcfvkJ5Zvf\nBJB6g0ucg580W98K4wIDAQAB\n-----END PUBLIC KEY-----\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": true, "score": 1, "last_activity_date": 1570975439, "last_edit_date": 1570975439, "creation_date": 1570974629, "answer_id": 58364193, "question_id": 58363773, "link": "https://stackoverflow.com/questions/58363773/float64-with-two-decimals/58364193#58364193", "title": "Float64 with two decimals", "body": "<p>If you just need to accept a float 64 value for your inputs, you can simply use <code>%f</code>, or <code>%g</code> to set your values.  The default precision is 6.</p>\n\n<p>If you need greater precision and error handling, it may be more robust to bring your inputs in as strings, then parse and process them as you require.</p>\n\n<p>Run the code below to see the inputs are both float64.  The first will be output with a precision of 2, the second will be output with the default precision.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nconst menu string = \"Calculator v1.0:\\n\\t1.a+b\\n\\t2.a-b\\n\\t3.a*b\\n\\t4.a/b\\nSelect an option:\"\n\nfunc main() {\n    var option int\n    var firstNumber float64\n    var secondNumber float64\n\n    fmt.Println(menu)\n    fmt.Scanf(\"%d\", &amp;option)\n\n    fmt.Println(\"First number:\")\n    fmt.Scanf(\"%f\", &amp;firstNumber)\n    fmt.Println(\"Second number:\")\n    fmt.Scanf(\"%g\", &amp;secondNumber)\n\n    fmt.Printf(\"Input Type: %T, FirstNumber: %.2f\\n\", firstNumber, firstNumber)\n    fmt.Printf(\"Input Type 2: %T, SecondNumber: %f\\n\", secondNumber, secondNumber)\n\n    if option == 1 {\n        println(sum(firstNumber, secondNumber))\n    } else if option == 2 {\n        println(subtract(firstNumber, secondNumber))\n    } else if option == 3 {\n        println(multiply(firstNumber, secondNumber))\n    } else if option == 4 {\n        println(divide(firstNumber, secondNumber))\n    }\n\n}\n\nfunc sum(a float64, b float64) float64 {\n    return a + b\n}\nfunc subtract(a float64, b float64) float64 {\n    return a - b\n}\nfunc multiply(a float64, b float64) float64 {\n    return a * b\n}\nfunc divide(a float64, b float64) float64 {\n    return a / b\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10408704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 58364193, "answer_count": 1, "score": -1, "last_activity_date": 1570975439, "creation_date": 1570971377, "question_id": 58363773, "link": "https://stackoverflow.com/questions/58363773/float64-with-two-decimals", "title": "Float64 with two decimals", "body": "<p>I am new at this. I am trying to make a calculator that receives two numbers of type <code>float64</code> but then I want to put the result of two decimals. I have been reading that it is with <code>\"%.2f\"</code> but it does not take well the result in <code>fmt.Scanf</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nconst menu string = \"Calculator v1.0:\\n\\t1.a+b\\n\\t2.a-b\\n\\t3.a*b\\n\\t4.a/b\\nSelect an option:\"\n\nfunc main() {\n    var option int\n    var firstNumber float64\n    var secondNumber float64\n\n    fmt.Println(menu)\n    fmt.Scanf(\"%d\", &amp;option)\n\n    fmt.Println(\"First number:\")\n    fmt.Scanf(\"%.2f\", &amp;firstNumber)\n    fmt.Println(\"Second number:\")\n    fmt.Scanf(\"%.2f\", &amp;secondNumber)\n\n    if option == 1 {\n        println(sum(firstNumber, secondNumber))\n    } else if option == 2 {\n        println(subtract(firstNumber, secondNumber))\n    } else if option == 3 {\n        println(multiply(firstNumber, secondNumber))\n    } else if option == 4 {\n        println(divide(firstNumber, secondNumber))\n    }\n\n}\n\nfunc sum(a float64, b float64) float64 {\n    return a + b\n}\nfunc subtract(a float64, b float64) float64 {\n    return a - b\n}\nfunc multiply(a float64, b float64) float64 {\n    return a * b\n}\nfunc divide(a float64, b float64) float64 {\n    return a / b\n}\n\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 2, "last_activity_date": 1570959017, "creation_date": 1570959017, "answer_id": 58362251, "question_id": 58361961, "link": "https://stackoverflow.com/questions/58361961/how-to-convert-byte-to-c-hex-format-0x/58362251#58362251", "title": "How to convert []byte to C hex format 0x...?", "body": "<p>I couldn't find any function in the <code>hex</code> module that would achieve what you want. However, we can use a custom buffer to write in our desired format.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    originalBytes := []byte(\"go\")\n\n    result := make([]byte, 4*len(originalBytes))\n\n    buff := bytes.NewBuffer(result)\n\n    for _, b := range originalBytes {\n        fmt.Fprintf(buff, \"0x%02x \", b)\n    }\n\n    fmt.Println(buff.String())\n\n}\n\n</code></pre>\n\n<p>Runnable example: <a href=\"https://goplay.space/#fyhDJ094GgZ\" rel=\"nofollow noreferrer\">https://goplay.space/#fyhDJ094GgZ</a></p>\n"}, {"comments": [{"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570979259, "post_id": 58363519, "comment_id": 103080256, "body": "Thanks for the nuanced answer. I like your approach."}, {"owner": {"user_type": "does_not_exist", "display_name": "user12206905"}, "reply_to_user": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 1, "creation_date": 1570985244, "post_id": 58363519, "comment_id": 103081833, "body": "The strings.Builder vs bytes.Buffer thing is nuance.  Everything else is about correctness."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12206905"}, "is_accepted": false, "score": 1, "last_activity_date": 1570969704, "last_edit_date": 1570969704, "creation_date": 1570969308, "answer_id": 58363519, "question_id": 58361961, "link": "https://stackoverflow.com/questions/58361961/how-to-convert-byte-to-c-hex-format-0x/58363519#58363519", "title": "How to convert []byte to C hex format 0x...?", "body": "<p>Here's a solution that produces the result as specified in the question.  Specifically, there's a \", \" between each byte and no trailing space.  </p>\n\n<pre><code>p := []byte(\"go\")\n\nvar buf strings.Builder\nif len(p) &gt; 0 {\n    buf.Grow(len(p)*6 - 2)\n    for i, b := range p {\n        if i &gt; 0 {\n            buf.WriteString(\", \")\n        }\n        fmt.Fprintf(&amp;buf, \"0x%02x\", b)\n    }\n}\nresult := buf.String()\n</code></pre>\n\n<p>The <a href=\"https://godoc.org/strings#Builder\" rel=\"nofollow noreferrer\">strings.Builder</a> type is used to avoid allocating memory on the final conversion to a string. Another answer uses bytes.Buffer that does allocate memory at this step.</p>\n\n<p>The the builder is initially sized large enough to hold the representation of each byte and the separators. Another answer ignores the size of the separators.</p>\n\n<p><a href=\"https://play.golang.org/p/QEzh2YI9tGW\" rel=\"nofollow noreferrer\">Try this on the Go playground</a>. </p>\n"}], "owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 58362251, "answer_count": 2, "score": 2, "last_activity_date": 1570969704, "creation_date": 1570956637, "question_id": 58361961, "link": "https://stackoverflow.com/questions/58361961/how-to-convert-byte-to-c-hex-format-0x", "title": "How to convert []byte to C hex format 0x...?", "body": "<pre><code>\nfunc main() {\n    str := hex.EncodeToString([]byte(\"go\"))\n    fmt.Println(str)\n}\n</code></pre>\n\n<p>this code return <code>676f</code>. How I can print C-like <code>0x67, 0x6f</code> ?</p>\n"}, {"tags": ["vue.js", "go", "routes", "vue-router", "vue-cli"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570959813, "post_id": 58362100, "comment_id": 103076182, "body": "<code>If possible, don&#39;t serve the front end from within the Go app.</code> why ?"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1570978354, "post_id": 58362100, "comment_id": 103080062, "body": "Static content should served through a CDN or at least through nginx directly. Because nginx or a CDN would be more performant than a Go app. I don&#39;t want my Go functions executing for serving a simple css file."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 0, "last_activity_date": 1570957912, "creation_date": 1570957912, "answer_id": 58362100, "question_id": 58361672, "link": "https://stackoverflow.com/questions/58361672/how-to-use-both-vue-router-and-gorilla-mux-router/58362100#58362100", "title": "How to use both Vue-Router and Gorilla Mux Router", "body": "<p>If possible, don't serve the front end from within the Go app. Here's what I do: </p>\n\n<p>Go app is the backend, provides RESTful APIs for the front end to use.</p>\n\n<p>There's a nginx server setup as a reverse proxy for the Go app.</p>\n\n<p>nginx serves the front end directly</p>\n\n<p>I use nginx to serve the Go    backend in a certain url location or different port</p>\n"}], "owner": {"reputation": 87, "user_id": 7481952, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f30cc05a464bf342defbeab273f47009?s=128&d=identicon&r=PG&f=1", "display_name": "Pramod", "link": "https://stackoverflow.com/users/7481952/pramod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597951983, "creation_date": 1570954002, "last_edit_date": 1597951983, "question_id": 58361672, "link": "https://stackoverflow.com/questions/58361672/how-to-use-both-vue-router-and-gorilla-mux-router", "title": "How to use both Vue-Router and Gorilla Mux Router", "body": "<p>I started to create a web app using Vue JS as the front end framework. In this process, I'm using Vue-Router to route paths to my vue components. And I'm serving this web app using Go with gorilla mux as my router.</p>\n\n<p>Here I am not able to load any component to <code>&lt;router-view&gt;&lt;/router-view&gt;</code> in <code>App.vue</code>.</p>\n\n<p>I found a similar question <a href=\"https://stackoverflow.com/questions/46144883/vue-router-in-production-serving-with-go\">here</a>. And I tried removing <code>mode: 'history'</code> but no luck. In the comments, it was mentioned that he let Go redirect all not-found URLs to <code>/# + r.URL.Path</code>. I didn't understand this bit. </p>\n\n<p>I'll appreciate if anyone can guide me with some example.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570947947, "post_id": 58361020, "comment_id": 103074063, "body": "What&#39;s your question?"}, {"owner": {"reputation": 37, "user_id": 12208339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871652cb57680ee3eaba5bab7e8e02b1?s=128&d=identicon&r=PG&f=1", "display_name": "doraqwe", "link": "https://stackoverflow.com/users/12208339/doraqwe"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570948235, "post_id": 58361020, "comment_id": 103074121, "body": "@Peter I want the <code>cmd</code> command as declared in the code above, to run every one minute, and the output of the command to be accessible on <code>http:&#47;&#47;localhost:8080&#47;feed</code>. How do I go about doing that?"}], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 37, "user_id": 12208339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871652cb57680ee3eaba5bab7e8e02b1?s=128&d=identicon&r=PG&f=1", "display_name": "doraqwe", "link": "https://stackoverflow.com/users/12208339/doraqwe"}, "edited": false, "score": 0, "creation_date": 1570950860, "post_id": 58361303, "comment_id": 103074546, "body": "@doraqwe I have updated the answer accordingly: don&#39;t serve directly the output. Serve a file in which you periodically write the output."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571058863, "post_id": 58361303, "comment_id": 103103839, "body": "Unless the output is too big to keep in memory, getting the filesystem involved just slows the whole thing down."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571059117, "post_id": 58361303, "comment_id": 103103985, "body": "@Adrian There is no obvious performance issue here, and that keeps the all system more resilient to stop/restart events: it can read and publish the last recorded command output (as written in the file)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571059609, "post_id": 58361303, "comment_id": 103104288, "body": "Not particularly, since it&#39;s producing its own data, it can do so immediately on startup. Also, not all applications would prefer to serve stale content - what if that file is half an hour old when the app starts?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1571059773, "post_id": 58361303, "comment_id": 103104373, "body": "@Adrian It is a log with a timestamp in its message: if it is an hour old, you will see it right away."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": -1, "last_activity_date": 1570950825, "last_edit_date": 1570950825, "creation_date": 1570950135, "answer_id": 58361303, "question_id": 58361020, "link": "https://stackoverflow.com/questions/58361020/exec-command-every-one-minute-and-serve-the-output-via-http/58361303#58361303", "title": "exec command every one minute and serve the output via http", "body": "<p>You could:</p>\n\n<ul>\n<li>write the last command instance (the \"<code>string(out)</code>\") to a log file: see \"<a href=\"https://stackoverflow.com/q/19965795/6309\">Go/Golang write log to file</a>\"</li>\n<li>serve that log file (and only the file) in a Go http server: see \"<a href=\"https://stackoverflow.com/q/51275875/6309\">How to serve a file to a specific URL path with the <code>FileServer</code> function in go/golang</a>\"</li>\n</ul>\n\n<p>That way, any time you go to your server, you will get the last command output.</p>\n\n<blockquote>\n  <p>How do I make it cache(?) the output of the command for one minute, and then run the command again only after the cache time is expired?</p>\n</blockquote>\n\n<p>By keeping the execution of the command <em>separate</em> from the command output being served.</p>\n\n<p>That is why you must kept the two asynchronous, typically through a goroutine, a a <a href=\"http://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\"><code>time.NewTicker</code></a>.<br>\nSee \"<a href=\"https://stackoverflow.com/a/16466581/6309\">Is there a way to do repetitive tasks at intervals?</a>\"</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1570958558, "post_id": 58361536, "comment_id": 103075884, "body": "you should not be locking during command exec, but only during variable assignments.."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570959133, "post_id": 58361536, "comment_id": 103076021, "body": "it is pointless to assign content to <code>err.Error()</code>, if the program fails during execution for internal logical reason, the returned go error will contain something about the exit code being != 0, and all the interesting information located in the command output will be lost. This assignment is useful only if the binary can not be started at all."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570959312, "post_id": 58361536, "comment_id": 103076065, "body": "it is a little weird to use output both as a function parameter and a package variable."}, {"owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570961053, "post_id": 58361536, "comment_id": 103076408, "body": "Sure, that are things that can be improved"}, {"owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570963532, "post_id": 58361536, "comment_id": 103076918, "body": "@mh-cbon It depends who will use output of the script. I assumed in this example, that they would be interested in error if it occurs (ex: you have web interface for process customized by user  input)"}, {"owner": {"reputation": 37, "user_id": 12208339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871652cb57680ee3eaba5bab7e8e02b1?s=128&d=identicon&r=PG&f=1", "display_name": "doraqwe", "link": "https://stackoverflow.com/users/12208339/doraqwe"}, "edited": false, "score": 0, "creation_date": 1571020568, "post_id": 58361536, "comment_id": 103088883, "body": "@igr The updated code doesn&#39;t work. I get the following error : <code>.\\test.go:21:19: undefined: output .\\test.go:23:39: undefined: output</code> which are these lines - <code>go updateResult(output)    http.HandleFunc(&quot;&#47;feed&quot;, initHandle(output)</code>"}, {"owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "reply_to_user": {"reputation": 37, "user_id": 12208339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871652cb57680ee3eaba5bab7e8e02b1?s=128&d=identicon&r=PG&f=1", "display_name": "doraqwe", "link": "https://stackoverflow.com/users/12208339/doraqwe"}, "edited": false, "score": 0, "creation_date": 1571068520, "post_id": 58361536, "comment_id": 103108911, "body": "@doraqwe it should be fixed now"}], "tags": [], "owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "is_accepted": true, "score": 1, "last_activity_date": 1571067743, "last_edit_date": 1571067743, "creation_date": 1570952706, "answer_id": 58361536, "question_id": 58361020, "link": "https://stackoverflow.com/questions/58361020/exec-command-every-one-minute-and-serve-the-output-via-http/58361536#58361536", "title": "exec command every one minute and serve the output via http", "body": "<p>If output is not too big, you can keep it in memory variable. \nI took approach to wait for result in case that script is executed (using mutex): </p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n  \"os/exec\"\n  \"sync\"\n  \"time\"\n)   \n\nvar LoopDelay = 60*time.Second\n\ntype Output struct {\n  sync.Mutex\n  content string\n}   \n\n\nfunc main() {\n\n  var output *Output = new(Output)\n\n  go updateResult(output)\n\n  http.HandleFunc(\"/feed\", initHandle(output))\n  err := http.ListenAndServe(\":8080\", nil)\n  if err != nil {\n    fmt.Println(\"ERROR\", err)\n  }   \n}   \n\nfunc initHandle(output *Output) func(http.ResponseWriter, *http.Request) {\n  return func(respw http.ResponseWriter, req *http.Request) {\n    output.Lock()\n    defer output.Unlock()\n    _, err := respw.Write([]byte(output.content))\n    if err != nil {\n        fmt.Println(\"ERROR: Unable to write response: \", err)\n    }\n  }\n}\n\nfunc updateResult(output *Output) {\n  var execFn = func() { /* Extracted so that 'defer' executes at the end of loop iteration */\n    output.Lock()\n    defer output.Unlock()\n    command := exec.Command(\"bash\", \"-c\", \"date | nl \")\n    output1, err := command.CombinedOutput()\n    if err != nil {\n      output.content = err.Error()\n    } else {\n      output.content = string(output1)\n    }   \n\n  }   \n  for {\n    execFn()\n    time.Sleep(LoopDelay)\n  }\n}\n</code></pre>\n\n<p>Executing </p>\n\n<pre><code>date; curl http://localhost:8080/feed\n</code></pre>\n\n<p>gives output (on multiple calls): </p>\n\n<pre><code> 1  dimanche 13 octobre 2019, 09:41:40 (UTC+0200)\nhttp-server-cmd-output&gt; date; curl http://localhost:8080/feed\n\ndimanche 13 octobre 2019, 09:42:05 (UTC+0200)\n 1  dimanche 13 octobre 2019, 09:41:40 (UTC+0200)\n</code></pre>\n\n<p>Few things to consider: <br>\n- Used 'date | nl' as command with pipe example <br>\n- If output too big, write to file <br>\n- Very likely it is good idea to keep mutex only for content <strong>update</strong> (no need to wait during script execution) - you can try to improve it <br>\n- Go routine may have variable (channel) to exit on signal (ex: when program ends) <br></p>\n\n<p>EDIT: variable moved to main function</p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1571131355, "last_edit_date": 1571131355, "creation_date": 1570958700, "answer_id": 58362194, "question_id": 58361020, "link": "https://stackoverflow.com/questions/58361020/exec-command-every-one-minute-and-serve-the-output-via-http/58362194#58362194", "title": "exec command every one minute and serve the output via http", "body": "<blockquote>\n  <p>How do I make it cache(?) the output of the command for one minute,\n  and then run the command again only after the cache time is expired?</p>\n</blockquote>\n\n<p>In below solution two goroutines are declared. </p>\n\n<ul>\n<li>First goroutine loop until the context is done to execute the command at regular interval and send a copy to the second go routine.</li>\n<li>The second routine, tries to get from the first goroutine, or distribute its value to other goroutines.</li>\n<li>The http handler, third goroutine, only queries the value from the getter and does something with it.</li>\n</ul>\n\n<p>The reason to use three routines instead of two in this example is to prevent blocking the http routines if the command is being executed. With that additional routines, http requests only wait for the synchronization to occur.</p>\n\n<p><code>type state</code> is a dummy struct to transport the values within channels.</p>\n\n<p>We prevent race conditions because of two facts, the state is passed by value, <code>cmd.Output()</code> allocates a new buffer each time it runs.</p>\n\n<p>To retrieve original command in the http handler, OP should build a custom error type and attach those information to the recorded error, within the http handler, OP should type assert the error to its custom type and get the specific details from there.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os/exec\"\n    \"time\"\n)\n\ntype state struct {\n    out []byte\n    err error\n}\n\nfunc main() {\n\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    set := make(chan state, 1)\n    go func() {\n        ticker := time.NewTicker(2 * time.Second)\n        cmd := []string{\"date\"}\n        s := state{}\n        s.out, s.err = exec.Command(cmd[0], cmd[1:]...).Output()\n        set &lt;- s\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case &lt;-ticker.C:\n                s.out, s.err = exec.Command(cmd[0], cmd[1:]...).Output()\n                set &lt;- s\n            }\n        }\n    }()\n\n    get := make(chan state)\n    go func() {\n        s := state{}\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case s = &lt;-set: // get the fresh value, if any\n            case get &lt;- s: // distribute your copy\n            }\n        }\n    }()\n\n    http.HandleFunc(\"/feed\", func(w http.ResponseWriter, r *http.Request) {\n        state := &lt;-get\n        if state.err != nil {\n            fmt.Printf(\"Failed to execute command: %v\", state.err)\n        }\n        fmt.Fprintf(w, string(state.out))\n    })\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 12208339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/871652cb57680ee3eaba5bab7e8e02b1?s=128&d=identicon&r=PG&f=1", "display_name": "doraqwe", "link": "https://stackoverflow.com/users/12208339/doraqwe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 1, "accepted_answer_id": 58361536, "answer_count": 3, "score": 1, "last_activity_date": 1571131355, "creation_date": 1570946928, "last_edit_date": 1570950516, "question_id": 58361020, "link": "https://stackoverflow.com/questions/58361020/exec-command-every-one-minute-and-serve-the-output-via-http", "title": "exec command every one minute and serve the output via http", "body": "<p>I want to run a command in the Bash shell every one minute, and serve the output via http, on <a href=\"http://localhost:8080/feed\" rel=\"nofollow noreferrer\">http://localhost:8080/feed</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := `&lt;a piped command&gt;`\n    out, err := exec.Command(\"bash\", \"-c\", cmd).Output()\n    if err != nil {\n        fmt.Sprintf(\"Failed to execute command: %s\", cmd)\n    }\n    fmt.Println(string(out))\n}\n</code></pre>\n\n<p><strong>UPDATE :</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os/exec\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    cmd := `&lt;a piped command&gt;`\n    out, err := exec.Command(\"bash\", \"-c\", cmd).Output()\n    if err != nil {\n        fmt.Sprintf(\"Failed to execute command: %s\", cmd)\n    }\n    fmt.Fprintf(w, string(out))\n}\n\nfunc main() {\n    http.HandleFunc(\"/feed\", handler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>With the above code, the command is run every time <a href=\"http://localhost:8080/feed\" rel=\"nofollow noreferrer\">http://localhost:8080/feed</a> is accessed. How do I make it cache(?) the output of the command for one minute, and then run the command again only after the cache time is expired?</p>\n"}, {"tags": ["go", "client", "http2"], "comments": [{"owner": {"reputation": 9307, "user_id": 705086, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fbeee3d76a35f9de8847f36ee51c28a2?s=128&d=identicon&r=PG", "display_name": "Dima Tisnek", "link": "https://stackoverflow.com/users/705086/dima-tisnek"}, "edited": false, "score": 0, "creation_date": 1586153107, "post_id": 58360811, "comment_id": 108011825, "body": "I&#39;m thinking to reuse this question for generic &quot;golang: I want to control HTTP/2 connection&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "edited": false, "score": 0, "creation_date": 1570962591, "post_id": 58362351, "comment_id": 103076700, "body": "Thanks for clarification. Just curious, if I want to close the connection after every request for HTTP/2, what can be done? Go wouldn&#39;t allow that at all?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "edited": false, "score": 0, "creation_date": 1570963033, "post_id": 58362351, "comment_id": 103076797, "body": "you can try <a href=\"https://github.com/golang/net/blob/master/http2/transport.go#L475\" rel=\"nofollow noreferrer\">github.com/golang/net/blob/master/http2/transport.go#L475</a> but really http/2 is different from http/1.1. what you ask somehow defeats its purpose."}, {"owner": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "edited": false, "score": 0, "creation_date": 1570963367, "post_id": 58362351, "comment_id": 103076870, "body": "Thanks a lot! this seems to work. Agreed, that this would defeat the purpose but adding Header &lt;Connection:close&gt; in http2 server handler does do the work, so I think it should have worked for client as well. Ref: <a href=\"https://github.com/golang/go/issues/20977\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/20977</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "edited": false, "score": 0, "creation_date": 1570964494, "post_id": 58362351, "comment_id": 103077147, "body": "I see, thanks for the link. Note that it tears down the connection when it become idle, check the comment <a href=\"https://github.com/golang/net/commit/97aa3a539ec716117a9d15a4659a911f50d13c3c#diff-51f54e5e768ac5a5b2539aebaf738475R2350\" rel=\"nofollow noreferrer\">github.com/golang/net/commit/&hellip;</a> I am unsure about the conditions to consider the connection as idle, but as a quick guess, it might not be immediate."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1570959750, "creation_date": 1570959750, "answer_id": 58362351, "question_id": 58360811, "link": "https://stackoverflow.com/questions/58360811/close-http2-client-connection-after-every-request/58362351#58362351", "title": "Close http2 client connection after every request", "body": "<p>HTTP/2 does not allow that behavior.</p>\n\n<p><a href=\"https://httpwg.org/specs/rfc7540.html#rfc.section.8.1.2\" rel=\"nofollow noreferrer\">https://httpwg.org/specs/rfc7540.html#rfc.section.8.1.2</a></p>\n\n<blockquote>\n  <p>8.1.2.2. Connection-Specific Header Fields</p>\n  \n  <p>HTTP/2 does not use the Connection header field to indicate\n  connection-specific header fields; in this protocol,\n  connection-specific metadata is conveyed by other means. [...]</p>\n  \n  <p>[...]</p>\n  \n  <p>This means that an intermediary transforming an HTTP/1.x message to\n  HTTP/2 will need to remove any header fields nominated by the\n  Connection header field, along with the Connection header field\n  itself. Such intermediaries SHOULD also remove other\n  connection-specific header fields, such as Keep-Alive,\n  Proxy-Connection, Transfer-Encoding, and Upgrade, even if they are not\n  nominated by the Connection header field.</p>\n</blockquote>\n\n<p>see also </p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/22441\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/22441</a></li>\n<li><a href=\"https://github.com/golang/go/issues/17717\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/17717</a></li>\n</ul>\n"}], "owner": {"reputation": 67, "user_id": 9590238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Nyz7kN64rs4/AAAAAAAAAAI/AAAAAAAAAW4/d_v2XhY1eAI/photo.jpg?sz=128", "display_name": "Ashley Thomas", "link": "https://stackoverflow.com/users/9590238/ashley-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1441, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1570959750, "creation_date": 1570944016, "question_id": 58360811, "link": "https://stackoverflow.com/questions/58360811/close-http2-client-connection-after-every-request", "title": "Close http2 client connection after every request", "body": "<p>I want to close http2 client connection after every request (like disabling keep-alive connection in http1.1). I tried adding header <code>Connection: close</code> but that gives \n<em>http2: client conn not usable</em> error.</p>\n\n<p>I tried using request.Close = true as well as specified in the document, but still getting error.</p>\n\n<p>Following is the code snippet which I am using:</p>\n\n<pre><code>func main() {\n\n    enableCompression := false\n\n    transport2 := &amp;http2.Transport{\n        DisableCompression: !enableCompression,\n        AllowHTTP:          true,\n        DialTLS: func(network, addr string, cfg *tls.Config) (net.Conn, error) {\n            return net.Dial(network, addr)\n        },\n    }\n\n    // Create http client\n    client := http.Client{\n        Transport: transport2,\n        Timeout:   time.Duration(1 * time.Second),\n    }\n\n    var err error\n    var request *http.Request\n    if request, err = createRequest(); err == nil {\n        request.Close = true\n        var response *http.Response\n\n        if response, err = client.Do(request); err == nil {\n            fmt.Println(response)\n        } else {\n            fmt.Println(\"error: \", err)\n        }\n    }\n}\n\nfunc createRequest() (request *http.Request, err error) {\n    if request, err = http.NewRequest(\"GET\", \"http://0.0.0.0:1010/hello/sayHello\", nil); err == nil {\n        fmt.Println(request)\n    }\n    return\n}\n</code></pre>\n\n<p>This gives error:\n<em>http2: client conn not usable (Client.Timeout exceeded while awaiting headers)</em></p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings", "vscode-debugger"], "owner": {"reputation": 10223, "user_id": 221650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68a2471aa6fae5bfec71d8d09afbb2f1?s=128&d=identicon&r=PG&f=1", "display_name": "Petruza", "link": "https://stackoverflow.com/users/221650/petruza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 285, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1618783684, "creation_date": 1570936851, "last_edit_date": 1618783684, "question_id": 58360328, "link": "https://stackoverflow.com/questions/58360328/vscode-golang-output-to-debug-console-is-buffered-and-not-flushed-even-on-a-brea", "title": "VScode Golang output to debug console is buffered and not flushed even on a breakpoint", "body": "<p>I'm debugging a loop in which each iteration outputs a line and then hits a breakpoint.<br>\nI need to see that output line when the breakpoint is hit, although the output is buffered in the debug console so it doesn't flush for several lines, <strong>how do I manage to make it flush on every iteration, or when hitting a breakpoint?</strong><br>\nI'm pretty sure it's not a code problem because if I run the program and use a fmt.Scan() to pause execution on each iteration, the output is flushed correctly each time.<br>\nIt seems to be an issue with the debug console, go debugger <em>Delve</em> or the Microsoft Go extension. <strong>Can I configure the buffering of this console in vscode?</strong></p>\n"}, {"tags": ["parsing", "go", "rune"], "comments": [{"owner": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "edited": false, "score": 1, "creation_date": 1570928637, "post_id": 58359740, "comment_id": 103071916, "body": "Have you tried replacing <code>nextToken := stream.Scan()</code> with <code>nextToken := stream.Peek()</code>? Of course, you&#39;ll have to adapt some of your code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1570958548, "post_id": 58359740, "comment_id": 103075883, "body": "You can&#39;t rewind a scanner. Your only option, if <code>Peek</code> is not sufficient, is to buffer the input, and scan it twice."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1571032595, "post_id": 58359740, "comment_id": 103091138, "body": "You don&#39;t mention how you are actually parsing, but if you are using something like recursive descent, there is no need for the scanner to make this distinction because the two uses of <code>not</code> are in disjoint contexts: one is a prefix operator; the other is part of an infix operator. You should know before you request the token which one would be valid. After you see a <code>not</code> token, a following <code>in</code> would either be required or illegal, depending upon which type of <code>not</code> it is."}, {"owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "reply_to_user": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "edited": false, "score": 0, "creation_date": 1571088097, "post_id": 58359740, "comment_id": 103116471, "body": "@Federico <code>Peek()</code> gives you a single rune, which isn&#39;t enough to figure out what&#39;s the next token is."}, {"owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571089168, "post_id": 58359740, "comment_id": 103116784, "body": "@Flimzy I guess it doesn&#39;t necessarily need to be a rewind option as long as I can see if <code>not</code> comes after <code>in</code>. I&#39;ve tried to buffer (providing I understood what you mean), but to no avail - see the updated answer."}], "answers": [{"comments": [{"owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "edited": false, "score": 0, "creation_date": 1571088038, "post_id": 58359798, "comment_id": 103116452, "body": "<code>Peek()</code> only gives you 1 rune, which doesn&#39;t help. I tried using <code>Next()</code> too but that just changes the state as well which gets me back to need to rewind."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "edited": false, "score": 0, "creation_date": 1571112208, "post_id": 58359798, "comment_id": 103121321, "body": "You can keep <code>Peek()</code>-ing as far as you wish. Since it doesn&#39;t change the state, you may even iterate the entire document."}, {"owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "edited": false, "score": 0, "creation_date": 1572193928, "post_id": 58359798, "comment_id": 103476973, "body": "I tried using <code>Peek()</code> in a loop but to it only returns the same rune, whereas <code>Next()</code> always returns the next run but it does change the state."}, {"owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "edited": false, "score": 0, "creation_date": 1572200243, "post_id": 58359798, "comment_id": 103478479, "body": "So <code>fmt.Printf(&quot;%v;%v;%v\\n%v;%v;%v\\n&quot;, s.Peek(), s.Peek(), s.Peek(), s.Next(), s.Next(), s.Next())</code> produces <code>32;32;32\\n32;105;110</code>"}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 3, "last_activity_date": 1570928692, "creation_date": 1570928692, "answer_id": 58359798, "question_id": 58359740, "link": "https://stackoverflow.com/questions/58359740/how-to-rewind-in-gos-text-scanner/58359798#58359798", "title": "How to rewind in Go&#39;s text/scanner?", "body": "<p>By looking at the API references of <code>text/scanner</code>, I can't seem to find a way to rewind the scanner the way you want. </p>\n\n<p>However, the <code>Peek()</code> method would get you the next rune without advancing the scanner. Inside the \"not\" case, you can use it to peek in advance to see if it matches.</p>\n"}], "owner": {"reputation": 1415, "user_id": 670388, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/dffbf421b8d3ce9018a13c653b91c001?s=128&d=identicon&r=PG", "display_name": "Hosh Sadiq", "link": "https://stackoverflow.com/users/670388/hosh-sadiq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571089081, "creation_date": 1570927508, "last_edit_date": 1571089081, "question_id": 58359740, "link": "https://stackoverflow.com/questions/58359740/how-to-rewind-in-gos-text-scanner", "title": "How to rewind in Go&#39;s text/scanner?", "body": "<p>I am using <code>text/scanner</code> package to parse some arbitrary expressions. I am currently trying to implement a <code>not in</code> option, that is, if the current identifier is <code>not</code>, and the next is <code>in</code>, parse it using function <code>notin(left, right)</code>, and otherwise we parse it as <code>negate(right)</code>.</p>\n\n<p>I've essentially got the code to manage these cases however, I am unable to rewind the scanner in case the next token is not <code>in</code>. I've tried by recording the position and then reassigning it later, but to no avail and haven't been able to find a different solution.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func readToken(stream *scanner.Scanner) {\n    switch stream.Scan() {\n    case scanner.Ident:\n        switch stream.TokenText() {\n        case \"in\":\n            in(left, right)\n        case \"not\":\n            oldPosition := stream.Position\n            nextToken := stream.Scan()\n            if nextToken == scanner.Ident {\n                switch stream.TokenText() {\n                case \"in\":\n                    fmt.Println(\"notin\")\n                default:\n                    // how do we rewind the scanner?\n                    stream.Position = oldPosition \n                    fmt.Println(\"negate default\")\n                }\n            } else {\n                fmt.Println(\"negate no-ident\")\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>How can I rewind the scanner when I don't find a valid identifier?</p>\n\n<p>Edit, I also tried using <code>Peek()</code> as below, but that still changes the state to the point that I'd need to rewind as well.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// other code\ncase \"not\":\n    nextIdent, err := getNextIdent(stream)\n    if err != nil {\n        fmt.Println(\"negate no-ident\")\n    } else {\n        switch nextIdent {\n        case \"in\":\n            fmt.Println(\"notin\")\n        default:\n            fmt.Println(\"negate default\")\n        }\n    }\n// other code\n\n\nfunc getNextIdent(s *scanner.Scanner) (string, error) {\n    var nextIdent string\n\n    ch := s.Peek()\n\n    // skip white space\n    for s.Whitespace&amp;(1&lt;&lt;uint(ch)) != 0 {\n        ch = s.Next()\n    }\n\n    if isIdentRune(ch, 0) {\n        nextIdent = string(ch)\n        ch = s.Next()\n        nextIdent += string(ch)\n        for i := 1; isIdentRune(ch, i); i++ {\n            ch = s.Next()\n            if s.Whitespace&amp;(1&lt;&lt;uint(ch)) != 0 {\n                break\n            }\n            nextIdent += string(ch)\n        }\n        return nextIdent, nil\n    }\n\n    return \"\",errors.New(\"not a ident\")\n}\n</code></pre>\n\n<p>Note, the code I've got is a forked from <a href=\"https://github.com/Knetic/govaluate\" rel=\"nofollow noreferrer\">Knetic/govaluate</a> combined with a <a href=\"https://github.com/Knetic/govaluate/pull/71\" rel=\"nofollow noreferrer\">PR from GH user generikvault</a> and some other forks. The full code can be found on my <a href=\"https://github.com/hoshsadiq/govaluate/\" rel=\"nofollow noreferrer\">Github profile</a></p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1570931862, "post_id": 58359960, "comment_id": 103072278, "body": "you example says OR yet your description is an and, specifically what I want. I need all three to be included in the returned set. Please clarify"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1570932222, "post_id": 58359960, "comment_id": 103072312, "body": "@DonaldFrench My first example does not say OR, that&#39;s what I think you want based on the question. Please you clarify the question which one you want, but I presented both (AND and OR) in my answer."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 1, "creation_date": 1570933181, "post_id": 58359960, "comment_id": 103072410, "body": "Ok, I want the AND. I misunderstood your last statement. It is good to know both formats."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1570931706, "last_edit_date": 1570931706, "creation_date": 1570931378, "answer_id": 58359960, "question_id": 58359474, "link": "https://stackoverflow.com/questions/58359474/proper-wildcard-multi-field-query-with-the-official-mongo-go-driver/58359960#58359960", "title": "Proper wildcard multi field query with the official mongo-go-driver", "body": "<p>By default all listed conditions are in logical AND connection (<code>$and</code>), so you don't need to add that:</p>\n\n<pre><code>filter := bson.D{\n    {\"sessionid\", \"C-dhf\"},\n    {\"family\", primitive.Regex{Pattern: \"^s\", Options: \"i\"}},\n    {\"given\", primitive.Regex{Pattern: \"^n\", Options: \"i\"}},\n}\n</code></pre>\n\n<p>The syntax and structure you used would be appropriate if you'd wanted logical OR connection: if you'd wanted documents with given session ID, and whose family name starts with <code>s</code> or given name starts with <code>n</code>. That could look like this:</p>\n\n<pre><code>filter := bson.D{\n    {\"sessionid\", \"C-dhf\"},\n    {\"$or\", bson.A{\n        bson.D{{\"family\", primitive.Regex{Pattern: \"^s\", Options: \"i\"}}},\n        bson.D{{\"given\", primitive.Regex{Pattern: \"^n\", Options: \"i\"}}},\n    }},\n}\n</code></pre>\n"}], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 58359960, "answer_count": 1, "score": 1, "last_activity_date": 1570931706, "creation_date": 1570923336, "last_edit_date": 1570931412, "question_id": 58359474, "link": "https://stackoverflow.com/questions/58359474/proper-wildcard-multi-field-query-with-the-official-mongo-go-driver", "title": "Proper wildcard multi field query with the official mongo-go-driver", "body": "<p>I have a database field:</p>\n\n<pre><code>            \"sessionid\": \"C-dhf\",\n            \"given\": \"NURSE \",\n            \"family\": \"SHARK\",\n            \"name\": \"SHARK, NURSE\",\n</code></pre>\n\n<p>I am attempting to create a query that will query the db looking for records that family starts with \"s\" given name starts with \"n\". I am using the following to create the filter.</p>\n\n<pre><code>        {\"sessionid\", \"C-dhf\"},\n        {\"$and\", bson.A{\n            bson.D{{\"family\", primitive.Regex{Pattern: \"^s\", Options: \"i\"}}},\n            bson.D{{\"given\", primitive.Regex{Pattern: \"^n\", Options: \"i\"}}},\n        }},\n    }\n</code></pre>\n\n<p>The filter value used in the find is:</p>\n\n<pre><code>[{sessionid C-dhf} {$and [[{family {\"pattern\": \"^s\", \"options\": \"i\"}}] [{given {\"pattern\": \"^n\", \"options\": \"i\"}}]]}]\n</code></pre>\n\n<p>The find is:</p>\n\n<pre><code>cursor, err := collection.Find(context.TODO(), filter, findOptions)\n</code></pre>\n\n<p>It returns all records in the db as though it is not even looking at the filter.</p>\n\n<p>What is the proper go syntax for a multiple field wildcard query?</p>\n"}, {"tags": ["go", "gob"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7984722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa89c9e0e13e6cd4aa8a4e5e9d208043?s=128&d=identicon&r=PG&f=1", "display_name": "Asim Sansi", "link": "https://stackoverflow.com/users/7984722/asim-sansi"}, "edited": false, "score": 0, "creation_date": 1570914303, "post_id": 58358186, "comment_id": 103069599, "body": "it worked, thank you. Can you elaborate a little bit on why the number of bytes sent and received must be equal ?"}, {"owner": {"reputation": 35, "user_id": 7984722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa89c9e0e13e6cd4aa8a4e5e9d208043?s=128&d=identicon&r=PG&f=1", "display_name": "Asim Sansi", "link": "https://stackoverflow.com/users/7984722/asim-sansi"}, "edited": false, "score": 0, "creation_date": 1570915969, "post_id": 58358186, "comment_id": 103069952, "body": "ah i get it for real now(i should not have deleted my previous comment), when i was trying to read the []byte(string) i was also reading a chunk of decoded blob as well which corrupted the blob or the decoder didn&#39;t know what type it was."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 35, "user_id": 7984722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa89c9e0e13e6cd4aa8a4e5e9d208043?s=128&d=identicon&r=PG&f=1", "display_name": "Asim Sansi", "link": "https://stackoverflow.com/users/7984722/asim-sansi"}, "edited": false, "score": 1, "creation_date": 1570916051, "post_id": 58358186, "comment_id": 103069976, "body": "The call to Read reads up between 1 and 256 bytes of data from the connection. If the amount of data read is less than 13 bytes, then the decoder starts reading prefix data and errors out.  If the amount of data read is greater than 13 bytes, the the decoder starts reading mid gob an errors out."}, {"owner": {"reputation": 35, "user_id": 7984722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa89c9e0e13e6cd4aa8a4e5e9d208043?s=128&d=identicon&r=PG&f=1", "display_name": "Asim Sansi", "link": "https://stackoverflow.com/users/7984722/asim-sansi"}, "edited": false, "score": 0, "creation_date": 1570916836, "post_id": 58358186, "comment_id": 103070182, "body": "makes sense, i&#39;m new to go and network programming it was an obvious mistake but i just couldn&#39;t get my head around it anyway i really appreciate your help, have a good one."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1570915729, "last_edit_date": 1570915729, "creation_date": 1570912007, "answer_id": 58358186, "question_id": 58357984, "link": "https://stackoverflow.com/questions/58357984/getting-an-error-gob-unknown-type-id-or-corrupted-data-when-trying-to-decode/58358186#58358186", "title": "Getting an Error (gob: unknown type id or corrupted data) when trying to decode a blob using gob.Decoder()", "body": "<p>The sender writes 13 bytes before encoding gob (<code>\"newblock add \"</code>). </p>\n\n<p>If the receiver does not read these 13 bytes before decoding the gob, then the decoder will be out of sync with the data stream and report an error.</p>\n\n<p>The connection Read method returns when data is available, the slice is filled or there is an error reading the connection. Ignoring errors, the call to Read on the connection will read between 1 and len(recvdSlice) bytes from the connection. There's no guarantee that 13 bytes of data is read, but it happens frequently in practice because of timing.</p>\n\n<p>Fix by reading just the prefix before decoding the gob.  One way is to delimit the prefix with a newline.</p>\n\n<p>Change the sender code to:</p>\n\n<pre><code> _, _ = conn.Write([]byte(\"newblock add \\n\"))\n</code></pre>\n\n<p>Change the receiver code to:</p>\n\n<pre><code> br := bufio.NewReader(conn)\n receivedData, err := br.ReadString('\\n')\n if err != nil {\n     // handle error\n }\n finalData := strings.Split(receivedData, \" \")\n\n if finalData[0] == \"newblock\"{\n    var blob packet\n    decoder := gob.NewDecoder(br) // &lt;-- decode from the buffered reader\n    err := decoder.Decode(&amp;blob)\n</code></pre>\n\n<p>Another fix is to use the gob codec for the prefix.  Change the sender to:</p>\n\n<pre><code>    encoder := gob.NewEncoder(conn)\n    if err := encoder.Encode(\"newblock add \"); err != nil {\n        // handle error\n    }\n    if err := encoder.Encode(blob); err != nil {\n        // handle error\n    }\n</code></pre>\n\n<p>Change the receiver to:</p>\n\n<pre><code>decoder := gob.NewDecoder(conn)\nvar receivedData string\nif err := decoder.Decode(&amp;receivedData); err != nil {\n     // handle error\n}\nfinalData := strings.Split(receivedData, \" \")\n\nif finalData[0] == \"newblock\"{\n    var blob packet\n    err := decoder.Decode(&amp;blob)\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 7984722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa89c9e0e13e6cd4aa8a4e5e9d208043?s=128&d=identicon&r=PG&f=1", "display_name": "Asim Sansi", "link": "https://stackoverflow.com/users/7984722/asim-sansi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 633, "favorite_count": 0, "accepted_answer_id": 58358186, "answer_count": 1, "score": 0, "last_activity_date": 1570915729, "creation_date": 1570910391, "last_edit_date": 1570911645, "question_id": 58357984, "link": "https://stackoverflow.com/questions/58357984/getting-an-error-gob-unknown-type-id-or-corrupted-data-when-trying-to-decode", "title": "Getting an Error (gob: unknown type id or corrupted data) when trying to decode a blob using gob.Decoder()", "body": "<p>I'm trying to to send an encoded blob to a list of local peers(a client code listening at multiple ports on a local machine), at the peers when i decode the blob for some peers it works but for some it doesn't and displays an error(gob: unknown type id or corrupted data), how can i solve this ?</p>\n\n<pre><code>//My blob struct\ntype packet struct {\n    Nodes []a1.Node\n    Ledger *a1.Block\n    ActionType string\n}\n\n\n//Encoding Part\n    for i:=1; i&lt;len(ConnectedNodes);i++{\n        var blob packet\n        blob.Ledger = Ledger\n        blob.ActionType = \"AddBlock\"\n        blob.Nodes = []a1.Node{}\n        conn, err := net.Dial(\"tcp\", \"localhost\"+\":\"+ConnectedNodes[i].Port)\n        if err != nil {\n            // handle error\n            fmt.Println(\"Error At Client In Making A Connection (sending New Block to client \"+ ConnectedNodes[i].Name +\")\")\n        }\n        //sending request type to client\n        _, _ = conn.Write([]byte(\"newblock add \"))\n        //sending data to the client node\n        //gob.Register(blob)\n        encoder := gob.NewEncoder(conn)\n        error := encoder.Encode(blob)\n        if error != nil {\n            log.Fatal(error)\n        }\n    }\n\n//Decoding Part running on another peer\n//adds new block to the Ledger\n\n//Recieving incoming data\n    recvdSlice := make([]byte, 256)\n    conn.Read(recvdSlice)\n    RecievedData := string(recvdSlice)\n    finalData := strings.Split(RecievedData, \" \")\n\n    if finalData[0] == \"newblock\"{\n        var blob packet\n        decoder := gob.NewDecoder(conn)\n        err := decoder.Decode(&amp;blob)\n        if err != nil {\n            fmt.Println(\"error at decoding New Block on client!\")\n            fmt.Println(err)\n        }\n        fmt.Println(Ledger.Hash)\n        fmt.Println(blob.Ledger.Hash)\n        if(bytes.Compare(Ledger.Hash, blob.Ledger.Hash)) == 0 {\n            fmt.Println(\"Ledger is already updated !\")\n        }else{\n            fmt.Println(\"New Block Added !\")\n            Ledger = blob.Ledger\n        }\n        a1.ListBlocks(Ledger)\n        //SendingNewBlockToConnectedNodes()\n    }\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570906393, "post_id": 58357163, "comment_id": 103067804, "body": "use <code>go &gt;= 1.12</code>"}, {"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1570965391, "post_id": 58357163, "comment_id": 103077347, "body": "We also stopped supporting Fabric releases earlier than 1.4.x a while back."}, {"owner": {"reputation": 75, "user_id": 11023277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10649909c58ea7603bbd18c4fab94088?s=128&d=identicon&r=PG&f=1", "display_name": "KaneHarry729", "link": "https://stackoverflow.com/users/11023277/kaneharry729"}, "reply_to_user": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1570989526, "post_id": 58357163, "comment_id": 103083024, "body": "@GariSingh okay, so I guess it won&#39;t build properly since the packages in 1.0.x will be obsolete"}, {"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1571036136, "post_id": 58357163, "comment_id": 103092440, "body": "Are you trying to build fabric-sdk-go or fabric?"}, {"owner": {"reputation": 75, "user_id": 11023277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10649909c58ea7603bbd18c4fab94088?s=128&d=identicon&r=PG&f=1", "display_name": "KaneHarry729", "link": "https://stackoverflow.com/users/11023277/kaneharry729"}, "reply_to_user": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1571071230, "post_id": 58357163, "comment_id": 103110062, "body": "@GariSingh Fabric SDK I believe.. Again i&#39;m following <a href=\"https://github.com/chainHero/heroes-service\" rel=\"nofollow noreferrer\">github.com/chainHero/heroes-service</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "is_accepted": false, "score": 1, "last_activity_date": 1570906584, "creation_date": 1570906584, "answer_id": 58357463, "question_id": 58357163, "link": "https://stackoverflow.com/questions/58357163/my-hyperledger-fabirc-wont-build-with-go-due-to-package-issues-with-fabric-1-1/58357463#58357463", "title": "My Hyperledger Fabirc won&#39;t build with Go due to package issues with Fabric 1.1 vs 1.0", "body": "<p>From your error, it seems that Fabric v1.1 uses <code>strings.ReplaceAll</code> from the go standard library, and your installed version of Go doesn't support it.</p>\n\n<p>According to the documentation of <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\">strings.ReplaceAll</a>, it was added in go version 1.12, so you should use a go version >= 1.12</p>\n"}], "owner": {"reputation": 75, "user_id": 11023277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10649909c58ea7603bbd18c4fab94088?s=128&d=identicon&r=PG&f=1", "display_name": "KaneHarry729", "link": "https://stackoverflow.com/users/11023277/kaneharry729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1570989486, "creation_date": 1570904545, "last_edit_date": 1570989486, "question_id": 58357163, "link": "https://stackoverflow.com/questions/58357163/my-hyperledger-fabirc-wont-build-with-go-due-to-package-issues-with-fabric-1-1", "title": "My Hyperledger Fabirc won&#39;t build with Go due to package issues with Fabric 1.1 vs 1.0", "body": "<p>Right now, I'm following this tutorial <a href=\"https://github.com/chainHero/heroes-service\" rel=\"nofollow noreferrer\">https://github.com/chainHero/heroes-service</a></p>\n\n<p>After I've setup my <code>.go</code> and <code>yaml</code> and <code>toml</code> scripts, I do \n<code>dep ensure</code> and then <code>go build</code>. </p>\n\n<p>I get the error</p>\n\n<pre><code># github.com/chainHero/heroes-service/vendor/github.com/zmap/zlint/lints\nvendor/github.com/zmap/zlint/lints/result.go:75:9: undefined: strings.ReplaceAll\n# github.com/chainHero/heroes-service/vendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util\nvendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:47:8: cannot convert nil to type csr.KeyRequest\nvendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:132:37: cannot use req.KeyRequest (type *csr.KeyRequest) as type csr.KeyRequest in argument to getBCCSPKeyOpts\n</code></pre>\n\n<p>I've heard that's due to versioning issues of <code>1.0</code> vs <code>1.1</code>, the latter which I have. I thought this would be solved since in the <code>Gopkg.toml</code></p>\n\n<pre><code># github.com/chainHero/heroes-service/vendor/github.com/zmap/zlint/lints\nvendor/github.com/zmap/zlint/lints/result.go:75:9: undefined: strings.ReplaceAll\n# github.com/chainHero/heroes-service/vendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util\nvendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:47:8: cannot convert nil to type csr.KeyRequest\nvendor/github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:132:37: cannot use req.KeyRequest (type *csr.KeyRequest) as type csr.KeyRequest in argument to getBCCSPKeyOpts\n</code></pre>\n\n<p>Do I still need to import the <code>Go</code> packages?</p>\n\n<p>UPDATE:</p>\n\n<p>I installed <code>Go 1.13.1</code> and now when I <code>go build</code> I get</p>\n\n<pre><code>build github.com/chainHero/heroes-service: cannot load github.com/hyperledger/fabric-sdk-go/pkg/client/msp: open /home/luke/go/src/github.com/hyperledger/fabric-sdk-go/pkg/client/msp: no such file or directory\n</code></pre>\n\n<p>I'm guessing this has to do with using Fabric 1.0 here...</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901582, "post_id": 58356560, "comment_id": 103066519, "body": "deadlock means the goroutines are &quot;alive&quot;, so yes, it&#39;s no surprise that they are alive. The problem is that all goroutines are waiting for each other."}], "answers": [{"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570902123, "post_id": 58356788, "comment_id": 103066652, "body": "Ah, I see. Also, I realised that adding a <code>default</code> case seems to make it not crash but blocks indefinitely, and from your explanation it seems that it is because the goroutine does not have to wait on <code>ch2</code>, is that right?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570904763, "post_id": 58356788, "comment_id": 103067367, "body": "If you add a <code>default</code> case, <code>select</code> will not block, and the for loop will keep spinning until you close the second channel."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1570901901, "creation_date": 1570901901, "answer_id": 58356788, "question_id": 58356560, "link": "https://stackoverflow.com/questions/58356560/fatal-error-all-goroutines-are-asleep-deadlock-when-using-a-waitgroup-with-a/58356788#58356788", "title": "fatal error: all goroutines are asleep - deadlock! when using a WaitGroup with a for-select loop", "body": "<p>You only close <code>ch</code>, not <code>ch2</code>. When <code>ch</code> is closed, the goroutine sets <code>c1</code> to nil, but <code>c2</code> is still not nil, so <code>select</code> waits to receive from <code>c2</code>, and the main goroutine waits at <code>wg.Done()</code>, so both goroutines are asleep.</p>\n"}, {"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570902176, "post_id": 58356790, "comment_id": 103066668, "body": "That was the intent though, I was expecting it to block indefinitely"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570902388, "post_id": 58356790, "comment_id": 103066724, "body": "If your intent was to block indefinitely, then it would cause a deadlock."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 1, "last_activity_date": 1570901910, "creation_date": 1570901910, "answer_id": 58356790, "question_id": 58356560, "link": "https://stackoverflow.com/questions/58356560/fatal-error-all-goroutines-are-asleep-deadlock-when-using-a-waitgroup-with-a/58356790#58356790", "title": "fatal error: all goroutines are asleep - deadlock! when using a WaitGroup with a for-select loop", "body": "<p>It's happening because you're not closing <code>ch2</code>. The select block is still waiting for <code>ch2</code>.</p>\n\n<p>Working code: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    ch := make(chan int)\n    ch2 := make(chan int)\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n\n    go func(c1 chan int, c2 chan int, w *sync.WaitGroup) {\n        for c1 != nil || c2 != nil {\n\n            select {\n            case v, ok := &lt;-c1:\n                if !ok {\n                    c1 = nil\n                    fmt.Println(\"c1 closed\")\n                } else {\n                    fmt.Println(v, \" recieved c1\")\n                }\n            case v, ok := &lt;-c2:\n                if !ok {\n                    c2 = nil\n                } else {\n                    fmt.Println(v, \" recieved c2\")\n                }\n            }\n        }\n\n        fmt.Println(\"called wg.Done\")\n        wg.Done()\n    }(ch, ch2, &amp;wg)\n\n    for i := 0; i &lt; 4; i++ {\n        if i%2 == 0 {\n            ch &lt;- i\n            fmt.Println(\"sending to c1 \", i)\n        } else {\n            ch2 &lt;- i\n            fmt.Println(\"sending to c2 \", i)\n        }\n    }\n    close(ch)\n    close(ch2)\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 58356788, "answer_count": 2, "score": -2, "last_activity_date": 1570901910, "creation_date": 1570900387, "last_edit_date": 1570901552, "question_id": 58356560, "link": "https://stackoverflow.com/questions/58356560/fatal-error-all-goroutines-are-asleep-deadlock-when-using-a-waitgroup-with-a", "title": "fatal error: all goroutines are asleep - deadlock! when using a WaitGroup with a for-select loop", "body": "<p><strong>go version:</strong> go1.12.5 linux/amd64</p>\n\n<p>I was trying to understand nil channels in Go.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    ch := make(chan int)\n    ch2 := make(chan int)\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go func(c1 chan int, c2 chan int, w *sync.WaitGroup) {\n        for c1 != nil || c2 != nil {\n            fmt.Println(\"in for\")\n            fmt.Println(c1, c2)\n            select {\n            case v, ok := &lt;-c1:\n                if !ok {\n                    c1 = nil\n                    fmt.Println(\"c1 closed\")\n                } else {\n                    fmt.Println(v, \" recieved c1\")\n                }\n            case v, ok := &lt;-c2:\n                if !ok {\n                    c2 = nil\n                } else {\n                    fmt.Println(v, \" recieved c2\")\n                }\n            }\n        }\n        fmt.Println(\"called wg.Done\")\n        wg.Done()\n    }(ch, ch2, &amp;wg)\n    for i := 0; i &lt; 4; i++ {\n        if i%2 == 0 {\n            ch &lt;- i\n        } else {\n            ch2 &lt;- i\n        }\n    }\n    close(ch)\n    wg.Wait()\n}\n\n</code></pre>\n\n<p>And received this output on the stdout:</p>\n\n<pre><code>in for\n0xc000084060 0xc0000840c0\n0  recieved c1\nin for\n0xc000084060 0xc0000840c0\n1  recieved c2\nin for\n0xc000084060 0xc0000840c0\n2  recieved c1\nin for\n0xc000084060 0xc0000840c0\n3  recieved c2\nin for\n0xc000084060 0xc0000840c0\nc1 closed\nin for\n&lt;nil&gt; 0xc0000840c0\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_Semacquire(0xc00009a018)\n        /usr/local/go/src/runtime/sema.go:56 +0x39\nsync.(*WaitGroup).Wait(0xc00009a010)\n        /usr/local/go/src/sync/waitgroup.go:130 +0x65\nmain.main()\n        /home/ayush/projects/gojects/src/go-practice/nil-channels/main.go:44 +0x155\n\ngoroutine 18 [select]:\nmain.main.func1(0xc00009a010, 0xc000084060, 0xc0000840c0, 0xc00009a010)\n        /home/ayush/projects/gojects/src/go-practice/nil-channels/main.go:17 +0x1e5\ncreated by main.main\n        /home/ayush/projects/gojects/src/go-practice/nil-channels/main.go:13 +0xce\nexit status 2\n</code></pre>\n\n<p>But according to the code and the logs, <code>wg.Done()</code> is never called, that means that the goroutine is still alive.</p>\n\n<p>Could anyone help me understand what's going on here?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570900358, "post_id": 58356472, "comment_id": 103066212, "body": "The race is where the main go-routine will read from a chan value that will be altered by the background go-routine. Create the channel ahead of time."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570900978, "post_id": 58356492, "comment_id": 103066355, "body": "&quot;It&#39;s happening because the channel is closing before the main function can consume the data&quot; -- No, this is not accurate. It&#39;s happening because the <code>defer close(chanStr)</code> is being called before <code>chanStr</code> is defined. You&#39;ll notice that in the failed run, data <i>is consumed</i> from the channel, prior to the panic."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901110, "post_id": 58356492, "comment_id": 103066389, "body": "That part is not related to the code he posted, it was answer to why reading from the closed channel was causing panic. This part was added before I ran his code and noticed the deadlock."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901131, "post_id": 58356492, "comment_id": 103066394, "body": "Reading from the channel isn&#39;t causing a panic, though. Closing the channel is causing the panic. The OP&#39;s own output shows successful reads from the channel."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901214, "post_id": 58356492, "comment_id": 103066418, "body": "I think something like that was mentioned in the post but you&#39;re right. I stand corrected."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901242, "post_id": 58356492, "comment_id": 103066422, "body": "Your solution <i>will</i> fix the problem, by the way... just not for the reasons you&#39;ve explained :)"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570902447, "post_id": 58356492, "comment_id": 103066740, "body": "What&#39;s wrong with the rest of the part? Just curious :)"}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": -1, "last_activity_date": 1570901176, "last_edit_date": 1570901176, "creation_date": 1570899893, "answer_id": 58356492, "question_id": 58356472, "link": "https://stackoverflow.com/questions/58356472/why-does-closing-a-channel-in-defer-statement-panic/58356492#58356492", "title": "Why does closing a channel in defer statement panic?", "body": "<p>The code you posted had a deadlock scenario. As Flimzy pointed out, you probably didn't post the same codes. </p>\n\n<p>Here's the updated code that should work: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n\n    chanStr := make(chan string)\n\n    go pump(chanStr)\n    fmt.Println(\"iterating ...\")\n    for val := range chanStr {\n        fmt.Printf(\"fetched val: %s from channel\\n\", val)\n    }\n}\n\nfunc pump(ch chan string) {\n    defer close(ch)\n\n    for i := 1; i &lt;= 5; i++ {\n        fmt.Printf(\"pumping seq %d into channel\\n\", i)\n        ch &lt;- \"val\" + strconv.Itoa(i)\n    }\n    //close(chanStr)\n}\n\n</code></pre>\n\n<p>The issue in this case was that you created the channel inside the <code>pump</code> function so the main function didn't know how to consume the data and was causing a deadlock because there was no consumer. </p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570901193, "post_id": 58356502, "comment_id": 103066407, "body": "That is <i>a</i> race, but not the one the OP asked about. :) This particular race leads to a deadlock, not closing a nil channel."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570908305, "post_id": 58356502, "comment_id": 103068282, "body": "@Flimzy true. But my fix of creating the channel before the go routine solves both race conditions. It not worth contorting the code to work for a channel value that may change. Instead, fix the code so the channel value never changes."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570909240, "post_id": 58356502, "comment_id": 103068472, "body": "Yes, it&#39;s the same solution I offered in my answer."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1570900391, "last_edit_date": 1570900391, "creation_date": 1570899992, "answer_id": 58356502, "question_id": 58356472, "link": "https://stackoverflow.com/questions/58356472/why-does-closing-a-channel-in-defer-statement-panic/58356502#58356502", "title": "Why does closing a channel in defer statement panic?", "body": "<p>There is a possibility where the main go-routine may read from the channel before it's created. That is your data race.</p>\n\n<p>The channel should be created <em>before</em> starting your go-routine.</p>\n\n<p>Fix: <a href=\"https://play.golang.org/p/O7pgM05KEtI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/O7pgM05KEtI</a></p>\n"}, {"comments": [{"owner": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "edited": false, "score": 0, "creation_date": 1570900690, "post_id": 58356562, "comment_id": 103066283, "body": "Since channel is just a reference and the <code>pump()</code> holds a closure to that reference, by the time <code>defer close(chanStr)</code> gets called it shouldn&#39;t be <code>nil</code> channel anymore right?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "edited": false, "score": 0, "creation_date": 1570900728, "post_id": 58356562, "comment_id": 103066291, "body": "A channel isn&#39;t a reference, though. And whether <code>pump()</code> is a closure or not doesn&#39;t matter. <code>close(chanStr)</code> is evaluated immediately, even though the <code>close</code> function itself isn&#39;t executed until the function exits."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "edited": false, "score": 1, "creation_date": 1570901480, "post_id": 58356562, "comment_id": 103066496, "body": "I&#39;ve updated the answer with another example to illustrate that the problem is the early evaluation of <code>chanStr</code>."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1570901435, "last_edit_date": 1570901435, "creation_date": 1570900395, "answer_id": 58356562, "question_id": 58356472, "link": "https://stackoverflow.com/questions/58356472/why-does-closing-a-channel-in-defer-statement-panic/58356562#58356562", "title": "Why does closing a channel in defer statement panic?", "body": "<p>Your code is very racy, in different ways:</p>\n\n<ol>\n<li><p>You have the potential (in fact, it's very likely) that you'll start reading from the channel in your <code>for val</code> loop, before the goroutine actually initializes the channel, leading to a deadlock.</p>\n\n<pre><code>iterating ...\npumping seq 1 into channel\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>In fact, this is the only behavior I observe executing your code, as-is, both locally, or in the playground.</p></li>\n<li><p>If I add a delay, </p>\n\n<pre><code> fmt.Println(\"iterating ...\")\n time.Sleep(10 * time.Millisecond) // Delay ensures the channel has been created\n for val := range chanStr {\n</code></pre>\n\n<p>I then do observe your noted behavior:</p>\n\n<pre><code>iterating ...\npumping seq 1 into channel\nfetched val: val1 from channel\npumping seq 2 into channel\npumping seq 3 into channel\nfetched val: val2 from channel\nfetched val: val3 from channel\npumping seq 4 into channel\npumping seq 5 into channel\nfetched val: val4 from channel\nfetched val: val5 from channel\npanic: close of nil channel\n</code></pre>\n\n<p>The reason for this is that you're calling <code>close(chanStr)</code> while <code>chanStr</code> is still nil. If you call your <code>defer</code> after you create the channel:</p>\n\n<pre><code>func pump() {\n    chanStr = make(chan string)\n    defer close(chanStr)\n</code></pre>\n\n<p>you'll solve that problem.</p></li>\n</ol>\n\n<p>To solve both races, you need to initialize the channel <em>before</em> calling the goroutine. Complete code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nvar chanStr chan string\n\nfunc main() {\n    chanStr = make(chan string)\n    go pump(chanStr)\n    fmt.Println(\"iterating ...\")\n    for val := range chanStr {\n        fmt.Printf(\"fetched val: %s from channel\\n\", val)\n    }\n}\n\nfunc pump(chanStr chan string) {\n    defer close(chanStr)\n    for i := 1; i &lt;= 5; i++ {\n        fmt.Printf(\"pumping seq %d into channel\\n\", i)\n        chanStr &lt;- \"val\" + strconv.Itoa(i)\n    }\n}\n</code></pre>\n\n<p>To further illustrate that the problem is that <code>defer close(chanStr)</code> evaluates <code>chanStr</code> immediately (while it's still <code>nil</code>), consider this (not recommended!) alternative solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n)\n\nvar chanStr chan string\n\nfunc main() {\n    go pump()\n    fmt.Println(\"iterating ...\")\n    time.Sleep(10 * time.Millisecond)\n    for val := range chanStr {\n        fmt.Printf(\"fetched val: %s from channel\\n\", val)\n    }\n}\n\nfunc pump() {\n    defer func() {\n        close(chanStr)\n    }()\n    chanStr = make(chan string)\n    for i := 1; i &lt;= 5; i++ {\n        fmt.Printf(\"pumping seq %d into channel\\n\", i)\n        chanStr &lt;- \"val\" + strconv.Itoa(i)\n    }\n}\n</code></pre>\n\n<p>In this case, the deferred function is a closure over <code>chanStr</code>, so <code>chanStr</code>'s evaluation is delayed until the actual execution. In this version, when the deferred function executes, <code>chanStr</code> is no longer nil, so no panic.</p>\n"}], "owner": {"reputation": 1769, "user_id": 3151330, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/osBeZ.jpg?s=128&g=1", "display_name": "manikawnth", "link": "https://stackoverflow.com/users/3151330/manikawnth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 1, "answer_count": 3, "score": -2, "last_activity_date": 1571064059, "creation_date": 1570899741, "last_edit_date": 1571064059, "question_id": 58356472, "link": "https://stackoverflow.com/questions/58356472/why-does-closing-a-channel-in-defer-statement-panic", "title": "Why does closing a channel in defer statement panic?", "body": "<p>In the following example, a go routine is pumping values into unbuffered channel and the main function is iterating over it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nvar chanStr chan string\n\nfunc main() {\n    go pump()\n    fmt.Println(\"iterating ...\")\n    for val := range chanStr {\n        fmt.Printf(\"fetched val: %s from channel\\n\", val)\n    }\n}\n\nfunc pump() {\n    defer close(chanStr)\n    chanStr = make(chan string)\n    for i := 1; i &lt;= 5; i++ {\n        fmt.Printf(\"pumping seq %d into channel\\n\", i)\n        chanStr &lt;- \"val\" + strconv.Itoa(i)\n    }\n    //close(chanStr)\n}\n</code></pre>\n\n<p>The function panics with the following output:</p>\n\n<pre><code>iterating ...                                             \npumping seq 1 into channel                                \npumping seq 2 into channel                                \nfetched val: val1 from channel                            \n\n......\n\nfetched val: val4 from channel                            \npumping seq 5 into channel                                \npanic: close of nil channel                               \n\ngoroutine 5 [running]:                                    \nmain.pump()                                               \n        C:/personal/gospace/go-rules/test.go:26 +0x1a6    \ncreated by main.main                                      \n        C:/personal/gospace/go-rules/test.go:11 +0x4e     \n</code></pre>\n\n<p>However if I comment the defer statement and close right after the for loop in the goroutine <code>pump</code> , the receiver doesn't panic. \n<em>What's the difference in both the cases?</em> Looks like defer closes the channel before the value is received but the regular close waits.</p>\n\n<p>Also when I built using the race detector on, even in the regular close it flags a potential race condition (I'm not able recreate the race every time). Does it imply that both of those ways are not right in gracefully closing the channel?</p>\n\n<p><strong>UPDATE:</strong>\nFor all those commenting, I know what's the issue. I have to create the channel at the first line in the <code>main()</code> function. However I'm running on windows with go1.12 and I observed this behavior.\nObviously I didn't fake the output. I'm consistently recreating the panic using defer statement and not even once a panic occurred when I closed the channel immediately after the for loop in <code>pump()</code></p>\n"}, {"tags": ["unit-testing", "go", "environment-variables"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1570899254, "post_id": 58356031, "comment_id": 103065915, "body": "You can&#39;t. That&#39;s why global variables make testing hard."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1570899429, "creation_date": 1570899429, "answer_id": 58356422, "question_id": 58356031, "link": "https://stackoverflow.com/questions/58356031/how-to-run-test-in-parallel-requiring-different-values-for-env-variables/58356422#58356422", "title": "How to run test in parallel requiring different values for env variables", "body": "<p>Don't use environment variables in your testing. Instead, pass the configuration into your tested function. During normal start up, read that configuration from the environment, but during testing, pass it in directly.  Example:</p>\n\n<p>Your code:</p>\n\n<pre><code>func main() {\n    envFoo := os.Getenv(\"FOO\")\n    if err := someFunc(envFoo); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc someFunc(confValue string) error {\n    // do stuff\n}\n</code></pre>\n\n<p>Your test:</p>\n\n<pre><code>func TestSomeFunc(t *testing.T) {\n    err := someFunc(\"test config value\")\n    // assert things\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 3091282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ad5c29b4ad1c6ada40a27c06084b1a8?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/3091282/yogesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 58356422, "answer_count": 1, "score": 2, "last_activity_date": 1570899429, "creation_date": 1570896732, "last_edit_date": 1570899251, "question_id": 58356031, "link": "https://stackoverflow.com/questions/58356031/how-to-run-test-in-parallel-requiring-different-values-for-env-variables", "title": "How to run test in parallel requiring different values for env variables", "body": "<p>I have a Go application where application reads environment variables when booting up. The application configures itself using the values of the environment variables.</p>\n\n<p>Now, depending on one of the env variable's value, application gets setup differently than other value of same env variable.</p>\n\n<p>I want to test both these setups in my unit tests. I also want to run these tests in parallel. \nI can set env variable value using <code>os.Setenv()</code> in one test but that will also impact another test running in parallel that tries to set a different value for this same env variable. </p>\n\n<p>What is the best practice in such cases? And how can we set env variables values that do not impact across unit tests.</p>\n"}, {"tags": ["go", "rss"], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 2, "last_activity_date": 1570882821, "last_edit_date": 1570882821, "creation_date": 1570882507, "answer_id": 58354061, "question_id": 58353505, "link": "https://stackoverflow.com/questions/58353505/making-a-custom-rss-feed-for-my-university-website/58354061#58354061", "title": "Making a custom RSS feed for my university website", "body": "<p>You will need to scrape the website regularly for new news items. You can use <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">goquery</a> for extracting the data. </p>\n\n<p>The idea is simple. You need to generate the urls for the news section (fill in the value of <code>n</code>) starting from 1 and visit each url. If you find news (the structure exists), store the data. Add 1 to the <code>n</code> value to get the next ID. If the url doesn't contain news, stop and store the value of the number / ID of last successful news. The next time you can start from this ID instead of the beginning.</p>\n\n<p>For example, I start from 1, I find the last successful news at ID 32. I save it somewhere. Next time I can start from 33 instead of 1. </p>\n\n<p>When you have a database of the data extracted from the website, you can publish your own RSS feed from those. You can use a router like <a href=\"https://github.com/go-chi/chi\" rel=\"nofollow noreferrer\">chi</a> and gorilla <a href=\"https://www.gorillatoolkit.org/pkg/feeds\" rel=\"nofollow noreferrer\">feeds</a> to create the rss feed. </p>\n"}], "owner": {"reputation": 11, "user_id": 12205431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fea5f83fd3149649b44b56b37863662?s=128&d=identicon&r=PG&f=1", "display_name": "lopyk", "link": "https://stackoverflow.com/users/12205431/lopyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1570882821, "creation_date": 1570878720, "question_id": 58353505, "link": "https://stackoverflow.com/questions/58353505/making-a-custom-rss-feed-for-my-university-website", "title": "Making a custom RSS feed for my university website", "body": "<p>My university has a website where it posts announcements. I can't afford to miss these announcements, and at the same time, checking the website every day is kinda cumbersome. The website has no RSS feed.</p>\n\n<p>The announcements are posted on a web page with the following as the format for the URL of an announcement :</p>\n\n<pre><code>http://example.com/news/detail/1/n\n</code></pre>\n\n<p>where <code>n</code> is the announcement ID, which is numeric.</p>\n\n<p>When there is an announcement, the above web page (<a href=\"http://example.com/news/detail/1/180\" rel=\"nofollow noreferrer\">http://example.com/news/detail/1/180</a>, for example), contains the announcement in the following format :</p>\n\n<pre><code>            &lt;div class=\"middleconten\"&gt;    \n\n              &lt;h3&gt;\n              Title           &lt;/h3&gt;\n\n 11 October, 2019\n\n              &lt;p&gt;\n                             &lt;a href='/some/link' target='_blank'&gt;Click here for more details&lt;/a&gt;             \n              &lt;/p&gt;  \n\n            &lt;/div&gt;\n</code></pre>\n\n<p>and when there is no announcement, (that is, when a user visits a web page with a <code>n</code> value, that doesn't correspond to an actual announcement ID, <a href=\"http://example.com/news/detail/1/1234567890\" rel=\"nofollow noreferrer\">http://example.com/news/detail/1/1234567890</a>, for example), the web page is as follows :</p>\n\n<pre><code>            &lt;div class=\"middleconten\"&gt;    \n\n              &lt;h3&gt;\n                          &lt;/h3&gt;\n\n 1 January, 1970\n\n              &lt;p&gt;\n\n              &lt;/p&gt;  \n\n            &lt;/div&gt;\n</code></pre>\n\n<p>How do I make a RSS feed for the website capturing the <code>&lt;h3&gt;</code> value, the <code>href</code> attribute, and the date?</p>\n"}, {"tags": ["docker", "go", "gitlab", "gitlab-ci"], "comments": [{"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 1, "creation_date": 1570877234, "post_id": 58353192, "comment_id": 103060452, "body": "This image is based on Windows Server Core (microsoft/windowsservercore). As such, it only works in places which that image does, such as Windows 10 Professional/Enterprise (Anniversary Edition) or Windows Server 2016... From docker hub"}, {"owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "reply_to_user": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1570877306, "post_id": 58353192, "comment_id": 103060462, "body": "so is that because gitlab does not support the image?"}, {"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1570877802, "post_id": 58353192, "comment_id": 103060554, "body": "yes seem like that the offical message of Microsoft mentioned &quot;Your host must have the Windows container feature enabled. The Windows container feature is only available on Windows Server 2016 (Core and with Desktop Experience), Windows 10 Professional and Enterprise (Anniversary Edition) and later.&quot;"}, {"owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "reply_to_user": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1570878260, "post_id": 58353192, "comment_id": 103060649, "body": "ok thanks, looking a container registry seems I may be able to enable it."}, {"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1570880991, "post_id": 58353192, "comment_id": 103061253, "body": "you check the combination table, you will get the answer from combination table."}], "answers": [{"tags": [], "owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "is_accepted": true, "score": 4, "last_activity_date": 1570880957, "creation_date": 1570880957, "answer_id": 58353844, "question_id": 58353192, "link": "https://stackoverflow.com/questions/58353192/when-user-linux-docker-image-no-issues-but-windows-docker-image-fails/58353844#58353844", "title": "When user linux docker image no issues, but windows docker image fails", "body": "<blockquote>\n  <p>This image is based on Windows Server Core\n  (microsoft/windowsservercore). As such, it only works in places which\n  that image does, such as Windows 10 Professional/Enterprise\n  (Anniversary Edition) or Windows Server 2016.</p>\n</blockquote>\n\n<p><a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">golang-dockerhub</a></p>\n\n<p>So if you using gitlib then there is also some limitation and combination of the container.</p>\n\n<p><strong>The Docker executor</strong></p>\n\n<blockquote>\n  <p>GitLab Runner can use Docker to run jobs on user provided images. This\n  is possible with the use of Docker executor.</p>\n  \n  <p>The Docker executor when used with GitLab CI, connects to Docker\n  Engine and runs each build in a separate and isolated container using\n  the predefined image that is set up in .gitlab-ci.yml and in\n  accordance in config.toml.</p>\n</blockquote>\n\n<p>The following table lists what combinations of containers, executors, and OS are supported.</p>\n\n<p><a href=\"https://i.stack.imgur.com/hCRb8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hCRb8.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://docs.gitlab.com/runner/executors/docker.html\" rel=\"nofollow noreferrer\">docker executor</a></p>\n\n<p>You can check also window container limitation <a href=\"https://docs.gitlab.com/runner/executors/docker.html#limitations\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 0, "accepted_answer_id": 58353844, "answer_count": 1, "score": 1, "last_activity_date": 1570880957, "creation_date": 1570876198, "question_id": 58353192, "link": "https://stackoverflow.com/questions/58353192/when-user-linux-docker-image-no-issues-but-windows-docker-image-fails", "title": "When user linux docker image no issues, but windows docker image fails", "body": "<p>I get the following error when using windows docker golang image...</p>\n\n<blockquote>\n  <p>Job failed: Error response from daemon: manifest for\n  golang:latest-windowsservercore-1803 not found</p>\n</blockquote>\n\n<p>line from .gitlab-ciyml file...</p>\n\n<blockquote>\n  <p>image: golang:latest-windowsservercore</p>\n</blockquote>\n\n<p>However, when I use the default golang image which is based on linux i think, it works fine with no errors.</p>\n\n<p>the below works...</p>\n\n<blockquote>\n  <p>image: golang:latest</p>\n</blockquote>\n\n<p>I need the build phase to build windows executable;le hence the change.  I have tried lots of different permutations take from...</p>\n\n<p><a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/golang</a></p>\n\n<p>but nothing works is there something I am doing wrong?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570894758, "post_id": 58353030, "comment_id": 103064714, "body": "You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite its &quot;harsh&quot; title. Please add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to your question <a href=\"https://stackoverflow.com/posts/58353030/edit\">by editing it</a>."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1570910770, "creation_date": 1570910770, "answer_id": 58358042, "question_id": 58353030, "link": "https://stackoverflow.com/questions/58353030/mongodb-upsert-array-document-with-golang/58358042#58358042", "title": "MongoDB upsert array document with golang", "body": "<p>There is not a single update operation in mongodb update language that will do what you want to do. You can get close by using <code>$addToSet</code>, which adds to a set of items if the item is not already there, but it will not update the item based on the match of a subset of fields. Your best option is to perform a read-update in memory-write.</p>\n"}, {"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 0, "last_activity_date": 1570931890, "creation_date": 1570931890, "answer_id": 58359989, "question_id": 58353030, "link": "https://stackoverflow.com/questions/58353030/mongodb-upsert-array-document-with-golang/58359989#58359989", "title": "MongoDB upsert array document with golang", "body": "<p>You will need to do this manually. There's no upsert mechanism for embedded structures inside a document. </p>\n\n<p>First fetch the document, check if <code>file_x</code> is in the files list, if not, insert it. Then save the document back. </p>\n\n<p>You should make sure that at any given time, only one program / goroutine is trying to do this, otherwise you will run into race conditions and <code>file_x</code> might get inserted multiple times. </p>\n"}], "owner": {"reputation": 3, "user_id": 12205246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NJlaeSYA5dI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reJH5tWGjLWxJUk9CalIoqGwaS6_A/photo.jpg?sz=128", "display_name": "Tao Liu", "link": "https://stackoverflow.com/users/12205246/tao-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 58359989, "answer_count": 2, "score": 0, "last_activity_date": 1570931890, "creation_date": 1570874825, "last_edit_date": 1570875419, "question_id": 58353030, "link": "https://stackoverflow.com/questions/58353030/mongodb-upsert-array-document-with-golang", "title": "MongoDB upsert array document with golang", "body": "<p>I have a document like below\uff1a</p>\n\n<pre><code> {\n       \"_id\": \"1.0\",\n        files: [\n          {\"name\": \"file_1\", \"size\": 1024, \"create_ts\": 1570862776426},\n          {\"name\": \"file_2\", \"size\": 2048, \"create_ts\": 1570862778426}\n        ]\n    }\n</code></pre>\n\n<p>And I want to upsert \u201cfiles\u201d with \"file_x\"\uff1a\n1 if \"file_x\" already in \"files\", then update, for example \"file_x\" is\uff1a</p>\n\n<pre><code>{\"name\": \"file_2\", \"size\": 4096, \"create_ts\": 1570862779426}\n</code></pre>\n\n<p>after upsert document is\uff1a</p>\n\n<pre><code>{\n   \"_id\": \"1.0\",\n    files: [\n      {\"name\": \"file_1\", \"size\": 1024, \"create_ts\": 1570862776426},\n      {\"name\": \"file_2\", \"size\": 4096, \"create_ts\": 1570862779426}}\n    ]\n}\n</code></pre>\n\n<p>2 if \"file_x\" not in \"files\",  insert it\uff0c for example \"file_x\" is\uff1a</p>\n\n<pre><code>{\"name\": \"file_3\", \"size\": 4096, \"create_ts\": 1570862779426}\n</code></pre>\n\n<p>after upsert document is :</p>\n\n<pre><code>{\n   \"_id\": \"1.0\",\n    files: [\n      {\"name\": \"file_1\", \"size\": 1024, \"create_ts\": 1570862776426},\n      {\"name\": \"file_2\", \"size\": 2048, \"create_ts\": 1570862778426},\n      {\"name\": \"file_3\", \"size\": 4096, \"create_ts\": 1570862779426}\n    ]\n}\n</code></pre>\n\n<p>So can I use one function to archive it ?</p>\n"}, {"tags": ["sockets", "go", "networking", "udp"], "owner": {"reputation": 1172, "user_id": 4428377, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9295caadce48c5971dda44581c72181a?s=128&d=identicon&r=PG&f=1", "display_name": "aquaman", "link": "https://stackoverflow.com/users/4428377/aquaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1570904124, "creation_date": 1570866942, "last_edit_date": 1570904124, "question_id": 58352080, "link": "https://stackoverflow.com/questions/58352080/cannot-get-udp-hole-punching-right-error-recvfrom-connection-refused", "title": "Cannot get UDP hole punching right. Error: recvfrom: connection refused", "body": "<p>I am trying to connect two peers behind same NAT using <a href=\"https://en.wikipedia.org/wiki/UDP_hole_punching\" rel=\"nofollow noreferrer\">UDP hole punching</a> but whenever 1 client send UDP packet to other client, it receives error:</p>\n\n<pre><code>read udp4 192.168.0.xx:xx-&gt;192.168.0.xx:xx: recvfrom: connection refused\n</code></pre>\n\n<p>I followed implementation from <a href=\"https://bford.info/pub/net/p2pnat/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Some background about my code:</p>\n\n<p><strong>server.go</strong></p>\n\n<ol>\n<li><p>init UDP server</p></li>\n<li><p>start listening for packets on given IP:PORT (user input)</p></li>\n<li><p>a. receive packet of type <strong><em>new_connection</em></strong> for new client (does not exist already), store client_name, IP:PORT mapping in a variable and send <strong><em>connection_success</em></strong> in response.</p>\n\n<p>b. receive packet of type <strong><em>connection_request</em></strong> from client A requesting from B's details, send <strong><em>mapping_response</em></strong> packet to client A with B's details and send client B <strong><em>peer_request</em></strong> packet with A's details.</p></li>\n</ol>\n\n<p>code for server.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"fmt\"\n    \"strings\"\n    \"os\"\n)\n\nvar mapping map[string]*net.UDPAddr\n\nfunc initServer(addr string) (*net.UDPConn, error) {\n    s, err := net.ResolveUDPAddr(\"udp4\", addr)\n    if err != nil {\n        fmt.Println(err.Error())\n        return nil, err\n    }\n    c, err := net.ListenUDP(\"udp4\", s)\n    return c, nil\n}\n\nfunc main() {\n    port := \":\" + os.Args[1]\n    mapping = make(map[string]*net.UDPAddr)\n    c, err := initServer(port)\n    defer c.Close()\n    if err != nil {\n        return\n    }\n    listen(c)\n}\n\nfunc listen(c *net.UDPConn) {\n    buffer := make([]byte, 1024)\n    for {\n        n, addr, err := c.ReadFromUDP(buffer)\n        if err != nil {\n            fmt.Println(err.Error())\n        } else  {\n            s := strings.Split(string(buffer[0:n]), \" \")\n            packetType, packetData := s[0], s[1]\n            go handle(c, packetType, packetData, addr)\n        }\n    }\n}\n\nfunc addMapping(c *net.UDPConn, data string, addr *net.UDPAddr) {\n    if _, ok := mapping[data]; !ok {\n        mapping[data] = addr\n        fmt.Println(mapping)\n        data := generateData(\"connection_success\", \"hello\")\n        sendResponse(c, data, addr)\n    }\n}\n\nfunc makeConnection(c *net.UDPConn, name string, addr1 *net.UDPAddr) {\n    addr2 := getAddress(name)\n    var data string\n    data = generateData(\"mapping_response\", addr2.String())\n    sendResponse(c, data, addr1)\n    data = generateData(\"peer_request\", addr1.String())\n    sendResponse(c, data, addr2)\n}\n\nfunc handle(c *net.UDPConn, packetType string, packetData string, addr *net.UDPAddr) {\n    switch packetType {\n    case \"new_connection\":\n        addMapping(c, packetData, addr)\n    case \"connection_request\":\n        makeConnection(c, packetData, addr)\n    default:\n        break\n    }\n}\n\nfunc getAddress(name string) *net.UDPAddr {\n    return mapping[name]\n}\n\nfunc generateData(packetType string, packetData string) string {\n    return fmt.Sprintf(\"%s %s\", packetType, packetData)\n}\n\nfunc sendResponse(c *net.UDPConn, data string, addr *net.UDPAddr) {\n    fmt.Println(data, addr)\n    _, err := c.WriteToUDP([]byte(data), addr)\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n}  \n</code></pre>\n\n<p><strong>client.go</strong></p>\n\n<ol>\n<li><p>init UDP client for server</p></li>\n<li><p>get client_name as input (user input)</p></li>\n<li><p>send packet of type <strong><em>new_connection</em></strong> to server every 10s.</p></li>\n<li><p>a. receive packet of type <strong><em>connection_success</em></strong>, ask user whom to connect with (client B) and send <strong><em>connection_request</em></strong> packet to server asking B's details.</p>\n\n<p>b. receive packet of type <strong><em>mapping_response</em></strong>, try to connect to client B by using sending <strong><em>establish_connection</em></strong> packet to client B every 3s.</p>\n\n<p>c. receive packet of type <strong><em>peer_request</em></strong>, try same thing as 3b from client B side.</p></li>\n</ol>\n\n<p>code for client.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"net\"\n    \"time\"\n    \"strings\"\n)\n\nfunc initClient(addr string) (*net.UDPConn, error) {\n    s, err := net.ResolveUDPAddr(\"udp4\", addr)\n    c, err := net.DialUDP(\"udp4\", nil, s)\n    if err != nil {\n        fmt.Println(err.Error())\n        return nil, err\n    }\n    return c, nil\n}\n\nfunc main() {\n    serverAddress := os.Args[1]\n    c, err := initClient(serverAddress)\n    if err != nil {\n        return\n    }\n    defer c.Close()\n    name := getInput()\n    go addMappingToServer(c, name)\n    listen(c)\n}\n\nfunc addMappingToServer(c *net.UDPConn, name string) {\n    for {\n        data := generateData(\"new_connection\", name)\n        sendPacket(c, data)\n        time.Sleep(10*time.Second)\n    }\n}\n\nfunc listen(c *net.UDPConn) {\n    buffer := make([]byte, 1024)\n    for {\n        n, addr, err := c.ReadFromUDP(buffer)\n        if err != nil {\n            fmt.Println(err.Error())\n        } else  {\n            s := strings.Split(string(buffer[0:n]), \" \")\n            packetType, packetData := s[0], s[1]\n            go handle(c, packetType, packetData, addr)\n        }\n    }\n}\n\nfunc handle(c *net.UDPConn, packetType string, packetData string, addr *net.UDPAddr) {\n    fmt.Println(packetType, packetData)\n    switch packetType {\n    case \"connection_success\":\n        getPeerMapping(c)\n    case \"peer_request\":\n        establishConnectionToPeer(packetData)\n    case \"mapping_response\":\n        establishConnectionToPeer(packetData)\n    default:\n        break\n    }\n}\n\nfunc generateData(packetType string, packetData string) string {\n    return fmt.Sprintf(\"%s %s\", packetType, packetData)\n}\n\nfunc sendPacket(c *net.UDPConn, data string) {\n    _, err := c.Write([]byte(data))\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n}\n\nfunc sendPacketToAddr(c *net.UDPConn, data string, addr *net.UDPAddr) {\n    _, err := c.WriteToUDP([]byte(data), addr)\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n}\n\nfunc getInput() string {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"&gt;&gt; \")\n    text, _ := reader.ReadString('\\n')\n    return text[0:len(text)-1]\n}\n\nfunc getPeerMapping(c *net.UDPConn) {\n    peer := getInput()\n    data := generateData(\"connection_request\", peer)\n    sendPacket(c, data)\n}\n\nfunc establishConnectionToPeer(peerAddr string) {\n    c, err := initClient(peerAddr)\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    defer c.Close()\n    buffer := make([]byte, 1024)\n    for {\n        data := generateData(\"establish_connection\", \"hello\")\n        sendPacket(c, data)\n        n, addr, err := c.ReadFromUDP(buffer)\n        if err != nil {\n            fmt.Println(err.Error())\n        } else {\n            fmt.Println(\"packet recieved from peer data : %s, addr : %#v\", string(buffer[0:n]), addr)\n            break\n        }\n        time.Sleep(3*time.Second)\n    }\n\n}\n</code></pre>\n\n<p>The problem that I am facing is in line </p>\n\n<pre><code>n, addr, err := c.ReadFromUDP(buffer)\n</code></pre>\n\n<p>inside <em>establishConnectionToPeer</em> function and I am getting error I mentioned above (<strong>connection refused</strong>).</p>\n\n<p><strong>Scenario</strong></p>\n\n<p>Client A and server are on 1 host and client B on another. Both hosts are behind same NAT.</p>\n\n<p><strong>Sample output:</strong></p>\n\n<p><em>for server:</em></p>\n\n<pre><code>map[abc:192.168.0.78:45999 xyz:192.168.0.10:44207]\n</code></pre>\n\n<p>meaning client abc's IP:PORT is <em>192.168.0.78:45999</em> and for xyz, it is <em>192.168.0.10:44207</em></p>\n\n<p><em>for client abc:</em> </p>\n\n<pre><code>read udp4 192.168.0.78:40934-&gt;192.168.0.10:44207: recvfrom: connection refused\n</code></pre>\n\n<p><em>for client xyz:</em></p>\n\n<pre><code>read udp4 192.168.0.10:49708-&gt;192.168.0.78:45999: recvfrom: connection refused\n</code></pre>\n\n<p>Problem is clear: both clients opened another port (different from what they opened to communicate from server)</p>\n\n<p>What is wrong with the client code above, and what can I do to resolve it? It would be great if someone can provide (or modify above) code piece to make it start working.</p>\n\n<p>I assume it's not the case that my router does not support UDP hole punching because I can use skype using it (and I read from <a href=\"http://www.h-online.com/security/features/How-Skype-Co-get-round-firewalls-747197.html\" rel=\"nofollow noreferrer\">here</a> that skype uses hole punching).</p>\n"}, {"tags": ["mongodb", "go", "bson"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 3, "creation_date": 1570865675, "post_id": 58351694, "comment_id": 103057910, "body": "The documents are clearly different. As noted One form is an <b>&quot;array of integers&quot;</b> at 32-bit&#39;s a piece ( even if the actual numeric values are all less than 255 ). The other form is just the full binary data. So just <b>plain bytes</b>. Of course one is much smaller than the other. Not an &quot;apples to apples&quot; comparison."}], "answers": [{"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 1, "creation_date": 1570864742, "post_id": 58351811, "comment_id": 103057735, "body": "this doesn&#39;t answer the question though. The OP is asking why saving the same data in two different formats causes the document size to  increase by like 5 times"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570864812, "post_id": 58351811, "comment_id": 103057750, "body": "because the format is different? one is being stored as an array of integer, another one in binary form."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1570864863, "post_id": 58351811, "comment_id": 103057762, "body": "Let me try and rephrase this in a better way."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 5, "creation_date": 1570865542, "post_id": 58351811, "comment_id": 103057891, "body": "@AyushGupta Completely disagree with you and I suggest you try to understand what the answer actually says. As an &quot;array of bye values&quot; but expressed as <b>integers</b>, this actually stores in MongoDB as that many <b>integers</b> which are <a href=\"http://bsonspec.org/spec.html\" rel=\"nofollow noreferrer\"><b>4-byte values*</b></a> and <b>NOT ONE</b>. So the subsequent BSON size difference is indeed more that <b>4 times</b> the size, plus the additional padding on each integer value and the definition of the BSON Array. A BSON Binary field is just storing the data <b>as is</b>."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570867216, "post_id": 58351811, "comment_id": 103058224, "body": "I have added more explanations, hope the answer is better now."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 7, "last_activity_date": 1570867177, "last_edit_date": 1570867177, "creation_date": 1570864603, "answer_id": 58351811, "question_id": 58351694, "link": "https://stackoverflow.com/questions/58351694/why-json-rawmessage-enlarge-mongodb-document-size/58351811#58351811", "title": "Why json.RawMessage enlarge mongoDb document size?", "body": "<p>test_doc1 uses <code>json.RawMessage</code> which is essentially <code>[]byte</code> so it gets stored as an array of integers which represent the string (raw representation of the document). </p>\n\n<p>test_doc2 is storing the data as binary data which is a more compact form.</p>\n\n<p>The Go Mongo Driver uses the <code>WriteBinaryWithSubtype</code> method for the json encoded data but uses <code>WriteArray</code> for the <code>RawMessage</code>.  </p>\n\n<p>The difference is in the data type being used on the mongo side to store these data. One is storing the byte slice as an array of integers, another is storing data as binary with a sub type. The binary form takes less space compared to the integers. </p>\n\n<p>Digging deeper, I noticed the Go driver uses a registry to determine how it should encode a value to BSON. There's a method dedicated to byte slices. </p>\n\n<pre><code>// ByteSliceEncodeValue is the ValueEncoderFunc for []byte.\nfunc (dve DefaultValueEncoders) ByteSliceEncodeValue(ec EncodeContext, vw bsonrw.ValueWriter, val reflect.Value) error {\n</code></pre>\n\n<p>This method uses the <code>WriteBinary()</code> method to encode byte slices as binary data. </p>\n\n<p>Where as, if there's a custom type (even if it's a <code>[]byte</code> underneath), it would be treated as a slice type and trigger the \"default encoder\" for slices. </p>\n\n<pre><code>// SliceEncodeValue is the ValueEncoderFunc for slice types.\nfunc (dve DefaultValueEncoders) SliceEncodeValue(ec EncodeContext, vw bsonrw.ValueWriter, val reflect.Value) error {\n</code></pre>\n\n<p>This method uses the <code>WriteArray()</code> method in turn. </p>\n\n<p><strong>Summary:</strong> The <code>json.Marshal</code> call gets use <code>[]byte</code> types directly so they are treated as bson binary type and stored in the compact binary form. <code>json.RawMessage</code> even though stores the data as <code>[]byte</code> internally is treated as a slice, a slice of integers and thus stored in mongo as an array of integers. </p>\n"}], "owner": {"reputation": 33451, "user_id": 3011380, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/oN76M.jpg?s=128&g=1", "display_name": "zangw", "link": "https://stackoverflow.com/users/3011380/zangw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 58351811, "answer_count": 1, "score": -3, "last_activity_date": 1570867177, "creation_date": 1570863567, "question_id": 58351694, "link": "https://stackoverflow.com/questions/58351694/why-json-rawmessage-enlarge-mongodb-document-size", "title": "Why json.RawMessage enlarge mongoDb document size?", "body": "<p>The following codes try to insert new documents into mongoDB through <code>go.mongodb.org/mongo-driver</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    data := \"this is test string blablablablablablabla\"\n    type Doc struct {\n        Version int \"json:version, bson:version\"\n        Data   string   \"json:data, bson:data\"\n    }\n    dd := Doc{Version: 21, Data: data}\n    dObj, _ := json.Marshal(dd)\n\n    queryFilter := bson.M{\"version\": 1}\n    update1 := bson.M{\"$set\": bson.M{\"version\": 1, \"data\": json.RawMessage(dObj)}}\n\n    // insert data with json.RawMessage\n    _, err := db.Mongo(\"test\").Collection(\"test_doc1\").UpdateOne(context.Background(), queryFilter, update1, options.Update().SetUpsert(true))\n    if err != nil {\n        fmt.Println(\"failed to insert doc1\")\n    }\n\n    update2 := bson.M{\"$set\": bson.M{\"version\": 1, \"data\": (dObj)}}\n\n    // insert data without json.RawMessage\n    _, err = db.Mongo(\"test\").Collection(\"test_doc2\").UpdateOne(context.Background(), queryFilter, update2, options.Update().SetUpsert(true))\n    if err != nil {\n        fmt.Println(\"failed to insert doc2\")\n    }\n</code></pre>\n\n<p>The content of <code>test_doc1</code> is <code>\"data\": json.RawMessage(dObj)</code>, whereas the  content of <code>test_doc2</code> is <code>\"data\": (dObj)</code>.</p>\n\n<p>The document content as below</p>\n\n<pre><code>db.test_doc1.find()\n{ \"_id\" : ObjectId(\"5da164a950d625a5b2e5d23e\"), \"version\" : 1, \"data\" : [ 123, 34, 86, 101, 114, 115, 105, 111, 110, 34, 58, 50, 49, 44, 34, 68, 97, 116, 97, 34, 58, 34, 116, 104, 105, 115, 32, 105, 115, 32, 116, 101, 115, 116, 32, 115, 116, 114, 105, 110, 103, 32, 98, 108, 97, 98, 108, 97, 98, 108, 97, 98, 108, 97, 98, 108, 97, 98, 108, 97, 98, 108, 97, 34, 125 ] }\n\ndb.test_doc2.find()\n{ \"_id\" : ObjectId(\"5da164a950d625a5b2e5d249\"), \"version\" : 1, \"data\" : BinData(0,\"eyJWZXJzaW9uIjoyMSwiRGF0YSI6InRoaXMgaXMgdGVzdCBzdHJpbmcgYmxhYmxhYmxhYmxhYmxhYmxhYmxhIn0=\") }\n</code></pre>\n\n<p>After check the size of the above two documents</p>\n\n<pre><code>Object.bsonsize(db.test_doc2.findOne())\n111\n\nObject.bsonsize(db.test_doc1.findOne())\n556\n</code></pre>\n\n<p>The size of <code>test_doc1</code> is more larger than <code>test_doc2</code>. Why?</p>\n\n<p>Per <a href=\"http://bsonspec.org/spec.html\" rel=\"nofollow noreferrer\">bson doc</a> </p>\n\n<blockquote>\n  <p>Array - The document for an array is a normal BSON document with integer values for the keys, starting with 0 and continuing sequentially. For example, the array ['red', 'blue'] would be encoded as the document {'0': 'red', '1': 'blue'}. The keys must be in ascending numerical order.</p>\n</blockquote>\n\n<p>Bson array could occupy more disk space? Am I right? </p>\n\n<p>MongoDB version: 4.0</p>\n"}, {"tags": ["go", "resources"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570869818, "post_id": 58351084, "comment_id": 103058751, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/7395542/13860\">stackoverflow.com/q/7395542/13860</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11395623"}, "edited": false, "score": 0, "creation_date": 1570858994, "post_id": 58351115, "comment_id": 103056720, "body": "If it does not close automatically, does Go have any other mechanism to guard against this extremely common form of error other than relying on the programmer to know to do this explicltly?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570859415, "post_id": 58351115, "comment_id": 103056775, "body": "I was wrong. File seems to have a finalizer to close it. I will update my answer."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1570859844, "last_edit_date": 1570859844, "creation_date": 1570857754, "answer_id": 58351115, "question_id": 58351084, "link": "https://stackoverflow.com/questions/58351084/does-go-automatically-close-resources-if-not-explicitly-closed/58351115#58351115", "title": "Does Go automatically close resources if not explicitly closed?", "body": "<p>Files will be closed automatically when os.File is garbage collected. This appears to be done by SetFinalizer calls so the file will be closed eventually, not immediately after it becomes unreachable.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 8, "last_activity_date": 1570861464, "last_edit_date": 1570861464, "creation_date": 1570860949, "answer_id": 58351400, "question_id": 58351084, "link": "https://stackoverflow.com/questions/58351084/does-go-automatically-close-resources-if-not-explicitly-closed/58351400#58351400", "title": "Does Go automatically close resources if not explicitly closed?", "body": "<p>It is true Files are closed when garbage collected, but... as mentioned in \"<a href=\"https://lk4d4.darth.io/posts/finalizers/\" rel=\"noreferrer\">Mystery of finalizers in Go</a>\" from <a href=\"https://twitter.com/LK4D4math\" rel=\"noreferrer\">Alexander Morozov -- LK4D4math</a>:</p>\n\n<blockquote>\n  <p>In Go we have both GC and pro-users :)<br>\n  So, in my opinion <strong>explicit call of <code>Close</code> is always better than magic finalizer</strong>.</p>\n</blockquote>\n\n<p>Alexander adds:</p>\n\n<blockquote>\n  <p>The problem with finalizers is that you have no control over them, and, more than that, you\u2019re not expecting them. </p>\n  \n  <p>Look at this code:</p>\n</blockquote>\n\n<pre><code>func getFd(path string) (int, error) {\n    f, err := os.Open(path)\n    if err != nil {\n        return -1, err\n    }\n    return f.Fd(), nil\n}\n</code></pre>\n\n<blockquote>\n  <p>It\u2019s pretty common operation to get file descriptor from path when you\u2019re writing some stuff for linux.<br>\n  But that code is unreliable, because when you\u2019re return from <code>getFd()</code>, <code>f</code> loses its last reference and so your file is doomed to be closed sooner or later (when next GC cycle will come). </p>\n  \n  <p>Here, the problem is <em>not</em> that file will be closed, but that it is not documented and not expected at all.</p>\n</blockquote>\n\n<hr>\n\n<p>There was a proposal to <a href=\"https://github.com/golang/go/issues/24696\" rel=\"noreferrer\">extend the finalizer and detecting leaks</a> (like file descriptor leaks)</p>\n\n<p>But... <a href=\"https://github.com/rsc\" rel=\"noreferrer\">Russ Cox</a> quashed that down convincingly:</p>\n\n<blockquote>\n  <p>Anyone interested in this topic should read Hans Boehm's paper \"<a href=\"http://www.hpl.hp.com/techreports/2002/HPL-2002-335.html\" rel=\"noreferrer\"><strong>Destructors, Finalizers, and Synchronization</strong></a>\".<br>\n  It greatly influenced our decision to limit the scope of finalizers in Go as much as possible.<br>\n  They are a necessary evil for allowing reclamation of non-(heap memory) resources at the same time as associated heap memory, but they are inherently much more limited in their capabilities than most people initially believe. </p>\n  \n  <p>We will not be expanding the scope of finalizers, either in implementation or in the standard library, or in the x repos, nor will we encourage others to expand that scope.</p>\n  \n  <p>If you want to track manually-managed objects, you'd be far better off using <a href=\"https://golang.org/pkg/runtime/pprof/#NewProfile\" rel=\"noreferrer\"><code>runtime/pprof.NewProfile</code></a>. </p>\n  \n  <p>For example, inside Google's source tree we have a Google-wide \"file\" abstraction, and the Go wrapper package for this declares a global:</p>\n</blockquote>\n\n<pre><code>var profiles = pprof.NewProfile(\"file\")\n</code></pre>\n\n<blockquote>\n  <p>The end of the function that creates a new File says:</p>\n</blockquote>\n\n<pre><code>profiles.Add(f, 2)\nreturn f\n</code></pre>\n\n<blockquote>\n  <p>and then <code>f.Close</code> does</p>\n</blockquote>\n\n<pre><code>profiles.Remove(f)\n</code></pre>\n\n<blockquote>\n  <p>Then we can get a profile of all in-use files, \"leaked\" or otherwise, from <code>/debug/pprof/file</code> or from <code>pprof.Lookup(\"file\").WriteTo(w, 0)</code>.<br>\n  And that profile includes stack traces.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12206905"}, "is_accepted": false, "score": 1, "last_activity_date": 1570905822, "creation_date": 1570905822, "answer_id": 58357349, "question_id": 58351084, "link": "https://stackoverflow.com/questions/58351084/does-go-automatically-close-resources-if-not-explicitly-closed/58357349#58357349", "title": "Does Go automatically close resources if not explicitly closed?", "body": "<p>Go applications are expected to explicitly release resources. There is no language feature that will implicitly release a resource when a variable goes out of scope.\n The language does provide the defer feature to make it easier to write the explicit code.</p>\n\n<p>As bserdar and VonC noted, the garbage collector has a hook for releasing external resources (see <a href=\"https://godoc.org/runtime#SetFinalizer\" rel=\"nofollow noreferrer\">runtime.SetFinalizer</a>). This hook is used by the os.File type. Applications should not rely on this hook because it's not specified when objects are collected, if at all.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11395623"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1570905822, "creation_date": 1570857356, "question_id": 58351084, "link": "https://stackoverflow.com/questions/58351084/does-go-automatically-close-resources-if-not-explicitly-closed", "title": "Does Go automatically close resources if not explicitly closed?", "body": "<p>The following <code>Open</code> followed by a deferred <code>Close</code> is idiomatic in Go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func example() {\n    f, err := os.Open(path)\n    if err != nil {\n        return\n    }\n    defer f.Close()\n}\n</code></pre>\n\n<p>What happens if I don't have <code>defer f.Close()</code>? </p>\n\n<p>When I call this function and <code>f</code> goes out of scope, does it automatically close the file or do I have a zombie file handle? </p>\n\n<p>If it closes automatically, when exactly does it do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 3, "creation_date": 1570856530, "post_id": 58350881, "comment_id": 103056376, "body": "Its not actually error!"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1570877467, "post_id": 58350881, "comment_id": 103060494, "body": "Please go through <code>GoLang specs</code> first. Also, read docs to save your time."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1570911723, "post_id": 58350881, "comment_id": 103069013, "body": "That&#39;s not an error. It&#39;s a lint warning. And it should be pretty self-explanatory. What part do you need help understanding?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 5, "last_activity_date": 1570856839, "last_edit_date": 1570856839, "creation_date": 1570855107, "answer_id": 58350916, "question_id": 58350881, "link": "https://stackoverflow.com/questions/58350881/golang-var-should-have-comment-or-should-be-unexported/58350916#58350916", "title": "Golang var should have comment or should be unexported", "body": "<p><code>URLSuffix</code> start with an uppercase letter, so it is exported, so add a comment right before it, as described in the <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#doc-comments\" rel=\"nofollow noreferrer\">Code Review guide</a>, and <a href=\"https://golang.org/doc/effective_go.html#commentary\" rel=\"nofollow noreferrer\">effective Go commentary</a>:</p>\n\n<pre><code>// URLSuffix is ... (complete here)\nURLSuffix aType\n</code></pre>\n\n<p>This is a <em>warning</em> from <a href=\"https://github.com/golang/lint\" rel=\"nofollow noreferrer\"><code>golang/lint</code></a>, illustrated in <a href=\"https://github.com/golang/lint/issues/191\" rel=\"nofollow noreferrer\"><code>golang/lint</code> issue 191</a>.</p>\n"}], "owner": {"reputation": 165, "user_id": 11675463, "user_type": "registered", "profile_image": "https://graph.facebook.com/2369312196630357/picture?type=large", "display_name": "Gunjan Paul", "link": "https://stackoverflow.com/users/11675463/gunjan-paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 677, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1600618707, "creation_date": 1570854800, "last_edit_date": 1600618707, "question_id": 58350881, "link": "https://stackoverflow.com/questions/58350881/golang-var-should-have-comment-or-should-be-unexported", "title": "Golang var should have comment or should be unexported", "body": "<p>I am facing this error in my Go code\nexported var should have a comment or be unexported \nerror message </p>\n\n<blockquote>\n  <p>install.go:44:2: exported var URLSuffix should have comment or be unexported</p>\n</blockquote>\n"}]