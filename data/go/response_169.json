[{"tags": ["go", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "is_accepted": false, "score": 0, "last_activity_date": 1522894778, "creation_date": 1522894778, "answer_id": 49663142, "question_id": 49659962, "link": "https://stackoverflow.com/questions/49659962/error-response-2-build-failed-using-gcp-golang/49663142#49663142", "title": "Error response: [2] Build failed using GCP - Golang", "body": "<p>External packages need to be local for the build to take place. Go programs are often comprised of packages from many different sources. Each one of these sources are pulled in from the GOPATH or from the standard library. (<a href=\"https://blog.gopheracademy.com/advent-2015/vendor-folder/\" rel=\"nofollow noreferrer\">Source of Explanation</a>)</p>\n\n<p>Take a look at <a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\">govendor</a>. Govendor will create your vendor folder and add your external packages.</p>\n\n<pre><code>// init govendor\ngovendor init\n\n# Add existing GOPATH files to vendor.\ngovendor add +external\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8858621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d5aa91bf90b4fb5457b293605255154?s=128&d=identicon&r=PG&f=1", "display_name": "IrvinS", "link": "https://stackoverflow.com/users/8858621/irvins"}, "is_accepted": true, "score": 0, "last_activity_date": 1523265228, "creation_date": 1523265228, "answer_id": 49729405, "question_id": 49659962, "link": "https://stackoverflow.com/questions/49659962/error-response-2-build-failed-using-gcp-golang/49729405#49729405", "title": "Error response: [2] Build failed using GCP - Golang", "body": "<p>The error was in <code>app.yaml</code> i don't have much idea why but i just delete into <code>app.yaml</code> the line <code>api_version: go1</code></p>\n"}], "owner": {"reputation": 11, "user_id": 8858621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d5aa91bf90b4fb5457b293605255154?s=128&d=identicon&r=PG&f=1", "display_name": "IrvinS", "link": "https://stackoverflow.com/users/8858621/irvins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 410, "favorite_count": 0, "accepted_answer_id": 49729405, "answer_count": 2, "score": 0, "last_activity_date": 1523265228, "creation_date": 1522874095, "question_id": 49659962, "link": "https://stackoverflow.com/questions/49659962/error-response-2-build-failed-using-gcp-golang", "title": "Error response: [2] Build failed using GCP - Golang", "body": "<p>I'm trying deploy my server using Golang into Google Cloud Platform<br>\nI run <code>gcloud app deploy cmd/web/app.yaml</code>\nAnd was return <code>Failure status: UNKNOWN: Error Response: [2] Build failed; check build logs for details</code><br>\nInto the logs was print this:<br></p>\n\n<pre><code>Starting Step #0\nStep #0: Pulling image: gcr.io/gcp-runtimes/go1-builder@sha256:[...]\nStep #0: sha256:[...]: Pulling from gcp-runtimes/go1-builder\nStep #0: Digest: sha256:[...]\nStep #0: Status: Downloaded newer image for gcr.io/gcp-runtimes/go1-builder@sha256:[...]\nStep #0: main.go:8:2: cannot find package \"github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql\" in any of:\nStep #0:    /usr/local/go/src/github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql (from $GOROOT)\nStep #0:    /workspace/_gopath/src/github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql (from $GOPATH)\nStep #0: routes.go:5:2: cannot find package \"github.com/bmizerany/pat\" in any of:\nStep #0:    /usr/local/go/src/github.com/bmizerany/pat (from $GOROOT)\nStep #0:    /workspace/_gopath/src/github.com/bmizerany/pat (from $GOPATH)\nStep #0: main.go:7:2: cannot find package \"github.com/go-sql-driver/mysql\" in any of:\nStep #0:    /usr/local/go/src/github.com/go-sql-driver/mysql (from $GOROOT)\nStep #0:    /workspace/_gopath/src/github.com/go-sql-driver/mysql (from $GOPATH)\nStep #0: middleware.go:6:2: cannot find package \"github.com/justinas/nosurf\" in any of:\nStep #0:    /usr/local/go/src/github.com/justinas/nosurf (from $GOROOT)\nStep #0:    /workspace/_gopath/src/github.com/justinas/nosurf (from $GOPATH)\nStep #0: handlers.go:7:2: cannot find package \"myProject/pkg/forms\" in any of:\nStep #0:    /usr/local/go/src/myProject/pkg/forms (from $GOROOT)\nStep #0:    /workspace/_gopath/src/myProject/pkg/forms (from $GOPATH)\nStep #0: app.go:4:2: cannot find package \"myProject/pkg/models\" in any of:\nStep #0:    /usr/local/go/src/myProject/pkg/models (from $GOROOT)\nStep #0:    /workspace/_gopath/src/myProject/pkg/models (from $GOPATH)\nFinished Step #0\nERROR\n</code></pre>\n\n<p>My gcloud configuration is correct because I have a connection to Google SQL and I save the data. I have the code in a Compute Engine, but I try to run <code>gcloud app deploy cmd / web / app.yaml</code> on my pc</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 2, "creation_date": 1522873697, "post_id": 49659836, "comment_id": 86329231, "body": "Can&#39;t you split on a comma and then extract the value?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522873963, "post_id": 49659836, "comment_id": 86329359, "body": "This is going to be difficult if commas are used as separators between key/value pairs <i>and</i> as separators for multiple values."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1522874034, "post_id": 49659836, "comment_id": 86329387, "body": "Just to precise: you need to get <code>[&#39;bar&#39;,&#39;apple,tree&#39;, &#39;bie&#39;]</code>, <code>[&#39;bar&#39;,&#39;apple,tree&#39;]</code> and <code>[&#39;apple,tree&#39;]</code>?"}, {"owner": {"reputation": 530, "user_id": 978927, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/daf1ffb2144fd84fe8f39b36d75996bc?s=128&d=identicon&r=PG", "display_name": "Puzzle84", "link": "https://stackoverflow.com/users/978927/puzzle84"}, "edited": false, "score": 0, "creation_date": 1522874769, "post_id": 49659836, "comment_id": 86329787, "body": "so i need to split on key=value even if the value is comma seperated."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1522876012, "post_id": 49659836, "comment_id": 86330439, "body": "Check <a href=\"https://play.golang.org/p/_bTPcVAsbX2\" rel=\"nofollow noreferrer\">play.golang.org/p/_bTPcVAsbX2</a>, a <a href=\"https://regex101.com/r/E1rPyX/1\" rel=\"nofollow noreferrer\">regex demo</a>."}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1522876833, "post_id": 49659836, "comment_id": 86330836, "body": "I think this would be for more clear in your code if you didn&#39;t use a regex. A possible algorithm:  1. find the next key--a word with &#39;=&#39; at the end. 2. find the next key. 3. split the values list from the slice between last index of #1 and first index of #2."}, {"owner": {"reputation": 530, "user_id": 978927, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/daf1ffb2144fd84fe8f39b36d75996bc?s=128&d=identicon&r=PG", "display_name": "Puzzle84", "link": "https://stackoverflow.com/users/978927/puzzle84"}, "edited": false, "score": 0, "creation_date": 1522879725, "post_id": 49659836, "comment_id": 86332130, "body": "We have a ton of parameters that get parsed. i figured it out with the or statement."}], "answers": [{"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 1, "last_activity_date": 1522880699, "creation_date": 1522880699, "answer_id": 49661357, "question_id": 49659836, "link": "https://stackoverflow.com/questions/49659836/parse-comma-seperated-values-in-argumentlist-thats-seperated-by-commas/49661357#49661357", "title": "parse comma seperated values in argumentlist that&#39;s seperated by commas", "body": "<p>You can split on variable names - that will leave only the values:</p>\n\n<pre><code>s := regexp.MustCompile(\"[^,\\\\s]+=\").Split(\"foo=bar,pine=apple,tree,bar=bie\", -1)\nfmt.Println(s)\n# =&gt; [ \"bar\", \"apple,tree\", \"bie\"] \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XY6an7a-VnK\" rel=\"nofollow noreferrer\">Go Demo</a></p>\n\n<p><a href=\"https://regex101.com/r/a7ZrYC/2\" rel=\"nofollow noreferrer\">Regex Demo</a></p>\n"}], "owner": {"reputation": 530, "user_id": 978927, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/daf1ffb2144fd84fe8f39b36d75996bc?s=128&d=identicon&r=PG", "display_name": "Puzzle84", "link": "https://stackoverflow.com/users/978927/puzzle84"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 49661357, "answer_count": 1, "score": 0, "last_activity_date": 1522880699, "creation_date": 1522873617, "last_edit_date": 1522879755, "question_id": 49659836, "link": "https://stackoverflow.com/questions/49659836/parse-comma-seperated-values-in-argumentlist-thats-seperated-by-commas", "title": "parse comma seperated values in argumentlist that&#39;s seperated by commas", "body": "<p>So i have this regex:</p>\n\n<pre><code>=([0-9A-Za-z_-]+),?\n</code></pre>\n\n<p>and i need have a string like:</p>\n\n<pre><code>foo=bar,pine=apple,tree,bar=bie\nor\nfoo=bar,pine=apple,tree\nor \npine=apple,tree\n</code></pre>\n\n<p>the regex works for cases where i only have 1 value.\nbut since we have comma's in the list of values for the key.\nthe regex just craps out and my code does half of what i want it to do but doesn't get the 2nd value.</p>\n\n<p>How do i fix my regex to take both values regardless of where in the string it is?\nalone, between 2 others, at the end.</p>\n\n<p>i tried some stuff but couldn't figure it out.</p>\n\n<p>Attempt 1:</p>\n\n<pre><code>=([0-9A-Za-z,_-]+),=?\n</code></pre>\n\n<p>In this case, it matches the one where it's in the middle but it fails on the others because = does not exist.</p>\n\n<p>Attempt 2:</p>\n\n<pre><code>=[0-9A-Za-z_-]+([,]+[0-9A-Za-z_-]*),?\n</code></pre>\n\n<p>Matches too bar,pine and tree,bar for example</p>\n\n<p>EDIT::</p>\n\n<p>This seems to work maybe....</p>\n\n<pre><code>=('[0-9A-Za-z,_-]+'),*|=([0-9A-Za-z_-]+),*\n</code></pre>\n\n<p>if i use quotes for multi values..</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522869305, "post_id": 49658633, "comment_id": 86326770, "body": "Did you check the error and number of values scanned? See the <a href=\"https://golang.org/pkg/fmt/#hdr-Scanning\" rel=\"nofollow noreferrer\">docs on scanning</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1445, "user_id": 5972487, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/024fcbdd0ee00e2dccefce0ef67bc434?s=128&d=identicon&r=PG", "display_name": "elmiomar", "link": "https://stackoverflow.com/users/5972487/elmiomar"}, "is_accepted": false, "score": 0, "last_activity_date": 1522872285, "creation_date": 1522872285, "answer_id": 49659505, "question_id": 49658633, "link": "https://stackoverflow.com/questions/49658633/take-an-arrary-as-input-in-golang/49659505#49659505", "title": "take an arrary as input in golang", "body": "<p>What you want to use are called <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Slices</a>. </p>\n\n<p>An array has a fixed size: <code>[n]T</code> is an array of <code>n</code> values of type <code>T</code>.</p>\n\n<p>A slice, on the other hand, is a dynamically-sized, and flexible way of representing an array: <code>[]T</code> is a slice with elements of type <code>T</code>.</p>\n\n<p>Slices are more common in the Go world.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    len := 0\n    fmt.Print(\"Enter the number of floats: \")\n    fmt.Scanln(&amp;len)\n    input := make([]float64, len)\n    for i := 0; i &lt; len; i++ {\n        fmt.Print(\"Enter a float: \")\n        fmt.Scanf(\"%f\", &amp;input[i])\n    }\n    fmt.Println(input)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>// Enter the number of floats: 4\n// Enter a float: 3.2\n// Enter a float: -6.77\n// Enter a float: 42\n// Enter a float: -0.9\n// [3.2 -6.77 42 -0.9]\n</code></pre>\n\n<p>I hope this helps!</p>\n"}], "owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "closed_date": 1522872306, "answer_count": 1, "score": -2, "last_activity_date": 1522872285, "creation_date": 1522868958, "question_id": 49658633, "link": "https://stackoverflow.com/questions/49658633/take-an-arrary-as-input-in-golang", "closed_reason": "Duplicate", "title": "take an arrary as input in golang", "body": "<p>How am I goingt take an array as input in golang ?</p>\n\n<pre><code>func main() {\nvar inPut []float32\nfmt.Printf(\"Input? \")\nfmt.Scanf(\"%s\", &amp;inPut)\nfmt.Println(inPut)\n\nfor _, value := range inPut {\n\n    fmt.Print(value)\n }\n}\n</code></pre>\n\n<p>I tried the code above and it doesn't give me the right answer, should I use another type of scanner ? </p>\n\n<p>the input I want to take in is something like  [3.2 -6.77 42 -0.9]</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 596, "user_id": 1983554, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f5a8f555ba614299c1e0de8688d15cc?s=128&d=identicon&r=PG", "display_name": "Karl Pokus", "link": "https://stackoverflow.com/users/1983554/karl-pokus"}, "edited": false, "score": 2, "creation_date": 1545730898, "post_id": 49658483, "comment_id": 94684297, "body": "will <code>doc.time</code> be of type Date in mongo then? Otherwise queries on date will fail."}], "tags": [], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "is_accepted": false, "score": 1, "last_activity_date": 1522868407, "creation_date": 1522868407, "answer_id": 49658483, "question_id": 49657422, "link": "https://stackoverflow.com/questions/49657422/using-time-time-in-mongodb-record/49658483#49658483", "title": "Using time.Time in mongodb record", "body": "<p>You will need to convert the time to either a string or a unix timestamp. \n<code>time.Now()</code> is a type time which is a struct.</p>\n\n<pre><code>a := time.Now()\nfmt.Println(a.Unix()) // Goes into mongodb as a int64\nfmt.Println(a.String()) // Goes inot mongodb as a string\n</code></pre>\n\n<p><code>1522868253</code> // Unix</p>\n\n<p><code>2018-04-04 13:57:33.495965 -0500 CDT m=+0.000363419</code> // String</p>\n\n<p>So you can do this</p>\n\n<pre><code>collection.InsertOne(context.Background(), map[string]interface{}{\n    \"string\":   \"test\",\n    \"integer\":  123,\n    \"float\":    0.123,\n    \"array\":    []string{\"t\", \"e\", \"s\", \"t\"},\n    \"objectid\": objectid.New(),\n    \"time\":     time.Now().String(),\n})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 596, "user_id": 1983554, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f5a8f555ba614299c1e0de8688d15cc?s=128&d=identicon&r=PG", "display_name": "Karl Pokus", "link": "https://stackoverflow.com/users/1983554/karl-pokus"}, "edited": false, "score": 1, "creation_date": 1545732811, "post_id": 49669692, "comment_id": 94684694, "body": "Does <code>bson.EC.DateTime</code> still exist in the beta? I can&#39;t find it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1522922926, "creation_date": 1522922926, "answer_id": 49669692, "question_id": 49657422, "link": "https://stackoverflow.com/questions/49657422/using-time-time-in-mongodb-record/49669692#49669692", "title": "Using time.Time in mongodb record", "body": "<p>If you pass a <code>map</code> as the document to <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.InsertOne\" rel=\"noreferrer\"><code>Collection.InsertOne()</code></a>, the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo\" rel=\"noreferrer\"><code>mongo</code></a> package will use the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#TransformDocument\" rel=\"noreferrer\"><code>mongo.TransformDocument()</code></a> to convert it to a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#Document\" rel=\"noreferrer\"><code>*bson.Document</code></a> value, because most operations are only implemented on <code>bson.Document</code>s.</p>\n\n<p>The current transformation implementation does not handle <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson/objectid#ObjectID\" rel=\"noreferrer\"><code>objectid.ObjectID</code></a> nor the <a href=\"https://golang.org/pkg/time/#Time\" rel=\"noreferrer\"><code>time.Time</code></a> types. It could and probably should, and I assume it will, but currently it doesn't.</p>\n\n<p>If you want these types to end up with proper types in MongoDB, you may construct and pass a <code>*bson.Document</code> yourself, in which you can explicitly dictate what the types of the properties should be.</p>\n\n<p>This is an equivalent insert statement to yours, using <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#NewDocument\" rel=\"noreferrer\"><code>bson.NewDocument()</code></a> to create the document manually:</p>\n\n<pre><code>res, err := coll.InsertOne(context.Background(), bson.NewDocument(\n    bson.EC.String(\"string\", \"test\"),\n    bson.EC.Int64(\"integer\", 123),\n    bson.EC.Double(\"float\", 0.123),\n    bson.EC.ArrayFromElements(\"array\",\n        bson.VC.String(\"t\"), bson.VC.String(\"e\"),\n        bson.VC.String(\"s\"), bson.VC.String(\"t\")),\n    bson.EC.ObjectID(\"objectid\", objectid.New()),\n    bson.EC.DateTime(\"time\", time.Now().UnixNano()/1e6), // Must pass milliseconds\n))\n</code></pre>\n\n<p>It's more verbose, but it's explicit in what we want the result document in MongoDB to be. The result document will look like this:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5ac5f598ca151255c6fc0ffb\"),\n    \"string\" : \"test\",\n    \"integer\" : NumberLong(123),\n    \"float\" : 0.123,\n    \"array\" : [\n        \"t\",\n        \"e\",\n        \"s\",\n        \"t\"\n    ],\n    \"objectid\" : ObjectId(\"5ac5f598ca151255c6fc0ffa\"),\n    \"time\" : ISODate(\"2018-04-05T10:08:24.148Z\")\n}\n</code></pre>\n\n<p>Once the driver improves, I assume your original version will work as expected and produce a document identical to this in structure.</p>\n"}], "owner": {"reputation": 258, "user_id": 3252269, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0c55e6accf3bf243d74ac8d837bdaeef?s=128&d=identicon&r=PG&f=1", "display_name": "maksim", "link": "https://stackoverflow.com/users/3252269/maksim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6234, "favorite_count": 0, "accepted_answer_id": 49669692, "answer_count": 2, "score": 6, "last_activity_date": 1522923291, "creation_date": 1522864354, "last_edit_date": 1522923291, "question_id": 49657422, "link": "https://stackoverflow.com/questions/49657422/using-time-time-in-mongodb-record", "title": "Using time.Time in mongodb record", "body": "<p>I'm inserting new item in collection. Using official mongo go driver for this (<a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"noreferrer\">https://github.com/mongodb/mongo-go-driver</a>).</p>\n\n<pre><code>collection.InsertOne(context.Background(), map[string]interface{}{\n    \"string\":   \"test\",\n    \"integer\":  123,\n    \"float\":    0.123,\n    \"array\":    []string{\"t\", \"e\", \"s\", \"t\"},\n    \"objectid\": objectid.New(),\n    \"time\":     time.Now(),\n})\n</code></pre>\n\n<p>But as a result I have a problem with couple of properties: time.Time and objectid.ObjectID.</p>\n\n<ul>\n<li>time.Time is going as Object that is empty</li>\n<li>objectid.ObjectID - as Binary</li>\n</ul>\n\n<p><a href=\"https://i.stack.imgur.com/Tcr2W.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Tcr2W.png\" alt=\"enter image description here\"></a></p>\n\n<p>I understand that it's only in alpha state, but maybe someone knows. Am I just doing it wrong or it's not yet implemented in the way as it should be?</p>\n"}, {"tags": ["go", "plugins", "interface", "symbols"], "answers": [{"comments": [{"owner": {"reputation": 58, "user_id": 3989411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DTxxo.jpg?s=128&g=1", "display_name": "Roman Odermatt", "link": "https://stackoverflow.com/users/3989411/roman-odermatt"}, "edited": false, "score": 0, "creation_date": 1523021482, "post_id": 49668505, "comment_id": 86400412, "body": "Thank you for this detailed explanation. The solution to return by a public-function seems much prettier than the global var. I will use this method in the future."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1522933389, "last_edit_date": 1522933389, "creation_date": 1522919614, "answer_id": 49668505, "question_id": 49656283, "link": "https://stackoverflow.com/questions/49656283/plugin-symbol-as-function-return/49668505#49668505", "title": "Plugin symbol as function return", "body": "<p>What you want is possible, but there is something in the background that prevents it from working.</p>\n\n<p>This is namely that you want to lookup a <em>variable</em> named <code>Greeter</code> from the plugin. <a href=\"https://golang.org/pkg/plugin/#Plugin.Lookup\" rel=\"nofollow noreferrer\"><code>Plugin.Lookup()</code></a> will return a pointer to this variable! If it wouldn't, you could only inspect its value, but you couldn't change it.</p>\n\n<p>You can verify this by simply printing the type of the value stored in <code>sym</code>:</p>\n\n<pre><code>fmt.Printf(\"%T\\n\", sym)\n</code></pre>\n\n<p>In your first case <code>func getPlugin() testpl</code>, output will be:</p>\n\n<pre><code>*main.testpl\n</code></pre>\n\n<p>In your second case <code>func getPlugin() iface.IPlugin</code>, output will be:</p>\n\n<pre><code>*iface.IPlugin\n</code></pre>\n\n<p>(Yes, it's a pointer to an interface!)</p>\n\n<p>In your third case <code>func getPlugin() interface{}</code>, output will be:</p>\n\n<pre><code>*interface {}\n</code></pre>\n\n<p>So your first example works because the value stored in <code>sym</code> is of type <code>*main.testpl</code>, which also implements <code>iface.IPlugin</code> (because <code>main.testpl</code> implements it, so does the pointer type).</p>\n\n<p>Back to your 2nd example: <code>func getPlugin() iface.IPlugin</code></p>\n\n<p>The value stored in <code>sym</code> is of type <code>*iface.IPlugin</code>. A value of pointer type to interface never satisfies any interfaces (except the empty interface), so attempting to type-assert <code>iface.IPlugin</code> from a value of type <code>*iface.IPlugin</code> will never succeed. You have to type assert <code>*iface.IPlugin</code> type, which you can dereference after to obtain a value of type <code>iface.IPlugin</code>. It could look like this:</p>\n\n<pre><code>pgPtr, ok := sym.(*iface.IPlugin)\nif !ok {\n    panic(errors.New(\"error binding plugin to interface\"))\n}\npg := *pgPtr\n</code></pre>\n\n<p>And now everything works as expected!</p>\n\n<p>To avoid such hassle and confusion, you may implement your plugin to expose a <em>function</em> which returns you the <code>Greeter</code>:</p>\n\n<pre><code>func Greeter() iface.IPlugin { return testpl{} }\n</code></pre>\n\n<p>And then get rid of the <code>Greeter</code> global var of course. If you do this, you may lookup the <code>Greeter</code> symbol which will be of type:</p>\n\n<pre><code>func() iface.IPlugin\n</code></pre>\n\n<p>The difference is that looking up a function does not require the <code>plugin</code> package to return a pointer to the value, while in case of a variable it does. A simple function type, no pointer-to-interface-kung-fu. Using it to obtain the greeter would be:</p>\n\n<pre><code>Greeter, err := p.Lookup(\"Greeter\")\nif err != nil {\n    panic(err)\n}\ngreeterFunc, ok := GetFilter.(func() iface.IPlugin)\nif !ok {\n    panic(errors.New(\"not of expected type\"))\n}\ngreeter := greeterFunc()\n\n// And using it:\nfmt.Printf(\"You're now connected to: %s \\n\", greeter.WhatsYourName())\ngreeter.SayHello(\"user\")\ngreeter.SayGoodby(\"user\")\n</code></pre>\n\n<p>See related / similar question: <a href=\"https://stackoverflow.com/questions/42388090/go-1-8-plugin-use-custom-interface/42389345#42389345\">go 1.8 plugin use custom interface</a></p>\n"}], "owner": {"reputation": 58, "user_id": 3989411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DTxxo.jpg?s=128&g=1", "display_name": "Roman Odermatt", "link": "https://stackoverflow.com/users/3989411/roman-odermatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 49668505, "answer_count": 1, "score": 3, "last_activity_date": 1522933389, "creation_date": 1522860292, "last_edit_date": 1522891703, "question_id": 49656283, "link": "https://stackoverflow.com/questions/49656283/plugin-symbol-as-function-return", "title": "Plugin symbol as function return", "body": "<p>I'm running into a Go behaviour which I don't understand.  My idea is to import a plugin which implements an interface that is out of both packages.  If a struct is returned it works fine, but to be sure it implements the interface, I want to return an interface which fails.</p>\n\n<p>Interface definition:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package iface\n\ntype IPlugin interface{\n   SayHello(string)\n   SayGoodby(string)\n   WhatsYourName() string\n}\n</code></pre>\n\n<p>The main program looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"plugin\"\n    \"plugin_test/iface\"\n    \"errors\"\n    \"fmt\"\n)\n\n//go:generate go build -buildmode=plugin -o ./pg/test.so ./pg/test.go\n\nfunc main(){\n    path := \"pg/test.so\"\n    plug, err := plugin.Open(path)\n    if err != nil {\n        panic(err)\n    }\n\n    sym, err := plug.Lookup(\"Greeter\")\n    if err != nil {\n        panic(err)\n    }\n\n    var pg iface.IPlugin\n    pg, ok := sym.(iface.IPlugin)\n    if !ok {\n        panic(errors.New(\"error binding plugin to interface\"))\n    }\n\n    fmt.Printf(\"You're now connected to: %s \\n\", pg.WhatsYourName())\n    pg.SayHello(\"user\")\n    pg.SayGoodby(\"user\")\n}\n</code></pre>\n\n<p>The plugin (stored in pg/test.go)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"plugin_test/iface\"\n)\n\ntype testpl struct {}\n\nfunc(pl testpl) SayHello(s string){\n    fmt.Printf(\"Plugin says hello to %s \\n\", s)\n}\nfunc(pl testpl) SayGoodby(s string){\n    fmt.Printf(\"Plugin says goodby to %s \\n\", s)\n}\nfunc(pl testpl) WhatsYourName() string{\n    return \"my name is Test-Plugin\"\n}\n\n/* This function works */\nfunc getPlugin() testpl{\n    return testpl{}\n}\n\n/* This function doesn't work */\nfunc getPlugin() iface.IPlugin{\n    return testpl{}\n}\n\n/* This function also doesn't work */\nfunc getPlugin() interface{}{\n    return testpl{}\n}\n\nvar Greeter = getPlugin()\n</code></pre>\n\n<p>I tried every <code>getPlugin</code> function on its own.</p>\n\n<p>The function returning <code>testpl</code> prints the expected output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>You're now connected to: my name is Test-Plugin\nPlugin says hello to user\nPlugin says goodby to user \n</code></pre>\n\n<p>The other functions end on <code>sym.(iface.IPlugin)</code></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>panic: error binding plugin to interface\n\ngoroutine 1 [running]:\nmain.main()\n        /home/../../../main.go:27 +0x343\nexit status 2\n</code></pre>\n\n<p>Can someone explain why this isn't possible? Wouldn't it be easier to create a plugin if it did't let you build your plugin in such a case?</p>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 2, "creation_date": 1522856611, "post_id": 49655191, "comment_id": 86319340, "body": "Out of curiosity, what is the issue you are trying to solve using this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522857197, "post_id": 49655191, "comment_id": 86319759, "body": "Your reflect line takes an interface, dereferences it, takes the address of it, then returns the same interface you started with. I don&#39;t understand what the goal of that is supposed to be"}, {"owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "edited": false, "score": 0, "creation_date": 1522857440, "post_id": 49655191, "comment_id": 86319916, "body": "It looks like you&#39;re trying to shoehorn in polymorphism to a language that doesn&#39;t support it, which is a bit of a code smell. Perhaps your type system isn&#39;t designed in a very go-like way?"}, {"owner": {"reputation": 3, "user_id": 9596869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Gjolly", "link": "https://stackoverflow.com/users/9596869/gjolly"}, "edited": false, "score": 0, "creation_date": 1522858589, "post_id": 49655191, "comment_id": 86320595, "body": "This is typically a wrapper for a Get operation on a database. <code>value</code> is what I get from the db and <code>valuePtr</code> is given by the user. I presume the user knows the type of the value he wants."}, {"owner": {"reputation": 3, "user_id": 9596869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Gjolly", "link": "https://stackoverflow.com/users/9596869/gjolly"}, "reply_to_user": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "edited": false, "score": 0, "creation_date": 1522858694, "post_id": 49655191, "comment_id": 86320660, "body": "@TimothyJones you should be right,"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1522858709, "last_edit_date": 1522858709, "creation_date": 1522857195, "answer_id": 49655434, "question_id": 49655191, "link": "https://stackoverflow.com/questions/49655191/golang-interface-real-type/49655434#49655434", "title": "Golang interface &amp; real type", "body": "<p>Based on the code in the question, it looks like your goal is to set a pointer element to a value. Use this code:</p>\n\n<pre><code>reflect.ValueOf(valuePtr).Elem().Set(reflect.ValueOf(value))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/G5VlDLg3G0O\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>As an aside, the code <code>ptr := reflect.ValueOf(valuePtr).Elem().Addr().Interface().(*string)</code> can be written more directly as <code>ptr := valuePtr.(*string)</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 9596869, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Gjolly", "link": "https://stackoverflow.com/users/9596869/gjolly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 49655434, "answer_count": 1, "score": 0, "last_activity_date": 1522858709, "creation_date": 1522856420, "question_id": 49655191, "link": "https://stackoverflow.com/questions/49655191/golang-interface-real-type", "title": "Golang interface &amp; real type", "body": "<p>Let <code>valuePtr</code> and <code>value</code> be two <code>interface{}</code>. Knowing that <code>valuePtr</code> is a pointer of the type of <code>value</code>, how to make <code>valuePtr</code> points on <code>value</code>?</p>\n\n<p>The \"trick\" I'm using currently works with the <code>reflect</code> package and a type switch:</p>\n\n<pre><code>switch value.(type) {\ncase string:\n    ptr := reflect.ValueOf(valuePtr).Elem().Addr().Interface().(*string)\n    *ptr = value.(string)\ncase ...:\n    [...]\n}\n</code></pre>\n\n<p>This requires one case for each type that can be given to the function. However, I am using <code>interface{}</code> to make things universal. Thus, this technic will eventually lead to a situation where dozens of types will be listed.</p>\n\n<p>What I am trying to do is something like:</p>\n\n<pre><code>ptr := valuePtr.(*type(value))\n</code></pre>\n\n<p>Did you face this issue? What did you do?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1522855631, "post_id": 49654876, "comment_id": 86318581, "body": "It&#39;s generally best to keep the code in the <code>main</code> package and <code>main()</code> function minimal so that testing is unnecessary; basically, the only code in <code>main</code> should be calling into the entry point in another package (which can then be covered by tests as needed)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1522860263, "post_id": 49654876, "comment_id": 86321564, "body": "Don&#39;t update your question with the answer--just accept the correct answer."}], "answers": [{"comments": [{"owner": {"reputation": 602, "user_id": 2042773, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/e5oEP.png?s=128&g=1", "display_name": "kousha", "link": "https://stackoverflow.com/users/2042773/kousha"}, "edited": false, "score": 2, "creation_date": 1546899007, "post_id": 49655458, "comment_id": 94998586, "body": "The thing here is if you run <code>go test -cover</code> for that code you will get: <code>coverage: 50.0% of statements </code>"}], "tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 1, "last_activity_date": 1522857285, "creation_date": 1522857285, "answer_id": 49655458, "question_id": 49654876, "link": "https://stackoverflow.com/questions/49654876/covering-code-in-main-function-with-unit-tests/49655458#49655458", "title": "Covering code in main function with unit tests", "body": "<p>Test files usually are directly next to the code they test. Depending on the size of your project you don't have to extract your sum function into another package just to test it and it also doesn't have to be public:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nfunc main() {\n    sum()\n}\n\nfunc sum() int {\n    return 5 + 5\n}\n</code></pre>\n\n<p><strong>main_test.go</strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc TestSum(t *testing.T) {\n    total := sum()\n    if total != 10 {\n        t.Fail()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1293, "favorite_count": 0, "accepted_answer_id": 49655458, "answer_count": 1, "score": 1, "last_activity_date": 1522860275, "creation_date": 1522855514, "last_edit_date": 1522860275, "question_id": 49654876, "link": "https://stackoverflow.com/questions/49654876/covering-code-in-main-function-with-unit-tests", "title": "Covering code in main function with unit tests", "body": "<p>Golang show that I have only 50% of covering code, and as I see code in main is not covered, I've tried to search but not found anything with explanations how to cover code in main.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nfunc Sum(x int, y int) int {\n    return x + y\n}\n\nfunc main() {\n    Sum(5, 5)\n}\n</code></pre>\n\n<p><strong>main_test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc TestSum(t *testing.T) {\n    total := Sum(5, 5)\n    if total != 10 {\n        t.Fail()\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "directory-structure"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1522854866, "post_id": 49654346, "comment_id": 86318040, "body": "You should probably start by reading through <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>. Go projects generally use a <code>testdata</code> directory for test data since that is ignored by the build tools. You should also <i>never</i> have any non-test paths that are relative to the program source, as the location of the source is completely irrelevant to the working directory of the executable."}], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 7752659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-hzkAu0lMAVI/AAAAAAAAAAI/AAAAAAAAAPw/DYH04TIw8Ck/photo.jpg?sz=128", "display_name": "Shoshin Nikita", "link": "https://stackoverflow.com/users/7752659/shoshin-nikita"}, "edited": false, "score": 0, "creation_date": 1522854767, "post_id": 49654461, "comment_id": 86317965, "body": "Does it meant that I should submit the path to function? For example, getConfig() -&gt; getConfig(path). Now I have constant path in body of function."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 363, "user_id": 7752659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-hzkAu0lMAVI/AAAAAAAAAAI/AAAAAAAAAPw/DYH04TIw8Ck/photo.jpg?sz=128", "display_name": "Shoshin Nikita", "link": "https://stackoverflow.com/users/7752659/shoshin-nikita"}, "edited": false, "score": 0, "creation_date": 1522855068, "post_id": 49654461, "comment_id": 86318199, "body": "Relative paths are resolved to an absolute path using the working directory.  There&#39;s no relationship between what the working directory might be and the source directory. In fact, the source directory may not be present locally when the application is run.  Pass a path as an argument or use an absolute path. It&#39;s usually easier to specify the path."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1522854667, "last_edit_date": 1522854667, "creation_date": 1522854353, "answer_id": 49654461, "question_id": 49654346, "link": "https://stackoverflow.com/questions/49654346/structure-of-go-project/49654461#49654461", "title": "Structure of Go project", "body": "<p>The go test command sets the <a href=\"https://en.wikipedia.org/wiki/Working_directory\" rel=\"nofollow noreferrer\">working directory</a> to the directory containing the package source files. For example, the config tests are run with the working directory set to <code>project/src/config</code>:</p>\n\n<p>Use paths relative to that directory from tests:  </p>\n\n<p>A test in the first variant should open files like this:</p>\n\n<pre><code> f, err := os.Open(\"data/config.json\")\n if err != nil {\n     // handle error\n }\n</code></pre>\n\n<p>A test in the second variant should should open files like this:</p>\n\n<pre><code> f, err := os.Open(\"../../data/config.json\")\n if err != nil {\n     // handle error\n }\n</code></pre>\n\n<p>(the important point here is the relative path, not that os.Open is used).</p>\n"}], "owner": {"reputation": 363, "user_id": 7752659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-hzkAu0lMAVI/AAAAAAAAAAI/AAAAAAAAAPw/DYH04TIw8Ck/photo.jpg?sz=128", "display_name": "Shoshin Nikita", "link": "https://stackoverflow.com/users/7752659/shoshin-nikita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 49654461, "answer_count": 1, "score": -1, "last_activity_date": 1522857306, "creation_date": 1522854051, "last_edit_date": 1522857306, "question_id": 49654346, "link": "https://stackoverflow.com/questions/49654346/structure-of-go-project", "title": "Structure of Go project", "body": "<p>My program uses several files like *.json, *.db</p>\n\n<p>How should i place they? First variant:</p>\n\n<pre><code>project\n    |-&gt; src\n        |-&gt; main\n            | main.go\n            | main_test.go\n            |-&gt; data\n                | database.db\n        |-&gt; config\n            | config.go\n            |-&gt; data\n                | config.json\n        ...\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>project\n    |-&gt; src\n        |-&gt; main\n            | main.go\n            | main_test.go\n        |-&gt; config\n            | config.go\n        ...\n    |-&gt; data\n        | database.db\n        | config.json\n</code></pre>\n\n<p>I would prefer second variant, but I get troubles when try to write tests. I tried to use \"/absolute/path\", but it doesn't work, because it points to \".../src/main/ folder.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "edited": false, "score": 0, "creation_date": 1522853491, "post_id": 49653926, "comment_id": 86316983, "body": "Thank you very much! I couldn&#39;t guess to make standard conversion for custom types."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1522853231, "last_edit_date": 1522853231, "creation_date": 1522852823, "answer_id": 49653926, "question_id": 49653870, "link": "https://stackoverflow.com/questions/49653870/how-can-i-convert-same-signatured-types-accross-each-other-in-golang/49653926#49653926", "title": "How can I convert same signatured types accross each other in golang?", "body": "<p>The question uses a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>.  A type assertion asserts that an interface value is a specific type.  It does not convert types.</p>\n\n<p>Use a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> to convert between the types:</p>\n\n<pre><code>var v1 MyType\nvar v2 logrus.Fields\n\nv2 = logrus.Fields(v1)\nv1 = MyType(v2)\n</code></pre>\n\n<p>If you have a function that can accept either type, use a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a> and then convert each specific type:</p>\n\n<pre><code>func newAction(data interface{}) {\n    var df logrus.Fields\n    switch v := data.(type) {\n    case logur.Fields:\n        df = v\n    case MyType:\n        df = logrus.Fields(v)\n    default:\n        // handle error\n    }\n    ... do something with df\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 49653926, "answer_count": 1, "score": 0, "last_activity_date": 1522853231, "creation_date": 1522852673, "question_id": 49653870, "link": "https://stackoverflow.com/questions/49653870/how-can-i-convert-same-signatured-types-accross-each-other-in-golang", "title": "How can I convert same signatured types accross each other in golang?", "body": "<p>I want to convert from;</p>\n\n<pre><code>type MyType map[string]interface{}\n</code></pre>\n\n<p>to;</p>\n\n<pre><code>logrus.Fields // map[string]interface{}\n</code></pre>\n\n<p>My code is;</p>\n\n<pre><code>func newAction(data interface{}) { // data comes as 'MyType'\n    df := data.(logrus.Fields)\n}\n</code></pre>\n\n<p>I take this error;</p>\n\n<pre><code>interface conversion: interface {} is MyType, not logrus.Fields\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1522849754, "post_id": 49652575, "comment_id": 86313882, "body": "You&#39;ll have to do it yourself, instead of depending on a printf verb"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1522849957, "post_id": 49652575, "comment_id": 86314072, "body": "@Flimzy Can you give an example?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1522851794, "post_id": 49652575, "comment_id": 86315579, "body": "Looks like what you want happens to be JSON encoding, so use the encoding/json package."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522852827, "post_id": 49652575, "comment_id": 86316471, "body": "@Peter Any link or hint how to use encoding/json together with sqlx?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1522853577, "post_id": 49652575, "comment_id": 86317059, "body": "This has nothing to do with sqlx. You want to format a map[string]interface{}. The fact that you fill it with MapScan is irrelevant. encoding/json is <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">documented on golang.org</a>, like every other package in the standard library."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522854206, "post_id": 49652575, "comment_id": 86317542, "body": "I am stuck being a total newbie. Something like     json.Unmarshal([]byte(results]), &amp;results). Or can you be more specific?"}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522914208, "post_id": 49656559, "comment_id": 86343386, "body": "Thank you for this exhaustive answer!  It sure points me in the right direction, but there still are some minor issues. Look at my updated question."}, {"owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522954105, "post_id": 49656559, "comment_id": 86370527, "body": "Your updated question is unrelated to your initial question, I recommend you ask a new question."}, {"owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522955277, "post_id": 49656559, "comment_id": 86371175, "body": "Oh, I didn&#39;t see that you were writing to a specific <code>Writer</code> in your original question. I&#39;ve edited my answer."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522991243, "post_id": 49656559, "comment_id": 86382540, "body": "Yes! it works better. Thank you! But numeric values does not encode correct: &quot;QTY&quot;:&quot;MS4wMA==&quot;. How come?"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1523025815, "post_id": 49656559, "comment_id": 86403322, "body": "Though this not solved my entire problem, it was an exact answer to my question. Thank you!"}], "tags": [], "owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "is_accepted": true, "score": 5, "last_activity_date": 1522955296, "last_edit_date": 1522955296, "creation_date": 1522861225, "answer_id": 49656559, "question_id": 49652575, "link": "https://stackoverflow.com/questions/49652575/how-can-i-print-out-a-mapstringinterface-as-json/49656559#49656559", "title": "How can I print out a map[string]interface{} as json?", "body": "<p>If you want to format your output as JSON, it's better to use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>json</code></a> package.  There's a well-written introduction to json handling <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">in this blog post</a>, but generally the <code>Marshal</code> function is happy to take a map of <code>map[string]interface{}</code> where <code>interface{}</code> is any other type that it is able to marshal:</p>\n\n<pre><code>b, err := json.Marshal(m)\n</code></pre>\n\n<p>This returns a byte array, so you'll need to convert it to a string:</p>\n\n<pre><code>m := map[string]string{\n    \"USER_ID\":\"JD\", \n    \"USER_NAME\":\"John Doe\",\n}\nb, err := json.Marshal(m)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(string(b))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rffsuI4BL35\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rffsuI4BL35</a></p>\n\n<p>However, since you know that you're just going to print out the encoded result, it's probably better to use a streamed encoder:</p>\n\n<pre><code>m := map[string]string{\n    \"USER_ID\":\"JD\", \n    \"USER_NAME\":\"John Doe\",\n}\nenc := json.NewEncoder(os.Stdout)\n\nif err := enc.Encode(m); err != nil {\n        log.Fatal(err)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/l2-BOUK3yn9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/l2-BOUK3yn9</a></p>\n\n<p>For your code, it looks like this:</p>\n\n<pre><code>enc := json.NewEncoder(w)\nrows, err = db.Queryx(query)\n// Note: you should check err here\n\nfor rows.Next() {\n    results := make(map[string]interface{})\n    err = rows.MapScan(results)\n    // Note: You should check err here       \n\n    if err := enc.Encode(results); err != nil {\n         // Whatever you want to do in an encoding error\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5684, "favorite_count": 0, "accepted_answer_id": 49656559, "answer_count": 1, "score": 2, "last_activity_date": 1522955296, "creation_date": 1522849293, "last_edit_date": 1522914028, "question_id": 49652575, "link": "https://stackoverflow.com/questions/49652575/how-can-i-print-out-a-mapstringinterface-as-json", "title": "How can I print out a map[string]interface{} as json?", "body": "<p>I have a problem with formatting when using <code>sqlx</code> </p>\n\n<pre><code>rows, err = db.Queryx(query)\nfor rows.Next() {\n    results := make(map[string]interface{})\n    err = rows.MapScan(results)\n    fmt.Fprintf(w,\"%#v \\n\", results)\n}\n</code></pre>\n\n<p>The output when using <strong>%#v</strong></p>\n\n<pre><code>fmt.Fprintf(w,\"%#v \\n\", results)\n</code></pre>\n\n<blockquote>\n  <p>map[string]interface {}{\"USER_ID\u201d:\u201dJD\u201d, \"USER_NAME\u201d:\u201dJohn Doe\u201d}</p>\n  \n  <p>map[string]interface {}{\"USER_ID\u201d:\u201dJAD\u201d, \"USER_NAME\u201d:\u201dJane Doe\u201d} </p>\n  \n  <p>map[string]interface {}{\"USER_ID\u201d:\u201dDD\u201d, \"USER_NAME\u201d:\u201dDonald Duck\u201d}</p>\n</blockquote>\n\n<p>Using only <strong>%v</strong></p>\n\n<pre><code>fmt.Fprintf(w,\"%v \\n\", results)\n</code></pre>\n\n<blockquote>\n  <p>map[USER_ID:JD USER_NAME:John Doe]</p>\n  \n  <p>map[USER_ID:JAD USER_NAME:Jane Doe]</p>\n  \n  <p>map[USER_ID:DD USER_NAME:Donald Duck]</p>\n</blockquote>\n\n<p>The desired output is to get rid of <strong>map[string]interface {}</strong></p>\n\n<blockquote>\n  <p>{\"USER_ID\u201d:\u201dJD\u201d, \"USER_NAME\u201d:\u201dJohn Doe\u201d}</p>\n  \n  <p>{\"USER_ID\u201d:\u201dJAD\u201d, \"USER_NAME\u201d:\u201dJane Doe\u201d} </p>\n  \n  <p>{\"USER_ID\u201d:\u201dDD\u201d, \"USER_NAME\u201d:\u201dDonald Duck\u201d}</p>\n</blockquote>\n\n<p>Is this possible?</p>\n\n<p><strong>EDIT USING JSON</strong></p>\n\n<p>According to @Timothy Jones I have updated the main code and it work as expected. Except that the result is printed to the TERMINAL and not browser.</p>\n\n<pre><code>rows, err = db.Queryx(query)\n  for rows.Next() {\n    results := make(map[string]interface{})\n    err = rows.MapScan(results)\n    if err := enc.Encode(results); err != nil {\n      fmt.Fprintf(w,\"%s\\n\", results)\n    }\n  }\n</code></pre>\n\n<blockquote>\n  <p>{\"USER_ID\u201d:\u201dJD\u201d,\u201dUSER_NAME\u201d:\u201dJohn Doe\u201d}</p>\n  \n  <p>{\"USER_ID\u201d:\u201dJAD\u201d,\u201dUSER_NAME\u201d:\u201dJane Doe\u201d}</p>\n  \n  <p>{\"USER_ID\u201d:\u201dDD\u201d,\u201dUSER_NAME\u201d:\u201dDonald Duck\u201d}</p>\n</blockquote>\n\n<p>Removing the error handling just to test. It shows wrong results, but are printed to the BROWSER as it should.</p>\n\n<pre><code>rows, err = db.Queryx(query)\nfor rows.Next() {\n  results := make(map[string]interface{})\n  err = rows.MapScan(results)\n  enc.Encode(results)\n  fmt.Fprintf(w,\"%s\\n\", results)\n}\n</code></pre>\n\n<blockquote>\n  <p>map[USER_ID:JD USER_NAME:John Doe] </p>\n  \n  <p>map[USER_ID:JAD USER_NAME:Jane Doe]</p>\n  \n  <p>map[USER_ID:DD USER_NAME:Donald Duck]</p>\n</blockquote>\n\n<p>One question remains. How do I print the correct result to the BROWSER?</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 2531, "user_id": 721616, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5990dc71908d05dc416b75d9fac6bb6a?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/721616/david"}, "edited": false, "score": 0, "creation_date": 1522838220, "post_id": 49648708, "comment_id": 86305633, "body": "Thanks for your reasoning. It is quite clear. Would you please be kind again to give some hint or suggestion on what&#39;s the right golang tooling to address this kind of issue, say, resources leaks"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2531, "user_id": 721616, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5990dc71908d05dc416b75d9fac6bb6a?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/721616/david"}, "edited": false, "score": 0, "creation_date": 1522838428, "post_id": 49648708, "comment_id": 86305776, "body": "@David That part of the question is off-topic for Stack Overflow, but see edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1522912206, "last_edit_date": 1522912206, "creation_date": 1522837658, "answer_id": 49648708, "question_id": 49648380, "link": "https://stackoverflow.com/questions/49648380/is-there-a-resource-leak-here/49648708#49648708", "title": "Is there a resource leak here?", "body": "<p>Yes, you are right (for reference, here's the <a href=\"https://talks.golang.org/2012/concurrency.slide#48\" rel=\"nofollow noreferrer\">link to the slide</a>). In the above code only one launched goroutine will terminate, the rest will hang on attempting to send on channel <code>c</code>.</p>\n\n<p>Detailing:</p>\n\n<ul>\n<li><code>c</code> is an unbuffered channel</li>\n<li>there is only a single receive operation, in the <code>return</code> statement</li>\n<li>A new goroutine is launched for each element of <code>replicas</code></li>\n<li>each launched goroutine sends a value on channel <code>c</code></li>\n<li>since there is only 1 receive from it, one goroutine will be able to send a value on it, the rest will block forever</li>\n</ul>\n\n<p>Note that depending on the number of elements of <code>replicas</code> (which is <code>len(replicas)</code>):</p>\n\n<ul>\n<li>if it's <code>0</code>: <code>First()</code> would block forever (no one sends anything on <code>c</code>)</li>\n<li>if it's <code>1</code>: would work as expected</li>\n<li>if it's <code>&gt; 1</code>: then it leaks resources</li>\n</ul>\n\n<p>The following modified version will not leak goroutines, by using a non-blocking send (with the help of <code>select</code> with <code>default</code> branch):</p>\n\n<pre><code>searchReplica := func(i int) {\n    select {\n    case c &lt;- replicas[i](query):\n    default:\n    }\n}\n</code></pre>\n\n<p>The first goroutine ready with the result will send it on channel <code>c</code> which will be received by the goroutine running <code>First()</code>, in the <code>return</code> statement. All other goroutines when they have the result will attempt to send on the channel, and \"seeing\" that it's not ready (send would block because nobody is ready to receive from it), the <code>default</code> branch will be chosen, and thus the goroutine will end normally.</p>\n\n<p>Another way to fix it would be to use a buffered channel:</p>\n\n<pre><code>c := make(chan Result, len(replicas))\n</code></pre>\n\n<p>And this way the send operations would not block. And of course only one (the first sent) value will be received from the channel and returned.</p>\n\n<p>Note that the solution with any of the above fixes would still block if <code>len(replicas)</code> is <code>0</code>. To avoid that, <code>First()</code> should check this explicitly, e.g.:</p>\n\n<pre><code>func First(query string, replicas ...Search) Result {\n    if len(replicas) == 0 {\n        return Result{}\n    }\n    // ...rest of the code...\n}\n</code></pre>\n\n<p>Some tools / resources to detect leaks:</p>\n\n<ul>\n<li><a href=\"https://github.com/fortytw2/leaktest\" rel=\"nofollow noreferrer\">https://github.com/fortytw2/leaktest</a></li>\n<li><a href=\"https://github.com/zimmski/go-leak\" rel=\"nofollow noreferrer\">https://github.com/zimmski/go-leak</a></li>\n<li><a href=\"https://medium.com/golangspec/goroutine-leak-400063aef468\" rel=\"nofollow noreferrer\">https://medium.com/golangspec/goroutine-leak-400063aef468</a></li>\n<li><a href=\"https://blog.minio.io/debugging-go-routine-leaks-a1220142d32c\" rel=\"nofollow noreferrer\">https://blog.minio.io/debugging-go-routine-leaks-a1220142d32c</a></li>\n</ul>\n"}], "owner": {"reputation": 2531, "user_id": 721616, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/5990dc71908d05dc416b75d9fac6bb6a?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/721616/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 3, "accepted_answer_id": 49648708, "answer_count": 1, "score": 5, "last_activity_date": 1522912206, "creation_date": 1522836637, "last_edit_date": 1522838844, "question_id": 49648380, "link": "https://stackoverflow.com/questions/49648380/is-there-a-resource-leak-here", "title": "Is there a resource leak here?", "body": "<pre><code>func First(query string, replicas ...Search) Result {\n  c := make(chan Result)\n  searchReplica := func(i int) {\n    c &lt;- replicas[i](query)\n  }\n  for i := range replicas {\n    go searchReplica(i)\n  }\n  return &lt;-c\n}\n</code></pre>\n\n<p>This function is from the slides of Rob Pike on go concurrency patterns in 2012. I think there is a resource leak in this function. As the function return after the first send &amp; receive pair happens on channel c, the other go routines try to send on channel c. So there is a resource leak here. Anyone knows golang well can confirm this? And how can I detect this leak using what kind of golang tooling?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "is_accepted": true, "score": 0, "last_activity_date": 1522839740, "creation_date": 1522839740, "answer_id": 49649351, "question_id": 49647830, "link": "https://stackoverflow.com/questions/49647830/how-to-get-the-data-according-to-the-data-entered-in-the-query-string-in-golang/49649351#49649351", "title": "how to get the data according to the data entered in the query string in golang?", "body": "<p>I made the solution </p>\n\n<pre><code>value:= c.Query(\"keyword\")\nfmt.Println(value)\nresponse := ResponseControllerList{}\nname := strings.Replace(value, \" \", \"|\", -1)\nconditions := bson.M{\"$or\": []bson.M{\n    bson.M{\"first_name\":bson.RegEx{\"(?i).*\"+name+\".*\", \"i\"} },\n    bson.M{\"last_name\": bson.RegEx{ \"(?i).*\"+name+\".*\", \"i\"} },\n    bson.M{\"email\": bson.RegEx{\".*\" + value, \"i\"}},\n    bson.M{\"phone_number\": bson.RegEx{\".*\" + value, \"i\"}},\n}}\n</code></pre>\n\n<p>change in the query</p>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 49649351, "answer_count": 1, "score": 0, "last_activity_date": 1523851042, "creation_date": 1522835176, "last_edit_date": 1523851042, "question_id": 49647830, "link": "https://stackoverflow.com/questions/49647830/how-to-get-the-data-according-to-the-data-entered-in-the-query-string-in-golang", "title": "how to get the data according to the data entered in the query string in golang?", "body": "<p>I'm retrieving the data from the collection in mongodb matches to the data enter in the query string using golang.</p>\n\n<p>There are two cases</p>\n\n<p><strong>case 1</strong></p>\n\n<p>Suppose if user search the single field like <code>first_name</code>, <code>last_name</code> etc. Then the data will be retrieve by hitting the url <code>http://localhost:8080/api/v1/customer?keyword=puneet</code> </p>\n\n<p><strong>case 2</strong></p>\n\n<p>In case 2 suppose we have the two fields in collection of mongodb for example <code>first_name : puneet</code>, <code>last_name : jindal</code>,etc. If the user will enter the two fields in the query string <code>first_name</code> and <code>last_name</code> </p>\n\n<p>Example hitting the url like <code>http://localhost:8080/api/v1/customer?keyword=puneet%20kumar</code> then there is no data retrieval.</p>\n\n<p>I have tried the following  code for this. But not success</p>\n\n<p>Struct for this is:</p>\n\n<pre><code>type Customer struct {\n  Id          int    `json:\"id\" bson:\"_id\"`\n  Name        string `json:\"name\" bson:\"name\"`\n  FirstName   string `json:\"first_name\" bson:\"first_name\"`\n  LastName    string `json:\"last_name\" bson:\"last_name\"`\n  Email       string `json:\"email\" bson:\"email\"`\n  PhoneNumber string `json:\"phone_number\" bson:\"phone_number\"`\n}\n</code></pre>\n\n<p>Function for retrieving the data:</p>\n\n<pre><code>func GetCustomers(c *gin.Context) {\nvalue:= c.Query(\"keyword\")\nfmt.Println(value)\nresponse := ResponseControllerList{}\nconditions := bson.M{\"$or\": []bson.M{\n    bson.M{\"first_name\": bson.RegEx{\".*\" + value, \"i\"}},\n    bson.M{\"last_name\": bson.RegEx{\".*\" + value, \"i\"}},\n    bson.M{\"email\": bson.RegEx{\".*\" + value, \"i\"}},\n    bson.M{\"phone_number\": bson.RegEx{\".*\" + value, \"i\"}},\n}}\ndata, err := models.GetCustomerListing(conditions)\nif err != nil {\n    response = ResponseControllerList{\n        config.FailureCode,\n        config.FailureFlag,\n        config.FailureMsg,\n        nil,\n        nil,\n    }\n} else {\n    response = ResponseControllerList{\n        config.SuccessFlag,\n        config.SuccessFlag,\n        config.SuccessMsg,\n        data,\n        nil,\n    }\n}\nGetResponseList(c, response)\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1522835258, "post_id": 49647653, "comment_id": 86303627, "body": "Its like asking how int can be exposed if not written as Int or why you can access len. That stuf is <i>built</i> <i>into</i> the language itself."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1522834913, "creation_date": 1522834913, "answer_id": 49647720, "question_id": 49647653, "link": "https://stackoverflow.com/questions/49647653/how-error-interface-is-exposed-outside-when-starts-with-small-letter-in-go/49647720#49647720", "title": "How error interface is exposed outside when starts with small letter in GO?", "body": "<p><a href=\"https://golang.org/pkg/builtin/#error\" rel=\"nofollow noreferrer\"><code>error</code></a> is a builtin type just like <code>int</code>, <code>bool</code>, <code>string</code> etc. I guess you've never wondered why <code>int</code> is available despite starting with a lowecased letter.</p>\n\n<p>Builtin types are <a href=\"https://golang.org/ref/spec#Predeclared_identifiers\" rel=\"nofollow noreferrer\">predeclared identifiers</a>, they are implicitly declared in the <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow noreferrer\">universe block</a> and so available everywhere without any imports or qualifiers.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1522834985, "creation_date": 1522834985, "answer_id": 49647748, "question_id": 49647653, "link": "https://stackoverflow.com/questions/49647653/how-error-interface-is-exposed-outside-when-starts-with-small-letter-in-go/49647748#49647748", "title": "How error interface is exposed outside when starts with small letter in GO?", "body": "<p><code>error</code> is a special case, defined <a href=\"https://golang.org/ref/spec#Errors\" rel=\"nofollow noreferrer\">in the language spec</a>:</p>\n\n<blockquote>\n  <p>The predeclared type error is defined as</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n  \n  <p>It is the conventional interface for representing an error condition, with the nil value representing no error. For instance, a function to read data from a file might be defined:</p>\n\n<pre><code>func Read(f *File, b []byte) (n int, err error)\n</code></pre>\n</blockquote>\n\n<p>As historical trivia, in a pre-release version of Go, it was part of a standard library package, but this lead to a dependency nightmare, so they made it a special case.</p>\n"}], "owner": {"reputation": 541, "user_id": 8407160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ATLGJ.png?s=128&g=1", "display_name": "Akshay Naik", "link": "https://stackoverflow.com/users/8407160/akshay-naik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 49647720, "answer_count": 2, "score": 0, "last_activity_date": 1522834985, "creation_date": 1522834738, "question_id": 49647653, "link": "https://stackoverflow.com/questions/49647653/how-error-interface-is-exposed-outside-when-starts-with-small-letter-in-go", "title": "How error interface is exposed outside when starts with small letter in GO?", "body": "<p>In the GO language specification its said things which needs to be exported outside package must starts with capital letter. I am wondering how <code>error</code> interface is exposed outside and can be accessible anywhere even though it starts with small letter  unlike other interfaces starts with capital letter like <code>Stringer</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1522835514, "post_id": 49647387, "comment_id": 86303794, "body": "What do you expect? You are deliberately calling <code>panic(err)</code> if the request Body is not JSON. Just opening a URL in a browser won&#39;t send JSON magically."}], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 2, "last_activity_date": 1522840731, "creation_date": 1522840731, "answer_id": 49649632, "question_id": 49647387, "link": "https://stackoverflow.com/questions/49647387/http-panic-serving-127-0-0-148286-eof/49649632#49649632", "title": "http: panic serving 127.0.0.1:48286: EOF", "body": "<p>As mentioned in the comments by Volker you are currently panic'ing when you don't receive json according to your spec - it's safe to assume this should not be the case, so do some proper error handling.</p>\n\n<hr>\n\n<p>Nonetheless you're code is currently working, assuming you have something similar to this struct:</p>\n\n<pre><code>type ip struct {\n    Ip string `json:\"ip\"`\n}\n</code></pre>\n\n<p>You can post content matching this struct:</p>\n\n<pre><code>curl -d '{\"ip\":\"128.0.0.1\"}' -H \"Content-Type: application/json\" -X POST http://localhost:8000/\n</code></pre>\n\n<p>This will return:</p>\n\n<pre><code>{\"status\":1}\n</code></pre>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 0, "closed_date": 1522850833, "accepted_answer_id": 49649632, "answer_count": 1, "score": -5, "last_activity_date": 1522840731, "creation_date": 1522834050, "last_edit_date": 1522834362, "question_id": 49647387, "link": "https://stackoverflow.com/questions/49647387/http-panic-serving-127-0-0-148286-eof", "closed_reason": "Not suitable for this site", "title": "http: panic serving 127.0.0.1:48286: EOF", "body": "<p>Here is my code (it's a simple web server in golang) : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    \"io\"\n    \"github.com/gorilla/mux\"\n    \"encoding/json\"\n    \"strconv\"\n\n    \"io/ioutil\"\n    \"os\"\n)\n\nvar (\n    Trace   *log.Logger\n    Info    *log.Logger\n    Warning *log.Logger\n    Error   *log.Logger\n    Response string\n)\n\nfunc Init(\n    traceHandle io.Writer,\n    infoHandle io.Writer,\n    warningHandle io.Writer,\n    errorHandle io.Writer) {\n\n    Trace = log.New(traceHandle,\n        \"TRACE: \",\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Info = log.New(infoHandle,\n        \"INFO: \",\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Warning = log.New(warningHandle,\n        \"WARNING: \",\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Error = log.New(errorHandle,\n        \"ERROR: \",\n        log.Ldate|log.Ltime|log.Lshortfile)\n}\n\ntype check_geo_send struct {\n    Status int `json:\"status\"`\n}\n\nfunc checkGeo(w http.ResponseWriter, r *http.Request) {\n    var ipdata ip\n    decoder := json.NewDecoder(r.Body)\n\n    err := decoder.Decode(&amp;ipdata)\n    fmt.Println(ipdata.Ip)\n    checkErr(err)\n    var data_send check_geo_send\n    data_send.Status = 1\n    data_json, _ := json.Marshal(data_send)\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Header().Set(\"Content-Length\", strconv.Itoa(len(data_json))) //len(dec)\n    w.Write(data_json)\n}\n\nfunc checkErr(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc main() {\n    Init(ioutil.Discard, os.Stdout, os.Stdout, os.Stderr)\n    r := mux.NewRouter()\n    Info.Println(\"1\")\n    r.HandleFunc(\"/\", checkGeo)\n    http.Handle(\"/\", r)\n    err := http.ListenAndServe(\":8000\", nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>and after I made a local tunnel: </p>\n\n<pre><code>lt --port 8000\n</code></pre>\n\n<p>that give me something like:</p>\n\n<pre><code>https://proud-chipmunk-52.localtunnel.me\n</code></pre>\n\n<p>But when I try to open the URL with my browser I have this error: </p>\n\n<pre><code>INFO: 2018/04/04 11:19:03 Orchestra.go:85: 1\n2018/04/04 11:19:08 http: panic serving 127.0.0.1:48286: EOF\ngoroutine 22 [running]:\nnet/http.(*conn).serve.func1(0xc420128280)\n    /usr/lib/go-1.10/src/net/http/server.go:1726 +0xd0\npanic(0x6884a0, 0xc420010070)\n    /usr/lib/go-1.10/src/runtime/panic.go:505 +0x229\nmain.checkErr(0x719940, 0xc420010070)\n    /home/bussiere/Workspace/Alexa/Orchestra.go:79 +0x4a\nmain.checkGeo(0x71c7a0, 0xc420188000, 0xc42013c600)\n    /home/bussiere/Workspace/Alexa/Orchestra.go:65 +0x175\nnet/http.HandlerFunc.ServeHTTP(0x6f8458, 0x71c7a0, 0xc420188000, 0xc42013c600)\n    /usr/lib/go-1.10/src/net/http/server.go:1947 +0x44\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc42010e000, 0x71c7a0, 0xc420188000, 0xc42013c600)\n    /home/bussiere/go/packages/src/github.com/gorilla/mux/mux.go:159 +0xed\nnet/http.(*ServeMux).ServeHTTP(0x86d720, 0x71c7a0, 0xc420188000, 0xc42013c400)\n    /usr/lib/go-1.10/src/net/http/server.go:2337 +0x130\nnet/http.serverHandler.ServeHTTP(0xc420082ea0, 0x71c7a0, 0xc420188000, 0xc42013c400)\n    /usr/lib/go-1.10/src/net/http/server.go:2694 +0xbc\nnet/http.(*conn).serve(0xc420128280, 0x71ca20, 0xc42012e540)\n    /usr/lib/go-1.10/src/net/http/server.go:1830 +0x651\ncreated by net/http.(*Server).Serve\n    /usr/lib/go-1.10/src/net/http/server.go:2795 +0x27b\n</code></pre>\n\n<p>Maybe because it's using https but I don't have any clue of what is causing this bug.</p>\n"}, {"tags": ["python", "go", "numbers", "division"], "comments": [{"owner": {"reputation": 1292, "user_id": 1887634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57d96d668a832a01e56fae26fc8859bc?s=128&d=identicon&r=PG", "display_name": "Alan", "link": "https://stackoverflow.com/users/1887634/alan"}, "edited": false, "score": 1, "creation_date": 1522832133, "post_id": 49646574, "comment_id": 86301467, "body": "I think you are missing a decimal point in your v2 variable?"}, {"owner": {"reputation": 17, "user_id": 3675730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da41922ce59030cfc052bf606c7a93e?s=128&d=identicon&r=PG&f=1", "display_name": "user3675730", "link": "https://stackoverflow.com/users/3675730/user3675730"}, "reply_to_user": {"reputation": 1292, "user_id": 1887634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57d96d668a832a01e56fae26fc8859bc?s=128&d=identicon&r=PG", "display_name": "Alan", "link": "https://stackoverflow.com/users/1887634/alan"}, "edited": false, "score": 0, "creation_date": 1522832437, "post_id": 49646574, "comment_id": 86301693, "body": "@Alan, Thanks for your quick answer. Exactly the result of python is what I want. I don&#39;t know why golang return different result and I think it&#39;s wrong."}, {"owner": {"reputation": 1380, "user_id": 6345404, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/69987c584342d8123b11b711918209c0?s=128&d=identicon&r=PG&f=1", "display_name": "T.Nel", "link": "https://stackoverflow.com/users/6345404/t-nel"}, "edited": false, "score": 0, "creation_date": 1522832921, "post_id": 49646574, "comment_id": 86302010, "body": "He just explained it to you. You divide by 14484.162361 in go and by 14484162361 in python"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1380, "user_id": 6345404, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/69987c584342d8123b11b711918209c0?s=128&d=identicon&r=PG&f=1", "display_name": "T.Nel", "link": "https://stackoverflow.com/users/6345404/t-nel"}, "edited": false, "score": 0, "creation_date": 1522833200, "post_id": 49646574, "comment_id": 86302194, "body": "@T.Nel That wouldn&#39;t be the problem, as both the dividend and divisor are multiplied by the same number (1e6), so the quotient should be the same."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 3675730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da41922ce59030cfc052bf606c7a93e?s=128&d=identicon&r=PG&f=1", "display_name": "user3675730", "link": "https://stackoverflow.com/users/3675730/user3675730"}, "edited": false, "score": 0, "creation_date": 1522832748, "post_id": 49646840, "comment_id": 86301908, "body": "Yes, you got my point. So that looks I used wrong methods to do the calculation. Thank you @icza."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1522834492, "last_edit_date": 1522834492, "creation_date": 1522832392, "answer_id": 49646840, "question_id": 49646574, "link": "https://stackoverflow.com/questions/49646574/why-do-go-and-python-return-different-result-when-dividing-big-numbers/49646840#49646840", "title": "Why do Go and Python return different result when dividing big numbers?", "body": "<p>You are not doing the same operation in Go and in Python. In Go you divide 2 floating point numbers, while in Python you divide 2 integer numbers. The results are only \"roughly\" equal because the input numbers you provide  lose precision, and the accuracy of the floating point operation is also limited (insufficient).</p>\n\n<p>If you perform the same integer division in Go (using the <a href=\"https://golang.org/pkg/math/big/#Int\" rel=\"nofollow noreferrer\"><code>big.Int</code></a> type), you get the same result:</p>\n\n<pre><code>i, ok := big.NewInt(0).SetString(\"26959535291011309493156476344723991336010898738574164086137773096960000000\", 10)\nif !ok {\n    panic(\"invalid\")\n}\nj, ok := big.NewInt(0).SetString(\"14484162361\", 10)\nif !ok {\n    panic(\"invalid\")\n}\n\nk := big.NewInt(0).Quo(i, j)\nfmt.Println(k)\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>1861311315012765306929610463010191006516769515973403833769533170\n</code></pre>\n\n<p>If you want to perform floating point division in Go, don't use <code>float64</code> type to represent your inputs, as they are limited in precision. This will happen because you created your input numbers using <a href=\"https://golang.org/pkg/math/big/#NewFloat\" rel=\"nofollow noreferrer\"><code>big.NewFloat()</code></a> which has a parameter of <code>float64</code> type, so the constants you pass will be implicitly converted to <code>float64</code> and you already lose precision.</p>\n\n<p>Instead use the <a href=\"https://golang.org/pkg/math/big/#Float\" rel=\"nofollow noreferrer\"><code>big.Float</code></a> type, and specify your input as <code>string</code> values and set it using <a href=\"https://golang.org/pkg/math/big/#Float.SetString\" rel=\"nofollow noreferrer\"><code>Float.SetString()</code></a>; and manually increase the precision (using <a href=\"https://golang.org/pkg/math/big/#Float.SetPrec\" rel=\"nofollow noreferrer\"><code>Float.SetPrec()</code></a>). If you do so, you will get the \"same\" result (same in the integer part, plus some fraction value):</p>\n\n<pre><code>x, ok := big.NewFloat(0).SetPrec(500).SetString(\"26959535291011309493156476344723991336010898738574164086137773096960\")\nif !ok {\n    panic(\"invalid\")\n}\ny, ok := big.NewFloat(0).SetPrec(500).SetString(\"14484.162361\")\nif !ok {\n    panic(\"invalid\")\n}\nz := new(big.Float).SetPrec(500).Quo(x, y)\nfmt.Println(fmt.Sprintf(\"%f\", z))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1861311315012765306929610463010191006516769515973403833769533170.518151\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/WYtJfndJlZR\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note that precision of <a href=\"https://golang.org/pkg/math/big/#Float.Quo\" rel=\"nofollow noreferrer\"><code>Float.Quo()</code></a> depends on:</p>\n\n<blockquote>\n  <p>Precision, rounding, and accuracy reporting are as for Add. </p>\n</blockquote>\n\n<p>Which is:</p>\n\n<blockquote>\n  <p>If z's precision is 0, it is changed to the larger of x's or y's precision before the operation. Rounding is performed according to z's precision and rounding mode; and z's accuracy reports the result error relative to the exact (not rounded) result. </p>\n</blockquote>\n"}], "owner": {"reputation": 17, "user_id": 3675730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9da41922ce59030cfc052bf606c7a93e?s=128&d=identicon&r=PG&f=1", "display_name": "user3675730", "link": "https://stackoverflow.com/users/3675730/user3675730"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "answer_count": 1, "score": -5, "last_activity_date": 1522834492, "creation_date": 1522831647, "last_edit_date": 1522834042, "question_id": 49646574, "link": "https://stackoverflow.com/questions/49646574/why-do-go-and-python-return-different-result-when-dividing-big-numbers", "title": "Why do Go and Python return different result when dividing big numbers?", "body": "<pre><code>// In golang    \nx, y := big.NewFloat(26959535291011309493156476344723991336010898738574164086137773096960), big.NewFloat(14484.162361)  \nz := new(big.Float).Quo(x, y)\nfmt.Println(fmt.Sprintf(\"%f\", z))\n</code></pre>\n\n<blockquote>\n  <p>output:\n  1861311315012765262390495455137379355146730679910059382988079104.000000</p>\n</blockquote>\n\n<pre><code>// In python\nv1 = 26959535291011309493156476344723991336010898738574164086137773096960000000\nv2= 14484162361\nprint v1/v2\n</code></pre>\n\n<blockquote>\n  <p>output:1861311315012765306929610463010191006516769515973403833769533170</p>\n</blockquote>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522831064, "post_id": 49646079, "comment_id": 86300773, "body": "Looks like you want item.Mobile to be a string, not a string slice."}], "answers": [{"comments": [{"owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "edited": false, "score": 0, "creation_date": 1522835503, "post_id": 49646443, "comment_id": 86303783, "body": "Thanks a lot @icza"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1522831257, "creation_date": 1522831257, "answer_id": 49646443, "question_id": 49646079, "link": "https://stackoverflow.com/questions/49646079/make-soap-xml-with-encoding-xml-package-in-golang/49646443#49646443", "title": "Make soap xml with encoding/xml package in Golang", "body": "<p>In your XML inside an <code>&lt;item&gt;</code> there is only a single <code>&lt;Mobile&gt;</code> tag. You don't want to repeat the <code>&lt;Mobile&gt;</code> tag but the <code>&lt;item&gt;</code> tag. So in Go you have to create a new <code>Item</code> for each number.</p>\n\n<p>Model it like this:</p>\n\n<pre><code>type Item struct {\n    Mobile string `xml:\"Mobile\"`\n}\n\ntype SendDetail struct {\n    Items []*Item `xml:\"item\"`\n}\n</code></pre>\n\n<p>Example using the model:</p>\n\n<pre><code>recipients := []string{\"num1\", \"num2\"}\n\nsd := &amp;SendDetail{}\nfor _, recipient := range recipients {\n    sd.Items = append(sd.Items, &amp;Item{Mobile: recipient})\n}\n\ndata, err := xml.MarshalIndent(sd, \"\", \"  \")\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(string(data))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/MXHyGWr-O-I\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;SendDetail&gt;\n  &lt;item&gt;\n    &lt;Mobile&gt;num1&lt;/Mobile&gt;\n  &lt;/item&gt;\n  &lt;item&gt;\n    &lt;Mobile&gt;num2&lt;/Mobile&gt;\n  &lt;/item&gt;\n&lt;/SendDetail&gt;\n</code></pre>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 49646443, "answer_count": 1, "score": 2, "last_activity_date": 1522831257, "creation_date": 1522830121, "last_edit_date": 1522831096, "question_id": 49646079, "link": "https://stackoverflow.com/questions/49646079/make-soap-xml-with-encoding-xml-package-in-golang", "title": "Make soap xml with encoding/xml package in Golang", "body": "<p>I want to make a sample xml that repeats a field depending on the value of the slice. But the final result is not as desired.</p>\n\n<p><strong>XML that I want to create</strong></p>\n\n<pre><code>        recipients = [\"num1\",\"num2\",...]\n\n        //Start XML\n        .\n        .\n        .\n        &lt;SendDetail&gt;\n            &lt;item&gt;&lt;Mobile&gt;num1&lt;/Mobile&gt;&lt;/item&gt;\n            &lt;item&gt;&lt;Mobile&gt;num2&lt;/Mobile&gt;&lt;/item&gt;\n            ...\n        &lt;/SendDetail&gt;  \n</code></pre>\n\n<p>The number of repetitions of  depends on the length of the slice of recipients and its values.        </p>\n\n<p><strong>My Code</strong></p>\n\n<pre><code>        type item struct {\n            Mobile  []string `xml:\"Mobile\"`\n        }\n        type sendDetail struct {\n            Item *[]item `xml:\"item\"`\n        }   \n\n\n        SendDetail: &amp;sendDetail{\n                Item:&amp;[]item{\n                    item{\n                        Mobile:recipients,\n                    },\n                },\n            },\n</code></pre>\n\n<p><strong>Result</strong></p>\n\n<pre><code>      &lt;SendDetail&gt;\n        &lt;item&gt;\n          &lt;Mobile&gt;num1&lt;/Mobile&gt;\n          &lt;Mobile&gt;num2&lt;/Mobile&gt;\n        &lt;/item&gt;\n      &lt;/SendDetail&gt;\n</code></pre>\n\n<p>Any pointers will be appreciated.</p>\n"}, {"tags": ["go", "lambda", "bitbucket", "serverless-framework", "aws-codebuild"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522828571, "post_id": 49645157, "comment_id": 86299348, "body": "The import name for the package is &quot;bitbucket.org/&lt;username&gt;/&lt;repo&gt;/test&quot;, not &quot;myproject/hello/test&quot;. (Maybe there&#39;s a hello in there somewhere too. Hard to tell since the names in your question are inconsistent)"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522828721, "post_id": 49645157, "comment_id": 86299444, "body": "Hi @Peter, yeah.. that should be it in the CodeBuild instance, but in my developer environment, it&#39;s only a folder and not starting with &quot;bitbucket.org...&quot;. Or should I use that format in my dev environment?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522829061, "post_id": 49645157, "comment_id": 86299626, "body": "Yes, you should: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522831592, "post_id": 49645157, "comment_id": 86301118, "body": "right! Ok then! If you make it as answer I&#39;ll make it as the answer! Thanks!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522833318, "post_id": 49645157, "comment_id": 86302274, "body": "This question has got to be a duplicate, but apparently my search mojo left me and I can&#39;t find a good existing question."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522833928, "post_id": 49645157, "comment_id": 86302690, "body": "that&#39;s why i asked this :p but if you found one, I&#39;m happy to flag this question as a duplicate! @Peter"}], "answers": [{"tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 1, "last_activity_date": 1523422462, "creation_date": 1523422462, "answer_id": 49766746, "question_id": 49645157, "link": "https://stackoverflow.com/questions/49645157/aws-codebuild-golang-lambda-using-serverless-framework/49766746#49766746", "title": "AWS Codebuild Golang Lambda using Serverless Framework", "body": "<p>Based on Peter's comments, I resolved the issue by using the full path of my bitbucket repo in my $GOPATH/src.</p>\n\n<p>so the path should be <code>bitbucket.org/&lt;username&gt;/&lt;repo&gt;</code></p>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 49766746, "answer_count": 1, "score": 0, "last_activity_date": 1523422462, "creation_date": 1522826864, "last_edit_date": 1522828096, "question_id": 49645157, "link": "https://stackoverflow.com/questions/49645157/aws-codebuild-golang-lambda-using-serverless-framework", "title": "AWS Codebuild Golang Lambda using Serverless Framework", "body": "<p>I'm building golang lambda functions using the serverless framework in AWS CodeBuild. This project is in a private bitbucket repository. And the CodeBuild source is the bitbucket repo</p>\n\n<p>I'm having some problems of using local packages in the code.</p>\n\n<p>I have this project structure</p>\n\n<pre><code>hello\n   test\n      test.go\n   main.go\nserverless.yml\n...other files\n</code></pre>\n\n<p>what I'm trying to do is to use package <code>test</code> in <code>hello/test/test.go</code> in the <code>hello/main.go</code>.</p>\n\n<p>And I've tried 2 options.</p>\n\n<ol>\n<li>Import the package using \"myproject/hello/test\"</li>\n<li>Using bitbucket url and <code>dep ensure</code>. Moving <code>test</code> to another project.</li>\n</ol>\n\n<p>the problems:</p>\n\n<ol>\n<li>in AWS CodeBuild, the package cannot be found as the real package directory is <code>/....aws path/bitbucket.org/&lt;username&gt;/&lt;repo&gt;/</code> and the <code>$GOPATH</code> is <code>/...aws path/</code>.</li>\n<li>dep ensure freezes when writing the private bitbucket repo. I'm assuming that it's because authentication issues?</li>\n</ol>\n\n<p>So, what can I do to use <strong>my</strong> golang packages in AWS CodeBuild? And it's a private repo not a public one.</p>\n"}, {"tags": ["function", "go", "implementation"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1522824693, "post_id": 49644421, "comment_id": 86296841, "body": "The code is not &quot;hidden&quot;, these functions often are implemented in assembly (in which case look at the .s files) or are kinda renamed with the go:linkname directive (see runtime/proc.go for sync_runtime_doSpin())."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522825298, "post_id": 49644421, "comment_id": 86297231, "body": "The function is <a href=\"https://github.com/golang/go/blob/00fab20582abc614dcf31ca444b4275240de9ae6/src/runtime/proc.go#L4919-L4922\" rel=\"nofollow noreferrer\">defined here</a> using go:linkname."}, {"owner": {"reputation": 11, "user_id": 9428678, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u90d1\u5353\u5f6c", "link": "https://stackoverflow.com/users/9428678/%e9%83%91%e5%8d%93%e5%bd%ac"}, "edited": false, "score": 0, "creation_date": 1522825804, "post_id": 49644421, "comment_id": 86297558, "body": "thanks , i know go likename now ."}], "owner": {"reputation": 11, "user_id": 9428678, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u90d1\u5353\u5f6c", "link": "https://stackoverflow.com/users/9428678/%e9%83%91%e5%8d%93%e5%bd%ac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1522825154, "answer_count": 0, "score": 0, "last_activity_date": 1522824186, "creation_date": 1522824186, "question_id": 49644421, "link": "https://stackoverflow.com/questions/49644421/go-function-with-no-body-where-can-i-find-its-implemtion", "closed_reason": "Duplicate", "title": "go function with no body , where can i find it&#39;s implemtion", "body": "<p>when i explore the mutex lock function implemtion in go .</p>\n\n<pre><code>func (m *Mutex) Lock()\n</code></pre>\n\n<p>I find some function called in this method which without function body .</p>\n\n<pre><code>func runtime_canSpin(i int) bool   // in sync/runtime.go\nfunc runtime_doSpin()\n</code></pre>\n\n<p>I want to find the code and login with these method . \nBut i only can find something like this in <a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Function_declarations</a></p>\n\n<pre><code>A function declaration may omit the body. Such a declaration provides the signature for a function implemented outside Go, such as an assembly routine.\n</code></pre>\n\n<p>what can i do to find the code hidden?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1522822952, "post_id": 49644039, "comment_id": 86295829, "body": "You wrote <code>This error is confusing me as the package is located in this directory</code> - which one of them is &quot;this directory&quot;? And perhaps double and triple check the actual paht :)"}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1522823050, "post_id": 49644039, "comment_id": 86295883, "body": "make sure your project base directory is in <code>$GOPATH</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1522823235, "post_id": 49644039, "comment_id": 86296000, "body": "Your error does not match your code: Your code imports  github.com/username/projectname/models (<b>username</b>) while your error stats it cannot find github.com/user/projectname/models (<b>user</b>). Just fix your setup. Your package is not there."}, {"owner": {"reputation": 49, "user_id": 3246744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de951ff974610f39a2df3c646dde98c?s=128&d=identicon&r=PG&f=1", "display_name": "noahgg", "link": "https://stackoverflow.com/users/3246744/noahgg"}, "edited": false, "score": 0, "creation_date": 1522875195, "post_id": 49644039, "comment_id": 86330023, "body": "I have updated the post, I used user instead of username when removing my github username."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 3246744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de951ff974610f39a2df3c646dde98c?s=128&d=identicon&r=PG&f=1", "display_name": "noahgg", "link": "https://stackoverflow.com/users/3246744/noahgg"}, "is_accepted": true, "score": 2, "last_activity_date": 1523340217, "creation_date": 1523340217, "answer_id": 49746401, "question_id": 49644039, "link": "https://stackoverflow.com/questions/49644039/go-cant-find-my-local-package/49746401#49746401", "title": "Go can&#39;t find my local package", "body": "<p>I changed my directory structure and the package now imports. Previously, my folders were named as followed src->github.com, github.com/username. I have since reworked it to src->github.com->username. Moving the folders like this allows the project to be found easily. </p>\n\n<p>The official <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">go documentation</a> makes it unclear that this is the intended structure. However, upon looking at <a href=\"https://github.com/golang/go/wiki/GitHubCodeLayout\" rel=\"nofollow noreferrer\">the github code layout</a> it becomes clear.</p>\n"}], "owner": {"reputation": 49, "user_id": 3246744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de951ff974610f39a2df3c646dde98c?s=128&d=identicon&r=PG&f=1", "display_name": "noahgg", "link": "https://stackoverflow.com/users/3246744/noahgg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3656, "favorite_count": 0, "accepted_answer_id": 49746401, "answer_count": 1, "score": 0, "last_activity_date": 1523340217, "creation_date": 1522822528, "last_edit_date": 1522875160, "question_id": 49644039, "link": "https://stackoverflow.com/questions/49644039/go-cant-find-my-local-package", "title": "Go can&#39;t find my local package", "body": "<p>I am getting the following error when trying to build a go project I am working on. </p>\n\n<pre><code>cannot find package \"github.com/user/projectname/models\" in any of:\n    /usr/local/go/src/github.com/user/projectname/models (from $GOROOT)\n    /Users/username/go/src/github.com/user/projectname/models (from $GOPATH)\n</code></pre>\n\n<p>This error is confusing me as the package is located in the directory from goroot. I have 3 go files there with models defined in them. When I run 'go build' or 'go install' in the models directory, no errors are returned. I am new to go and believe I must be missing something simple. I am using a mac and my github username directory shows up as github.com:user instead of github.com/username. Could that make a difference?</p>\n\n<p>Class to import model snippet:</p>\n\n<pre><code>package dal\n\nimport (\n    \"database/sql\"\n    \"log\"\n\n    \"github.com/user/projectname/models\"\n)\n</code></pre>\n\n<p>Model class: </p>\n\n<pre><code>package models\n\nimport \"time\"\n\n//Album of an artist.\ntype Album struct {\n    ID          int       `json:\"id\"`\n    Title       string    `json:\"title\"`\n    ArtistID    int       `json:\"artist_id\"`\n    ReleaseDate time.Time `json:\"date\"`\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/euaUC.png\" rel=\"nofollow noreferrer\">Directory Setup</a></p>\n"}, {"tags": ["go", "go-swagger"], "answers": [{"tags": [], "owner": {"reputation": 4059, "user_id": 8763847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k2myi.png?s=128&g=1", "display_name": "sayboras", "link": "https://stackoverflow.com/users/8763847/sayboras"}, "is_accepted": true, "score": 0, "last_activity_date": 1574853895, "last_edit_date": 1574853895, "creation_date": 1523055409, "answer_id": 49702006, "question_id": 49642527, "link": "https://stackoverflow.com/questions/49642527/customize-go-swagger-generate-spec/49702006#49702006", "title": "Customize go-swagger generate spec", "body": "<p>I checked <code>go-swagger</code> source <a href=\"https://github.com/go-swagger/go-swagger/blob/master/scan/parameters.go\" rel=\"nofollow noreferrer\">code</a>, and found out that in current implemented design, we can't do this. Basically, the scanning logic just checks the comment and JSON tag only.</p>\n"}], "owner": {"reputation": 4059, "user_id": 8763847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k2myi.png?s=128&g=1", "display_name": "sayboras", "link": "https://stackoverflow.com/users/8763847/sayboras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "accepted_answer_id": 49702006, "answer_count": 1, "score": 2, "last_activity_date": 1574853895, "creation_date": 1522814364, "last_edit_date": 1522819653, "question_id": 49642527, "link": "https://stackoverflow.com/questions/49642527/customize-go-swagger-generate-spec", "title": "Customize go-swagger generate spec", "body": "<p>I am using go-swagger to generate spec with command <code>swagger generate spec</code>. Everything is working fine, however I want to mitigate possible mismatch between specs and actual implementation. </p>\n\n<p>For example, the below model is having <code>required : true</code> in comment (for spec generation), as well as <code>value:\"required\"</code> for actual validation (e.g with <a href=\"http://github.com/asaskevich/govalidator\" rel=\"nofollow noreferrer\">govalidator</a>)</p>\n\n<pre><code>    // Current model\n    // swagger:parameters myAPI\n    type Post struct {\n        // the title\n        // required : true\n        Title   string `json:\"Title\" valid:\"required\"`\n\n        // the message\n        Message string `json:\"Message\"`\n    }\n</code></pre>\n\n<p>Is there any way to customize go-swagger to parse <code>valid:\"required\"</code> and automatically add <code>required:true</code> in generated specs? I know that currently <code>swagger generate spec</code> is already checking <code>json:\"Tittle\"</code> to populate json field name <code>Title</code>. Any pointer will be appreciated. Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1522808683, "post_id": 49641001, "comment_id": 86291139, "body": "You can try unmarshaling into a slice, and if you get an error, try unmarshaling into a struct."}, {"owner": {"reputation": 3, "user_id": 9059144, "user_type": "registered", "profile_image": "https://graph.facebook.com/1553635591378965/picture?type=large", "display_name": "Igor Guedes Rodrigues", "link": "https://stackoverflow.com/users/9059144/igor-guedes-rodrigues"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1522844562, "post_id": 49641001, "comment_id": 86309879, "body": "I will try it ! thank you"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9059144, "user_type": "registered", "profile_image": "https://graph.facebook.com/1553635591378965/picture?type=large", "display_name": "Igor Guedes Rodrigues", "link": "https://stackoverflow.com/users/9059144/igor-guedes-rodrigues"}, "edited": false, "score": 0, "creation_date": 1522838730, "post_id": 49642371, "comment_id": 86305976, "body": "OK this helped a lot but how to do this being that the json object has more fields the det is just a piece of JSON."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3, "user_id": 9059144, "user_type": "registered", "profile_image": "https://graph.facebook.com/1553635591378965/picture?type=large", "display_name": "Igor Guedes Rodrigues", "link": "https://stackoverflow.com/users/9059144/igor-guedes-rodrigues"}, "edited": false, "score": 0, "creation_date": 1522850897, "post_id": 49642371, "comment_id": 86314839, "body": "@IgorGuedesRodrigues Use json.RawMessage. See updated answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1522850879, "last_edit_date": 1522850879, "creation_date": 1522813142, "answer_id": 49642371, "question_id": 49641001, "link": "https://stackoverflow.com/questions/49641001/different-data-structures-coming-from-a-json/49642371#49642371", "title": "Different data structures coming from a json", "body": "<p>Decode the JSON as a slice if the first non-whitespace byte in the input is <code>[</code>. Otherwise, decode the JSON as a struct.</p>\n\n<pre><code>func decode(data []byte) ([]Det, error) {\n    data = bytes.TrimSpace(data)\n    if len(data) == 0 {\n        return nil, errors.New(\"empty\")\n    }\n    if data[0] == '[' {\n        var v []Det\n        err := json.Unmarshal(data, &amp;v)\n        return v, err\n    }\n    var v [1]Det\n    err := json.Unmarshal(data, &amp;v[0])\n    return v[:], err\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mzehQnfwKDJ\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>If the <code>Det</code> value is a member of a struct, then use <a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"nofollow noreferrer\">RawMessage</a> to capture the JSON and then use the function above.</p>\n\n<pre><code> type SomeStruct struct {\n    ....\n    DetRaw json.RawMessage `json:\"Det\"`\n    Det []Det `json:\"-\"`\n    ....\n}\n\nvar v SomeStruct\nif err := json.Unmarshal(data, &amp;v); err != nil {\n   // handle error\n}\nv.Det, err = decode([]byte(v.DetRaw))\nif err != nil {\n   // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9059144, "user_type": "registered", "profile_image": "https://graph.facebook.com/1553635591378965/picture?type=large", "display_name": "Igor Guedes Rodrigues", "link": "https://stackoverflow.com/users/9059144/igor-guedes-rodrigues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 49642371, "answer_count": 1, "score": 0, "last_activity_date": 1522850879, "creation_date": 1522802263, "last_edit_date": 1522839179, "question_id": 49641001, "link": "https://stackoverflow.com/questions/49641001/different-data-structures-coming-from-a-json", "title": "Different data structures coming from a json", "body": "<p>My question is,\n I have a JSON that returns me a list of objects.\nBut sometimes this list returns me a single object in case the det.</p>\n\n<p>I try to use the pattern below</p>\n\n<pre><code>Det []struct {\n                    NItem string `json:\"-nItem\"`\n                    Prod  struct {\n                        CProd    string `json:\"cProd\"`\n                        CEST     string `json:\"CEST\"`\n                        Cfop     string `json:\"CFOP\"`\n                        UCom     string `json:\"uCom\"`\n                        QCom     string `json:\"qCom\"`\n                        IndTot   string `json:\"indTot\"`\n                        VProd    string `json:\"vProd\"`\n                        CEANTrib string `json:\"cEANTrib\"`\n                        UTrib    string `json:\"uTrib\"`\n                        NCM      string `json:\"NCM\"`\n                        CEAN     string `json:\"cEAN\"`\n                        XProd    string `json:\"xProd\"`\n                        VUnCom   string `json:\"vUnCom\"`\n                        QTrib    string `json:\"qTrib\"`\n                        VUnTrib  string `json:\"vUnTrib\"`\n                    } `json:\"prod\"`\n                    Imposto struct {\n                        VTotTrib string `json:\"vTotTrib\"`\n                        ICMS     struct {\n                            ICMS00 struct {\n                                Orig  string `json:\"orig\"`\n                                CST   string `json:\"CST\"`\n                                ModBC string `json:\"modBC\"`\n                                VBC   string `json:\"vBC\"`\n                                PICMS string `json:\"pICMS\"`\n                                VICMS string `json:\"     vICMS\"`\n                            } `json:\"ICMS00\"`\n                        } `json:\"ICMS\"`\n                        IPI struct {\n                            CEnq    string `json:\"cEnq\"`\n                            IPITrib struct {\n                                CST  string `json:\"CST\"`\n                                VBC  string `json:\"vBC\"`\n                                PIPI string `json:\"pIPI\"`\n                                VIPI string `json:\"vIPI\"`\n                            } `json:\"IPITrib\"`\n                        } `json:\"IPI\"`\n                        PIS struct {\n                            PISAliq struct {\n                                CST  string `json:\"CST\"`\n                                VBC  string `json:\"vBC\"`\n                                PPIS string `json:\"pPIS\"`\n                                VPIS string `json:\"vPIS\"`\n                            } `json:\"PISAliq\"`\n                        } `json:\"PIS\"`\n                        COFINS struct {\n                            COFINSAliq struct {\n                                CST     string `json:\"CST     \"`\n                                VBC     string `json:\"vBC\"`\n                                PCOFINS string `json:\"pCOFINS\"`\n                                VCOFINS string `json:\"vCOFINS\"`\n                            } `json:\"COFINSAliq\"`\n                        } `json:\"COFINS\"`\n                    } `json:\"imposto\"`\n                } `json:\"det\"`\n</code></pre>\n\n<p>but works perfectly, but when the det object receives only element the unmarshal does not work, only works if I remove the slice of struct like that</p>\n\n<pre><code>Det struct {\n                    NItem string `json:\"-nItem\"`\n                    Prod  struct {\n                        CProd    string `json:\"cProd\"`\n                        CEST     string `json:\"CEST\"`\n                        Cfop     string `json:\"CFOP\"`\n                        UCom     string `json:\"uCom\"`\n                        QCom     string `json:\"qCom\"`\n                        IndTot   string `json:\"indTot\"`\n                        VProd    string `json:\"vProd\"`\n                        CEANTrib string `json:\"cEANTrib\"`\n                        UTrib    string `json:\"uTrib\"`\n                        NCM      string `json:\"NCM\"`\n                        CEAN     string `json:\"cE\n</code></pre>\n\n<p>The whole structure looks like this.</p>\n\n<p><code>\nSomeStruct struct {\n                ID  string <code>json:\"-Id\"</code>\n                Ide struct {...} <code>json:\"ide\"</code>\n                Total struct {\n                    ICMSTot struct {...} <code>json:\"ICMSTot\"</code>\n                } <code>json:\"total\"</code>\n                Cobr struct { Dup struct {....} <code>json:\"dup\"</code> } <code>json:\"cobr\"</code>\n                Versao string <code>json:\"-versao\"</code>\n                Emit   struct { ... } <code>json:\"enderEmit\"</code>\n                Det []struct {\n                    NItem string <code>json:\"-nItem\"</code>\n                    Prod  struct {\n                        CProd    string <code>json:\"cProd\"</code>\n                        CEST     string <code>json:\"CEST\"</code>\n                        Cfop     string <code>json:\"CFOP\"</code>\n                        UCom     string <code>json:\"uCom\"</code>\n                        QCom     string <code>json:\"qCom\"</code>\n                        IndTot   string <code>json:\"indTot\"</code>\n                        VProd    string <code>json:\"vProd\"</code>\n                        CEANTrib string <code>json:\"cEANTrib\"</code>\n                        UTrib    string <code>json:\"uTrib\"</code>\n                        NCM      string <code>json:\"NCM\"</code>\n                        CEAN     string <code>json:\"     cEAN\"</code>\n                        XProd    string <code>json:\"xProd\"</code>\n                        VUnCom   string <code>json:\"vUnCom\"</code>\n                        QTrib    string <code>json:\"qTrib\"</code>\n                        VUnTrib  string <code>json:\"vUnTrib\"</code>\n                    } <code>json:\"prod\"</code>\n</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522798476, "post_id": 49640461, "comment_id": 86288796, "body": "This code doesn&#39;t make sense to me. Why is the if statement outside the Scan loop? It never executes until an error occurs."}, {"owner": {"reputation": 43, "user_id": 9023719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g75i0.png?s=128&g=1", "display_name": "Dispatcher", "link": "https://stackoverflow.com/users/9023719/dispatcher"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522798983, "post_id": 49640461, "comment_id": 86288919, "body": "It is outside because if the user doesn&#39;t enter q, I want the program to ask again to enter a city name"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522799662, "post_id": 49640461, "comment_id": 86289096, "body": "I think you misunderstand how the Scanner works. Read the docs again. For instance, city and anything will have the same value because the return value of Text() doesn&#39;t change until the next call to Scan. There should only be one loop."}, {"owner": {"reputation": 43, "user_id": 9023719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g75i0.png?s=128&g=1", "display_name": "Dispatcher", "link": "https://stackoverflow.com/users/9023719/dispatcher"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522805445, "post_id": 49640461, "comment_id": 86290365, "body": "you&#39;re right thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1522806026, "last_edit_date": 1522806026, "creation_date": 1522800728, "answer_id": 49640839, "question_id": 49640461, "link": "https://stackoverflow.com/questions/49640461/golang-exit-bufio-for-loop-inside-another-for-loop/49640839#49640839", "title": "Golang exit bufio for loop inside another for loop", "body": "<p>It's hard to tell exactly what you want because you don't provide us with sample input and output. Perhaps, based on your code, something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    var cities []string\n    scanner := bufio.NewScanner(os.Stdin)\n    for {\n        fmt.Println(\"Enter a city name\")\n        if !scanner.Scan() {\n            break\n        }\n        city := scanner.Text()\n        if len(city) &gt; 0 {\n            cities = append(cities, city)\n        }\n        fmt.Printf(\"q to quit (Anything else to continue): \")\n        if !scanner.Scan() || scanner.Text() == \"q\" {\n            break\n        }\n    }\n    if err := scanner.Err(); err != nil {\n        fmt.Fprintln(os.Stderr, err)\n    }\n    fmt.Printf(\"%q\\n\", cities)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Enter a city name\nLos Angeles\nq to quit (Anything else to continue): \nEnter a city name\nLondon\nq to quit (Anything else to continue): \nEnter a city name\nDelhi\nq to quit (Anything else to continue): q\n[\"Los Angeles\" \"London\" \"Delhi\"]\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 9023719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g75i0.png?s=128&g=1", "display_name": "Dispatcher", "link": "https://stackoverflow.com/users/9023719/dispatcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 1, "accepted_answer_id": 49640839, "answer_count": 1, "score": 0, "last_activity_date": 1522806026, "creation_date": 1522797648, "question_id": 49640461, "link": "https://stackoverflow.com/questions/49640461/golang-exit-bufio-for-loop-inside-another-for-loop", "title": "Golang exit bufio for loop inside another for loop", "body": "<p>I have an initial loop that  keep asking user Questions until the user types q to quit. </p>\n\n<pre><code>func main() {\n scanner := bufio.NewScanner(os.Stdin)\n quit := false\n var city string\n var anything string\n for quit == false {    \n     fmt.Println(\"Enter a city name\")\n     for scanner.Scan(){\n         city= scanner.Text()\n         fmt.Printf(\"q to quit (Anything else to continue): \")\n         anything = scanner.Text()\n     }\n     if anything == \"q\" {\n         fmt.Println(city)\n         quit = true\n     }\n }\n}\n</code></pre>\n\n<p>What I'm struggling to figure out is how I can exit the nested for loop for the scanner and continue on with the initial for loop until the user enters q. Right now, it doesn't exit the 2nd loop so it always prompts \"q to quit ...\" and when I put a break it exits both the loops.</p>\n\n<p>Any idea how I should tackle this?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 7, "creation_date": 1522797665, "post_id": 49640390, "comment_id": 86288551, "body": "This is probably a duplicate, but anyway this should help: <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/InterfaceSlice</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1522827176, "post_id": 49640390, "comment_id": 86298413, "body": "For the obvious reason that they are different types."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1522865780, "post_id": 49640390, "comment_id": 86324636, "body": "From the Go FAQ: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}], "answers": [{"tags": [], "owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "is_accepted": false, "score": 2, "last_activity_date": 1522849004, "last_edit_date": 1522849004, "creation_date": 1522803172, "answer_id": 49641104, "question_id": 49640390, "link": "https://stackoverflow.com/questions/49640390/why-cant-i-pass-a-func-int-as-func-interface-in-go/49641104#49641104", "title": "Why can&#39;t I pass a `func() []int` as `func() []interface{}` in go?", "body": "<p>Because []int and []interface are 2 different types of slices and go does not allow automatic conversion between the 2.</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/InterfaceSlice</a></p>\n\n<p>all you can do is change this</p>\n\n<pre><code>func source() []int {\n    return []int{ 0, 1, 2, 3, 4 }\n}\n</code></pre>\n\n<p>into that</p>\n\n<pre><code>func source() []interface{} {\n    return []interface{}{ 0, 1, 2, 3, 4 }\n}\n</code></pre>\n\n<p>in order to fit the function signature you defined for <code>RegisterSource</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1522881017, "last_edit_date": 1522881017, "creation_date": 1522867646, "answer_id": 49658290, "question_id": 49640390, "link": "https://stackoverflow.com/questions/49640390/why-cant-i-pass-a-func-int-as-func-interface-in-go/49658290#49658290", "title": "Why can&#39;t I pass a `func() []int` as `func() []interface{}` in go?", "body": "<p>The <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">relevant Go FAQ entry</a> states that <code>[]T</code> and <code>[]interface{}</code> \u00abdo not have the same representation in memory\u00bb.</p>\n\n<p>To understand why, let's dissect two things:</p>\n\n<ol>\n<li><p>A slice is a backing storage <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">array</a> plus several integers containing the size and capacity\nof the slice.</p>\n\n<p>In Go, arrays are not somehow \"high-level\"; on the contrary,\nthe layout of the elements they contain is strictly defined: they are all\ncontained in a contiguous region of memory, adjacent to each other.</p>\n\n<p>This means, that in the backing array of a slice <code>[]T</code>, elements are of\ntype <code>T</code>, and each of them occupies a region of memory of a size natural\nfor that type <code>T</code>, and all these regions are all adjacent to each other\nin a single contiguous memory block.</p>\n\n<p>That means, each element of a slice <code>[]int</code> occupies exactly 64 bits\n(8 bytes) on a 64-bit platform \u2014 the amount of memory a single <code>int</code> value\noccupies.</p></li>\n<li><p>A value of any interface type, including the empty interface,\n<code>interface{}</code>, is represented as a structure containing two pointers,\nsomething like:</p>\n\n<pre><code>type iface struct {\n    realType  *typeInfo\n    realValue *dataType\n}\n</code></pre>\n\n<p>(More on how interfaces are represented \u2014 <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">here</a>).</p></li>\n</ol>\n\n<p>All of the above means in a slice <code>[]interface{}</code> each element occupies the\nregion of memory the size of two pointers, and these two pointers contain\naddresses of other variables in memory \u2014 as opposed to mere integer values\ncontained by elements of <code>[]int</code>.</p>\n\n<p>And this, in turn, means you can't just \"cast\" <code>[]int</code> \"to\" <code>[]interface{}</code> \u2014 simply because a value stored in any element of <code>[]int</code> (an <code>int</code>) is\nincompatible in its structure (memory layout) with an element\nof <code>[]interface{}</code> (a struct containing two pointers).\nTo produce one from another, you need to allocate a slice and convert each\nelement of the source slice to a matching element of the destination one.</p>\n\n<p>Finally, this means if a function returns a slice of type <code>[]int</code>,\nthat slice cannot be directly processed by code expecting slices of\ntype <code>[]interface{}</code> (and vice-versa), and this explains why\nthe two function signatures from your question represent incompatible\ntypes.</p>\n"}], "owner": {"reputation": 805, "user_id": 2297687, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/94f9a7ae7da0b0c0e43bbede728149cd?s=128&d=identicon&r=PG", "display_name": "gaigepr", "link": "https://stackoverflow.com/users/2297687/gaigepr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 0, "accepted_answer_id": 49658290, "answer_count": 2, "score": 0, "last_activity_date": 1522881017, "creation_date": 1522797188, "question_id": 49640390, "link": "https://stackoverflow.com/questions/49640390/why-cant-i-pass-a-func-int-as-func-interface-in-go", "title": "Why can&#39;t I pass a `func() []int` as `func() []interface{}` in go?", "body": "<p>I have the following definition:</p>\n\n<pre><code>func (c *Collector) RegisterSource(f func() []interface{}) {\n    c.source = f\n}\n</code></pre>\n\n<p>I attempt to call it as follows but get an error:</p>\n\n<pre><code>func source() []int {\n    return []int{ 0, 1, 2, 3, 4 }\n}\n...\nc.RegisterSource(source)\n</code></pre>\n\n<p>This is met with:</p>\n\n<pre><code>cannot use source (type func() []int) as type func() []interface {} in argument to c.RegisterSource\n</code></pre>\n"}, {"tags": ["dictionary", "go", "struct", "nested"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522793501, "post_id": 49638061, "comment_id": 86287372, "body": "Duplicate of <a href=\"https://stackoverflow.com/questions/49479464/nested-structs-of-arrays-in-go\" title=\"nested structs of arrays in go\">stackoverflow.com/questions/49479464/&hellip;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1522785708, "post_id": 49638166, "comment_id": 86284120, "body": "To illustrate the unwieldiness of using an anonymous struct definition, here is an example <a href=\"https://play.golang.org/p/T-e3ajEUhiu\" rel=\"nofollow noreferrer\">play.golang.org/p/T-e3ajEUhiu</a>"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1522785404, "creation_date": 1522785404, "answer_id": 49638166, "question_id": 49638061, "link": "https://stackoverflow.com/questions/49638061/initializing-nested-maps-in-struct/49638166#49638166", "title": "Initializing Nested Maps in Struct", "body": "<p>A <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> must start with the type being initialized. Now, obviously that's pretty unwieldy with anonymous structs because you'd be repeating the same struct definition, so it would probably be better not to use an anonymous type:</p>\n\n<pre><code>type Feature struct {\n    Name        string\n    Description string\n    Stories     map[string]Story \n}\n\ntype Story struct {\n    Name        string\n    Description string\n}\n\ntype EpicFeatureStory struct {\n    Key         string\n    Description string\n    Features    map[string]Feature\n}\n</code></pre>\n\n<p>So that you can just:</p>\n\n<pre><code>// You can only make() a type, not a field reference\nEpicData.Features = make(map[string]Feature)\n\nfor _, issue := range epicFeatures.Issues {\n        issueKey := issue.Key\n        issueDesc := issue.Fields.Summary\n\n        EpicData.Features[issueKey] = Feature{Name: issueKey, Description: issueDesc}\n        fmt.Println(issueKey)\n}\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 1962855, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b99377b20319fccbf0b59b918d0779fa?s=128&d=identicon&r=PG", "display_name": "feik", "link": "https://stackoverflow.com/users/1962855/feik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1294, "favorite_count": 0, "accepted_answer_id": 49638166, "answer_count": 1, "score": 0, "last_activity_date": 1522820071, "creation_date": 1522784895, "last_edit_date": 1522820071, "question_id": 49638061, "link": "https://stackoverflow.com/questions/49638061/initializing-nested-maps-in-struct", "title": "Initializing Nested Maps in Struct", "body": "<p>I am relatively new to Go and I am consuming some data from a REST endpoint. I have unmarshaled my json and I am trying to populate a custom struct with a couple of nested maps:</p>\n\n<pre><code>type EpicFeatureStory struct {\n    Key         string\n    Description string\n    Features    map[string]struct {\n        Name        string\n        Description string\n        Stories     map[string]struct {\n            Name        string\n            Description string\n        }\n    }\n}\n</code></pre>\n\n<p>As I iterate over my features I am trying to add them to the Features map within the struct. </p>\n\n<pre><code>// One of my last attempts (of many)\nEpicData.Features = make(EpicFeatureStory.Features)\n\nfor _, issue := range epicFeatures.Issues {\n        issueKey := issue.Key\n        issueDesc := issue.Fields.Summary\n\n        EpicData.Features[issueKey] = {Name: issueKey, Description: issueDesc}\n        fmt.Println(issueKey)\n}\n</code></pre>\n\n<p>How does one initialize the Features map in this case? I feel like have tried everything under the sun without success. Is it better Go form to create independent structs for Feature and Story rather than anonymously defining them within the main struct?</p>\n"}, {"tags": ["ssl", "go"], "comments": [{"owner": {"reputation": 32972, "user_id": 150978, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/feadc214792e2581c3c750140e3eb2c7?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/150978/robert"}, "edited": false, "score": 2, "creation_date": 1522780058, "post_id": 49636807, "comment_id": 86281282, "body": "Yo can simply test it out. Just try some of the subpages of <a href=\"https://badssl.com\" rel=\"nofollow noreferrer\">badssl.com</a> which should definitely cause the SSL/TLS handshake to fail."}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1522781385, "post_id": 49636807, "comment_id": 86282003, "body": "I believe the closest you may get is <a href=\"https://github.com/golang/go/blob/e875fe42eee942c35cdecc7b4b5d4e762f47bade/src/crypto/tls/alert.go#L51\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522793857, "post_id": 49636807, "comment_id": 86287489, "body": "Assuming an HTTPS server, set <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">*http.Server.ErrorLog</a> to something you can monitor. TLS errors contain the string &quot;tls:&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1522794638, "last_edit_date": 1522794638, "creation_date": 1522781776, "answer_id": 49637285, "question_id": 49636807, "link": "https://stackoverflow.com/questions/49636807/what-is-the-golang-equivalent-to-javas-javax-net-ssl-sslhandshakeexception/49637285#49637285", "title": "What is the Golang equivalent to Java&#39;s javax.net.ssl.SSLHandshakeException?", "body": "<p>Golang has no exceptions, but funcs return errors. This code would set err if the handshake fails:</p>\n\n<pre><code>conf := &amp;tls.Config{}\ntlsCon, err := tls.Dial(\"tcp\", \"example.com:443\", conf)\nif err != nil { // err is set when handshake fails\n    fmt.Println(err.Error())\n    return\n}\ntlsCon.Close()\n</code></pre>\n"}], "owner": {"reputation": 1123, "user_id": 3448228, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7ce9d0dbd549c09b0ced925c64d0c2a0?s=128&d=identicon&r=PG&f=1", "display_name": "SuperCow", "link": "https://stackoverflow.com/users/3448228/supercow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1522794638, "creation_date": 1522779890, "last_edit_date": 1522781868, "question_id": 49636807, "link": "https://stackoverflow.com/questions/49636807/what-is-the-golang-equivalent-to-javas-javax-net-ssl-sslhandshakeexception", "title": "What is the Golang equivalent to Java&#39;s javax.net.ssl.SSLHandshakeException?", "body": "<p>I'm trying to set up some logging/monitoring for a Golang application. I want to be alerted if an SSL handshake error occurs. In Java I looked for the string \"javax.net.ssl.SSLHandshakeException\". Is there an equivalent in Golang for when something goes wrong with an SSL handshake?</p>\n"}, {"tags": ["go", "stdout", "stdin"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1522775334, "post_id": 49635270, "comment_id": 86278580, "body": "Why don&#39;t you just run the command you really want to run, instead of trying to start a shell?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1522776181, "post_id": 49635270, "comment_id": 86279082, "body": "What is the reason for not using a goroutine?"}, {"owner": {"reputation": 137, "user_id": 4694193, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/690053f5046e186fab6c94ea3e38a90c?s=128&d=identicon&r=PG&f=1", "display_name": "lucio", "link": "https://stackoverflow.com/users/4694193/lucio"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1522776411, "post_id": 49635270, "comment_id": 86279231, "body": "@MichaelHampton Unfortunately once you kill the process (shell) you can&#39;t retrieve the current working path and the shell is restarted with binary path as working path."}, {"owner": {"reputation": 137, "user_id": 4694193, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/690053f5046e186fab6c94ea3e38a90c?s=128&d=identicon&r=PG&f=1", "display_name": "lucio", "link": "https://stackoverflow.com/users/4694193/lucio"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522776660, "post_id": 49635270, "comment_id": 86279364, "body": "@CeriseLim&#243;n in that case, a goroutine, will be the worst solution imho. I need to read output from different functions sequentially."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1522776872, "post_id": 49635270, "comment_id": 86279491, "body": "What are the functions you are talking about?  The example shows one function, <code>main</code>.   In any case, the use of goroutines does not prevent sequential read of the sub process stdout."}, {"owner": {"reputation": 137, "user_id": 4694193, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/690053f5046e186fab6c94ea3e38a90c?s=128&d=identicon&r=PG&f=1", "display_name": "lucio", "link": "https://stackoverflow.com/users/4694193/lucio"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522779344, "post_id": 49635270, "comment_id": 86280892, "body": "@CeriseLim&#243;n I&#39;ve updated the code. As you can see the first command (cd ~) does not produce any output and the code will hang once <code>pr.Read(buf)</code> is reached since there&#39;s nothing to be read.  Setting a non-block flag will solve this issue but when the second one (pwd) is written, the stdout is not yet ready to be read so I got a &quot;resource temporary not available&quot; error."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522784789, "post_id": 49635270, "comment_id": 86283717, "body": "The non-blocking flag does not help determine when the grandchild process is done writing output. It&#39;s no better than just reading the connection.  What is the actual problem you are trying to solve?  If your goal is to find the home directory as shown in the question, then use the <a href=\"https://godoc.org/os/user#User.HomeDir\" rel=\"nofollow noreferrer\">os/user</a> package."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 3, "creation_date": 1522790263, "post_id": 49635270, "comment_id": 86286218, "body": "The whole approach doesn&#39;t make any sense. What exactly are you trying to do?"}], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": false, "score": 0, "last_activity_date": 1522843375, "creation_date": 1522843375, "answer_id": 49650514, "question_id": 49635270, "link": "https://stackoverflow.com/questions/49635270/reading-from-stdout-pipe-once-ready-in-golang/49650514#49650514", "title": "Reading from stdout pipe once ready in golang", "body": "<p>As Cerise Lim\u00f3n mentioned go functions whould be the way to go here, since these sorts of interactive scripting exercises are traditionally done with expect.</p>\n\n<p>You can wrap the the parrellel execution into a library to it might still look like sequencial code, so this might be helpful: <a href=\"https://github.com/ThomasRooney/gexpect\" rel=\"nofollow noreferrer\">https://github.com/ThomasRooney/gexpect</a></p>\n\n<p>From the readme:</p>\n\n<pre><code>child, err := gexpect.Spawn(\"python\")\nif err != nil { panic(err) }\nchild.Expect(\"&gt;&gt;&gt;\")\nchild.SendLine(\"print 'Hello World'\")\nchild.Interact()\nchild.Close()\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 4694193, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/690053f5046e186fab6c94ea3e38a90c?s=128&d=identicon&r=PG&f=1", "display_name": "lucio", "link": "https://stackoverflow.com/users/4694193/lucio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522843375, "creation_date": 1522774048, "last_edit_date": 1522779061, "question_id": 49635270, "link": "https://stackoverflow.com/questions/49635270/reading-from-stdout-pipe-once-ready-in-golang", "title": "Reading from stdout pipe once ready in golang", "body": "<p>I'm facing with a weird golang issue. The following code will clarify:</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"io\"\n    \"fmt\"\n    \"os\"\n)\n\nvar (\n    pw io.WriteCloser\n    pr io.ReadCloser\n)\n\nfunc main() {\n    term := exec.Command(\"/bin/sh\")\n\n    // Get stdin writer pipe\n    pw, _ = term.StdinPipe()\n    pr, _ = term.StdoutPipe()\n\n    term.Start()\n\n    run(\"cd ~\")\n    pwd := run(\"pwd\");\n\n    // Do something with pwd output\n    ...\n\n    term.Wait()\n}\n\nfunc run(c string) string {\n    io.WriteString(pw, fmt.Sprintln(c))\n\n    buf := make([]byte, 32 * 1024)\n    pr.Read(buf)\n    return string(buf)\n}\n</code></pre>\n\n<p>I'd like to run some commands in a shell env and read their output. There's no problem on write/run command but it seems that there're some limitations while reading: </p>\n\n<ul>\n<li>you can't know if a command doesn't output anything or not;</li>\n<li>there's no way to check if stdout is ready to be read or not.</li>\n</ul>\n\n<p>The <code>pr.Read(dest)</code> method will block the code flow until something is read from stdout. As said, the goal is to read sequentially (without using a go routine and/or an infinite loop). This means that if we send a <code>cd</code> command the func end is never reached.</p>\n\n<p>Setting the non-block flag through <code>unix.SetNonblock</code> on stdout file descriptor seems to solve the above issue but you can't know prior if it's ready or not and an error saying \"resource temporary not available\" is returned from <code>.Read</code> call.</p>\n"}, {"tags": ["go", "reflection", "hash"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522771170, "post_id": 49634346, "comment_id": 86276231, "body": "Hashing a series of values requires a linear scan over that series of values. I&#39;m not sure how you envision that being faster than the short-circuiting comparison you have already."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522771261, "post_id": 49634346, "comment_id": 86276294, "body": "@JimB without the hashing, it&#39;s a linear scan for every overload. <code>O(num_args * num_overloads)</code> vs <code>O(num_args)</code>. As I said in the question, most of the slices don&#39;t change. So the hash values will be pre-computed/cached."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522771831, "post_id": 49634346, "comment_id": 86276625, "body": "Yes, but you need to calculate the hash in order to compare it, which means a linear scan. The lookup speed of a map isn&#39;t because of the hash comparison, it&#39;s because of the O(1) lookup time within the map. Constant time lookups does not mean constant time hashing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522771950, "post_id": 49634346, "comment_id": 86276690, "body": "Maybe it&#39;s just the obvious name you need, a type can be uniquely identified by <code>t.PkgPath()</code> + <code>t.Name()</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1522772102, "post_id": 49634346, "comment_id": 86276762, "body": "<code>reflect.Type</code> is an interface, the dymanic value stored in it in most cases is a pointer, which means comparing 2 <code>reflect.Type</code> values is just comparing some pointers. If you need better performance, I would make sure the <code>Signature</code> values themselves &quot;interned&quot; or have a unique identifier which can be used for simple and most efficient comparison / lookup."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522772598, "post_id": 49634346, "comment_id": 86277036, "body": "@JimB I&#39;m reusing the hashed values, I don&#39;t know how else to explain it ..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522773121, "post_id": 49634346, "comment_id": 86277314, "body": "@IliaCholy, that&#39;s fine, it&#39;s just not how you&#39;ve described the problem. Just make each Signature return a unique, comparable value."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522779249, "post_id": 49634346, "comment_id": 86280847, "body": "@JimB I asked for a way to hash a <code>reflect.Type</code>. Pretty cut and dry."}], "answers": [{"tags": [], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "is_accepted": false, "score": 0, "last_activity_date": 1522787159, "last_edit_date": 1522787159, "creation_date": 1522773085, "answer_id": 49634974, "question_id": 49634346, "link": "https://stackoverflow.com/questions/49634346/hashing-reflect-type/49634974#49634974", "title": "Hashing reflect.Type", "body": "<p>I ended up abusing the built-in <code>map</code> to assign unique ids to each <code>reflect.Type</code>. Then I hash those using djb2.</p>\n\n<pre><code>type TypeCode struct {\n    seq   int64\n    codes map[reflect.Type]int64\n}\n\nfunc (td *TypeCode) TypeID(t reflect.Type) int64 {\n    if code, ok := td.codes[t]; ok {\n        return code\n    }\n    td.seq++\n    td.codes[t] = td.seq\n    return td.seq\n}\n\nfunc (td *TypeCode) SliceTypeID(tt []reflect.Type) int64 {\n    id := int64(5381)\n    for _, t := range tt {\n        id = ((id &lt;&lt; 5) + id) + td.TypeID(t)\n    }\n    return id\n}\n</code></pre>\n\n<p><strong>edit</strong>: I switched to a string based approach which is less efficient, but removes any potential for collisions.</p>\n\n<pre><code>type TypeCode struct {\n    seq   int64\n    codes map[reflect.Type]string\n}\n\nfunc (td *TypeCode) TypeID(t reflect.Type) string {\n    if code, ok := td.codes[t]; ok {\n        return code\n    }\n    td.seq++\n    id := strconv.FormatInt(td.seq, 10)\n    td.codes[t] = id\n    return id\n}\n\nfunc (td *TypeCode) SliceTypeID(tt []reflect.Type) string {\n    ids := make([]string, len(tt))\n    for i := 0; i &lt; len(tt); i++ {\n        ids[i] = td.TypeID(tt[i])\n    }\n    return strings.Join(ids, \".\")\n}\n</code></pre>\n"}], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1522787159, "creation_date": 1522770888, "question_id": 49634346, "link": "https://stackoverflow.com/questions/49634346/hashing-reflect-type", "title": "Hashing reflect.Type", "body": "<p>I'm trying to find a quick way of performing comparisons between two <code>[]reflect.Type</code>. Right now I have the following:</p>\n\n<pre><code>func Equal(left, right []reflect.Type) bool {\n    if len(left) != len(right) {\n        return false\n    }\n    for i := 0; i &lt; len(left); i++ {\n        if left[i] != right[i] {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>Most of the slices don't change. So if I can find a way to hash them, I'd get a huge perf boost.</p>\n\n<p><strong>Background</strong></p>\n\n<p>I'm trying to (for fun) implement a form of function overloading in Go using the <code>reflect</code> package. The first thing I did is to convert each specialised/overloaded function into a signature type. </p>\n\n<pre><code>type Signature struct {\n    Variadic bool\n    In, Out  []reflect.Type\n}\n</code></pre>\n\n<p>The idea is that, when the overloaded function gets called, I'll convert the arguments into a slice of <code>reflect.Type</code> and then find a <code>Signature</code> where the <code>In</code> types match. </p>\n\n<p>This works, but for each comparison, it's a linear scan which is pretty slow. If I could hash the slice of <code>[]reflect.Type</code> I could stick that in a map and get constant time lookups.</p>\n"}, {"tags": ["go", "graph", "cayley"], "comments": [{"owner": {"reputation": 1091, "user_id": 3387602, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c5ef481e47f40861b734abc7d7973777?s=128&d=identicon&r=PG&f=1", "display_name": "zer09", "link": "https://stackoverflow.com/users/3387602/zer09"}, "edited": false, "score": 0, "creation_date": 1522810656, "post_id": 49631330, "comment_id": 86291642, "body": "What with the downvotes? Any explanation what&#39;s wrong with question?"}, {"owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "edited": false, "score": 0, "creation_date": 1522843783, "post_id": 49631330, "comment_id": 86309295, "body": "I guess that it is not that clear, what your actual question is. Whether you wanted to know more about labels or simply wanted to know the value of the constant <code>quad.Label</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1091, "user_id": 3387602, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c5ef481e47f40861b734abc7d7973777?s=128&d=identicon&r=PG&f=1", "display_name": "zer09", "link": "https://stackoverflow.com/users/3387602/zer09"}, "edited": false, "score": 0, "creation_date": 1522851051, "post_id": 49633008, "comment_id": 86314960, "body": "Additional resource: <a href=\"https://discourse.cayley.io/t/beginners-guide-to-schema-design-working-thread/436/11\" rel=\"nofollow noreferrer\">discourse.cayley.io/t/&hellip;</a>"}], "tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 4, "last_activity_date": 1522766880, "creation_date": 1522766880, "answer_id": 49633008, "question_id": 49631330, "link": "https://stackoverflow.com/questions/49631330/what-is-label-in-cayley-quads/49633008#49633008", "title": "What is &quot;label&quot; in cayley quads?", "body": "<p>Quads in caylay are an implementation of <a href=\"https://www.w3.org/TR/n-quads/\" rel=\"nofollow noreferrer\">https://www.w3.org/TR/n-quads/</a></p>\n\n<p>While triplets only allow subject, predicate and object:</p>\n\n<pre><code>:subject :predicate :object .\n\n:spiderman :relationship/enemyOf :green-goblin .\n</code></pre>\n\n<p>Quads add the optional context label which can be used to further describe the relationship or base of knowledge.</p>\n\n<pre><code>:subject :predicate :object :label .\n\n:spiderman :relationship/enemyOf :green-goblin :graphs/spiderman .\n</code></pre>\n"}], "owner": {"reputation": 1091, "user_id": 3387602, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c5ef481e47f40861b734abc7d7973777?s=128&d=identicon&r=PG&f=1", "display_name": "zer09", "link": "https://stackoverflow.com/users/3387602/zer09"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 49633008, "answer_count": 1, "score": 0, "last_activity_date": 1522848626, "creation_date": 1522762042, "last_edit_date": 1522848626, "question_id": 49631330, "link": "https://stackoverflow.com/questions/49631330/what-is-label-in-cayley-quads", "title": "What is &quot;label&quot; in cayley quads?", "body": "<p>I already tried, to look in <a href=\"https://godoc.org/github.com/cayleygraph/cayley/quad\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/cayleygraph/cayley/quad</a> but cant find the definition of it and it's uses.</p>\n\n<p>I will appreciate any advice and recommendation, thanks.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522761855, "post_id": 49630950, "comment_id": 86269414, "body": "did you use <code>{new: true}</code> in update query"}, {"owner": {"reputation": 3040, "user_id": 3158312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gv23q.jpg?s=128&g=1", "display_name": "Albert221", "link": "https://stackoverflow.com/users/3158312/albert221"}, "reply_to_user": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522761937, "post_id": 49630950, "comment_id": 86269474, "body": "@AshishChoudhary no, why? there&#39;s no problem with updating, the problem is with retrieving this specific embedded document"}, {"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522762072, "post_id": 49630950, "comment_id": 86269578, "body": "you have mentioned that you want updated data ... right??"}, {"owner": {"reputation": 3040, "user_id": 3158312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gv23q.jpg?s=128&g=1", "display_name": "Albert221", "link": "https://stackoverflow.com/users/3158312/albert221"}, "reply_to_user": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522762200, "post_id": 49630950, "comment_id": 86269684, "body": "you&#39;re right, can you link me any resource of what that <code>new</code> will do? I didn&#39;t hear of that"}, {"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522762400, "post_id": 49630950, "comment_id": 86269848, "body": "<a href=\"https://stackoverflow.com/questions/32811510/mongoose-findoneandupdate-doesnt-return-updated-document\" title=\"mongoose findoneandupdate doesnt return updated document\">stackoverflow.com/questions/32811510/&hellip;</a>"}, {"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522762461, "post_id": 49630950, "comment_id": 86269884, "body": "{new: true} if set true then will return the updated docs... else return previous data"}, {"owner": {"reputation": 3040, "user_id": 3158312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gv23q.jpg?s=128&g=1", "display_name": "Albert221", "link": "https://stackoverflow.com/users/3158312/albert221"}, "reply_to_user": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522763692, "post_id": 49630950, "comment_id": 86270778, "body": "this actually won&#39;t help me because it returns whole document which I already have, but I found a workaround"}, {"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1522763773, "post_id": 49630950, "comment_id": 86270835, "body": "ok... so do you want specific keys???"}], "answers": [{"tags": [], "owner": {"reputation": 3040, "user_id": 3158312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gv23q.jpg?s=128&g=1", "display_name": "Albert221", "link": "https://stackoverflow.com/users/3158312/albert221"}, "is_accepted": true, "score": 0, "last_activity_date": 1522763771, "creation_date": 1522763771, "answer_id": 49631944, "question_id": 49630950, "link": "https://stackoverflow.com/questions/49630950/how-to-return-embedded-document-with-id-of/49631944#49631944", "title": "How to return embedded document with ID of", "body": "<p>I found a workaround, it's not stricte Mongo query that is returning this embedded document, but this code is IMO more clear and understandable than some fancy Mongo query that fetches whole document anyway.</p>\n\n<pre><code>func (r MongoRepository) UpdateMemberRole(id string, role int8) (*Member, error) {\n    change := mgo.Change{\n        Update: bson.M{\"$set\": bson.M{\"members.$.role\": role}},\n        ReturnNew: true,\n    }\n\n    var updatedGroup Group\n    _, err := r.db.C(\"groups\").Find(bson.M{\"members\": bson.M{\"$elemMatch\": bson.M{\"id\": id}}}).Apply(change, &amp;updatedGroup)\n    if err == mgo.ErrNotFound {\n        return nil, fmt.Errorf(\"member with ID '%s' does not exist\", id)\n    } else if err != nil {\n        return nil, err\n    }\n\n    for _, member := range updatedGroup.Members {\n        if member.Id == id {\n            return &amp;member, nil\n        }\n    }\n\n    return nil, fmt.Errorf(\"weird error, Id cannot be found\")\n}\n</code></pre>\n"}], "owner": {"reputation": 3040, "user_id": 3158312, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gv23q.jpg?s=128&g=1", "display_name": "Albert221", "link": "https://stackoverflow.com/users/3158312/albert221"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 49631944, "answer_count": 1, "score": 0, "last_activity_date": 1522763771, "creation_date": 1522760929, "question_id": 49630950, "link": "https://stackoverflow.com/questions/49630950/how-to-return-embedded-document-with-id-of", "title": "How to return embedded document with ID of", "body": "<p>I have a MongoDB collection with an example document like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Jmjn0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Jmjn0.png\" alt=\"Mongo example document\"></a></p>\n\n<p>What I want to do (as you can see from the actual code) is to update a <code>role</code> field in <code>members.x.role</code> where <code>members.x.id</code> equals given ID (ID is UUID so it's unique; this part of code works without problem) and then I want to return that <code>members.x</code>. But the problem is that it always returns first member instead of the one that has been just updated. I've tried some methods of <em>mgo</em> and found <code>Distinct()</code> be closest to my expectations, but that doesn't work as I want.</p>\n\n<p>My question is how can I return <code>member</code> <strong><em>embedded document</em></strong> with specified ID?</p>\n\n<p>I've already looked on <a href=\"https://stackoverflow.com/questions/9201743/mongodb-select-field-to-return-embedded-document-in-array\">this</a> and <a href=\"https://stackoverflow.com/questions/33751451/how-can-i-use-mongodb-projections-with-go-and-mgo\">this</a> but it didn't help me.</p>\n\n<pre><code>func (r MongoRepository) UpdateMemberRole(id string, role int8) (*Member, error) {\n    memberQuery := &amp;bson.M{\"members\": &amp;bson.M{\"$elemMatch\": &amp;bson.M{\"id\": id}}}\n    change := &amp;bson.M{\"members.$.role\": role}\n\n    err := r.db.C(\"groups\").Update(memberQuery, &amp;bson.M{\"$set\": &amp;change})\n    if err == mgo.ErrNotFound {\n        return nil, fmt.Errorf(\"member with ID '%s' does not exist\", id)\n    }\n\n    // FIXME: Retrieve this member from query below. THIS ALWAYS RETURNS FIRST MEMBER!!!\n    var member []Member\n    r.db.C(\"groups\").Find(&amp;bson.M{\"members.id\": id}).Distinct(\"members.0\", &amp;member)\n\n    return &amp;member[0], nil\n}\n</code></pre>\n"}, {"tags": ["go", "locking", "atomic", "cas"], "comments": [{"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522760043, "post_id": 49630574, "comment_id": 86268035, "body": "You need a CAS (compare and swap) loop"}, {"owner": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "reply_to_user": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522760819, "post_id": 49630574, "comment_id": 86268646, "body": "@Ivan can you elaborate? The implementation in the question already uses CAS, can you explain the concept of a CAS loop?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522761251, "post_id": 49630574, "comment_id": 86268979, "body": "Your race isn&#39;t in the atomic operations, look at the exact location the race detector is showing you. You&#39;re reading the <code>index</code> value in your return statement."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "reply_to_user": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "edited": false, "score": 0, "creation_date": 1522765499, "post_id": 49630574, "comment_id": 86272147, "body": "@mhutter I don&#39;t really know Go and I don&#39;t have compiler with me atm. I can only show use example in either pseudo-code or C (or C++). It might be converted to Go with some help."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522767102, "post_id": 49631224, "comment_id": 86273380, "body": "@Ivan Neither of those are issues. The <code>index</code> variable cannot be read, only the return value of <code>Inc()</code> is valid, which will always be in the range of <code>[0..Max)</code>. My solution does not build on what <code>Max</code> is, there are no bit operations involved, only a remainder <code>%</code> which works with &quot;any&quot; numbers."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522767265, "post_id": 49631224, "comment_id": 86273503, "body": "Yeah, original code does not mention if <code>index</code> should never become equal to <code>Max</code>, but the non-atomic code does not let it get out of range. If other threads read this variable they might see &quot;invalid&quot; value."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522767537, "post_id": 49631224, "comment_id": 86273726, "body": "@Ivan Other goroutines can&#39;t read <code>index</code> without synchronization anyway, that&#39;s undefined behavior in Go in general. If there would be a need to read <code>index</code> without incrementing it, it would be a simple <code>LoadInt64() % Max</code> operation."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522767686, "post_id": 49631224, "comment_id": 86273852, "body": "It is unclear if other goroutines know if <code>% Max</code> should be performed. My point was that it is not equivalent to the non-atomic code. And to me it looks like the point of this assignment is to learn how to use CAS loop to implement more complex atomic operations."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "edited": false, "score": 0, "creation_date": 1522767950, "post_id": 49631224, "comment_id": 86274038, "body": "@Ivan Yes, it&#39;s true that this solution is not identical, although it solves the original problem in a cleaner and more efficient way. Other goroutines should not mess with <code>index</code> anyway, an exported function can be provided to read and return its value if needed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1522770214, "last_edit_date": 1522770214, "creation_date": 1522761772, "answer_id": 49631224, "question_id": 49630574, "link": "https://stackoverflow.com/questions/49630574/how-to-implement-i-and-i-max-0-i-that-only-use-atomic-in-go/49631224#49631224", "title": "How to implement &quot;i++ and i&gt;=max ? 0: i&quot; that only use atomic in Go", "body": "<h2>Solving it without loops and locks</h2>\n\n<p>A simple implementation may look like this:</p>\n\n<pre><code>const Max = 8\n\nvar index int64\n\nfunc Inc() int64 {\n    value := atomic.AddInt64(&amp;index, 1)\n    if value &lt; Max {\n        return value // We're done\n    }\n\n    // Must normalize, optionally reset:\n    value %= Max\n    if value == 0 {\n        atomic.AddInt64(&amp;index, -Max) // Reset\n    }\n    return value\n}\n</code></pre>\n\n<p>How does it work?</p>\n\n<p>It simply adds 1 to the counter; <a href=\"https://golang.org/pkg/sync/atomic/#AddInt64\" rel=\"nofollow noreferrer\"><code>atomic.AddInt64()</code></a> returns the new value. If it's less than <code>Max</code>, \"we're done\", we can return it.</p>\n\n<p>If it's greater than or equal to <code>Max</code>, then we have to normalize the value (make sure it's in the range <code>[0..Max)</code>) and reset the counter.</p>\n\n<p>Reset may only be done by a single caller (a single goroutine), which will be selected by the counter's value. The winner will be the one that caused the counter to reach <code>Max</code>.</p>\n\n<p>And the trick to avoid the need of locks is to reset it by adding <code>-Max</code>, not by setting it to <code>0</code>. Since the counter's value is normalized, it won't cause any problems if other goroutines are calling it and incrementing it concurrently.</p>\n\n<p>Of course with many goroutines calling this <code>Inc()</code> concurrently it may be that the counter will be incremented more that <code>Max</code> times before a goroutine that ought to reset it can actually carry out the reset, which would cause the counter to reach or exceed <code>2 * Max</code> or even <code>3 * Max</code> (in general: <code>n * Max</code>). So we handle this by using a <code>value % Max == 0</code> condition to decide if a reset should happen, which again will only happen at a single goroutine for each possible values of <code>n</code>.</p>\n\n<h2>Simplification</h2>\n\n<p>Note that the normalization does not change values already in the range <code>[0..Max)</code>, so you may opt to always perform the normalization. If you want to, you may simplify it to this:</p>\n\n<pre><code>func Inc() int64 {\n    value := atomic.AddInt64(&amp;index, 1) % Max\n    if value == 0 {\n        atomic.AddInt64(&amp;index, -Max) // Reset\n    }\n    return value\n}\n</code></pre>\n\n<h2>Reading the counter without incrementing it</h2>\n\n<p>The <code>index</code> variable should not be accessed directly. If there's a need to read the counter's current value without incrementing it, the following function may be used:</p>\n\n<pre><code>func Get() int64 {\n    return atomic.LoadInt64(&amp;index) % Max\n}\n</code></pre>\n\n<h2>Extreme scenario</h2>\n\n<p>Let's analyze an \"extreme\" scenario. In this, <code>Inc()</code> is called 7 times, returning the numbers <code>1..7</code>. Now the next call to <code>Inc()</code> after the increment will see that the counter is at <code>8 = Max</code>. It will then normalize the value to <code>0</code> and wants to reset the counter. Now let's say before the reset (which is to add <code>-8</code>) is actually executed, 8 other calls happen. They will increment the counter 8 times, and the last one will again see that the counter's value is <code>16 = 2 * Max</code>. All the calls will normalize the values into the range <code>0..7</code>, and the last call will again go on to perform a reset. Let's say this reset is again delayed (e.g. for scheduling reasons), and yet another 8 calls come in. For the last, the counter's value will be <code>24 = 3 * Max</code>, the last call again will go on to perform a reset.</p>\n\n<p>Note that all calls will only return values in the range <code>[0..Max)</code>. Once all reset operations are executed, the counter's value will be <code>0</code>, properly, because it had a value of <code>24</code> and there were 3 \"pending\" reset operations. In practice there's only a slight chance for this to happen, but this solution handles it nicely and efficiently.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 7760737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZhQl.jpg?s=128&g=1", "display_name": "wllenyj", "link": "https://stackoverflow.com/users/7760737/wllenyj"}, "edited": false, "score": 0, "creation_date": 1523191278, "post_id": 49632897, "comment_id": 86448715, "body": "LoadInt32(&amp;index)  whether  can use prev:=index directy, if index is int32."}, {"owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "reply_to_user": {"reputation": 55, "user_id": 7760737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZhQl.jpg?s=128&g=1", "display_name": "wllenyj", "link": "https://stackoverflow.com/users/7760737/wllenyj"}, "edited": false, "score": 0, "creation_date": 1523193921, "post_id": 49632897, "comment_id": 86449440, "body": "@wllenyj <code>LoadInt32</code> need to be used to guarantee ordering, normal assignment might not work, depending on compiler and processor architecture."}], "tags": [], "owner": {"reputation": 6746, "user_id": 1143634, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e7lca.png?s=128&g=1", "display_name": "StaceyGirl", "link": "https://stackoverflow.com/users/1143634/staceygirl"}, "is_accepted": false, "score": 1, "last_activity_date": 1522767201, "last_edit_date": 1522767201, "creation_date": 1522766540, "answer_id": 49632897, "question_id": 49630574, "link": "https://stackoverflow.com/questions/49630574/how-to-implement-i-and-i-max-0-i-that-only-use-atomic-in-go/49632897#49632897", "title": "How to implement &quot;i++ and i&gt;=max ? 0: i&quot; that only use atomic in Go", "body": "<p>I assume your goal is to never let <code>index</code> has value equal or greater than <code>Max</code>. This can be solved using CAS (Compare-And-Swap) loop:</p>\n\n<pre><code>const Max = 8\nvar index int32\n\nfunc add() int32 {\n    var next int32;\n\n    for {\n        prev := atomic.LoadInt32(&amp;index)\n        next = prev + 1;\n\n        if next &gt;= Max {\n            next = 0\n        }\n\n        if (atomic.CompareAndSwapInt32(&amp;index, prev, next)) {\n            break;\n        }\n    }\n\n    return next\n}\n</code></pre>\n\n<p>CAS can be used to implement almost any operation atomically like this. The algorithm is:</p>\n\n<ol>\n<li>Load the value</li>\n<li>Perform the desired operation</li>\n<li>Use CAS, goto 1 on failure.</li>\n</ol>\n"}], "owner": {"reputation": 55, "user_id": 7760737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZhQl.jpg?s=128&g=1", "display_name": "wllenyj", "link": "https://stackoverflow.com/users/7760737/wllenyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1522770214, "creation_date": 1522759882, "question_id": 49630574, "link": "https://stackoverflow.com/questions/49630574/how-to-implement-i-and-i-max-0-i-that-only-use-atomic-in-go", "title": "How to implement &quot;i++ and i&gt;=max ? 0: i&quot; that only use atomic in Go", "body": "<p>only use atomic implement the follow code:\n</p>\n\n<pre><code>const Max = 8\nvar index int\nfunc add() int {\n    index++\n    if index &gt;= Max {\n        index = 0\n    }\n    return index\n}\n</code></pre>\n\n<p>such as:\n</p>\n\n<pre><code>func add() int {\n    atomic.AddUint32(&amp;index, 1)\n    // error: race condition \n    atomic.CompareAndSwapUint32(&amp;index, Max, 0)\n    return index\n}\n</code></pre>\n\n<p>but it is wrong. there is a race condition. \ncan be implemented that don't use lock ?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522756971, "post_id": 49629560, "comment_id": 86265852, "body": "What problems / errors are you having? What is the definition of the <code>Customers</code> type?"}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522757075, "post_id": 49629560, "comment_id": 86265921, "body": "@icza i edit my question"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522757131, "post_id": 49629560, "comment_id": 86265963, "body": "Please answer the other questions too: what problems / errors are you having?"}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1522757352, "post_id": 49629560, "comment_id": 86266155, "body": "It retrieve the data when user enter the last name but if it enter the first name then it does not retrieve the data I want if user enter any field data then it retrieve the data which matches like it for example <code>http:&#47;&#47;localhost:8080&#47;api&#47;v1&#47;customer?keyword=puneet</code> then it matches with collection <code>first_name</code> and retrieve it @icza"}, {"owner": {"reputation": 2696, "user_id": 14019, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5e4654adc0a8cf62d437e014fd9f8435?s=128&d=identicon&r=PG", "display_name": "Adam Straughan", "link": "https://stackoverflow.com/users/14019/adam-straughan"}, "edited": false, "score": 1, "creation_date": 1522758383, "post_id": 49629560, "comment_id": 86266840, "body": "This questions looks like it could read: &quot;In mongodb how do I query, multiple fields and/or perform a SQL LIKE filter&quot;. If that is the question, simply querying SO will yield an answer. The URL, web ness of the question does not seem relevant."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1522760236, "post_id": 49629560, "comment_id": 86268190, "body": "See related question: <a href=\"https://stackoverflow.com/questions/6790819/searching-for-value-of-any-field-in-mongodb-without-explicitly-naming-it\">Searching for value of any field in MongoDB without explicitly naming it</a>."}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522760331, "post_id": 49629560, "comment_id": 86268277, "body": "@icza see i found my answer thankyou. for helping me"}], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "is_accepted": true, "score": 0, "last_activity_date": 1523851126, "last_edit_date": 1523851126, "creation_date": 1522759139, "answer_id": 49630318, "question_id": 49629560, "link": "https://stackoverflow.com/questions/49629560/how-to-find-the-data-from-collection-according-to-url-in-golang/49630318#49630318", "title": "How to find the data from collection according to url in golang?", "body": "<p>I got the answer it is done by using the <code>$or</code> in mongodb.</p>\n\n<p>In the monogdb there is a operator called or <code>$or</code> it checks the value with all the fields and produce result. </p>\n\n<p>There is a <code>bson.RegExis</code> used. Because it will matches or checks the data similar to it receives from the user.</p>\n\n<p>There is change in condition. The condition is:-</p>\n\n<pre><code>conditions := bson.M{\"$or\": []bson.M{\n    bson.M{\"first_name\": bson.RegEx{value,\"\"}},\n    bson.M{\"last_name\": bson.RegEx{value,\"\"}},\n    bson.M{\"email\": bson.RegEx{value,\"\"}},\n    bson.M{\"phone_number\": bson.RegEx{value,\"\"}},\n}}\n</code></pre>\n\n<p>there is change in the query</p>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 49630318, "answer_count": 1, "score": 1, "last_activity_date": 1523851126, "creation_date": 1522756788, "last_edit_date": 1522757161, "question_id": 49629560, "link": "https://stackoverflow.com/questions/49629560/how-to-find-the-data-from-collection-according-to-url-in-golang", "title": "How to find the data from collection according to url in golang?", "body": "<p>I'm retrieving the data from the database when the user hit the url like <code>http://localhost:8080/api/v1/customer?keyword=dhiman</code>  then it search for the data in the collection if there is any field matches then it will retrieve that data. if the user entered the short url like  <code>http://localhost:8080/api/v1/customer?keyword=dhi</code> then it also retrieve the data which matches like that how I'll solve this problem. I tried the code for this like following:-</p>\n\n<p>Struct of the customer</p>\n\n<pre><code>type Customer struct {\n  Id               int    `json:\"id\" bson:\"_id\"`\n  FirstName        string `json:\"first_name\" bson:\"first_name\"`\n  LastName         string `json:\"last_name\" bson:\"last_name\"`\n  Email            string `json:\"email\" bson:\"email\"`\n  PhoneNumber      string `json:\"phone_number\" bson:\"phone_number\"`\n}\ntype Customers []Customer\n</code></pre>\n\n<p>Functions</p>\n\n<pre><code>func GetCustomers(c *gin.Context) {\nvalue := c.Query(\"keyword\")\nfmt.Println(value)\nresponse := ResponseControllerList{}\nconditions := bson.M{\"last_name\":value}\ndata, err := models.GetCustomerListing(conditions)\nif err != nil {\n    response = ResponseControllerList{\n        config.FailureCode,\n        config.FailureFlag,\n        config.FailureMsg,\n        nil,\n        nil,\n    }\n} else {\n    response = ResponseControllerList{\n        config.SuccessFlag,\n        config.SuccessFlag,\n        config.SuccessMsg,\n        data,\n        // dataCount,\n        nil,\n    }\n}\nGetResponseList(c, response)\n} \n</code></pre>\n\n<p>GetCustomerListing function in models page:-</p>\n\n<pre><code>func GetCustomerListing(customerQuery interface{}) (result Customers, err error) {\nmongoSession := config.ConnectDb()\nsessionCopy := mongoSession.Copy()\ndefer sessionCopy.Close()\ngetCollection := mongoSession.DB(config.Database).C(config.CustomerCollection)\nerr = getCollection.Find(customerQuery).Select(bson.M{\"password\": 0}).All(&amp;result) //.Skip(skip).Limit(limit)\nif err != nil {\n    return result, err\n}\nreturn result, nil\n}\n</code></pre>\n\n<p>collection images</p>\n\n<p><a href=\"https://i.stack.imgur.com/hMC1c.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hMC1c.png\" alt=\"\"></a></p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "is_accepted": false, "score": 2, "last_activity_date": 1522756109, "last_edit_date": 1522756109, "creation_date": 1522747771, "answer_id": 49626630, "question_id": 49626549, "link": "https://stackoverflow.com/questions/49626549/how-to-assign-a-set-of-rowsretrieved-from-a-database-in-an-array-of-structure/49626630#49626630", "title": "How to assign a set of rows(Retrieved from a database) in an array of structure in GoLang?", "body": "<p>If you call Get it expects only one row to be returned. If you want to select multiple rows, use Select and pass a pointer to your slice. For example:</p>\n\n<pre><code>var rows []Demo\nerr := sqlx.Select(&amp;rows, `SELECT * FROM \"demo\"`)\n// ...\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 2433953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57c850fb19acb28a42b7147e938bdca3?s=128&d=identicon&r=PG", "display_name": "user2433953", "link": "https://stackoverflow.com/users/2433953/user2433953"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522756109, "creation_date": 1522747515, "question_id": 49626549, "link": "https://stackoverflow.com/questions/49626549/how-to-assign-a-set-of-rowsretrieved-from-a-database-in-an-array-of-structure", "title": "How to assign a set of rows(Retrieved from a database) in an array of structure in GoLang?", "body": "<p>I am trying to retrieve a set of rows from postgresql and trying to assign it in an array of structure. My code goes like this :</p>\n\n<pre><code>var test []Demo\n    err := sqlx.Get(db,&amp;test, `\n                    select *\n                    from demo\n                    where id = $1`,\n                    5,\n            )\n            if err != nil {\n                    fmt.Println(\"Error\",err)\n                    fmt.Println(\"DatabaseExtraction Error\")\n                    return nil, errors.Wrap(err, \"select error\")\n            } else {\n                    fmt.Println(\"No Extraction Error\")\n            }\n</code></pre>\n\n<p>I have a structure like this :</p>\n\n<pre><code>type Demo struct {\n        ID         int64         `db:\"id\"`\n        Name       string        `db:\"name\"`\n}\n</code></pre>\n\n<p>But I am getting an error like this\nError scannable dest type slice with >1 columns (2) in result (code: 2)\nAlso I don't get any error if I replace var test []Demo with var test Demo. </p>\n"}, {"tags": ["google-app-engine", "go", "goroutine", "google-app-engine-go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1522747172, "post_id": 49626357, "comment_id": 86259752, "body": "<a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go/28240299#28240299\">You can&#39;t kill a goroutine from the &quot;outside&quot;</a>, the goroutine has to support its termination, e.g. by monitoring a channel, which may be communicated via a <code>context.Context</code>."}, {"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522842137, "post_id": 49626357, "comment_id": 86308175, "body": "&quot;You can&#39;t kill a goroutine from the &quot;outside&quot;.  - yes, I agree. So I try to control the context app engine, maybe there is any solution ?"}, {"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1522842301, "post_id": 49626357, "comment_id": 86308302, "body": "&quot;a channel, which may be communicated via a context.Context&quot; -&gt; I tried context.WithCancel(), but it doesn&#39;t work"}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1522841863, "post_id": 49629023, "comment_id": 86307998, "body": "This is exactly my first idea. But the risk is: the seconde goroutine is still running, even the handler has finished, as a result app engine will create too many instances"}], "tags": [], "owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "is_accepted": false, "score": 0, "last_activity_date": 1522755142, "creation_date": 1522755142, "answer_id": 49629023, "question_id": 49626357, "link": "https://stackoverflow.com/questions/49626357/app-engine-go-how-to-kill-a-running-goroutine/49629023#49629023", "title": "App Engine Go: How to kill a running goroutine", "body": "<p>You can try reducing the value of <code>wg.Add()</code> to <code>wg.Add(1)</code> instead of <code>wg.Add(2)</code>. </p>\n\n<p>When one go-routine completes, <code>wg.Done()</code> will reduce the counter value by <code>1</code>. So, In this case, the <code>WaitGroup (wg)</code> counter value will become <code>ZERO</code>. As a result, <code>wg.Wait()</code> on last line, will not wait for other go-routines to complete. </p>\n\n<p>Note that, if the value of <code>wg</code> counter falls below zero, it will panic the remaining go-routines. So, the go-routines will be exited forcefully.</p>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1522842574, "post_id": 49629791, "comment_id": 86308495, "body": "Thanks your answer. I hope that: when goroutine1 finish its job, the handler can stop goroutine2 immediately."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1522848869, "post_id": 49629791, "comment_id": 86313172, "body": "@Xin I have changed implementation, please take a look. Now once one request succeeded another will be stopped waiting for the response."}, {"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1522939979, "post_id": 49629791, "comment_id": 86361721, "body": "I tried your code, yes, it works! Thanks. But I have to find another solution, because the request.WithContext() is supported from go1.7, but I use still go1.6  in my project, so the func cancel() with timeout doesn&#39;t work for me."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1522993994, "post_id": 49629791, "comment_id": 86383557, "body": "For 1.6 there is no way to cancel in-fly connection. The only possible thing you can do is to call <code>https:&#47;&#47;golang.org&#47;pkg&#47;net&#47;http&#47;#Transport.CancelRequest</code>, but this can be called only after RoundTrip is finished (request response returned)."}, {"owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1523020597, "post_id": 49629791, "comment_id": 86399823, "body": "you are right, I think that I have to change my go version, or just give up the idea of concurrence. Thanks your help!"}, {"owner": {"reputation": 954, "user_id": 9188803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CESgG.png?s=128&g=1", "display_name": "Rodrigo C.", "link": "https://stackoverflow.com/users/9188803/rodrigo-c"}, "reply_to_user": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "edited": false, "score": 0, "creation_date": 1523873194, "post_id": 49629791, "comment_id": 86723705, "body": "@Xin, if you consider Pavlo&#39;s answer to be helpful for you, please consider accepting it. Thank you."}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 1, "last_activity_date": 1522848779, "last_edit_date": 1522848779, "creation_date": 1522757436, "answer_id": 49629791, "question_id": 49626357, "link": "https://stackoverflow.com/questions/49626357/app-engine-go-how-to-kill-a-running-goroutine/49629791#49629791", "title": "App Engine Go: How to kill a running goroutine", "body": "<p>Just create a notification channel and send there a signal that one of computations is over and you can proceed without waiting for the other.</p>\n\n<pre><code>func handlerTest(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    ctx, cancel := context.WithTimeout(c, 30*time.Second)\n    done := make(chan error, 2)\n\n    work := func(url, name string) {\n        log.Infof(ctx, \"%s begin ...\", name)\n        client := urlfetch.Client(ctx)\n        req, err := http.NewRequest(http.MethodGet, url, nil)\n        if err != nil {\n            log.Errorf(ctx, \"%s failed:  %v\", name, err)\n            done &lt;- err\n            return\n        }\n        req = req.WithContext(ctx)\n        _, err = client.Do(req)\n        done &lt;- err\n        if err != nil {\n            log.Errorf(ctx, \"%s failed:  %v\", name, err)\n            return\n        }\n        cancel()\n        log.Infof(ctx, \"%s over ...\", name)\n    }\n    go work(\"go1\", \"http://APP_NAME.appspot.com/testwait5s\")\n    go work(\"go2\", \"http://APP_NAME.appspot.com/testwait10s\")\n\n    for i := 0; i &lt; cap(done); i++ {\n        if err := &lt;-done; err == nil {\n            log.Infof(ctx, \"executed without errors\")\n            return\n        }\n    }\n    log.Error(ctx, \"both computations have failed\")\n}\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 5000077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1Q7Vb_ZkSRA/AAAAAAAAAAI/AAAAAAAAADA/jczbRX12lDo/photo.jpg?sz=128", "display_name": "Xin", "link": "https://stackoverflow.com/users/5000077/xin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 49629791, "answer_count": 2, "score": 1, "last_activity_date": 1522848779, "creation_date": 1522747011, "last_edit_date": 1522774455, "question_id": 49626357, "link": "https://stackoverflow.com/questions/49626357/app-engine-go-how-to-kill-a-running-goroutine", "title": "App Engine Go: How to kill a running goroutine", "body": "<p>I want to run 2 goroutines parallel in App Engine, so that when the first goroutine finish its job, the handler doesn't need to wait the second goroutine - it stops the secend goroutine and returns the result to the client. Is this possible? I tried it with context.WithCancel(), but it didn't work (I use go1.6). </p>\n\n<p>Here is my code:  </p>\n\n<pre><code>package mytest\n\nimport (\n    \"net/http\"\n    \"sync\"\n    \"time\"\n\n    \"golang.org/x/net/context\"\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/log\"\n    \"google.golang.org/appengine/urlfetch\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/test\", handlerTest)\n    http.HandleFunc(\"/testwait10s\", handlerTest10s)\n    http.HandleFunc(\"/testwait5s\", handlerTest5s)\n}\n\nfunc handlerTest(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    ctx, _ := context.WithTimeout(c, 30*time.Second)\n\n    ctx1, ctx1Cancel := context.WithCancel(ctx)\n    ctx2, ctx2Cancel := context.WithCancel(ctx)\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go func() {\n        defer wg.Done()\n        log.Infof(ctx1, \"Go1 begin ...\")\n        client1 := urlfetch.Client(ctx1)\n        _, err := client1.Get(\"http://APP_NAME.appspot.com/testwait5s\")\n        if err != nil {\n            log.Errorf(ctx1, \"Go1 failed:  %v\", err)\n        }\n        ctx2Cancel()\n        log.Infof(ctx1, \"Go1 over ...\")\n    }()\n\n    go func() {\n        defer wg.Done()\n        log.Infof(ctx2, \"Go2 begin ...\")\n        client2 := urlfetch.Client(ctx2)\n        _, err := client2.Get(\"http://APP_NAME.appspot.com/testwait10s\")\n        if err != nil {\n            log.Errorf(ctx2, \"Go2 failed %v\", err)\n        }\n        ctx1Cancel()\n        log.Infof(ctx2, \"Go2 over ...\")\n    }()\n\n    wg.Wait()\n    log.Infof(ctx1, \"Go1 and GO2 over\")\n}\n\nfunc handlerTest10s(w http.ResponseWriter, r *http.Request) {\n    time.Sleep(10 * time.Second)\n    return\n}\n\nfunc handlerTest5s(w http.ResponseWriter, r *http.Request) {\n    time.Sleep(5 * time.Second)\n    return\n}\n</code></pre>\n\n<p>Any ideas? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1522747190, "post_id": 49626229, "comment_id": 86259764, "body": "No, a closure is fine here."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1522755109, "post_id": 49626229, "comment_id": 86264655, "body": "Since you can&#39;t pass additional arguments to <code>time.AfterFunc()</code>, how would it &quot;guess&quot; the values of the additional parameters if the function would require any? Alternative to passing a closure, you may also mass a method value (<a href=\"https://stackoverflow.com/questions/38897529/golang-pass-method-to-function/38897667#38897667\">example1</a>, <a href=\"https://stackoverflow.com/questions/28251283/golang-function-alias-on-method-receiver/28252088#28252088\">example2</a>)."}, {"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1522851254, "post_id": 49626229, "comment_id": 86315111, "body": "a good explanation, why don&#39;t you add it as answer?. This is what i wanted to know."}, {"owner": {"reputation": 102, "user_id": 3987895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad42b52ba79ce5641de33fa24e25b08b?s=128&d=identicon&r=PG", "display_name": "gblomqvist", "link": "https://stackoverflow.com/users/3987895/gblomqvist"}, "edited": false, "score": 0, "creation_date": 1523128262, "post_id": 49626229, "comment_id": 86435550, "body": "Why the downvotes? I just started learning Go and found this question helpful."}, {"owner": {"reputation": 25797, "user_id": 316357, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/50e7e6ec58e101311283a40e60c33572?s=128&d=identicon&r=PG", "display_name": "Curious2learn", "link": "https://stackoverflow.com/users/316357/curious2learn"}, "edited": false, "score": 0, "creation_date": 1534949069, "post_id": 49626229, "comment_id": 90889296, "body": "Same question. Why the downvotes? I think stackoverflow should require downvoters to explain, and reveal their identity. It is annoying."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": true, "score": 8, "last_activity_date": 1522747314, "creation_date": 1522747314, "answer_id": 49626480, "question_id": 49626229, "link": "https://stackoverflow.com/questions/49626229/passing-a-function-with-parameters-to-time-afterfunc/49626480#49626480", "title": "Passing a function with parameters to time.AfterFunc", "body": "<p>Create a function from the argument, return it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc foo(bar string) {\n    fmt.Printf(\"in foo('%s')\\n\", bar)\n}\n\nfunc newFunc(bar string) func() {\n    fmt.Printf(\"creating func with '%s'\\n\", bar)\n    return func() {\n        foo(bar)\n    }\n}\n\nfunc main() {\n    somebar := \"Here we go!\"\n    f := newFunc(somebar)\n    _ = time.AfterFunc(1*time.Second, f)\n\n    time.Sleep(2 * time.Second)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/lWgeHvPLg9N\" rel=\"noreferrer\">https://play.golang.com/p/lWgeHvPLg9N</a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 12338363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9a1946ca5160f2bdbec473874931299?s=128&d=identicon&r=PG", "display_name": "Nashenas", "link": "https://stackoverflow.com/users/12338363/nashenas"}, "is_accepted": false, "score": 1, "last_activity_date": 1573138339, "last_edit_date": 1573138339, "creation_date": 1573137647, "answer_id": 58751127, "question_id": 49626229, "link": "https://stackoverflow.com/questions/49626229/passing-a-function-with-parameters-to-time-afterfunc/58751127#58751127", "title": "Passing a function with parameters to time.AfterFunc", "body": "<p>Anonymous function helps you to send functions with parameters to AfterFunc. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc foo(bar string) {\n\n    fmt.Printf(\"in foo('%s')\\n\", bar)\n}\n\nfunc main() {\n    somebar := \"Here we go!\"\n    time.AfterFunc(1*time.Second, func(){foo(somebar)})\n    time.Sleep(2 * time.Second)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/sdpiBtBWt_s\" rel=\"nofollow noreferrer\">https://play.golang.com/p/sdpiBtBWt_s</a></p>\n"}], "owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2569, "favorite_count": 0, "accepted_answer_id": 49626480, "answer_count": 2, "score": 5, "last_activity_date": 1573138339, "creation_date": 1522746590, "question_id": 49626229, "link": "https://stackoverflow.com/questions/49626229/passing-a-function-with-parameters-to-time-afterfunc", "title": "Passing a function with parameters to time.AfterFunc", "body": "<p><code>time.AfterFunc()</code> accepts a duration and a function to be executed when that duration has expired. But the function cannot be a function that accepts parameters.</p>\n\n<p>For example: The following function cannot be passed:</p>\n\n<pre><code>func Foo (b *Bar) {}\n</code></pre>\n\n<p>Although, it is possible to initialize a new function that calls the above one and then pass it:</p>\n\n<pre><code>f := func() {\n    Foo(somebar)\n}\ntimer := time.AfterFunc(1*time.Second, f)\n</code></pre>\n\n<p>Should this really be done this way?<br>\nWhy does time.AfterFunc not accept any functions that accept parameters?<br>\nDo there exist other/better ways to do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1522745067, "post_id": 49625640, "comment_id": 86258489, "body": "You <b>must</b> call wg.Add(1) from <i>outside</i> of the goroutine. Otherwise wg.Wait() might not (in your case: does not) see the Add(1)."}, {"owner": {"reputation": 15050, "user_id": 8605791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae3be140b26db13a86d624dba4ef1c8?s=128&d=identicon&r=PG&f=1", "display_name": "llllllllll", "link": "https://stackoverflow.com/users/8605791/llllllllll"}, "edited": false, "score": 2, "creation_date": 1522745201, "post_id": 49625640, "comment_id": 86258565, "body": "Putting <code>wg.Add(1)</code> inside goroutine is a race condition. You don&#39;t know whether the those <code>Add</code> have been executed when <code>wg.Wait()</code> is called. And you forgot to call <code>Done()</code> in goroutine."}, {"owner": {"reputation": 63, "user_id": 7992250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4865c98587f39c9c41dd9fe1e88c575?s=128&d=identicon&r=PG&f=1", "display_name": "Denis Kertios", "link": "https://stackoverflow.com/users/7992250/denis-kertios"}, "edited": false, "score": 0, "creation_date": 1522768164, "post_id": 49625640, "comment_id": 86274196, "body": "All right, I understand. This tool acts as a simple counter. Thanks."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1522776537, "post_id": 49625640, "comment_id": 86279302, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/19208725/example-for-sync-waitgroup-correct\">Example for sync.WaitGroup correct?</a>"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523651340, "post_id": 49625640, "comment_id": 86665206, "body": "@DenisKertios is the given answer solved your problem? If it does, you may accept it."}], "answers": [{"tags": [], "owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "is_accepted": false, "score": 3, "last_activity_date": 1522747964, "last_edit_date": 1522747964, "creation_date": 1522747438, "answer_id": 49626527, "question_id": 49625640, "link": "https://stackoverflow.com/questions/49625640/why-dont-the-go-routines-start/49626527#49626527", "title": "Why don&#39;t the GO routines start?", "body": "<p>As <a href=\"https://stackoverflow.com/questions/19208725/example-for-sync-waitgroup-correct\">this</a> solution says: </p>\n\n<blockquote>\n  <p>It is important that the wg.Add() happens before the go statement to\n  prevent race conditions. The following would also be correct:</p>\n</blockquote>\n\n<p>So, you need to take out <code>wg.Add(1)</code> off inside of go routine itself and call it just before starting go routines. Also, call <code>defer wg.Done()</code> at the start of the function, so that, it will decrements the WaitGroup counter by one. Take a look at the code below.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"time\"\n    \"sync\"\n)\n\nfunc main() {\n\n    wg := sync.WaitGroup{}\n\n    fmt.Print(\"Starting 3 clients\\n\")\n\n    for i:=0; i&lt;3; i++ {\n\n        client := func(inName string) {\n\n            defer wg.Done() // added this line\n\n            fmt.Printf(\"Client &lt;%s&gt; started\\n\", inName)\n\n            conn, err := net.Dial(\"tcp\", \":8000\")\n            if err != nil {\n                fmt.Printf(\"[%s] Error while connecting to the server: %s\", inName, err.Error())\n                os.Exit(1)\n            }\n\n            n := 0\n            sleepDuration, _ := time.ParseDuration(\"2s\")\n            for {\n                message := fmt.Sprintf(\"[%s] &gt; message %d\\n\", inName, n)\n                fmt.Printf(\"%s\", message)\n                _, err := conn.Write([]byte(message))\n                if nil != err {\n                    fmt.Sprintf(\"[%s] Error while writing data to the socket: %s\", inName, err.Error())\n                    os.Exit(1)\n                }\n                time.Sleep(sleepDuration)\n                n++\n            }\n        }\n\n        name := fmt.Sprintf(\"Client%d\", i)\n        fmt.Printf(\"Starting client &lt;%s&gt;...\\n\", name)\n        wg.Add(1) // moved this line\n        go client(name)\n        fmt.Print(\"Done\\n\")\n    }\n\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7992250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4865c98587f39c9c41dd9fe1e88c575?s=128&d=identicon&r=PG&f=1", "display_name": "Denis Kertios", "link": "https://stackoverflow.com/users/7992250/denis-kertios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1522747964, "creation_date": 1522744626, "question_id": 49625640, "link": "https://stackoverflow.com/questions/49625640/why-dont-the-go-routines-start", "title": "Why don&#39;t the GO routines start?", "body": "<p>I wrote a simple GO program that should start 3 GO routines. However, the GO routines don't start.</p>\n\n<p>Please note that the situation is not identical to the one describer within this post : </p>\n\n<p><a href=\"https://stackoverflow.com/questions/24425987/why-is-my-goroutine-not-executed\">Why is my goroutine not executed?</a></p>\n\n<p>The program should wait for the GO routines to end their execution... Thus, the program should wait forever (since the routines never stop).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"time\"\n    \"sync\"\n)\n\nfunc main() {\n\n    wg := sync.WaitGroup{}\n\n    fmt.Print(\"Starting 3 clients\\n\")\n\n    for i:=0; i&lt;3; i++ {\n\n        client := func(inName string) {\n\n            fmt.Printf(\"Client &lt;%s&gt; started\\n\", inName)\n\n            wg.Add(1)\n            conn, err := net.Dial(\"tcp\", \":8000\")\n            if err != nil {\n                fmt.Printf(\"[%s] Error while connecting to the server: %s\", inName, err.Error())\n                os.Exit(1)\n            }\n\n            n := 0\n            sleepDuration, _ := time.ParseDuration(\"2s\")\n            for {\n                message := fmt.Sprintf(\"[%s] &gt; message %d\\n\", inName, n)\n                fmt.Printf(\"%s\", message)\n                _, err := conn.Write([]byte(message))\n                if nil != err {\n                    fmt.Sprintf(\"[%s] Error while writing data to the socket: %s\", inName, err.Error())\n                    os.Exit(1)\n                }\n                time.Sleep(sleepDuration)\n                n++\n            }\n        }\n\n        name := fmt.Sprintf(\"Client%d\", i)\n        fmt.Printf(\"Starting client &lt;%s&gt;...\\n\", name)\n        go client(name)\n        fmt.Print(\"Done\\n\")\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Starting 3 clients\nStarting client &lt;Client0&gt;...\nDone\nStarting client &lt;Client1&gt;...\nDone\nStarting client &lt;Client2&gt;...\nDone\n</code></pre>\n"}, {"tags": ["recursion", "go", "types"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1522744468, "last_edit_date": 1522744468, "creation_date": 1522744139, "answer_id": 49625506, "question_id": 49625328, "link": "https://stackoverflow.com/questions/49625328/using-recursion-to-get-the-deeply-nested-struct-in-go/49625506#49625506", "title": "Using recursion to get the deeply nested struct in go", "body": "<p>This syntax:</p>\n\n<pre><code>if v.(type) == map[string]interface{} { /* ... */ }\n</code></pre>\n\n<p>is invalid. You can't compare to a type, only to a value.</p>\n\n<p>What you want may be solved using a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\">type switch</a>, where the cases are indeed types:</p>\n\n<pre><code>func arrayReturn(m map[string]interface{}) []interface{} {\n    for _, v := range m {\n        switch v2 := v.(type) {\n        case map[string]interface{}:\n            return arrayReturn(v2)     // v2 is of type map[string]interface{}\n        case []interface{}:\n            return v2                  // v2 is of type []interface{}\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Also note that if you use a short variable declaration after the <code>switch</code> keyword, in each <code>case</code> the type of the variable used will be what you specify in the <code>case</code>, so no further type assertion is needed!</p>\n"}], "owner": {"reputation": 17, "user_id": 3008021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3753f00f089be470e97d89a1fbf25b5a?s=128&d=identicon&r=PG&f=1", "display_name": "Anoymouswho", "link": "https://stackoverflow.com/users/3008021/anoymouswho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522744468, "creation_date": 1522743448, "last_edit_date": 1522744420, "question_id": 49625328, "link": "https://stackoverflow.com/questions/49625328/using-recursion-to-get-the-deeply-nested-struct-in-go", "title": "Using recursion to get the deeply nested struct in go", "body": "<p>I need to parse an interface read from a JSON object which is deeply nested. I use the following recursive function to get most of the array.  </p>\n\n<pre><code>func arrayReturn(m map[string]interface{}) []interface{} {\n    for _, v:= range m {\n        if v.(type) == map[string]interface{} {\n            return arrayReturn(v.(map[string]interface{}))\n        }\n        if v.(type) == string {\n            return v.([]interface{})\n        } \n    }\n}\n</code></pre>\n\n<p>Which gives this error for the <code>return</code> line:</p>\n\n<pre><code>syntax error: unexpected return, expecting expression\n</code></pre>\n\n<p>What does \"expecting expression\" mean? </p>\n"}, {"tags": ["json", "go", "sendgrid-api-v3", "html-escape", "strconv"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522752499, "post_id": 49625281, "comment_id": 86263130, "body": "Which part of <a href=\"https://sendgrid.com/docs/API_Reference/Web_API_v3/Mail/index.html\" rel=\"nofollow noreferrer\">the docs</a> and <a href=\"https://godoc.org/github.com/sendgrid/sendgrid-go/helpers/mail#NewSingleEmail\" rel=\"nofollow noreferrer\">the Go API</a> is unclear?"}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522775765, "post_id": 49625281, "comment_id": 86278844, "body": "The docs only offer examples of text/plain.  There are no text/html examples to work from."}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522775888, "post_id": 49625281, "comment_id": 86278922, "body": "The established Go API doesn&#39;t work from google app engine standard environment. See my troubleshooting post here: <a href=\"https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang\" title=\"how to use sendgrid from google app engine golang\">stackoverflow.com/questions/49596003/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 48253, "user_id": 3583182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6JxNE.png?s=128&g=1", "display_name": "patricus", "link": "https://stackoverflow.com/users/3583182/patricus"}, "is_accepted": false, "score": 0, "last_activity_date": 1523030389, "creation_date": 1523030389, "answer_id": 49696775, "question_id": 49625281, "link": "https://stackoverflow.com/questions/49625281/how-to-embed-html-inside-json-in-a-format-that-sendgrid-api-accepts/49696775#49696775", "title": "How to embed html inside json in a format that Sendgrid API accepts?", "body": "<p>Looking at the Sendgrid api docs, it looks like it should accept html. You will need to have the html properly escaped in the json string (and set the content->type = \"text/html\").</p>\n\n<p>In your example template, the only problem I see are the double quotes in your meta tag. As a quick test to make sure everything is working, I would attempt to send the following html string:</p>\n\n<pre><code>&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Hi!&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>If that html string is successful, then you need to work on escaping your original html string example. The only invalid characters I see are the double quotes, which need to be escaped in json with backslashes. I'm not sure if go has a specific function for this, but it looks like this should work:</p>\n\n<pre><code>// import \"strings\"\n\nstrings.Replace(emailtpl, `\"`, `\\\"`, -1)\n</code></pre>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 670, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523030389, "creation_date": 1522743269, "last_edit_date": 1522940873, "question_id": 49625281, "link": "https://stackoverflow.com/questions/49625281/how-to-embed-html-inside-json-in-a-format-that-sendgrid-api-accepts", "title": "How to embed html inside json in a format that Sendgrid API accepts?", "body": "<p>I have been trying to send an HTML email using the Sendgrid API, but I have been unsuccessful in embedding the html inside the json request.</p>\n\n<p>This is an example of the html I am trying to send (<code>emailtpl</code>):</p>\n\n<pre><code>&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>Things I have tried:</p>\n\n<ol>\n<li>html.EscapeString(emailtpl)</li>\n<li>strconv.Quote(emailtpl)</li>\n<li>using backticks ` inside the json template</li>\n<li>wrapping value with single quotes for the value in the json template.</li>\n<li>base64.StdEncoding.EncodeToString([]byte(emailtpl)) only display the base64 gibberish.</li>\n</ol>\n\n<p>Items #1 and #5 are the only solutions that Sendgrid has accepted, but the html sent is not correct (as shown in the screenshot).</p>\n\n<p><a href=\"https://i.stack.imgur.com/RqUZq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RqUZq.png\" alt=\"escape-butchered\"></a></p>\n\n<p>Items #2 - #4 all result in Status 400 Bad Request.</p>\n\n<p>Does anyone know how to embed html into Sendgrid API request that Sendgrid accepts AND it renders correctly?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1522740400, "creation_date": 1522740400, "answer_id": 49624511, "question_id": 49624365, "link": "https://stackoverflow.com/questions/49624365/how-do-i-use-reflection-to-get-slice-data/49624511#49624511", "title": "How do I use reflection to get slice data?", "body": "<p>From <a href=\"https://golang.org/pkg/reflect/#Value.NumField\" rel=\"nofollow noreferrer\">the docs</a>:</p>\n\n<blockquote>\n  <p>NumField returns the number of fields in the struct v. It panics if v's Kind is not Struct.</p>\n</blockquote>\n\n<p>Since your input is a slice, not a struct, <code>NumField</code> is supposed to panic.</p>\n\n<p>You probably need the <a href=\"https://golang.org/pkg/reflect/#Value.Slice\" rel=\"nofollow noreferrer\">Slice</a> method.</p>\n"}], "owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1522740400, "creation_date": 1522739894, "question_id": 49624365, "link": "https://stackoverflow.com/questions/49624365/how-do-i-use-reflection-to-get-slice-data", "title": "How do I use reflection to get slice data?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\n//AuthRequest struct\ntype AuthRequest struct {\n    Id int64\n}\n\nfunc main() {\n    //AuthRequest auth1\n    auth1 := AuthRequest{\n        Id : 1111,\n    }\n    //Authrequest auth2\n    auth2 := AuthRequest{\n        Id : 2222,\n    }\n\n    //create slice\n    var sliceModel = make([]AuthRequest, 0)\n\n    //put element to slice\n    sliceModel = append(sliceModel, auth1)\n    sliceModel = append(sliceModel, auth2)\n\n    //Pointer to an array\n    model := &amp;sliceModel\n\n    //How do I get the struct Id field here?\n    v := reflect.ValueOf(model).Elem()\n    for j := 0; j &lt; v.NumField(); j++ {\n        f := v.Field(j)\n        n := v.Type().Field(j).Name\n        t := f.Type().Name()\n        fmt.Printf(\"Name: %s  Kind: %s  Type: %s\\n\", n, f.Kind(), t)\n    }\n}\n</code></pre>\n\n<p>When I execute the above code, I get the following error.</p>\n\n<p><strong>panic: reflect: call of reflect.Value.NumField on slice Value [recovered]</strong></p>\n\n<p>How do I use reflection to traverse slice to get the value of Id field in the struct AuthRequest?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1522740152, "post_id": 49624243, "comment_id": 86255759, "body": "Thankyou giving me this answer. it works . but can i do it with the <code>$match</code> also?? @icza"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1522740232, "post_id": 49624243, "comment_id": 86255805, "body": "@Puneet What do you want to do with <code>$match</code>? You can include filtering with <code>$match</code> in pipeline, sure."}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1522740302, "post_id": 49624243, "comment_id": 86255843, "body": "okay thanks i just asking because I&#39;m reading the other documentation of the mongodb that&#39;s why"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1522739484, "creation_date": 1522739484, "answer_id": 49624243, "question_id": 49622758, "link": "https://stackoverflow.com/questions/49622758/how-to-group-the-collection-data-having-same-user-id-in-mongodb-using-golang/49624243#49624243", "title": "How to $group the collection data having same user_id in mongodb using golang?", "body": "<p>When grouping using <code>$group</code>, you have to use the special <code>_id</code> property to tell what you want to group by.</p>\n\n<p>And when referring to existing properties / fields, you have to use the <code>$</code> sign in front of their names, e.g. <code>$user_id</code>.</p>\n\n<p>And besides the <code>_id</code> you may list additional properties whose value may be some aggregate value (like <code>$sum</code>).</p>\n\n<p>This is how your pipeline may look like:</p>\n\n<pre><code>pipeline := []bson.M{\n    {\n        \"$group\": bson.M{\n            \"_id\":       \"$user_id\",\n            \"sum_price\": bson.M{\"$sum\": \"$price\"},\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 49624243, "answer_count": 1, "score": 1, "last_activity_date": 1522757219, "creation_date": 1522732895, "last_edit_date": 1522757219, "question_id": 49622758, "link": "https://stackoverflow.com/questions/49622758/how-to-group-the-collection-data-having-same-user-id-in-mongodb-using-golang", "title": "How to $group the collection data having same user_id in mongodb using golang?", "body": "<p>I'm trying to make the sum of the price of the product which having same <code>user_id</code> using golang. But I don't know how I will get this. I tried <code>$group</code> in the following code</p>\n\n<p>Struct for product</p>\n\n<pre><code>type Product struct {\n  Id         int     `json:\"id\" bson:\"_id\"`\n  Name       string  `json:\"name\" bson:\"name\"`\n  Sku        string  `json:\"sku\" bson:\"sku\"`\n  Category   string  `json:\"category\" bson:\"category\"`\n  Stock      int     `json:\"stock\" bson:\"stock\"`\n  Price      float64 `json:\"price\" bson:\"price\"`\n  Sale_price float64 `json:\"sale_price\" bson:\"sale_price\"`\n  UpdatedOn  int64   `json:\"updated_on\" bson:\"updated_on\"`\n  UserId     int     `json:\"user_id\" bson:\"user_id\"`\n}\n</code></pre>\n\n<p>Struct for the customer</p>\n\n<pre><code>type Customer struct {\n  Id               int    `json:\"id\" bson:\"_id\"`\n  FirstName        string `json:\"first_name\" bson:\"first_name\"`\n  LastName         string `json:\"last_name\" bson:\"last_name\"`\n  Email            string `json:\"email\" bson:\"email\"`\n  PhoneNumber      string `json:\"phone_number\" bson:\"phone_number\"`\n}\n</code></pre>\n\n<p>function from where the data will retrieve </p>\n\n<pre><code>func GetProducts(c *gin.Context) {\n    mongoSession := config.ConnectDb()                                         //connection to database\n    collection := mongoSession.DB(config.Database).C(config.ProductCollection) //session\n    pipeline := []bson.M{\n        bson.M{\"$group\": bson.M{\"user_id\": 1}}, bson.M{\"$sum\": bson.M{\"price\": \"price\"}},\n    } //query i tried\n    fmt.Println(pipeline)\n    pipe := collection.Pipe(pipeline)\n    resp := []bson.M{}\n    err = pipe.All(&amp;resp)\n    if err != nil {\n        fmt.Println(\"Errored: %#v \\n\", err)\n    }\n    fmt.Println(resp)\n    GetResponseList(c, response)\n}\n</code></pre>\n\n<p>The data viewed in the image-</p>\n\n<p><a href=\"https://i.stack.imgur.com/hMVuP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hMVuP.png\" alt=\"\"></a></p>\n\n<p>In the above image the <code>user_id</code> of the product is same. I want to group this data and calculate the <code>price</code>.</p>\n\n<p>I also read the documentation of the Mongodb <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/\" rel=\"nofollow noreferrer\">this one</a> but don't understand how to do in golang can anyone explain it in simple way how to make the query for this.    Thanks</p>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "edited": false, "score": 0, "creation_date": 1522728169, "post_id": 49621716, "comment_id": 86250881, "body": "I want it to handle the gracefulstop. Also I want the rpc handler to be able to do the cleanups"}, {"owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "reply_to_user": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "edited": false, "score": 0, "creation_date": 1522731066, "post_id": 49621716, "comment_id": 86251750, "body": "This will handle the graceful stop. If you want the rpc handler to do the cleanup then you need create the signal channel in rpc handler itself"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1522739414, "post_id": 49621716, "comment_id": 86255349, "body": "Don&#39;t forget to wait for the goroutine to finish (or timeout) before exiting the <code>main</code> function."}], "tags": [], "owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "is_accepted": false, "score": 0, "last_activity_date": 1522725741, "creation_date": 1522725741, "answer_id": 49621716, "question_id": 49621189, "link": "https://stackoverflow.com/questions/49621189/how-to-listen-for-graceful-server-termination-in-grpc/49621716#49621716", "title": "How to listen for graceful server termination in grpc", "body": "<p>You can have shutdown hook by listening to the signals something like this</p>\n\n<p>In your main function or where you start your server create channel for signals that you want to listen to </p>\n\n<pre><code>c := make(chan os.Signal, 1)\nsignal.Notify(c, syscall.SIGINT, syscall.SIGTERM)\n// call your cleanup method with this channel as a routine\ngo cleanup(c)\n</code></pre>\n\n<p>In your clean up method</p>\n\n<pre><code>func cleanup(c chan os.Signal) {\n   // Wait for termination\n   &lt;- c\n\n  // Do your cleanups here\n}\n</code></pre>\n\n<p>Create the signal channel and call the <code>cleanup</code> function as a go routine before you start the gRPC server. Whenever the application (gRPC server) stopped or interrupted this channel will get the signal in the <code>cleanup</code> function where you can do the necessary cleanups </p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": false, "score": 0, "last_activity_date": 1523639961, "creation_date": 1523639961, "answer_id": 49822184, "question_id": 49621189, "link": "https://stackoverflow.com/questions/49621189/how-to-listen-for-graceful-server-termination-in-grpc/49822184#49822184", "title": "How to listen for graceful server termination in grpc", "body": "<p>Currently there's no mechanism to signal a service handler about Graceful stop. Cleanups and other such global functions that must happen upon server exiting wouldn't usually happen inside of a service handler.\nThat said, if you think your design is better off with such cleanups happening inside of the service handler and a signal from graceful close is critical, we would love to hear more about your use case. Perhaps open an issue on our github <a href=\"https://github.com/grpc/grpc-go\" rel=\"nofollow noreferrer\">repo</a> and we can discuss it there. </p>\n\n<p>Best,</p>\n\n<p>Mak</p>\n"}, {"tags": [], "owner": {"reputation": 579, "user_id": 1608682, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/pVLpr.jpg?s=128&g=1", "display_name": "I.Tyger", "link": "https://stackoverflow.com/users/1608682/i-tyger"}, "is_accepted": false, "score": 0, "last_activity_date": 1602589798, "last_edit_date": 1602589798, "creation_date": 1554884974, "answer_id": 55608042, "question_id": 49621189, "link": "https://stackoverflow.com/questions/49621189/how-to-listen-for-graceful-server-termination-in-grpc/55608042#55608042", "title": "How to listen for graceful server termination in grpc", "body": "<p>For grpc servers u can do this</p>\n<pre><code>func waitForGracefulShutdown(srv *grpc.Server) {\n    fmt.Println(&quot;Grpc messaging server started ...&quot;)\n    interruptChan := make(chan os.Signal, 1)\n    signal.Notify(interruptChan, os.Interrupt, syscall.SIGINT, syscall.SIGTERM)\n\n    // Block until we receive our signal.\n    &lt;-interruptChan\n\n    // Create a deadline to wait for.\n    _, cancel := context.WithTimeout(context.Background(), time.Second*10)\n    defer cancel()\n    srv.GracefulStop()\n    publisher, messagingError := messaging.GetPublisherInstance()\n    if messagingError.Error == nil {\n        publisher.Close()\n    }\n\n    log.Println(&quot;Shutting down grpc messaging server.&quot;)\n    os.Exit(0)\n}\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2824, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1602589798, "creation_date": 1522721174, "question_id": 49621189, "link": "https://stackoverflow.com/questions/49621189/how-to-listen-for-graceful-server-termination-in-grpc", "title": "How to listen for graceful server termination in grpc", "body": "<p>I want to listen for graceful server termination in grpc in my handler. When the server is being stopped gracefully, I want to add some logic in my code to close open ports, files, flush results etc. How can I do that?</p>\n\n<p>How is it different in case of unary and streaming handler?</p>\n"}, {"tags": ["nginx", "go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 1642, "user_id": 3097900, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/eDetc.jpg?s=128&g=1", "display_name": "Adriano Martins", "link": "https://stackoverflow.com/users/3097900/adriano-martins"}, "is_accepted": false, "score": 0, "last_activity_date": 1522720015, "last_edit_date": 1522720015, "creation_date": 1522718596, "answer_id": 49620886, "question_id": 49620796, "link": "https://stackoverflow.com/questions/49620796/deploying-a-golang-beego-in-production/49620886#49620886", "title": "Deploying a Golang (Beego) in production", "body": "<p>1 - Pretty much install golang (Using the built-in version: <code>sudo apt-get install golang-go</code> or <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"nofollow noreferrer\">Detailed guide</a>) and build the project or simply copy the built project and their libs if needed;</p>\n\n<p>2 - Ideally, the production environment shouldn't include the source codes on most scenarios, therefore a built server could be better.  </p>\n\n<p>3 - Although not required, most people recommend to run golang behind a nginx. The reason for that is due to several optimizations (eg:static files serving) made on NGinx/Apache, which you would be missing on direct running your bin on server 80.</p>\n\n<p>Side notes:<br>\n- the <code>go run ...</code> is the same thing as the <code>go build ...</code> + run the built executable<br>\n- If you are just deploying the binary, build using the same OS / configurations.<br>\n- Remember to follow the basic security guides, just open the ports needed, secure the server before deploying, limit users access, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "is_accepted": false, "score": 1, "last_activity_date": 1522753514, "creation_date": 1522753514, "answer_id": 49628498, "question_id": 49620796, "link": "https://stackoverflow.com/questions/49620796/deploying-a-golang-beego-in-production/49628498#49628498", "title": "Deploying a Golang (Beego) in production", "body": "<p>How to deploy in Ubuntu and NGINX environment?</p>\n\n<ol>\n<li>Install Golang and run your Golang app on a particular port at localhost (say localhost:9000).</li>\n<li>Install Nginx (<a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04</a>)</li>\n<li>Choose a domain or subdomain that you wish to point to your Golang App.</li>\n<li><p>Create Nginx server block (<a href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04</a>)</p>\n\n<p>Example Server block pointing to Golang App running at localhost:9000:</p>\n\n<pre><code>server {\n        listen 80;\n        server_name my.domain.com;\n\n        location / {\n        proxy_pass http://localhost:9000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For         \n        $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n        proxy_pass_request_headers on;\n        proxy_read_timeout 150;\n    }\n}    \n</code></pre></li>\n<li>To run your program efficiently, you may use supervisor (<a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps</a>)</li>\n</ol>\n"}], "owner": {"reputation": 598, "user_id": 3431424, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/50c1a42476ac4643d7a9b2e72bda4770?s=128&d=identicon&r=PG", "display_name": "Jake Pucan", "link": "https://stackoverflow.com/users/3431424/jake-pucan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1522753514, "creation_date": 1522717745, "question_id": 49620796, "link": "https://stackoverflow.com/questions/49620796/deploying-a-golang-beego-in-production", "title": "Deploying a Golang (Beego) in production", "body": "<p>I came from a PHP background w/c is you can easily throw a PHP file in a server and that's it! How about in Golang, to be specific is the Beego framework because I already created a website using Beego but my stopper is (Q1)How to deploy in Ubunto and NGINX environment? (Q2)Do i need to compile the Beego project before deploying? (Q3)Do i need NGINX/Apache as server or use the built-in \"run\" of Beego?</p>\n\n<p>Thank You.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1522708777, "post_id": 49619620, "comment_id": 86246499, "body": "Technically it should be empty since Go strings can&#39;t be null, but prepare yourself for pain in the future if you ignore the docs."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1522709716, "last_edit_date": 1522709716, "creation_date": 1522708462, "answer_id": 49619715, "question_id": 49619620, "link": "https://stackoverflow.com/questions/49619620/is-gos-sql-nullstrings-value-predictably-empty/49619715#49619715", "title": "Is Go&#39;s sql.NullString&#39;s Value predictably empty?", "body": "<p>In the <a href=\"https://golang.org/src/database/sql/sql.go?s=4428:4479#L157\" rel=\"nofollow noreferrer\">current implementation</a> yes, but the docs explicitly say to check Valid before using String. Ignore the docs at your own risk.</p>\n\n<p>If you want to be safe, simply copy the type into your own package; then you know it's not going to change with the next Go release.</p>\n\n<p>If you don't do that, I strongly suggest to write a test:</p>\n\n<pre><code>func TestEmptyNullString(t *testing.T) {\n    var x sql.NullString\n    x.String = \"foo\"\n    x.Scan(nil)\n    if x.String != \"\" {\n        t.Error(\"string not empty after Scan\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1289, "user_id": 670659, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/MZy0s.jpg?s=128&g=1", "display_name": "Miles", "link": "https://stackoverflow.com/users/670659/miles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 49619715, "answer_count": 1, "score": 1, "last_activity_date": 1522709716, "creation_date": 1522707902, "last_edit_date": 1522709060, "question_id": 49619620, "link": "https://stackoverflow.com/questions/49619620/is-gos-sql-nullstrings-value-predictably-empty", "title": "Is Go&#39;s sql.NullString&#39;s Value predictably empty?", "body": "<p>After using <code>db.Query</code> and <code>rows.Scan</code> to populate a <code>sql.NullString</code> with a <code>NULL</code> value such that its <code>.Valid</code> field is <code>false</code>, is it guaranteed that its <code>.String</code> will hold the empty string <code>\"\"</code>?</p>\n\n<p>I ask because it would be snazzy if I could use this:</p>\n\n<pre><code>res := ns.String\n</code></pre>\n\n<p>Instead of this:</p>\n\n<pre><code>var res string\nif ns.Valid {\n    res = ns.String\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#NullString</a></p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1522698967, "post_id": 49617904, "comment_id": 86242804, "body": "You&#39;re calling <code>wg.Add(1)</code> once and calling <code>wg.Done()</code> inside a loop. Don&#39;t call <code>wg.Done</code> until, well, you&#39;re actually done."}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522699392, "post_id": 49617904, "comment_id": 86242986, "body": "@Adrian Thanks. I am updating my code. Now, I have displayed: WARNING: DATA RACE"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522699553, "post_id": 49617904, "comment_id": 86243057, "body": "@tcoder01: yes, you have a data race. You cannot read and write the same value concurrently."}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1522699628, "post_id": 49617904, "comment_id": 86243092, "body": "You need to call <code>Add</code> before calling <code>Wait</code> on a <code>sync.WaitGroup</code>."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 1, "creation_date": 1522699876, "post_id": 49617904, "comment_id": 86243201, "body": "I do not want to spoil this whole thing, but the overall approach is massively suboptimal: if all you want it a shared counter, use the <code>atomic</code> package as in <a href=\"https://gobyexample.com/atomic-counters\" rel=\"nofollow noreferrer\">gobyexample.com/atomic-counters</a> Using channels would be idiomatic, but tricky here. But even using a simple read/readwrite lock would make your code much simpler conceptually. You lock RW before you increment, unlock immediately after; you lock R to read out the value, unlock immediately after, then print."}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522700047, "post_id": 49617904, "comment_id": 86243275, "body": "@JimB thanks. Any tips on how to fix this ? I have read about <code>sync.RWMutex{}</code>, and I am willing to study it more. My concern is: what if I have read operation that are a lot more frequent than write operations. Are you suggesting to lock <code>counter</code> on every read operation? will this delay the write ? Sorry, I come from js background with no experience in concurrency"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1522700133, "post_id": 49617904, "comment_id": 86243307, "body": "Use a Mutex. If there are a lot more reads than writes, use an RWMutex. Yes, you need a lock of some sort for any read or write operation. I&#39;m not sure what there is to study, there&#39;s not much to it."}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "reply_to_user": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1522700135, "post_id": 49617904, "comment_id": 86243310, "body": "@OlegSklyar Thanks a lot! I needed this explanation :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1522700209, "post_id": 49617904, "comment_id": 86243362, "body": "@OlegSklyar: having looked at massive amounts of production Go code over many years, I would say that channels are <i>not</i> idiomatic for mutual exclusion around a single value, nor is sync/atomic. You will almost always find a simple mutex around a shared value."}, {"owner": {"reputation": 1445, "user_id": 5972487, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/024fcbdd0ee00e2dccefce0ef67bc434?s=128&d=identicon&r=PG", "display_name": "elmiomar", "link": "https://stackoverflow.com/users/5972487/elmiomar"}, "edited": false, "score": 0, "creation_date": 1522700375, "post_id": 49617904, "comment_id": 86243443, "body": "<a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">Mutexes</a> and <a href=\"https://gobyexample.com/atomic-counters\" rel=\"nofollow noreferrer\">Atomic Counters</a> might be helpful reads."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522700499, "post_id": 49617904, "comment_id": 86243489, "body": "I assume this is just an experiment, yes? Otherwise you can just compute the counter&#39;s value from delta T. You don&#39;t need an actual counter."}, {"owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522700528, "post_id": 49617904, "comment_id": 86243505, "body": "@JimB I must say I do not see a trivial solution with channels either, but I am surprised why would you prefer a mutex to atomic in this case?"}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522700774, "post_id": 49617904, "comment_id": 86243609, "body": "@Peter for now, this is just an experiment. In the future, instead of counter, I need to update a global struct state recurrently. The global state will be available to read operations with various frequency"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "edited": false, "score": 0, "creation_date": 1522700806, "post_id": 49617904, "comment_id": 86243627, "body": "@OlegSklyar: in the case of a simple counter, I would usually give atomic operations a pass, as the implementation is pretty straightforward. In the general case of shared values, a mutex is usually easier to reason about and avoids errors using the variety of other atomic functions. Only when proven that atomic operations are needed, via performance benchmarking, or other particular requirements, would atomic operations be added."}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "edited": false, "score": 0, "creation_date": 1522701096, "post_id": 49617904, "comment_id": 86243762, "body": "Thanks everyone for the answers :)  Things are clearer for me now"}, {"owner": {"reputation": 1445, "user_id": 5972487, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/024fcbdd0ee00e2dccefce0ef67bc434?s=128&d=identicon&r=PG", "display_name": "elmiomar", "link": "https://stackoverflow.com/users/5972487/elmiomar"}, "edited": false, "score": 0, "creation_date": 1522701290, "post_id": 49617904, "comment_id": 86243842, "body": "@tcoder01 I think what you want to implement is similar to the <a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">Mutexes</a> example from <a href=\"https://gobyexample.com/\" rel=\"nofollow noreferrer\">Go By Example</a>, which is clearly explained."}, {"owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "reply_to_user": {"reputation": 1445, "user_id": 5972487, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/024fcbdd0ee00e2dccefce0ef67bc434?s=128&d=identicon&r=PG", "display_name": "elmiomar", "link": "https://stackoverflow.com/users/5972487/elmiomar"}, "edited": false, "score": 0, "creation_date": 1522701649, "post_id": 49617904, "comment_id": 86244001, "body": "@elmiomar exactly thanks."}], "answers": [{"tags": [], "owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "is_accepted": true, "score": 0, "last_activity_date": 1522711153, "creation_date": 1522711153, "answer_id": 49620081, "question_id": 49617904, "link": "https://stackoverflow.com/questions/49617904/cannot-to-write-in-one-goroutine-and-read-from-another-indefintely/49620081#49620081", "title": "Cannot to write in one goroutine and read from another indefintely", "body": "<p>One way may be to send message to 2nd gorutine when it comes time to print. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    fmt.Println(\"Start\");\n    counter := 0\n\n    printChannel := make( chan int)\n    done := make(chan struct{} )\n\n    go func(done &lt;-chan struct{}, printChannel chan&lt;- int  ){\n        timer := time.NewTicker(time.Second)\n        bDone := false;\n        for !bDone {\n            select {\n            case &lt;-timer.C:\n                counter++\n                if counter%2 == 0 {\n                    printChannel &lt;- counter\n                }\n            case &lt;-done:\n                bDone=true\n            }\n        }\n    }(done, printChannel)\n\n    go func(done &lt;-chan struct{}, printChannel &lt;-chan int ){\n        bDone:=false\n        for !bDone{\n            select {\n            case n := &lt;-printChannel:\n                fmt.Print(n, \" \");\n            case &lt;-done:\n                bDone=true\n            }\n        }\n    }(done,printChannel)\n\n\n    //whatever logic to stop\n    go func() {\n        &lt;- time.After(21*time.Second)\n        done &lt;- struct{}{}\n    }()\n\n    &lt;-done\n\n    fmt.Println(\"\\nEnd\");\n\n}\n</code></pre>\n\n<p>Note that here there is 3rd gorutine just to finish the example</p>\n\n<p>Output: </p>\n\n<pre><code>Start\n2 4 6 8 10 12 14 16 18 20 \nEnd\n</code></pre>\n\n<p>To improve it, you can do it without bDone variable, you can stop Ticker and add appropriate message when gorutine exists.\nOr you may want to test 'break' with label to exit for loop.<br>\nYou can test effect when you use close(done) channel instead of sending message to it.<br>\nAlso, if you are ready to relax read/write order, you can remove printChannel and make 2nd gorutine use another ticker that pings every 2 seconds.  </p>\n"}], "owner": {"reputation": 99, "user_id": 6842205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b27d57862db7038014309ff206b50c?s=128&d=identicon&r=PG&f=1", "display_name": "tcoder01", "link": "https://stackoverflow.com/users/6842205/tcoder01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 49620081, "answer_count": 1, "score": -2, "last_activity_date": 1522711153, "creation_date": 1522698907, "last_edit_date": 1522699515, "question_id": 49617904, "link": "https://stackoverflow.com/questions/49617904/cannot-to-write-in-one-goroutine-and-read-from-another-indefintely", "title": "Cannot to write in one goroutine and read from another indefintely", "body": "<p>I am in the process of learning go, and I am having trouble with <code>goroutines</code>. Here is my code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar counter = 0\nvar wg = sync.WaitGroup{}\n\nfunc main() {\n    ticker := time.NewTicker(time.Second)\n    go func() {\n        for range ticker.C {\n            // wg.Add(1)\n            // defer wg.Done()\n            counter++\n            fmt.Println(counter)\n            //wg.Done()\n        }\n    }()\n\n    ticker2 := time.NewTicker(time.Second * 2)\n    wg.Add(1)\n    go func() {\n        for range ticker2.C {\n            //defer wg.Done()\n            fmt.Println(counter)\n        }\n    }()\n    wg.Wait()\n}\n</code></pre>\n\n<p>Basically, I would like to have:</p>\n\n<ul>\n<li>a global variable called <code>counter</code></li>\n<li>one <code>goroutine</code> that keeps updating this counter every one 1 second</li>\n<li>another <code>goroutine</code> that keeps printing this counter every two seconds</li>\n</ul>\n\n<p>Playground is <a href=\"https://play.golang.org/p/9PLpwqaA3LG\" rel=\"nofollow noreferrer\">here</a>\nI tried to play with <code>WaitGroup</code> but I did not manage to have this working.\nWith this level of code, I have the following warning:</p>\n\n<pre><code>WARNING: DATA RACE\nRead at 0x0000011d8318 by goroutine 8:\n  runtime.convT2E64()\n</code></pre>\n\n<p>Another question is this thread safe? I mean, can I safely use counter in the main method outside of the two groroutines?</p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1522698171, "post_id": 49617717, "comment_id": 86242447, "body": "That depends on what you&#39;re doing with the data. Is part of a row something you can act on? Usually when processing a CSV the smallest viable unit of work is one row."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1522698256, "post_id": 49617717, "comment_id": 86242492, "body": "Seems right. If you end up with your program bogging down the system or dying due to memory use, or something like that, post a question with more context of what you&#39;re doing and what you see happening."}, {"owner": {"reputation": 175, "user_id": 7902359, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/cc136e9fe72b06c7f6c2f201bf9e7b39?s=128&d=identicon&r=PG&f=1", "display_name": "ecl0", "link": "https://stackoverflow.com/users/7902359/ecl0"}, "edited": false, "score": 0, "creation_date": 1522700234, "post_id": 49617717, "comment_id": 86243375, "body": "I am writing each record/row to a database by sending an array over GRPC to a separate service."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1522733488, "post_id": 49617717, "comment_id": 86252640, "body": "What qualifies as &quot;best&quot; or &quot;better&quot; depends on a lot of factors, several of them even external to code. Never start thinking about &quot;better&quot;, &quot;improve&quot; or that like until you are sure about the quality characteristics you are after."}], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 2, "last_activity_date": 1522703063, "creation_date": 1522703063, "answer_id": 49618797, "question_id": 49617717, "link": "https://stackoverflow.com/questions/49617717/how-to-read-large-csv-files/49618797#49618797", "title": "How to read large CSV files", "body": "<p>Yes, there is one option you can use to improve it.<br>\nIt is possible to allow reader to reuse a slice that is returned by it on each <code>Read</code> method call.<br>\nTo do it you need to set <code>reader.ReuseRecord = true</code>.<br>\nBut be careful, because the returned slice may be changed after the next call of <code>Read</code>!</p>\n"}], "owner": {"reputation": 175, "user_id": 7902359, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/cc136e9fe72b06c7f6c2f201bf9e7b39?s=128&d=identicon&r=PG&f=1", "display_name": "ecl0", "link": "https://stackoverflow.com/users/7902359/ecl0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1213, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522703063, "creation_date": 1522698062, "last_edit_date": 1522700212, "question_id": 49617717, "link": "https://stackoverflow.com/questions/49617717/how-to-read-large-csv-files", "title": "How to read large CSV files", "body": "<p>What is the best way to read large CSV files, at the moment I am reading one record at a time rather than using <code>ReadAll()</code>.</p>\n\n<pre><code>reader := csv.NewReader(csvFile)\nreader.FieldsPerRecord = -1\n\nfor {\n    // read just one record at a time\n    record, err := reader.Read()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        checkErr(err)\n        return\n    }\n</code></pre>\n\n<p>Is there a better way to do this to save memory?</p>\n\n<p>I am writing each record/row to a database by sending an array over GRPC to a separate service.</p>\n"}, {"tags": ["linux", "go", "concurrency", "scheduling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522697286, "post_id": 49617451, "comment_id": 86241995, "body": "You&#39;re running into situations that are very unlikely under real-world circumstances - i.e. weird stuff is happening because this is a weird, artificial example that tries to simulate work."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522697406, "post_id": 49617451, "comment_id": 86242056, "body": "Actually, this example is contrived because I wanted to isolate the problem, but this behavior came up while I was writing a websocket broadcasting server, and the capacity was ~10x less than expected because of this issue. The rough analogy is that the main goroutine generates messages and pushes them onto the broadcast goroutine, and the work is sending the message to each listening client."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522697518, "post_id": 49617451, "comment_id": 86242121, "body": "That&#39;s pretty strange, considering that any non-inlined function call causes the current routine to yield to the scheduler. What version of Go is this?"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522697678, "post_id": 49617451, "comment_id": 86242207, "body": "1.10. What you just said is surprising, I haven&#39;t found that to be the case. The slow function call in my program is WriteMessage() onto a websocket connection, using the gorilla/websocket package. I definitely get different behavior when I interleave the broadcasting WriteMessage() calls with runtime.Gosched()."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1522697831, "post_id": 49617451, "comment_id": 86242282, "body": "The logging statement makes an IO operation, which makes a system call. A system call makes the runtime run the scheduling algorithm."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522697890, "post_id": 49617451, "comment_id": 86242310, "body": "This seems more appropriate for the Go issue tracker or mailing list. A quirk or bug in a specific implementation isn&#39;t really on topic here."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522697897, "post_id": 49617451, "comment_id": 86242313, "body": "But why does runtime.Gosched() alone fail to run the scheduler?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522697930, "post_id": 49617451, "comment_id": 86242331, "body": "@rampatowl: Gosched should yield to the scheduler. Something else is going on."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522701203, "post_id": 49617451, "comment_id": 86243807, "body": "Thanks for the tips. I submitted the question to golang-nuts. In the meantime, I updated this question with more details in case anyone has any ideas!"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522703430, "post_id": 49617451, "comment_id": 86244725, "body": "@JimB: Have you reproduced this issue on Ubuntu?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1522704629, "post_id": 49617451, "comment_id": 86245232, "body": "@peterSO, just spun up a 16.04.4 node with go1.10.1, and got similar results to the OP. With only <code>GoSched()</code> it is noticeably slower. Adding the <code>fmt.Println</code> makes it faster unless stdout is redirected to a file, in which case it reverts to the 6+ second runtime. I&#39;m guessing the new Linux file poller is interfering here somehow"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522782540, "post_id": 49617451, "comment_id": 86282622, "body": "A couple updates: I updated the original post with a much simpler example showing the weird behavior, without channels or filler work. This example also shows that Gosched() is being called, just with what appears to be a 5ms delay (unless preceded by a print statement). To see if it was an ssh issue, I tried ssh&#39;ing into my Mac from another computer and the program ran fast. Tried another Linux distro (Amazon 4.9.81) and the program was slow."}], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522706122, "post_id": 49618694, "comment_id": 86245738, "body": "The plot thickens! Thanks for running this on your machine. I am on <code>Linux 4.4.0-1047-aws</code>, perhaps that is the issue? This was the default Linux OS through AWS so I assumed it wouldn&#39;t have any issues..."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522708440, "post_id": 49618694, "comment_id": 86246400, "body": "@rampatowl: I ran this on several real machines using Ubuntu 17.10, Linux 4.13 and the times were around 1.1 seconds. To match your Ubuntu 16.04, Linux 4.4, I ran under a virtual machine, VirtualBox and WSL Ubuntu, on real machines and the times were around 1.5 seconds. Nothing close to 10 seconds."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1522709667, "post_id": 49618694, "comment_id": 86246747, "body": "Maybe it has something to do with how we&#39;re connecting to the machines? I am <code>ssh</code>ing into an AWS box, and maybe @JimB is doing something similar to get the same result whereas peterSO is on a real machine. I spun up a different distro (amazon AMI, Linux 4.9.81) and am still getting 6+ second results."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1522702633, "creation_date": 1522702633, "answer_id": 49618694, "question_id": 49617451, "link": "https://stackoverflow.com/questions/49617451/golang-scheduler-mystery-linux-vs-mac-os-x/49618694#49618694", "title": "Golang scheduler mystery: Linux vs Mac OS X", "body": "<blockquote>\n  <p>When I add periodic runtime.Gosched() calls in the second goroutine,\n  as expected the program runtime shrinks down to 1 second on my Mac.\n  However, when I try running the same program on Ubuntu, it still takes\n  10 seconds.</p>\n</blockquote>\n\n<hr>\n\n<p>On Ubuntu, I'm unable to reproduce your issue, one second, not ten seconds,</p>\n\n<p>Output:</p>\n\n<pre><code>$ uname -srvm\nLinux 4.13.0-37-generic #42-Ubuntu SMP Wed Mar 7 14:13:23 UTC 2018 x86_64\n$ go version\ngo version devel +f1deee0e8c Mon Apr 2 20:18:14 2018 +0000 linux/amd64\n$ go build rampatowl.go &amp;&amp; time ./rampatowl\n2018/04/02 16:52:04 Finished in 1.122870 seconds.\nreal    0m1.128s\nuser    0m1.116s\nsys 0m0.012s\n$ \n</code></pre>\n\n<p><code>rampatowl.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc doWork(c chan int) {\n    for {\n        &lt;-c\n\n        // This outer loop will take ~10ms.\n        for j := 0; j &lt; 100; j++ {\n            // The following block of CPU work takes ~100 microseconds\n            for i := 0; i &lt; 300000; i++ {\n                _ = i * 17\n            }\n            // Somehow this print statement saves the day in Ubuntu\n            //log.Printf(\"donkey\")\n            runtime.Gosched()\n        }\n    }\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    c := make(chan int, 1000)\n    go doWork(c)\n\n    start := time.Now().UnixNano()\n    for i := 0; i &lt; 1000; i++ {\n        time.Sleep(1 * time.Millisecond)\n\n        // Queue up 10ms of work in the other goroutine, which will backlog\n        // this goroutine without runtime.Gosched() calls.\n        c &lt;- 0\n    }\n\n    // Whole program should take about 1 second to run if the Gosched() calls\n    // work, otherwise 10 seconds.\n    log.Printf(\"Finished in %f seconds.\", float64(time.Now().UnixNano()-start)/1e9)\n}\n</code></pre>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 404, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1598479482, "creation_date": 1522696941, "last_edit_date": 1598479482, "question_id": 49617451, "link": "https://stackoverflow.com/questions/49617451/golang-scheduler-mystery-linux-vs-mac-os-x", "title": "Golang scheduler mystery: Linux vs Mac OS X", "body": "<p>I've run into some mysterious behavior with the Go scheduler, and I'm very curious about what's going on. The gist is that <code>runtime.Gosched()</code> doesn't work as expected in Linux unless it is preceded by a <code>log.Printf()</code> call, but it works as expected in both cases on OS X. Here's a minimal setup that reproduces the behavior:</p>\n<p>The main goroutine sleeps for 1000 periods of 1ms, and after each sleep pushes a dummy message onto another goroutine via a channel. The second goroutine listens for new messages, and every time it gets one it does 10ms of work. So without any <code>runtime.Gosched()</code> calls, the program will take 10 seconds to run.</p>\n<p>When I add periodic <code>runtime.Gosched()</code> calls in the second goroutine, as expected the program runtime shrinks down to 1 second on my Mac. However, when I try running the same program on Ubuntu, it still takes 10 seconds. I made sure to set <code>runtime.GOMAXPROCS(1)</code> in both cases.</p>\n<p>Here's where it gets really strange: if I just add a logging statement before the <code>runtime.Gosched()</code> calls, then suddenly the program runs in the expected 1 second on Ubuntu as well.</p>\n<pre><code>package main\n\nimport (\n    &quot;time&quot;\n    &quot;log&quot;\n    &quot;runtime&quot;\n)\n\nfunc doWork(c chan int) {\n    for {\n        &lt;-c\n\n        // This outer loop will take ~10ms.\n        for j := 0; j &lt; 100 ; j++ {\n            // The following block of CPU work takes ~100 microseconds\n            for i := 0; i &lt; 300000; i++ {\n                _ = i * 17\n            }\n            // Somehow this print statement saves the day in Ubuntu\n            log.Printf(&quot;donkey&quot;)\n            runtime.Gosched()\n        }\n    }\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    c := make(chan int, 1000)\n    go doWork(c)\n\n    start := time.Now().UnixNano()\n    for i := 0; i &lt; 1000; i++ {\n        time.Sleep(1 * time.Millisecond)\n\n        // Queue up 10ms of work in the other goroutine, which will backlog\n        // this goroutine without runtime.Gosched() calls.\n        c &lt;- 0\n    }\n\n    // Whole program should take about 1 second to run if the Gosched() calls \n    // work, otherwise 10 seconds.\n    log.Printf(&quot;Finished in %f seconds.&quot;, float64(time.Now().UnixNano() - start) / 1e9)\n}\n</code></pre>\n<p>Additional details: I'm running go1.10 darwin/amd64, and compiling the linux binary with\n<code>env GOOS=linux GOARCH=amd64 go build ...</code></p>\n<p>I've tried a few simple variants:</p>\n<ul>\n<li>Just making a log.Printf() call, without the Gosched()</li>\n<li>Making two calls to Gosched()</li>\n<li>Keeping the Gosched() call but replacing the log.Printf() call to a dummy function call</li>\n</ul>\n<p>All of these are ~10x slower than calling log.Printf() and then Gosched().</p>\n<p>Any insights would be appreciated! This example is of course very artificial, but the issue came up while writing a websocket broadcast server which led to significantly degraded performance.</p>\n<p>EDIT: I got rid of the extraneous bits in my example to make things more transparent. I've discovered that without the print statement, the <code>runtime.Gosched()</code> calls are still getting run, it's just that they seem to be delayed by a fixed 5ms, leading to a total runtime of almost exactly 5seconds in the example below, when the program should finish instantaneously (and does on my Mac, or on Ubuntu with the print statement).</p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;runtime&quot;\n    &quot;time&quot;\n)\n\nfunc doWork() {\n    for {\n        // This print call makes the code run 20x faster\n        log.Printf(&quot;donkey&quot;)\n\n        // Without this line, the program never terminates (as expected). With this line\n        // and the print call above it, the program takes &lt;300ms as expected, dominated by\n        // the sleep calls in the main goroutine. But without the print statement, it \n        // takes almost exactly 5 seconds.\n        runtime.Gosched()\n    }\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    go doWork()\n\n    start := time.Now().UnixNano()\n    for i := 0; i &lt; 1000; i++ {\n        time.Sleep(10 * time.Microsecond)\n\n        runtime.Gosched()\n    }\n\n    log.Printf(&quot;Finished in %f seconds.&quot;, float64(time.Now().UnixNano() - start) / 1e9)\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "is_accepted": false, "score": 3, "last_activity_date": 1522697045, "last_edit_date": 1522697045, "creation_date": 1522696970, "answer_id": 49617458, "question_id": 49617407, "link": "https://stackoverflow.com/questions/49617407/in-go-app-catch-enviroment-variables-of-docker-container/49617458#49617458", "title": "In Go app catch enviroment variables of docker container", "body": "<p>You can use <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#Getenv</a> or <a href=\"https://golang.org/pkg/os/#LookupEnv\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#LookupEnv</a> to get values from the enviroment variables. I prefer to use os.LookupEnv since I get a boolean saying that variable has a value and then I have my own method to have a default value.</p>\n\n<pre><code>func getEnv(key string, defaultValue string) string {\n    if value, ok := os.LookupEnv(key); ok {\n        return value\n    }\n\n    return defaultValue\n}\n</code></pre>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522697045, "creation_date": 1522696760, "question_id": 49617407, "link": "https://stackoverflow.com/questions/49617407/in-go-app-catch-enviroment-variables-of-docker-container", "title": "In Go app catch enviroment variables of docker container", "body": "<p>I want to create an image in docker of a Golang Application. I compiled the application and created the image over it, and it's working as expected.\nHowever, that application needs certains parameters: Database name, user, ip of the database server, and so on...\nSo, I know that in docker I can send enviroment variables to the container using the flag <code>-e</code> so, my question is: </p>\n\n<h1>How can I catch those values in the Golang application?</h1>\n"}, {"tags": ["go", "middleware", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522737386, "post_id": 49616205, "comment_id": 86254340, "body": "I shall be more detailed: remoteAddr is available as soon as TCP connection is established, however, my assumption is, first middleware gets to execute only when client is done sending complete HTTP request. In case client is posting a file, my first middleware with O(1) lookup will be executed after a couple of milliseconds, few  MBs of data transfer and a few thousands of CPU cycles atleast. So my question is what is the earliest stage a middleware can get control of request processing, and can reject request, preferably with a valid HTTP response code, saving those resources mentioned above"}, {"owner": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522753239, "post_id": 49616205, "comment_id": 86263581, "body": "Or how Expect header should be handled? <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect</a>"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522757218, "post_id": 49616205, "comment_id": 86266038, "body": "I don&#39;t understand your question. Can you please elaborate? If you want to get the RemoteAddr or get the IP some other way, do it in the <code>doSomething()</code> function I added in the middleware above. That is where you can get the IP address or unique request ID, however you want to do that."}, {"owner": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522769587, "post_id": 49616205, "comment_id": 86275194, "body": "doSomething() is invoked after client is done sending all data (request header + request body). I would prefer to be able to decide if I want to process request, right after request headers have been received, but before request body is transmitted. This will save a lot of time and other resources. I hope the problem is clear now. I highly appreciate your help."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522770030, "post_id": 49616205, "comment_id": 86275483, "body": "I don&#39;t think Golang is the right tool to solve that problem, then. You should be doing this at the DNS level, perhaps in a firewall or load balancer, not in your Go code. If your intent here is to prevent DDoS, you DEFINITELY do not want to do it in Go. No matter what sort of middleware you add, all that have to do is completely flood your pipes and your server will still be put to a halt. Look into something like CloudFlare; they are built specifically to prevent DDoS as they will act as a proxy in front of your services and prevent any malicious requests from reaching your services."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522770332, "post_id": 49616205, "comment_id": 86275673, "body": "To demonstrate what I mean, go ahead and add the middleware example I showed you, and use a load testing tool built in Go, such as <a href=\"https://github.com/codesenberg/bombardier\" rel=\"nofollow noreferrer\">Bombardier</a>, and hit your local server as hard as you can. You will see that eventually, even with a whitelist middleware, the server will have so many connections open that it can&#39;t handle them anymore and the same result occurs: a denial of service. You can&#39;t prevent DDoS at application level."}], "tags": [], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "is_accepted": false, "score": 3, "last_activity_date": 1522691751, "creation_date": 1522691751, "answer_id": 49616205, "question_id": 49616076, "link": "https://stackoverflow.com/questions/49616076/how-to-implement-efficient-ip-whitelist-in-gin-gonic-gin-middleware/49616205#49616205", "title": "How to implement efficient IP whitelist in gin-gonic/gin middleware", "body": "<p>Have you read the <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin documentation</a>?</p>\n\n<p>You can add middleware based on the examples in <a href=\"https://github.com/gin-gonic/gin#using-middleware\" rel=\"nofollow noreferrer\">this section</a>. Use <code>router.Use()</code> to chain middleware. If you want it to be as efficient as possible, make it the first middleware in the chain, and use a data structure that allows O(1) read access to the IP's that are allowed.</p>\n\n<p>For instance:</p>\n\n<pre><code>var myWhiteList map[string]bool = map[string]bool{\n    \"1.2.3.4\": true,\n    \"4.3.2.1\": true,\n}\n\nfunc main() {\n    // Creates a router without any middleware by default\n    r := gin.New()\n\n    // Add whitelist middleware\n    r.Use(middleware.IPWhitelist(myWhiteList))\n\n    // Listen and serve on 0.0.0.0:8080\n    r.Run(\":8080\")\n}\n</code></pre>\n\n<p>The implementation of <code>middleware.IPWhitelist</code> can look something like this:</p>\n\n<pre><code>func IPWhiteList(whitelist map[string]bool) func(http.Handler) http.Handler {\n    f := func(h http.Handler) http.Handler {\n        fn := func(w http.ResponseWriter, r *http.Request) {\n            // Get IP of this request\n            ip := doSomething()\n\n            // If the IP isn't in the whitelist, forbid the request.\n            if !whitelist[ip] {\n                w.Header().Set(\"Content-Type\", \"text/plain\")\n                w.WriteHeader(http.StatusForbidden)\n                w.Write([]byte(\".\"))\n                return\n            }\n\n            h.ServeHTTP(w, r)\n        }\n\n        return http.HandlerFunc(fn)\n    }\n\n    return f\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "edited": false, "score": 0, "creation_date": 1522737639, "post_id": 49616705, "comment_id": 86254461, "body": "Thank you for your reply. Please check my comment above, any information will be quite useful, specially HTTP request life cycle in gin."}], "tags": [], "owner": {"reputation": 3178, "user_id": 972966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77e82beae0d15e24aff8b28d7b9213c8?s=128&d=identicon&r=PG", "display_name": "JazzCat", "link": "https://stackoverflow.com/users/972966/jazzcat"}, "is_accepted": false, "score": 3, "last_activity_date": 1522693790, "creation_date": 1522693790, "answer_id": 49616705, "question_id": 49616076, "link": "https://stackoverflow.com/questions/49616076/how-to-implement-efficient-ip-whitelist-in-gin-gonic-gin-middleware/49616705#49616705", "title": "How to implement efficient IP whitelist in gin-gonic/gin middleware", "body": "<p>Add a middleware as Lansana described. </p>\n\n<p>It's important that you declare it as early in the chain as possible.</p>\n\n<pre><code>r := gin.New()\n\nwhitelist := make(map[string]bool)\nwhitelist[\"127.0.0.1\"] = true\n\nr.Use(middleware.IPWhiteList(whitelist))\n</code></pre>\n\n<p>I'd write the middleware like this, if you're not in the whitelist, return an error that is appropriate, in the following snippet i'm returning a JSON error.</p>\n\n<pre><code>package middleware\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc IPWhiteList(whitelist map[string]bool) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        if !whitelist[c.ClientIP()] {\n            c.AbortWithStatusJSON(http.StatusForbidden, gin.H{\n                \"status\":  http.StatusForbidden,\n                \"message\": \"Permission denied\",\n            })\n            return\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7828660, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CHGjtv4HzSI/AAAAAAAAAAI/AAAAAAAAAAA/Cij40j1UqTo/photo.jpg?sz=128", "display_name": "i_am_on_my_way_to_happiness", "link": "https://stackoverflow.com/users/7828660/i-am-on-my-way-to-happiness"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2351, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1597438733, "creation_date": 1522691198, "last_edit_date": 1597438733, "question_id": 49616076, "link": "https://stackoverflow.com/questions/49616076/how-to-implement-efficient-ip-whitelist-in-gin-gonic-gin-middleware", "title": "How to implement efficient IP whitelist in gin-gonic/gin middleware", "body": "<p>I have an application which I need to restrict to a handful of IPs. I can write a middleware and return if request IP is not from allowed list, however I would like this process to be as efficient as possible. I.e. I would like to drop the connection as early as possible. What is the earliest stage I can drop connection, preferably with an HTTP response. \nI do not have control on host firewall or border firewall to filter traffic, and again, I won't be able to provide an HTTP response, even if I had control of firewall.</p>\n\n<p>Also I would prefer if I could get a description of a life cycle of an HTTP request in gin.</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522684203, "post_id": 49613649, "comment_id": 86235265, "body": "What do you mean &quot;different instances of the server&quot;? Are you running multiple instances of the server? If you&#39;re only running one instance of the server, then they are handled by the same instance of the server. As for using the &quot;same instance of the handler&quot;, that doesn&#39;t really make sense, since a handler only handles one request. Handlers are run concurrently for concurrent requests, if that&#39;s what you&#39;re asking."}, {"owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522721046, "post_id": 49613649, "comment_id": 86249266, "body": "@JimB. Yes multiple requests. So for each request a new instance of the handler is created? What if I have to share stuff between multiple requests. How do I do that?"}], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": false, "score": 2, "last_activity_date": 1523404494, "creation_date": 1523404494, "answer_id": 49764422, "question_id": 49613649, "link": "https://stackoverflow.com/questions/49613649/how-are-the-requests-handled-in-grpc/49764422#49764422", "title": "How are the requests handled in GRPC?", "body": "<p>I'm sorry but I'm having a hard time understanding the code you provided. Seems like <code>Process</code> is the RPC call that you're writing a service handler for. But what is the <code>handler</code> type then. Also the function <code>newHandler()</code> is used as a method. Moreover, I don't see the need of wrapping the service handler either.</p>\n\n<p>How about we take the official <a href=\"https://github.com/grpc/grpc-go/blob/master/examples/helloworld/\" rel=\"nofollow noreferrer\">example</a> for unary RPCs from gRPC's github.</p>\n\n<p>If you look <a href=\"https://github.com/grpc/grpc-go/blob/858463ac273fd87e6b2343eda6e96ed3a91e3b20/examples/helloworld/greeter_server/main.go#L38\" rel=\"nofollow noreferrer\">here</a>, a gRPC service handler is defined which handles <code>SayHello</code> RPC.</p>\n\n<p>Multiple clients can make multiple calls to this RPC, all of which will be run in a separate goroutine. Now, it is understandable that one might want to share some information between these calls. This can be achieved by augmenting your service handler <code>type server struct</code> with more logic, for instance a data structure with a mutex.</p>\n\n<p>Hopefully, this answers some questions.</p>\n\n<p>Best\nMak</p>\n"}], "owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1312, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523404494, "creation_date": 1522681221, "question_id": 49613649, "link": "https://stackoverflow.com/questions/49613649/how-are-the-requests-handled-in-grpc", "title": "How are the requests handled in GRPC?", "body": "<p>Lets say that my given GRPC endpoint has the following implementation</p>\n\n<pre><code>type HandlerFunc func(ctx context.Context, in *pb.Request) (*pb.Response, error)\n\nfunc newHandler() HandlerFunc {\n   func (s *Server) Process(ctx context.Context, in *pb.Request) (*pb.Response, error) {\n        //do processing\n    }\n}\n\ntype Server struct {\n    Handler handler\n}\n\nfunc new() (s *Server) {\n   return &amp;Server{\n      handler: handlers.newHandler()\n   }\n}\nfunc (s *Server) Process(ctx context.Context, in *pb.Request) (*pb.Response, error) {\n    return s.handler\n}\n</code></pre>\n\n<p>Now lets say that multiple clients try to call the Process endpoint. Do all of them call the same Process function of the same instance of the server or they call the Process function of the different instance of the server?</p>\n\n<p>Also the handler defined in </p>\n\n<pre><code>func newHandler() HandlerFunc {\n   func (s *Server) Process(ctx context.Context, in *pb.Request) (*pb.Response, error) {\n        //do processing\n    }\n}\n</code></pre>\n\n<p>Is the same instance of the handler handling multiple requests from the same client? Also how about different clients? Is the same instance of the handler handling requests from multiple clients?</p>\n"}, {"tags": ["json", "rest", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522674547, "post_id": 49611868, "comment_id": 86230368, "body": "It does seem weird that you&#39;re marshaling and unmarshaling the data, I don&#39;t understand why you&#39;re doing that. You say you know how the data is supposed to be structured, so why do you need an <code>interface{}</code>? If you don&#39;t know what the structure is before hand, just extract the values from the generic types."}, {"owner": {"reputation": 69, "user_id": 6561719, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cFqaQfE3FCM/AAAAAAAAAAI/AAAAAAAAAEY/jrdW4e98uaI/photo.jpg?sz=128", "display_name": "Sam Reynolds", "link": "https://stackoverflow.com/users/6561719/sam-reynolds"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522674701, "post_id": 49611868, "comment_id": 86230454, "body": "I know what the structure is before hand. I&#39;m trying to abstract the response struct so I don&#39;t need to create a response struct for every API call."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1522675148, "post_id": 49611868, "comment_id": 86230684, "body": "@SamReynolds <i>Initialize</i> the Data field to the type you know is contained in the response json: <a href=\"https://play.golang.org/p/f2kTobiDoQY\" rel=\"nofollow noreferrer\">play.golang.org/p/f2kTobiDoQY</a>"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1522675177, "post_id": 49611868, "comment_id": 86230698, "body": "@SamReynolds Take look at my <code>jsonapi</code> library and see how I write generic response JSON. My structure looks exactly like yours does, with a <code>Data</code> field and an <code>interface{}</code> type. <a href=\"https://github.com/lansana/jsonapi\" rel=\"nofollow noreferrer\">github.com/lansana/jsonapi</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1522675593, "post_id": 49611868, "comment_id": 86230911, "body": "Defining one struct type per endpoint (or per model) is perfectly &quot;normal&quot;."}, {"owner": {"reputation": 69, "user_id": 6561719, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cFqaQfE3FCM/AAAAAAAAAAI/AAAAAAAAAEY/jrdW4e98uaI/photo.jpg?sz=128", "display_name": "Sam Reynolds", "link": "https://stackoverflow.com/users/6561719/sam-reynolds"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1522676475, "post_id": 49611868, "comment_id": 86231347, "body": "@mkopriva Thank you! That works perfectly. I didn&#39;t think of initializing Data to be a pointer to the struct."}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 6561719, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cFqaQfE3FCM/AAAAAAAAAAI/AAAAAAAAAEY/jrdW4e98uaI/photo.jpg?sz=128", "display_name": "Sam Reynolds", "link": "https://stackoverflow.com/users/6561719/sam-reynolds"}, "edited": false, "score": 0, "creation_date": 1522678237, "post_id": 49612445, "comment_id": 86232205, "body": "This is useful information, thank you. @mkpriva also pointed out that you can initialize the data attribute of the response struct to a pointer of the struct you expect, and then what ever struct that pointer is pointing to will be populated with the data. This is his example: play.golang.org/p/f2kTobiDoQY"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "reply_to_user": {"reputation": 69, "user_id": 6561719, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cFqaQfE3FCM/AAAAAAAAAAI/AAAAAAAAAEY/jrdW4e98uaI/photo.jpg?sz=128", "display_name": "Sam Reynolds", "link": "https://stackoverflow.com/users/6561719/sam-reynolds"}, "edited": false, "score": 0, "creation_date": 1522679266, "post_id": 49612445, "comment_id": 86232756, "body": "That is a good point, certainly possible. I will add it to the answer."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1522684847, "post_id": 49612445, "comment_id": 86235564, "body": "@jsageryd please note that the idea with the pre-initialization rests on the assumption that you initialize the known type into a variable first, <i>then</i> you assign it to the Data field, and after unmarshal is done you use the variable not the Data field. So there is no need to do any additional type assertion as you point out in your answer. Basically <i>if the caller knows the type, then it can create and use a reference to the value of that type.</i> To see what i mean go here: <a href=\"https://play.golang.org/p/KAEE8dCDdFC\" rel=\"nofollow noreferrer\">play.golang.org/p/KAEE8dCDdFC</a>"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1522685294, "post_id": 49612445, "comment_id": 86235785, "body": "Ah! My bad. I did not understand that this is what you meant. Indeed a much better solution. I will revise the example to reflect your intention."}], "tags": [], "owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "is_accepted": true, "score": 2, "last_activity_date": 1522687660, "last_edit_date": 1522687660, "creation_date": 1522676478, "answer_id": 49612445, "question_id": 49611868, "link": "https://stackoverflow.com/questions/49611868/best-way-to-handle-interfaces-in-http-response/49612445#49612445", "title": "Best way to handle interfaces in HTTP response", "body": "<p>The JSON unmarshaller uses reflection to look at the type it is unmarshalling to. Given an uninitialised <code>interface{}</code> as the destination for the unmarshalled data, a JSON <code>object</code> gets unmarshalled into a <code>map[string]interface{}</code> (<a href=\"https://play.golang.org/p/IK9WVjOFL5G\" rel=\"nofollow noreferrer\">example in playground</a>).</p>\n\n<p>Here are some ideas.</p>\n\n<h1>Option A</h1>\n\n<p>If you know the datatype, you can define a new response struct for each type. Example:</p>\n\n<pre><code>type FooResponse struct {\n  Err  int `json:\"err\"`\n  Data Foo `json:\"data\"`\n}\n\ntype Foo struct {\n  FooField string `json:\"foofield\"`\n}\n\ntype BarResponse struct {\n  Err  int `json:\"err\"`\n  Data Bar `json:\"data\"`\n}\n\ntype Bar struct {\n  BarField string `json:\"barfield\"`\n}\n</code></pre>\n\n<h1>Option B</h1>\n\n<p>If you prefer to have a single <code>Response</code> struct instead of one per type, you can tell the JSON unmarshaller to avoid unmarshalling the <code>data</code> field until a later time by using the <code>json.RawMessage</code> data type:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"log\"\n)\n\ntype Response struct {\n  Err  int             `json:\"err\"`\n  Data json.RawMessage `json:\"data\"`\n}\n\ntype Foo struct {\n  FooField string `json:\"foofield\"`\n}\n\ntype Bar struct {\n  BarField string `json:\"barfield\"`\n}\n\nfunc main() {\n  fooRespJSON := []byte(`{\"data\":{\"foofield\":\"foo value\"}}`)\n  barRespJSON := []byte(`{\"data\":{\"barfield\":\"bar value\"}}`)\n\n  var (\n    resp Response\n    foo  Foo\n    bar  Bar\n  )\n\n  // Foo\n  if err := json.Unmarshal(fooRespJSON, &amp;resp); err != nil {\n    log.Fatal(err)\n  }\n  if err := json.Unmarshal(resp.Data, &amp;foo); err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(\"foo:\", foo)\n\n  // Bar\n  if err := json.Unmarshal(barRespJSON, &amp;resp); err != nil {\n    log.Fatal(err)\n  }\n  if err := json.Unmarshal(resp.Data, &amp;bar); err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(\"bar:\", bar)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>foo: {foo value}\nbar: {bar value}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Y7D4uhaC4a8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y7D4uhaC4a8</a></p>\n\n<h1>Option C</h1>\n\n<p>A third option, as pointed out by @mkopriva in a comment on the question, is to use <code>interface{}</code> as an intermediary datatype and pre-initialise this to a known datatype.</p>\n\n<p>Emphasis lies on the word intermediary -- of course passing around an <code>interface{}</code> is best avoided (<a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=7m36s\" rel=\"nofollow noreferrer\">Rob Pike's Go Proverbs</a>). The use-case here is to allow any datatype to be used without the need for multiple different <code>Response</code> types. On way to avoid exposing the <code>interface{}</code> is to wrap the response completely, exposing only the data and the error:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"log\"\n)\n\ntype Foo struct {\n  FooField string `json:\"foofield\"`\n}\n\ntype Bar struct {\n  BarField string `json:\"barfield\"`\n}\n\ntype Error struct {\n  Code int\n}\n\nfunc (e *Error) Error() string {\n  return fmt.Sprintf(\"error code %d\", e.Code)\n}\n\nfunc unmarshalResponse(data []byte, v interface{}) error {\n  resp := struct {\n    Err  int         `json:\"err\"`\n    Data interface{} `json:\"data\"`\n  }{Data: v}\n\n  if err := json.Unmarshal(data, &amp;resp); err != nil {\n    return err\n  }\n\n  if resp.Err != 0 {\n    return &amp;Error{Code: resp.Err}\n  }\n\n  return nil\n}\n\nfunc main() {\n  fooRespJSON := []byte(`{\"data\":{\"foofield\":\"foo value\"}}`)\n  barRespJSON := []byte(`{\"data\":{\"barfield\":\"bar value\"}}`)\n  errRespJSON := []byte(`{\"err\": 123}`)\n\n  // Foo\n  var foo Foo\n  if err := unmarshalResponse(fooRespJSON, &amp;foo); err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(\"foo:\", foo)\n\n  // Bar\n  var bar Bar\n  if err := unmarshalResponse(barRespJSON, &amp;bar); err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(\"bar:\", bar)\n\n  // Error response\n  var v interface{}\n  if err := unmarshalResponse(errRespJSON, &amp;v); err != nil {\n    log.Fatal(err)\n  }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>foo: {foo value}\nbar: {bar value}\n2009/11/10 23:00:00 error code 123\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/5SVfQGwS-Wy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5SVfQGwS-Wy</a></p>\n"}], "owner": {"reputation": 69, "user_id": 6561719, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cFqaQfE3FCM/AAAAAAAAAAI/AAAAAAAAAEY/jrdW4e98uaI/photo.jpg?sz=128", "display_name": "Sam Reynolds", "link": "https://stackoverflow.com/users/6561719/sam-reynolds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 49612445, "answer_count": 1, "score": 1, "last_activity_date": 1522687660, "creation_date": 1522674270, "last_edit_date": 1522681038, "question_id": 49611868, "link": "https://stackoverflow.com/questions/49611868/best-way-to-handle-interfaces-in-http-response", "title": "Best way to handle interfaces in HTTP response", "body": "<p>I'm using an API that formats its responses in this way:</p>\n\n<pre><code>{\n  \"err\": 0,\n  \"data\": **Other json structure**\n}\n</code></pre>\n\n<p>The way I'm getting a response right now is I'm putting the response in an struct like this:</p>\n\n<pre><code>type Response struct {\n   Err int        `json:\"err\"`\n   Data interface{} `json:\"data\"`\n}\n</code></pre>\n\n<p>and then I'm doing this after getting a response</p>\n\n<pre><code>jsonbytes, _ := json.Marshal(resp.Data)\njson.Unmarshal(jsonBytes, &amp;dataStruct)\n</code></pre>\n\n<p>I'm only ignoring errors for this example.<br>\nIt seems kinda weird to me that I'm marshaling and unmarshaling when I know what the data is supposed to look like and what type it's supposed to be.  </p>\n\n<p>Is there a more simple solution that I'm not seeing or is this a normal thing to do? </p>\n\n<p>Edit: I should probably mention that the Data attribute in the response object can vary depending on what API call I'm doing.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522673365, "post_id": 49611607, "comment_id": 86229697, "body": "What are the types definitions for what you\u2019re encoding?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1522673392, "post_id": 49611607, "comment_id": 86229708, "body": "Are you using <code>string</code> for your struct that you pass to the sql driver? If so, try using <code>mysql.NullString</code>. Or vice versa (don&#39;t remember exactly)."}, {"owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522674087, "post_id": 49611607, "comment_id": 86230105, "body": "@JimB, this is the response structure type Resp struct { \t\tResult  []map[string]interface{} <code>json:&quot;result&quot;&#39; \t\tStatus  string                   </code>json:&quot;status&quot;` \t}  edited the same in my question"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 1, "creation_date": 1522674349, "post_id": 49611607, "comment_id": 86230275, "body": "You will not be able to get an output of  <code>{}</code> (an object). The type is a slice; so you will get a <code>[]</code> (an array)."}], "answers": [{"tags": [], "owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "is_accepted": true, "score": 1, "last_activity_date": 1522674672, "last_edit_date": 1522674672, "creation_date": 1522674165, "answer_id": 49611849, "question_id": 49611607, "link": "https://stackoverflow.com/questions/49611607/want-to-send-empty-json-string-instead-of-null/49611849#49611849", "title": "Want to send empty json string &quot;{}&quot; instead of &quot;null&quot;", "body": "<p>The <code>Result</code> field is a slice, which can be <code>nil</code>. This is rendered as <code>null</code> in JSON. To make it not <code>nil</code>, you will have to initialise it.</p>\n\n<p>In addition, since <code>Result</code> is a slice, it will be marshalled to a JSON array (<code>[]</code>), not a JSON object (<code>{}</code>).</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"log\"\n  \"os\"\n)\n\ntype Resp struct {\n  Result []map[string]interface{} `json:\"result\"`\n  Status string                   `json:\"status\"`\n}\n\nfunc main() {\n  enc := json.NewEncoder(os.Stdout)\n\n  fmt.Println(\"Empty Resp struct:\")\n  if err := enc.Encode(Resp{}); err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Println()\n\n  fmt.Println(\"Initialised Result field:\")\n  if err := enc.Encode(Resp{Result: []map[string]interface{}{}}); err != nil {\n    log.Fatal(err)\n  }\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Empty Resp struct:\n{\"result\":null,\"status\":\"\"}\n\nInitialised Result field:\n{\"result\":[],\"status\":\"\"}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9zmfH-180Zk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9zmfH-180Zk</a></p>\n"}], "owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 0, "accepted_answer_id": 49611849, "answer_count": 1, "score": 1, "last_activity_date": 1522688018, "creation_date": 1522673242, "last_edit_date": 1522688018, "question_id": 49611607, "link": "https://stackoverflow.com/questions/49611607/want-to-send-empty-json-string-instead-of-null", "title": "Want to send empty json string &quot;{}&quot; instead of &quot;null&quot;", "body": "<p>I'm trying to handle http requests in my go api, in which i wish to send empty json string like </p>\n\n<pre><code>{\"result\": {}, \"status\": \"failed\"}\n</code></pre>\n\n<p>but when the mysql query returns zero rows, it return an output as </p>\n\n<pre><code>{\"result\": null, \"status\": \"failed\"}\n</code></pre>\n\n<p>Edit : This is the response struct i'm using:</p>\n\n<pre><code>type Resp struct {\n  Result []map[string]interface{} `json:\"result\"`\n  Status string                   `json:\"status\"`\n}\n</code></pre>\n\n<p>How can i handle this situation?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "blockchain", "hyperledger"], "comments": [{"owner": {"reputation": 1446, "user_id": 9214985, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BbCIR.png?s=128&g=1", "display_name": "rwp", "link": "https://stackoverflow.com/users/9214985/rwp"}, "edited": false, "score": 0, "creation_date": 1522673199, "post_id": 49611393, "comment_id": 86229599, "body": "You&#39;ll need to provide more detail of what you&#39;ve tried. Suggest you take a look at <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1522676697, "post_id": 49611393, "comment_id": 86231450, "body": "To rwp&#39;s point, here&#39;s an example: I&#39;ve followed the guide on developing chaincode in developer mode.  I now want to deploy this to a network of peers.  I tried .... | I could not find an example ... | ..."}, {"owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "edited": false, "score": 0, "creation_date": 1522696767, "post_id": 49611393, "comment_id": 86241738, "body": "When you say &quot;how can I transform my chaincode&quot;, do you mean how to install and instantiate the chaincode on a peer ?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9586006, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OZWBxXw4W4A/AAAAAAAAAAI/AAAAAAAAAAA/OX78_h5i9DY/photo.jpg?sz=128", "display_name": "user9586006", "link": "https://stackoverflow.com/users/9586006/user9586006"}, "edited": false, "score": 0, "creation_date": 1522715298, "post_id": 49617639, "comment_id": 86247985, "body": "thanks your answer, but you did not ansewer my question. I konw how to install chaincode. When I install chaincode, there are condition, my chaincode code file has been transfered on peer. But how can I do it ?"}, {"owner": {"reputation": 1, "user_id": 9586006, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OZWBxXw4W4A/AAAAAAAAAAI/AAAAAAAAAAA/OX78_h5i9DY/photo.jpg?sz=128", "display_name": "user9586006", "link": "https://stackoverflow.com/users/9586006/user9586006"}, "edited": false, "score": 0, "creation_date": 1522715397, "post_id": 49617639, "comment_id": 86248008, "body": "-p option can&#39;t through the contain to access my local file system."}], "tags": [], "owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "is_accepted": false, "score": 1, "last_activity_date": 1522697661, "creation_date": 1522697661, "answer_id": 49617639, "question_id": 49611393, "link": "https://stackoverflow.com/questions/49611393/how-can-i-transform-my-chaincode-from-local-to-peer-in-hyperledger-fabric/49617639#49617639", "title": "how can I transform my chaincode from local to peer in hyperledger fabric?", "body": "<p>With the assumption that, when you say \"how can I transform my chaincode from local to peer\", you mean that you want to install and instantiate the chaincode on a peer. \nYou can follow the steps provided <a href=\"https://hyperledger-fabric.readthedocs.io/en/release-1.1/build_network.html#install-instantiate-chaincode\" rel=\"nofollow noreferrer\">here</a>. \nIf you're following the tutorial provided <a href=\"https://hyperledger-fabric.readthedocs.io/en/release-1.1/build_network.html#building-your-first-network\" rel=\"nofollow noreferrer\">here</a>, I'd suggest you create the artifacts manually and follow the steps from <a href=\"https://hyperledger-fabric.readthedocs.io/en/release-1.1/build_network.html#manually-generate-the-artifacts\" rel=\"nofollow noreferrer\">here</a>. \nSpecifically, using cli, you install a chaincode into a peer from the cli container using the following command : </p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p path/to/your/chaincode/\n</code></pre>\n\n<p>The argument to the <code>-p</code> option specifies the path to the chaincode, which must be located within the source tree of the user\u2019s <code>GOPATH</code></p>\n"}], "owner": {"reputation": 1, "user_id": 9586006, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OZWBxXw4W4A/AAAAAAAAAAI/AAAAAAAAAAA/OX78_h5i9DY/photo.jpg?sz=128", "display_name": "user9586006", "link": "https://stackoverflow.com/users/9586006/user9586006"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1522697661, "creation_date": 1522672438, "last_edit_date": 1522673088, "question_id": 49611393, "link": "https://stackoverflow.com/questions/49611393/how-can-i-transform-my-chaincode-from-local-to-peer-in-hyperledger-fabric", "title": "how can I transform my chaincode from local to peer in hyperledger fabric?", "body": "<p>If I write a piece of Hyperledger Fabric chaincode in go on local, how can I transform my chaincode from local to fabric peer ?</p>\n"}, {"tags": ["string", "templates", "go"], "answers": [{"tags": [], "owner": {"reputation": 132, "user_id": 6035983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1737193349850773/picture?type=large", "display_name": "Ben Ammann", "link": "https://stackoverflow.com/users/6035983/ben-ammann"}, "is_accepted": true, "score": 1, "last_activity_date": 1522669365, "creation_date": 1522669365, "answer_id": 49610640, "question_id": 49610587, "link": "https://stackoverflow.com/questions/49610587/template-strings-in-golang/49610640#49610640", "title": "Template Strings in GoLang?", "body": "<p>The Solution is</p>\n\n<pre><code>sentence := fmt.Sprintf(\"My Name is %s\", name)\n</code></pre>\n"}], "owner": {"reputation": 132, "user_id": 6035983, "user_type": "registered", "profile_image": "https://graph.facebook.com/1737193349850773/picture?type=large", "display_name": "Ben Ammann", "link": "https://stackoverflow.com/users/6035983/ben-ammann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 49610640, "answer_count": 1, "score": -2, "last_activity_date": 1522669365, "creation_date": 1522669166, "question_id": 49610587, "link": "https://stackoverflow.com/questions/49610587/template-strings-in-golang", "title": "Template Strings in GoLang?", "body": "<p>i've been researching for a while now but could not find anything.</p>\n\n<p>For Example</p>\n\n<pre><code>var name = \"tom\"\nsentence := \"My Name is #{name}\"\n</code></pre>\n\n<p>In JS this works with ${var} and in ruby with #{var}</p>\n\n<p>So are there Template Strings in GoLang ?</p>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["mongodb", "go", "struct", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 267, "user_id": 9077144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0dfcd9c7206eca7409802bb8dd775bc?s=128&d=identicon&r=PG&f=1", "display_name": "ThrasosT", "link": "https://stackoverflow.com/users/9077144/thrasost"}, "edited": false, "score": 0, "creation_date": 1522678469, "post_id": 49610860, "comment_id": 86232338, "body": "I added the bson notation in the struct  type Customer struct {    ID        bson.ObjectId <code>bson:&quot;_id,omitempty&quot;</code>    StoreName string    Person    Person        <code>bson:&quot;persons&quot;,json:&quot;persons&quot;</code> }  and then used it in the query (note the persons with an \u2018s\u2019) err = dbc.Find(bson.M{&quot;persons.name&quot;: &quot;GNXGJKMOFM&quot;}).One(&amp;resultsB)  This worked"}, {"owner": {"reputation": 434, "user_id": 1218264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c138058bf67f1c33d6f800b809624f8?s=128&d=identicon&r=PG", "display_name": "Fred", "link": "https://stackoverflow.com/users/1218264/fred"}, "reply_to_user": {"reputation": 267, "user_id": 9077144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0dfcd9c7206eca7409802bb8dd775bc?s=128&d=identicon&r=PG&f=1", "display_name": "ThrasosT", "link": "https://stackoverflow.com/users/9077144/thrasost"}, "edited": false, "score": 0, "creation_date": 1522692055, "post_id": 49610860, "comment_id": 86239350, "body": "Also I think you can remove the ID field from Person, usually you have one ID per object and the nested objects don&#39;t have  IDs."}], "tags": [], "owner": {"reputation": 434, "user_id": 1218264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c138058bf67f1c33d6f800b809624f8?s=128&d=identicon&r=PG", "display_name": "Fred", "link": "https://stackoverflow.com/users/1218264/fred"}, "is_accepted": true, "score": 0, "last_activity_date": 1522670261, "creation_date": 1522670261, "answer_id": 49610860, "question_id": 49610484, "link": "https://stackoverflow.com/questions/49610484/extracting-nested-struct-data-from-mongodb/49610860#49610860", "title": "extracting nested struct data from mongodb", "body": "<p>You could try something like that: <code>bson.M{\"person.name\": \"john\"}</code></p>\n\n<p>check mongodb documentation on embedded documents: <a href=\"https://docs.mongodb.com/manual/tutorial/query-embedded-documents/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/tutorial/query-embedded-documents/</a></p>\n"}], "owner": {"reputation": 267, "user_id": 9077144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0dfcd9c7206eca7409802bb8dd775bc?s=128&d=identicon&r=PG&f=1", "display_name": "ThrasosT", "link": "https://stackoverflow.com/users/9077144/thrasost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 49610860, "answer_count": 1, "score": 0, "last_activity_date": 1522738695, "creation_date": 1522668719, "last_edit_date": 1522738695, "question_id": 49610484, "link": "https://stackoverflow.com/questions/49610484/extracting-nested-struct-data-from-mongodb", "title": "extracting nested struct data from mongodb", "body": "<p>Have a struct as follows</p>\n\n<pre><code>type Person struct {\n   ID    bson.ObjectId `bson:\"_id,omitempty\"`\n   Name  string        `json:\"name\"`\n   Phone string        `json:\"phone\"`\n}\n</code></pre>\n\n<p>and then want to nest it in another struct</p>\n\n<pre><code>type Customer struct {\n   ID        bson.ObjectId `bson:\"_id,omitempty\"`\n   StoreName string\n   Person    Person        `json:\"persons\"`\n}\n</code></pre>\n\n<p>instantiated as</p>\n\n<pre><code>customer := Customer{bson.NewObjectId(), \"Seattle\", p1}\n</code></pre>\n\n<p>and insterted into Mongo db (I am using the mgo driver for golang)</p>\n\n<pre><code>err = databaseConnection.Insert(&amp;customer)\n</code></pre>\n\n<p>How do I retrieve the customer struct from the DB using parameters from the nested Person struct? E.g. pull all Customer structs that have a Person struct named \u201cJohn\u201d</p>\n\n<p>I am trying </p>\n\n<pre><code>err = databaseConnection.Find(bson.M{XXXXXXXXX}).All(&amp;resultsB)\n</code></pre>\n\n<p>but I can\u2019t figure out what XXXXXX should be.</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1522672888, "post_id": 49610920, "comment_id": 86229422, "body": "Thanks! also, that cause an error, the line: var auxiliar1 = template.New(&quot;aux&quot;).Funcs(funcionIncremento), it does not work, because you have to add the function to  <a href=\"https://play.golang.org/p/X_xhKIJVmQ4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/X_xhKIJVmQ4</a> auxiliar1 = template.Must().Funcs(funcionIncremento)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1522673229, "post_id": 49610920, "comment_id": 86229627, "body": "It fails because in that example you&#39;ve created a new template <code>template.New(&quot;test)</code> that does not have the functions and called <code>Parse</code> on that, instead of on <code>auxiliary1</code> which already has the functions. See this: <a href=\"https://play.golang.org/p/EIJGZ5OJqoi\" rel=\"nofollow noreferrer\">play.golang.org/p/EIJGZ5OJqoi</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1522674605, "post_id": 49610920, "comment_id": 86230403, "body": "To clarify a bit more @JohnBalvinArias, <code>var auxiliar1 = template.New(&quot;aux&quot;).Funcs(funcionIncremento)</code> does not cause the error, it&#39;s <code>Parse</code> causing it. <code>Parse</code> parses the given string and everytime it encounters a function, e.g. <code>inc</code> it will check if that function is present in the <code>template.Template</code> on which <code>Parse</code> was called and if it isn&#39;t present it will return an error. You can see that more clearly here: <a href=\"https://play.golang.org/p/y5m6k1TMjWK\" rel=\"nofollow noreferrer\">play.golang.org/p/y5m6k1TMjWK</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1522670532, "creation_date": 1522670532, "answer_id": 49610920, "question_id": 49610213, "link": "https://stackoverflow.com/questions/49610213/template-and-custom-function-err-executing-templname-at-funcname-is-not/49610920#49610920", "title": "Template and custom function; err: executing &quot;templName&quot; at &lt;&quot;funcName&quot;&gt; is not a define function", "body": "<p><code>a.AddParseTree(\"t\", b.Tree)</code> adds <em>only</em> the <code>parse.Tree</code> of template <code>b</code> it does not add <code>b</code>'s functions because they are not part of the <code>parse.Tree</code> type, they are part of the <code>template.Template</code> type.</p>\n\n<p>Any function that <code>b</code> needs to use, must also be added to <code>a</code>.</p>\n\n<pre><code>var probar1 = template.New(\"pro\").Funcs(funcionIncremento)\nvar auxiliar1 = template.New(\"aux\").Funcs(funcionIncremento)\n\nauxiliar1 = template.Must(auxiliar1.Parse(`\n        {{range $index, $element := .}}\n            Number: {{inc $index}}\n        {{end}}\n`))\n\nprobar1 = template.Must(probar1.AddParseTree(\"test\", auxiliar1.Tree))\nerr := probar1.ExecuteTemplate(os.Stdout, \"test\", &amp;strs)\nif err != nil {\n    log.Println(\"Error1: \", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 49610920, "answer_count": 1, "score": 0, "last_activity_date": 1522670532, "creation_date": 1522667710, "last_edit_date": 1522668785, "question_id": 49610213, "link": "https://stackoverflow.com/questions/49610213/template-and-custom-function-err-executing-templname-at-funcname-is-not", "title": "Template and custom function; err: executing &quot;templName&quot; at &lt;&quot;funcName&quot;&gt; is not a define function", "body": "<p>I got some text that I\u00b4m adding with template.AddParseTree method in order to append the template text, but there is a weir behaviour, the method is supossed to use it like this:</p>\n\n<pre><code>singleTemplate=anyTemplate\ntargetTemplate=*template.Must(targetTemplate.AddParseTree(e.Name, anyTemplate.Tree))\n</code></pre>\n\n<p>But is not working when singleTemplate has a funtion, by a weird reason it only works when I do this</p>\n\n<pre><code>singleTemplate=anyTemplate\ntargetTemplate=*template.Must(singleTemplate.AddParseTree(e.Name, anyTemplate.Tree))\n</code></pre>\n\n<p>But it must not work that way, because I won\u00b4t be able to append anything else\nYou can try it here: <a href=\"https://play.golang.org/p/f5oXNzD1fKP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/f5oXNzD1fKP</a> </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\nvar funcionIncremento = template.FuncMap{\n    \"inc\": func(i int) int {\n        return i + 1\n    },\n}\n\nfunc main() {\n\n    var strs []string\n    strs = append(strs, \"test1\")\n    strs = append(strs, \"test2\")\n    //-----------------Not valid(it would)\n    var probar1 = template.Template{}\n    var auxiliar1 = template.Template{}\n    auxiliar1 = *template.Must(template.New(\"test\").Funcs(funcionIncremento).Parse(`\n            {{range $index, $element := .}}\n                Number: {{inc $index}}\n            {{end}}\n    `))\n\n    probar1 = *template.Must(probar1.AddParseTree(\"test\", auxiliar1.Tree))\n    err := probar1.ExecuteTemplate(os.Stdout, \"test\", &amp;strs)\n    if err != nil {\n        log.Println(\"Error1: \", err)\n    }\n//--------------------------------valid(it wouldn\u00b4t), because I wouldn\u00b4t be able to append\n    var probar2 = template.Template{}\n    var auxiliar2 = template.Template{}\n    auxiliar2 = *template.Must(template.New(\"test\").Funcs(funcionIncremento).Parse(`\n            {{range $index, $element := .}}\n                Number: {{inc $index}}\n            {{end}}\n    `))\n\n    probar2 = *template.Must(auxiliar2.AddParseTree(\"test\", auxiliar2.Tree))\n    err = probar2.ExecuteTemplate(os.Stdout, \"test\", &amp;strs)\n    if err != nil {\n        log.Println(\"Error2: \", err)\n    }\n    //-------------------------------------------\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "constructor"], "answers": [{"comments": [{"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 1, "creation_date": 1522667871, "post_id": 49610108, "comment_id": 86226926, "body": "Yes. In the case <code>for _, foo := range b.foos {</code>, each item in <code>b.foos</code> gets copied to <code>foo</code>, so changing <code>foo</code> will not be reflected in <code>b.foos</code>. The solution you suggest in your answer fixes it by referencing the original instances, without copying. If however <code>b.foos</code> were a slice of pointers to <code>foo</code> ( <code>[]*foo</code> ), the pointer would have been copied but not the original value, so the <code>for _, foo := range b.foos {</code> would have worked as expected, given that you had first allocated each item."}], "tags": [], "owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "is_accepted": false, "score": 1, "last_activity_date": 1522672127, "last_edit_date": 1522672127, "creation_date": 1522667308, "answer_id": 49610108, "question_id": 49610015, "link": "https://stackoverflow.com/questions/49610015/struct-containing-embedded-slice-of-struct/49610108#49610108", "title": "Struct containing embedded slice of struct", "body": "<p>Omg, I just realized this after posting this question, it's because variable <code>slot</code> is local to <code>for loop</code>. So the solution is:</p>\n\n<pre><code>for i, _ := range b.foos {\n    // now b is set to true\n    b.foos[i].b = true\n}\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1522672127, "creation_date": 1522666893, "last_edit_date": 1522667347, "question_id": 49610015, "link": "https://stackoverflow.com/questions/49610015/struct-containing-embedded-slice-of-struct", "title": "Struct containing embedded slice of struct", "body": "<p>I have this code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype foo struct {\n    a int\n    b bool\n}\n\ntype foos []foo\n\ntype bar struct {\n    foos\n}\n\nfunc newBar() *bar {\n    b := &amp;bar{\n        foos: make([]foo, 3, 3),\n    }\n    for _, foo := range b.foos {\n        // didn't set b to true\n        foo.b = true\n    }\n    return b\n}\n\nfunc main() {\n    b := newBar()\n    fmt.Println(b)\n    // set b to true\n    b.foos[0].b = true\n    fmt.Println(b)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pDUaN8wRUPU\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n\n<p>As you can see I want to initialize <code>bar</code> using constructor <code>newBar()</code> but I want the embed type foo.b is initialize with non zero value so I initialize with for range statement but it didn't work as intended, the <code>foo.b</code> is still false, all of them. As comparison in the main function using this code <code>b.foos[0].b = true</code> it work. So whats wrong with my code?</p>\n"}, {"tags": ["go", "glide-golang"], "comments": [{"owner": {"reputation": 713, "user_id": 1614687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f36f1c086750b793f887fbc97647e2?s=128&d=identicon&r=PG", "display_name": "Jeff P", "link": "https://stackoverflow.com/users/1614687/jeff-p"}, "edited": false, "score": 0, "creation_date": 1538070177, "post_id": 49608059, "comment_id": 92024766, "body": "There&#39;s also a <a href=\"https://github.com/Masterminds/glide/issues/873\" rel=\"nofollow noreferrer\">bug report on glide&#39;s GitHub page</a> regarding the same error message."}], "answers": [{"tags": [], "owner": {"reputation": 713, "user_id": 1614687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f36f1c086750b793f887fbc97647e2?s=128&d=identicon&r=PG", "display_name": "Jeff P", "link": "https://stackoverflow.com/users/1614687/jeff-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1538070155, "creation_date": 1538070155, "answer_id": 52542466, "question_id": 49608059, "link": "https://stackoverflow.com/questions/49608059/glide-update-failing-unable-to-export-dependencies-to-vendor-directory-error/52542466#52542466", "title": "glide update failing -&gt; Unable to export dependencies to vendor directory: Error moving files: exit status 1. output: Access is denied. 0 dir(s) moved", "body": "<p>In my case, I was getting the same error when running Glide on Windows in an automated build environment. It seemed to be a problem moving the files from whatever temp directory Glide was using into the final vendor directory.</p>\n\n<p>For me, I was able to get around the issue by overriding the <code>GLIDE_TMP</code> environment variable such that it was located in my project's build directory. So, in your case, you can try either setting the <code>GLIDE_TMP</code> variable to a working directory near your project directory, or using the <code>glide --tmp value</code> argument to do so just once as part of each Glide command</p>\n\n<p>e.g. (assuming Bash terminal):</p>\n\n<pre><code>GLIDE_TMP=/d/DAAAS/Edge_OSS/code\nglide update\n</code></pre>\n\n<p>or</p>\n\n<pre><code>glide --tmp /d/DAAAS/Edge_OSS/code update\n</code></pre>\n\n<p>If that temp directory doesn't work, you could instead try using your <code>/d/DAAAS/Edge_OSS/code/microservice/NE3SProto/src/ne3s</code> project directory as the temp directory, in which case Glide will temporarily create a random <code>glide-vendor1234567</code> subdirectory there until it moves the files to <code>vendor</code>.</p>\n"}], "owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 501, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1538070155, "creation_date": 1522658735, "question_id": 49608059, "link": "https://stackoverflow.com/questions/49608059/glide-update-failing-unable-to-export-dependencies-to-vendor-directory-error", "title": "glide update failing -&gt; Unable to export dependencies to vendor directory: Error moving files: exit status 1. output: Access is denied. 0 dir(s) moved", "body": "<p>I followed the <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">tutorial for glide usage</a>.\nI did <code>glide init</code> and a <code>glide.yaml</code> was created successfully. Post that, when I did <code>glide update</code>, I am getting below error. Any idea how do I resolve this?</p>\n\n<p>I installed <code>glide</code> using <code>go get github.com/Masterminds/glide</code></p>\n\n<p>Note: I am doing these operation on <code>Windows</code> via <code>Git Bash</code> terminal.</p>\n\n<p>(Not sure, but if <code>GOPATH</code> value is required, it is <code>/c/Users/aagoyal/eclipse-workspace-oxygen/GoPath/:/d/Edge_OSS/code/microservice/NE3SProto/</code>. And my code is in location <code>/d/DAAAS/Edge_OSS/code/microservice/NE3SProto/src/ne3s</code>)</p>\n\n<pre><code>$ glide update\n[INFO]  Downloading dependencies. Please wait...\n[INFO]  --&gt; Fetching updates for github.com/gorilla/mux\n[INFO]  Resolving imports\n[INFO]  --&gt; Fetching updates for github.com/gorilla/context\n[INFO]  Downloading dependencies. Please wait...\n[INFO]  Setting references for remaining imports\n[INFO]  Exporting resolved dependencies...\n[INFO]  --&gt; Exporting github.com/gorilla/context\n[INFO]  --&gt; Exporting github.com/gorilla/mux\n[INFO]  Replacing existing vendor dependencies\n[ERROR] Unable to export dependencies to vendor directory: Error moving files: exit status 1. output: Access is denied.\n        0 dir(s) moved.\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1522647619, "post_id": 49605805, "comment_id": 86218528, "body": "Thanks for the suggestions @jwriteclub I am able to skip the test cases, but i am not able to exclude those method present on the skipset1 file, while running the -coverprofile"}, {"owner": {"reputation": 1485, "user_id": 353184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Hngu.jpg?s=128&g=1", "display_name": "jwriteclub", "link": "https://stackoverflow.com/users/353184/jwriteclub"}, "reply_to_user": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1522648118, "post_id": 49605805, "comment_id": 86218655, "body": "I&#39;m not sure I understand, you want the coverage tool not to cover the code called by the skipped tests?"}, {"owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1522648566, "post_id": 49605805, "comment_id": 86218775, "body": "yes,the tool should cover all the files present under the package except  the file tagged as skipped test"}, {"owner": {"reputation": 1485, "user_id": 353184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Hngu.jpg?s=128&g=1", "display_name": "jwriteclub", "link": "https://stackoverflow.com/users/353184/jwriteclub"}, "reply_to_user": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1522648942, "post_id": 49605805, "comment_id": 86218898, "body": "Then I think you&#39;ll need to use the build flags. If the code in question isn&#39;t built, then it&#39;s not getting covered."}], "tags": [], "owner": {"reputation": 1485, "user_id": 353184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3Hngu.jpg?s=128&g=1", "display_name": "jwriteclub", "link": "https://stackoverflow.com/users/353184/jwriteclub"}, "is_accepted": true, "score": 3, "last_activity_date": 1522646974, "creation_date": 1522646974, "answer_id": 49605805, "question_id": 49605482, "link": "https://stackoverflow.com/questions/49605482/while-running-the-go-test-under-a-package-how-to-skip-a-go-file-at-test-as-well/49605805#49605805", "title": "While running the go test under a package, how to skip a go file at test as well as at coverage report", "body": "<p>Unfortunately there's no simple way to skip tests based solely on the file name, however, here are three simple options which may work:</p>\n\n<p><strong>1. Specify tests using a regular expression</strong></p>\n\n<p>The go test command supports the <code>-run</code> runtime option which only runs tests satisfying a regular expression:</p>\n\n<blockquote>\n  <p>-run regexp</p>\n  \n  <p>Run only those tests and examples matching the regular expression.\n    For tests, the regular expression is split by unbracketed slash (/)\n    characters into a sequence of regular expressions, and each part\n    of a test's identifier must match the corresponding element in\n    the sequence, if any. Note that possible parents of matches are\n    run too, so that -run=X/Y matches and runs and reports the result\n    of all tests matching X, even those without sub-tests matching Y,\n    because it must run them to look for those sub-tests.</p>\n</blockquote>\n\n<p>In order for this to work, you will need to name all of the tests in the file in question in such a way that you can exclude them via a regular expression (for example, make all of them start with <code>TestExcludable...</code>, such as <code>TestExcludableA</code>, <code>TestExludableB</code>, etc). Then run using a slightly hacky negative regular expression, such as <code>-run \"Test[^E][^x][^c][^l][^u][^d][^a][^b][^l][^e].*\"</code></p>\n\n<p><strong>2. Don't compile certain tests using build flags</strong></p>\n\n<p>As explained in detail in <a href=\"https://stackoverflow.com/a/24036237/353184\">this stackoverflow post</a>, you can use build flags to prevent a particular file from building as part of the test suite. In a nutshell,</p>\n\n<p><strong>skip_test.go</strong></p>\n\n<pre><code>// +build !skipset1\npackage name\n\nimport testing\n\n// Rest of test file\n</code></pre>\n\n<p>Then when you invoke <code>go test</code> us the <code>-tags</code> parameter and specify the tests you would like to skip, such as <code>-tags skipset1</code>.</p>\n\n<p><strong>3. Rename the offending file during the build</strong></p>\n\n<p>As specified in the go test docs,</p>\n\n<blockquote>\n  <p>Files whose names begin with \"_\" (including \"_test.go\") or \".\" are ignored. </p>\n</blockquote>\n\n<p>Simply surround your go test command with a rename so that the file to skip is not actually compiled into the test executable:</p>\n\n<p><code>mv src/skip_test.go src/_skip_test.go &amp;&amp; go test ... || mv src/_skip_test.go src/skip_test.go</code></p>\n\n<p>(note the use of an <code>||</code> and in the second move, to cause it to run even if the go test fails).</p>\n"}], "owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1153, "favorite_count": 1, "accepted_answer_id": 49605805, "answer_count": 1, "score": 2, "last_activity_date": 1522646974, "creation_date": 1522644753, "last_edit_date": 1522645538, "question_id": 49605482, "link": "https://stackoverflow.com/questions/49605482/while-running-the-go-test-under-a-package-how-to-skip-a-go-file-at-test-as-well", "title": "While running the go test under a package, how to skip a go file at test as well as at coverage report", "body": "<p>I want to skip a particular go file under a package, while running the <strong>go test</strong> and coverage.\nPlease find the below command, I have used to run under my service package :</p>\n\n<pre><code>cd src/service &amp;&amp; go test --coverprofile coverageService.out --coverpkg ./.\n</code></pre>\n"}, {"tags": ["asynchronous", "go", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1522627400, "post_id": 49603738, "comment_id": 86214736, "body": "The idiomatic approach is to write synchronous APIs and leave it to the caller to execute the call from a goroutine."}, {"owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522627747, "post_id": 49603738, "comment_id": 86214783, "body": "How does that resolve the ambiguity of whether or not a channel is required?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1522628671, "post_id": 49603738, "comment_id": 86214935, "body": "Synchronous APIs do not use channels.  The idiomatic approach is to remove <code>responeChan</code> from <code>HTTPRequest</code> and to simply return <code>&amp;twitterHTTPResponse{body, nil}, err</code> from the function."}], "answers": [{"comments": [{"owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 0, "creation_date": 1522672179, "post_id": 49604708, "comment_id": 86229038, "body": "Thanks Cerise. Is this idiomatic mainly because an API request normally involves use of the net/http stdlib which itself is highly async already?  (and so running it as a goroutine should theoretically provide little to no benefit if the API function is properly separate from other application logic?)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 1, "creation_date": 1522677927, "post_id": 49604708, "comment_id": 86232068, "body": "I updated the answer to describe why synchronous APIs are idiomatic.  The net/http client API is synchronous."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1522677845, "last_edit_date": 1522677845, "creation_date": 1522637462, "answer_id": 49604708, "question_id": 49603738, "link": "https://stackoverflow.com/questions/49603738/what-is-the-idiomatic-way-of-dealing-with-return-data-from-a-conditionally-async/49604708#49604708", "title": "What is the idiomatic way of dealing with return data from a conditionally asynchronous function?", "body": "<p>The idiomatic approach is to provide a synchronous API:</p>\n\n<pre><code>type HTTPRequest struct {\n    // Represents a request to the twitter API\n    method string\n    baseurl string\n    urlParams map[string]string\n    bodyParams map[string]string\n    authParams map[string]string\n}\n\nfunc APICall(request *HTTPRequest) *HTTPResponse {\n    ...\n    return &amp;twitterHTTPResponse{body, nil} \n}\n</code></pre>\n\n<p>The caller an can easily create a goroutine if it needs to run the call concurrently.  For example:</p>\n\n<pre><code>r := make(chan *HTTPResponse) \ngo func() {\n    r &lt;- APICall(req)\n}()\n\n... do some other work\n\nresp := &lt;- r\n</code></pre>\n\n<p>Synchronous APIs are idiomatic for a couple of reasons: </p>\n\n<ul>\n<li>Synchronous APIs are easier to use and understand.</li>\n<li>Synchronous APIs don't make incorrect assumptions about how the application is managing concurrency.  For example, the application may want to use a wait group to wait for completion instead of receiving on a channel as assumed by the API.</li>\n</ul>\n"}], "owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 49604708, "answer_count": 1, "score": 1, "last_activity_date": 1522677845, "creation_date": 1522626684, "question_id": 49603738, "link": "https://stackoverflow.com/questions/49603738/what-is-the-idiomatic-way-of-dealing-with-return-data-from-a-conditionally-async", "title": "What is the idiomatic way of dealing with return data from a conditionally asynchronous function?", "body": "<p>I have a function which may or may not be called as an asynchronous go-routine.</p>\n\n<pre><code>func APICall(request *HTTPRequest) *HTTPResponse\n</code></pre>\n\n<p><code>*HTTPRequest</code> is a pointer to a struct which contains various pieces of data required in order to build a request:</p>\n\n<pre><code>type HTTPRequest struct {\n    // Represents a request to the twitter API\n    method string\n    baseurl string\n    urlParams map[string]string\n    bodyParams map[string]string\n    authParams map[string]string\n    responseChan chan *HTTPResponse\n}\n</code></pre>\n\n<p>If called as a goroutine, i.e a channel is passed in; we build the request and write the response into the *HTTPResponse object (also a struct) of the provided channel. What is the most graceful / idiomatic way to accept a call to the function without a channel (ie. Not async)</p>\n\n<p>At the moment, we do something like this within the body of APICall to deal with both kinds of function call:</p>\n\n<pre><code>if request.responseChan != nil { // If a response channel has been specified, write to that channel\nrequest.responseChan &lt;- &amp;twitterHTTPResponse{body, nil}\nreturn nil // Not returning a struct\n} else {\nreturn &amp;twitterHTTPResponse{body, nil} // Return a pointer to a new struct representing the response\n}\n</code></pre>\n\n<p>Are we along the right lines?</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 3, "user_id": 9583694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaf0bc2e1b73b7889483dfbfeef29db3?s=128&d=identicon&r=PG&f=1", "display_name": "philologisch", "link": "https://stackoverflow.com/users/9583694/philologisch"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522698131, "post_id": 49603638, "comment_id": 86242428, "body": "The answer from mkopriva solves my problem! I edited the list.html so now it should be proper."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1522660268, "creation_date": 1522660268, "answer_id": 49608418, "question_id": 49603638, "link": "https://stackoverflow.com/questions/49603638/parsing-multiple-templates-with-data/49608418#49608418", "title": "Parsing multiple templates with data", "body": "<p>From the <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>{{template \"name\" pipeline}} The template with the specified name is\n  executed with dot set to the value of the pipeline.</p>\n</blockquote>\n\n<p>This means that to pass data from the <code>layout.html</code> template to the <code>list.html</code> template you need to pass the data as the second argument of the <code>template</code> action.</p>\n\n<p>E.g. <code>{{template \"main\" .}}</code></p>\n"}], "owner": {"reputation": 3, "user_id": 9583694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaf0bc2e1b73b7889483dfbfeef29db3?s=128&d=identicon&r=PG&f=1", "display_name": "philologisch", "link": "https://stackoverflow.com/users/9583694/philologisch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 49608418, "answer_count": 1, "score": 0, "last_activity_date": 1522698052, "creation_date": 1522625707, "last_edit_date": 1522698052, "question_id": 49603638, "link": "https://stackoverflow.com/questions/49603638/parsing-multiple-templates-with-data", "title": "Parsing multiple templates with data", "body": "<p>How do i pass the data to the right template?</p>\n\n<p>I have the following templates and want to parse them</p>\n\n<p>layout.html:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n\n&lt;html&gt;\n    &lt;head&gt;\n    ...\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;header&gt;\n        ...\n        &lt;/header&gt;\n        &lt;main&gt;\n            {{template \"main\"}}\n        &lt;/main&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>list.html:</p>\n\n<pre><code>{{define \"main\"}}\n{{range $index, $element := . }}    \n    &lt;div&gt;\n        &lt;a href=#&gt;{{ $element.Data1 }}&lt;/a&gt;\n        &lt;p&gt;{{ $element.Data2 }}&lt;/p&gt;\n        &lt;p&gt;{{ $element.Data3 }}&lt;/p&gt;\n    &lt;/div&gt;\n{{end}}\n{{end}}\n</code></pre>\n\n<p>When i use this in the handler func only the \"main\" template is executed and i dont get the layout.</p>\n\n<pre><code>t, err := template.ParseFiles(layoutPath, templatePath)\n\nt.ExecuteTemplate(w, \"main\", Data)\n</code></pre>\n\n<p>And with this i dont have the Data in the list template and so cant display the list.</p>\n\n<pre><code>t, err := template.ParseFiles(layoutPath, templatePath)\n\nt.ExecuteTemplate(w, Data)\n</code></pre>\n\n<p>So how do i execute this properly?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1598318279, "post_id": 49602855, "comment_id": 112413153, "body": "It may be worth noting that APIs that take in a one-method <code>interface</code> could be re-written as taking a function type. See <a href=\"https://stackoverflow.com/a/63557675/12817546\">stackoverflow.com/a/63557675/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 6276257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dec81a543c7f8e032db33f8a0fcba89?s=128&d=identicon&r=PG&f=1", "display_name": "AlexManning", "link": "https://stackoverflow.com/users/6276257/alexmanning"}, "edited": false, "score": 0, "creation_date": 1522621569, "post_id": 49602921, "comment_id": 86213659, "body": "I am embarrassed at how easy that was. Thank you so much!"}], "tags": [], "owner": {"reputation": 4481, "user_id": 1264974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6558cf06df3ccf1c49329f38fd843b7d?s=128&d=identicon&r=PG", "display_name": "justinas", "link": "https://stackoverflow.com/users/1264974/justinas"}, "is_accepted": true, "score": 3, "last_activity_date": 1522619017, "creation_date": 1522619017, "answer_id": 49602921, "question_id": 49602855, "link": "https://stackoverflow.com/questions/49602855/extend-interface-throughout-package/49602921#49602921", "title": "Extend interface throughout package", "body": "<p>You could instead use a set of smaller interfaces and still combine them into one if needed.</p>\n\n<pre><code>type UserStore interface {\n  AllUsers() ([]User, error)\n  CreateUser(u User) error\n}\n\ntype PostStore interface {\n  AllPosts() ([]Post, error)\n  CreatePost(p Post) error\n}\n\ntype DataStore interface {\n  UserStore\n  PostStore\n}\n</code></pre>\n\n<p>This allows you to mock, say, only <code>UserStore</code> in a test. <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">See the \"Embedding\" chapter in Effective Go</a> for more info.</p>\n"}], "owner": {"reputation": 97, "user_id": 6276257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dec81a543c7f8e032db33f8a0fcba89?s=128&d=identicon&r=PG&f=1", "display_name": "AlexManning", "link": "https://stackoverflow.com/users/6276257/alexmanning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 49602921, "answer_count": 1, "score": 1, "last_activity_date": 1522667407, "creation_date": 1522618589, "last_edit_date": 1522667407, "question_id": 49602855, "link": "https://stackoverflow.com/questions/49602855/extend-interface-throughout-package", "title": "Extend interface throughout package", "body": "<p>TL;DR: Is there a way to extend an interface, or is there a school of thought on how to handle multiple 'datastore' functions (many models under a package), while creating an interface that can be properly mocked for controller testing.</p>\n\n<p>Long Story: \nI just finished implementing <a href=\"http://www.alexedwards.net/blog/organising-database-access#using-an-interface\" rel=\"nofollow noreferrer\" title=\"Alex Edward&#39;s blog on organizing database access in Go\">Alex Edward's blog on organizing database access in Go</a>, and one of the better solutions that would allow me to create mocks involves creating a Datastore interface.</p>\n\n<p>Under a models package I have codes similar to the below</p>\n\n<pre><code>type Datastore interface {\n  AllPosts() ([]Post, error)\n  CreatePost(p Post) error\n}\n\ntype DB struct {\n  *sql.DB\n}\n\nfunc initDB(...)( *DB) { // Code to initialize DB }\n\nfunc (db *DB) AllPosts() ([]Post, error) { ... }\n</code></pre>\n\n<p>and then under main:</p>\n\n<pre><code>type Env struct {\n    DB models.Datastore\n}\n\nfunc main() {\n  db := models.initDB(...)\n  env := &amp;Env{DB: db}\n\n  httprouter.New()\n  r.GET(\"/posts\", PostIndex(env))\n}\n\nfunc PostIndex(env *config.Env) httprouter.Handle {\n  return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    posts, err := env.DB.AllPosts()\n    ....\n  }\n}\n</code></pre>\n\n<p>I have everything working, but as I add a User model, I realize that my Datastore interface is growing tremendously (CreatePost, CreateUser, GetAllPosts, GetAllUsers, etc.), and although this won't be a problem for a personal project, I couldn't imagine any medium to large scale application doing this. Is there another way to have multiple models under a single package that can be properly mocked for testing purposes? </p>\n"}, {"tags": ["http", "go", "cookies", "client"], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 0, "last_activity_date": 1522607919, "creation_date": 1522607919, "answer_id": 49601393, "question_id": 49599927, "link": "https://stackoverflow.com/questions/49599927/changing-an-http-client-cookie-value/49601393#49601393", "title": "Changing an http.Client cookie value", "body": "<p>To change value of cookies you need to use <a href=\"https://golang.org/src/net/http/cookiejar/jar.go?s=6307:6367#L218\" rel=\"nofollow noreferrer\">SetCookies</a> method.<br>\nBecause you need just to change a single cookie value you need something like this:</p>\n\n<pre><code>mainLinkedinURL := \"http://www.example.com/\"\ncookieURL, err := url.Parse(mainLinkedinURL)\nif err != nil {\n    // handle error properly\n}\ncookies := jar.Cookies(cookieURL)\nfor _, cookie := range cookies {\n    // note: if there is no cookie with such a name \n    // then a new value would not appear, please pay attention to this\n    if cookie.Name == \"JSESSIONID\" {\n        cookie.Value = \"Another New Value\"\n        break\n    }\n}\njar.SetCookies(cookieURL, cookies)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9403556, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "OneSockThief", "link": "https://stackoverflow.com/users/9403556/onesockthief"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522667436, "creation_date": 1522598508, "last_edit_date": 1522667436, "question_id": 49599927, "link": "https://stackoverflow.com/questions/49599927/changing-an-http-client-cookie-value", "title": "Changing an http.Client cookie value", "body": "<p>I have the below code that works as intended, however upon the first request, I have the cookies I want, and just want to change a value of 1 cookie before sending another request. So far I have been rather unsuccessful.</p>\n\n<pre><code>jar, err := cookiejar.New(&amp;cookiejar.Options{PublicSuffixList: publicsuffix.List})\nif err != nil {\n  log.Fatal(err)\n}\n\nclient = &amp;http.Client{\n    Jar: jar,\n}\n\nfirstRequest() // aka login\n\nmainLinkedinURL := \"http://www.example.com/\"\ncookieURL, _ := url.Parse(mainLinkedinURL)\nfor j, i := range jar.Cookies(cookieURL) {\n    if i.Name == \"JSESSIONID\" {\n        jar.Cookies(cookieURL)[j].Value = \"Another New Value\"\n        i.Value = \"Another way of setting a new value\"\n    }\n}\nsecondRequest() // request after changing cookie\n</code></pre>\n\n<p>This is only from the http.Client perspective, and no server-side cookie management.</p>\n"}, {"tags": ["go", "race-condition"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1522598094, "post_id": 49599002, "comment_id": 86206779, "body": "The race detector detects data races when they happen in your program, not just in the <code>main</code> package."}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522612401, "post_id": 49599002, "comment_id": 86211327, "body": "@JimB if so it is very good."}], "answers": [{"tags": [], "owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "is_accepted": true, "score": 3, "last_activity_date": 1550793224, "last_edit_date": 1550793224, "creation_date": 1522658646, "answer_id": 49608040, "question_id": 49599002, "link": "https://stackoverflow.com/questions/49599002/detect-a-race-condition-in-imported-package/49608040#49608040", "title": "Detect a race condition in imported package", "body": "<p>The race condition detection is false negative rather than false positive. This means that it detects race at any time when it has just happened - when a program tries to read or write a shared value at the same time. The bottom line is the -race flag works not at 100% cases.</p>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "accepted_answer_id": 49608040, "answer_count": 1, "score": -1, "last_activity_date": 1550793224, "creation_date": 1522592469, "last_edit_date": 1522593389, "question_id": 49599002, "link": "https://stackoverflow.com/questions/49599002/detect-a-race-condition-in-imported-package", "title": "Detect a race condition in imported package", "body": "<p>I have package where I write a <code>golang</code> code.\nI have a fear that program works incorrecly because it outputs different results from time to time. Probably it's due to <code>race condtions</code>. So I run multiple times:</p>\n\n<pre><code>go run -race myprogram\n</code></pre>\n\n<p>But I didn't got any warning or errros. </p>\n\n<p>Probably, errors are in another package I imported. As I understand, <code>-race</code> flag doesn't detect them. If so, how can I do it (detect race condtion which occurs not in my code but in package I imported and I use in my code)? </p>\n"}, {"tags": ["git", "go", "git-lfs"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1522590322, "post_id": 49598662, "comment_id": 86204553, "body": "Go 1.2 is 5 years old... upgrade to 1.9"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522590907, "post_id": 49598662, "comment_id": 86204718, "body": "1.9 is outdated too. Update to 1.10.1. Find a tarball at <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">golang.org/dl</a>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522591671, "post_id": 49598662, "comment_id": 86204923, "body": "@Peter: Not true. Go supports the last two versions: &quot;Each major Go release is supported until there are two newer major releases. Go 1.9 is supported until Go 1.11 is released.&quot; <a href=\"https://golang.org/doc/devel/release.html#policy\" rel=\"nofollow noreferrer\">Go Release Policy</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1522592171, "post_id": 49598662, "comment_id": 86205048, "body": "@peterSO, perhaps outdated was the wrong term. But advising to install a version that is not the most recent seems wrong to me."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522593749, "post_id": 49598662, "comment_id": 86205521, "body": "@Peter: In production environments, it is common to run one or more versions behind, waiting for others to hopefully shake out any remaining bugs. In operating systems, Long Term Support (LTS) versions are commonly used for production: <a href=\"https://wiki.ubuntu.com/LTS\" rel=\"nofollow noreferrer\">Ubuntu LTS</a>. I use <code>devel</code> and test on the two most recently released versions."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1522595280, "creation_date": 1522595280, "answer_id": 49599445, "question_id": 49598662, "link": "https://stackoverflow.com/questions/49598662/installing-git-lfs-from-source-using-go-cannot-find-package/49599445#49599445", "title": "Installing git-lfs from source using go - cannot find package", "body": "<p><a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>Context</code></a> was supported only in <a href=\"https://golang.org/doc/go1.8#more_context\" rel=\"nofollow noreferrer\">Go 1.7/1.8</a></p>\n\n<p>You need to add the right archive, as explained in the <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"nofollow noreferrer\">Ubuntu page</a>:</p>\n\n<pre><code>$ sudo add-apt-repository ppa:gophers/archive\n$ sudo apt-get update\n$ sudo apt-get install golang-1.10-go\n</code></pre>\n"}], "owner": {"reputation": 761, "user_id": 1011227, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/d1aa1deafa5f1fb82df01a014b98ef1d?s=128&d=identicon&r=PG", "display_name": "sagism", "link": "https://stackoverflow.com/users/1011227/sagism"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 360, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1522596448, "creation_date": 1522590001, "last_edit_date": 1522596448, "question_id": 49598662, "link": "https://stackoverflow.com/questions/49598662/installing-git-lfs-from-source-using-go-cannot-find-package", "title": "Installing git-lfs from source using go - cannot find package", "body": "<p>I am trying to install git-lfs on an arm-based ubuntu machine. Package doesn't seem to exist so I need to install from source.</p>\n\n<p>Seems like the installation depends on the go language so I installed it </p>\n\n<pre><code>sudo apt-get install golang-go\n</code></pre>\n\n<p><code>go version</code> gives me: <code>go1.2.1 linux/arm</code></p>\n\n<p>Now I need to build git-lfs </p>\n\n<pre><code>go build ./src/github.com/git-lfs/git-lfs \n</code></pre>\n\n<p>and I get:</p>\n\n<blockquote>\n  <p>cannot find package \"context\" in any of Same for <code>net/http/httptrace</code></p>\n</blockquote>\n\n<p>Other packages seem to have been found since I have set the path (after some fumbling around and setting a bunch of go environments params).</p>\n\n<p>Now I see I can install more packages using <code>go get</code> , but it requires the full path, so I would need to know what is the fully qualified path to those two packages.</p>\n\n<p>Is there a way to look up what is the full path for those packages? i.e. something equivalent to the py-pi in Python etc?</p>\n"}, {"tags": ["go", "mutex", "deadlock", "channel"], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "edited": false, "score": 0, "creation_date": 1522581056, "post_id": 49596502, "comment_id": 86202039, "body": "Thank you, @Peter! Is it possible to fix this with <code>sync.Mutex</code>+<code>bool</code> ?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1522583851, "post_id": 49596502, "comment_id": 86202746, "body": "yes you can but then you have to protect the bool with another mutex and if you do that wrong you end up in the same position you are in now. It is much easier and cleaner to use a channel or a context as Peter suggested."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "edited": false, "score": 0, "creation_date": 1522583889, "post_id": 49596502, "comment_id": 86202756, "body": "@skovtunenko, no. As I said in the answer, you have to unblock the send on the channel eventually. Protecting a channel with a Mutex makes no sense."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1522573662, "creation_date": 1522573662, "answer_id": 49596502, "question_id": 49596347, "link": "https://stackoverflow.com/questions/49596347/closing-a-channel-from-the-receiver-side-deadlock-when-accessing-sync-mutex-fro/49596502#49596502", "title": "Closing a channel from the receiver side: deadlock when accessing sync.Mutex from multiple goroutines", "body": "<p>Send grabs the lock, then attempts to sends data down the channel. This may happen just after the 50th receive operation. There will be no more receives, so <code>c.data &lt;- data</code> blocks forever and consequently the Mutex is held forever.</p>\n\n<p>For cancellation, use another channel (instead of the boolean) and a select statement in Send. You can also leverage <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">the context package</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1522584434, "creation_date": 1522584434, "answer_id": 49597880, "question_id": 49596347, "link": "https://stackoverflow.com/questions/49596347/closing-a-channel-from-the-receiver-side-deadlock-when-accessing-sync-mutex-fro/49597880#49597880", "title": "Closing a channel from the receiver side: deadlock when accessing sync.Mutex from multiple goroutines", "body": "<p>You can try as hard as you like: you have to close the channel from sender side.</p>\n\n<p>You might be able to get it working without a complete lockdown but you will leak goroutines. The sender will block forever and cannot be shut down. If the receiver wants to trigger a shutdown it has to tell the sender to shut the channel down. How you could tell the sender to shut down:</p>\n\n<ul>\n<li>A boolean as you suggest (needs another mutex)</li>\n<li>A <code>stop</code>-channel that when closed signals the sender to close the data channel (cannot be closed multiple times)</li>\n<li>a <code>ctx.Context</code>: calling the <code>cancel()</code> function will signal the sender to stop. (Can be cancelled multiple times without worry)</li>\n</ul>\n\n<p>(Only elaborating on Peters correct answer)</p>\n"}], "owner": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "accepted_answer_id": 49596502, "answer_count": 2, "score": -1, "last_activity_date": 1522584434, "creation_date": 1522572210, "last_edit_date": 1522572585, "question_id": 49596347, "link": "https://stackoverflow.com/questions/49596347/closing-a-channel-from-the-receiver-side-deadlock-when-accessing-sync-mutex-fro", "title": "Closing a channel from the receiver side: deadlock when accessing sync.Mutex from multiple goroutines", "body": "<p>I'm trying to implement graceful <strong>channel closing from receiver side</strong>.</p>\n\n<p>Yes, I'm aware that this violates the channel closing rule:</p>\n\n<blockquote>\n  <p>...<a href=\"http://www.tapirgames.com/blog/golang-channel-closing\" rel=\"nofollow noreferrer\">don't close a channel from the receiver side and don't close a channel if the channel has multiple concurrent senders.</a></p>\n</blockquote>\n\n<p>But I want to implement such logic. Unfortunately, I fail into deadlock issue in the number of cases: the application just hangs for the unlimited time, trying to lock same locked <code>Mutex</code> again.</p>\n\n<p>So, I have 2 goroutines: </p>\n\n<ul>\n<li>one that will write into a channel and </li>\n<li>another that will receive data + will close channel from the receiver side.</li>\n</ul>\n\n<p>My channel wrapped in the struct with <code>sync.Mutex</code> and <code>closed</code> boolean flag:</p>\n\n<pre><code>type Chan struct {\n    sync.Mutex // can be replaced with deadlock.Mutex from \"github.com/sasha-s/go-deadlock\"\n    data           chan int\n    closed         bool\n}\n</code></pre>\n\n<p>All <code>Send()</code>, <code>Close()</code>, <code>IsClosed()</code> operations on this struct are guarded with <code>Mutex</code> and to prevent duplicate locking have the <em>non-threadsafe method versions</em> (<code>send()</code>, <code>close()</code>, <code>isClosed()</code>).</p>\n\n<p>The full source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"sync\"\n)\n\nfunc main() {\n    log.Println(\"Start\")\n\n    ch := New(0) // unbuffered channel to expose problem faster\n\n    wg := sync.WaitGroup{}\n    wg.Add(2)\n\n    // send data:\n    go func(ch *Chan) {\n        for i := 0; i &lt; 100; i++ {\n            ch.Send(i)\n        }\n        wg.Done()\n    }(ch)\n\n    // receive data and close from receiver side:\n    go func(ch *Chan) {\n        for data := range ch.data {\n            log.Printf(\"Received %d data\", data)\n            // Bad practice: I want to close the channel from receiver's side:\n            if data &gt; 50 {\n                ch.Close()\n                break\n            }\n        }\n        wg.Done()\n    }(ch)\n\n    wg.Wait()\n    log.Println(\"End\")\n}\n\ntype Chan struct {\n    deadlock.Mutex //sync.Mutex\n    data           chan int\n    closed         bool\n}\n\nfunc New(size int) *Chan {\n    defer func() {\n        log.Printf(\"Channel was created\")\n    }()\n    return &amp;Chan{\n        data: make(chan int, size),\n    }\n}\n\nfunc (c *Chan) Send(data int) {\n    c.Lock()\n    c.send(data)\n    c.Unlock()\n}\n\nfunc (c *Chan) Close() {\n    c.Lock()\n    c.close()\n    c.Unlock()\n}\n\nfunc (c *Chan) IsClosed() bool {\n    c.Lock()\n    defer c.Unlock()\n    return c.isClosed()\n}\n\n// send is internal non-threadsafe api.\nfunc (c *Chan) send(data int) {\n    if !c.closed {\n        c.data &lt;- data\n        log.Printf(\"Data %d was sent\", data)\n    }\n}\n\n// close is internal non-threadsafe api.\nfunc (c *Chan) close() {\n    if !c.closed {\n        close(c.data)\n        c.closed = true\n        log.Println(\"Channel was closed\")\n    } else {\n        log.Println(\"Channel was already closed\")\n    }\n}\n\n// isClosed is internal non-threadsafe api.\nfunc (c *Chan) isClosed() bool {\n    return c.closed\n}\n</code></pre>\n\n<p>You can run this program in the <a href=\"https://goplay.space/#P5NYRPlvZBh\" rel=\"nofollow noreferrer\">sandbox</a>.</p>\n\n<p>On the local machine, in small number of runs, after 30 seconds the output will be (using <code>deadlock.Mutex</code> instead of <code>sync.Mutex</code>):</p>\n\n<pre><code>2018/04/01 11:26:22 Data 50 was sent\n2018/04/01 11:26:22 Received 50 data\n2018/04/01 11:26:22 Data 51 was sent\n2018/04/01 11:26:22 Received 51 data\nPOTENTIAL DEADLOCK:\nPrevious place where the lock was grabbed\ngoroutine 35 lock 0xc42015a040\nclose-from-receiver-side/closeFromReceiverSideIsBadPractice.go:71 main.(*Chan).Send { c.Lock() } &lt;&lt;&lt;&lt;&lt;\nclose-from-receiver-side/closeFromReceiverSideIsBadPractice.go:30 main.main.func1 { ch.Send(i) }\n\nHave been trying to lock it again for more than 30s\ngoroutine 36 lock 0xc42015a040\nclose-from-receiver-side/closeFromReceiverSideIsBadPractice.go:77 main.(*Chan).Close { c.Lock() } &lt;&lt;&lt;&lt;&lt;\nclose-from-receiver-side/closeFromReceiverSideIsBadPractice.go:44 main.main.func2 { ch.Close() }\n</code></pre>\n\n<p>Why this deadlock happened and how to fix this implementation to avoid deadlocks?</p>\n\n<hr>\n\n<p>Closing the channel on the sender's side is not the answer. So, this is not the fix for my question: <a href=\"https://goplay.space/#3oVCHXBDywu\" rel=\"nofollow noreferrer\">Example of closing channel from sender side</a>.</p>\n"}, {"tags": ["file", "http", "go", "gzip"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522574425, "post_id": 49596181, "comment_id": 86200390, "body": "Read the file until <code>\\r\\n\\r\\n</code> (bufio.Reader), then decompress (compress/gzip)."}], "answers": [{"tags": [], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "is_accepted": true, "score": 0, "last_activity_date": 1522672941, "creation_date": 1522672941, "answer_id": 49611532, "question_id": 49596181, "link": "https://stackoverflow.com/questions/49596181/ungzip-after-write-dumpresponse-to-file/49611532#49611532", "title": "Ungzip after write DumpResponse to file", "body": "<p>You can deserialize it back to <code>http.Response</code>, and then 'ungzip' body:</p>\n\n<pre><code>func main()  {\n    file, _ := os.Open(`/home/your/path/file.txt`)\n    response, _ := http.ReadResponse(bufio.NewReader(file), nil)\n    reader, _ := gzip.NewReader(response.Body)\n    ungzipped, _ := ioutil.ReadAll(reader)\n    fmt.Println(string(ungzipped))\n}\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 49611532, "answer_count": 1, "score": 0, "last_activity_date": 1522672941, "creation_date": 1522570671, "question_id": 49596181, "link": "https://stackoverflow.com/questions/49596181/ungzip-after-write-dumpresponse-to-file", "title": "Ungzip after write DumpResponse to file", "body": "<p>I have following code:</p>\n\n<pre><code>dump, err := httputil.DumpResponse(response, true)\nioutil.WriteFile(response.Request.Host+\".txt\", dump, 0644)\n</code></pre>\n\n<p>I creates following file <code>example.com.txt</code>:</p>\n\n<pre><code>HTTP/1.1 200 OK\nTransfer-Encoding: chunked\nAccept-Ranges: bytes\nAge: 0\nCache-Control: public\nContent-Encoding: gzip\nContent-Type: text/xml\nDate: Sun, 01 Apr 2018 08:52:39 GMT\nLast-Modified: Thu, 01 Mar 2018 13:30:10 GMT\nServer: Microsoft-IIS/7.5\nVary: Accept-Encoding\nVia: 1.1 varnish\n\n8000\n\ufffd      \ufffd`I\ufffd\ufffd\ufffd\ufffd\ufffdB\ufffd\u24ff\ufffdO\ufffd\ufffd\ufffd\ufffd?\ufffd\ufffd\ufffd\ufffd...\n</code></pre>\n\n<p>How can I read gzipped content from the file now?</p>\n"}, {"tags": ["google-app-engine", "go", "sendgrid", "urlfetch", "sendgrid-api-v3"], "comments": [{"owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "edited": false, "score": 0, "creation_date": 1522655963, "post_id": 49596003, "comment_id": 86221498, "body": "Refrain from sharing your API Key in public."}, {"owner": {"reputation": 48253, "user_id": 3583182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6JxNE.png?s=128&g=1", "display_name": "patricus", "link": "https://stackoverflow.com/users/3583182/patricus"}, "edited": false, "score": 0, "creation_date": 1523030485, "post_id": 49596003, "comment_id": 86406401, "body": "The v3 package has a <code>DefaultClient</code> variable. Did you try setting that to <code>bob</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2430, "user_id": 4092401, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L2gLB.jpg?s=128&g=1", "display_name": "Ying Li", "link": "https://stackoverflow.com/users/4092401/ying-li"}, "edited": false, "score": 1, "creation_date": 1522681825, "post_id": 49607041, "comment_id": 86234038, "body": "Great answer, I upvoted it. It&#39;s worth noting that GAE has a lot of limitation (the GAE sandbox) on what can be done on it and our URLFetch method is basically there to make sure we don&#39;t need to expose the native net/http method to users."}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "edited": false, "score": 0, "creation_date": 1522716146, "post_id": 49607041, "comment_id": 86248150, "body": "The latest sendgrid-go package version doesn&#39;t have sg.Client.  It won&#39;t even compile.   I tried a few different workarounds on that and gave up."}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "edited": false, "score": 0, "creation_date": 1522716210, "post_id": 49607041, "comment_id": 86248167, "body": "When I found the import statement to use the old Sendgrid v2 api : \t&quot;gopkg.in/sendgrid/sendgrid-go.v2&quot;, I got it to compile and run, but sendgrid returns bad username / pass on every attempt.  Buried somewhere in their docs is: &quot;You can&#39;t use API keys with anything older than v3&quot;."}, {"owner": {"reputation": 48253, "user_id": 3583182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6JxNE.png?s=128&g=1", "display_name": "patricus", "link": "https://stackoverflow.com/users/3583182/patricus"}, "reply_to_user": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "edited": false, "score": 0, "creation_date": 1523028454, "post_id": 49607041, "comment_id": 86405106, "body": "@Darian311 From the docs on the github page for v2, it says you&#39;d need to use <code>sendgrid.NewSendGridClientWithApiKey</code> instead of <code>sendgrid.NewSendGridClient</code> if you&#39;re using an api key."}], "tags": [], "owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "is_accepted": false, "score": 1, "last_activity_date": 1522655849, "last_edit_date": 1522655849, "creation_date": 1522654014, "answer_id": 49607041, "question_id": 49596003, "link": "https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang/49607041#49607041", "title": "How to use SendGrid from Google App Engine Golang?", "body": "<p>You were on the right track, but skipped overriding the default <code>sendgrid</code> client with <code>urlfetch</code> client.</p>\n\n<pre><code>.\n.\n.\nfunc IndexHandler (w http.ResponseWriter, r *http.Request){\n    ctx := appengine.NewContext(r)    \n    sg := sendgrid.NewSendClient(\"REPLACE_WITH_API_KEY\")\n    bob := urlfetch.Client(ctx)\n\n    sg.Client = bob\n\n    request := sendgrid.GetRequest(\"REPLACE_WITH_API_KEY\", \"/v3/mail/send\", \"https://api.sendgrid.com\")\n    request.Method = \"POST\"\n.\n.\n.\n</code></pre>\n\n<p><strong>Explanation</strong></p>\n\n<p>The error occurs as sendgrid tries to fetch a url with the default <code>net/http</code> method.</p>\n\n<p>Quoting AppEngine Documentation</p>\n\n<blockquote>\n  <p>App Engine uses the URL Fetch service to issue outbound HTTP(S) requests. To issue an outbound HTTP request, use the http package as usual, but create your client using urlfetch.Client. urlfetch.Client returns an *http.Client that uses urlfetch.Transport, which is an implementation of the http.RoundTripper interface that makes requests using the URL Fetch API.</p>\n</blockquote>\n\n<p>The workaround is to override the Sendgrid client to use <code>urlfetch</code></p>\n\n<pre><code>        context := appengine.NewContext(r)\n        sg := sendgrid.NewSendClient(os.Getenv(\"SENDGRID_API_KEY\"))\n        sg.Client = urlfetch.Client(context)\n</code></pre>\n\n<p>References</p>\n\n<ol>\n<li><a href=\"https://cloud.google.com/appengine/docs/standard/go/issue-requests\" rel=\"nofollow noreferrer\">GCloud Documentation- Issuing HTTP(S) Requests in App Engine Golang</a></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "is_accepted": true, "score": 2, "last_activity_date": 1522716036, "creation_date": 1522716036, "answer_id": 49620631, "question_id": 49596003, "link": "https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang/49620631#49620631", "title": "How to use SendGrid from Google App Engine Golang?", "body": "<p>After 8 different attempts, including trying an example published in Google Cloud docs for using Sendgrid, an example from Sendgrid blog, and trying to use deprecated versions of Sendgrid api, I found Sendgrid curl examples at: </p>\n\n<p><a href=\"https://sendgrid.com/docs/Classroom/Send/v3_Mail_Send/curl_examples.html\" rel=\"nofollow noreferrer\">https://sendgrid.com/docs/Classroom/Send/v3_Mail_Send/curl_examples.html</a></p>\n\n<pre><code>curl --request POST \\\n  --url https://api.sendgrid.com/v3/mail/send \\\n  --header 'Authorization: Bearer YOUR_API_KEY' \\\n  --header 'Content-Type: application/json' \\\n  --data '{\"personalizations\": [{\"to\": [{\"email\": \"recipient@example.com\"}]}],\"from\": {\"email\": \"sendeexampexample@example.com\"},\"subject\": \"Hello, World!\",\"content\": [{\"type\": \"text/plain\", \"value\": \"Heya!\"}]}'\n</code></pre>\n\n<p>I then translated the HelloWorld example to into URLFetch usage</p>\n\n<pre><code>client := urlfetch.Client(ctx)\n\nrequest, err := http.NewRequest(\"POST\", \"https://api.sendgrid.com/v3/mail/send\", buf)\n    if err != nil {\n        log.Errorf(ctx, \"Failed Request %v\", request)\n    }\n    request.Header.Set(\"Authorization\", \"Bearer SENDGRID_API_KEY\")\n    request.Header.Set(\"Content-Type\", \"application/json\")\n    resp, err := client.Do(request)\n</code></pre>\n\n<p>One Easter weekend, later, it works!</p>\n"}, {"comments": [{"owner": {"reputation": 665, "user_id": 10458445, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-PuPfqcdNqr8/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DVqgdU_dKUq7xVCZPveZKuIpMbx_A/mo/photo.jpg?sz=128", "display_name": "Steve", "link": "https://stackoverflow.com/users/10458445/steve"}, "edited": false, "score": 0, "creation_date": 1549303538, "post_id": 51686283, "comment_id": 95846364, "body": "This worked perfectly for me, using go 1.11 on Google App Angine Standard, with the latest example from sendgrid&#39;s go library v3 example on github.   Thanks!"}], "tags": [], "owner": {"reputation": 11, "user_id": 6538912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8784a120f514797c9883ee0ae4b4d5ca?s=128&d=identicon&r=PG&f=1", "display_name": "Birju Prajapati", "link": "https://stackoverflow.com/users/6538912/birju-prajapati"}, "is_accepted": false, "score": 1, "last_activity_date": 1533390776, "creation_date": 1533390776, "answer_id": 51686283, "question_id": 49596003, "link": "https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang/51686283#51686283", "title": "How to use SendGrid from Google App Engine Golang?", "body": "<p>The solution is documented in <strong>sendgrid.go</strong>:</p>\n\n<pre><code>// DefaultClient is used if no custom HTTP client is defined\nvar DefaultClient = rest.DefaultClient\n</code></pre>\n\n<p>So just do this at the beginning of your send, where <strong>ctx</strong> is <strong>appengine.NewContext(req)</strong>:</p>\n\n<pre><code>sendgrid.DefaultClient = &amp;rest.Client{HTTPClient: urlfetch.Client(ctx)}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8702, "user_id": 828547, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/8ed7d7d8f26f5b8c1adb434e1bca4bae?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/828547/jack"}, "is_accepted": false, "score": 0, "last_activity_date": 1578055696, "creation_date": 1578055696, "answer_id": 59578929, "question_id": 49596003, "link": "https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang/59578929#59578929", "title": "How to use SendGrid from Google App Engine Golang?", "body": "<p><strong>SendGrid</strong> document the minimum needed code to send an email with Go on AppEngine in\n<a href=\"https://app.sendgrid.com/guide/integrate/langs/go\" rel=\"nofollow noreferrer\">How to send email using Go</a>. It differs from @birju-prajapati's answer; the client is created with <code>sendgrid.NewSendClient</code>.</p>\n\n<p>An API key must be generated and your development environment updated with your <code>SENDGRID_API_KEY</code>.  Then install <strong>sendgrid-go</strong> and its dependencies with <code>go get github.com/sendgrid/sendgrid-go</code>. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// using SendGrid's Go Library\n// https://github.com/sendgrid/sendgrid-go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"github.com/sendgrid/sendgrid-go\"\n    \"github.com/sendgrid/sendgrid-go/helpers/mail\"\n)\n\nfunc main() {\n    from := mail.NewEmail(\"Example User\", \"test@example.com\")\n    subject := \"Sending with SendGrid is Fun\"\n    to := mail.NewEmail(\"Example User\", \"test@example.com\")\n    plainTextContent := \"and easy to do anywhere, even with Go\"\n    htmlContent := \"&lt;strong&gt;and easy to do anywhere, even with Go&lt;/strong&gt;\"\n    message := mail.NewSingleEmail(from, subject, to, plainTextContent, htmlContent)\n    client := sendgrid.NewSendClient(os.Getenv(\"SENDGRID_API_KEY\"))\n    response, err := client.Send(message)\n    if err != nil {\n        log.Println(err)\n    } else {\n        fmt.Println(response.StatusCode)\n        fmt.Println(response.Body)\n        fmt.Println(response.Headers)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 601, "favorite_count": 0, "accepted_answer_id": 49620631, "answer_count": 4, "score": 1, "last_activity_date": 1578055696, "creation_date": 1522569302, "last_edit_date": 1522742160, "question_id": 49596003, "link": "https://stackoverflow.com/questions/49596003/how-to-use-sendgrid-from-google-app-engine-golang", "title": "How to use SendGrid from Google App Engine Golang?", "body": "<p>The example code at: <a href=\"https://sendgrid.com/blog/send-email-go-google-app-engine/\" rel=\"nofollow noreferrer\">https://sendgrid.com/blog/send-email-go-google-app-engine/</a></p>\n\n<p>My guess this is very old sample code to use sendgrid-go on Google App Engine.   </p>\n\n<p>I've attempted 4 permutations and failed each time with: </p>\n\n<pre><code>https://api.sendgrid.com/v3/mail/send: http.DefaultTransport and http.DefaultClient are not available in App Engine. See https://cloud.google.com/appengine/docs/go/urlfetch/\n</code></pre>\n\n<p>Here is a minimum hardcoded attempt with some logging: </p>\n\n<pre><code>package sendgridgo\n\n\nimport(\n    \"github.com/sendgrid/sendgrid-go\"\n    \"fmt\"\n    _\"google.golang.org/appengine\"\n    \"net/http\"\n    \"google.golang.org/appengine/log\"\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/urlfetch\"\n     _ \"github.com/sendgrid/sendgrid-go/helpers/mail\"\n)\n\nfunc init(){\n    http.HandleFunc(\"/\", IndexHandler)\n    appengine.Main()\n}\n\nfunc IndexHandler (w http.ResponseWriter, r *http.Request){\n    ctx := appengine.NewContext(r)\n\n    log.Infof(ctx, \"IndexHandler\")\n    sg := sendgrid.NewSendClient(\"SENDGRID_API_KEY\")\n    log.Infof(ctx, \"%v\", sg)\n    bob := urlfetch.Client(ctx)\n\n    log.Infof(ctx, \"UrlFetchClient %v\", bob)\n    //resp, err := sg.Send(m)\n    request := sendgrid.GetRequest(\"SENDGRID_API_KEY\", \"/v3/mail/send\", \"https://api.sendgrid.com\")\n    request.Method = \"POST\"\n\n    request.Body = []byte(` {\n    \"personalizations\": [\n        {\n            \"to\": [\n                {\n                    \"email\": \"darian.hickman@gmail.com\"\n                }\n            ],\n            \"subject\": \"Sending with SendGrid is Fun\"\n        }\n    ],\n    \"from\": {\n        \"email\": \"darian.hickman@villagethegame.com\"\n    },\n    \"content\": [\n        {\n            \"type\": \"text/plain\",\n            \"value\": \"and easy to do anywhere, even with Go\"\n        }\n    ]\n}`)\n    resp, err := sendgrid.API(request)\n\n    if err != nil{\n        log.Errorf(ctx, \"Failed %v\", err)\n    }\n\n    fmt.Fprint(w, resp)\n\n\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1522569416, "post_id": 49595947, "comment_id": 86199306, "body": "What if you do something like this: <a href=\"https://play.golang.org/p/cmxkFCvDRDR\" rel=\"nofollow noreferrer\">play.golang.org/p/cmxkFCvDRDR</a> ?"}, {"owner": {"reputation": 462, "user_id": 2476347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0ada1accf751d0d89e615705d0519da1?s=128&d=identicon&r=PG", "display_name": "erPe", "link": "https://stackoverflow.com/users/2476347/erpe"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1522569955, "post_id": 49595947, "comment_id": 86199410, "body": "@mkopriva that potentially could work ;) I&#39;m guessing the use of pointer in structure is addressing the problem of having or not the property in answer ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1522570235, "post_id": 49595947, "comment_id": 86199478, "body": "Yes, but same applies to the slice of structs, if any of the fields after unmarshal are nil, it means they were not present in the json. see here: <a href=\"https://play.golang.org/p/iGef5-odrDb\" rel=\"nofollow noreferrer\">play.golang.org/p/iGef5-odrDb</a>"}], "answers": [{"comments": [{"owner": {"reputation": 462, "user_id": 2476347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0ada1accf751d0d89e615705d0519da1?s=128&d=identicon&r=PG", "display_name": "erPe", "link": "https://stackoverflow.com/users/2476347/erpe"}, "edited": false, "score": 0, "creation_date": 1522920629, "post_id": 49635535, "comment_id": 86347612, "body": "Works nice! Thanks"}], "tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1522775002, "creation_date": 1522775002, "answer_id": 49635535, "question_id": 49595947, "link": "https://stackoverflow.com/questions/49595947/same-struct-in-nested-json/49635535#49635535", "title": "Same struct in nested JSON", "body": "<p>Here is a solution that works, check <a href=\"https://play.golang.org/p/DlEsHnzAoda\" rel=\"nofollow noreferrer\">playground</a> </p>\n\n<pre><code>type Categories []*Category\ntype Category struct {\n    Type string `json:\"podKategoriaTyp\"`\n    Display string `json:\"nazwaWyswietlana\"`\n    Categories Categories `json:\"podKategorie\"`\n    SubCategory *Category `json:\"podKategoria\"`\n}\n\nfunc main() {\n\n    cat := &amp;Category{}\n    err := json.Unmarshal([]byte(JSON), &amp;cat)\n    if err != nil {\n        log.Fatal(err)\n    }\n    buf, err := json.Marshal(cat)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%s\\n\", buf)\n}\n</code></pre>\n"}], "owner": {"reputation": 462, "user_id": 2476347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0ada1accf751d0d89e615705d0519da1?s=128&d=identicon&r=PG", "display_name": "erPe", "link": "https://stackoverflow.com/users/2476347/erpe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 49635535, "answer_count": 1, "score": 0, "last_activity_date": 1522775002, "creation_date": 1522568824, "last_edit_date": 1522752273, "question_id": 49595947, "link": "https://stackoverflow.com/questions/49595947/same-struct-in-nested-json", "title": "Same struct in nested JSON", "body": "<p>I got a problem with parsing JSON in golang where I receive response from API in JSON format which nests same form of JSON in multiple levels. </p>\n\n<p>Response from API is following</p>\n\n<pre><code>{\n    \"podKategoria\": {\n        \"podKategoriaTyp\": \"area\",\n        \"nazwaWyswietlana\": \"Area\",\n        \"podKategorie\": [\n            {\n                \"podKategoriaTyp\": \"somethingelse\",\n                \"nazwaWyswietlana\": \"Display something else\",\n                \"podKategoria\": {\n                    \"podKategoriaTyp\": \"and other thing\",\n                    \"nazwaWyswietlana\": \"Display and other thing\",\n                    \"podKategorie\": [\n                        {\n                            \"podKategoriaTyp\": \"sub nd other thing\",\n                            \"nazwaWyswietlana\": \"display nd other thing\"\n                        },\n                        {\n                            \"podKategoriaTyp\": \"sub 2 nd other thing\",\n                            \"nazwaWyswietlana\": \"display sub 2 nd other thing\"\n                        },\n                        {\n                            \"podKategoriaTyp\": \"sub 3 nd other thing\",\n                            \"nazwaWyswietlana\": \"display sub 3 nd other thing\"\n                        }\n                    ]\n                }\n            },\n            {\n                \"podKategoriaTyp\": \"another one\",\n                \"nazwaWyswietlana\": \"display another one\",\n                \"podKategoria\": {\n                    \"podKategoriaTyp\": \"and and another one \",\n                    \"nazwaWyswietlana\": \"display it another one\",\n                    \"podKategorie\": [\n                        {\n                            \"podKategoriaTyp\": \"sub 1 another one\",\n                            \"nazwaWyswietlana\": \"display sub 1\"\n                        },\n                        {\n                            \"podKategoriaTyp\": \"sub 2 another one\",\n                            \"nazwaWyswietlana\": \"display sub 2\"\n                        },\n                    ]\n                }\n            },\n        ]\n    }\n}\n</code></pre>\n\n<p>Following this I have used <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> to try and create structure for me. The most appropriate approach seemed to be creating base structure like </p>\n\n<pre><code>type Struktury struct {\n    PodKategorie PodKategoria `json:\"podKategoria\"`\n}\n\n\ntype PodKategoria struct {\n    PodKategoriaTyp string `json:\"podKategoriaTyp\"`\n    NazwaWyswietlana     string `json:\"nazwaWyswietlana\"`\n    PodKategorie   []struct {\n        SubCategoryType string `json:\"podKategoriaTyp\"`\n        DisplayName     string `json:\"nazwaWyswietlana\"`\n    } `json:\"podKategorie, omitempty\"`\n}\n</code></pre>\n\n<p>But as you can see JSON structure is a bit tricky and I'm kinda stuck trying to figure the best way to proper unmarshliing this JSON string :/ </p>\n\n<p>Initial attempt to just use defaults allows me to get root of items ( tested in playground <a href=\"https://play.golang.org/p/uQMnMGEtXD-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uQMnMGEtXD-</a> ) therefore this brings me to idea that maybe custom unmarshall interface implemention is the way to go here ? Any pointers how to tackle this would be appreciated</p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1522860813, "last_edit_date": 1522860813, "creation_date": 1522568834, "answer_id": 49595949, "question_id": 49595551, "link": "https://stackoverflow.com/questions/49595551/use-struct-from-different-package-golang/49595949#49595949", "title": "Use struct from different package golang", "body": "<p>The package is <code>models</code> which contains <code>Requires</code> struct used as slice. Have a look at <a href=\"https://golang.org/ref/spec#Qualified_identifiers\" rel=\"nofollow noreferrer\">Qualified identifiers</a> for more understanding of how package works.\nIn your case It needs a slice of <code>Requires</code> with <code>models</code> package, should be used as below:</p>\n\n<pre><code>Requires: []models.Requires{\n{\n    Name: \"db\",\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1522860813, "creation_date": 1522565391, "last_edit_date": 1522575267, "question_id": 49595551, "link": "https://stackoverflow.com/questions/49595551/use-struct-from-different-package-golang", "title": "Use struct from different package golang", "body": "<p>I'm calling to object from current file which works\n(i'm creating unit test)</p>\n\n<pre><code>type Requires struct {\n    Name       string     `yaml:\"name,omitempty\"`\n}\n</code></pre>\n\n<p>and I call it inside test like </p>\n\n<pre><code>Requires: []Requires{\n{\n    Name: \"db\",\n}\n</code></pre>\n\n<p><strong>which works ok,</strong></p>\n\n<p>Now I <strong>move</strong> the <code>Requires</code> struct to different package models</p>\n\n<p>and I try to call it like </p>\n\n<pre><code>Requires: models.Requires{\n{\n    Name: \"db\",\n}\n</code></pre>\n\n<blockquote>\n  <p>cannot use models.require as type <code>[]Require</code></p>\n</blockquote>\n\n<p>also tried with <code>models.[]Requires\n</code></p>\n\n<p>This give me the error</p>\n\n<blockquote>\n  <p>use of package without selector error</p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/questions/36994445/getting-a-use-of-package-without-selector-error\">Getting a use of package without selector error</a></p>\n\n<p>But not sure how to handle it for my case...</p>\n\n<p>Any idea how to overcome this ?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>When I try it like following</p>\n\n<pre><code>        Requires: models.Requires{\n                Name: \u201cdb\",\n\n                },\n            },\n</code></pre>\n\n<p>I got error </p>\n\n<blockquote>\n  <p>cannot use models.Requires literal (type models.Requires) as type\n  []models.Requires in field value</p>\n</blockquote>\n\n<p>This is the error from viscose</p>\n"}, {"tags": ["postgresql", "rest", "go"], "comments": [{"owner": {"reputation": 94, "user_id": 5306495, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zA_hch-dee4/AAAAAAAAAAI/AAAAAAAABc8/pQiKydilpxQ/photo.jpg?sz=128", "display_name": "Rajmani Arya", "link": "https://stackoverflow.com/users/5306495/rajmani-arya"}, "edited": false, "score": 0, "creation_date": 1522563344, "post_id": 49595272, "comment_id": 86197943, "body": "separate <b>DB Query</b> and <b>DB Connection</b> in separate functions. while writing output to stdout using <code>fmt.Printf()</code> use <code>fmt.Fprintf(w, &quot;pattern&quot;, vars)</code> this will write output to http response."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 94, "user_id": 5306495, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zA_hch-dee4/AAAAAAAAAAI/AAAAAAAABc8/pQiKydilpxQ/photo.jpg?sz=128", "display_name": "Rajmani Arya", "link": "https://stackoverflow.com/users/5306495/rajmani-arya"}, "edited": false, "score": 0, "creation_date": 1522563828, "post_id": 49595272, "comment_id": 86198027, "body": "Yes, this redirect the &quot;result&quot; to the browser. But only garbage text like &quot;pattern%!(EXTRA *interface {}=0xc4201aa2b0 etc&quot;. At the same time the result is still printed to the Terminal. Further clues?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522575058, "post_id": 49595272, "comment_id": 86200518, "body": "You are using a type safe language to try and ignore type safety. Find a better hammer or generate the code."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522593293, "post_id": 49595272, "comment_id": 86205360, "body": "@peter Can you elaborate this more? What is insecure and why?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522596415, "post_id": 49595272, "comment_id": 86206340, "body": "I didn&#39;t say it is insecure. What I meant is that there&#39;s better options than using a statically typed language to then ignore the type system by putting interface{} everywhere. That&#39;s going to be messy. You might as well use a dynamically typed language like Ruby, Python, PHP."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522603886, "post_id": 49595272, "comment_id": 86208619, "body": "@peter &quot;rows.Columns()&quot; is a dynamically (?) command from golang &quot;database/sql&quot;. How can a standard command be messy? Forgive me, but I am a totally newbie on Golang and am only trying to understand."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522604835, "post_id": 49595272, "comment_id": 86208933, "body": "The messy bit is how you have to deal with the actual rows, not the column names. It is much cleaner and simpler if you know what you&#39;re working with. And you haven&#39;t even written the code for inserts yet. Try it yourself. Write non-generic code for one of the endpoints and compare. You&#39;ll see that it is much shorter and simpler."}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1522565576, "post_id": 49595457, "comment_id": 86198403, "body": "1. So calling another function outside &quot;func Query&quot;?. How? 2. How to achieve generic REST API. I e write once use many times. Links, clues or whatever."}], "tags": [], "owner": {"reputation": 61, "user_id": 9185113, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qjcu8aNPCSg/AAAAAAAAAAI/AAAAAAAAACg/dRP-h2qhULA/photo.jpg?sz=128", "display_name": "Helen Lazar", "link": "https://stackoverflow.com/users/9185113/helen-lazar"}, "is_accepted": false, "score": 0, "last_activity_date": 1522564870, "last_edit_date": 1522564870, "creation_date": 1522564539, "answer_id": 49595457, "question_id": 49595272, "link": "https://stackoverflow.com/questions/49595272/generic-rest-api-golang/49595457#49595457", "title": "Generic REST API Golang", "body": "<ol>\n<li><p>write response with appropriahe HTTP hearers &amp;&amp; status code</p>\n\n<pre><code>import \"net/http\"\n\nfunc writeResponse(w http.ResponseWriter, contents []byte) {\n    w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintln(w, contents)\n}\n</code></pre></li>\n<li><p>sounds a little unclear, sorry</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 42, "user_id": 4671615, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FUIXO851_Kw/AAAAAAAAAAI/AAAAAAAAAF8/WnnZJuU3wx4/photo.jpg?sz=128", "display_name": "Plawan Rath", "link": "https://stackoverflow.com/users/4671615/plawan-rath"}, "is_accepted": false, "score": 1, "last_activity_date": 1522693801, "creation_date": 1522693801, "answer_id": 49616710, "question_id": 49595272, "link": "https://stackoverflow.com/questions/49595272/generic-rest-api-golang/49616710#49616710", "title": "Generic REST API Golang", "body": "<p>My recommendation would be to look at using existing packages like \"mux\" for calling REST APIs in browser. As a quick demo how you would do it as as follows:</p>\n\n<p>your restapi.go cound have APIs as follows:</p>\n\n<pre><code>func SampleAPI(w http.ResponseWriter, r *http.Request) { //Assuming this is a POST request\n    var example SomeSruct \n    _ = json.NewDecoder(r.Body).Decode(&amp;example) //Decode the POST body\n    result := someLogicFunction(example) //call your generic function\n    json.NewEncoder(w).Encode(result) //encode the result to pass it back to browser\n}\n</code></pre>\n\n<p>Now say you write a main.go and you are using mux package here is an example of how you would call this</p>\n\n<p>main.go</p>\n\n<pre><code>func main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/testFunc\",restapi.SampleAPI).Methods(\"POST\") //This creates the route for your http request\n    handler := cros.Default().Handler(router) //You will need this if you plan to deploy it in a server and call it externally for testing locally you don't need this\n    log.Fatal(http.ListenAndServe(\":8080\", handler)) //Port that the router is listening to\n}\n</code></pre>\n\n<p>Now note that you will have to import the \"github.com/gorilla/mux\" and the \"github.com/rs/cors\" packages to use these but this way you can create REST APIs whic can be accessed by te browser. Similarly you could create a GET method and use parameters which you can grab in your function and perform any logical step.</p>\n\n<p>If you build and install the above code you can POST to <em>localhost:8080/testFunc</em> over http using any web app and get results i your browser. If you had a GET request you could directly type the Url in the browser and see the result.</p>\n"}], "owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 993, "favorite_count": 1, "answer_count": 2, "score": -2, "last_activity_date": 1522693801, "creation_date": 1522562698, "last_edit_date": 1522564517, "question_id": 49595272, "link": "https://stackoverflow.com/questions/49595272/generic-rest-api-golang", "title": "Generic REST API Golang", "body": "<p>Searching SO for <strong>Generic REST API Golang</strong> gives 0 results. Searching Google gives 2 results. So this question is maybe not correctly formulated or it is impossible to achieve in Golang.</p>\n\n<p>My goal is to avoid repeating similar code over and over again. So I am trying to make the code in Golang as generic as possible. Write once, use many.</p>\n\n<p>This is my first attempt to create a generic REST API for select in Golang. The code below gives almost what I want: </p>\n\n<p>But the result is presented in the Terminal. I have no idea how to redirect the result to the browser.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"database/sql\"\n    \"time\"\n    _ \"github.com/lib/pq\"\n)\n\nvar db *sql.DB\n\nfunc main() {\n   Connect()\n   http.HandleFunc(\"/\", Query)\n   log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc Connect() {\n   const (\n   host = \"127.0.0.1\"\n   port = 5432\n   user = \"test\"\n   password = \"test\"\n   dbname  = \"Test\")\n\nlogin := fmt.Sprintf(\"host=%s port=%d user=%s \"+\"password=%s dbname=%s sslmode=require\", host, port, user, password, dbname)\nvar err error\n  db, err = sql.Open(\"postgres\", login)\nif err != nil {\n    log.Fatalln(err)\n}\nerr = db.Ping()\n  if err != nil {\n  panic(err)\n}\n\nfunc Query(w http.ResponseWriter, r *http.Request) {\n\n   var query string\n   switch r.URL.String() {\n   case \"/getuser\":\n      query = \"select * from getuser()\"\n   case \"/getco\":\n      query = \"select * from getco()\"\n   case \"/etc\"\n      query = \"select * from etc\"\n   default:\n      query = \"\"\n   }\n\n  var err error\n  var rows *sql.Rows\n\n  rows, err = db.Query(query)\n  if err != nil {\n      http.Error(w, http.StatusText(500), 500)\n      return\n   }\n  defer rows.Close()\n\n  cols, err := rows.Columns()\n  vals := make([]interface{}, len(cols))\n  for i := 0; i &lt; len(cols); i++ {\n      vals[i] = new(interface{})\n      if i != 0 {\n        fmt.Print(\"\\t\")\n      }\n      fmt.Print(cols[i])\n   }\nfmt.Println()\n\nfor rows.Next() {\n    err = rows.Scan(vals...)\n    if err != nil {\n        fmt.Println(err)\n        continue\n    }\n    for i := 0; i &lt; len(vals); i++ {\n        if i != 0 {\n            fmt.Print(\"\\t\")\n        }\n        printValue(vals[i].(*interface{}))\n    }\n    fmt.Println()\n}\n\n\nfunc printValue(pval *interface{}) {\n    switch v := (*pval).(type) {\n    case nil:\n        fmt.Print(\"NULL\")\n    case bool:\n        if v {\n           fmt.Print(\"1\")\n        } else {\n           fmt.Print(\"0\")\n        }\n    case []byte:\n        fmt.Print(string(v))\n    case time.Time:\n        fmt.Print(v.Format(\"2006-01-02\"))\n    default:\n        fmt.Print(v)\n    }\n }\n</code></pre>\n\n<p>Every attempt to write to the browser gives various type of errors:</p>\n\n<pre><code>fmt.Printf(\"%s\\n\", vals...)\n</code></pre>\n\n<p>My questions are</p>\n\n<ol>\n<li>How do I redirect the result to the browser?</li>\n<li>Is there any better way to achieve this? (reuse generic code)</li>\n</ol>\n"}, {"tags": ["multithreading", "pointers", "go", "maps", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9580712, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AVhJkQpJ_V0/AAAAAAAAAAI/AAAAAAAAACg/Mha5Z5cOoKE/photo.jpg?sz=128", "display_name": "Disco Broccoli", "link": "https://stackoverflow.com/users/9580712/disco-broccoli"}, "edited": false, "score": 0, "creation_date": 1522590005, "post_id": 49594887, "comment_id": 86204502, "body": "Oh I see, what a noob mistake, I&#39;ve even done this in the past, should&#39;ve ran with the race argument, thank you ever so much :)  Sorry about the code snippet, it was late at night and my first time using StackOverflow, I&#39;ll make sure to provide fully working code next time not a random snippet without context."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1522588363, "last_edit_date": 1522588363, "creation_date": 1522557889, "answer_id": 49594887, "question_id": 49594529, "link": "https://stackoverflow.com/questions/49594529/issue-modifying-map-from-goroutine-func/49594887#49594887", "title": "Issue modifying map from goroutine func", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">Package sync</a></p>\n  \n  <p>import \"sync\" </p>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">type WaitGroup</a></p>\n  \n  <p>A WaitGroup waits for a collection of goroutines to finish. The main\n  goroutine calls Add to set the number of goroutines to wait for. Then\n  each of the goroutines runs and calls Done when finished. At the same\n  time, Wait can be used to block until all goroutines have finished.</p>\n</blockquote>\n\n<hr>\n\n<p>You have provided us with a non-working fragment of code. See <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a></p>\n\n<p>As a guess, your use of a <code>sync.WaitGroup</code> looks strange. For example, by simply following the instructions in the sync.Waitgroup documentation, I would expect something more like the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"sync\"\n)\n\nfunc google(string) (string, error) { return \"yes\", nil }\n\nfunc main() {\n    question := \"question?\"\n    answers := []string{\"yes\", \"no\"}\n\n    scores := make(map[string]int)\n    total := 0\n\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n\n        body, _ := google(question)\n        for _, ans := range answers {\n            count := strings.Count(body, ans)\n            total += count\n            scores[ans] += 5 // &lt;-- This does work\n        }\n    }()\n    wg.Wait()\n\n    fmt.Println(scores, total)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/sZmB2Dc5RjL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sZmB2Dc5RjL</a></p>\n\n<p>Output:</p>\n\n<pre><code>map[yes:5 no:5] 1\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9580712, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AVhJkQpJ_V0/AAAAAAAAAAI/AAAAAAAAACg/Mha5Z5cOoKE/photo.jpg?sz=128", "display_name": "Disco Broccoli", "link": "https://stackoverflow.com/users/9580712/disco-broccoli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 1, "accepted_answer_id": 49594887, "answer_count": 1, "score": 1, "last_activity_date": 1522588363, "creation_date": 1522553424, "last_edit_date": 1522586533, "question_id": 49594529, "link": "https://stackoverflow.com/questions/49594529/issue-modifying-map-from-goroutine-func", "title": "Issue modifying map from goroutine func", "body": "<pre><code>scores := make(map[string]int)\npercentage := make(map[string]float64)\ntotal := 0\n\nfor i, ans := range answers {\n    answers[i] = strings.ToLower(ans)\n}\n\nwg := sync.WaitGroup{}\n\ngo func() {\n    wg.Add(1)\n\n    body, _ := google(question)\n\n    for _, ans := range answers {\n        count := strings.Count(body, ans)\n        total += count\n        scores[ans] += 5 // &lt;------------------- This doesn't work\n    }\n\n    wg.Done()\n}()\n</code></pre>\n\n<p>Here's a snippet of code, my issue is, that I am unable to modify the scores, I've tried using pointers, I've tried doing it normally, I've tried passing it as a parameter.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1522575442, "post_id": 49594280, "comment_id": 86200616, "body": "No, not possible. This seems like an XY problem. What is your real goal?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1522687445, "post_id": 49594280, "comment_id": 86236835, "body": "Consider this: the assignment of return values happens <i>after the function returns</i>. Therefor, there would be no way at runtime for the function to know what will happen after it returns."}], "answers": [{"tags": [], "owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "is_accepted": true, "score": 1, "last_activity_date": 1522571493, "creation_date": 1522571493, "answer_id": 49596268, "question_id": 49594280, "link": "https://stackoverflow.com/questions/49594280/how-to-detect-ignored-return-values/49596268#49596268", "title": "How to detect ignored return values", "body": "<p>You can't do that and it is also not a good design. You can check from which function it was called using reflection and see if that function is using the orm variable or not.</p>\n\n<p><a href=\"https://golang.org/pkg/runtime/#Caller\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/#Caller</a></p>\n\n<p>Go uses connection pool and if you are worried about the open connection, you may use timeout for each connection made.</p>\n"}], "owner": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 49596268, "answer_count": 1, "score": -1, "last_activity_date": 1522571493, "creation_date": 1522550155, "question_id": 49594280, "link": "https://stackoverflow.com/questions/49594280/how-to-detect-ignored-return-values", "title": "How to detect ignored return values", "body": "<p>Given the following function:</p>\n\n<pre><code>func CreateDB() (*xorm.Engine orm, error) {\n\n}\n</code></pre>\n\n<p>I want to detect within that function whether it was called like this:</p>\n\n<pre><code>_, err := CreateDB()\n</code></pre>\n\n<p>...or like this:</p>\n\n<pre><code>orm, err := CreateDB()\n</code></pre>\n\n<p>I want to check the <code>orm</code> variable and close the connection if it's not required. Is this possible?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1522554978, "post_id": 49594259, "comment_id": 86196735, "body": "Read an existing image from where?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5637652"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1522555506, "post_id": 49594259, "comment_id": 86196807, "body": "from Image in the Directory"}], "answers": [{"comments": [{"owner": {"reputation": 1202, "user_id": 5032550, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/6MWmL.jpg?s=128&g=1", "display_name": "Luis Cabrera Benito", "link": "https://stackoverflow.com/users/5032550/luis-cabrera-benito"}, "edited": false, "score": 1, "creation_date": 1612838034, "post_id": 49595208, "comment_id": 116885759, "body": "Don&#39;t forget to import &quot;image&quot;, &quot;image/png&quot; and &quot;image/jpeg&quot;. This way: <code>import (\t&quot;image&quot; \t_ &quot;image&#47;jpeg&quot; \t_ &quot;image&#47;png&quot; )</code>"}], "tags": [], "owner": {"reputation": 61, "user_id": 9185113, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qjcu8aNPCSg/AAAAAAAAAAI/AAAAAAAAACg/dRP-h2qhULA/photo.jpg?sz=128", "display_name": "Helen Lazar", "link": "https://stackoverflow.com/users/9185113/helen-lazar"}, "is_accepted": false, "score": 6, "last_activity_date": 1614163847, "last_edit_date": 1614163847, "creation_date": 1522561885, "answer_id": 49595208, "question_id": 49594259, "link": "https://stackoverflow.com/questions/49594259/reading-image-in-go/49595208#49595208", "title": "Reading Image in Go", "body": "<p>Something like this:</p>\n<pre><code>func getImageFromFilePath(filePath string) (image.Image, error) {\n    f, err := os.Open(filePath)\n    if err != nil {\n        return nil, err\n    }\n    defer f.Close()\n    image, _, err := image.Decode(f)\n    return image, err\n}\n</code></pre>\n<p>references</p>\n<ul>\n<li><a href=\"https://golang.org/pkg/image/#Decode\" rel=\"nofollow noreferrer\">https://golang.org/pkg/image/#Decode</a></li>\n<li><a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#Open</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 4457657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n47QQ.jpg?s=128&g=1", "display_name": "Salim Ahmed", "link": "https://stackoverflow.com/users/4457657/salim-ahmed"}, "is_accepted": false, "score": 1, "last_activity_date": 1522567833, "last_edit_date": 1522567833, "creation_date": 1522567324, "answer_id": 49595770, "question_id": 49594259, "link": "https://stackoverflow.com/questions/49594259/reading-image-in-go/49595770#49595770", "title": "Reading Image in Go", "body": "<p>try this: </p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"image\"\n  \"image/png\"\n  \"os\"\n)\n\nfunc main() {\n  // Read image from file that already exists\n  existingImageFile, err := os.Open(\"test.png\")\n  if err != nil {\n    // Handle error\n  } \n\n  defer existingImageFile.Close()\n\n  // Calling the generic image.Decode() will tell give us the data\n  // and type of image it is as a string. We expect \"png\"\n  imageData, imageType, err := image.Decode(existingImageFile)\n  if err != nil {\n    // Handle error\n  }\n  fmt.Println(imageData)\n  fmt.Println(imageType)\n\n  // We only need this because we already read from the file\n  // We have to reset the file pointer back to beginning\n  existingImageFile.Seek(0, 0)\n\n  // Alternatively, since we know it is a png already\n  // we can call png.Decode() directly\n  loadedImage, err := png.Decode(existingImageFile)\n  if err != nil {\n    // Handle error\n    }\n  fmt.Println(loadedImage)\n }\n</code></pre>\n\n<p>references</p>\n\n<ul>\n<li><a href=\"https://www.devdungeon.com/content/working-images-go\" rel=\"nofollow noreferrer\">https://www.devdungeon.com/content/working-images-go</a></li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5637652"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3848, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1614163847, "creation_date": 1522549848, "last_edit_date": 1522550041, "question_id": 49594259, "link": "https://stackoverflow.com/questions/49594259/reading-image-in-go", "title": "Reading Image in Go", "body": "<pre><code>func (sticky *Sticky) DrawImage(W, H int) (img *image, err error) {\n\n    myImage := image.NewRGBA(image.Rect(0, 0, 10, 25))\n    myImage.Pix[0] = 55 // 1st pixel red\n    myImage.Pix[1] = 155 // 1st pixel green\n    return myImage ,nil\n}\n</code></pre>\n\n<p>I am creating an image. I want to read the existing Image and return in this Function. How I can I do that?</p>\n"}, {"tags": ["go", "jna", "cgo"], "comments": [{"owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1522562705, "post_id": 49594219, "comment_id": 86197831, "body": "Can you comment the <code>defer</code> call in <code>passBackHello</code> function and try again? The reason I&#39;m seeing is that it is being freed after the assignment. But, technically, you should be freeing it in your <code>main</code> (as you&#39;re already doing) that means it is a dangling pointer. Can you confirm that please?"}, {"owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1522563059, "post_id": 49594219, "comment_id": 86197905, "body": "Another thing is that that <code>C.CString</code> allocates the memory and return the pointer so you don&#39;t need that <code>buf</code> in <code>main</code>. The pointer is enough and it&#39;ll be pointing to the string. You just have to free it after use. See: <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>."}, {"owner": {"reputation": 95, "user_id": 2058478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbe504bbfb1baa1c1491f42de7aa30f4?s=128&d=identicon&r=PG", "display_name": "Phil", "link": "https://stackoverflow.com/users/2058478/phil"}, "reply_to_user": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1522565862, "post_id": 49594219, "comment_id": 86198473, "body": "cString in passBackHello has no pointer accessible from func main.  So C.free needed to be done in passBackHello .  However, does &quot;*buf = C.CString(str)&quot; leave behind a C string allocation?  In not, there&#39;s no need for a C.free."}, {"owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1522566732, "post_id": 49594219, "comment_id": 86198687, "body": "I&#39;m not quite sure that I got that. You&#39;re returning a string in <code>buf</code> which is then received in <code>main</code> and it should be freed there. Isn&#39;t that so? And, when you do <code>defer C.free(unsafe.Pointer(cString))</code>,  it frees the memory which is pointed to by <code>buf</code> after assignment. Can you run it without the <code>defer</code> statement?"}, {"owner": {"reputation": 9055, "user_id": 996081, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/83817dc1e83cf8ac372b21cd5f010bc4?s=128&d=identicon&r=PG&f=1", "display_name": "cbr", "link": "https://stackoverflow.com/users/996081/cbr"}, "edited": false, "score": 1, "creation_date": 1522736626, "post_id": 49594219, "comment_id": 86253998, "body": "To free the string from the Java side after you&#39;re done with the string, I suggest you create a Go function which takes a pointer and frees it. Then you just call this function from the Java side. Sure, you could just directly call <code>free</code> from via JNA, but theoretically cgo might use a different memory allocator in the case of which you might have undesired consequences."}], "answers": [{"tags": [], "owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "is_accepted": true, "score": 0, "last_activity_date": 1522730594, "last_edit_date": 1522730594, "creation_date": 1522563419, "answer_id": 49595330, "question_id": 49594219, "link": "https://stackoverflow.com/questions/49594219/how-do-i-pass-c-char-data-back-to-callers-buffer/49595330#49595330", "title": "How do I pass **C.char data back to caller&#39;s buffer?", "body": "<p>According to the documentation of <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\"><code>C.CString</code></a> function:</p>\n\n<pre><code>// Go string to C string\n// The C string is allocated in the C heap using malloc.\n// It is the caller's responsibility to arrange for it to be\n// freed, such as by calling C.free (be sure to include stdlib.h\n// if C.free is needed).\nfunc C.CString(string) *C.char\n</code></pre>\n\n<p>You don't need to free it in your function. It is the caller (i.e. <code>main</code> function in your case) that is supposed to free it.</p>\n\n<p>Remove the line <code>defer C.free(unsafe.Pointer(cString))</code> from your <code>passBackHello</code> and it should work!</p>\n\n<p><strong>NOTE</strong>:<br>\nYou don't need that buffer (i.e. <code>buf</code>) because it's the pointer that is being returned and the memory is already allocated. You may copy it in your buffer if required and free the pointer.</p>\n"}], "owner": {"reputation": 95, "user_id": 2058478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbe504bbfb1baa1c1491f42de7aa30f4?s=128&d=identicon&r=PG", "display_name": "Phil", "link": "https://stackoverflow.com/users/2058478/phil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 49595330, "answer_count": 1, "score": 0, "last_activity_date": 1525063410, "creation_date": 1522549356, "last_edit_date": 1525063410, "question_id": 49594219, "link": "https://stackoverflow.com/questions/49594219/how-do-i-pass-c-char-data-back-to-callers-buffer", "title": "How do I pass **C.char data back to caller&#39;s buffer?", "body": "<p>I am going to build a Go shared object binary (.DLL and .so) that passes back a string to Java. To work out the C string passing from Go I wrote this: </p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdlib.h&gt;\n*/\nimport \"C\"\nimport (\n    \"log\"\n    \"unsafe\"\n)\n\n//export passBackHello\nfunc passBackHello(buf **C.char) C.int {\n    str := \"Hello World!\"\n    length := len(str)\n    cString := C.CString(str) // returns *C.char\n    defer C.free(unsafe.Pointer(cString))\n    log.Println(\"In passBackHello: cString:\", C.GoStringN(cString, C.int(length)))\n    *buf = C.CString(str) // works\n    *buf = cString        // doesn't work\n    log.Println(\"In passBackHello: buf:\", C.GoStringN(*buf, C.int(length)))\n\n    return C.int(length)\n}\n\nfunc main() {\n    buf := make([]byte, 8192) //create my buffer\n    cStrPointer := (**C.char)(unsafe.Pointer(&amp;buf[0]))\n    defer C.free(unsafe.Pointer(cStrPointer))\n    lengthCint := passBackHello(cStrPointer)\n    log.Println(\"In main: length:\", int(lengthCint))\n    log.Println(\"In main: buf:\", C.GoStringN(*cStrPointer, lengthCint))\n    log.Println(\"In main: buf:\", C.GoString(*cStrPointer))\n}\n</code></pre>\n\n<p>When I use <code>*buf = C.CString(str)</code> in function <code>passBackHello</code> it works:</p>\n\n<pre><code>2018/03/31 19:33:54 In passBackHello: cString: Hello World!\n2018/03/31 19:33:54 In passBackHello: buf: Hello World!\n2018/03/31 19:33:54 In main: length: 12\n2018/03/31 19:33:54 In main: buf: Hello World!\n2018/03/31 19:33:54 In main: buf: Hello World!\nexit status 3221226356\n</code></pre>\n\n<p>When I use <code>*buf = cStringPointer</code> in function <code>passBackHello</code> it shows in <code>buf</code> while in <code>passBackHello</code> but not in <code>main</code>:</p>\n\n<pre><code>2018/03/31 19:33:05 In passBackHello: cString: Hello World!\n2018/03/31 19:33:05 In passBackHello: buf: Hello World!\n2018/03/31 19:33:05 In main: length: 12\n2018/03/31 19:33:05 In main: buf:  \u23023     X\u263a\ufffd\n2018/03/31 19:33:05 In main: buf:  \u23023\nexit status 3221226356\n</code></pre>\n\n<p>I need to get the <code>*buf = cStringPointer</code> version to work because that one has the <code>C.free</code> of the C string variable. I am running go version go1.10.1 windows/amd64.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>After applying <a href=\"https://stackoverflow.com/users/7670262/azeem\">Azeem</a>'s answer and some other cleanup the working Go code looks like this:</p>\n\n<pre><code>//export passBackHello\nfunc passBackHello(cStrPointer **C.char) C.int {\n    str := \"Hello World!\"\n    length := len(str)\n    *cStrPointer = C.CString(str) // copies *C.char into caller's buffer\n    log.Println(\"In passBackHello *cStrPointer:\", C.GoStringN(*cStrPointer, C.int(length)))\n    return C.int(length)\n}\n\nfunc main() {\n    buf := make([]byte, 8192) //create my buffer\n    cStrPointer := (**C.char)(unsafe.Pointer(&amp;buf[0]))\n    defer C.free(unsafe.Pointer(cStrPointer))\n    lengthCint := passBackHello(cStrPointer)\n    log.Println(\"In main: length:\", int(lengthCint))\n    log.Println(\"In main: *cStrPointer:\", C.GoStringN(*cStrPointer, lengthCint))\n    log.Println(\"In main: *cStrPointer:\", C.GoString(*cStrPointer))\n}\n</code></pre>\n\n<p>And just to be complete the Java caller looks like this:</p>\n\n<pre><code>// allocate a void**\nfinal PointerByReference decCStringPointer = new PointerByReference();\n// call the C function\nInteger decLength = gpg.passBackHello(decCStringPointer);\n// extract the void* that was allocated in C\nfinal Pointer p = decCStringPointer.getValue();\n// extract the null-terminated string from the Pointer\nfinal String decValue = p.getString(0);\nSystem.out.printf(\"decrypted length: %d\\n\", decLength);\nSystem.out.printf(\"decrypted value: %s\\n\", decValue);\n</code></pre>\n\n<p>It looks like the buffer is in C memory. How do I free it from Java?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1522546435, "creation_date": 1522546435, "answer_id": 49594003, "question_id": 49593861, "link": "https://stackoverflow.com/questions/49593861/golang-const-unsafe-sizeof/49594003#49594003", "title": "Golang const unsafe.Sizeof", "body": "<p>It's explained in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">specification</a>.</p>\n\n<p>Package unsafe is implemented in the compiler. The expression <a href=\"https://golang.org/ref/spec#Package_unsafe\" rel=\"nofollow noreferrer\"><code>unsafe.Sizeof(uint64(0))</code> can be evaluated at compile time</a>. It is a <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a>.</p>\n\n<p>The function plain function call <code>binary.Size(uint64(0))</code> cannot be evaluated at compile time. It is not <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">constant expression</a>.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Constant_declarations\" rel=\"nofollow noreferrer\">Constant declarations require a constant expression</a>.</p>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 49594003, "answer_count": 1, "score": 0, "last_activity_date": 1522546435, "creation_date": 1522544401, "question_id": 49593861, "link": "https://stackoverflow.com/questions/49593861/golang-const-unsafe-sizeof", "title": "Golang const unsafe.Sizeof", "body": "<p>Don't understand why I can do</p>\n\n<pre><code>const OK = uint64(0)\n\nconst OK = int(unsafe.Sizeof(uint64(0)))\n</code></pre>\n\n<p>but not this?</p>\n\n<pre><code>const NOK = binary.Size(uint64(0))\n</code></pre>\n"}, {"tags": ["docker", "nginx", "go"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1522563240, "post_id": 49593850, "comment_id": 86197929, "body": "You should use the base url in golang as well to avoid problems. Then you should change <code>baseRouter := mux.NewRouter()</code> to <code>baseRouter := mux.NewRouter().PathPrefix(&quot;&#47;myapp&quot;)</code> And also change <code>proxy_pass http:&#47;&#47;myapp:5600&#47;;</code> to <code>proxy_pass http:&#47;&#47;myapp:5600;</code> in your nginx so the <code>&#47;myapp</code> is also sent to the golang server"}, {"owner": {"reputation": 147, "user_id": 1619594, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90eca0e491c69d81b1770497f985b4ba?s=128&d=identicon&r=PG", "display_name": "tamasfe", "link": "https://stackoverflow.com/users/1619594/tamasfe"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1522591647, "post_id": 49593850, "comment_id": 86204914, "body": "Yeah, thanks I&#39;ve got it now. Protip for anyone else struggling with things like these: delete your browser cache, or disable it entirely... Apparently my requests didn&#39;t even reach the server, as for some reason firefox did its black magic."}], "answers": [{"tags": [], "owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "is_accepted": false, "score": 1, "last_activity_date": 1522570308, "creation_date": 1522570308, "answer_id": 49596123, "question_id": 49593850, "link": "https://stackoverflow.com/questions/49593850/go-server-with-nginx-reverse-proxy/49596123#49596123", "title": "Go server with nginx reverse proxy", "body": "<p>Your nginx configuration is perfectly fine.</p>\n\n<p>The path you mentioned (/myapp/something) will show you 404 because you have not registered that in your routes.</p>\n\n<p>I would suggest that if you wish to host multiple applications using the same domain, prefer using subdomains (myapp1.mydomain.com) instead of path (mydomain.com/myapp1).</p>\n\n<p>For each subdomain, you can create a separate nginx server block by changing the server_name value only and keeping the rest of the nginx server file the same.</p>\n\n<p>Then, while using middleware, you may filter out the domains and provide the requested resource.</p>\n"}, {"tags": [], "owner": {"reputation": 823, "user_id": 3807226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/968fa2c7813b5007f1099a0d1d23e75f?s=128&d=identicon&r=PG&f=1", "display_name": "Chun Liu", "link": "https://stackoverflow.com/users/3807226/chun-liu"}, "is_accepted": true, "score": 3, "last_activity_date": 1522570781, "creation_date": 1522570781, "answer_id": 49596195, "question_id": 49593850, "link": "https://stackoverflow.com/questions/49593850/go-server-with-nginx-reverse-proxy/49596195#49596195", "title": "Go server with nginx reverse proxy", "body": "<p>Your nginx looks fine to me. </p>\n\n<p>In your Go code, when you create your router, you may use the myapp as the PathPrefix like below: </p>\n\n<pre><code>baseRouter := mux.NewRouter()\nsubRouter := baseRouter.PathPrefix(\"/myapp\").Subrouter()\nsubRouter.HandleFunc(\"/something\", routes.SomeHandler).Methods(\"GET\")\n</code></pre>\n\n<p>Or simply add myapp to the path: <code>baseRouter.HandleFunc(\"/myapp/something\", routes.SomeHandler).Methods(\"GET\")</code></p>\n"}], "owner": {"reputation": 147, "user_id": 1619594, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/90eca0e491c69d81b1770497f985b4ba?s=128&d=identicon&r=PG", "display_name": "tamasfe", "link": "https://stackoverflow.com/users/1619594/tamasfe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 1, "accepted_answer_id": 49596195, "answer_count": 2, "score": 1, "last_activity_date": 1522570781, "creation_date": 1522544281, "question_id": 49593850, "link": "https://stackoverflow.com/questions/49593850/go-server-with-nginx-reverse-proxy", "title": "Go server with nginx reverse proxy", "body": "<p>I've been trying to set up a go web application with docker and nginx as a reverse proxy.</p>\n\n<p>My plan is to use a single domain for multiple applications e.g.: <code>mydomain.com/myapp1</code>.</p>\n\n<p>However whenever I try to access my app in with an url like <code>localhost/myapp/something</code>, the request is redirected to <code>http://localhost/something</code>. </p>\n\n<p>I've gone through all kinds of nginx configs, none of them worked, so I suspect that the problem is on the go side.</p>\n\n<p>In the app itself, I'm using gorilla mux for routing, and also negroni for some middleware.</p>\n\n<p>The relevant code looks something like this:</p>\n\n<pre><code>baseRouter := mux.NewRouter()\nbaseRouter.HandleFunc(\"/something\", routes.SomeHandler).Methods(\"GET\")\nbaseRouter.HandleFunc(\"/\", routes.IndexHandler).Methods(\"GET\")\n\ncommonMiddleware := negroni.New(\n    negroni.HandlerFunc(middleware.Debug),\n)\n\ncommonMiddleware.UseHandler(baseRouter)\nlog.Fatal(http.ListenAndServe(\":5600\", commonMiddleware))\n</code></pre>\n\n<p>According to this, every request should go through my debug middleware, which just prints some request info to stdout, however when the redirects happen, it doesn't work.</p>\n\n<p>But if the path doesn't match any handlers, everything works just fine, the standard go 404 message appears as expected, and the request is printed by the debug middleware as well.</p>\n\n<p>My GET handlers generally only do something like this: </p>\n\n<pre><code>templ, _ := template.ParseFiles(\"public/something.html\")\ntempl.Execute(w, utils.SomeTemplate{\n    Title: \"something\",\n})\n</code></pre>\n\n<p>And finally, the relevant part in my nginx config:</p>\n\n<pre><code>server {\n    listen 80;\n    server_name localhost;\n\n    location /myapp/ {\n        # address \"myapp\" is set by docker-compose\n        proxy_pass http://myapp:5600/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP  $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n</code></pre>\n\n<p>This kind of nginx config used to be enough for nodeJS apps in the past, so I don't understand why it wouldn't work. If anyone could point out what the hell I'm doing wrongly, I would appreciate it a lot.</p>\n"}, {"tags": ["go", "marathon", "traefik"], "comments": [{"owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "edited": false, "score": 0, "creation_date": 1522572257, "post_id": 49593575, "comment_id": 86199878, "body": "It surprises me that &quot;traefik.frontend.rule=Host:web.myblog.com;PathPrefix:/&quot; didn&#39;t work for you. As you wrote in your own answer, Traefik does longest path matching. Thus, any request with an <code>&#47;app</code> prefix should reach app 2 while any request missing that prefix should reach app 1. If that doesn&#39;t work, there might be a bug (or I&#39;m remembering the behavior incorrectly)."}, {"owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "edited": false, "score": 0, "creation_date": 1522572415, "post_id": 49593575, "comment_id": 86199909, "body": "I just edited your post as it used the <code>app</code> host in the initial paragraph but <code>myblog</code> later. Hope my fix was correct, if not let me know."}, {"owner": {"reputation": 17692, "user_id": 867294, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcb041f273e31f7f8b4f635fba685060?s=128&d=identicon&r=PG", "display_name": "Willem D&#39;Haeseleer", "link": "https://stackoverflow.com/users/867294/willem-dhaeseleer"}, "reply_to_user": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "edited": false, "score": 0, "creation_date": 1522605457, "post_id": 49593575, "comment_id": 86209140, "body": "It&#39;s the actual syntactic lenth of the rule. Rule 1 uses a regex for part of the rule so it&#39;s longer in total."}, {"owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "edited": false, "score": 0, "creation_date": 1522616732, "post_id": 49593575, "comment_id": 86212405, "body": "I was referring to the updated rule you mentioned in the paragraph starting with &quot;I also tried specifying a path prefix for app 1 like so [...]&quot;. With that, the difference between the rules for app 1 and app 2 seems to boil down to the path value."}], "answers": [{"tags": [], "owner": {"reputation": 17692, "user_id": 867294, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcb041f273e31f7f8b4f635fba685060?s=128&d=identicon&r=PG", "display_name": "Willem D&#39;Haeseleer", "link": "https://stackoverflow.com/users/867294/willem-dhaeseleer"}, "is_accepted": true, "score": 0, "last_activity_date": 1522625228, "last_edit_date": 1522625228, "creation_date": 1522547577, "answer_id": 49594096, "question_id": 49593575, "link": "https://stackoverflow.com/questions/49593575/multi-path-routing-with-traefik-marathon-on-the-same-host/49594096#49594096", "title": "Multi path routing with traefik marathon on the same host", "body": "<p>If multiple rules match traefic will use the length of the rule to determine which rule is most specific instead of the actual specificity. You can override this artificial priority by using</p>\n\n<p><code>traefik.frontend.priority=1000</code></p>\n\n<p>More info:\n<a href=\"https://github.com/containous/traefik/issues/1663\" rel=\"nofollow noreferrer\">https://github.com/containous/traefik/issues/1663</a></p>\n"}, {"comments": [{"owner": {"reputation": 17692, "user_id": 867294, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcb041f273e31f7f8b4f635fba685060?s=128&d=identicon&r=PG", "display_name": "Willem D&#39;Haeseleer", "link": "https://stackoverflow.com/users/867294/willem-dhaeseleer"}, "edited": false, "score": 0, "creation_date": 1522713300, "post_id": 49619259, "comment_id": 86247555, "body": "you aren&#39;t using a regex for the first route. The regex caused the rule to be longer and takes precedence as a result. Your second rule is 3 characters longer and that&#39;s why it&#39;s working, not related to the PathPrefix."}, {"owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "reply_to_user": {"reputation": 17692, "user_id": 867294, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcb041f273e31f7f8b4f635fba685060?s=128&d=identicon&r=PG", "display_name": "Willem D&#39;Haeseleer", "link": "https://stackoverflow.com/users/867294/willem-dhaeseleer"}, "edited": false, "score": 0, "creation_date": 1522744656, "post_id": 49619259, "comment_id": 86258240, "body": "That&#39;s right. I was responding to this statement from your SO question (<b>emphasis</b> by me): <i>I also tried specifying a path prefix for app 1 like so traefik.frontend.rule=Host:web.myblog.com;PathPrefix:/ <b>but this has no effect</b></i>. I was trying to demonstrate that it did make a difference for me compared to the original regex/no-regex rule mix."}], "tags": [], "owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "is_accepted": false, "score": 0, "last_activity_date": 1522705590, "creation_date": 1522705590, "answer_id": 49619259, "question_id": 49593575, "link": "https://stackoverflow.com/questions/49593575/multi-path-routing-with-traefik-marathon-on-the-same-host/49619259#49619259", "title": "Multi path routing with traefik marathon on the same host", "body": "<p>If I adjust the rule for app 1 to</p>\n\n<pre><code>traefik.frontend.rule=Host:web.myblog.com;PathPrefix:/\n</code></pre>\n\n<p>per one of your attempts, and stick with</p>\n\n<pre><code>traefik.frontend.rule=Host:web.myblog.com;PathPrefix:/app\n</code></pre>\n\n<p>on app 2, the routing behavior seems to be as expected: Requests with the <code>web.myblog.com</code> host and an <code>/app</code> path go to app 2 exclusively and deterministically (because Traefik employs longest-path matching). If I modify the request to use the root path <code>/</code> (or any path other than <code>/app</code> as they will all hold the matching root path prefix), traffic is forwarded to app 1.</p>\n\n<p>I tested against Marathon 1.3.10.</p>\n"}], "owner": {"reputation": 17692, "user_id": 867294, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcb041f273e31f7f8b4f635fba685060?s=128&d=identicon&r=PG", "display_name": "Willem D&#39;Haeseleer", "link": "https://stackoverflow.com/users/867294/willem-dhaeseleer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2487, "favorite_count": 0, "accepted_answer_id": 49594096, "answer_count": 2, "score": 0, "last_activity_date": 1522705590, "creation_date": 1522540632, "last_edit_date": 1522572337, "question_id": 49593575, "link": "https://stackoverflow.com/questions/49593575/multi-path-routing-with-traefik-marathon-on-the-same-host", "title": "Multi path routing with traefik marathon on the same host", "body": "<p>I have two apps running on marathon.<br>\nI want <code>web.myblog.com</code> to route to App 1, and <code>web.myblog.com/app</code> to route to app2.</p>\n\n<p>With the below config, all traffic is going to app 1.</p>\n\n<pre><code>App 1  \ntraefik.frontend.rule=HostRegexp:{subdomain:[a-z]+}.myblog.com\n\nApp 2  \ntraefik.frontend.rule=Host:web.myblog.com;PathPrefix:/app\n</code></pre>\n\n<p>I tried using negative matching to exclude /app routing for app 1, but it is my understanding that negative lookahead isn't fully supported in golang and by result also not in traefik.</p>\n\n<p>I also tried specifying a path prefix for app 1 like so \n<code>traefik.frontend.rule=Host:web.myblog.com;PathPrefix:/</code> but this has no effect. </p>\n\n<p>When I modify the rule for App 1 to point to <code>Host:test.myblog.com</code> all traffic goes to app 2 correctly, From that I conclude that the routing config to App 2 is correct, it is just being ignored because App 1 supersedes it since it also satisfies the route.</p>\n\n<p>This issue is discussing this exact use case:<br>\n<a href=\"https://github.com/containous/traefik/issues/419#issuecomment-223843103\" rel=\"nofollow noreferrer\">https://github.com/containous/traefik/issues/419#issuecomment-223843103</a></p>\n\n<p>But it looks like a config without pathPrefix takes precedence over a config with pathPrefix, maybe this type of config is simply not supported on the marathon backend ?</p>\n\n<p>It's not clear to me from this documentation:<br>\n<a href=\"https://github.com/fclaeys/traefik/blob/master/docs/basics.md\" rel=\"nofollow noreferrer\">https://github.com/fclaeys/traefik/blob/master/docs/basics.md</a>.</p>\n\n<p>Looking for an answer that will help me understand whether this use case is supported at all on the marathon backend, or an example working config for it.</p>\n\n<p>Using Traefik v1.5.1</p>\n"}, {"tags": ["go", "networking", "server", "client", "deadlock"], "comments": [{"owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522540384, "post_id": 49593231, "comment_id": 86194624, "body": "I&#39;m starting to suspect this is is because the client doesn&#39;t notify the server that the message it sent is over. I&#39;m not sure how to go about testing this theory. A thread suggested adding a newline to the message, but that did not work."}], "answers": [{"comments": [{"owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522541928, "post_id": 49593562, "comment_id": 86194882, "body": "Ah thank you, I was using <code>ioutil.ReadAll</code> as a convenience to avoid making a buffer. I was able to fix the problem by simply removing the call to that in the server and directly using <code>conn.Read()</code>, which returns after the message is sent from the client instead of waiting for more."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522542280, "post_id": 49593562, "comment_id": 86194940, "body": "@jeanluc conn.Read() can return before the entire message is received."}, {"owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522542651, "post_id": 49593562, "comment_id": 86194998, "body": "Yes that could be a problem, but since I&#39;m only using this as a test scaffold and know the max size, it should be fine. In production, sockets will be wrapped with <code>gob</code> which I think takes care of message size"}, {"owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522542754, "post_id": 49593562, "comment_id": 86195018, "body": "But since readers of this question most likely won&#39;t know the max size if they&#39;re having a similar problem, the suggestions you gave are good"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "edited": false, "score": 0, "creation_date": 1522546092, "post_id": 49593562, "comment_id": 86195450, "body": "Knowing the max size make it possible to slurp up the entire message in a single call to Read, but it does not guarantee that it will slurp up the entire message.  Read returns when data is available. That may or may not have any relationship to the calls to Write by the peer.  You will be covered if you use gob because the gob encoder frames values."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1522541307, "last_edit_date": 1522541307, "creation_date": 1522540438, "answer_id": 49593562, "question_id": 49593231, "link": "https://stackoverflow.com/questions/49593231/apparent-deadlock-between-server-and-client/49593562#49593562", "title": "Apparent deadlock between server and client", "body": "<p>The program blocks on the call to ioutil.ReadAll. This function reads until io.EOF or some other error is returned.</p>\n\n<p>One fix is to shutdown write after writing data to the connection. This will cause read on the peer to return io.EOF and for ioutil.ReadAll to return successfully.</p>\n\n<pre><code>    conn.Write(data)\n    cw, ok := conn.(interface{ CloseWrite() error })\n    if !ok {\n        // handle error\n    }\n    cw.CloseWrite()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/QUAf7LO8osM\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>The program in the question does not guarantee that the listener is opened before the connection is dialed or that client will print print the received message. The playground example corrects these issues.</p>\n\n<p>Another approach is to frame the messages in some way:</p>\n\n<ul>\n<li>Write newline or some other byte sequence not allowed in message after message.  Read until this byte sequence is found.</li>\n<li>Write message length before message. Read length and then specified number of bytes.</li>\n</ul>\n"}], "owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 49593562, "answer_count": 1, "score": 0, "last_activity_date": 1522541307, "creation_date": 1522537195, "question_id": 49593231, "link": "https://stackoverflow.com/questions/49593231/apparent-deadlock-between-server-and-client", "title": "Apparent deadlock between server and client", "body": "<p>I have a test function which both creates a server and spawns a goroutine acting as a client. Now, simply sending a message from the client to the server works, but if I want to create an exchange, they seem to deadlock since the test never runs to completion (if no r/w deadlines are set). For example, I want the client to send a message to the server, the server to copy that message and send it back to the client, and then the client to verify that the received message was identical. Here is my test code:</p>\n\n<pre><code>func TestSendAwait(t *testing.T) {\n    m := \"Hello World\"\n\n    go func() {\n        conn, err := net.Dial(\"tcp\", testingAddr)\n        if err != nil {\n            t.Fatal(err)\n        }\n        defer conn.Close()\n        t.Log(\"client connected to server\") // DEBUG\n\n        conn.SetDeadline(time.Now().Add(2 * time.Second))\n        conn.Write([]byte(m))\n\n        conn.SetDeadline(time.Now().Add(2 * time.Second))\n        buf, err := ioutil.ReadAll(conn)\n        if err != nil {\n            t.Fatal(err)\n        }\n        t.Log(string(buf))\n    }()\n\n    ln, err := net.Listen(\"tcp\", testingAddr)\n    if err != nil {\n        t.Fatal(err)\n    }\n    defer ln.Close()\n    t.Log(\"server started\") // DEBUG\n\n    conn, err := ln.Accept()\n    if err != nil {\n        t.Fatal(err)\n    }\n    defer conn.Close()\n    t.Log(\"server received connection\") // DEBUG\n\n    buf, err := ioutil.ReadAll(conn)\n    if err != nil {\n        t.Fatal(err)\n    }\n    t.Logf(\"server read buffer: %v\", buf) // DEBUG\n\n    _, err = conn.Write(buf)\n    if err != nil {\n        t.Fatal(err)\n    }\n    t.Log(\"server wrote to connection\") // DEBUG\n}\n</code></pre>\n\n<p>The deadlines are set on the connection because otherwise the deadlock would be indefinite. The output is as follows:</p>\n\n<pre><code>    transmission_test.go:42: server started\n    transmission_test.go:24: client connected to server\n    transmission_test.go:49: server received connection\n    transmission_test.go:32: read tcp 127.0.0.1:41164-&gt;127.0.0.1:9090: i/o timeout\n    transmission_test.go:55: server read buffer: [72 101 108 108 111 32 87 111 114 108 100]\n    transmission_test.go:61: server wrote to connection\n\nProcess finished with exit code 1\n</code></pre>\n\n<p>I don't understand why the client is unable to read and exits, and only then the server decides to send data down the socket? This happens even if I increase the read deadline in the client.</p>\n"}, {"tags": ["go", "go-pg"], "answers": [{"comments": [{"owner": {"reputation": 214, "user_id": 4186181, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/RyB2K.jpg?s=128&g=1", "display_name": "rhymes", "link": "https://stackoverflow.com/users/4186181/rhymes"}, "edited": false, "score": 0, "creation_date": 1522575058, "post_id": 49593544, "comment_id": 86200519, "body": "Thank you @fl0cke, that is very clear. It&#39;s weird to me that in such a big community I found very little information about this. I will adapt your example to go-pg and let you know."}, {"owner": {"reputation": 136, "user_id": 1665820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5099c7123f112cf4ccf9cdab627f116?s=128&d=identicon&r=PG", "display_name": "shanab", "link": "https://stackoverflow.com/users/1665820/shanab"}, "edited": false, "score": 1, "creation_date": 1531398449, "post_id": 49593544, "comment_id": 89587885, "body": "Thanks @fl0cke. I personally think it&#39;s better that the <code>Store</code> type only uses executor, instead of having db and executor. Inside <code>RunInTransaction</code> you can typecast executor to *sql.DB. This way it&#39;s guaranteed that users use <code>executor</code> inside the store functions instead of accidentally using <code>db</code>."}], "tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": false, "score": 3, "last_activity_date": 1522540992, "last_edit_date": 1522540992, "creation_date": 1522540293, "answer_id": 49593544, "question_id": 49592934, "link": "https://stackoverflow.com/questions/49592934/wrapping-a-db-object-in-go-and-running-two-methods-in-the-same-transaction/49593544#49593544", "title": "Wrapping a db object in Go and running two methods in the same transaction", "body": "<p>I've done something like this in the past (using the standard <code>sql</code> package, you may need to adapt it to your needs):</p>\n\n<pre><code>var ErrNestedTransaction = errors.New(\"nested transactions are not supported\")\n\n// abstraction over sql.TX and sql.DB\n// a similar interface seems to be already defined in go-pg. So you may not need this. \ntype executor interface {\n    Exec(query string, args ...interface{}) (sql.Result, error)\n    Query(query string, args ...interface{}) (*sql.Rows, error)\n    QueryRow(query string, args ...interface{}) *sql.Row\n}\n\ntype Store struct {\n    // this is the actual connection(pool) to the db which has the Begin() method\n    db       *sql.DB\n    executor executor\n}\n\nfunc NewStore(dsn string) (*Store, error) {\n    db, err := sql.Open(\"sqlite3\", dsn)\n    if err != nil {\n         return nil, err\n    }      \n    // the initial store contains just the connection(pool)\n    return &amp;Store{db, db}, nil\n}\n\nfunc (s *Store) RunInTransaction(f func(store *Store) error) error {\n    if _, ok := s.executor.(*sql.Tx); ok {\n        // nested transactions are not supported!\n        return ErrNestedTransaction\n    }\n\n    tx, err := s.db.Begin()\n    if err != nil {\n        return err\n    }\n\n    transactedStore := &amp;Store{\n        s.db,\n        tx,\n    }\n\n    err = f(transactedStore)\n    if err != nil {\n        tx.Rollback()\n        return err\n    }\n\n    return tx.Commit()\n}\n\nfunc (s *Store) CreateA(thing A) error {\n    // your implementation\n    _, err := s.executor.Exec(\"INSERT INTO ...\", ...)\n    return err\n}\n</code></pre>\n\n<p>And then you use it like</p>\n\n<pre><code>// store is a global object\nstore.RunInTransaction(func(store *Store) error { \n    // this instance of Store uses a transaction to execute the methods\n    err := store.CreateA(a)\n    if err != nil {\n        return err\n    }\n    return store.CreateB(b)\n})\n</code></pre>\n\n<p>The trick is to use the executor instead of the *sql.DB in your CreateX methods, which allows you to dynamically change the underlying implementation (tx vs. db). However, since there is very little information out there on how to deal with this issue, I can't assure you that this is the \"best\" solution. Other suggestions are welcome!</p>\n"}], "owner": {"reputation": 214, "user_id": 4186181, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/RyB2K.jpg?s=128&g=1", "display_name": "rhymes", "link": "https://stackoverflow.com/users/4186181/rhymes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2637, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1522540992, "creation_date": 1522534368, "question_id": 49592934, "link": "https://stackoverflow.com/questions/49592934/wrapping-a-db-object-in-go-and-running-two-methods-in-the-same-transaction", "title": "Wrapping a db object in Go and running two methods in the same transaction", "body": "<p>In the effort of learning Go a bit better, I am trying to refactor a series of functions which accept a DB connection as the first argument into struct methods and something a bit more \"idiomatically\" Go.</p>\n\n<p>Right now my \"data store\" methods are something like this:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func CreateA(db orm.DB, a *A) error {\n    db.Exec(\"INSERT...\")\n}\n\nfunc CreateB(db orm.DB, b *B) error {\n    db.Exec(\"INSERT...\")\n}\n</code></pre>\n\n<p>These the functions work perfectly fine. <code>orm.DB</code> is the <a href=\"https://godoc.org/github.com/go-pg/pg/orm#DB\" rel=\"nofollow noreferrer\">DB interface of go-pg</a>.</p>\n\n<p>Since the two functions accept a db connection I can either pass an actual connection or a <a href=\"https://godoc.org/github.com/go-pg/pg#Tx\" rel=\"nofollow noreferrer\">transaction</a> (which implements the same interface). I can be sure that both functions issuing SQL INSERTs run in the same transaction, avoiding having inconsistent state in the DB in case either one of them fails.</p>\n\n<p>The trouble started when I decided to read more about how to structure the code a little better and to make it \"mockable\" in case I need to. </p>\n\n<p>So I googled a bit, read the article <a href=\"http://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">Practical Persistence in Go: Organising Database Access</a> and tried to refactor the code to use proper interfaces.</p>\n\n<p>The result is something like this:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Store {\n    CreateA(a *A) error\n    CreateB(a *A) error\n}\n\ntype DB struct {\n    orm.DB\n}\n\nfunc NewDBConnection(p *ConnParams) (*DB, error) {\n    .... create db connection ...\n    return &amp;DB{db}, nil\n}\n\nfunc (db *DB) CreateA(a *A) error {\n...\n}\n\nfunc (db *DB) CreateB(b *B) error {\n...\n}\n</code></pre>\n\n<p>which allows me to write code like:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>db := NewDBConnection()\nDB.CreateA(a)\nDB.CreateB(b)\n</code></pre>\n\n<p>instead of:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>db := NewDBConnection()\nCreateA(db, a)\nCreateB(db, b)\n</code></pre>\n\n<p>The actual issue is that I lost the ability to run the two functions in the same transaction. Before I could do:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>pgDB := DB.DB.(*pg.DB) // convert the interface to an actual connection\npgDB.RunInTransaction(func(tx *pg.Tx) error {\n    CreateA(tx, a)\n    CreateB(tx, b)\n})\n</code></pre>\n\n<p>or something like:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>tx := db.DB.Begin()\n\nerr = CreateA(tx, a)\nerr = CreateB(tx, b)\n\nif err != nil {\n  tx.Rollback()\n} else {\n  tx.Commit()\n}\n</code></pre>\n\n<p>which is more or less the same thing.</p>\n\n<p>Since the functions were accepting the common interface between a connection and a transaction I could abstract from my model layer the transaction logic sending down either a full connection or a transaction. This allowed me to decide in the \"HTTP handler\" when to create a trasaction and when I didn't need to.</p>\n\n<p>Keep in mind that the connection is a global object representing a pool of connections handled automatically by go, so the hack I tried:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>pgDB := DB.DB.(*pg.DB) // convert the interface to an actual connection\nerr = pgDB.RunInTransaction(func(tx *pg.Tx) error {\n    DB.DB = tx // replace the connection with a transaction\n    DB.CreateA(a)\n    DB.CreateB(a)\n})\n</code></pre>\n\n<p>it's clearly a bad idea, because although it works, it works only once because we replace the global connection with a transaction. The following request breaks the server.</p>\n\n<p>Any ideas? I can't find information about this around, probably because I don't know the right keywords being a noob.</p>\n"}, {"tags": ["function", "go", "concurrency"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 2, "creation_date": 1522530007, "post_id": 49592319, "comment_id": 86192245, "body": "It looks that you will get no benefit from concurrency in this case. Can you elaborate?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1522531980, "post_id": 49592319, "comment_id": 86192761, "body": "Use a <a href=\"https://godoc.org/sync#Mutex\" rel=\"nofollow noreferrer\">mutex</a> to limit execution to one goroutine a time."}, {"owner": {"reputation": 89, "user_id": 5353240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d49a765a784ff64ae48d362213db2149?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Vodopyanov", "link": "https://stackoverflow.com/users/5353240/ivan-vodopyanov"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522575177, "post_id": 49592319, "comment_id": 86200549, "body": "@CeriseLim&#243;n, I can&#39;t modify my function, so I have to wrap it with another function with mutex object included. Am I right?"}, {"owner": {"reputation": 89, "user_id": 5353240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d49a765a784ff64ae48d362213db2149?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Vodopyanov", "link": "https://stackoverflow.com/users/5353240/ivan-vodopyanov"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1522575617, "post_id": 49592319, "comment_id": 86200667, "body": "@Grzegorz\u017bur, yes, you are right - I will not receive any benefit from concurrency at this stage. I have to build up a pipeline with this function as a one stage of it."}], "owner": {"reputation": 89, "user_id": 5353240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d49a765a784ff64ae48d362213db2149?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan Vodopyanov", "link": "https://stackoverflow.com/users/5353240/ivan-vodopyanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525960173, "creation_date": 1522529715, "last_edit_date": 1525960173, "question_id": 49592319, "link": "https://stackoverflow.com/questions/49592319/single-invocation-at-a-time", "title": "Single invocation at a time", "body": "<p>I want to call function for each of several inputs in parallel.\nHow is it possible to organize goroutines communication if there is a restriction: one function's call at a time?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 5762747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71ba60e7e099907fc626bb0fd184c337?s=128&d=identicon&r=PG&f=1", "display_name": "Ne00n", "link": "https://stackoverflow.com/users/5762747/ne00n"}, "edited": false, "score": 0, "creation_date": 1522534680, "post_id": 49592130, "comment_id": 86193515, "body": "I cannot define a instance from the key value store outside any function as I said, but you still posted the example post to do that. Maybe you could take a look at the example from github"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 67, "user_id": 5762747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71ba60e7e099907fc626bb0fd184c337?s=128&d=identicon&r=PG&f=1", "display_name": "Ne00n", "link": "https://stackoverflow.com/users/5762747/ne00n"}, "edited": false, "score": 0, "creation_date": 1522584794, "post_id": 49592130, "comment_id": 86202993, "body": "You are talking about <a href=\"https://play.golang.org/p/cGewKsM461f\" rel=\"nofollow noreferrer\">this</a> example from github?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 67, "user_id": 5762747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71ba60e7e099907fc626bb0fd184c337?s=128&d=identicon&r=PG&f=1", "display_name": "Ne00n", "link": "https://stackoverflow.com/users/5762747/ne00n"}, "edited": false, "score": 0, "creation_date": 1522585518, "post_id": 49592130, "comment_id": 86203196, "body": "I will edit my answer and put the working code in there."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1522585699, "last_edit_date": 1522585699, "creation_date": 1522528304, "answer_id": 49592130, "question_id": 49591712, "link": "https://stackoverflow.com/questions/49591712/using-a-key-value-store-in-webserver-application-golang/49592130#49592130", "title": "Using a key value store in webserver application golang", "body": "<h2>Global Conn Instance</h2>\n\n<p>First create a package with a single instance of the key value store and make the connection a package variable that you connect once and then keep open for all future use. Here some pseudo code sample:</p>\n\n<pre><code>package kvstore\n\nvar conn *diskv.Conn // or whatever the type of the conn is\n\nfunc Connect(...) {\n    // crate connection and fill conn\n    conn = diskv.New(...)\n}\n\nfunc Write(k, v []byte) error {\n    return conn.Write(k, v)\n}\n</code></pre>\n\n<p>That way yo have a \"global\" connection that can be used from everywhere. Simply call <code>kvstore.Write(...)</code> anywhere to write to the store.</p>\n\n<h2>Sync concurrent access</h2>\n\n<p>If your application uses multiple goroutines that can access the kvstore you (might -- depending if the package you use already does this for you or not) need to sync the access. You can do this by using a mutex for the connection:</p>\n\n<pre><code>var (\n    conn *diskv.Conn // or whatever the type of the conn is\n    mutex sync.Mutex\n)\n\nfunc Write(k, v []byte) error {\n    // everywhere you use the conn object, lock the mutex before and unlock after\n    mutex.Lock()\n    defer mutex.Unlock()\n    return conn.Write(k, v)\n}\n</code></pre>\n\n<p>You can also use the actor pattern. Here a post by Peter Bourgon that explains the <a href=\"https://blog.appdynamics.com/engineering/three-productive-go-patterns-put-radar/\" rel=\"nofollow noreferrer\">actor pattern</a>. With the actor pattern we can make sure the conn object is only used in one goroutine making the use of a mutex unnecessary.</p>\n\n<h2>Simple kvstore package implementation</h2>\n\n<pre><code>package kvstore\n\nimport \"github.com/peterbourgon/diskv\"\n\nvar conn *diskv.Diskv\n\n// Connect opens the global diskv db\nfunc Connect(dir string) {\n    flatTransform := func(s string) []string { return []string{} }\n\n    conn = diskv.New(diskv.Options{\n        BasePath:     dir,\n        Transform:    flatTransform,\n        CacheSizeMax: 1024 * 1024,\n    })\n}\n\n// Write writes to the global diskv db\nfunc Write(k string, v []byte) error {\n    return conn.Write(k, v)\n}\n\n// Read reads from the global diskv db\nfunc Read(k string) ([]byte, error) {\n    return conn.Read(k)\n}\n\n// Erase deletes a key from the global discv db\nfunc Erase(k string) error {\n    return conn.Erase(k)\n}\n</code></pre>\n\n<h2>Sample usage of kvstore</h2>\n\n<pre><code>package main\n\nimport (\n    \"github.com/tehsphinx/diskv\"\n)\n\nfunc main() {\n    // call this once in startup sequence.\n    kvstore.Connect(\"my-data-dir\")\n\n    // use this anywhere to write to key value store\n    kvstore.Write(\"alpha\", []byte{'1', '2', '2'})\n\n    // use this anywhere to read from kvstore\n    kvstore.Read(\"alpha\")\n\n    // use this anywhere to delete from kvstore\n    kvstore.Erase(\"alpha\")\n}\n</code></pre>\n\n<p>Just copy it in two different folders and try. It works.</p>\n"}], "owner": {"reputation": 67, "user_id": 5762747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71ba60e7e099907fc626bb0fd184c337?s=128&d=identicon&r=PG&f=1", "display_name": "Ne00n", "link": "https://stackoverflow.com/users/5762747/ne00n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 0, "accepted_answer_id": 49592130, "answer_count": 1, "score": 1, "last_activity_date": 1522585699, "creation_date": 1522525357, "question_id": 49591712, "link": "https://stackoverflow.com/questions/49591712/using-a-key-value-store-in-webserver-application-golang", "title": "Using a key value store in webserver application golang", "body": "<p>I tried to get a simple key value store working inside of a go webserver app, which should store some information.</p>\n\n<p>The issue is, I can only create one instance of it, since its writing to the disk and the folder is locked, so I need to find away to access the key value store with my Webserver.</p>\n\n<p>So every current instance can access it (read/write).\nHow do I do that?</p>\n\n<p>Currently My app looks like that: <a href=\"https://play.golang.org/p/_SmGBZlP0Vi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_SmGBZlP0Vi</a>\nThe Package I wanted to use is this: <a href=\"https://github.com/peterbourgon/diskv\" rel=\"nofollow noreferrer\">https://github.com/peterbourgon/diskv</a></p>\n\n<p>Basically I would create an instance before the main and pass the instance of the key value store, to the rtt function, but that seems not directly be possible in go. Or do I something wrong?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1522525934, "post_id": 49590422, "comment_id": 86191228, "body": "Using a <code>for select</code> listening for <code>ctx.Done</code> and result channel? do all the processing in a different goroutine and return the result in the channel"}], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": false, "score": 0, "last_activity_date": 1522872886, "creation_date": 1522872886, "answer_id": 49659666, "question_id": 49590422, "link": "https://stackoverflow.com/questions/49590422/how-to-use-context-passed-from-the-client-in-the-grpc-server-side/49659666#49659666", "title": "How to use context passed from the client in the grpc server side", "body": "<p>The context that the service handler gets has the deadline(the one that client set) set in it. Go way would be to pass that context around in each step of your way and if any of these steps are blocking you block on that context as well.</p>\n"}], "owner": {"reputation": 3436, "user_id": 729294, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/de7b24414ca6c375479bdab7ba824eb0?s=128&d=identicon&r=PG", "display_name": "rajan sthapit", "link": "https://stackoverflow.com/users/729294/rajan-sthapit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 463, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1522872886, "creation_date": 1522516723, "question_id": 49590422, "link": "https://stackoverflow.com/questions/49590422/how-to-use-context-passed-from-the-client-in-the-grpc-server-side", "title": "How to use context passed from the client in the grpc server side", "body": "<p>I have defined an endpoint in the grpc service. Now when the client calls the endpoint with some context how am I supposed to handle that context, its expiry/deadline etc?</p>\n\n<p>I mean in the service side, I have a series of steps to be performed to complete the request. It includes some processing, writing to data store etc. Now how am I supposed to honor the context. Is it that after every step in the process, I am required to check if the context is done?. If it is done, I will just return instead of proceeding to the next step? This doesn't feel right though.</p>\n\n<p>What is the right way to do it in GRPC/Go?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1522514361, "post_id": 49590041, "comment_id": 86187879, "body": "write your error on header rather than Status code to check what error is returned from the database."}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1522516176, "post_id": 49590041, "comment_id": 86188403, "body": "first log.println(err)...then complain if its empty"}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "edited": false, "score": 0, "creation_date": 1522522834, "post_id": 49590041, "comment_id": 86190438, "body": "Are you sure you have <code>autocommit</code> flag enabled for your DB?"}, {"owner": {"reputation": 171, "user_id": 5259101, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1e8db9739f9d98012a2d0ba1801b4a99?s=128&d=identicon&r=PG&f=1", "display_name": "Shambhu", "link": "https://stackoverflow.com/users/5259101/shambhu"}, "edited": false, "score": 0, "creation_date": 1548989518, "post_id": 49590041, "comment_id": 95752152, "body": "Have you solved this error? Coz, I too getting this error."}], "owner": {"reputation": 29, "user_id": 8259428, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f8h4pbCUOuw/AAAAAAAAAAI/AAAAAAAAD-I/1MYlmzGHdfo/photo.jpg?sz=128", "display_name": "prince antony", "link": "https://stackoverflow.com/users/8259428/prince-antony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1647, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1522514069, "creation_date": 1522514069, "question_id": 49590041, "link": "https://stackoverflow.com/questions/49590041/insert-query-not-working-in-golang", "title": "insert query not working in golang", "body": "<p>In my golang program, the insert MySQL query was not inserting the values. Even the syntax of the query was correct.It returns my error statement ie internal server error </p>\n\n<pre><code>            package main\n\n            import (\n\n            \"database/sql\"\n            \"net/http\"\n             \"log\"\n            \"golang.org/x/crypto/bcrypt\"\n            \"encoding/json\"\n            _ \"github.com/go-sql-driver/mysql\"\n            \"fmt\"\n\n            )\n\n\n            const hashCost = 8\n            var db *sql.DB\n\n\n            func initDB(){\n                var err error\n</code></pre>\n\n<p>// Connect to the db\n//you might have to change the connection string to add your database credentials</p>\n\n<pre><code>          db, err = sql.Open(\"mysql\", \n     \"root:nfn@tcp(127.0.0.1:3306)/mydb\")\n\n                if err != nil {\n                    panic(err)\n                }\n            }\n</code></pre>\n\n<p>// Create a struct that models the structure of a user, both in the request body, and in the DB</p>\n\n<pre><code>                    type Credentials struct {\n                    Password string `json:\"password\", db:\"password\"`\n                      Username string `json:\"username\", db:\"username\"`\n               }\n\n            func Signup(w http.ResponseWriter, r *http.Request){\n                // Parse and decode the request body into a new `Credentials` instance\n                creds := &amp;Credentials{}\n                err := json.NewDecoder(r.Body).Decode(creds)\n                if err != nil {\n                    // If there is something wrong with the request body, return a 400 status\n                    w.WriteHeader(http.StatusBadRequest)\n                    return\n                }\n                // Salt and hash the password using the bcrypt algorithm\n                // The second argument is the cost of hashing, which we arbitrarily set as 8 (this value can be more or less, depending on the computing power you wish to utilize)\n                hashedPassword, err := bcrypt.GenerateFromPassword([]byte(creds.Password), 8)\n\n                // Next, insert the username, along with the hashed password into the database\n</code></pre>\n\n<p>// Sql query not working Here.How to solve this error </p>\n\n<pre><code>                        if _, err = db.Exec(\"INSERT INTO users(username,password) VALUES (?,?) \", creds.Username, string(hashedPassword)); err != nil {\n                    // If there is any issue with inserting into the database, return a 500 error\n                    w.WriteHeader(http.StatusInternalServerError)\n                    return\n                }\n</code></pre>\n\n<p>// We reach this point if the credentials we correctly stored in the database, and the default status of 200 is sent back\n                }</p>\n"}, {"tags": ["http", "go", "fileserver"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522512479, "post_id": 49589685, "comment_id": 86187267, "body": "What happens if you return nil, os.ErrNotExist from Readdir? I would expect this to result in a 404 response."}, {"owner": {"reputation": 824, "user_id": 2164642, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/093eaa03106e4783fe918b36dcff1453?s=128&d=identicon&r=PG", "display_name": "Tobias", "link": "https://stackoverflow.com/users/2164642/tobias"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522512781, "post_id": 49589685, "comment_id": 86187360, "body": "@Peter added note in post on what happens when you do that. Basically, it returns a 500, not a 404."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1522514480, "post_id": 49589685, "comment_id": 86187916, "body": "Either wrap the handler to return 404 or write a simple handler that uses http.ServeContent for the heavy lifting."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1522519609, "post_id": 49589685, "comment_id": 86189420, "body": "Perhaps simply fall back down one level and <code>http.ServeFile()</code> if indeed file and if dir -&gt; 404. A little more code but, would work."}], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 3, "last_activity_date": 1522529100, "creation_date": 1522529100, "answer_id": 49592238, "question_id": 49589685, "link": "https://stackoverflow.com/questions/49589685/good-way-to-disable-directory-listing-with-http-fileserver-in-go/49592238#49592238", "title": "Good way to disable directory listing with http.FileServer in Go", "body": "<p>This behavior can be changed if you substitute not a <code>Readdir</code> method, but the <code>Stat</code>.<br>\nPlease take a look at working code below. It supports serving of <code>index.html</code> files if they are inside of requested directory and returns <code>404</code> in case there is no <code>index.html</code> and it is a directory.</p>\n\n<pre><code>    package main\n\n    import (\n        \"io\"\n        \"net/http\"\n        \"os\"\n    )\n\n    type justFilesFilesystem struct {\n        fs               http.FileSystem\n        // readDirBatchSize - configuration parameter for `Readdir` func  \n        readDirBatchSize int\n    }\n\n    func (fs justFilesFilesystem) Open(name string) (http.File, error) {\n        f, err := fs.fs.Open(name)\n        if err != nil {\n            return nil, err\n        }\n        return neuteredStatFile{File: f, readDirBatchSize: fs.readDirBatchSize}, nil\n    }\n\n    type neuteredStatFile struct {\n        http.File\n        readDirBatchSize int\n    }\n\n    func (e neuteredStatFile) Stat() (os.FileInfo, error) {\n        s, err := e.File.Stat()\n        if err != nil {\n            return nil, err\n        }\n        if s.IsDir() {\n        LOOP:\n            for {\n                fl, err := e.File.Readdir(e.readDirBatchSize)\n                switch err {\n                case io.EOF:\n                    break LOOP\n                case nil:\n                    for _, f := range fl {\n                        if f.Name() == \"index.html\" {\n                            return s, err\n                        }\n                    }\n                default:\n                    return nil, err\n                }\n            }\n            return nil, os.ErrNotExist\n        }\n        return s, err\n    }\n\n    func main() {\n        fs := justFilesFilesystem{fs: http.Dir(\"/tmp/\"), readDirBatchSize: 2}\n        fss := http.FileServer(fs)\n        http.ListenAndServe(\":8080\", fss)\n    }\n</code></pre>\n"}], "owner": {"reputation": 824, "user_id": 2164642, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/093eaa03106e4783fe918b36dcff1453?s=128&d=identicon&r=PG", "display_name": "Tobias", "link": "https://stackoverflow.com/users/2164642/tobias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1966, "favorite_count": 0, "accepted_answer_id": 49592238, "answer_count": 1, "score": 4, "last_activity_date": 1522529100, "creation_date": 1522511853, "last_edit_date": 1522512739, "question_id": 49589685, "link": "https://stackoverflow.com/questions/49589685/good-way-to-disable-directory-listing-with-http-fileserver-in-go", "title": "Good way to disable directory listing with http.FileServer in Go", "body": "<p>If you use the http.FileServer in Go like:</p>\n\n<pre><code>func main() {\n    port := flag.String(\"p\", \"8100\", \"port to serve on\")\n    directory := flag.String(\"d\", \".\", \"the directory of static file to host\")\n    flag.Parse()\n\n    http.Handle(\"/\", http.FileServer(http.Dir(*directory)))\n\n    log.Printf(\"Serving %s on HTTP port: %s\\n\", *directory, *port)\n    log.Fatal(http.ListenAndServe(\":\"+*port, nil))\n}\n</code></pre>\n\n<p>Then accessing a directory will give you a listing of files. Often this is disabled for web services and instead responds with 404 and I would like this behaviour too.</p>\n\n<p>http.FileServer has no options for this AFAIK and I have seen a proposed way to solve this here <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/bStLPdIVM6w\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/bStLPdIVM6w</a> what they do is wrapping the http.FileSystem type and implementing an own Open method. However this doesn't give a 404 when the path is a directory, it just gives a blank page, and it's unclear how to modify it to accomodate this. This is what they do:</p>\n\n<pre><code>type justFilesFilesystem struct {\n    fs http.FileSystem\n}\n\nfunc (fs justFilesFilesystem) Open(name string) (http.File, error) {\n    f, err := fs.fs.Open(name)\n    if err != nil {\n        return nil, err\n    }\n    return neuteredReaddirFile{f}, nil\n}\n\ntype neuteredReaddirFile struct {\n    http.File\n}\n\nfunc (f neuteredReaddirFile) Readdir(count int) ([]os.FileInfo, error) {\n    return nil, nil\n}\n\nfunc main() {\n    fs := justFilesFilesystem{http.Dir(\"/tmp/\")}\n    http.ListenAndServe(\":8080\", http.FileServer(fs))\n}\n</code></pre>\n\n<p>Note: if you make Readdir <code>return nil, os.ErrNotExist</code> then you get a 500 response with \"Error reading directory\" - not 404.</p>\n\n<p>Any ideas on how to neatly present a 404 and still preserving the feature of automatically finding an index.html if present?</p>\n"}, {"tags": ["go", "cryptography"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522495004, "post_id": 49587016, "comment_id": 86181922, "body": "&quot;It does not work&quot; is not an adequate problem description. Show what you have tried and why it doesn&#39;t solve your problem."}], "answers": [{"tags": [], "owner": {"reputation": 4059, "user_id": 8763847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k2myi.png?s=128&g=1", "display_name": "sayboras", "link": "https://stackoverflow.com/users/8763847/sayboras"}, "is_accepted": true, "score": 0, "last_activity_date": 1522495233, "creation_date": 1522495233, "answer_id": 49587150, "question_id": 49587016, "link": "https://stackoverflow.com/questions/49587016/how-to-chnage-x509-certificate-to-byte-array/49587150#49587150", "title": "How to chnage *x509.Certificate to byte array", "body": "<p>Please find below the code snippet</p>\n\n<pre><code>derPubKey, err := x509.MarshalPKIXPublicKey(&amp;pKey.PublicKey)\n\nif err != nil {\n    //handle error here\n}\n\npubBytes := pem.EncodeToMemory(&amp;pem.Block{\n    Type:  \"RSA PUBLIC KEY\",\n    Bytes: derPubKey,\n})\n\nioutil.WriteFile(\"key.pub\", pubBytes, 0644)\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 7569869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ceedd2b4e849b1a39cb4ea41743890c9?s=128&d=identicon&r=PG&f=1", "display_name": "Gokuruto", "link": "https://stackoverflow.com/users/7569869/gokuruto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 914, "favorite_count": 0, "accepted_answer_id": 49587150, "answer_count": 1, "score": -1, "last_activity_date": 1522503418, "creation_date": 1522494330, "last_edit_date": 1522503418, "question_id": 49587016, "link": "https://stackoverflow.com/questions/49587016/how-to-chnage-x509-certificate-to-byte-array", "title": "How to chnage *x509.Certificate to byte array", "body": "<p>Hello i've got somthing like this to read from .p12 keystore</p>\n\n<pre><code>func read_keys()(interface{},*x509.Certificate) {\n    b, err:= ioutil.ReadFile(\"mystore.p12\")\n    if err!=nil {\n        fmt.Println(err)\n        return nil,nil\n    }\n    password := \"pass\"\n    privk, pKey , err := pkcs12.Decode(b,password)\n    if err!=nil {\n        fmt.Println(err)\n    }\n    return privk,pKey\n}\n</code></pre>\n\n<p>now i need to change pKey to byte array for AES.cipher and i don't know how i've looking in pkcs12 and pem docs and tried some decode functions but it doesnt work. Is there any way to read this way AES secret key ? because this code will throw error that \"there only RSA and ECDSA public keys supported\" and i need AES secret key to be readed from keystore too. </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "uuid", "string-concatenation"], "comments": [{"owner": {"reputation": 49, "user_id": 2582103, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/360f2462b56974daa7acf51b4e22ec37?s=128&d=identicon&r=PG", "display_name": "machmum", "link": "https://stackoverflow.com/users/2582103/machmum"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522491337, "post_id": 49586495, "comment_id": 86181025, "body": "I&#39;m using this <a href=\"https://github.com/satori/go.uuid\" rel=\"nofollow noreferrer\">github.com/satori/go.uuid</a>, docs said uid is [16] byte type. how can I concatenate uuid then?"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 2582103, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/360f2462b56974daa7acf51b4e22ec37?s=128&d=identicon&r=PG", "display_name": "machmum", "link": "https://stackoverflow.com/users/2582103/machmum"}, "edited": false, "score": 0, "creation_date": 1522493633, "post_id": 49586708, "comment_id": 86181581, "body": "Add <code>buffer.WriteString(&quot;-&quot;)</code> to the concatenate, then remove the last char <code>&quot;-&quot;</code> from the concatenated string. Thanks Cerise!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1618716123, "last_edit_date": 1618716123, "creation_date": 1522491773, "answer_id": 49586708, "question_id": 49586495, "link": "https://stackoverflow.com/questions/49586495/concatenate-uuid-in-golang/49586708#49586708", "title": "Concatenate uuid in golang", "body": "<p>The type of <code>uuid.Must(uuid.NewV4())</code> is <code>uuid.UUID</code>, not <code>string</code>.  Call the <code>UUID.Sring()</code> method to get a <code>string</code>.  Call <code>buffer.String()</code> to get the <code>string</code> when done concatenating:</p>\n<pre><code>var buffer strings.Builder\nfor i := 0; i &lt; 2; i++ {\n    if i &gt; 0 {\n        buffer.WriteByte('-')\n    }\n    buffer.WriteString(uuid.Must(uuid.NewV4()).String())\n}\ns := buffer.String()\n</code></pre>\n<p>Another approach is to join the strings:</p>\n<pre><code>var uuids []string\nfor i := 0; i &lt; 2; i++ {\n    uuids = append(uuids, uuid.Must(uuid.NewV4()).String())\n}\ns := strings.Join(uuids, &quot;-&quot;)\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 2582103, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/360f2462b56974daa7acf51b4e22ec37?s=128&d=identicon&r=PG", "display_name": "machmum", "link": "https://stackoverflow.com/users/2582103/machmum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1334, "favorite_count": 0, "accepted_answer_id": 49586708, "answer_count": 1, "score": 0, "last_activity_date": 1618716123, "creation_date": 1522490351, "last_edit_date": 1522491290, "question_id": 49586495, "link": "https://stackoverflow.com/questions/49586495/concatenate-uuid-in-golang", "title": "Concatenate uuid in golang", "body": "<p>I read <a href=\"https://stackoverflow.com/questions/1760757/how-to-efficiently-concatenate-strings-in-go\">here</a> how to convert string efficiently in GO using either <code>bytes.Buffer</code> or <code>strings.Builder</code>. So how do I achieve the same in uuid im using <a href=\"https://github.com/satori/go.uuid\" rel=\"nofollow noreferrer\">satori/go.uuid</a>, since doing this</p>\n\n<pre><code>var buffer bytes.Buffer\nvar s string\nfor i := 0; i &lt; 2; i++ {\n  s = buffer.WriteString(uuid.Must(uuid.NewV4()))\n}\n</code></pre>\n\n<p>produce this error <code>Cannot use 'uuid.Must(uuid.NewV4())' as type string</code>.</p>\n\n<p>My goal was so the 's' would be like this <code>15094a36-8827-453a-b27a-598421dbd73b-803bc133-dbc5-4629-9a2e-ef8ed3f1372e</code></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1522482218, "post_id": 49585021, "comment_id": 86178798, "body": "What&#39;s wrong with your solution? Go is not about providing magic for each and every use case which can be encapsulated into a function. Writing a function which does some work and using this function is not &quot;uncomfortable&quot;. So what&#39;s the question?"}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1522486116, "post_id": 49585021, "comment_id": 86179798, "body": "I think it is not very handy and I haven&#39;t seen it a lot to only use pointers to struct fields, with all the dereferencing and risks of nil pointers. And about the magic:&quot;DisallowUnknownFields&quot; is part of the json std lib, so why couldn&#39;t &quot;DisallowMissingFields&quot; be? And I don&#39;t know what a function would look like that solve this generically for all structs (since a I am building a library)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1522495629, "post_id": 49585021, "comment_id": 86182100, "body": "First of all: pointers are not uncommon in Go. Second: Wrap this into a function. There is no need that you work with pointers, all you have to do is use them during decoding, then copy back to a &quot;pointerless&quot; struct. Dead simple."}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1522510725, "post_id": 49585021, "comment_id": 86186633, "body": "So every user of the generic library has to provide two structs, has to do field == nil checks and then has to copy over to another struct... Very intuitive. :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1522486239, "post_id": 49585931, "comment_id": 86179821, "body": "That at least solves a little bit the problem if the nil check. But still I think it is not much fun messing around with pointers of primitive values."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1522486945, "post_id": 49585931, "comment_id": 86179986, "body": "But why are you using pointers, instead of values? Just pass <code>p</code> as pointer when needed? In my opinion using values is much safer since it will always have a value ( 0 value at init - for which you can check ) this will prevent panics from accessing <code>nil</code> pointers."}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1522490563, "post_id": 49585931, "comment_id": 86180836, "body": "Btw: this does only check if <i>none</i> if the fields could be mapped. You cannot decide from the result if all fields or only some could be mapped since the check is &quot;false&quot; in both cases."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522506276, "post_id": 49585931, "comment_id": 86185286, "body": "This does not distinguish between absent fields and present zero values."}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 2, "last_activity_date": 1522485708, "creation_date": 1522485708, "answer_id": 49585931, "question_id": 49585021, "link": "https://stackoverflow.com/questions/49585021/how-to-check-if-a-json-matches-a-struct-struct-fields/49585931#49585931", "title": "How to check if a json matches a struct / struct fields", "body": "<p>You could compare <code>p</code> with a empty struct, instead of comparing each field with <code>nil</code>. </p>\n\n<pre><code>// handle json did not match error\nif p == Person{} {\n    return\n}\n</code></pre>\n\n<p>Since <code>Person{}</code> will initialize with the 0 value of each field, this will result in each property that is <code>pointers</code> to be <code>nil</code>, <code>strings</code> will be <code>\"\"</code>, <code>ints</code> will be <code>0</code>, and so on.</p>\n"}, {"comments": [{"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1522510991, "post_id": 49586806, "comment_id": 86186717, "body": "Can this also be generic or do you need to implement this for every struct. Since the library is generic ( similar to json.Unmarshal ) und the user of the library provides arbitrary structs."}, {"owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "reply_to_user": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1522532861, "post_id": 49586806, "comment_id": 86193014, "body": "This code is in principle generic but you always need to create a custom <code>JSONUnmarshal</code> function for every type. You should be able to extract the example code I provided into a separate function which you can call but in general I advise using this approach carefully and only if you absolutely have to and otherwise default to the standard unmarshaling.   Keep in mind you have to take care of the comment I had regarding unmarshalling numeric types. Also I didn&#39;t test unexported or anonymous fields so you should make sure to test those as well if you try this approach."}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "edited": false, "score": 0, "creation_date": 1543918092, "post_id": 49586806, "comment_id": 94081999, "body": "Why do you need <code>switch field.Type.Kind() {}</code> code block?"}, {"owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "edited": false, "score": 0, "creation_date": 1544172484, "post_id": 49586806, "comment_id": 94189749, "body": "You nay not need it. The intention in my example was only to show that you can use it if you want to apply logic for specific kinds (see comment in the code)"}], "tags": [], "owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "is_accepted": true, "score": 3, "last_activity_date": 1522492650, "creation_date": 1522492650, "answer_id": 49586806, "question_id": 49585021, "link": "https://stackoverflow.com/questions/49585021/how-to-check-if-a-json-matches-a-struct-struct-fields/49586806#49586806", "title": "How to check if a json matches a struct / struct fields", "body": "<p>Another way would be to implement your own <a href=\"http://godoc.org/encoding/json#Unmarshaler\" rel=\"nofollow noreferrer\">json.Unmarshaler</a> which uses reflection (similar to the default json unmarshaler):</p>\n\n<p>There are a few points to consider:</p>\n\n<ul>\n<li>if speed is of great importance to you then you should write a benchmark to see how big the impact of the extra reflection is. I suspect its negligible but it can't hurt to write a small go benchmark to get some numbers.</li>\n<li>the stdlib will unmarshal all numbers in your json input into floats. So if you use reflection to set integer fields then you need to provide the corresponding conversion yourself (see TODO in example below)</li>\n<li>the <code>json.Decoder.DisallowUnknownFields</code> function will not work as expected with your type. You need to implement this yourself (see example below)</li>\n<li>if you decide to take this approach you will <strong>make your code more complex and thus harder to understand and maintain</strong>. Are you actually sure you must know if fields are omitted? Maybe you can refactor your fields to make good usage of the zero values? </li>\n</ul>\n\n<p>Here a fully executable test of this approach:</p>\n\n<pre><code>package sandbox\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"reflect\"\n    \"strings\"\n    \"testing\"\n)\n\ntype Person struct {\n    Name string\n    City string\n}\n\nfunc (p *Person) UnmarshalJSON(data []byte) error {\n    var m map[string]interface{}\n    err := json.Unmarshal(data, &amp;m)\n    if err != nil {\n        return err\n    }\n\n    v := reflect.ValueOf(p).Elem()\n    t := v.Type()\n\n    var missing []string\n    for i := 0; i &lt; t.NumField(); i++ {\n        field := t.Field(i)\n        val, ok := m[field.Name]\n        delete(m, field.Name)\n        if !ok {\n            missing = append(missing, field.Name)\n            continue\n        }\n\n        switch field.Type.Kind() {\n        // TODO: if the field is an integer you need to transform the val from float\n        default:\n            v.Field(i).Set(reflect.ValueOf(val))\n        }\n    }\n\n    if len(missing) &gt; 0 {\n        return errors.New(\"missing fields: \" + strings.Join(missing, \", \"))\n    }\n\n    if len(m) &gt; 0 {\n        extra := make([]string, 0, len(m))\n        for field := range m {\n            extra = append(extra, field)\n        }\n        // TODO: consider sorting the output to get deterministic errors:\n        // sort.Strings(extra)\n        return errors.New(\"unknown fields: \" + strings.Join(extra, \", \"))\n    }\n\n    return nil\n}\n\nfunc TestJSONDecoder(t *testing.T) {\n    cases := map[string]struct {\n        in       string\n        err      string\n        expected Person\n    }{\n        \"Empty object\": {\n            in:       `{}`,\n            err:      \"missing fields: Name, City\",\n            expected: Person{},\n        },\n        \"Name missing\": {\n            in:       `{\"City\": \"Berlin\"}`,\n            err:      \"missing fields: Name\",\n            expected: Person{City: \"Berlin\"},\n        },\n        \"Age missing\": {\n            in:       `{\"Name\": \"Friedrich\"}`,\n            err:      \"missing fields: City\",\n            expected: Person{Name: \"Friedrich\"},\n        },\n        \"Unknown field\": {\n            in:       `{\"Name\": \"Friedrich\", \"City\": \"Berlin\", \"Test\": true}`,\n            err:      \"unknown fields: Test\",\n            expected: Person{Name: \"Friedrich\", City: \"Berlin\"},\n        },\n        \"OK\": {\n            in:       `{\"Name\": \"Friedrich\", \"City\": \"Berlin\"}`,\n            expected: Person{Name: \"Friedrich\", City: \"Berlin\"},\n        },\n    }\n\n    for name, c := range cases {\n        t.Run(name, func(t *testing.T) {\n            var actual Person\n            r := strings.NewReader(c.in)\n            err := json.NewDecoder(r).Decode(&amp;actual)\n            switch {\n            case err != nil &amp;&amp; c.err == \"\":\n                t.Errorf(\"Expected no error but go %v\", err)\n            case err == nil &amp;&amp; c.err != \"\":\n                t.Errorf(\"Did not return expected error %v\", c.err)\n            case err != nil &amp;&amp; err.Error() != c.err:\n                t.Errorf(\"Expected error %q but got %v\", c.err, err)\n            }\n\n            if !reflect.DeepEqual(c.expected, actual) {\n                t.Errorf(\"\\nWant: %+v\\nGot:  %+v\", c.expected, actual)\n            }\n        })\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6493, "favorite_count": 1, "accepted_answer_id": 49586806, "answer_count": 2, "score": 2, "last_activity_date": 1522492650, "creation_date": 1522478589, "question_id": 49585021, "link": "https://stackoverflow.com/questions/49585021/how-to-check-if-a-json-matches-a-struct-struct-fields", "title": "How to check if a json matches a struct / struct fields", "body": "<p>Is there an easy way to check if each field of myStruct was mapped by using json.Unmarshal(jsonData, &amp;myStruct).</p>\n\n<p>The only way I could image is to define each field of a struct as pointer, otherwise you will always get back an initialized struct.\nSo every jsonString that is an object (even an empty one {}) will return an initialized struct and you cannot tell if the json represented your struct.</p>\n\n<p>The only solution I could think of is quite uncomfortable:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Person struct {\n    Name *string `json:name`\n    Age  *int    `json:age`\n    Male *bool   `json:male`\n}\n\nfunc main() {\n    var p *Person\n    err := json.Unmarshal([]byte(\"{}\"), &amp;p)\n    // handle parse error\n    if err != nil {\n        return\n    }\n\n    // handle json did not match error\n    if p.Name == nil || p.Age == nil || p.Male == nil {\n        return\n    }\n\n    // now use the fields with dereferencing and hope you did not forget a nil check\n    fmt.Println(\"Hello \" + *p.Name)\n}\n</code></pre>\n\n<p>Maybe one could use a library like <a href=\"https://github.com/asaskevich/govalidator\" rel=\"nofollow noreferrer\">govalidator</a> and use SetFieldsRequiredByDefault. But then you still have to execute the validation and still you are left with the whole pointer dereferencing for value retrieval and the risk of nil pointer.</p>\n\n<p>What I would like is a function that returns my unmarshaled json as a struct or an error if the fields did not match. The only thing the golang json library offers is an option to fail on unknown fields but not to fail on missing fields.</p>\n\n<p>Any idea?</p>\n"}, {"tags": ["google-app-engine", "go", "router", "mux"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1522488900, "post_id": 49584588, "comment_id": 86180448, "body": "Aren&#39;t you missing <code>http.Handle(&quot;&#47;&quot;, r)</code>? Or how does your app know to use the mux router for incoming http requests?"}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1522515884, "post_id": 49584588, "comment_id": 86188306, "body": "I&#39;m not sure how it&#39;s supposed to know.  I copy pasted an example straight from the mux site. looks like i have to dig more."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522535896, "post_id": 49584588, "comment_id": 86193786, "body": "You did not copy the code where the mux is specified as the request handler."}], "answers": [{"tags": [], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "is_accepted": true, "score": 2, "last_activity_date": 1522622734, "creation_date": 1522622734, "answer_id": 49603322, "question_id": 49584588, "link": "https://stackoverflow.com/questions/49584588/mux-nor-http-handlefunc-is-working-for-even-a-helloworld-endpoint-on-google-app/49603322#49603322", "title": "Mux nor http.HandleFunc is working for even a helloworld endpoint on Google App Engine", "body": "<p>Here is what ultimately worked: \n1. I fixed mux code like mkopriva pointed out.  (Caution: http.handleFunc instead of http.Handle doesn't work). \n2. I had to change main() to init() and then app engine acknowledged my mux setup. </p>\n\n<p>So basically I learned the hard way that go app engine on its own can't handle multiple handlers and I bungled through setting up mux. </p>\n\n<p>Working code: </p>\n\n<pre><code>package sendmail\n\nimport (\n    \"fmt\"\n    _\"github.com/sendgrid/sendgrid-go\"\n    \"net/http\"\n    \"google.golang.org/appengine\"\n    \"github.com/gorilla/mux\"\n    \"google.golang.org/appengine/log\"\n\n)\n\nfunc init() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/send\", sendhardcoded)\n    r.HandleFunc(\"/emptysuccess\", emptysuccess)\n    //appengine.Main() // Starts the server to receive requests\n    http.Handle(\"/\", r)\n}\n\nfunc emptysuccess(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(w, \"Hello Success\")\n\n}\n\nfunc sendhardcoded(w http.ResponseWriter, r *http.Request) {\n    ctx := appengine.NewContext(r)\n\n    log.Infof(ctx, \"Running Sendhardcoded\")\n\n}\n</code></pre>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 49603322, "answer_count": 1, "score": 0, "last_activity_date": 1522622734, "creation_date": 1522474317, "question_id": 49584588, "link": "https://stackoverflow.com/questions/49584588/mux-nor-http-handlefunc-is-working-for-even-a-helloworld-endpoint-on-google-app", "title": "Mux nor http.HandleFunc is working for even a helloworld endpoint on Google App Engine", "body": "<p>I can't get a handler called emptysuccess to work.  I'm turning sendgrid into an appspot micro-service.  So far \nA call to</p>\n\n<blockquote>\n  <p><a href=\"http://localhost:8080/emptysuccess\" rel=\"nofollow noreferrer\">http://localhost:8080/emptysuccess</a></p>\n</blockquote>\n\n<p>Returns </p>\n\n<blockquote>\n  <p>404 page not found</p>\n</blockquote>\n\n<p>This behavior is true dev_appserver.py and also for the real appspot.com.  How to get /emptysuccess to work? </p>\n\n<pre><code>package sendmail\n\nimport (\n    \"fmt\"\n    \"github.com/sendgrid/sendgrid-go\"\n    \"net/http\"\n    \"google.golang.org/appengine\"\n    \"github.com/gorilla/mux\"\n    \"google.golang.org/appengine/log\"\n\n)\n\nfunc main() {\n    r := mux.Router{}\n    r.HandleFunc(\"/send\", sendhardcoded)\n    r.HandleFunc(\"/emptysuccess\", emptysuccess)\n    //appengine.Main() // Starts the server to receive requests\n}\n\nfunc emptysuccess(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(w, \"Hello Success\")\n\n}\n\nfunc sendhardcoded(w http.ResponseWriter, r *http.Request) {\n    ctx := appengine.NewContext(r)\n\n    log.Infof(ctx, \"Running Sendhardcoded\")\n    request := sendgrid.GetRequest(\"SG.OYPDF6hA.zk_XibKbJEUVLQfrkY-SBu5FejFakeC9ODFv1bE\", \"/v3/mail/send\", \"https://api.sendgrid.com\")\n    request.Method = \"POST\"\n    request.Body = []byte(` {\n    \"personalizations\": [\n        {\n            \"to\": [\n                {\n                    \"email\": \"darian.hickman@gmail.info\"\n                }\n            ],\n            \"subject\": \"Sending with SendGrid is Fun\"\n        }\n    ],\n    \"from\": {\n        \"email\": \"darian.hickman@ccc.com\"\n    },\n    \"content\": [\n        {\n            \"type\": \"text/plain\",\n            \"value\": \"and easy to do anywhere, even with Go\"\n        }\n    ]\n}`)\n    response, err := sendgrid.API(request)\n    if err != nil {\n        log.Errorf(ctx, \"Problems: %v\" ,err)\n    } else {\n        fmt.Println(w, response.StatusCode)\n        fmt.Println(w, response.Body)\n        fmt.Println(w, response.Headers)\n        fmt.Println(w, \"Sendmail should have worked\")\n    }\n}\n</code></pre>\n\n<p>Also to make sure all requests go to the go app my app.yaml is:</p>\n\n<pre><code>runtime: go\napi_version: go1.9\n\nhandlers:\n\n- url: /static\n  static_dir: static\n\n- url: /.*\n  script: _go_app\n  login: required\n  secure: always\n</code></pre>\n"}, {"tags": ["parsing", "go", "url-encoding"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1522471950, "creation_date": 1522471950, "answer_id": 49584377, "question_id": 49584307, "link": "https://stackoverflow.com/questions/49584307/how-to-parse-string-into-url-values-in-golang/49584377#49584377", "title": "How to parse string into url.Values in golang?", "body": "<p>You could first decode the URL with <a href=\"https://golang.org/pkg/net/url/#QueryUnescape\" rel=\"nofollow noreferrer\"><code>net/url/QueryUnescape</code></a>.<br>\nIt does converts '<code>+</code>' into '<code></code>' (space).</p>\n\n<p>Then you can start splitting the decoded string, or use <a href=\"https://golang.org/pkg/net/url/#ParseRequestURI\" rel=\"nofollow noreferrer\"><code>net/url/#ParseRequestURI</code></a> and get the <a href=\"https://golang.org/pkg/net/url/#URL.Query\" rel=\"nofollow noreferrer\"><code>URL.Query</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 12, "last_activity_date": 1522472806, "last_edit_date": 1522472806, "creation_date": 1522472205, "answer_id": 49584397, "question_id": 49584307, "link": "https://stackoverflow.com/questions/49584307/how-to-parse-string-into-url-values-in-golang/49584397#49584397", "title": "How to parse string into url.Values in golang?", "body": "<p>You could use <code>url.ParseQuery</code> to convert the raw query to <code>url.Values</code> with unescaping</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    t := \"honeypot=&amp;name=Zelalem+Mekonen&amp;email=zola%40programmer.net&amp;message=Hello+And+this+is+a+test+message...\"\n    v, err := url.ParseQuery(t)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>map[honeypot:[] name:[Zelalem Mekonen] email:[zola@programmer.net] message:[Hello And this is a test message...]]\n</code></pre>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10952, "favorite_count": 2, "accepted_answer_id": 49584397, "answer_count": 2, "score": 7, "last_activity_date": 1559760975, "creation_date": 1522471179, "question_id": 49584307, "link": "https://stackoverflow.com/questions/49584307/how-to-parse-string-into-url-values-in-golang", "title": "How to parse string into url.Values in golang?", "body": "<p>Let's suppose i have the following string</p>\n\n<p><code>honeypot=&amp;name=Zelalem+Mekonen&amp;email=zola%40programmer.net&amp;message=Hello+And+this+is+a+test+message...</code></p>\n\n<p>and i want to convert it into <code>url.Values</code> struct and i have the following</p>\n\n<pre><code>data := url.Values{}\n\nparameters := strings.Split(request.Body, \"&amp;\")\n\nfor _, parameter := range parameters {\n\n    parts := strings.Split(parameter, \"=\")\n\n    data.Add(parts[0], parts[1])\n\n}\n</code></pre>\n\n<p>which does convert it into <code>url.Values</code> but the problem is that it doesn't convert url encoded values like <code>+</code> into space, so first <strong>is there a better way to parse this?</strong> then <strong>if not how do i convert url encoded string to normal string first?</strong></p>\n\n<p>Thank's For Your Help...o</p>\n"}, {"tags": ["go", "jwt", "jwt-go"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1522482723, "post_id": 49584141, "comment_id": 86178932, "body": "I can&#39;t see the check for exp anywhere in your code, what&#39;s the exact error message are you getting?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1522650519, "post_id": 49584141, "comment_id": 86219381, "body": "@vitr jwt.Parse is giving &quot;signature is invalid&quot; when I logged it in console. Also in token object, returned by jwt.Parse(), it gives token.Valid field as false."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1522651170, "post_id": 49584141, "comment_id": 86219632, "body": "@vitr Also following is the value of exp I am getting after logging jwt claims: map[email:EMAIL exp:1.522677136e+09 ip:IP user_agent:Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0]"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1522665811, "post_id": 49584141, "comment_id": 86225871, "body": "look inside jwt.Parse code, what package do you use? as you didn&#39;t include any imports in your code. Obviously, <i>&#39;signature is invalid&#39;</i> isn&#39;t the same case as <i>&#39;expired&#39;</i>"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1522728208, "post_id": 49584141, "comment_id": 86250889, "body": "@vitr I have edited the code for package inclusion."}], "answers": [{"tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": false, "score": 1, "last_activity_date": 1522738022, "creation_date": 1522738022, "answer_id": 49623853, "question_id": 49584141, "link": "https://stackoverflow.com/questions/49584141/gos-jwt-token-expires-when-i-compile-new-code/49623853#49623853", "title": "Go&#39;s JWT token expires when I compile new code", "body": "<p>I suspect, there is something wrong with your session</p>\n\n<pre><code>_, err := merchantDb.GetSession(bson.M{\"token\": bearerToken})\n</code></pre>\n\n<p>or something else, as you didn't share the full code. Perhaps, your SigningKeys are not consistent between the builds.\nI wrote a small test for you to prove that jwt tokens don't expire between go builds</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/dgrijalva/jwt-go\"\n    \"time\"\n)\n\nfunc CreateToken() (string, error) {\n\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, &amp;jwt.MapClaims{\n        \"email\":      \"test@email.com\",\n        \"exp\":        time.Now().Add(time.Hour * 240).Unix(),\n        //\"exp\":        time.Now().Add(-time.Hour * 8).Unix(),\n        \"role\":       \"test role\",\n        \"name\":       \"test name\",\n        \"ip\":         \"1.1.1.1\",\n        \"user_agent\": \"test agent\",\n        \"id\":         \"123\",\n    })\n\n    // Sign and get the complete encoded token as a string\n    tokenString, err := token.SignedString([]byte(\"AllYourBase\"))\n\n    return tokenString, err\n}\nfunc main() {\n\n    //tokenString,_ := CreateToken()\n    tokenString := \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InRlc3RAZW1haWwuY29tIiwiZXhwIjoxNTIzNjAwOTM1LCJpZCI6IjEyMyIsImlwIjoiMS4xLjEuMSIsIm5hbWUiOiJ0ZXN0IG5hbWUiLCJyb2xlIjoidGVzdCByb2xlIiwidXNlcl9hZ2VudCI6InRlc3QgYWdlbnQifQ.UCD3P5-ua3qgTvy_-7hmHEVPPZwFCbhmRJNqndBwtes\"\n    token, _ := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n        return []byte(\"AllYourBase\"), nil\n    })\n    fmt.Println(token)\n    fmt.Println(token.Valid)\n}\n</code></pre>\n\n<p>As you can check, the <code>tokenString</code> will be valid for the next 10 days wherever you run this code </p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1588058129, "creation_date": 1522469273, "last_edit_date": 1588058129, "question_id": 49584141, "link": "https://stackoverflow.com/questions/49584141/gos-jwt-token-expires-when-i-compile-new-code", "title": "Go&#39;s JWT token expires when I compile new code", "body": "<p>I am working on a SAAS based product which is built in Angular5 at front end. It uses Go's rest APIs to connect to DB and all back end functionality. I am using JWT token to authenticate the users on this system.</p>\n\n<p>On the back end, I am using Gin framework for API routing and response handling.</p>\n\n<p>The problem I am facing is that when ever I compile latest code on server. The token expires and it asks me to login again in order to generate new token.</p>\n\n<p>The code I am using to generate JWT is given below:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/dgrijalva/jwt-go\"\n    \"github.com/gin-gonic/contrib/sessions\"\n)\n\nfunc CreateToken(user models.User, c *gin.Context) (string, error){\n    var ip, userAgent string\n    keyError := config.InitKeys()\n    if keyError != nil{\n        return \"\", keyError\n    }\n    if values, _ := c.Request.Header[\"Ip\"]; len(values) &gt; 0 {\n        ip = values[0]\n    }\n\n    if values, _ := c.Request.Header[\"User-Agent\"]; len(values) &gt; 0{\n        userAgent = values[0]\n    }\n\n\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, &amp;jwt.MapClaims{\n        \"email\": user.EmailId,\n        \"exp\":   time.Now().Add(time.Hour * 8).Unix(),\n        \"role\": user.Role,\n        \"name\":  user.FirstName+\" \"+user.LastName,\n        \"ip\": ip,\n        \"user_agent\": userAgent,\n        \"id\": user.Id,\n    })\n\n    config.CurrentUserId    = user.Id\n    models.CurrentUser      = user\n\n    // Sign and get the complete encoded token as a string\n    tokenString, err        := token.SignedString([]byte(config.SignKey))\n\n    return tokenString, err\n}\n</code></pre>\n\n<p>And code to compare it with the token that is being sent in the header from front end is:</p>\n\n<pre><code>if values, _ := c.Request.Header[\"Authorization\"]; len(values) &gt; 0 {\n        bearer := strings.Split(c.Request.Header[\"Authorization\"][0], \"Bearer\")\n        bearerToken := strings.TrimSpace(bearer[1])\n        _, err := merchantDb.GetSession(bson.M{\"token\": bearerToken})\n        if err != nil{\n            errMsg := \"Failed: Unauthorized Access.\"\n            response := controllers.ResponseController{\n                config.FailureCode,\n                config.FailureFlag,\n                errMsg,\n                nil,\n            }\n            controllers.GetResponse(c, response)\n            c.Abort()\n        }else{\n\n            var ip, userAgent string\n            var ipCheck, userAgentCheck bool\n\n            if values, _ := c.Request.Header[\"Ip\"]; len(values) &gt; 0 {\n                ip = values[0]\n            }\n\n            if values, _ := c.Request.Header[\"User-Agent\"]; len(values) &gt; 0{\n                userAgent = values[0]\n            }\n\n            token, err := jwt.Parse(bearerToken, func(token *jwt.Token) (interface{}, error) {\n                return config.SignKey, nil\n            })\n            if len (token.Claims.(jwt.MapClaims)) &gt; 0{\n                for key, claim := range token.Claims.(jwt.MapClaims) {\n                    if key == \"ip\" {\n                        if claim == ip{\n                            ipCheck = true\n                        }\n                    }\n\n                    if key == \"user_agent\"{\n                        if claim == userAgent{\n                            userAgentCheck = true\n                        }\n                    }   \n\n                    if key == \"role\"{\n                        role = claim.(string)\n                    }\n\n                    if key == \"id\"{\n                        userId = claim.(float64)\n                    }\n                    if key == \"name\"{\n                        userName = claim.(string)\n                    }\n                }\n            }\n            merchantDatabase[\"userid\"] = userId\n            merchantDatabase[\"role\"] = role\n            merchantDatabase[\"username\"] = userName\n            c.Keys = merchantDatabase\n            if err == nil &amp;&amp; token.Valid &amp;&amp; ipCheck == true &amp;&amp; userAgentCheck == true {\n                c.Next()\n            } else {\n                errMsg := \"Failed: Invalid Token.\"\n                response := controllers.ResponseController{\n                    config.FailureCode,\n                    config.FailureFlag,\n                    errMsg,\n                    nil,\n                }\n                controllers.GetResponse(c, response)\n                c.Abort()\n            }\n        }\n    }else{\n        errMsg := \"Failed: Unauthorized Access.\"\n        response := controllers.ResponseController{\n            config.FailureCode,\n            config.FailureFlag,\n            errMsg,\n            nil,\n        }\n        controllers.GetResponse(c, response)\n        c.Abort()\n    }\n</code></pre>\n\n<p>This issue is consuming a lot of time. If issue is known to anyone, Please reply to this post.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8947834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d57d912a437465b51693fcf06d8a96?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Wilson", "link": "https://stackoverflow.com/users/8947834/jonathan-wilson"}, "edited": false, "score": 0, "creation_date": 1522497084, "post_id": 49584052, "comment_id": 86182520, "body": "Sorry maybe it wasn&#39;t clear. I understand I need to have {{}} in my template. I&#39;m wondering if I can avoid having two sets of them. Can I do this without assigning to a variable $a?"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1522510441, "post_id": 49584052, "comment_id": 86186531, "body": "You can use () inside the {{}} like this: {{ (index .Servers 1).lp1 }}"}, {"owner": {"reputation": 11, "user_id": 8947834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d57d912a437465b51693fcf06d8a96?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Wilson", "link": "https://stackoverflow.com/users/8947834/jonathan-wilson"}, "edited": false, "score": 0, "creation_date": 1522542826, "post_id": 49584052, "comment_id": 86195027, "body": "This is exactly what I was looking for thanks mgagnon!"}], "tags": [], "owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "is_accepted": false, "score": 1, "last_activity_date": 1522468254, "creation_date": 1522468254, "answer_id": 49584052, "question_id": 49583751, "link": "https://stackoverflow.com/questions/49583751/how-to-access-a-struct-slice-element-key-directly-in-a-template-file/49584052#49584052", "title": "How to access a struct slice element key directly in a template file", "body": "<p>Please refer this:\n<a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/</a></p>\n\n<p>You have to use {{}} in your HTML template, if you wish to access any Struct variable.</p>\n"}], "owner": {"reputation": 11, "user_id": 8947834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9d57d912a437465b51693fcf06d8a96?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Wilson", "link": "https://stackoverflow.com/users/8947834/jonathan-wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1522468254, "creation_date": 1522464602, "question_id": 49583751, "link": "https://stackoverflow.com/questions/49583751/how-to-access-a-struct-slice-element-key-directly-in-a-template-file", "title": "How to access a struct slice element key directly in a template file", "body": "<p>I am loading some template files and attempting to compile them with some structs I've defined. </p>\n\n<p>The following example is working. I'd like to know if there is a better way of formatting my <strong>templateFile</strong> to directly access <strong>config.Servers[1].Ip1</strong> without needing two sets of <strong>{{}}</strong></p>\n\n<p>templateFile:\n    {{$a := index .Servers 1 }}{{$a.Ip1}} some extra text</p>\n\n<p>learn.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\ntype Server struct {\n    Ip1 string\n    Ip2 string\n}\n\ntype Configuration struct {\n    Servers []Server\n}\n\nfunc main() {\n    someServers := []Server{\n        {\n            Ip1: \"1.1.1.1\",\n            Ip2: \"2.2.2.2\",\n        },\n        {\n            Ip1: \"3.3.3.3\",\n            Ip2: \"4.4.4.4\",\n        },\n    }\n    config := Configuration{\n        Servers: someServers,\n    }\n\n    tmpl, err := template.ParseFiles(\"./templateFile\")\n    if err != nil {\n        panic(err)\n    }\n    err = tmpl.Execute(os.Stdout, config)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["linux", "ubuntu", "go", "tensorflow"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1522461518, "post_id": 49583327, "comment_id": 86175060, "body": "You don&#39;t even tell us what the error is! What is your problem? How can we reproduce it?"}, {"owner": {"reputation": 85, "user_id": 3532975, "user_type": "registered", "profile_image": "https://graph.facebook.com/1073072257/picture?type=large", "display_name": "KeiD", "link": "https://stackoverflow.com/users/3532975/keid"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1522464231, "post_id": 49583327, "comment_id": 86175481, "body": "Hi @peterSO , sorry about forgetting to add the error in! I have updated my question!"}], "answers": [{"tags": [], "owner": {"reputation": 1634, "user_id": 8180401, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3fed8ee5eeed1edb427e4032cca93de5?s=128&d=identicon&r=PG&f=1", "display_name": "LaSul", "link": "https://stackoverflow.com/users/8180401/lasul"}, "is_accepted": false, "score": 0, "last_activity_date": 1545233140, "creation_date": 1545233140, "answer_id": 53854330, "question_id": 49583327, "link": "https://stackoverflow.com/questions/49583327/cant-install-go-tensorflow/53854330#53854330", "title": "Can&#39;t install Go Tensorflow", "body": "<p>You need to install the <a href=\"https://www.tensorflow.org/install/lang_c\" rel=\"nofollow noreferrer\">C library</a> first ! </p>\n\n<p>Look at the doc :</p>\n\n<p><a href=\"https://i.stack.imgur.com/fMzE4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fMzE4.png\" alt=\"enter image description here\"></a></p>\n\n<p>Assuming you're on linux without GPU, just do :</p>\n\n<pre><code>wget https://storage.googleapis.com/tensorflow/libtensorflow/libtensorflow-cpu-linux-x86_64-1.12.0.tar.gz\n\nsudo tar -xzf libtensorflow-cpu-linux-x86_64-1.12.0.tar.gz -C /usr/local\n\nsudo ldconfig\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 3532975, "user_type": "registered", "profile_image": "https://graph.facebook.com/1073072257/picture?type=large", "display_name": "KeiD", "link": "https://stackoverflow.com/users/3532975/keid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 469, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1545233140, "creation_date": 1522459422, "last_edit_date": 1522464172, "question_id": 49583327, "link": "https://stackoverflow.com/questions/49583327/cant-install-go-tensorflow", "title": "Can&#39;t install Go Tensorflow", "body": "<p>I'm trying to install Tensorflow Go on a Linux Ubuntu machine.</p>\n\n<p>I have done the first 3 steps in the <a href=\"https://www.tensorflow.org/versions/master/install/install_go\" rel=\"nofollow noreferrer\">Installation guide</a> and am currently at step 4. </p>\n\n<p>Everything above 4) works, but I couldn't run \"go get github.com/tensorflow/tensorflow/tensorflow/go\" as instructed. The error that I'm having is:</p>\n\n<pre><code>/usr/bin/ld: cannot find -ltensorflow\ncollect2: error: ld returned 1 exit status\nExited with code 2 \n</code></pre>\n\n<p>I'm pretty sure my environment path variables are configured correctly, as seen below:</p>\n\n<pre><code>sudo ldconfig -p | grep tensorflow\n        libtensorflow_framework.so (libc6,x86-64) =&gt; /usr/local/lib/libtensorflow_framework.so\n        libtensorflow.so (libc6,x86-64) =&gt; /usr/local/lib/libtensorflow.so\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 1, "creation_date": 1522448336, "post_id": 49582094, "comment_id": 86172343, "body": "<a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 3591, "user_id": 4107956, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/LjlBF.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/4107956/will"}, "edited": false, "score": 1, "creation_date": 1522448625, "post_id": 49582094, "comment_id": 86172429, "body": "<a href=\"http://goinbigdata.com/golang-pass-by-pointer-vs-pass-by-value/\" rel=\"nofollow noreferrer\">goinbigdata.com/golang-pass-by-pointer-vs-pass-by-value</a>  I <i>think</i> you just need <code>completeArray(&amp;someArray, 1)</code>"}, {"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1522449612, "post_id": 49582094, "comment_id": 86172701, "body": "@dave there you have it."}, {"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1522777530, "post_id": 49582094, "comment_id": 86279866, "body": "Dont know why people downvotes it."}], "answers": [{"comments": [{"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1522777499, "post_id": 49582465, "comment_id": 86279844, "body": "Great. Thanks for introducing me to waitgroups."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1522450667, "creation_date": 1522450667, "answer_id": 49582465, "question_id": 49582094, "link": "https://stackoverflow.com/questions/49582094/passing-an-array-as-value-in-a-goroutine-function-does-nothing/49582465#49582465", "title": "Passing an array as value in a Goroutine function does nothing", "body": "<p>When you put <code>go</code> in front of it, it runs it in a separate goroutine (similar to a thread), and the current code path continues - they are running at the same time.</p>\n\n<p>This means, that when you do <code>fmt.Println(someArray)</code>, you have no guarantee that <code>DoSomethingWithArray</code> has completed.  In this instance, you could use a <code>sync.WaitGroup</code>, to let your current thread wait until the other code has completed:</p>\n\n<p><a href=\"https://play.golang.org/p/zClukrHNdpM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zClukrHNdpM</a></p>\n\n<pre><code>var wg sync.WaitGroup\nfunc main() {\n    someArray := Empty2DArray(4)\n    wg.Add(1)\n    go DoSomethingWithArray(4,0,someArray)\n    wg.Wait()\n    fmt.Println(someArray)\n}\n\nfunc DoSomethingWithArray(aSize, threadID int, mapArray [][]int) {\n    //your code\n    wg.Done()\n}\n</code></pre>\n"}], "owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 49582465, "answer_count": 1, "score": -3, "last_activity_date": 1522450667, "creation_date": 1522448122, "last_edit_date": 1522449296, "question_id": 49582094, "link": "https://stackoverflow.com/questions/49582094/passing-an-array-as-value-in-a-goroutine-function-does-nothing", "title": "Passing an array as value in a Goroutine function does nothing", "body": "<p>I have something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n// Empty2DArray returns a zeroed 2D array.\nfunc Empty2DArray(arraySize int) [][]int {\n    emptyArray := make([][]int, arraySize)\n    for y := 0; y &lt; arraySize; y++ {\n        row := make([]int, arraySize)\n        for x := 0; x &lt; arraySize; x++ {\n            row[x] = 0\n        }\n        emptyArray[y] = row\n    }\n    return emptyArray\n}\n\nfunc DoSomethingWithArray(aSize, threadID int, mapArray [][]int) {\n\n    var start, end int\n\n    switch threadID {\n    case 0: // unique thread\n        start = 0\n        end = aSize\n    case 1: // 1 and 2 when using more than 1 and less than 2 threads.\n        start = 0\n        end = aSize / 2\n    case 2:\n        start = aSize/2 + 1\n        end = aSize\n    }\n\n    for j := start; j &lt; end; j++ {\n        for i := 0; i &lt; aSize; i++ {\n            mapArray[i][j] = 1\n        }\n    }\n}\n\nfunc main() {\n\n    someArray := Empty2DArray(4)\n    DoSomethingWithArray(4, 0, someArray) // this works\n    //  go DoSomethingWithArray(4,0,someArray) // this doesnt\n    fmt.Println(someArray)\n}\n</code></pre>\n\n<p>If i do this i get nothing new in someArray, just the zeroes i got in the initialization. I'm sure i need a channel to communicate between the goroutines and the receiving array, but I'm clueless.</p>\n\n<p>Any tips?</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: some working code</p>\n"}, {"tags": ["rest", "go", "routing"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1522444626, "creation_date": 1522444626, "answer_id": 49581555, "question_id": 49581433, "link": "https://stackoverflow.com/questions/49581433/how-to-pass-two-or-more-parameters-using-julienschmidt-httprouter-in-golang/49581555#49581555", "title": "How to pass two or more parameters using julienschmidt/httprouter in golang?", "body": "<p>Just add in another parameter:</p>\n\n<pre><code>router.GET(\"/hello/:first_name/:last_name\", Hello)\n\nfunc Hello(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    fmt.Fprintf(w, \"hello, %s %s!\\n\", ps.ByName(\"first_name\"), ps.ByName(\"last_name\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1578, "favorite_count": 0, "accepted_answer_id": 49581555, "answer_count": 1, "score": 0, "last_activity_date": 1522444626, "creation_date": 1522443923, "question_id": 49581433, "link": "https://stackoverflow.com/questions/49581433/how-to-pass-two-or-more-parameters-using-julienschmidt-httprouter-in-golang", "title": "How to pass two or more parameters using julienschmidt/httprouter in golang?", "body": "<p>I am new to golang and using julienschmidt/httprouter for routing.\n    based on below snippet, able to send one parameter.\n    but I am little confused to send multiple parameters, cloud anyone helps me.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n    \"log\"\n)\n\nfunc Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    fmt.Fprint(w, \"Welcome!\\n\")\n}\n\nfunc Hello(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    fmt.Fprintf(w, \"hello, %s!\\n\", ps.ByName(\"name\"))\n}\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/\", Index)\n    router.GET(\"/hello/:name\", Hello)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n"}, {"tags": ["go", "redis", "publish-subscribe", "grpc", "http2"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1522440624, "post_id": 49580793, "comment_id": 86169483, "body": "Keep a list of connected clients."}, {"owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522440839, "post_id": 49580793, "comment_id": 86169575, "body": "<a href=\"https://stackoverflow.com/questions/41583218/grpc-client-id-or-connection-information\" title=\"grpc client id or connection information\">stackoverflow.com/questions/41583218/&hellip;</a> says that there is no actual unique identifier for clients"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522440918, "post_id": 49580793, "comment_id": 86169600, "body": "And as the answer to the question you just linked states, &quot;One possible solution is handshake protocol in app level. You can add rpc method &#39;Connect&#39; and send clientId as response from server. After that you can attach custom headers (metadata) to your rpc calls.&quot;"}, {"owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522441102, "post_id": 49580793, "comment_id": 86169670, "body": "mhm...sorry I missed that. I was thinking that maybe using gRPC supported bi-directional streams would be the answer, but I suppose something like a list of clients would work (albeit it feels weird to have to cycle through all of them each time a request is made to the server)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1522441689, "post_id": 49580793, "comment_id": 86169908, "body": "If you want to broadcast a message to all clients, you&#39;ll have to cycle through them - I don&#39;t see any way that could be avoidable."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2172, "user_id": 2661419, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/iPQFJ.jpg?s=128&g=1", "display_name": "Venelin", "link": "https://stackoverflow.com/users/2661419/venelin"}, "edited": false, "score": 0, "creation_date": 1601384780, "post_id": 49580793, "comment_id": 113386387, "body": "@VenelinVasilev if you have a question, please post a new question rather than posting as a comment on a question from two years ago. That way more people will be able to see &amp; answer it."}, {"owner": {"reputation": 2172, "user_id": 2661419, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/iPQFJ.jpg?s=128&g=1", "display_name": "Venelin", "link": "https://stackoverflow.com/users/2661419/venelin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1601384833, "post_id": 49580793, "comment_id": 113386418, "body": "@Adrian I do have, please take a look: <a href=\"https://stackoverflow.com/questions/64118630/c-grpc-how-to-get-list-of-all-connected-clients\" title=\"c grpc how to get list of all connected clients\">stackoverflow.com/questions/64118630/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2172, "user_id": 2661419, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/iPQFJ.jpg?s=128&g=1", "display_name": "Venelin", "link": "https://stackoverflow.com/users/2661419/venelin"}, "edited": false, "score": 0, "creation_date": 1601385083, "post_id": 49580793, "comment_id": 113386549, "body": "@VenelinVasilev that question isn&#39;t even about the same language. I&#39;m not a C++ dev so I won&#39;t be much help. Good luck!"}], "answers": [{"comments": [{"owner": {"reputation": 2172, "user_id": 2661419, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/iPQFJ.jpg?s=128&g=1", "display_name": "Venelin", "link": "https://stackoverflow.com/users/2661419/venelin"}, "edited": false, "score": 0, "creation_date": 1601381269, "post_id": 49659777, "comment_id": 113384670, "body": "How can I get the connected stream so I can put it list ?"}], "tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": false, "score": 3, "last_activity_date": 1522873384, "creation_date": 1522873384, "answer_id": 49659777, "question_id": 49580793, "link": "https://stackoverflow.com/questions/49580793/how-to-broadcast-in-grpc-from-server-to-client/49659777#49659777", "title": "How to broadcast in gRPC from server to client?", "body": "<p>Yup, I don't see any other way than keeping a global data structure containing all the connected streams and looping through them, telling each about the even that just occurred.</p>\n"}, {"tags": [], "owner": {"reputation": 1902, "user_id": 2946480, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1410130b0742994273f53d17e0fb9360?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142", "link": "https://stackoverflow.com/users/2946480/micha%c5%82"}, "is_accepted": false, "score": 4, "last_activity_date": 1547460539, "last_edit_date": 1547460539, "creation_date": 1523032939, "answer_id": 49697489, "question_id": 49580793, "link": "https://stackoverflow.com/questions/49580793/how-to-broadcast-in-grpc-from-server-to-client/49697489#49697489", "title": "How to broadcast in gRPC from server to client?", "body": "<p>Another option would be to use a long-polling approach. That is try something like below (code in Python, since that is what I'm most familiar with, but go should be very similar). This was not tested, and is meant to just give you an idea of how to do long-polling in gRPC:</p>\n\n<pre><code>.PROTO defs\n-------------------------------------------------\nservice Updater {\n    rpc GetUpdates(GetUpdatesRequest) returns (GetUpdatesResponse);\n}\n\nmessage GetUpdatesRequest {\n    int64 last_received_update = 1;\n}\n\nmessage GetUpdatesResponse {\n    repeated Update updates = 1;\n    int64 update_index = 2;\n}\n\nmessage Update {\n    // your update structure\n}\n\n\nSERVER\n-----------------------------------------------------------\nclass UpdaterServer(UpdaterServicer):\n    def __init__(self):\n        self.condition = threading.Condition()\n        self.updates = []\n\n    def post_update(self, update):\n        \"\"\"\n        Used whenever the clients should be updated about something. It will\n        trigger their long-poll calls to return\n        \"\"\"\n        with self.condition:\n            # TODO: You should probably remove old updates after some time\n            self.updates.append(updates)\n            self.condition.notify_all()\n\n    def GetUpdates(self, req, context):\n        with self.condition:\n            while self.updates[req.last_received_update + 1:] == []:\n                self.condition.wait()\n            new_updates = self.updates[req.last_received_update + 1:]\n            response = GetUpdatesResponse()\n            for update in new_updates:\n                response.updates.add().CopyFrom(update)\n            response.update_index = req.last_received_update + len(new_updates)\n            return response\n\n\nSEPARATE THREAD IN THE CLIENT\n----------------------------------------------\nrequest = GetUpdatesRequest()\nrequest.last_received_update = -1\nwhile True:\n    stub = UpdaterStub(channel)\n    try:\n        response = stub.GetUpdates(request, timeout=60*10)\n        handle_updates(response.updates)\n        request.last_received_update = response.update_index\n    except grpc.FutureTimeoutError:\n        pass\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 774, "user_id": 2356048, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb8c65583543cbd1de0a1492cf605e0c?s=128&d=identicon&r=PG", "display_name": "Sven Bardos", "link": "https://stackoverflow.com/users/2356048/sven-bardos"}, "is_accepted": false, "score": 1, "last_activity_date": 1544559688, "creation_date": 1544559688, "answer_id": 53731777, "question_id": 49580793, "link": "https://stackoverflow.com/questions/49580793/how-to-broadcast-in-grpc-from-server-to-client/53731777#53731777", "title": "How to broadcast in gRPC from server to client?", "body": "<p>Another approach is to spawn a grpc-server on client side too. On app-level you have some handshake from client to server to exchange the clients grpc-server ip and port. You probably want to create a client for that address at this point and store the client in a list.</p>\n\n<p>Now you can push messages to the clients from the list with default unary RPC calls. No [bidi] stream needed.\nPros:</p>\n\n<ul>\n<li>Possible to separate the clients \"Push\"-API from the server API.</li>\n<li>Unary RPC push calls.</li>\n</ul>\n\n<p>Cons:</p>\n\n<ul>\n<li>Additional \"server\". Don't know if that is possible in every scenario.</li>\n</ul>\n"}], "owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9599, "favorite_count": 2, "answer_count": 3, "score": 5, "last_activity_date": 1547460539, "creation_date": 1522440587, "question_id": 49580793, "link": "https://stackoverflow.com/questions/49580793/how-to-broadcast-in-grpc-from-server-to-client", "title": "How to broadcast in gRPC from server to client?", "body": "<p>I'm creating a small chat application in gRPC right now and I've run into the issue where if a user wants to connect to the gRPC server as a client, I'd like to broadcast that the event has occurred to all other connected clients.</p>\n\n<p>I'm thinking of using some sort of observer but I\"m confused as to how the server knows of who is connected and how I would broadcast the event to all clients and not just one or two.</p>\n\n<p>I know using streams is part of the answer, but because each client is creating it's own stream with the server, I'm unsure of how it can subscribe to other server-client streams.</p>\n"}, {"tags": ["go", "tcp", "microservices"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522439393, "post_id": 49580394, "comment_id": 86168994, "body": "aside from performance, you&#39;re losing data and causing extra allocations in the server by discarding the <code>bufio.Reader</code>, you&#39;re not checking errors, not waiting for the server to complete, and only timing the write calls which are not going to be flushed before the process exits."}, {"owner": {"reputation": 324, "user_id": 3526468, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/727862912/picture?type=large", "display_name": "user3526468", "link": "https://stackoverflow.com/users/3526468/user3526468"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1522439926, "post_id": 49580394, "comment_id": 86169201, "body": "I just tried a bufWriter, and speed indeed increased significantly (500ms for a million writes). So I guess that&#39;s the way to do it. In my original code I was handling errors, just tried to simplify the example as much as possible."}], "answers": [{"comments": [{"owner": {"reputation": 1126, "user_id": 4595674, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-sZKhhu4m_Eo/AAAAAAAAAAI/AAAAAAAAAN0/wjo2wquXsXU/photo.jpg?sz=128", "display_name": "Albi", "link": "https://stackoverflow.com/users/4595674/albi"}, "edited": false, "score": 0, "creation_date": 1537418663, "post_id": 49580791, "comment_id": 91778546, "body": "I have an issue, When I&#39;m sending large data over TCP, the parsing is failing, the same data if i send in small size this become success, Why is this happening?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1522440584, "creation_date": 1522440584, "answer_id": 49580791, "question_id": 49580394, "link": "https://stackoverflow.com/questions/49580394/sending-millions-of-short-messages-over-tcp-socket-in-golang/49580791#49580791", "title": "sending millions of short messages over tcp socket in golang", "body": "<p>Syscalls are expensive, and writing data over loopback is very fast, so this is essentially just timing how fast you can make 1 million calls to <code>write</code>.</p>\n\n<p>Making lots of small reads and writes is the primary use case for using buffered io. Wrapping the normal <code>net.TCPConn</code> in a <a href=\"https://golang.org/pkg/bufio/#NewWriter\" rel=\"noreferrer\"><code>bufio.Writer</code></a> will provide the expected performance increase.</p>\n"}], "owner": {"reputation": 324, "user_id": 3526468, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/727862912/picture?type=large", "display_name": "user3526468", "link": "https://stackoverflow.com/users/3526468/user3526468"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3592, "favorite_count": 2, "accepted_answer_id": 49580791, "answer_count": 1, "score": 1, "last_activity_date": 1522440584, "creation_date": 1522438645, "question_id": 49580394, "link": "https://stackoverflow.com/questions/49580394/sending-millions-of-short-messages-over-tcp-socket-in-golang", "title": "sending millions of short messages over tcp socket in golang", "body": "<p>I'm writing two services in golang that need to send to each other about 2 million messages per second. Each message is about 50 bytes, so throughput should only be about 100MB/s. I want to use tcp for this. However, results are very slow. I configured SetNoDelay(false) to make sure that data is buffered before sending, but that didn't make any difference. </p>\n\n<p>I can only send about 50k messages per second, and message size doesn't matter too much, so I assume the code is blocking somewhere. Here's my test code:</p>\n\n<pre><code>package main\n\nimport \"net\"\nimport \"fmt\"\nimport \"bufio\"\nimport (\n    //\"strings\"\n    \"time\"\n)\n\nfunc startserver() {\n    fmt.Println(\"Launching server...\")\n    ln, _ := net.Listen(\"tcp\", \":8081\")\n    conn, _ := ln.Accept()\n\n    for {\n        bufio.NewReader(conn).ReadString('\\n')\n        //fmt.Println(message)\n        //newmessage := strings.ToUpper(message)\n        //conn.Write([]byte(newmessage + \"\\n\"))\n    }\n}\n\nfunc startclient() {\n    time.Sleep(time.Second) // so that server has time to start\n    servAddr := \"127.0.0.1:8081\"\n    tcpAddr, _ := net.ResolveTCPAddr(\"tcp\", servAddr)\n    conn, _ := net.DialTCP(\"tcp\", nil, tcpAddr)\n    conn.SetNoDelay(false)\n    conn.SetWriteBuffer(10000)\n    msg := \"abc\\n\"\n    start := time.Now()\n    for i := 0; i &lt; 1000000; i++ {\n        conn.Write([]byte(msg))\n        //bufio.NewReader(conn).ReadString('\\n')\n        //fmt.Print(\"Message from server: \", response)\n    }\n    fmt.Println(\"took:\", time.Since(start))\n}\n\nfunc main() {\n    go startserver()\n    startclient()\n}\n</code></pre>\n\n<p>Any suggestion?</p>\n"}, {"tags": ["mongodb", "go", "mgo", "fasthttp"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522436998, "post_id": 49579782, "comment_id": 86167903, "body": "Is it actually the MongoDB calls that are slower? Or request handling overall? Have you profiled it using <code>pprof</code> to see where the hotspots are?"}, {"owner": {"reputation": 11594, "user_id": 795896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/SEIkR.jpg?s=128&g=1", "display_name": "Aidan Ewen", "link": "https://stackoverflow.com/users/795896/aidan-ewen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522437407, "post_id": 49579782, "comment_id": 86168087, "body": "Thanks @Adrian - I\u2019ll have a look at pprof and see if I can get more info. (Currently I\u2019m just running a timing function - I start the clock before the find call and stop it immediately afterwards)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522437801, "post_id": 49579782, "comment_id": 86168272, "body": "I do notice that the calls are not identical. In Go you&#39;re doing an additional sort &amp; limit which you do not do in the PHP code."}, {"owner": {"reputation": 11594, "user_id": 795896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/SEIkR.jpg?s=128&g=1", "display_name": "Aidan Ewen", "link": "https://stackoverflow.com/users/795896/aidan-ewen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522437882, "post_id": 49579782, "comment_id": 86168317, "body": "Sorry the php does the sort and limit too. I\u2019ll update my question"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522437903, "post_id": 49579782, "comment_id": 86168328, "body": "Also note that your Go code is also retrieving all results and decoding the BSON into objects, which is not included in the shown PHP code, which ends at the point where it receives a cursor in order to begin retrieving results."}, {"owner": {"reputation": 11594, "user_id": 795896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/SEIkR.jpg?s=128&g=1", "display_name": "Aidan Ewen", "link": "https://stackoverflow.com/users/795896/aidan-ewen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522438372, "post_id": 49579782, "comment_id": 86168573, "body": "The two services return the same data in the same format. The Golang service spends 90% of the time in the find function. And it\u2019s taken an average of 512ms over a 12 hour period. The php service took an average of 123ms over that 12 hour period."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1522438938, "post_id": 49579782, "comment_id": 86168816, "body": "I don&#39;t see anything offhand to cause a performance issue, but there&#39;s not a lot to go on. I would definitely profile it. I know from experience that mgo adds very little overhead to queries."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522442519, "post_id": 49579782, "comment_id": 86170263, "body": "How large is the limit in practice? Does it help at all if you allocate the results slice with the respective capacity?"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1522463162, "post_id": 49579782, "comment_id": 86175310, "body": "@AidanEwen what is your  GOMAXPROCS value? Some of the design decisions on  mgo were made with scalability and concurrency in mind. It performs  well if you allow it to use more threads. please, have a read  about similar issue here <a href=\"https://groups.google.com/forum/#!topic/mgo-users/wkEE7LNpWpc\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/mgo-users/wkEE7LNpWpc</a>"}, {"owner": {"reputation": 23612, "user_id": 147407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/65f858d8a973f4ee8d97517a21a17e7d?s=128&d=identicon&r=PG", "display_name": "Andrejs Cainikovs", "link": "https://stackoverflow.com/users/147407/andrejs-cainikovs"}, "edited": false, "score": 0, "creation_date": 1522616563, "post_id": 49579782, "comment_id": 86212345, "body": "Have you tried to compare performance with aggregation?"}], "owner": {"reputation": 11594, "user_id": 795896, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/SEIkR.jpg?s=128&g=1", "display_name": "Aidan Ewen", "link": "https://stackoverflow.com/users/795896/aidan-ewen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 375, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1527044555, "creation_date": 1522435720, "last_edit_date": 1527044555, "question_id": 49579782, "link": "https://stackoverflow.com/questions/49579782/why-are-my-mgo-queries-running-slower-than-they-do-in-php", "title": "Why are my mgo queries running slower than they do in php", "body": "<p>I've swapped an endpoint from our PHP 7 app to a new Go service. The service takes a geographic bounding box and returns properties from a mongo database. The problem is that it's currently taking 4-5 times as long as the old PHP service took to do the same thing. ~90% of the time is spent in the GetProps function below.</p>\n\n<pre><code>var session *mgo.Session\n\nfunc connectToDB() *mgo.Session {\n    dialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{\"xxx1.mongodb.net:27017\", \"xxx2.mongodb.net:27017\", \"xxx3.mongodb.net:27017\"},\n        Database: \"admin\",\n        Username: \"me\",\n        Password: \"xxx\",\n        DialServer: func(addr *mgo.ServerAddr) (net.Conn, error) {\n            return tls.Dial(\"tcp\", addr.String(), &amp;tls.Config{})\n        },\n        Timeout: time.Second * 10,\n    }\n    session, err := mgo.DialWithInfo(dialInfo)\n    if err != nil {\n        log.Panic(err)\n    }\n    session.SetMode(mgo.Monotonic, true)\n    return session\n}\n\nfunc GetProps(propRequest Request) []Property {\n    results := make([]Property, 0)\n    sessionCopy := session.Copy()\n    defer sessionCopy.Close()\n    props := sessionCopy.DB(\"mapov\").C(\"properties\")\n    props.Find(bson.M{\n        \"geo\": bson.M{\n            \"$geoWithin\": bson.M{\n                \"$geometry\": bson.M{\n                    \"type\":        \"Polygon\",\n                    \"coordinates\": propRequest.BoundingPoly,\n                },\n            },\n        },\n    }).Sort(\"-rank\").Limit(propRequest.CpPropsRequired).All(&amp;results)\n    return results\n}\n\nfunc init() {\n    session = connectToDB()\n}\n</code></pre>\n\n<p>The PHP 7 service does pretty much the same thing -</p>\n\n<pre><code>$collection = $mapovdb-&gt;properties; \n$query = ['geo' =&gt; [\n  '$geoWithin' =&gt; [\n    '$geometry' =&gt; [\n      'type' =&gt; 'Polygon',\n      'coordinates' =&gt; $boundingPoly\n    ]\n  ]\n]];\n\n$cursor = $collection-&gt;find( $query, $queryOptions); // $queryOptions includes the matching sort and limit \n</code></pre>\n\n<p>But it's way quicker (I ran the two services next to each other for 12 hours randomising the traffic).</p>\n\n<p>I tried changing my property struct so it just takes a single field, but that didn't seem to affect the performance.</p>\n\n<pre><code>type Property struct {\n    Name         string    `bson:\"name\" json:\"name\"`\n}\n</code></pre>\n\n<p>What am I doing wrong? Surely I should be able to match the performance of the php7 driver?</p>\n\n<p>UPDATE</p>\n\n<p>I've swapped out the builtin http library for <a href=\"http://%22http://github.com/valyala/fasthttp%22\" rel=\"nofollow noreferrer\">fasthttp</a>. This seems to have made everything faster. I haven't had time to work out why yet (but will come back here when I do). My current theory is that the builtin http library creates a new goroutine for each new tcp connection not each new http connection and this is causing my db queries to queue - either because the load balancer is reusing tcp connections, or because the client is reusing them (http/2?).</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1522435712, "post_id": 49579756, "comment_id": 86167293, "body": "The empty interface <code>interface{}</code> has no methods. Is there a reason why you are using argument type <code>interface{}</code> instead of &#39;*Person`?"}, {"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522436162, "post_id": 49579756, "comment_id": 86167490, "body": "Because I want to make it as generic/dynamic function that accepts any struct type @CeriseLim&#243;n"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1522436390, "post_id": 49579756, "comment_id": 86167600, "body": "@Angger you need to implement the interface on <code>setter</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1522437028, "post_id": 49579756, "comment_id": 86167917, "body": "@Angger Update the question to state your actual goal."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1522437132, "post_id": 49579756, "comment_id": 86167959, "body": "It can&#39;t be totally generic. You can&#39;t call <code>SetName</code> on something with no <code>SetName</code> method. If you want to call <code>SetName</code> in the function, you have to specify that the argument is, at the very least, an interface that includes <code>SetName</code> with the same signature."}], "answers": [{"comments": [{"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1522470925, "post_id": 49579804, "comment_id": 86176598, "body": "Can I make &quot;SetName&quot; func as dynamic too? coz I want everything that pass through SomeMethod automatically can use SetName method. @Himanshu"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1522513106, "post_id": 49579804, "comment_id": 86187477, "body": "@Angger There is no automatic way to call a method. You have to call the method on given object encapsulated by <code>Human</code> interface."}, {"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1522540609, "post_id": 49579804, "comment_id": 86194651, "body": "but the SetName method inside Human is only belongs to Person. I want to make this SetName method also applied to any struct passes to SomeMethod? @Himanshu"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1522566538, "post_id": 49579804, "comment_id": 86198631, "body": "@Angger It will be apply to any struct you pass inside the interface. Check updated code with getter to get the name you pass."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1522566666, "last_edit_date": 1522566666, "creation_date": 1522435815, "answer_id": 49579804, "question_id": 49579756, "link": "https://stackoverflow.com/questions/49579756/modify-struct-value-inside-dynamic-struct-function-golang/49579804#49579804", "title": "Modify struct value inside dynamic struct function Golang", "body": "<p>Create an interface with <code>setName</code> and implement it on <code>Person</code> struct then call <code>SomeMethod</code> to set the value of <code>Person</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Person struct {\n   Name string\n   Age int\n}\n\ntype Human interface{\n    SetName(name string)\n}\n\nfunc (p *Person) SetName(name string) {\n   p.Name = name\n}\n\nfunc SomeMethod(human Human){\n   human.SetName(\"Johnson\")\n}\n\nfunc main(){\n   p := &amp;Person{Name : \"Musk\"}\n   SomeMethod(p)\n   fmt.Println(p)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/SHgny1zWWs0\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p>To get the name using getter method for any struct pass through Human interface implement getter property on <code>Human</code> interface</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    )\n\ntype Person struct {\n   Name string\n   Age int\n}\n\ntype Person2 struct{\n   Name string\n   Age int\n}\n\ntype Human interface{\n    getName() string\n}\n\nfunc (p *Person2) getName() string{\n   return p.Name\n}\n\nfunc (p *Person) getName() string{\n   return p.Name\n}\n\nfunc SomeMethod(human Human){\n   fmt.Println(human.getName())\n}\n\nfunc main(){\n   p := &amp;Person{Name : \"Musk\"}\n   SomeMethod(p)\n   p2 := &amp;Person2{Name: \"Joe\"}\n   SomeMethod(p2)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/R0bXpb_ydDl\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2208, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1531403975, "creation_date": 1522435583, "last_edit_date": 1531403975, "question_id": 49579756, "link": "https://stackoverflow.com/questions/49579756/modify-struct-value-inside-dynamic-struct-function-golang", "title": "Modify struct value inside dynamic struct function Golang", "body": "<p>I have struct with setter function</p>\n\n<pre><code>package main\n\ntype Person struct {\n   Name string\n   Age int\n}\n\nfunc (p *Person) SetName(name string) {\n   p.Name = name\n}\n\nfunc SomeMethod(human interface{}){\n   // I call the setter function here, but doesn't seems exist\n   human.SetName(\"Johnson\")\n}\n\nfunc main(){\n   p := Person{Name : \"Musk\"}\n   SomeMethod(&amp;p)\n}\n</code></pre>\n\n<p>Got an error as follows :</p>\n\n<blockquote>\n  <p>human.SetName undefined (type interface {} is interface with no\n  methods)</p>\n</blockquote>\n\n<p>seems like func <code>SetName</code> doesn't included in <code>SomeMethod</code></p>\n\n<p>Why is it so? Any answer will be highly appreciated ! </p>\n"}, {"tags": ["go", "tensorflow"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1522433795, "post_id": 49579332, "comment_id": 86166402, "body": "Because indexing on interface is not possible. Get underlying type of interface using assertion and then get the value on index."}, {"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1522434176, "post_id": 49579332, "comment_id": 86166570, "body": "Could you post a code snippet for the same?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1522434208, "post_id": 49579332, "comment_id": 86166579, "body": "There are numerous questions and and answers here with that exact error message. What are you asking that isn&#39;t covered already?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1522434396, "post_id": 49579332, "comment_id": 86166679, "body": "@Vasanti get type of <code>result[0].Value()</code> using reflection as <code>fmt.Println(reflect.TypeOf(result[0].Value()))</code>. and then type assert that to get value"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1522434772, "post_id": 49579332, "comment_id": 86166866, "body": "@Himanshu: a tip for quickly checking the type of things, use <code>fmt.Printf</code> with <code>%#v</code> or  <code>%T</code>."}], "answers": [{"tags": [], "owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "is_accepted": false, "score": 1, "last_activity_date": 1523282341, "last_edit_date": 1523282341, "creation_date": 1522434682, "answer_id": 49579565, "question_id": 49579332, "link": "https://stackoverflow.com/questions/49579332/how-to-print-the-individual-element-value-of-an-interface-in-golang/49579565#49579565", "title": "How to print the individual element value of an interface in Golang", "body": "<p>Using type assertion, we can fetch the individual values by its index</p>\n\n<p><code>md := result[0].Value().([][]float32)\nfmt.Println(md[0][0])\nfmt.Println(md[0][1])</code></p>\n"}], "owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1089, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1523282341, "creation_date": 1522433547, "last_edit_date": 1522434107, "question_id": 49579332, "link": "https://stackoverflow.com/questions/49579332/how-to-print-the-individual-element-value-of-an-interface-in-golang", "title": "How to print the individual element value of an interface in Golang", "body": "<p>I have a piece of code which returns a [][]float32 value with a shape of [1,2]. Below is the code snippet.</p>\n\n<pre><code>  result, runErr := model.Session.Run(\n        map[tf.Output]*tf.Tensor{\n            model.Graph.Operation(\"x\").Output(0): tensor,\n        },\n        []tf.Output{\n            model.Graph.Operation(\"predict\").Output(0),\n        },\n        nil,\n  )\n  fmt.Println(result[0].Value())\n</code></pre>\n\n<p>The output of the following code is: </p>\n\n<pre><code>[[0 1]]\n</code></pre>\n\n<p>I need to access the individual elements 0 and 1, however when I try to fetch it using the following <code>fmt.Println(result[0].Value()[0][0])</code> it results in an error:</p>\n\n<blockquote>\n  <p>(type interface {} does not support indexing)</p>\n</blockquote>\n\n<p>How can I access the individual elements for my processing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "edited": false, "score": 2, "creation_date": 1522408903, "post_id": 49573389, "comment_id": 86154231, "body": "What is your question?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1522408906, "post_id": 49573389, "comment_id": 86154233, "body": "math.MaxInt64  = 1&lt;&lt;63 - 1"}, {"owner": {"reputation": 535, "user_id": 1436289, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/HRq26.png?s=128&g=1", "display_name": "xiaodong", "link": "https://stackoverflow.com/users/1436289/xiaodong"}, "edited": false, "score": 0, "creation_date": 1522409314, "post_id": 49573389, "comment_id": 86154427, "body": "@LutzHorn sorry, I have clarified my question"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522409605, "post_id": 49573389, "comment_id": 86154546, "body": "<code>fmt.Printf(&quot;%x&quot;, -10)</code> prints &quot;-a&quot;. Is that what throws you off?"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1522410395, "post_id": 49573389, "comment_id": 86154938, "body": "Why do you consider it being wrong to use a sign in front of a negative hex number when you apparently don&#39;t consider it being wrong in front of a negative decimal number?"}, {"owner": {"reputation": 535, "user_id": 1436289, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/HRq26.png?s=128&g=1", "display_name": "xiaodong", "link": "https://stackoverflow.com/users/1436289/xiaodong"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1522410993, "post_id": 49573389, "comment_id": 86155255, "body": "@Peter @md2perpe because in C/C++, <code>%x</code> will print the data in memory true hexadecimally (which means ignore the sign bit, and take 4 bit every time and converts it to hex code util exhausted whole bits). I think golang was consistent with C/C++ at this topic"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1522412822, "post_id": 49573389, "comment_id": 86156221, "body": "Yes, I can tell you why it looks unreasonable to you: You think Go should do everything like C."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": false, "score": 0, "last_activity_date": 1522410330, "last_edit_date": 1522410330, "creation_date": 1522409830, "answer_id": 49573700, "question_id": 49573389, "link": "https://stackoverflow.com/questions/49573389/format-printing-the-64bit-integer-1-as-hexadecimal-deviates-between-golang-and/49573700#49573700", "title": "Format printing the 64bit integer -1 as hexadecimal deviates between golang and C", "body": "<p><code>int64(math.MaxUint64)</code> overflows the range of <code>int64</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    var x uint64 = 1&lt;&lt;64 - 1\n    fmt.Printf(\"%v\\n\", math.MaxUint64 == x) // true\n\n    var y int64 = 1&lt;&lt;63 - 1\n    fmt.Printf(\"%v\\n\", math.MaxInt64 == y) // true\n\n    var z int64 = int64(x) // -1\n    fmt.Printf(\"%v\\n\", z)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/J6buiaaZcFt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J6buiaaZcFt</a></p>\n\n<p>see <a href=\"https://golang.org/pkg/math/#pkg-constants\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/#pkg-constants</a> and <a href=\"https://play.golang.org/p/iul2dgRbK2E\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iul2dgRbK2E</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1522413886, "last_edit_date": 1522413886, "creation_date": 1522412350, "answer_id": 49574308, "question_id": 49573389, "link": "https://stackoverflow.com/questions/49573389/format-printing-the-64bit-integer-1-as-hexadecimal-deviates-between-golang-and/49574308#49574308", "title": "Format printing the 64bit integer -1 as hexadecimal deviates between golang and C", "body": "<p>Go acts differently here than C for example. The <code>%x</code> verb for integers means to format the <em>value</em> of the number using the hexadecimal (base 16) representation, not its memory representation (which would be 2's complement). Same goes for <code>%b</code> for binary and <code>%o</code> for octal representation.</p>\n\n<p>For a negative number like <code>-255</code>, its base16 representation is <code>-ff</code>.</p>\n\n<p>Go is strict about types, you always have to be explicit. If you pass a signed integer, it will be formatted as a signed integer. If you want to print it as an unsigned value, you have to explicitly convert it to an unsigned value like in this example:</p>\n\n<pre><code>i := -1 // type int\nfmt.Printf(\"%d %x %d %x\", i, i, uint(i), uint(i))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/K8ncuXn-qom\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>-1 -1 4294967295 ffffffff\n</code></pre>\n\n<p>Note that when converting a signed value to its unsigned version (same size) it does not change the memory representation just its type, so the converted value (the unsigned result) will be the 2's complement of the signed value.</p>\n\n<p>As to why this is the default for negative numbers, read the reasoning given by Rob Pike <a href=\"https://groups.google.com/forum/#!topic/golang-dev/L5qWgEtebyY\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>Why is that not the default [the unsigned format]? Because if it were, there would be no way to print something as a negative number, which as you can see is a much shorter representation. Or to put it another way, %b %o %d %x all treat their arguments identically.</p>\n</blockquote>\n\n<p>You can see how / where this is implemented in this related question: <a href=\"https://stackoverflow.com/questions/37582550/golang-twos-complement-and-fmt-printf\">Golang: Two&#39;s complement and fmt.Printf</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1522415046, "creation_date": 1522415046, "answer_id": 49574991, "question_id": 49573389, "link": "https://stackoverflow.com/questions/49573389/format-printing-the-64bit-integer-1-as-hexadecimal-deviates-between-golang-and/49574991#49574991", "title": "Format printing the 64bit integer -1 as hexadecimal deviates between golang and C", "body": "<blockquote>\n  <p><strong>The C Programming Language, Second Edition</strong></p>\n  \n  <p>x,X int ; unsigned hexadecimal number (without a leading 0x or 0X ),\n  using abcdef or ABCDEF for 10, ...,15.</p>\n  \n  <p>x,X unsigned int ; unsigned hexadecimal notation (without a leading 0x\n  or 0X ), using abcdef for 0x or ABCDEF for 0X .</p>\n  \n  <p><strong>The GNU C Library Reference Manual, Version 2.27</strong></p>\n  \n  <p>\u2018%x\u2019, \u2018%X\u2019 Print an integer as an unsigned hexadecimal number. \u2018%x\u2019\n  uses lower-case letters and \u2018%X\u2019 uses upper-case.</p>\n</blockquote>\n\n<hr>\n\n<p><em>I am shocked- shocked- to find that integer conversions are going on here!</em></p>\n\n<p>In C, implicit conversions abound. In Go, by design, conversions are explicit.</p>\n\n<p>In C, printf implicitly converts a signed integer to unsigned for format <code>%x</code>. Go <code>fmt.Printf</code> does not.</p>\n\n<p>By design, Go is not C. Go does have similarities to C, which may trap the unwary.</p>\n"}], "owner": {"reputation": 535, "user_id": 1436289, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/HRq26.png?s=128&g=1", "display_name": "xiaodong", "link": "https://stackoverflow.com/users/1436289/xiaodong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1203, "favorite_count": 1, "closed_date": 1523041312, "answer_count": 3, "score": -1, "last_activity_date": 1522415046, "creation_date": 1522408612, "last_edit_date": 1522409265, "question_id": 49573389, "link": "https://stackoverflow.com/questions/49573389/format-printing-the-64bit-integer-1-as-hexadecimal-deviates-between-golang-and", "closed_reason": "Needs details or clarity", "title": "Format printing the 64bit integer -1 as hexadecimal deviates between golang and C", "body": "<p>I'm recently reading the <a href=\"https://golang.org/doc/effective_go.html#printing\" rel=\"nofollow noreferrer\">effective_go</a> document, and got shocked when reading the <em>Print</em> section:</p>\n\n<pre><code>var x uint64 = 1&lt;&lt;64 - 1\nfmt.Printf(\"%d %x; %d %x\\n\", x, x, int64(x), int64(x))\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>18446744073709551615 ffffffffffffffff; -1 -1\n</code></pre>\n\n<p>As a C programmer the expected output of <code>%x int64(x)</code> should also be <code>ffffffffffffffff</code>, so the above output is unreasonable to me, could anyone tell why?</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 5, "creation_date": 1522408521, "post_id": 49573233, "comment_id": 86154070, "body": "Ignoring anonymous functions: <code>grep ^func *.go</code>"}], "answers": [{"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 3, "last_activity_date": 1522434394, "creation_date": 1522434394, "answer_id": 49579501, "question_id": 49573233, "link": "https://stackoverflow.com/questions/49573233/list-all-functions-from-source-code/49579501#49579501", "title": "List all functions from source code", "body": "<p>Definitely Peter's answer is very much sufficient, but if you want to go down the rabbit hole... and for the fun of it. Using powers of golang std lib ast.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/ast\"\n    \"go/parser\"\n    \"go/token\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    // read file\n    // here you can filepath.Walk() for your go files\n    gopath := os.ExpandEnv(\"$GOPATH\")\n    fname := gopath + \"/src/github.com/golang/protobuf/proto/lib.go\"\n\n    // read file\n    file, err := os.Open(fname)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    defer file.Close()\n\n    // read the whole file in\n    srcbuf, err := ioutil.ReadAll(file)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    src := string(srcbuf)\n\n    // file set\n    fset := token.NewFileSet()\n    f, err := parser.ParseFile(fset, \"lib.go\", src, 0)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    // main inspection\n    ast.Inspect(f, func(n ast.Node) bool {\n\n        switch fn := n.(type) {\n\n        // catching all function declarations\n        // other intersting things to catch FuncLit and FuncType\n        case *ast.FuncDecl:\n            fmt.Print(\"func \")\n\n            // if a method, explore and print receiver\n            if fn.Recv != nil {\n                fmt.Printf(\"(%s)\", fields(*fn.Recv))\n            }\n\n            // print actual function name\n            fmt.Printf(\"%v\", fn.Name)\n\n            // print function parameters\n            if fn.Type.Params != nil {\n                fmt.Printf(\"(%s)\", fields(*fn.Type.Params))\n            }\n\n            // print return params\n            if fn.Type.Results != nil {\n                fmt.Printf(\"(%s)\", fields(*fn.Type.Results))\n            }\n\n            fmt.Println()\n\n        }\n        return true\n    })\n}\n\nfunc expr(e ast.Expr) (ret string) {\n    switch x := e.(type) {\n    case *ast.StarExpr:\n        return fmt.Sprintf(\"%s*%v\", ret, x.X)\n    case *ast.Ident:\n        return fmt.Sprintf(\"%s%v\", ret, x.Name)\n    case *ast.ArrayType:\n        if x.Len != nil {\n            log.Println(\"OH OH looks like homework\")\n            return \"TODO: HOMEWORK\"\n        }\n        res := expr(x.Elt)\n        return fmt.Sprintf(\"%s[]%v\", ret, res)\n    case *ast.MapType:\n        return fmt.Sprintf(\"map[%s]%s\", expr(x.Key), expr(x.Value))\n    case *ast.SelectorExpr:\n        return fmt.Sprintf(\"%s.%s\", expr(x.X), expr(x.Sel))\n    default:\n        fmt.Printf(\"\\nTODO HOMEWORK: %#v\\n\", x)\n    }\n    return\n}\n\nfunc fields(fl ast.FieldList) (ret string) {\n    pcomma := \"\"\n    for i, f := range fl.List {\n        // get all the names if present\n        var names string\n        ncomma := \"\"\n        for j, n := range f.Names {\n            if j &gt; 0 {\n                ncomma = \", \"\n            }\n            names = fmt.Sprintf(\"%s%s%s \", names, ncomma, n)\n        }\n        if i &gt; 0 {\n            pcomma = \", \"\n        }\n        ret = fmt.Sprintf(\"%s%s%s%s\", ret, pcomma, names, expr(f.Type))\n    }\n    return ret\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1918, "user_id": 8961316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YzXbi.jpg?s=128&g=1", "display_name": "0xInfection", "link": "https://stackoverflow.com/users/8961316/0xinfection"}, "is_accepted": false, "score": 1, "last_activity_date": 1612428197, "creation_date": 1612428197, "answer_id": 66042070, "question_id": 49573233, "link": "https://stackoverflow.com/questions/49573233/list-all-functions-from-source-code/66042070#66042070", "title": "List all functions from source code", "body": "<p>Building on @Peter's idea on an approach, you extract out all the exported functions using a simple grep + regex like this:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>grep -rP '^func\\s(?:\\([^\\)]+\\)\\s)?[A-Z].*' *.go\n</code></pre>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 657, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1612428197, "creation_date": 1522407904, "last_edit_date": 1522408508, "question_id": 49573233, "link": "https://stackoverflow.com/questions/49573233/list-all-functions-from-source-code", "title": "List all functions from source code", "body": "<p>I have folder with <code>.go</code> files and functions defined inside them.</p>\n\n<p>Is it possible to list in command line all function declarations in current folder, probably with <code>godoc</code>?</p>\n\n<pre><code>godoc list functions /path/to/fileOrFolder\n</code></pre>\n\n<p>To have such output:</p>\n\n<pre><code>func Foo(a, b int) int\nfunc Bar(c, d int) int\n</code></pre>\n"}]