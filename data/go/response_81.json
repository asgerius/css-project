[{"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 22219, "user_id": 14663, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/611db642b9164a9425f953071a5939ff?s=128&d=identicon&r=PG", "display_name": "WW.", "link": "https://stackoverflow.com/users/14663/ww"}, "edited": false, "score": 0, "creation_date": 1469678946, "post_id": 38624712, "comment_id": 64638504, "body": "I&#39;d recommend using the url.Parse since that should handle any weird edge cases which might be missed by a regex or a split.  For example, URLs without a ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 22219, "user_id": 14663, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/611db642b9164a9425f953071a5939ff?s=128&d=identicon&r=PG", "display_name": "WW.", "link": "https://stackoverflow.com/users/14663/ww"}, "edited": false, "score": 0, "creation_date": 1469681198, "post_id": 38624712, "comment_id": 64639109, "body": "I agree that url.Parse is the best approach. All of the options listed handle URLs without a <code>?</code>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 12, "last_activity_date": 1469726277, "last_edit_date": 1469726277, "creation_date": 1469661561, "answer_id": 38624712, "question_id": 38624609, "link": "https://stackoverflow.com/questions/38624609/extract-part-of-string-in-golang/38624712#38624712", "title": "Extract part of string in Golang?", "body": "<p>There are a few options:</p>\n\n<pre><code>// match regexp as in question\npat := regexp.MustCompile(`https?://.*\\.txt`)\ns := pat.FindString(myString)\n\n// everything before the query \ns := strings.Split(myString, \"?\")[0] string\n\n// same as previous, but avoids []string allocation\ns := myString\nif i := strings.IndexByte(s, '?'); i &gt;= 0 {\n    s = s[:i]\n}\n\n// parse and clear query string\nu, err := url.Parse(myString)\nu.RawQuery = \"\"\ns := u.String()\n</code></pre>\n\n<p>The last option is the best because it will handle all possible corner cases.</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/eNmaj2RpjC\" rel=\"noreferrer\">try it on the playground</a></kbd></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 4, "last_activity_date": 1469682182, "last_edit_date": 1469682182, "creation_date": 1469678762, "answer_id": 38626923, "question_id": 38624609, "link": "https://stackoverflow.com/questions/38624609/extract-part-of-string-in-golang/38626923#38626923", "title": "Extract part of string in Golang?", "body": "<p>you may use <code>strings.IndexRune</code>, <code>strings.IndexByte</code>, <code>strings.Split</code>, <code>strings.SplitAfter</code>,   <code>strings.FieldsFunc</code>, <code>url.Parse</code>, <code>regexp</code> or your function.  </p>\n\n<p>first most simple way:<br>\nyou may use <code>i := strings.IndexRune(s, '?')</code> or <code>i := strings.IndexByte(s, '?')</code> then <code>s[:i]</code> like this (with commented output):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    i := strings.IndexByte(s, '?')\n    if i != -1 {\n        fmt.Println(s[:i]) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n    }\n}\n</code></pre>\n\n<p>or you may use <code>url.Parse(s)</code> (I'd use this):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"net/url\"\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    url, err := url.Parse(s)\n    if err == nil {\n        url.RawQuery = \"\"\n        fmt.Println(url.String()) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n    }\n}\n</code></pre>\n\n<p>or you may use <code>regexp.MustCompile(\".*\\\\.txt\")</code>:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nvar rgx = regexp.MustCompile(`.*\\.txt`)\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n\n    fmt.Println(rgx.FindString(s)) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n}\n</code></pre>\n\n<p>or you may use <code>splits := strings.FieldsFunc(s, func(r rune) bool { return r == '?' })</code> then <code>splits[0]</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    splits := strings.FieldsFunc(s, func(r rune) bool { return r == '?' })\n    fmt.Println(splits[0]) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n}\n</code></pre>\n\n<p>you may use <code>splits := strings.Split(s, \"?\")</code> then <code>splits[0]</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    splits := strings.Split(s, \"?\")\n    fmt.Println(splits[0]) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n}\n</code></pre>\n\n<p>you may use <code>splits := strings.SplitAfter(s, \".txt\")</code> then <code>splits[0]</code>:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    splits := strings.SplitAfter(s, \".txt\")\n    fmt.Println(splits[0]) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n}\n</code></pre>\n\n<p>or you may use your function (most independent way):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc left(s string) string {\n    for i, r := range s {\n        if r == '?' {\n            return s[:i]\n        }\n    }\n    return \"\"\n}\n\nfunc main() {\n    s := `https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value`\n    fmt.Println(left(s)) // https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 2, "last_activity_date": 1469706498, "last_edit_date": 1469706498, "creation_date": 1469700920, "answer_id": 38633470, "question_id": 38624609, "link": "https://stackoverflow.com/questions/38624609/extract-part-of-string-in-golang/38633470#38633470", "title": "Extract part of string in Golang?", "body": "<p>If you are prosessing only URLs, you can use Go's <code>net/url</code> library <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow\">https://golang.org/pkg/net/url/</a> to parse the URL, truncate the Query and Fragment parts (Query would be <code>parm1=value,parm2=value</code> etc.), and extract the remaining portion <code>scheme://host/path</code>, as in the following example (<a href=\"https://play.golang.org/p/Ao0jU22NyA\" rel=\"nofollow\">https://play.golang.org/p/Ao0jU22NyA</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    u, _ := url.Parse(\"https://example-1.example.com/a/b/c/list.txt?parm1=value,parm2=https%3A%2F%2Fexample.com%2Fa%3Fparm1%3Dvalue%2Cparm2%3Dvalue#somefragment\")\n    u.RawQuery, u.Fragment = \"\", \"\"\n    fmt.Printf(\"%s\\n\", u)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>https://example-1.example.com/a/b/c/list.txt\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1882, "user_id": 1396864, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/9e291ca58bddd0189d783a865e0086cb?s=128&d=identicon&r=PG", "display_name": "MortenSickel", "link": "https://stackoverflow.com/users/1396864/mortensickel"}, "edited": false, "score": 0, "creation_date": 1574949556, "post_id": 59089963, "comment_id": 104415614, "body": "Hi and welcome! I am sorry but it is a bit difficult to understand your question. Could you rephrase it a bit so it is easier to understand what you want to achieve?"}], "tags": [], "owner": {"reputation": 1, "user_id": 8777235, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LTMzojQhlms/AAAAAAAAAAI/AAAAAAAABQw/hPHMOTnFyMY/photo.jpg?sz=128", "display_name": "Ganga Ram Daukiya", "link": "https://stackoverflow.com/users/8777235/ganga-ram-daukiya"}, "is_accepted": false, "score": 0, "last_activity_date": 1575104322, "last_edit_date": 1575104322, "creation_date": 1574947639, "answer_id": 59089963, "question_id": 38624609, "link": "https://stackoverflow.com/questions/38624609/extract-part-of-string-in-golang/59089963#59089963", "title": "Extract part of string in Golang?", "body": "<p>I used regexp package extract string from string .</p>\n\n<p>In this example I wanted to extract between  and &lt;\\PERSON> , did this by re expression and and replaced  and &lt;\\PERSON> by re1 expression.</p>\n\n<p>for loop used for if there there are multiple match and re1 format used for replace.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`&lt;PERSON&gt;(.*?)&lt;/PERSON&gt;`)\n\n    string_l := \"java -mx500m -cp stanford-ner.jar edu.stanford.nlp.ie.crf.CRFClassifier -loadClassifier classifiers/english.all.3class.distsim.crf.ser.gz -textFile PatrickYe.txt -outputFormat inlineXML 2&gt; /dev/null I complained to &lt;ORGANIZATION&gt;Microsoft&lt;/ORGANIZATION&gt; about &lt;PERSON&gt;Bill Gates&lt;/PERSON&gt;.They     told me to see the mayor of &lt;PERSON&gt;New York&lt;/PERSON&gt;.,\"\n    x := re.FindAllString(string_l, -1)        \n    fmt.Println(x)\n    for v,st:= range x{\n            re1 := regexp.MustCompile(`&lt;(.?)PERSON&gt;`)\n            y1 := re1.ReplaceAllLiteralString(st,\"\")\n            fmt.Println(v,st,\" : sdf : \",y1) \n\n    }    \n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/inVaPAAMJuY\" rel=\"nofollow noreferrer\">Play with Go</a></p>\n"}], "owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17727, "favorite_count": 0, "accepted_answer_id": 38624712, "answer_count": 4, "score": 5, "last_activity_date": 1575104322, "creation_date": 1469660881, "question_id": 38624609, "link": "https://stackoverflow.com/questions/38624609/extract-part-of-string-in-golang", "title": "Extract part of string in Golang?", "body": "<p>I'm learning Golang so I can rewrite some of my shell scripts.</p>\n\n<p>I have URL's that look like this:</p>\n\n<pre><code>https://example-1.example.com/a/c482dfad3573acff324c/list.txt?parm1=value,parm2=value,parm3=https://example.com/a?parm1=value,parm2=value\n</code></pre>\n\n<p>I want to extract the following part:</p>\n\n<pre><code>https://example-1.example.com/a/c482dfad3573acff324c/list.txt\n</code></pre>\n\n<p>In a shell script I would do something like this:</p>\n\n<pre><code>echo \"$myString\" | grep -o 'http://.*.txt'\n</code></pre>\n\n<p>What is the best way to do the same thing in Golang, only by using the standard library?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 711, "user_id": 6178021, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/vhabx.jpg?s=128&g=1", "display_name": "Tanmay Garg", "link": "https://stackoverflow.com/users/6178021/tanmay-garg"}, "edited": false, "score": 3, "creation_date": 1469678359, "post_id": 38624696, "comment_id": 64638362, "body": "Note that, Golang allows you to convert []byte to string (or vice versa) simply by doing an explicit typecast, because the underlying type of a string actually <i>is</i> a []byte.  But as you would notice, same doesn&#39;t hold for string and int types. You need something more than just a typecast (a function) to do this conversion."}], "tags": [], "owner": {"reputation": 2936, "user_id": 39791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661c7cc5565e5bc21fb0fc22c0354fef?s=128&d=identicon&r=PG", "display_name": "Joe McMahon", "link": "https://stackoverflow.com/users/39791/joe-mcmahon"}, "is_accepted": true, "score": 2, "last_activity_date": 1469661406, "creation_date": 1469661406, "answer_id": 38624696, "question_id": 38624552, "link": "https://stackoverflow.com/questions/38624552/how-to-convert-type-in-golang/38624696#38624696", "title": "How to convert type in golang?", "body": "<p>You can do the conversion with <code>strconv</code>'s <code>Atoi()</code> function:</p>\n\n<pre><code>i, err := strconv.Atoi(\"-42\")\n</code></pre>\n\n<p>And you'd convert your <code>[]byte</code> to a <code>string</code> with</p>\n\n<pre><code>s := string(byteArray[:])\n</code></pre>\n\n<p>So the combination is </p>\n\n<pre><code>i, err := strconv.Atoi(string(pass[:]))\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 5916316, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oUSvR.jpg?s=128&g=1", "display_name": "Mike Ru", "link": "https://stackoverflow.com/users/5916316/mike-ru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "accepted_answer_id": 38624696, "answer_count": 1, "score": 0, "last_activity_date": 1469661406, "creation_date": 1469660456, "last_edit_date": 1469660940, "question_id": 38624552, "link": "https://stackoverflow.com/questions/38624552/how-to-convert-type-in-golang", "title": "How to convert type in golang?", "body": "<p>I need to hid a password.\nI get (mismatched types <code>[]byte</code> and <code>int</code>).\nHow can i fix it? How can I convert from <code>int</code> to <code>[]byte</code>?</p>\n\n<pre><code>package main\n\nimport (\"fmt\"; \"github.com/howeyc/gopass\")\n\nfunc main() {\n    var user string\n    maping := map[string]int{\"dasha\": 123, \"mike\": 777}\n\n    fmt.Println(\"Enter username: \")\n    fmt.Scan(&amp;user)\n    fmt.Printf(\"Enter password: \")\n    pass, err := gopass.GetPasswd()\n    if err != nil {\n        return\n    }\n    if pass == maping[user] {\n        fmt.Println(\"bingo\")\n    }else{\n        fmt.Println(\"the login or password is not correct\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 1, "creation_date": 1469650915, "post_id": 38622395, "comment_id": 64630567, "body": "Minor optimization that&#39;s not really related to the question: You probably want to pre-compile that regex once so you&#39;re not recompiling it for no reason on every single iteration of your loop (every time you call findEmails)."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469650980, "post_id": 38622395, "comment_id": 64630603, "body": "That&#39;s a very good idea, I didn&#39;t even think about it, I&#39;ve been trying to get the damned thing to work lol, but I will certainly precompile thanks!"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469651357, "post_id": 38622395, "comment_id": 64630816, "body": "Another thing I noticed: <code>numberOfUrls</code> is racey. You probably want to put a sync.Mutex on it. It&#39;s also being decremented in multiple places which maybe isn&#39;t what you wanted?"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469651730, "post_id": 38622395, "comment_id": 64631012, "body": "Also, don&#39;t flush the writer on every iteration. Let the OS decide when things get written to the disk (or the network, or wherever); right now you&#39;re doing a lot of work and preventing the kernel from ever optimizing reads/writes in memory."}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469652202, "post_id": 38622395, "comment_id": 64631231, "body": "Err, not the OS in this case, but the package. Either way, you probably don&#39;t want to do it on every iteration."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1469656430, "post_id": 38623541, "comment_id": 64633295, "body": "This seems to work well, I&#39;ll have to do some testing, but thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1469656489, "last_edit_date": 1469656489, "creation_date": 1469655173, "answer_id": 38623541, "question_id": 38622395, "link": "https://stackoverflow.com/questions/38622395/im-encountering-multiple-errors-when-trying-concurrently-parse-sites-with-go/38623541#38623541", "title": "I&#39;m encountering multiple errors when trying concurrently parse sites with GO", "body": "<p>The application will open a large number of sockets and possibly breach file descriptor limits. I suggest limiting the number of concurrent requests to prevent this issue:</p>\n\n<pre><code>    var (\n        requestMu    sync.Mutex  // protects requestCount\n        requestCount int         // incremented on each request\n    )\n    // Create 10 workers. Adjust up or down as needed.\n    for w := 0; w &lt; 10; w++ {\n        go func() {\n            for {\n                // Increment request count. Exit at end.\n\n                requestMu.Lock()\n                i := requestCount\n                requestCount++\n                requestMu.Unlock()\n                if i &gt;= len(seedUrls) {\n                    return\n                }\n\n                // Fetch the current URL.\n\n                myURL := seedUrls[i]\n                resp, err := http.Get(myUrl)\n                if err != nil {\n                    fmt.Println(myURL, err.Error(), i)\n                    data &lt;- &amp;HTTPResponse{myURL, err.Error()}\n                    continue\n                }\n\n                // Read body and close.\n\n                b, err := ioutil.ReadAll(resp.Body)\n                resp.Body.Close()\n                if err != nil {\n                    fmt.Println(myURL, err.Error(), i)\n                    data &lt;- &amp;HTTPResponse{myURL, err.Error()}\n                    continue\n                }\n\n                myHTML := string(b)\n                data &lt;- &amp;HTTPResponse{myURL, myHTML}\n            }\n        }()\n    }\n\n    // Recieve expected number of results\n    for i := 0; i &lt; len(seedUrls); i++ {\n        result &lt;- data\n        emails := findEmails(result.HTML, filters)\n        fmt.Printf(\"%s, %s, %d\\n\", result.URL, emails, i)\n        var row = []string{result.URL, strings.Join(emails, \",\")}\n        err := writer.Write(row)\n        writer.Flush()\n        if err != nil {\n            panic(err)\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 38623541, "answer_count": 1, "score": 0, "last_activity_date": 1469656489, "creation_date": 1469650501, "last_edit_date": 1469655921, "question_id": 38622395, "link": "https://stackoverflow.com/questions/38622395/im-encountering-multiple-errors-when-trying-concurrently-parse-sites-with-go", "title": "I&#39;m encountering multiple errors when trying concurrently parse sites with GO", "body": "<p>Following some @Sam Whited advance and doing some research on stack, i've rewritten my code see below: This version of the code seems more stable, however, it is having issues where every once and a while the i get a slew of TCP errors as if i'm no closing my requests. I've throttled the requests by adding a sleep. It seems to help a bit.  </p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(maxParallelism())\n    var file = flag.String(\"f\", \"\", \"Enter new line deliminated text file\")\n    var fileName = flag.String(\"s\", \"contact_bot.csv\", \"Enter new line deliminated text file\")\n    flag.Parse()\n\n    if *file != \"\" {\n        counter := 0\n        filters = []string{\"info\", \"ads\", \"sales\", \"sale\", \"info\", \"media\", \"mediarelations\", \"media_relations\", \"contact\", \"contacts\", \"contactus\", \"contact_us\", \"contact-us\", \"about_us\", \"general\", \"advertise\", \"support\", \"systems\", \"system\"}\n        emailRE = regexp.MustCompile(`([a-z0-9!#$%&amp;'*+\\/=?^_{|}~-]+(?:\\.[a-z0-9!#$%&amp;'*+\\/=?^_{|}~-]+)*(@|\\sat\\s)(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?(\\.|\\sdot\\s))+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)`)\n\n        seedUrls, err := readLines(*file)\n        checkErr(err)\n        numberOfUrls := len(seedUrls)\n        usr, err := user.Current()\n        checkErr(err)\n        parentPath := filepath.Join(usr.HomeDir, \"/Desktop/\"+*fileName)\n\n        file, err := os.Create(parentPath)\n        checkErr(err)\n        defer file.Close()\n\n        writer := csv.NewWriter(file)\n        defer writer.Flush()\n\n        var header = []string{\"URL\", \"EMAILS\"}\n        err = writer.Write(header)\n        checkErr(err)\n\n        data = make(chan *HTTPResponse)\n        go asyncHTTPGets(seedUrls)\n\n    loop:\n        for result := range data {\n            counter++\n            emails := findEmails(result.HTML, filters)\n            fmt.Printf(\"%s, %s, %s\\n\", result.URL, emails, strconv.Itoa(numberOfUrls))\n            var row = []string{result.URL, strings.Join(emails, \",\")}\n            err := writer.Write(row)\n            // writer.Flush()\n            checkErr(err)\n            if counter == len(seedUrls) {\n                break loop\n            }\n            numberOfUrls--\n        }\n    }\n}\n\n\n// AsyncHTTPGets ...\nfunc asyncHTTPGets(urls []string) {\n    counter := 0\n    for _, url := range urls {\n        counter++\n        if counter%10 == 0 {\n            time.Sleep(1 * time.Second)\n        }\n        go func(url string) {\n            fmt.Printf(\"Fetching %s \\n\", url)\n            resp, err := http.Get(url)\n            if err != nil {\n                fmt.Println(err.Error())\n                data &lt;- &amp;HTTPResponse{url, err.Error()}\n                return\n            }\n            b := resp.Body\n            buf := new(bytes.Buffer)\n            buf.ReadFrom(b)\n            resp.Body.Close()\n            myHTML := buf.String()\n            data &lt;- &amp;HTTPResponse{url, myHTML}\n\n        }(url)\n    }\n}\n\nfunc findEmails(html string, filters []string) []string {\n    emails := emailRE.FindAllString(html, -1)\n    filteredEmails := []string{}\n    for _, email := range emails {\n        if stringInSlice(email, filters) {\n            if !stringInSlice(email, filteredEmails) {\n                filteredEmails = append(filteredEmails, email)\n            }\n        }\n    }\n    sort.Strings(filteredEmails)\n    return filteredEmails\n}\n</code></pre>\n"}, {"tags": ["go", "unicode"], "comments": [{"owner": {"reputation": 4119, "user_id": 4447998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be2b81fe09ceb2ec13da299127f242f3?s=128&d=identicon&r=PG", "display_name": "roeland", "link": "https://stackoverflow.com/users/4447998/roeland"}, "edited": false, "score": 0, "creation_date": 1469659053, "post_id": 38621534, "comment_id": 64634230, "body": "Do you also need to have the unicode characters escaped when they are not escaped in the JSON file? Eg. what if the JSON file looks like this: <code>{&quot;code&quot;:&quot;\u5728\u4e30\u5fb7\u5c14Berro\u8212\u9002\u76841\u623f\u5355\u4f4d&quot;}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3586147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6QziD.jpg?s=128&g=1", "display_name": "Ranveer Singh", "link": "https://stackoverflow.com/users/3586147/ranveer-singh"}, "edited": false, "score": 0, "creation_date": 1469712216, "post_id": 38621869, "comment_id": 64658418, "body": "Thanks for your reply, we have some services in PHP which want to use the same data, I already implemented the custom MarshalJSON which works for me. Thanks."}, {"owner": {"reputation": 23, "user_id": 3586147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6QziD.jpg?s=128&g=1", "display_name": "Ranveer Singh", "link": "https://stackoverflow.com/users/3586147/ranveer-singh"}, "edited": false, "score": 0, "creation_date": 1469730736, "post_id": 38621869, "comment_id": 64671374, "body": "Just found a small problem in this, it is adding double quotes <code>&quot; &quot;</code>  to the string. When you print <code>r.Code</code> you can see the string with <code>&quot; &quot;</code>. I tried to trim the first and last byte of the array inside <code>UnmarshalJSON</code> and it worked. But I am not sure if that is the correct solution."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 23, "user_id": 3586147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6QziD.jpg?s=128&g=1", "display_name": "Ranveer Singh", "link": "https://stackoverflow.com/users/3586147/ranveer-singh"}, "edited": false, "score": 0, "creation_date": 1469731736, "post_id": 38621869, "comment_id": 64671960, "body": "@RanveerSingh you can try to use un unmarshaller <code>RawUnicodeString(b[1:len(b)-1])</code> Should work."}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 5, "last_activity_date": 1469724604, "last_edit_date": 1469724604, "creation_date": 1469648630, "answer_id": 38621869, "question_id": 38621534, "link": "https://stackoverflow.com/questions/38621534/skip-decoding-unicode-string-while-unmarshalling-golang/38621869#38621869", "title": "Skip decoding Unicode string while unmarshalling: golang", "body": "<p>You can do this with custom decoder <a href=\"https://play.golang.org/p/H-gagzJGPI\" rel=\"nofollow\">https://play.golang.org/p/H-gagzJGPI</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype RawUnicodeString string\n\nfunc (this *RawUnicodeString) UnmarshalJSON(b []byte) error {\n    *this = RawUnicodeString(b)\n    return nil\n}\n\nfunc (this RawUnicodeString) MarshalJSON() ([]byte, error) {\n    return []byte(this), nil\n}\n\ntype Message struct {\n    Code RawUnicodeString\n}\n\nfunc main() {\n    var r Message\n    data := `{\"code\":\"\\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\"}`\n    json.Unmarshal([]byte(data), &amp;r)\n    fmt.Println(r.Code)\n    out, _ := json.Marshal(r)\n    fmt.Println(string(out))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 471, "user_id": 6573268, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44130f383b5f894f91a5d1984d9c6e9a?s=128&d=identicon&r=PG&f=1", "display_name": "aebudak", "link": "https://stackoverflow.com/users/6573268/aebudak"}, "is_accepted": false, "score": 0, "last_activity_date": 1469690660, "last_edit_date": 1469690660, "creation_date": 1469690315, "answer_id": 38629543, "question_id": 38621534, "link": "https://stackoverflow.com/questions/38621534/skip-decoding-unicode-string-while-unmarshalling-golang/38629543#38629543", "title": "Skip decoding Unicode string while unmarshalling: golang", "body": "<p>You could use <code>json.RawMessage</code> instead of string. <a href=\"https://play.golang.org/p/YcY2KrkaIb\" rel=\"nofollow\">https://play.golang.org/p/YcY2KrkaIb</a></p>\n\n<pre><code>    package main\n\n    import (\n        \"encoding/json\"\n        \"fmt\"\n    )\n\n    type Text struct {\n        Code json.RawMessage\n    }\n\n    func main() {\n        data := []byte(`{\"code\":\"\\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\"}`)\n        var message Text\n        json.Unmarshal(data, &amp;message)\n        fmt.Println(string(message.Code))\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "is_accepted": false, "score": 0, "last_activity_date": 1532859846, "creation_date": 1532859846, "answer_id": 51579351, "question_id": 38621534, "link": "https://stackoverflow.com/questions/38621534/skip-decoding-unicode-string-while-unmarshalling-golang/51579351#51579351", "title": "Skip decoding Unicode string while unmarshalling: golang", "body": "<p>Simple solution is to escape your backslash by preceding it with another backslash.</p>\n\n<pre><code>func main() {\n    var jsonRawOriginal json.RawMessage = []byte(`\"\\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\"`)\n    var jsonRawEscaped json.RawMessage = []byte(strings.Replace(string(jsonRawOriginal), `\\u`, `\\\\u`, -1))\n\n    fmt.Println(string(jsonRawOriginal)) // \"\\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\"\n    fmt.Println(string(jsonRawEscaped))  // \"\\\\u5728\\\\u4e30\\\\u5fb7\\\\u5c14Berro\\\\u8212\\\\u9002\\\\u76841\\\\u623f\\\\u5355\\\\u4f4d\"\n\n    var a interface{}\n    var b interface{}\n\n    json.Unmarshal(jsonRawOriginal, &amp;a)\n    json.Unmarshal(jsonRawEscaped, &amp;b)\n\n    fmt.Println(a) // \u5728\u4e30\u5fb7\u5c14Berro\u8212\u9002\u76841\u623f\u5355\u4f4d\n    fmt.Println(b) // \\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Ok9IVJnxp-8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ok9IVJnxp-8</a></p>\n"}], "owner": {"reputation": 23, "user_id": 3586147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6QziD.jpg?s=128&g=1", "display_name": "Ranveer Singh", "link": "https://stackoverflow.com/users/3586147/ranveer-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2444, "favorite_count": 0, "accepted_answer_id": 38621869, "answer_count": 3, "score": 1, "last_activity_date": 1532859846, "creation_date": 1469647454, "last_edit_date": 1481349044, "question_id": 38621534, "link": "https://stackoverflow.com/questions/38621534/skip-decoding-unicode-string-while-unmarshalling-golang", "title": "Skip decoding Unicode string while unmarshalling: golang", "body": "<p>I have this JSON:</p>\n\n<pre><code>{\n    \"code\":\"\\u5728\\u4e30\\u5fb7\\u5c14Berro\\u8212\\u9002\\u76841\\u623f\\u5355\\u4f4d\"\n}\n</code></pre>\n\n<p>And this struct</p>\n\n<pre><code>type Text struct {\n    Code string\n}\n</code></pre>\n\n<p>If I use any of the <code>json.Unmarshal</code> or <code>NewDecoder.Decode</code>, the Unicode is converted to the actual Chinese. So <code>Text.Code</code> is</p>\n\n<p><code>\u5728\u4e30\u5fb7\u5c14Berro\u8212\u9002\u76841\u623f\u5355\u4f4d</code></p>\n\n<p>I don't want it to convert, I want the same unicode string.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 2, "creation_date": 1469644790, "post_id": 38620763, "comment_id": 64627321, "body": "<a href=\"https://gobyexample.com/slices\" rel=\"nofollow noreferrer\">gobyexample.com/slices</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469645142, "post_id": 38620763, "comment_id": 64627531, "body": "Also in <a href=\"https://golang.org/doc/effective_go.html#append\" rel=\"nofollow noreferrer\">Effective Go</a>, the <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">Go Language Specification</a> and in the <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">Tour of Go</a>"}, {"owner": {"reputation": 3895, "user_id": 3169754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sP8Pj.png?s=128&g=1", "display_name": "gavv", "link": "https://stackoverflow.com/users/3169754/gavv"}, "edited": false, "score": 0, "creation_date": 1469645687, "post_id": 38620763, "comment_id": 64627852, "body": "See also: <a href=\"http://stackoverflow.com/questions/20195296/golang-append-an-item-to-a-slice/20197469#20197469\" title=\"golang append an item to a slice\">stackoverflow.com/questions/20195296/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469646076, "post_id": 38620763, "comment_id": 64628071, "body": "Go slices are somewhat similar to python lists, but making assumptions based on that similarity is only going to cause confusion. Slices are very simple data structures, and it&#39;s better to just understand how they work to begin with."}], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 3, "last_activity_date": 1469647754, "last_edit_date": 1469647754, "creation_date": 1469645380, "answer_id": 38620954, "question_id": 38620763, "link": "https://stackoverflow.com/questions/38620763/how-to-append-a-new-element-to-a-slice/38620954#38620954", "title": "How to append a new element to a slice?", "body": "<p>Appending in Go uses the builtin method <a href=\"https://godoc.org/builtin#append\" rel=\"nofollow\"><code>append</code></a>. For example:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>s := []byte{1, 2, 3}\ns = append(s, 4, 5, 6)\nfmt.Println(s)\n// Output: [1 2 3 4 5 6]\n</code></pre>\n\n<p>You are correct, slices in Go are close to Python's list, and, in fact, many of the same indexing and slicing operations work on them.</p>\n\n<p>When you do:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>s[len(s)] = 100\n</code></pre>\n\n<p>it panics because you cannot access a value beyond the length of the slice. There appears to be some confusion here, because in Python this works the exact same way. Attempting the above in Python (unless you've already expanded the list) will give:</p>\n\n<pre class=\"lang-python prettyprint-override\"><code>IndexError: list assignment index out of range\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469647754, "creation_date": 1469644680, "question_id": 38620763, "link": "https://stackoverflow.com/questions/38620763/how-to-append-a-new-element-to-a-slice", "title": "How to append a new element to a slice?", "body": "<p>I tried to append a new element to a slice, just like appending a new element to a <code>list</code> in Python, but there is an error</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    s[len(s)] = 100\n    printSlice(s)\n}\n\nfunc printSlice(s []int) {\n    fmt.Printf(\"%v\\n\", s)\n}\n</code></pre>\n\n<p>and the output is</p>\n\n<pre><code>[2 3 5 7 11 13]\n\npanic: runtime error: index out of range\n</code></pre>\n\n<p>How can I append a new element to a slice then?</p>\n\n<p>Is it correct that <code>slice</code> in Go is the closet data type to <code>list</code> in Python?</p>\n\n<p>Thanks. </p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469643538, "post_id": 38620251, "comment_id": 64626594, "body": "Thanks. Do you mean that <code>Unmarshal</code> and <code>Decode</code> can apply to the same object, and the only difference is that the object should be treated as a byte array for <code>Unmarshal</code> while the object should be treated as an <code>io.Reader</code> object?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469644521, "post_id": 38620251, "comment_id": 64627158, "body": "That is basically the idea. In fact, if you look at <code>Decode</code>&#39;s source, you&#39;ll see that it also uses <code>Unmarshal</code> internally (although defined as a private package member. (<a href=\"https://github.com/golang/go/blob/master/src/encoding/json/stream.go#L67\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/encoding/json/&hellip;</a>)"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469644718, "post_id": 38620251, "comment_id": 64627269, "body": "Also, <code>Decode</code> is very useful when you have a type implementing the <code>json.Unmarshaler</code> interface, as it can be used to decode nested structures. e.g. <a href=\"http://stackoverflow.com/questions/20587157/golang-having-trouble-with-nested-json-unmarshaler\" title=\"golang having trouble with nested json unmarshaler\">stackoverflow.com/questions/20587157/&hellip;</a>"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 4, "last_activity_date": 1469642912, "creation_date": 1469642912, "answer_id": 38620251, "question_id": 38620151, "link": "https://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here/38620251#38620251", "title": "Why are json package&#39;s Decode and Marshal methods used here?", "body": "<p>I think the main reason for using a <code>json.NewDecoder</code> here is to read directly from response's body (<code>r.Body</code>) here, since <code>NewDecoder</code> takes an <code>io.Reader</code> as an input.</p>\n\n<p>You could have used <code>json.Unmarshal</code> but then you'd have to first read response body into a <code>[]byte</code> and pass that value to <code>json.Unmarshal</code>. <code>NewDecoder</code> is more convenient here.</p>\n"}, {"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 1, "last_activity_date": 1469644716, "last_edit_date": 1469644716, "creation_date": 1469644216, "answer_id": 38620643, "question_id": 38620151, "link": "https://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here/38620643#38620643", "title": "Why are json package&#39;s Decode and Marshal methods used here?", "body": "<p><strong>TL;DR \u2014</strong> <code>Marshal</code>/<code>Unmarshal</code> take and return byte slices, while <code>Encode</code>/<code>Decode</code> do the same thing, but read the bytes from a stream such as a network connection (readers and writers).</p>\n\n<p>The <a href=\"https://godoc.org/encoding/json\" rel=\"nofollow\"><code>encoding/json</code></a> package uses the <a href=\"https://godoc.org/encoding/json#Encoder\" rel=\"nofollow\"><code>Encoder</code></a> and <a href=\"https://godoc.org/encoding/json#Decoder\" rel=\"nofollow\"><code>Decoder</code></a> types to act on <em>streams</em> of data, that is, <a href=\"https://godoc.org/io#Reader\" rel=\"nofollow\"><code>io.Reader</code></a>'s and <a href=\"https://godoc.org/io#Writer\" rel=\"nofollow\"><code>io.Writer</code></a>'s. This means that you can take data directly from a network socket (or an HTTP body in this case which implements <code>io.Reader</code>) and transform it to JSON as the bytes come in. Doing it this way, we can go ahead and start processing that JSON as soon as any data is available but before we've received the whole document (on a slow network connection with a big document this could save us a lot of time, and for some streaming protocols with \"infinitely sized\" document streams this is absolutely necessary!)</p>\n\n<p><code>Marshal</code> and <code>Unmarshal</code> however operate on byte slices, which means that you have to have the entirety of the JSON document in memory before you can use them. In your example, the author uses Marshal because they already have a <code>[]byte</code> slice so there's no point in constructing a buffer using the byte slice, then making an encoder that uses that buffer, then calling encode: Instead they can just let Marshal do that for them.</p>\n\n<p>In reality, Marshal/Unmarshal are just convenience methods on top of Encoders and Decoders. If we look at the <a href=\"https://golang.org/src/encoding/json/decode.go#L85\" rel=\"nofollow\">source for Unmarshal</a>, we see that under the hood it's just constructing an encoder (or the internal representation of an encoder, but trust me, they're the same thing, if you want proof you can look at the <a href=\"https://golang.org/src/encoding/json/stream.go#L183\" rel=\"nofollow\">Encode method source</a> and see that it's also creating an <code>encodeState</code>) and then returning the output bytes:\n</p>\n\n<pre><code>func Marshal(v interface{}) ([]byte, error) {\n    e := &amp;encodeState{}\n    err := e.marshal(v)\n    if err != nil {\n        return nil, err\n    }\n    return e.Bytes(), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1469644716, "creation_date": 1469642544, "last_edit_date": 1495539862, "question_id": 38620151, "link": "https://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here", "title": "Why are json package&#39;s Decode and Marshal methods used here?", "body": "<p>In the following example from <a href=\"https://books.google.com/books?id=OalPCwAAQBAJ&amp;lpg=PR2&amp;dq=web%20application%20in%20go&amp;pg=PA155#v=onepage&amp;q=web%20application%20in%20go&amp;f=false\" rel=\"nofollow noreferrer\">Web Development with Go by Shiju Varghese</a>, which is for implementing a HTTP server using a new MongoDB session for each HTTP request:</p>\n\n<ul>\n<li><p>Why is <code>json</code> package's <code>Decode</code> method used in <code>PostCategory</code> function?</p></li>\n<li><p>Why is <code>json</code> package's <code>Marshal</code> method used in <code>GetCategories</code> function?</p></li>\n</ul>\n\n<p>At first I thought that <code>Decode</code> in <code>PostCategory</code> and <code>Marshal</code> in <code>GetCategories</code> are opposite to each other, but later I found that there is a <code>Unmarshal</code> method and maybe a <code>Encode</code> one in the <code>json</code> package. So I asked <a href=\"https://stackoverflow.com/questions/38618339/\">a question</a> earlier.</p>\n\n<p>Here is the program</p>\n\n<pre><code>package main\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\nvar session *mgo.Session\n\ntype (\n    Category struct {\nId bson.ObjectId `bson:\"_id,omitempty\"`\nName string\nDescription string\n    }\n    DataStore struct {\nsession *mgo.Session\n    }\n)\n//Close mgo.Session\nfunc (d *DataStore) Close() {\n    d.session.Close()\n}\n//Returns a collection from the database.\nfunc (d *DataStore) C(name string) *mgo.Collection {\n    return d.session.DB(\"taskdb\").C(name)\n}\n//Create a new DataStore object for each HTTP request\nfunc NewDataStore() *DataStore {\n    ds := &amp;DataStore{\nsession: session.Copy(),\n    }\n    return ds\n}\n\n//Insert a record\nfunc PostCategory(w http.ResponseWriter, r *http.Request) {\n    var category Category\n    // Decode the incoming Category json\n    err := json.NewDecoder(r.Body).Decode(&amp;category)\n    if err != nil {\npanic(err)\n    }\n    ds := NewDataStore()\n    defer ds.Close()\n    //Getting the mgo.Collection\n    c := ds.C(\"categories\")\n    //Insert record\n    err = c.Insert(&amp;category)\n    if err != nil {\npanic(err)\n    }\nw.WriteHeader(http.StatusCreated)\n}\n\n//Read all records\nfunc GetCategories(w http.ResponseWriter, r *http.Request) {\n    var categories []Category\n    ds := NewDataStore()\n    defer ds.Close()\n    //Getting the mgo.Collection\n    c := ds.C(\"categories\")\n    iter := c.Find(nil).Iter()\n    result := Category{}\n    for iter.Next(&amp;result) {\ncategories = append(categories, result)\n    }\nw.Header().Set(\"Content-Type\", \"application/json\")\nj, err := json.Marshal(categories)\nif err != nil {\npanic(err)\n    }\nw.WriteHeader(http.StatusOK)\nw.Write(j)\n}\n\nfunc main() {\n    var err error\n    session, err = mgo.Dial(\"localhost\")\n    if err != nil {\npanic(err)\n    }\n    r := mux.NewRouter()\nr.HandleFunc(\"/api/categories\", GetCategories).Methods(\"GET\")\nr.HandleFunc(\"/api/categories\", PostCategory).Methods(\"POST\")\n    server := &amp;http.Server{\nAddr:    \":8080\",\nHandler: r,\n    }\n    log.Println(\"Listening...\")\n    server.ListenAndServe()\n}\n</code></pre>\n"}, {"tags": ["node.js", "go", "benchmarking", "apachebench"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469642833, "post_id": 38620107, "comment_id": 64626177, "body": "use something better than <code>ab</code>? <code>wrk</code>, <code>httpperf</code>, <code>boom</code>, <code>siege</code>, <code>weighttp</code>, <code>vegeta</code> come to mind. I prefer <code>wrk</code> and have been experimenting with <code>vegeta</code> since it has a constant request rate (there&#39;s a wrk fork somewhere to do that too)"}, {"owner": {"reputation": 161, "user_id": 6008053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37987854bcf0a353bdc375d0a6b14449?s=128&d=identicon&r=PG&f=1", "display_name": "DanielTheGeek", "link": "https://stackoverflow.com/users/6008053/danielthegeek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469643044, "post_id": 38620107, "comment_id": 64626311, "body": "@JimB what&#39;s wrong with ab?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469643814, "post_id": 38620107, "comment_id": 64626732, "body": "To start, it&#39;s only http/1.0 (doesn&#39;t do keepalive by default) has trouble with chunked encodings, and doesn&#39;t perform as well as many others. Your contrived Go server can respond faster than <code>ab</code> can test, so all you&#39;re testing is <code>ab</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469644071, "post_id": 38620107, "comment_id": 64626909, "body": "Just ran it myself, and <code>wrk</code> reports response times in the 200us range, and <code>ab</code> reports them in the 70ms range. That&#39;s 2 order of magnitude in error, and you&#39;re not even yet handling the problem of the request <i>rate</i>."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1469642556, "creation_date": 1469642556, "answer_id": 38620153, "question_id": 38620107, "link": "https://stackoverflow.com/questions/38620107/how-to-run-a-load-test-with-apachebench/38620153#38620153", "title": "How to run a load test with ApacheBench", "body": "<p>You do ab -n [number of requests] -c [number of concurrent requests] [url]:[port]</p>\n\n<pre><code>ab -n 100 -c 10 http://localhost:8080/\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6008053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37987854bcf0a353bdc375d0a6b14449?s=128&d=identicon&r=PG&f=1", "display_name": "DanielTheGeek", "link": "https://stackoverflow.com/users/6008053/danielthegeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "accepted_answer_id": 38620153, "answer_count": 1, "score": 0, "last_activity_date": 1469642556, "creation_date": 1469642364, "question_id": 38620107, "link": "https://stackoverflow.com/questions/38620107/how-to-run-a-load-test-with-apachebench", "title": "How to run a load test with ApacheBench", "body": "<p>Please, how can I use ApacheBench to do load testing assuming I want to test the HTTP capabilities of Node and Go?. Note: I have installed AB, I just don't know how to run the test.</p>\n\n<p>Node:</p>\n\n<pre><code>  var http = require(\"http\");\n  http.createServer(function(request,response) {\n  response.writeHeader(200);\n  response.write(\"You requested \" + request.url);\n  response.end();\n}).listen(8080);\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"You requested %s\", r.URL.Path)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469636842, "post_id": 38618432, "comment_id": 64622788, "body": "You could install everything and remove the build artifacts for your package."}, {"owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 1, "creation_date": 1469639352, "post_id": 38618432, "comment_id": 64624186, "body": "AFAIK <code>go install</code> compiles all packages and stores them to <code>$GOPATH&#47;pkg</code>. So you could run <code>go install</code> in a clean <code>$GOPATH</code> and copy these files. Unfortunately I don&#39;t have time to verify this, now."}, {"owner": {"reputation": 7887, "user_id": 786662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S1PVE.jpg?s=128&g=1", "display_name": "ldg", "link": "https://stackoverflow.com/users/786662/ldg"}, "edited": false, "score": 0, "creation_date": 1469645446, "post_id": 38618432, "comment_id": 64627722, "body": "You can also make your own base image from the vendor packages and extend the user images FROM that. As mentioned, you can do any cleanup, etc. in your base image. This would make it possible to do a clean build if need be later and still be able to reuse the vendor (base) image."}], "answers": [{"tags": [], "owner": {"reputation": 798, "user_id": 329056, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/676dd4312d04f92b8b9d1c0cae9ccad3?s=128&d=identicon&r=PG", "display_name": "scooz", "link": "https://stackoverflow.com/users/329056/scooz"}, "is_accepted": false, "score": 2, "last_activity_date": 1469698978, "creation_date": 1469698978, "answer_id": 38632686, "question_id": 38618432, "link": "https://stackoverflow.com/questions/38618432/speeding-up-docker-build-for-golang-vendoring/38632686#38632686", "title": "Speeding up docker build for golang vendoring", "body": "<ul>\n<li>In the host (outside the docker container), the packages are still stored in the <code>/vendor</code> folder. This allows for convenient management of these dependencies. Personally I use <code>godep</code> to manage this.</li>\n<li>Inside the container, instead of adding the <code>/vendor</code> folder to be a subdir of my package, I add all the packages inside the <code>/vendor</code> folder under the source directory <code>/go/src</code> directly.</li>\n<li>Since go's vendoring is all about changing import paths, and build artifacts are stored in the <code>/pkg</code> directory regardless of whether they were 'vendored' or not, this solution is stable.</li>\n<li>In order to enjoy the speed-up, and not having to rebuild all vendored packages unless they were changed, the Dockerfile runs a <code>go install ./...</code> on the <code>src</code> dir after adding the <code>vendor</code> folder, then proceeds with the rest of the build.</li>\n</ul>\n\n<p>Dockerfile:</p>\n\n<pre><code>FROM golang:1.6-alpine\n\n# Add and install all vendored packages.\nADD vendor /go/src/\nRUN cd /go/src &amp;&amp; go install -v ./...\n\n# ...\n\n# Add and install our package's source files, without the vendor folder\nADD *.go \"/go/src/github.com/myuser/mypackage\"\nRUN go install -v \"/go/src/github.com/myuser/mypackage\"\n</code></pre>\n"}], "owner": {"reputation": 798, "user_id": 329056, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/676dd4312d04f92b8b9d1c0cae9ccad3?s=128&d=identicon&r=PG", "display_name": "scooz", "link": "https://stackoverflow.com/users/329056/scooz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1163, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1469698978, "creation_date": 1469636542, "question_id": 38618432, "link": "https://stackoverflow.com/questions/38618432/speeding-up-docker-build-for-golang-vendoring", "title": "Speeding up docker build for golang vendoring", "body": "<p>I have a Dockerfile which is <code>FROM golang:1.6-alpine</code>. I\u2019d like to use the docker images cache as much as possible while performing <code>docker build</code> to speed things up. </p>\n\n<p>For this, I thought I\u2019d add <code>ADD vendor /go/src/\u2026/mypackage/vendor</code> as one of the first steps, and eventually run <code>go install -v \u2026/mypackage</code>. However, this causes the vendored packages (which are the bulk of the build time) to only be built then. </p>\n\n<p>Is there anyway to explicitly build all vendored packages (i.e. sources inside a <code>\u2026/vendor</code> dir), but only them?</p>\n\n<p>I'd like my Dockerfile to look something like this:</p>\n\n<pre><code>FROM golang:1.6-alpine\n\nADD vendor /go/src/github.com/myuser/package/vendor\n# missing: magic command to build only the vendored packages above\n\nADD *.go /go/src/github.com/myuser/package\nRUN go install -v \"github.com/myuser/package\n</code></pre>\n"}, {"tags": ["json", "serialization", "go", "marshalling", "json-deserialization"], "comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 1, "creation_date": 1477836292, "post_id": 38618339, "comment_id": 67914825, "body": "@ Tim, why you haven&#39;t picked <i>the</i> answer yet? Still unsatisfied?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469642690, "post_id": 38618559, "comment_id": 64626097, "body": "Thanks. See an example here <a href=\"http://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here\" title=\"why are json packages decode and marshal methods used here\">stackoverflow.com/questions/38620151/&hellip;</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469643105, "post_id": 38618559, "comment_id": 64626356, "body": "@Tim I&#39;ll take a look at that when I get a minute."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 6, "last_activity_date": 1469636963, "creation_date": 1469636963, "answer_id": 38618559, "question_id": 38618339, "link": "https://stackoverflow.com/questions/38618339/relations-and-differences-between-marshall-unmarshal-encoding-decoding-and-ser/38618559#38618559", "title": "Relations and differences between marshall/unmarshal, encoding/decoding, and serialization/deserialization for JSON?", "body": "<p>I would personally say all those terms are synonyms though less so with encoding/decoding. In Go Marshal and Unmarshal happen to be the terms that are used to describe converting json in a string form to an object and vice versa. However in C# these same methods are called serialize and deserialize, as far as I know that terminology isn't in Go at all (at least not in any std lib).</p>\n\n<p>Encoding can be used as an adjective to describe the format in which some data is stored, the most common use is probably character encoding (UTF-8). In Go it's also used as a noun to describe objects that can unmarshal/marshal json. Marshal/Unmarshal are always used as verbs, you take that action on the json.</p>\n\n<p>Encoding is also used in Go to refer to a larger category of packages that deal with the conversion from one encoding to another.</p>\n\n<p>If you told me you were marshalling, marshalling, deserializing or serializing some object or json I would understand exactly what you meant. If you said you were json encoding an object I would ask a clarifying question. If you said the \"response is json encoded\" I would get what you mean though I would think it's odd that you used those words rather than just saying \"the response is json\". Hope that is more or less the information you're looking for.</p>\n\n<p>Oh also, just for more clarity</p>\n\n<p><code>Unmarshal == deserialize == decode</code></p>\n\n<p><code>Marshal == serialize == encode</code></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "edited": false, "score": 0, "creation_date": 1469642684, "post_id": 38619876, "comment_id": 64626094, "body": "Thanks. See an example here <a href=\"http://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here\" title=\"why are json packages decode and marshal methods used here\">stackoverflow.com/questions/38620151/&hellip;</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1469642279, "last_edit_date": 1469642279, "creation_date": 1469641505, "answer_id": 38619876, "question_id": 38618339, "link": "https://stackoverflow.com/questions/38618339/relations-and-differences-between-marshall-unmarshal-encoding-decoding-and-ser/38619876#38619876", "title": "Relations and differences between marshall/unmarshal, encoding/decoding, and serialization/deserialization for JSON?", "body": "<p>In the <code>encoding/json</code> package, the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\"><code>Marshal</code></a> function and the inverse <a href=\"https://golang.org/pkg/encoding/json/#Unarshal\" rel=\"nofollow\"><code>Unmarshal</code></a>function return and operate on single fixed bytes slices. They transform single objects to bytes, and vice versa. </p>\n\n<p>There are also the <a href=\"https://golang.org/pkg/encoding/json/#Encoder\" rel=\"nofollow\"><code>Encoder</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow\"><code>Decoder</code></a> types. These contain the <a href=\"https://golang.org/pkg/encoding/json/#Encoder.Encode\" rel=\"nofollow\"><code>Encode</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow\"><code>Decode</code></a> methods, and they operate on streams of bytes, taking an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow\"><code>io.Reader</code></a> and <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow\"><code>io.Writer</code></a> respectively. They also allow <em>multiple</em> objects to be serialized or deserialized with a newline delimiter using those streams. </p>\n\n<p>The underlying mechanisms of Marshal/Unmarshal functions and the Encoder/Decoder types are identical, they both use the same internal <code>encodeState.marshal</code> and <code>decodeState.unmarshal</code> codepaths. The only real difference is they provide alternative access for various usage patterns. </p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2191, "favorite_count": 1, "answer_count": 2, "score": 8, "last_activity_date": 1469642726, "creation_date": 1469636244, "last_edit_date": 1495540478, "question_id": 38618339, "link": "https://stackoverflow.com/questions/38618339/relations-and-differences-between-marshall-unmarshal-encoding-decoding-and-ser", "title": "Relations and differences between marshall/unmarshal, encoding/decoding, and serialization/deserialization for JSON?", "body": "<p>In Go's JSON package, I saw there are <code>marshal</code>, <code>decode</code> and other functions.</p>\n\n<p>I thought that <code>decode</code> is the opposite to <code>marshal</code>, but latter realized that I might be wrong. </p>\n\n<p>I think the fundamental question that I have is:</p>\n\n<p>What are the relations and differences between marshall/unmarshal, encoding/decoding, and serialization/deserialization for JSON?</p>\n\n<p>Thanks.</p>\n\n<p>See an example here <a href=\"https://stackoverflow.com/questions/38620151/why-are-json-packages-decode-and-marshal-methods-used-here\">Why are json package&#39;s Decode and Marshal methods used here?</a></p>\n"}, {"tags": ["go", "naming-conventions"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1469631807, "post_id": 38616687, "comment_id": 64619425, "body": "They have different uses: <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Exported_identifiers</a>"}, {"owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469632143, "post_id": 38616687, "comment_id": 64619656, "body": "Thanks. In the other&#39;s program in file A, the function is named in the first way, and another program in file B calls the function from file A. Both file A and B are in the same directory. According to the link, it seems that the function must be defined in the second way to be used by the program in another file, correct?"}, {"owner": {"reputation": 711, "user_id": 6178021, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/vhabx.jpg?s=128&g=1", "display_name": "Tanmay Garg", "link": "https://stackoverflow.com/users/6178021/tanmay-garg"}, "edited": false, "score": 0, "creation_date": 1469632525, "post_id": 38616687, "comment_id": 64619924, "body": "That is right, if the name of package of file A is <code>packageA</code>, file B can access the function using <code>packageA.WriteToMongoD</code> (packageA being necessary as a qualifier)."}], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 1, "creation_date": 1602396363, "post_id": 38616867, "comment_id": 113703385, "body": "Great answer +1. The preferred Go term is MixedCaps or mixedCaps not CamelCase. See <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#mixed-caps</a>."}], "tags": [], "owner": {"reputation": 711, "user_id": 6178021, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/vhabx.jpg?s=128&g=1", "display_name": "Tanmay Garg", "link": "https://stackoverflow.com/users/6178021/tanmay-garg"}, "is_accepted": false, "score": 12, "last_activity_date": 1469632081, "creation_date": 1469632081, "answer_id": 38616867, "question_id": 38616687, "link": "https://stackoverflow.com/questions/38616687/which-way-to-name-a-function-in-go-camelcase-or-semi-camelcase/38616867#38616867", "title": "Which way to name a function in Go, CamelCase or Semi-CamelCase?", "body": "<p>In Golang, any variable (or a function) with an identifier starting with an upper-case letter (example, CamelCase) is made public (accessible) to all other packages in your program, whereas those starting with a lower-case letter (example, camelCase) is not accessible to any package except the one it is being declared in.</p>\n\n<p>You should use CamelCase in case you intend to use the variable (or function) in another package, or you can safely stick with camelCase.</p>\n"}, {"comments": [{"owner": {"reputation": 5663, "user_id": 6505847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MhmSw.jpg?s=128&g=1", "display_name": "AzyCrw4282", "link": "https://stackoverflow.com/users/6505847/azycrw4282"}, "edited": false, "score": 0, "creation_date": 1596056324, "post_id": 38616879, "comment_id": 111691616, "body": "just learning golang and was stuck on this for days. Finally solved it!"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 30, "last_activity_date": 1469632101, "creation_date": 1469632101, "answer_id": 38616879, "question_id": 38616687, "link": "https://stackoverflow.com/questions/38616687/which-way-to-name-a-function-in-go-camelcase-or-semi-camelcase/38616879#38616879", "title": "Which way to name a function in Go, CamelCase or Semi-CamelCase?", "body": "<p>In Go, it is convention to uses mixed cap. From the docs: <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"noreferrer\">https://golang.org/doc/effective_go.html#mixed-caps</a></p>\n\n<blockquote>\n  <p>Finally, the convention in Go is to use MixedCaps or mixedCaps rather\n  than underscores to write multiword names.</p>\n</blockquote>\n\n<p>Note that file level names beginning with Capital letter are exported at package level: <a href=\"https://golang.org/doc/effective_go.html#Getters\" rel=\"noreferrer\">https://golang.org/doc/effective_go.html#Getters</a></p>\n\n<p>Also, it is convention to write acronyms on all caps. So below is fine:</p>\n\n<pre><code>writeToMongoDB // unexported, only visible within the package\n</code></pre>\n\n<p>or</p>\n\n<pre><code>WriteToMongoDB // exported\n</code></pre>\n\n<p>And not:</p>\n\n<pre><code>writeToMongoDb\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 18, "last_activity_date": 1469632814, "last_edit_date": 1469632814, "creation_date": 1469632362, "answer_id": 38616979, "question_id": 38616687, "link": "https://stackoverflow.com/questions/38616687/which-way-to-name-a-function-in-go-camelcase-or-semi-camelcase/38616979#38616979", "title": "Which way to name a function in Go, CamelCase or Semi-CamelCase?", "body": "<p>Names</p>\n\n<blockquote>\n  <p>Names are as important in Go as in any other language. They even have\n  semantic effect: <strong>the visibility of a name outside a package is\n  determined by whether its first character is upper case</strong>. It's\n  therefore worth spending a little time talking about naming\n  conventions in Go programs.</p>\n</blockquote>\n\n<p>Package names</p>\n\n<blockquote>\n  <p>When a package is imported, the package name becomes an accessor for\n  the contents. After</p>\n  \n  <p>import \"bytes\" the importing package can talk about bytes.Buffer. It's\n  helpful if everyone using the package can use the same name to refer\n  to its contents, which implies that the package name should be good:\n  short, concise, evocative. <strong>By convention, packages are given lower\n  case, single-word names; there should be no need for underscores or\n  mixedCaps</strong>. Err on the side of brevity, since everyone using your\n  package will be typing that name. And don't worry about collisions a\n  priori. The package name is only the default name for imports; it need\n  not be unique across all source code, and in the rare case of a\n  collision the importing package can choose a different name to use\n  locally. In any case, confusion is rare because the file name in the\n  import determines just which package is being used.</p>\n  \n  <p>Another convention is that the package name is the base name of its\n  source directory; the package in src/encoding/base64 is imported as\n  \"encoding/base64\" but has name base64, not encoding_base64 and not\n  encodingBase64.</p>\n  \n  <p>The importer of a package will use the name to refer to its contents,\n  so exported names in the package can use that fact to avoid stutter.\n  (Don't use the import . notation, which can simplify tests that must\n  run outside the package they are testing, but should otherwise be\n  avoided.) For instance, the buffered reader type in the bufio package\n  is called Reader, not BufReader, because users see it as bufio.Reader,\n  which is a clear, concise name. Moreover, because imported entities\n  are always addressed with their package name, bufio.Reader does not\n  conflict with io.Reader. Similarly, the function to make new instances\n  of ring.Ring\u2014which is the definition of a constructor in Go\u2014would\n  normally be called NewRing, but since Ring is the only type exported\n  by the package, and since the package is called ring, it's called just\n  New, which clients of the package see as ring.New. Use the package\n  structure to help you choose good names.</p>\n  \n  <p>Another short example is once.Do; once.Do(setup) reads well and would\n  not be improved by writing once.DoOrWaitUntilDone(setup). Long names\n  don't automatically make things more readable. <strong>A helpful doc comment\n  can often be more valuable than an extra long name</strong>.</p>\n</blockquote>\n\n<p>Getters</p>\n\n<blockquote>\n  <p>Go doesn't provide automatic support for getters and setters. There's\n  nothing wrong with providing getters and setters yourself, and it's\n  often appropriate to do so, but it's neither idiomatic nor necessary\n  to put Get into the getter's name. If you have a field called owner\n  (lower case, unexported), <strong>the getter method should be called Owner\n  (upper case, exported), not GetOwner</strong>. The use of upper-case names for\n  export provides the hook to discriminate the field from the method. <strong>A\n  setter function, if needed, will likely be called SetOwner</strong>. Both names\n  read well in practice:</p>\n</blockquote>\n\n<pre><code>owner := obj.Owner()\nif owner != user {\n    obj.SetOwner(user)\n}\n</code></pre>\n\n<p>Interface names</p>\n\n<blockquote>\n  <p><strong>By convention, one-method interfaces are named by the method name plus\n  an -er suffix or similar modification to construct an agent noun:\n  Reader, Writer, Formatter, CloseNotifier etc</strong>.</p>\n  \n  <p>There are a number of such names and it's productive to honor them and\n  the function names they capture. <strong>Read, Write, Close, Flush, String and\n  so on have canonical signatures and meanings. To avoid confusion,\n  don't give your method one of those names unless it has the same\n  signature and meaning.</strong> Conversely, if your type implements a method\n  with the same meaning as a method on a well-known type, give it the\n  same name and signature; <strong>call your string-converter method String not\n  ToString</strong>.</p>\n</blockquote>\n\n<p>MixedCaps</p>\n\n<blockquote>\n  <p><strong>Finally, the convention in Go is to use MixedCaps or mixedCaps rather\n  than underscores to write multiword names</strong>.</p>\n</blockquote>\n\n<p>ref: <a href=\"http://golang.org/doc/effective_go.html\" rel=\"noreferrer\">Effective Go</a></p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1602396283, "post_id": 38617771, "comment_id": 113703375, "body": "Great answer +1. The preferred Go term is MixedCaps or mixedCaps not CamelCase. See <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#mixed-caps</a>."}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 122, "last_activity_date": 1592572774, "last_edit_date": 1592572774, "creation_date": 1469634524, "answer_id": 38617771, "question_id": 38616687, "link": "https://stackoverflow.com/questions/38616687/which-way-to-name-a-function-in-go-camelcase-or-semi-camelcase/38617771#38617771", "title": "Which way to name a function in Go, CamelCase or Semi-CamelCase?", "body": "<h2>Syntax</h2>\n\n<p>In Go this is not a matter of style, it is a matter of syntax.</p>\n\n<p>Exported names (that is, identifiers that can be used from a package other than the one where they are defined) begin with a capital letter. Thus if your method is part of your public API, it should be written:</p>\n\n<p><code>WriteToDB</code></p>\n\n<p>but if it is an internal helper method it should be written:</p>\n\n<p><code>writeToDB</code></p>\n\n<p>The benefit of doing it this way over using keywords to define exportedness (<code>extern</code>, <code>public</code>, etc.) is that making it a part of the name ensures that anywhere an identifier is used you can tell if it is exported or not without having to find where it was defined (to see if the definition contains a keyword).</p>\n\n<p><strong>See also:</strong> <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"noreferrer\"><em>Exported Identifiers</em></a> from the spec.</p>\n\n<h3>i18n</h3>\n\n<p>Because Go is UTF-8 encoded and supports any Unicode character with the letters or numbers property in identifier names some people in locales that don't have a concept of case may have trouble creating exported methods (the default is non-exported). In this case (pun intended) it is common to prefix identifiers with an <code>X</code> to indicate exportedness. For example: <code>X\u65e5\u672c\u8a9e</code></p>\n\n<p><strong>See also:</strong> <a href=\"https://golang.org/doc/faq#unicode_identifiers\" rel=\"noreferrer\"><em>What's up with Unicode identifiers?</em></a> from the FAQ.</p>\n\n<h2>Style</h2>\n\n<p>As far as the general style goes, it is to always use camel-case (except for the first letter, as previously mentioned). This includes constants, functions, and other identifiers. So for example a list of (exported) constants might look like:</p>\n\n<pre><code>const (\n    StateConnected = iota\n    StateError\n    StateDone\n\n    internalStateMask = 0x2 \n)\n</code></pre>\n\n<p>Furthermore, abbreviations are always written with the same case, so you would write one of the following:</p>\n\n<pre><code>dbWrite\nwriteDB\n</code></pre>\n\n<p>instead of <code>writeDb</code> or <code>DbWrite</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61408, "favorite_count": 16, "answer_count": 4, "score": 85, "last_activity_date": 1592572774, "creation_date": 1469631699, "question_id": 38616687, "link": "https://stackoverflow.com/questions/38616687/which-way-to-name-a-function-in-go-camelcase-or-semi-camelcase", "title": "Which way to name a function in Go, CamelCase or Semi-CamelCase?", "body": "<p>I want to write a function in Go to insert a document into a collection in a MongoDB database. Which way to name the function is better, </p>\n\n<ul>\n<li><code>writeToMongoDB</code> or </li>\n<li><code>WriteToMongoD</code>? </li>\n</ul>\n\n<p>The second is CamelCase, while I saw someone using the style of the first one, so I am not sure which one is more appropriate. Thanks.</p>\n"}, {"tags": ["http", "go", "session-cookies", "http-redirect"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469623118, "post_id": 38613179, "comment_id": 64612579, "body": "How to store cookies is a completely separate question from how to check the redirect response."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469623347, "post_id": 38613179, "comment_id": 64612757, "body": "Yes, that&#39;s the tricky part. I could get the single response using transport.RoundTrip instead of an http client, but I am also looking for a solution that can retrieve the cookie."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469623535, "post_id": 38613179, "comment_id": 64612903, "body": "Doesn&#39;t the CookieJar work when you use the http.Client, but stop on the first redirect?"}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469623808, "post_id": 38613179, "comment_id": 64613101, "body": "yes, I am trying to find out how to not to make the client do redirects."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1469625370, "post_id": 38613179, "comment_id": 64614402, "body": "Possible duplicate questions: <a href=\"http://stackoverflow.com/questions/23297520/how-can-i-make-the-go-http-client-not-follow-redirects-automatically\" title=\"how can i make the go http client not follow redirects automatically\">stackoverflow.com/questions/23297520/&hellip;</a> <a href=\"http://stackoverflow.com/questions/14420222/query-url-without-redirect-in-go\" title=\"query url without redirect in go\">stackoverflow.com/questions/14420222/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469623748, "post_id": 38613417, "comment_id": 64613055, "body": "great! can you provide any sample code so that in case of response 302, the redirect is not followed?"}, {"owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "reply_to_user": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469624005, "post_id": 38613417, "comment_id": 64613266, "body": "@DanieleB - I&#39;ve updated my answer to show a simple implementation."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469624153, "post_id": 38613417, "comment_id": 64613396, "body": "Thanks, but I am not really sure how this should be used. What I want is: 1) the client should not follow the redirect; 2) I would be able to get the redirect URL; 3) the CookieJar would work as usual"}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469624281, "post_id": 38613417, "comment_id": 64613515, "body": "Ideally, it should be the equivalent of setting a &quot;flag&quot; on the client not to follow the redirect, and being able to inspect cookieJar and response, as usual"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 2, "creation_date": 1469624859, "post_id": 38613417, "comment_id": 64613974, "body": "@DanieleB: error returned from CheckRedirect is the &quot;flag&quot;"}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469625038, "post_id": 38613417, "comment_id": 64614123, "body": "I still don&#39;t understand how to use it."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469627424, "post_id": 38613417, "comment_id": 64615952, "body": "@DanieleB : You use the client, not the error. 1) This client does not follow redirect. 2) Inspect the Location header to find out the redirect URL. 3) Cookie jar should work."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1469628300, "post_id": 38613417, "comment_id": 64616632, "body": "@Volker thanks. So, is it enough to return any kind of error in the CheckRedirect function in order not to follow redirects?"}, {"owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "reply_to_user": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 0, "creation_date": 1469634166, "post_id": 38613417, "comment_id": 64621095, "body": "@DanieleB - would you accept my answer as correct? :)"}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "edited": false, "score": 1, "creation_date": 1469685651, "post_id": 38613417, "comment_id": 64640696, "body": "I have just implemented it and it works great! I have also realized that it is even possibile to modify the request of the following redirect, and hence change the redirected url. Great stuff!"}], "tags": [], "owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "is_accepted": true, "score": 11, "last_activity_date": 1469629284, "last_edit_date": 1469629284, "creation_date": 1469623608, "answer_id": 38613417, "question_id": 38613179, "link": "https://stackoverflow.com/questions/38613179/golang-how-to-make-http-client-not-following-redirects/38613417#38613417", "title": "Golang: how to make http client not following redirects?", "body": "<p>If you use a <code>http.Client</code>, you have the option of using the <code>CheckRedirect</code> <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"noreferrer\">field</a>.</p>\n\n<p>This field takes a custom function which can then handle any redirects if an error is received by the initial request.</p>\n\n<p>A simple example might be something like this:</p>\n\n<pre><code>client: &amp;http.Client{\n    CheckRedirect: func(req *http.Request, via []*http.Request) error {\n        return errors.New(\"something bad happened\") // or maybe the error from the request\n    },\n}\n</code></pre>\n\n<p>You could also return the <code>http.ErrUseLastResponse</code> <a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go#L423\" rel=\"noreferrer\">error</a> which returns the most recent response with its body unclosed.</p>\n"}], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2563, "favorite_count": 0, "accepted_answer_id": 38613417, "answer_count": 1, "score": 1, "last_activity_date": 1469629284, "creation_date": 1469622993, "last_edit_date": 1469623916, "question_id": 38613179, "link": "https://stackoverflow.com/questions/38613179/golang-how-to-make-http-client-not-following-redirects", "title": "Golang: how to make http client not following redirects?", "body": "<p>I would like to make an http call using an http client with these characteristics:</p>\n\n<ul>\n<li>don't follow redirects (just get the full response of the first call, which returns a 302 redirect code)</li>\n<li>being able to receive cookies</li>\n</ul>\n\n<p>Hence, I am looking for a solution with <code>http.Client</code> rather than with <code>trasport.RoundTrip</code></p>\n\n<p>how can I do that?</p>\n"}, {"tags": ["encryption", "go", "tcp", "rsa"], "answers": [{"tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": false, "score": 2, "last_activity_date": 1469623773, "creation_date": 1469623773, "answer_id": 38613473, "question_id": 38612279, "link": "https://stackoverflow.com/questions/38612279/how-to-send-a-rsa-publickey-over-a-tcp-connection-in-go/38613473#38613473", "title": "How to send a rsa.PublicKey over a tcp connection in go?", "body": "<p>You need to serialise the <code>rsa.PublicKey</code> to a <code>[]byte</code>.  There are multiple ways of doing this, but I'd probably go with JSON.</p>\n\n<p>The struct looks like this, and everthing within it is a) Public and b) Serializable with JSON.</p>\n\n<pre><code>type PublicKey struct {\n    N *big.Int // modulus\n    E int      // public exponent\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 2, "last_activity_date": 1469630899, "creation_date": 1469630899, "answer_id": 38616355, "question_id": 38612279, "link": "https://stackoverflow.com/questions/38612279/how-to-send-a-rsa-publickey-over-a-tcp-connection-in-go/38616355#38616355", "title": "How to send a rsa.PublicKey over a tcp connection in go?", "body": "<p>If you are sending data from a Go program to another Go one (as you show in your examples), you can use the package <code>encoding/gob</code> <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow\">https://golang.org/pkg/encoding/gob/</a> to serialize (<code>Encode</code>) an object into a slice of bytes and deserialize (<code>Decode</code>) the received bytes back into the Go object.  Here's an example (also <a href=\"https://play.golang.org/p/3bxbqGtqQY\" rel=\"nofollow\">https://play.golang.org/p/3bxbqGtqQY</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    priv, _ := rsa.GenerateKey(rand.Reader, 512) // skipped error checking for brevity\n    pub := priv.PublicKey\n    // adapted from https://golang.org/pkg/encoding/gob/#example__basic:\n    // Initialize the encoder and decoder.  Normally enc and dec would be\n    // bound to network connections and the encoder and decoder would\n    // run in different processes.\n    var network bytes.Buffer        // Stand-in for a network connection\n    enc := gob.NewEncoder(&amp;network) // Will write to network.\n    dec := gob.NewDecoder(&amp;network) // Will read from network.\n    enc.Encode(&amp;pub)\n    var pub2 = rsa.PublicKey{}\n    dec.Decode(&amp;pub2)\n    if pub.N.Cmp(pub2.N) != 0 || pub.E != pub2.E {\n        log.Fatal(\"Public Keys at source and destination not equal\")\n    }\n    fmt.Printf(\"OK - %#v\\n\", pub2)\n}\n</code></pre>\n\n<p>Output similar to:</p>\n\n<p><code>OK -rsa.PublicKey{N:10881677056019504919833663670523712169444878787643568603135265932739968735275981472697621424678110007129031867528249518560683510901399549383480944574041391, E:65537}</code></p>\n\n<p>Sending gob blobs can be faster and more efficient then doing JSON encoding especially if you are doing a lot of it, but you need to decide whether it is a significant factor for you and whether you prefer text (JSON) or binary format (gob or protobufs) for data transport.</p>\n"}, {"tags": [], "owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "is_accepted": false, "score": 1, "last_activity_date": 1528310353, "creation_date": 1528310353, "answer_id": 50727386, "question_id": 38612279, "link": "https://stackoverflow.com/questions/38612279/how-to-send-a-rsa-publickey-over-a-tcp-connection-in-go/50727386#50727386", "title": "How to send a rsa.PublicKey over a tcp connection in go?", "body": "<p>i have this question, and there was simple answer, serialising whit marshal</p>\n\n<pre><code>private_key, err = rsa.GenerateKey(rand.Reader, 2048)\npublic_key = &amp;private_key.PublicKey\npubInJason,err:=json.Marshal(public_key)\nfmt.Println(\"public key in jason: \",string(pubInJason))\npub2:=&amp;rsa.PublicKey{}\nerr=json.Unmarshal(pubInJason,pub2)\nfmt.Println(\"public key from jason: \",pub2)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5327424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "accepted_answer_id": 38616355, "answer_count": 3, "score": 2, "last_activity_date": 1528310353, "creation_date": 1469620622, "question_id": 38612279, "link": "https://stackoverflow.com/questions/38612279/how-to-send-a-rsa-publickey-over-a-tcp-connection-in-go", "title": "How to send a rsa.PublicKey over a tcp connection in go?", "body": "<p>I've been trying to make a simple RSA encrypted chat app. The problem I've come across is having to send the rsa Public key over the tcp connection, as net.Conn , to my knowledge only accepts the type []byte. </p>\n\n<p><strong>Problem code</strong></p>\n\n<pre><code> conn.Write([]byte(public_key))\n</code></pre>\n\n<p>This is the code that is producing my complications.This code is under the function handleRequest. I understand that conn.Write can only accept the type []byte, but is there anywhere around this. How can I deliver the public_key to my client? I have included all my server code just in case. Also if you wish to obtain all server/client code comment so and I will create a github link. Thankyou</p>\n\n<p><strong>Just in case-server code</strong></p>\n\n<p><strong><em>main.go</em></strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jonfk/golang-chat/tcp/common\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"os\"\n)\n\nconst (\n    CONN_HOST = \"0.0.0.0\"\n    CONN_PORT = \"3333\"\n    CONN_TYPE = \"tcp\"\n)\n\nvar (\n    connections []net.Conn\n)\n\nfunc main() {\n    setUP(3072)\n    l, err := net.Listen(CONN_TYPE, CONN_HOST+\":\"+CONN_PORT)\n    if err != nil {\n        fmt.Println(\"Error listening:\", err.Error())\n        os.Exit(1)\n    }\n    // Close the listener when the application closes.\n    defer l.Close()\n    fmt.Println(\"Listening on \" + CONN_HOST + \":\" + CONN_PORT)\n    for {\n        // Listen for an incoming connection.\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n        // Save connection\n        connections = append(connections, conn)\n        // Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\n\n// Handles incoming requests.\nfunc handleRequest(conn net.Conn) {\n    //I use the common library but this is how it would look like using go's net library.\n    conn.Write([]byte(public_key))\n    //Using the import common library this is what the command would be \n    //common.WriteMsg(conn,string(public_key))\n    for {\n        msg, err := common.ReadMsg(conn)\n        if err != nil {\n            if err == io.EOF {\n                // Close the connection when you're done with it.\n                removeConn(conn)\n                conn.Close()\n                return\n            }\n            log.Println(err)\n            return\n        }\n        broadcast(conn, msg)\n    }\n}\n\nfunc removeConn(conn net.Conn) {\n    var i int\n    for i = range connections {\n        if connections[i] == conn {\n            break\n        }\n    }\n    connections = append(connections[:i], connections[i+1:]...)\n}\n\nfunc broadcast(conn net.Conn, msg string) {\n    for i := range connections {\n        if connections[i] != conn {\n            err := common.WriteMsg(connections[i], msg)\n            if err != nil {\n                log.Println(err)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong><em>encryption.go</em></strong></p>\n\n<pre><code>package main\nimport (\n    \"crypto/md5\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"log\"\n    )\nvar private_key *rsa.PrivateKey\nvar public_key *rsa.PublicKey\nvar encrypted,decrypted []byte\nfunc setUP(size int) bool{\n    var err error\n    if private_key,err = rsa.GenerateKey(rand.Reader,size); err != nil {\n        log.Fatal(err)\n        return false\n    }\n    private_key.Precompute()\n    if err= private_key.Validate();err != nil {\n        log.Fatal(err)\n        return false\n    }\n    public_key = &amp;private_key.PublicKey\n    return true\n}\nfunc encrypt(msg string) string {\n    var err error\n    var label []byte\n    md5h := md5.New()\n    if encrypted,err = rsa.EncryptOAEP(md5h,rand.Reader,public_key,[]byte(msg),label); err != nil {\n        log.Fatal(err)\n    }\n    return string(encrypted)\n}\nfunc decrypt(msg string) string {\n    var err error\n    var label []byte\n    md5h := md5.New()\n    if decrypted,err = rsa.DecryptOAEP(md5h,rand.Reader,private_key,[]byte(msg),label); err != nil {\n        log.Fatal(err)\n    }\n    return string(decrypted)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 4, "creation_date": 1469618556, "post_id": 38611518, "comment_id": 64609280, "body": "The operator is <code>*=</code>, not <code>*</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2756, "user_id": 1704453, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rehw8.jpg?s=128&g=1", "display_name": "vipin cp", "link": "https://stackoverflow.com/users/1704453/vipin-cp"}, "edited": false, "score": 1, "creation_date": 1469618557, "post_id": 38611548, "comment_id": 64609282, "body": "I was writing this :)"}, {"owner": {"reputation": 808, "user_id": 6532640, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-8Uw3zcKUw5c/AAAAAAAAAAI/AAAAAAAAACE/yaXF1QrLkjM/photo.jpg?sz=128", "display_name": "NatNgs", "link": "https://stackoverflow.com/users/6532640/natngs"}, "edited": false, "score": 1, "creation_date": 1469618781, "post_id": 38611548, "comment_id": 64609439, "body": "You can also use <code>A += B</code> to mean <code>A = A + B</code>, <code>A -= B</code> as <code>A = A - B</code>, <code>A &#47;= B</code> and <code>A %= B</code> (ans maybe others like <code>A |= B</code> that&#39;s equals to <code>A = A | B</code> ...)"}, {"owner": {"reputation": 27113, "user_id": 1993204, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/n4qZa.jpg?s=128&g=1", "display_name": "Bartek Lipinski", "link": "https://stackoverflow.com/users/1993204/bartek-lipinski"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1469724222, "post_id": 38611548, "comment_id": 64667571, "body": "@Theuserwithnohat feel free to accept the answer if it helped you ;)"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1469731968, "post_id": 38611548, "comment_id": 64672080, "body": "@BartekLipinski done! I had to wait x minutes before to be able to accept it!"}], "tags": [], "owner": {"reputation": 27113, "user_id": 1993204, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/n4qZa.jpg?s=128&g=1", "display_name": "Bartek Lipinski", "link": "https://stackoverflow.com/users/1993204/bartek-lipinski"}, "is_accepted": true, "score": 8, "last_activity_date": 1469618507, "creation_date": 1469618507, "answer_id": 38611548, "question_id": 38611518, "link": "https://stackoverflow.com/questions/38611518/what-does-size-b-a-means/38611548#38611548", "title": "what does `size *= b - a` means?", "body": "<p>I don't know <code>go</code>, but isn't that just equal to a regular</p>\n\n<pre><code>size = size * (b-a)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 3, "last_activity_date": 1469618636, "creation_date": 1469618636, "answer_id": 38611596, "question_id": 38611518, "link": "https://stackoverflow.com/questions/38611518/what-does-size-b-a-means/38611596#38611596", "title": "what does `size *= b - a` means?", "body": "<p><code>*=</code> is a short hand operator in go. Above line <code>size *= b - a</code> is simply equivalent to:</p>\n\n<pre><code>size = size * (b - a)\n</code></pre>\n\n<p>Check out <em>Operators and Delimiters</em> here: <a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">https://golang.org/ref/spec</a></p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 38611548, "answer_count": 2, "score": 1, "last_activity_date": 1469618636, "creation_date": 1469618392, "question_id": 38611518, "link": "https://stackoverflow.com/questions/38611518/what-does-size-b-a-means", "title": "what does `size *= b - a` means?", "body": "<p>I've found the following notation <code>size *= b - a</code>. I've inspected it with reflect but it seems that size is just a float64 (a,b are floats too)so my question is what is <code>*</code> for?I expected it to dereference a pointer (size) but it doesn't seem to be the case.</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 547, "user_id": 5810474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108078f0353c37a619786a600fbbaec1?s=128&d=identicon&r=PG&f=1", "display_name": "Toni Villena", "link": "https://stackoverflow.com/users/5810474/toni-villena"}, "is_accepted": true, "score": 1, "last_activity_date": 1469619859, "creation_date": 1469619859, "answer_id": 38612017, "question_id": 38610383, "link": "https://stackoverflow.com/questions/38610383/golang-set-struct-field-using-reflect/38612017#38612017", "title": "Golang set struct field using reflect", "body": "<p><code>t.H</code> is nil because you are giving an incorrect value in <code>Set</code> method. You are getting <code>Value</code> of <code>reflect.New</code>'s return (<code>reflect.New(...).Elem()</code> is <code>Hello</code> type, no <code>*Hello</code> type and type of <code>H</code> field is <code>*Hello</code> type). If you change the type of <code>H</code>field to <code>Hello</code> type, you will see that it is initialized okay Then, you should do this:</p>\n\n<pre><code>controllerStruct.Elem().Field(i).Set(\n    reflect.New(\n        controllerStruct.Elem().Field(i).Type().Elem(),\n    ),\n)\n</code></pre>\n\n<p>Value of <code>reflect.New(controllerStruct.Elem().Field(i).Type().Elem())</code> is a new <code>*Hello</code> struct.</p>\n\n<p>I hope that it's useful to you! :-)</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3038, "favorite_count": 0, "accepted_answer_id": 38612017, "answer_count": 1, "score": 1, "last_activity_date": 1511917607, "creation_date": 1469615276, "last_edit_date": 1511917607, "question_id": 38610383, "link": "https://stackoverflow.com/questions/38610383/golang-set-struct-field-using-reflect", "title": "Golang set struct field using reflect", "body": "<p>I am currently doing the following</p>\n\n<pre><code>func Test(controller interface{}) {\n    controllerType := reflect.TypeOf(controller)\n    controllerFunc := reflect.ValueOf(controller)\n    controllerStruct := reflect.New(controllerType.In(0))\n    for i := 0; i &lt; controllerStruct.Elem().NumField(); i++ {\n        if controllerStruct.Elem().Field(i).Kind().String() == \"ptr\" {\n            controllerStruct.Elem().Field(i).Set(\n                reflect.New(\n                    controllerStruct.Elem().Field(i).Type(),\n                ).Elem(),\n            )\n        }\n    }\n    controllerFunc.Call([]reflect.Value{\n        controllerStruct.Elem(),\n    })\n}\n</code></pre>\n\n<p>Using the following function call</p>\n\n<pre><code>Test(controllers.Test.IsWorking)\n\ntype Test struct {\n    Name string\n    H    *Hello\n}\n\ntype Hello struct {\n    Friend string\n}\n\nfunc (t Test) IsWorking() {\n    log.Println(t.H)\n}\n</code></pre>\n\n<p><code>t.H</code> is always <code>nil</code> even tho I am setting it on the for loop. Also I am not sure if this is the correct way to make this since what about if <code>Hello</code> struct contains another pointer to a struct. Is there a better method to achieve what I am trying to do and why is <code>t.H</code> <code>nil</code> if I am setting it up</p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 11, "last_activity_date": 1469609091, "creation_date": 1469609091, "answer_id": 38608022, "question_id": 38607733, "link": "https://stackoverflow.com/questions/38607733/sorting-a-uint64-slice-in-go/38608022#38608022", "title": "sorting a uint64 slice in go", "body": "<p>You can define <code>sort.Interface</code> on your <code>dirRange</code>, which can be a type aliasing <code>[]uint64</code>:</p>\n\n<pre><code>type DirRange []uint64\n\nfunc (a DirRange) Len() int           { return len(a) }\nfunc (a DirRange) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a DirRange) Less(i, j int) bool { return a[i] &lt; a[j] }\n\nfunc main() {\n    dirRange := DirRange{2, 5, 7, 1, 9, 4}\n    sort.Sort(dirRange)\n    fmt.Println(dirRange)   \n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[1 2 4 5 7 9]\n</code></pre>\n\n<p>This way you can avoid casting and work directly with your array. Since the underlying type is a slice <code>[]uint64</code>, you can still use general slice operations. For example:</p>\n\n<pre><code>dirRange := make(DirRange, 10)\ndirRange = append(dirRange, 2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1469609499, "creation_date": 1469609499, "answer_id": 38608178, "question_id": 38607733, "link": "https://stackoverflow.com/questions/38607733/sorting-a-uint64-slice-in-go/38608178#38608178", "title": "sorting a uint64 slice in go", "body": "<p>You can provide a type alias for []uint64, add the standard \"boilerplate\" sorting methods to implement <code>sort.interface</code> (<code>Len</code>, <code>Swap</code>, and <code>Less</code> - <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow\">https://golang.org/pkg/sort/#Interface</a>); then either create an instance of the new type or typecast an existing slice []uint64 into the new type, as done in the following example (also <a href=\"https://play.golang.org/p/BbB3L9TmBI\" rel=\"nofollow\">https://play.golang.org/p/BbB3L9TmBI</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype uint64arr []uint64\n\nfunc (a uint64arr) Len() int           { return len(a) }\nfunc (a uint64arr) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a uint64arr) Less(i, j int) bool { return a[i] &lt; a[j] }\nfunc (a uint64arr) String() (s string) {\n    sep := \"\" // for printing separating commas\n    for _, el := range a {\n        s += sep\n        sep = \", \"\n        s += fmt.Sprintf(\"%d\", el)\n    }\n    return\n}\n\nfunc main() {\n    dirRange := []uint64{3, 2, 400000}\n    arr := uint64arr(dirRange)\n    sort.Sort(arr)\n    fmt.Printf(\"%s\\n\", arr)\n    fmt.Printf(\"%#v\\n\", dirRange)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>2, 3, 400000\n[]uint64{0x2, 0x3, 0x61a80}\n</code></pre>\n\n<p>showing that both arrays are sorted since the second one is a typecasted alias for the original. </p>\n"}, {"comments": [{"owner": {"reputation": 1227, "user_id": 679692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9e06dfdd4b7e811f1b452c652f54d9e?s=128&d=identicon&r=PG", "display_name": "allonhadaya", "link": "https://stackoverflow.com/users/679692/allonhadaya"}, "edited": false, "score": 3, "creation_date": 1517870750, "post_id": 48568680, "comment_id": 84262592, "body": "I cannot make the edit myself because it is less than 6 characters, but your second argument to Slice, the comparison func needs to declare the index parameters <code>i</code> and <code>j</code>."}, {"owner": {"reputation": 334, "user_id": 1076507, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p1B16.png?s=128&g=1", "display_name": "0x574F4F54", "link": "https://stackoverflow.com/users/1076507/0x574f4f54"}, "edited": false, "score": 0, "creation_date": 1606838077, "post_id": 48568680, "comment_id": 115080124, "body": "For the curious: int in golang are platform-dependent and signed (<a href=\"https://golang.org/doc/go1.1#int\" rel=\"nofollow noreferrer\">golang.org/doc/go1.1#int</a>). Signed 64bit range quite large and isn&#39;t a real limit when sorting enormous slices"}], "tags": [], "owner": {"reputation": 1439, "user_id": 1004687, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UivKO.jpg?s=128&g=1", "display_name": "vicentazo", "link": "https://stackoverflow.com/users/1004687/vicentazo"}, "is_accepted": true, "score": 47, "last_activity_date": 1517930189, "last_edit_date": 1517930189, "creation_date": 1517506698, "answer_id": 48568680, "question_id": 38607733, "link": "https://stackoverflow.com/questions/38607733/sorting-a-uint64-slice-in-go/48568680#48568680", "title": "sorting a uint64 slice in go", "body": "<p>As of version 1.8, you can use the simpler function <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"noreferrer\"><code>sort.Slice</code></a>. In your case, it would be something like the following:</p>\n\n<pre><code>sort.Slice(dirRange, func(i, j int) bool { return dirRange[i] &lt; dirRange[j] })\n</code></pre>\n\n<p>This avoids having to define any type just for the sorting.</p>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18325, "favorite_count": 6, "accepted_answer_id": 48568680, "answer_count": 3, "score": 28, "last_activity_date": 1519121745, "creation_date": 1469608218, "last_edit_date": 1519121745, "question_id": 38607733, "link": "https://stackoverflow.com/questions/38607733/sorting-a-uint64-slice-in-go", "title": "sorting a uint64 slice in go", "body": "<p>I'm writing Go application using Go 1.7rc3.</p>\n\n<p>I have a slice of uint64 (<code>var dirRange []uint64</code>) that I want to sort.</p>\n\n<p>the sort package has a function <code>sort.Ints()</code> but it requires <code>[]int</code> and I have <code>[]uint64</code>. </p>\n\n<p>what do I do? can I type cast the all slice ?</p>\n\n<p>thanks</p>\n"}, {"tags": ["multidimensional-array", "go", "append"], "comments": [{"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469608214, "post_id": 38607117, "comment_id": 64602111, "body": "are you sure you copied your code correctly?  When I copy your program to <a href=\"https://play.golang.org/p/mJeZsXlP7r\" rel=\"nofollow noreferrer\">play.golang.org/p/mJeZsXlP7r</a> and run it, it produces as output only &#39;Final Array []&#39; (try it)"}, {"owner": {"reputation": 6693, "user_id": 4180674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/95bQJ.jpg?s=128&g=1", "display_name": "Girish Sortur", "link": "https://stackoverflow.com/users/4180674/girish-sortur"}, "reply_to_user": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469608323, "post_id": 38607117, "comment_id": 64602195, "body": "@dmitris are you sure that golang playground allows us to provide input when it runs?"}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469610012, "post_id": 38607117, "comment_id": 64603365, "body": "Never mind, you are right - no stdin in the  Playgroun! :) <a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt/#Scanf</a> - &quot;Scanf scans text read from standard input, storing successive space-separated values into successive arguments as determined by the format. &quot;"}], "answers": [{"comments": [{"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469612730, "post_id": 38607416, "comment_id": 64605202, "body": "Really want to know why append function is appending as well as replacing existing data"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 3, "last_activity_date": 1469607854, "last_edit_date": 1469607854, "creation_date": 1469607236, "answer_id": 38607416, "question_id": 38607117, "link": "https://stackoverflow.com/questions/38607117/golang-multidimensional-array-using-slice-of-slice-strategy-resulting-in-strang/38607416#38607416", "title": "Golang: Multidimensional array using slice of slice strategy resulting in strange output", "body": "<p>This behaviour is occurring because you are not adding a new <code>row</code> slice to your <code>array</code>. Each iteration simply reads into the same <code>row</code> slice overriding previous values. Try below:</p>\n\n<pre><code>func main() {\n    var n int\n    fmt.Scanf(\"%d\", &amp;n)\n    array := [][]int{}\n\n    for i := 0; i &lt; n; i++ {\n        row := make([]int, n) // create a new slice to add next row values\n        for j, _ := range row {\n            fmt.Scanf(\"%d\", &amp;row[j])\n        }\n        fmt.Println(\"Printing current Row\", row)\n        array = append(array, row)\n        fmt.Println(\"Printing curent Array\", array)\n    }\n    fmt.Println(\"Final Array\", array)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469612796, "post_id": 38607548, "comment_id": 64605250, "body": "Thanks but want to know why append is behaving so strange that it is appending new row as well as updating others"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469613635, "post_id": 38607548, "comment_id": 64605884, "body": "@AbhishekSoni: the problem is not the append, you read data to same memory by <code>fmt.Scanf(&quot;%d&quot;, &amp;row[j])</code> for append see: <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Appending_and_copying_slices</a>"}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469614601, "post_id": 38607548, "comment_id": 64606572, "body": "i didn&#39;t get because according to me i appended a slice in first iteration to array after that i again pushed the same slice with altered values to  array , Now how can during next append it can get same reference for all appended values"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469615888, "post_id": 38607548, "comment_id": 64607487, "body": "@AbhishekSoni : see new Edit , i hope this helps."}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1469627574, "post_id": 38607548, "comment_id": 64616079, "body": "Thanks a lot it helped, what i learned is append function is based on reference and this model is quite different from c++ or java where after pushing the values to array , you can use the same reference variable."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1469616645, "last_edit_date": 1469616645, "creation_date": 1469607650, "answer_id": 38607548, "question_id": 38607117, "link": "https://stackoverflow.com/questions/38607117/golang-multidimensional-array-using-slice-of-slice-strategy-resulting-in-strang/38607548#38607548", "title": "Golang: Multidimensional array using slice of slice strategy resulting in strange output", "body": "<p><strong>use new slice for each iteration of the first loop, and check for the errors</strong>:  </p>\n\n<p><strong>you read new data to the old same slice</strong>, this is why you have duplicated data.  </p>\n\n<p>if you want to use <code>append</code> first create array with <strong>zero length</strong> and cap <code>n</code>:<br>\n <code>array := make([][]int, 0, n)</code><br>\nthen change your first loop to: <code>for i := 0; i &lt; n; i++ {</code><br>\nand inside this loop make new slice: <code>row := make([]int, n)</code></p>\n\n<p>2 way:<br>\nusing append (without <code>fmt.Scan</code> error checking):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    n := 0\n    fmt.Scan(&amp;n)\n    slice := make([][]int, 0, n)\n    for i := 0; i &lt; n; i++ {\n        row := make([]int, n)\n        for j, _ := range row {\n            fmt.Scan(&amp;row[j])\n        }\n        slice = append(slice, row)\n    }\n    fmt.Println(slice)\n}\n</code></pre>\n\n<p><strong>without using append</strong>  read to <code>s[i][j]</code> (with error checking):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var n int\n    if m, err := fmt.Scan(&amp;n); m != 1 {\n        panic(err)\n    }\n    s := make([][]int, n)\n    for i := 0; i &lt; n; i++ {\n        s[i] = make([]int, n)\n        for j := 0; j &lt; n; j++ {\n            if m, err := fmt.Scan(&amp;s[i][j]); m != 1 {\n                panic(err)\n            }\n        }\n    }\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>input:  </p>\n\n<pre><code>2\n1 2\n3 4\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>[[1 2] [3 4]]\n</code></pre>\n\n<hr>\n\n<p>I think this test sample code is clear enough to<br>\nshow <strong>how slice of slice works</strong> (with commented output):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s1 := [][]int{}\n    s2 := []int{1, 2}\n    s1 = append(s1, s2)\n    fmt.Println(s1) // [[1 2]]\n\n    s2[0], s2[1] = 3, 4\n    fmt.Println(s1) // [[3 4]]\n\n    s1 = append(s1, s2)\n\n    fmt.Println(s1) // [[3 4] [3 4]]\n\n    s2[0], s2[1] = 30, 40\n    fmt.Println(s1) // [[30 40] [30 40]]\n\n    fmt.Println(len(s2), cap(s2)) // 2 2\n\n    s3 := [][]int{\n        []int{1, 2},\n        []int{3, 4},\n        s2,\n        s2,\n    }\n    fmt.Println(s3) // [[1 2] [3 4] [30 40] [30 40]]\n    s2[0] = 100\n    fmt.Println(s3) // [[1 2] [3 4] [100 40] [100 40]]\n}\n</code></pre>\n\n<p>you created slice of slice <code>s1</code> like this :<br>\narray [0] =    row[0], row[1]<br>\narray [1] =    row[0], row[1] </p>\n\n<p>so when you change row it will seen twice.</p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2649, "favorite_count": 0, "accepted_answer_id": 38607548, "answer_count": 2, "score": 3, "last_activity_date": 1469616645, "creation_date": 1469606333, "question_id": 38607117, "link": "https://stackoverflow.com/questions/38607117/golang-multidimensional-array-using-slice-of-slice-strategy-resulting-in-strang", "title": "Golang: Multidimensional array using slice of slice strategy resulting in strange output", "body": "<p>I am using following simple code for 2d array in golang, where <strong>APPEND</strong> function is resulting in Duplicate values rather than appending. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var n int\n    fmt.Scanf(\"%d\", &amp;n)\n    array := [][]int{}\n    row := make([]int, n)\n    for _, _ = range row {\n        for j, _ := range row {\n            fmt.Scanf(\"%d\", &amp;row[j])\n        }\n        fmt.Println(\"Printing current Row\", row)\n        array = append(array, row)\n        fmt.Println(\"Printing curent Array\", array)\n    }\n    fmt.Println(\"Final Array\", array)\n}\n</code></pre>\n\n<p>But Strangely this are not going unexpectedly.\nIf suppose i want this thing to happen(input)</p>\n\n<pre><code>2\n1 2\n3 4\n</code></pre>\n\n<p>and i run this program i get this in return</p>\n\n<pre><code>2     //Dimension for matrix\n1     //Iteration one begins\n2\nPrinting current Row [1 2]\nPrinting curent Array [[1 2]]\n3     //Iteration two begins\n4\nPrinting current Row [3 4]\nPrinting curent Array [[3 4] [3 4]]\nFinal Array [[3 4] [3 4]]\n</code></pre>\n\n<p>I am not getting reason that why <strong>APPEND</strong> function is resulting in duplicating entries .\nThere by want to know how to correct this also underlying <strong>CONCEPT</strong></p>\n"}, {"tags": ["go", "exit", "die"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1469601594, "last_edit_date": 1469601594, "creation_date": 1469601212, "answer_id": 38605367, "question_id": 38605226, "link": "https://stackoverflow.com/questions/38605226/how-to-implement-a-php-function-die-or-exit-in-go/38605367#38605367", "title": "How to implement a PHP function `die()` (or `exit()`) in Go?", "body": "<p>You can use <code>panic</code> in HTTP handler. Server will handle it. See <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\">Handler</a>.</p>\n\n<blockquote>\n  <p>If ServeHTTP panics, the server (the caller of ServeHTTP) assumes that the effect of the panic was isolated to the active request. It recovers the panic, logs a stack trace to the server error log, and hangs up the connection.</p>\n</blockquote>\n\n<p>Function <code>panic</code> is reserved for the situation when program just cannot continue. Inability to serve just one request is not the same as inability to continue to work, so I would log the error, set a correct HTTP status and use <code>return</code>. See <a href=\"https://golang.org/doc/effective_go.html#panic\" rel=\"nofollow\">Effective Go</a>.</p>\n\n<blockquote>\n  <p>The usual way to report an error to a caller is to return an error as an extra return value. The canonical Read method is a well-known instance; it returns a byte count and an error. But what if the error is unrecoverable? Sometimes the program simply cannot continue.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1469602727, "creation_date": 1469602727, "answer_id": 38605848, "question_id": 38605226, "link": "https://stackoverflow.com/questions/38605226/how-to-implement-a-php-function-die-or-exit-in-go/38605848#38605848", "title": "How to implement a PHP function `die()` (or `exit()`) in Go?", "body": "<p>The idiomatic way to break a function in Go is to use <code>panic()</code>. This is the defacto way to stop the execution of an event on runtime. If you want to recover the panic you can use the built in <code>recover()</code> function. </p>\n\n<p><strong>Panic</strong> explanation:</p>\n\n<blockquote>\n  <p>Panic is a built-in function that stops the ordinary flow of control\n  and begins panicking. When the function F calls panic, execution of F\n  stops, any deferred functions in F are executed normally, and then F\n  returns to its caller. </p>\n</blockquote>\n\n<p><a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow\">https://blog.golang.org/defer-panic-and-recover</a></p>\n\n<p><strong>Recover</strong> explanation:</p>\n\n<blockquote>\n  <p>Recover is a built-in function that regains control of a panicking\n  goroutine. Recover is only useful inside deferred functions. During\n  normal execution, a call to recover will return nil and have no other\n  effect. If the current goroutine is panicking, a call to recover will\n  capture the value given to panic and resume normal execution.</p>\n</blockquote>\n\n<p><a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow\">https://blog.golang.org/defer-panic-and-recover</a></p>\n\n<p>And here is a simple example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc badCall() {\n    panic(\"Bad call happend!\")\n}\n\nfunc test() {\n    defer func() {\n        if err := recover(); err != nil {\n            fmt.Printf(\"Panicking %s\\n\\r\", err)\n        }\n    }()\n\n    badCall()\n    fmt.Println(\"This is never executed!!\")\n}\n\nfunc main() {\n    fmt.Println(\"Start testing\")\n    test()\n    fmt.Println(\"End testing\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": false, "score": 1, "last_activity_date": 1469606009, "last_edit_date": 1469606009, "creation_date": 1469603028, "answer_id": 38605947, "question_id": 38605226, "link": "https://stackoverflow.com/questions/38605226/how-to-implement-a-php-function-die-or-exit-in-go/38605947#38605947", "title": "How to implement a PHP function `die()` (or `exit()`) in Go?", "body": "<p>If you don't want to print a stack trace after exiting the program, you can use <a href=\"https://golang.org/pkg/os/#Exit\" rel=\"nofollow\"><code>os.Exit</code></a>. Also you are able to set a specific exit code with <code>os.Exit</code>.</p>\n\n<p><strong>Example</strong> (<a href=\"https://play.golang.org/p/XhDkKMhtpm\" rel=\"nofollow\">https://play.golang.org/p/XhDkKMhtpm</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc foo() {\n    fmt.Println(\"bim\")\n    os.Exit(1)\n    fmt.Println(\"baz\")\n}\n\nfunc main() {\n    foo()\n    foo()\n}\n</code></pre>\n\n<p>Also be aware, that <code>os.Exit</code> immediately stops the program and doesn't run any deferred functions, while <code>panic()</code> does. See <a href=\"https://play.golang.org/p/KjGFZzTrJ7\" rel=\"nofollow\">https://play.golang.org/p/KjGFZzTrJ7</a> and <a href=\"https://play.golang.org/p/Q4iciT35kP\" rel=\"nofollow\">https://play.golang.org/p/Q4iciT35kP</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "is_accepted": true, "score": 5, "last_activity_date": 1469604750, "creation_date": 1469604750, "answer_id": 38606588, "question_id": 38605226, "link": "https://stackoverflow.com/questions/38605226/how-to-implement-a-php-function-die-or-exit-in-go/38606588#38606588", "title": "How to implement a PHP function `die()` (or `exit()`) in Go?", "body": "<p>You should use <code>os.Exit</code>. </p>\n\n<blockquote>\n  <p>Exit causes the current program to exit with the given status code.\n  Conventionally, code zero indicates success, non-zero an error. The\n  program terminates immediately; deferred functions are not run.</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\n\nfunc main() {\n    fmt.Println(\"Start\")\n    os.Exit(1)\n    fmt.Println(\"End\")\n}\n</code></pre>\n\n<p>Even, you can use <code>panic</code>, it's also stop normal execution but throw Error when execution stop.  </p>\n\n<blockquote>\n  <p>The panic built-in function stops normal execution of the current\n  goroutine. When a function F calls panic, normal execution of F stops\n  immediately. Any functions whose execution was deferred by F are run\n  in the usual way, and then F returns to its caller. To the caller G,\n  the invocation of F then behaves like a call to panic, terminating G's\n  execution and running any deferred functions. This continues until all\n  functions in the executing goroutine have stopped, in reverse order.\n  At that point, the program is terminated and the error condition is\n  reported, including the value of the argument to panic. This\n  termination sequence is called panicking and can be controlled by the\n  built-in function recover.</p>\n</blockquote>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Start\")\n    panic(\"exit\")\n    fmt.Println(\"End\")\n}\n</code></pre>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2863, "favorite_count": 1, "accepted_answer_id": 38606588, "answer_count": 4, "score": 4, "last_activity_date": 1535701999, "creation_date": 1469600682, "question_id": 38605226, "link": "https://stackoverflow.com/questions/38605226/how-to-implement-a-php-function-die-or-exit-in-go", "title": "How to implement a PHP function `die()` (or `exit()`) in Go?", "body": "<p>In PHP, <code>die()</code> is used to stop running the script for preventing the unexpected behaviour. In Go, what is the idiomatic way to die a handle function? <code>panic()</code> or <code>return</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 6, "creation_date": 1469593040, "post_id": 38603623, "comment_id": 64594446, "body": "Go types don&#39;t even have parents, let alone a common ancestor."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1469595919, "post_id": 38603623, "comment_id": 64595350, "body": "There are no classes in go. What specific problem are you trying to solve?"}, {"owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "edited": false, "score": 0, "creation_date": 1469600517, "post_id": 38603623, "comment_id": 64597284, "body": "In java there are some default implementation for methods like <code>getHashCode</code> or <code>toString</code>. What happens to them in golang?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1469600635, "post_id": 38603623, "comment_id": 64597349, "body": "there is Stringer interface instead of toString:  <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#interface_conversions</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1469602520, "post_id": 38603623, "comment_id": 64598430, "body": "for better help please provide use cases in new questions with  <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 3, "creation_date": 1469596327, "post_id": 38603700, "comment_id": 64595486, "body": "It&#39;s inaccurate to say that go isn&#39;t an OOP language. It has objects (of any user-defined type) and methods, just not inheritance. But inheritance is not a defining property of OO languages -- see <a href=\"https://en.wikipedia.org/wiki/Object-oriented_programming\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Object-oriented_programming</a>"}, {"owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 2, "creation_date": 1469603347, "post_id": 38603700, "comment_id": 64598919, "body": "ACK. I always say that Go is object-oriented, but not class-based."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 7, "last_activity_date": 1469597038, "last_edit_date": 1495535390, "creation_date": 1469593530, "answer_id": 38603700, "question_id": 38603623, "link": "https://stackoverflow.com/questions/38603623/do-we-have-something-same-as-java-and-c-object-in-golang/38603700#38603700", "title": "Do we have something same as Java and C# Object in Golang?", "body": "<p><strong>There is no inheritance in Go.</strong><br>\nI think you are looking for <code>interface</code>: <a href=\"https://stackoverflow.com/questions/23148812/go-whats-the-meaning-of-interface\">Go: What&#39;s the meaning of interface{}?</a></p>\n\n<p>but if you need something similar to Object (not Class) you may use <code>interface</code>:  </p>\n\n<blockquote>\n  <p>Variables of interface type also have a distinct dynamic type, which\n  is the concrete type of the value assigned to the variable at run time\n  (unless the value is the predeclared identifier nil, which has no\n  type). The dynamic type may vary during execution but values stored in\n  interface variables are always assignable to the static type of the\n  variable.</p>\n\n<pre><code>var x interface{}  // x is nil and has static type interface{}\nvar v *T           // v has value nil, static type *T\nx = 42             // x has value 42 and dynamic type int\nx = v              // x has value (*T)(nil) and dynamic type *T\n</code></pre>\n</blockquote>\n\n<p>and:  </p>\n\n<p>Interface types:</p>\n\n<blockquote>\n  <p>An interface type specifies a method set called its interface. A\n  variable of interface type can store a value of any type with a method\n  set that is any superset of the interface. Such a type is said to\n  implement the interface. The value of an uninitialized variable of\n  interface type is nil.</p>\n</blockquote>\n\n<p>see:  <a href=\"http://golang.org/doc/go_spec.html\" rel=\"nofollow noreferrer\">http://golang.org/doc/go_spec.html</a>  </p>\n"}], "owner": {"reputation": 1393, "user_id": 2535843, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ijgr5.png?s=128&g=1", "display_name": "Mahdi", "link": "https://stackoverflow.com/users/2535843/mahdi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1872, "favorite_count": 1, "accepted_answer_id": 38603700, "answer_count": 1, "score": 3, "last_activity_date": 1469597038, "creation_date": 1469592990, "last_edit_date": 1469595584, "question_id": 38603623, "link": "https://stackoverflow.com/questions/38603623/do-we-have-something-same-as-java-and-c-object-in-golang", "title": "Do we have something same as Java and C# Object in Golang?", "body": "<p>In Java and C#, the <code>Object</code> class is implicitly parent of all classes that are defined. Is there something similar in go?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1469589693, "post_id": 38603082, "comment_id": 64593663, "body": "Calling the round tripper to ignore redirects is as simple as calling the client Do method: <code>resp, err := http.DefaultTransport.RoundTrip(req)</code>"}, {"owner": {"reputation": 936, "user_id": 1267758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e8e69107d92e6fdccfa30eb533efaa?s=128&d=identicon&r=PG", "display_name": "Andrew Leap", "link": "https://stackoverflow.com/users/1267758/andrew-leap"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1469589957, "post_id": 38603082, "comment_id": 64593729, "body": "Note, however, that that means the cookies won&#39;t get added to the cookie jar, you&#39;d have to parse and add them to it manually"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1469593643, "post_id": 38603082, "comment_id": 64594611, "body": "Oh, I missed the cookies. Yup, it&#39;s not simple."}], "tags": [], "owner": {"reputation": 936, "user_id": 1267758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e8e69107d92e6fdccfa30eb533efaa?s=128&d=identicon&r=PG", "display_name": "Andrew Leap", "link": "https://stackoverflow.com/users/1267758/andrew-leap"}, "is_accepted": true, "score": 1, "last_activity_date": 1469589174, "creation_date": 1469589174, "answer_id": 38603082, "question_id": 38602740, "link": "https://stackoverflow.com/questions/38602740/not-getting-location-header-from-golang-http-request/38603082#38603082", "title": "Not getting Location header from Golang http request", "body": "<p>You can get that url by checking <code>resp.Request.URL</code> after the <code>resp, err = newClient.Do(req)</code>.  There isn't a really simple way to ignore redirects, you can do a manual call through a <code>http.RoundTripper</code>, or you can set a <code>CheckRedirect</code> function on the client, but it's not ideal.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2443, "favorite_count": 0, "accepted_answer_id": 38603082, "answer_count": 1, "score": 0, "last_activity_date": 1469589174, "creation_date": 1469586610, "question_id": 38602740, "link": "https://stackoverflow.com/questions/38602740/not-getting-location-header-from-golang-http-request", "title": "Not getting Location header from Golang http request", "body": "<p>I'm trying to port over something I had written in Node, the request looks like this in Node(JS):</p>\n\n<pre><code>function _initialConnection(user, pass, callback) {\n  let opts = {\n    url: config.loginURL,\n    headers: {\n      \"User-Agent\": \"niantic\"\n    }\n  };\n\n  request.get(opts, (err, resp, body) =&gt; {\n    if (err) return callback(err, null);\n\n    console.log(resp.headers);\n\n    let data;\n    try {\n      data = JSON.parse(body);\n    } catch(err) {\n      return callback(err, null);\n    }\n    return callback(null, user, pass, data);\n  });\n}\n\nfunction _postConnection(user, pass, data, callback) {\n  let opts = {\n    url: config.loginURL,\n    form: {\n      'lt': data.lt,\n      'execution': data.execution,\n      '_eventId': 'submit',\n      'username': user,\n      'password': pass\n    },\n    headers: {\n      'User-Agent': 'niantic'\n    }\n  };\n\n\n  request.post(opts, (err, resp, body) =&gt; {\n    if (err) return callback(err, null);\n\n    let parsedBody;\n    if (body) {\n      try {\n        parsedBody = JSON.parse(body)\n        if (('errors' in parsedBody) &amp;&amp; parsedBody.errors.length &gt; 0) {\n          return callback(\n            new Error('Error Logging In: ' + paredBody.errors[0]),\n            null\n          )\n    }\n      } catch(err) {\n        return callback(err, null);\n      }\n    }\n\n    console.log(resp.headers)\n\n    let ticket = resp.headers['location'].split('ticket=')[1];\n\n    callback(null, ticket);\n  });\n}\n</code></pre>\n\n<p>If I <code>console.log(resp.headers)</code> I can see a location header.</p>\n\n<p>I have tried to recreate this in Go the best way I could which I ended up with:</p>\n\n<pre><code>// Initiate HTTP Client / Cookie JAR\n\njar, err := cookiejar.New(nil)\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to create new cookiejar for client\")\n}\nnewClient := &amp;http.Client{Jar: jar, Timeout: 5 * time.Second}\n\n// First Request\n\nreq, err := http.NewRequest(\"GET\", loginURL, nil)\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to authenticate with Google\\n Details: \\n\\n Username: %s\\n Password: %s\\n AuthType: %s\\n\", details.Username, details.Password, details.AuthType)\n}\nreq.Header.Set(\"User-Agent\", \"niantic\")\nresp, err := newClient.Do(req)\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to send intial handshake: %v\", err)\n}\nrespJSON := make(map[string]string)\nerr = json.NewDecoder(resp.Body).Decode(&amp;respJSON)\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to decode JSON Body: %v\", err)\n}\n\nresp.Body.Close()\n\n// Second Request\n\nform := url.Values{}\nform.Add(\"lt\", respJSON[\"lt\"])\nform.Add(\"execution\", respJSON[\"execution\"])\nform.Add(\"_eventId\", \"submit\")\nform.Add(\"username\", details.Username)\nform.Add(\"password\", details.Password)\nreq, err = http.NewRequest(\"POST\", loginURL, strings.NewReader(form.Encode()))\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to send second request authing with PTC: %v\", err)\n}\nreq.Header.Set(\"User-Agent\", \"niantic\")\nreq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\nresp, err = newClient.Do(req)\nif err != nil {\n    return \"\", fmt.Errorf(\"Failed to send second request authing with PTC: %v\", err)\n}\nlog.Println(resp.Location())\nticket := resp.Header.Get(\"Location\")\n\nif strings.Contains(ticket, \"ticket\") {\n    ticket = strings.Split(ticket, \"ticket=\")[1]\n} else {\n    return \"\", fmt.Errorf(\"Failed could not get the Ticket from the second request\\n\")\n}\nresp.Body.Close()\n</code></pre>\n\n<p>But when I <code>log.Println(resp.Location())</code> I get <code>&lt;nil&gt;</code></p>\n\n<p>I'm really not sure what the differences are here (I've tried with and without the <code>Content-Type</code> header but for some reason I just can NOT get the Location header that I'm looking for.</p>\n\n<p>I really can't see a discrepancy between the Node request, vs the Go request but any help would be great as I have been beating my head off the wall for the last day. Thanks.</p>\n"}, {"tags": ["model-view-controller", "go", "beego"], "answers": [{"comments": [{"owner": {"reputation": 991, "user_id": 2155614, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-yPPj1XVo0uI/AAAAAAAAAAI/AAAAAAAAACQ/NW3rM807aQs/photo.jpg?sz=128", "display_name": "andor kesselman", "link": "https://stackoverflow.com/users/2155614/andor-kesselman"}, "edited": false, "score": 0, "creation_date": 1469680819, "post_id": 38610258, "comment_id": 64638989, "body": "That was it. Very helpful and a stupid miss on my end. I ended up looking in all the wrong places!"}], "tags": [], "owner": {"reputation": 547, "user_id": 5810474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108078f0353c37a619786a600fbbaec1?s=128&d=identicon&r=PG&f=1", "display_name": "Toni Villena", "link": "https://stackoverflow.com/users/5810474/toni-villena"}, "is_accepted": true, "score": 2, "last_activity_date": 1469614970, "creation_date": 1469614970, "answer_id": 38610258, "question_id": 38601959, "link": "https://stackoverflow.com/questions/38601959/router-not-finding-controller-beego/38610258#38610258", "title": "Router Not Finding Controller Beego", "body": "<p>You are not importing <code>routers</code> package. If you don't import <code>routers</code> in anywhere, the <code>init</code> function will never be executed. You can test it adding a simple <code>fmt.Println('I'm initialized')</code> in <code>routers.init</code> function.</p>\n\n<pre><code>func init() {\n     fmt.Println('I'm initialized')\n     beego.Router(\"/\", &amp;controllers.MainController{})\n}\n</code></pre>\n\n<p>Ok, you must add a new import with <code>_</code> to say that you won't use, but, the <code>init</code> function will be executed! Then you must write this in main package:</p>\n\n<pre><code>import (\n        \"fmt\"\n        \"github.com/astaxie/beego\"\n\n        _ \"example/routers\"\n)\n</code></pre>\n\n<p>I hope that it is useful! :-)</p>\n"}], "owner": {"reputation": 991, "user_id": 2155614, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-yPPj1XVo0uI/AAAAAAAAAAI/AAAAAAAAACQ/NW3rM807aQs/photo.jpg?sz=128", "display_name": "andor kesselman", "link": "https://stackoverflow.com/users/2155614/andor-kesselman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1358, "favorite_count": 0, "accepted_answer_id": 38610258, "answer_count": 1, "score": 0, "last_activity_date": 1469614970, "creation_date": 1469579668, "question_id": 38601959, "link": "https://stackoverflow.com/questions/38601959/router-not-finding-controller-beego", "title": "Router Not Finding Controller Beego", "body": "<p>I had a beego application that was working, and then my router stopped finding the controller, and I have no idea why. No matter what url I type, the router does not direct to the controller complaining nomatch </p>\n\n<blockquote>\n  <p>2016/07/26 17:24:50 [router.go:829][D] | GET        | /                                        | 478.352\u00b5s        | notmatch   | </p>\n</blockquote>\n\n<p><strong>app.conf</strong></p>\n\n<pre><code>appname = exampleapp \nhttpport = 8080 \nrunmode = dev\n</code></pre>\n\n<p><strong>router.go</strong></p>\n\n<pre><code>package routers\n\nimport (\n    \"github.com/astaxie/beego\"\n    \"example/controllers\"\n</code></pre>\n\n<p>)</p>\n\n<pre><code>func init() {\n     beego.Router(\"/\", &amp;controllers.MainController{})\n}\n</code></pre>\n\n<p><strong>default.go (controller)</strong></p>\n\n<pre><code>package controllers\n\nimport (\n        \"github.com/astaxie/beego\"\n)\n\ntype MainController struct {\n        beego.Controller\n}\n\n func (c *MainController) Get() {\n        c.Data[\"Website\"] = \"http://localhost:8080\"\n        c.TplName = \"index.tpl\"\n }\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"github.com/astaxie/beego\"\n)\n\nfunc main() {\n        fmt.Pritnln(\"Starting Beego App\")\n        beego.Run()\n        fmt.Println(\"Finished Running Beego App\")\n}\n</code></pre>\n\n<p>I believe this is following the specifications of  <a href=\"http://beego.me/docs/mvc/controller/router.md\" rel=\"nofollow\">http://beego.me/docs/mvc/controller/router.md</a> so I would like to understand why it does not find the controller.       </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "edited": false, "score": 0, "creation_date": 1469575516, "post_id": 38601407, "comment_id": 64590555, "body": "Just to be clear, I know I can add this:       func (b *Block2) IsMe(other Base) bool {         return b == other     }  and I will then get the right result... however, I don&#39;t want to write the same boiler-plate code for every sub-struct."}, {"owner": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 0, "creation_date": 1469575871, "post_id": 38601407, "comment_id": 64590680, "body": "<a href=\"http://stackoverflow.com/questions/35546054/golang-equivalent-of-is-operator-in-python\" title=\"golang equivalent of is operator in python\">stackoverflow.com/questions/35546054/&hellip;</a>"}, {"owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "reply_to_user": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 1, "creation_date": 1469576691, "post_id": 38601407, "comment_id": 64590886, "body": "Thanks @IanAuld, but that link doesn&#39;t seem relevant to this particular problem. Note that there is an interface involved."}, {"owner": {"reputation": 6632, "user_id": 210547, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/70ebc83b42f07ad8e3363085e722500e?s=128&d=identicon&r=PG", "display_name": "MDrollette", "link": "https://stackoverflow.com/users/210547/mdrollette"}, "edited": false, "score": 3, "creation_date": 1469578316, "post_id": 38601407, "comment_id": 64591259, "body": "On a side note, it sounds like you&#39;re using, and thinking about, struct embedding as inheritence. You may be better off stepping back and thinking how you might solve the problem in a more Go idiomatic way. For example, the fact that your <code>IsMe</code> method takes an interface value, but you&#39;re not actually using any functionality defined by that interface, is a code smell."}, {"owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "edited": false, "score": 0, "creation_date": 1469578657, "post_id": 38601407, "comment_id": 64591324, "body": "I am indeed trying to do something akin to inheritance, as it can be quite useful in reducing boilerplate code. The example above was distilled down to its smallest case that would illustrate the problem, which is why it isn&#39;t actually doing anything useful, nor &quot;using any functionality defined by that interface&quot;. The actual code does in fact use it quite extensively."}], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "edited": false, "score": 0, "creation_date": 1469579254, "post_id": 38601731, "comment_id": 64591451, "body": "Thanks. This did the trick. I&#39;ve eliminated the use of the unsafe package by changing the IsMe() content to this: return reflect.ValueOf(Base(b)).Pointer() == reflect.ValueOf(other).Pointer()"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1469579312, "last_edit_date": 1469579312, "creation_date": 1469577811, "answer_id": 38601731, "question_id": 38601407, "link": "https://stackoverflow.com/questions/38601407/identity-comparison-in-golang/38601731#38601731", "title": "Identity comparison in golang?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Base interface {\n    IsMe(other Base) bool\n}\n\ntype Block struct {\n    _ [1]byte // size of struct must be greater than zero\n}\n\nfunc (b *Block) IsMe(other Base) bool {\n    x := reflect.ValueOf(b)\n    y := reflect.ValueOf(other)\n    return x.Pointer() == y.Pointer()\n}\n\ntype Block2 struct {\n    Block // \"parent\" needs to be first element\n}\n\nfunc main() {\n    b1 := &amp;Block{}\n    b2 := &amp;Block2{}\n    fmt.Printf(\"b1.IsMe(b1): %v\\n\", b1.IsMe(b1))\n    fmt.Printf(\"b1.IsMe(b2): %v\\n\", b1.IsMe(b2))\n    fmt.Printf(\"b2.IsMe(b1): %v\\n\", b2.IsMe(b1))\n    fmt.Printf(\"b2.IsMe(b2): %v\\n\", b2.IsMe(b2))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Dx0Ze3euFY\" rel=\"nofollow\">https://play.golang.org/p/Dx0Ze3euFY</a></p>\n"}, {"comments": [{"owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "edited": false, "score": 0, "creation_date": 1469590894, "post_id": 38602128, "comment_id": 64593952, "body": "That was what I wanted to do, but since it is the object itself that needs to compare itself against an interface stored elsewhere, I couldn&#39;t find a clean way to make it work without replicating code into every variation."}, {"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "reply_to_user": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "edited": false, "score": 0, "creation_date": 1469639460, "post_id": 38602128, "comment_id": 64624247, "body": "Your example is probably to abstract to highlight the underlying issue but the fact that you were unable to find a clean solution may indicate that your initial approach has flaws. The way you are doing it now (using <code>reflect</code>) is a workaround, not a solution."}], "tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": false, "score": 2, "last_activity_date": 1469583959, "last_edit_date": 1469583959, "creation_date": 1469581307, "answer_id": 38602128, "question_id": 38601407, "link": "https://stackoverflow.com/questions/38601407/identity-comparison-in-golang/38602128#38602128", "title": "Identity comparison in golang?", "body": "<p>If you really want to do it the fake inheritance way then you can certainly do it the way you did it but it really only works with <code>unsafe</code> or <code>reflect</code> because the language is not designed for what you want to do.</p>\n\n<p>Your problem starts with where <code>x.IsMe</code> comes from when using embedding. When you write</p>\n\n<pre><code>type Block struct {}\nfunc (b *Block) IsMe(other Base) bool { return b == other }\ntype Block2 struct { Block }\n</code></pre>\n\n<p>the method <code>IsMe</code> is actually associated and bound to <code>Block</code> instead of <code>Block2</code>. So calling <code>IsMe</code> on an instance of <code>Block2</code> is really only calling it on <code>Block</code>, in detail:</p>\n\n<pre><code>b2 := Block2{}\nfmt.Println(b2.IsMe)       // 0x21560\nfmt.Println(b2.Block.IsMe) // 0x21560\n</code></pre>\n\n<p>Both methods have the same address. This shows that even though <code>b2</code> has the method <code>IsMe</code>, that method is only propagated from <code>Block</code> to the outside of <code>Block2</code> and <strong>not inherited</strong>. This in turn means that you are always running effectively this code:</p>\n\n<pre><code>b1 := Block{}\nb2 := Block2{}\nb2_embedded_block := b2.Block\nb2_embedded_block.IsMe(b2)\nb2_embedded_block.IsMe(b1)\n// ...\n</code></pre>\n\n<p>which obviously cannot work since you are comparing two completely different instances.</p>\n\n<p>What you really should do is to use some function outside of your embedding chain to decide equality. Example (<a href=\"https://play.golang.org/p/YsPjuQ5VBg\" rel=\"nofollow\">On Play</a>):</p>\n\n<pre><code>func IsEq(a,b Base) bool {\n    return a == b\n}\n</code></pre>\n\n<p>This actually compares the right instances.</p>\n"}], "owner": {"reputation": 310, "user_id": 1394764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8579963d48c56fe440067b98a1a4b303?s=128&d=identicon&r=PG", "display_name": "Richard Wilkes", "link": "https://stackoverflow.com/users/1394764/richard-wilkes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 769, "favorite_count": 0, "accepted_answer_id": 38601731, "answer_count": 2, "score": 3, "last_activity_date": 1469583959, "creation_date": 1469575394, "question_id": 38601407, "link": "https://stackoverflow.com/questions/38601407/identity-comparison-in-golang", "title": "Identity comparison in golang?", "body": "<p>I've been trying to build a set of structs that have a base struct as their foundation and variants built on top of that. I've found, however, that there doesn't seem to be a way for the struct to identify itself when the common code is in the base struct. How should I be doing this?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Base interface {\n    IsMe(other Base) bool\n}\n\ntype Block struct {\n}\n\nfunc (b *Block) IsMe(other Base) bool {\n    return b == other\n}\n\ntype Block2 struct {\n    Block\n}\n\nfunc main() {\n    b1 := &amp;Block{}\n    b2 := &amp;Block2{}\n    fmt.Printf(\"b1.IsMe(b1): %v\\n\", b1.IsMe(b1))\n    fmt.Printf(\"b1.IsMe(b2): %v\\n\", b1.IsMe(b2))\n    fmt.Printf(\"b2.IsMe(b1): %v\\n\", b2.IsMe(b1)) // Wrong result!\n    fmt.Printf(\"b2.IsMe(b2): %v\\n\", b2.IsMe(b2)) // Wrong result!\n}\n</code></pre>\n"}, {"tags": ["arrays", "xml", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1469653344, "last_edit_date": 1469653344, "creation_date": 1469569575, "answer_id": 38600413, "question_id": 38600388, "link": "https://stackoverflow.com/questions/38600388/parse-an-xml-array-of-simple-values-in-go/38600413#38600413", "title": "Parse an xml array of simple values in go", "body": "<p>You need to specify the path the <code>int</code> elements:</p>\n\n<pre><code>type MyElement struct {\n    Ids []int `xml:\"Ids&gt;int\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HfyQzOiSqa\" rel=\"nofollow\">https://play.golang.org/p/HfyQzOiSqa</a></p>\n\n<p>You can also do this in order not to repeat \"Ids\"</p>\n\n<pre><code>type MyElement struct {\n    Ids []int `xml:\"&gt;int\"`\n}\n</code></pre>\n\n<p>This functionality is mentioned in <a href=\"https://godoc.org/encoding/xml#Unmarshal\" rel=\"nofollow\"><code>xml.Unmarshal</code>'s documentation</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>If the XML element contains a sub-element whose name matches\n  the prefix of a tag formatted as \"a\" or \"a>b>c\", unmarshal\n  will descend into the XML structure looking for elements with the\n  given names, and will map the innermost elements to that struct\n  field. A tag starting with \">\" is equivalent to one starting\n  with the field name followed by \">\".</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 7419, "user_id": 109525, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/1TSBj.jpg?s=128&g=1", "display_name": "0x26res", "link": "https://stackoverflow.com/users/109525/0x26res"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 38600413, "answer_count": 1, "score": 1, "last_activity_date": 1469653344, "creation_date": 1469569423, "question_id": 38600388, "link": "https://stackoverflow.com/questions/38600388/parse-an-xml-array-of-simple-values-in-go", "title": "Parse an xml array of simple values in go", "body": "<p>I have an xml that looks like this:</p>\n\n<pre><code>&lt;MyElement&gt;\n    &lt;Ids&gt;\n        &lt;int&gt;1&lt;/int&gt;\n        &lt;int&gt;2&lt;/int&gt;\n    &lt;/Ids&gt;\n&lt;/MyElement&gt;\n</code></pre>\n\n<p>I find it challenging to parse in go. I've tried the following</p>\n\n<pre><code>type MyElement struct {\n  Ids int[] \n}\n</code></pre>\n\n<p>or even </p>\n\n<pre><code>type Ids struct {\n  id int[] `xml:\"int\"`\n}\n\ntype MyElement struct {\n  Ids Ids\n}\n</code></pre>\n\n<p>But it never get picked up.</p>\n\n<p>The difficulty is in the fact that the elements are all called int and only store an int value, instead of the usual key/value pair.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1469565268, "post_id": 38599166, "comment_id": 64586721, "body": "Pipe in your content or send EOF (^D)."}, {"owner": {"reputation": 22826, "user_id": 1196150, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1f769ac40b6f5434f8eb211a358c4839?s=128&d=identicon&r=PG", "display_name": "Hommer Smith", "link": "https://stackoverflow.com/users/1196150/hommer-smith"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1469565641, "post_id": 38599166, "comment_id": 64586889, "body": "Volker what do you mean by Pipe in your content?"}], "answers": [{"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1469565445, "creation_date": 1469565445, "answer_id": 38599436, "question_id": 38599166, "link": "https://stackoverflow.com/questions/38599166/how-can-i-print-the-counts-of-the-lines-that-are-introduced-via-stdin/38599436#38599436", "title": "How can I print the counts of the lines that are introduced via stdin?", "body": "<p>Try this - save the following text in /tmp/input.txt or other local file:</p>\n\n<pre><code>Line A\nLine B\nLine B\nLine A\nLine C\nLine B\n</code></pre>\n\n<p>Now pipe the contents of that file as standard input to your program - for example in /tmp/q.go: \n<code>cat /tmp/input.txt | go run /tmp/q.go</code>\nThe output should be:</p>\n\n<pre><code>$ cat /tmp/input.txt | go run /tmp/q.go\n2   Line A\n3   Line B\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1469592911, "creation_date": 1469592911, "answer_id": 38603612, "question_id": 38599166, "link": "https://stackoverflow.com/questions/38599166/how-can-i-print-the-counts-of-the-lines-that-are-introduced-via-stdin/38603612#38603612", "title": "How can I print the counts of the lines that are introduced via stdin?", "body": "<p>your code first gets all lines, then prints the result at the end (<code>EOF</code>).<br>\n1 - if you need feedback for each line when you press Enter: edit your first loop:  </p>\n\n<pre><code>for input.Scan() {\n    txt := input.Text()\n    counts[txt]++\n    fmt.Println(\"counts[\", txt, \"] =\", counts[txt])\n}\n</code></pre>\n\n<p>like this working sample code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    counts := make(map[string]int)\n    input := bufio.NewScanner(os.Stdin)\n    for input.Scan() {\n        txt := input.Text()\n        counts[txt]++\n        fmt.Println(\"counts[\", txt, \"] =\", counts[txt])\n    }\n    // NOTE: ignoring potential errors from input.Err()\n    for line, n := range counts {\n        if n &gt; 1 {\n            fmt.Printf(\"%d\\t%s\\n\", n, line)\n        }\n    }\n}\n</code></pre>\n\n<p>2- if you want the result at the end of data entry, you have two options:<br>\nOption A: press <code>EOF</code> at the end of lines in terminal (command prompt): Ctrl+Z then Enter in Windows, or Ctrl+D in Linux.</p>\n\n<p>Option B: save all text data in one file like \"lines.txt\" and then run your go binary file with this file as input (<a href=\"http://www.tldp.org/LDP/abs/html/io-redirection.html\" rel=\"nofollow\">Redirecting input</a>) like this: </p>\n\n<p>Windows:  </p>\n\n<pre><code>main.exe &lt; lines.txt\n</code></pre>\n\n<p>Linux:    </p>\n\n<pre><code>./main &lt; lines.txt\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 711, "user_id": 6178021, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/vhabx.jpg?s=128&g=1", "display_name": "Tanmay Garg", "link": "https://stackoverflow.com/users/6178021/tanmay-garg"}, "is_accepted": false, "score": 0, "last_activity_date": 1469593115, "creation_date": 1469593115, "answer_id": 38603632, "question_id": 38599166, "link": "https://stackoverflow.com/questions/38599166/how-can-i-print-the-counts-of-the-lines-that-are-introduced-via-stdin/38603632#38603632", "title": "How can I print the counts of the lines that are introduced via stdin?", "body": "<p>The place where you are going wrong is:</p>\n\n<p>You are not giving any condition for the first <em>for</em> loop to terminate. This leaves you with the two options suggested by Volker. Either way, you are essentially providing the program with an <em>EOF</em>, for it to know when to stop scanning for input.</p>\n\n<p>Now, the chances are this might not look very clean to you. In that case (and only in that case), you can proceed by introducing a termination condition inside the <em>input for</em> loop:</p>\n\n<pre><code>if input.Text() == \"\" {\n    break;\n}\n</code></pre>\n\n<p>This leads to the execution to reach the second <em>for</em> loop as soon as you enter two new-line characters. Quite handy if you would like to prompt the user on the beginning of the program to <em>Hit enter twice to show results</em>, or something of that sorts.</p>\n\n<p>Cheers!</p>\n"}], "owner": {"reputation": 22826, "user_id": 1196150, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/1f769ac40b6f5434f8eb211a358c4839?s=128&d=identicon&r=PG", "display_name": "Hommer Smith", "link": "https://stackoverflow.com/users/1196150/hommer-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1469593115, "creation_date": 1469564336, "question_id": 38599166, "link": "https://stackoverflow.com/questions/38599166/how-can-i-print-the-counts-of-the-lines-that-are-introduced-via-stdin", "title": "How can I print the counts of the lines that are introduced via stdin?", "body": "<p>I have the following program that I want to show how many times a specific introduced line appears from stdin:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    counts := make(map[string]int)\n    input := bufio.NewScanner(os.Stdin)\n    for input.Scan() {\n        counts[input.Text()]++\n    }\n    // NOTE: ignoring potential errors from input.Err()\n    for line, n := range counts {\n        if n &gt; 1 {\n            fmt.Printf(\"%d\\t%s\\n\", n, line)\n        }\n    }\n}\n</code></pre>\n\n<p>When I run the program it allows me to enter strings, but even when I press enter I don't get any feedback.</p>\n\n<p>What am I missing here? I believe it gets stuked in the first <code>for</code>.</p>\n"}, {"tags": ["shell", "go", "mingw"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1469599389, "post_id": 38599096, "comment_id": 64596667, "body": "but &#39;/home&#39; on widows is not a regular path. it should be absolute <code>c:\\blabla\\blabla</code> or relative <code>blabla</code> and <code>.\\blabla</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1469611160, "creation_date": 1469611160, "answer_id": 38608785, "question_id": 38599096, "link": "https://stackoverflow.com/questions/38599096/how-is-this-argument-getting-expanded/38608785#38608785", "title": "How is this argument getting expanded?", "body": "<p>This must be <code>MinGW</code> or the shell that you are running that expands the parameter - to confirm it is not Go specific, try a simple shell script that prints <code>$0</code> and <code>$1</code> and run it with the <code>/home</code> parameter.</p>\n"}], "owner": {"reputation": 15751, "user_id": 1345655, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2f01aca0b4d2d9347a6fd0f16f24d084?s=128&d=identicon&r=PG", "display_name": "Kshitiz Sharma", "link": "https://stackoverflow.com/users/1345655/kshitiz-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469611160, "creation_date": 1469564070, "question_id": 38599096, "link": "https://stackoverflow.com/questions/38599096/how-is-this-argument-getting-expanded", "title": "How is this argument getting expanded?", "body": "<p>Consider the following program which I'm running via <code>MinGW</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Println(os.Args[1])\n}\n</code></pre>\n\n<p>When I run the command <code>go run test.go /home</code> it prints <code>C:/Program Files/Git/home</code>.</p>\n\n<p>I suspected that the shell might be expanding the relative path. But running <code>echo /home</code> prints only <code>/home</code>.</p>\n\n<p>What is changing the argument for my golang program?</p>\n"}, {"tags": ["go", "reflection", "struct"], "answers": [{"comments": [{"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469563454, "post_id": 38598831, "comment_id": 64585810, "body": "I dont think this is what I am looking for. or maybe it is but well. I want to get the struct the function is referring to, fill the fields of that struct and call the function that is being passed. This is to create a new controller and set the fields no? I mean this is also a part of what I am looking"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469563555, "post_id": 38598831, "comment_id": 64585868, "body": "@AlvaroCarvajalNakosmai: You said your method is not expecting a pointer, but you can&#39;t change the value of a struct if you don&#39;t have a pointer to it."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469563741, "post_id": 38598831, "comment_id": 64585977, "body": "True I am a little bit off today. I dont want to edit the value of a struct but create it on runtime so when the function passes controllers.Test.IsWorking create a Test struct and call the Test.IsWorking function with the newly created struct wich I can set the fields I guess"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469564712, "post_id": 38598831, "comment_id": 64586460, "body": "Pleas show what your end goal is here. I don&#39;t understand what you&#39;re asking. Are you sure you need <code>reflect</code> for what you&#39;re trying to accomplish?"}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469565168, "post_id": 38598831, "comment_id": 64586678, "body": "I now updated main post. I am sure I need reflect since I dont know what struct I am passing"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469565814, "post_id": 38598831, "comment_id": 64586980, "body": "It&#39;s still not clear what you&#39;re trying to do. I added how to call a method by name on a new <code>*Test</code> value."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469566182, "post_id": 38598831, "comment_id": 64587164, "body": "That is what I am looking for BUT without knowing about Test{} is that possible?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469566327, "post_id": 38598831, "comment_id": 64587242, "body": "You don&#39;t need to know what <code>Test{}</code> is, the argument for <code>TypeOf</code> is <code>interface{}</code>, so just pass in the <code>interface{}</code> value."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469566642, "post_id": 38598831, "comment_id": 64587410, "body": "Oh. Also what if I dont know about IsWorking? The above example wont work I am not passing Test{} as the interface but Test.IsWorking maybe I should change what I am passing to make it easier?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469566942, "post_id": 38598831, "comment_id": 64587572, "body": "It&#39;s definitely easier if you know <i>something</i> about the method you want to call."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469568228, "post_id": 38598831, "comment_id": 64588136, "body": "I dont think I am able to know more about it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469568340, "post_id": 38598831, "comment_id": 64588184, "body": "You must know something if you want to call a method, the name, the signature, etc. BTW, if you know the signature, it&#39;s much easier to call a method via an interface type assertion than with reflection."}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1469568532, "post_id": 38598831, "comment_id": 64588263, "body": "Okey I think I can pass the controller and the function name as two arguments for the function that might work. thanks"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1469565774, "last_edit_date": 1469565774, "creation_date": 1469563032, "answer_id": 38598831, "question_id": 38598685, "link": "https://stackoverflow.com/questions/38598685/get-struct-from-function-type/38598831#38598831", "title": "Get struct from function type", "body": "<p>To make a new pointer to a newly allocated struct of the type in the interface, all you need is </p>\n\n<pre><code>newController := reflect.New(reflect.TypeOf(controller)).Interface()\n</code></pre>\n\n<p>Or to set a value on the new instance first:</p>\n\n<pre><code>newController := reflect.New(reflect.TypeOf(controller))\nnewController.Elem().FieldbyName(\"Method\").Set(reflect.ValueOf(\"GET\"))\n</code></pre>\n\n<p>If you want to create a pointer to a struct and call the <code>IsWorking</code> method, it looks like</p>\n\n<pre><code>t := reflect.New(reflect.TypeOf(Test{}))\nt.MethodByName(\"IsWorking\").Call(nil)\n</code></pre>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 38598831, "answer_count": 1, "score": -1, "last_activity_date": 1469565774, "creation_date": 1469562466, "last_edit_date": 1469565143, "question_id": 38598685, "link": "https://stackoverflow.com/questions/38598685/get-struct-from-function-type", "title": "Get struct from function type", "body": "<p>I currently have the following code</p>\n\n<pre><code>func (r *Router) Get(path string, controller interface{}) {\n    ...\n    t := reflect.TypeOf(controller)\n    ...\n}\n</code></pre>\n\n<p>That is called doing the following</p>\n\n<pre><code>Route.Get(\"/\", controllers.Test.IsWorking)\n</code></pre>\n\n<p>The second argument is basically this</p>\n\n<pre><code>type Test struct {\n    *Controller\n    Name string\n}\n\nfunc (t Test) IsWorking() {\n\n}\n\ntype Controller struct {\n    Method   string\n    Request  *http.Request\n    Response http.ResponseWriter\n    Data     map[interface{}]interface{}\n}\n</code></pre>\n\n<p>I want to get the struct the function refers to. create a new struct of that type and call the function so for example</p>\n\n<p>controllers.Test.IsWorking</p>\n\n<p>Create a Test struct and call IsWorking()</p>\n"}, {"tags": ["go", "liteide", "delve"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469561120, "post_id": 38598167, "comment_id": 64584474, "body": "Does the exact same input work directly in delve?"}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1469561677, "post_id": 38598167, "comment_id": 64584819, "body": "I&#39;ve experienced the same behavior.  Everything seems to work directly in delve.  In the cases that I&#39;ve looked into, it seems to have something to do with debugging within a GoRoutine."}, {"owner": {"reputation": 3210, "user_id": 156671, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e236942ba8d664b677cbde3ee69986c?s=128&d=identicon&r=PG", "display_name": "GrandmasterB", "link": "https://stackoverflow.com/users/156671/grandmasterb"}, "edited": false, "score": 0, "creation_date": 1469591414, "post_id": 38598167, "comment_id": 64594073, "body": "I&#39;ve not had good luck with the debugger either, to the point where I barely use it.  I&#39;ve been relying on log.Println()"}, {"owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "edited": false, "score": 0, "creation_date": 1469606371, "post_id": 38598167, "comment_id": 64600920, "body": "I havent used delve directly , but tier1 answer is encouraging me to look into it."}, {"owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "edited": false, "score": 0, "creation_date": 1469648941, "post_id": 38598167, "comment_id": 64629565, "body": "Apparently , it doesn&#39;t seem to work even directly in delve making me think if  its worth investing time into this."}], "owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 457, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1469561150, "creation_date": 1469560632, "last_edit_date": 1469561150, "question_id": 38598167, "link": "https://stackoverflow.com/questions/38598167/delve-does-not-work-always-with-liteide", "title": "Delve does not work always with LiteIDE", "body": "<p>I am new to go language and for development purpose using LITEIDE with delve as debugger to debug my go code .</p>\n\n<p>I have observed that sometimes I can debug well in LITEIDE with breakpoints being hit and I can use it properly . But sometimes it just doesnt work at all .</p>\n\n<p>When it DOES NOT WORK i see messages like these in console  </p>\n\n<pre><code>(dlv) Process restarted with PID 29878\n(dlv) (dlv) (dlv) Breakpoint bk145085445 set at 0x206d for main.main() ./httpServer.go:15\n(dlv) Breakpoint bk83028073 set at 0xd3546 for usagereports/requestHandlers.KeyHandler() ./requestHandlers/customerKeyHandler.go:39\n(dlv) Breakpoint bk83028064 set at 0xd2e69 for usagereports/requestHandlers.KeyHandler() ./requestHandlers/customerKeyHandler.go:30\n(dlv) Breakpoint bk83028049 set at 0xd2bc8 for usagereports/requestHandlers.KeyHandler() ./requestHandlers/customerKeyHandler.go:21\n(dlv) Breakpoint 5 set at 0x2058 for main.main() ./httpServer.go:12\n(dlv)\n</code></pre>\n\n<p>Now If I type next (to go to next line) or continue (for it to stop at next breakpoint) nothing happens . But the program has not hanged and I can see it getting executed (through log messages or see desired output/errors on screen) which means that LITEIDE is not working properly.</p>\n\n<p>Can anyone guide here who uses LITEIDE with Delve and faced this problem </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 834108, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0bedf8b7464b132ea229ff4ebd3fb2ba?s=128&d=identicon&r=PG", "display_name": "meownoid", "link": "https://stackoverflow.com/users/834108/meownoid"}, "edited": false, "score": 0, "creation_date": 1469560380, "post_id": 38598023, "comment_id": 64584077, "body": "Thanks! Output parameters is evil :("}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 129, "user_id": 834108, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0bedf8b7464b132ea229ff4ebd3fb2ba?s=128&d=identicon&r=PG", "display_name": "meownoid", "link": "https://stackoverflow.com/users/834108/meownoid"}, "edited": false, "score": 0, "creation_date": 1469560873, "post_id": 38598023, "comment_id": 64584342, "body": "It&#39;s kind of hard to make use of a pre-allocated read buffer, if you don&#39;t pass it as a parameter."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1469583368, "post_id": 38598023, "comment_id": 64592291, "body": "This code isn&#39;t quite right (although it&#39;ll work for a <code>strings.Reader</code>) -- <code>Read</code> may return an error and a non-zero <code>n</code>, and when it does this decoder won&#39;t decode the result. <code>n, err := old_reader.r.Read(b); rot13(b[:n]); return n, err</code> is more accurate."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1469583568, "post_id": 38598023, "comment_id": 64592326, "body": "From <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#Reader</a> : &quot;Callers should always process the n &gt; 0 bytes returned before considering the error err. Doing so correctly handles I/O errors that happen after reading some bytes and also both of the allowed EOF behaviors.&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1469587364, "post_id": 38598023, "comment_id": 64593110, "body": "@PaulHankin:yes, I returned <code>n</code> for that reason, but forgot to rot13 any read bytes. In my rush I also needlessly reassigned <code>b</code>. The fixed answer is much cleaner."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1469587230, "last_edit_date": 1469587230, "creation_date": 1469560060, "answer_id": 38598023, "question_id": 38597775, "link": "https://stackoverflow.com/questions/38597775/what-is-wrong-with-solution-to-the-23th-task-of-go-tour/38598023#38598023", "title": "What is wrong with solution to the 23&#39;th task of go tour?", "body": "<p>The <code>Read</code> method for an <code>io.Reader</code> needs to operate on the byte slice provided to it. You're reading into a new slice, and never modifying the original.</p>\n\n<p>Just use <code>b</code> throughout the Read method:</p>\n\n<pre><code>func (old_reader rot13Reader) Read(b []byte) (int, error) {\n    n, err := old_reader.r.Read(b)\n    rot13(b[:n])\n    return n, err\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469560237, "post_id": 38598026, "comment_id": 64583994, "body": "You should use an early return pattern to remove the <code>else</code> clause and indentation of the main code path. There&#39;s no need to allocate the extra slice, use the provided slice. If you do need to copy, use the <code>copy</code> built-in to copy bytes rather than a for-loop."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469560649, "post_id": 38598026, "comment_id": 64584214, "body": "Yep, like I said in the edit, I intentionally tried to keep the changes to his code to the minimum necessary to make it functional, so the differences are more easily seen.  It&#39;s very much not ideally idiomatic Go."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1469583756, "post_id": 38598026, "comment_id": 64592366, "body": "This code has a similar problem to JimB&#39;s: <code>Read</code> may return n&gt;0 and err != nil (eg: err = io.EOF) and when it does, you truncate the result."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 1, "last_activity_date": 1470070586, "last_edit_date": 1470070586, "creation_date": 1469560070, "answer_id": 38598026, "question_id": 38597775, "link": "https://stackoverflow.com/questions/38597775/what-is-wrong-with-solution-to-the-23th-task-of-go-tour/38598026#38598026", "title": "What is wrong with solution to the 23&#39;th task of go tour?", "body": "<p>You're never modifying <code>b</code> in your reader.  The semantic of <code>io.Reader</code>'s <code>Read</code> function is that you put the data into <code>b</code>'s underlying array directly.</p>\n\n<p>Assuming the <code>rot13()</code> function also in-place modifies, this will work (<strong>edit</strong>: I've tried to keep this code close to your version so you can see what's changed easier.  JimB's solution is a more idiomatic solution to this problem):</p>\n\n<pre><code>func (old_reader rot13Reader) Read(b []byte) (int, error) {\n    tmp_bytes := make([]byte, len(b))\n    old_len, err := old_reader.r.Read(tmp_bytes)\n    tmp_bytes = tmp_bytes[:old_len]\n    rot13(tmp_bytes)\n    for i := range tmp_bytes {\n        b[i] = tmp_bytes[i]\n    }\n    return old_len, err\n}\n</code></pre>\n\n<p>Example (with stubbed <code>rot13()</code>): <a href=\"https://play.golang.org/p/vlbra-46zk\" rel=\"nofollow\">https://play.golang.org/p/vlbra-46zk</a></p>\n\n<p>On a side note, from an idiomatic perspect, <code>old_reader</code> isn't a proper receiver name (nor is <code>old_len</code> a proper variable name).  Go prefers short receiver names (like <code>r</code> or <code>rdr</code> in this case), and also prefer camelcase to underscores (underscores will actually fire a <code>golint</code> warning).</p>\n\n<p><strong>Edit2</strong>: A more idiomatic version of your code.  Kept the same mechanism of action, just cleaned it up a bit.</p>\n\n<pre><code>func (rdr rot13Reader) Read(b []byte) (int, error) {\n    tmp := make([]byte, len(b))\n    n, err := rdr.r.Read(tmp)\n    tmp = tmp[:n]\n    rot13(tmp)\n    for i := range tmp {\n        b[i] = tmp[i]\n    }\n    return n, err\n}\n</code></pre>\n\n<p>From this, removing the <code>tmp</code> byte slice and using the destination <code>b</code> directly results in JimB's idiomatic solution to the problem.</p>\n\n<p><strong>Edit3</strong>: Updated to fix the issue Paul pointed out in comments.</p>\n"}], "owner": {"reputation": 129, "user_id": 834108, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0bedf8b7464b132ea229ff4ebd3fb2ba?s=128&d=identicon&r=PG", "display_name": "meownoid", "link": "https://stackoverflow.com/users/834108/meownoid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 38598023, "answer_count": 2, "score": 0, "last_activity_date": 1470070586, "creation_date": 1469559208, "last_edit_date": 1469559872, "question_id": 38597775, "link": "https://stackoverflow.com/questions/38597775/what-is-wrong-with-solution-to-the-23th-task-of-go-tour", "title": "What is wrong with solution to the 23&#39;th task of go tour?", "body": "<p>There is a go tour. I've solved <a href=\"https://tour.golang.org/methods/23\" rel=\"nofollow\">https://tour.golang.org/methods/23</a> like this:</p>\n\n<pre><code>func (old_reader rot13Reader) Read(b []byte) (int, error) {\n    const LEN int = 1024\n    tmp_bytes := make([]byte, LEN)\n    old_len, err := old_reader.r.Read(tmp_bytes)\n    if err == nil {\n        tmp_bytes = tmp_bytes[:old_len]\n        rot13(tmp_bytes)\n        return len(tmp_bytes), nil\n    } else {\n        return 0, err\n    }\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n\n<p>Where <code>rot13</code> is correct and debug output right before return shows correct string. But why there is no output to console?</p>\n"}, {"tags": ["go", "package-managers"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469556830, "post_id": 38597046, "comment_id": 64582062, "body": "I don&#39;t use <code>glide</code> right now, but are you sure you have the latest version? Just a quick glance at the docs shows <code>&quot;Because of this Glide flattens the dependency tree into a single top level vendor&#47; directory.&quot;</code>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1469559332, "post_id": 38597046, "comment_id": 64583458, "body": "As JimB stated, most current vendoring tools that I&#39;ve used automatically flatten the dependency tree.  This is practically required, because the same package imported from two different unique paths are actually considered two different unique packages, as you found.  I know <code>govendor</code> does it by default."}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1469561755, "post_id": 38597046, "comment_id": 64584858, "body": "@Kaedys +1 for govendor.  I&#39;ve used it in quite a few projects."}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469581555, "post_id": 38597046, "comment_id": 64591917, "body": "Flattening the vendor directory is indeed a core glide feature; can you also include the exact glide invocation you&#39;re using and what your config file looks like?"}, {"owner": {"reputation": 2416, "user_id": 1271135, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e2449e6d1cb6b776d6a1b8f3025796cd?s=128&d=identicon&r=PG", "display_name": "Mikhail Orlov", "link": "https://stackoverflow.com/users/1271135/mikhail-orlov"}, "reply_to_user": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1469609183, "post_id": 38597046, "comment_id": 64602765, "body": "@SamWhited It is <code>https:&#47;&#47;github.com&#47;orloffm&#47;flat</code>. It uses <code>cat</code> and indirectly <code>toy</code>. But <code>cat</code> has some old version of <code>toy</code> vendored. I do <code>glide create</code> and <code>glide install</code> and get vendor/cat/vendor/toy."}], "answers": [{"comments": [{"owner": {"reputation": 2416, "user_id": 1271135, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e2449e6d1cb6b776d6a1b8f3025796cd?s=128&d=identicon&r=PG", "display_name": "Mikhail Orlov", "link": "https://stackoverflow.com/users/1271135/mikhail-orlov"}, "edited": false, "score": 0, "creation_date": 1469614276, "post_id": 38609165, "comment_id": 64606340, "body": "That sorts things out, thank you very much. I was a bit confused comparing it to all other tools."}], "tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 2, "last_activity_date": 1469613757, "last_edit_date": 1469613757, "creation_date": 1469612189, "answer_id": 38609165, "question_id": 38597046, "link": "https://stackoverflow.com/questions/38597046/how-to-handle-nested-vendor-directories-in-go-packages/38609165#38609165", "title": "How to handle nested &quot;vendor&quot; directories in Go packages?", "body": "<p>I was able to install and run your <code>flat</code> program by making the following  changes (also sent you a PR <a href=\"https://github.com/orloffm/flat/pull/1\" rel=\"nofollow\">https://github.com/orloffm/flat/pull/1</a>): </p>\n\n<p>1) flat.go needs to import \"github.com/orloffm/toy\" because of <code>new(toy.RubberToy)</code> - otherwise it doesn't compile </p>\n\n<p>2) add <code>glide.yaml</code> file that list both \"cat\" and \"toy\" libraries as dependencies:</p>\n\n<pre><code>package: github.com/orloffm/flat\nimport:\n- package: github.com/orloffm/cat\n- package: github.com/orloffm/toy\n</code></pre>\n\n<p>3) run <code>glide install --strip-vcs --strip-vendor</code> (or the equivalent shortcut <code>glide install -s -v</code>) to install packages and remove nested <code>vendor/</code> directories  (I'm using glide version 0.11.0-dev installed with <code>go get -u github.com/Masterminds/glide</code>; <code>glide install --help</code> shows the <code>--strip-vendor</code> option).</p>\n\n<p>4) GOBIN=$PWD go install &amp;&amp; ./flat produces</p>\n\n<pre><code>Cat pushes the toy.\nThe toy makes a very loud noise.\n</code></pre>\n\n<p>I think the best would be <strong>not</strong> to include the <code>vendor</code> directory into your <strong>libraries</strong> - this messes things up and makes life more difficult for the library users (for example, need to remember to use additional options to <code>glide</code>). Let the \"clients\" of those libraries - <code>package main</code> packages - either to vendor all the dependencies (including transitive ones) or specify them in a configuration such as <code>glide.yaml</code> and let the tool (glide) to fetch and install them properly.</p>\n"}], "owner": {"reputation": 2416, "user_id": 1271135, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e2449e6d1cb6b776d6a1b8f3025796cd?s=128&d=identicon&r=PG", "display_name": "Mikhail Orlov", "link": "https://stackoverflow.com/users/1271135/mikhail-orlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2121, "favorite_count": 1, "accepted_answer_id": 38609165, "answer_count": 1, "score": 7, "last_activity_date": 1469613757, "creation_date": 1469556629, "last_edit_date": 1469609421, "question_id": 38597046, "link": "https://stackoverflow.com/questions/38597046/how-to-handle-nested-vendor-directories-in-go-packages", "title": "How to handle nested &quot;vendor&quot; directories in Go packages?", "body": "<p>I'm writing an application and import some package <code>B</code>. This package has the <code>vendor</code> directory inside which, in turn, contains package <code>C</code>. I also want to use that package <code>C</code> in my app directly.</p>\n\n<p>So I decided to use <code>glide</code> package manager. It downloads both <code>B</code> and <code>C</code> into <code>myapp/vendor</code> directory, but keeps <code>myapp/vendor/B/vendor/C</code> inside. So when I build my app, it builds with two different versions of C (also with <code>myapp/vendor/C</code>).</p>\n\n<p>How to avoid that?</p>\n\n<p>1) Either, is there a package manager that handles that? <code>govend</code> seems to with its <code>--prune</code> argument, but it doesn't respect the versions of these <code>C</code> packages.</p>\n\n<p>2) Or, how to make <code>glide</code> properly handle the nested <code>vendor</code> directories?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>My example is <code>https://github.com/orloffm/flat</code>. It uses <code>cat</code> and - indirectly - <code>toy</code> packages. <code>cat</code> has some <em>older version</em> of <code>toy</code> vendored and commited into repository. I do <code>glide create &amp;&amp; glide install</code> and end up with this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 flat.go\n\u251c\u2500\u2500 glide.lock\n\u251c\u2500\u2500 glide.yaml\n\u2514\u2500\u2500 vendor\n    \u2514\u2500\u2500 github.com\n        \u2514\u2500\u2500 orloffm\n            \u251c\u2500\u2500 cat\n            \u2502\u00a0\u00a0 \u251c\u2500\u2500 cat.go\n            \u2502\u00a0\u00a0 \u251c\u2500\u2500 vendor\n            \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 github.com\n            \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 orloffm\n            \u2502\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 toy\n            \u2502\u00a0\u00a0 \u2502\u00a0\u00a0             \u2514\u2500\u2500 toy.go\n            \u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor.yml\n            \u2514\u2500\u2500 toy\n                \u2514\u2500\u2500 toy.go\n</code></pre>\n\n<p>I don't want to have nested <code>vendor</code> directory with <code>toy</code>.</p>\n"}, {"tags": ["go", "time", "timestamp"], "answers": [{"comments": [{"owner": {"reputation": 923, "user_id": 3578245, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/kfvCZ.png?s=128&g=1", "display_name": "witoong623", "link": "https://stackoverflow.com/users/3578245/witoong623"}, "edited": false, "score": 1, "creation_date": 1490751128, "post_id": 38596248, "comment_id": 73248269, "body": "I don&#39;t know why this answer got downed vote. <code>time.RFC3339</code> doesn&#39;t work but this layout work."}, {"owner": {"reputation": 478, "user_id": 822245, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e673cdf99e6d7448f3cbaf1424c999c?s=128&d=identicon&r=PG", "display_name": "Travis Smith", "link": "https://stackoverflow.com/users/822245/travis-smith"}, "edited": false, "score": 3, "creation_date": 1502725716, "post_id": 38596248, "comment_id": 78314229, "body": "<code>time.RFC3339</code> does not work for ISO 8601. Example: <a href=\"https://play.golang.org/p/gIi7D5KuWa\" rel=\"nofollow noreferrer\">play.golang.org/p/gIi7D5KuWa</a>"}, {"owner": {"reputation": 663, "user_id": 2121322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae1626bfa4b564ed9a80960fa543052?s=128&d=identicon&r=PG", "display_name": "David Cuthbert", "link": "https://stackoverflow.com/users/2121322/david-cuthbert"}, "edited": false, "score": 3, "creation_date": 1578443979, "post_id": 38596248, "comment_id": 105438352, "body": "This is not correct; it&#39;s the RFC 3339 subset of ISO 8601. Notably, it fails to parse 20060102T150405Z."}], "tags": [], "owner": {"reputation": 2747, "user_id": 3521420, "user_type": "registered", "profile_image": "https://graph.facebook.com/1054781629/picture?type=large", "display_name": "Jonathan Allen Grant", "link": "https://stackoverflow.com/users/3521420/jonathan-allen-grant"}, "is_accepted": true, "score": 16, "last_activity_date": 1596457843, "last_edit_date": 1596457843, "creation_date": 1469553776, "answer_id": 38596248, "question_id": 38596079, "link": "https://stackoverflow.com/questions/38596079/how-do-i-parse-an-iso-8601-timestamp-in-golang/38596248#38596248", "title": "How do I parse an ISO 8601 Timestamp in GoLang?", "body": "<p>I found this layout to work: <code>&quot;2006-01-02T15:04:05-0700&quot;</code></p>\n"}, {"comments": [{"owner": {"reputation": 4195, "user_id": 2432477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a516bc16804edd78d8f6c2a7e06f07b?s=128&d=identicon&r=PG&f=1", "display_name": "nouney", "link": "https://stackoverflow.com/users/2432477/nouney"}, "reply_to_user": {"reputation": 478, "user_id": 822245, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7e673cdf99e6d7448f3cbaf1424c999c?s=128&d=identicon&r=PG", "display_name": "Travis Smith", "link": "https://stackoverflow.com/users/822245/travis-smith"}, "edited": false, "score": 0, "creation_date": 1502811116, "post_id": 38598151, "comment_id": 78350554, "body": "@TravisSmith Take a look at this <a href=\"https://github.com/golang/go/issues/9346\" rel=\"nofollow noreferrer\">issue</a>"}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1504785512, "post_id": 38598151, "comment_id": 79153184, "body": "That issue is about not understanding what &quot;Z07:00&quot; means in the layout, but here the problem is about the colon."}, {"owner": {"reputation": 663, "user_id": 2121322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae1626bfa4b564ed9a80960fa543052?s=128&d=identicon&r=PG", "display_name": "David Cuthbert", "link": "https://stackoverflow.com/users/2121322/david-cuthbert"}, "edited": false, "score": 0, "creation_date": 1578444031, "post_id": 38598151, "comment_id": 105438364, "body": "RFC 3339 is NOT equivalent to ISO 8601; it is a subset of the allowed formats of ISO 8601. Notably, using time.RFC3339 fails to parse 20060102T150405Z correctly."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 2, "last_activity_date": 1469560554, "last_edit_date": 1495540934, "creation_date": 1469560554, "answer_id": 38598151, "question_id": 38596079, "link": "https://stackoverflow.com/questions/38596079/how-do-i-parse-an-iso-8601-timestamp-in-golang/38598151#38598151", "title": "How do I parse an ISO 8601 Timestamp in GoLang?", "body": "<p>RFC3339 is equivalent to ISO 8601.  Specifically, it has identical format, RFC3339 just has stricter requirements (example, it requires a complete date representation with 4-digit year).</p>\n\n<p><a href=\"https://stackoverflow.com/questions/522251/whats-the-difference-between-iso-8601-and-rfc-3339-date-formats\">What&#39;s the difference between ISO 8601 and RFC 3339 Date Formats?</a></p>\n\n<p>So you can use the constant <code>time.RFC3339</code> as your layout.</p>\n"}, {"comments": [{"owner": {"reputation": 626, "user_id": 2831645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a5c7a1c037b18bee852bf55b7d51463?s=128&d=identicon&r=PG", "display_name": "thibpat", "link": "https://stackoverflow.com/users/2831645/thibpat"}, "edited": false, "score": 0, "creation_date": 1530881889, "post_id": 46095721, "comment_id": 89402643, "body": "There is a problem with your examples. From your quote of the RFC, it&#39;s either &quot;2006-01-02T15:04:05Z&quot; or &quot;2006-01-02T15:04:05+07:00&quot;. You can&#39;t have both &quot;Z&quot; and a timezone offset."}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "reply_to_user": {"reputation": 626, "user_id": 2831645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a5c7a1c037b18bee852bf55b7d51463?s=128&d=identicon&r=PG", "display_name": "thibpat", "link": "https://stackoverflow.com/users/2831645/thibpat"}, "edited": false, "score": 2, "creation_date": 1530894394, "post_id": 46095721, "comment_id": 89409745, "body": "@thibpat In a timestamp you can&#39;t, but in a <i>layout string</i> you can. The &quot;Z&quot; in that case <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">means</a> that a &quot;Z&quot; should be printed <b>instead</b> of an offset when the time zone is UTC."}, {"owner": {"reputation": 626, "user_id": 2831645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a5c7a1c037b18bee852bf55b7d51463?s=128&d=identicon&r=PG", "display_name": "thibpat", "link": "https://stackoverflow.com/users/2831645/thibpat"}, "edited": false, "score": 0, "creation_date": 1531164617, "post_id": 46095721, "comment_id": 89484404, "body": "Thanks for the precision, that makes a lot more sense, sorry for not catching it right away."}], "tags": [], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "is_accepted": false, "score": 5, "last_activity_date": 1504785387, "last_edit_date": 1592644375, "creation_date": 1504785387, "answer_id": 46095721, "question_id": 38596079, "link": "https://stackoverflow.com/questions/38596079/how-do-i-parse-an-iso-8601-timestamp-in-golang/46095721#46095721", "title": "How do I parse an ISO 8601 Timestamp in GoLang?", "body": "<p>The problem here is that <a href=\"https://tools.ietf.org/html/rfc3339#section-5.6\" rel=\"nofollow noreferrer\">RFC3339 requires</a> the zone offset to be given as &quot;+00:00&quot; (or &quot;Z&quot; in case of UTC) while ISO8601 allows it to be &quot;+0000&quot;.</p>\n<p>From <a href=\"https://tools.ietf.org/html/rfc3339#section-5.6\" rel=\"nofollow noreferrer\">RFC3339</a>:</p>\n<blockquote>\n<pre><code>[...]\n\ntime-numoffset  = (&quot;+&quot; / &quot;-&quot;) time-hour &quot;:&quot; time-minute\ntime-offset     = &quot;Z&quot; / time-numoffset\n\n[...]\n\nfull-time       = partial-time time-offset\ndate-time       = full-date &quot;T&quot; full-time\n</code></pre>\n</blockquote>\n<p>So instead of the <code>time.RFC3339</code> layout</p>\n<pre><code>&quot;2006-01-02T15:04:05Z07:00&quot;\n</code></pre>\n<p>you have to use:</p>\n<pre><code>&quot;2006-01-02T15:04:05Z0700&quot;\n</code></pre>\n"}], "owner": {"reputation": 2747, "user_id": 3521420, "user_type": "registered", "profile_image": "https://graph.facebook.com/1054781629/picture?type=large", "display_name": "Jonathan Allen Grant", "link": "https://stackoverflow.com/users/3521420/jonathan-allen-grant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19327, "favorite_count": 1, "accepted_answer_id": 38596248, "answer_count": 3, "score": 14, "last_activity_date": 1596457843, "creation_date": 1469553112, "question_id": 38596079, "link": "https://stackoverflow.com/questions/38596079/how-do-i-parse-an-iso-8601-timestamp-in-golang", "title": "How do I parse an ISO 8601 Timestamp in GoLang?", "body": "<p>I know I need to use a time layout in GoLang (as shown here <a href=\"https://golang.org/src/time/format.go\" rel=\"noreferrer\">https://golang.org/src/time/format.go</a>) but I can't find the layout for an ISO 8601 timestamp. </p>\n\n<p>If it helps, I get the timestamp from the Facebook API. Here is an example timestamp: <code>2016-07-25T02:22:33+0000</code></p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469552670, "post_id": 38595887, "comment_id": 64579733, "body": "By &quot;central repository&quot;, do you mean a single local cache? That&#39;s your GOPATH, and you can use the same GOPATH for multiple projects."}, {"owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469552836, "post_id": 38595887, "comment_id": 64579833, "body": "If I&#39;m working on project1, I point the GOPATH to project1. Later I&#39;m working on project2, should I point GOPATH to project2? If so, GOPATH is not a local cache..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1469553429, "post_id": 38595887, "comment_id": 64580172, "body": "GOPATH isn&#39;t the root of your project. Your project should be located at its import path under <code>$GOPATH&#47;src</code>. See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 1, "creation_date": 1469553502, "post_id": 38595887, "comment_id": 64580213, "body": "<code>ln -s $GOPATH&#47;src&#47;github.com&#47;user130268&#47;my-cool-project ~&#47;dev&#47;my-cool-project</code> is your friend"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 1, "creation_date": 1469561070, "post_id": 38595887, "comment_id": 64584447, "body": "@Plato, I&#39;d say the <code>CDPATH</code> env. variable understood by most interactive shells is your better friend."}], "answers": [{"tags": [], "owner": {"reputation": 10277, "user_id": 190446, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c544188078900e5d5976689949177f11?s=128&d=identicon&r=PG", "display_name": "S\u0142awosz", "link": "https://stackoverflow.com/users/190446/s%c5%82awosz"}, "is_accepted": false, "score": 4, "last_activity_date": 1469553311, "creation_date": 1469553311, "answer_id": 38596123, "question_id": 38595887, "link": "https://stackoverflow.com/questions/38595887/does-golang-have-a-central-repository-for-the-downloaded-third-party-packages/38596123#38596123", "title": "Does golang have a central repository for the downloaded third-party packages?", "body": "<p>There is no central repository of go packages. Go always is looking for packages either in GOPATH or GOROOT. go get simply downloads packages using git or mercurial. I recommend you to read \n<a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">https://golang.org/doc/code.html</a>\nand <a href=\"https://peter.bourgon.org/go-best-practices-2016/#repository-structure\" rel=\"nofollow\">https://peter.bourgon.org/go-best-practices-2016/#repository-structure</a></p>\n\n<p>GOPATH simply tells go compiler where to search for <code>src</code>, <code>pkg</code> directories.</p>\n"}, {"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 3, "last_activity_date": 1586292730, "last_edit_date": 1586292730, "creation_date": 1469581819, "answer_id": 38602183, "question_id": 38595887, "link": "https://stackoverflow.com/questions/38595887/does-golang-have-a-central-repository-for-the-downloaded-third-party-packages/38602183#38602183", "title": "Does golang have a central repository for the downloaded third-party packages?", "body": "<blockquote>\n  <p>Later if I want to create another Go project, I create a new dir called project2 and point GOPATH to project2\n  \u2026\n  My question is, whether Go has a central repository? If not, the same package will be downloaded twice if they are used in two different projects. Is that true?</p>\n</blockquote>\n\n<p>No, there is no central repository for Go code. However, it is also not true that the packages will always be downloaded twice.</p>\n\n<p>The misconception here is that <code>GOPATH</code> points to an individual project: it does not. Instead, <code>GOPATH</code> points to an <em>environment</em> where all of your packages live; it is where <code>go get</code> will download packages, and where <code>go build</code> will look for packages when building.</p>\n\n<p>Instead of changing <code>GOPATH</code> for every project, you should set <code>GOPATH</code> once and put all of your projects in <code>$GOPATH/src/</code> (your projects don't contain an <code>src/</code> directory, they go <em>in</em> the <code>src/</code> directory).</p>\n\n<p>So for example, the entire tree might look like:</p>\n\n<pre><code>$GOPATH/src/bitbucket.org/ (or GitHub, or your website, or whatever)\n\u251c\u2500\u2500 YourProject\n\u2514\u2500\u2500 AnotherProject\n</code></pre>\n\n<hr>\n\n<h2>Update</h2>\n\n<p>It is worth noting that this answer is no longer correct. Now that Go Modules are the normal versioning mechanism for Go code and <code>$GOPATH</code> is being phased out, a central proxy has been setup that routes all requests for packages through Google servers where the various tagged versions of the package can be cached. A separate checksum database keeps hashes for every package that are audit-able and can help you detect if a package author has changed an already released tag. All of this isn't a central repository in the same sense that PyPi (in the Python world) or NPM (for JavaScript) are a repo: the packages are still fetched from their source control, but because all packages are routed through the proxy by default it serves a similar purpose. For more information see <a href=\"https://proxy.golang.org/\" rel=\"nofollow noreferrer\">https://proxy.golang.org/</a></p>\n"}, {"comments": [{"owner": {"reputation": 130, "user_id": 7820857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec704a4aa136d1689af3bbbea788ef21?s=128&d=identicon&r=PG", "display_name": "julian-alarcon", "link": "https://stackoverflow.com/users/7820857/julian-alarcon"}, "edited": false, "score": 0, "creation_date": 1612388149, "post_id": 54504716, "comment_id": 116755142, "body": "Bintray/GoCenter is being decommissioned <a href=\"https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/\" rel=\"nofollow noreferrer\">jfrog.com/blog/&hellip;</a> . So this not a good alternative in the close future."}], "tags": [], "owner": {"reputation": 439, "user_id": 1300846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47aa9ee6b072e13bd2d218ddb0bc8139?s=128&d=identicon&r=PG", "display_name": "elig", "link": "https://stackoverflow.com/users/1300846/elig"}, "is_accepted": false, "score": 7, "last_activity_date": 1549209614, "creation_date": 1549209614, "answer_id": 54504716, "question_id": 38595887, "link": "https://stackoverflow.com/questions/38595887/does-golang-have-a-central-repository-for-the-downloaded-third-party-packages/54504716#54504716", "title": "Does golang have a central repository for the downloaded third-party packages?", "body": "<p>I guess now there is <a href=\"https://gocenter.jfrog.com/\" rel=\"noreferrer\">https://gocenter.jfrog.com/</a> \nMore info in this blog <a href=\"https://jfrog.com/blog/go-at-full-speed-with-gocenter\" rel=\"noreferrer\">https://jfrog.com/blog/go-at-full-speed-with-gocenter</a></p>\n"}, {"tags": [], "owner": {"reputation": 8155, "user_id": 2008247, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/wis7M.jpg?s=128&g=1", "display_name": "Jan Bodnar", "link": "https://stackoverflow.com/users/2008247/jan-bodnar"}, "is_accepted": false, "score": 0, "last_activity_date": 1614626301, "creation_date": 1614626301, "answer_id": 66428289, "question_id": 38595887, "link": "https://stackoverflow.com/questions/38595887/does-golang-have-a-central-repository-for-the-downloaded-third-party-packages/66428289#66428289", "title": "Does golang have a central repository for the downloaded third-party packages?", "body": "<p>Recently, a new site that collects information about Go packages has emerged:\n<a href=\"https://go.dev/\" rel=\"nofollow noreferrer\">https://go.dev/</a>.</p>\n<blockquote>\n<p>go.dev is the hub for Go users providing centralized and curated resources from across the Go ecosystem.</p>\n</blockquote>\n<p>It is an official companion website to golang.org. It does not qualify for a repository, such as cpan, nmpjs, nuget or crates. For external packages, it simply links to their respective Github pages.</p>\n<blockquote>\n<p>Go.dev is currently in MVP status. We\u2019re proud of what we\u2019ve built and excited to share it with the community. We hope you find value and joy in using go.dev. Go.dev only has a small portion of features we intend to build, and we are actively seeking feedback</p>\n</blockquote>\n<p>But as is written it the about page, it is still in early development. Maybe one day (hopefully) it shall become a fully featured code repository.</p>\n"}], "owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3453, "favorite_count": 1, "answer_count": 4, "score": 10, "last_activity_date": 1614626301, "creation_date": 1469552459, "question_id": 38595887, "link": "https://stackoverflow.com/questions/38595887/does-golang-have-a-central-repository-for-the-downloaded-third-party-packages", "title": "Does golang have a central repository for the downloaded third-party packages?", "body": "<p>I'm new to Golang. As I understand, when you want to create a new Go project, we just need to create a directory. Then we point the environment variable <code>GOPATH</code> to this directory. Inside this directory, we create three subdirectories <code>pkg</code>, <code>src</code> and <code>bin</code>. Then when we execute <code>go get ...</code>, the third-party package will be installed in the <code>pkg</code> subdirectory. Later if I want to create another Go project, I create a new dir called project2 and point <code>GOPATH</code> to project2. At this time <code>go get ...</code> will download third-party package in the <code>pkg</code> subdirectory of project2. My question is, whether Go has a central repository? If not, the same package will be downloaded twice if they are used in two different projects. Is that true?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "edited": false, "score": 0, "creation_date": 1469552465, "post_id": 38595122, "comment_id": 64579625, "body": "Perfect, thanks. Yes I don&#39;t expect a huge boost but I&#39;m interested in the principal too :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1469550017, "creation_date": 1469550017, "answer_id": 38595122, "question_id": 38594884, "link": "https://stackoverflow.com/questions/38594884/can-i-perform-an-action-on-all-slice-items-at-once-in-go/38595122#38595122", "title": "Can I perform an action on all slice items at once in go?", "body": "<p>If the slice only has 100 items or less and that's is the entirety of <code>cleanString</code>, you're not going to get a lot of speedup unless the body strings are fairly large.</p>\n\n<p>Parallelizing it with goroutines would look something like:</p>\n\n<pre><code>var wg sync.WaitGroup\nfor index, value := range results {\n    wg.Add(1)\n    go func(index int, body string) {\n        defer wg.Done()\n        results[index].Body = cleanString(body)\n    }(index, value.Body)\n}\nwg.Wait()\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 38595122, "answer_count": 1, "score": 0, "last_activity_date": 1469550017, "creation_date": 1469549317, "question_id": 38594884, "link": "https://stackoverflow.com/questions/38594884/can-i-perform-an-action-on-all-slice-items-at-once-in-go", "title": "Can I perform an action on all slice items at once in go?", "body": "<p>I have the following code:</p>\n\n<pre><code>func myfunction() {\n    results := make([]SomeCustomStruct, 0)\n\n    // ... results gets populated ...\n\n    for index, value := range results {\n        results[index].Body = cleanString(value.Body)\n    }\n\n    // ... when done, more things happen ...\n}\n\nfunc cleanString (in string) (out string) {\n    s := sanitize.HTML(in)\n    s = strings.Replace(s, \"\\n\", \" \", -1)\n    out = strings.TrimSpace(s)\n    return\n}\n</code></pre>\n\n<p>The slice will never contain more than 100 or so entries. Is there any way I can exploit goroutines here to perform the cleanString function on each slice item at the same time rather than one by one?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["http", "go", "runtime-error"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469543723, "post_id": 38592623, "comment_id": 64573789, "body": "Check the error from NewRequest"}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1469543876, "post_id": 38592623, "comment_id": 64573912, "body": "Check the error from getToken()"}, {"owner": {"reputation": 2843, "user_id": 613461, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/wVevO.jpg?s=128&g=1", "display_name": "zmeda", "link": "https://stackoverflow.com/users/613461/zmeda"}, "edited": false, "score": 0, "creation_date": 1469543922, "post_id": 38592623, "comment_id": 64573940, "body": "The problem is that if fails on lineX so second NewRequest was not issued."}, {"owner": {"reputation": 2843, "user_id": 613461, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/wVevO.jpg?s=128&g=1", "display_name": "zmeda", "link": "https://stackoverflow.com/users/613461/zmeda"}, "edited": false, "score": 0, "creation_date": 1469544143, "post_id": 38592623, "comment_id": 64574106, "body": "Thanks guys! and yes URL was malformed. :("}], "answers": [{"tags": [], "owner": {"reputation": 2843, "user_id": 613461, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/wVevO.jpg?s=128&g=1", "display_name": "zmeda", "link": "https://stackoverflow.com/users/613461/zmeda"}, "is_accepted": false, "score": 0, "last_activity_date": 1469544217, "creation_date": 1469544217, "answer_id": 38593033, "question_id": 38592623, "link": "https://stackoverflow.com/questions/38592623/go-lang-unexpected-behaviour-with-http-reusage/38593033#38593033", "title": "Go lang unexpected behaviour with http reusage", "body": "<p>URL was malformed therefore <code>NewRequest</code> was not able to parse it correctly. Use the error handling always!</p>\n"}], "owner": {"reputation": 2843, "user_id": 613461, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/wVevO.jpg?s=128&g=1", "display_name": "zmeda", "link": "https://stackoverflow.com/users/613461/zmeda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1469544217, "creation_date": 1469543264, "question_id": 38592623, "link": "https://stackoverflow.com/questions/38592623/go-lang-unexpected-behaviour-with-http-reusage", "title": "Go lang unexpected behaviour with http reusage", "body": "<p>I'm having function to obtain token from somewhere like:</p>\n\n<pre><code>func getToken(client *http.Client) (string, error) {\n    fmt.Printf(\"Starting with token...\\n\")\n    // Token service URL\n    apiUrl := \"http://url.to.obtain.token\"\n\n    // Data to send when getting a token\n    data := url.Values{}\n    data.Set(\"username\", \"my-username\")\n    data.Set(\"password\", \"my-password\")\n\n    // Create a POST request\n    request, _ := http.NewRequest(\"POST\", apiUrl, bytes.NewBufferString(data.Encode()))\n    // Add needed headers\n    request.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    request.Header.Add(\"Content-Length\", strconv.Itoa(len(data.Encode())))\n\n    // Issue the POST\n    resp, err := client.Do(request)\n    if err != nil {\n        return \"\", err\n    } else {\n        // Getting the token and transform it to string\n        htmlData, _ := ioutil.ReadAll(resp.Body)\n        resp.Body.Close()\n        body := string(htmlData)\n        return body, nil\n    }\n}\n</code></pre>\n\n<p>Then I have my main function like:</p>\n\n<pre><code>func main() {\n    client := &amp;http.Client{}\n\n    token, _ := getToken(client)\n\n    apiUrl := \"http://url.that.actually.uses.token\"\n\n    requ, _ := http.NewRequest(\"GET\", apiUrl, nil)\n\n    requ.Header.Add(\"Authorization\", token) // (lineX - for later reference)\n\n    resp, err := client.Do(requ)\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        htmlData, _ := ioutil.ReadAll(resp.Body)\n        resp.Body.Close()\n        body := string(htmlData)\n        fmt.Printf(body)\n    }\n}\n</code></pre>\n\n<p>In <code>lineX</code> I got runtime error like:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>I tried all sorts of things (even reusing client across functions).</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1469546516, "post_id": 38592464, "comment_id": 64575967, "body": "There&#39;s nothing unidiomatic about callbacks in Go.  Go has first-class support for functional programming for a reason.  An enormous number of even the standard libraries use callbacks (example, the entire HTTP server implementation is based on handler callbacks).  Channels are awesome, but there&#39;s no reason they need to be used to the <i>exclusion</i> of functional programming."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1469551919, "post_id": 38592464, "comment_id": 64579288, "body": "Because an <code>interface{}</code> contains a type and value, there&#39;s no need for the <code>Event</code> type.  The app can type switch or type assert on the <code>interface{}</code> values."}], "answers": [{"tags": [], "owner": {"reputation": 6470, "user_id": 25814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nDa7n.jpg?s=128&g=1", "display_name": "themue", "link": "https://stackoverflow.com/users/25814/themue"}, "is_accepted": false, "score": 0, "last_activity_date": 1469562860, "creation_date": 1469562860, "answer_id": 38598788, "question_id": 38592464, "link": "https://stackoverflow.com/questions/38592464/event-handling-in-go-using-channels/38598788#38598788", "title": "Event handling in Go using channels", "body": "<p>Take a look at my <a href=\"https://github.com/tideland/gocells\" rel=\"nofollow\">https://github.com/tideland/gocells</a>. It's a library for event driven applications. Here so called cells are started with behaviors responsible to process the events, these cells are connected.</p>\n\n<p>Maybe you can use it or get some inspiration.</p>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469562860, "creation_date": 1469542880, "question_id": 38592464, "link": "https://stackoverflow.com/questions/38592464/event-handling-in-go-using-channels", "title": "Event handling in Go using channels", "body": "<p>I have written an SDK that encapsulates a bunch of logic and functionality.</p>\n\n<p>Typically, I would use event listeners/callbacks to provide feedback to the application using the SDK, but that is not idiomatic in Go.</p>\n\n<p>It is my understanding that channels and goroutines fill the void of callbacks but what is a way to implement this?</p>\n\n<p>Say for example, my SDK has a number of events that I want to notify the main application about. Would I use one channel based on an <code>Event</code> struct. This <code>Event</code> would contain a <code>_type</code> field which specifies the event type, then a <code>data</code> field of type <code>interface{}</code> similar to <code>Object</code> in Java. The receiver would then check the type and cast the data accordingly.</p>\n\n<p>Either the above approach or one channel for event then the app listens for whatever channels it is concerned with.</p>\n\n<p>For the record I prefer the former approach but unsure about it's implementation.</p>\n\n<p>Has anybody achieve this before and how did you implement?</p>\n"}, {"tags": ["c++", "windows", "http", "go", "localhost"], "comments": [{"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469545239, "post_id": 38592320, "comment_id": 64574949, "body": "&quot;I want the server to send POST requests to the client.&quot; - is it a typo? Don&#39;t you want the C++ client to send requests to he Go server? (sorry if I misunderstand).  Also you say &#39;the server is showing &quot;HTTP-GA-SERVER: POST Successfully sent&quot;&#39; - but this message is in the c++ <b>client</b> code..."}, {"owner": {"reputation": 87, "user_id": 2386583, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c26901dd6436245f3975d5f0a7550909?s=128&d=identicon&r=PG", "display_name": "tankyx", "link": "https://stackoverflow.com/users/2386583/tankyx"}, "reply_to_user": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469545465, "post_id": 38592320, "comment_id": 64575136, "body": "@dmitris It was a typo, and my log messages are misleading. Sorry for that, i have edited the code."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 2386583, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c26901dd6436245f3975d5f0a7550909?s=128&d=identicon&r=PG", "display_name": "tankyx", "link": "https://stackoverflow.com/users/2386583/tankyx"}, "edited": false, "score": 0, "creation_date": 1469544296, "post_id": 38592728, "comment_id": 64574225, "body": "Hi !  Thanks for the fast answer. Actually I want to print the message in the console, not to send it to the client. The client is sending stuff and does not wait for any answers :) I have try the curl command, and it is correctly outputing the message I want, so the problem comes frm the c++ code"}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "reply_to_user": {"reputation": 87, "user_id": 2386583, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c26901dd6436245f3975d5f0a7550909?s=128&d=identicon&r=PG", "display_name": "tankyx", "link": "https://stackoverflow.com/users/2386583/tankyx"}, "edited": false, "score": 0, "creation_date": 1469545755, "post_id": 38592728, "comment_id": 64575355, "body": "I see - edited the answer to recommend sending a valid <code>Host</code> HTTP header in the request from the c++ client"}], "tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 1, "last_activity_date": 1469545708, "last_edit_date": 1469545708, "creation_date": 1469543520, "answer_id": 38592728, "question_id": 38592320, "link": "https://stackoverflow.com/questions/38592320/sending-a-post-request-locally-in-c-on-windows/38592728#38592728", "title": "Sending a POST request locally in C++ on Windows", "body": "<p><strong>Edit</strong> <BR>\nIn the client code, try to change:\n<code>strcpy(buffer,\"POST /test HTTP/1.1\\n\");</code>\nto\n<code>strcpy(buffer,\"POST /test HTTP/1.1\\r\\nHost: localhost\\r\\n\\r\\n\");</code></p>\n\n<p>HTTP/1.1 requires the presence of the <code>Host</code> HTTP header; after the headers, there should be an extra newline (<code>\\r\\n</code>).  Of course, change <code>localhost</code> to the actual hostname if needed.</p>\n\n<p>[Previous answer regarding the Go http server code]<BR>\nIn the <code>handleTest</code> function, you need to write to the http.ResponseWriter <code>w</code> or use its <code>WriteHeader</code> and <code>Write</code> functions. Currently <code>fmt.Print</code> in your code most likely prints the string in the terminal where you started the Go server but does not send it to the client.  Try the following (simplified) version of your Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/test\", handleTest)\n\n    fmt.Println(\"HTTP : Listen and serve\")\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc handleTest(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"HTTP : Test successful\\n\"))\n}\n</code></pre>\n\n<p>When you started the Go server, the client should get a response like this one done with curl (you can also access it through a browser for testing) :</p>\n\n<pre>\n$ curl http://localhost:8080/test\nHTTP : Test successful\n</pre>\n\n<p>You can see the description of the <code>ResponseHeader</code>'s <code>Write</code> and <code>WriteHeader</code> functiosn in the documentation for the net/http package: <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\">https://golang.org/pkg/net/http/#ResponseWriter</a></p>\n"}], "owner": {"reputation": 87, "user_id": 2386583, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c26901dd6436245f3975d5f0a7550909?s=128&d=identicon&r=PG", "display_name": "tankyx", "link": "https://stackoverflow.com/users/2386583/tankyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1281, "favorite_count": 0, "accepted_answer_id": 38592728, "answer_count": 1, "score": 0, "last_activity_date": 1469545708, "creation_date": 1469542495, "last_edit_date": 1469545417, "question_id": 38592320, "link": "https://stackoverflow.com/questions/38592320/sending-a-post-request-locally-in-c-on-windows", "title": "Sending a POST request locally in C++ on Windows", "body": "<p>I have a c++ client and and golang server on the same pc (on windows 10), and I want the client to send POST requests to the server. The request I want to send is the /test one. Both projects compile and run well, but the requests are not handled by the client, even if the server is showing</p>\n\n<pre><code>\"HTTP-GA-SERVER: POST Successfully sent\"\n</code></pre>\n\n<p>Here is the C++ code :</p>\n\n<pre><code>#include &lt;winsock2.h&gt;\n#include \"ga-http-post.h\"\n\nint sendPostToMushroom(HttpRequestType req, void* metrics)\n{\n    WSADATA wsaData;\n    if (WSAStartup(MAKEWORD(2,2), &amp;wsaData) != 0) {\n        std::cout &lt;&lt; \"WSAStartup failed.\" &lt;&lt; std::endl;\n        return 1;\n    }\n    SOCKET Socket=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);\n\n    SOCKADDR_IN SockAddr;\n    SockAddr.sin_port=htons(8080);\n    SockAddr.sin_family=AF_INET;\n    SockAddr.sin_addr.s_addr = htonl(INADDR_LOOPBACK);\n\n    std::cout &lt;&lt; \"HTTP-GA: Connecting...\" &lt;&lt; std::endl;\n\n    if (Socket &lt; 0) {\n        std::cout &lt;&lt; \"HTTP-GA: Error creating socket: \" &lt;&lt; WSAGetLastError() &lt;&lt; std::endl;\n        return 1;\n    }\n\n    if(connect(Socket,(SOCKADDR*)(&amp;SockAddr),sizeof(SockAddr)) != 0){\n        std::cout &lt;&lt; \"HTTP-GA: Error connecting: \" &lt;&lt; WSAGetLastError() &lt;&lt; std::endl;\n        return 1;\n    }\n    std::cout &lt;&lt; \"HTTP-GA: Connected to \" &lt;&lt; inet_ntoa(SockAddr.sin_addr) &lt;&lt; std::endl;\n\n    char buffer[2048];\n    strcpy(buffer,\"POST /test HTTP/1.1\\n\");\n\n    if (send(Socket,buffer, strlen(buffer),0) != strlen(buffer))\n    {\n        std::cout &lt;&lt; \"HTTP-GA: Error sending:\" &lt;&lt; WSAGetLastError() &lt;&lt; std::endl;\n        return 1;\n    }\n    closesocket(Socket);\n    WSACleanup();\n    std::cout &lt;&lt; \"HTTP-GA: POST Successfully sent\" &lt;&lt; std::endl;\n    return 0;\n}\n</code></pre>\n\n<p>And the golang code :</p>\n\n<pre><code>func (a *Agent) runGaHTTPHandler() {\n    fmt.Println(\"HTTP : Init HTTP Server\")\n\n    http.HandleFunc(\"/ready\", a.handleServerReady)\n    http.HandleFunc(\"/unavailable\", a.handleServerUnavailable)\n    http.HandleFunc(\"/connected\", a.handleClientConnected)\n    http.HandleFunc(\"/disconnected\", a.handleServerUnavailable)\n    http.HandleFunc(\"/MetricsCollected\", a.handleMetrics)\n    http.HandleFunc(\"/test\", a.handleTest)\n\n    fmt.Println(\"HTTP : Listen and serve\")\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc (a *Agent) handleTest(w http.ResponseWriter, r *http.Request) {\n    fmt.Print(\"HTTP : Test successful\\n\")\n}\n</code></pre>\n\n<p>EDIT : C++ code changed, still not working</p>\n"}, {"tags": ["go", "ipv4", "go-gin", "goji"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 11, "last_activity_date": 1469542391, "creation_date": 1469542391, "answer_id": 38592286, "question_id": 38592064, "link": "https://stackoverflow.com/questions/38592064/listen-on-tcp4-not-tcp6/38592286#38592286", "title": "Listen on TCP4 not TCP6", "body": "<p>The documentation states </p>\n\n<blockquote>\n  <p>Run attaches the router to a http.Server and starts listening and serving HTTP requests. It is a shortcut for http.ListenAndServe(addr, router)</p>\n</blockquote>\n\n<p>You can start the server directly using an <code>http.Server</code> the same way the <code>http</code> package does in <code>ListenAndServe</code></p>\n\n<pre><code>server := &amp;http.Server{Handler: r}\nl, err := net.Listen(\"tcp4\", addr)\nif err != nil {\n    log.Fatal(err)\n}\nerr = server.Serve(l)\n// ...\n</code></pre>\n"}], "owner": {"reputation": 529, "user_id": 914584, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/14a97f2fd7d2c80353e37d6278ad8f4f?s=128&d=identicon&r=PG", "display_name": "user914584", "link": "https://stackoverflow.com/users/914584/user914584"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4475, "favorite_count": 2, "accepted_answer_id": 38592286, "answer_count": 1, "score": 5, "last_activity_date": 1526313408, "creation_date": 1469541809, "last_edit_date": 1526313408, "question_id": 38592064, "link": "https://stackoverflow.com/questions/38592064/listen-on-tcp4-not-tcp6", "title": "Listen on TCP4 not TCP6", "body": "<p>I am using <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">https://github.com/gin-gonic/gin</a> to write an http service\nBut when I deploy it, it keeps deploying on tcp6(according to netstat)</p>\n\n<pre><code>r := gin.Default()\n//none of these are working , It keeps being listed on tcp6\nr.Run(\":8080\")\nr.Run(\"*:8080\")\nr.Run(\"0.0.0.0:8080\")\n</code></pre>\n"}, {"tags": ["angularjs", "go"], "comments": [{"owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "edited": false, "score": 0, "creation_date": 1469541237, "post_id": 38591141, "comment_id": 64571907, "body": "you are getting the &quot;Msg&quot; instead of the body in the server probably"}], "answers": [{"comments": [{"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1469539957, "post_id": 38591197, "comment_id": 64570911, "body": "Nope.. Now it is not even reaching the server. I already defined &#39;$scope&#39; to scope.. &#39;$scope&#39;, &#39;$http&#39;, function(scope, http)"}], "tags": [], "owner": {"reputation": 704, "user_id": 5608441, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/41b842661eb5825abfdffd7674008c27?s=128&d=identicon&r=PG&f=1", "display_name": "vaqifrv", "link": "https://stackoverflow.com/users/5608441/vaqifrv"}, "is_accepted": false, "score": 2, "last_activity_date": 1469539657, "creation_date": 1469539657, "answer_id": 38591197, "question_id": 38591141, "link": "https://stackoverflow.com/questions/38591141/angularjs-http-post-not-working-correctly/38591197#38591197", "title": "angularjs $http post not working correctly", "body": "<p>Use $ sign:</p>\n\n<pre><code>$http.post(\"/server_url\",Msg).then(function(response) {\n    console.log(response);\n});\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 240, "user_id": 6606627, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bes5SBBs-wY/AAAAAAAAAAI/AAAAAAAAAlA/0mJULYfPMJA/photo.jpg?sz=128", "display_name": "Alejandro", "link": "https://stackoverflow.com/users/6606627/alejandro"}, "reply_to_user": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1469541417, "post_id": 38591325, "comment_id": 64572058, "body": "can you make sure your Go code is correct?, i mean handling post request in go.  <a href=\"http://stackoverflow.com/questions/15672556/handling-json-post-request-in-go\" title=\"handling json post request in go\">stackoverflow.com/questions/15672556/&hellip;</a>"}], "tags": [], "owner": {"reputation": 240, "user_id": 6606627, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bes5SBBs-wY/AAAAAAAAAAI/AAAAAAAAAlA/0mJULYfPMJA/photo.jpg?sz=128", "display_name": "Alejandro", "link": "https://stackoverflow.com/users/6606627/alejandro"}, "is_accepted": false, "score": 1, "last_activity_date": 1469541730, "last_edit_date": 1469541730, "creation_date": 1469539941, "answer_id": 38591325, "question_id": 38591141, "link": "https://stackoverflow.com/questions/38591141/angularjs-http-post-not-working-correctly/38591325#38591325", "title": "angularjs $http post not working correctly", "body": "<p>\"Angular $http post accepts JSON objects as POST parameters, whereas you are just sending a string\" (thanks @Kaushik Evani)</p>\n\n<p>also you have a typo in <strong>http</strong>, try to update your code to this.</p>\n\n<pre><code>completeCampaign.controller('campaignCtrl', ['$scope', '$http', function($scope, $http) {\n    var data = {msg: \"hello\"};\n\n    $http.post(\"/server_url\", data).then(function(response) {\n        console.log(response);\n    });\n}]);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 905, "user_id": 5148395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cda68d10b98abbf6ecdc8559dc11b5f?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushik Evani", "link": "https://stackoverflow.com/users/5148395/kaushik-evani"}, "is_accepted": false, "score": 1, "last_activity_date": 1469541446, "creation_date": 1469541446, "answer_id": 38591920, "question_id": 38591141, "link": "https://stackoverflow.com/questions/38591141/angularjs-http-post-not-working-correctly/38591920#38591920", "title": "angularjs $http post not working correctly", "body": "<p>@Alejandro B\u00e1ez Arcila's answer is of course absolutely right. Sorry for being a pedantic, but it's not exactly a typo. And also it would better for the OP to know why his POST is not working. Angular $http post accepts JSON objects as POST parameters, whereas you are just sending a string.\nSo like @Alejandro B\u00e1ez Arcila has suggested, send it like <code>var data = {msg: \"hai\"};</code> and just access \"msg\" key on your server.</p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1469541730, "creation_date": 1469539505, "question_id": 38591141, "link": "https://stackoverflow.com/questions/38591141/angularjs-http-post-not-working-correctly", "title": "angularjs $http post not working correctly", "body": "<p>I am new in angularjs. I was trying to post some data to the server through $http post. My code could reach the server, but data is not passed. I am using golang for back-end. What are the mistakes I made here?</p>\n\n<pre><code>completeCampaign.controller('campaignCtrl', ['$scope', '$http', function(scope, http) {\n    var Msg = \"hai\";\n    http.post(\"/server_url\",Msg).then(function(response) {\n        console.log(response);\n    });\n}]);\n</code></pre>\n\n<p>go code:</p>\n\n<pre><code>func (c *CarController) TestFunction() {\n    msg := c.GetString(\"Msg\")\n    fmt.Println(\"Message is: \", msg)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Message is:\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 4, "last_activity_date": 1469542517, "creation_date": 1469542517, "answer_id": 38592335, "question_id": 38591130, "link": "https://stackoverflow.com/questions/38591130/what-should-be-a-secret-key-or-an-authentication-key-that-passed-to-newcookie/38592335#38592335", "title": "What should be a secret key (or an authentication key) that passed to `NewCookieStore()` in `gorilla/sessions`?", "body": "<p>From the end of that paragraph in the documentation for <code>NewCookieStore</code>:</p>\n\n<blockquote>\n  <p>Use the convenience function securecookie.GenerateRandomKey() to create strong keys.</p>\n</blockquote>\n\n<p>Use <a href=\"https://godoc.org/github.com/gorilla/securecookie#GenerateRandomKey\" rel=\"nofollow\"><code>securecookie.GenerateRandomKey</code></a></p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1469542517, "creation_date": 1469539475, "last_edit_date": 1469540472, "question_id": 38591130, "link": "https://stackoverflow.com/questions/38591130/what-should-be-a-secret-key-or-an-authentication-key-that-passed-to-newcookie", "title": "What should be a secret key (or an authentication key) that passed to `NewCookieStore()` in `gorilla/sessions`?", "body": "<p>In <a href=\"http://www.gorillatoolkit.org/pkg/sessions#NewCookieStore\" rel=\"noreferrer\">gorilla/sessions</a>, <code>func NewCookieStore(keyPairs ...[]byte) *CookieStore</code> is a used to create a new CookieStore. But I don't actually know what is a secret key (or an authentication key).</p>\n\n<p>The description had said that :</p>\n\n<blockquote>\n  <p>It is recommended to use an authentication key with 32 or 64 bytes. </p>\n</blockquote>\n\n<p>Therefore, is this means that I can randomly push any string with length of 32 or 64? How do you choose your authentication key?</p>\n"}, {"tags": ["pointers", "testing", "go", "interface", "mocking"], "comments": [{"owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "edited": false, "score": 0, "creation_date": 1469539480, "post_id": 38591020, "comment_id": 64570509, "body": "Decoder is a struct and not an interface in the json package, check here <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Decoder</a>"}], "answers": [{"comments": [{"owner": {"reputation": 629, "user_id": 1546024, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1561056187b5b6d1c86253de3c8738d0?s=128&d=identicon&r=PG", "display_name": "Tim Blackwell", "link": "https://stackoverflow.com/users/1546024/tim-blackwell"}, "edited": false, "score": 2, "creation_date": 1469539788, "post_id": 38591192, "comment_id": 64570777, "body": "I thought duck typing would resolve this issue? As *json.Decoder implements decoder"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 629, "user_id": 1546024, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1561056187b5b6d1c86253de3c8738d0?s=128&d=identicon&r=PG", "display_name": "Tim Blackwell", "link": "https://stackoverflow.com/users/1546024/tim-blackwell"}, "edited": false, "score": 1, "creation_date": 1469540067, "post_id": 38591192, "comment_id": 64571002, "body": "@TimBlackwell Unfortunately not."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 629, "user_id": 1546024, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1561056187b5b6d1c86253de3c8738d0?s=128&d=identicon&r=PG", "display_name": "Tim Blackwell", "link": "https://stackoverflow.com/users/1546024/tim-blackwell"}, "edited": false, "score": 2, "creation_date": 1469547160, "post_id": 38591192, "comment_id": 64576391, "body": "@TimBlackwell duck typing works for matching inputs to method parameter types, and returns to return types.  It doesn&#39;t, however, work for function signatures.  In other words, if Foo is a concrete type, and Foo fulfills Bar, then F() Foo and F() Bar are still two different function signatures.  The reason behind this is that, if a function returns a Foo, and you instead give it a Bar, what if it expected to be able to access the fields of that returned value?  Now it can&#39;t, because it&#39;s a Bar, and might not even be a Foo at all!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1478682013, "last_edit_date": 1478682013, "creation_date": 1469539647, "answer_id": 38591192, "question_id": 38591020, "link": "https://stackoverflow.com/questions/38591020/golang-return-pointer-to-interface-throws-error/38591192#38591192", "title": "Golang return pointer to interface throws error", "body": "<p>The <a href=\"https://golang.org/pkg/encoding/json/#NewDecoder\" rel=\"nofollow noreferrer\"><code>json.NewDecoder()</code></a> is a function with the following declaration:</p>\n\n<pre><code>func NewDecoder(r io.Reader) *Decoder\n</code></pre>\n\n<p>Its return type is <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\"><code>*json.Decoder</code></a>. <code>json.Decoder</code> is <em>not</em> an interface, it's a concrete type. And 2 function types are different if their return type is different: <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">Spec: Function types:</a></p>\n\n<blockquote>\n  <p>A function type denotes the set of all functions with the <strong>same parameter and result types</strong>.</p>\n</blockquote>\n\n<p>So you can't construct a new type returning an interface, and expect to be the same as <code>json.NewDecoder</code>, or that it'll accept the value <code>json.NewDecoder</code>.</p>\n\n<p>But the <em>\"seemingly\"</em> easy fix is: define your <code>decoderFactory</code> to be a function type exactly what <code>json.NewDecoder</code> is:</p>\n\n<pre><code>type decoderFactory func(r io.Reader) *json.Decoder\n</code></pre>\n\n<p>This compiles, ok... but how to mock now?</p>\n\n<h3>How to mock now?</h3>\n\n<p>Of course in this form, you'll lose the possibility to mock <code>json.NewDecoder()</code> (because a \"mocker\" would have to return a value of type <code>*json.Decoder</code> and nothing else would be accepted). What to do then?</p>\n\n<p>You have to use a different factory type. The factory type should be a function which returns an interface (of which you can provide different implementations), you were on the right track:</p>\n\n<pre><code>type MyDecoder interface {\n    Decode(v interface{}) error\n    // List other methods that you need from json.Decoder\n}\n\ntype decoderFactory func(r io.Reader) MyDecoder\n</code></pre>\n\n<p>But you can't use <code>json.NewEncoder</code> <em>as-is</em> to pass as a value of <code>decoderFactory</code>. But fear not, it is very easy to create a function of type <code>decoderFactory</code> which will call <code>json.NewEncoder()</code> under the hood:</p>\n\n<pre><code>func jsonDecoderFact(r io.Reader) MyDecoder {\n    return json.NewDecoder(r)\n}\n</code></pre>\n\n<p><em>We're mocking the behaviour of <code>json.Decoder</code>, and not the <code>json.NewDecoder()</code> factory function.</em></p>\n\n<p>Using this <code>jsonDecoderFact()</code>:</p>\n\n<pre><code>_, err := NewConfig(os.Open, jsonDecoderFact)\nif err != nil {\n    fmt.Fprintf(os.Stderr, \"something bad happened: %v\\n\", err)\n}\n</code></pre>\n\n<p>This is valid and compiles, because <code>jsonDecoderFact</code> has exactly the same type as <code>decoderFactory</code>.</p>\n\n<p>If you want to test / mock with a different implementation:</p>\n\n<pre><code>type TestDecoder struct {\n    r io.Reader\n}\n\nfunc (t TestDecoder) Decode(v interface{}) error {\n    // Test / mocking logic here\n    return nil\n}\n\nfunc testDecoderFact(r io.Reader) MyDecoder {\n    return TestDecoder{r}\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>_, err2 := NewConfig(os.Open, testDecoderFact)\nif err2 != nil {\n    fmt.Fprintf(os.Stderr, \"something bad happened: %v\\n\", err2)\n}\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/_7TImaNEkR\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2225, "favorite_count": 3, "accepted_answer_id": 38591192, "answer_count": 1, "score": 10, "last_activity_date": 1478682013, "creation_date": 1469539201, "last_edit_date": 1469719206, "question_id": 38591020, "link": "https://stackoverflow.com/questions/38591020/golang-return-pointer-to-interface-throws-error", "title": "Golang return pointer to interface throws error", "body": "<p>I have a basic function in Go that opens a file and tries to decode its JSON contents.</p>\n\n<p>I am trying to extract the default <code>json.NewDecoder()</code> function so I can easily mock this in my tests.</p>\n\n<p>However, my implementation seems to return an error:</p>\n\n<blockquote>\n  <p>cannot use json.NewDecoder (type func(io.Reader) *json.Decoder) as type decoderFactory in argument to NewConfig</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\ntype openFile func(name string) (*os.File, error)\n\ntype decoderFactory func(r io.Reader) decoder\n\ntype decoder interface {\n    Decode(v interface{}) error\n}\n\ntype Config struct {\n    ConsumerKey,\n    ConsumerSecret,\n    AccessToken,\n    AccessTokenSecret string\n}\n\nfunc NewConfig(open openFile, d decoderFactory) (*Config, error) {\n    c := new(Config)\n    file, err := open(\"some.file\")\n    if err != nil {\n        return nil, fmt.Errorf(\"error opening config file\")\n    }\n    defer file.Close()\n\n    decoder := d(file)\n    if err := decoder.Decode(&amp;c); err != nil {\n        return nil, fmt.Errorf(\"error decoding config JSON\")\n    }\n\n    return c, nil\n}\n\nfunc main() {\n    _, err := NewConfig(os.Open, json.NewDecoder)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"something bad happened: %v\\n\", err)\n    }\n}\n</code></pre>\n\n<p>Here's a link to the <a href=\"https://play.golang.org/p/Je1YR4AKZ1\" rel=\"nofollow\">Go playground</a></p>\n\n<p>Where am I going wrong?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469539156, "post_id": 38590942, "comment_id": 64570265, "body": "C doesn&#39;t have any concept of a Go <code>interface{}</code>. You need to return a C type from your exported function. (If that doesn&#39;t work, you need to get dome more debugging info from the server as to why it crashed)"}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469540026, "post_id": 38590942, "comment_id": 64570966, "body": "That didn&#39;t work, how can i add some debugging/log to that code? <code>import &quot;log&quot;</code> and than printing to file doesn&#39;t work ..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469541280, "post_id": 38590942, "comment_id": 64571941, "body": "I would guess that you&#39;re segfaulting  in the <code>ret</code> function, since <code>cstring_to_text</code> returns a <code>*text</code>, and you palloc only the size of that pointer, then copy the <code>text</code> struct into that location. I would make a proof of concept in C first to ensure you can get that working before expanding to Go/cgo."}], "answers": [{"comments": [{"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1469688887, "post_id": 38623528, "comment_id": 64642363, "body": "Looks good, I&#39;we worked the version 1 around and now there is an complicated mess on my github: <a href=\"https://github.com/microo8/plgo\" rel=\"nofollow noreferrer\">github.com/microo8/plgo</a> There must not be the all the CFLAGS and LDFLAGS options? just build c-shared?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 1, "creation_date": 1469733877, "post_id": 38623528, "comment_id": 64673088, "body": "yeah, that&#39;s why I stuck with version 0.   I wanted stored procs in go.  Not write a bunch of C code to connect it all together.   For sure you dont need all the flags taking my approach, maybe it&#39;s required for the v1 macros"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 6, "last_activity_date": 1469655116, "creation_date": 1469655116, "answer_id": 38623528, "question_id": 38590942, "link": "https://stackoverflow.com/questions/38590942/golang-procedural-language-for-postgresql/38623528#38623528", "title": "Golang procedural language for Postgresql", "body": "<p>The trick is to use version 0 calling conventions as those allow calling simple C functions without using all the fancy macros they added to version 1 calling.</p>\n\n<p>You also need a single C file to invoke the PG_MODULE_MAGIC macro.  </p>\n\n<p>I have a working example project that does all this, might be easiest if you just copied that as a starting point.</p>\n\n<p>Not sure it will let you do exactly what you want, but it does indeed work for some use cases.</p>\n\n<p><a href=\"https://github.com/dbudworth/gopgfuncs\" rel=\"noreferrer\">https://github.com/dbudworth/gopgfuncs</a></p>\n\n<p>Will also outline the same stuff that repo tells you...</p>\n\n<h1>Step 1</h1>\n\n<p>create a .go file with you functions and the CGO includes</p>\n\n<pre><code>package main\n\n//#include \"postgres.h\"\n//#include \"fmgr.h\"\n//#include &lt;string.h&gt;\nimport \"C\"\nimport (\n    \"log\"\n    \"sync/atomic\"\n)\n\n// Functions are scoped to the db session\nvar counter int64\n\n//Inc atomically increments a session local counter by a given delta\n//export Inc\nfunc Inc(delta C.int64) C.int64 {\n    log.Printf(\"Inc(%v) called\", delta)\n    return C.int64(atomic.AddInt64(&amp;counter, int64(delta)))\n}\n\n//AddOne adds one to the given arg and retuns it\n//export AddOne\nfunc AddOne(i C.int) C.int {\n    log.Printf(\"AddOne(%v) called\", i)\n    return i + 1\n}\n\nfunc main() {\n}\n</code></pre>\n\n<h1>Step 2</h1>\n\n<p>create a .c file in the same directory that invokes the PG_MODULE_MAGIC macro from postgres.h, this is a requirement of all extension libraries.\nGo will automatically include the C file while compiling, no special instructions are needed.</p>\n\n<pre><code>#include \"postgres.h\"\n#include \"fmgr.h\"\n\nPG_MODULE_MAGIC;\n</code></pre>\n\n<h1>Step 3</h1>\n\n<p>Build your so file, trick here is to use -buildmode=c-shared</p>\n\n<pre><code>go build -buildmode=c-shared -o libMyMod.so\n</code></pre>\n\n<h1>Step 4</h1>\n\n<p>Execute SQL to register your functions.  Since registing an extension requires absolute paths, I prefer to pass the module on the command line to avoid making the \"install.sql\" script have hard coded paths in it.  </p>\n\n<pre><code>PGMOD=`pwd`/libMyMod.so\npsql $(DBNAME) --set=MOD=\\'$(PGMOD)\\' -f install.sql\n</code></pre>\n\n<p>Install script contains one of these statements per function you export.</p>\n\n<p>It's absolutely critical you get the input / output types right as there's nothing the system can do to verify them and you may end up stomping on memory, storage, whatever.  You can see the translation of pg types to c types <a href=\"https://www.postgresql.org/docs/9.5/static/xfunc-c.html#XFUNC-C-TYPE-TABLE\" rel=\"noreferrer\">here</a></p>\n\n<pre><code>create or replace function add_one(integer)\n  returns integer as :MOD,'AddOne'\n  LANGUAGE C STRICT;\n</code></pre>\n"}], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3189, "favorite_count": 3, "answer_count": 1, "score": 5, "last_activity_date": 1472408462, "creation_date": 1469539006, "last_edit_date": 1472408462, "question_id": 38590942, "link": "https://stackoverflow.com/questions/38590942/golang-procedural-language-for-postgresql", "title": "Golang procedural language for Postgresql", "body": "<p>I'm trying to compile and run go code as Postgresql stored procedure.\nMy motivation is because postgresql can have excensions written in C and golang can be compiled as c-shared</p>\n\n<p>So I have to files, pl.go:</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -Wall -Wpointer-arith -Wno-declaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fpic -I. -I./ -I/usr/include/postgresql/server -I/usr/include/postgresql/internal -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -I/usr/include/libxml2\n#cgo LDFLAGS: -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -march=x86-64 -mtune=generic -O2 -pipe -fstack-protector-strong -fpic -L/usr/lib -Wl,-O1,--sort-common,--as-needed,-z,relro  -Wl,--as-needed -Wl,-rpath,'/usr/lib',--enable-new-dtags -shared\n\n#include \"postgres.h\"\n#include \"fmgr.h\"\n#include \"utils/builtins.h\"\n\n#ifdef PG_MODULE_MAGIC\nPG_MODULE_MAGIC;\n#endif\n\n//the return value must be allocated trough palloc\nvoid* ret(void *val, uint64 *size) {\n    void *retDatum = palloc(*size);\n    memcpy(retDatum, val, *size);\n    return retDatum;\n}\n\nPG_FUNCTION_INFO_V1(plgo_func);\n*/\nimport \"C\"\nimport \"unsafe\"\n\nfunc main() {}\n\n//PGVal returns the Postgresql C type from Golang type (currently implements just stringtotext)\nfunc PGVal(val interface{}) (ret interface{}) {\n    var size uintptr\n    switch v := val.(type) {\n    case string:\n        ret = C.cstring_to_text(C.CString(v))\n        size = unsafe.Sizeof(ret)\n    default:\n        ret = val\n        size = unsafe.Sizeof(ret)\n    }\n    return C.ret(ret, (*C.uint64)(unsafe.Pointer(size)))\n}\n</code></pre>\n\n<p>the <code>CFLAGS</code> and <code>LDFLAGS</code> i'we got from <code>pg_config</code></p>\n\n<p>and the file where I create the function to call, plgo.go:</p>\n\n<pre><code>package main\n\n/*\n#include \"postgres.h\"\n#include \"fmgr.h\"\n#include \"utils/builtins.h\"\n*/\nimport \"C\"\n\n//export plgo_func\nfunc plgo_func(fcinfo *C.FunctionCallInfoData) interface{} {\n    return PGVal(\"meh\")\n}\n</code></pre>\n\n<p>the shared library is created with: <code>go build -buildmode=c-shared -o plgo.so plgo.go pl.go &amp;&amp; sudo cp plgo.so /usr/lib/postgresql</code></p>\n\n<p>the function in postgresql is created with:</p>\n\n<pre><code>CREATE OR REPLACE FUNCTION public.plgo_func(integer)\n  RETURNS text AS\n'$libdir/plgo', 'plgo_func'\n  LANGUAGE c IMMUTABLE STRICT\n  COST 1;\n</code></pre>\n\n<p>but when I run: <code>psql -U root -d meh -c \"select plgo_func(0)\"</code></p>\n\n<p>the server crashes with:</p>\n\n<pre><code>server closed the connection unexpectedly\n    This probably means the server terminated abnormally\n    before or while processing the request.\nconnection to server was lost\n</code></pre>\n\n<p>EDIT: I've successfully created an golang \"library\" for creating stored procedures and triggers in golang <a href=\"https://github.com/microo8/plgo\" rel=\"nofollow\">plgo</a> :)</p>\n"}, {"tags": ["json", "go", "json-deserialization"], "comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1469535204, "post_id": 38588358, "comment_id": 64567187, "body": "<a href=\"https://github.com/antonholmquist/jason\" rel=\"nofollow noreferrer\">github.com/antonholmquist/jason</a>"}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1469536960, "post_id": 38588358, "comment_id": 64568561, "body": "Maybe I missed the point, but what speaks against having declared <code>IntervalData.Data</code> as <code>[]string</code>? <a href=\"https://play.golang.org/p/ken-wOlYBf\" rel=\"nofollow noreferrer\">play.golang.org/p/ken-wOlYBf</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2462, "user_id": 1230744, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cf2b2b74c80e9f3b04fb7e3fa5b09067?s=128&d=identicon&r=PG", "display_name": "kuldeep.kamboj", "link": "https://stackoverflow.com/users/1230744/kuldeep-kamboj"}, "edited": false, "score": 0, "creation_date": 1469532867, "post_id": 38588524, "comment_id": 64565487, "body": "Oh that is typing mistake, My code only have Data variable not data, But interestingly code working in link you given. After more checking, I found I json variable is not string type but []uint8 type, ( It comes from a message consumer response )  ."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2462, "user_id": 1230744, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cf2b2b74c80e9f3b04fb7e3fa5b09067?s=128&d=identicon&r=PG", "display_name": "kuldeep.kamboj", "link": "https://stackoverflow.com/users/1230744/kuldeep-kamboj"}, "edited": false, "score": 1, "creation_date": 1469533171, "post_id": 38588524, "comment_id": 64565706, "body": "@kuldeep.kamboj <code>[]uint8</code> is the same as <code>[]byte</code>, which is how <code>json.RawMessage</code> is defined: <code>type RawMessage []byte</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1469532110, "creation_date": 1469532110, "answer_id": 38588524, "question_id": 38588358, "link": "https://stackoverflow.com/questions/38588358/golang-convert-json-having-array-list-to-struct-in-glolang/38588524#38588524", "title": "golang convert json having array list to struct in glolang", "body": "<p>In your example code you are referring to <code>r.data</code> which is an <em>unexported</em> field! But your type <code>IntervalData</code> has an <em>exported</em> <code>IntervalData.Data</code> field! This is inconsistent.</p>\n\n<p>So most likely your <code>IntervalData</code> contains an <em>unexported</em> <code>data</code> field, which the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow\"><code>json</code></a> package ignores, only exported fields are marshaled / unmarshaled.</p>\n\n<p>Simply change the <code>IntervalData.data</code> field to be exported: <code>IntervalData.Data</code>.</p>\n\n<p>See this working example:</p>\n\n<pre><code>j := `{\"data\" : [\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"], \"sid\" : \"ab\", \"did\" : \"123\"}`\nr := IntervalData{}\njson.Unmarshal([]byte(j), &amp;r)\nlog.Printf(\"Raw  Body: %s\", r)\n\nlog.Printf(\"Raw Data Json: %s\", r.Data)\n\nblist := IntervalDataList{}\njson.Unmarshal([]byte(r.Data), &amp;blist)\nlog.Printf(\"Data List : %s\", blist)\n</code></pre>\n\n<p>Output (try it on the <kbd><a href=\"https://play.golang.org/p/dyJaBOaZbb\" rel=\"nofollow\">Go Playground</a></kbd>):</p>\n\n<pre><code>2009/11/10 23:00:00 Raw  Body: {[\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"] 123 ab}\n2009/11/10 23:00:00 Raw Data Json: [\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"]\n2009/11/10 23:00:00 Data List : [2016-06-21 2016-06-22 2016-06-25]\n</code></pre>\n\n<p>Also note that the <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow\"><code>json.RawMessage</code></a> field and a second unmarshaling is unnecessary, you can define the <code>Data</code> to be of type <code>IntervalDataList</code> and it works with a single unmarshal:</p>\n\n<pre><code>Data IntervalDataList `json:\"data\"`\n</code></pre>\n\n<p>And unmarshaling:</p>\n\n<pre><code>j := `{\"data\" : [\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"], \"sid\" : \"ab\", \"did\" : \"123\"}`\nr := IntervalData{}\njson.Unmarshal([]byte(j), &amp;r)\nlog.Printf(\"Raw Data Json: %s\", r.Data)\n</code></pre>\n\n<p>Output (try this on the <kbd><a href=\"https://play.golang.org/p/sY2AcvbMqe\" rel=\"nofollow\">Go Playground</a></kbd>):</p>\n\n<pre><code>2009/11/10 23:00:00 Raw Data Json: [2016-06-21 2016-06-22 2016-06-25]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2462, "user_id": 1230744, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cf2b2b74c80e9f3b04fb7e3fa5b09067?s=128&d=identicon&r=PG", "display_name": "kuldeep.kamboj", "link": "https://stackoverflow.com/users/1230744/kuldeep-kamboj"}, "edited": false, "score": 0, "creation_date": 1469538454, "post_id": 38590450, "comment_id": 64569745, "body": "As icza points, initial code is also working, But main issue is actual json is different than expected json, which add double quotes around data value (and escape quotes inside too)."}], "tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1469537609, "creation_date": 1469537609, "answer_id": 38590450, "question_id": 38588358, "link": "https://stackoverflow.com/questions/38588358/golang-convert-json-having-array-list-to-struct-in-glolang/38590450#38590450", "title": "golang convert json having array list to struct in glolang", "body": "<p>The code below (or in <a href=\"https://play.golang.org/p/kQRE7xYjrz\" rel=\"nofollow\">https://play.golang.org/p/kQRE7xYjrz</a>) parses the JSON string and extracts/prints the Data field:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar data = []byte(`{\"data\" : [\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"], \"sid\" : \"ab\", \"did\" : \"123\"}`)\n\ntype IntervalDataList []string\n\ntype IntervalData struct {\n    Data IntervalDataList `json:\"data\"`\n    Did  string           `json:\"did\"`\n    Sid  string           `json:\"sid\"`\n}\n\nfunc main() {\n    r := &amp;IntervalData{}\n    err := json.Unmarshal(data, r)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Data: %#v\\n\", r.Data)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Data: main.IntervalDataList{\"2016-06-21\", \"2016-06-22\", \"2016-06-25\"}\n</code></pre>\n"}], "owner": {"reputation": 2462, "user_id": 1230744, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cf2b2b74c80e9f3b04fb7e3fa5b09067?s=128&d=identicon&r=PG", "display_name": "kuldeep.kamboj", "link": "https://stackoverflow.com/users/1230744/kuldeep-kamboj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1691, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1469537609, "creation_date": 1469531659, "last_edit_date": 1495540733, "question_id": 38588358, "link": "https://stackoverflow.com/questions/38588358/golang-convert-json-having-array-list-to-struct-in-glolang", "title": "golang convert json having array list to struct in glolang", "body": "<p>I am new to golang, I need to get data from following json string.</p>\n\n<pre><code>{\"data\" : [\"2016-06-21\",\"2016-06-22\",\"2016-06-25\"], \"sid\" : \"ab\", \"did\" : \"123\"}\n</code></pre>\n\n<p>For now I tried a struct with similar </p>\n\n<pre><code>type IntervalData struct {\n    Data json.RawMessage `json:\"data\"`\n    Did  string `json:\"did\"`\n    Sid  string `json:\"sid\"`\n}\n\ntype IntervalDataList []string\n</code></pre>\n\n<p>and json unmarshall code like </p>\n\n<pre><code>    r := IntervalData{}\n    json.Unmarshal([]byte(json), &amp;r)\n    log.Printf(\"Raw  Body: %s\", r)\n\n    log.Printf(\"Raw Date Json: %s\", r.Data)\n\n    blist := IntervalDataList{}\n    json.Unmarshal([]byte(r.Data), &amp;blist)\n    log.Printf(\"Date List : %s\", blist)\n</code></pre>\n\n<p>This code only able to get sid and did from json string not data which shown as empty map.<br>\nWhat can be the way to get data from above json.  </p>\n\n<p>UPDATE : Issue resolved. I checked my input json comes in format of <code>{\"data\":\"[\\\"dsadsdsaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\\\",\\n\\\"sdsdadsddad\\\"]\",\"did\":\"654646456\",\"sid\":\"88683627434\"}</code> which is not required form. Then I checked client script and make changes according to online sources.\n<a href=\"https://stackoverflow.com/questions/14177862/how-to-jsonize-a-uint8-slice-in-go\">How to JSONize a uint8 slice in Go?</a></p>\n\n<pre><code>type RequestData struct {\n    Data JSONableSlice `json:\"data\"`\n    Did  string `json:\"did\"`\n    Sid  string `json:\"sid\"`\n}\ntype JSONableSlice []uint8\n\nfunc (u JSONableSlice) MarshalJSON() ([]byte, error) {\n    var result string\n    if u == nil {\n        result = \"null\"\n    } else {\n        result = strings.Join(strings.Fields(fmt.Sprintf(\"%d\", u)), \",\")\n    }\n    return []byte(result), nil\n}\n\nfunc ApiRequest(w http.ResponseWriter, r *http.Request) {\n    sid := r.Header.Get(\"sid\")\n    deviceID := r.Header.Get(\"deviceId\")\n\n    body, err := ioutil.ReadAll(r.Body)\n    failOnError(err, \"Issue faced during reading post contents\")\n    data := RequestData{\n        Data: body,\n        Sid:  sid,\n        Did:  dID,\n    }\n\n    bdata, err := json.Marshal(data)\n\n    // Some Rabbit MQ Connection code\n\n    // Rabbit MQ publish code\n    err = ch.Publish(\n        \"\",     // exchange\n        q.Name, // routing key\n        false,  // mandatory\n        false,  // immediate\n        amqp.Publishing{\n            DeliveryMode: amqp.Persistent,\n            ContentType:  \"text/plain\",\n            Body:         bdata,\n    })\n}\n</code></pre>\n\n<p>Not much changes required in consumer code now</p>\n\n<pre><code>    type IntervalData struct {\n        //Data json.RawMessage `json:\"data\"`\n        Data []byte `json:\"data\"`\n        Did  string `json:\"did\"`\n        Sid  string `json:\"sid\"`\n    }\n    r := IntervalData{}\n    json.Unmarshal([]byte(json), &amp;r)\n    log.Printf(\"Raw  Body: %s\", r)\n\n    log.Printf(\"Raw Date Json: %s\", r.Data)\n\n    blist := IntervalDataList{}\n    json.Unmarshal(r.Data, &amp;blist)\n    log.Printf(\"Date List : %s\", blist)\n</code></pre>\n"}, {"tags": ["string", "parsing", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 2, "creation_date": 1469533248, "post_id": 38587397, "comment_id": 64565763, "body": "You can perhaps use a custom split function: <a href=\"https://play.golang.org/p/sr1pUIR3NC\" rel=\"nofollow noreferrer\">play.golang.org/p/sr1pUIR3NC</a> However, this still may not perform complete seek to EOF and it doesn&#39;t split on <code>\\n</code> anymore."}], "answers": [{"comments": [{"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1469532419, "post_id": 38587750, "comment_id": 64565212, "body": "No. This is not what I want. I want &quot;6\\n7&quot; to be printed. But more importantly, I want to know if there is a way to read until EOF from a scanner, from its SEEK_CUR position."}, {"owner": {"reputation": 547, "user_id": 5810474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108078f0353c37a619786a600fbbaec1?s=128&d=identicon&r=PG&f=1", "display_name": "Toni Villena", "link": "https://stackoverflow.com/users/5810474/toni-villena"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1469545445, "post_id": 38587750, "comment_id": 64575119, "body": "@SankarP, I have updated my solution. See <b>UPDATE</b>"}], "tags": [], "owner": {"reputation": 547, "user_id": 5810474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/108078f0353c37a619786a600fbbaec1?s=128&d=identicon&r=PG&f=1", "display_name": "Toni Villena", "link": "https://stackoverflow.com/users/5810474/toni-villena"}, "is_accepted": false, "score": 0, "last_activity_date": 1469546546, "last_edit_date": 1469546546, "creation_date": 1469529944, "answer_id": 38587750, "question_id": 38587397, "link": "https://stackoverflow.com/questions/38587397/golang-scanner-read-until-end-of-reader/38587750#38587750", "title": "golang scanner read until end of reader", "body": "<p>Is this that you want? :-)</p>\n\n<pre><code>    s := `1\n          2\n          3\n          4\n          5\n          6\n          7`\n\n    var beyond5 string\n\n    if strings.Contains(s, \"5\") {\n       scanner := bufio.NewScanner(strings.NewReader(s))\n       for scanner.Scan() {\n          beyond5 += scanner.Text()\n        }\n    }\n\n    beyond5 += \"\\n\"\n\n    log.Println(beyond5)\n</code></pre>\n\n<p><strong>UPDATE:</strong> My solution is similar to @abhink's solution, however, they are different solutions</p>\n\n<p>I have used <a href=\"https://golang.org/pkg/bufio/#Scanner.Split\" rel=\"nofollow\">Split method</a>, this method set split (private) property that it is <a href=\"https://golang.org/pkg/bufio/#SplitFunc\" rel=\"nofollow\">SplitFunc type</a>. And this is my implementation:</p>\n\n<pre><code>var canPass bool\n\nfunc mySplit(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    for pos, value := range data {\n\n        if (value &lt; '6' &amp;&amp; !canPass) || (value &lt; '0' || value &gt; '9') {\n            continue\n        }\n\n        canPass = true\n        return pos+1, data[pos : pos + 1], nil\n    }\n\n    return 0, nil, nil\n}\n</code></pre>\n\n<p>Now, you must use Split method, send it mySplit as parameter.</p>\n\n<pre><code>scanner.Split(mySplit)\n</code></pre>\n\n<p>And you do a simple for with <code>scanner.Scan()</code></p>\n\n<pre><code>for scanner.Scan() {\n        beyond5 += scanner.Text() + \"\\n\"\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>6\n7\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Sq6QaHchy5\" rel=\"nofollow\">Playground</a></p>\n\n<p>I hope it is the solution that you were looking for :-)</p>\n"}, {"tags": [], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "is_accepted": true, "score": 1, "last_activity_date": 1469534546, "creation_date": 1469534546, "answer_id": 38589366, "question_id": 38587397, "link": "https://stackoverflow.com/questions/38587397/golang-scanner-read-until-end-of-reader/38589366#38589366", "title": "golang scanner read until end of reader", "body": "<p>It seems such an operation is not possible at all with the scanner. We need to use the bufio reader only. The code is:</p>\n\n<pre><code>s := `1\n2\n3\n4\n5\n6\n7`\n\nbeyond5 := \"\"\nr := strings.NewReader(s)\nreader := bufio.NewReader(r)\nfor {\n    line, err := reader.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n    if strings.Contains(line, \"5\") {\n        b, _ := ioutil.ReadAll(reader)\n        beyond5 = string(b)\n        break\n    }\n}\n\nlog.Println(beyond5)\n</code></pre>\n"}], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2113, "favorite_count": 0, "accepted_answer_id": 38589366, "answer_count": 2, "score": 3, "last_activity_date": 1469546546, "creation_date": 1469529045, "question_id": 38587397, "link": "https://stackoverflow.com/questions/38587397/golang-scanner-read-until-end-of-reader", "title": "golang scanner read until end of reader", "body": "<p>I have a bufio scanner on a StringReader. After I reach a certain line on the Scanner output, I want to read until the end of the reader. Is there any way to achieve this using a simpler way, other than the commented code ?</p>\n\n<pre><code>s := `1\n2\n3\n4\n5\n6\n7`\n\nbeyond5 := \"\"\nscanner := bufio.NewScanner(strings.NewReader(s))\nfor scanner.Scan() {\n    if strings.Contains(scanner.Text(), \"5\") {\n        // Read all lines until EOF from scanner\n        // and store in beyond5\n        // for scanner.Scan() {\n        //  beyond5 += scanner.Text()\n        //  beyond5 += \"\\n\"\n        // }\n        break\n    }\n}\n\nlog.Println(beyond5)\n</code></pre>\n"}, {"tags": ["go", "channel", "beego"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469527835, "post_id": 38586804, "comment_id": 64562220, "body": "How are you calling <code>SetNotification</code>? There&#39;s no loop in your code so it&#39;s probably a blocking channel. Can you share some more code?"}, {"owner": {"reputation": 31, "user_id": 6639030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad7e053cab43626ddbd8e2ce7e55a332?s=128&d=identicon&r=PG&f=1", "display_name": "Sinojin", "link": "https://stackoverflow.com/users/6639030/sinojin"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469530467, "post_id": 38586804, "comment_id": 64563936, "body": "I added code. Do you think i need loop ? does   <code>&lt;-MessageNotification[&quot;1&quot;]</code> code make program wait or am i wrong ?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469531331, "post_id": 38586804, "comment_id": 64564496, "body": "How are you calling <code>Notification</code> and <code>Websocket</code> functions?"}, {"owner": {"reputation": 31, "user_id": 6639030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad7e053cab43626ddbd8e2ce7e55a332?s=128&d=identicon&r=PG&f=1", "display_name": "Sinojin", "link": "https://stackoverflow.com/users/6639030/sinojin"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469531661, "post_id": 38586804, "comment_id": 64564730, "body": "These are controller.I use beego framework and beego callback controller function according to url.(for example localhost:8080/chatinfo )"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469532333, "post_id": 38586804, "comment_id": 64565145, "body": "You should add beego tag to your question. Someone who knows it might be able to help out."}], "answers": [{"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 0, "last_activity_date": 1469547960, "creation_date": 1469547960, "answer_id": 38594447, "question_id": 38586804, "link": "https://stackoverflow.com/questions/38586804/go-channel-reading-and-writing-stuck-in-infinite-loop/38594447#38594447", "title": "Go Channel reading and writing stuck in infinite loop", "body": "<p>You're not creating your channel.  </p>\n\n<pre><code>var MessageNotification = make(map[string]chan bool, 10)\n</code></pre>\n\n<p>This line makes a map with capacity 10, but you're not creating the actual <em>channels</em> in the map.  As a result, `SetNotification[\"1\"] is a nil channel, and sends and receives on nil channels block indefinitely.  </p>\n\n<p>You need to put in </p>\n\n<pre><code>MessageNotification[\"1\"] = make(chan bool)\n</code></pre>\n\n<p>You can include a size if desired (and I have a hunch your \"10\" in the map make was supposed to be the buffering for that channel).  This can even be done conditionally:</p>\n\n<pre><code>func GetNotification(id int, timestamp int) notification {\n    if _, ok := MessageNotification[\"1\"]; !ok { // if map does not contain that key\n        MessageNotification[\"1\"] = make(chan bool, 10)\n    }\n\n    &lt;-MessageNotification[\"1\"]\n    // ...\n}\n\nfunc SetNotification(id int) {\n    if _, ok := MessageNotification[strconv.Itoa(id)]; !ok { // if map does not contain that key\n        MessageNotification[strconv.Itoa(id)] = make(chan bool, 10)\n    }\n\n    MessageNotification[strconv.Itoa(id)] &lt;- true\n}\n</code></pre>\n\n<p>This way the first location that tries to access the channel adds it to the map and properly makes the channel, so sends and receives on it will actually function.</p>\n"}], "owner": {"reputation": 31, "user_id": 6639030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad7e053cab43626ddbd8e2ce7e55a332?s=128&d=identicon&r=PG&f=1", "display_name": "Sinojin", "link": "https://stackoverflow.com/users/6639030/sinojin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 601, "favorite_count": 0, "accepted_answer_id": 38594447, "answer_count": 1, "score": 1, "last_activity_date": 1469547960, "creation_date": 1469527321, "last_edit_date": 1469532366, "question_id": 38586804, "link": "https://stackoverflow.com/questions/38586804/go-channel-reading-and-writing-stuck-in-infinite-loop", "title": "Go Channel reading and writing stuck in infinite loop", "body": "<p>First of all, I want to make Long Polling notification system. To be more specific, I will make http request, and response will be returned only if map channel is <code>true</code>.</p>\n\n<p>This is the code block I used:</p>\n\n<pre><code>var MessageNotification = make(map[string]chan bool, 10)\n\nfunc GetNotification(id int, timestamp int) notification {\n    &lt;-MessageNotification[\"1\"]\n\n    var chat_services []*models.Chat_service\n    o := orm.NewOrm()\n\n    _, err := o.QueryTable(\"chat_service\").Filter(\"Sender__id\", id).RelatedSel().All(&amp;chat_services)\n\n    if err != nil {\n        return notification{Status: false}\n    }\n    return notification{Status: true, MessageList: chat_services}\n}\n\nfunc SetNotification(id int) {\n    MessageNotification[strconv.Itoa(id)] &lt;- true\n}\n</code></pre>\n\n<p>This is controller block :</p>\n\n<pre><code>func (c *ChatController) Notification() {\n\ndata := chat.GetNotification(1,0)\n\nc.Data[\"json\"] = data\nc.ServeJSON()\n\n  }\n\n\nfunc (c *ChatController) Websocket(){\n\n\n    chat.SetNotification(1)\n\n    c.Data[\"json\"] = \"test\"\n    c.ServeJSON();\n\n}\n</code></pre>\n\n<p>function names and variable created for test.</p>\n\n<p>No error occurred. Thanks for your help.</p>\n"}, {"tags": ["function", "templates", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469528158, "post_id": 38586651, "comment_id": 64562460, "body": "Are you adding the function map <code>funcMap</code> to the template? You need to call a template&#39;s <code>Funcs</code> method to do that. Details: <a href=\"https://golang.org/pkg/text/template/#Template.Funcs\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template/#Template.Funcs</a>"}, {"owner": {"reputation": 23, "user_id": 1502452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b492bd4daf695bd52fdb34f0057178ae?s=128&d=identicon&r=PG", "display_name": "Respawner", "link": "https://stackoverflow.com/users/1502452/respawner"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469534270, "post_id": 38586651, "comment_id": 64566518, "body": "@abhink of course I did that. Otherwise it would tell me that the function is not defined while parsing the template."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 1502452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b492bd4daf695bd52fdb34f0057178ae?s=128&d=identicon&r=PG", "display_name": "Respawner", "link": "https://stackoverflow.com/users/1502452/respawner"}, "edited": false, "score": 0, "creation_date": 1469534551, "post_id": 38587070, "comment_id": 64566707, "body": "OK I see. Thanks for the really detailed answer, which actually answered my question. I had indeed an error while executing the template. <code>at &lt;.&gt;: wrong type for value; expected string; got net.IP</code> Meaning I already have a net.IP struct instead of a string, so my function doesn&#39;t work. Thanks again!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1557655977, "last_edit_date": 1557655977, "creation_date": 1469528081, "answer_id": 38587070, "question_id": 38586651, "link": "https://stackoverflow.com/questions/38586651/using-custom-func-in-go-condition-template/38587070#38587070", "title": "Using custom func in Go condition template", "body": "<p><strong>TL;DR;</strong> You must inspect the <code>error</code> value returned by <a href=\"https://golang.org/pkg/text/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>template.Execute()</code></a> or <a href=\"https://golang.org/pkg/text/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\"><code>template.ExecuteTemplate()</code></a> which will tell you why it doesn't work for you.</p>\n\n<hr>\n\n<h3>Things that could go wrong</h3>\n\n<p>First, your execution doesn't panic because it simply returns an error. Would you inspect that, you'll probably know what's going wrong immediately:</p>\n\n<pre><code>if err := t.Execute(os.Stdout, data); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Next what could go wrong: you have to register your custom functions <em>prior</em> to parsing the template because the template engine needs to be able to statically analyze the template, and it needs to know prior that <code>IsIPv4</code> is a function name:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n    \"IsIPv4\": isIPv4,\n}).Parse(templ))\n</code></pre>\n\n<p>Another potential error is that <code>isIPv4()</code> expects a value of type <code>string</code>, and you may pass a value of different type.</p>\n\n<p>And custom functions registered for templates should only return a non-<code>nil</code> error if you intend to stop the execution of the template. Because that's what happens if you return an <code>error</code>. <a href=\"https://golang.org/pkg/text/template/#FuncMap\" rel=\"nofollow noreferrer\"><code>template.FuncMap</code></a>:</p>\n\n<blockquote>\n  <p>[...] if the second (error) return value evaluates to non-nil during execution, execution terminates and Execute returns that error.</p>\n</blockquote>\n\n<h3>Working example</h3>\n\n<p>Here's a working example using your template and your <code>isIPv4()</code> function:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n    \"IsIPv4\": isIPv4,\n}).Parse(templ))\n\nm := map[string]interface{}{\n    \"Addresses\": []string{\"127.0.0.1\", \"0:0:0:0:0:0:0:1\"},\n}\n\nif err := t.Execute(os.Stdout, m); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/6CXSOyAbMO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>IPv4: 127.0.0.1\n\nIPv6: 0:0:0:0:0:0:0:1\n</code></pre>\n\n<h3>Potential errors</h3>\n\n<p>The above program prints the following errors:</p>\n\n<p>Passing an invalid IP:</p>\n\n<pre><code>    \"Addresses\": []string{\"127.0.0.1.9\"},\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: template: :2:6: executing \"\" at &lt;IsIPv4 .&gt;: error calling IsIPv4:\n    The argument is not an IP address\n</code></pre>\n\n<p>Passing a non-<code>string</code> value:</p>\n\n<pre><code>    \"Addresses\": []interface{}{2},\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: template: :2:13: executing \"\" at &lt;.&gt;: wrong type for value; expected string; got int\n</code></pre>\n\n<p>Attempting to register your custom function <em>after</em> the template has been parsed:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Parse(templ))\nt.Funcs(template.FuncMap{\n    \"IsIPv4\": isIPv4,\n})\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: template: :2: function \"IsIPv4\" not defined\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 1502452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b492bd4daf695bd52fdb34f0057178ae?s=128&d=identicon&r=PG", "display_name": "Respawner", "link": "https://stackoverflow.com/users/1502452/respawner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1152, "favorite_count": 0, "accepted_answer_id": 38587070, "answer_count": 1, "score": 2, "last_activity_date": 1557655977, "creation_date": 1469526929, "question_id": 38586651, "link": "https://stackoverflow.com/questions/38586651/using-custom-func-in-go-condition-template", "title": "Using custom func in Go condition template", "body": "<p>I'm trying to define a custom Go func to use in a template condition.\nWhat I want to achieve is : if the given argument is an IPv4 address the template will output <em>IPv4: [argument]</em> else it will output <em>IPv6: [argument]</em>.</p>\n\n<p>To do that I have created a template like this:</p>\n\n<pre><code>{{ range .Addresses }}\n{{ if IsIPv4 . }}\nIPv4: {{ . }}\n{{ else }}\nIPv6: {{ . }}\n{{ end }}\n{{ end }}\n</code></pre>\n\n<p>As you can see I have create a new function called <strong>IsIPv4</strong> which take a string argument and given the argument return true or false. Here is the code:</p>\n\n<pre><code>var (\n    errNotAnIPAddress = errors.New(\"The argument is not an IP address\")\n)\n\nfunc isIPv4(address string) (bool, error) {\n    ip := net.ParseIP(address)\n\n    if ip == nil {\n        return false, errNotAnIPAddress\n    }\n\n    return (ip.To4() != nil), nil\n}\n</code></pre>\n\n<p>When executing my template I have got no errors but the execution looks like to stop when trying to evaluate <strong>{{ if IsIPv4 . }}</strong>.</p>\n\n<p>Of course the function is mapped before trying to parse and execute the template.</p>\n\n<pre><code>funcMap := template.FuncMap{\n    \"IsIPv4\": isIPv4,\n}\n</code></pre>\n\n<p>I'm pretty new to Go and I have probably missed something (maybe obvious?).</p>\n\n<p>To debug a little bit I have tried to remove the IsIPv4 call in my template giving a condition like <strong>{{ if . }}</strong>. And the result was to always output <em>IPv4: [the IP address]</em>. That makes sense to me.</p>\n\n<p>I also took a look at the predefined Go funcs like <strong>eq</strong> and it looks like I'm trying to reproduce the same idea, without any success.</p>\n"}, {"tags": ["arrays", "go", "nested", "maps", "slice"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6638915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e895d9f74abf49e329e6cc4afe4a1b1f?s=128&d=identicon&r=PG&f=1", "display_name": "stucklen", "link": "https://stackoverflow.com/users/6638915/stucklen"}, "edited": false, "score": 0, "creation_date": 1469525457, "post_id": 38586015, "comment_id": 64560428, "body": "Thanks, I&#39;ve corrected it although I&#39;m still generating the same 3 errors :("}, {"owner": {"reputation": 33, "user_id": 6638915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e895d9f74abf49e329e6cc4afe4a1b1f?s=128&d=identicon&r=PG&f=1", "display_name": "stucklen", "link": "https://stackoverflow.com/users/6638915/stucklen"}, "edited": false, "score": 0, "creation_date": 1469526057, "post_id": 38586015, "comment_id": 64560860, "body": "Awesome, it kinda works now just one more error: cannot use map[string][]string literal (type map[string][]string) as type map[string]string in field value. Do I need to change the typing of the map?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 33, "user_id": 6638915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e895d9f74abf49e329e6cc4afe4a1b1f?s=128&d=identicon&r=PG&f=1", "display_name": "stucklen", "link": "https://stackoverflow.com/users/6638915/stucklen"}, "edited": false, "score": 0, "creation_date": 1469526220, "post_id": 38586015, "comment_id": 64561002, "body": "What&#39;s your <code>Model.Page</code> type? If in that you have <code>StringMap</code> as <code>map[string]string</code> then you&#39;ll have to change it to <code>map[string][]string</code>"}, {"owner": {"reputation": 33, "user_id": 6638915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e895d9f74abf49e329e6cc4afe4a1b1f?s=128&d=identicon&r=PG&f=1", "display_name": "stucklen", "link": "https://stackoverflow.com/users/6638915/stucklen"}, "edited": false, "score": 0, "creation_date": 1469526458, "post_id": 38586015, "comment_id": 64561193, "body": "Ah yes, solved! That was my problem, changed it and now it works. Thanks abhink."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 0, "last_activity_date": 1469525480, "last_edit_date": 1469525480, "creation_date": 1469525225, "answer_id": 38586015, "question_id": 38585950, "link": "https://stackoverflow.com/questions/38585950/nested-map-of-slices-does-not-work-inside-a-function/38586015#38586015", "title": "Nested map of slices does not work inside a function", "body": "<p>There's a missing comma at the end of <code>StringMap</code> declaration. Also, you are using <code>:=</code> for <code>StringMap</code> initialization. It should be <code>:</code> since the initialization is for a map key:</p>\n\n<pre><code>func RenderContents(responseWriter http.ResponseWriter) {\n    var page Model.Page = Model.Page {\n        TemplateFilename: \"template.html\",\n        StringMap: map[string][]string{\n           \"numbers\": []string{\"1\", \"2\"},\n           \"programs\": []string{\"red\"},\n        },\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6638915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e895d9f74abf49e329e6cc4afe4a1b1f?s=128&d=identicon&r=PG&f=1", "display_name": "stucklen", "link": "https://stackoverflow.com/users/6638915/stucklen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 38586015, "answer_count": 1, "score": -1, "last_activity_date": 1469525480, "creation_date": 1469525097, "question_id": 38585950, "link": "https://stackoverflow.com/questions/38585950/nested-map-of-slices-does-not-work-inside-a-function", "title": "Nested map of slices does not work inside a function", "body": "<p>I'm trying to create a map of slices and I have the following code that works.</p>\n\n<pre><code>StringMap := map[string][]string{\n    \"numbers\": []string{\"1\", \"2\"},\n    \"programs\": []string{\"red\"},\n}\n</code></pre>\n\n<p>But if I put it inside this function:</p>\n\n<pre><code>func RenderContents(responseWriter http.ResponseWriter) {\n    var page Model.Page = Model.Page {\n        TemplateFilename: \"template.html\",\n        StringMap := map[string][]string{\n           \"numbers\": []string{\"1\", \"2\"},\n           \"programs\": []string{\"red\"},\n        }\n    }\n}\n</code></pre>\n\n<p><strong>I get the following errors:</strong> \nsyntax error: unexpected :=, expecting comma or }\nextra expression in var declaration\nsyntax error: unexpected : at end of statement</p>\n\n<p>I'm a newbie to Go so not sure if there's an obvious answer, but any help is appreciated.</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1469519819, "post_id": 38584033, "comment_id": 64556710, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/37907679/go-unit-testing-fatals-and-testing-main\">Go Unit-Testing fatals and testing main()</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535096880, "post_id": 38584033, "comment_id": 90948560, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37907679/go-unit-testing-fatals-and-testing-main\">Go Unit-Testing fatals and testing main()</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10277, "user_id": 190446, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c544188078900e5d5976689949177f11?s=128&d=identicon&r=PG", "display_name": "S\u0142awosz", "link": "https://stackoverflow.com/users/190446/s%c5%82awosz"}, "is_accepted": false, "score": 6, "last_activity_date": 1469524767, "last_edit_date": 1469524767, "creation_date": 1469524396, "answer_id": 38585716, "question_id": 38584033, "link": "https://stackoverflow.com/questions/38584033/how-to-test-main-routine-from-go-test/38585716#38585716", "title": "How to test &quot;main()&quot; routine from &quot;go test&quot;?", "body": "<p>Just make your <code>main()</code> single line:</p>\n\n<pre><code>import \"myapp\"\n\nfunc main() {\n    myapp.Start()\n}\n</code></pre>\n\n<p>And test <code>myapp</code> package properly.</p>\n\n<p>EDIT:\nFor example, popular etcd conf server uses this technique: <a href=\"https://github.com/coreos/etcd/blob/master/main.go\" rel=\"noreferrer\">https://github.com/coreos/etcd/blob/master/main.go</a></p>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 1, "last_activity_date": 1469526213, "creation_date": 1469526213, "answer_id": 38586391, "question_id": 38584033, "link": "https://stackoverflow.com/questions/38584033/how-to-test-main-routine-from-go-test/38586391#38586391", "title": "How to test &quot;main()&quot; routine from &quot;go test&quot;?", "body": "<p>If you really want to do such type of testing in Go, you can use Go <code>os/exec</code> package <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow\">https://golang.org/pkg/os/exec/</a> to execute your binary and test it as a whole - for example, executing <code>go run main.go</code> command.  Essentially it would be an equivalent of a shell script done in Go. You can use <code>StdinPipe</code> <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow\">https://golang.org/pkg/os/exec/#Cmd.StdinPipe</a> and <code>StdouPipe</code>/<code>StderrPipe</code> (<a href=\"https://golang.org/pkg/os/exec/#Cmd.StdoutPipe\" rel=\"nofollow\">https://golang.org/pkg/os/exec/#Cmd.StdoutPipe</a> and <a href=\"https://golang.org/pkg/os/exec/#Cmd.StderrPipe\" rel=\"nofollow\">https://golang.org/pkg/os/exec/#Cmd.StderrPipe</a>) to feed the desired input and verify output. The examples on the package documentation page <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow\">https://golang.org/pkg/os/exec/</a> should give you a good starting point.</p>\n\n<p>However, the testing of compiled programs goes beyond the unit testing so it is worth to consider other tools (not necessarily Go-based) that more typically used for functional / acceptance testing such as Cucumber <a href=\"http://cucumber.io\" rel=\"nofollow\">http://cucumber.io</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 164, "user_id": 1780856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63308869cb01c7e0a877fea18e2e1c32?s=128&d=identicon&r=PG", "display_name": "davecb", "link": "https://stackoverflow.com/users/1780856/davecb"}, "is_accepted": false, "score": 5, "last_activity_date": 1560827698, "last_edit_date": 1560827698, "creation_date": 1518044394, "answer_id": 48674736, "question_id": 38584033, "link": "https://stackoverflow.com/questions/38584033/how-to-test-main-routine-from-go-test/48674736#48674736", "title": "How to test &quot;main()&quot; routine from &quot;go test&quot;?", "body": "<p>I think you're trying too hard: I just tried the following</p>\n\n<pre><code>func TestMainProgram(t *testing.T) {\n    os.Args = []string{\"sherlock\",\n        \"--debug\", \n        \"--add\", \"zero\",\n        \"--ruleset\", \"../scripts/ceph-log-filters/ceph.rules\",\n        \"../scripts/ceph-log-filters/ceph.log\"}\n    main()\n}\n</code></pre>\n\n<p>and it worked fine. I can make a normal tabular test or a goConvey BDD from it pretty easily...</p>\n"}], "owner": {"reputation": 195, "user_id": 5957452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5d3110808d4bcabdd7a7241da337e4?s=128&d=identicon&r=PG&f=1", "display_name": "john1234", "link": "https://stackoverflow.com/users/5957452/john1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4458, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1560827698, "creation_date": 1469519531, "question_id": 38584033, "link": "https://stackoverflow.com/questions/38584033/how-to-test-main-routine-from-go-test", "title": "How to test &quot;main()&quot; routine from &quot;go test&quot;?", "body": "<p>I want to lock the user-facing command line API of my <em>golang</em> program by writing few anti-regression tests that would focus on testing my binary as a whole. What testing \"binary as a whole\" means is that go-test should:</p>\n\n<ol>\n<li>be able to feed STDIN to my binary</li>\n<li>be able to check that my binary produces correct STDOUT</li>\n<li>be able to ensure that error cases are handled properly by binary</li>\n</ol>\n\n<p><strong>However, it is not obvious to me what is the best practice to do that in <em>go</em>? If there is a good <em>go</em> test example, could you point me to it?</strong></p>\n\n<p>P.S. in the past I have been using <em>autotools</em>. And I am looking for something similar to AT_CHECK, for example:</p>\n\n<pre><code>AT_CHECK([echo \"XXX\" | my_binary -e arg1 -f arg2], [1], [],\n  [-f and -e can't be used together])\n</code></pre>\n"}, {"tags": ["go", "deployment", "go-iris"], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "is_accepted": true, "score": 4, "last_activity_date": 1469522676, "creation_date": 1469522676, "answer_id": 38585046, "question_id": 38583853, "link": "https://stackoverflow.com/questions/38583853/how-to-deploy-an-iris-go-web-framework-project/38585046#38585046", "title": "How to deploy an iris (Go web framework) project?", "body": "<p>Go allows very simple deployment with a standalone binary you can push to all servers without worrying about available libraries:</p>\n\n<ol>\n<li>Compile your code for the targeted <a href=\"http://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5\" rel=\"nofollow\">operating system</a></li>\n<li>Push the executable to your server</li>\n<li>Run it with whatever you want : service, supervisord...</li>\n</ol>\n\n<p>A good read: <a href=\"https://peter.bourgon.org/go-in-production/\" rel=\"nofollow\">Go in production</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 39, "user_id": 10248741, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-0Yp5BmS9XH4/AAAAAAAAAAI/AAAAAAAAAc8/m7zqIoXiUxc/photo.jpg?sz=128", "display_name": "hamid hassani", "link": "https://stackoverflow.com/users/10248741/hamid-hassani"}, "is_accepted": false, "score": 0, "last_activity_date": 1567174822, "last_edit_date": 1567174822, "creation_date": 1567174312, "answer_id": 57728384, "question_id": 38583853, "link": "https://stackoverflow.com/questions/38583853/how-to-deploy-an-iris-go-web-framework-project/57728384#57728384", "title": "How to deploy an iris (Go web framework) project?", "body": "<p>depends on yours root project it's a bit different to build. i prefer to configure my project so </p>\n\n<p><strong>AppName</strong></p>\n\n<ul>\n<li>Models</li>\n<li>Services\n\n<ul>\n<li>service1</li>\n<li>service2</li>\n</ul></li>\n<li>Helpers</li>\n<li>Controllers</li>\n<li>Web\n\n<ul>\n<li>Views</li>\n<li>Assets</li>\n<li>Locals</li>\n<li>main.go</li>\n</ul></li>\n</ul>\n\n<p>for that go to the root directory ,\nin windows for development you should execute</p>\n\n<pre><code>go run web\\main.go\n</code></pre>\n\n<p>for production when the project complied </p>\n\n<pre><code>Set GOOS=linux //(if your server is linux)\ngo build web\\main.go\n</code></pre>\n\n<p>after it you will see a binary file \nwhen you put the file on the server in linux it's better to define a services for the binary file to execute on start up and restart on any error.</p>\n"}], "owner": {"reputation": 991, "user_id": 1572028, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b3c18fd15010927238391dd5049f0d98?s=128&d=identicon&r=PG", "display_name": "user130268", "link": "https://stackoverflow.com/users/1572028/user130268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1502, "favorite_count": 0, "accepted_answer_id": 38585046, "answer_count": 2, "score": 2, "last_activity_date": 1567174822, "creation_date": 1469518983, "last_edit_date": 1523950941, "question_id": 38583853, "link": "https://stackoverflow.com/questions/38583853/how-to-deploy-an-iris-go-web-framework-project", "title": "How to deploy an iris (Go web framework) project?", "body": "<p>I'm very new to the Golang as well as iris (Go web framework). Right now I'm play with them and trying to understand whether they fit my needs. As I understand, after we completed a iris project, what we have is a bunch of .go files. Then we compile them and get one executable. How should we deploy this output? Simply put it at some where in the file system and run it (probably as a service on Windows or background job in Linux)? Is it that simple?</p>\n"}, {"tags": ["http", "go", "http-status"], "comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1469518451, "post_id": 38583672, "comment_id": 64555825, "body": "What is your exact problem? What doesn&#39;t work for you in your current implementation? Do you want to write a proxy for some legacy API?"}, {"owner": {"reputation": 3, "user_id": 6638446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/699accca7e4857df9740c13578c2a276?s=128&d=identicon&r=PG&f=1", "display_name": "J.Lukac", "link": "https://stackoverflow.com/users/6638446/j-lukac"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1469519654, "post_id": 38583672, "comment_id": 64556615, "body": "Yes, kind of... The problem is headers that need to be like &lt;status code&gt; &lt;some status message&gt;  Status message should contain an error description, but not that standard one like 400 Bad request, but 400 Required parameter is missing, or 400 No timestamp in request or so..."}], "answers": [{"comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1469528514, "post_id": 38587192, "comment_id": 64562716, "body": "TIL! Thanks for that."}, {"owner": {"reputation": 3, "user_id": 6638446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/699accca7e4857df9740c13578c2a276?s=128&d=identicon&r=PG&f=1", "display_name": "J.Lukac", "link": "https://stackoverflow.com/users/6638446/j-lukac"}, "edited": false, "score": 0, "creation_date": 1469534385, "post_id": 38587192, "comment_id": 64566595, "body": "Wow that&#39;s pretty it, but how to write headers and content to that hijacked connection? Anyway, this is what I&#39;m looking for. Thanks in advance :)"}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469536464, "post_id": 38587192, "comment_id": 64568170, "body": "I modified the program above to have separate bufrw.WriteString calls for headers and the body, separated with an extra <code>\\r\\n</code> empty line.  Of course, you can add more headers or copy them from the proxied connection.  Just remember, with hijacking you have the full control of what is written and are imitating the HTTP server - so for example if it is important to send the Content-Length header, you should calculate the response length and send the header &quot;manually&quot;, as done with Content-Type in the example."}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1469541131, "post_id": 38587192, "comment_id": 64571832, "body": "If you want a semi-proxy functionality you can do <code>response.Write(bufrw)</code> after hijacking."}, {"owner": {"reputation": 3, "user_id": 6638446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/699accca7e4857df9740c13578c2a276?s=128&d=identicon&r=PG&f=1", "display_name": "J.Lukac", "link": "https://stackoverflow.com/users/6638446/j-lukac"}, "edited": false, "score": 0, "creation_date": 1469625008, "post_id": 38587192, "comment_id": 64614097, "body": "This solution is perfect. I just added some \\n s and \\r s to make it work. Thank you very much :)"}], "tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 2, "last_activity_date": 1469536279, "last_edit_date": 1469536279, "creation_date": 1469528449, "answer_id": 38587192, "question_id": 38583672, "link": "https://stackoverflow.com/questions/38583672/extending-golangs-http-package/38587192#38587192", "title": "Extending golang&#39;s http package", "body": "<p>You can use the <code>http.Hijacker</code> interface <a href=\"https://golang.org/pkg/net/http/#Hijacker\" rel=\"nofollow\">https://golang.org/pkg/net/http/#Hijacker</a> to \"hijack\" (take over) the server's TCP connection to the client and write to it the custom response. Here is a modification of the example <a href=\"https://golang.org/pkg/net/http/#example_Hijacker\" rel=\"nofollow\">https://golang.org/pkg/net/http/#example_Hijacker</a> to return \"400 Required parameter is missing\" instead of the standard \"400 Bad request\" response to the client:</p>\n\n<pre><code>package main\n\nimport \"net/http\"\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        hj, ok := w.(http.Hijacker)\n        if !ok {\n            http.Error(w, \"webserver doesn't support hijacking\", http.StatusInternalServerError)\n            return\n        }\n        conn, bufrw, err := hj.Hijack()\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        // Don't forget to close the connection:\n        defer conn.Close()\n        // non-standard HTTP status text and an HTTP header are written;\n        // end of the Headers part of the messages is marked by extra \\r\\n\n        bufrw.WriteString(\"HTTP/1.1 400 Required parameter is missing\\r\\nContent-Type: text/html; charset=utf-8\\r\\n\\r\\n\")\n        // write the body of the HTTP response message\n        bufrw.WriteString(\"400 Required parameter is missing\\n\")\n        bufrw.Flush()\n    })\n    http.ListenAndServe(\":9000\", nil)\n}\n</code></pre>\n\n<p>Running this program and sending a curl request produces the desired response:</p>\n\n<pre>\n$ curl -i http://localhost:9000/\nHTTP/1.1 400 Required parameter is missing\nContent-Type: text/html; charset=utf-8\n\n400 Required parameter is missing\n</pre>\n\n<p>It should be straightforward to extend it to propagate other responses from your legacy API server.</p>\n\n<p><strong>Edit</strong> <br>\nused <code>\\r\\n\\r\\n</code> in the example program to terminate the Headers portion of the HTTP response in accordance with the HTTP message standard (<a href=\"https://tools.ietf.org/html/rfc7230#section-3\" rel=\"nofollow\">https://tools.ietf.org/html/rfc7230#section-3</a>); separated <code>WriteString</code> calls for the headers and body of the HTTP response for clarity.</p>\n"}], "owner": {"reputation": 3, "user_id": 6638446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/699accca7e4857df9740c13578c2a276?s=128&d=identicon&r=PG&f=1", "display_name": "J.Lukac", "link": "https://stackoverflow.com/users/6638446/j-lukac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1246, "favorite_count": 0, "accepted_answer_id": 38587192, "answer_count": 1, "score": 0, "last_activity_date": 1469536279, "creation_date": 1469518321, "question_id": 38583672, "link": "https://stackoverflow.com/questions/38583672/extending-golangs-http-package", "title": "Extending golang&#39;s http package", "body": "<p>I would need to extend http package to achieve non standard response containing error description in status ie:\n400 Required parameter is missing \ninstead of 400 Bad request that is standard status description.</p>\n\n<p>This is my actual implementation:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/url\"\n)\n\ntype GatewayHandler int\n\nfunc main() {\n    var gh GatewayHandler\n\n    http.ListenAndServe(\":9000\", gh)\n}\n\nfunc (gh GatewayHandler) ServeHTTP(res http.ResponseWriter, req *http.Request) {\n\n    legacyApiUrl := \"http://some-url.com\" + req.URL.RequestURI()\n\n    client := &amp;http.Client{}\n    request, _ := http.NewRequest(req.Method, legacyApiUrl, nil)\n    response, _ := client.Do(request)\n    res.Header().Set(\"Status\", response.Status)\n    for k, v := range response.Header {\n        fmt.Println(k, \": \", v)\n        i := \"\"\n        for _, j := range v {\n            i += j\n        }\n        res.Header().Set(k, i)\n    }\n\n    res.WriteHeader(response.StatusCode)\n\n    if response.Status != \"200 OK\" {\n        fmt.Println(response.Status)\n    }\n\n    result, _ := ioutil.ReadAll(response.Body)\n    output := string(result)\n    fmt.Println(output)\n\n    io.WriteString(res, output)\n}\n</code></pre>\n\n<p>In general I need to forward that status from other URL that uses it and I need to keep it compatible. </p>\n\n<p>Thank you very much in advance.</p>\n\n<p>Jozef</p>\n"}, {"tags": ["ssl", "go", "https", "net-http"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6638302"}, "edited": false, "score": 1, "creation_date": 1469521970, "post_id": 38583993, "comment_id": 64557987, "body": "Thank you I accepted your answer but I can&#39;t upvote until i reach 15 reputations"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1559902757, "post_id": 38583993, "comment_id": 99573641, "body": "No one provid private key. The client always use public key to connect."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 8, "last_activity_date": 1469519402, "creation_date": 1469519402, "answer_id": 38583993, "question_id": 38582937, "link": "https://stackoverflow.com/questions/38582937/how-to-create-a-tls-client-with-ca-certificates-in-go/38583993#38583993", "title": "How to create a tls client with ca certificates in GO?", "body": "<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"flag\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nvar (\n    certFile = flag.String(\"cert\", \"someCertFile\", \"A PEM eoncoded certificate file.\")\n    keyFile  = flag.String(\"key\", \"someKeyFile\", \"A PEM encoded private key file.\")\n    caFile   = flag.String(\"CA\", \"someCertCAFile\", \"A PEM eoncoded CA's certificate file.\")\n)\n\nfunc main() {\n    flag.Parse()\n\n    // Load client cert\n    cert, err := tls.LoadX509KeyPair(*certFile, *keyFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Load CA cert\n    caCert, err := ioutil.ReadFile(*caFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n    caCertPool := x509.NewCertPool()\n    caCertPool.AppendCertsFromPEM(caCert)\n\n    // Setup HTTPS client\n    tlsConfig := &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n        RootCAs:      caCertPool,\n    }\n    tlsConfig.BuildNameToCertificate()\n    transport := &amp;http.Transport{TLSClientConfig: tlsConfig}\n    client := &amp;http.Client{Transport: transport}\n\n    // Do GET something\n    resp, err := client.Get(\"https://localdev.local:8443\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    // Dump response\n    data, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(string(data))\n}\n</code></pre>\n\n<p>Mostly borrowed from this <a href=\"https://gist.github.com/michaljemala/d6f4e01c4834bf47a9c4\" rel=\"noreferrer\">gist</a>. And here is a great article to work with TLS in Go: <a href=\"https://ericchiang.github.io/tls/go/https/2015/06/21/go-tls.html\" rel=\"noreferrer\">https://ericchiang.github.io/tls/go/https/2015/06/21/go-tls.html</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6638302"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3768, "favorite_count": 2, "accepted_answer_id": 38583993, "answer_count": 1, "score": 4, "last_activity_date": 1469519402, "creation_date": 1469516041, "question_id": 38582937, "link": "https://stackoverflow.com/questions/38582937/how-to-create-a-tls-client-with-ca-certificates-in-go", "title": "How to create a tls client with ca certificates in GO?", "body": "<p>I want to create a tls client using the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">net/http</a>  in GO how can I create it given the ca certificates?</p>\n"}, {"tags": ["sorting", "go"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 4, "last_activity_date": 1469511318, "last_edit_date": 1469511318, "creation_date": 1469509710, "answer_id": 38581411, "question_id": 38581277, "link": "https://stackoverflow.com/questions/38581277/golang-how-to-sort-slices-by-days-of-the-week/38581411#38581411", "title": "Golang: How to sort slices by days of the week?", "body": "<p>You can create a map keying days to their relative order. Then you can have a type implement <code>sort.Interface</code> interface:</p>\n\n<pre><code>type Days []string\n\n// map to store weekdays' relative order\nvar days = map[string]int{\n    \"M\":  1,\n    \"T\":  2,\n    \"W\":  3,\n    \"Th\": 4,\n    \"F\":  5,\n    \"S\":  6,\n    \"Su\": 7,\n}\n\nfunc (d Days) Len() int      { return len(d) }\nfunc (d Days) Swap(i, j int) { d[i], d[j] = d[j], d[i] }\nfunc (d Days) Less(i, j int) bool {\n    return days[d[i]] &lt; days[d[j]]\n}\n\nfunc main() {\n    ds := Days([]string{\"M\", \"Th\", \"W\", \"F\", \"T\", \"S\", \"Su\"})\n\n    sort.Sort(ds)\n    fmt.Println(ds)\n}\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/lzdfI-1BJK\" rel=\"nofollow\">https://play.golang.org/p/lzdfI-1BJK</a></p>\n\n<p>If you want you can move <code>days</code> in <code>Less</code> method to avoid globals. But that would be severely inefficient since the map will be initialized for each element of <code>Days</code>.</p>\n\n<p>Another implementation would be to have a pre-declared slice with the days in correct order and then use <code>strings.Index</code> in <code>Less</code>. This would perform slower but since your slice is of fixed length and very small (only 7 elements), it shouldn't be much of an issue.</p>\n"}, {"tags": [], "owner": {"reputation": 2595, "user_id": 177467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0360b3193f9ae92cbb560446463a4752?s=128&d=identicon&r=PG", "display_name": "Paddy", "link": "https://stackoverflow.com/users/177467/paddy"}, "is_accepted": false, "score": 1, "last_activity_date": 1469509916, "creation_date": 1469509916, "answer_id": 38581454, "question_id": 38581277, "link": "https://stackoverflow.com/questions/38581277/golang-how-to-sort-slices-by-days-of-the-week/38581454#38581454", "title": "Golang: How to sort slices by days of the week?", "body": "<p>You want the <a href=\"https://golang.org/pkg/sort#Interface\" rel=\"nofollow\"><code>sort.Interface</code></a>, which lets you use <code>sort.Sort</code>. The tricky part of this is to define the <code>Less</code> method, which needs to return true if one day should be considered to come before another day. I <a href=\"https://play.golang.org/p/9US-12_QLy\" rel=\"nofollow\">chose to do this</a> by testing the relationship of the days to each other semantically, but you could also do this by assigning each day an <code>int</code> that represents its position in the week.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype Days []string\n\nfunc (d Days) Len() int {\n    return len(d)\n}\n\nfunc (d Days) Swap(i, j int) {\n    d[i], d[j] = d[j], d[i]\n}\n\nfunc (d Days) Less(i, j int) bool {\n    switch d[i] {\n        case \"M\":\n            return true\n        case \"T\":\n            return d[j] != \"M\"\n        case \"W\":\n            return d[j] != \"M\" &amp;&amp; d[j] != \"T\"\n        case \"Th\":\n            return d[j] != \"M\" &amp;&amp; d[j] != \"T\" &amp;&amp; d[j] != \"W\"\n        case \"F\":\n            return d[j] == \"S\" || d[j] == \"Su\"\n        case \"S\":\n            return d[j] == \"Su\"\n        default:\n            return false\n    }\n}\n\nfunc main() {\n    days := []string{\"M\", \"Th\", \"W\", \"F\", \"T\", \"S\", \"Su\"}\n    sort.Sort(Days(days))\n    fmt.Println(days)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5788707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25c8f87214554e08da3d6d0300180469?s=128&d=identicon&r=PG&f=1", "display_name": "suhas", "link": "https://stackoverflow.com/users/5788707/suhas"}, "is_accepted": false, "score": -2, "last_activity_date": 1469514286, "creation_date": 1469514286, "answer_id": 38582412, "question_id": 38581277, "link": "https://stackoverflow.com/questions/38581277/golang-how-to-sort-slices-by-days-of-the-week/38582412#38582412", "title": "Golang: How to sort slices by days of the week?", "body": "<pre><code>public static void main(String[] args) {\n        String[] arr = new String[] { \"M\", \"Th\", \"W\", \"F\", \"T\", \"S\", \"Su\" };\n        // [M T W Th F S Su]\n        String[] arr1 = new String[] { \"M\", \"T\", \"W\", \"Th\", \"F\", \"S\", \"Su\" };\n\n        LinkedHashSet&lt;String&gt; h = new LinkedHashSet&lt;String&gt;();\n\n        for (int i = 0; i &lt; arr.length; i++) {\n            for (int j = 0; j &lt; arr1.length; j++) {\n                if (arr[i].equals(arr1[j])) {\n                    h.add(arr[i]);\n\n                } else {\n                    arr[i] = arr1[j];\n                    h.add(arr[i]);\n                }\n\n            }\n\n        }\n\n        System.out.println(\"arr = \" + h);\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1479428833, "last_edit_date": 1495541237, "creation_date": 1479428833, "answer_id": 40667466, "question_id": 38581277, "link": "https://stackoverflow.com/questions/38581277/golang-how-to-sort-slices-by-days-of-the-week/40667466#40667466", "title": "Golang: How to sort slices by days of the week?", "body": "<p>With Go 1.8 (Q1 2017) and the <a href=\"https://go-review.googlesource.com/#/c/27321/14/src/sort/sort.go\" rel=\"nofollow noreferrer\">new <code>sort.go</code></a> implementing <code>sort.Slice()</code>, <a href=\"https://stackoverflow.com/users/177467/paddy-foran\">Paddy Foran</a>'s <a href=\"https://stackoverflow.com/a/38581454/6309\">answer</a> would become:</p>\n\n<pre><code>days := []string{\"M\", \"Th\", \"W\", \"F\", \"T\", \"S\", \"Su\"}\nsort.Slice(days,  func(i, j int) bool { return less(days[i], days[j] })\n</code></pre>\n\n<p><code>less()</code> being a func taking two strings (first letter of two days) and comparing them.</p>\n\n<p>No need for <code>Swap()</code> or <code>Len()</code> anymore (done by reflection in the new sort implementation)</p>\n"}], "owner": {"reputation": 5185, "user_id": 2180770, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/i1yKC.jpg?s=128&g=1", "display_name": "Melvin", "link": "https://stackoverflow.com/users/2180770/melvin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 1, "accepted_answer_id": 38581411, "answer_count": 4, "score": 2, "last_activity_date": 1479428833, "creation_date": 1469509009, "question_id": 38581277, "link": "https://stackoverflow.com/questions/38581277/golang-how-to-sort-slices-by-days-of-the-week", "title": "Golang: How to sort slices by days of the week?", "body": "<p>I have a slice of strings which contains the days of the week like this:</p>\n\n<pre><code>days := []string{\"M\", \"Th\", \"W\", \"F\", \"T\", \"S\", \"Su\"}\n</code></pre>\n\n<p>How do I sort them so it will output like this:</p>\n\n<pre><code>[M T W Th F S Su]\n</code></pre>\n\n<p>starting with Monday.</p>\n"}, {"tags": ["go", "cryptography", "rsa", "ssh-keys"], "answers": [{"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 3, "last_activity_date": 1469532350, "creation_date": 1469532350, "answer_id": 38588613, "question_id": 38579982, "link": "https://stackoverflow.com/questions/38579982/converting-rsa-publickey-to-ssh-publickey/38588613#38588613", "title": "Converting rsa.PublicKey to ssh.PublicKey", "body": "<p>The <code>NewPublicKey</code> function  from the crypto/ssh package <a href=\"http://godoc.org/golang.org/x/crypto/ssh#NewPublicKey\" rel=\"nofollow\">http://godoc.org/golang.org/x/crypto/ssh#NewPublicKey</a> can take an <code>*rsa.PublicKey</code> as parameter and returns an instance of the <code>PublicKey</code> interface that includes a <code>Verify</code> method (<code>Verify(data []byte, sig *Signature) error</code>) - <a href=\"http://godoc.org/golang.org/x/crypto/ssh#PublicKey\" rel=\"nofollow\">http://godoc.org/golang.org/x/crypto/ssh#PublicKey</a>. </p>\n\n<p>The program below illustrates it - we create a new *rsa.PrivateKey and sign a message with it, then convert <code>*rsa.PublicKey</code> to <code>ssh.PublicKey</code> using <code>NewPublicKey</code> function and verify the signature; also check that the signature verification fails if the original data is modified.  The error checking is elided for brevity.</p>\n\n<pre>\npackage main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"fmt\"\n    \"log\"\n\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc main() {\n    data := []byte(\"Hello, world!\")\n\n    // create a new key as *rsa.PrivateKey\n    priv, _ := rsa.GenerateKey(rand.Reader, 512)\n    signer, _ := ssh.NewSignerFromKey(priv)\n    sig, _ := signer.Sign(rand.Reader, data)\n\n    // extract the ssh.PublicKey from *rsa.PublicKey to verify the signature\n    pub, _ := ssh.NewPublicKey(&priv.PublicKey)\n    if err := pub.Verify(data, sig); err != nil {\n        log.Fatalf(\"publicKey.Verify failed: %v\", err)\n    }\n    fmt.Printf(\"Signature OK\\n\")\n    // modify the data and make sure we get a failure\n    data[0]++\n    if err := pub.Verify(data, sig); err == nil {\n        log.Printf(\"publicKey.Verify passed on bad data/signature, expect failure\")\n    }\n}\n</pre>\n\n<p>Output:</p>\n\n<pre>\nSignature OK\n</pre>\n"}], "owner": {"reputation": 6583, "user_id": 931721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7890aab3c851571d48e6c4f7459f187f?s=128&d=identicon&r=PG&f=1", "display_name": "Jakob Weisblat", "link": "https://stackoverflow.com/users/931721/jakob-weisblat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1002, "favorite_count": 0, "accepted_answer_id": 38588613, "answer_count": 1, "score": 4, "last_activity_date": 1586280998, "creation_date": 1469498522, "question_id": 38579982, "link": "https://stackoverflow.com/questions/38579982/converting-rsa-publickey-to-ssh-publickey", "title": "Converting rsa.PublicKey to ssh.PublicKey", "body": "<p>I have an <code>rsa.PublicKey</code> which consists of a modulus and a public exponenet in a struct. I want to verify an <code>ssh.Signature</code> which is signed with that key, and I figure if I have an <code>ssh.PublicKey</code> I can call the <code>Verify</code> method on that interface. However, I can't find any classes that implement <code>ssh.PublicKey</code> and support converting from <code>rsa.PublicKey</code>. Do I need to write a proprietary method to do this, or is there some class I'm not finding, or a better way to go about solving my problem?</p>\n\n<p>For context, I got the <code>rsa.PublicKey</code> from an <code>x509.Certificate</code> which came from a yubikey attesting a key in one of its PIV slots.</p>\n"}, {"tags": ["go", "maps", "slice"], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 7148629, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBjEl.gif?s=128&g=1", "display_name": "dropbeardan", "link": "https://stackoverflow.com/users/7148629/dropbeardan"}, "edited": false, "score": 6, "creation_date": 1536967435, "post_id": 38579502, "comment_id": 91627652, "body": "I feel like we should make a standard library for some of these data structure helpers"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 26, "last_activity_date": 1549903134, "last_edit_date": 1549903134, "creation_date": 1469494128, "answer_id": 38579502, "question_id": 38579485, "link": "https://stackoverflow.com/questions/38579485/golang-convert-slices-into-map/38579502#38579502", "title": "Golang: convert slices into map", "body": "<p>Use a for loop:</p>\n\n<pre><code>elements = []string{\"abc\", \"def\", \"fgi\", \"adi\"}\nelementMap := make(map[string]string)\nfor i := 0; i &lt; len(elements); i +=2 {\n    elementMap[elements[i]] = elements[i+1]\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/DuJfF_wPMV\" rel=\"noreferrer\">runnable example on the playground</a></kbd></p>\n\n<p>The standard library does not have a function to do this.</p>\n"}, {"tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": false, "score": 6, "last_activity_date": 1497871008, "creation_date": 1497871008, "answer_id": 44629145, "question_id": 38579485, "link": "https://stackoverflow.com/questions/38579485/golang-convert-slices-into-map/44629145#44629145", "title": "Golang: convert slices into map", "body": "<p>There is currently no way to do it the perl way. You just have to iterate the slice, and place the slice elements in your map, e.g. as the map's key:</p>\n\n<pre><code>func main() {\n    var elements []string\n    var elementMap map[string]string\n    elements = []string{\"abc\", \"def\", \"fgi\", \"adi\"}\n\n    // initialize map\n    elementMap = make(map[string]string)\n\n    // put slice values into map\n    for _, s := range elements {  \n        elementMap[s] = s\n        // or just keys, without values: elementMap[s] = \"\"\n    }\n\n    // print map\n    for k := range elementMap {\n        fmt.Println(k)\n    }\n}\n</code></pre>\n\n<p>Depending on what you want to do, you have to keep one thing in mind: map keys are unique, so if your slice contains duplicate strings you might want to keep count by using a <code>map[string]int</code>:</p>\n\n<pre><code>func main() {\n    var elements []string\n    var elementMap map[string]int\n    elements = []string{\"abc\", \"def\", \"fgi\", \"adi\", \"fgi\", \"adi\"}\n\n    // initialize map\n    elementMap = make(map[string]int)\n\n    // increment map's value for every key from slice\n    for _, s := range elements {  \n        elementMap[s]++\n    }\n\n    // print map\n    for k, v := range elementMap {\n        fmt.Println(k, v)\n    }\n}\n</code></pre>\n\n<p>And you can always wrap that functionality in a func:</p>\n\n<pre><code>func sliceToStrMap(elements []string) map[string]string {\n    elementMap := make(map[string]string)\n    for _, s := range elements {\n        elementMap[s] = s\n    }\n    return elementMap\n}\n\nfunc sliceToIntMap(elements []string) map[string]int {\n    elementMap := make(map[string]int)\n    for _, s := range elements {\n        elementMap[s]++\n    }\n    return elementMap\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2612, "user_id": 2273578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/211dd1a8e9f61b248fba83b9924f4f13?s=128&d=identicon&r=PG", "display_name": "Mario P&#233;rez", "link": "https://stackoverflow.com/users/2273578/mario-p%c3%a9rez"}, "is_accepted": false, "score": 2, "last_activity_date": 1573129425, "creation_date": 1573129425, "answer_id": 58748724, "question_id": 38579485, "link": "https://stackoverflow.com/questions/38579485/golang-convert-slices-into-map/58748724#58748724", "title": "Golang: convert slices into map", "body": "<p>If looking for a library you can use <a href=\"https://github.com/thoas/go-funk\" rel=\"nofollow noreferrer\">go-funk</a>. This code may be less performant and not idiomatic in Go until we have Generics. </p>\n\n<pre><code>var elements = []string{\"abc\", \"def\", \"fgi\", \"adi\"}\n\nelementsMap := funk.Map(\n    funk.Chunk(elements, 2),\n    func(x []string) (string, string) { // Slice to Map\n        return x[0], x[1]\n    },\n)\n\nfmt.Println(elementsMap) // map[abc:def fgi:adi]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-t-33z4aKM_j\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-t-33z4aKM_j</a></p>\n"}, {"tags": [], "owner": {"reputation": 599, "user_id": 1129296, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/ca998718121eff31bbdd806042e03ca6?s=128&d=identicon&r=PG", "display_name": "ULLAS K", "link": "https://stackoverflow.com/users/1129296/ullas-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1597046771, "creation_date": 1597046771, "answer_id": 63336356, "question_id": 38579485, "link": "https://stackoverflow.com/questions/38579485/golang-convert-slices-into-map/63336356#63336356", "title": "Golang: convert slices into map", "body": "<p>Try with range</p>\n<pre><code>elements := []string{&quot;abc&quot;, &quot;def&quot;, &quot;fgi&quot;, &quot;adi&quot;}\n    elementMap := make(map[int]string)\n    for i, data := range elements  {\n             elementMap[i] = data\n        }\n\nfmt.Println(elementMap ) // map[0:abc 1:def 2:fgi 3:adi]\n</code></pre>\n<p><a href=\"https://play.golang.org/p/h6uZn5obLKg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h6uZn5obLKg</a></p>\n"}], "owner": {"reputation": 436, "user_id": 309812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4635a06e7bf8c43e70f016441185392?s=128&d=identicon&r=PG", "display_name": "Nikhil Mulley", "link": "https://stackoverflow.com/users/309812/nikhil-mulley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37258, "favorite_count": 1, "answer_count": 4, "score": 24, "last_activity_date": 1597046771, "creation_date": 1469493979, "last_edit_date": 1470223659, "question_id": 38579485, "link": "https://stackoverflow.com/questions/38579485/golang-convert-slices-into-map", "title": "Golang: convert slices into map", "body": "<p>Is there an easy/simple means of converting a slice into a map in Golang? Like converting an array into hash in perl is easy to do with simple assignment like <code>%hash = @array</code>\nthis above will convert all the elements in the array into a hash, with keys being even-numbered index elements while the values will be odd-numbered index elements of the array.</p>\n\n<p>In my Go code, I have slices of string and would like to convert it into a map. I am wondering if there is a Go's library code to do this.</p>\n\n<pre><code>func main() {\n  var elements []string\n  var elementMap map[string]string\n  elements = []string{\"abc\", \"def\", \"fgi\", \"adi\"}\n}\n</code></pre>\n\n<p>elements slice should be converted into map of strings, <code>elementMap</code>.</p>\n\n<p>thanks</p>\n"}, {"tags": ["json", "parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1469487966, "post_id": 38578709, "comment_id": 64546502, "body": "He&#39;s just missing a tag. Changing his data type to something dynamic isn&#39;t a good solution to that problem."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1469488032, "post_id": 38578709, "comment_id": 64546517, "body": "@evanmcdonnal I&#39;m not sure what makes you think that. The default JSON tag for <code>Result</code> is <code>result</code> already. Adding a tag shouldn&#39;t (and doesn&#39;t when I just tried it) make a difference."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1469488161, "post_id": 38578709, "comment_id": 64546552, "body": "yeah you&#39;re right, that works fine and my code was wrong, didn&#39;t read the post closely enough. Result needs to be a dictionary because the objects have keys. He could do something like what I have but it doesn&#39;t really make sense imo (the three inner structs would also need tags and I bet their names change from one response to another)."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1469488246, "post_id": 38578709, "comment_id": 64546580, "body": "@evanmcdonnal Yeah, I added an alternative that shows that approach, but as you said, it&#39;s probably not the right thing."}, {"owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "edited": false, "score": 0, "creation_date": 1469489996, "post_id": 38578709, "comment_id": 64547044, "body": "Thanks. I could not figure out where the tags for the inner structs should go,  I put them after <code>struct</code> but that did not work. However, I like the first example much better as this is more compact and will also work when name of inner structs change."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "edited": false, "score": 0, "creation_date": 1469490610, "post_id": 38578709, "comment_id": 64547187, "body": "@JohnSmith if you&#39;re defining nested objects inline like that, you put the tag after the closing brace; <code>}</code>"}], "tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": true, "score": 1, "last_activity_date": 1469488220, "last_edit_date": 1469488220, "creation_date": 1469487931, "answer_id": 38578709, "question_id": 38578656, "link": "https://stackoverflow.com/questions/38578656/parse-nested-json-into-struct/38578709#38578709", "title": "Parse nested JSON into struct?", "body": "<p>The <code>result</code> part of the JSON is a dictionary mapping strings to objects. Try this instead (<a href=\"https://play.golang.org/p/BCNHw-OH2I\" rel=\"nofollow\">https://play.golang.org/p/BCNHw-OH2I</a>):</p>\n\n<pre><code>type VoteResult struct {\n    Total  int `json:\"total\"`\n    Result map[string]struct {\n        Percent float64 `json:\"percent\"`\n        Count   int     `json:\"count\"`\n    }\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>As an alternative, if those strings are truly fixed, you could do this:</p>\n\n<pre><code>type VoteResult struct {\n    Total  int `json:\"total\"`\n    Result struct {\n        Efid1 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        } `json:\"6581\"`\n        Efid2 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        } `json:\"6591\"`\n        Efid3 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        } `json:\"6601\"`\n    }\n}\n</code></pre>\n\n<p>Here we've just decided that <code>Efid1</code> has the JSON key <code>6591</code>, etc. But I suspect a map of strings to structs is a better fit for the data structure you have.</p>\n"}], "owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 38578709, "answer_count": 1, "score": 1, "last_activity_date": 1469488220, "creation_date": 1469487606, "question_id": 38578656, "link": "https://stackoverflow.com/questions/38578656/parse-nested-json-into-struct", "title": "Parse nested JSON into struct?", "body": "<p>I want to parse the following JSON output:</p>\n\n<pre><code>{\n    \"total\":5689,\n    \"result\":{\n        \"6581\":{\n            \"percent\":37.79,\n            \"count\":2150\n        },\n        \"6591\":{\n            \"percent\":35.31,\n            \"count\":2009\n        },\n        \"6601\":{\n            \"percent\":26.89,\n            \"count\":1530\n        }\n    }\n}\n</code></pre>\n\n<p>I have read that JSON can be parsed into a struct if the format is known:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype VoteResult struct {\n    Total  int `json:\"total\"`\n    Result struct {\n        Efid1 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        }\n        Efid2 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        }\n        Efid3 struct {\n            Percent float64 `json:\"percent\"`\n            Count   int     `json:\"count\"`\n        }\n    }\n}\n\nfunc main() {\n    b := []byte(`{\"total\":5689,\"result\":{\"6581\":{\"percent\":37.79,\"count\":2150}\n    ,\"6591\":{\"percent\":35.31,\"count\":2009},\"6601\":{\"percent\":26.89,\"count\":1530}}}`)\n\n    var v VoteResult\n\n    err := json.Unmarshal(b, &amp;v)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"%v\\n\", err)\n        os.Exit(1)\n    }\n\n    fmt.Println(v)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/gxnNIsSXBi\" rel=\"nofollow\">Go Playground</a></p>\n\n<p>This is the output, but something is wrong as the nested structs are not filled with data:</p>\n\n<p><code>{5689 {{0 0} {0 0} {0 0}}}</code></p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469470640, "post_id": 38574672, "comment_id": 64538651, "body": "What do you mean by &quot;efficient&quot;? Do you want to skip the copy done by <code>C.CString</code>?"}, {"owner": {"reputation": 113, "user_id": 6406168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/28dd9fe5587c7b329b09858e1baf498f?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/6406168/steve"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469470982, "post_id": 38574672, "comment_id": 64538861, "body": "Maybe I worded it incorrectly. When I have a string <code>str</code> whose length is around <code>uint32 &#47; 4</code> characters long, copying takes a significant amount of time. is this expected? If I don&#39;t want to do <code>C.CString</code> I&#39;m assuming I would have to do that conversion using <code>cgo</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469472207, "post_id": 38574672, "comment_id": 64539506, "body": "Copying bytes, takes time. The only way to fix that is no not copy the bytes. I&quot;m not sure what you mean by &quot;do the conversion using <code>cgo</code>&quot;, <code>C.CString</code> is a <code>cgo</code> function."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469472231, "post_id": 38574672, "comment_id": 64539517, "body": "C.Cstring allocates a *char and copies the argument into that newly allocated array. If you don&#39;t want to allocate an unnecessary string in Go, or if you don&#39;t need the copy, then alloc the memory in C. I can&#39;t be much more specific without any example to go by."}], "owner": {"reputation": 113, "user_id": 6406168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/28dd9fe5587c7b329b09858e1baf498f?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/6406168/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 734, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1469478347, "creation_date": 1469470141, "last_edit_date": 1469478347, "question_id": 38574672, "link": "https://stackoverflow.com/questions/38574672/converting-go-string-to-c-string", "title": "converting go string to c string", "body": "<p>In a program, I have a function that takes in a string argument, and returns a string in which <code>len(resultString)</code> could potentially be <code>4 * len(argumentString)</code>. This is because I am using <code>Cgo</code> with a C-file that I have imported into my project, and this C function requires a <code>char *</code> that is 4 times the original length of a string. </p>\n\n<p>Is there an 'efficient' way of initializing and converting a go string to a C string? Because right now I am initializing a byte array in Go, and then <code>string</code>ing that, and then calling <code>C.CString</code> on that string. This ultimately is causing some performance issues if the length of the string is large enough. Thanks!</p>\n"}, {"tags": ["templates", "go", "consul", "consul-template"], "answers": [{"tags": [], "owner": {"reputation": 3258, "user_id": 2058014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a12b9d9a9cd413b4ddccd046428f72c?s=128&d=identicon&r=PG&f=1", "display_name": "Brrrr", "link": "https://stackoverflow.com/users/2058014/brrrr"}, "is_accepted": false, "score": 0, "last_activity_date": 1469517283, "creation_date": 1469517283, "answer_id": 38583351, "question_id": 38574399, "link": "https://stackoverflow.com/questions/38574399/how-to-concatenate-service-metadata-for-consul-template-with-commas/38583351#38583351", "title": "How to concatenate Service metadata for consul-template with commas", "body": "<p>You can use a custom plugin. </p>\n\n<pre><code>servers={{service \"foo\" | toJSON | plugin \"path/to/plugin\"}}\n</code></pre>\n\n<p>The plugin code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype InputEntry struct {\n    Node    string\n    Address string\n    Port    int\n}\n\nfunc main() {\n    arg := []byte(os.Args[1])\n    var input []InputEntry\n    if err := json.Unmarshal(arg, &amp;input); err != nil {\n        fmt.Fprintln(os.Stderr, fmt.Sprintf(\"err: %s\", err))\n        os.Exit(1)\n    }\n\n    var output string\n    for i, entry := range input {\n        output += fmt.Sprintf(\"%v:%v\", entry.Address, entry.Port)\n        if i != len(input)-1 {\n            output += \",\"\n        }\n    }\n\n    fmt.Fprintln(os.Stdout, string(output))\n    os.Exit(0)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1502, "user_id": 5927773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZnTbl.jpg?s=128&g=1", "display_name": "Frank Wong", "link": "https://stackoverflow.com/users/5927773/frank-wong"}, "is_accepted": false, "score": 3, "last_activity_date": 1488784540, "creation_date": 1488784540, "answer_id": 42619637, "question_id": 38574399, "link": "https://stackoverflow.com/questions/38574399/how-to-concatenate-service-metadata-for-consul-template-with-commas/42619637#42619637", "title": "How to concatenate Service metadata for consul-template with commas", "body": "<p>This should work.</p>\n\n<pre><code>{{$foo_srv := service \"foo\"}}\n{{if $foo_srv}}\n  {{$last := len $foo_srv | subtract 1}}\nservers=\n  {{- range $i := loop $last}}\n    {{- with index $foo_srv $i}}{{.Address}}{{.Port}},{{end}}\n  {{- end}}\n  {{- with index $foo_srv last}}{{.Address}}{{.Port}}{{end}}/bogus\n{{end}}\n</code></pre>\n\n<p>I was thinking if \"join\" can be used.</p>\n\n<p>Note \"{{-\" means removing leading white spaces (such ' ', \\t, \\n).</p>\n"}], "owner": {"reputation": 1501, "user_id": 706837, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/70156efee76a8bfdba06e83857bf370e?s=128&d=identicon&r=PG", "display_name": "Jose Leon", "link": "https://stackoverflow.com/users/706837/jose-leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1714, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1552580627, "creation_date": 1469469161, "question_id": 38574399, "link": "https://stackoverflow.com/questions/38574399/how-to-concatenate-service-metadata-for-consul-template-with-commas", "title": "How to concatenate Service metadata for consul-template with commas", "body": "<p>Does anyone know how to concatenate strings from consul for consul-template? </p>\n\n<p>If I have a service 'foo' registered in Consul</p>\n\n<pre><code>{\n  \"Node\": \"node1\",\n  \"Address\": \"192.168.0.1\",\n  \"Port\": 3333\n},\n{\n  \"Node\": \"node2\",\n  \"Address\": \"192.168.0.2\",\n  \"Port\": 4444\n}\n</code></pre>\n\n<p>I would like consul-template to generate the following line:</p>\n\n<pre><code>servers=192.168.0.1:3333,192.168.0.2:4444/bogus\n</code></pre>\n\n<p>The following attempt does not work since it leaves a trailing comma <code>,</code></p>\n\n<pre><code>servers={{range service \"foo\"}}{{.Address}}{{.Port}},{{end}}/bogus\n# renders\nservers=192.168.0.1:3333,192.168.0.2:4444,/bogus\n\n# What I actually want\nservers=192.168.0.1:3333,192.168.0.2:4444/bogus\n</code></pre>\n\n<p>I know consul-template uses golang template syntax, but I simply cannot figure out the syntax to get this working. Its likely that I should use consul-template's <code>join</code> but how do I pass both <code>.Address</code> and <code>.Port</code> to <code>join</code>? This is just a trivial example, and I'm not using indexes intentionally since the number of services could be more than two. Any ideas?</p>\n"}, {"tags": ["amazon-web-services", "github", "go", "amazon-s3", "runtime-error"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 1174612, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc0f69108ec2fb888755472d60e334e8?s=128&d=identicon&r=PG", "display_name": "hijaked79", "link": "https://stackoverflow.com/users/1174612/hijaked79"}, "edited": false, "score": 0, "creation_date": 1469634704, "post_id": 38576434, "comment_id": 64621469, "body": "Thanks for the reply.  I updated the GO Version and made sure to get the $GOPATH working along with sourcing the .bashrc file with the data I need, but it&#39;s still a no go.  Please see edit above in main post. @rking788"}], "tags": [], "owner": {"reputation": 381, "user_id": 1148266, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/120ab1b6201bbab8beacf79b623e2604?s=128&d=identicon&r=PG", "display_name": "rking788", "link": "https://stackoverflow.com/users/1148266/rking788"}, "is_accepted": false, "score": 0, "last_activity_date": 1469476951, "creation_date": 1469476951, "answer_id": 38576434, "question_id": 38574129, "link": "https://stackoverflow.com/questions/38574129/go-script-runtime-error-for-amazon-aws-s3/38576434#38576434", "title": "GO script runtime error for Amazon AWS S3", "body": "<p>There seem to be a few things going on here. One thing to check is that you are actually sourcing your .bashrc file after you set the environment variables in there. You should be able to run the <code>env</code> command and see your AWS keys, S3 configuration, and graphite settings in your current shell.</p>\n\n<p>The second problem I see is that the library you are using hasn't been updated since last year. As far as I know the AWS SDK for Go has changed a lot in the past year. The \"panic:\" line in your application's output gives a hint at the problem. </p>\n\n<blockquote>\n  <p>panic: runtime error: invalid memory address or nil pointer dereference</p>\n</blockquote>\n\n<p>It seems like <code>nil</code> is being passed somewhere it is not supposed to be. Further down the panic output you can see the stacktrace for goroutine 1 says:</p>\n\n<pre><code>github.com/aws/aws-sdk-go/service/s3.New(0x0, 0x0, 0x0, 0x0, 0x0, 0x3f)\n    /home/ec2-user/work/src/github.com/aws/aws-sdk-go/service/s3/service.go:41 +0x76\nmain.NewS3(0x7ffc202bef6e, 0x1b, 0x7ffc202be684, 0x9, 0x1, 0x0, 0x0)\n    /home/ec2-user/work/src/github.com/adammck/s3-graphite/s3.go:20 +0x66\n</code></pre>\n\n<p>From this you can see that the NewS3 method is being called on line 20 of the s3.go file in the s3-graphite library. Then it goes to the aws-sdk-go library and tries to create a new S3 client. With the following arguments:</p>\n\n<blockquote>\n  <p>s3.New(0x0, 0x0, 0x0, 0x0, 0x0, 0x3f)</p>\n</blockquote>\n\n<p>My best guy is that your configuration is not exported to the environment you are running the executable in, or the s3-graphite library needs to be updated to work with the latest aws-sdk-go version.</p>\n"}], "owner": {"reputation": 55, "user_id": 1174612, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc0f69108ec2fb888755472d60e334e8?s=128&d=identicon&r=PG", "display_name": "hijaked79", "link": "https://stackoverflow.com/users/1174612/hijaked79"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1469634872, "creation_date": 1469468159, "last_edit_date": 1469634872, "question_id": 38574129, "link": "https://stackoverflow.com/questions/38574129/go-script-runtime-error-for-amazon-aws-s3", "title": "GO script runtime error for Amazon AWS S3", "body": "<p>I'm currently attempting to run the following Golang build for the first time on a Amazon Linux Distro:</p>\n\n<p><a href=\"https://github.com/adammck/s3-graphite\" rel=\"nofollow\">https://github.com/adammck/s3-graphite</a></p>\n\n<p>README Here:</p>\n\n<pre><code>go get github.com/adammck/s3-graphite\ncd $GOPATH/adammck/s3-graphite\ngo build\n</code></pre>\n\n<p>After this, I set my variables in my .bashrc file like below:</p>\n\n<pre><code># AWS keys with read access to the bucket\nexport AWS_ACCESS_KEY_ID=xxxxxxxxxx\nexport AWS_SECRET_ACCESS_KEY=yyyyyyyyyy\nexport AWS_REGION=us-east-1\n\n# the bucket to watch\nexport S3_BUCKET=my-bucket\nexport S3_PREFIX=dir/subdir\n\n# the server to send metrics to\nexport GRAPHITE_ADDRESS=metrics.example.com\nexport GRAPHITE_PREFIX=s3-count.my-bucket.dir.subdir\n</code></pre>\n\n<p>I set my GOPATH to the following:</p>\n\n<pre><code>export GOPATH=\"$HOME/work/\"\n</code></pre>\n\n<p>I cd into the dir to run a go build which works like it should, but when I go to run the following after the go build:</p>\n\n<p>./s3-graphite</p>\n\n<p>I get the following error:</p>\n\n<pre><code>INFO[0000] Starting s3-graphite...\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x20 pc=0x4e3256]\n\ngoroutine 1 [running]:\ngithub.com/aws/aws-sdk-go/service/s3.New(0x0, 0x0, 0x0, 0x0, 0x0, 0x3f)\n    /home/ec2-user/work/src/github.com/aws/aws-sdk-go/service/s3/service.go:41 +0x76\nmain.NewS3(0x7ffc202bef6e, 0x1b, 0x7ffc202be684, 0x9, 0x1, 0x0, 0x0)\n    /home/ec2-user/work/src/github.com/adammck/s3-graphite/s3.go:20 +0x66\nmain.main()\n    /home/ec2-user/work/src/github.com/adammck/s3-graphite/main.go:19 +0x21c\n\ngoroutine 2 [runnable]:\nruntime.forcegchelper()\n    /usr/lib/golang/src/runtime/proc.go:90\nruntime.goexit()\n    /usr/lib/golang/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 3 [runnable]:\nruntime.bgsweep()\n    /usr/lib/golang/src/runtime/mgc0.go:82\nruntime.goexit()\n    /usr/lib/golang/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 4 [runnable]:\nruntime.runfinq()\n    /usr/lib/golang/src/runtime/malloc.go:712\nruntime.goexit()\n    /usr/lib/golang/src/runtime/asm_amd64.s:2232 +0x1\n</code></pre>\n\n<p>Here is my GOPATH:</p>\n\n<pre><code>$GOPATH\n-bash: /home/ec2-user/work/: Is a directory\n</code></pre>\n\n<p>Here is my dir where I execute the s3-graphite:</p>\n\n<pre><code>/home/ec2-user/work/src/github.com/adammck/s3-graphite\n</code></pre>\n\n<p>EDIT (updated with items from your answer:</p>\n\n<pre><code>[ec2-user@s3-graphite]$ go version\ngo version go1.6.3 linux/amd64\n[ec2-user@ s3-graphite]$ $GOPATH\n-bash: /home/ec2-user/work: Is a directory\n[ec2-user@ s3-graphite]$ pwd\n/home/ec2-user/work/src/github.com/adammck/s3-graphite\n[ec2-user@ s3-graphite]$ ./s3-graphite\nINFO[0000] Starting s3-graphite...\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x20 pc=0x512aa2]\n\ngoroutine 1 [running]:\npanic(0x873120, 0xc82000a0e0)\n    /usr/local/go/src/runtime/panic.go:481 +0x3e6\ngithub.com/aws/aws-sdk-go/service/s3.New(0x0, 0x0, 0x0, 0x0, 0x0, 0x3f)\n    /home/ec2-user/work/src/github.com/aws/aws-sdk-go/service/s3/service.go:41 +0x72\nmain.NewS3(0xc82001603a, 0x1b, 0xc82000e06a, 0x9, 0x1, 0x0, 0x0)\n    /home/ec2-user/work/src/github.com/adammck/s3-graphite/s3.go:20 +0x4a\nmain.main()\n    /home/ec2-user/work/src/github.com/adammck/s3-graphite/main.go:19 +0x229\n[ec2-user@ s3-graphite]$\n</code></pre>\n"}, {"tags": ["go", "append", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1469467738, "post_id": 38573983, "comment_id": 64537111, "body": "Are you running the same version as the tour server? How <code>append</code> extends capacity isn&#39;t defined by the language spec, and the implementation can change."}, {"owner": {"reputation": 468, "user_id": 3429037, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/8d8ed0a025f0928b411b1a1b36abd23f?s=128&d=identicon&r=PG", "display_name": "Maksat Yalkabov", "link": "https://stackoverflow.com/users/3429037/maksat-yalkabov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469468089, "post_id": 38573983, "comment_id": 64537304, "body": "Hmm I figured out this when I append items to the slice in the way that dont get over old slice capacity capacity does not change but when it gets over capacity it rearranges the slice."}, {"owner": {"reputation": 6693, "user_id": 4180674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/95bQJ.jpg?s=128&g=1", "display_name": "Girish Sortur", "link": "https://stackoverflow.com/users/4180674/girish-sortur"}, "edited": false, "score": 1, "creation_date": 1469473059, "post_id": 38573983, "comment_id": 64539987, "body": "Well I would say, go tries to increase your capacity a little more than your length value if length, and when you cross the capacity max limit, by appending a new value, it adds multiples of 2 to the capacity value, and so it always ends with an even number to make sure to reduce operation of copies. This is with go version 1.6"}], "answers": [{"comments": [{"owner": {"reputation": 585, "user_id": 603694, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d2a5cf52980415ae71831a30e53ca2c9?s=128&d=identicon&r=PG", "display_name": "GregL83", "link": "https://stackoverflow.com/users/603694/gregl83"}, "edited": false, "score": 0, "creation_date": 1491755783, "post_id": 38575300, "comment_id": 73683018, "body": "good explanation but i think the question is more focused on why one would get a different result on their local machine then the same code running in the tour playground.  golang version issue???"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "reply_to_user": {"reputation": 585, "user_id": 603694, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d2a5cf52980415ae71831a30e53ca2c9?s=128&d=identicon&r=PG", "display_name": "GregL83", "link": "https://stackoverflow.com/users/603694/gregl83"}, "edited": false, "score": 1, "creation_date": 1491775039, "post_id": 38575300, "comment_id": 73689596, "body": "See the first paragraph of my answer; this could change for many reasons. I&#39;m not sure that the specific reason matters, but you could always test it against the playground, and the same version locally to narrow it down. (FWIW I see this same behavior right now when I swap back to 1.8 which is what the playground is running, so it&#39;s not the version)."}, {"owner": {"reputation": 1062, "user_id": 1235165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3678a00749a25d0ec2501ef174d92569?s=128&d=identicon&r=PG", "display_name": "hmijail mourns resignees", "link": "https://stackoverflow.com/users/1235165/hmijail-mourns-resignees"}, "edited": false, "score": 0, "creation_date": 1602470428, "post_id": 38575300, "comment_id": 113721028, "body": "As for &quot;why&quot; - I would <i>imagine</i> that an implementation might grow the capacity liberally when it&#39;s convenient to do so (like the case of a small initial slice that fits in the cache), while it could be much more conservative in other cases (little memory left)"}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 14, "last_activity_date": 1469472392, "last_edit_date": 1495541424, "creation_date": 1469472392, "answer_id": 38575300, "question_id": 38573983, "link": "https://stackoverflow.com/questions/38573983/capacity-of-slices-in-go/38575300#38575300", "title": "Capacity of slices in Go", "body": "<p>This question isn't an exact duplicate, but my answer <a href=\"https://stackoverflow.com/a/38548703/1087001\">here</a> also effectively answers this.</p>\n\n<p>TL;DR \u2014 how much the capacity of the slice is expanded by isn't mentioned in the specification and different versions of Go (or different implementations, or the same version on different architectures, etc.) can expand the slice by different amounts.</p>\n\n<p>The reason you might want to make the capacity larger than you need is because underneath the slice there is an array which is immutable (it can't be expanded). When you \"grow\" a slice what actually happens is that you make a new (longer) array, copy all the values over, and then set that as the backing array for the slice. If you were appending lots of values, you'd have to do lots and lots of copies (one for every single value), which would be very slow, so instead the runtime allocates more space than it thinks you need so that it has to make copies less often.</p>\n"}], "owner": {"reputation": 468, "user_id": 3429037, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/8d8ed0a025f0928b411b1a1b36abd23f?s=128&d=identicon&r=PG", "display_name": "Maksat Yalkabov", "link": "https://stackoverflow.com/users/3429037/maksat-yalkabov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3692, "favorite_count": 1, "answer_count": 1, "score": 12, "last_activity_date": 1469472392, "creation_date": 1469467587, "question_id": 38573983, "link": "https://stackoverflow.com/questions/38573983/capacity-of-slices-in-go", "title": "Capacity of slices in Go", "body": "<p>I have a question about the below code      </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var a []int\n    printSlice(\"a\", a)\n\n    // append works on nil slices.\n    a = append(a, 0)\n    printSlice(\"a\", a)\n\n    // the slice grows as needed.\n    a = append(a, 1)\n    printSlice(\"a\", a)\n\n    // we can add more than one element at a time.\n    a = append(a, 2, 3, 4)\n    printSlice(\"a\", a)\n}\n\nfunc printSlice(s string, x []int) {\n    fmt.Printf(\"%s len=%d cap=%d %v\\n\",\n    s, len(x), cap(x), x)\n}       \n</code></pre>\n\n<p>I always guess what the result of running a piece of code will look like then run the code and check if my guess is correct. But this code resulted a little bit different from my guess:     </p>\n\n<p><strong>Result:</strong><br>\n<strong><em>On my local go tour server:</em></strong>    </p>\n\n<pre><code>a len=0 cap=0 []\na len=1 cap=1 [0]\na len=2 cap=2 [0 1]\na len=5 cap=6 [0 1 2 3 4]      \n</code></pre>\n\n<p>Everything is ok until the last line but I don't get     </p>\n\n<pre><code>cap=6     \n</code></pre>\n\n<p>why not     </p>\n\n<pre><code>cap=5    \n</code></pre>\n\n<p>My opinion is I did not create slice with explicit capacity therefore my system gave it this value of <strong>6</strong>.    </p>\n\n<p><strong>2</strong>) But when I tried this same code on the golang tour server I get a little more diffferent result like this :     </p>\n\n<pre><code>a len=0 cap=0 []\na len=1 cap=2 [0]\na len=2 cap=2 [0 1]\na len=5 cap=8 [0 1 2 3 4]   \n</code></pre>\n\n<p>What about <strong>cap=2</strong> on the second line and <strong>cap=8</strong> on the last line?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469482954, "post_id": 38573176, "comment_id": 64544872, "body": "in what way are you trying to test <code>terminal.ReadPassword</code>? Are you trying to add a test to that package? That function can only work on a terminal, so if you don&#39;t have a terminal then don&#39;t use that function."}, {"owner": {"reputation": 4555, "user_id": 353463, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/66RN8.jpg?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/353463/luke"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469508966, "post_id": 38573176, "comment_id": 64551465, "body": "I wrote a library that uses that function. Was trying to create a test, mostly to ensure that I had full coverage, but its not 100% necessary.  I&#39;m using <code>bufio.Reader</code> for regular input and I can modify the file to handle that test case, but <code>terminal.ReadPassword</code> doesn&#39;t seem to work the same way.  Library is here (not meant to be a plug) in case you have suggestions: <a href=\"https://github.com/goposse/tardy\" rel=\"nofollow noreferrer\">github.com/goposse/tardy</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469538371, "post_id": 38573176, "comment_id": 64569681, "body": "You just need to make using ReadPassword conditional on having a tty. You could do that by wrapping it in another function, mocking out a PasswordReader as Corbin suggested, or just adding another condition to the if statement to check IsTerminal."}], "answers": [{"comments": [{"owner": {"reputation": 4555, "user_id": 353463, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/66RN8.jpg?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/353463/luke"}, "edited": false, "score": 0, "creation_date": 1469556672, "post_id": 38583077, "comment_id": 64581974, "body": "Make sense and actually this helps to tidy up that part of the code also. Thanks for the suggestion!"}], "tags": [], "owner": {"reputation": 122, "user_id": 4241670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/329e413106cac2bb6d6a281b40f8b8d3?s=128&d=identicon&r=PG&f=1", "display_name": "Corbin", "link": "https://stackoverflow.com/users/4241670/corbin"}, "is_accepted": true, "score": 4, "last_activity_date": 1469516459, "creation_date": 1469516459, "answer_id": 38583077, "question_id": 38573176, "link": "https://stackoverflow.com/questions/38573176/mocking-crypto-ssh-terminal/38583077#38583077", "title": "Mocking crypto/ssh/terminal", "body": "<p>If you are stubbing this test by creating a fake file that <code>os.Stdin</code> is referencing, your tests will become tremendously OS specific when you try to handle <code>ReadPassword()</code>. This is because under the hood Go is compiling separate syscalls depending on the OS. <code>ReadPassword()</code> is implemented <a href=\"https://github.com/golang/crypto/blob/911fafb28f4ee7c7bd483539a6c96190bbbccc3f/ssh/terminal/util.go#L94\" rel=\"nofollow\">here</a>, but the syscalls based on architecture and OS are in <a href=\"https://github.com/golang/go/tree/0104a31b8fbcbe52728a08867b26415d282c35d2/src/syscall\" rel=\"nofollow\">this directory</a>. As you can see there are many. I cannot think of a good way to stub this test in the way you are specifying. </p>\n\n<p>With the limited understanding of your problem the solution I would propose would be to inject a simple interface along the lines of:</p>\n\n<pre><code>type PasswordReader interface {\n    ReadPassword(fd int) ([]byte, error)\n}\n\nfunc (pr PasswordReader) ReadPassword(fd int) ([]byte, error) {\n    return terminal.ReadPassword(fd)\n}\n</code></pre>\n\n<p>This way you can pass in a fake object to your tests, and stub the response to <code>ReadPassword</code>. I know this feels like writing your code for your tests, but you can reframe this thought as <code>terminal</code> is an outside dependency (I/O) that should be injected! So now your tests are not only ensuring your code works, but actually helping you make good design decisions. </p>\n"}, {"tags": [], "owner": {"reputation": 4497, "user_id": 2417812, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b93b8e30afdedfaae41d81f412b9085e?s=128&d=identicon&r=PG", "display_name": "Peter Souter", "link": "https://stackoverflow.com/users/2417812/peter-souter"}, "is_accepted": false, "score": 2, "last_activity_date": 1547475437, "creation_date": 1547475437, "answer_id": 54183219, "question_id": 38573176, "link": "https://stackoverflow.com/questions/38573176/mocking-crypto-ssh-terminal/54183219#54183219", "title": "Mocking crypto/ssh/terminal", "body": "<p>Corbin's example prompted me to look into interface mocking and prompted me to write up a basic example:</p>\n\n<pre><code>// getter.go\npackage cmd\n\nimport (\n    \"errors\"\n    \"syscall\"\n\n    \"golang.org/x/crypto/ssh/terminal\"\n)\n\ntype PasswordReader interface {\n    ReadPassword() (string, error)\n}\n\ntype StdInPasswordReader struct {\n}\n\nfunc (pr StdInPasswordReader) ReadPassword() (string, error) {\n    pwd, error := terminal.ReadPassword(int(syscall.Stdin))\n    return string(pwd), error\n}\n\nfunc readPassword(pr PasswordReader) (string, error) {\n    pwd, err := pr.ReadPassword()\n    if err != nil {\n        return \"\", err\n    }\n    if len(pwd) == 0 {\n        return \"\", errors.New(\"empty password provided\")\n    }\n    return pwd, nil\n}\n\nfunc Run(pr PasswordReader) (string, error) {\n    pwd, err := readPassword(pr)\n    if err != nil {\n        return \"\", err\n    }\n\n    return string(pwd), nil\n}\n</code></pre>\n\n<p>In the test, we can mock errors and simulating no <code>stdin</code> input.</p>\n\n<pre><code>// getter_test.go\npackage cmd_test\nimport (\n    \"errors\"\n    \"testing\"\n\n    \"github.com/petems/passwordgetter/cmd\"\n    \"github.com/stretchr/testify/assert\"\n)\n\ntype stubPasswordReader struct {\n    Password    string\n    ReturnError bool\n}\n\nfunc (pr stubPasswordReader) ReadPassword() (string, error) {\n    if pr.ReturnError {\n        return \"\", errors.New(\"stubbed error\")\n    }\n    return pr.Password, nil\n}\n\nfunc TestRunReturnsErrorWhenReadPasswordFails(t *testing.T) {\n    pr := stubPasswordReader{ReturnError: true}\n    result, err := cmd.Run(pr)\n    assert.Error(t, err)\n    assert.Equal(t, errors.New(\"stubbed error\"), err)\n    assert.Equal(t, \"\", result)\n}\n\nfunc TestRunReturnsPasswordInput(t *testing.T) {\n    pr := stubPasswordReader{Password: \"password\"}\n    result, err := cmd.Run(pr)\n    assert.NoError(t, err)\n    assert.Equal(t, \"password\", result)\n}\n</code></pre>\n\n<p>There are also tools like gomock, testify and counterfeiter that basically do all the heavy lifting for you, and you can add in generator steps into the code:</p>\n\n<pre><code>//go:generate mockgen -destination=../mocks/mock_getter.go -package=mocks github.com/petems/passwordgetter/cmd PasswordReader\n</code></pre>\n\n<p>You then include the mock that gets generated in your test:</p>\n\n<pre><code>package cmd_test\n\nimport (\n    \"testing\"\n    \"errors\"\n\n    \"github.com/golang/mock/gomock\"\n\n    \"github.com/petems/passwordgetter/mocks\"\n    \"github.com/petems/passwordgetter/cmd\"\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestRunReturnsErrorWhenEmptyString(t *testing.T) {\n\n    mockCtrl := gomock.NewController(t)\n  defer mockCtrl.Finish()\n\n  mockPasswordReader := mocks.NewMockPasswordReader(mockCtrl)\n\n  mockPasswordReader.EXPECT().ReadPassword().Return(\"\", nil).Times(1)\n\n    result, err := cmd.Run(mockPasswordReader)\n    assert.Error(t, err)\n    assert.Equal(t, errors.New(\"empty password provided\"), err)\n    assert.Equal(t, \"\", result)\n}\n</code></pre>\n"}], "owner": {"reputation": 4555, "user_id": 353463, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/66RN8.jpg?s=128&g=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/353463/luke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 38583077, "answer_count": 2, "score": 3, "last_activity_date": 1547475437, "creation_date": 1469464601, "question_id": 38573176, "link": "https://stackoverflow.com/questions/38573176/mocking-crypto-ssh-terminal", "title": "Mocking crypto/ssh/terminal", "body": "<p>Has anyone had any success or have any ideas on what would be the best way to mock entry (for testing purposes) to a <code>term.ReadPassword(int(os.Stdin.Fd()))</code> call in the <code>golang.org/x/crypto/ssh/terminal</code> package?</p>\n\n<p>I have tried creating a temp file (vs <code>os.Stdin</code>) and writing string values like <code>testing\\n</code> or <code>testing\\r</code> to the temp file but I get the error <code>inappropriate ioctl for device</code>. I'm guessing it is something TTY related or a specific format that is missing(?) but I really am not sure.</p>\n\n<p>Help appreciated.</p>\n"}, {"tags": ["json", "go", "firebase", "google-cloud-messaging"], "comments": [{"owner": {"reputation": 4557, "user_id": 1741203, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/QORb3.jpg?s=128&g=1", "display_name": "Rajeev Kumar", "link": "https://stackoverflow.com/users/1741203/rajeev-kumar"}, "edited": false, "score": 0, "creation_date": 1487679599, "post_id": 38573049, "comment_id": 71884040, "body": "Hi, can u please advise me where i can get the sample code implementing  gcm-go package..  i have been trying it but not getting any sample code"}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "reply_to_user": {"reputation": 4557, "user_id": 1741203, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/QORb3.jpg?s=128&g=1", "display_name": "Rajeev Kumar", "link": "https://stackoverflow.com/users/1741203/rajeev-kumar"}, "edited": false, "score": 0, "creation_date": 1487775095, "post_id": 38573049, "comment_id": 71936819, "body": "@RajeevKumar I&#39;m not aware of any official sample code, but there are quite a few blogs posts / tutorials on it if you use your Google-fu."}], "answers": [{"comments": [{"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1469480559, "post_id": 38574046, "comment_id": 64543906, "body": "The requirement in the FCM docs (not the library) state that <code>data</code> has to be a set of key value pairs.  Is that inaccurate?"}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "reply_to_user": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1469483573, "post_id": 38574046, "comment_id": 64545085, "body": "@JohnGB According to <a href=\"http://stackoverflow.com/questions/11378004/with-android-gcm-can-you-use-a-deep-json-data-field\">this</a> answer it is possible to send nested data."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1469485252, "post_id": 38574046, "comment_id": 64545622, "body": "Is there any confirmation from Google that they will support this?  All documentation that I can see specifically states that they should be key value string pairs."}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "reply_to_user": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1469490032, "post_id": 38574046, "comment_id": 64547052, "body": "You can still serialize your data to a json string and send it that way, if you want to be 100% sure. I will update my answer with some suggestion later."}], "tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": true, "score": 2, "last_activity_date": 1469575885, "last_edit_date": 1495542296, "creation_date": 1469467847, "answer_id": 38574046, "question_id": 38573049, "link": "https://stackoverflow.com/questions/38573049/how-best-to-send-complex-data-with-fcm-gcm-using-go/38574046#38574046", "title": "How best to send complex data with FCM / GCM using Go", "body": "<p>According to <a href=\"https://stackoverflow.com/questions/11378004/with-android-gcm-can-you-use-a-deep-json-data-field\">this</a> answer, it is possible to send nested data with FCM/GCM.\nTo do that, you can write your own FCM Client or fork google's implementation and change the type definition of <code>Data</code> from</p>\n\n<pre><code>type Data map[string]interface{}\n</code></pre>\n\n<p>to </p>\n\n<pre><code>type Data interface{}\n</code></pre>\n\n<p>And plug in any type that is JSON serializable (e.g. nested structs).</p>\n\n<hr>\n\n<p>It is also possible to send the data via a JSON string without changing the type definition of <code>Data</code>:</p>\n\n<pre><code>// first marshal your complex data structure\ncomplexData := someComplexStruct{...}\nb, _ := json.Marshal(complexData)\n\n// then assign the returned json string to one key of your choice\ndata := map[string]interface{}{\"key\":string(b)}\n</code></pre>\n\n<p>You probably have to unquote the json string before parsing it on the client.</p>\n"}], "owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1206, "favorite_count": 1, "accepted_answer_id": 38574046, "answer_count": 1, "score": 2, "last_activity_date": 1469575885, "creation_date": 1469464212, "last_edit_date": 1469550575, "question_id": 38573049, "link": "https://stackoverflow.com/questions/38573049/how-best-to-send-complex-data-with-fcm-gcm-using-go", "title": "How best to send complex data with FCM / GCM using Go", "body": "<p>Both the FCM and GCM documentation give the structure of the <code>data</code> payload as a map[string]string (although <a href=\"https://github.com/google/go-gcm\" rel=\"nofollow\">google's GCM package</a> implements it at a map[string]interface{})</p>\n\n<p>However, there are many cases where a simple flat key:value structure doesn't meet the needs of an application.  Some examples are when a slice of values is needed, or when another non-trivial struct needs to be sent.</p>\n\n<p>What would be the cleanest way of sending more complicated data structures as a map[string]string?</p>\n\n<hr>\n\n<p>Conclusion:  I have marked the answer by fl0cke as correct given that it provides a solution to sending complex data with FCM / GCM using Go.  However, it is clear from the FCM documentation, that the intention is for the data to be key:value string pairs moving forward, and so to be sure that nothing gets broken in the future, I will be sticking to simple key:value string pairs.</p>\n"}, {"tags": ["mongodb", "go", "distributed", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 10, "last_activity_date": 1471244300, "creation_date": 1471244300, "answer_id": 38950599, "question_id": 38572332, "link": "https://stackoverflow.com/questions/38572332/compare-consistency-models-used-in-mgo/38950599#38950599", "title": "Compare consistency models used in mgo", "body": "<p>These are the three consistency models that MongoDB claims to support:</p>\n\n<ul>\n<li><p><strong>Strong consistency:</strong> All accesses are seen by all parallel processes (or nodes, processors, etc.) in the same order (sequentially).</p></li>\n<li><p><strong>Monotonic reads:</strong> If a process reads the value of a data item x, any successive read operation on x by that process will always return that same value or a more recent value.</p></li>\n<li><p><strong>Eventual consistency:</strong> If no new updates are made to a given data item, eventually all accesses to that item will return the last updated value.</p></li>\n</ul>\n\n<p>By these definitions, Strong implies eventual, and strong implies monotonic, but there is no relation between eventual consistency and monotonic reads. </p>\n\n<p>However, looking at the real system, there is more to be found. </p>\n\n<p>In MongoDB, Monotonic mode means that the client opens a single connection to some secondary node. All reads happen through this connection. When a write happens, the client drops the connection and connects to the primary node, and then performs the write. Reads following a write are performed from the primary node. </p>\n\n<p>In Eventual mode, reads are done from multiple secondary nodes, concurrently. This means that we might see updates out of order, as they reach different nodes. Writes are performed against the primary, but possibly in multiple concurrent connections. This means that writes may arrive out of order as well. It is not clear from the documentation if reads following the first write are all served by the primary, like in Monotonic mode, or if they continue to be served by secondaries. <a href=\"https://bazaar.launchpad.net/+branch/mgo/v2/view/head:/session.go#L3380\" rel=\"noreferrer\">The source code</a>, however, tells us that reads continue to be served by secondaries. </p>\n\n<pre><code>// Switch over a Monotonic session to the master.\nif !slaveOk &amp;&amp; s.consistency == Monotonic {\n    s.slaveOk = false\n}\n</code></pre>\n\n<p>Thus, for Mgo v2, <strong>Strong implies Monotonic implies Eventual</strong>.</p>\n"}], "owner": {"reputation": 1, "user_id": 156458, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/3PCjR.png?s=128&g=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/156458/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1693, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1471244300, "creation_date": 1469461982, "last_edit_date": 1469465512, "question_id": 38572332, "link": "https://stackoverflow.com/questions/38572332/compare-consistency-models-used-in-mgo", "title": "Compare consistency models used in mgo", "body": "<p>MongoDB servers are queried with multiple \nconsistency rules. In <code>mgo</code>, <code>SetMode</code> of the <code>Session</code> object changes the consistency mode for the session. Three types \nof consistency modes are available: Eventual, Monotonic, and Strong.</p>\n\n<p>e.g.</p>\n\n<pre><code>session, err := mgo.Dial(\"localhost\")\nif err != nil {\n    panic(err)\n}\ndefer session.Close()\n//Switch the session to a monotonic behavior.\nsession.SetMode(mgo.Monotonic, true)\n</code></pre>\n\n<p>I am reading about the different consistency models in <a href=\"https://en.wikipedia.org/wiki/Consistency_model\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Consistency_model</a></p>\n\n<p>But what are the relations between the three  models used in <code>mgo</code>?</p>\n\n<p>Is it correct that <code>Strong</code> implies <code>Eventual</code>, and <code>Eventual</code> implies <code>Monotonic</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["node.js", "go", "blockchain", "hyperledger"], "comments": [{"owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "edited": false, "score": 0, "creation_date": 1469461850, "post_id": 38572046, "comment_id": 64533629, "body": "@Amd updated the question"}, {"owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "edited": false, "score": 0, "creation_date": 1469470844, "post_id": 38572046, "comment_id": 64538784, "body": "I guess you&#39;re looking it from go perspective. The async.js file is from the library file is being getting called from my app.js code. The issue is with running blockchain on local network with security enabled."}, {"owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "edited": false, "score": 0, "creation_date": 1469477740, "post_id": 38572046, "comment_id": 64542480, "body": "@Amd update the question."}], "owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1469477690, "creation_date": 1469461144, "last_edit_date": 1469477690, "question_id": 38572046, "link": "https://stackoverflow.com/questions/38572046/error-running-custom-blockchainhyperledger-application-with-security-enabled", "title": "Error Running custom blockchain(hyperledger) application with security enabled", "body": "<p>I'm running my blockchain application on local network setup using Vagrant.<br>\nThe network (ca and vp ) are running inside Vagrant VM while my application resides outside Vagrant. When I ran my application with security disabled, everything works fine. But now when I tried with security enabled, I'm getting the following error:  </p>\n\n<pre><code>himanshus-mbp:BCApplication himanshutyagi$ node app.js \nloading hardcoded peers\nloading hardcoded users\n[ibc-js] Peer:  vp0-dev_vp0...:5000\n[ibc-js] No membership users found after filtering, assuming this is a network w/o membership\n[ibc-js] Found chaincode in local file system\n[ibc-js] Scanning files [ '.DS_Store', 'chaincode_finished.go', 'finished' ]\n[ibc-js] Parsing file for shim version\n[ibc-js] Found shim version: github.com/hyperledger/fabric/core/chaincode/shim\n[ibc-js] Parsing file for invoke functions - chaincode_finished.go\n[ibc-js] Found cc invoke function:  init\n[ibc-js] Found cc invoke function:  delete_product\n[ibc-js] Found cc invoke function:  delete_offering\n[ibc-js] Found cc invoke function:  delete_contract\n[ibc-js] Found cc invoke function:  delete_client\n[ibc-js] Found cc invoke function:  write\n[ibc-js] Found cc invoke function:  init_product\n[ibc-js] Found cc invoke function:  init_offering\n[ibc-js] Found cc invoke function:  init_contract\n[ibc-js] Found cc invoke function:  init_client\n[ibc-js] Found cc invoke function:  set_user_type\n[ibc-js] Parsing file for query functions - chaincode_finished.go\n[ibc-js] Found cc query function:  read\n[ibc-js] Found cc query function:  read_product_index\n[ibc-js] Found cc query function:  read_offering_index\n[ibc-js] Found cc query function:  read_contract_index\n[ibc-js] Found cc query function:  read_client_index\n[ibc-js] load_chaincode() finished\nchaincode summary file indicates chaincode has been previously deployed\n------------------------------------------ Chain is up and running ------------------------------------------\nGetting Offering List: \n[ibc-js] read  - success: { jsonrpc: '2.0',\n  error: \n   { code: -32602,\n     message: 'Invalid params',\n     data: 'Must supply username for chaincode when security is enabled.' },\n  id: 1469460324754 }\nread _offeringindex: null { name: 'query() resp error',\n  code: 400,\n  details: \n   { code: -32602,\n     message: 'Invalid params',\n     data: 'Must supply username for chaincode when security is enabled.' } }\n/Users/himanshutyagi/Desktop/workspace/node_modules/async/lib/async.js:106\n        if (!arr.length) {\n                ^\n\nTypeError: Cannot read property 'length' of null\n    at Object.async.each (/Users/himanshutyagi/Desktop/workspace/node_modules/async/lib/async.js:106:17)\n    at /Users/himanshutyagi/Desktop/workspace/BCApplication/BCApplication/app.js:379:10\n    at Object.options.success (/Users/himanshutyagi/Desktop/workspace/BCApplication/BCApplication/node_modules/ibm-blockchain-js/index.js:1020:22)\n    at success (/Users/himanshutyagi/Desktop/workspace/BCApplication/BCApplication/node_modules/ibm-blockchain-js/lib/rest.js:109:30)\n    at IncomingMessage.&lt;anonymous&gt; (/Users/himanshutyagi/Desktop/workspace/BCApplication/BCApplication/node_modules/ibm-blockchain-js/lib/rest.js:192:7)\n    at emitNone (events.js:72:20)\n    at IncomingMessage.emit (events.js:166:7)\n    at endReadableNT (_stream_readable.js:921:12)\n    at nextTickCallbackWith2Args (node.js:442:9)\n    at process._tickCallback (node.js:356:17)\n</code></pre>\n\n<p>What also is weird is that in the logs, it says <code>No membership users found after filtering</code> I also re deployed the chaincode with the same <code>enrollID and enrollPW</code> as I've mentioned in my <code>app.js</code> blockchain js configuration. Following are the details:</p>\n\n<pre><code>var options =   {\n                    network:{\n                        /*\n                        peers: peers,\n                        users: users,\n                        options: {quiet: true, tls:false, maxRetry: 1}*/\n                        'peers': [\n                            {\n                                        'discovery_host': 'localhost',\n                                        'discovery_port': 30303,\n                                        'api_host': 'localhost',\n                                        'api_port_tls': 443,\n                                        'api_port': 5000,\n                                        'type': 'peer',\n                                        'network_id': 'dev',\n                                        'id': 'dev_vp0',\n                                        'api_url': 'http://localhost:5000'\n                                    }\n                            ],\n                            \"users\": [\n                          {\n                            \"username\": \"tyagi_user_type1\",\n                            \"secret\": \"1ccf8703ac\",\n                            \"enrollId\": \"tyagi_type1\",\n                            \"enrollSecret\": \"1ccf8703ac\"\n                          }\n                        ],\n                    options: {quiet: true, tls:false, maxRetry: 1}\n                    },\n                    ...\n};\n</code></pre>\n\n<p>What does \"Must supply username for chaincode\" mean. Has anyone faced a similar issue while running with security enabled on a local network ?\n<br>\n<strong>UPDATE:</strong>\nSo, I changed the enrillId to <code>user_type1_xxx</code> , now \"No Membership users found..\" message doesn't come anymore. But I'm getting a connection refused error when the user is trying to register. </p>\n\n<pre><code>himanshus-mbp:BCApplication himanshutyagi$ node app.js\nloading hardcoded peers\nloading hardcoded users\n[ibc-js] Peer:  vp0-dev_vp0...:443\n[ibc-js] Registering  vp0-dev_vp0...:443  w/enrollID - user_type1_tyagi\n[ibc-js] Register - failure x1 : user_type1_tyagi 500\n[ibc-js]    going to try to register again in 30 secs\nQuery for the product table executed\nQuery for the offering table executed\nQuery for the contract table executed\nQuery for the product table executed\n[ibc-js] Registering  vp0-dev_vp0...:443  w/enrollID - user_type1_tyagi\n[ibc-js] Register - failure x2 : user_type1_tyagi 500\n[ibc-js]    going to try to register again in 30 secs\nQuery for the product table executed\nQuery for the offering table executed\nQuery for the contract table executed\nQuery for the product table executed\n[ibc-js] Registering  vp0-dev_vp0...:443  w/enrollID - user_type1_tyagi\n[ibc-js] Register - failure x3 : user_type1_tyagi 500\n[ibc-js]    going to try to register again in 30 secs\nQuery for the product table executed\nQuery for the offering table executed\nQuery for the contract table executed\nQuery for the product table executed\nQuery for the product table executed\nQuery for the offering table executed\nQuery for the contract table executed\nQuery for the product table executed\n[ibc-js] Registering  vp0-dev_vp0...:443  w/enrollID - user_type1_tyagi\n[ibc-js] Register - failure x4 : user_type1_tyagi 500\n! looks like an error loading the chaincode or network, app will fail\n { name: 'register() error',\n  code: 500,\n  details: \n   { [Error: connect ECONNREFUSED 127.0.0.1:443]\n     code: 'ECONNREFUSED',\n     errno: 'ECONNREFUSED',\n     syscall: 'connect',\n     address: '127.0.0.1',\n     port: 443 } }\n</code></pre>\n"}, {"tags": ["go", "slice", "swap"], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": true, "score": 44, "last_activity_date": 1469459619, "creation_date": 1469459619, "answer_id": 38571485, "question_id": 38571354, "link": "https://stackoverflow.com/questions/38571354/best-way-to-swap-variable-values-in-go/38571485#38571485", "title": "Best way to swap variable values in Go?", "body": "<p>Yes, it is possible. Assuming <code>a</code> and <code>b</code> have the same type, the example provided will work just fine. For example:</p>\n\n<pre><code>a, b := \"second\", \"first\"\nfmt.Println(a, b) // Prints \"second first\"\nb, a = a, b\nfmt.Println(a, b) // Prints \"first second\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/aZJsfa_LH_\" rel=\"noreferrer\"><code>Run sample on the playground</code></a></p>\n\n<p>This is both legal and idiomatic, so there's no need to use an intermediary buffer.</p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 13, "last_activity_date": 1469459637, "creation_date": 1469459637, "answer_id": 38571494, "question_id": 38571354, "link": "https://stackoverflow.com/questions/38571354/best-way-to-swap-variable-values-in-go/38571494#38571494", "title": "Best way to swap variable values in Go?", "body": "<p>Yes it is possible to swap elements using tuple assignments:</p>\n\n<pre><code>i := []int{1, 2, 3, 4}\nfmt.Println(i)\n\ni[0], i[1] = i[1], i[0]\nfmt.Println(i)\n\na, b := 1, 2\nfmt.Println(a, b)\n\na, b = b, a // note the lack of ':' since no new variables are being created\nfmt.Println(a, b)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[1 2 3 4]\n[2 1 3 4]\n1 2\n2 1\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/sopFxCqwM1\" rel=\"noreferrer\">https://play.golang.org/p/sopFxCqwM1</a></p>\n\n<p>More details here: <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">https://golang.org/ref/spec#Assignments</a></p>\n"}, {"tags": [], "owner": {"reputation": 1257, "user_id": 9790416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e4d4944386ae38d1b229977ac4b3e4?s=128&d=identicon&r=PG", "display_name": "Shubham Chadokar", "link": "https://stackoverflow.com/users/9790416/shubham-chadokar"}, "is_accepted": false, "score": 2, "last_activity_date": 1583081710, "creation_date": 1583081710, "answer_id": 60477454, "question_id": 38571354, "link": "https://stackoverflow.com/questions/38571354/best-way-to-swap-variable-values-in-go/60477454#60477454", "title": "Best way to swap variable values in Go?", "body": "<p>There is a function called <a href=\"https://golang.org/pkg/reflect/#Swapper\" rel=\"nofollow noreferrer\">Swapper</a> which takes a slice and returns a swap function. This swap function takes 2 indexes and swap the index values in the slice.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    s := []int{1, 2, 3}\n\n    fmt.Printf(\"Before swap: %v\\n\", s)\n\n    swapF := reflect.Swapper(s)\n\n    swapF(0, 1)\n\n    fmt.Printf(\"After swap: %v\\n\", s)\n}\n\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-uKzYN_AkZS\" rel=\"nofollow noreferrer\">Try it</a>  </p>\n\n<p>Output</p>\n\n<pre><code>Before swap: [1 2 3]\nAfter swap: [2 1 3]\n</code></pre>\n\n<hr>\n\n<p>Yes, you can swap values like python.  </p>\n\n<pre><code>a, b := 0, 1\nfmt.Printf(\"Before swap a = %v, b = %v\\n\", a, b)\n\nb, a = a, b\nfmt.Printf(\"After swap a = %v, b = %v\\n\", a, b)\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>Before swap a = 0, b = 1\nAfter swap a = 1, b = 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 155, "user_id": 10450863, "user_type": "registered", "profile_image": "https://graph.facebook.com/2192347384310274/picture?type=large", "display_name": "Shivani Singhal", "link": "https://stackoverflow.com/users/10450863/shivani-singhal"}, "is_accepted": false, "score": 1, "last_activity_date": 1610433113, "creation_date": 1610433113, "answer_id": 65679013, "question_id": 38571354, "link": "https://stackoverflow.com/questions/38571354/best-way-to-swap-variable-values-in-go/65679013#65679013", "title": "Best way to swap variable values in Go?", "body": "<p>Yes you can swap by using</p>\n<blockquote>\n<p>a, b = b, a</p>\n</blockquote>\n<p>So if a = 1 and b= 2,\nthen after executing</p>\n<p><code>a , b = b, a</code></p>\n<p>you get a = 2 and b = 1</p>\n<p>Also, if you write</p>\n<p><code>a, b, a = b, a, b</code></p>\n<p>then it results b = 1 and a = 2</p>\n"}], "owner": {"reputation": 2449, "user_id": 4313927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/568720341/picture?type=large", "display_name": "Nicky Feller", "link": "https://stackoverflow.com/users/4313927/nicky-feller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21316, "favorite_count": 2, "accepted_answer_id": 38571485, "answer_count": 4, "score": 14, "last_activity_date": 1610433113, "creation_date": 1469459277, "last_edit_date": 1525484437, "question_id": 38571354, "link": "https://stackoverflow.com/questions/38571354/best-way-to-swap-variable-values-in-go", "title": "Best way to swap variable values in Go?", "body": "<p>Is it possible to swap elements like in python?</p>\n\n<pre><code>a,b = b,a\n</code></pre>\n\n<p>or do we have to use:</p>\n\n<pre><code>temp = a\na = b\nb = temp\n</code></pre>\n"}, {"tags": ["ssl", "go", "https", "tls1.2"], "answers": [{"comments": [{"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1469513002, "post_id": 38571961, "comment_id": 64552845, "body": "great I need something like this but from which library is this client? or in other words how to create it?"}, {"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1469517576, "post_id": 38571961, "comment_id": 64555312, "body": "ok you are using the net/http but how can I create a tlsclient in this library given the certificates?"}], "tags": [], "owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "is_accepted": true, "score": 1, "last_activity_date": 1469535668, "last_edit_date": 1469535668, "creation_date": 1469460901, "answer_id": 38571961, "question_id": 38571329, "link": "https://stackoverflow.com/questions/38571329/how-to-use-http-get-in-a-tlsclient-in-go/38571961#38571961", "title": "How to use http.Get in a TLSClient in Go?", "body": "<p>Not sure what package you are using but the http package has a <em>NewRequest</em> function</p>\n\n<pre><code>req, _ := http.NewRequest(\"GET\", url, nil)\nclient.Do(req)\n</code></pre>\n\n<p>--Edit</p>\n\n<p>In addition, here is a full working TLS example with client certificates (I did not create this gist)</p>\n\n<p><a href=\"https://gist.github.com/michaljemala/d6f4e01c4834bf47a9c4\" rel=\"nofollow\">https://gist.github.com/michaljemala/d6f4e01c4834bf47a9c4</a></p>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 38571961, "answer_count": 1, "score": -1, "last_activity_date": 1469535668, "creation_date": 1469459200, "last_edit_date": 1469461092, "question_id": 38571329, "link": "https://stackoverflow.com/questions/38571329/how-to-use-http-get-in-a-tlsclient-in-go", "title": "How to use http.Get in a TLSClient in Go?", "body": "<p>Hi I want to perform a GET Request in GO after creating a tlsclient, for example:</p>\n\n<pre><code>client, err := docker.NewTLSClient(sconf.DockConf.Endpoint, sconf.DockConf.Cert, sconf.DockConf.Key, sconf.DockConf.Ca)\n</code></pre>\n\n<p>then how can I perform a Get request in GO?</p>\n"}, {"tags": ["arrays", "string", "dictionary", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1469456639, "post_id": 38570222, "comment_id": 64530225, "body": "Th error is not because you have a map vs an array, it&#39;s because you have a data race. You need to protect a global map from concurrent access."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469456677, "post_id": 38570222, "comment_id": 64530251, "body": "How are you calling the functions writing to the map? Some code would be helpful. Are they being called as goroutines? If so, take a look at <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#Mutex</a>"}, {"owner": {"reputation": 33, "user_id": 6565674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/034e394f4221e6b84d4f8b7bdd08fa35?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/6565674/chrisdave"}, "edited": false, "score": 0, "creation_date": 1469463033, "post_id": 38570222, "comment_id": 64534404, "body": "Is there any way to declare and assign  values globally to a map??"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469464023, "post_id": 38570222, "comment_id": 64534971, "body": "All values required synchronization for concurrent reads and writes. A map is no different."}], "answers": [{"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1495396363, "last_edit_date": 1495396363, "creation_date": 1469481459, "answer_id": 38577575, "question_id": 38570222, "link": "https://stackoverflow.com/questions/38570222/golang-multidimensional-string-array-instead-of-maps/38577575#38577575", "title": "Golang: multidimensional string array instead of maps", "body": "<p>The <code>Concurrent writes</code> error happens when the Go runtime detects concurrent writes to the map by different goroutines.  It is a feature added in go1.6:</p>\n\n<p><a href=\"https://blog.golang.org/go1.6\" rel=\"nofollow noreferrer\">https://blog.golang.org/go1.6</a></p>\n\n<blockquote>\n  <p>The runtime has added lightweight, best-effort detection of concurrent misuse of maps. As always, if one goroutine is writing to a map, no other goroutine should be reading or writing the map concurrently. If the runtime detects this condition, it prints a diagnosis and crashes the program. The best way to find out more about the problem is to run it under the race detector, which will more reliably identify the race and give more detail.</p>\n</blockquote>\n\n<p>You <strong>can</strong> initialize a map on a global level - see <a href=\"https://play.golang.org/p/AjqtQBGMEM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AjqtQBGMEM</a> (or below) for an example.  The same code snippet shows how maps data races can be prevented with synchronisation mechanisms - use a mutex, lock before writing to a map, and unlock afterwards.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar mu sync.Mutex\nvar mymap = map[string]string{\"hello\": \"world\", \"foo\": \"bar\"}\n\nfunc main() {\n    demo()\n}\n\nfunc demo() {\n    mu.Lock()\n    defer mu.Unlock()\n    mymap[\"hello\"] = \"gophers\"\n    fmt.Println(\"hello, \", mymap[\"hello\"])  \n}\n</code></pre>\n\n<p>Another way to avoid the data race is to use a channel of size 1 (non-buffered), similar to the Tour example in <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/2</a>: extract the map from the channel, write to it, and put it back to the channel.</p>\n\n<p><a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/race_detector.html</a> has more information about data races and the Go race detector - a very useful tool to identify hard-to-trace bugs in concurrent access. </p>\n"}], "owner": {"reputation": 33, "user_id": 6565674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/034e394f4221e6b84d4f8b7bdd08fa35?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/6565674/chrisdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1066, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1495396363, "creation_date": 1469456259, "last_edit_date": 1469458688, "question_id": 38570222, "link": "https://stackoverflow.com/questions/38570222/golang-multidimensional-string-array-instead-of-maps", "title": "Golang: multidimensional string array instead of maps", "body": "<p>In my project I need to read a value as a global variable so I am using maps (global variable)</p>\n\n<pre><code>var url = make(map[string]string)\n</code></pre>\n\n<p>and I occasionally get into error <code>\"Concurrent writes\"</code>  as I assign value in a function (cant assign global as it gives an error non-declarative statement).</p>\n\n<pre><code>url[\"test\"] = \"http://google.com\"\n</code></pre>\n\n<p>In PHP I could easily do this through an multidimensioanl array and read the value. Is there a way I could just use multidimensional array or maps in Go to just assign and read it in a function?</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["http", "go", "server", "dependencies"], "comments": [{"owner": {"reputation": 4058, "user_id": 754407, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1b5c51ae68d0d76ce0e178f777f1742d?s=128&d=identicon&r=PG", "display_name": "hauron", "link": "https://stackoverflow.com/users/754407/hauron"}, "edited": false, "score": 0, "creation_date": 1469454329, "post_id": 38569396, "comment_id": 64528511, "body": "Looks like it crashed on loading dynamic libraries. Perhaps after you&#39;ve installed <code>go</code> the necessary binaries ended up in win32/wow64 directory, hence it worked? You could try adding the necessary runtime dynamic libraries to the binary directory (or PATH) and see if that&#39;s enough."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1469454382, "post_id": 38569396, "comment_id": 64528546, "body": "The runtime does not require the source to be installed. You need to show how you build the binary and what output you received."}, {"owner": {"reputation": 635, "user_id": 3491921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e2794eb0e45c57129cb73d2c9d7b41a4?s=128&d=identicon&r=PG&f=1", "display_name": "Mehulkumar", "link": "https://stackoverflow.com/users/3491921/mehulkumar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469455786, "post_id": 38569396, "comment_id": 64529555, "body": "@JimB I&#39;ve added my program. In case <code>Go</code> is not installed, it just logs the err and exits!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1469456029, "post_id": 38569396, "comment_id": 64529740, "body": "Your program is looking for the <code>go</code> binary, so of course Go needs to be installed. Why are you doing <code>exec.LookPath(&quot;go&quot;)</code>?"}, {"owner": {"reputation": 635, "user_id": 3491921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e2794eb0e45c57129cb73d2c9d7b41a4?s=128&d=identicon&r=PG&f=1", "display_name": "Mehulkumar", "link": "https://stackoverflow.com/users/3491921/mehulkumar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469457483, "post_id": 38569396, "comment_id": 64530782, "body": "@JimB I need checking on whether some commands exists on target system, so that was my test! Thanks so much for your help!!"}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 1, "creation_date": 1469460580, "post_id": 38569396, "comment_id": 64532764, "body": "change log.Fatal() to log.Printf(), and it should work (and you probably don&#39;t need to <code>exec.LookPath(&quot;go&quot;)</code> since Go does not have to be installed on the target machine)"}, {"owner": {"reputation": 635, "user_id": 3491921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e2794eb0e45c57129cb73d2c9d7b41a4?s=128&d=identicon&r=PG&f=1", "display_name": "Mehulkumar", "link": "https://stackoverflow.com/users/3491921/mehulkumar"}, "reply_to_user": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469509034, "post_id": 38569396, "comment_id": 64551481, "body": "@dmitris Yes! My program will require some commands to be run on target machine so <code>exec.LookPath(&quot;go&quot;)</code> was just a test to check if it works. I&#39;ll probably also require <code>log.Fatal()</code> as well because without some commands on target machine(not <code>go</code>), my program will not run."}], "answers": [{"comments": [{"owner": {"reputation": 635, "user_id": 3491921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e2794eb0e45c57129cb73d2c9d7b41a4?s=128&d=identicon&r=PG&f=1", "display_name": "Mehulkumar", "link": "https://stackoverflow.com/users/3491921/mehulkumar"}, "edited": false, "score": 0, "creation_date": 1469457321, "post_id": 38570213, "comment_id": 64530678, "body": "Well noted! Thank so much for help!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1469456687, "last_edit_date": 1495542179, "creation_date": 1469456232, "answer_id": 38570213, "question_id": 38569396, "link": "https://stackoverflow.com/questions/38569396/go-build-with-built-in-dependencies/38570213#38570213", "title": "Go build with built-in dependencies", "body": "<p>Your app doesn't work without Go because you call <a href=\"https://golang.org/pkg/log/#Fatal\" rel=\"nofollow noreferrer\"><code>log.Fatal()</code></a> if it doesn't find the <code>go</code> tool, and <code>log.Fatal()</code> <em>terminates</em> your app:</p>\n\n<blockquote>\n  <p>Fatal is equivalent to Print() <strong>followed by a call to os.Exit(1)</strong>.</p>\n</blockquote>\n\n<p>Your executable binary will contain everything it needs if you build it from the source you posted either with <code>go build</code> or <code>go install</code> (see <a href=\"https://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a> for details). Just don't call <code>log.Fatal()</code> and it should work.</p>\n\n<p>And on a side note: you <em>should</em> check and print errors returned by <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow noreferrer\"><code>http.ListenAndServe()</code></a>, e.g.:</p>\n\n<pre><code>panic(http.ListenAndServe(\":8080\", nil))\n</code></pre>\n\n<p>Because if this fails, you won't know why it doesn't work (e.g. you already started the app and the port is taken / in use).</p>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 2, "last_activity_date": 1469456293, "creation_date": 1469456293, "answer_id": 38570233, "question_id": 38569396, "link": "https://stackoverflow.com/questions/38569396/go-build-with-built-in-dependencies/38570233#38570233", "title": "Go build with built-in dependencies", "body": "<p>No, the target system does not have to have the Go compiler installed for the executable compiled with Go to run. You can compile your program with <code>go install</code> or <code>go build</code> on one Windows computer, copy it to another one where Go is <strong>not</strong> installed and run it there.  </p>\n\n<p>Make sure the program that you compile starts with the <code>package main</code> statement - otherwise only a library file will be compiled.</p>\n\n<p>Make sure to check whether the user that runs your program has rights to listen on the port that the http server uses.  The ports 0-1023 - \"Well Known Ports\" - \"can only be used by system (or root) processes or by programs executed by privileged users\" (<a href=\"https://support.microsoft.com/en-us/kb/174904\" rel=\"nofollow\">https://support.microsoft.com/en-us/kb/174904</a>), so try to start your program as a privileged user (for example, Administrator) or use a non-privileged port >= 1024 (ex. <code>http.ListenAndServe(\":8080\", nil)</code> should start the server on a non-privilege port.  Take a very simple example - for example from <a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow\">https://golang.org/doc/articles/wiki/</a> - and see if you can get it to work.</p>\n"}], "owner": {"reputation": 635, "user_id": 3491921, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e2794eb0e45c57129cb73d2c9d7b41a4?s=128&d=identicon&r=PG&f=1", "display_name": "Mehulkumar", "link": "https://stackoverflow.com/users/3491921/mehulkumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 619, "favorite_count": 0, "accepted_answer_id": 38570213, "answer_count": 2, "score": 0, "last_activity_date": 1469458521, "creation_date": 1469454166, "last_edit_date": 1469458521, "question_id": 38569396, "link": "https://stackoverflow.com/questions/38569396/go-build-with-built-in-dependencies", "title": "Go build with built-in dependencies", "body": "<p>I'm very new to system programming.</p>\n\n<p>I have a Go program which uses <code>net/http</code> and starts an http server.</p>\n\n<p>When I build a Windows binary and tried on a target Windows machine, nothing worked except <code>Printf</code>s before it starts the server.</p>\n\n<p>As soon as I installed Go on the target Windows machine, everything started working!</p>\n\n<p>Here is my program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there @%s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n\n    path, err := exec.LookPath(\"go\")\n    if err != nil {\n        log.Fatal(\"Go is not your fortune :|\")\n    }\n    fmt.Printf(\"Go is available at %s\\n\", path)\n\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>If <code>go</code> doesn't build all the dependencies with its program then how do I do it? If it does, why it is not working? </p>\n\n<p>Does target systems have to have <code>go</code> installed prior to run any Go programs?</p>\n\n<p>Please help! Thanks.</p>\n"}, {"tags": ["go", "base64", "decode", "encode"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1469443975, "post_id": 38565793, "comment_id": 64521515, "body": "Can you show us all of the data so we can see if it&#39;s valid?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1469445077, "last_edit_date": 1469445077, "creation_date": 1469444761, "answer_id": 38566102, "question_id": 38565793, "link": "https://stackoverflow.com/questions/38565793/illegal-base64-data-at-input-byte-2564-error-message/38566102#38566102", "title": "Illegal base64 data at input byte 2564 error message", "body": "<p>You can't concatenate different base64 encoded strings and decode them as one. Base64 encoding might not use all the bits in the result string, and it may use padding, which is only valid if found at the end (but not in the middle).</p>\n\n<p>You have to decode them separately.</p>\n\n<p>See this example:</p>\n\n<pre><code>d1 := []byte{1, 2}\nd2 := []byte{3, 4}\ns1 := base64.StdEncoding.EncodeToString(d1)\ns2 := base64.StdEncoding.EncodeToString(d2)\nfmt.Println(s1)\nfmt.Println(s2)\n\nd1d, err := base64.StdEncoding.DecodeString(s1)\nif err != nil {\n    panic(err)\n}\nd2d, err := base64.StdEncoding.DecodeString(s2)\nif err != nil {\n    panic(err)\n}\nfmt.Println(d1d)\nfmt.Println(d2d)\n\nd12d, err := base64.StdEncoding.DecodeString(s1 + s2)\nif err != nil {\n    fmt.Println(err)\n} else {\n    fmt.Println(d12d)\n}\n</code></pre>\n\n<p>Output (try it on the <kbd><a href=\"https://play.golang.org/p/c_CX2xHDCu\" rel=\"nofollow\">Go Playground</a></kbd>):</p>\n\n<pre><code>AQI=\nAwQ=\n[1 2]\n[3 4]\nillegal base64 data at input byte 4\n</code></pre>\n\n<p>As you can see, decoding succeeds one-by-one, but fails when attempting to decode the concatenated string.</p>\n\n<p><strong>Note:</strong></p>\n\n<p>Note that in special cases it might be possible to \"properly\" decode concatenated base64 strings (that is, if the first one does not end with padding characters), but you should never make such assumption.</p>\n\n<p>For example if the first data is the encoded from of an input whose length is dividable by 3, its Base64 form does not contain padding:</p>\n\n<pre><code>d1 := []byte{1, 2, 3}\nd2 := []byte{4, 5, 6}\n</code></pre>\n\n<p>Using this input to the above test code, it yields success (try it on the <kbd><a href=\"https://play.golang.org/p/CGipAQUCUv\" rel=\"nofollow\">Go Playground</a></kbd>):</p>\n\n<pre><code>AQID\nBAUG\n[1 2 3]\n[4 5 6]\n[1 2 3 4 5 6]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2679, "user_id": 3081480, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UVerL.jpg?s=128&g=1", "display_name": "Kyle Chadha", "link": "https://stackoverflow.com/users/3081480/kyle-chadha"}, "is_accepted": false, "score": 3, "last_activity_date": 1489014667, "creation_date": 1489014667, "answer_id": 42683706, "question_id": 38565793, "link": "https://stackoverflow.com/questions/38565793/illegal-base64-data-at-input-byte-2564-error-message/42683706#42683706", "title": "Illegal base64 data at input byte 2564 error message", "body": "<p>I ran into a somewhat similar issue; the solution for me was to use <code>base64.RawStdEncoding</code>, since <strong>my encoded string had already had its padding stripped</strong>.</p>\n\n<p>Note: As the other answer mentions, if padding has not been stripped: you can not concatenate two base64encoded strings.</p>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>RawStdEncoding is the standard raw, unpadded base64 encoding, as\n  defined in RFC 4648 section 3.2. This is the same as StdEncoding but\n  omits padding characters.</p>\n  \n  <p><code>var RawStdEncoding = StdEncoding.WithPadding(NoPadding)</code></p>\n  \n  <p>RawURLEncoding\n  is the unpadded alternate base64 encoding defined in RFC 4648. It is\n  typically used in URLs and file names. This is the same as URLEncoding\n  but omits padding characters.</p>\n  \n  <p><code>var RawURLEncoding = URLEncoding.WithPadding(NoPadding)</code></p>\n  \n  <p>StdEncoding is\n  the standard base64 encoding, as defined in RFC 4648.</p>\n  \n  <p><code>var StdEncoding = NewEncoding(encodeStd)</code></p>\n  \n  <p>URLEncoding is the alternate\n  base64 encoding defined in RFC 4648. It is typically used in URLs and\n  file names.</p>\n  \n  <p><code>var URLEncoding = NewEncoding(encodeURL)</code></p>\n</blockquote>\n"}], "owner": {"reputation": 67, "user_id": 4985625, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XmBvqOg_-2g/AAAAAAAAAAI/AAAAAAAAADI/-dRgZsQ8cxw/photo.jpg?sz=128", "display_name": "Iranna Pattar", "link": "https://stackoverflow.com/users/4985625/iranna-pattar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3832, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1489014667, "creation_date": 1469443848, "last_edit_date": 1469447596, "question_id": 38565793, "link": "https://stackoverflow.com/questions/38565793/illegal-base64-data-at-input-byte-2564-error-message", "title": "Illegal base64 data at input byte 2564 error message", "body": "<p>I am getting:</p>\n\n<pre><code>error: illegal base64 data at input byte 2564 \n</code></pre>\n\n<p>When I am decrypting two encoded strings:</p>\n\n<pre><code>data1:=\"8uxiowaHGmt6usI7U2SErXwpi/JLKbdhI3o....\"(encrypted data)\ndata2:=\"iqqtWBCW7Ih9GAXubtIoLjucdIDfWd+oo2j....\"(encrypted data)\n\ndata:=data1+data2\n\nvalue, err = base64.StdEncoding.DecodeString(data)\nif err != nil {\n    log.Println(err)\n    return\n}\n</code></pre>\n\n<p>Can anyone suggest what could be the problem?</p>\n"}, {"tags": ["go", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469444244, "post_id": 38565654, "comment_id": 64521674, "body": "The documentation states: &quot;Multiple goroutines may invoke methods on a Conn simultaneously.&quot;. If that doesn&#39;t hold true for all platforms then it&#39;s a bug that needs to be fixed."}, {"owner": {"reputation": 371, "user_id": 2248790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56d52363db767c88e7da44ee20c3cf81?s=128&d=identicon&r=PG", "display_name": "bitflood", "link": "https://stackoverflow.com/users/2248790/bitflood"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469444572, "post_id": 38565654, "comment_id": 64521845, "body": "You right. The only thing stopping me to file the bug is that I do not know whether WSASend implements the loop equivalent to unix impl or not. Hence the question on SO"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469444999, "post_id": 38565654, "comment_id": 64522107, "body": "Normally you file a bug when you have proof that it doesn&#39;t work correctly. Otherwise you assume the code works as advertised."}, {"owner": {"reputation": 371, "user_id": 2248790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56d52363db767c88e7da44ee20c3cf81?s=128&d=identicon&r=PG", "display_name": "bitflood", "link": "https://stackoverflow.com/users/2248790/bitflood"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469446238, "post_id": 38565654, "comment_id": 64522873, "body": "I just found out that there is no looping required for WSASend <a href=\"http://stackoverflow.com/questions/28752103/how-to-make-sure-that-wsasend-will-send-the-data\">here</a>. This answers my questions. I will check some more, else I will answer this myself"}], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 5, "last_activity_date": 1469459121, "creation_date": 1469459121, "answer_id": 38571301, "question_id": 38565654, "link": "https://stackoverflow.com/questions/38565654/golang-net-conn-write-in-parallel/38571301#38571301", "title": "Golang net.Conn Write in parallel", "body": "<p>Yes, you can make many calls to a <code>net.Conn</code>'s write method in parallel.</p>\n\n<p>Part of <code>net.Conn</code>'s contract is that it can be used from multiple Goroutines concurrently. This is explicitly called out in <a href=\"https://godoc.org/net#Conn\" rel=\"noreferrer\">its documentation</a>:</p>\n\n<blockquote>\n  <p>Conn is a generic stream-oriented network connection.</p>\n  \n  <p>Multiple goroutines may invoke methods on a Conn simultaneously.</p>\n</blockquote>\n\n<p>Though I can't speak to the Windows implementation in particular, this statement holds true for all platforms. Since there is no loop in the Windows implementation then <code>WSASend</code> calls must make guarantees that the Unix API does not.</p>\n"}, {"tags": [], "owner": {"reputation": 371, "user_id": 2248790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56d52363db767c88e7da44ee20c3cf81?s=128&d=identicon&r=PG", "display_name": "bitflood", "link": "https://stackoverflow.com/users/2248790/bitflood"}, "is_accepted": true, "score": 0, "last_activity_date": 1469532590, "last_edit_date": 1495540462, "creation_date": 1469532590, "answer_id": 38588711, "question_id": 38565654, "link": "https://stackoverflow.com/questions/38565654/golang-net-conn-write-in-parallel/38588711#38588711", "title": "Golang net.Conn Write in parallel", "body": "<ol>\n<li><p>The <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\">io.Write</a> says that in case of partial write, err will be != nil</p></li>\n<li><p>Found <a href=\"https://stackoverflow.com/questions/28752103/how-to-make-sure-that-wsasend-will-send-the-data\">here</a> on StackOverflow that WSASend need not have a loop around it.</p></li>\n<li><p>From #1 &amp; #2, it implies that I need not acquire lock before calling net.Conn.Write. </p></li>\n</ol>\n\n<p>So my question stands answered.</p>\n"}], "owner": {"reputation": 371, "user_id": 2248790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56d52363db767c88e7da44ee20c3cf81?s=128&d=identicon&r=PG", "display_name": "bitflood", "link": "https://stackoverflow.com/users/2248790/bitflood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4052, "favorite_count": 2, "accepted_answer_id": 38588711, "answer_count": 2, "score": 6, "last_activity_date": 1469532590, "creation_date": 1469443456, "question_id": 38565654, "link": "https://stackoverflow.com/questions/38565654/golang-net-conn-write-in-parallel", "title": "Golang net.Conn Write in parallel", "body": "<p>I have multiple Goroutines sharing a net.Conn object. Can they issue a Write calls simultaneously?</p>\n\n<p>My main concern is that of Write calls which are partially done. Say I intend to wrote 100 bytes, but only 30 were sent, so I need to send 70 more. For this I will typically write a loop:</p>\n\n<pre><code>count := 0\nfor count &lt; len(buf) {\n    byteSent, err := conn.Write(buf[count:])\n    //check error \n\n    count += byteSent\n}\n</code></pre>\n\n<p>But I see that Go implements this loop in <a href=\"https://golang.org/src/net/fd_unix.go\" rel=\"noreferrer\">net.Conn.Write</a> line number 318 and it does so by taking a lock. </p>\n\n<p>However, on <a href=\"https://golang.org/src/net/fd_windows.go\" rel=\"noreferrer\">Windows</a> implementation there is no such loop except that there is a call to WSASend. I do not know how WSASend behaves and could not get much from the MSDN docs</p>\n\n<p>Hence the questions are:</p>\n\n<p>[edit] Added 4th question</p>\n\n<ol>\n<li>Do I need to acquire a lock everytime I write to socket?</li>\n<li>If yes, then the purpose of acquiring the lock in Write implementation is defeated.</li>\n<li>In unix implementation, does it mean that I cannot get byteSent &lt; len(buf) unless err != nil? (I mean am I reading the code correct?)</li>\n<li>Does the WSASend on Windows implements the equivalent loop in Unix implementation </li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15946, "user_id": 4606734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/858769040849894/picture?type=large", "display_name": "ameyCU", "link": "https://stackoverflow.com/users/4606734/ameycu"}, "edited": false, "score": 0, "creation_date": 1469438758, "post_id": 38563990, "comment_id": 64518370, "body": "What if in case you need to acces some function or structure or interface defined in another file in project from <code>main</code> ? Also it helps to follow modular approach to build a project."}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "reply_to_user": {"reputation": 15946, "user_id": 4606734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/858769040849894/picture?type=large", "display_name": "ameyCU", "link": "https://stackoverflow.com/users/4606734/ameycu"}, "edited": false, "score": 0, "creation_date": 1469438909, "post_id": 38563990, "comment_id": 64518456, "body": "@ameyCU Then I just use it. All identifiers from all files within the same package (= directory) are in one single scope."}, {"owner": {"reputation": 930, "user_id": 4328963, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/505Lz.png?s=128&g=1", "display_name": "huygn", "link": "https://stackoverflow.com/users/4328963/huygn"}, "edited": false, "score": 0, "creation_date": 1469439095, "post_id": 38563990, "comment_id": 64518569, "body": "Its when you start making/importing a package to use it in your main package."}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469447025, "post_id": 38563990, "comment_id": 64523364, "body": "Actually there is a way to build all main packages underneath a certain root of the GOPATH subtree, for example: go install -v github.com/foo/bar/... will build and install all executables corresponding to the &#39;package main&#39; packages underneath GOPATH/src/github.com/foo/bar"}], "answers": [{"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1469439968, "post_id": 38564329, "comment_id": 64519113, "body": "Interesting. Do you have a real-life example (Github?) where this is used to some benefit?"}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1469440145, "post_id": 38564329, "comment_id": 64519210, "body": "Regarding the spec: I think we shouldn&#39;t nitpick about Go language and Go implementation, there is only one relevant implementation of the Go language. :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1469440500, "post_id": 38564329, "comment_id": 64519408, "body": "@AndreKR It gives you the option to use package names which otherwise might not be permitted by the underlying operating or file system. See edited answer."}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1469458622, "post_id": 38564329, "comment_id": 64531534, "body": "I wish I could accept both answers. I&#39;ll upvote this one and accept the other, because that&#39;s closer to the question, especially after your comment."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1471045351, "last_edit_date": 1471045351, "creation_date": 1469439553, "answer_id": 38564329, "question_id": 38563990, "link": "https://stackoverflow.com/questions/38563990/what-is-the-purpose-of-the-package-declaration/38564329#38564329", "title": "What is the purpose of the package declaration?", "body": "<p>The missing information you \"have\" is that the package name does not need to be the same as the directory name.</p>\n\n<p>It is perfectly fine to use a package name other than the folder name. If you do so, you still have to import the package based on the directory structure, but after the import you have to refer to it by the name you used in the package clause.</p>\n\n<p>For example, if you have a folder <code>$GOPATH/src/mypck</code>, and in it you have a file <code>a.go</code>:</p>\n\n<pre><code>package apple\n\nconst Pi = 3.14\n</code></pre>\n\n<p>Using this package:</p>\n\n<pre><code>package main\n\nimport (\n    \"mypck\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(apple.Pi)\n}\n</code></pre>\n\n<p>Just like you are allowed to use relative imports but is not advisable, you may use package names other that their containing folder, but this is not advisable also to avoid further misunderstanding.</p>\n\n<p>Note that the specification doesn't even require all files belonging to the same package to be in the same folder (but it may be an <em>implementation</em> requirement). <a href=\"https://golang.org/ref/spec#Package_clause\" rel=\"nofollow\">Spec: Package clause:</a></p>\n\n<blockquote>\n  <p>A set of files sharing the same PackageName form the implementation of a package. An implementation <strong>may</strong> require that all source files for a package inhabit the same directory.</p>\n</blockquote>\n\n<h3>What's the use of this?</h3>\n\n<p>Simple. A package name is a Go <a href=\"https://golang.org/ref/spec#Identifiers\" rel=\"nofollow\">identifier</a>:</p>\n\n<pre><code>identifier = letter { letter | unicode_digit } .\n</code></pre>\n\n<p>Which allows unicode letters to be used in identifiers, e.g. <code>\u03b1\u03b2</code> is a valid identifier in Go. Folder and file names are not handled by Go but by the Operating System, and different file systems have different restrictions. There are actually many file systems which would not allow all valid Go identifiers as folder names, so you would not be able to name your packages what otherwise the language spec would allow.</p>\n\n<p>So in one hand not all valid Go identifiers may be valid folder names. And on the other hand, not all valid folder names are valid Go identifiers, for example <code>go-math</code> is a valid folder name in most (all?) file systems, but it's not a valid Go identifier (as identifiers cannot contain the dash <code>-</code> character).</p>\n\n<p>Having the option to use package names different than their containing folders, you have the option to really name your packages what the language spec allows, regardless of the underlying operating and file system, and put it in a folder named anything that the underlying OS and file system allows - regardless of the package name.</p>\n"}, {"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1469444686, "post_id": 38564881, "comment_id": 64521913, "body": "&quot;package main is not useless - it tells the Go compiler to create an executable as opposed to a .a library file.&quot; Hm, I can&#39;t reproduce that. When my package is called something other than <code>main</code>, <code>go build</code> does absolutely nothing."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 2, "creation_date": 1469445227, "post_id": 38564881, "comment_id": 64522244, "body": "@AndreKR See: <a href=\"http://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a>"}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1469448086, "post_id": 38564881, "comment_id": 64524076, "body": "thanks @icza - edited the answer to mention the difference between &quot;go install&quot; and &quot;go build&quot; in this respect.  A &quot;fringe&quot; case when &quot;go build&quot; retains the compiled library is when you run it with &quot;-work&quot; option, ex. go build -x -work - the compiled .a can be then found underneath the WORK directory which does not get deleted with this option."}], "tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": true, "score": 8, "last_activity_date": 1469447913, "last_edit_date": 1469447913, "creation_date": 1469441204, "answer_id": 38564881, "question_id": 38563990, "link": "https://stackoverflow.com/questions/38563990/what-is-the-purpose-of-the-package-declaration/38564881#38564881", "title": "What is the purpose of the package declaration?", "body": "<p>The name of the package does not have to coincide with the directory name.  It is possible to have <code>package foobar</code> in the directory <code>xyz/go-foobar</code>.  In this case, <code>xyz/go-foobar</code> becomes an <strong>import path</strong>, but the <strong>package name</strong> that you use to quality the identifiers (functions, types etc.) would be <code>foobar</code>.</p>\n\n<p>Here's an example to make it more concrete: I created a test package <a href=\"http://godoc.org/github.com/dmitris/go-foobar\" rel=\"noreferrer\">http://godoc.org/github.com/dmitris/go-foobar</a> (source in <a href=\"https://github.com/dmitris/go-foobar\" rel=\"noreferrer\">https://github.com/dmitris/go-foobar</a>) - you can see from the documentation page, that the import path is \"github.com/dmitris/go-foobar\" but the package name is <code>foobar</code>, so you would call the function it provides as <code>foobar.Demo()</code> (not <code>go-foobar.Demo()</code>).  </p>\n\n<p>A similar real-life example - the import path for the NSQ Messaging platform is \"github.com/nsqio/go-nsq\" while the package name is \"nsq\": <a href=\"http://godoc.org/github.com/nsqio/go-nsq\" rel=\"noreferrer\">http://godoc.org/github.com/nsqio/go-nsq</a>.  However, for the sake of user-friendliness and simplicity, the standard and recommended practice is to keep the last portions of the import path and the package name being the same whenever possible.</p>\n\n<p><code>package main</code> is not useless - it tells the Go compiler to create an executable as opposed to a .a library file (with <code>go install</code> or <code>go get</code>; <code>go build</code> discards the compilation result).  The executable is named after the directory name in which the <code>package main</code> file or files are placed.  Again a concrete example - I made a test program <a href=\"https://github.com/dmitris/go-foobar-client\" rel=\"noreferrer\">https://github.com/dmitris/go-foobar-client</a>, you install it with <code>go get github.com/dmitris/go-foobar-client</code> and you should get a <code>go-foobar-client</code> executable placed in your $GOPATH/bin directory. It is from the the directory name where the <code>package main</code> file is placed that the Go compiler takes the name of the executable from.  The filename of the <code>.go</code> file that contains the <code>main()</code> function is not important - in the example above, we can rename <code>main.go</code> to <code>client.go</code> or something else, but as long as the enclosing directory is called <code>go-foobar-client</code>, that's how the resulting executable will be named.</p>\n\n<p>For an additional accessible and practically oriented reading about Go packages, I recommend Dave Cheney's article \"Five suggestions for setting up a Go project\" <a href=\"http://dave.cheney.net/2014/12/01/five-suggestions-for-setting-up-a-go-project\" rel=\"noreferrer\">http://dave.cheney.net/2014/12/01/five-suggestions-for-setting-up-a-go-project</a>.</p>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2326, "favorite_count": 2, "accepted_answer_id": 38564881, "answer_count": 2, "score": 12, "last_activity_date": 1471045351, "creation_date": 1469438517, "last_edit_date": 1469439030, "question_id": 38563990, "link": "https://stackoverflow.com/questions/38563990/what-is-the-purpose-of-the-package-declaration", "title": "What is the purpose of the package declaration?", "body": "<p>Every Go file starts with <code>package &lt;something&gt;</code>.</p>\n\n<p>As far as I understand - and this is probably where I am missing some information - there are only two possible values for <code>&lt;something&gt;</code>: The name of the directory it is in*, or <code>main</code>. If it is <code>main</code>, all other files in that directory can only have <code>main</code>, too. If it is something else, the project is inconsistent/violating convention.</p>\n\n<p>Now if it is the name of the directory, it's redundant, because the same information is, well, in the name of the directory.</p>\n\n<p>If it is <code>main</code>, it's kind of useless, because as far as I can see there is no way to tell <code>go build</code> to \"please build <em>all</em> <code>main</code> packages\".</p>\n\n<p><sup>* Because, in other words, one directory is one package.</sup></p>\n"}, {"tags": ["testing", "go", "io", "mocking", "stdout"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469437703, "post_id": 38563583, "comment_id": 64517713, "body": "What do you mean by using a <code>bufio.NewScanner</code> on <code>stdout</code>? Are you creating a new scanner using <code>stdout</code>?"}, {"owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1469438587, "post_id": 38563583, "comment_id": 64518260, "body": "@abhink yes <code>bufio.NewScanner(os.Stdout)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": false, "score": 2, "last_activity_date": 1469440245, "creation_date": 1469440245, "answer_id": 38564562, "question_id": 38563583, "link": "https://stackoverflow.com/questions/38563583/mock-a-stdout-stream-for-bufio-newscanner/38564562#38564562", "title": "Mock a stdout stream for bufio.NewScanner", "body": "<p>You can use <code>bytes.Buffer</code> since it implements the <code>io.Reader</code> functions.</p>\n\n<p><strong>Example</strong> <a href=\"https://play.golang.org/p/gjjMmT3SzD\" rel=\"nofollow\">https://play.golang.org/p/gjjMmT3SzD</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    buf := bytes.NewBufferString(\"foo\\nbar\")\n    scanner := bufio.NewScanner(buf)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "edited": false, "score": 0, "creation_date": 1469449182, "post_id": 38565403, "comment_id": 64524835, "body": "Thanks for the detailed explanation, that makes a whole lot of sense now!"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 5, "last_activity_date": 1469442757, "creation_date": 1469442757, "answer_id": 38565403, "question_id": 38563583, "link": "https://stackoverflow.com/questions/38563583/mock-a-stdout-stream-for-bufio-newscanner/38565403#38565403", "title": "Mock a stdout stream for bufio.NewScanner", "body": "<p>To simply test your code you can use @Sven's answer.</p>\n\n<p>To get an idea of a simple <code>io.Reader</code> for testing, consider below example:</p>\n\n<pre><code>type R struct {\n    Data string\n    done bool\n}\n\nfunc (r *R) Read(p []byte) (n int, err error) {\n    copy(p, []byte(r.Data))\n    if r.done {\n        return 0, io.EOF\n    }\n    r.done = true\n    return len([]byte(r.Data)), nil\n}\n</code></pre>\n\n<p><code>R</code> is a custom test type that's implementing an <code>io.Reader</code> interface by having a <code>Read</code> method. Thus, it will be accepted by <code>NewScanner</code>. It can be used as:</p>\n\n<pre><code>func NewR(data string) *R {\n    return &amp;R{data, false}\n}\n\nr := NewR(\"Test\\nmessage\\n\")\nscanner := bufio.NewScanner(r)\n\nfor scanner.Scan() {\n    fmt.Printf(\"Line: %s\\n\", scanner.Text())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Line: Test \nLine: message\n</code></pre>\n\n<p>Both the type <code>R</code> and its <code>Read</code> method have been defined to work as a simple source of bytes. <code>Scan</code> calls its reader's (input to <code>NewScanner</code>) <code>Read</code> method until it gets an <code>EOF</code> or an error. For simplicity, <code>R</code>'s <code>Read</code> method copies its data to caller's buffer (<code>p</code>) in its first call and returns an <code>EOF</code> for any subsequent calls.</p>\n\n<p>Note that actual splitting of the lines at <code>\\n</code> is done by <code>scanner.Scan</code> and not <code>r.Read</code>.</p>\n\n<p>You can modify the <code>Read</code> method above to get custom behavior as per your requirements.</p>\n\n<p>Working example: <a href=\"https://play.golang.org/p/zqDoQDIE93\" rel=\"noreferrer\">https://play.golang.org/p/zqDoQDIE93</a></p>\n"}], "owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 800, "favorite_count": 1, "accepted_answer_id": 38565403, "answer_count": 2, "score": 1, "last_activity_date": 1469442757, "creation_date": 1469437387, "question_id": 38563583, "link": "https://stackoverflow.com/questions/38563583/mock-a-stdout-stream-for-bufio-newscanner", "title": "Mock a stdout stream for bufio.NewScanner", "body": "<p>I want to write a test for a utility function where I use <code>bufio.NewScanner</code> and <code>Scan()</code>. I usually use it on <code>stdout</code> and now I want to simulate a short piece of stream where I can return some static string for the purpose of the test.</p>\n\n<p><code>bufio.NewScanner(r io.Reader)</code> takes a <code>Reader</code> but that only requires a <code>read</code> method. By reading the source code I couldn't figure out from which buffer it reads or how that gets passed in.</p>\n\n<p>How can I mock that in a short and concise way?</p>\n"}, {"tags": ["http", "go", "net-http"], "comments": [{"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 1, "creation_date": 1469447607, "post_id": 38563285, "comment_id": 64523751, "body": "with curl, I think you can also use <code>curl -I https:&#47;&#47;golang.org</code> (reference: <a href=\"https://curl.haxx.se/docs/manpage.html#-I\" rel=\"nofollow noreferrer\">curl.haxx.se/docs/manpage.html#-I</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 1853733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95fa0e937eaadf84f06a427a5b2d8655?s=128&d=identicon&r=PG", "display_name": "hunter_tech", "link": "https://stackoverflow.com/users/1853733/hunter-tech"}, "edited": false, "score": 0, "creation_date": 1578401638, "post_id": 38563299, "comment_id": 105419515, "body": "How to head request with a host"}], "tags": [], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "is_accepted": true, "score": 13, "last_activity_date": 1469436603, "creation_date": 1469436603, "answer_id": 38563299, "question_id": 38563285, "link": "https://stackoverflow.com/questions/38563285/how-to-execute-a-head-request-in-go/38563299#38563299", "title": "How to execute a HEAD Request in GO?", "body": "<p>use <a href=\"https://golang.org/pkg/net/http/#Client.Head\" rel=\"noreferrer\">http.Head()</a></p>\n\n<pre><code>res, err := http.Head(\"https://golang.org\")\nif err != nil {\n    panic(err)\n}\ncontentlength:=res.ContentLength\nfmt.Printf(\"ContentLength:%v\",contentlength)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6583848"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4716, "favorite_count": 3, "accepted_answer_id": 38563299, "answer_count": 1, "score": 6, "last_activity_date": 1469436603, "creation_date": 1469436563, "question_id": 38563285, "link": "https://stackoverflow.com/questions/38563285/how-to-execute-a-head-request-in-go", "title": "How to execute a HEAD Request in GO?", "body": "<p>I want to get the content length of a page using GO net/http? I can do this in terminal using <code>curl -i -X HEAD  https://golang.org</code> and then check the content-length field. </p>\n"}, {"tags": ["session", "dictionary", "go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 4, "last_activity_date": 1469435616, "creation_date": 1469435616, "answer_id": 38563009, "question_id": 38562141, "link": "https://stackoverflow.com/questions/38562141/set-map-struct-to-session-in-golang-gin-gonic-framework/38563009#38563009", "title": "Set map,struct to session in golang( gin gonic framework)", "body": "<p>You probably forgot to register it, when your app starts you need to have something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/gob\"\n    \"path/to/yourpackage\"\n\nfunc init() {\n    gob.Register(&amp;yourpackage.YourStruct{})\n}\n</code></pre>\n\n<p>You can look here <a href=\"http://www.gorillatoolkit.org/pkg/sessions\" rel=\"nofollow\">http://www.gorillatoolkit.org/pkg/sessions</a> for more information (gin-gonic uses gorilla sessions under the hood)</p>\n"}], "owner": {"reputation": 390, "user_id": 4401682, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a5696cfc9087ea6003bada234cb2c8cb?s=128&d=identicon&r=PG&f=1", "display_name": "Vutuz", "link": "https://stackoverflow.com/users/4401682/vutuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 1, "accepted_answer_id": 38563009, "answer_count": 1, "score": 2, "last_activity_date": 1546280335, "creation_date": 1469432429, "last_edit_date": 1489451415, "question_id": 38562141, "link": "https://stackoverflow.com/questions/38562141/set-map-struct-to-session-in-golang-gin-gonic-framework", "title": "Set map,struct to session in golang( gin gonic framework)", "body": "<p>I am using gin gonic to build a web application. I use <a href=\"https://github.com/gin-gonic/contrib/tree/master/sessions\" rel=\"nofollow\">https://github.com/gin-gonic/contrib/tree/master/sessions</a> to handle session. Forexample, i set a integer value to session: </p>\n\n<pre><code>function Test(c *gin.Context){\n  session:= sessions.Default(c)\n  session.Set(\"mysession\",123)\n  session.Save()\n}\n</code></pre>\n\n<p>And in another controllers, i can get this session by <code>session.Get(\"mysession\")</code>.</p>\n\n<p>But if i set map or struct. I only can get the session in the same controller. something wrong here??</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469429869, "post_id": 38561188, "comment_id": 64513474, "body": "Check <a href=\"https://play.golang.org/p/BuU54evLzJ\" rel=\"nofollow noreferrer\">this demo</a>, does it look like what you are looking for?"}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469432035, "post_id": 38561188, "comment_id": 64514590, "body": "Yes, it does. Thanks. you should have made it as an answer, instead of a comment."}, {"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469433108, "post_id": 38561188, "comment_id": 64515138, "body": "Yes, I understood that now :) Thanks a lot."}, {"owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "edited": false, "score": 0, "creation_date": 1469444213, "post_id": 38561188, "comment_id": 64521652, "body": "the strings in your example are separated with two commas (before &quot;NEW NAME(S) ), is it a typo?"}], "answers": [{"comments": [{"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 0, "creation_date": 1469430702, "post_id": 38561602, "comment_id": 64513868, "body": "There is also a FindStringSubmatch that takes a string and returns a slice of strings."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469432249, "post_id": 38561602, "comment_id": 64514709, "body": "This won&#39;t work if there are 2 or more pairs of keywords in the input string."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1469430464, "creation_date": 1469430464, "answer_id": 38561602, "question_id": 38561188, "link": "https://stackoverflow.com/questions/38561188/golang-regexp-to-match-multiple-patterns-between-keyword-pairs/38561602#38561602", "title": "Golang regexp to match multiple patterns between keyword pairs", "body": "<p>If your input doesn't change then the simplest way would be to use submatches (groups). You can try something like this:</p>\n\n<pre><code>// (?s) is a flag that enables '.' to match newlines\nvar r = regexp.MustCompile(`(?s)CURRENT NAME\\(S\\)(.*)\",,\"NEW NAME\\(S\\)(.*)\"`)\nfmt.Println(r.MatchString(s))\nm := r.FindSubmatch([]byte(s)) // FindSubmatch requires []byte\n\nfor _, match := range m {\n    s := string(match)\n    fmt.Printf(\"Match - %d: %s\\n\", i, strings.Trim(s, \"\\n\")) //remove the newline\n}   \n</code></pre>\n\n<p>Output: (Note that the first match is the entire input string because it completely matches the regex (<a href=\"https://golang.org/pkg/regexp/#Regexp.FindSubmatch\" rel=\"nofollow\">https://golang.org/pkg/regexp/#Regexp.FindSubmatch</a>)</p>\n\n<pre><code>Match - 0: CURRENT NAME(S)\nName1, Name2\",,\"NEW NAME(S)\nNewName1,NewName2\"\nMatch - 1: Name1, Name2\nMatch - 2: NewName1,NewName2\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/0cgBOMumtp\" rel=\"nofollow\">https://play.golang.org/p/0cgBOMumtp</a></p>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1469435371, "creation_date": 1469435371, "answer_id": 38562932, "question_id": 38561188, "link": "https://stackoverflow.com/questions/38561188/golang-regexp-to-match-multiple-patterns-between-keyword-pairs/38562932#38562932", "title": "Golang regexp to match multiple patterns between keyword pairs", "body": "<p>The issue with your regex is that the input string contains newline symbols, and <code>.</code> in Go regex does not match a newline. Another issue is that the <code>.*</code> is a greedy pattern and will match as many symbols as it can up to the <em>last</em> second keyword. Also, you need to escape parentheses in the regex pattern to match the <code>(</code> and <code>)</code> literal symbols.</p>\n\n<p>The best way to solve the issue is to change <code>.*</code> into a negated character class pattern <code>[^\"]*</code> and place it inside a pair of non-escaped <code>(</code> and <code>)</code> to form a <em>capturing group</em> (a construct to get <em>submatches</em> from the match).</p>\n\n<p>Here is a <a href=\"https://play.golang.org/p/UIkrCHCSpE\" rel=\"nofollow\">Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    s := `\"CURRENT NAME(S)\n Name1, Name2\",,\"NEW NAME(S)\nNewName1,NewName2\"`\n    re := regexp.MustCompile(`\"CURRENT NAME\\(S\\)\\s*([^\"]*)\",,\"NEW NAME\\(S\\)\\s*([^\"]*)\"`)\n\n    segs2 := re.FindAllStringSubmatch(s,-1)\n    fmt.Printf(\"segs2: [%s; %s]\", segs2[0][1], segs2[0][2])\n}\n</code></pre>\n\n<p>Now, the regex matches:</p>\n\n<ul>\n<li><code>\"CURRENT NAME\\(S\\)</code> - a literal string \"CURRENT NAME(S)`</li>\n<li><code>\\s*</code> - zero or more whitespaces</li>\n<li><code>([^\"]*)</code> - Group 1 capturing 0+ chars other than <code>\"</code></li>\n<li><code>\",,\"NEW NAME\\(S\\)</code> - a literal string <code>\",,\"NEW NAME(S)</code></li>\n<li><code>\\s*</code> - zero or more whitespaces</li>\n<li><code>([^\"]*)</code> - Group 2 capturing 0+ chars other than <code>\"</code></li>\n<li><code>\"</code>  - a literal <code>\"</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 0, "last_activity_date": 1469445814, "creation_date": 1469445814, "answer_id": 38566455, "question_id": 38561188, "link": "https://stackoverflow.com/questions/38561188/golang-regexp-to-match-multiple-patterns-between-keyword-pairs/38566455#38566455", "title": "Golang regexp to match multiple patterns between keyword pairs", "body": "<p>For a fixed format like in the example, you can also avoid regular expressions and perform explicit parsing as in this example - <a href=\"https://play.golang.org/p/QDIyYiWJHt\" rel=\"nofollow\">https://play.golang.org/p/QDIyYiWJHt</a>:</p>\n\n<pre>\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := `\"CURRENT NAME(S)\n Name1, Name2\",,\"NEW NAME(S)\nNewName1,NewName2\"`\n\n    names := []string{}\n    parts := strings.Split(s, \",,\")\n    for _, part := range parts {\n        part = strings.Trim(part, `\"`)\n        part = strings.TrimPrefix(part, \"CURRENT NAME(S)\")\n        part = strings.TrimPrefix(part, \"NEW NAME(S)\")\n        part = strings.TrimSpace(part)\n        names = append(names, part)\n    }\n    fmt.Println(\"Names:\")\n    for _, name := range names {\n        fmt.Println(name)\n    }\n}\n</pre>\n\n<p>Output:</p>\n\n<pre>\nNames:\nName1, Name2\nNewName1,NewName2\n</pre>\n\n<p>It uses a few more lines of code but may make it easier to understand the processing logic at a first glance.</p>\n"}], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7640, "favorite_count": 0, "accepted_answer_id": 38562932, "answer_count": 3, "score": 1, "last_activity_date": 1469445814, "creation_date": 1469428835, "last_edit_date": 1469438136, "question_id": 38561188, "link": "https://stackoverflow.com/questions/38561188/golang-regexp-to-match-multiple-patterns-between-keyword-pairs", "title": "Golang regexp to match multiple patterns between keyword pairs", "body": "<p>I have a string which has two keywords: \"CURRENT NAME(S)\" and \"NEW NAME(S)\" and each of these keywords are followed by a bunch of words. I want to extract those set of words beyond each of these keywords. To elaborate with a code:</p>\n\n<pre><code>    s := `\"CURRENT NAME(S)\n Name1, Name2\",,\"NEW NAME(S)\nNewName1,NewName2\"`\n    re := regexp.MustCompile(`\"CURRENT NAME(S).*\",,\"NEW NAME(S).*\"`)\n\n    segs := re.FindAllString(s, -1)\n    fmt.Println(\"segs:\", segs)\n\n    segs2 := re.FindAllStringSubmatch(s, -1)\n    fmt.Println(\"segs2:\", segs2)\n</code></pre>\n\n<p>As you can see, the string 's' has the input. \"Name1,Name2\" is the current names list and \"NewName1, NewName2\" is the new names list. I want to extract these two lists. The two lists are separated by a comma. Each of the keywords are beginning with a double quote and their reach ends, when their corresponding double quote ends.</p>\n\n<p>What is the way to use regexp such that the program can print \"<code>Name1, Name2</code>\" and \"<code>NewName1,NewName2</code>\" ?</p>\n"}, {"tags": ["go", "icmp"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1469426815, "creation_date": 1469426815, "answer_id": 38560729, "question_id": 38559074, "link": "https://stackoverflow.com/questions/38559074/trouble-parsing-icmp-messages-in-golang/38560729#38560729", "title": "Trouble parsing icmp messages in golang", "body": "<p><code>message.Body</code> is a <code>MessageBody</code> (<a href=\"https://godoc.org/golang.org/x/net/icmp#MessageBody\" rel=\"nofollow\">https://godoc.org/golang.org/x/net/icmp#MessageBody</a>) which is an interface type.  If you want the underlying type you need to cast it.  One way to do that would be to say</p>\n\n<pre><code>body := message.Body.(*icmp.Echo)\n...\n</code></pre>\n\n<p>This would likely work for you, but if the <code>MessageBody</code> is NOT an <code>icmp.Echo</code> pointer then it will be a panic.  </p>\n\n<p>The type switch makes sure there is no panic.</p>\n\n<p>You could also do</p>\n\n<pre><code>if body, ok := message.Body.(*icmp.Echo); ok {\n    // do something with Body as an *icmp.Echo type\n}\n</code></pre>\n\n<p>to guard against the panic.</p>\n"}], "owner": {"reputation": 1172, "user_id": 4621508, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/7edbd50ad77354c926f108838b77b938?s=128&d=identicon&r=PG&f=1", "display_name": "rumdrums", "link": "https://stackoverflow.com/users/4621508/rumdrums"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 38560729, "answer_count": 1, "score": 0, "last_activity_date": 1469426815, "creation_date": 1469415416, "question_id": 38559074, "link": "https://stackoverflow.com/questions/38559074/trouble-parsing-icmp-messages-in-golang", "title": "Trouble parsing icmp messages in golang", "body": "<p>I'm a newb with Golang and trying to do what seems like a very simple task -- sending a ping with some text in it and reading that text back when I get a reply, but I'm running into some things I don't understand. I've built a ping like this:</p>\n\n<pre><code> ping := icmp.Message{\n    Type: ipv4.ICMPTypeEcho,\n    Code: 0,\n    Body: &amp;icmp.Echo{\n        ID: os.Getpid() &amp; 0xffff,\n        Seq: 1,\n        Data: []byte(\"Hello\"),\n    },\n}\n</code></pre>\n\n<p>Here's the socket read part for context:</p>\n\n<pre><code>buf := make([]byte, 1500)\n_, peer, err := c.ReadFrom(buf)\nmessage, err := icmp.ParseMessage(1, buf)\n</code></pre>\n\n<p>Here's my failed effort to get my data back out of the message body:</p>\n\n<pre><code>body := message.Body;\nfmt.Println(\"body.ID \", body.ID)\nfmt.Println(\"body.Seq \", body.Seq)\nfmt.Println(\"body.Data \", string(body.Data))\n</code></pre>\n\n<p>Go is not happy at build time:</p>\n\n<pre><code>./ping.go:86: body.ID undefined (type icmp.MessageBody has no field or method ID)\n./ping.go:87: body.Seq undefined (type icmp.MessageBody has no field or method Seq)\n./ping.go:88: body.Data undefined (type icmp.MessageBody has no field or method Data)\n</code></pre>\n\n<p>This code, however, which is adapted from <a href=\"https://github.com/tatsushid/go-fastping/blob/master/fastping.go#L649-L658\" rel=\"nofollow\">this awesome project</a>, works just swell:</p>\n\n<pre><code>switch body := message.Body.(type) {\n  case *icmp.Echo:\n    fmt.Println(\"body.ID \", body.ID)\n    fmt.Println(\"body.Seq \", body.Seq)\n    fmt.Println(\"body.Data \", string(body.Data))\n  default:\n    fmt.Println(\"not a *icmp.Echo\")\n}\n</code></pre>\n\n<p>Go is perfectly happy to compile and run this code. Can someone tell me why the code in the type switch works fine, but the first example results in compile errors.  Thank you!</p>\n"}, {"tags": ["http", "azure", "asp.net-web-api", "go", "azure-web-app-service"], "comments": [{"owner": {"reputation": 1171, "user_id": 4836342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db017c5e33e8247e1e98b1288bc4f4ba?s=128&d=identicon&r=PG&f=1", "display_name": "Will Shao - MSFT", "link": "https://stackoverflow.com/users/4836342/will-shao-msft"}, "edited": false, "score": 0, "creation_date": 1469441798, "post_id": 38557968, "comment_id": 64520190, "body": "A question need confirm: Could you can access your ASP.NET API hosted on Azure using IE or other browser, Fiddler? I think the first thing is we should make sure your API works fine on Azure Web App."}, {"owner": {"reputation": 2349, "user_id": 316855, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1e4268090367ad8c19af73ea30561aad?s=128&d=identicon&r=PG", "display_name": "Dominic St-Pierre", "link": "https://stackoverflow.com/users/316855/dominic-st-pierre"}, "reply_to_user": {"reputation": 1171, "user_id": 4836342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db017c5e33e8247e1e98b1288bc4f4ba?s=128&d=identicon&r=PG&f=1", "display_name": "Will Shao - MSFT", "link": "https://stackoverflow.com/users/4836342/will-shao-msft"}, "edited": false, "score": 0, "creation_date": 1469444809, "post_id": 38557968, "comment_id": 64521979, "body": "API working  fine, 80% of request works, it&#39;s periodic, running a failing request via a curl immediately after getting error works."}, {"owner": {"reputation": 2349, "user_id": 316855, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1e4268090367ad8c19af73ea30561aad?s=128&d=identicon&r=PG", "display_name": "Dominic St-Pierre", "link": "https://stackoverflow.com/users/316855/dominic-st-pierre"}, "reply_to_user": {"reputation": 1171, "user_id": 4836342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db017c5e33e8247e1e98b1288bc4f4ba?s=128&d=identicon&r=PG&f=1", "display_name": "Will Shao - MSFT", "link": "https://stackoverflow.com/users/4836342/will-shao-msft"}, "edited": false, "score": 1, "creation_date": 1469450711, "post_id": 38557968, "comment_id": 64525959, "body": "Will Shao wrote a C# equivalent app and when running using the Azure endpoint it&#39;s painfully slow, issue is not with Go at all, but fact that same app with same database is running bad once deployed to Azure."}, {"owner": {"reputation": 1508, "user_id": 1623047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/424e84c6326aba4507829062cf6d6431?s=128&d=identicon&r=PG", "display_name": "&#211;scar Andreu", "link": "https://stackoverflow.com/users/1623047/%c3%93scar-andreu"}, "edited": false, "score": 0, "creation_date": 1541661336, "post_id": 38557968, "comment_id": 93294113, "body": "You can try to add Application Insights to the API and use it to try to figure out was going on."}], "answers": [{"tags": [], "owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "is_accepted": false, "score": 0, "last_activity_date": 1555015937, "last_edit_date": 1555015937, "creation_date": 1555015458, "answer_id": 55640882, "question_id": 38557968, "link": "https://stackoverflow.com/questions/38557968/net-http-request-canceled-client-timeout-exceeded-while-awaiting-headers-why/55640882#55640882", "title": "net/http: request canceled (Client.Timeout exceeded while awaiting headers) why/what to do with this?", "body": "<p>I think you might want to use thing like context, go routines and channels to not lockup your main. Similar to Task in c# which also gives you more Throughput and performance.</p>\n\n<p><a href=\"https://marcofranssen.nl/tags/go/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/tags/go/</a></p>\n\n<p>You can find a bunch of blog posts I wrote. I also have c# background and these blogs are some of my lessons learned. I do refer to c# vs Go approach in the blogs so that should make easy for you to compare.</p>\n\n<p>Check out the go routines and the graceful webserver posts. You might find your answer there.</p>\n\n<p>Also your c# implementation is blocking due to the call to .Result</p>\n\n<p>You should use async await which makes code way more efficient, utilizing Task.</p>\n\n<p>I expect your c# server probably also isn't using Task as a return type meaning it will not be able to cope with huge amount of connections. As soon you use Task there and spin code in New threads that will also be able to handle more concurrent request and succeed probably more often. So basically do db stuff in separate thread/task and make sure to dispose database connections to prevent memory leaks.</p>\n\n<p>It is just an assumption, as I notice the client code in this post also doesn't use this properly. So forgive me if I am wrong with my assumption.</p>\n"}], "owner": {"reputation": 2349, "user_id": 316855, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1e4268090367ad8c19af73ea30561aad?s=128&d=identicon&r=PG", "display_name": "Dominic St-Pierre", "link": "https://stackoverflow.com/users/316855/dominic-st-pierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 8381, "favorite_count": 0, "protected_date": 1569685610, "answer_count": 1, "score": 4, "last_activity_date": 1616706265, "creation_date": 1469404023, "last_edit_date": 1469460833, "question_id": 38557968, "link": "https://stackoverflow.com/questions/38557968/net-http-request-canceled-client-timeout-exceeded-while-awaiting-headers-why", "title": "net/http: request canceled (Client.Timeout exceeded while awaiting headers) why/what to do with this?", "body": "<p>TL:DR - Look at edit 2 for a C# equivalent of code http client code, resulting in ~same issue, so Go http.Client is not the real problem, but C# Web API once deployed to Azure...</p>\n\n<p>I'm getting very bad performance from a C# Web API once deployed to Azure Web App [2x Standard S3]. At first I was asking re: Go's http.Client timeout, but writing a similar client in C# and NodeJs gave same results.</p>\n\n<p>This is my http.Client:</p>\n\n<pre><code>func getWebClient() *http.Client {\n    var netTransport = &amp;http.Transport{\n        Dial: (&amp;net.Dialer{\n            Timeout: 5 * time.Second,\n        }).Dial,\n        TLSHandshakeTimeout:   10 * time.Second,\n        MaxIdleConnsPerHost:   2000,\n        ResponseHeaderTimeout: 10 * time.Second,\n    }\n\n    var netClient = &amp;http.Client{\n        Timeout:   time.Second * 10,\n        Transport: netTransport,\n    }\n\n    return netClient\n}\n</code></pre>\n\n<p>Error I'm getting:</p>\n\n<p><code>net/http: request canceled (Client.Timeout exceeded while awaiting headers)</code></p>\n\n<p>It can be on GET, POST, PUT. I'm getting those error, yet running a failing GET with curl immediately got a reply.</p>\n\n<p>This is a sample Get function I'm using to call an API:</p>\n\n<pre><code>func get(path string, result interface{}) error {\n    req, err := http.NewRequest(\"GET\", webDALAPIURL+path, nil)\n    if err != nil {\n        return err\n    }\n\n    req.Header.Set(\"Content-Type\", \"application/json\")\n\n    wc := getWebClient()\n    res, err := wc.Do(req)\n    if err != nil {\n        return err\n    }\n    defer res.Body.Close()\n\n    if res.StatusCode &gt;= 400 {\n        return fmt.Errorf(\"[GET] %d - %s\", res.StatusCode, webDALAPIURL+path)\n    }\n\n    decoder := json.NewDecoder(res.Body)\n    return decoder.Decode(result)\n}\n</code></pre>\n\n<p>Fun fact, never encountered those error when the API was running locally. API is a C# ASP.NET Web API app. </p>\n\n<p>I started to have lots of TLS Handshake error, so I dropped the https for the Azure app endpoint. Now I'm getting this error.</p>\n\n<p>I'm tailing the logs for the app, and nothing is occurring [the API being called]. Seems like Go is unable to make multiple call to same host. I'm not event using goroutine in one cmd and using them in another, both results in same errors.</p>\n\n<p>When the API is running on a Windows computer in same network, never had that error during development.</p>\n\n<p>Edit 1:</p>\n\n<p>Note that 80-85% of the requests are working well, the scenario is that (pseudo code):</p>\n\n<pre><code>for item in items {\n  http get /item/{id} =&gt; works 90% of the time, 10% timeout\n\n  change item properties\n\n  http PUT /item/{id} =&gt; works 80% of the time\n}\n</code></pre>\n\n<p>I added a retry in the <code>get()</code> function, so if the timeout occurs it's retrying the get, and this seems to works. Although, I don't like this  workaround at all.</p>\n\n<p>Also note that we are talking about quick GET that are returning timeout, when I run them from curl, it's &lt; 1sec. Same for the PUT, those are highly simplistic database SELECT * FROM TABLE WHERE ID = {id} AND UPDATE.</p>\n\n<p>The Azure Web app that runs the API is 2 instance of Standard S3.</p>\n\n<p>The fact that the retry for the GET worked looks like, it's most certainly the API / Azure app not taking the load, which is impossible for the simplicity and we are talking about less than 10 requests / seconds.</p>\n\n<p>Another point not negligible, when running on dev server, the same Azure SQL Database was used, so the SELECT/UPDATE perf should be the exact same on dev and on Azure Web App. </p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>The speed comparing same C# Web API from local to Azure is disturbing. I wrote a similar C# http client to test Azure vs Local Web API.</p>\n\n<pre><code>class Program\n{\n  static int fails = 0;\n  static void Main(string[] args)\n  {\n    for (int i = 0; i &lt; 2000; i++)\n    {\n      get(i);\n    }\n    Console.WriteLine(\"completed: \" + fails.ToString());\n    Console.ReadLine();\n  }\n  static void get(int id)\n  {\n    id += 22700;\n    var c = new HttpClient();\n\n    var resp = c.GetAsync(\"http://myapphere.azurewebsites.net/api/users/\" + id).Result;\n    if (!resp.IsSuccessStatusCode)\n    {\n      Console.WriteLine(\"\");\n      fails++;\n      Console.WriteLine(string.Format(\"error getting /users status code {0}\", resp.StatusCode));\n    }\n    else\n    {\n      Console.Write(\".\");\n    }\n  }\n}\n</code></pre>\n\n<p>Running this console app <strong>against Azure</strong> I can clearly see where Go's getting time out, it's painfully slow, no error are returned, but the Console.Write(\".\"); takes forever to print, are are periodic, can print ~fast for 3-4 than it stopped.</p>\n\n<p>Changing this <strong>to localhost:1078</strong> again <strong>same database used</strong> there's no paused, and the Console.Write(\".\") are printing like 20x the speed compare to Azure.</p>\n\n<p>How is that possible?</p>\n\n<p>Edit 3:</p>\n\n<p>Just added global error handler on the web api, maybe the slovenliness could be caused by too much Exception being thrown. Added a <code>Trace.TraceError</code> and I <code>azure site log tail</code> it, again nothing was displayed.</p>\n\n<p>I would go as far as saying that the local web api is running 25-30x faster than the 2x instance of Azure Standard S3. Clearly that can't be true, but the web api is so simple that I don't see what I can do to have Azure run it at full speed.</p>\n"}, {"tags": ["go", "middleware", "fasthttp"], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 1225672, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c375628694f0866fac0ba8e63c4470bd?s=128&d=identicon&r=PG", "display_name": "aldo", "link": "https://stackoverflow.com/users/1225672/aldo"}, "edited": false, "score": 0, "creation_date": 1479043103, "post_id": 38576085, "comment_id": 68384006, "body": "i got these errors: undefined: fasthttprouter.Handler and undefined: fasthttprouter.Params what should i do?"}, {"owner": {"reputation": 2836, "user_id": 1359163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/063e1984ad8cb19353c311ba3a9290b9?s=128&d=identicon&r=PG", "display_name": "KBN", "link": "https://stackoverflow.com/users/1359163/kbn"}, "reply_to_user": {"reputation": 163, "user_id": 1225672, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c375628694f0866fac0ba8e63c4470bd?s=128&d=identicon&r=PG", "display_name": "aldo", "link": "https://stackoverflow.com/users/1225672/aldo"}, "edited": false, "score": 0, "creation_date": 1480443910, "post_id": 38576085, "comment_id": 68961306, "body": "@aldo import these packages <code>github.com&#47;buaazp&#47;fasthttprouter</code> and <code>github.com&#47;valyala&#47;fasthttp</code>"}, {"owner": {"reputation": 385, "user_id": 1717298, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/b5f589d045716dbd8e118635b9e83fed?s=128&d=identicon&r=PG", "display_name": "Uday Swami", "link": "https://stackoverflow.com/users/1717298/uday-swami"}, "reply_to_user": {"reputation": 2836, "user_id": 1359163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/063e1984ad8cb19353c311ba3a9290b9?s=128&d=identicon&r=PG", "display_name": "KBN", "link": "https://stackoverflow.com/users/1359163/kbn"}, "edited": false, "score": 0, "creation_date": 1499949198, "post_id": 38576085, "comment_id": 77133865, "body": "@KBN Even after implementing these packages I&#39;m facing the issue aldo mentioned"}, {"owner": {"reputation": 2836, "user_id": 1359163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/063e1984ad8cb19353c311ba3a9290b9?s=128&d=identicon&r=PG", "display_name": "KBN", "link": "https://stackoverflow.com/users/1359163/kbn"}, "reply_to_user": {"reputation": 385, "user_id": 1717298, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/b5f589d045716dbd8e118635b9e83fed?s=128&d=identicon&r=PG", "display_name": "Uday Swami", "link": "https://stackoverflow.com/users/1717298/uday-swami"}, "edited": false, "score": 0, "creation_date": 1500020645, "post_id": 38576085, "comment_id": 77168074, "body": "@UdaySwami Maybe they updated the packages, I don&#39;t use those. So I&#39;m not really sure."}, {"owner": {"reputation": 419, "user_id": 10395454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6noTQ.jpg?s=128&g=1", "display_name": "Ugur Kazdal", "link": "https://stackoverflow.com/users/10395454/ugur-kazdal"}, "edited": false, "score": 0, "creation_date": 1589446846, "post_id": 38576085, "comment_id": 109299464, "body": "How could i send this gfuy a cookie"}], "tags": [], "owner": {"reputation": 3258, "user_id": 2058014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a12b9d9a9cd413b4ddccd046428f72c?s=128&d=identicon&r=PG&f=1", "display_name": "Brrrr", "link": "https://stackoverflow.com/users/2058014/brrrr"}, "is_accepted": true, "score": 18, "last_activity_date": 1553851984, "last_edit_date": 1553851984, "creation_date": 1469475546, "answer_id": 38576085, "question_id": 38557843, "link": "https://stackoverflow.com/questions/38557843/fasthttp-fasthttprouter-trying-to-write-middleware/38576085#38576085", "title": "Fasthttp + fasthttprouter, trying to write middleware", "body": "<p>for example, let us create a middleware function that will handle CORS using:</p>\n\n<p><em><a href=\"https://github.com/buaazp/fasthttprouter\" rel=\"noreferrer\">github.com/buaazp/fasthttprouter</a></em> and <em><a href=\"https://github.com/valyala/fasthttp\" rel=\"noreferrer\">github.com/valyala/fasthttp</a></em></p>\n\n<pre><code>var (\n    corsAllowHeaders     = \"authorization\"\n    corsAllowMethods     = \"HEAD,GET,POST,PUT,DELETE,OPTIONS\"\n    corsAllowOrigin      = \"*\"\n    corsAllowCredentials = \"true\"\n)\n\nfunc CORS(next fasthttp.RequestHandler) fasthttp.RequestHandler {\n    return func(ctx *fasthttp.RequestCtx) {\n\n        ctx.Response.Header.Set(\"Access-Control-Allow-Credentials\", corsAllowCredentials)\n        ctx.Response.Header.Set(\"Access-Control-Allow-Headers\", corsAllowHeaders)\n        ctx.Response.Header.Set(\"Access-Control-Allow-Methods\", corsAllowMethods)\n        ctx.Response.Header.Set(\"Access-Control-Allow-Origin\", corsAllowOrigin)\n\n        next(ctx)\n    }\n}\n</code></pre>\n\n<p>Now we chain this middleware function on our Index handler and register it on the router.</p>\n\n<pre><code>func Index(ctx *fasthttp.RequestCtx) {\n    fmt.Fprint(ctx, \"some-api\")\n}\n\nfunc main() {\n    router := fasthttprouter.New()\n    router.GET(\"/\", Index)\n\n    if err := fasthttp.ListenAndServe(\":8181\", CORS(router.Handler)); err != nil {\n        log.Fatalf(\"Error in ListenAndServe: %s\", err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 6202570, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1637704046473431/picture?type=large", "display_name": "Denys Adamenko", "link": "https://stackoverflow.com/users/6202570/denys-adamenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1527594195, "creation_date": 1527594195, "answer_id": 50583539, "question_id": 38557843, "link": "https://stackoverflow.com/questions/38557843/fasthttp-fasthttprouter-trying-to-write-middleware/50583539#50583539", "title": "Fasthttp + fasthttprouter, trying to write middleware", "body": "<p>Example of auth middleware for fasthttp &amp; fasthttprouter (new versions)</p>\n\n<pre><code>type Middleware func(h fasthttp.RequestHandler) fasthttp.RequestHandler\ntype AuthFunc func(ctx *fasthttp.RequestCtx) bool\nfunc NewAuthMiddleware(authFunc AuthFunc) Middleware {\n    return func(h fasthttp.RequestHandler) fasthttp.RequestHandler {\n        return func(ctx *fasthttp.RequestCtx) {\n            result, err: = authFunc(ctx)\n            if result {\n                h(ctx)\n            } else {\n                ctx.Response.SetStatusCode(fasthttp.StatusUnauthorized)\n            }\n        }\n    }\n}\n\nfunc AuthCheck(ctx *fasthttp.RequestCtx)(bool, error) {\n    return false; // for example ;)\n}\n\n// router\nauthMiddleware: = middleware.NewAuthMiddleware(security.AuthCheck)\n    ...\nrouter.GET(\"/protected\", authMiddleware(handlers.ProtectedHandler))\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6038, "favorite_count": 5, "accepted_answer_id": 38576085, "answer_count": 2, "score": 5, "last_activity_date": 1553851984, "creation_date": 1469402622, "last_edit_date": 1521176437, "question_id": 38557843, "link": "https://stackoverflow.com/questions/38557843/fasthttp-fasthttprouter-trying-to-write-middleware", "title": "Fasthttp + fasthttprouter, trying to write middleware", "body": "<p>I'm currently trying to write some middleware to work with fasthttp and fasthttprouter. And I'm stuck.</p>\n\n<pre><code>func jwt(h fasthttprouter.Handle) fasthttprouter.Handle {\nmyfunc := func(ctx *fasthttp.RequestCtx, _ fasthttprouter.Params) {\n    fmt.Println(string(ctx.Request.Header.Cookie(\"Authorization\")))\n}\n\nreturn myfunc\n}\n</code></pre>\n\n<p>How do I run the actual handler now? I feel like i'm missing something very simple.</p>\n\n<p>I've read through this blog post: <a href=\"https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81#.ssb07reu3/\" rel=\"nofollow\">Middleware in Golang</a>. But i'm lost.</p>\n\n<p>Any ideas?</p>\n\n<p>Regards</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "amazon-cloudtrail", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 5920601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/746515270f433083eba2d6bb8065c336?s=128&d=identicon&r=PG&f=1", "display_name": "ruman hassan", "link": "https://stackoverflow.com/users/5920601/ruman-hassan"}, "edited": false, "score": 0, "creation_date": 1469401098, "post_id": 38557575, "comment_id": 64506411, "body": "Thanks for replying. The Guide that you provided shows steps to be followed through AWS console. Is there something similar that i can do through aws-go-sdk. I mean adding/specifying S3 bucket policy through Go-SDK"}, {"owner": {"reputation": 11362, "user_id": 5017586, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6cf237e6b3b0f4e8ed76d138336bed4?s=128&d=identicon&r=PG&f=1", "display_name": "error2007s", "link": "https://stackoverflow.com/users/5017586/error2007s"}, "reply_to_user": {"reputation": 49, "user_id": 5920601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/746515270f433083eba2d6bb8065c336?s=128&d=identicon&r=PG&f=1", "display_name": "ruman hassan", "link": "https://stackoverflow.com/users/5920601/ruman-hassan"}, "edited": false, "score": 0, "creation_date": 1469401468, "post_id": 38557575, "comment_id": 64506486, "body": "Check this <a href=\"https://github.com/aws/aws-sdk-go/tree/master/service/iam\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go/tree/master/service/iam</a> there is a example file where you can attached different policies check examples_test.go file."}, {"owner": {"reputation": 49, "user_id": 5920601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/746515270f433083eba2d6bb8065c336?s=128&d=identicon&r=PG&f=1", "display_name": "ruman hassan", "link": "https://stackoverflow.com/users/5920601/ruman-hassan"}, "edited": false, "score": 0, "creation_date": 1469433650, "post_id": 38557575, "comment_id": 64515459, "body": "Thanks a ton, it worked for me, able to create Trail successfully now."}], "tags": [], "owner": {"reputation": 11362, "user_id": 5017586, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6cf237e6b3b0f4e8ed76d138336bed4?s=128&d=identicon&r=PG&f=1", "display_name": "error2007s", "link": "https://stackoverflow.com/users/5017586/error2007s"}, "is_accepted": true, "score": 0, "last_activity_date": 1469400236, "creation_date": 1469400236, "answer_id": 38557575, "question_id": 38557503, "link": "https://stackoverflow.com/questions/38557503/aws-cloudtrail-create-api-for-go-sdk-throwing-error-mesage-insufficients3bucket/38557575#38557575", "title": "AWS CloudTrail Create API for Go SDK throwing error mesage &quot;InsufficientS3BucketPolicyException: Incorrect S3 bucket policy is detected for bucket: &quot;", "body": "<p>Your Cloud Trail should have this policy for the S3 bucket. Follow this guide there are different options in the step.</p>\n\n<p><a href=\"http://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html\" rel=\"nofollow\">http://docs.aws.amazon.com/awscloudtrail/latest/userguide/create-s3-bucket-policy-for-cloudtrail.html</a></p>\n\n<pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AWSCloudTrailAclCheck20150319\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"cloudtrail.amazonaws.com\"\n            },\n            \"Action\": \"s3:GetBucketAcl\",\n            \"Resource\": \"arn:aws:s3:::myBucketName\"\n        },\n        {\n            \"Sid\": \"AWSCloudTrailWrite20150319\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Service\": \"cloudtrail.amazonaws.com\"\n            },\n            \"Action\": \"s3:PutObject\",\n            \"Resource\": \"arn:aws:s3:::myBucketName/[optional prefix]/AWSLogs/myAccountID/*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n                }\n            }\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6567, "user_id": 1103953, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/107522343c9ed3b01cdc0d3eece92241?s=128&d=identicon&r=PG", "display_name": "RtmY", "link": "https://stackoverflow.com/users/1103953/rtmy"}, "is_accepted": false, "score": 0, "last_activity_date": 1597253569, "creation_date": 1597253569, "answer_id": 63381885, "question_id": 38557503, "link": "https://stackoverflow.com/questions/38557503/aws-cloudtrail-create-api-for-go-sdk-throwing-error-mesage-insufficients3bucket/63381885#63381885", "title": "AWS CloudTrail Create API for Go SDK throwing error mesage &quot;InsufficientS3BucketPolicyException: Incorrect S3 bucket policy is detected for bucket: &quot;", "body": "<p>Make sure that after you add the policy mentioned in the accepted answer that there is a match between your bucket's <code>name</code>, <code>prefix</code> and <code>accountID</code> and the values specified here:</p>\n<pre><code>&quot;Resource&quot;: &quot;arn:aws:s3:::myBucketName/&lt;prefix&gt;/AWSLogs/myAccountID/*&quot;\n</code></pre>\n<p>Also make sure that the <code>&quot;*&quot;</code> postfix exist.</p>\n<p>Wrong configuration there will lead to the same error.</p>\n"}], "owner": {"reputation": 49, "user_id": 5920601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/746515270f433083eba2d6bb8065c336?s=128&d=identicon&r=PG&f=1", "display_name": "ruman hassan", "link": "https://stackoverflow.com/users/5920601/ruman-hassan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1392, "favorite_count": 0, "accepted_answer_id": 38557575, "answer_count": 2, "score": 2, "last_activity_date": 1597253569, "creation_date": 1469399723, "last_edit_date": 1489209579, "question_id": 38557503, "link": "https://stackoverflow.com/questions/38557503/aws-cloudtrail-create-api-for-go-sdk-throwing-error-mesage-insufficients3bucket", "title": "AWS CloudTrail Create API for Go SDK throwing error mesage &quot;InsufficientS3BucketPolicyException: Incorrect S3 bucket policy is detected for bucket: &quot;", "body": "<p>I am trying to create a cloudtrail using Go SDK. Successfully able to connect AWS without any issue by following AWS doc. </p>\n\n<p>I Followed below steps for creating a trail </p>\n\n<p>Step1 - Created S3 Bucket, so that all trail log files can be placed in this bucket. </p>\n\n<p><strong>CreateS3Bucket: Code</strong> </p>\n\n<pre><code>func CreateS3Bucket(bucketName string) error {\nbucketName := \"s3-bucket-123\"\nsvc := s3.New(session.New(&amp;aws.Config{Region: aws.String(\"us-east-1\")}))\n\nparams := &amp;s3.CreateBucketInput{\n    Bucket: aws.String(bucketName), // Required\n}\nresp, err1 := svc.CreateBucket(params)\n\nif err1 != nil {\n    // Print the error, cast err to awserr.Error to get the Code and\n    // Message from an error.\n    log.Errorf(\"S3 Bucket Creation Fails: %s\", err1.Error())\n    errs := errors.New(\"500\")\n    return errs\n}\n\n// Pretty-print the response data.\nlog.Infof(\"Bucket Successfully created: %s\", resp)\nreturn nil\n}\n</code></pre>\n\n<p><strong>Success Response:</strong> </p>\n\n<pre><code>{\\n  Location: \\\"/s3-bucket-123\\\"\\n}\" \n</code></pre>\n\n<p>Step2 - Create CloudTrail</p>\n\n<p><strong>CreateCloudTrail:</strong> <strong>Code</strong></p>\n\n<pre><code>func (ref *AwsCloudTrail) CreateCloudTrail(bucketName, trailName string) error {\nsvc := cloudtrail.New(session.New(&amp;aws.Config{Region: aws.String(\"us-east-1\")}))\n\n//bucketName is \"s3-bucket-123\" and trailName is cloudtrail123\n\nparams := &amp;cloudtrail.CreateTrailInput{\n    Name:                       aws.String(trailName), // Required\n    S3BucketName:               aws.String(bucketName), // Required\n}\n\nresp, errs := svc.CreateTrail(params)\n\nif errs != nil {\n    // Print the error, cast err to awserr.Error to get the Code and\n    // Message from an error.\n    log.Errorf(\"Error while creating trail %v\",errs.Error())\n    err := errors.New(\"500\")\n    return err\n}\n\n// Pretty-print the response data.\nlog.Infof(\"create trail response: %s\",resp)\n\nreturn nil\n}\n</code></pre>\n\n<p><strong>Response</strong></p>\n\n<pre><code>\"Error while creating trail InsufficientS3BucketPolicyException: Incorrect S3 bucket policy is detected for bucket: s3-bucket-123\\n\\tstatus code: 400, request id: 203d63d6-51ea-11e6-bb2c-b5d25b86e418\" \n</code></pre>\n\n<p>Can anyone please tell me where i am doing wrong. what S3 Policy do i need to specify while creating Trail</p>\n\n<p>Any Help/Suggestion is really appreciated</p>\n\n<p>Reference:\n<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/cloudtrail/#CloudTrail.CreateTrail\" rel=\"nofollow\">https://docs.aws.amazon.com/sdk-for-go/api/service/cloudtrail/#CloudTrail.CreateTrail</a></p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CreateBucket\" rel=\"nofollow\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CreateBucket</a></p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 1304, "user_id": 5125201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff70a4545b368f2aca2a97de7b234b2?s=128&d=identicon&r=PG", "display_name": "Ammar Bandukwala", "link": "https://stackoverflow.com/users/5125201/ammar-bandukwala"}, "edited": false, "score": 0, "creation_date": 1469387333, "post_id": 38555568, "comment_id": 64502505, "body": "If you&#39;re always comparing to <code>err</code> in your switch, why not use <code>switch err{}</code> instead?"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1469392217, "post_id": 38555568, "comment_id": 64503963, "body": "Which &quot;database/sql&quot; documentation are you referring to? That code is most definitely not in the Postgres manual"}, {"owner": {"reputation": 1108, "user_id": 1356472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d0ee816d272a19a793a3f2192545c84?s=128&d=identicon&r=PG", "display_name": "Sue Spence", "link": "https://stackoverflow.com/users/1356472/sue-spence"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1469393371, "post_id": 38555568, "comment_id": 64504282, "body": "@a_horse_with_no_name: <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#DB.Query</a>, expand the example for QueryRow."}], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1469425397, "post_id": 38556663, "comment_id": 64511569, "body": "Documentation patch seems like the right path. If they want their code to work, they should really use an example query that can return 0 or 1 rows, like &#39;select id from user where email=$1&#39; (assuming a unique index on email). Aggregates always returning a row (even a row containing nulls) threw them off."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1469479564, "post_id": 38556663, "comment_id": 64543455, "body": "Oh, I hadn&#39;t realized the code in the question is a variation of the doc sample with a different query, not the exact code. The documentation is right as Spencer Judd said--the problem is in the subtle difference between a non-aggregate query that looks at no rows (and returns nothing) vs. an aggregate one (that returns NULL)."}], "tags": [], "owner": {"reputation": 1108, "user_id": 1356472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d0ee816d272a19a793a3f2192545c84?s=128&d=identicon&r=PG", "display_name": "Sue Spence", "link": "https://stackoverflow.com/users/1356472/sue-spence"}, "is_accepted": false, "score": 1, "last_activity_date": 1469393562, "creation_date": 1469393562, "answer_id": 38556663, "question_id": 38555568, "link": "https://stackoverflow.com/questions/38555568/example-in-database-sql-using-sql-errnorows-crashes-and-burns/38556663#38556663", "title": "Example in database/sql using sql.ErrNoRows crashes and burns", "body": "<p>I reworked the code to get the results I wanted.</p>\n\n<pre><code>// Get the karma value for nick from the database.\nfunc getKarma(nick string, db *sql.DB) string {\n    var karma int\n    rows, err := db.Query(\"SELECT SUM(delta) FROM karma WHERE nick = $1\", nick)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n    karmaStr := fmt.Sprintf(\"%s has no karma.\", nick)\n    if rows.Next() {\n        rows.Scan(&amp;karma)\n        karmaStr = fmt.Sprintf(\"Karma for %s is %d.\", nick, karma)\n    }\n    return karmaStr\n}\n</code></pre>\n\n<p>Tempted to submit a documentation patch of some sort to the database/sql package.</p>\n"}, {"tags": [], "owner": {"reputation": 399, "user_id": 585787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d26803627dcba40bce391b324552bf0?s=128&d=identicon&r=PG", "display_name": "Spencer Judd", "link": "https://stackoverflow.com/users/585787/spencer-judd"}, "is_accepted": true, "score": 2, "last_activity_date": 1469449093, "last_edit_date": 1469449093, "creation_date": 1469413985, "answer_id": 38558922, "question_id": 38555568, "link": "https://stackoverflow.com/questions/38555568/example-in-database-sql-using-sql-errnorows-crashes-and-burns/38558922#38558922", "title": "Example in database/sql using sql.ErrNoRows crashes and burns", "body": "<p>I believe your issue is that you're getting a <code>NULL</code> value back from the database, which go translates into <code>nil</code>. However, you're scanning into an integer, which has no concept of <code>nil</code>. One thing you can do is scan into a type that implements the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow\"><code>sql.Scanner</code></a> interface (and can handle <code>NULL</code> values), e.g., <a href=\"https://golang.org/pkg/database/sql/#NullInt64\" rel=\"nofollow\"><code>sql.NullInt64</code></a>.</p>\n\n<p>In the example code in the <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow\">documentation</a>, I'd assume they have a <code>NOT NULL</code> constraint on the <code>username</code> column. I think the reason for this is because they didn't want to lead people to believe that you <em>have</em> to use NULL-able types across the board.</p>\n"}], "owner": {"reputation": 1108, "user_id": 1356472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d0ee816d272a19a793a3f2192545c84?s=128&d=identicon&r=PG", "display_name": "Sue Spence", "link": "https://stackoverflow.com/users/1356472/sue-spence"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1390, "favorite_count": 0, "accepted_answer_id": 38558922, "answer_count": 2, "score": 2, "last_activity_date": 1469449093, "creation_date": 1469386131, "last_edit_date": 1469424697, "question_id": 38555568, "link": "https://stackoverflow.com/questions/38555568/example-in-database-sql-using-sql-errnorows-crashes-and-burns", "title": "Example in database/sql using sql.ErrNoRows crashes and burns", "body": "<p>I have a small Go program which uses a a postgresql db. In it there is a query which can return no rows, and the code I'm using to deal with this isn't working correctly.</p>\n\n<pre><code>    // Get the karma value for nick from the database.\nfunc getKarma(nick string, db *sql.DB) string {\n    var karma int\n    err := db.QueryRow(\"SELECT SUM(delta) FROM karma WHERE nick = $1\", nick).Scan(&amp;karma)\n    var karmaStr string\n    switch {\n    case err == sql.ErrNoRows:\n        karmaStr = fmt.Sprintf(\"%s has no karma.\", nick)\n    case err != nil:\n        log.Fatal(err)\n    default:\n       karmaStr = fmt.Sprintf(\"Karma for %s is %d.\", nick, karma)\n    }\n    return karmaStr\n}\n</code></pre>\n\n<p>This logic is taken directly from the <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow\">Go documentation</a>. When there are no rows corresponding to <strong>nick</strong>, the following error occurs:</p>\n\n<pre><code>2016/07/24 19:37:07 sql: Scan error on column index 0: converting driver.Value type &lt;nil&gt; (\"&lt;nil&gt;\") to a int: invalid syntax\n</code></pre>\n\n<p>I must be doing something stupid - clues appreciated.</p>\n"}, {"tags": ["go", "allocation"], "answers": [{"comments": [{"owner": {"reputation": 742, "user_id": 1006006, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7e18db000f12082ea6b1a68ae678701?s=128&d=identicon&r=PG", "display_name": "Vishal Kumar", "link": "https://stackoverflow.com/users/1006006/vishal-kumar"}, "edited": false, "score": 0, "creation_date": 1469403304, "post_id": 38557195, "comment_id": 64506819, "body": "This is what i would expect. Except above bench mark shows for smaller string, there is no allocation in both the cases. But it behaves as expected for bigger string."}, {"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "reply_to_user": {"reputation": 742, "user_id": 1006006, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7e18db000f12082ea6b1a68ae678701?s=128&d=identicon&r=PG", "display_name": "Vishal Kumar", "link": "https://stackoverflow.com/users/1006006/vishal-kumar"}, "edited": false, "score": 0, "creation_date": 1469431414, "post_id": 38557195, "comment_id": 64514221, "body": "You should have a look at the compiled code. <code>go test -c</code> and then <code>go tool objdump -s &#39;BenchmarkHashing&#39; main.test.exe</code>."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 742, "user_id": 1006006, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7e18db000f12082ea6b1a68ae678701?s=128&d=identicon&r=PG", "display_name": "Vishal Kumar", "link": "https://stackoverflow.com/users/1006006/vishal-kumar"}, "edited": false, "score": 0, "creation_date": 1469460986, "post_id": 38557195, "comment_id": 64533014, "body": "@VishalKumar You actually shouldn&#39;t see an allocation in <i>either</i> case for the <code>bytes.Buffer</code> version.  Bytes.Buffer has a built-in 64-byte array in its structure for handling small data sets without (extra) allocation, and neither of those tests exceed 64 bytes per write operation.  If you move the <code>bufByte.Reset()</code> outside the for loop, I have a feeling you&#39;ll see more equitable results."}, {"owner": {"reputation": 742, "user_id": 1006006, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7e18db000f12082ea6b1a68ae678701?s=128&d=identicon&r=PG", "display_name": "Vishal Kumar", "link": "https://stackoverflow.com/users/1006006/vishal-kumar"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1469470464, "post_id": 38557195, "comment_id": 64538525, "body": "@Kaedys Question is not about why no allocation for bytes.Buffer. There will be single allocation outside loop. It is as expected in result. Question is why not allocation for other case when string is small."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1469546734, "post_id": 38557195, "comment_id": 64576122, "body": "Thinking about it, I have a hunch you&#39;re seeing a compiler optimization, tbh.  Try assigning the value in that <code>bytStr</code> slice to another global slice to prevent the compiler from optimizing it out.  As long as you&#39;re assigning to a defined global slice variable (<i>NOT</i> appending to the global slice), there shouldn&#39;t be any extra allocation for that assignment, just the filling of a pointer and the setting of a pair of ints in the slice header.  Example: <a href=\"https://play.golang.org/p/FchGznDWNC\" rel=\"nofollow noreferrer\">play.golang.org/p/FchGznDWNC</a>"}], "tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": -1, "last_activity_date": 1469397145, "creation_date": 1469397145, "answer_id": 38557195, "question_id": 38554773, "link": "https://stackoverflow.com/questions/38554773/when-golang-does-allocation-for-string-to-byte-conversion/38557195#38557195", "title": "When golang does allocation for string to byte conversion", "body": "<p>When you write something into a <code>byte.Buffer</code>, it allocates memory as needed. When you call <code>byte.Buffer.Reset</code>, that memory is not freed but instead kept for later reuse. And your code does exactly that. It marks the buffer as empty and then fills it again.</p>\n\n<p>Actually, there <em>is</em> some allocation going on, but when iterating 50000000 times, it is negligible. But if you move the declaration for <code>bufByte</code> into the <code>for</code> loop, you will get some allocations.</p>\n"}, {"tags": [], "owner": {"reputation": 627, "user_id": 39476, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f073542d0cb2993da3fb78bb82986f16?s=128&d=identicon&r=PG", "display_name": "Francis Stephens", "link": "https://stackoverflow.com/users/39476/francis-stephens"}, "is_accepted": false, "score": 4, "last_activity_date": 1503482788, "creation_date": 1503482788, "answer_id": 45836716, "question_id": 38554773, "link": "https://stackoverflow.com/questions/38554773/when-golang-does-allocation-for-string-to-byte-conversion/45836716#45836716", "title": "When golang does allocation for string to byte conversion", "body": "<p>Your benchmarks are observing a curious optimisation by the Golang compiler (version 1.8).</p>\n\n<p>You can see the PR from Dmitry Dvyukov here</p>\n\n<p><a href=\"https://go-review.googlesource.com/c/go/+/3120\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/go/+/3120</a></p>\n\n<p>Unfortunately that is from a long time ago, when the compiler was written in C, I am not sure where to find the optimisation in the current compiler. But I can confirm that it still exists, and Dmitry's PR description is accurate.</p>\n\n<p>If you want a clearer self contained set of benchmarks to demonstrate this I have a gist here.</p>\n\n<p><a href=\"https://gist.github.com/fmstephe/f0eb393c4ec41940741376ab08cbdf7e\" rel=\"nofollow noreferrer\">https://gist.github.com/fmstephe/f0eb393c4ec41940741376ab08cbdf7e</a></p>\n\n<p>If we look only at the second benchmark <code>BenchmarkHashingWithNew900000000</code> we can see a clear spot where it 'should' allocate.</p>\n\n<pre><code>bytStr := []byte(testString)\n</code></pre>\n\n<p>This line must copy the contents of <code>testString</code> into a new <code>[]byte</code>. However in this case the compiler can see that <code>bytStr</code> is never used again after <code>Sum32</code> returns. Therefore it can be allocated on the stack. However, as strings can be arbitrarily large a limit is set to 32 bytes for a stack allocated <code>string</code> or <code>[]byte</code>.</p>\n\n<p>It's worth being aware of this little trick, because it can be easy to trick yourself into believing some code does not allocate, if your benchmark strings are all short.</p>\n"}], "owner": {"reputation": 742, "user_id": 1006006, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c7e18db000f12082ea6b1a68ae678701?s=128&d=identicon&r=PG", "display_name": "Vishal Kumar", "link": "https://stackoverflow.com/users/1006006/vishal-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2327, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1503482788, "creation_date": 1469381287, "last_edit_date": 1469383376, "question_id": 38554773, "link": "https://stackoverflow.com/questions/38554773/when-golang-does-allocation-for-string-to-byte-conversion", "title": "When golang does allocation for string to byte conversion", "body": "<pre><code>var testString = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n//var testString = \"ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nfunc BenchmarkHashing900000000(b *testing.B){\n    var bufByte = bytes.Buffer{}\n    for i := 0; i &lt; b.N ; i++{\n        bufByte.WriteString(testString)\n        Sum32(bufByte.Bytes())\n        bufByte.Reset()\n    }\n}\n\nfunc BenchmarkHashingWithNew900000000(b *testing.B){\n    for i := 0; i &lt; b.N ; i++{\n        bytStr := []byte(testString)\n        Sum32(bytStr)\n    }\n}\n</code></pre>\n\n<p>test result:  </p>\n\n<pre><code>With  testString = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nBenchmarkHashing900000000-4         50000000            35.2 ns/op         0 B/op          0 allocs/op\nBenchmarkHashingWithNew900000000-4  50000000            30.9 ns/op         0 B/op          0 allocs/op\n\nWith testString = \"ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nBenchmarkHashing900000000-4         30000000            46.6 ns/op         0 B/op          0 allocs/op\nBenchmarkHashingWithNew900000000-4  20000000            73.0 ns/op        64 B/op          1 allocs/op\n</code></pre>\n\n<p>Why there is allocation in case of BenchmarkHashingWithNew900000000 when string is long but no allocation when string is small.<br>\nSum32 : <a href=\"https://gowalker.org/github.com/spaolacci/murmur3\" rel=\"noreferrer\">https://gowalker.org/github.com/spaolacci/murmur3</a><br>\n<strong>I am using go1.6</strong></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1469407504, "post_id": 38554480, "comment_id": 64507560, "body": "Is there a library that provide a set of functions to do string checking?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 1, "creation_date": 1469413314, "post_id": 38554480, "comment_id": 64508744, "body": "@CasperLI : to name a few: strings, fmt, regexp, strconv, unicode, unicode/utf8, unicode/utf16, path/filepath, net/url, bytes, bufio, encoding/json, time,  ..."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 2, "creation_date": 1469425130, "post_id": 38554480, "comment_id": 64511491, "body": "@CasperLI To (freely) quote Rob Pike: &quot;A little bit of copying is better than a little more dependency&quot;."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 1, "creation_date": 1469426515, "post_id": 38554480, "comment_id": 64511968, "body": "Why there is no a collection of string-checking functions on standard lib or github so that we can directly call those functions in one line?"}, {"owner": {"reputation": 1922, "user_id": 49775, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2e6161e8c45bd7775ecf862b77ca6e76?s=128&d=identicon&r=PG", "display_name": "Dave Cameron", "link": "https://stackoverflow.com/users/49775/dave-cameron"}, "edited": false, "score": 0, "creation_date": 1505241097, "post_id": 38554480, "comment_id": 79329216, "body": "Also useful to know a character can be converted to a rune with a regular type conversion <code>unicode.IsLetter(rune(&#39;a&#39;))</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3646022"}, "reply_to_user": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1545158539, "post_id": 38554480, "comment_id": 94526663, "body": "@Kin A one-liner is possible using <code>len(strings.TrimFunc(candidateString, unicode.IsLetter)) == 0</code>"}, {"owner": {"reputation": 2400, "user_id": 1103700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365175c40356861c03385615db1adfdd?s=128&d=identicon&r=PG", "display_name": "WeakPointer", "link": "https://stackoverflow.com/users/1103700/weakpointer"}, "edited": false, "score": 0, "creation_date": 1570377621, "post_id": 38554480, "comment_id": 102886596, "body": "I particularly like the example where regexp/MustCompile/Match are used on a single line to provide a function that is very description."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 69, "last_activity_date": 1469382279, "last_edit_date": 1469382279, "creation_date": 1469379332, "answer_id": 38554480, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go/38554480#38554480", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>you may use <code>unicode.IsLetter</code> like this working sample code:   </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"unicode\"\n\nfunc IsLetter(s string) bool {\n    for _, r := range s {\n        if !unicode.IsLetter(r) {\n            return false\n        }\n    }\n    return true\n}\nfunc main() {\n    fmt.Println(IsLetter(\"Alex\")) // true\n    fmt.Println(IsLetter(\"123\"))  // false\n}\n</code></pre>\n\n<p>or if you have limited range e.g. 'a'..'z' and 'A'..'Z', you may use this working sample code:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc IsLetter(s string) bool {\n    for _, r := range s {\n        if (r &lt; 'a' || r &gt; 'z') &amp;&amp; (r &lt; 'A' || r &gt; 'Z') {\n            return false\n        }\n    }\n    return true\n}\nfunc main() {\n    fmt.Println(IsLetter(\"Alex\"))  // true\n    fmt.Println(IsLetter(\"123 a\")) // false\n\n}\n</code></pre>\n\n<p>or if you have limited range e.g. 'a'..'z' and 'A'..'Z', you may use this working sample code:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nvar IsLetter = regexp.MustCompile(`^[a-zA-Z]+$`).MatchString\n\nfunc main() {\n    fmt.Println(IsLetter(\"Alex\")) // true\n    fmt.Println(IsLetter(\"u123\")) // false\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 12, "creation_date": 1519140208, "post_id": 38554509, "comment_id": 84782174, "body": "<code>&#233;</code> is an alphabetic character."}], "tags": [], "owner": {"reputation": 339, "user_id": 6512964, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Kve6f8BM-o/AAAAAAAAAAI/AAAAAAAAB08/DZEVoRhF9Fw/photo.jpg?sz=128", "display_name": "Tom Cleveland", "link": "https://stackoverflow.com/users/6512964/tom-cleveland"}, "is_accepted": false, "score": 8, "last_activity_date": 1469379548, "creation_date": 1469379548, "answer_id": 38554509, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go/38554509#38554509", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>Here's the way I'd do it:</p>\n\n<pre><code>import \"strings\"\n\nconst alpha = \"abcdefghijklmnopqrstuvwxyz\"\n\nfunc alphaOnly(s string) bool {\n   for _, char := range s {  \n      if !strings.Contains(alpha, strings.ToLower(string(char))) {\n         return false\n      }\n   }\n   return true\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 6, "last_activity_date": 1469381662, "creation_date": 1469381662, "answer_id": 38554835, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go/38554835#38554835", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>Assuming you're only looking for ascii letters, you would normally see this implemented as a regular expression using the alpha character class <code>[[:alpha:]]</code> or the equivalent <code>[A-Za-z]</code></p>\n\n<pre><code>isAlpha := regexp.MustCompile(`^[A-Za-z]+$`).MatchString\n\nfor _, username := range []string{\"userone\", \"user2\", \"user-three\"} {\n    if !isAlpha(username) {\n        fmt.Printf(\"%q is not valid\\n\", username)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lT9Fki7tt7\" rel=\"noreferrer\">https://play.golang.org/p/lT9Fki7tt7</a></p>\n"}, {"tags": [], "owner": {"reputation": 1926, "user_id": 5077455, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tpoV2.jpg?s=128&g=1", "display_name": "stwykd", "link": "https://stackoverflow.com/users/5077455/stwykd"}, "is_accepted": false, "score": 3, "last_activity_date": 1560850169, "creation_date": 1560850169, "answer_id": 56645940, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go/56645940#56645940", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>You can also do this concisely without importing any packages</p>\n\n<pre><code>func isLetter(c rune) bool {\n    return ('a' &lt;= c &amp;&amp; c &lt;= 'z') || ('A' &lt;= c &amp;&amp; c &lt;= 'Z')\n}\n\nfunc isWord(s string) bool {\n    for _, c := range s {\n        if !isLetter(c) {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "is_accepted": false, "score": 1, "last_activity_date": 1599145536, "creation_date": 1599145536, "answer_id": 63726432, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go/63726432#63726432", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>One approach is to use <a href=\"https://golang.org/pkg/strings/#FieldsFunc\" rel=\"nofollow noreferrer\"><code>FieldsFunc</code> from Go's <code>strings</code> library</a>.</p>\n<p>The following compares each character in the username with the set of unicode letters.  Similar to the <code>strings.Split</code> function, <code>FieldsFunc</code> splits the username into a slice along boundaries of non-matching characters (in this case, unicode letters).  Below, we compare the original username with the joined elements of the slice.</p>\n<pre><code>func lettersOnly(username string) bool {\n    nonLetter := func(c rune) bool { return !unicode.IsLetter(c) }\n    words := strings.FieldsFunc(username, nonLetter)\n    return username == strings.Join(words, &quot;&quot;)\n}\n</code></pre>\n<p>Playground Example: <a href=\"https://play.golang.org/p/4aWKCu9upox\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4aWKCu9upox</a></p>\n<p>We can also compare the username against a list of very specific characters, combining <code>strings.FieldsFunc</code> with <code>strings.ContainsAny</code>.</p>\n<pre><code>func hawaiianOnly(username string) bool {\n    hawaiian := `aeiouhklmnpw\u02bb`\n    nonCharacter := func(c rune) bool { return !strings.ContainsAny(hawaiian, strings.ToLower(string(c))) }\n    words := strings.FieldsFunc(username, nonCharacter)\n    return username == strings.Join(words, &quot;&quot;)\n}\n</code></pre>\n<p>Playground Example:<a href=\"https://play.golang.org/p/ipwAOC3c72P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ipwAOC3c72P</a></p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44941, "favorite_count": 8, "accepted_answer_id": 38554480, "answer_count": 5, "score": 36, "last_activity_date": 1608457417, "creation_date": 1469378451, "last_edit_date": 1469386782, "question_id": 38554353, "link": "https://stackoverflow.com/questions/38554353/how-to-check-if-a-string-only-contains-alphabetic-characters-in-go", "title": "How to check if a string only contains alphabetic characters in Go?", "body": "<p>I am trying to check the username whether is only containing alphabetic characters. What is the idiomatic way to check it in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469372675, "post_id": 38553299, "comment_id": 64497682, "body": "A udp socket can be &quot;connected&quot;, and only a connected udp socket really satisfies a <code>net.Conn</code>."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469378883, "post_id": 38553299, "comment_id": 64499714, "body": "(1/2) To add to what @JimB said, it stems back to a design choice (one that I think was pretty stupid) from the original Berkeley sockets API that has become the standard in Unix-like systems. Sockets, in this API, are stream-oriented data sources. Think a TCP connection or a file - unless the stream has been disconnected or closed, there&#39;s always a logical &quot;next byte&quot; to read, and it always makes sense to write a &quot;next byte&quot; to the stream. The problem is that UDP packets are not ordered, so UDP sockets don&#39;t fit this paradigm."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1469379024, "post_id": 38553299, "comment_id": 64499761, "body": "(2/2) The solution was to pretend that there are &quot;UDP streams.&quot; In practice, a UDP stream is just a way of sending UDP packets without having to specify the source address/port or destination address/port because those were specified during setup. This acts a <i>little bit</i> like a normal TCP socket because all of the data is sent from the same sender and to the same receiver. But, since it&#39;s UDP, there&#39;s still no guarantee that data will be ordered properly, will not be dropped, will not be duplicated, etc."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "reply_to_user": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 1, "creation_date": 1469385097, "post_id": 38553299, "comment_id": 64501742, "body": "@joshlf What&#39;s stupid about that? There are plenty of cases where it&#39;s acceptable for a stream to be lossy (live audio, video)."}, {"owner": {"reputation": 108, "user_id": 4764951, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cUX8P3Rr9SM/AAAAAAAAAAI/AAAAAAAACg4/Y10AEKR7GmQ/photo.jpg?sz=128", "display_name": "felix.infinite", "link": "https://stackoverflow.com/users/4764951/felix-infinite"}, "reply_to_user": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1469385502, "post_id": 38553299, "comment_id": 64501866, "body": "@joshlf Despite what you said... I was not sure what would happen if I write to the socket... and no receiver address is provided. Where will the UDP payload go to ? The standard documentation provides no such information. Or maybe I did not understand the UDP protocol enough."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 1, "creation_date": 1469397468, "post_id": 38553299, "comment_id": 64505489, "body": "@JonathonReinhart - it&#39;s mostly just that it&#39;s unintuitive. Having run a college-level networking class, I can tell you that many people were confused by that behavior and it caused a lot of bugs for people who just didn&#39;t realize that that&#39;s how it behaved. I&#39;m not saying it&#39;s necessarily wrong, just very unintuitive (which, in my book, is a negative in and of itself)."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 1, "creation_date": 1469397502, "post_id": 38553299, "comment_id": 64505496, "body": "@felix.infinite - if I&#39;m not mistaken, it should generate an error. But I&#39;d just try it and see what happens. It&#39;s easy enough to test."}], "owner": {"reputation": 108, "user_id": 4764951, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cUX8P3Rr9SM/AAAAAAAAAAI/AAAAAAAACg4/Y10AEKR7GmQ/photo.jpg?sz=128", "display_name": "felix.infinite", "link": "https://stackoverflow.com/users/4764951/felix-infinite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 303, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1469371580, "creation_date": 1469371580, "question_id": 38553299, "link": "https://stackoverflow.com/questions/38553299/why-does-the-net-udpconn-struct-implement-the-net-conn-interface", "title": "Why does the *net.UDPConn struct implement the net.Conn interface?", "body": "<p><strong>*net.UDPConn</strong> is a packet-oriented protocol. So it makes sense for it to implement the <em>net.PacketConn</em> interface. However, it is confusing why it also implements the <em>net.Conn</em> interface, which is a connection-oriented protocol ( also implemented by <strong>*net.TCPConn</strong>) .</p>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594289905, "post_id": 38552803, "comment_id": 111076910, "body": "<code>strconv.FormatBool(t)</code> to set <code>true</code> to \u201ctrue\u201d. <code>strconv.ParseBool(&quot;true&quot;)</code> to set \u201ctrue\u201d to <code>true</code>. See <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3258, "user_id": 2058014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a12b9d9a9cd413b4ddccd046428f72c?s=128&d=identicon&r=PG&f=1", "display_name": "Brrrr", "link": "https://stackoverflow.com/users/2058014/brrrr"}, "is_accepted": true, "score": 179, "last_activity_date": 1469369356, "creation_date": 1469369356, "answer_id": 38552924, "question_id": 38552803, "link": "https://stackoverflow.com/questions/38552803/how-to-convert-a-bool-to-a-string-in-go/38552924#38552924", "title": "How to convert a bool to a string in Go?", "body": "<p>use the strconv package</p>\n\n<p><a href=\"https://golang.org/pkg/strconv/#FormatBool\">docs</a></p>\n\n<p><code>strconv.FormatBool(v)</code></p>\n\n<blockquote>\n  <p>func FormatBool(b bool) string FormatBool returns \"true\" or \"false\"<br>\n  according to the value of b</p>\n</blockquote>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 9, "last_activity_date": 1469390754, "last_edit_date": 1469390754, "creation_date": 1469369415, "answer_id": 38552933, "question_id": 38552803, "link": "https://stackoverflow.com/questions/38552803/how-to-convert-a-bool-to-a-string-in-go/38552933#38552933", "title": "How to convert a bool to a string in Go?", "body": "<p>you may use <code>strconv.FormatBool</code> like this:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strconv\"\n\nfunc main() {\n    isExist := true\n    str := strconv.FormatBool(isExist)\n    fmt.Println(str)        //true\n    fmt.Printf(\"%q\\n\", str) //\"true\"\n}\n</code></pre>\n\n<p>or you may use <code>fmt.Sprint</code> like this:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    isExist := true\n    str := fmt.Sprint(isExist)\n    fmt.Println(str)        //true\n    fmt.Printf(\"%q\\n\", str) //\"true\"\n}\n</code></pre>\n\n<p>or write like <code>strconv.FormatBool</code>:  </p>\n\n<pre><code>// FormatBool returns \"true\" or \"false\" according to the value of b\nfunc FormatBool(b bool) string {\n    if b {\n        return \"true\"\n    }\n    return \"false\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6840, "user_id": 1353549, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/413d2645039577214eb6382b3166e1c4?s=128&d=identicon&r=PG", "display_name": "akim", "link": "https://stackoverflow.com/users/1353549/akim"}, "is_accepted": false, "score": 9, "last_activity_date": 1511268233, "creation_date": 1511268233, "answer_id": 47413424, "question_id": 38552803, "link": "https://stackoverflow.com/questions/38552803/how-to-convert-a-bool-to-a-string-in-go/47413424#47413424", "title": "How to convert a bool to a string in Go?", "body": "<p>Just use <code>fmt.Sprintf(\"%v\", isExist)</code>, as you would for almost all the types.</p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 25, "last_activity_date": 1534891466, "last_edit_date": 1534891466, "creation_date": 1534890558, "answer_id": 51957548, "question_id": 38552803, "link": "https://stackoverflow.com/questions/38552803/how-to-convert-a-bool-to-a-string-in-go/51957548#51957548", "title": "How to convert a bool to a string in Go?", "body": "<p>The two main options are:</p>\n\n<ol>\n<li><a href=\"https://golang.org/pkg/strconv/#FormatBool\" rel=\"noreferrer\"><code>strconv.FormatBool(bool) string</code></a></li>\n<li><a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"noreferrer\"><code>fmt.Sprintf(string, bool) string</code></a> with the <code>\"%t\"</code> or <code>\"%v\"</code> formatters.</li>\n</ol>\n\n<p>Note that <code>strconv.FormatBool(...)</code> is <em>considerably</em> faster than <code>fmt.Sprintf(...)</code> as demonstrated by the following benchmarks:</p>\n\n<pre><code>func Benchmark_StrconvFormatBool(b *testing.B) {\n  for i := 0; i &lt; b.N; i++ {\n    strconv.FormatBool(true)  // =&gt; \"true\"\n    strconv.FormatBool(false) // =&gt; \"false\"\n  }\n}\n\nfunc Benchmark_FmtSprintfT(b *testing.B) {\n  for i := 0; i &lt; b.N; i++ {\n    fmt.Sprintf(\"%t\", true)  // =&gt; \"true\"\n    fmt.Sprintf(\"%t\", false) // =&gt; \"false\"\n  }\n}\n\nfunc Benchmark_FmtSprintfV(b *testing.B) {\n  for i := 0; i &lt; b.N; i++ {\n    fmt.Sprintf(\"%v\", true)  // =&gt; \"true\"\n    fmt.Sprintf(\"%v\", false) // =&gt; \"false\"\n  }\n}\n</code></pre>\n\n<p>Run as:</p>\n\n<pre><code>$ go test -bench=. ./boolstr_test.go \ngoos: darwin\ngoarch: amd64\nBenchmark_StrconvFormatBool-8       2000000000           0.30 ns/op\nBenchmark_FmtSprintfT-8             10000000           130 ns/op\nBenchmark_FmtSprintfV-8             10000000           130 ns/op\nPASS\nok      command-line-arguments  3.531s\n</code></pre>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75639, "favorite_count": 7, "accepted_answer_id": 38552924, "answer_count": 4, "score": 101, "last_activity_date": 1534891466, "creation_date": 1469368592, "question_id": 38552803, "link": "https://stackoverflow.com/questions/38552803/how-to-convert-a-bool-to-a-string-in-go", "title": "How to convert a bool to a string in Go?", "body": "<p>I am trying to convert a <code>bool</code> called <code>isExist</code> to a <code>string</code> (<code>true</code> or <code>false</code>) by using <code>string(isExist)</code> but it does not work. What is the idiomatic way to do this in Go?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": 13, "last_activity_date": 1469364290, "creation_date": 1469364290, "answer_id": 38552164, "question_id": 38552095, "link": "https://stackoverflow.com/questions/38552095/when-to-use-global-variables/38552164#38552164", "title": "When to use global variables", "body": "<p>Not all global variables are bad. In your case:</p>\n\n<ul>\n<li>The global variable is in the <code>main</code> package and therefore only accessible by a single program. This is ok.</li>\n<li>The global variable is initialized once and not modified thereafter. This is ok.</li>\n</ul>\n\n<p>On the other hand, whenever a global variable is modified during the program\u2019s execution, the program becomes more difficult to understand. Therefore it should be avoided.</p>\n\n<p>In a package that is meant to be reusable, global variables should be avoided since then two users of that package might influence each other. Imagine if the <code>json</code> package had a global variable <code>var Indent bool</code>. Such a variable is better to be hidden inside a data structure like <code>JsonFormatter</code> that gets created anew each time someone wants to format some JSON.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 11, "last_activity_date": 1469364649, "last_edit_date": 1592644375, "creation_date": 1469364337, "answer_id": 38552169, "question_id": 38552095, "link": "https://stackoverflow.com/questions/38552095/when-to-use-global-variables/38552169#38552169", "title": "When to use global variables", "body": "<p>One usual way is to use <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"noreferrer\">Method Value</a></p>\n<blockquote>\n<p>Consider a <code>struct type T</code> with two methods, <code>Mv</code>, whose receiver is of type <code>T</code>, and <code>Mp</code>, whose receiver is of type <code>*T</code>.</p>\n</blockquote>\n<pre><code>type T struct { \n    a int\n}\nfunc (tv  T) Mv(a int) int         { return 0 }  // value receiver\nfunc (tp *T) Mp(f float32) float32 { return 1 }  // pointer receiver\n\nvar t T\n</code></pre>\n<blockquote>\n<p>The expression</p>\n</blockquote>\n<pre><code>T.Mv\n</code></pre>\n<blockquote>\n<p>yields a function equivalent to Mv but with an explicit receiver as its first argument; it has signature</p>\n</blockquote>\n<pre><code>func(tv T, a int) int\n</code></pre>\n<p>You can see an example of Method Value <a href=\"https://dmitri.shuralyov.com/blog/19\" rel=\"noreferrer\">in this thread</a></p>\n<pre><code>// TODO: Get rid of the global variable.\nvar foo service\n\nfunc handleFoo(w http.ResponseWriter, req *http.Request) {\n    // code that uses foo\n}\n\nfunc main() {\n    foo = initFoo()\n\n    http.HandleFunc(&quot;/foo&quot;, handleFoo)\n}\n</code></pre>\n<blockquote>\n<p>One way to get rid of that global variable is to use method values:</p>\n</blockquote>\n<pre><code>type fooHandler struct {\n    foo service\n}\n\nfunc (h fooHandler) handle(w http.ResponseWriter, req *http.Request) {\n    // code that uses h.foo\n}\n\nfunc main() {\n    foo := initFoo()\n\n    http.HandleFunc(&quot;/foo&quot;, fooHandler{foo}.handle)\n}\n</code></pre>\n<hr />\n<p>A new official approach for your global values is introduced in Go 1.7 with <a href=\"https://tip.golang.org/pkg/context/\" rel=\"noreferrer\"><code>context.Context#Values</code></a>.</p>\n<blockquote>\n<p>Use context Values only for request-scoped data that transits processes and APIs, not for passing optional parameters to functions.</p>\n</blockquote>\n<p>See &quot;<a href=\"https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39#.t2986hxkg\" rel=\"noreferrer\">How to correctly use context.Context in Go 1.7</a>&quot;</p>\n<hr />\n<p>Finally, in addition of being hard to test, global values can <strong>prevent vendoring</strong>.</p>\n<p>See &quot;<a href=\"https://lziest.github.io/golang/programming/2016/07/03/first-post.html\" rel=\"noreferrer\">To vendor or not to vendor, that is a question</a>&quot;</p>\n<blockquote>\n<p>Many Go\u2019s libaries have exported package variables. Those variables can be viewed as certain global states of a certain package.</p>\n<p>Prior vendoring era, we can go get each imported package once and the global state of each imported package can be shared within all other imported packages.</p>\n<p>Some devs may take it as granted and simply manipulate those global states at will.<br />\nHowever, <strong>with vendoring each imported package may have its own view of global states</strong>. Now a dev may found it impossible to change other package\u2019s view of global state</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 658, "user_id": 677688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gDJR9.jpg?s=128&g=1", "display_name": "Olaf Klischat", "link": "https://stackoverflow.com/users/677688/olaf-klischat"}, "is_accepted": false, "score": 2, "last_activity_date": 1544017385, "last_edit_date": 1544017385, "creation_date": 1543967243, "answer_id": 53623088, "question_id": 38552095, "link": "https://stackoverflow.com/questions/38552095/when-to-use-global-variables/53623088#53623088", "title": "When to use global variables", "body": "<p>You're not modifying <code>myTypes</code>, just reading it, so it's not a variable at all, it's a constant, and would be defined as such if Go supported it (and make sure you don't mutate it -- unfortunately Go doesn't allow you to enforce \"constness\" like other languages do). Global constants are mostly fine.</p>\n\n<p>If you were to modify <code>myTypes</code>, e.g. by providing a function to add new types at runtime, then yes, it's a bad idea to retain <code>myTypes</code> as global state. You might just get away with it as long as you do it only in your \"main program\" which you're sure will never be a package to be imported by other code, but you don't know where this code might end up / get copied to (or even just used from multiple places in the same package), so why risk it. If this becomes a package that gets imported by other packages, things may work fine as long as there's not more than one such \"client\" package is active at runtime, but as soon as somebody links together several such packages into one binary, all those user packages will stomp over each other's data in the global <code>myTypes</code>. If a client package expects to only see the <code>myTypes</code> that it put in earlier, this will break if there's another client with different expectations. So packages that work fine when used individually may break when used together, with no way to fix this except changing the shared code. So just don't do it. It's a shame that Google themselves use global state in some of their own public stuff, e.g. in the standard \"flag\" package and things like \"glog\" which uses it and thus inherits the problem. Don't do it.</p>\n"}], "owner": {"reputation": 523, "user_id": 2502761, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/eac8ddf404d16c2e2b0a23c8b3b4755e?s=128&d=identicon&r=PG", "display_name": "user2502761", "link": "https://stackoverflow.com/users/2502761/user2502761"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8378, "favorite_count": 4, "accepted_answer_id": 38552169, "answer_count": 3, "score": 18, "last_activity_date": 1544017385, "creation_date": 1469363771, "last_edit_date": 1469385731, "question_id": 38552095, "link": "https://stackoverflow.com/questions/38552095/when-to-use-global-variables", "title": "When to use global variables", "body": "<p>I've heard many times that you should avoid global variables.</p>\n\n<p>In my example I declared a global <code>myTypes</code> variable only to avoid declaring that variable over and over again in a function call or something similar.</p>\n\n<p>Is this how it should be done? Is there a better way? A more testable way?</p>\n\n<pre><code>var myTypes = map[string]string{\n  \"type1\": \"tpl1\",\n  \"type2\": \"tpl2\",\n}\n\nfunc AFunc(someType string) string {\n  fmt.Sprintf(\"this is your type %s\", myTypes[someType])\n}\n\nfunc main() {\n  AFunc(\"type1\")\n}\n</code></pre>\n"}, {"tags": ["go", "webserver", "fileserver"], "answers": [{"tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 1, "last_activity_date": 1469531579, "creation_date": 1469531579, "answer_id": 38588327, "question_id": 38549197, "link": "https://stackoverflow.com/questions/38549197/serving-a-dynamic-html-file-by-html-template-while-also-serving-a-file-server/38588327#38588327", "title": "Serving a Dynamic HTML File by `html/template` while also Serving a File Server for Hosting CSS, JS and Images Files in the Same Directory", "body": "<p>It seems to me that the easiest way (less code) is to pretend as if your static files are in different directory, say \"static\". This means that you have to change the path in html file(s) where you refer to them, ie where you had</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"clent.css\" type=\"text/css\"&gt;\n</code></pre>\n\n<p>you replace it with\n</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"static/clent.css\" type=\"text/css\"&gt;\n</code></pre>\n\n<p>Then in your server code you can have an handler for path <code>static</code> and still use the <code>/</code> for dynamic stuff, ie</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func main() {\n    http.HandleFunc(\"/\", hh_root)\n    http.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/home/Casper/public/client/index/\"))))\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc hh_root(w http.ResponseWriter, r *http.Request) {\n    // generate response from template\n}\n</code></pre>\n\n<p>It is common to organize web resources into directories like \"css\" and \"js\" so perhaps it makes sense to use these for fake paths - then when your app grows and you wish to organize it better, it is easier to do.</p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1469531579, "creation_date": 1469339843, "last_edit_date": 1469406925, "question_id": 38549197, "link": "https://stackoverflow.com/questions/38549197/serving-a-dynamic-html-file-by-html-template-while-also-serving-a-file-server", "title": "Serving a Dynamic HTML File by `html/template` while also Serving a File Server for Hosting CSS, JS and Images Files in the Same Directory", "body": "<p>Now I have 3 files and a folder in the same directory like the following. <code>index.html</code> will request the <code>.css</code>, <code>.js</code>(ReactJS) and images inside the folder <code>/img</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/QXmdJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QXmdJ.png\" alt=\"enter image description here\"></a></p>\n\n<p>After quite a lot of search and try, I know that I can use the following to make a file server to serve the <code>/</code> url request for files inside <code>client/index</code>.</p>\n\n<pre><code>http.Handle(\"/\", http.StripPrefix(\"/\", http.FileServer(http.Dir(\"client/index\"))))\n</code></pre>\n\n<p>It works well. But it only serve static files and I want to make some change to the html file before transferring out such as modifying a value in a tag <code>&lt;input id='projectId' type='hidden' value={{.projectId}}/&gt;</code>. Therefore, I need to register a <code>HandleFunc('/', handler)</code> to execute the html template but the url <code>/</code> is already used for implementing the file server.</p>\n\n<p>What is the proper way to modify the html dynamically while also serving requests to the file system for the files (<code>.css</code>, <code>.js</code> and images inside the folder <code>img</code>)?</p>\n\n<p><strong>server / pghndler / index / index.go</strong></p>\n\n<pre><code>package index\n\nfunc RegisterHandlers() {\n    http.Handle(\"/\", http.StripPrefix(\"/\", http.FileServer(http.Dir(\"client/index\"))))\n    http.HandleFunc(\"/login\", loginHandler)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1469367898, "post_id": 38549125, "comment_id": 64496104, "body": "No, the early bounds check is not necessary for memory safety in go. This initial bounds check is only for a compiler hint to be able to elide further bounds checks (and there&#39;s been some discussion if this should be an encouraged pattern at all). All index operations are memory safe in go unless you&#39;re using the unsafe package."}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469369706, "post_id": 38549125, "comment_id": 64496684, "body": "That&#39;s what I said in the first sentence; the compiler inserts the bounds check for you in many cases and you don&#39;t always need an early bounds check. Sorry if this was unclear; I&#39;ll revise."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1469626542, "post_id": 38549125, "comment_id": 64615315, "body": "@SamWhited : Thanks a lot."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469626551, "post_id": 38549125, "comment_id": 64615323, "body": "@JimB : Thanks a lot."}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": true, "score": 2, "last_activity_date": 1469370059, "last_edit_date": 1469370059, "creation_date": 1469339209, "answer_id": 38549125, "question_id": 38548911, "link": "https://stackoverflow.com/questions/38548911/is-it-necessary-to-early-bounds-check-to-guarantee-safety-of-writes-in-golang/38549125#38549125", "title": "is it necessary to early bounds check to guarantee safety of writes in Golang?", "body": "<blockquote>\n  <p>Q1: is it necessary to early bounds check to guarantee safety of writes in Golang?</p>\n</blockquote>\n\n<p>The answer here is \"yes and no\". In general, \"no\", you do not normally have to insert bounds checks in Go because the compiler inserts them for you (that's why your examples panic when you try to access a memory location beyond the length of the slice). However, if you're doing multiple writes like the example given then, \"yes\", you'll need to insert an early bounds check like the example provided to ensure that you don't have only some of the writes succeed, putting you in a bad state (or refactor as you did in example B so that the first write is to the largest array, ensuring that the panic will happen before any writes can succeed).</p>\n\n<p>However, this isn't so much a \"go problem\" as it is a generic class of bug. If you don't do bounds checking (or don't start with the highest index if it's a language that enforces bounds checking itself like Go) in any language, the writes aren't safe. It also very heavily depends on the situation; in the example from the standard library you posted, the user bounds check is necessary. In the second example you posted, however, the user bounds check is not necessary because the code can be written like B where the compiler inserts the bounds check on the first line.</p>\n\n<blockquote>\n  <p>Q2: for early bounds check to guarantee safety of writes which Sample Code is more concise and performance optimized (speed), sample code A, B, C or ... ?</p>\n  \n  <p>A2: I think B : because it is concise and do early bounds check , isn't it?</p>\n</blockquote>\n\n<p>You are correct. In B the compiler will insert a bounds check on the first write, protecting the rest of the writes. Because you are indexing the slice with a constant (<code>7</code>, <code>6</code>, \u2026 <code>0</code>) the compiler can elide the bounds check from the rest of the writes since it can guarantee that they are safe.</p>\n"}, {"tags": [], "owner": {"reputation": 104432, "user_id": 53212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0fbce15f81d6308656931250db267a1?s=128&d=identicon&r=PG", "display_name": "thomasrutter", "link": "https://stackoverflow.com/users/53212/thomasrutter"}, "is_accepted": false, "score": 1, "last_activity_date": 1506602408, "last_edit_date": 1506602408, "creation_date": 1501813669, "answer_id": 45497349, "question_id": 38548911, "link": "https://stackoverflow.com/questions/38548911/is-it-necessary-to-early-bounds-check-to-guarantee-safety-of-writes-in-golang/45497349#45497349", "title": "is it necessary to early bounds check to guarantee safety of writes in Golang?", "body": "<p>The comment about \"safety of writes\" is misleading here. Placing the highest bounds check at the start is simply an optimisation. If you omit it, the behavior will not change (or become \"unsafe\") but you may suffer the performance penalty of multiple bounds checks instead of just one, as the minimum required bound increments with each subsequent higher index.</p>\n\n<p>Where the comment says \"guarantee safety of writes\" it just means that it will guarantee to the compiler that the subsequent writes will be safe without needing to insert more bounds checks. Leaving it out won't make the writes unsafe, it'll just make the compiler insert more bounds checks. Under no conditions will the compiler generate unsafe memory accesses.</p>\n\n<p>It is debatable whether inserting this fake early bounds check is a good idea in code as opposed to not using it or rewriting the code to legitimately use the highest index first as in your example code B. As long as it's clear why it's there (eg. with a sensible and non-misleading comment) I'd say use it if you want and find it beneficial. In general with manual optimisations there is the possibility that a future compiler optimisation may make it redundant or otherwise change its effectiveness.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 1, "accepted_answer_id": 38549125, "answer_count": 2, "score": 5, "last_activity_date": 1506602408, "creation_date": 1469336579, "last_edit_date": 1472653082, "question_id": 38548911, "link": "https://stackoverflow.com/questions/38548911/is-it-necessary-to-early-bounds-check-to-guarantee-safety-of-writes-in-golang", "title": "is it necessary to early bounds check to guarantee safety of writes in Golang?", "body": "<p>If you look at \"encoding/binary\" package:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (littleEndian) Uint64(b []byte) uint64 {\n    _ = b[7] // bounds check hint to compiler; see golang.org/issue/14808\n    return uint64(b[0]) | uint64(b[1])&lt;&lt;8 | uint64(b[2])&lt;&lt;16 | uint64(b[3])&lt;&lt;24 |\n        uint64(b[4])&lt;&lt;32 | uint64(b[5])&lt;&lt;40 | uint64(b[6])&lt;&lt;48 | uint64(b[7])&lt;&lt;56\n}\n\nfunc (littleEndian) PutUint64(b []byte, v uint64) {\n    _ = b[7] // early bounds check to guarantee safety of writes below\n    b[0] = byte(v)\n    b[1] = byte(v &gt;&gt; 8)\n    b[2] = byte(v &gt;&gt; 16)\n    b[3] = byte(v &gt;&gt; 24)\n    b[4] = byte(v &gt;&gt; 32)\n    b[5] = byte(v &gt;&gt; 40)\n    b[6] = byte(v &gt;&gt; 48)\n    b[7] = byte(v &gt;&gt; 56)\n}\n</code></pre>\n\n<p>You will see:  </p>\n\n<pre><code>_ = b[7] // early bounds check to guarantee safety of writes below\n</code></pre>\n\n<p>Now consider this sample code A (see comment):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := []byte{0, 1, 2, 3, 4, 5, 6}\n    var v uint64 = 0x0807060504030201\n\n    b[0] = byte(v)\n    b[1] = byte(v &gt;&gt; 8)\n    b[2] = byte(v &gt;&gt; 16)\n    b[3] = byte(v &gt;&gt; 24)\n    b[4] = byte(v &gt;&gt; 32)\n    b[5] = byte(v &gt;&gt; 40)\n    b[6] = byte(v &gt;&gt; 48)\n    b[7] = byte(v &gt;&gt; 56) // panic: runtime error: index out of range\n\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>And this sample code B (see comment): </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := []byte{0, 1, 2, 3, 4, 5, 6}\n    var v uint64 = 0x0807060504030201\n\n    b[7] = byte(v &gt;&gt; 56) // panic: runtime error: index out of range\n    b[6] = byte(v &gt;&gt; 48)\n    b[5] = byte(v &gt;&gt; 40)\n    b[4] = byte(v &gt;&gt; 32)\n    b[3] = byte(v &gt;&gt; 24)\n    b[2] = byte(v &gt;&gt; 16)\n    b[1] = byte(v &gt;&gt; 8)\n    b[0] = byte(v)\n\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>And sample code C:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := []byte{0, 1, 2, 3, 4, 5, 6}\n    var v uint64 = 0x0807060504030201\n\n    _ = b[7] // early bounds check to guarantee safety of writes below\n\n    b[0] = byte(v)\n    b[1] = byte(v &gt;&gt; 8)\n    b[2] = byte(v &gt;&gt; 16)\n    b[3] = byte(v &gt;&gt; 24)\n    b[4] = byte(v &gt;&gt; 32)\n    b[5] = byte(v &gt;&gt; 40)\n    b[6] = byte(v &gt;&gt; 48)\n    b[7] = byte(v &gt;&gt; 56)\n\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>So I have two questions:<br>\nQ1: Is it necessary to early bounds check to guarantee safety of writes in Golang?<br>\nQ2: For early bounds check to guarantee safety of writes which Sample Code is more concise and performance optimized (speed), sample code  A, B, C or ...  ?  </p>\n\n<p>A2: I think B : because it is concise and do early bounds check , isn't it?</p>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": true, "score": 3, "last_activity_date": 1469369630, "last_edit_date": 1469369630, "creation_date": 1469338079, "answer_id": 38549028, "question_id": 38548778, "link": "https://stackoverflow.com/questions/38548778/cannot-wrap-stripprefix-in-another-function-missing-servehttp-method/38549028#38549028", "title": "Cannot wrap StripPrefix in another function (missing ServeHTTP method)", "body": "<p><code>http.Handle</code> expects a function that takes an <code>http.ResponseWriter</code> and an <code>*http.Request</code>. Your file handler function does not take either of these arguments. Instead, you want to pass in the handler returned from a <em>call</em> to your fileHandler function. However, if you do this as-is, you will only be checking the credentials once instead of on every HTTP call, which is probably not what you wanted. Instead, you have to return a handler function that wraps both your session check, and a call to the file servers <code>Handle</code> method. You could even have it wrap a generic handler (similar to how <code>StripPrefix</code> works) so that you can reuse it to check the session for multiple different types of requests. Something like the following:</p>\n\n<pre><code>func RegisterHandlers() {\n    http.Handle(\"/\", checkSession(http.StripPrefix(\"/\", http.FileServer(http.Dir(\"client/index\")))))\n    http.HandleFunc(\"/login\", loginHandler)\n}\n\nfunc checkSession(h http.Handler) http.Handler {\n    return HandlerFunc(func(w ResponseWriter, r *Request) {\n        //Check session in the database\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 38549028, "answer_count": 1, "score": 0, "last_activity_date": 1469369630, "creation_date": 1469334809, "question_id": 38548778, "link": "https://stackoverflow.com/questions/38548778/cannot-wrap-stripprefix-in-another-function-missing-servehttp-method", "title": "Cannot wrap StripPrefix in another function (missing ServeHTTP method)", "body": "<p>I want to wrap func StripPrefix inside another function and do some client session checking before making a file server. All the sessions are stored in a MySQL database table for implementing multiple web server for one website.</p>\n\n<pre><code>func RegisterHandlers() {\n    http.Handle(\"/\", fileHandler)\n    http.HandleFunc(\"/login\", loginHandler)\n}\n\nfunc fileHandler() http.Handler {\n    //Check session in the database\n    return http.StripPrefix(\"/\", http.FileServer(http.Dir(\"client/index\")))\n}\n</code></pre>\n\n<p><strong>Error Message</strong></p>\n\n<p>The error message said that missing <code>ServeHTTP</code> method. I don't understand why since I just wrap it in another function and return exactly <code>http.StripPrefix</code>.</p>\n\n<pre><code>./index.go:9: cannot use fileHandler (type func() http.Handler) as type http.Handler in argument to http.Handle:\n    func() http.Handler does not implement http.Handler (missing ServeHTTP method)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 0, "last_activity_date": 1469334620, "creation_date": 1469334620, "answer_id": 38548761, "question_id": 38548263, "link": "https://stackoverflow.com/questions/38548263/how-to-turn-a-slice-of-uint64-into-a-slice-of-bytes/38548761#38548761", "title": "How to turn a slice of Uint64 into a slice of Bytes", "body": "<p>Integer values can be encoded into byte arrays with the <a href=\"https://godoc.org/encoding/binary\" rel=\"nofollow\"><code>encoding/binary</code></a> package from the standard library.</p>\n\n<p>For instance, to encode a <code>uint64</code> into a byte buffer, we could use the <a href=\"https://godoc.org/encoding/binary#PutUvarint\" rel=\"nofollow\"><code>binary.PutUvarint</code></a> function:</p>\n\n<pre><code>big := uint64(257)\nbuf := make([]byte, 2)\nn := binary.PutUvarint(buf, big)\nfmt.Printf(\"Wrote %d bytes into buffer: [% x]\\n\", n, buf)\n</code></pre>\n\n<p>Which would print:</p>\n\n<pre><code>Wrote 2 bytes into buffer: [81 02]\n</code></pre>\n\n<p>We can also write a generic stream to the buffer using the <a href=\"https://godoc.org/encoding/binary#Write\" rel=\"nofollow\"><code>binary.Write</code></a> function:</p>\n\n<pre><code>buf := new(bytes.Buffer)\nvar pi float64 = math.Pi\nerr := binary.Write(buf, binary.LittleEndian, pi)\nif err != nil {\n    fmt.Println(\"binary.Write failed:\", err)\n}\nfmt.Printf(\"% x\", buf.Bytes())\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>18 2d 44 54 fb 21 09 40\n</code></pre>\n\n<p>(this second example was borrowed from that packages documentation, where you will find other simliar examples)</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1469334620, "creation_date": 1469328418, "question_id": 38548263, "link": "https://stackoverflow.com/questions/38548263/how-to-turn-a-slice-of-uint64-into-a-slice-of-bytes", "title": "How to turn a slice of Uint64 into a slice of Bytes", "body": "<p>I currently have a protobuf struct that looks like this:</p>\n\n<pre><code>type RequestEnvelop_MessageQuad struct {\n    F1   [][]byte `protobuf:\"bytes,1,rep,name=f1,proto3\" json:\"f1,omitempty\"`\n    F2   []byte   `protobuf:\"bytes,2,opt,name=f2,proto3\" json:\"f2,omitempty\"`\n    Lat  float64  `protobuf:\"fixed64,3,opt,name=lat\" json:\"lat,omitempty\"`\n    Long float64  `protobuf:\"fixed64,4,opt,name=long\" json:\"long,omitempty\"`\n}\n</code></pre>\n\n<p>F1 takes some S2 Geometry data which I have generated like so:</p>\n\n<pre><code>ll := s2.LatLngFromDegrees(location.Latitude, location.Longitude)\ncid := s2.CellIDFromLatLng(ll).Parent(15)\nwalkData := []uint64{cid.Pos()}\n\nnext := cid.Next()\nprev := cid.Prev()\n\n// 10 Before, 10 After\nfor i := 0; i &lt; 10; i++ {\n    walkData = append(walkData, next.Pos())\n    walkData = append(walkData, prev.Pos())\n\n    next = next.Next()\n    prev = prev.Prev()\n}\n\nlog.Println(walkData)\n</code></pre>\n\n<p>The only problem is, the protobuf struct expects a type of <code>[][]byte</code> I'm just not sure how I can get my <code>uint64</code> data into bytes. Thanks.</p>\n"}, {"tags": ["mysql", "google-app-engine", "go", "google-cloud-sql"], "comments": [{"owner": {"reputation": 19398, "user_id": 775345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/c6jtG.jpg?s=128&g=1", "display_name": "Robert Moskal", "link": "https://stackoverflow.com/users/775345/robert-moskal"}, "edited": false, "score": 0, "creation_date": 1469324222, "post_id": 38547940, "comment_id": 64487556, "body": "I don&#39;t think there are any unique issues specific to the environment. Cloud SQL is just mysql and gae is just where you run your code."}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1469324946, "post_id": 38547940, "comment_id": 64487632, "body": "at least one particular case potentially of interest: <a href=\"http://stackoverflow.com/questions/34670194/handling-schema-migrations-in-app-engine\" title=\"handling schema migrations in app engine\">stackoverflow.com/questions/34670194/&hellip;</a>"}, {"owner": {"reputation": 731, "user_id": 843032, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ef09d873ff1da5d4e2333c42344180e?s=128&d=identicon&r=PG", "display_name": "Ralph Pina", "link": "https://stackoverflow.com/users/843032/ralph-pina"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1469331760, "post_id": 38547940, "comment_id": 64488528, "body": "@DanCornilescu thanks! However that appears to be for Datastore Entities."}, {"owner": {"reputation": 731, "user_id": 843032, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ef09d873ff1da5d4e2333c42344180e?s=128&d=identicon&r=PG", "display_name": "Ralph Pina", "link": "https://stackoverflow.com/users/843032/ralph-pina"}, "reply_to_user": {"reputation": 19398, "user_id": 775345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/c6jtG.jpg?s=128&g=1", "display_name": "Robert Moskal", "link": "https://stackoverflow.com/users/775345/robert-moskal"}, "edited": false, "score": 0, "creation_date": 1469333382, "post_id": 38547940, "comment_id": 64488729, "body": "@RobertMoskal I don&#39;t think your statement is correct. While I am new to backend work, and most of my experience is in client side development, I think the asynchronous and distributed nature of GAE poses some unique challenges. I added some of these specifics to my question."}], "answers": [{"tags": [], "owner": {"reputation": 2428, "user_id": 226773, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/2Hha4.jpg?s=128&g=1", "display_name": "Bill Prin", "link": "https://stackoverflow.com/users/226773/bill-prin"}, "is_accepted": false, "score": 2, "last_activity_date": 1469401811, "creation_date": 1469401811, "answer_id": 38557754, "question_id": 38547940, "link": "https://stackoverflow.com/questions/38547940/what-is-the-best-migration-strategy-for-gae-cloudsql/38557754#38557754", "title": "What is the best migration strategy for GAE CloudSQL", "body": "<p>I have to agree with Robert, that while this is a challenging situation, it has very little to do with CloudSQL. Pretty much any situation where you need to migrate two versions of app with different SQL schemas will create this situation. </p>\n\n<p>You basically have two options</p>\n\n<ul>\n<li><p>Make all your changes at least temporarily backwards compatible. This might involve an intermediate version of your application that can gracefully handle either versions of the schema.</p></li>\n<li><p>Version your app/API like you describe, associate a given version with a given schema and use a different database, which might require copying data between the two databases, which might use a lot more storage than you'd like.</p></li>\n</ul>\n\n<p>The backwards compatible approach is usually the best although you get some ugly code to handle the different schemas. But it can usually be done. </p>\n\n<p>You're asking about how do you get whether a given version has a given migration, but keep in mind the migration is an attribute of the database and the version is an attribute of the application. So the question is really just which database the version is talking to and what the schema is for that database. Your idea for a \"version\" number for the migrations in the database is actually pretty reasonable and many ORMs have some sort of feature for that.</p>\n\n<p>The fact that this issue exists is why your usually better off with more flexible data modeling approaches when first prototyping your app (allow more NULLs, don't use foreign keys, or just use a NoSQL approach like Datastore), and implement more data integrity once you have more confidence in your data model.</p>\n\n<p>Finally, I work on Google Cloud documentation and I'm sorry if you're disappointed we don't address this more clearly, but hopefully you understand the perspective that it's a general database operations question rather than a question specific to Google Cloud or App Engine. If you do come up with a solution you like, you should consider blogging about it and we'll be happy to help promote your solution!</p>\n"}], "owner": {"reputation": 731, "user_id": 843032, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ef09d873ff1da5d4e2333c42344180e?s=128&d=identicon&r=PG", "display_name": "Ralph Pina", "link": "https://stackoverflow.com/users/843032/ralph-pina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1469401811, "creation_date": 1469323952, "last_edit_date": 1469333235, "question_id": 38547940, "link": "https://stackoverflow.com/questions/38547940/what-is-the-best-migration-strategy-for-gae-cloudsql", "title": "What is the best migration strategy for GAE CloudSQL", "body": "<p>I can't, for the life of me, find documentation on how to handle migrations using Google App Engine and CloudSQL.I am using the Go runtime.</p>\n\n<p>Clearly an application's schema will change and evolve as time goes by, and migrations will need to be run. Currently I run the migrations by hand. This is not scalable.</p>\n\n<p>Is there anyone who has a solution?</p>\n\n<p>I see some specific challenges:</p>\n\n<ul>\n<li><p>I can get the version of the current <code>app.yaml</code> deployed version using <a href=\"https://cloud.google.com/appengine/docs/go/reference#VersionID\" rel=\"nofollow\">VersionID</a>. However, how do I check if a migration happened for this version? I would have to keep a version number in a db table and check against that in the <code>init()</code> function?</p></li>\n<li><p>However, when you upload a new version of the app, with the new schema GAE will slowly <a href=\"https://cloud.google.com/appengine/docs/go/migrating-traffic\" rel=\"nofollow\">migrate your traffic</a> which means once the first instance of <code>init()</code> in your new version runs, and the migration completes, traffic to the old version will fail in those db transactions.</p></li>\n<li><p>I could somewhat mitigate the issue above by versioning my API. But this limits the migration strategies, such as dropping tables, etc. </p></li>\n</ul>\n\n<p>Lastly, I am disappointed there is no <a href=\"https://cloud.google.com/appengine/docs/go/\" rel=\"nofollow\">documentation</a> on this as far as I can tell.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 607453, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/f460ee15558ce3c81d2048c7778476a9?s=128&d=identicon&r=PG", "display_name": "raindog308", "link": "https://stackoverflow.com/users/607453/raindog308"}, "edited": false, "score": 0, "creation_date": 1469373555, "post_id": 38548164, "comment_id": 64497969, "body": "Thank you - that is beautiful.  I don&#39;t know why several hours of googling and experimenting didn&#39;t uncover that simplicity, but it was a night of learning :-)  Thanks much."}], "tags": [], "owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "is_accepted": true, "score": 7, "last_activity_date": 1469326838, "creation_date": 1469326838, "answer_id": 38548164, "question_id": 38547797, "link": "https://stackoverflow.com/questions/38547797/parsing-a-subsection-of-json-in-golang/38548164#38548164", "title": "Parsing a subsection of JSON in golang", "body": "<p>Do your initial unmarshal to a <code>type Sections map[string]json.RawMessage</code> variable. You will then have the section type and the raw data associated with it. You can either switch on the section type and unmarshal to the specific section struct or unmarshal to a map[string]interface{} and handle them generically. (Whatever works best for your app.)</p>\n"}], "owner": {"reputation": 759, "user_id": 607453, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/f460ee15558ce3c81d2048c7778476a9?s=128&d=identicon&r=PG", "display_name": "raindog308", "link": "https://stackoverflow.com/users/607453/raindog308"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 1, "accepted_answer_id": 38548164, "answer_count": 1, "score": 3, "last_activity_date": 1469326838, "creation_date": 1469322273, "question_id": 38547797, "link": "https://stackoverflow.com/questions/38547797/parsing-a-subsection-of-json-in-golang", "title": "Parsing a subsection of JSON in golang", "body": "<p>I have an app that receives messages which are JSON.  The JSON has various \"sections\" (example below).  Each section has a name, but the structure beyond that is completely different per section.</p>\n\n<p>What I want to do is go through the sections and for each, Unmarshal into the appropriate object.  But strangely I've found this difficult, as it seems you can either Unmarshal the entire JSON into an object, or you can get a generic map[string]interface{}.  All the example code I've found gets into type switching and manually assigning variables...I was hoping to do the neato Unmarshal directly into an object.</p>\n\n<p>Is there a way to feed Unmarshal a subset of the JSON?  I could slice and dice the byte[] myself but that seems ghastly...surely others have experienced something like this?</p>\n\n<p>Here is what I've played with.</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\n\ntype Book struct {\n    Author string\n    Title  string\n    Price  float64\n}\n\ntype Movie struct {\n    Title  string\n    Year   float64\n    Stars  float64\n    Format string\n}\n\nvar sections map[string]interface{}\n\nfunc main() {\n\n    /*\n     * \"Book\" and \"Movie\" are \"sections\".\n     * There are dozens of possible section types,\n     * and which are present is not known ahead of time\n     */\n\n    incoming_msg_string := `\n{\n    \"Book\" : {\n        \"Author\" : \"Jack Kerouac\",\n        \"Title\" : \"On the Road\",\n        \"Price\" : 5.99\n    }, \n    \"Movie\" : {\n        \"Title\" : \"Sherlock Holmes vs. the Secret Weapon\",\n        \"Year\" : 1940,\n        \"Stars\" : 2.5,\n        \"Format\" : \"DVD\"\n    }\n}`\n\n    /*\n     * this code gets me a list of sections\n     */\n\n    var f interface{}\n    err := json.Unmarshal([]byte(incoming_msg_string), &amp;f)\n    if err != nil {\n        panic(err)\n    }\n\n    var list_of_sections []string\n    for section_type, _ := range f.(map[string]interface{}) {\n        list_of_sections = append(list_of_sections, section_type)\n    }\n\n    /*\n       * next I would like to take the JSON in the \"book\" section\n       * and unmarshal it into a Book object, then take the JSON\n       * in the \"movie\" section and unmarshal it into a Movie object,\n       * etc.\n       *\n       * https://blog.golang.org/json-and-go has an example on\n       * decoding arbitrary data, but there's only one Unmarshaling.\n       *\n       * json.RawMessage has an example in the docs but it assumes\n       * the objects are the same type (I think).  My attempts to use\n       * it with a two-field struct (section name, and a raw message)\n       * gave runtime errors.  Likewise unmarshaling into a \n       * []json.RawMessage gave \"panic: json: cannot unmarshal object into Go value of type []json.RawMessage\"\n       *\n       * What I'm looking for is something like:\n       *   json.Unmarshal(some_json[\"a certain section\"],&amp;object)\n       *\n    */\n}\n</code></pre>\n\n<p>Any breadcrumb trail hints much appreciated.</p>\n"}, {"tags": ["networking", "go", "network-programming", "gopacket"], "answers": [{"tags": [], "owner": {"reputation": 4939, "user_id": 2906820, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2d458add2417430233cc4877e80a01d5?s=128&d=identicon&r=PG&f=1", "display_name": "rodolk", "link": "https://stackoverflow.com/users/2906820/rodolk"}, "is_accepted": false, "score": 1, "last_activity_date": 1469342551, "creation_date": 1469342551, "answer_id": 38549457, "question_id": 38547625, "link": "https://stackoverflow.com/questions/38547625/sending-udp-packets-with-gopacket/38549457#38549457", "title": "Sending UDP packets with gopacket", "body": "<p>I'm not an expert in Go but it seems you have to use function net.ListenUDP and specify the port to bind the UDP socket. Then you use that connection (obtained from ListeUDP) to read from there. I assume you are specifying port 53 in 'sport'. </p>\n\n<p>Here there is a simple example of a client and server: <a href=\"https://varshneyabhi.wordpress.com/2014/12/23/simple-udp-clientserver-in-golang/\" rel=\"nofollow\">https://varshneyabhi.wordpress.com/2014/12/23/simple-udp-clientserver-in-golang/</a></p>\n"}, {"tags": [], "owner": {"reputation": 322, "user_id": 588650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVeTQ.jpg?s=128&g=1", "display_name": "Vitold S.", "link": "https://stackoverflow.com/users/588650/vitold-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1536609720, "creation_date": 1536609720, "answer_id": 52264702, "question_id": 38547625, "link": "https://stackoverflow.com/questions/38547625/sending-udp-packets-with-gopacket/52264702#52264702", "title": "Sending UDP packets with gopacket", "body": "<p>You mix in example two different approach to UDP packet creation. You should use only one.</p>\n\n<p>First approach using Go application \"net\" module to prepare and send UDP packet. This is common way and in most common way you will use this one.</p>\n\n<p>Secand approach using Google special \"gopacket\" module to prepare RAW network packet. This is hacker way to check hardware or implement special protocol and emulate some specific protocol stack. This only expert way to create special utility and test application.</p>\n\n<p>It you create new hardware and try to interopt with this devices you may use gopakcet or if you simple create software application you should use net package.</p>\n"}], "owner": {"reputation": 2308, "user_id": 1120799, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/IRCQ4.jpg?s=128&g=1", "display_name": "Abhishek Chanda", "link": "https://stackoverflow.com/users/1120799/abhishek-chanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1946, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1536609720, "creation_date": 1469320356, "last_edit_date": 1499715821, "question_id": 38547625, "link": "https://stackoverflow.com/questions/38547625/sending-udp-packets-with-gopacket", "title": "Sending UDP packets with gopacket", "body": "<p>I am trying to send UDP packets to a remote host like this</p>\n\n<pre><code>conn, err := net.ListenPacket(\"ip4:udp\", \"0.0.0.0\")\nif err != nil {\n    panic(err)\n}\nip := &amp;layers.IPv4{\n    SrcIP:    saddr,\n    DstIP:    dip,\n    Protocol: layers.IPProtocolUDP,\n}\nudp := &amp;layers.UDP{\n    SrcPort: layers.UDPPort(sport),\n    DstPort: layers.UDPPort(us.Port),\n}\nudp.SetNetworkLayerForChecksum(ip)\nbuf := gopacket.NewSerializeBuffer()\nopts := gopacket.SerializeOptions{\n    ComputeChecksums: true,\n    FixLengths:       true,\n}\nif err := gopacket.SerializeLayers(buf, opts, udp); err != nil {\n    fmt.Printf(\"%v\", err)\n}\nif _, err := us.Conn.WriteTo(buf.Bytes(), &amp;net.IPAddr{IP: dip}); err != nil {\n    panic(err)\n}\n\n// reading\nfor {\n    buf2 := make([]byte, 4096)\n    n, addr, err := us.Conn.ReadFrom(buf2)\n    if err != nil {\n        fmt.Printf(\"%v\", err)\n    }\n    if addr.String() == dip.String() {\n        fmt.Printf(\"Got a reply\")\n    }\n}\n</code></pre>\n\n<p>But this keeps erring out while reading packets with <code>read ip4 0.0.0.0: i/o timeout</code>. When I tcpdump, I see packets being sent out and one UDP response coming back on port 53 others are all ICMP. Why can't my code read those packets?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1469290651, "post_id": 38543825, "comment_id": 64479480, "body": "Actually it is not. In go lang most of the types has always a default value, in the case of array it is an empty array, not a nil. The nil is for pointers and objects."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 2, "creation_date": 1469292058, "post_id": 38543825, "comment_id": 64479910, "body": "@MarioAlexandroSantini, zero value for slice is nil <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1469293283, "post_id": 38543825, "comment_id": 64480315, "body": "Right @crecker, I miss this. Now I see it is the <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\">append</a> that do the <i>magic</i>, adding the needed size."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1470169250, "last_edit_date": 1470169250, "creation_date": 1469291467, "answer_id": 38543982, "question_id": 38543825, "link": "https://stackoverflow.com/questions/38543825/appending-one-element-to-nil-slice-increases-capacity-by-two/38543982#38543982", "title": "Appending one element to nil slice increases capacity by two", "body": "<p><strong>The capacity growth is not under user control</strong>:  </p>\n\n<blockquote>\n<pre><code>append(s S, x ...T) S  // T is the element type of S \n</code></pre>\n  \n  <p>If the capacity of s is not large enough to fit the additional values,\n  append allocates a new, sufficiently large underlying array that fits\n  both the existing slice elements and the additional values. Otherwise,\n  append re-uses the underlying array.</p>\n</blockquote>\n\n<p>ref: <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow\">https://golang.org/ref/spec#Appending_and_copying_slices</a><br>\nand see:  <a href=\"https://golang.org/doc/effective_go.html#append\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#append</a>  </p>\n\n<p><strong>it is not increased by 2 (it is performance optimized):<br>\ntest sample code with initial capacity 5 bytes then it is 16 instead of 10 (see commented output):</strong>  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []byte{1, 2, 3, 4, 5}\n    fmt.Println(cap(s)) // 5\n    s = append(s, s...)\n    fmt.Println(cap(s)) // 16\n}\n</code></pre>\n\n<p>test sample code (with commented output):  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := []int{0}\n    fmt.Println(cap(s)) // 1\n    s = append(s, s...)\n    fmt.Println(cap(s)) // 2\n}\n</code></pre>\n\n<p>test sample code (with commented output):  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := []int{}\n    fmt.Println(cap(s)) // 0\n    s = append(s, 1)\n    fmt.Println(cap(s)) // 1\n}\n</code></pre>\n\n<p>test sample code with nil slice (with commented output):  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var s []int\n    fmt.Println(cap(s)) // 0\n    s = append(s, 1)\n    fmt.Println(cap(s)) // 1\n}\n</code></pre>\n\n<p>your sample code (with commented output):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var s1 []int\n    s2 := append(s1, 1)\n    fmt.Println(cap(s1)) // 0\n    fmt.Println(cap(s2)) // 1\n}\n</code></pre>\n\n<p>test sample code with 5 ints (with commented output):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{1, 2, 3, 4, 5}\n    fmt.Println(cap(s)) // 5\n    s = append(s, s...)\n    fmt.Println(cap(s)) // 10\n}\n</code></pre>\n\n<p><strong>you can not access uninitialized indexes of slice like <code>s2[1]</code>:</strong><br>\npanic: runtime error: slice bounds out of range:<br>\ntest sample code (with commented output):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var s1 []int\n    s2 := append(s1, 1)\n\n    fmt.Println(cap(s1)) // 0\n    fmt.Println(cap(s2)) // 1\n    fmt.Println(s1)      // []\n    fmt.Println(s2)      // [1]\n\n    //fmt.Println(s2[0:2]) //panic: runtime error: slice bounds out of range\n    //fmt.Println(s2[1])   //panic: runtime error: slice bounds out of range\n\n}\n</code></pre>\n\n<blockquote>\n  <p>Bounds Checking Elimination (or BCE) is a general term for removing\n  redundant bound checking. Normally a go program will panic when a\n  slice or a string is accessed outside of its bounds. There are two\n  types of bound checking: for indexing (a[i]) and for slicing (a[i:j]).\n  The go compiler inserts these bounds checks at every access, but in\n  most cases they are not needed and are redundant based on the context.</p>\n  \n  <p>Bound checking is important because it provides a defense against\n  buffer overflow attacks and catches a common programming error early.\n  BCE is important because: it speeds up the code, makes the binary\n  smaller. If binaries are slowed down by bound checks then developers\n  will have an incentive to disable bound checking (using -gcflags=-B).  </p>\n</blockquote>\n\n<p><a href=\"https://docs.google.com/document/d/1vdAEAjYdzjnPA9WDOQ1e4e05cYVMpqSxJYZT33Cqw2g/edit#\" rel=\"nofollow\">ref</a> </p>\n"}, {"comments": [{"owner": {"reputation": 1455, "user_id": 1261335, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7148159afe3a7065728d44063f3d22d0?s=128&d=identicon&r=PG", "display_name": "GrandOpener", "link": "https://stackoverflow.com/users/1261335/grandopener"}, "edited": false, "score": 1, "creation_date": 1493129535, "post_id": 38544172, "comment_id": 74275054, "body": "At first glance I read this answer too quickly and got confused.  Lest anyone else have the same problem, the key is that these limits on indices are specific to slicing operations:  Given <code>a := make([]int, 1, 2)</code>, indices for a slicing operation can go up to the <i>capacity</i> (<code>a[0:2]</code> is valid), however indices for an indexing operation can only go up to the <i>length</i> (<code>a[1]</code> is <i>not</i> valid), as is probably expected."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 23, "last_activity_date": 1469293258, "last_edit_date": 1469293258, "creation_date": 1469292426, "answer_id": 38544172, "question_id": 38543825, "link": "https://stackoverflow.com/questions/38543825/appending-one-element-to-nil-slice-increases-capacity-by-two/38544172#38544172", "title": "Appending one element to nil slice increases capacity by two", "body": "<p>Go is free to provide you more capacity than you request. This improves performance by reducing the number of allocations (and possibly copying) that are required. Capacity is just the amount of space reserved before another allocation would be required.</p>\n\n<p>If you append 5 elements to this slice, at least in my experiments, the capacity is 8. This shouldn't be surprising, but also shouldn't be relied on. On different platforms, or different versions of the compiler, the actual result may be different, as long as the capacity is \"sufficiently large\" (equal to or greater than length).</p>\n\n<p>The upper index bound of a slice is <a href=\"https://golang.org/ref/spec#Slice_expressions\">defined as its capacity</a>:</p>\n\n<blockquote>\n  <p>For arrays or strings, the indices are in range if 0 &lt;= low &lt;= high &lt;= len(a), otherwise they are out of range. For slices, the upper index bound is the slice capacity cap(a) rather than the length. A constant index must be non-negative and representable by a value of type int; for arrays or constant strings, constant indices must also be in range. If both indices are constant, they must satisfy low &lt;= high. If the indices are out of range at run time, a run-time panic occurs.</p>\n</blockquote>\n\n<p>This is why reading past the length is not causing a panic. Even so, you shouldn't think of those zeros as part of the slice. They are indexable by the slice, but <code>fmt.Printf(s2)</code> would correctly not show them because they are not part of the slice. Don't subscript this way.</p>\n\n<p>In general, you want to be looking at length, not capacity. Capacity mostly is readable to assist in performance optimization.</p>\n"}, {"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 1, "last_activity_date": 1469306154, "last_edit_date": 1495535358, "creation_date": 1469292718, "answer_id": 38544227, "question_id": 38543825, "link": "https://stackoverflow.com/questions/38543825/appending-one-element-to-nil-slice-increases-capacity-by-two/38544227#38544227", "title": "Appending one element to nil slice increases capacity by two", "body": "<h2>Slice zero value</h2>\n\n<p>Zero value for slices is nil. But it doesn't mean you can't do anything with it. In Go types can actually be used when the value is nil. For example, struct methods can be called even if the pointer receiver is nil. Here's an example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype foo struct {\n}\n\nfunc (f *foo) bar() {\n    fmt.Println(1)\n}\n\nfunc main() {\n    var f *foo\n    fmt.Println(f)\n    f.bar()\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/u5HeZ3I7Xm\" rel=\"nofollow noreferrer\">playground</a></kbd></p>\n\n<p>The same applies to slices. <code>len</code>, <code>cap</code>, <code>append</code> all work even if you pass a nil slice. In case of <code>append</code> it basically creates a new slice for you that points to an array holding the value.</p>\n\n<h2>Slice capacity growth</h2>\n\n<p>When you add an element and you need to allocate more space for it, you don't allocate space for just one element. That's very ineficient. Instead you allocate more than actually needed.</p>\n\n<p>Exactly how much more is allocated depends on the implementation and is not defined in the language spec. Usually capacity is doubled but in case of Go, at least as of v1.5, it rounded up to allocated memory block. You can find link to the source code <a href=\"https://stackoverflow.com/questions/32995623/why-does-slice-capacity-with-odd-numbers-differ-from-behavior-with-even-numbers\">here</a>.</p>\n\n<h2>Slicing past length</h2>\n\n<p>Slicing past length is actually supported. You can slice beyond the length of a slice but you can't slice beyond the capacity:</p>\n\n<blockquote>\n  <p>Earlier we sliced s to a length shorter than its capacity. We can grow\n  s to its capacity by slicing it again:</p>\n  \n  <p>A slice cannot be grown beyond its capacity. Attempting to do so will\n  cause a runtime panic, just as when indexing outside the bounds of a\n  slice or array. Similarly, slices cannot be re-sliced below zero to\n  access earlier elements in the array.</p>\n</blockquote>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n\n<p>In your case underlying array has capacity of 2. You only appended one element so the other one is equal to it's zero value. When you reslice past length Go can recognize that slice already has the needed capacity. So it returns a new slice that points to the same array but with length value set to 2. Here's an example of how it works:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var s []int\n    s = append(s, 1, 2)\n    fmt.Println(s, cap(s))\n\n    s = s[:1]\n    fmt.Println(s, cap(s))\n\n    s = s[:2]\n    fmt.Println(s, cap(s))\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/GjhoOgyd-D\" rel=\"nofollow noreferrer\">playground</a></kbd></p>\n\n<p>It will print</p>\n\n<blockquote>\n  <p>[1 2] 2<br>\n  [1] 2<br>\n  [1 2] 2  </p>\n</blockquote>\n\n<p>You can see that even though I resliced to smaller length, second element is still preserved.</p>\n"}, {"comments": [{"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 0, "creation_date": 1474019377, "post_id": 38548703, "comment_id": 66371594, "body": "The reason why the capacity is doubled every time is because that makes the &quot;effort to copy existing data&quot; roughly proportional to the number of elements appended. To convince yourself of this, for N appends, you will have copied 1 + 2 + 4 + ... + 2^m (for m such that 2^m &lt; N &lt;= 2^(m+1) )."}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 8, "last_activity_date": 1469333931, "creation_date": 1469333931, "answer_id": 38548703, "question_id": 38543825, "link": "https://stackoverflow.com/questions/38543825/appending-one-element-to-nil-slice-increases-capacity-by-two/38548703#38548703", "title": "Appending one element to nil slice increases capacity by two", "body": "<p>There's a bit of confusion here about capacity and length, I think. What you are looking at when you print the slice and see zero or one elements in the slice is its <strong>length</strong>, that is, the number of values the slice actually contains. The capacity of the underlying array is generally hidden from you unless you look it up with the <code>cap()</code> builtin.</p>\n\n<p>Under the hood, slices are actually fixed length arrays. When you run out of space in the slice, Go has to make it bigger by creating a new (longer) array, and copying all the values over from the old one. If you're adding lots of values to a slice, it would be very slow to allocate memory for the new value (and copy all the old ones over) every time, so sometimes Go assumes that you're going to append more elements and goes ahead and allocates more memory than it needs so that you don't have to copy things as often. This extra memory can be used the next time you call append, and the number of values which <em>can</em> be stored in the slice before it has to be expanded is called its <strong>capacity</strong>. In other words, the capacity of the slice is the length of the slices backing array, and the length of a slice is independent from the capacity.</p>\n\n<p>When you append a single value to your slice Go sees that it has to allocate space for this value, so it allocates twice the amount of space that it actually needs, increasing the length by 1 and the capacity by 2.</p>\n\n<p>The slice you mention is because slicing acts on the underlying array: Go lets you slice beyond the <em>length</em> of a slice, you just can't go beyond its <em>capacity</em> (the length of the underlying array). For example, lets try a few things on a simple nil slice:</p>\n\n<pre><code>var s []int\nfmt.Println(len(s), cap(s)) // Prints `0 0` because this is a nil slice\ns = append(s, 1)\nfmt.Println(len(s), cap(s)) // Prints `1 2`\nfmt.Println(s[0:2])         // Prints `[1 0]` (only the first value is part of the slice, the second position in the underlying array is a zero value that is waiting to be used when the slices length grows)\nfmt.Println(s[0:3])         // panic: slice bounds out of range (because we've exceeded the slices capacity)\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 1380370, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/8krHm.png?s=128&g=1", "display_name": "amiregelz", "link": "https://stackoverflow.com/users/1380370/amiregelz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14082, "favorite_count": 0, "accepted_answer_id": 38544172, "answer_count": 4, "score": 18, "last_activity_date": 1470169250, "creation_date": 1469290428, "last_edit_date": 1469293316, "question_id": 38543825, "link": "https://stackoverflow.com/questions/38543825/appending-one-element-to-nil-slice-increases-capacity-by-two", "title": "Appending one element to nil slice increases capacity by two", "body": "<p>I have a nil slice:    </p>\n\n<pre><code>var s1 []int // len(s1) == 0, cap(s1) == 0\n</code></pre>\n\n<p>Which I append one element to:</p>\n\n<pre><code>s2 := append(s1, 1) // len(s2) == 1, cap(s2) == 2\n</code></pre>\n\n<p><strong>Why is appending one element to a nil slice increases the capacity by 2?</strong></p>\n\n<p>Printing the slices using <code>fmt.Printf</code> shows the following:</p>\n\n<pre><code>[] // s1\n[1] // s2\n</code></pre>\n\n<p>I am also confused about why re-slicing <code>s2[0:2]</code> shows a zero which was not in the original slice nor appended to it:</p>\n\n<pre><code>[1,0] // s2[0:2]\n</code></pre>\n"}, {"tags": ["regex", "go", "pattern-matching"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 4, "creation_date": 1469289670, "post_id": 38543687, "comment_id": 64479185, "body": "Go regex does not support lookarounds and regex delimiters."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469290033, "post_id": 38543687, "comment_id": 64479285, "body": "Is there any other plugins that I can <code>go get</code> from github to use for this regex pattern?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469290043, "post_id": 38543687, "comment_id": 64479286, "body": "The <code>(?!.*\\s)</code> lookahead is redundant since the consuming pattern does not match whitespaces."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469290103, "post_id": 38543687, "comment_id": 64479307, "body": "Check <a href=\"https://github.com/glenn-brown/golang-pkg-pcre\" rel=\"nofollow noreferrer\">github.com/glenn-brown/golang-pkg-pcre</a>"}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469290376, "post_id": 38543687, "comment_id": 64479389, "body": "@Wiktor Stribi\u017cew - Is there any other good regex pattern choice for checking password in go regexp?"}, {"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 2, "creation_date": 1469290655, "post_id": 38543687, "comment_id": 64479484, "body": "The backtick ( ` ) is used for raw strings. They have the exact same type as normal strings (created with &quot;) but they don&#39;t handle backslashes (writing <code>\\n</code> will result in a string that contains the characters \\ and n, not in a line break)."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1469291341, "post_id": 38543687, "comment_id": 64479699, "body": "It is difficult to find regex pattern without <code>(?=</code> for checking password."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1469293815, "post_id": 38543687, "comment_id": 64480483, "body": "@CasperLI: You can really do it without lookaheads. Just split the conditions, here is pseudo code: <code>if str.length &gt;= 8 &amp;&amp; s =~ &#47;\\d&#47; &amp;&amp; &amp;&amp; s =~ &#47;[a-z]&#47; &amp;&amp; s =~ &#47;[A-Z]&#47; &amp;&amp; s =~ &#47;^[0-9a-zA-Z!@#$%^&amp;*()]*$&#47;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "edited": false, "score": 0, "creation_date": 1469379223, "post_id": 38545346, "comment_id": 64499820, "body": "If I use standard lib function to validate string input, will it be faster than using regexp method? regexp method seems need to take time to decode the regex pattern. What would you recommend?"}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1469395732, "last_edit_date": 1469395732, "creation_date": 1469299839, "answer_id": 38545346, "question_id": 38543687, "link": "https://stackoverflow.com/questions/38543687/php-regex-pattern-for-password-checking-not-working-in-go/38545346#38545346", "title": "PHP regex pattern for password checking not working in Go", "body": "<p>Go regexp does not support lookarounds. Also, the <code>/.../</code> regex delimiters are not supported, either (there are special methods in Go to express those).</p>\n\n<p>You may either use a lookaround-supporting regex library for Go (<a href=\"https://github.com/glenn-brown/golang-pkg-pcre\" rel=\"nofollow\">here is a PCRE-supporting one</a>) or split the conditions and use several small, readable regexps:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"unicode/utf8\"\n)\n\nfunc main() {\n    s := \"aSfd46Fgwaq\"\n    lower_cond := regexp.MustCompile(`[a-z]`)\n    upper_cond := regexp.MustCompile(`[A-Z]`)\n    digit_cond := regexp.MustCompile(`[0-9]`)\n    whole_cond := regexp.MustCompile(`^[0-9a-zA-Z!@#$%^&amp;*()]*$`)\n    pass_len := utf8.RuneCountInString(s)\n    fmt.Println(lower_cond.MatchString(s) &amp;&amp; upper_cond.MatchString(s) &amp;&amp; digit_cond.MatchString(s) &amp;&amp; whole_cond.MatchString(s) &amp;&amp; pass_len &gt;= 8)\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/Y6BbdXKF9u\" rel=\"nofollow\">Go playground demo</a></p>\n\n<p>NOTE: I used <code>utf8.RuneCountInString</code> in the demo to make sure even UTF8 string length is parsed correctly. Otherwise, you might use <code>len(s)</code> that will count bytes that should suffice for ASCII input.</p>\n\n<p><strong>Update</strong></p>\n\n<p>If the performance is not satisfactory, you may consider using a simpler non-regex approach:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    myString := \"aSfd46Fgwaq\"\n    has_digit := false\n    has_upper := false\n    has_lower := false\n    pass_length := len(myString)\n    for _, value := range myString {\n        switch {\n        case value &gt;= '0' &amp;&amp; value &lt;= '9':\n            has_digit = true\n        case value &gt;= 'A' &amp;&amp; value &lt;= 'Z':\n            has_upper = true\n        case value &gt;= 'a' &amp;&amp; value &lt;= 'z':\n            has_lower = true\n        }\n    }\n    fmt.Println(has_digit &amp;&amp; has_upper &amp;&amp; has_lower &amp;&amp; pass_length &gt;= 8)\n\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/awvIBoLzw7\" rel=\"nofollow\">another Go demo</a></p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 38545346, "answer_count": 1, "score": 1, "last_activity_date": 1533279805, "creation_date": 1469289573, "last_edit_date": 1533279805, "question_id": 38543687, "link": "https://stackoverflow.com/questions/38543687/php-regex-pattern-for-password-checking-not-working-in-go", "title": "PHP regex pattern for password checking not working in Go", "body": "<p>After reading <a href=\"https://stackoverflow.com/questions/31518130/go-lang-error-using-regex\">this post</a>, I know I need to use a backquotes ( ` ) to wrap my regex pattern. Now I have regex pattern <code>/^(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s)[0-9a-zA-Z!@#$%^&amp;*()]*$/</code> to check password pattern whether is correct. I have tested it with PHP and it work correctly. But it does not work in Go. Why?</p>\n\n<p>By the way, what is the type of backquoted ( ` ) variable? it seems not <code>string</code> type. How can I declare this variable container?</p>\n\n<p><strong>Testing Code</strong></p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main(){\n    re := regexp.MustCompile(`/^(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s)[0-9a-zA-Z!@#$%^&amp;*()]*$/`)\n    fmt.Println(re.MatchString(\"aSfd46Fgwaq\"))\n}\n</code></pre>\n\n<p><strong>Testing Result</strong></p>\n\n<pre><code>Running...\n\npanic: regexp: Compile(`/^(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s)[0-9a-zA-Z!@#$%^&amp;*()]*$/`): error parsing regexp: invalid or unsupported Perl syntax: `(?=`\n\ngoroutine 1 [running]:\npanic(0x4efae0, 0xc82000a340)\n    /usr/local/go/src/runtime/panic.go:481 +0x3e6\nregexp.MustCompile(0x576140, 0x4b, 0x100000000)\n    /usr/local/go/src/regexp/regexp.go:232 +0x16f\nmain.main()\n    /home/casper/.local/share/data/liteide/goplay.go:9 +0x30\nexit status 2\n\nError: process exited with code 1.\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "hugo"], "comments": [{"owner": {"reputation": 905, "user_id": 3781709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4fa60c6b287ee4f006d6c4e320daf5?s=128&d=identicon&r=PG", "display_name": "Pradip Patil", "link": "https://stackoverflow.com/users/3781709/pradip-patil"}, "edited": false, "score": 0, "creation_date": 1469289919, "post_id": 38543167, "comment_id": 64479256, "body": "<a href=\"https://gohugo.io/extras/datafiles\" rel=\"nofollow noreferrer\">hugo: access custom data</a> - this may help."}, {"owner": {"reputation": 1754, "user_id": 3943954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYknv.png?s=128&g=1", "display_name": "revelt", "link": "https://stackoverflow.com/users/3943954/revelt"}, "edited": false, "score": 0, "creation_date": 1469309935, "post_id": 38543167, "comment_id": 64485076, "body": "Can you clarify please what do you want to achieve exactly? The code line doesn&#39;t say much. Do you want to access custom variable from the front matter of .md, or from config, or custom data?"}], "owner": {"reputation": 256, "user_id": 561618, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/8b3f6e04369467c3ca06064d5a58beb6?s=128&d=identicon&r=PG", "display_name": "mistersender", "link": "https://stackoverflow.com/users/561618/mistersender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1469286183, "creation_date": 1469286183, "question_id": 38543167, "link": "https://stackoverflow.com/questions/38543167/how-do-i-access-variables-dynamically-with-go-templating", "title": "How do I access variables dynamically with go templating?", "body": "<p>I'm using hugo as a static site generator, and need to do something like this:</p>\n\n<p>$.Site.Data.pages[{{ .Params.location }}].someStuff</p>\n\n<p>I am not sure of the syntax to actually accomplish this and it's such an irritatingly simple thing that it's actually difficult to find by googling</p>\n"}, {"tags": ["http", "go", "go-echo"], "comments": [{"owner": {"reputation": 4871, "user_id": 4381265, "user_type": "registered", "profile_image": "https://graph.facebook.com/1030964142/picture?type=large", "display_name": "Bogdan Ku\u0161tan", "link": "https://stackoverflow.com/users/4381265/bogdan-ku%c5%a1tan"}, "edited": false, "score": 0, "creation_date": 1469285325, "post_id": 38542956, "comment_id": 64477924, "body": "You should look into streaming response <a href=\"https://echo.labstack.com/recipes/streaming-response\" rel=\"nofollow noreferrer\">echo.labstack.com/recipes/streaming-response</a>"}, {"owner": {"reputation": 793, "user_id": 786126, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5fdda792896b8f14da6d1ce532f9624b?s=128&d=identicon&r=PG", "display_name": "zeroc8", "link": "https://stackoverflow.com/users/786126/zeroc8"}, "reply_to_user": {"reputation": 4871, "user_id": 4381265, "user_type": "registered", "profile_image": "https://graph.facebook.com/1030964142/picture?type=large", "display_name": "Bogdan Ku\u0161tan", "link": "https://stackoverflow.com/users/4381265/bogdan-ku%c5%a1tan"}, "edited": false, "score": 0, "creation_date": 1469286151, "post_id": 38542956, "comment_id": 64478168, "body": "I do not think this is the right approach. For example, when using the http package, http.ListenAndServe(&quot;:8080&quot;, http.FileServer(http.Dir(&quot;uploads&quot;))) works fine, even with large files. I think there is either some limit that can be set within Echo, or it&#39;s a bug."}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1536001779, "creation_date": 1536001779, "answer_id": 52155144, "question_id": 38542956, "link": "https://stackoverflow.com/questions/38542956/serving-large-videofiles-fails/52155144#52155144", "title": "Serving large Videofiles fails", "body": "<p>you are looking for <code>echo.File()</code>. This method serves, longer files, like yours because the underlying <code>net/http</code> package used in <code>http.FileServer()</code> and <code>echo.File()</code> are the same. You can add something like this</p>\n\n<p><code>echo.File(\"route\",\"filepath\",middleware)</code>.</p>\n\n<p>You can also use the same functionality which is associated with <code>echo.Context</code> by the same name <code>c.File()</code>. Here the function definition is shorter and has an example in echo webpage <a href=\"https://echo.labstack.com/cookbook/file-download\" rel=\"nofollow noreferrer\">https://echo.labstack.com/cookbook/file-download</a>.</p>\n"}], "owner": {"reputation": 793, "user_id": 786126, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5fdda792896b8f14da6d1ce532f9624b?s=128&d=identicon&r=PG", "display_name": "zeroc8", "link": "https://stackoverflow.com/users/786126/zeroc8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536001779, "creation_date": 1469284790, "last_edit_date": 1521026698, "question_id": 38542956, "link": "https://stackoverflow.com/questions/38542956/serving-large-videofiles-fails", "title": "Serving large Videofiles fails", "body": "<p>I'm using the Echo Framework's static filehandler for serving uploaded files out of my upload directory.</p>\n\n<pre><code>e := echo.New()\ne.Static(\"/uploads\",\"uploads\")  \n</code></pre>\n\n<p>This works fine for smaller video files. I've tested it with a 20MB videofile, which works fine. Larger files, for example a 50MB testfile, do not work. The underlying TCP connection gets closed before the whole file is being served.</p>\n\n<p>Does anyone know if there is a filesize limit or a timer that can be set to prevent this? </p>\n"}, {"tags": ["go", "types", "constants"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469284025, "post_id": 38542588, "comment_id": 64477622, "body": "There are boolean constants, rune constants, integer constants, floating-point constants, complex constants, and string constants. REGP isn&#39;t one of those."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469284261, "post_id": 38542588, "comment_id": 64477682, "body": "@JimB - You mean that I cannot make a custom type constant? Do you have any idea to make it looks better?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469284779, "post_id": 38542588, "comment_id": 64477805, "body": "Correct <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Constants</a>. Most code would use a variable, or just make the regex string const"}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469285148, "post_id": 38542588, "comment_id": 64477881, "body": "Is there a way to wrap <code>pattern</code> and <code>Descr</code> together to form global variables?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469285693, "post_id": 38542588, "comment_id": 64478046, "body": "Yes, you can create a global variable of type REGP."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469286048, "post_id": 38542588, "comment_id": 64478145, "body": "Could you give me some hints? I get error on my every try."}, {"owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1469286308, "post_id": 38542588, "comment_id": 64478215, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/118095/discussion-between-casper-li-and-jimb\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "is_accepted": false, "score": 1, "last_activity_date": 1469288106, "creation_date": 1469288106, "answer_id": 38543446, "question_id": 38542588, "link": "https://stackoverflow.com/questions/38542588/making-constant-global-variables-of-a-custom-struct-type/38543446#38543446", "title": "Making constant global variables of a custom struct type", "body": "<p>I finally find that it seems not possible to make the <code>REGP</code> pointer or its variable inside to be constant. So I just make them global variables.</p>\n\n<pre><code>package aut\n\nimport \"regexp\"\n\ntype Input string\n\ntype REGP struct {\n    pattern string\n    Descr   string\n}\n\nvar REGP_LOGINNAME = REGP{\n    pattern: \"/^(?=^.{6,20}$)^[a-zA-Z][a-zA-Z0-9]*[._-]?[a-zA-Z0-9]+$/\",\n    Descr:   \"regex description 1\",\n}\n\nvar REGP_PASSWORD = REGP{\n    pattern: \"/^(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s)[0-9a-zA-Z!@#$%^&amp;*()]*$/\",\n    Descr:   \"regex description 2\",\n}\n\nfunc (i Input) isMatch(regp REGP) bool {\n    isMatchREGP, _ := regexp.MatchString(regp.pattern, string(i))\n    return isMatchREGP\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": true, "score": 6, "last_activity_date": 1469337030, "creation_date": 1469337030, "answer_id": 38548945, "question_id": 38542588, "link": "https://stackoverflow.com/questions/38542588/making-constant-global-variables-of-a-custom-struct-type/38548945#38548945", "title": "Making constant global variables of a custom struct type", "body": "<p>Consants in Go can only be scalar values (eg. <code>2</code>, <code>true</code>, <code>3.14</code>, <code>\"and more\"</code>) or any expression that is composed of only constants (eg. <code>1 + 2</code>, <code>\"hello \" + \"world\"</code>, or <code>2 * math.Pi * 1i</code>).</p>\n\n<p>This means that struct types such as your <code>REGP_LOGINNAME</code> which are not scalar values cannot be assigned to constants. Instead, use a variable:</p>\n\n<pre><code>var (\n    REGP_LOGINNAME = REGP{\n        pattern: `/^(?=^.{6,20}$)^[a-zA-Z][a-zA-Z0-9]*[._-]?[a-zA-Z0-9]+$/`,\n        Descr:   \"regex description 1\",\n    }\n    REGP_PASSWORD = REGP{\n        pattern: `/^(?=^.{8,}$)(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\\s)[0-9a-zA-Z!@#$%^&amp;*()]*$/`,\n        Descr:   \"regex description 2\",\n    }\n)\n</code></pre>\n\n<h2>Further Reading</h2>\n\n<ul>\n<li><a href=\"https://blog.golang.org/constants\" rel=\"noreferrer\">https://blog.golang.org/constants</a></li>\n</ul>\n\n<p><em>Aside:</em> I don't know your use case, of course, but I really <strong>really</strong> doubt you actually need or want to use a regexp to validate a users password. Instead, consider passing it through the <a href=\"https://godoc.org/golang.org/x/text/secure/precis#Profile\" rel=\"noreferrer\">OpaqueString profile of PRECIS</a> (a framework for handling and enforcing safety of unicode strings; the opaque string profile was designed to handle passwords). Similarly, the UsernameCaseMapped and UsernameCasePreserved profiles (also implemented in the linked package) can be used for usernames to ensure you don't end up with two usernames that look the same but have different unicode characters in them. Further validation can also be done, of course.</p>\n"}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5602, "favorite_count": 0, "accepted_answer_id": 38548945, "answer_count": 2, "score": 3, "last_activity_date": 1469337030, "creation_date": 1469282357, "last_edit_date": 1469286268, "question_id": 38542588, "link": "https://stackoverflow.com/questions/38542588/making-constant-global-variables-of-a-custom-struct-type", "title": "Making constant global variables of a custom struct type", "body": "<p>I want to create a \"class\" to handle the input validation. I first make a type of <code>Input</code> which is a string for storing user input and a type of <code>REGP</code> which store the regex pattern and the description of the pattern. I created two constant instances <code>REGP_LOGINNAME</code> and <code>REGP_PASSWORD</code>. But I get error of <code>const initializer REGP literal is not a constant</code>. Why?</p>\n\n<pre><code>package aut\n\nimport \"regexp\"\n\ntype Input string\n\ntype REGP struct {\n    pattern string\n    Descr   string\n}\n\nconst REGP_LOGINNAME = REGP{ //const initializer REGP literal is not a constant\n    \"regex pattern 1\",\n    \"regex description 1\",\n}\n\nconst REGP_PASSWORD = REGP{ //const initializer REGP literal is not a constant\n    \"regex pattern 2\",\n    \"regex description 2\",\n}\n\nfunc (i Input) isMatch(regp REGP) bool {\n    isMatchREGP, _ := regexp.MatchString(regp.pattern, string(i))\n    return isMatchREGP\n}\n</code></pre>\n\n<p>Error Message:</p>\n\n<pre><code>/usr/local/go/bin/go build -i [/home/casper/gopath/codespace_v2.6.6/dev/server_side/golang/go_codespace_v2.1/server/lib/aut]\n# _/home/casper/gopath/codespace_v2.6.6/dev/server_side/golang/go_codespace_v2.1/server/lib/aut\n./validation.go:15: const initializer REGP literal is not a constant\n./validation.go:20: const initializer REGP literal is not a constant\nError: process exited with code 2.\n</code></pre>\n"}, {"tags": ["go", "profiler"], "comments": [{"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "edited": false, "score": 0, "creation_date": 1526978806, "post_id": 38541971, "comment_id": 87939910, "body": "which go version are you using?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1526445284, "creation_date": 1526445284, "answer_id": 50362520, "question_id": 38541971, "link": "https://stackoverflow.com/questions/38541971/profiling-golang-runtime-systemstack/50362520#50362520", "title": "profiling golang runtime.systemstack", "body": "<p>If you did cpu profiling (<code>go test -cpuprofile</code>), <a href=\"https://github.com/golang/go/issues/10609\" rel=\"nofollow noreferrer\">issue 10609</a> mentioned \"runtime: cpu profile is not useful due to systemstack\" (<a href=\"https://go-review.googlesource.com/c/go/+/9506\" rel=\"nofollow noreferrer\">fixed here</a>, for <a href=\"https://github.com/golang/go/commit/db6f88a84b126877bd523df8c45af06779ce0e42\" rel=\"nofollow noreferrer\">Go 1.5</a>)</p>\n\n<p>You can have a more interesting view with the recent Go 1.10 trace: see \"<a href=\"https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d\" rel=\"nofollow noreferrer\">Using Go 1.10 new trace features to debug an integration test</a>\"</p>\n\n<pre><code>go test -trace trace.out\ngo tool trace -http=localhost:8080 trace.out\n</code></pre>\n\n<p>See an <a href=\"https://blog.gopheracademy.com/advent-2017/go-execution-tracer/\" rel=\"nofollow noreferrer\">example here</a>.\nYou will see clearly the inactivity period for each of your processors.</p>\n"}], "owner": {"reputation": 267, "user_id": 3142398, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-IvPGTvqHRnQ/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oj_LM08CHikNlfbLewdR2yCc6P6g/mo/photo.jpg?sz=128", "display_name": "Amit Shani", "link": "https://stackoverflow.com/users/3142398/amit-shani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1526445284, "creation_date": 1469278089, "last_edit_date": 1469458440, "question_id": 38541971, "link": "https://stackoverflow.com/questions/38541971/profiling-golang-runtime-systemstack", "title": "profiling golang runtime.systemstack", "body": "<p>I have a networking app written in go. the business logic isn't important.<br>\nThe problem is I'm struggling to utilize the full capabilites of my machine<br>\nand when I profile the applicaiton most of the time is spent in runtime stuff. \nIt seems that ALOT of time is spent under <code>runtime.systemstack</code><br>\nI don't understand what it means or how to increase performance.<br>\nI add the profiling of the related slow execution methods.<br>\n<a href=\"https://drive.google.com/file/d/0ByQSPd8fhPlzTGZ0V09pc2RvaUU/view?usp=sharing\" rel=\"noreferrer\">svg file</a></p>\n"}, {"tags": ["variables", "go", "types", "scope"], "answers": [{"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 1, "last_activity_date": 1469282277, "creation_date": 1469282277, "answer_id": 38542577, "question_id": 38541598, "link": "https://stackoverflow.com/questions/38541598/why-is-it-possible-to-export-variable-of-private-type/38542577#38542577", "title": "Why is it possible to export variable of private type", "body": "<p>Essentially, it's a singleton pattern. The package exports a single instance of <code>person</code> but because the type is private you can't create another instance out of it.</p>\n\n<p>Better implementation would be to export a function that returns a singleton instance of a private type. On first invocation it will create the instance in a thread-safe manner. </p>\n\n<pre><code>var (\n    p    *person\n    once sync.Once\n)\n\ntype person struct {\n    Name string\n}\n\nfunc Per() *person {\n    once.Do(func() {\n        p = &amp;person{\n            Name: \"Jack\",\n        }\n    })\n\n    return p\n}\n</code></pre>\n\n<p><code>sync.Once</code> allows you to execute a piece of code only once even if multiple goroutines are trying to execute it. </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 3, "last_activity_date": 1469284047, "last_edit_date": 1469284047, "creation_date": 1469283300, "answer_id": 38542739, "question_id": 38541598, "link": "https://stackoverflow.com/questions/38541598/why-is-it-possible-to-export-variable-of-private-type/38542739#38542739", "title": "Why is it possible to export variable of private type", "body": "<p>it is fine:  </p>\n\n<blockquote>\n  <p>Exported identifiers:</p>\n  \n  <p>An identifier may be exported to permit access to it from another\n  package. An identifier is exported if both:</p>\n  \n  <ul>\n  <li>the first character of the identifier's name is a Unicode upper case\n  letter (Unicode class \"Lu\"); and  </li>\n  <li>the identifier is declared in the\n  package block or it is a field name or method name. All other\n  identifiers are not exported.  </li>\n  </ul>\n</blockquote>\n\n<p>ref:  <a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">https://golang.org/ref/spec</a>  </p>\n\n<p>and even you can use Getters:</p>\n\n<blockquote>\n  <p>Go doesn't provide automatic support for getters and setters. There's\n  nothing wrong with providing getters and setters yourself, and it's\n  often appropriate to do so, but it's neither idiomatic nor necessary\n  to put Get into the getter's name. If you have a field called owner\n  (lower case, unexported), the getter method should be called Owner\n  (upper case, exported), not GetOwner. The use of upper-case names for\n  export provides the hook to discriminate the field from the method. A\n  setter function, if needed, will likely be called SetOwner. Both names\n  read well in practice:</p>\n\n<pre><code>owner := obj.Owner()\nif owner != user {\n    obj.SetOwner(user)\n}  \n</code></pre>\n</blockquote>\n\n<p>ref:  <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">https://golang.org/doc/effective_go.html</a>  </p>\n\n<p>so if you do not want to export <code>Name</code> make it lower case, like this working sample codes and use Getter/Setter :  </p>\n\n<pre><code>package first\n\ntype person struct {\n    name string\n}\n\nvar Per = person{\n    name: \"Jack\",\n}\n\nfunc (p *person) SetName(name string) {\n    p.name = name\n}\n\nfunc (p *person) Name() string {\n    return p.name\n}\n</code></pre>\n\n<p>main.go (with commented output):  </p>\n\n<pre><code>package main\n\nimport \"first\"\nimport \"fmt\"\n\nfunc main() {\n    person := first.Per\n    fmt.Println(person.Name()) //Jack\n    person.SetName(\"Alex\")\n    fmt.Println(person.Name()) //Alex\n}\n</code></pre>\n\n<h3>another use cases:</h3>\n\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Singleton_pattern\" rel=\"nofollow\">Singleton pattern</a></li>\n</ul>\n"}], "owner": {"reputation": 93, "user_id": 5305806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/iv16I.jpg?s=128&g=1", "display_name": "Vikram Chhipa", "link": "https://stackoverflow.com/users/5305806/vikram-chhipa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1236, "favorite_count": 0, "accepted_answer_id": 38542739, "answer_count": 2, "score": 1, "last_activity_date": 1469284047, "creation_date": 1469275510, "last_edit_date": 1469283414, "question_id": 38541598, "link": "https://stackoverflow.com/questions/38541598/why-is-it-possible-to-export-variable-of-private-type", "title": "Why is it possible to export variable of private type", "body": "<p>Think like this :  </p>\n\n<pre><code>package first\n\ntype person struct {\n    Name string\n}\n\nvar Per = person{\n    Name: \"Jack\",\n}\n</code></pre>\n\n<p>and in main package</p>\n\n<pre><code>package main\n\nimport \"first\"\nimport \"fmt\"\n\nfunc main(){\n    o := first.Per\n    fmt.Println(o)\n}\n</code></pre>\n\n<p>the above works, as we can see that the variable in first package was visible outside but it's type was not, but it gives no error? And how it can be useful outside package?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1469269831, "post_id": 38540366, "comment_id": 64473988, "body": "In this case <code>interface</code> is the way to go."}, {"owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1469274427, "post_id": 38540366, "comment_id": 64475224, "body": "Could you give me some more details?"}], "answers": [{"comments": [{"owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469448993, "post_id": 38546064, "comment_id": 64524700, "body": "This might be it. I am still getting <code>invalid operation: result[&quot;value&quot;][&quot;sha1&quot;] (type interface {} does not support indexing)</code>"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469450478, "post_id": 38546064, "comment_id": 64525775, "body": "@Petru can you post result of <code>fmt.Printf(&quot;%+v\\n&quot;, resp)</code>? Looks like your <code>resp</code> is not <code>bson.M</code> and this is strange."}, {"owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469452032, "post_id": 38546064, "comment_id": 64526901, "body": "<code>map[extracted_files:&lt;nil&gt; file_info:map[file_size:235933 file_type_description:Win32...</code> my error is at compile time"}, {"owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469452204, "post_id": 38546064, "comment_id": 64527022, "body": "I can print <code>result[&quot;value&quot;]</code>. <code>result[&quot;value&quot;][&quot;sha1&quot;]</code> throws invalid operation."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469464215, "post_id": 38546064, "comment_id": 64535069, "body": "@Petru try <code>result[&quot;value&quot;].(bson.M)[&quot;sha1&quot;]</code>"}, {"owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "edited": false, "score": 0, "creation_date": 1469465357, "post_id": 38546064, "comment_id": 64535700, "body": "Worked like a charm!"}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1469655287, "last_edit_date": 1469655287, "creation_date": 1469305071, "answer_id": 38546064, "question_id": 38540366, "link": "https://stackoverflow.com/questions/38540366/use-mgo-aggregate-iterator-data-in-upsert-without-unmarshaling/38546064#38546064", "title": "Use mgo aggregate iterator data in upsert without unmarshaling", "body": "<p>Maybe I misunderstood you but you can simply access returned documents as a <code>map</code>. Something like this:</p>\n\n<pre><code>pipe := c.Pipe([]bson.M{})\niter := pipe.Iter()\nresp := bson.M{} // not array as you are using iterator which returns single document\n\nfor iter.Next(&amp;resp) {\n    otherCollection.Upsert(bson.M{\"value.sha1\": result[\"value\"].(bson.M)[\"sha1\"]}, resp)\n}\n</code></pre>\n"}], "owner": {"reputation": 834, "user_id": 1289113, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3b94526f54ef6ec169a099d9dfe24b5d?s=128&d=identicon&r=PG", "display_name": "Petru", "link": "https://stackoverflow.com/users/1289113/petru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 38546064, "answer_count": 1, "score": 1, "last_activity_date": 1469655287, "creation_date": 1469267106, "question_id": 38540366, "link": "https://stackoverflow.com/questions/38540366/use-mgo-aggregate-iterator-data-in-upsert-without-unmarshaling", "title": "Use mgo aggregate iterator data in upsert without unmarshaling", "body": "<p>First of all, I am very new to go :)</p>\n\n<p>I am trying to do an aggregate + upsert in mongo using go and mgo driver.</p>\n\n<p>My code looks something like this:</p>\n\n<pre><code>pipe := c.Pipe([]bson.M{{\"$match\": bson.M{\"name\":\"John\"}}})\niter := pipe.Iter()\nresp := []bson.M{}\n\nfor iter.Next(&amp;resp) {\n     //\n     // read \"value.sha1\" from each response\n     // do a:\n     // otherCollection.Upsert(bson.M{\"value.sha1\": mySha1}, resp)\n     //\n}\n</code></pre>\n\n<p>The response from the aggregate collection can have lot's of formats, so I can't define a struct for it. </p>\n\n<p>I just need to get one of the fields from the response, which is a sha1, and update another collection with the response received, based on the sha1 condition.</p>\n\n<p>Can anybody point me in the right direction?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2261, "user_id": 1654631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8d805f46866346046b4527bee7d8a24?s=128&d=identicon&r=PG", "display_name": "Shiv Buyya", "link": "https://stackoverflow.com/users/1654631/shiv-buyya"}, "edited": false, "score": 0, "creation_date": 1469251245, "post_id": 38538332, "comment_id": 64469934, "body": "new allocates memory dynamically, for uninitialized variable memory is not allocated yet."}, {"owner": {"reputation": 593, "user_id": 3956094, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/100003002375819/picture?type=large", "display_name": "Yosua Lijanto Binar", "link": "https://stackoverflow.com/users/3956094/yosua-lijanto-binar"}, "reply_to_user": {"reputation": 2261, "user_id": 1654631, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c8d805f46866346046b4527bee7d8a24?s=128&d=identicon&r=PG", "display_name": "Shiv Buyya", "link": "https://stackoverflow.com/users/1654631/shiv-buyya"}, "edited": false, "score": 0, "creation_date": 1469251785, "post_id": 38538332, "comment_id": 64469999, "body": "is it address of memory or content of memory? because if I check address of both, they are allocates. The content also."}], "answers": [{"comments": [{"owner": {"reputation": 593, "user_id": 3956094, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/100003002375819/picture?type=large", "display_name": "Yosua Lijanto Binar", "link": "https://stackoverflow.com/users/3956094/yosua-lijanto-binar"}, "edited": false, "score": 0, "creation_date": 1469257296, "post_id": 38538926, "comment_id": 64471057, "body": "So the conclusion is var s *string = &amp;emptyString same with s := new(string)?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1469264440, "post_id": 38538926, "comment_id": 64472670, "body": "Yes. Just the former form is supported only for <code>struct</code> types. But <i>conceptually</i> they are the same. I&#39;m also pretty sure the compiler would end up generating the same code for them."}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": false, "score": 4, "last_activity_date": 1469255678, "creation_date": 1469255678, "answer_id": 38538926, "question_id": 38538332, "link": "https://stackoverflow.com/questions/38538332/difference-of-new-function-and-uninitialized-variable/38538926#38538926", "title": "Difference of New Function and Uninitialized Variable", "body": "<p>This code:</p>\n\n<pre><code>var s *string\n</code></pre>\n\n<p>Simply declare \"s\" as a pointer to a string. In this case \"s\" is a nil pointer, this is the default value in golang for pointers.</p>\n\n<p>This code:</p>\n\n<pre><code>s := new(string)\n</code></pre>\n\n<p>Also declare \"s\" as a pointer to a string, but this time the string is initialized. That means \"s\" is a non-nil pointer, and points to the default value for string in golang, an empty string.</p>\n\n<p><a href=\"https://play.golang.org/p/r8AbKlKQZI\">See this playground</a> </p>\n"}, {"comments": [{"owner": {"reputation": 593, "user_id": 3956094, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/100003002375819/picture?type=large", "display_name": "Yosua Lijanto Binar", "link": "https://stackoverflow.com/users/3956094/yosua-lijanto-binar"}, "edited": false, "score": 0, "creation_date": 1469261906, "post_id": 38539576, "comment_id": 64472098, "body": "So the conclusion is var s *string = &amp;emptyString same with s := new(string)?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1469264276, "post_id": 38539576, "comment_id": 64472622, "body": "Correction: <code>new()</code> allocates memory for a value, not a variable. In <code>s := new(string)</code>, the variable is &quot;s&quot;, and the value it holds is a pointer to another value -- this time a string, -- which was allocated by <code>new()</code>."}, {"owner": {"reputation": 593, "user_id": 3956094, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/100003002375819/picture?type=large", "display_name": "Yosua Lijanto Binar", "link": "https://stackoverflow.com/users/3956094/yosua-lijanto-binar"}, "edited": false, "score": 0, "creation_date": 1469264744, "post_id": 38539576, "comment_id": 64472744, "body": "@Amd: When var allocates memory? At Compile? -- Sorry a little bit OOT, what is the difference allocates memory at run time and compile? Beside of the time."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1469264755, "post_id": 38539576, "comment_id": 64472750, "body": "To be more clear: variables are named things holding values. They are for the programmer only. What&#39;s kept in memory, are values. So &quot;allocating a variable&quot; simply is nonsense because you can only allocate a value. Note that this is only true for  static compiled languages; in certain (most?) dynamic/scripting languages it&#39;s indeed possible to create variables at runtime."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1469264503, "last_edit_date": 1469264503, "creation_date": 1469260985, "answer_id": 38539576, "question_id": 38538332, "link": "https://stackoverflow.com/questions/38538332/difference-of-new-function-and-uninitialized-variable/38539576#38539576", "title": "Difference of New Function and Uninitialized Variable", "body": "<p>first difference:  </p>\n\n<blockquote>\n  <p>The built-in function new takes a type T, allocates storage for a\n  variable of that type <strong>at run time</strong></p>\n</blockquote>\n\n<p>2nd difference: \n<code>new</code> initializes allocated string to empty string (\"\") and initializes pointer to the address of this string, but <code>var ptr2 *string</code> \njust initializes <code>ptr2</code> to <code>nil</code> and do not allocates any string:</p>\n\n<p>sample code A (with commented output):  </p>\n\n<pre><code>ptr := new(string)               // *ptr has value \"\", ptr: static type *string\nfmt.Println(len(*ptr))           // 0\nfmt.Println(cap([]byte(*ptr)))   // 32\nfmt.Printf(\"%T %q\\n\", ptr, *ptr) // *string \"\"\n</code></pre>\n\n<p>sample code B (with commented output):  </p>\n\n<pre><code>var ptr2 *string                // ptr2 has value nil, static type *string\nfmt.Printf(\"%T %#[1]v\\n\", ptr2) // *string (*string)(nil)\n//fmt.Println(len(*ptr2)) // panic: runtime error: invalid memory address or nil pointer dereference\n//fmt.Println(cap([]byte(*ptr2)))\n</code></pre>\n\n<p>sample code C (with commented output):</p>\n\n<pre><code>var str string                // str has value \"\", static type string\nfmt.Println(len(str))         // 0\nfmt.Println(cap([]byte(str))) // 32\nfmt.Printf(\"%T %[1]q\\n\", str) // string \"\"\n</code></pre>\n\n<p>Allocation:</p>\n\n<blockquote>\n  <p><strong>The built-in function new takes a type T, allocates storage for a\n  variable of that   type at run time</strong>, and returns a value of type *T\n  pointing to it. The variable is initialized as described in the\n  section on <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow\">initial values</a>.</p>\n\n<pre><code>new(T)\n</code></pre>\n  \n  <p>For instance</p>\n\n<pre><code>type S struct { a int; b float64 }\nnew(S)\n</code></pre>\n  \n  <p>allocates storage for a variable of type S, initializes it (a=0,\n  b=0.0), and returns a value of type *S containing the address of the\n  location.</p>\n</blockquote>\n\n<p>ref: <a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">https://golang.org/ref/spec</a>  </p>\n\n<p>Allocation with new: </p>\n\n<blockquote>\n  <p>Go has two allocation primitives, the built-in\n  functions new and make. They do different things and apply to\n  different types, which can be confusing, but the rules are simple.\n  Let's talk about new first. <strong>It's a built-in function that allocates\n  memory</strong>, but unlike its namesakes in some other languages it does not\n  initialize the memory, it only zeros it. That is, new(T) allocates\n  zeroed storage for a new item of type T and returns its address, a\n  value of type *T. In Go terminology, it returns a pointer to a newly\n  allocated zero value of type T.</p>\n  \n  <p><strong>Since the memory returned by new is zeroed, it's helpful to arrange\n  when designing your data structures that the zero value of each type\n  can be used without further initialization.</strong> This means a user of the\n  data structure can create one with new and get right to work. For\n  example, the documentation for bytes.Buffer states that \"the zero\n  value for Buffer is an empty buffer ready to use.\" Similarly,\n  sync.Mutex does not have an explicit constructor or Init method.\n  Instead, the zero value for a sync.Mutex is defined to be an unlocked\n  mutex.</p>\n  \n  <p>The zero-value-is-useful property works transitively. Consider this\n  type declaration.</p>\n\n<pre><code>type SyncedBuffer struct {\n    lock    sync.Mutex\n    buffer  bytes.Buffer\n} Values of type SyncedBuffer are also ready to use immediately upon allocation or just declaration. In the next snippet, both p and v\n</code></pre>\n  \n  <p>will work correctly without further arrangement:</p>\n\n<pre><code>p := new(SyncedBuffer)  // type *SyncedBuffer\nvar v SyncedBuffer      // type  SyncedBuffer\n</code></pre>\n  \n  <p>Allocation with make:   Back to allocation. The built-in function\n  make(T, args) serves a purpose different from new(T). It creates\n  slices, maps, and channels only, and it returns an initialized (not\n  zeroed) value of type T (not *T). The reason for the distinction is\n  that these three types represent, under the covers, references to data\n  structures that must be initialized before use. A slice, for example,\n  is a three-item descriptor containing a pointer to the data (inside an\n  array), the length, and the capacity, and until those items are\n  initialized, the slice is nil. For slices, maps, and channels, make\n  initializes the internal data structure and prepares the value for\n  use. For instance,</p>\n\n<pre><code>make([]int, 10, 100) \n</code></pre>\n  \n  <p>allocates an array of 100 ints and then creates a slice structure with\n  length 10 and a capacity of 100\n  pointing at the first 10 elements of the array. (When making a slice,\n  the capacity can be omitted; see the section on slices for more\n  information.) <strong>In contrast, new([]int) returns a pointer to a newly\n  allocated, zeroed slice structure, that is, a pointer to a nil slice\n  value. These examples illustrate the difference between new and make:</strong></p>\n\n<pre><code>var p *[]int = new([]int)       // allocates slice structure; *p == nil; rarely useful\nvar v  []int = make([]int, 100) // the slice v now refers to a new array of 100 ints\n\n// Unnecessarily complex:\nvar p *[]int = new([]int)\n*p = make([]int, 100, 100)\n\n// Idiomatic:\nv := make([]int, 100)\n</code></pre>\n  \n  <p>Remember that make applies only to maps, slices and channels and does\n  not return a pointer. To obtain an explicit pointer allocate with new\n  or take the address of a variable explicitly.</p>\n</blockquote>\n\n<p>ref:  <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">https://golang.org/doc/effective_go.html</a>  </p>\n"}], "owner": {"reputation": 593, "user_id": 3956094, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/100003002375819/picture?type=large", "display_name": "Yosua Lijanto Binar", "link": "https://stackoverflow.com/users/3956094/yosua-lijanto-binar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 38539576, "answer_count": 2, "score": 0, "last_activity_date": 1469265296, "creation_date": 1469249876, "last_edit_date": 1469265296, "question_id": 38538332, "link": "https://stackoverflow.com/questions/38538332/difference-of-new-function-and-uninitialized-variable", "title": "Difference of New Function and Uninitialized Variable", "body": "<p>What's the difference of new function and uninitialized variable? What's the advantage of both?</p>\n\n<pre><code>s := new(string) // *string\nvar s *string    // *string\nvar s string     // string\n</code></pre>\n\n<p>Is it only for simplicity the code? Because i think it's same</p>\n\n<pre><code>s := new(string) /* same as */ var s *string = &amp;emptyString\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 6627664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934596877829949ce488b39c087baaad?s=128&d=identicon&r=PG&f=1", "display_name": "MFreundlich", "link": "https://stackoverflow.com/users/6627664/mfreundlich"}, "edited": false, "score": 0, "creation_date": 1469244836, "post_id": 38537542, "comment_id": 64468940, "body": "Thanks for the response! Unfortunately after changing the import statement I still get the error : can&#39;t find import: &quot;web_console&quot; ."}], "tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": false, "score": 0, "last_activity_date": 1469240648, "creation_date": 1469240648, "answer_id": 38537542, "question_id": 38537417, "link": "https://stackoverflow.com/questions/38537417/why-cant-go-app-builder-find-local-imports/38537542#38537542", "title": "Why cant go-app-builder find local imports?", "body": "<p>Each GAE service/module is standalone and can not access anything <strong>outside</strong> the service/module dir which:</p>\n\n<ul>\n<li>is the directory where the <code>.yaml</code> file exists</li>\n<li>is what's uploaded during deployment</li>\n<li>is considered the \"root\" directory for that service/module, everything is relative to it</li>\n</ul>\n\n<p>In your particular case you need to make sure no service/module makes references to the parent <code>myapp</code> dir (which is nothing but an organisational placeholder for the app stuff, relevant on your side but <strong>with no actual presence on GAE</strong>). I believe your <code>mod1.go</code> import should looks like this:</p>\n\n<pre><code>package mod1\n\nimport (\n    \"web_console\"\n)\n</code></pre>\n\n<p>But take it with a grain of salt, I'm not actually familiar with go.</p>\n"}, {"comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1469247954, "post_id": 38538090, "comment_id": 64469449, "body": "With your original import statement?"}, {"owner": {"reputation": 111, "user_id": 6627664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934596877829949ce488b39c087baaad?s=128&d=identicon&r=PG&f=1", "display_name": "MFreundlich", "link": "https://stackoverflow.com/users/6627664/mfreundlich"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1469248038, "post_id": 38538090, "comment_id": 64469461, "body": "Yup, didn&#39;t change anything. I&#39;m not too sure what&#39;s going on so I&#39;m going to dive into the documentation a bit more."}], "tags": [], "owner": {"reputation": 111, "user_id": 6627664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934596877829949ce488b39c087baaad?s=128&d=identicon&r=PG&f=1", "display_name": "MFreundlich", "link": "https://stackoverflow.com/users/6627664/mfreundlich"}, "is_accepted": false, "score": 0, "last_activity_date": 1469247138, "creation_date": 1469247138, "answer_id": 38538090, "question_id": 38537417, "link": "https://stackoverflow.com/questions/38537417/why-cant-go-app-builder-find-local-imports/38538090#38538090", "title": "Why cant go-app-builder find local imports?", "body": "<p>It seems like I was using the wrong tool to deploy. I ran the command with <code>goapp deploy app/app.yaml mod1/mod1.yaml</code> and was able to successfully deploy the services without issue.</p>\n"}], "owner": {"reputation": 111, "user_id": 6627664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/934596877829949ce488b39c087baaad?s=128&d=identicon&r=PG&f=1", "display_name": "MFreundlich", "link": "https://stackoverflow.com/users/6627664/mfreundlich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1469247138, "creation_date": 1469238940, "question_id": 38537417, "link": "https://stackoverflow.com/questions/38537417/why-cant-go-app-builder-find-local-imports", "title": "Why cant go-app-builder find local imports?", "body": "<p>I am currently writing an application in Go and trying to deploy multiple services. I am running the following command : <code>gcloud app deploy dispatch.yaml app/app.yaml mod1/mod1.yaml</code>. </p>\n\n<p>The app.yaml file corresponds to the default service and is successfully deployed however the service mod1 returns this error: </p>\n\n<pre><code>ERROR: (gcloud.app.deploy) Error Response: [9] Deployment contains files that cannot be compiled: Compile failed: 2016/07/22 18:17:14 go-app-builder: build timing: 1\u00d7compile (53ms total), 0\u00d7link (0 total) 2016/07/22 18:17:14 go-app-builder: failed running compile: exit status 1\n\nmod1.go:4: can't find import: \"myapp/mod1/web_console\"\n\nMy-Macbook: myapp$ gcloud app deploy dispatch.yaml app/app.yaml mod1/mod1.yaml\n</code></pre>\n\n<p>My file structure is as follows:</p>\n\n<ul>\n<li>/My_Project \n\n<ul>\n<li>/src\n\n<ul>\n<li>/myapp \n\n<ul>\n<li>/app\n\n<ul>\n<li>app.go </li>\n<li>app.yaml</li>\n</ul></li>\n<li>/mod1 \n\n<ul>\n<li>mod1.go </li>\n<li>mod1.yaml</li>\n<li>/web_console\n\n<ul>\n<li>web_console.go</li>\n</ul></li>\n</ul></li>\n</ul></li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p><strong>mod1.go :</strong></p>\n\n<pre><code>package mod1\n\nimport (\n    \"myapp/mod1/web_console\"\n)\n\nfunc init() {\n    // Initializing Web Console establishes connection\n    // to the database and also creates routes\n    var wc *web_console.WebConsole\n    wc = web_console.NewWebConsole(true)\n    wc.Configure()\n}\n</code></pre>\n\n<p><strong>mod1.yaml :</strong></p>\n\n<pre><code>module: mod1\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p><strong>app.yaml :</strong></p>\n\n<pre><code>module: default\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n script: _go_app\n</code></pre>\n\n<p>Thanks for taking the time to help!</p>\n"}, {"tags": ["testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1469232850, "creation_date": 1469232850, "answer_id": 38536893, "question_id": 38536734, "link": "https://stackoverflow.com/questions/38536734/golang-find-filenames-and-line-numbers-that-prints-output-to-stdout/38536893#38536893", "title": "Golang: Find filenames and line numbers that prints output to stdout", "body": "<p>Maybe adding some instrumentation to your legacy code could help.</p>\n\n<p>For instance, <a href=\"https://github.com/spacemonkeygo/monkit\" rel=\"nofollow\"><code>spacemonkeygo/monkit</code></a> can add <a href=\"https://github.com/spacemonkeygo/monkit#trace-graphs\" rel=\"nofollow\">trace graphs</a> for you to at least identify from where those logs are generated.</p>\n"}, {"tags": [], "owner": {"reputation": 186, "user_id": 3896867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uyluq.png?s=128&g=1", "display_name": "Marcel Voigt", "link": "https://stackoverflow.com/users/3896867/marcel-voigt"}, "is_accepted": false, "score": 1, "last_activity_date": 1469259325, "creation_date": 1469259325, "answer_id": 38539363, "question_id": 38536734, "link": "https://stackoverflow.com/questions/38536734/golang-find-filenames-and-line-numbers-that-prints-output-to-stdout/38539363#38539363", "title": "Golang: Find filenames and line numbers that prints output to stdout", "body": "<p>If the messages are printed using the <code>log</code> package, you could tell it to always include the full file path and line number where the calls happen:</p>\n\n<pre><code>log.SetFlags(log.LstdFlags|log.Llongfile)\n</code></pre>\n"}], "owner": {"reputation": 311, "user_id": 2210093, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/28aae85287829addd5198cc0844a0e4a?s=128&d=identicon&r=PG", "display_name": "hrs", "link": "https://stackoverflow.com/users/2210093/hrs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1469259325, "creation_date": 1469231444, "question_id": 38536734, "link": "https://stackoverflow.com/questions/38536734/golang-find-filenames-and-line-numbers-that-prints-output-to-stdout", "title": "Golang: Find filenames and line numbers that prints output to stdout", "body": "<p>I inherited a codebase with tens of thousands of lines, and several libraries, that prints out several lines of garbage (both from normal functions and imported libraries, as well as from test functions and libraries) onto the console when I run a <code>go test</code>. This makes testing a nightmare since my print statements and errors get lost in a sea of junk.</p>\n\n<p>Is there an easy way to identify and output the filenames and line numbers where any sort of printing to the console occurs, so that I can mute these suckers?</p>\n"}, {"tags": ["mongodb", "go", "deferred", "mgo", "revel"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1469402294, "last_edit_date": 1469402294, "creation_date": 1469401404, "answer_id": 38557706, "question_id": 38531267, "link": "https://stackoverflow.com/questions/38531267/how-to-defer-an-mgo-session-until-its-fully-streamed-to-the-client/38557706#38557706", "title": "How to defer an mgo Session until it&#39;s fully streamed to the client?", "body": "<p>I have no idea what your <code>OpenFile</code> function doing but I assume it using Mongo's GridFS to access the file. You are right <code>defer session.Close()</code> is called right before the return. If you use file Revel <a href=\"https://github.com/revel/revel/blob/a9a2ff45fae4330ef4116b257bcf9c82e53350c2/results.go#L349\" rel=\"nofollow\">closes it automatically</a> but in your case, you also want to close the session.</p>\n\n<p>The only one way around it is to make custom Reader that can be used by Revel in <code>RenderBinary</code>. Something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"gopkg.in/mgo.v2\"\n)\n\ntype MongoReader struct {\n    io.Reader\n    File    *os.File\n    Session *mgo.Session\n}\n\nfunc (mr *MongoReader) Read(p []byte) (n int, e error) {\n    return mr.File.Read(p)\n}\n\nfunc (mr *MongoReader) Close() {\n    mr.File.Close()\n    mr.Session.Close()\n}\n\nfunc main() {\n    mr := MongoReader{}\n    mr.Session, mr.File = OpenFile(\"abababa\")\n    return c.RenderBinary(mr, \"filename\", \"inline\", now)\n}\n</code></pre>\n\n<p>I didn't test it on Revel but as code is quite simple I think it should work. Maybe you will need some <code>os.File</code> specific methods.</p>\n"}], "owner": {"reputation": 829, "user_id": 5853279, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bb52cf1bbfd8c91d1df94ebb05e798c6?s=128&d=identicon&r=PG&f=1", "display_name": "pward", "link": "https://stackoverflow.com/users/5853279/pward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1469402294, "creation_date": 1469204703, "question_id": 38531267, "link": "https://stackoverflow.com/questions/38531267/how-to-defer-an-mgo-session-until-its-fully-streamed-to-the-client", "title": "How to defer an mgo Session until it&#39;s fully streamed to the client?", "body": "<p>I want to close an mgo session after it' fully streamed to the client. At first, I thought this might work, but it seems the <code>defer</code> just waits until the the func begins to return or something. </p>\n\n<pre><code>func (c App) OpenFile(fileId string) revel.Result {\n    // convert string to bson.ObjectId\n    objId := bson.ObjectIdHex(fileId)\n    file, session := OpenFile(objId)\n    defer session.Close()\n    // memfile io.Reader, filename string, delivery ContentDisposition, modtime time.Time\n    var now = time.Now()\n    return c.RenderBinary(file, \"filename\", \"inline\", now)\n}\n</code></pre>\n"}]