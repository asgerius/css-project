[{"tags": ["json", "go", "struct", "structure"], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1476332794, "creation_date": 1476332794, "answer_id": 40012284, "question_id": 40008652, "link": "https://stackoverflow.com/questions/40008652/golang-nested-struct-and-map/40012284#40012284", "title": "golang nested struct and map", "body": "<p>The #1 asked question on SO's go tag.</p>\n\n<p>Struct members has to be exported, aka start with capital letter.</p>\n\n<pre><code>type book struct{\n  Category string `json:\"category\"`\n  Books []*BookDetails `json:\"books\"`\n}\n\ntype BookDetails struct{\n  Name  string `json:\"name\"`\n  ID    uint `json:\"id\"`\n  Publisher string `json:\"publisher\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 1659640, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/rrNBG.jpg?s=128&g=1", "display_name": "Dhanesh Mane", "link": "https://stackoverflow.com/users/1659640/dhanesh-mane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1365, "favorite_count": 0, "closed_date": 1476332915, "answer_count": 1, "score": 0, "last_activity_date": 1476332794, "creation_date": 1476307666, "question_id": 40008652, "link": "https://stackoverflow.com/questions/40008652/golang-nested-struct-and-map", "closed_reason": "Duplicate", "title": "golang nested struct and map", "body": "<p>I am new to golang and trying to map database query result to my struct which is nested but I am getting errors and not able to figure out the best way to do it. This program is suppose to out JSON - book details group by categories.</p>\n\n<p><strong>Struct is as follows</strong></p>\n\n<pre><code>type book struct{\n  category string\n  books []*bookDetails\n}\n\ntype bookDetails struct{\n  name  string\n  id    uint\n  publisher string.\n}\n</code></pre>\n\n<p><strong>Expected JSON output</strong></p>\n\n<pre><code>[\n  {\n    \"category\" : \"Ficton\",\n    \"books\" : [\n               {name:'aaa',id:12,publisher:'one'},\n               {name:'bbb',id:13,publisher:'two'}\n             ]\n  },\n {\n    \"category\" : \"suspense\",\n    \"books\" : [\n               {name:'ccc',id:14,publisher:'three'},\n               {name:'ddd',id:15,publisher:'four'}\n             ]\n  }\n]\n</code></pre>\n\n<p>I am not writing SQL query here but please assume similar kind of database schema. <strong>dbRow</strong> in following code is output of select query. Following code is working fine but I am getting all the books in one array, and I am <strong>not able to figure out how can I make it group by categories</strong>.</p>\n\n<pre><code>detailsMap := make(map[uint][]*details)\nfor dbRow.Next() {\n  var det details\n  detErr := dbRow.StructScan(&amp;det)\n  detailsMap[det.id] = append(detailsMap[det.id], &amp;det)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": true, "score": 5, "last_activity_date": 1476304918, "creation_date": 1476304918, "answer_id": 40008000, "question_id": 40007920, "link": "https://stackoverflow.com/questions/40007920/go-slices-and-loops-multilple-loop-through-slice-items-while-reducing-the-items/40008000#40008000", "title": "Go slices and loops: Multilple loop through slice items while reducing the items with 1 each on each loop", "body": "<p>You don't seem to know that what you are doing is called <em>generating permutations</em>. Otherwise it would be easy to google an efficient algorithm for doing it.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 40008000, "answer_count": 1, "score": 2, "last_activity_date": 1476304918, "creation_date": 1476304635, "question_id": 40007920, "link": "https://stackoverflow.com/questions/40007920/go-slices-and-loops-multilple-loop-through-slice-items-while-reducing-the-items", "title": "Go slices and loops: Multilple loop through slice items while reducing the items with 1 each on each loop", "body": "<p>I have a slice of ints that I want to loop through multiple times, but each time I do another loop, I want to exclude the item from the parent loop.</p>\n\n<p>Something like this:</p>\n\n<pre><code>func main() {\n    as := []int{0, 1, 2, 3}\n    for i, a := range as {\n        bs := make([]int, len(as))\n        copy(bs, as)\n        bs = append(bs[:i], bs[i+1:]...)\n        for i, b := range bs {\n            cs := make([]int, len(bs))\n            copy(cs, bs)\n            cs = append(cs[:i], cs[i+1:]...)\n            for i, c := range cs {\n                ds := make([]int, len(cs))\n                copy(ds, cs)\n                ds = append(ds[:i], ds[i+1:]...)\n                for _, d := range ds {\n                    fmt.Println(a, b, c, d)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The output of this code is:</p>\n\n<pre><code>0123\n0132\n0213\n0231\n0312\n0321\n1023\n1032\n1203\n1230\n1302\n1320\n2013\n2031\n2103\n2130\n2301\n2310\n3012\n3021\n3102\n3120\n3201\n3210\n</code></pre>\n\n<p>Which is what I wanted. But this code does not look so good. I have to copy the slice multiple times before I remove an item, and then loop through the items on that slice. Is there a better and more dry way for me to achieve what I am doing here? I am going to the same thing for a slice that looks like this: <code>[]int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}</code></p>\n\n<p>I don't think writing each loop like I have done 10 times is a good way of doing things. Any suggestions how I can do this?</p>\n"}, {"tags": ["arrays", "go", "struct", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476303246, "post_id": 40006633, "comment_id": 67293089, "body": "There&#39;s a lot of missing functionality here, covering a lot of basic areas. What part are you asking about?"}, {"owner": {"reputation": 41, "user_id": 3218590, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed421600c9a989bef750d7b457ce880d?s=128&d=identicon&r=PG&f=1", "display_name": "user3218590", "link": "https://stackoverflow.com/users/3218590/user3218590"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476339552, "post_id": 40006633, "comment_id": 67304670, "body": "what is the best way  of casting C structure into Go structure? considering there can be different data types in the C structure."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476363161, "post_id": 40006633, "comment_id": 67319828, "body": "If the data types are different, you need to copy/convert those to their respective fields. For example, Go strings are not the same as C strings, so you can&#39;t &quot;cast&quot; those, you need to copy the characters from the C <code>char*</code> to the Go <code>string</code>"}, {"owner": {"reputation": 41, "user_id": 3218590, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed421600c9a989bef750d7b457ce880d?s=128&d=identicon&r=PG&f=1", "display_name": "user3218590", "link": "https://stackoverflow.com/users/3218590/user3218590"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476422863, "post_id": 40006633, "comment_id": 67347496, "body": "I am aware of that, that&#39;s why I was looking for any other short cut which can directly cast or map C struct to Golang struct"}, {"owner": {"reputation": 41, "user_id": 3218590, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed421600c9a989bef750d7b457ce880d?s=128&d=identicon&r=PG&f=1", "display_name": "user3218590", "link": "https://stackoverflow.com/users/3218590/user3218590"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476632252, "post_id": 40006633, "comment_id": 67417502, "body": "I have added a complex C struct studentStruct in my original post. Can some one add a code snippet to interpret this C struct in Go code?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476641598, "post_id": 40006633, "comment_id": 67420667, "body": "What do you mean by &quot;interpret&quot; the C struct? You said that you are aware that you need to copy/convert the data to use native Go structures, but are looking for a shortcut. You can access the struct directly as type <code>C.struct_student</code> if that&#39;s what you&#39;re looking for."}, {"owner": {"reputation": 1060, "user_id": 1727288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6f87f7fef5f4704e31d3ebf93b33f8f?s=128&d=identicon&r=PG", "display_name": "bain", "link": "https://stackoverflow.com/users/1727288/bain"}, "edited": false, "score": 0, "creation_date": 1567085012, "post_id": 40006633, "comment_id": 101864546, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28925179/cgo-how-to-pass-struct-array-from-c-to-go\">cgo: How to pass struct array from c to go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 6028077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qq0eE.png?s=128&g=1", "display_name": "Mohanson", "link": "https://stackoverflow.com/users/6028077/mohanson"}, "edited": false, "score": 0, "creation_date": 1476345372, "post_id": 40014583, "comment_id": 67307808, "body": "In fact, I suggest use json string between C and Golang."}, {"owner": {"reputation": 41, "user_id": 3218590, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed421600c9a989bef750d7b457ce880d?s=128&d=identicon&r=PG&f=1", "display_name": "user3218590", "link": "https://stackoverflow.com/users/3218590/user3218590"}, "edited": false, "score": 0, "creation_date": 1476422825, "post_id": 40014583, "comment_id": 67347482, "body": "converting all different data types to json string before sending to Golang will take additional transformation logic what I was trying to avoid."}], "tags": [], "owner": {"reputation": 81, "user_id": 6028077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qq0eE.png?s=128&g=1", "display_name": "Mohanson", "link": "https://stackoverflow.com/users/6028077/mohanson"}, "is_accepted": false, "score": 1, "last_activity_date": 1476345696, "last_edit_date": 1476345696, "creation_date": 1476342944, "answer_id": 40014583, "question_id": 40006633, "link": "https://stackoverflow.com/questions/40006633/how-to-return-array-of-c-struct-from-c-function-to-go/40014583#40014583", "title": "How to return array of C struct from C function to go?", "body": "<p>You could use the out paramters, and the way for C struct -> Go struct is thus:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdlib.h&gt;\n\ntypedef struct Point{\n    float x;\n    float y;\n}Point;\n\nvoid GetPoint(void **ppPoint) {\n   Point *pPoint= (Point *)malloc(sizeof(Point));\n   pPoint-&gt;x=0.5f;\n   pPoint-&gt;y=1.5f;\n   *ppPoint = pPoint;\n}\n*/\nimport \"C\"\n\nimport \"unsafe\"\n\ntype Point struct {\n    x float32\n    y float32\n}\n\nfunc main() {\n    var ppoint unsafe.Pointer\n    C.GetPoint(&amp;ppoint)\n    point := *(*Point)(ppoint)\n    println(point.x, point.y)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3218590, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed421600c9a989bef750d7b457ce880d?s=128&d=identicon&r=PG&f=1", "display_name": "user3218590", "link": "https://stackoverflow.com/users/3218590/user3218590"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1260, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1476632129, "creation_date": 1476299717, "last_edit_date": 1476632129, "question_id": 40006633, "link": "https://stackoverflow.com/questions/40006633/how-to-return-array-of-c-struct-from-c-function-to-go", "title": "How to return array of C struct from C function to go?", "body": "<p>I have a C function which will return an array of structure to go function.\nHow can I receive the array of structure and interpret or cast to go structure?</p>\n\n<p>Here is the code snippet</p>\n\n<pre><code>typedef struct student{  \n    nameStruct name;  \n    addressStruct address;  \n} studentStruct;\n\ntypedef struct name{\n    char firstName[20];\n    char lastName[20];\n} nameStruct;\n\ntypedef struct address{\n    char location[40];\n    int    pin;\n}addressStruct;\n\n\nstudent* getAllStudents(){\n   //Allocate memory for N number of students\n   student *pStudent= (struct student*)(N* sizeof(struct student));\n   //populate the array\n   return pStudent;\n}\n</code></pre>\n\n<p>I need to get the pStudent array in my go code</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -I.\n#cgo LDFLAGS: -L. -lkeyboard\n#include \"keyboard.h\"\n*/\nimport \"C\"\nimport (\n    \"fmt\"\n)\n\ntype student struct {\n    name string\n    ID int\n}\n\nfunc main() {\n    s := student{} //Need to know how to decide the length of the struct array\n    s = C.getAllStudents() //?????\n\n\n}\n</code></pre>\n\n<p>Can some one help me with code snippet?</p>\n"}, {"tags": ["http", "post", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476300347, "post_id": 40006631, "comment_id": 67291554, "body": "This is a webpage posting the form, right? You&#39;re gonna have to use JS for this if that is the case. When you&#39;re working with the template, Go code isn&#39;t posting anything, it&#39;s simply generating the html with an input element of type submit. That request on the other hand can&#39;t run in the browser, it&#39;s gotta run on the system. So if you have an html form using submit to POST to a Go back end and you want to add headers you need to use an <code>XMLHttpRequest</code> in JavaScript to accomplish that."}, {"owner": {"reputation": 4786, "user_id": 1012149, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/754c40373db2331c02a81ef7654ca0c7?s=128&d=identicon&r=PG", "display_name": "Jana", "link": "https://stackoverflow.com/users/1012149/jana"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476307122, "post_id": 40006631, "comment_id": 67295197, "body": "no, not a webpage, this is a Go unit test. See the answer below, setting the content-type in header fixed my problem."}], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 42, "last_activity_date": 1476300514, "creation_date": 1476300514, "answer_id": 40006833, "question_id": 40006631, "link": "https://stackoverflow.com/questions/40006631/sending-post-request-in-golang-with-header/40006833#40006833", "title": "Sending POST request in Golang with header", "body": "<p>You need to add a content type to your request.</p>\n\n<p>You said <code>http.PostForm</code> worked so let's look at the <a href=\"https://golang.org/src/net/http/client.go?s=18126:18196#L582\" rel=\"noreferrer\">source</a> of that:</p>\n\n<pre><code>func PostForm(url string, data url.Values) (resp *Response, err error) {\n    return DefaultClient.PostForm(url, data)\n}\n</code></pre>\n\n<p>OK so it's just a wrapper around the <code>PostForm</code> method on the default client. Let's look at <a href=\"https://golang.org/src/net/http/client.go?s=18618:18700#L594\" rel=\"noreferrer\">that</a>:</p>\n\n<pre><code>func (c *Client) PostForm(url string, data url.Values) (resp *Response, err error) {\n    return c.Post(url, \"application/x-www-form-urlencoded\", strings.NewReader(data.Encode()))\n}\n</code></pre>\n\n<p>OK it's calling the <code>Post</code> method and passing in <code>\"application/x-www-form-urlencoded\"</code> for <code>bodyType</code> and doing the same thing for the body that you're doing. Let's look at <a href=\"https://golang.org/src/net/http/client.go?s=17414:17508#L563\" rel=\"noreferrer\">the Post method</a></p>\n\n<pre><code>func (c *Client) Post(url string, bodyType string, body io.Reader) (resp *Response, err error) {\n    req, err := NewRequest(\"POST\", url, body)\n    if err != nil {\n        return nil, err\n    }\n    req.Header.Set(\"Content-Type\", bodyType)\n    return c.doFollowingRedirects(req, shouldRedirectPost)\n}\n</code></pre>\n\n<p>So the solution to your problem is to add</p>\n\n<pre><code>req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n"}], "owner": {"reputation": 4786, "user_id": 1012149, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/754c40373db2331c02a81ef7654ca0c7?s=128&d=identicon&r=PG", "display_name": "Jana", "link": "https://stackoverflow.com/users/1012149/jana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35463, "favorite_count": 4, "accepted_answer_id": 40006833, "answer_count": 1, "score": 19, "last_activity_date": 1476300514, "creation_date": 1476299706, "question_id": 40006631, "link": "https://stackoverflow.com/questions/40006631/sending-post-request-in-golang-with-header", "title": "Sending POST request in Golang with header", "body": "<p>I create my form like this:</p>\n\n<pre><code>form := url.Values{}\nform.Add(\"region\", \"San Francisco\")\nif len(params) &gt; 0 { \n    for i := 0; i &lt; len(params); i += 2 { \n        form.Add(params[i], params[i+1])\n    }\n    testLog.Infof(\"form %v\", form)\n</code></pre>\n\n<p>Now if I use</p>\n\n<pre><code>resp, err = http.PostForm(address+r.Path, form)\n</code></pre>\n\n<p>then everything works fine, I get back a response with an expected cookie.  </p>\n\n<p>However, I would like to to add a header in which case I can't use <code>PostForm</code> hence I created my <code>POST request</code> manually like:</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", address+r.Path, strings.NewReader(form.Encode()))\n</code></pre>\n\n<p>Then I add stuff to the header and send the request</p>\n\n<pre><code>req.Header.Add(\"region\", \"San Francisco\") \nresp, err = http.DefaultClient.Do(req)\n</code></pre>\n\n<p>But the form is not received and my response does not contain any cookie.</p>\n\n<p>When I print the <code>req</code>, it looks like the form is <code>nil</code>:</p>\n\n<pre><code>&amp;{POST http://localhost:8081/login HTTP/1.1 1 1 map[Region:[San Francisco]] {0xc420553600} 78 [] false localhost:8081 map[] map[] &lt;nil&gt; map[]   &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt;}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1476301659, "post_id": 40005892, "comment_id": 67292259, "body": "The answers are right for the question as posed, and of them I&#39;d go with Yandry&#39;s since it doesn&#39;t use unsafe, but big-picture, I wouldn&#39;t worry about the speed of this operation. Chances are this isn&#39;t where your app spends most of the time, and even within this function the alloc to build the combined string may dwarf the cost of making the intermediate <code>[]string</code> in your sample code."}], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1476301923, "post_id": 40006839, "comment_id": 67292403, "body": "Not inaccurate, but I&#39;m reticent to point someone at unsafe when we haven&#39;t established that it&#39;s worse to just eat the performance cost of building a <code>[]string</code> (or to eat the lines-of-code cost of doing it Yandry&#39;s way). Note, for example, if SpecialScopes changes from <code>string</code> to <code>[]byte</code> or something, this still compiles but has undefined behavior. Opinions will differ, just noting mine."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 2, "last_activity_date": 1476300535, "creation_date": 1476300535, "answer_id": 40006839, "question_id": 40005892, "link": "https://stackoverflow.com/questions/40005892/golang-use-string-join-on-a-type-alias-for-a-string/40006839#40006839", "title": "Golang: Use string.join on a type alias for a string", "body": "<p>Here's a solution using the <a href=\"https://godoc.org/unsafe\" rel=\"nofollow\"><code>unsafe</code></a> package:</p>\n\n<pre><code>func MergeScopes(scopes ...SpecialScopes) SpecialScopes {\n    specialScopes := *(*[]string)((unsafe.Pointer(&amp;scopes)))\n    s := strings.Join(specialScopes, \",\")\n    return *(*SpecialScopes)((unsafe.Pointer(&amp;s)))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-wsHY2eCdc\" rel=\"nofollow\">https://play.golang.org/p/-wsHY2eCdc</a></p>\n"}, {"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 1, "last_activity_date": 1476301304, "creation_date": 1476301304, "answer_id": 40007023, "question_id": 40005892, "link": "https://stackoverflow.com/questions/40005892/golang-use-string-join-on-a-type-alias-for-a-string/40007023#40007023", "title": "Golang: Use string.join on a type alias for a string", "body": "<p>If you really want something fast, this is the faster way in Go:</p>\n\n<pre><code>func MergeScopes(scopes ...SpecialScopes) SpecialScopes {\n    var buffer bytes.Buffer\n    for ix, s := range scopes {\n        buffer.WriteString(string(s))\n        if ix &lt; len(scopes)-1 {\n            buffer.WriteString(\", \")    \n        }\n    }\n\n    return SpecialScopes(buffer.String())\n}\n</code></pre>\n\n<p>Full example: <a href=\"https://play.golang.org/p/McWjh1yxHf\" rel=\"nofollow\">https://play.golang.org/p/McWjh1yxHf</a></p>\n\n<p>I know it doesn't look nice like a simple .Join() but it's easy to read.</p>\n"}, {"comments": [{"owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "edited": false, "score": 1, "creation_date": 1476812636, "post_id": 40012587, "comment_id": 67500925, "body": "Thanks! The analysis and comparison really helped"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1476334606, "creation_date": 1476334606, "answer_id": 40012587, "question_id": 40005892, "link": "https://stackoverflow.com/questions/40005892/golang-use-string-join-on-a-type-alias-for-a-string/40012587#40012587", "title": "Golang: Use string.join on a type alias for a string", "body": "<p>This is mostly the fastest way without using unsafe.</p>\n\n<pre><code>func MergeScopes(scopes ...SpecialScopes) SpecialScopes {\n    if len(scopes) == 0 {\n        return \"\"\n    }\n    var (\n        sep = []byte(\", \")\n        // preallocate for len(sep) + assume at least 1 character\n        out = make([]byte, 0, (1+len(sep))*len(scopes))\n    )\n    for _, s := range scopes {\n        out = append(out, s...)\n        out = append(out, sep...)\n    }\n    return SpecialScopes(out[:len(out)-len(sep)])\n}\n</code></pre>\n\n<p>Benchmark code: <a href=\"https://play.golang.org/p/DrB8nM-6ws\" rel=\"nofollow\">https://play.golang.org/p/DrB8nM-6ws</a></p>\n\n<pre><code>\u2501\u27a4 go test -benchmem -bench=.  -v -benchtime=2s\ntesting: warning: no tests to run\nBenchmarkUnsafe-8       30000000               109 ns/op              32 B/op          2 allocs/op\nBenchmarkBuffer-8       20000000               255 ns/op             128 B/op          2 allocs/op\nBenchmarkCopy-8         10000000               233 ns/op             112 B/op          3 allocs/op\nBenchmarkConcat-8       30000000               112 ns/op              32 B/op          2 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1884, "favorite_count": 0, "accepted_answer_id": 40012587, "answer_count": 3, "score": 4, "last_activity_date": 1476334606, "creation_date": 1476297043, "last_edit_date": 1476299369, "question_id": 40005892, "link": "https://stackoverflow.com/questions/40005892/golang-use-string-join-on-a-type-alias-for-a-string", "title": "Golang: Use string.join on a type alias for a string", "body": "<p>I have a type alias for string like </p>\n\n<p>type SpecialScopes string</p>\n\n<p>and I want to Join an array of this type using the strings.Join function</p>\n\n<pre><code>func MergeScopes(scopes ...SpecialScopes) SpecialScopes {\n    return strings.Join(scopes, \",\")\n}\n</code></pre>\n\n<p>But with the above I get the errors</p>\n\n<pre><code>cannot use scopes (type []SpecialScopes) as type []string in argument to strings.Join\ncannot use strings.Join(scopes, \",\") (type string) as type SpecialScopes in return argument\n</code></pre>\n\n<p>Is there a way to make golang realize that SpecialScopes is just another name for strings and do the join function on it?\nIf not what is the most efficient way to go about doing this? One way I see is to cast all the elements in the array to string, join, then cast it back to SpecialScopes and return the value</p>\n\n<p>Update 1:\nI have a working implementation that casts the values. Any suggestions for a faster way to do this?</p>\n\n<pre><code>func MergeScopes(scopes ...SpecialScopes) SpecialScopes {\n    var s []string\n    for _, scope := range scopes {\n        s = append(s, string(scope))\n    }\n\n    return SpecialScopes(strings.Join(s, \",\"))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476295993, "post_id": 40005467, "comment_id": 67289047, "body": "You probably don&#39;t have write permission for GOROOT. Does it work with <code>-installsuffix nocgo</code>?"}, {"owner": {"reputation": 21857, "user_id": 842075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e1e6d890077d7e1199084462fd0a5b1?s=128&d=identicon&r=PG", "display_name": "Molecular Man", "link": "https://stackoverflow.com/users/842075/molecular-man"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476296571, "post_id": 40005467, "comment_id": 67289382, "body": "@JimB, fails with <code>go install runtime&#47;internal&#47;sys: mkdir &#47;usr&#47;local&#47;go&#47;pkg&#47;linux_amd64_nocgo: permission denied</code>. I&#39;m not running it as a super user"}, {"owner": {"reputation": 21857, "user_id": 842075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e1e6d890077d7e1199084462fd0a5b1?s=128&d=identicon&r=PG", "display_name": "Molecular Man", "link": "https://stackoverflow.com/users/842075/molecular-man"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476296696, "post_id": 40005467, "comment_id": 67289453, "body": "So I should run it as a super user? I&#39;m just finding it weird that doing <code>go install</code> in a project tries to install <code>net</code> package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476297836, "post_id": 40005467, "comment_id": 67290131, "body": "It would probably be better to make your GOROOT writable by your user. It needs to install the <code>net</code> package because that packages uses CGO, so it needs to be re-compiled."}, {"owner": {"reputation": 21857, "user_id": 842075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e1e6d890077d7e1199084462fd0a5b1?s=128&d=identicon&r=PG", "display_name": "Molecular Man", "link": "https://stackoverflow.com/users/842075/molecular-man"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476353856, "post_id": 40005467, "comment_id": 67313326, "body": "@JimB thank you for the help"}], "owner": {"reputation": 21857, "user_id": 842075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e1e6d890077d7e1199084462fd0a5b1?s=128&d=identicon&r=PG", "display_name": "Molecular Man", "link": "https://stackoverflow.com/users/842075/molecular-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1628, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1476295600, "creation_date": 1476295600, "question_id": 40005467, "link": "https://stackoverflow.com/questions/40005467/go-install-fails-when-cgo-enabled-0", "title": "go install fails when CGO_ENABLED=0", "body": "<p>I have a strange issue:</p>\n\n<p><code>go install</code> works fine.</p>\n\n<p>However <code>CGO_ENABLED=0</code> gives me an error:</p>\n\n<pre><code>\u279c CGO_ENABLED=0 go install   \ngo install net: open /usr/local/go/pkg/linux_amd64/net.a: permission denied\n</code></pre>\n\n<p>I don't get why it thinks that net package changed.</p>\n\n<p>I was trying to resolve it by doing</p>\n\n<pre><code>\u279c go clean -i\n</code></pre>\n\n<p>and by</p>\n\n<pre><code>\u279c rm -r $GOPATH/pkg\n</code></pre>\n\n<p>which didn't help.\nHere is my setup:</p>\n\n<pre><code>\u279c go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/aberezhynskyi/work/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build254491808=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n\u279c go version\ngo version go1.7.1 linux/amd64\n</code></pre>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 39041, "user_id": 27358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fed1635f89478c88eda07e87de452bcf?s=128&d=identicon&r=PG", "display_name": "David Moles", "link": "https://stackoverflow.com/users/27358/david-moles"}, "edited": false, "score": 0, "creation_date": 1476289884, "post_id": 40003577, "comment_id": 67285388, "body": "Have you tried putting quotes around the command? Not sure just what&#39;s going on here but I suspect some shell string quoting / expansion weirdness. By default <code>RUN</code> uses <code>&#47;bin&#47;sh -c</code>; I would think it would be smart enough to quote the argument, but maybe not."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476290624, "post_id": 40003577, "comment_id": 67285805, "body": "The shell executing the RUN line is a basic <code>&#47;bin&#47;sh</code>, and doesn&#39;t do the brace expansion."}], "answers": [{"comments": [{"owner": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "edited": false, "score": 0, "creation_date": 1476322832, "post_id": 40005066, "comment_id": 67299810, "body": "Thanks for the info, but this answer didn&#39;t work for me - I got this error: <code>&#47;bin&#47;bash: go get -u github.com&#47;golang&#47;protobuf&#47;{proto,protoc-gen-go}: No such file or directory</code>"}, {"owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "reply_to_user": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "edited": false, "score": 0, "creation_date": 1476361135, "post_id": 40005066, "comment_id": 67318255, "body": "Ye, I didn&#39;t have time to test it so it&#39;s an approximation :p Will test today and fix the exact command."}, {"owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "reply_to_user": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "edited": false, "score": 0, "creation_date": 1476373517, "post_id": 40005066, "comment_id": 67328258, "body": "OK tested. First way worked fine, second way now edited, just needed the &quot;-c&quot; added to the SHELL directive."}], "tags": [], "owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "is_accepted": false, "score": 5, "last_activity_date": 1476373481, "last_edit_date": 1476373481, "creation_date": 1476294230, "answer_id": 40005066, "question_id": 40003577, "link": "https://stackoverflow.com/questions/40003577/error-with-go-get-for-protobuf-in-dockerfile/40005066#40005066", "title": "Error with Go Get for Protobuf in Dockerfile", "body": "<p>It's happening because the default shell is <em>not</em> <code>/bin/bash</code>, it's <code>sh</code>. You have two possible solutions, either you can explicitly define a shell in your RUN command like so:</p>\n\n<pre><code>RUN [\"/bin/bash\", \"-c\", \"go get -u github.com/golang/protobuf/{proto,protoc-gen-go}\"]\n</code></pre>\n\n<p>Or you can change the shell that <code>RUN</code> uses by default like so:</p>\n\n<pre><code>SHELL [\"/bin/bash\", \"-c\"]\nRUN go get -u github.com/golang/protobuf/{proto,protoc-gen-go}\n</code></pre>\n\n<p>Source: <a href=\"https://docs.docker.com/engine/reference/builder/#/shell\" rel=\"nofollow\">https://docs.docker.com/engine/reference/builder/#/shell</a></p>\n"}, {"comments": [{"owner": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "edited": false, "score": 0, "creation_date": 1476322848, "post_id": 40005097, "comment_id": 67299817, "body": "This answer worked! Although the other one explains what&#39;s going on :P"}], "tags": [], "owner": {"reputation": 23608, "user_id": 2915097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91318014af3b3d389901d50d5f9276d5?s=128&d=identicon&r=PG&f=1", "display_name": "user2915097", "link": "https://stackoverflow.com/users/2915097/user2915097"}, "is_accepted": true, "score": 3, "last_activity_date": 1476294756, "last_edit_date": 1476294756, "creation_date": 1476294329, "answer_id": 40005097, "question_id": 40003577, "link": "https://stackoverflow.com/questions/40003577/error-with-go-get-for-protobuf-in-dockerfile/40005097#40005097", "title": "Error with Go Get for Protobuf in Dockerfile", "body": "<p>It works if I use another shell, like bash, and put double quotes for the <code>go</code> command</p>\n\n<p><code>RUN bash -c \"go get github.com/golang/protobuf/{proto,protoc-gen-go}\"</code></p>\n\n<p>By the way, you can do all in only one RUN, see Dockerfiles best practices</p>\n\n<p><a href=\"https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/\" rel=\"nofollow\">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></p>\n"}], "owner": {"reputation": 4921, "user_id": 171916, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/810fb8ed5b7f4d81ade67a2d34c1ffeb?s=128&d=identicon&r=PG", "display_name": "Narfanator", "link": "https://stackoverflow.com/users/171916/narfanator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 737, "favorite_count": 0, "accepted_answer_id": 40005097, "answer_count": 2, "score": 1, "last_activity_date": 1476373481, "creation_date": 1476289230, "question_id": 40003577, "link": "https://stackoverflow.com/questions/40003577/error-with-go-get-for-protobuf-in-dockerfile", "title": "Error with Go Get for Protobuf in Dockerfile", "body": "<p>Here's my Dockerfile:</p>\n\n<pre><code>FROM golang\nRUN apt-get update\nRUN go get -u github.com/golang/protobuf/{proto,protoc-gen-go}\n</code></pre>\n\n<p>This generates this error:</p>\n\n<pre><code>package github.com/golang/protobuf/{proto,protoc-gen-go}: invalid github.com/ import path \"github.com/golang/protobuf/{proto,protoc-gen-go}\"\n</code></pre>\n\n<p>But, if I take out that <code>RUN</code> directive, and just load up <code>/bin/bash</code> in the docker container, I can run the <code>go get</code> command just fine.</p>\n\n<p>What's going on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476284004, "post_id": 40001715, "comment_id": 67281258, "body": "Can you show an example of what you expect to get? <code>binary.Write</code> already takes an <code>interface{}</code> and asserts the correct type internally."}, {"owner": {"reputation": 157, "user_id": 4893009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c60c11b194736721a5b106e8057b0ed7?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/4893009/mike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476284636, "post_id": 40001715, "comment_id": 67281699, "body": "right, it does. but in my example, if i pass <code>a</code> (essentially a <code>uint64</code> it would write 0x00000000000000FF) however, i would like to have only 0xFF written to the file."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1476286810, "post_id": 40001715, "comment_id": 67283315, "body": "If the caller knows the size they want at call time, why not convert it in place rather than leaving <code>foo</code> to enumerate all possible combinations? (there&#39;s also the binary Varint encodings which use as little space as possible). Otherwise you end up with some copy&amp;paste that looks like this: <a href=\"https://play.golang.org/p/koL6_PB3Ie\" rel=\"nofollow noreferrer\">play.golang.org/p/koL6_PB3Ie</a> and can&#39;t really be decoded without the original type and size combinations and order."}, {"owner": {"reputation": 157, "user_id": 4893009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c60c11b194736721a5b106e8057b0ed7?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/4893009/mike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476292478, "post_id": 40001715, "comment_id": 67286935, "body": "that has the same problem... the example just illustrates my problem. essentially, i get a <code>interface{}</code> given back to me after parsing json. i need to write it to the spec i&#39;m following, but i need to know how many bytes to write given the data type in the spec. so converting it before calling <code>foo</code> or in <code>foo</code>, the same issue is presented where i need to convert <code>interface{}</code> to the &quot;right&quot; size in bytes"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1476295899, "last_edit_date": 1476295899, "creation_date": 1476295156, "answer_id": 40005340, "question_id": 40001715, "link": "https://stackoverflow.com/questions/40001715/go-casting-interface-to-numbers/40005340#40005340", "title": "go casting interface{} to numbers", "body": "<p>No matter what, you're going to need to assert a concrete type for each value in order to operate on it numerically. Since converting smaller integer types is simply truncation, you could encode all integer values as <code>uint64</code> to reduce the number of cases you need to handle, then cut the slice at the desired number of bits. </p>\n\n<pre><code>func foo(buf *bytes.Buffer, num interface{}, sizeInBytes int) {\n    switch sizeInBytes {\n    case 1, 2, 4, 8:\n        // OK\n    default:\n        panic(\"invalid size\")\n    }\n\n    b := make([]byte, 8)\n    var un uint64\n\n    switch n := num.(type) {\n    case float32:\n        switch sizeInBytes {\n        case 4:\n            un = uint64(math.Float32bits(n))\n        case 8:\n            un = math.Float64bits(float64(n))\n        default:\n            panic(\"can't do that\")\n        }\n\n    case float64:\n        switch sizeInBytes {\n        case 4:\n            un = uint64(math.Float32bits(float32(n)))\n        case 8:\n            un = math.Float64bits(n)\n        default:\n            panic(\"can't do that\")\n        }\n    case int8:\n        un = uint64(n)\n    case uint8:\n        un = uint64(n)\n    case uint16:\n        un = uint64(n)\n    case int16:\n        un = uint64(n)\n    case uint32:\n        un = uint64(n)\n    case int32:\n        un = uint64(n)\n    case uint64:\n        un = uint64(n)\n    case int64:\n        un = uint64(n)\n    case int:\n        un = uint64(n)\n    }\n\n    binary.LittleEndian.PutUint64(b, un)\n    b = b[:sizeInBytes]\n    buf.Write(b)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/g6d5Bt1esI\" rel=\"nofollow\">https://play.golang.org/p/g6d5Bt1esI</a></p>\n"}], "owner": {"reputation": 157, "user_id": 4893009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c60c11b194736721a5b106e8057b0ed7?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/4893009/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 40005340, "answer_count": 1, "score": 0, "last_activity_date": 1476295899, "creation_date": 1476283811, "question_id": 40001715, "link": "https://stackoverflow.com/questions/40001715/go-casting-interface-to-numbers", "title": "go casting interface{} to numbers", "body": "<p>I'm playing around with go, but can't figure this out. here is a contrived example of what I want to do. Basically, i have number held in an <code>interface{}</code> data type and i want to write that binary representation of the number of a user specified size.</p>\n\n<pre><code>func main() {\n   buf := new(bytes.Buffer)  // imported from encoding.binary \n   var val1 uint64 = 0xff    // 8 bytes\n   var val2 float32 = 9.876  // 4 bytes\n\n   var a interface{} = val1\n   var b interface{} = val2\n\n   // for argument sake, lets assume we want to write a as a uint8\n   // to our binary file\n   foo(buf.Bytes(), a, 1)\n\n   // let's write b as a float64 to our binary file\n   foo(buf,Bytes(), b, 8)\n\n   // write buffer to file\n   ...\n}\n\n// write the number in binary to the buffer\nvar foo (buf *bytes.Buffer, num interface{}, sizeInBytes int) {\n\n   // TODO: somehow i need to convert num to the correct datatype\n   //       let's assume the first scenario where num is unit64 and\n   //       i need to make it uint8\n   var tmp uint8 = num.(uint8) // error interface is uint64, not uint8\n   var tmp uint8 = uint8(num)  // error (type interface {}) to type uint8: need type assertion\n\n   // help please ^^^^^^ i assume writing a float32 as a float64 would\n   // follow the same paradigm\n\n    binary.Write(buf, binary.LittleEndian, num)\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1476348998, "post_id": 40000677, "comment_id": 67310058, "body": "Please provide the table and the go struct? Mayber the field name is not correctly set"}, {"owner": {"reputation": 11, "user_id": 4928010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afd19269a50dcfa7cadb71573e75d29c?s=128&d=identicon&r=PG&f=1", "display_name": "Kristijan Ujevic", "link": "https://stackoverflow.com/users/4928010/kristijan-ujevic"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1476713089, "post_id": 40000677, "comment_id": 67449493, "body": "names are definitely set correctly because if i scan each model individually it works."}], "answers": [{"tags": [], "owner": {"reputation": 331, "user_id": 8078699, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jt770.jpg?s=128&g=1", "display_name": "Faishal Ahammad", "link": "https://stackoverflow.com/users/8078699/faishal-ahammad"}, "is_accepted": false, "score": 1, "last_activity_date": 1548839711, "creation_date": 1548839711, "answer_id": 54437015, "question_id": 40000677, "link": "https://stackoverflow.com/questions/40000677/scanning-into-struct-of-gorm-models/54437015#54437015", "title": "Scanning into struct of gorm models", "body": "<p>You can use multiple Scan.</p>\n\n<p>for example</p>\n\n<pre><code>type Dto1 struct {\n    model1   model.model1\n}\n\ntype Dto2 struct {\n    model2    model.model2\n}\n\nfunc main() {\n\nvar dto1 []Dto1\nvar dto2 []Dto2\nvar err error\n\ndb, err := gorm.Open(\"postgres\", \"bla\")\ndefer db.Close()\n\nerr = db.Raw(`SELECT t1.*, t2.*\n              FROM   t1\n               INNER JOIN t2 on something\n              WHERE something`).Scan(&amp;dto1).Scan(&amp;dto2).Error\n\nfor _, element := range result {\n    fmt.Println(element)\n }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4928010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afd19269a50dcfa7cadb71573e75d29c?s=128&d=identicon&r=PG&f=1", "display_name": "Kristijan Ujevic", "link": "https://stackoverflow.com/users/4928010/kristijan-ujevic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5361, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1548839711, "creation_date": 1476280974, "last_edit_date": 1476321169, "question_id": 40000677, "link": "https://stackoverflow.com/questions/40000677/scanning-into-struct-of-gorm-models", "title": "Scanning into struct of gorm models", "body": "<p>I'm trying to scan the result of a query into a result structure that's comprised of gorm models.</p>\n\n<p>The code builds and the query passes but the result array consists of default values like this:</p>\n\n<p><code>{{0 0 0 0 0 0 0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC 0 0001-01-01 00:00:00 +0000 UTC { false}} {0 0 0 0 {0 false} {0 false} {0 false} 0001-01-01 00:00:00 +0000 UTC  false {0 false} {0 false} { false} { false}}}\n</code></p>\n\n<p>Also, result array has the exact length as the query result should have (when i try it manually through pgadmin) but they are not mapped correctly.</p>\n\n<p>Is this possible or it's a gorm bug.</p>\n\n<p>Code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"test/model\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\ntype Result struct {\n    model1    model.model1\n    model2    model.model2\n}\n\nfunc main() {\n    var result []Result\n    var err error\n\n    db, err := gorm.Open(\"postgres\", \"bla\")\n    defer db.Close()\n\n    err = db.Raw(`SELECT t1.*, t2.*\n                  FROM   t1\n                   INNER JOIN t2 on something\n                  WHERE something`).Scan(&amp;result).Error\n\n    for _, element := range result {\n        fmt.Println(element)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "email-headers", "spf", "dkim", "dmarc"], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1476356774, "post_id": 40008761, "comment_id": 67315281, "body": "Thanks for your response. Is this the standard? For instance from one emailer I can see that there is a <code>d=</code> which contains the domain where the <code>dkim</code> key is stored. The ryanair example just has the domain stored in the <code>d=</code> field and you have to add the <code>15below._domainkey.</code> to it. Is there a standard set of rules for finding the domain where the key is stored?"}, {"owner": {"reputation": 29469, "user_id": 333340, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/EUElo.jpg?s=128&g=1", "display_name": "Synchro", "link": "https://stackoverflow.com/users/333340/synchro"}, "reply_to_user": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1476356964, "post_id": 40008761, "comment_id": 67315412, "body": "Yep - it&#39;s right <a href=\"http://dkim.org/specs/rfc4871-dkimbase.html#dkim-sig-hdr\" rel=\"nofollow noreferrer\">here in the RFC</a>. If you&#39;re going to parse DKIM headers, you <b>really</b> need to read the spec!"}], "tags": [], "owner": {"reputation": 29469, "user_id": 333340, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/EUElo.jpg?s=128&g=1", "display_name": "Synchro", "link": "https://stackoverflow.com/users/333340/synchro"}, "is_accepted": false, "score": 2, "last_activity_date": 1476308168, "creation_date": 1476308168, "answer_id": 40008761, "question_id": 40000491, "link": "https://stackoverflow.com/questions/40000491/checking-spf-dkim-dmarc-programmatically/40008761#40008761", "title": "Checking SPF, DKIM, DMARC programmatically", "body": "<p>The DKIM selector is not necessarily called <code>dkim</code>. In the Ryanair example, the selector is a rather random <code>15below</code> (From the <code>s=</code> item in the DKIM signature header), so you would need to look up <code>15below._domainkey.ryanair.com</code>.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1476308168, "creation_date": 1476280467, "question_id": 40000491, "link": "https://stackoverflow.com/questions/40000491/checking-spf-dkim-dmarc-programmatically", "title": "Checking SPF, DKIM, DMARC programmatically", "body": "<p>I have a small program designed to check the existence of these three mail records to counter spoofing. It seems to work on specific domains however they seem to be setup in a case by case basis. \nMy question is whats a more robust way to check these records.\nThe code is here:\n<a href=\"https://gist.github.com/amlwwalker/f445932d2fdb0f9f9a5e457c1894bf7d\" rel=\"nofollow\">https://gist.github.com/amlwwalker/f445932d2fdb0f9f9a5e457c1894bf7d</a>\nExamples:</p>\n\n<p>Ryanair.com:</p>\n\n<pre><code>result:  v=spf1 a mx include:mail1.ryanair.com include:mail2.ryanair.com ~all\nerr:  lookup _dmarc.ryanair.com on 172.16.4.1:53: no such host\nerr:  lookup dkim._domainkey.ryanair.com on 172.16.4.1:53: no such host\n</code></pre>\n\n<p>Ryanair Email header:</p>\n\n<pre><code>Authentication-Results: mx.google.com;\n       dkim=pass header.i=@care.ryanair.com;\n       spf=pass (google.com: domain of info@care.ryanair.com designates 209.235.250.215 as permitted sender) smtp.mailfrom=info@care.ryanair.com\nDKIM-Signature: v=1; a=rsa-sha1; c=relaxed/relaxed; s=15below; d=care.ryanair.com; h=MIME-Version:From:To:Date:Subject:Message-ID:Content-Type; i=info@care.ryanair.com; bh=MCorT6FfWGOmISJQSzdv4YLmKfg=; b=eXcQvy0odmzIAYy11bfM8OsoiXziin5E1hbWHvxlY6Q+KSpZr6/5OiUZ4EiNoCpNwFrciKB9Yj8G\n   wmZOZwxQd3PW05+2bnu+8oKMPij/AyAEAi2tJ0TBEZxM7BOsno84L3eZ0BQFZvog6bW9UQE1fJCQ\n   aoQYXPgsHV6dzWjmHYo=\n</code></pre>\n\n<p>So to me that looks like it has DKIM and SPF. The code doesn't find a DKIM record though.</p>\n\n<p>marvelapp.com</p>\n\n<pre><code>result:  v=spf1 include:mailgun.org include:spf.mandrillapp.com include:spf1 include:mail.zendesk.com include:spf.mail.intercom.io -all\nerr:  lookup _dmarc.marvelapp.com on 172.16.4.1:53: no such host\nerr:  lookup dkim._domainkey.marvelapp.com on 172.16.4.1:53: no such host\n</code></pre>\n\n<p>Marvelapp Email Header:</p>\n\n<pre><code>Received-SPF: pass (google.com: domain of ml-bounce-newsletter@ml.mailersend.com designates 31.193.196.244 as permitted sender) client-ip=31.193.196.244;\nAuthentication-Results: mx.google.com;\n       dkim=pass header.i=@ml.mailersend.com;\n       spf=pass (google.com: domain of ml-bounce-newsletter@ml.mailersend.com designates 31.193.196.244 as permitted sender) smtp.mailfrom=ml-bounce-newsletter@ml.mailersend.com\n</code></pre>\n\n<p>So what I don't understand is why in some cases dkim._domainkey.domain.TLD is the correct way to find the dkim key, and sometimes its clearly not (google seems to find it, but how? Whats the best way to look the dkim key up?</p>\n\n<p>I bascially want that code snippet to return the same result as going to \"Show Original\" in Gmail does</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "is_accepted": false, "score": 5, "last_activity_date": 1476266987, "creation_date": 1476266987, "answer_id": 39995969, "question_id": 39995913, "link": "https://stackoverflow.com/questions/39995913/string-replace-backslash-with-slash/39995969#39995969", "title": "string replace backslash with slash", "body": "<p>You didn't escape backslashes in <code>string</code>. The following code works:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    string := \"P:\\\\Project\\\\project-name/content/topic/\"\n    fmt.Println(strings.Replace(string, \"\\\\\", \"/\", -1))\n}\n</code></pre>\n\n<p>Play this on playground: <a href=\"https://play.golang.org/p/T3XE5uiIkk\" rel=\"noreferrer\">https://play.golang.org/p/T3XE5uiIkk</a></p>\n"}, {"comments": [{"owner": {"reputation": 675, "user_id": 2068823, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/YPjQV.jpg?s=128&g=1", "display_name": "kOssi", "link": "https://stackoverflow.com/users/2068823/kossi"}, "edited": false, "score": 0, "creation_date": 1476267752, "post_id": 39996077, "comment_id": 67270148, "body": "Is it possible to simply convert the literal string to raw string programmatically before the replacement?"}, {"owner": {"reputation": 6099, "user_id": 211176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1098198f10f2890217a272bf037e58f5?s=128&d=identicon&r=PG&f=1", "display_name": "adam_0", "link": "https://stackoverflow.com/users/211176/adam-0"}, "reply_to_user": {"reputation": 675, "user_id": 2068823, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/YPjQV.jpg?s=128&g=1", "display_name": "kOssi", "link": "https://stackoverflow.com/users/2068823/kossi"}, "edited": false, "score": 0, "creation_date": 1507221121, "post_id": 39996077, "comment_id": 80134233, "body": "@kOssi a raw string is just a way to represent a literal string without needing those pesky double backslashes. That&#39;s what abhink means when he says that they have the same internal representation. They&#39;re not two different types, or even two different strings. They&#39;re syntactic sugar to make things easier on the programmer&#39;s eyes."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 0, "last_activity_date": 1476267292, "creation_date": 1476267292, "answer_id": 39996077, "question_id": 39995913, "link": "https://stackoverflow.com/questions/39995913/string-replace-backslash-with-slash/39996077#39996077", "title": "string replace backslash with slash", "body": "<p>You can also use back-quotes (<code>`</code>) to create a raw string:</p>\n\n<pre><code>func main() {\n    string := `P:\\Project\\project-name/content/topic/`\n    fmt.Println(strings.Replace(string, \"\\\\\", \"/\", -1))\n}\n</code></pre>\n\n<p>Note that the raw string above would still have its internal representation as</p>\n\n<pre><code>\"P:\\\\Project\\\\project-name/content/topic/\"\n</code></pre>\n\n<p>Hence the need to use <code>\"\\\\\"</code> in <code>strings.Replace</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1476286296, "creation_date": 1476286296, "answer_id": 40002602, "question_id": 39995913, "link": "https://stackoverflow.com/questions/39995913/string-replace-backslash-with-slash/40002602#40002602", "title": "string replace backslash with slash", "body": "<p>Use the function <a href=\"https://godoc.org/path/filepath#ToSlash\" rel=\"noreferrer\">filepath.ToSlash</a> to replace the operating system path separator with '/' in a path.</p>\n\n<p>On Windows, the function returns <code>strings.Replace(path, string(filepath.Separator), \"/\", -1)</code>.  On other operating systems, the function returns the path argument as is.</p>\n"}], "owner": {"reputation": 675, "user_id": 2068823, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/YPjQV.jpg?s=128&g=1", "display_name": "kOssi", "link": "https://stackoverflow.com/users/2068823/kossi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9894, "favorite_count": 1, "accepted_answer_id": 40002602, "answer_count": 3, "score": 3, "last_activity_date": 1476286296, "creation_date": 1476266798, "question_id": 39995913, "link": "https://stackoverflow.com/questions/39995913/string-replace-backslash-with-slash", "title": "string replace backslash with slash", "body": "<p>I need to replace <code>\\</code> with <code>/</code> in a path string, but following code failed.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    string := \"P:\\Project\\project-name/content/topic/\"\n    fmt.Println(strings.Replace(string, \"\\\\\", \"/\", -1))\n}\n</code></pre>\n\n<p>Any helpful suggestions?</p>\n"}, {"tags": ["go", "slice", "pass-by-value"], "answers": [{"comments": [{"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1476260640, "post_id": 39993797, "comment_id": 67265542, "body": "so would a solution be to make a local copy of the slice inside the function. and editing that instead ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 2, "creation_date": 1476260764, "post_id": 39993797, "comment_id": 67265632, "body": "@user4901806 If you don&#39;t want to modify the elements of the passed slice (the elements of the backing array it points to), then yes, make a copy."}, {"owner": {"reputation": 8717, "user_id": 73249, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aa58ce9763beb48289b05c19f716bcd8?s=128&d=identicon&r=PG", "display_name": "Sahas", "link": "https://stackoverflow.com/users/73249/sahas"}, "edited": false, "score": 0, "creation_date": 1497704246, "post_id": 39993797, "comment_id": 76196783, "body": "I&#39;m assuming this would mean if we append an element,  it wouldn&#39;t get added to the original slice."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8717, "user_id": 73249, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aa58ce9763beb48289b05c19f716bcd8?s=128&d=identicon&r=PG", "display_name": "Sahas", "link": "https://stackoverflow.com/users/73249/sahas"}, "edited": false, "score": 11, "creation_date": 1497710060, "post_id": 39993797, "comment_id": 76198558, "body": "@Sahas The slice header contains the length. If you append an element, the length must be increased, so the original slice header will not &quot;see&quot; it even if the backing array has room for this additional element and no new backing array is allocated and existing elements copied over. That&#39;s why the builtin <code>append()</code> function has to return a new slice value. Not to mention if a new array has to be allocated..."}, {"owner": {"reputation": 627, "user_id": 3488580, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fb6b6c1689059ab424936e2053b50b4f?s=128&d=identicon&r=PG&f=1", "display_name": "jtkSource", "link": "https://stackoverflow.com/users/3488580/jtksource"}, "edited": false, "score": 0, "creation_date": 1520217447, "post_id": 39993797, "comment_id": 85210590, "body": "Doesnt arrays behave the same way ?"}, {"owner": {"reputation": 627, "user_id": 3488580, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fb6b6c1689059ab424936e2053b50b4f?s=128&d=identicon&r=PG&f=1", "display_name": "jtkSource", "link": "https://stackoverflow.com/users/3488580/jtksource"}, "edited": false, "score": 0, "creation_date": 1520218935, "post_id": 39993797, "comment_id": 85210912, "body": "Also, would this mean that slices are always on the heap ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 627, "user_id": 3488580, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fb6b6c1689059ab424936e2053b50b4f?s=128&d=identicon&r=PG&f=1", "display_name": "jtkSource", "link": "https://stackoverflow.com/users/3488580/jtksource"}, "edited": false, "score": 0, "creation_date": 1520241296, "post_id": 39993797, "comment_id": 85218752, "body": "@jtkSource What do you mean they behave the same as arrays? And no, slices may be allocated on the stack if they don&#39;t &quot;escape&quot;."}, {"owner": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 0, "creation_date": 1558460310, "post_id": 39993797, "comment_id": 99106022, "body": "Is the SliceHeader then the memory layout for embedded slice types as well?  Would <code>type Container struct {data []byte}</code> take up exactly the same amount of memory as SliceHeader?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 1, "creation_date": 1558460663, "post_id": 39993797, "comment_id": 99106173, "body": "@vas <code>type Container struct {data []byte}</code> is not embedding, it&#39;s just a regular field. And if there is only a single field, then the answer is yes. If you have multiple fields, implicit padding may apply so the overall struct size may be bigger."}, {"owner": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 0, "creation_date": 1558586779, "post_id": 39993797, "comment_id": 99151844, "body": "@icza yeah i know but a an anonymous field (embedding) example is hard to do in these comments! My understanding is that a non-pointer field and an anonymous field have the exact same memory representation. Right? Thanks for your answer!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 1, "creation_date": 1558590174, "post_id": 39993797, "comment_id": 99152630, "body": "@vas Yes, whether you use embedding or a named field, they use the same amount of memory."}, {"owner": {"reputation": 413, "user_id": 6483259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GwZbR.jpg?s=128&g=1", "display_name": "Nickadiemus", "link": "https://stackoverflow.com/users/6483259/nickadiemus"}, "edited": false, "score": 0, "creation_date": 1584714137, "post_id": 39993797, "comment_id": 107528660, "body": "@icza dude thank you! I was working on a Hackerrank problem that had to deal with manipulating slices around and I could not for the life of me figure out why my function wasn&#39;t editing a copy of my slice by value. I&#39;m new to the golang so I&#39;m learning as I go. This saved me a lot of time and frustration"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 141, "last_activity_date": 1579669554, "last_edit_date": 1579669554, "creation_date": 1476260499, "answer_id": 39993797, "question_id": 39993688, "link": "https://stackoverflow.com/questions/39993688/are-slices-passed-by-value/39993797#39993797", "title": "Are slices passed by value?", "body": "<p>Everything in Go is passed by value, slices too. But a slice value is a <em>header</em>, describing a contiguous section of a backing array, and a slice value only contains a pointer to the array where the elements are actually stored. The slice value does not include its elements (unlike arrays).</p>\n\n<p>So when you pass a slice to a function, a copy will be made from this header, including the pointer, which will point to the same backing array. Modifying the elements of the slice implies modifying the elements of the backing array, and so all slices which share the same backing array will \"observe\" the change.</p>\n\n<p>To see what's in a slice header, check out the <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"noreferrer\"><code>reflect.SliceHeader</code></a> type:</p>\n\n<pre><code>type SliceHeader struct {\n    Data uintptr\n    Len  int\n    Cap  int\n}\n</code></pre>\n\n<p>See related / possible duplicate question: \n<a href=\"https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write\">Are Golang function parameter passed as copy-on-write?</a></p>\n\n<p>Read blog post: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">Go Slices: usage and internals</a></p>\n"}, {"tags": [], "owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "is_accepted": false, "score": 2, "last_activity_date": 1591444214, "creation_date": 1591444214, "answer_id": 62231294, "question_id": 39993688, "link": "https://stackoverflow.com/questions/39993688/are-slices-passed-by-value/62231294#62231294", "title": "Are slices passed by value?", "body": "<p>Slices when its passed it\u2019s passed with the pointer to underlying array, so a <a href=\"https://blog.golang.org/slices-intro\" rel=\"nofollow noreferrer\">slice</a> is a small structure that points to an underlying array. The small structure is copied, but it still points to the same underlying array. the memory block containing the slice elements is passed by \"reference\". The slice information triplet holding the capacity, the number of element and the pointer to the elements is passed by value.</p>\n\n<p>The best way to handle slices passing to function (if the elements of the slice are manipulated into the function, and we do not want this to be reflected at the elements memory block is to copy them using <code>copy(s, *c)</code> as:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Team []Person\ntype Person struct {\n    Name string\n    Age  int\n}\n\nfunc main() {\n    team := Team{\n        Person{\"Hasan\", 34}, Person{\"Karam\", 32},\n    }\n    fmt.Printf(\"original before clonning: %v\\n\", team)\n    team_cloned := team.Clone()\n    fmt.Printf(\"original after clonning: %v\\n\", team)\n    fmt.Printf(\"clones slice: %v\\n\", team_cloned)\n}\n\nfunc (c *Team) Clone() Team {\n    var s = make(Team, len(*c))\n    copy(s, *c)\n    for index, _ := range s {\n        s[index].Name = \"change name\"\n    }\n    return s\n}\n</code></pre>\n\n<p>But be careful, if this slice is containing a <code>sub slice</code> further copying is required, as we'll still have the sub slice elements sharing pointing to the same memory block elements, an example is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Inventories []Inventory\ntype Inventory struct { //instead of: map[string]map[string]Pairs\n    Warehouse string\n    Item      string\n    Batches   Lots\n}\ntype Lots []Lot\ntype Lot struct {\n    Date  time.Time\n    Key   string\n    Value float64\n}\n\nfunc main() {\nins := Inventory{\n        Warehouse: \"DMM\",\n        Item:      \"Gloves\",\n        Batches: Lots{\n            Lot{mustTime(time.Parse(custom, \"1/7/2020\")), \"Jan\", 50},\n            Lot{mustTime(time.Parse(custom, \"2/1/2020\")), \"Feb\", 70},\n        },\n    }\n\n   inv2 := CloneFrom(c Inventories)\n}\n\nfunc (i *Inventories) CloneFrom(c Inventories) {\n    inv := new(Inventories)\n    for _, v := range c {\n        batches := Lots{}\n        for _, b := range v.Batches {\n            batches = append(batches, Lot{\n                Date:  b.Date,\n                Key:   b.Key,\n                Value: b.Value,\n            })\n        }\n\n        *inv = append(*inv, Inventory{\n            Warehouse: v.Warehouse,\n            Item:      v.Item,\n            Batches:   batches,\n        })\n    }\n    (*i).ReplaceBy(inv)\n}\n\nfunc (i *Inventories) ReplaceBy(x *Inventories) {\n    *i = *x\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 11561640, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-52voy0QhnrM/AAAAAAAAAAI/AAAAAAAAAC8/tumuPeotzP4/photo.jpg?sz=128", "display_name": "Arin Yazilim", "link": "https://stackoverflow.com/users/11561640/arin-yazilim"}, "is_accepted": false, "score": 1, "last_activity_date": 1613490583, "last_edit_date": 1613490583, "creation_date": 1607417069, "answer_id": 65195722, "question_id": 39993688, "link": "https://stackoverflow.com/questions/39993688/are-slices-passed-by-value/65195722#65195722", "title": "Are slices passed by value?", "body": "<p>You can find an example below. Briefly slices is also passed by value but original slice and copied slice are linked to the same underlying array. If one of this slice changes, then underlying array changes, then other slice changes.</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    x := []int{1, 10, 100, 1000}\n    double(x)\n    fmt.Println(x) // ----&gt; 3 will print [2, 20, 200, 2000] (original slice changed)\n}\n\nfunc double(y []int) {\n    fmt.Println(y) // ----&gt; 1 will print [1, 10, 100, 1000]\n    for i := 0; i &lt; len(y); i++ {\n        y[i] *= 2\n    }\n    fmt.Println(y) // ----&gt; 2 will print [2, 20, 200, 2000] (copy slice + under array changed)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 309, "user_id": 5042376, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TmRyQ.png?s=128&g=1", "display_name": "Al Elizalde", "link": "https://stackoverflow.com/users/5042376/al-elizalde"}, "is_accepted": false, "score": 0, "last_activity_date": 1619194134, "creation_date": 1619194134, "answer_id": 67233419, "question_id": 39993688, "link": "https://stackoverflow.com/questions/39993688/are-slices-passed-by-value/67233419#67233419", "title": "Are slices passed by value?", "body": "<p>To complement this post, here is an example of passing by reference for the <a href=\"https://play.golang.org/p/mMivoH0TuV\" rel=\"nofollow noreferrer\">Golang PlayGround</a> you shared:</p>\n<pre><code>type point struct {\n    x int\n    y int\n}\n\nfunc main() {\n    data := []point{{1, 2}, {3, 4}, {5, 6}, {7, 8}}\n    makeRandomDatas(&amp;data)\n}\n\nfunc makeRandomDatas(dataPoints *[]point) {\n    for i := 0; i &lt; 10; i++ {\n        if len(*dataPoints) &gt; 0 {\n            fmt.Println(makeRandomData(dataPoints))\n        } else {\n            fmt.Println(&quot;no more elements&quot;)\n        }\n    }\n\n}\n\nfunc makeRandomData(cities *[]point) []point {\n    solution := []point{(*cities)[0]}                 //create a new slice with the first item from the old slice\n    *cities = append((*cities)[:0], (*cities)[1:]...) //remove the first item from the old slice\n    return solution\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40233, "favorite_count": 20, "accepted_answer_id": 39993797, "answer_count": 4, "score": 63, "last_activity_date": 1619194134, "creation_date": 1476260106, "last_edit_date": 1614860679, "question_id": 39993688, "link": "https://stackoverflow.com/questions/39993688/are-slices-passed-by-value", "title": "Are slices passed by value?", "body": "<p>In Go, I am trying to make a scramble slice function for my traveling salesman problem. While doing this I noticed when I started editing the slice I gave the scramble function was different every time I passed it in.</p>\n<p>After some debugging I found out it was due to me editing the slice inside the function. But since Go is supposed to be a &quot;pass by value&quot; language, how is this possible?</p>\n<p><a href=\"https://play.golang.org/p/mMivoH0TuV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mMivoH0TuV</a></p>\n<p>I have provided a playground link to show what I mean.\nBy removing line 27 you get a different output than leaving it in, this should not make a difference since the function is supposed to make its own copy of the slice when passed in as an argument.<br />\nCan someone explain the phenomenon?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 940, "user_id": 2833639, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z03bc.jpg?s=128&g=1", "display_name": "Nico M", "link": "https://stackoverflow.com/users/2833639/nico-m"}, "edited": false, "score": 0, "creation_date": 1476261495, "post_id": 39993639, "comment_id": 67266085, "body": "I don&#39;t think the community will do your research, please take a look at  <a href=\"http://stackoverflow.com/help/dont-ask\">stackoverflow.com/help/dont-ask</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1476372843, "post_id": 39993639, "comment_id": 67327763, "body": "maybe off topic, but the q is interesting i believe."}], "answers": [{"tags": [], "owner": {"reputation": 122, "user_id": 6692630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60010a9ab2531ae50f7cffebb58e1943?s=128&d=identicon&r=PG&f=1", "display_name": "rqLizard", "link": "https://stackoverflow.com/users/6692630/rqlizard"}, "is_accepted": false, "score": 5, "last_activity_date": 1571170151, "last_edit_date": 1571170151, "creation_date": 1476260313, "answer_id": 39993731, "question_id": 39993639, "link": "https://stackoverflow.com/questions/39993639/what-is-a-good-cms-written-in-go/39993731#39993731", "title": "What is a good CMS written in go?", "body": "<p>You should try use <a href=\"https://github.com/fragmenta/fragmenta-cms\" rel=\"nofollow noreferrer\">Fragmenta</a>, <a href=\"https://getqor.com/en\" rel=\"nofollow noreferrer\">QOR</a>, <a href=\"https://github.com/ponzu-cms/ponzu\" rel=\"nofollow noreferrer\">ponzu</a>, <a href=\"https://github.com/tejo/boxed\" rel=\"nofollow noreferrer\">boxed</a>, or <a href=\"https://libs.garden/go/search?q=cms&amp;page=1\" rel=\"nofollow noreferrer\">others</a>.</p>\n"}], "owner": {"reputation": 624, "user_id": 5388039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db2bc12577db77f610cec33fbf996a19?s=128&d=identicon&r=PG", "display_name": "Joost", "link": "https://stackoverflow.com/users/5388039/joost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1596, "favorite_count": 0, "closed_date": 1476266484, "answer_count": 1, "score": 1, "last_activity_date": 1571170151, "creation_date": 1476259934, "question_id": 39993639, "link": "https://stackoverflow.com/questions/39993639/what-is-a-good-cms-written-in-go", "closed_reason": "Not suitable for this site", "title": "What is a good CMS written in go?", "body": "<p>What would be a good CMS written in go?</p>\n\n<p>I'm looking for a CMS that is easy to customize, user-friendly and fast to set up.</p>\n\n<p>Basically a simple cms</p>\n"}, {"tags": ["json", "mongodb", "go", "struct", "bson"], "answers": [{"comments": [{"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1476257318, "post_id": 39992659, "comment_id": 67263623, "body": "You&#39;re right. But if the post data contains &#39;pincode&#39;, I still want that the final field name in the db should be &#39;zipcode&#39;."}, {"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1476258344, "post_id": 39992659, "comment_id": 67264203, "body": "Yeah, this seems be the way to go! Btw, even if we don&#39;t use *string and use omitempty, the field will be ignored right. Unless we Marshal or Unmarshal in which case it will exist but be empty. Am I understanding correctly? Thank you for your time to answer anyway!"}, {"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1476260608, "post_id": 39992659, "comment_id": 67265526, "body": "I tried it and got the error -  Duplicated key &#39;zipcode&#39; in struct utility.Address  Any ideas what&#39;s going wrong?"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1476296757, "post_id": 39992659, "comment_id": 67289489, "body": "Ops, it seems that your library doesn&#39;t allow duplicate <b>bson</b> fields, in this case we have to personalize our Unmarshal process. See the new <b>Edit</b>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1476298638, "post_id": 39992659, "comment_id": 67290605, "body": "Yes we use omitempty to ignore a field if it&#39;s empty, but because the zero value of a string is empty quotes &quot;&quot; it&#39;s better to use a pointer to know if the field is really empty just checking with <b>nil</b>"}, {"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 1, "creation_date": 1476333210, "post_id": 39992659, "comment_id": 67302422, "body": "Thank you very much for the detailed response @yandry-pozo"}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": true, "score": 2, "last_activity_date": 1476299484, "last_edit_date": 1476299484, "creation_date": 1476256658, "answer_id": 39992659, "question_id": 39992260, "link": "https://stackoverflow.com/questions/39992260/golang-bson-structs-use-multiple-field-names-for-a-single-field-in-json-but-on/39992659#39992659", "title": "Golang bson structs - use multiple field names for a single field in json but only one for writing to the database", "body": "<p>You can have both fields as pointer to string:</p>\n\n<pre><code>type Address struct {\n    AddressLine1 string        `json:\"addressLine1\" bson:\"addressLine1\"`\n    AddressLine2 string        `json:\"addressLine2\" bson:\"addressLine2\"`\n    Landmark     string        `json:\"landmark\" bson:\"landmark\"`\n    Zipcode      *string       `json:\"zipcode,omitempty\" bson:\"zipcode\"`\n    Pincode      *string       `json:\"pincode,omitempty\" bson:\"zipcode\"`\n    City         string        `json:\"city\" bson:\"city\"`\n}\n</code></pre>\n\n<p>As you may note we're using <strong>omitempty</strong> in the json tag, so if one of the fields is not present in the json it will be ignored as a <strong>nil</strong> pointer and it will not be present after <em>Marshal()</em> or <em>Unmarshal()</em></p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>In this case all we have to do is implement the method <code>UnmarshalJSON([]byte) error</code> to satisfy the interface <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow\">Unmarshaler</a>, the method <code>json.Unmarshal()</code> will always try to call that method and we can add our own logic after Unmarshal the struct, in this case we want to know if <em>pincode</em> is settled if it's we assigned to <em>zipcode</em>:\nfull example here: <a href=\"https://play.golang.org/p/zAOPMtCwBs\" rel=\"nofollow\">https://play.golang.org/p/zAOPMtCwBs</a></p>\n\n<pre><code>type Address struct {\n    AddressLine1 string  `json:\"addressLine1\" bson:\"addressLine1\"`\n    AddressLine2 string  `json:\"addressLine2\" bson:\"addressLine2\"`\n    Landmark     string  `json:\"landmark\" bson:\"landmark\"`\n    Zipcode      *string `json:\"zipcode,omitempty\" bson:\"zipcode\"`\n    Pincode      *string `json:\"pincode,omitempty\"`\n    City         string  `json:\"city\" bson:\"city\"`\n}\n\n// private alias of Address to avoid recursion in UnmarshalJSON()\ntype address Address\n\nfunc (a *Address) UnmarshalJSON(data []byte) error {\n    b := address{}\n    if err := json.Unmarshal(data, &amp;b); err != nil {\n        return nil\n    }\n    *a = Address(b) // convert the alias to address\n\n    if a.Pincode != nil &amp;&amp; a.Zipcode == nil {\n        a.Zipcode = a.Pincode\n        a.Pincode = nil // unset pincode\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Note that the field <strong>Zipcode</strong> has a bson tag and <strong>Pincode</strong> not, also we have to create an alias of type address to avoid calling UnmarshalJSON recursively</p>\n"}], "owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1188, "favorite_count": 1, "accepted_answer_id": 39992659, "answer_count": 1, "score": 1, "last_activity_date": 1476299484, "creation_date": 1476255257, "question_id": 39992260, "link": "https://stackoverflow.com/questions/39992260/golang-bson-structs-use-multiple-field-names-for-a-single-field-in-json-but-on", "title": "Golang bson structs - use multiple field names for a single field in json but only one for writing to the database", "body": "<p>I have a struct like this -</p>\n\n<pre><code>type Address struct {\n    AddressLine1 string        `json:\"addressLine1\" bson:\"addressLine1\"`\n    AddressLine2 string        `json:\"addressLine2\" bson:\"addressLine2\"`\n    Landmark     string        `json:\"landmark\" bson:\"landmark\"`\n    Zipcode      string        `json:\"zipcode\" bson:\"zipcode\"`\n    City         string        `json:\"city\" bson:\"city\"`\n}\n</code></pre>\n\n<p>Due to some compatibility issues between the previous build and the latest yet-to-be-released build, I want to make sure that if someone posts json data that decodes using this struct they should be able to use either 'zipcode' or 'pincode' as the field name in their json. But when this value is written to my database, the field name should only be 'zipcode'.</p>\n\n<p>In short,</p>\n\n<pre><code>{\n\"city\": \"Mumbai\",\n\"zipcode\": \"400001\"\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>{\n\"city\": \"Mumbai\",\n\"pincode\": \"400001\"\n}\n</code></pre>\n\n<p>should both appear inside the database as -</p>\n\n<pre><code>{\n\"city\": \"Mumbai\",\n\"zipcode\": \"400001\"\n}\n</code></pre>\n\n<p>How do I allow this?</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "bson", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "is_accepted": true, "score": 1, "last_activity_date": 1476421513, "last_edit_date": 1476421513, "creation_date": 1476358353, "answer_id": 40019808, "question_id": 39990793, "link": "https://stackoverflow.com/questions/39990793/how-to-get-aggregate-pipline-result-using-mongodb-in-golang-mgo-v2-liabry/40019808#40019808", "title": "How to get aggregate Pipline result using MongoDB in golang mgo.v2 liabry", "body": "<p>Finally I find the solution.I like to share it with stackoverflow community.</p>\n\n<p>I refer this one : <a href=\"https://groups.google.com/forum/#!topic/mgo-users/osael4xbGYs\" rel=\"nofollow\">google group answer</a></p>\n\n<pre><code> session := commons.GetMongoSession()\n    defer session.Close()\n\n    pipeline := []bson.D{\n        bson.D{\n            {\"$match\",\n                bson.M{\n                    \"venueList.id\": bson.M{\"$in\": []string{\"VID1212\", \"VID4343\"}},\n                },\n            },\n        },\n        bson.D{\n            {\"$unwind\", \"$venueList\"},\n        },\n        bson.D{\n            {\"$match\",\n                bson.M{\n                    \"venueList.id\": bson.M{\"$in\": []string{\"VID1212\", \"VID4343\"}},\n                },\n            },\n        },\n        bson.D{\n            {\"$unwind\", \"$venueList.sum\"},\n        },\n        bson.D{\n            {\"$group\",\n\n                bson.M{\n                    \"_id\": \"$venueList.sum.name\",\n                    \"count\": bson.M{\n                        \"$sum\": \"$venueList.sum.value\",\n                    },\n                },\n            },\n        },\n        bson.D{\n            {\"$group\",\n                bson.M{\n                    \"_id\": bson.NewObjectId(),\n                    \"counts\": bson.M{\n                        \"$push\": bson.M{\n                            \"name\":  \"$_id\",\n                            \"value\": \"$count\",\n                        },\n                    },\n                },\n            },\n        },\n    }\n\n    query := bson.D{\n        {\"aggregate\", \"useragents\"}, // useragents is a collection name\n        {\"pipeline\", pipeline},\n    }\n\n    var res interface{}\n    err := session.DB(\"analytics\").Run(query, &amp;res)\n    if err != nil {\n        println(err.Error())\n    } else {\n        println(res)\n    }\n</code></pre>\n"}], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1617, "favorite_count": 2, "accepted_answer_id": 40019808, "answer_count": 1, "score": 2, "last_activity_date": 1476421513, "creation_date": 1476248226, "last_edit_date": 1495542255, "question_id": 39990793, "link": "https://stackoverflow.com/questions/39990793/how-to-get-aggregate-pipline-result-using-mongodb-in-golang-mgo-v2-liabry", "title": "How to get aggregate Pipline result using MongoDB in golang mgo.v2 liabry", "body": "<p>Question background is I want retrieve aggregated data from MongoDB data by using golang mgo.v2 liabary.</p>\n\n<p>I have a collection dataset as following.collection name is useragents</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"57f940c4932a00aba387b0b0\"),\n    \"tenantID\" : 1,\n    \"date\" : \"2016-10-09 00:23:56\",\n    \"venueList\" : [\n        {\n            \"id\" : \u201cVID1212\u201d,\n            \"sum\" : [\n                {\n                      \"name\" : \"linux\",\n                      \"value\" : 12\n                },\n                {\n                    \"name\" : \"ubuntu\",\n                    \"value\" : 4\n                }\n            ],\n            \u201cssidList\u201d : [    // this is list of ssid\u2019s in venue\n                {\n                    \"id\" : \u201cSSID1212\u201d,\n                    \"sum\" : [\n                        {\n                            \"name\" : \"linux\",\n                            \"value\" : 8\n                        },\n                        {\n                            \"name\" : \"ubuntu\",\n                            \"value\" : 6\n                        }\n                    ],\n                    \u201cmacList\u201d : [  // this is mac list inside particular ssid  ex: this is mac list inside the SSID1212\n                        {\n                            \"id\" : \u201c12:12:12:12:12:12\u201d,\n                            \"sum\" : [\n                                {\n                                    \"name\" : \"linux\",\n                                    \"value\" : 12\n                                },\n                                {\n                                    \"name\" : \"ubuntu\",\n                                    \"value\" : 1\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        },\n        {\n            \"id\" : \u201cVID4343\u201d,\n            \"sum\" : [\n                {\n                     \"name\" : \"linux\",\n                     \"value\" : 2\n                }\n            ],\n            \"ssidList\" : [\n                {\n                    \"id\" : \u201cSSID4343\u201d,\n                    \"sum\" : [\n                        {\n                            \"name\" : \"linux\",\n                            \"value\" : 2\n                        }\n                    ],\n                    \"macList\" : [\n                        {\n                            \"id\" : \u201c43:43:43:43:43:34\u201d,\n                            \"sum\" : [\n                                {\n                                    \"name\" : \"linux\",\n                                    \"value\" : 2\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>I have already solved MongoDB shell script that i want by help from stack-overflow community.but I am troubling on when I was implemening it in golang using mgo.v2 library.</p>\n\n<p>This is mongodb shell script</p>\n\n<pre><code>db.useragents.aggregate([\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList\" },\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList.sum\" },    \n    { \n        \"$group\": {\n            \"_id\": \"$venueList.sum.name\",\n            \"count\": { \"$sum\": \"$venueList.sum.value\" }\n        }\n    },\n    { \n        \"$group\": {\n            \"_id\": null,\n            \"counts\": {\n                \"$push\": {\n                    \"name\": \"$_id\",\n                    \"value\": \"$count\"\n                }\n            }\n        }\n    }\n])\n</code></pre>\n\n<p>Please go though <a href=\"https://stackoverflow.com/questions/39943111/retrieve-item-list-by-checking-multiple-attribute-values-in-mongodb-in-golang\">question background</a> </p>\n\n<p>And I implement golang code as following</p>\n\n<pre><code>func GetBrowserStats(constrains models.Constrains) ([]bson.M, error) {\n\n    session := commons.GetMongoSession()\n    defer session.Close()\n    var col = session.DB(\"analytics\").C(\"useragents\")\n\n    pipeline1 := bson.M{\n        \"$match\": bson.M{\n            \"venueList.id\": bson.M{\n                \"$in\": []string{\"VID1212\", \"VID4343\"},\n            },\n        },\n    }\n    pipeline2 := bson.M{\n        \"$unwind\": \"$venueList\",\n    }\n    pipeline3 := bson.M{\n        \"$match\": bson.M{\n            \"venueList.id\": bson.M{\n                \"$in\": []string{\"VID1212\", \"VID4343\"},\n            },\n        },\n    }\n    pipeline4 := bson.M{\n        \"$unwind\": \"$venueList.sum\",\n    }\n\n    pipeline5 := bson.M{\n        \"$group\": bson.M{\n            \"_id\": \"$venueList.sum.name\",\n            \"count\": bson.M{\n                \"$sum\": \"$venueList.sum.value\",\n            },\n        },\n    }\n    pipeline6 := bson.M{\n        \"$group\": bson.M{\n            \"_id\": bson.NewObjectId(),\n            \"counts\": bson.M{\n                \"$push\": bson.M{\n                    \"name\":  \"$_id\",\n                    \"value\": \"$count\",\n                },\n            },\n        },\n    }\n\n    all := []bson.M{pipeline1, pipeline2, pipeline3, pipeline4, pipeline5, pipeline6}\n    pipe := col.Pipe(all)\n\n    result := []bson.M{}\n    err := pipe.All(&amp;result)\n    println(result[0])\n    if err != nil {\n        println(err.Error())\n        errMsg := \"Error occourred while getting dashboard configs from mongo stack:\" + err.Error()\n        log.Error()\n        return result, errors.New(errMsg)\n    }\n    return result, nil\n}\n</code></pre>\n\n<p>I have create a pipline and serve it into pipe.All() but there is null result return from the <code>result</code> varible.</p>\n\n<p>I want to return following object in <code>result</code></p>\n\n<pre><code>{ \"_id\" : ObjectId(\"57f73573d6e0ac1a9f2ab346\") , \"counts\" : [ { \"name\" : \"ubuntu\", \"value\" : 1 }, { \"name\" : \"linux\", \"value\" : 14 } ] }\n</code></pre>\n"}, {"tags": ["mysql", "go", "time", "unix-timestamp", "google-cloud-sql"], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": true, "score": 2, "last_activity_date": 1476244516, "creation_date": 1476244516, "answer_id": 39990258, "question_id": 39988506, "link": "https://stackoverflow.com/questions/39988506/what-is-best-practice-when-storing-rfc3339-time-in-a-mysql-database/39990258#39990258", "title": "What is best practice when storing RFC3339 time in a MySQL database?", "body": "<p>If you're using the <code>go-sql-driver/mysql</code> you can ask the driver to scan DATE and DATETIME automatically to time.Time, by adding <code>parseTime=true</code> to your connection string.</p>\n\n<p>See <a href=\"https://github.com/go-sql-driver/mysql#timetime-support\" rel=\"nofollow\">https://github.com/go-sql-driver/mysql#timetime-support</a></p>\n\n<p>Example code:</p>\n\n<pre><code>db, _ := sql.Open(\"mysql\", \"root:@/?parseTime=true\")\n\nvar myTime time.Time\nrow, err := db.QueryRow(\"SELECT current_timestamp()\")\n\nrow.Scan(&amp;myTime)\nfmt.Println(myTime)\n</code></pre>\n"}], "owner": {"reputation": 924, "user_id": 4199833, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9tBnh.png?s=128&g=1", "display_name": "rudolph1024", "link": "https://stackoverflow.com/users/4199833/rudolph1024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1212, "favorite_count": 1, "accepted_answer_id": 39990258, "answer_count": 1, "score": 1, "last_activity_date": 1476244516, "creation_date": 1476230006, "last_edit_date": 1476231337, "question_id": 39988506, "link": "https://stackoverflow.com/questions/39988506/what-is-best-practice-when-storing-rfc3339-time-in-a-mysql-database", "title": "What is best practice when storing RFC3339 time in a MySQL database?", "body": "<p>I have data in a Google Cloud Datastore NoSQL database. The objects in this database contain fields of <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow\">type <code>Time.time</code></a>, specifically RFC3339 format (YYYY-MM-DDThh:mm:ssTZD). I am moving some of this data into a Google Cloud SQL database and I am wondering what is considered best practice when storing RFC3339 formatted time data in a MySQL database.</p>\n\n<p><a href=\"http://www.xaprb.com/blog/2014/01/30/timestamps-in-mysql/\" rel=\"nofollow\">This post</a> strongly suggests the following:</p>\n\n<blockquote>\n  <p>All date and time columns shall be <code>INT UNSIGNED NOT NULL</code>, and shall\n  store a Unix timestamp in UTC.</p>\n</blockquote>\n\n<p>So, should I just make use of <a href=\"https://godoc.org/time#Time.Unix\" rel=\"nofollow\">Golang's <code>func (t Time) Unix()</code></a> and store the data that way? What are some alternative approaches to storing the data? What kinds of issues might I run into if I don't heed the poster's advice?</p>\n"}, {"tags": ["dictionary", "go", "struct", "grouping", "slice"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476222427, "post_id": 39987023, "comment_id": 67253471, "body": "I don&#39;t really follow your question. What is the purpose of an <code>Equal</code> function? I&#39;m not sure if you&#39;re expecting a map of maps where all items with an id1 value <code>X</code> are in a group, all items with another id1 value <code>Y</code> are in a different group ect. Can you give an example of the input and output? Don&#39;t need a lot of data but enough to illustrate the point which your struct does not."}, {"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476222763, "post_id": 39987023, "comment_id": 67253611, "body": "Yes, for example:"}, {"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476223208, "post_id": 39987023, "comment_id": 67253799, "body": "Yes, for example: <code>[r1{id1: 345, money: 1500}, r2{id1: 345, id2 140, money: 2700}, r3{id1: 345, money: 1000}</code>. So r1 and r3 should be summed and get <code>rSummed1{id: 345, money: 2500},  rSummed2{id1: 345, id2: 140, money: 2700}</code>. It is the classical <code>SELECT Sum(money) GROUP BY id1, id2 ...</code>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476223935, "post_id": 39987023, "comment_id": 67254102, "body": "Wouldn&#39;t <code>r2</code> also be in that group? It&#39;s <code>id1</code> value is also 345."}, {"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476225158, "post_id": 39987023, "comment_id": 67254495, "body": "No, because in r2 id2 != 0. All id fields need to be exactly the same."}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "edited": false, "score": 0, "creation_date": 1476271357, "post_id": 39989962, "comment_id": 67272401, "body": "Awesome, this was the kind of thing I was looking for. I knew there was a much better way! Thanks!!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1476254077, "last_edit_date": 1476254077, "creation_date": 1476242263, "answer_id": 39989962, "question_id": 39987023, "link": "https://stackoverflow.com/questions/39987023/golang-group-and-sum-slice-of-structs/39989962#39989962", "title": "Golang: group and sum slice of structs", "body": "<p>Basically your <code>idXX</code> fields are the keys, an n-tuple. And the <code>money</code> field is the data to be summed.</p>\n\n<p>This can easily be done if you slightly refactor your types. Put only the keys into a struct, so it can be used as a key in a map. Struct values are <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">comparable</a>:</p>\n\n<blockquote>\n  <p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"noreferrer\">blank</a> fields are equal.</p>\n</blockquote>\n\n<p>So the new types:</p>\n\n<pre><code>type Key struct {\n    id1 int\n    id2 int\n    id3 int\n    id4 int\n    id5 int\n    id6 int\n    id7 int\n    id8 int\n}\n\ntype Register struct {\n    key   Key\n    money int\n}\n</code></pre>\n\n<p>And to group and calculate sum, you can use a <code>map[Key]int</code>, using <code>Register.key</code> as the map key to \"group\" all registers with the same keys (same ids):</p>\n\n<pre><code>regs := []*Register{\n    {Key{id1: 345}, 1500},\n    {Key{id1: 345, id2: 140}, 2700},\n    {Key{id1: 345, id2: 140}, 1300},\n    {Key{id1: 345}, 1000},\n    {Key{id3: 999}, 1000},\n    {Key{id3: 999}, 2000},\n}\n\n// calculate sum:\nm := map[Key]int{}\nfor _, v := range regs {\n    m[v.key] += v.money\n}\n\nfmt.Println(m)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>map[{345 0 0 0 0 0 0 0}:2500 {345 140 0 0 0 0 0 0}:4000 {0 0 999 0 0 0 0 0}:3000]\n</code></pre>\n\n<p>For a nice output:</p>\n\n<pre><code>fmt.Println(\"Nice output:\")\nfor k, v := range m {\n    fmt.Printf(\"%+3v: %d\\n\", k, v)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Nice output:\n{id1:345 id2:  0 id3:  0 id4:  0 id5:  0 id6:  0 id7:  0 id8:  0}: 2500\n{id1:345 id2:140 id3:  0 id4:  0 id5:  0 id6:  0 id7:  0 id8:  0}: 4000\n{id1:  0 id2:  0 id3:999 id4:  0 id5:  0 id6:  0 id7:  0 id8:  0}: 3000\n</code></pre>\n\n<p>This is as easy and as efficient as it can get. Try the examples on the <a href=\"https://play.golang.org/p/1p_625J5HE\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>In the map we didn't have to check if a <code>Key</code> is already in it. This is so because indexing a map yields the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a> of the value type of the map if the key is not in the map. So in this case if a <code>Key</code> is not yet in the map, <code>m[key]</code> will give you <code>0</code> (<code>0</code> is the zero value for the <code>int</code> type), properly telling that the \"previous\" sum for that key is <code>0</code> so far.</p>\n\n<p>Also note that <code>Key</code> may be an <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">embedded field</a> in <code>Register</code> instead of a \"regular\" field, it doesn't matter, and that way you could refer to the <code>idXX</code> fields as if they were part of the <code>Register</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "edited": false, "score": 0, "creation_date": 1476271483, "post_id": 39995327, "comment_id": 67272469, "body": "Great! Seems exacty what I need! Thanks!"}], "tags": [], "owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "is_accepted": false, "score": 1, "last_activity_date": 1476265070, "creation_date": 1476265070, "answer_id": 39995327, "question_id": 39987023, "link": "https://stackoverflow.com/questions/39987023/golang-group-and-sum-slice-of-structs/39995327#39995327", "title": "Golang: group and sum slice of structs", "body": "<p>You can try go-linq: <a href=\"https://github.com/ahmetalpbalkan/go-linq/\" rel=\"nofollow\">https://github.com/ahmetalpbalkan/go-linq/</a></p>\n\n<p>It is similar to c# linq, use the GroupBy and Aggregate in your case</p>\n\n<p><a href=\"https://godoc.org/github.com/ahmetalpbalkan/go-linq#example-Query-GroupBy\" rel=\"nofollow\">https://godoc.org/github.com/ahmetalpbalkan/go-linq#example-Query-GroupBy</a>\n<a href=\"https://godoc.org/github.com/ahmetalpbalkan/go-linq#example-Query-Aggregate\" rel=\"nofollow\">https://godoc.org/github.com/ahmetalpbalkan/go-linq#example-Query-Aggregate</a></p>\n\n<p>pseudo code:</p>\n\n<pre><code>From(regs).GroupBy(merge ids to a string as group key).Select(use Aggregate or SumInts to sum money)\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11584, "favorite_count": 0, "accepted_answer_id": 39989962, "answer_count": 2, "score": 9, "last_activity_date": 1476265070, "creation_date": 1476221173, "last_edit_date": 1476252494, "question_id": 39987023, "link": "https://stackoverflow.com/questions/39987023/golang-group-and-sum-slice-of-structs", "title": "Golang: group and sum slice of structs", "body": "<p>I come from the .NET world where I had LINQ so I could do in-memory queries like the one we usually see in SQL.</p>\n\n<p>I have a slice of this structure I want to group by 8 fields, and then sum another integer field. Something like:</p>\n\n<pre><code>type Register struct {\n    id1 int\n    id2 int\n    id3 int\n    id4 int\n    id5 int\n    id6 int\n    id7 int\n    id8 int\n    money int\n}\n</code></pre>\n\n<p>I thought in:</p>\n\n<ul>\n<li>Creating an Equal function, to compare structures (those eight<br>\nfields).\nIterate over the collection I'm analyzing.  For each item<br>\ncheck if it is already in the hash table.  If it is there => I sum\nthe field.  If it is not => I add the new item to hash table.</li>\n</ul>\n\n<p>Is there a better way or any beautiful, efficient and easy ready to use\nlibrary?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1476219204, "post_id": 39985749, "comment_id": 67251862, "body": "Thanks for the answer, that helps with the first part, but now I am confused about the select statement, is it choosing the <code>c &lt;- x</code> part because the goroutine &quot;opens&quot; the channel and then the switch statement reads something like <code>if x can send to c; do...</code>? If I am correct, then how can I interpret the second case...?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1476219649, "post_id": 39985749, "comment_id": 67252113, "body": "@deltaskelta yep, that&#39;s the basic idea. Think of it like a switch where it executes the first condition that is met. You&#39;re receiving from the <code>quit</code> channel so something sending on <code>quit</code> will put you in that case, you&#39;re sending on <code>c</code> so something having read off <code>c</code> will open it up for another write causing you to go into that case."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1476216431, "last_edit_date": 1476216431, "creation_date": 1476216129, "answer_id": 39985749, "question_id": 39985524, "link": "https://stackoverflow.com/questions/39985524/what-is-happening-in-this-go-concurrency-example/39985749#39985749", "title": "What is happening in this go concurrency example?", "body": "<p>In the code example the goroutine is launched, and runs until it hits <code>fmt.Println(&lt;- c)</code> where it is printing the values it receives from <code>c</code>. At this point in time <code>i == 0</code> we're in the first iteration. Meanwhile, since this is running in a goroutine, main has continued execution and called <code>fibonacci</code> passing it the <code>c</code> and <code>quit</code> channels. The <code>fibonacci</code> function is sitting in an 'infinite' select, meaning you will never get out of this without explicitly calling <code>return</code> as it does when it receives from the <code>quit</code> channel.</p>\n\n<p>So back in main, where you invoked the goroutine, it blocks until receiving from the channel, <code>fibonacci</code> begins executing and sending on that channel, providing the next number in the <code>fibonacci</code> sequence until that loop terminates (when <code>i == 10</code>) at which point the code there moves down to <code>quit &lt;- 0</code> where is sends on the quit channel. Since you're in an infinite select over there in <code>fibonacci</code> it will always execute the next available case, it cannot continue sending on <code>c</code> because that channel is not buffered, it only allows one item and is full, instead it moves in the <code>quit</code> case statement because it has received something on the <code>quit</code> channel, at which point it prints <code>quit</code> and returns.</p>\n\n<p>Hope that helps. Some of the language may not be 100% accurate. Really just trying to illustrate how this control flow works. I think actually, the select waits until the goroutine in main can receive at which point it goes into the <code>c &lt;- x</code> statement and sends. You can observe this by trying to read an item out of the channel after everything is done, which causes a panic. In effect they're both waiting for one another, you can't send on a full channel and if you just read off it without any other control flow (like a select) then you will block until there is something there to receive.</p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 39985749, "answer_count": 1, "score": 0, "last_activity_date": 1476217385, "creation_date": 1476215299, "last_edit_date": 1476217385, "question_id": 39985524, "link": "https://stackoverflow.com/questions/39985524/what-is-happening-in-this-go-concurrency-example", "title": "What is happening in this go concurrency example?", "body": "<p>I am on the concurrency example here: <a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow\">https://tour.golang.org/concurrency/5</a></p>\n\n<p>This is the code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {\n        select {\n        case c &lt;- x:\n            x, y = y, x + y\n        case &lt;- quit:\n            fmt.Println(\"quit\")\n            return\n        }\n    }\n}\n\nfunc main() {\n    c := make(chan int)\n    quit := make(chan int)\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            fmt.Println(&lt;- c)\n        }\n        quit &lt;- 0\n    }()\n    fibonacci(c, quit)\n}\n</code></pre>\n\n<p>There is quite a bit about this that is confusing to me and the tour itself doesn't say much about it. It says that select will wait on communication operations but I don't really get how that applies to the function that it sends to a goroutine before calling <code>fibonacci</code>. <code>fmt.Println</code> is being sent the channel <code>c</code>, but I just don't see why or how this makes any sense...</p>\n\n<p>I have so many questions about this, I am hoping that everything falls into place after understanding the first part...</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1586221823, "post_id": 39984974, "comment_id": 108043617, "body": "<code>len(oneSlice)</code> == <code>cap(oneSlice)</code>"}, {"owner": {"reputation": 383, "user_id": 8216204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc75d2ed2c77d48af4bdbd45e8e355c?s=128&d=identicon&r=PG&f=1", "display_name": "mrpandey", "link": "https://stackoverflow.com/users/8216204/mrpandey"}, "edited": false, "score": 23, "creation_date": 1589702301, "post_id": 39984974, "comment_id": 109393342, "body": "I want to create a slice containing <code>n</code> copies of integer <code>val</code>. Is there an easier way than looping? For example, in C++ I can do <code>vector&lt;int&gt; a(n, val)</code>."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 64, "last_activity_date": 1530186349, "last_edit_date": 1530186349, "creation_date": 1476213306, "answer_id": 39984974, "question_id": 39984957, "link": "https://stackoverflow.com/questions/39984957/is-it-possible-to-initialize-slice-with-specific-values/39984974#39984974", "title": "Is it possible to initialize slice with specific values?", "body": "<p>Yes but you have to use a different syntax.</p>\n\n<pre><code>oneSlice := []int{1, 1, 1, 1, 1}\n</code></pre>\n\n<p>It's referred to as 'composite literal'</p>\n\n<p>Also, if there is reason to iterate (like calculating the values based loop variable or something) then you could use the <code>range</code> keyword rather than the old school for i is equal to, i is less than, i++ loop.</p>\n\n<pre><code>for i := range onesSlice {\n    onesSlice[i] = 1\n}\n</code></pre>\n"}], "owner": {"reputation": 2449, "user_id": 4313927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/568720341/picture?type=large", "display_name": "Nicky Feller", "link": "https://stackoverflow.com/users/4313927/nicky-feller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42077, "favorite_count": 3, "accepted_answer_id": 39984974, "answer_count": 1, "score": 42, "last_activity_date": 1569412553, "creation_date": 1476213228, "last_edit_date": 1569412553, "question_id": 39984957, "link": "https://stackoverflow.com/questions/39984957/is-it-possible-to-initialize-slice-with-specific-values", "title": "Is it possible to initialize slice with specific values?", "body": "<p>Is it possible to initialize an slice with all 1's like in python?</p>\n\n<p>PYTHON:</p>\n\n<pre><code>onesArray = np.ones(5)\nonesList = [1]*5\n</code></pre>\n\n<p>GOLANG</p>\n\n<pre><code>onesSlice := make([]int, 5)\nfor i:= 0; i &lt; len(onesSlice); i++{\n    onesSlice[i] = 1\n}\n</code></pre>\n\n<p>Is it possible to do better than this?</p>\n"}, {"tags": ["c", "go", "system-calls"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476215168, "post_id": 39984761, "comment_id": 67249640, "body": "@JimB thanks, that solved my problem."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1476215243, "creation_date": 1476215243, "answer_id": 39985512, "question_id": 39984761, "link": "https://stackoverflow.com/questions/39984761/how-can-i-count-syscalls-in-a-go-program-on-os-x/39985512#39985512", "title": "How can I count syscalls in a Go program on OS X?", "body": "<p>If you want to use dtrace on macOS, you will need to use the external linker to build your program</p>\n\n<pre><code>-ldflags -linkmode=external\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 39985512, "answer_count": 1, "score": 1, "last_activity_date": 1476215243, "creation_date": 1476212426, "question_id": 39984761, "link": "https://stackoverflow.com/questions/39984761/how-can-i-count-syscalls-in-a-go-program-on-os-x", "title": "How can I count syscalls in a Go program on OS X?", "body": "<p>I'm trying to count the syscalls in my Go program on OS X Yosemite. I've tried using <code>dtruss</code> and <code>dtrace</code>, but both cause my program to crash with the following error, followed by a stack trace:</p>\n\n<pre><code>fatal error: runtime: bsdthread_register error\n</code></pre>\n\n<p>The two commands I've used are:</p>\n\n<ol>\n<li><code>sudo dtruss \"./my_program my_arg\"</code></li>\n<li><code>sudo dtrace -c \"powerset 2\" -n 'syscall:::entry { @num[probefunc] = count(); }'</code></li>\n</ol>\n\n<h2>Things I've Tried</h2>\n\n<p>The main takeaway from my Google-foo has been to unset <code>DYLD_INSERT_LIBRARIES</code>, which I have done numerous times to no avail.</p>\n\n<p><code>./my_program</code> is a binary that I created with <code>go install</code>. I've written an equivalent C program and both of the above commands work fine with that.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476217574, "post_id": 39984575, "comment_id": 67250981, "body": "To get multiple values, you need to use the <code>Request.Form</code> or <code>Request.PostForm</code> maps directly. If those aren&#39;t there please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. For instance, the form you show will submit via a <i>GET</i> to the same url that generated the form."}, {"owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476219911, "post_id": 39984575, "comment_id": 67252256, "body": "@JimB - Edited to show MCV example :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476223024, "post_id": 39984575, "comment_id": 67253720, "body": "Sorry, you&#39;re going to have to create a more complete example, because what you&#39;ve shown should still work.."}, {"owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476223448, "post_id": 39984575, "comment_id": 67253905, "body": "@JimB - Ah, I think my issues were two fold.  First c.Request.PostForm is likely not working at all because of something in my form that is not shown in the example <code>enctype=&quot;multipart&#47;form-data&quot;</code> .. Technically I don&#39;t think I need my form to be multipart and if I did I think it would just mean calling <code>ParseMultipartForm</code> rather than <code>ParseForm</code> -- <code>ParseMultipartForm</code> is however called when I call <code>c.PostForm</code> using gonic, but it appears the gonic method manually returns <a href=\"https://github.com/gin-gonic/gin/blob/develop/context.go#L267-L269\" rel=\"nofollow noreferrer\">only the first value</a> - Will check and update."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476223601, "post_id": 39984575, "comment_id": 67253967, "body": "The methods only returning the first value is expected, because that&#39;s how the std lib <code>http.Request</code> methods works."}], "answers": [{"tags": [], "owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "is_accepted": false, "score": 1, "last_activity_date": 1476293674, "creation_date": 1476293674, "answer_id": 40004908, "question_id": 39984575, "link": "https://stackoverflow.com/questions/39984575/gin-gonic-array-of-values-from-postform/40004908#40004908", "title": "Gin Gonic array of values from PostForm", "body": "<p>Issue with this code is two fold.  Posting my answer in case someone else has either of these problems.</p>\n\n<ol>\n<li><code>c.Request.PostForm</code> returns empty in this case because the form is multipart and <code>ParseForm</code> only parses non-multipart forms.  In order to get the data here either change the form type to non-multipart or call <code>ParseMultipartForm</code> before accessing post values.</li>\n<li><code>c.PostForm()</code> only returns the first value because thats what the wrapper in Gin Gonic does.  In order to access all the values, it is necessary to access the original <code>c.Request.PostForm</code> data, and then AFTER you parse it properly.</li>\n</ol>\n\n<p>Thanks @JimB for the assist.</p>\n"}, {"tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": false, "score": 5, "last_activity_date": 1476297280, "creation_date": 1476297280, "answer_id": 40005949, "question_id": 39984575, "link": "https://stackoverflow.com/questions/39984575/gin-gonic-array-of-values-from-postform/40005949#40005949", "title": "Gin Gonic array of values from PostForm", "body": "<p>In order to make it works you have two ways here</p>\n\n<pre><code>&lt;form method=\"POST\" enctype=\"multipart/form-data\" action=\"mygo\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email1@email.com\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email2@email.com\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email3@email.com\"&gt;\n&lt;/form&gt;\n\nr.POST(\"/\", func(c *gin.Context) {\n        c.Request.ParseMultipartForm(1000)\n        for key, value := range c.Request.PostForm {\n            fmt.Println(key,value)\n        }\n    })\n</code></pre>\n\n<p>either</p>\n\n<pre><code>    &lt;form method=\"POST\" action=\"mygo\"&gt;\n     &lt;input type=hidden name=\"emails\" value=\"email1@email.com\"&gt;\n     &lt;input type=hidden name=\"emails\" value=\"email2@email.com\"&gt;\n     &lt;input type=hidden name=\"emails\" value=\"email3@email.com\"&gt;\n    &lt;/form&gt;\n\n r.POST(\"/\", func(c *gin.Context) {\n            c.Request.ParseForm()\n            for key, value := range c.Request.PostForm {\n                fmt.Println(key,value)\n            }\n        })\n</code></pre>\n\n<p>Both gives the same result</p>\n\n<pre><code>emails [email1@email.com email2@email.com email3@email.com]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 1169825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4795a27b784eed182585dbbbabe632c?s=128&d=identicon&r=PG", "display_name": "algorix", "link": "https://stackoverflow.com/users/1169825/algorix"}, "is_accepted": false, "score": 3, "last_activity_date": 1524580759, "creation_date": 1524580759, "answer_id": 50004438, "question_id": 39984575, "link": "https://stackoverflow.com/questions/39984575/gin-gonic-array-of-values-from-postform/50004438#50004438", "title": "Gin Gonic array of values from PostForm", "body": "<p>With the latest version of gin-gonic (v1.2) you can just:</p>\n\n<pre><code>emails := c.PostFormArray(\"emails\")\n</code></pre>\n\n<p>Then <code>emails</code> will be a <code>[]string</code>.</p>\n\n<p><code>Parse</code> and <code>iterate</code> isn't more necessary.</p>\n"}], "owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11365, "favorite_count": 4, "answer_count": 3, "score": 5, "last_activity_date": 1524580759, "creation_date": 1476211774, "last_edit_date": 1490874968, "question_id": 39984575, "link": "https://stackoverflow.com/questions/39984575/gin-gonic-array-of-values-from-postform", "title": "Gin Gonic array of values from PostForm", "body": "<p>I'm trying to capture an array of Post values from HTML form using Go / Gin Gonic -- in PHP I would use something like:</p>\n\n<pre><code>&lt;form method=\"POST\" enctype=\"multipart/form-data\" action=\"mygo\"&gt;\n &lt;input type=hidden name=\"emails[]\" value=\"email1@email.com\"&gt;\n &lt;input type=hidden name=\"emails[]\" value=\"email2@email.com\"&gt;\n &lt;input type=hidden name=\"emails[]\" value=\"email3@email.com\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>However this doesn't seem to work with Gin Gonic (or Go for that matter).</p>\n\n<p>I've also tried:</p>\n\n<pre><code>&lt;form method=\"POST\" enctype=\"multipart/form-data\" action=\"mygo\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email1@email.com\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email2@email.com\"&gt;\n &lt;input type=hidden name=\"emails\" value=\"email3@email.com\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>As elsewhere it is suggested that doing this would cause <code>c.PostForm(\"emails\")</code> to return a slice.  However in practice it seems that this instead returns the last value as a string instead :(</p>\n\n<p>Interestingly, <code>c.Request.PostForm</code> returns an empty map, even if <code>c.Request.ParseForm()</code> is called first.  What am I doing wrong?</p>\n\n<p>Go Form:</p>\n\n<pre><code>func main() {\n// ...\n    router.POST(\"mygo\",parseFunc)\n}\n\nfunc mygo(c *gin.Context) {\n  c.Request.ParseForm()\n  log.Printf(\"%v\",c.Request.PostForm[\"emails\"]) // \"\"\n  log.Printf(\"%v\",c.PostForm(\"emails\") // \"email3@email.com\"\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "docker", "libgit2", "alpine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476208605, "post_id": 39982804, "comment_id": 67245851, "body": "What problem are you trying to solve? libgit isn&#39;t installing a pkg-config file, but it&#39;s still there in a standard path."}, {"owner": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476209494, "post_id": 39982804, "comment_id": 67246398, "body": "I am trying to build a golang app which uses git2go and as git2go depends on libgit2 I need to have it. And pkg-config or not if I try to build the app assuming that libgit2 is installed (after the apk add step) I still get the exact same error"}], "answers": [{"comments": [{"owner": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "edited": false, "score": 0, "creation_date": 1476216824, "post_id": 39984304, "comment_id": 67250565, "body": "Thanks a lot. I have figured out a way by manually cloning and building and installing libgit2 but this one is much more simpler. Great. Thanks again."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1476214134, "last_edit_date": 1476214134, "creation_date": 1476210848, "answer_id": 39984304, "question_id": 39982804, "link": "https://stackoverflow.com/questions/39982804/libgit2-alpine-linux-docker-error/39984304#39984304", "title": "libgit2 alpine linux docker error", "body": "<p>You are trying to compile a package using <code>libgit2</code>, so you need the <code>libgit2-dev</code> development package with the headers, pc file, etc.</p>\n\n<p>This docker file file builds git2go successfully:</p>\n\n<pre><code>FROM golang:1.7-alpine\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git openssh alpine-sdk libgit2-dev\nRUN go get -v github.com/libgit2/git2go\n</code></pre>\n"}], "owner": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1766, "favorite_count": 0, "accepted_answer_id": 39984304, "answer_count": 1, "score": 3, "last_activity_date": 1476261701, "creation_date": 1476205603, "last_edit_date": 1495535269, "question_id": 39982804, "link": "https://stackoverflow.com/questions/39982804/libgit2-alpine-linux-docker-error", "title": "libgit2 alpine linux docker error", "body": "<p>Ok, This is above my understanding. I have really no idea what exactly is wrong here but something is. I am on the verge of breaking by banging my head on the wall and yet nothing came up. Can any kind soul please help me.</p>\n\n<p>This is my Dockerfile - </p>\n\n<pre><code>FROM golang:1.7-alpine\nRUN echo http://dl-4.alpinelinux.org/alpine/edge/testing &gt;&gt; /etc/apk/repositories\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git openssh alpine-sdk libgit2\n\nRUN pkg-config --print-errors --exists libgit2\n</code></pre>\n\n<p>I have wrote it with advice from here -  <a href=\"https://stackoverflow.com/questions/36803993/how-do-i-install-libgit2-on-alipne-linux\">How do I install libgit2 on Alipne linux</a></p>\n\n<p>And this is the end result - </p>\n\n<pre><code>Sending build context to Docker daemon   513 kB\nStep 1 : FROM golang:1.7-alpine\n ---&gt; 161e259af05d\nStep 2 : RUN echo http://dl-4.alpinelinux.org/alpine/edge/testing &gt;&gt; /etc/apk/repositories\n ---&gt; Running in 428c62a1fc94\n ---&gt; 80a4e0dca9d7\nRemoving intermediate container 428c62a1fc94\nStep 3 : RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git openssh alpine-sdk libgit2\n ---&gt; Running in 7876608fa4e7\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz\nfetch http://dl-4.alpinelinux.org/alpine/edge/testing/x86_64/APKINDEX.tar.gz\nv3.4.4-9-g07aa589 [http://dl-cdn.alpinelinux.org/alpine/v3.4/main]\nv3.4.4-1-g77d84e1 [http://dl-cdn.alpinelinux.org/alpine/v3.4/community]\nv3.4.0-4072-g7fdcbdd [http://dl-4.alpinelinux.org/alpine/edge/testing]\nOK: 7381 distinct packages available\n(1/2) Upgrading libcrypto1.0 (1.0.2i-r0 -&gt; 1.0.2j-r0)\n(2/2) Upgrading libssl1.0 (1.0.2i-r0 -&gt; 1.0.2j-r0)\nExecuting busybox-1.24.2-r11.trigger\nOK: 5 MiB in 12 packages\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz\nfetch http://dl-4.alpinelinux.org/alpine/edge/testing/x86_64/APKINDEX.tar.gz\n(1/63) Installing fakeroot (1.20.2-r3)\n(2/63) Installing sudo (1.8.16-r0)\n(3/63) Installing libcap (2.25-r0)\n(4/63) Installing pax-utils (1.1.6-r0)\n(5/63) Installing openssl (1.0.2j-r0)\n(6/63) Installing libattr (2.4.47-r4)\n(7/63) Installing attr (2.4.47-r4)\n(8/63) Installing tar (1.29-r0)\n(9/63) Installing pkgconf (0.9.12-r0)\n(10/63) Installing patch (2.7.5-r1)\n(11/63) Installing libssh2 (1.7.0-r0)\n(12/63) Installing libcurl (7.50.3-r0)\n(13/63) Installing curl (7.50.3-r0)\n(14/63) Installing abuild (2.27.1-r1)\nExecuting abuild-2.27.1-r1.pre-install\n(15/63) Installing binutils-libs (2.26-r0)\n(16/63) Installing binutils (2.26-r0)\n(17/63) Installing gmp (6.1.0-r0)\n(18/63) Installing isl (0.14.1-r0)\n(19/63) Installing libgomp (5.3.0-r0)\n(20/63) Installing libatomic (5.3.0-r0)\n(21/63) Installing libgcc (5.3.0-r0)\n(22/63) Installing pkgconfig (0.25-r1)\n(23/63) Installing mpfr3 (3.1.2-r0)\n(24/63) Installing mpc1 (1.0.3-r0)\n(25/63) Installing libstdc++ (5.3.0-r0)\n(26/63) Installing gcc (5.3.0-r0)\n(27/63) Installing make (4.1-r1)\n(28/63) Installing musl-dev (1.1.14-r12)\n(29/63) Installing libc-dev (0.7-r0)\n(30/63) Installing fortify-headers (0.8-r0)\n(31/63) Installing g++ (5.3.0-r0)\n(32/63) Installing build-base (0.4-r1)\n(33/63) Installing expat (2.1.1-r1)\n(34/63) Installing pcre (8.38-r1)\n(35/63) Installing git (2.8.3-r0)\n(36/63) Installing xz-libs (5.2.2-r1)\n(37/63) Installing lzo (2.09-r1)\n(38/63) Installing squashfs-tools (4.3-r2)\n(39/63) Installing libmagic (5.27-r0)\n(40/63) Installing file (5.27-r0)\n(41/63) Installing bzip2 (1.0.6-r5)\n(42/63) Installing libbz2 (1.0.6-r5)\n(43/63) Installing cdrkit (1.1.11-r2)\n(44/63) Installing acct (6.6.2-r0)\n(45/63) Installing lddtree (1.25-r2)\n(46/63) Installing libuuid (2.28-r3)\n(47/63) Installing libblkid (2.28-r3)\n(48/63) Installing device-mapper (2.02.154-r0)\n(49/63) Installing cryptsetup-libs (1.7.1-r0)\n(50/63) Installing kmod (22-r0)\n(51/63) Installing mkinitfs (3.0.5-r1)\nExecuting mkinitfs-3.0.5-r1.post-install\n(52/63) Installing mtools (4.0.18-r1)\n(53/63) Installing alpine-sdk (0.4-r3)\n(54/63) Installing ncurses-terminfo-base (6.0-r7)\n(55/63) Installing ncurses-terminfo (6.0-r7)\n(56/63) Installing ncurses-libs (6.0-r7)\n(57/63) Installing readline (6.3.008-r4)\n(58/63) Installing bash (4.3.42-r3)\nExecuting bash-4.3.42-r3.post-install\n(59/63) Installing libgit2-libs (0.24.1-r0)\n(60/63) Installing libgit2 (0.24.1-r0)\n(61/63) Installing openssh-client (7.2_p2-r3)\n(62/63) Installing openssh-sftp-server (7.2_p2-r3)\n(63/63) Installing openssh (7.2_p2-r3)\nExecuting busybox-1.24.2-r11.trigger\nExecuting ca-certificates-20160104-r4.trigger\nOK: 198 MiB in 75 packages\n ---&gt; f73132c8c72e\nRemoving intermediate container 7876608fa4e7\nStep 4 : RUN pkg-config --print-errors --exists libgit2\n ---&gt; Running in f69f97142e81\nPackage libgit2 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `libgit2.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'libgit2', required by 'world', not found\nThe command '/bin/sh -c pkg-config --print-errors --exists libgit2' returned a non-zero code: 1\n</code></pre>\n\n<p>So what is it that is wrong? Why it can not see the installed libgit2 (0.24.1-r0). I really tried every possible way to get this one package built and installed in my docker container and I can not simply do it. I have no idea what is wrong. Please help me.</p>\n\n<p>-------------- EDIT</p>\n\n<p>The last command in my Dockerfile is actually taken from here <a href=\"http://lists.subsurface-divelog.org/pipermail/subsurface/2014-November/015646.html\" rel=\"nofollow noreferrer\">http://lists.subsurface-divelog.org/pipermail/subsurface/2014-November/015646.html</a> </p>\n\n<p>And certainly the issue depicted there and the one that I have is not the same</p>\n\n<p>---------------- EDIT 2</p>\n\n<p>Anyone interested in doing the effort all by your self can follow this - </p>\n\n<pre><code>FROM golang:1.7-alpine\nENV TARGET venv\nRUN echo http://dl-4.alpinelinux.org/alpine/edge/testing &gt;&gt; /etc/apk/repositories\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git openssh alpine-sdk libcurl\nRUN apk update &amp;&amp; apk add cmake\nRUN git clone git://github.com/libgit2/libgit2.git\nWORKDIR $GOPATH/libgit2\nRUN git checkout v0.24.0 &amp;&amp; rm -rf build &amp;&amp; mkdir build &amp;&amp; cd build \\\n    &amp;&amp; cmake .. -DCMAKE_INSTALL_PREFIX=$TARGET -DBUILD_CLAR=OFF &amp;&amp; cmake --build . --target install\nENV PKG_CONFIG_PATH /go/libgit2/build/venv/lib/pkgconfig:$PKG_CONFIG_PATH\n</code></pre>\n\n<p>For a simpler and cleaner approach follow the accepted answer. This one only has the advantage of having libgit2 version which is not available via apk yet. </p>\n\n<p>One more thing - <code>-DBUILD_CLAR=OFF</code> is there because I did not want to install Python in the image just to run the tests</p>\n"}, {"tags": ["http", "go", "template-engine"], "comments": [{"owner": {"reputation": 88487, "user_id": 6508, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6baa1023a5f700292f7e9791311e7f7a?s=128&d=identicon&r=PG", "display_name": "Jorge Ferreira", "link": "https://stackoverflow.com/users/6508/jorge-ferreira"}, "edited": false, "score": 2, "creation_date": 1476206144, "post_id": 39982545, "comment_id": 67244413, "body": "Can you post the http handler?"}, {"owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "reply_to_user": {"reputation": 88487, "user_id": 6508, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6baa1023a5f700292f7e9791311e7f7a?s=128&d=identicon&r=PG", "display_name": "Jorge Ferreira", "link": "https://stackoverflow.com/users/6508/jorge-ferreira"}, "edited": false, "score": 0, "creation_date": 1476207903, "post_id": 39982545, "comment_id": 67245450, "body": "I&#39;m using httprouter.  Anything in particular?"}, {"owner": {"reputation": 583, "user_id": 1712816, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/dSk9M.jpg?s=128&g=1", "display_name": "tuck", "link": "https://stackoverflow.com/users/1712816/tuck"}, "edited": false, "score": 3, "creation_date": 1476208757, "post_id": 39982545, "comment_id": 67245956, "body": "If you can post at least all the code that leads to this path would help. There is a change the connection is not closed. Can you start a playground that we can take a look at. <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1476209779, "post_id": 39982545, "comment_id": 67246525, "body": "That last post most definitely does not suggest that this is expected (it&#39;s really unrelated to your question at all). First run your code with the race detector. You should never see a panic, especially a <code>slice bounds out of range</code> error. (please don&#39;t handle simple errors with a panic either)"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1476266024, "post_id": 39982545, "comment_id": 67269038, "body": "Isn&#39;t that a normal behavior ? If, while the server sends data back to the client, the connection closes, it&#39;s normal to stop the process of rendering isn&#39;t it ? (And I agree with the above comment, don&#39;t use panic for such simple errors)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1476287874, "post_id": 39982545, "comment_id": 67284085, "body": "@Depado: yes, if the client disconnects during the request, then write errors can be expected, but this is a short lived request over localhost, and there&#39;s no indication in the question that the client should be dropping connections. Plus a panic is <i>never</i> expected, and is an indication that there is a programming error involved."}, {"owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "edited": false, "score": 0, "creation_date": 1476287909, "post_id": 39982545, "comment_id": 67284112, "body": "Using factorlog in this particular project. Bad idea to pretend to use panic.  I&#39;m really thinking this was proper behavior and these &quot;errors&quot; (except the last one) are caused by &quot;incorrect&quot; ajax requests."}, {"owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "edited": false, "score": 0, "creation_date": 1519201903, "post_id": 39982545, "comment_id": 84807776, "body": "My ajax code was closing the http connection."}], "owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1496, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1476208464, "creation_date": 1476204684, "last_edit_date": 1495540379, "question_id": 39982545, "link": "https://stackoverflow.com/questions/39982545/golang-executetemplate-results-in-errror-write-tcp-127-0-0-18080-127-0-0-1", "title": "Golang : ExecuteTemplate results in errror: `write tcp 127.0.0.1:8080-&gt;127.0.0.1:35212: write: broken pipe` with multiple requests", "body": "<p>I have something like this:</p>\n\n<pre><code>t, err1 := template.ParseFiles(\"exampleFile.tmpl\")\nif err1 != nil {\n    panic(err1)\n}\nerr2 := t.ExecuteTemplate(w, \"example\", someStruct)\nif err2 != nil {\n    panic(err2)\n}\n</code></pre>\n\n<p>With simple requests, there are no problems. </p>\n\n<p>But if I send two requests very close to each other, about 40% of the time from simple page refreshes from Chrome and a few ajax requests, it results in various different errors (err2): </p>\n\n<ul>\n<li><code>write tcp 127.0.0.1:8080-&gt;127.0.0.1:35212: write: broken pipe</code></li>\n<li><code>write: connection reset by peer</code></li>\n<li><code>use of closed network connection</code></li>\n<li><code>http: panic serving 127.0.0.1:35814: runtime error: slice bounds out of range\ngoroutine 340 (...)</code></li>\n</ul>\n\n<p>Others seem to have had similar issues, but with no clear resolution.  </p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/26853200/filter-out-broken-pipe-errors-from-template-execution\">Filter out broken pipe errors from template execution</a></li>\n<li><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/g6UNu4Mrv28\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/g6UNu4Mrv28</a></li>\n</ul>\n\n<p>Another post seems to suggest just to expect this, and retry failed requests:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/31409281/1923095\">https://stackoverflow.com/a/31409281/1923095</a></li>\n</ul>\n\n<p>What's the best Golang way to handle this?  </p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 18203, "user_id": 100731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/056c32203f8017f075ac060069823b66?s=128&d=identicon&r=PG", "display_name": "phoet", "link": "https://stackoverflow.com/users/100731/phoet"}, "edited": false, "score": 0, "creation_date": 1476215338, "post_id": 39982526, "comment_id": 67249745, "body": "looking into the implementation of <code>c.PostForm()</code> i assume that the <code>PostForm</code> has not been parsed and thus might not contain any value <a href=\"https://github.com/gin-gonic/gin/blob/develop/context.go#L264-L276\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/blob/develop/context.go#L264-L276</a>"}, {"owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "reply_to_user": {"reputation": 18203, "user_id": 100731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/056c32203f8017f075ac060069823b66?s=128&d=identicon&r=PG", "display_name": "phoet", "link": "https://stackoverflow.com/users/100731/phoet"}, "edited": false, "score": 0, "creation_date": 1476219606, "post_id": 39982526, "comment_id": 67252082, "body": "@phoet - Kind of looks like that... but shouldn&#39;t <code>ParseForm()</code> call parse?  What&#39;s the fix?  Do I need to call <code>ParseMultipartForm</code> instead?"}], "answers": [{"tags": [], "owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "is_accepted": false, "score": 0, "last_activity_date": 1476293782, "creation_date": 1476293782, "answer_id": 40004937, "question_id": 39982526, "link": "https://stackoverflow.com/questions/39982526/iterate-through-all-postform-values-gin-gonic/40004937#40004937", "title": "Iterate through all PostForm values Gin Gonic", "body": "<p>Issue here was the form (not shown) was a multipart form.  <code>ParseForm</code> does not parse multipart forms, and thus, no data.  The fix is to call <code>ParseMultipartForm</code> instead.  Thanks to @phoet for pointing at the method in Gin Gonic for PostForm (which calls <code>ParseMultipartForm</code> for you, and does so automatically), which helped lead me to the answer.</p>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 2386761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b40573f66a7ee0d6168859e91d682b4d?s=128&d=identicon&r=PG", "display_name": "Fernando Leal", "link": "https://stackoverflow.com/users/2386761/fernando-leal"}, "is_accepted": true, "score": 3, "last_activity_date": 1586387037, "creation_date": 1586387037, "answer_id": 61111410, "question_id": 39982526, "link": "https://stackoverflow.com/questions/39982526/iterate-through-all-postform-values-gin-gonic/61111410#61111410", "title": "Iterate through all PostForm values Gin Gonic", "body": "<p>We also needed something like @BadPirate describes so if anyone need for gin 1.6.2</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func register(c *gin.Context){\n    c.MultipartForm()\n    for key, value := range c.Request.PostForm {\n        log.Printf(\"%v = %v \\n\",key,value)\n    }\n}\n</code></pre>\n\n<p>Thanks @BadPirate and @phoet for the info. </p>\n"}], "owner": {"reputation": 24641, "user_id": 285694, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6af708e77a9683635ee600ced1bdac00?s=128&d=identicon&r=PG", "display_name": "BadPirate", "link": "https://stackoverflow.com/users/285694/badpirate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1261, "favorite_count": 1, "accepted_answer_id": 61111410, "answer_count": 2, "score": 3, "last_activity_date": 1586387037, "creation_date": 1476204617, "last_edit_date": 1489365235, "question_id": 39982526, "link": "https://stackoverflow.com/questions/39982526/iterate-through-all-postform-values-gin-gonic", "title": "Iterate through all PostForm values Gin Gonic", "body": "<p>Is there an easy way to list / iterate through all post values using Gin Gonic? (Go)</p>\n\n<p>I have tried:</p>\n\n<pre><code>c.Request.ParseForm()\nfor key, value := range c.Request.PostForm {\n    log.Printf(\"POST %v = %v\",key,value)\n}\n</code></pre>\n\n<p>But this shows no values, however when I test the values directly from context:</p>\n\n<pre><code>log.Printf(\"POST email = %v\", c.PostForm(\"email\")\n</code></pre>\n\n<p>It outputs fine.</p>\n\n<p>What I'm trying to do is to map all post values into a gin.H{} context, so that upon failure I can pass the posted values back into the .HTML template context and have them prefilled (along with my error message).  Best I've found is manually wiring each POST value to the gin.H{} map, but for a large form these seems verbose and not ideal.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476200320, "post_id": 39980902, "comment_id": 67240849, "body": "The error your printing says <code>packets.go:33: unexpected EOF</code>, what is line 33 in packets.go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476200814, "post_id": 39980902, "comment_id": 67241201, "body": "The source of the error isn&#39;t in the code you&#39;ve posted, but <code>GetConnection</code> never assigns a value to the global <code>connection</code> variable. Is it supposed to?"}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476201010, "post_id": 39980902, "comment_id": 67241334, "body": "I didn&#39;t even catch that. I&#39;ve edited."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476203954, "post_id": 39980902, "comment_id": 67243204, "body": "so, the error is coming from <code>mc.buf.readNext</code>, what is that? It would really help to have a full example here.  Either the connection is closing early, or the data is shorter than you expect for some reason. Since you say it&#39;s random, I would guess it&#39;s former. The other thing you should do with &quot;random&quot; problems, it to make sure you test with the race detector."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476204199, "post_id": 39980902, "comment_id": 67243329, "body": "Is there any hard in this message for the time being? Or, if the connection closes early and makes a db request, does it throw that error and just open back up?"}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476204246, "post_id": 39980902, "comment_id": 67243353, "body": "I have no idea what &quot;mc.buf.readNext&quot; is. That&#39;s not my code, it&#39;s in the mysql package."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476204834, "post_id": 39980902, "comment_id": 67243691, "body": "Check out my edit. Would this work? Checking to see if the connection is still alive with connection.Ping() and if an error is thrown reset the connection?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476206021, "post_id": 39980902, "comment_id": 67244356, "body": "Sorry, I assumed the log line you posted was coming from your code. Are you saying that there is no error in your code, and this is just getting logged? Then the original fix to assign the global <code>connection</code> may have taken care of your problem, since <code>sql.Open</code> should only be called once.  The server is closing connections for some reason, maybe because you have too many open. You should also set a sane limit with <code>SetMaxOpenConns</code>"}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476207166, "post_id": 39980902, "comment_id": 67245022, "body": "Yes, that is correct. There is no error in my code. I&#39;ve added SetMaxOpenConns(10) in addition to my initial edit and it is still giving me the error."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476208901, "post_id": 39980902, "comment_id": 67246058, "body": "@JimB look at my latest edit. I added a few Println&#39;s and look at my console output right when I get that error. That makes me even more confused because it&#39;s saying my connection was active the entire time."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476209012, "post_id": 39980902, "comment_id": 67246131, "body": "<code>sql.Open</code> returns a <code>*sql.DB</code>, which is a connection <i>pool</i>, your <code>connection</code> variable doesn&#39;t correspond to a single TCP connection."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476209138, "post_id": 39980902, "comment_id": 67246189, "body": "What update to my code do you recommend?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476211548, "post_id": 39980902, "comment_id": 67247576, "body": "You haven&#39;t shown any of the code that interacts with the DB, so there&#39;s not much we can do without an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476212303, "post_id": 39980902, "comment_id": 67248051, "body": "The only thing my code is doing is calling connection.QueryRow and passing in a query string. That&#39;s it. Sometimes it throws the error and other times it doesn&#39;t. The error comes some time in the QueryRow function as I have printed out things before and after before the row is scanned into a struct. It doesn&#39;t make any sense. But, that is literally all I&#39;m doing. And if I&#39;m not using the sql.DB correctly you could shed some light on how I could update my code."}, {"owner": {"reputation": 1724, "user_id": 1230559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/cac803f8fb5f55281c2c0f0f9e17ea4d?s=128&d=identicon&r=PG", "display_name": "city", "link": "https://stackoverflow.com/users/1230559/city"}, "edited": false, "score": 0, "creation_date": 1486578222, "post_id": 39980902, "comment_id": 71409742, "body": "I got the same error: [mysql] 2017/02/08 16:31:56 packets.go:33: unexpected EOF [mysql] 2017/02/08 16:31:56 packets.go:130: write tcp 127.0.0.1:49188-&gt;127.0.0.1:3306: write: broken pipe  -- this error happened after there is no request sent to server within 10 hours. Not sure whether it&#39;s related to <a href=\"https://github.com/go-sql-driver/mysql/issues/257\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql/issues/257</a>"}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "edited": false, "score": 1, "creation_date": 1486605859, "post_id": 39980902, "comment_id": 71421926, "body": "Did you try setting the number of idle connections to 0?"}], "answers": [{"comments": [{"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1511263353, "post_id": 42146536, "comment_id": 81776965, "body": "I am also getting the same error. but setting <code>MaxIdleConnections to be 0</code> didn&#39;t work for me. <code>https:&#47;&#47;stackoverflow.com&#47;questions&#47;47406876&#47;unexpected-eof-&zwnj;&#8203;and-busy-buffer-in-g&zwnj;&#8203;o-sql-driver-mysql-p&zwnj;&#8203;ackets-go</code>"}, {"owner": {"reputation": 109, "user_id": 1848279, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7d0c7ace50131411d37795b17894d1f5?s=128&d=identicon&r=PG", "display_name": "TaoJS", "link": "https://stackoverflow.com/users/1848279/taojs"}, "edited": false, "score": 2, "creation_date": 1556978991, "post_id": 42146536, "comment_id": 98615882, "body": "The best solution we have is disable pooling? I&#39;m not okay with this. I will update once I find something  better."}], "tags": [], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "is_accepted": true, "score": 3, "last_activity_date": 1486673166, "creation_date": 1486673166, "answer_id": 42146536, "question_id": 39980902, "link": "https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof/42146536#42146536", "title": "Golang MySQL error - packets.go:33: unexpected EOF", "body": "<p>Looks like the link to the <a href=\"https://github.com/go-sql-driver/mysql/issues/257\" rel=\"nofollow noreferrer\">github issue</a> provided the fix. The fix, at least for my situation was setting the <strong>MaxIdleConnections</strong> to 0. I have kept a server up for 24 hours, running queries against it every several hours and have yet to reproduce the error.</p>\n\n<p>Thanks to @city for the link.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12359618, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/7bbb0736b32dbecfdec3878132ec56b9?s=128&d=identicon&r=PG", "display_name": "user12359618", "link": "https://stackoverflow.com/users/12359618/user12359618"}, "is_accepted": false, "score": 0, "last_activity_date": 1576838491, "creation_date": 1576838491, "answer_id": 59423886, "question_id": 39980902, "link": "https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof/59423886#59423886", "title": "Golang MySQL error - packets.go:33: unexpected EOF", "body": "<p>DSN adds net_write_timeout option</p>\n\n<pre><code>root:root@tcp(localhost:3306)/prod?net_write_timeout=6000\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 1, "creation_date": 1611196838, "post_id": 64966815, "comment_id": 116375661, "body": "it works in my end too"}], "tags": [], "owner": {"reputation": 165, "user_id": 10534470, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LfcIWrf_Eqk/AAAAAAAAAAI/AAAAAAAAVVw/3QXNF9eZNwc/photo.jpg?sz=128", "display_name": "Eshaan Bansal", "link": "https://stackoverflow.com/users/10534470/eshaan-bansal"}, "is_accepted": false, "score": 1, "last_activity_date": 1606128073, "creation_date": 1606128073, "answer_id": 64966815, "question_id": 39980902, "link": "https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof/64966815#64966815", "title": "Golang MySQL error - packets.go:33: unexpected EOF", "body": "<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;database/sql&quot;\n    &quot;time&quot;\n)\n//..snip...\ndb, err = sql.Open(&quot;mysql&quot;, url)\ndb.SetConnMaxLifetime(time.Minute * 4) // &lt;-- this\n</code></pre>\n<p>did it for me. Explanation: <a href=\"https://github.com/go-sql-driver/mysql/issues/674#issuecomment-345661869\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11883, "favorite_count": 3, "accepted_answer_id": 42146536, "answer_count": 3, "score": 6, "last_activity_date": 1606128073, "creation_date": 1476199461, "last_edit_date": 1476208837, "question_id": 39980902, "link": "https://stackoverflow.com/questions/39980902/golang-mysql-error-packets-go33-unexpected-eof", "title": "Golang MySQL error - packets.go:33: unexpected EOF", "body": "<p>I am switching my entire code base from PHP to Go and during several processes that run, I randomly get this error:</p>\n\n<pre><code>[mysql] 2016/10/11 09:17:16 packets.go:33: unexpected EOF\n</code></pre>\n\n<p>Here is my db package that handles all connections to the database:</p>\n\n<pre><code>package db\n\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"pkg/db\"\n)\n\nvar connection *sql.DB\nvar err error\n\nfunc GetConnection() *sql.DB {\n    if connection != nil {\n        fmt.Println(\"********** CHECKING PING\")\n        err = connection.Ping()\n        if err == nil {\n            fmt.Println(\"************ CONNECTION STILL ACTIVE\")\n            return connection\n        } else {\n            fmt.Println(\"********** PING ERROR: \" + err.Error())\n        }\n    }\n\n    connection, err = sql.Open(\"mysql\", db.DEVUSER + \":\" + db.DEVUSER_PASSWORD + \"@tcp(localhost:3306)/main?parseTime=true\")\n    if err != nil {\n        panic(err)\n    }\n\n    return connection\n}\n</code></pre>\n\n<p>Is there anything I'm doing wrong with this db package that causes this error to be thrown? What exactly does this error mean? I make sure to return the current connection if there is one open so for multiple requests it uses the same connection object. </p>\n\n<p>Here's an excerpt from the mysql packets.go:</p>\n\n<pre><code>// Read packet to buffer 'data'\nfunc (mc *mysqlConn) readPacket() ([]byte, error) {\n    var payload []byte\n    for {\n        // Read packet header\n        data, err := mc.buf.readNext(4)\n        if err != nil {\n            errLog.Print(err)\n            mc.Close()\n            return nil, driver.ErrBadConn\n        }\n\n        // Packet Length [24 bit]\n        pktLen := int(uint32(data[0]) | uint32(data[1])&lt;&lt;8 | uint32(data[2])&lt;&lt;16)\n\n        if pktLen &lt; 1 {\n            errLog.Print(ErrMalformPkt)\n            mc.Close()\n            return nil, driver.ErrBadConn\n        }\n\n        // Check Packet Sync [8 bit]\n        if data[3] != mc.sequence {\n            if data[3] &gt; mc.sequence {\n                return nil, ErrPktSyncMul\n            }\n            return nil, ErrPktSync\n        }\n        mc.sequence++\n\n        // Read packet body [pktLen bytes]\n        data, err = mc.buf.readNext(pktLen)\n        if err != nil {\n            errLog.Print(err)\n            mc.Close()\n            return nil, driver.ErrBadConn\n        }\n\n        isLastPacket := (pktLen &lt; maxPacketSize)\n\n        // Zero allocations for non-splitting packets\n        if isLastPacket &amp;&amp; payload == nil {\n            return data, nil\n        }\n\n        payload = append(payload, data...)\n\n        if isLastPacket {\n            return payload, nil\n        }\n    }\n}\n</code></pre>\n\n<p>The first \"errLog.Print(err)\" is line 33 in the \"Read packet header\" section.</p>\n\n<p>Any help is greatly appreciated!</p>\n\n<p>I added a few log.Println to the connection package and let the process run, and right where I get this error, this is what the console prints:</p>\n\n<pre><code>********** CHECKING PING\n************ CONNECTION STILL ACTIVE\n[mysql] 2016/10/11 11:57:27 packets.go:33: unexpected EOF\n********** CHECKING PING\n************ CONNECTION STILL ACTIVE\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1476198430, "creation_date": 1476198430, "answer_id": 39980504, "question_id": 39979956, "link": "https://stackoverflow.com/questions/39979956/golang-exerciseimages-missing-at-method/39980504#39980504", "title": "golang exercise:images missing at method", "body": "<p>Your type <code>Image</code> does not implement the <code>At</code> method. If you want your type to inherit the methods implemented by <code>*image.RGBA</code>, use an anonymous field:</p>\n\n<pre><code>type Image struct{\n     *image.RGBA   \n}\n</code></pre>\n\n<p>See <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#embedding</a>.</p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 39980504, "answer_count": 1, "score": 0, "last_activity_date": 1476198430, "creation_date": 1476196986, "question_id": 39979956, "link": "https://stackoverflow.com/questions/39979956/golang-exerciseimages-missing-at-method", "title": "golang exercise:images missing at method", "body": "<p>I am wokring through the exercise:images at <a href=\"https://tour.golang.org/methods/25\" rel=\"nofollow\">https://tour.golang.org/methods/25</a> and I have run into a problem. Here is my code...</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/tour/pic\"\n    \"image\"\n)\n\ntype Image struct{\n    image *image.RGBA   \n}\n\nfunc main() {\n    rect := image.Rect(0,0,255,255)\n    myImage := image.NewRGBA(rect)\n    m := Image{myImage}\n    pic.ShowImage(m)\n}\n</code></pre>\n\n<p>it gives me the error...</p>\n\n<pre><code>tmp/sandbox089594299/main.go:16: cannot use m (type Image) as type image.Image in argument to pic.ShowImage:\nImage does not implement image.Image (missing At method)\n</code></pre>\n\n<p>But <code>image.NewRGBA</code> returns a <code>*NRGBA</code> and that does indeed have an <code>At()</code> method. Also I assume since the <code>At()</code> method is the last method required by the <code>image.Image</code> interface then it is finding the other two required methods...so what is up with the <code>At()</code>?</p>\n\n<p>image.NRGBA: <a href=\"https://golang.org/pkg/image/#NRGBA\" rel=\"nofollow\">https://golang.org/pkg/image/#NRGBA</a></p>\n\n<p>image.Image interface: <a href=\"https://golang.org/pkg/image/#Image\" rel=\"nofollow\">https://golang.org/pkg/image/#Image</a></p>\n"}, {"tags": ["encryption", "go", "pgp", "openpgp"], "comments": [{"owner": {"reputation": 170, "user_id": 2859891, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/aea1cbf521eb982eb9ab0c3b4db06b3b?s=128&d=identicon&r=PG&f=1", "display_name": "nicwhitts", "link": "https://stackoverflow.com/users/2859891/nicwhitts"}, "edited": false, "score": 0, "creation_date": 1501632610, "post_id": 39979701, "comment_id": 77860086, "body": "Did you ever get this working?"}, {"owner": {"reputation": 3488, "user_id": 52439, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/OmhO0.png?s=128&g=1", "display_name": "cg.", "link": "https://stackoverflow.com/users/52439/cg"}, "reply_to_user": {"reputation": 170, "user_id": 2859891, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/aea1cbf521eb982eb9ab0c3b4db06b3b?s=128&d=identicon&r=PG&f=1", "display_name": "nicwhitts", "link": "https://stackoverflow.com/users/2859891/nicwhitts"}, "edited": false, "score": 0, "creation_date": 1501699736, "post_id": 39979701, "comment_id": 77898431, "body": "No, in the end we dropped the idea of using Go as a language for that project altogether."}, {"owner": {"reputation": 170, "user_id": 2859891, "user_type": "registered", "accept_rate": 37, "profile_image": "https://www.gravatar.com/avatar/aea1cbf521eb982eb9ab0c3b4db06b3b?s=128&d=identicon&r=PG&f=1", "display_name": "nicwhitts", "link": "https://stackoverflow.com/users/2859891/nicwhitts"}, "edited": false, "score": 0, "creation_date": 1501699881, "post_id": 39979701, "comment_id": 77898507, "body": ":/ I found another library which I&#39;m using solely for generating keys, and go for everything else."}, {"owner": {"reputation": 6086, "user_id": 914967, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7500194166646eb28af858f0374bd744?s=128&d=identicon&r=PG", "display_name": "shawnzhu", "link": "https://stackoverflow.com/users/914967/shawnzhu"}, "edited": false, "score": 0, "creation_date": 1575857642, "post_id": 39979701, "comment_id": 104694636, "body": "is this example good enough? I just searched on github: <a href=\"https://gist.github.com/jonatasnona/6b4ed853af7c8fc7ced5f6213c5acbac\" rel=\"nofollow noreferrer\">gist.github.com/jonatasnona/6b4ed853af7c8fc7ced5f6213c5acbac</a>"}], "owner": {"reputation": 3488, "user_id": 52439, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/OmhO0.png?s=128&g=1", "display_name": "cg.", "link": "https://stackoverflow.com/users/52439/cg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1476200309, "creation_date": 1476196311, "last_edit_date": 1495540381, "question_id": 39979701, "link": "https://stackoverflow.com/questions/39979701/how-do-i-create-an-encrypted-openpgp-private-key-in-go", "title": "How do I create an encrypted OpenPGP private key in Go?", "body": "<p>I would like to generate OpenPGP key pairs and encrypt them using 'passphrases' before exporting them. I would like to do so in Go, using its <a href=\"https://godoc.org/golang.org/x/crypto/openpgp\" rel=\"nofollow noreferrer\">openpgp package</a>. So far I have generated key pairs, exported them and successfully imported the public keys in GnuPG for encryption, using the simple wrapper linked <a href=\"https://stackoverflow.com/a/39626592/52439\">here</a>.</p>\n\n<p>I still need to <strong>encrypt the private keys using 'passphrases'</strong> before exporting them in ASCII armor though. Could someone please provide me with an example or some hint on how to do this?</p>\n"}, {"tags": ["arrays", "json", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 563, "user_id": 6345027, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3ee7df5d6dd1ce4a7e9b10ad203e333a?s=128&d=identicon&r=PG&f=1", "display_name": "Colleen Larsen", "link": "https://stackoverflow.com/users/6345027/colleen-larsen"}, "edited": false, "score": 0, "creation_date": 1476188664, "post_id": 39977086, "comment_id": 67232955, "body": "You are awesome"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1476188319, "creation_date": 1476188319, "answer_id": 39977086, "question_id": 39977034, "link": "https://stackoverflow.com/questions/39977034/how-to-give-a-json-array-an-identifier-in-golang/39977086#39977086", "title": "How to give a Json array an Identifier in golang", "body": "<p>Wrap the slice with a struct to add the JSON object with \"posts\" field:</p>\n\n<pre><code>data := struct { \n   Posts []models.Post `json:\"posts\"`\n}{\n   Posts: posts\n}\np, err := json.Marshal(&amp;data)\n</code></pre>\n\n<p>An alternative is to wrap the slice with a map:</p>\n\n<pre><code>p, err := json.Marshal(map[string]interface{}{\"posts\": posts})\n</code></pre>\n"}], "owner": {"reputation": 563, "user_id": 6345027, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3ee7df5d6dd1ce4a7e9b10ad203e333a?s=128&d=identicon&r=PG&f=1", "display_name": "Colleen Larsen", "link": "https://stackoverflow.com/users/6345027/colleen-larsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 39977086, "answer_count": 1, "score": 0, "last_activity_date": 1476188325, "creation_date": 1476188129, "last_edit_date": 1476188325, "question_id": 39977034, "link": "https://stackoverflow.com/questions/39977034/how-to-give-a-json-array-an-identifier-in-golang", "title": "How to give a Json array an Identifier in golang", "body": "<p>I am trying to create a JSON array in Go with a struct using <code>json.Marshall</code> however I cant seem to get the desired result here is the slice of structs I am working with.</p>\n\n<pre><code>posts := []models.Post{\n    models.Post{Id: 1,MediaUrl:\"...\", Title: \"...\", Slug: \"...\", ShortDescription : \"...\", Content : \"...\"},\n    models.Post{Id: 2,MediaUrl:\"...\", Title: \"...\", Slug: \"...\", ShortDescription : \"...\", Content : \"...\"},\n}\n</code></pre>\n\n<p>And I am trying to marshall it into a struct that looks like</p>\n\n<pre><code>{\"posts\":[{\"Id\": 1,...},{\"Id\": 2,...}]}\n</code></pre>\n\n<p>But I am stuck at </p>\n\n<pre><code>[{\"Id\":1,...},{\"Id\": 2,...}]\n</code></pre>\n\n<p>I dont know how to get the additional <code>{\"posts\":..}</code> around the json array.\nHow do I add this additional identifier to the json array?\nThanks</p>\n"}, {"tags": ["sqlite", "go", "beego"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 4115763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtV8W.jpg?s=128&g=1", "display_name": "Master Sketchiggle", "link": "https://stackoverflow.com/users/4115763/master-sketchiggle"}, "edited": false, "score": 0, "creation_date": 1476189100, "post_id": 39977040, "comment_id": 67233214, "body": "Ahhh. silly rookie mistake, the issue seemed to be not dealing with error.  Thanks."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 0, "last_activity_date": 1476188151, "creation_date": 1476188151, "answer_id": 39977040, "question_id": 39976949, "link": "https://stackoverflow.com/questions/39976949/beego-raw-sql-type-conversion-issue/39977040#39977040", "title": "Beego raw sql - Type conversion issue", "body": "<p><a href=\"https://golang.org/pkg/strconv/#Atoi\" rel=\"nofollow\">strconv.Atoi</a> has a signature of:</p>\n\n<pre><code>func Atoi(s string) (int, error)\n</code></pre>\n\n<p>you should check the error before using the result, like so:</p>\n\n<pre><code>var maps []orm.Params\n//Pallets Completed already.\no.Raw(\"Select SUM(Things) as AllTheThings FROM SomeTable\").Values(&amp;maps)\n\nnumThings, err := strconv.Atoi(maps[0][\"AllTheThings\"].(string))\nif err != nil {\n    // couldn't convert\n}\n\nc.Data[\"Stuff\"] = maps[0][\"AllTheThings\"]\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 4115763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gtV8W.jpg?s=128&g=1", "display_name": "Master Sketchiggle", "link": "https://stackoverflow.com/users/4115763/master-sketchiggle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 39977040, "answer_count": 1, "score": 0, "last_activity_date": 1476188151, "creation_date": 1476187845, "question_id": 39976949, "link": "https://stackoverflow.com/questions/39976949/beego-raw-sql-type-conversion-issue", "title": "Beego raw sql - Type conversion issue", "body": "<p>Here is the code used inside the Beego MVC architecture.</p>\n\n<pre><code>var maps []orm.Params\n//Pallets Completed already.\no.Raw(\"Select SUM(Things) as AllTheThings FROM SomeTable\").Values(&amp;maps)\n\nnumThings := strconv.Atoi(maps[0][\"AllTheThings\"].(string))\n\nc.Data[\"Stuff\"] = maps[0][\"AllTheThings\"]\n</code></pre>\n\n<p>Error:\nmultiple-value strconv.Atoi() in single-value context </p>\n\n<p>Trying to figure out how I can get data out with our ORM and type cast it so arithmetic can be done on it.</p>\n\n<p>Any more details please let me know.</p>\n"}, {"tags": ["go", "middleware"], "answers": [{"comments": [{"owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1476271391, "post_id": 39990486, "comment_id": 67272422, "body": "doing this leads to an error: cannot use func1 (type func(http.ResponseWriter, *http.Request)) as type http.Handler in argument to alice.New(m1, m2, m3).Then"}, {"owner": {"reputation": 397, "user_id": 992058, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/aef573436082d96d0e5a9a9335800e93?s=128&d=identicon&r=PG", "display_name": "michael60612", "link": "https://stackoverflow.com/users/992058/michael60612"}, "reply_to_user": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "edited": false, "score": 0, "creation_date": 1476285835, "post_id": 39990486, "comment_id": 67282565, "body": "@user6638204 you have to wrap your function in an <code>http.HandlerFunc</code> ala <code>.Then(http.HandlerFunc(func1))</code>"}], "tags": [], "owner": {"reputation": 397, "user_id": 992058, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/aef573436082d96d0e5a9a9335800e93?s=128&d=identicon&r=PG", "display_name": "michael60612", "link": "https://stackoverflow.com/users/992058/michael60612"}, "is_accepted": true, "score": 1, "last_activity_date": 1476246139, "creation_date": 1476246139, "answer_id": 39990486, "question_id": 39974880, "link": "https://stackoverflow.com/questions/39974880/how-to-use-different-middlewares-for-different-paths-in-go/39990486#39990486", "title": "How to use different middlewares for different paths in GO?", "body": "<p>You need to let set the handlers for <code>router</code> and <code>router</code> to the returned chain from <code>alice</code>.</p>\n\n<pre><code>// define routers\nrouter := mux.NewRouter() // assuming this is gorilla mux\nrouter2 := mux.NewRouter()\n\n// create alice chains\nchain1 := alice.New(m1, m2, m3).Then(func1)\nchain2 := alice.New(m1, m2).Then(func2)\n\n// set chains as path handlers\nrouter.HandleFunc(path1, chain1)\nrouter2.HandleFunc(path2, chain2)\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "accepted_answer_id": 39990486, "answer_count": 1, "score": 0, "last_activity_date": 1476246139, "creation_date": 1476180305, "last_edit_date": 1476184045, "question_id": 39974880, "link": "https://stackoverflow.com/questions/39974880/how-to-use-different-middlewares-for-different-paths-in-go", "title": "How to use different middlewares for different paths in GO?", "body": "<p>Hi I am using <a href=\"https://github.com/justinas/alice\" rel=\"nofollow\">justinas/alice</a>, and I want to create different middlewares based on paths. i.e if I have path1 and path2, I want to apply m1,m2,m3 for path 1 and m1,m2 for path 2</p>\n\n<p>I tried:</p>\n\n<ul>\n<li>Creating two mux routers first: </li>\n</ul>\n\n<p><code>router := mux.NewRouter()\nrouter2 := mux.NewRouter()</code></p>\n\n<ul>\n<li>Assign the paths to them:</li>\n</ul>\n\n<p><code>router.HandleFunc(path1,Func1)\n router2.HandleFunc(path2,Func2)\n</code></p>\n\n<ul>\n<li>Then I wanted to have something like this</li>\n</ul>\n\n<p><code>middlewares:=alice.New(m1,m2).Then(router2)\n middlewaress:=middlewares.Append(middlewares)\n</code>\n - Then:</p>\n\n<pre><code>if err := http.ListenAndServe(fmt.Sprintf(\":%d\", sconf.Server.Port), middlewaress); err != nil {\n\n    }\n</code></pre>\n\n<p>how can I do something like this?</p>\n"}, {"tags": ["json", "go", "reddit"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 5988785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/76db4835d03cf2ecd09d36a7efa34fdb?s=128&d=identicon&r=PG", "display_name": "calmeishmael", "link": "https://stackoverflow.com/users/5988785/calmeishmael"}, "edited": false, "score": 0, "creation_date": 1476205939, "post_id": 39972930, "comment_id": 67244306, "body": "Thanks for answering. The tool seems very useful and will certainly help in the future working with JSON. Thanks again."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 0, "last_activity_date": 1476173355, "creation_date": 1476173355, "answer_id": 39972930, "question_id": 39972367, "link": "https://stackoverflow.com/questions/39972367/unmarshalling-complex-json/39972930#39972930", "title": "Unmarshalling Complex Json", "body": "<p>It seems like the JSON you are trying to unmarshal is over complex, so your struct has to be complex, but that's the way it goes. </p>\n\n<p>There are a few tools that generate struct definitions from a JSON, and that saves a ton of work. Using the JSON you posted and <a href=\"https://jsonformatter.curiousconcept.com/\" rel=\"nofollow\">such an online tool</a>, I generated the following struct:</p>\n\n<pre><code>package main\n\ntype MyJsonName struct {\n    Data struct {\n        After    string      `json:\"after\"`\n        Before   interface{} `json:\"before\"`\n        Children []struct {\n            Data struct {\n                ApprovedBy          interface{}   `json:\"approved_by\"`\n                Archived            bool          `json:\"archived\"`\n                Author              string        `json:\"author\"`\n                AuthorFlairCSSClass string        `json:\"author_flair_css_class\"`\n                AuthorFlairText     interface{}   `json:\"author_flair_text\"`\n                BannedBy            interface{}   `json:\"banned_by\"`\n                Clicked             bool          `json:\"clicked\"`\n                ContestMode         bool          `json:\"contest_mode\"`\n                Created             int           `json:\"created\"`\n                CreatedUtc          int           `json:\"created_utc\"`\n                Distinguished       string        `json:\"distinguished\"`\n                Domain              string        `json:\"domain\"`\n                Downs               int           `json:\"downs\"`\n                Edited              bool          `json:\"edited\"`\n                Gilded              int           `json:\"gilded\"`\n                Hidden              bool          `json:\"hidden\"`\n                HideScore           bool          `json:\"hide_score\"`\n                ID                  string        `json:\"id\"`\n                IsSelf              bool          `json:\"is_self\"`\n                Likes               interface{}   `json:\"likes\"`\n                LinkFlairCSSClass   string        `json:\"link_flair_css_class\"`\n                LinkFlairText       string        `json:\"link_flair_text\"`\n                Locked              bool          `json:\"locked\"`\n                Media               interface{}   `json:\"media\"`\n                MediaEmbed          struct{}      `json:\"media_embed\"`\n                ModReports          []interface{} `json:\"mod_reports\"`\n                Name                string        `json:\"name\"`\n                NumComments         int           `json:\"num_comments\"`\n                NumReports          interface{}   `json:\"num_reports\"`\n                Over18              bool          `json:\"over_18\"`\n                Permalink           string        `json:\"permalink\"`\n                Quarantine          bool          `json:\"quarantine\"`\n                RemovalReason       interface{}   `json:\"removal_reason\"`\n                ReportReasons       interface{}   `json:\"report_reasons\"`\n                Saved               bool          `json:\"saved\"`\n                Score               int           `json:\"score\"`\n                SecureMedia         interface{}   `json:\"secure_media\"`\n                SecureMediaEmbed    struct{}      `json:\"secure_media_embed\"`\n                Selftext            string        `json:\"selftext\"`\n                SelftextHTML        string        `json:\"selftext_html\"`\n                Stickied            bool          `json:\"stickied\"`\n                Subreddit           string        `json:\"subreddit\"`\n                SubredditID         string        `json:\"subreddit_id\"`\n                SuggestedSort       interface{}   `json:\"suggested_sort\"`\n                Thumbnail           string        `json:\"thumbnail\"`\n                Title               string        `json:\"title\"`\n                Ups                 int           `json:\"ups\"`\n                URL                 string        `json:\"url\"`\n                UserReports         []interface{} `json:\"user_reports\"`\n                Visited             bool          `json:\"visited\"`\n            } `json:\"data\"`\n            Kind string `json:\"kind\"`\n        } `json:\"children\"`\n        Modhash string `json:\"modhash\"`\n    } `json:\"data\"`\n    Kind string `json:\"kind\"`\n}\n</code></pre>\n\n<p>Usually, the output of these tools still needs to manual tweaking to work properly. for example:</p>\n\n<pre><code>MediaEmbed          struct{}      `json:\"media_embed\"`\n</code></pre>\n\n<p>I'm pretty sure that's not what's needed here. But it does go a long way in showing the basic idea and figuring out most of the stuff correctly. There are other similar tools you can try.</p>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 5988785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/76db4835d03cf2ecd09d36a7efa34fdb?s=128&d=identicon&r=PG", "display_name": "calmeishmael", "link": "https://stackoverflow.com/users/5988785/calmeishmael"}, "edited": false, "score": 0, "creation_date": 1476205907, "post_id": 39974045, "comment_id": 67244283, "body": "Thanks for the answer, very simple and concise. I don&#39;t know much about XML either, but I think I&#39;ll take a look at it to see how it differs from JSON."}, {"owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "reply_to_user": {"reputation": 27, "user_id": 5988785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/76db4835d03cf2ecd09d36a7efa34fdb?s=128&d=identicon&r=PG", "display_name": "calmeishmael", "link": "https://stackoverflow.com/users/5988785/calmeishmael"}, "edited": false, "score": 0, "creation_date": 1476220135, "post_id": 39974045, "comment_id": 67252357, "body": "The difference is that in xml package if you want to decode nested values you can put paths in tags like this: <code>type Foo struct { Title string &#39;xml:&quot;data&gt;children&gt;data&gt;title&quot;&#39;}</code> No idea why it&#39;s not possible in json package as it&#39;s really handy, having to only define a single struct (instead of 4 in this case). Otherwise the package is really similiar"}], "tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": true, "score": 2, "last_activity_date": 1476177502, "creation_date": 1476177502, "answer_id": 39974045, "question_id": 39972367, "link": "https://stackoverflow.com/questions/39972367/unmarshalling-complex-json/39974045#39974045", "title": "Unmarshalling Complex Json", "body": "<p>You don't have to define fields you don't need in your struct. Unmarshal will only decode the values that are present in your struct. But with nested JSONs you unfortunately have to define all the parent fields also (unlike in xml package in which you can define paths in tags). So your struct could look like this:</p>\n\n<pre><code>type Foo struct {\n    Data struct {\n        Children []struct {\n            Data struct {\n                Title string\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>See here for a working example: <a href=\"https://play.golang.org/p/UeUYfWBONL\" rel=\"nofollow\">https://play.golang.org/p/UeUYfWBONL</a></p>\n"}], "owner": {"reputation": 27, "user_id": 5988785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/76db4835d03cf2ecd09d36a7efa34fdb?s=128&d=identicon&r=PG", "display_name": "calmeishmael", "link": "https://stackoverflow.com/users/5988785/calmeishmael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 39974045, "answer_count": 2, "score": 1, "last_activity_date": 1476177502, "creation_date": 1476171166, "question_id": 39972367, "link": "https://stackoverflow.com/questions/39972367/unmarshalling-complex-json", "title": "Unmarshalling Complex Json", "body": "<p>I just recently started working with apis and http requests and I'm trying to build an application that uses the Reddit API to pull posts on a specific subreddit.</p>\n\n<p>This is the the page with json and search parameters that I'm practicing on:\n<a href=\"https://www.reddit.com/r/hiphopheads.json?limit=1\" rel=\"nofollow\">https://www.reddit.com/r/hiphopheads.json?limit=1</a></p>\n\n<p>Looking at the standard library of the JSON module for Golang, I still don't understand how to use json.Unmarshal for this complex JSON. From what I gather, I have to define a struct that resembles the JSON structure to actually hold the data</p>\n\n<p>I posted the link into this website to get a feel for what the JSON is actually strucutred like: <a href=\"https://jsonformatter.curiousconcept.com/\" rel=\"nofollow\">https://jsonformatter.curiousconcept.com/</a></p>\n\n<p>Right now the main thing I'm after is the title which is under Data->Children->Data->Title. If I want to unmarshal the JSON into an object, do I define a nested struct object? Or is there a simpler way to do this so that I don't have to figure out all the attributes of the JSON and define them myself??</p>\n\n<p>Any help that can get me on the right track is greatly appreciated. Thanks!</p>\n"}, {"tags": ["go", "docker"], "owner": {"reputation": 11, "user_id": 6952786, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FVcDVN6FzDk/AAAAAAAAAAI/AAAAAAAAAA8/Z3h-1M2_PcI/photo.jpg?sz=128", "display_name": "Dreamacro", "link": "https://stackoverflow.com/users/6952786/dreamacro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 338, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1476170100, "creation_date": 1476170100, "question_id": 39972126, "link": "https://stackoverflow.com/questions/39972126/how-to-exit-a-docker-remote-api-exec-stream", "title": "How to exit a Docker Remote API Exec Stream?", "body": "<p>When I get a stream from Docker Remote API like this:</p>\n\n<pre><code>// Exec exec command\nfunc (d *Docker) ExecStart(host, id string) (net.Conn) {\n    config := map[string]interface{}{\n        \"Detach\": false,\n        \"Tty\":    true,\n    }\n\n    buf, _ := json.Marshal(config)\n\n    conn, _ := net.Dial(\"tcp\", host)\n    conn.Write([]byte(\"POST /exec/\" + id + \"/start HTTP/1.1\\r\\n\"))\n    conn.Write([]byte(\"Host:\\r\\n\"))\n    conn.Write([]byte(\"Connection: Upgrade\\r\\n\"))\n    conn.Write([]byte(\"Content-Type: application/json\\r\\n\"))\n    conn.Write([]byte(\"Upgrade: tcp\\r\\n\"))\n    conn.Write([]byte(\"Content-Length: \" + fmt.Sprintf(\"%d\", len(buf)) + \"\\r\\n\"))\n    conn.Write([]byte(\"\\r\\n\"))\n    conn.Write(buf)\n    return conn\n}\n</code></pre>\n\n<p>After that, I disconnect the conn, but when I use <code>curl /exec/id/json</code> to get the status of result, the sh still running. So I want to know the best way to close the sh, even in <code>vi</code> mode. thx :)</p>\n"}, {"tags": ["ios", "google-app-engine", "go", "push-notification"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 1, "creation_date": 1478152515, "post_id": 39970210, "comment_id": 68040172, "body": "I&#39;m guessing you would need to make your own implimentation of <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow noreferrer\"><code>http.RoundTripper</code></a> by combining <a href=\"https://github.com/golang/net/blob/master/http2/transport.go#L299\" rel=\"nofollow noreferrer\"><code>http2.Transport</code></a> and <a href=\"https://github.com/golang/appengine/blob/master/urlfetch/urlfetch.go#L127\" rel=\"nofollow noreferrer\"><code>urlfetch.Transport</code></a>"}], "answers": [{"comments": [{"owner": {"reputation": 29797, "user_id": 112, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8cff214f16c7c8e73244a8ed8dea7e0e?s=128&d=identicon&r=PG", "display_name": "Jesse Beder", "link": "https://stackoverflow.com/users/112/jesse-beder"}, "edited": false, "score": 0, "creation_date": 1478639374, "post_id": 40458037, "comment_id": 68237109, "body": "This is unrelated. The issue is in the HTTP format, not in the certificate."}], "tags": [], "owner": {"reputation": 11931, "user_id": 2160144, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/zcIKd.jpg?s=128&g=1", "display_name": "Mehul Thakkar", "link": "https://stackoverflow.com/users/2160144/mehul-thakkar"}, "is_accepted": false, "score": -1, "last_activity_date": 1478494196, "creation_date": 1478494196, "answer_id": 40458037, "question_id": 39970210, "link": "https://stackoverflow.com/questions/39970210/send-apple-push-notification-from-a-go-appengine-site/40458037#40458037", "title": "Send Apple push notification from a Go appengine site", "body": "<p>I dont know much about go appengine, but whatever it looks from the code, your <code>client := apns2.NewClient(cert).Development()</code> line seems to be defective, i think for production, you dont need development cert, you need to have distribution cert.  So check that is there any option available for it. Also, is certificates from apple's dev site are generated by you or by  go appengine. If you have manually created that, then you have to create 2 types of certificates, one for developement and one for distribution/production, and when app is running in production mode, you need to use that certificates.</p>\n"}, {"tags": [], "owner": {"reputation": 5284, "user_id": 3953357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2f0b6d4522d8c03a21c5c41d5ba5a23?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3953357/adam"}, "is_accepted": false, "score": 2, "last_activity_date": 1479610255, "creation_date": 1479610255, "answer_id": 40700188, "question_id": 39970210, "link": "https://stackoverflow.com/questions/39970210/send-apple-push-notification-from-a-go-appengine-site/40700188#40700188", "title": "Send Apple push notification from a Go appengine site", "body": "<p>This would require going through the <a href=\"https://cloud.google.com/appengine/docs/go/sockets/\" rel=\"nofollow noreferrer\">App Engine Sockets API</a>. The documentation states:</p>\n\n<blockquote>\n  <p>Libraries that can accept a net.Conn should work without modification.</p>\n</blockquote>\n\n<p>You can get a <code>net.Conn</code> from the <code>appengine/socket</code> package and pass it to a lib that will accept one, but in the case of <code>apns2</code> it doesn't allow you to do this. However another user has <a href=\"https://github.com/sideshow/apns2/pull/31\" rel=\"nofollow noreferrer\">submitted a pull request</a> to the <code>apns2</code> project that adds a distinct <code>GAEClient</code> which can use App Engine sockets.</p>\n\n<p>As of right now it looks like the commits still have not been pulled into the master branch, however you could still merge these updates manually into your own source tree as a workaround for now.</p>\n"}], "owner": {"reputation": 29797, "user_id": 112, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8cff214f16c7c8e73244a8ed8dea7e0e?s=128&d=identicon&r=PG", "display_name": "Jesse Beder", "link": "https://stackoverflow.com/users/112/jesse-beder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 1, "answer_count": 2, "score": 17, "last_activity_date": 1479610255, "creation_date": 1476157481, "question_id": 39970210, "link": "https://stackoverflow.com/questions/39970210/send-apple-push-notification-from-a-go-appengine-site", "title": "Send Apple push notification from a Go appengine site", "body": "<p>I'm trying to send an Apple push notification from a Go appengine site. I'm using the <a href=\"https://godoc.org/github.com/sideshow/apns2\" rel=\"noreferrer\">apns2 library</a> as follows:</p>\n\n<pre><code>cert, err := certificate.FromPemFile(pemFile, \"\")\nif err != nil {\n    log.Fatalf(\"cert error: %v\", err)\n}\nclient := apns2.NewClient(cert).Development()\nn := &amp;apns2.Notification{...}\nif res, err := client.Push(n); err != nil { ... }\n</code></pre>\n\n<p>On a local development server, it works fine; but in production I'm seeing:</p>\n\n<pre><code>Post https://api.development.push.apple.com/3/device/995aa87050518ca346f7254f3484d7d5c731ee93c35e3c359db9ddf95d035003:\ndial tcp: lookup api.development.push.apple.com on [::1]:53: dial udp [::1]:53: socket: operation not permitted\n</code></pre>\n\n<p>It looks like appengine expects you to use its own <a href=\"https://cloud.google.com/appengine/docs/go/outbound-requests\" rel=\"noreferrer\">urlfetch library</a> when sending outbound requests, so I tried setting the underlying <code>HTTPClient</code> to use that:</p>\n\n<pre><code>client.HTTPClient = urlfetch.Client(ctx)\n</code></pre>\n\n<p>However, the response from the Apple server is now</p>\n\n<pre><code>@@?HTTP/2 client preface string missing or corrupt. Hex dump for received bytes: 504f5354202f332f6465766963652f393935616138373035\n</code></pre>\n\n<p>I believe the problem is that Apple push notifications <a href=\"https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html\" rel=\"noreferrer\">require HTTP/2</a>, but urlfetch only implements HTTP/1.1.</p>\n\n<p>How do I solve this problem? Is there a way for an appengine app to send an HTTP/2 request?</p>\n"}, {"tags": ["go", "http-headers", "go-gin"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 1, "creation_date": 1476164332, "post_id": 39970078, "comment_id": 67221287, "body": "what is the output of fmt.Println(c.Request.Header) ?"}, {"owner": {"reputation": 25, "user_id": 2101482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VR3IN.jpg?s=128&g=1", "display_name": "tiagopotencia", "link": "https://stackoverflow.com/users/2101482/tiagopotencia"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1476181851, "post_id": 39970078, "comment_id": 67229335, "body": "@Apin i edited the question! :)"}], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 2101482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VR3IN.jpg?s=128&g=1", "display_name": "tiagopotencia", "link": "https://stackoverflow.com/users/2101482/tiagopotencia"}, "is_accepted": true, "score": 1, "last_activity_date": 1476186770, "last_edit_date": 1476186770, "creation_date": 1476184657, "answer_id": 39976050, "question_id": 39970078, "link": "https://stackoverflow.com/questions/39970078/golang-wrong-http-resquest-header/39976050#39976050", "title": "Golang wrong http resquest header", "body": "<p>Helo, guys! i found the solution....</p>\n\n<p>I don't know why yet... but i think golang don't handle <em>no trailing slash</em> url's....</p>\n\n<p><a href=\"https://localhost:8086/v2/example\" rel=\"nofollow\">https://localhost:8086/v2/example</a><br>\nis different of<br>\n<a href=\"https://localhost:8086/v2/example/\" rel=\"nofollow\">https://localhost:8086/v2/example/</a></p>\n\n<p>That was my problem....</p>\n\n<p>I just copy and past the golang generated code of postman... and that was the \"biggest\" difference....</p>\n\n<p>Thanks mr. Postman...</p>\n"}], "owner": {"reputation": 25, "user_id": 2101482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VR3IN.jpg?s=128&g=1", "display_name": "tiagopotencia", "link": "https://stackoverflow.com/users/2101482/tiagopotencia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 39976050, "answer_count": 1, "score": 1, "last_activity_date": 1489451123, "creation_date": 1476156432, "last_edit_date": 1489451123, "question_id": 39970078, "link": "https://stackoverflow.com/questions/39970078/golang-wrong-http-resquest-header", "title": "Golang wrong http resquest header", "body": "<p>I'm building 2 apis. One make request to another.</p>\n\n<p>To call the api that receives requests, we need to pass a X-Token Header. I'm doing this with Golang</p>\n\n<pre><code>client := &amp;http.Client{\n    Transport: &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n    },\n}\n\nreq, err := http.NewRequest(\"GET\", \"https://localhost:8086/v2/example\", nil)\nif err != nil {\n    c.JSON(http.StatusInternalServerError, gin.H{\"Error\": err.Error()})\n}\nreq.Header.Add(\"accept\", \"application/json\")\nreq.Header.Add(\"content-type\", \"application/json\")\nreq.Header.Add(\"x-token\", \"a2e63ee01401aaeca78be023dfbb8c59\")\n\nresp, err := client.Do(req)\n</code></pre>\n\n<p>In the other API, i get the http header with <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">gin</a> like this:  </p>\n\n<p><code>token := c.Request.Header.Get(\"x-token\")</code></p>\n\n<p>I dont know why my header arrives with another value and no X-Token. Thanks!</p>\n\n<p>Result of <code>fmt.Printf(\"%+v\", c.Request.Header)</code>:</p>\n\n<pre><code>map[User-Agent:[Go-http-client/1.1] Referer:[https://localhost:8086/v2/example] Accept-Encoding:[gzip]]\n</code></pre>\n\n<p>I don't know where is my <em>x-token</em>, <em>accept</em> and <em>content-type</em> headers....</p>\n\n<p><strong>IMPORTANT</strong></p>\n\n<ul>\n<li>If i make a request with <em>x-token</em> header on Postman to the requested API i get the right header.</li>\n<li>If i change the request address on the API that makes requests, e.g <a href=\"https://httpbin.org/headers\" rel=\"nofollow\">httpbin</a>, i get the right header too....</li>\n</ul>\n"}, {"tags": ["go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 4475, "user_id": 2263165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe2bf7c90b7e27710a33b0bedcebde94?s=128&d=identicon&r=PG", "display_name": "Travis Hobrla", "link": "https://stackoverflow.com/users/2263165/travis-hobrla"}, "edited": false, "score": 0, "creation_date": 1476202030, "post_id": 39969371, "comment_id": 67241976, "body": "Which client library are you using?"}, {"owner": {"reputation": 1229, "user_id": 6336858, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ebcd58007a9088efe7c1605069558559?s=128&d=identicon&r=PG&f=1", "display_name": "omgj", "link": "https://stackoverflow.com/users/6336858/omgj"}, "reply_to_user": {"reputation": 4475, "user_id": 2263165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe2bf7c90b7e27710a33b0bedcebde94?s=128&d=identicon&r=PG", "display_name": "Travis Hobrla", "link": "https://stackoverflow.com/users/2263165/travis-hobrla"}, "edited": false, "score": 0, "creation_date": 1476228978, "post_id": 39969371, "comment_id": 67255527, "body": "<a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/storage</a> but there is another one which is confusing <a href=\"https://godoc.org/google.golang.org/api/storage/v1\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/api/storage/v1</a>. The error I get is <code>account is read only</code> but I have set up IAM permissions etc.."}], "owner": {"reputation": 1229, "user_id": 6336858, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ebcd58007a9088efe7c1605069558559?s=128&d=identicon&r=PG&f=1", "display_name": "omgj", "link": "https://stackoverflow.com/users/6336858/omgj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1476229385, "creation_date": 1476150984, "last_edit_date": 1476229385, "question_id": 39969371, "link": "https://stackoverflow.com/questions/39969371/google-cloud-storage-object-insert", "title": "Google Cloud storage, Object Insert?", "body": "<p>When I <code>r.FormFile(\"name\")</code> from the <code>*http.Request</code> I get a file (<code>f</code>), file header (<code>fh</code>) and an error (<code>err</code>). When I try to save the object into a bucket with :</p>\n\n<p><code>service.Objects.Insert(\"bucketName\", f).Do()</code></p>\n\n<p>I get a mismatch of types, <code>multipart.File</code> != <code>*storage.Object</code></p>\n\n<p>I suspect I might have to <code>io.Copy</code>...</p>\n"}, {"tags": ["go", "bytestream"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1476146665, "post_id": 39968839, "comment_id": 67217238, "body": "Do you have a specific question we could help you with?"}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 2, "creation_date": 1476146716, "post_id": 39968839, "comment_id": 67217253, "body": "Maybe check out the documentation of <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">io.Reader</a>"}, {"owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "edited": false, "score": 0, "creation_date": 1476147300, "post_id": 39968839, "comment_id": 67217373, "body": "I think it&#39;ll be better to write your own code (though incomplete or not working) and request a review to <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a> ."}, {"owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "reply_to_user": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1476147731, "post_id": 39968839, "comment_id": 67217456, "body": "I just want konw how to implement this exercise  @jcbwlkr"}, {"owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "reply_to_user": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "edited": false, "score": 0, "creation_date": 1476147766, "post_id": 39968839, "comment_id": 67217470, "body": "I update my code. @philipjkim"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1476248876, "last_edit_date": 1476248876, "creation_date": 1476169411, "answer_id": 39971974, "question_id": 39968839, "link": "https://stackoverflow.com/questions/39968839/how-to-implement-a-exercise-in-the-go-programming-language/39971974#39971974", "title": "How to implement a exercise in The Go Programming Language", "body": "<p>It seems you are not clear with the concepts of what you need to do.</p>\n\n<p>You need to create a function with the following signature:</p>\n\n<pre><code>func LimitReader(r io.Reader, n int64) io.Reader\n</code></pre>\n\n<p>That is, an <code>r</code> <code>io.Reader</code> and an <code>n</code> number is passed to it, and you have to return a new <code>io.Reader</code>. When someone reads from the <em>returned</em> reader, the read data must come from the passed <code>r</code> reader, and it should automatically count the read bytes; and if the read bytes exceeds the <code>n</code> number, it <em>must not</em> read further bytes from <code>r</code> but return <code>io.EOF</code> which is used to indicate that the end of the stream is reached. It could be that the <code>r</code> reader has more bytes (meaning more bytes could be read from it), but that should not be read and returned: that's the purpose of the <code>LimitedReader</code>.</p>\n\n<p>If you think you understand the problem now, stop reading the answer for now, and try to implement this yourself. What follows is an example solution.</p>\n\n<hr>\n\n<p>This exact functionality already exists in the <a href=\"https://golang.org/pkg/io/\" rel=\"nofollow\"><code>io</code></a> package, and goes by the same name: <a href=\"https://golang.org/pkg/io/#LimitReader\" rel=\"nofollow\"><code>io.LimitReader()</code></a>.</p>\n\n<pre><code>// LimitReader returns a Reader that reads from r\n// but stops with EOF after n bytes.\n// The underlying implementation is a *LimitedReader.\nfunc LimitReader(r Reader, n int64) Reader { return &amp;LimitedReader{r, n} }\n</code></pre>\n\n<p>It returns a value of <a href=\"https://golang.org/pkg/io/#LimitedReader\" rel=\"nofollow\"><code>*io.LimitedReader</code></a>, whose implementation is this:</p>\n\n<pre><code>// A LimitedReader reads from R but limits the amount of\n// data returned to just N bytes. Each call to Read\n// updates N to reflect the new amount remaining.\ntype LimitedReader struct {\n    R Reader // underlying reader\n    N int64  // max bytes remaining\n}\n\nfunc (l *LimitedReader) Read(p []byte) (n int, err error) {\n    if l.N &lt;= 0 {\n        return 0, EOF\n    }\n    if int64(len(p)) &gt; l.N {\n        p = p[0:l.N]\n    }\n    n, err = l.R.Read(p)\n    l.N -= int64(n)\n    return\n}\n</code></pre>\n\n<p>Take a minute or 2 to try to understand the code yourself. If you're stuck or not everything is clear, read on.</p>\n\n<p><strong>Explaining the code:</strong></p>\n\n<p><code>io.LimitedReader</code> is a struct, which contains the <em>source</em> reader it reads from, and the number of bytes that can still be read without having to report <code>io.EOF</code>. So <code>LimitReader()</code> simply just returns a value of this struct where the parameters <code>r</code> and <code>n</code> are assigned to the fields <code>R</code> and <code>N</code> of the struct. More specifically an address of this struct is returned, because <code>LimitedReader.Read()</code> has pointer receiver, and so only a pointer to it implements <code>io.Reader</code>. And it has a pointer receiver, because the <code>Read()</code> method (may) modify the fields of the struct, so a pointer is required to be able to do that (else only a copy would be modified which is discarded after the <code>Read()</code> method returns).</p>\n\n<p><code>LimitedReader.Read()</code> first checks the <code>N</code> field which tells how many more bytes can we return, and if there is no more \"allowed\", being a well-behaved Limited-reader, it returns <code>io.EOF</code> immedately without reading any more bytes from the source:</p>\n\n<pre><code>if l.N &lt;= 0 {\n    return 0, EOF\n}\n</code></pre>\n\n<p>If <code>N</code> is positive, that means <em>some</em> bytes may be read and returned, but no more than <code>N</code>, so if the <code>p</code> slice passed to <code>Read()</code> has a greater length, we <em>re-slice</em> it so a call to the source reader will not read more than what we should allow:</p>\n\n<pre><code>if int64(len(p)) &gt; l.N {\n    p = p[0:l.N]\n}\n</code></pre>\n\n<p>And the last part is nothing more that actually doing the reading, from the source reader:</p>\n\n<pre><code>n, err = l.R.Read(p)\n</code></pre>\n\n<p>Which returns the number of actually read bytes, and an optional error (whether reading encountered some error). Since we're about to return these, we have to administer that this amount of bytes are now returned, we have to subtract this from the allowed remaining bytes:</p>\n\n<pre><code>l.N -= int64(n)\nreturn\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 39971974, "answer_count": 1, "score": 0, "last_activity_date": 1476248876, "creation_date": 1476146591, "last_edit_date": 1476172262, "question_id": 39968839, "link": "https://stackoverflow.com/questions/39968839/how-to-implement-a-exercise-in-the-go-programming-language", "title": "How to implement a exercise in The Go Programming Language", "body": "<p>Exercise 7.5:<br>\nThe <code>LimitReader</code> function in the <code>io</code> package accepts an <code>io.Reader</code> <code>r</code> and a number of bytes <code>n</code>, and returns another <code>Reader</code> that reads from <code>r</code> but reports an end-of-file condition after <code>n</code> bytes. Implement it.</p>\n\n<pre><code>func LimitReader(r io.Reader, n int64) io.Reader\n</code></pre>\n\n<p>How to implement it?</p>\n\n<hr>\n\n<p>Below is my code, I know it not right.</p>\n\n<pre><code>type MyReader struct {\n    bytes []byte\n    length int\n}\n\nfunc (myReader *MyReader) Read (p []byte) (int, error) {\n    fmt.Println(\"be invoked\")\n    myReader.bytes = p\n    myReader.length = len(p)\n    fmt.Printf(\"lenght: %d\\n\" , myReader.length)\n    return len(p), nil\n}\nfunc LimitReader(r io.Reader, n int64) io.Reader {\n    filecontent, _:= ioutil.ReadFile(\"./testfile.txt\")\n    r.Read(filecontent[:n])\n    return r\n}\n\nfunc main() {\n    myReader := &amp;MyReader{}\n    r := LimitReader(myReader, 100)\n    filecontent, _:= ioutil.ReadFile(\"./testfile.txt\")\n    fmt.Println(r.Read(filecontent))\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "slice"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1476142229, "post_id": 39968236, "comment_id": 67216194, "body": "You can try the <a href=\"https://golang.org/pkg/reflect/#example_StructTag\" rel=\"nofollow noreferrer\">reflect</a> library."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1476142454, "post_id": 39968236, "comment_id": 67216241, "body": "@kichik could not figure out how. Can you elaborate your answer please."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1476142573, "last_edit_date": 1495535268, "creation_date": 1476142573, "answer_id": 39968350, "question_id": 39968236, "link": "https://stackoverflow.com/questions/39968236/how-to-convert-slice-of-structs-to-slice-of-strings-in-go/39968350#39968350", "title": "How to convert slice of structs to slice of strings in go?", "body": "<p>For your specific case I would just do it \"manually\":</p>\n\n<pre><code>rows := []TagRow{\n    {\"a\", \"b\", \"c\"},\n    {\"d\", \"e\", \"f\"},\n    {\"g\", \"h\", \"i\"},\n}\n\nvar s []string\nfor _, v := range rows {\n    s = append(s, v.Tag1, v.Tag2, v.Tag3)\n}\nfmt.Printf(\"%q\\n\", s)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\"a\" \"b\" \"c\" \"d\" \"e\" \"f\" \"g\" \"h\" \"i\"]\n</code></pre>\n\n<p>If you want it to dynamically walk through all fields, you may use the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a> package. A helper function which does that:</p>\n\n<pre><code>func GetFields(i interface{}) (res []string) {\n    v := reflect.ValueOf(i)\n    for j := 0; j &lt; v.NumField(); j++ {\n        res = append(res, v.Field(j).String())\n    }\n    return\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>var s2 []string\nfor _, v := range rows {\n    s2 = append(s2, GetFields(v)...)\n}\nfmt.Printf(\"%q\\n\", s2)\n</code></pre>\n\n<p>Output is the same:</p>\n\n<pre><code>[\"a\" \"b\" \"c\" \"d\" \"e\" \"f\" \"g\" \"h\" \"i\"]\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/0nS9tC6cGY\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>See similar questions with more complex examples:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/30913483/golang-sort-struct-fields-in-alphabetical-order\">Golang, sort struct fields in alphabetical order</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/33142594/how-to-print-struct-with-string-of-fields\">How to print struct with String() of fields?</a></p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8313, "favorite_count": 0, "accepted_answer_id": 39968350, "answer_count": 1, "score": 2, "last_activity_date": 1476142605, "creation_date": 1476141922, "last_edit_date": 1476142605, "question_id": 39968236, "link": "https://stackoverflow.com/questions/39968236/how-to-convert-slice-of-structs-to-slice-of-strings-in-go", "title": "How to convert slice of structs to slice of strings in go?", "body": "<p>New go user here. \nI have a slice of this struct objects:</p>\n\n<pre><code>type TagRow struct {\n    Tag1 string  \n    Tag2 string  \n    Tag3 string  \n}\n</code></pre>\n\n<p>Which yeilds slices like: </p>\n\n<pre><code>[{a b c} {d e f} {g h}]\n</code></pre>\n\n<p>I'm wondering how can I convert the resulting slice to a slice of strings like:</p>\n\n<pre><code>[\"a\" \"b\" \"c\" \"d\" \"e\" \"f\" \"g\" \"h\"]\n</code></pre>\n\n<p>I tried to iterate over like:</p>\n\n<pre><code>for _, row := range tagRows {\nfor _, t := range row {\n    fmt.Println(\"tag is\" , t)\n}\n</code></pre>\n\n<p>}</p>\n\n<p>But I get:</p>\n\n<pre><code>cannot range over row (type TagRow)\n</code></pre>\n\n<p>So appreciate your help.</p>\n"}, {"tags": ["string", "security", "memory", "go", "cgo"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1476141138, "post_id": 39968084, "comment_id": 67215910, "body": "When you say zeroing the memory do you mean calling realloc and giving it a size of 0? Because if you mean just setting all the bits in the block to 0 I&#39;m not sure what the point is. My intuition says you should depend on the GC, I think you can arrange your code such that the map leaves scope very quickly (like pass the string into a function you call in a goroutine and move one) so I don&#39;t see the memory being held as really being a problem. I mean also, what is the memory concern here? A password isn&#39;t very significant."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476142018, "post_id": 39968084, "comment_id": 67216131, "body": "If a password is coming in through an HTTP POST, there&#39;s not much point in zeroing a specific string, because you didn&#39;t read it directly off the wire yourself, and have no idea how many copies there have been in memory."}, {"owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476142239, "post_id": 39968084, "comment_id": 67216198, "body": "@JimB That is very true, and perhaps I should have worded my question a bit better as I seem to have given off the impression that I want to do this in my web application. Really the web application example was just the trigger for my thoughts on this subject, and I&#39;m more interested in simply whether zeroing a Go <code>string</code>s memory is actually possible/&quot;safe&quot; enough to do in Go, should that much security be required."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476142471, "post_id": 39968084, "comment_id": 67216245, "body": "@JakeLucas: no, there&#39;s no &quot;safe&quot; way to do it, and the language makes no guarantees about the internal handling of strings."}, {"owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476142929, "post_id": 39968084, "comment_id": 67216379, "body": "@JimB That&#39;s what I thought the answer would be, but just wanted to post here to check my understanding. And by &quot;safe&quot; I mean, if you are careful not to use the string variable again. Of course, since there is no guarantee about the internal handling of strings it would probably be best to just leave it alone no matter how careful you are, but sometimes I can&#39;t help wanting to play with the memory more directly :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476143316, "post_id": 39968084, "comment_id": 67216488, "body": "@JakeLucas: that kind of has to be the answer, since string are defined as immutable, there can&#39;t be a safe way to do it. It&#39;s fairly easy to use unsafe and zero the bytes if you wish, there&#39;s just no guarantees. Anything where memory access is critical will always use slices or arrays to control memory layout."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476151294, "post_id": 39968084, "comment_id": 67218280, "body": "Works most of the time: <a href=\"https://play.golang.org/p/ibG1MFKYns\" rel=\"nofollow noreferrer\">play.golang.org/p/ibG1MFKYns</a>"}, {"owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476226000, "post_id": 39968084, "comment_id": 67254760, "body": "@JimB Thank you for getting back to me again, and with an example too. It looks like that&#39;s the closest you can get using Go to replacing a <code>string</code>&#39;s content, albeit with no actual guarantees that the string hasn&#39;t been copied elsewhere in memory. If you would like to compile your comments into an answer I&#39;d be happy to accept it."}], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "edited": false, "score": 0, "creation_date": 1493795944, "post_id": 39997200, "comment_id": 74548650, "body": "Why not just ditch all strings altogether?"}, {"owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "reply_to_user": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "edited": false, "score": 0, "creation_date": 1497704277, "post_id": 39997200, "comment_id": 76196790, "body": "@Awn I did ditch strings in the package I wrote, but the problem I was trying to solve was how to zero the memory of a string when you are passed one from some other place. Unfortunately there isn&#39;t any guaranteed way to do this in pure Go, but that wasn&#39;t going to stop me from at least trying :)"}, {"owner": {"reputation": 391, "user_id": 1304076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb8e5a1596efa01374ffabe734cacec?s=128&d=identicon&r=PG", "display_name": "Jeffrey Goldberg", "link": "https://stackoverflow.com/users/1304076/jeffrey-goldberg"}, "edited": false, "score": 0, "creation_date": 1550786044, "post_id": 39997200, "comment_id": 96409854, "body": "If you are going to accept passwords with multibyte characters then you will want to perform some sort of unicode normalization. And all of the tools for those expect strings. So you would need to write a low level unicode normalization system."}], "tags": [], "owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "is_accepted": true, "score": 5, "last_activity_date": 1476313872, "last_edit_date": 1476313872, "creation_date": 1476270921, "answer_id": 39997200, "question_id": 39968084, "link": "https://stackoverflow.com/questions/39968084/is-it-possible-to-zero-a-golang-strings-memory-safely/39997200#39997200", "title": "Is it possible to zero a Golang string&#39;s memory &quot;safely&quot;?", "body": "<p>Given that there doesn't seem to be much activity on this question, I'm going to just assume that most people haven't needed/wanted to look into this before, or haven't thought it was worth the time. As such I will just post my own findings as an answer despite my ignorance regarding the inner-workings of Go.</p>\n\n<p>I should preface this answer with a disclaimer that since Go is a Garbage Collected language and I do not know how it works internally the following information may not actually guarantee any memory to actually be cleared to zero at all, but that won't stop me from trying; after all, the fewer plain-text passwords in memory the better, in my opinion.</p>\n\n<p>With that in mind this is everything I have found to work (as far as I can tell) in conjunction with <code>libsodium</code>; so far none of it has crashed any of my programs at least.</p>\n\n<p>First of all, as you probably already know <code>string</code>s in Go are immutable, so technically their value shouldn't be changed, but if we use an <code>unsafe.Pointer</code> to the <code>string</code> in Go or in C via Cgo, we can actually overwrite the data stored in the <code>string</code> value; we just can't guarantee there aren't any other copies of the data anywhere else in memory.</p>\n\n<p>For this reason I made my password related functions deal with <code>[]byte</code> variables exclusively to cut down on the number of possible plain-text passwords being copied around memory.</p>\n\n<p>I also return the <code>[]byte</code> reference for the plain text password that gets passed into all password functions, since converting a <code>string</code> into a <code>[]byte</code> will allocate new memory and copy the contents over. This way, at least if you convert your <code>string</code> to a <code>[]byte</code> in-place without assigning it to a variable first you can still get access to the new <code>[]byte</code> after the function call has finished and zero that memory as well.</p>\n\n<p>Below is the gist of what I came up with. You can fill in the blanks, include the <code>libsodium</code> C library and compile it to see the results for yourself.</p>\n\n<p>For me it output this before the <code>MemZero*</code> function were called:</p>\n\n<pre><code>pwd     : Correct Horse Battery Staple\npwdBytes: [67 111 114 114 101 99 116 32 72 111 114 115 101 32 66 97 116 116 101 114 121 32 83 116 97 112 108 101]\n</code></pre>\n\n<p>Then this after the <code>MemZero*</code> function were called:</p>\n\n<pre><code>pwd     :\npwdBytes: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\nHash: $argon2i$v=19$m=131072,t=6,p=1$N05osI8nuTjftzfAYBIcbA$3yb92yt9S9dRmPtlSV/J8jY4DG3reqm+2eV+fi54Its\n</code></pre>\n\n<p>So it looks like a success, but since we can't guarantee there are no copies of the plain-text password elsewhere in memory I think that is as far as we can <em>go</em> with it.</p>\n\n<p>The code below simply passes an <code>unsafe.Pointer</code> with the number of <code>byte</code>s to the <code>sodium_memzero</code> function in C to achieve this. So the actual zeroing of memory is left up to <code>libsodium</code>.</p>\n\n<p>I apologise if I left any typos or anything in the code that doesn't work, but I didn't want to paste in too much, only the relevant parts.</p>\n\n<p>For example, you could also employ the use of functions like <code>mlock</code> if you really needed to, but since this question was focused on zeroing a <code>string</code> I will just show that here.</p>\n\n<pre><code>package sodium\n\n// Various imports, other functions and &lt;sodium.h&gt; here...\n\nfunc init() {\n    if err := sodium.Init(); err != nil {\n        log.Fatalf(\"sodium: %s\", err)\n    }\n}\n\nfunc PasswordHash(pwd []byte, opslimit, memlimit int) ([]byte, []byte, error) {\n    pwdPtr := unsafe.Pointer(&amp;pwd[0])\n    hashPtr := unsafe.Pointer(&amp;make([]byte, C.crypto_pwhash_STRBYTES)[0])\n\n    res := C.crypto_pwhash_str(\n        (*C.char)(hashPtr),\n        (*C.char)(pwdPtr),\n        C.ulonglong(len(pwd)),\n        C.ulonglong(opslimit),\n        C.size_t(memlimit),\n    )\n    if res != 0 {\n        return nil, pwd, fmt.Errorf(\"sodium: passwordhash: out of memory\")\n    }\n    return C.GoBytes(hashPtr, C.crypto_pwhash_STRBYTES), pwd, nil\n}\n\nfunc MemZero(p unsafe.Pointer, size int) {\n    if p != nil &amp;&amp; size &gt; 0 {\n        C.sodium_memzero(p, C.size_t(size))\n    }\n}\n\nfunc MemZeroBytes(bytes []byte) {\n    if size := len(bytes); size &gt; 0 {\n        MemZero(unsafe.Pointer(&amp;bytes[0]), size)\n    }\n}\n\nfunc MemZeroStr(str *string) {\n    if size := len(*str); size &gt; 0 {\n        MemZero(unsafe.Pointer(str), size)\n    }\n}\n</code></pre>\n\n<p>And then to use it all:</p>\n\n<pre><code>package main\n\n// Imports etc here...\n\nfunc main() {\n    // Unfortunately there is no guarantee that this won't be\n    // stored elsewhere in memory, but we will try to remove it anyway\n    pwd := \"Correct Horse Battery Staple\"\n\n    // I convert the pwd string to a []byte in place here\n    // Because of this I have no reference to the new memory, with yet\n    // another copy of the plain password hanging around\n    // The function always returns the new []byte as the second value\n    // though, so we can still zero it anyway\n    hash, pwdBytes, err := sodium.PasswordHash([]byte(pwd), 6, 134217728)\n\n    // Byte slice and string before MemZero* functions\n    fmt.Println(\"pwd     :\", pwd)\n    fmt.Println(\"pwdBytes:\", pwdBytes)\n\n    // No need to keep a plain-text password in memory any longer than required\n    sodium.MemZeroStr(&amp;pwd)\n    sodium.MemZeroBytes(pwdBytes)\n    if err != nil {\n      log.Fatal(err)\n    }\n\n    // Byte slice and string after MemZero* functions\n    fmt.Println(\"pwd     :\", pwd)\n    fmt.Println(\"pwdBytes:\", pwdBytes)\n\n    // We've done our best to make sure we only have the hash in memory now\n    fmt.Println(\"Hash:\", string(hash))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "edited": false, "score": 2, "creation_date": 1497704422, "post_id": 43719317, "comment_id": 76196852, "body": "Thank you for the link and suggestion of using cgo, Awn. That memguard package does look interesting. It&#39;s been a while since I&#39;ve thought about memory in the context of my question, but I think I&#39;ll start using that package the next chance I get."}], "tags": [], "owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "is_accepted": false, "score": 4, "last_activity_date": 1497716340, "last_edit_date": 1497716340, "creation_date": 1493642814, "answer_id": 43719317, "question_id": 39968084, "link": "https://stackoverflow.com/questions/39968084/is-it-possible-to-zero-a-golang-strings-memory-safely/43719317#43719317", "title": "Is it possible to zero a Golang string&#39;s memory &quot;safely&quot;?", "body": "<p>Handling secure values in memory is harder in Go than it would be in something like C or C++. That's because of the GC, which goes around copying and messing with whatever memory it feels like.</p>\n\n<p>So, the first step is to get some memory that the GC cannot mess with. For this, we'd either spin up cgo and malloc whatever we want; or use systemcalls like mmap and VirtualAlloc; then pass around the resulting slice as normal.</p>\n\n<p>The next step is to tell the OS that you don't want this memory being swapped out to disk, so you mlock or VirtualLock it.</p>\n\n<p>Before exiting, zero out the slice with either libsodium or by simply iterating over it, setting each element to zero. This wouldn't be possible with a string, and I'm not sure that I would recommend manually wiping the string's memory. I mean, I can't immediately spot anything wrong with it but... It just doesn't feel right. No one uses strings for secure values anyway.</p>\n\n<p>There's a library (mine) that is designed specifically for storing secure values, and it does what I've described above alongside a few other things. You might find it useful: <a href=\"https://github.com/awnumar/memguard\" rel=\"nofollow noreferrer\">https://github.com/awnumar/memguard</a></p>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 7461738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-D0yKjXEU0zI/AAAAAAAAAAI/AAAAAAAAACE/2YFhu24oiB0/photo.jpg?sz=128", "display_name": "Louki Sumirniy", "link": "https://stackoverflow.com/users/7461738/louki-sumirniy"}, "is_accepted": false, "score": 2, "last_activity_date": 1534865934, "creation_date": 1534865934, "answer_id": 51952229, "question_id": 39968084, "link": "https://stackoverflow.com/questions/39968084/is-it-possible-to-zero-a-golang-strings-memory-safely/51952229#51952229", "title": "Is it possible to zero a Golang string&#39;s memory &quot;safely&quot;?", "body": "<p>\"No one uses strings for secure values anyway.\"</p>\n\n<p>Except for the passwords used in a KDF to unlock a ciphertext or decrypt directly.</p>\n\n<p>The memory used in string allocations triggers a segmentation fault if you attempt to mutate the underlying buffer of a string:</p>\n\n<p><a href=\"https://medium.com/kokster/mutable-strings-in-golang-298d422d01bc\" rel=\"nofollow noreferrer\">https://medium.com/kokster/mutable-strings-in-golang-298d422d01bc</a></p>\n\n<p>Same as memguard immutable buffers.</p>\n\n<p>I have tried using unix.Mprotect on the address given but I think the trick is I have to find the actual memory page address where the string buffer is stored, not the pointer to the start of the buffer, to do this effectively.</p>\n\n<p>It's a little too much work for me to find the proper solution for the time being, but knowing that strings are immutable and pile up copies from here to kingdom come in memory, I think it should be a rule if you are using memguard and have to process passwords, put it inside a memguard buffer at the first moment and only work with its data in that form thereafter.</p>\n\n<p>It's exactly for reasons like this that Qubes was devised, to put a stronger boundary between applications. If your program is boxed inside a VM container, it cannot reach outside that box, at all. Only attack vector then is if your program runs malicious code.</p>\n\n<p>Since network packets arrive as []byte, anything sensitive in them can be zeroed out as needed. Since the keyboard input side is controlled by the OS, one need simply to find (or maybe write) a console text input function that goes directly to mutable byte slices, and then the statement I quoted at the top applies.</p>\n\n<p>Bearing this in mind I am now altering my code to not use a string variable anywhere I need to zero out data after using it.</p>\n"}, {"tags": [], "owner": {"reputation": 391, "user_id": 1304076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb8e5a1596efa01374ffabe734cacec?s=128&d=identicon&r=PG", "display_name": "Jeffrey Goldberg", "link": "https://stackoverflow.com/users/1304076/jeffrey-goldberg"}, "is_accepted": false, "score": 5, "last_activity_date": 1550786362, "creation_date": 1550786362, "answer_id": 54816869, "question_id": 39968084, "link": "https://stackoverflow.com/questions/39968084/is-it-possible-to-zero-a-golang-strings-memory-safely/54816869#54816869", "title": "Is it possible to zero a Golang string&#39;s memory &quot;safely&quot;?", "body": "<p>I do not believe that your scheme will work in general if you want to accept passwords with multibyte characters.</p>\n\n<p>Handling password with multibyte characters requires that you normalize them first (there are multiple different byte sequences that may underly something like \"\u00c5\", and which you get as input will vary on keyboard, operating system, and perhaps the phase of the moon.</p>\n\n<p>So unless you want to rewrite all of Go's Unicode normalization code to work on your byte arrays, you will run into problems.</p>\n\n<blockquote>\n  <p>Given that there doesn't seem to be much activity on this question, I'm going to just assume that most people haven't needed/wanted to look into this before, or haven't thought it was worth the time.</p>\n</blockquote>\n\n<p>Actually, I hadn't noticed this question until today. Believe me, I've thought about this.</p>\n"}], "owner": {"reputation": 9826, "user_id": 467732, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93af4ec7a03d6ec6e95eff3a83af3dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/467732/lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3613, "favorite_count": 2, "accepted_answer_id": 39997200, "answer_count": 4, "score": 10, "last_activity_date": 1550786362, "creation_date": 1476140875, "last_edit_date": 1476142104, "question_id": 39968084, "link": "https://stackoverflow.com/questions/39968084/is-it-possible-to-zero-a-golang-strings-memory-safely", "title": "Is it possible to zero a Golang string&#39;s memory &quot;safely&quot;?", "body": "<p>Recently I've been setting up <code>libsodium</code> in one of my projects by using cgo, in order to use the <code>crypto_pwhash_str</code> and <code>crypto_pwhash_str_verify</code> functions.</p>\n\n<p>This has all gone very smoothly and I now have a small collection of functions that receive a <code>[]byte</code> in the form of a plain-text password and either hash it, or compare it against another <code>[]byte</code> to verify it.</p>\n\n<p>My reason for using a <code>[]byte</code> instead of a <code>string</code> is because, from what I've learnt so far about Go, I can at least loop over the plain-text password and zero all of the bytes, or even pass a pointer into <code>libsodium</code>'s <code>sodium_memzero</code> function, in order to not leave it hanging around in memory longer than it needs to.</p>\n\n<p>This is fine for applications where I have the ability to read input directly as bytes, but I'm now trying to use it in a small web application where I need to read passwords from a form using the <code>POST</code> method.</p>\n\n<p>From what I can see in the Go source code and documentation, using <code>r.ParseForm</code> in a request handler will parse all of the form values into a <code>map</code> of <code>string</code>s.</p>\n\n<p>The problem is that because <code>string</code>s in Go are immutable I don't think I can do anything about zeroing the memory of a password that was <code>POST</code>ed in the form; at least, using only Go.</p>\n\n<p>So it seems like my only (easy) option would be to pass an <code>unsafe.Pointer</code> into a function in C along with the number of bytes and let C zero the memory for me instead (for example, passing it to the aforementioned <code>sodium_memzero</code> function).</p>\n\n<p>I have tried this, and unsurprisingly it does of course work, but then I'm left with an unsafe <code>string</code> in Go, which, if used in a function like <code>fmt.Println</code> will crash the program.</p>\n\n<p>My questions are as follows:</p>\n\n<ul>\n<li>Should I just accept that passwords will be <code>POST</code>ed and parsed as strings and that I shouldn't mess with it and just wait for the GC to kick in? (not ideal)</li>\n<li>Is zeroing the memory of a <code>string</code> using cgo ok, provided it's obviously documented in the code that the string variable should not be used again?</li>\n<li>Will zeroing the memory of a <code>string</code> using cgo ever do something like crashing the GC?</li>\n<li>Is it worth writing a sort of decorator for <code>http.Request</code> that adds a function to parse form values directly as <code>[]byte</code> so I have complete control over the values when they arrive?</li>\n</ul>\n\n<p><strong>Edit:</strong> To clarify, the web app and form <code>POST</code> is just a convenient example of a case where I might be handed sensitive data just from using Go's standard library in the form of a <code>string</code>. I'm more just interested in whether all of my questions are possible/worthwhile in some case were cleaning up data in memory as quickly as possible was more of a security concern.</p>\n"}, {"tags": ["go", "biginteger", "integer-overflow"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1476136203, "post_id": 39966952, "comment_id": 67214369, "body": "Const in Go are <i>not</i> normal variables which happen to be be const, they are different. The concept of a const exists during compilation only, const are of arbitrary (almost) precision and size and arithmetic is possible. When <i>using</i> a const it is converted to a &quot;proper&quot; type. This conversion may fail as in your case in which aour program is malformed. There is no (direct, simple) way to print <code>Big</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1476138184, "post_id": 39966952, "comment_id": 67215021, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/38982278/how-does-go-perform-arithmetic-on-constants\">How does Go perform arithmetic on constants?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1476191854, "creation_date": 1476191854, "answer_id": 39978175, "question_id": 39966952, "link": "https://stackoverflow.com/questions/39966952/go-print-large-number/39978175#39978175", "title": "Go print large number", "body": "<p>That value is larger than any 64 bit numeric type can hold, so you have no way of manipulating it directly.</p>\n\n<p>If you need to write a numeric constant that can only be manipulated with the <code>math/big</code> package, you need to store it serialized in a format that package can consume. Easiest way is probably to use a base 10 string: </p>\n\n<p><a href=\"https://play.golang.org/p/Mzwox3I2SL\" rel=\"nofollow\">https://play.golang.org/p/Mzwox3I2SL</a></p>\n\n<pre><code>bigNum := \"1267650600228229401496703205376\"\nb, ok := big.NewInt(0).SetString(bigNum, 10)\nfmt.Println(ok, b)\n// true 1267650600228229401496703205376\n</code></pre>\n"}], "owner": {"reputation": 23300, "user_id": 299711, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f61d00f60af2317ddd079565680d0bc5?s=128&d=identicon&r=PG", "display_name": "arik", "link": "https://stackoverflow.com/users/299711/arik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1677, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1476191854, "creation_date": 1476134617, "last_edit_date": 1476137587, "question_id": 39966952, "link": "https://stackoverflow.com/questions/39966952/go-print-large-number", "title": "Go print large number", "body": "<p>I am currently doing the Go Lang tutorial, \"Numeric Constants\" to be precise. The example code starts with the following statement:</p>\n\n<pre><code>const (\n    // Create a huge number by shifting a 1 bit left 100 places.\n    // In other words, the binary number that is 1 followed by 100 zeroes.\n    Big = 1 &lt;&lt; 100\n    // Shift it right again 99 places, so we end up with 1&lt;&lt;1, or 2.\n    Small = Big &gt;&gt; 99\n)\n</code></pre>\n\n<p>The constant <code>Big</code> is obviously huge, and I am trying to print it and its type, like this:</p>\n\n<pre><code>fmt.Printf(\"%T\", Big)\nfmt.Println(Big)\n</code></pre>\n\n<p>However, I get the following error for both lines:</p>\n\n<blockquote>\n  <p># command-line-arguments ./compile26.go:19: constant 1267650600228229401496703205376 overflows int</p>\n</blockquote>\n\n<p>I would try casting Big to some other type, such as <code>uint64</code>, which it overflowed with the same error, or just convert it to a string, but when trying <code>Big.String()</code> I get the following error:</p>\n\n<blockquote>\n  <p>Big.String undefined (type int has no field or method String)</p>\n</blockquote>\n\n<p>It appears that its type is <code>int</code>, yet I can't print it or cast it to anything and it overflows all methods. What do I do with this number/object and how do I print it?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1476133583, "post_id": 39966718, "comment_id": 67213387, "body": "What does <code>fmt.Println(&quot;Users &gt;&gt; &quot;, users)</code> print?"}, {"owner": {"reputation": 955, "user_id": 2621320, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/F4NfU.jpg?s=128&g=1", "display_name": "Gerardo Tarragona", "link": "https://stackoverflow.com/users/2621320/gerardo-tarragona"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1476143579, "post_id": 39966718, "comment_id": 67216571, "body": "It prints &quot;<code>&lt;nil&gt;</code>&quot;"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1476155658, "post_id": 39966718, "comment_id": 67219291, "body": "well &lt;nil&gt; is the zero value for an empty slice and there is no errors, so it seems that your collection &#39;users&#39; is empty"}, {"owner": {"reputation": 955, "user_id": 2621320, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/F4NfU.jpg?s=128&g=1", "display_name": "Gerardo Tarragona", "link": "https://stackoverflow.com/users/2621320/gerardo-tarragona"}, "edited": false, "score": 0, "creation_date": 1476163409, "post_id": 39966718, "comment_id": 67221051, "body": "but in the mongo shell, if I run <code>use my_db</code> and then <code>db.users.find()</code>, it returns several json documents.."}], "answers": [{"comments": [{"owner": {"reputation": 955, "user_id": 2621320, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/F4NfU.jpg?s=128&g=1", "display_name": "Gerardo Tarragona", "link": "https://stackoverflow.com/users/2621320/gerardo-tarragona"}, "edited": false, "score": 0, "creation_date": 1476217677, "post_id": 39973592, "comment_id": 67251038, "body": "You&#39;re right, thank you. I&#39;m just getting used to pointers and references in Go."}], "tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": true, "score": 1, "last_activity_date": 1476175902, "creation_date": 1476175902, "answer_id": 39973592, "question_id": 39966718, "link": "https://stackoverflow.com/questions/39966718/mgo-collection-findnil-allusers-not-working/39973592#39973592", "title": "mgo collection.Find(nil).All(&amp;users) not working", "body": "<p>There is no issue with your code, but the last line <code>fmt.Println(\"Results &gt;&gt; \", err)</code>, shouldn't it be <code>fmt.Println(\"Results &gt;&gt; \", users)</code> ?</p>\n\n<p>Also you can check if collection is not empty and fields are correct by using interface</p>\n\n<pre><code>session := dbConnect()\n    collection := session.DB(\"my_db\").C(\"users\")\n    var v []interface{}\n    err := collection.Find(nil).All(&amp;v)\n    if err != nil {\n        log.Fatal(\"Mongo collection find fail: \", err)\n    }\n    fmt.Println(\"Results &gt;&gt; \", v)\n</code></pre>\n"}], "owner": {"reputation": 955, "user_id": 2621320, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/F4NfU.jpg?s=128&g=1", "display_name": "Gerardo Tarragona", "link": "https://stackoverflow.com/users/2621320/gerardo-tarragona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 0, "accepted_answer_id": 39973592, "answer_count": 1, "score": 0, "last_activity_date": 1476179931, "creation_date": 1476133406, "last_edit_date": 1476179931, "question_id": 39966718, "link": "https://stackoverflow.com/questions/39966718/mgo-collection-findnil-allusers-not-working", "title": "mgo collection.Find(nil).All(&amp;users) not working", "body": "<p>I'm having the next issue..\nI can't get all records from my mongo database (running in a docker containner), here is my really simple code:</p>\n\n<pre><code>type User struct {\n    Email string `json:\"email\" bson:\"email\"`\n    Pass  string `json:\"pass\" bson:\"pass\"`\n}\n\nsession := dbConnect()\ncollection := session.DB(\"my_db\").C(\"users\")\nvar users []User\nerr := collection.Find(nil).All(&amp;users)\nif err != nil {\n    log.Fatal(\"Mongo collection find fail: \", err)\n}\nfmt.Println(\"Results &gt;&gt; \", err)\n</code></pre>\n\n<p>The thing is \"err\" returns <code>&lt;nil&gt;</code>. Something weird is that inserting documents on the database actually works. Thank you!</p>\n"}, {"tags": ["sqlite", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "edited": false, "score": 0, "creation_date": 1476190821, "post_id": 39974252, "comment_id": 67234281, "body": "Many thanks for that, but i got nothing as result, but needed phones entry with id 3."}, {"owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "reply_to_user": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "edited": false, "score": 0, "creation_date": 1476191924, "post_id": 39974252, "comment_id": 67234997, "body": "I&#39;ve updated my answer with logging / error checking - can you try again?"}, {"owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "edited": false, "score": 0, "creation_date": 1476294226, "post_id": 39974252, "comment_id": 67287995, "body": "Ahh I needed some more where .Where(&quot;user_phones.id is null&quot;). :)"}], "tags": [], "owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "is_accepted": true, "score": 0, "last_activity_date": 1476201116, "last_edit_date": 1476201116, "creation_date": 1476178158, "answer_id": 39974252, "question_id": 39964882, "link": "https://stackoverflow.com/questions/39964882/select-all-which-not-in-related-table/39974252#39974252", "title": "Select all which not in related table", "body": "<p>I got this to work using a join rather than gorm's <em>related</em>. Perhaps not idiomatic gorm, but I never have any luck with the advanced relationships in gorm.</p>\n\n<pre><code>Gdb.LogMode(true)\n\nif err := Gdb.Joins(\"left join user_phones on phones.id=user_phones.phone_id\").Order(\"id desc\").Where(\"status = ?\", true).Not(\"user_phones.user_id = ?\", user.Id).Find(&amp;phones).Error; err != nil {\n    fmt.Printf(\"%v\\n\", err)\n} else {\n    fmt.Printf(\"result = %+v\\n\", phones)\n}\n</code></pre>\n\n<p>This produces the following SQL:</p>\n\n<pre><code>SELECT  `phones`.* FROM `phones` left join user_phones on phones.id=user_phones.phone_id WHERE (status = 'true') AND NOT (user_phones.user_id = '1') ORDER BY id desc\n</code></pre>\n\n<p>And output:</p>\n\n<pre><code>result = [{Id:3 Number:1045}]\n</code></pre>\n\n<p>I used mysql as that's what I'm used to, but I can't see sqlite being any different.</p>\n"}], "owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 870, "favorite_count": 0, "accepted_answer_id": 39974252, "answer_count": 1, "score": 0, "last_activity_date": 1606916907, "creation_date": 1476125427, "last_edit_date": 1606916907, "question_id": 39964882, "link": "https://stackoverflow.com/questions/39964882/select-all-which-not-in-related-table", "title": "Select all which not in related table", "body": "<p>for example I have the following gorm objects in tables.</p>\n<pre><code>user\n+----+------+\n| id | name |\n+----+------+\n| 1  | John |\n+----+------+\n| 2  | Jane |\n+----+------+\n\nphones\n+----+------+\n| id |number|\n+----+------+\n| 1  | 0945 |\n+----+------+\n| 2  | 0950 |\n+----+------+\n| 3  | 1045 |\n+----+------+\n\nuser_phones\n+----+-------+--------+\n| id |user_id|phone_id|\n+----+-------+--------+\n| 1  | 1     | 1      |\n+----+-------+--------+\n| 2  | 1     | 2      |\n+----+-------+--------+\n| 3  | 2     | 3      |\n+----+-------+--------+\n</code></pre>\n<p>With gorm I would like select all phones which not given user is.\nSomething like: select * phones where user_phones.user_id != 1\nThats what I tried:</p>\n<pre><code>Gdb.Order(&quot;id desc&quot;).Where(&quot;status = ?&quot;, true).Find(&amp;phones).Related(&quot;UserPhones&quot;).Not(&quot;UserPhones.User.ID = ?&quot;, user.ID)\n</code></pre>\n"}, {"tags": ["json", "mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1476124560, "creation_date": 1476124560, "answer_id": 39964649, "question_id": 39964166, "link": "https://stackoverflow.com/questions/39964166/stream-straight-from-mgo-result-to-json-without-unserializing-to-struct-in-go/39964649#39964649", "title": "Stream straight from mgo result to json without unserializing to struct in go", "body": "<p>Decode the result to an <code>interface{}</code>.  Encode the <code>interface{}</code> as JSON.</p>\n\n<pre><code>var v interface{}\nif err := c.Find(query).One(&amp;v); err != nil {\n   // handle error\n}\np, err := json.Marshal(v)\nif err != nil {\n   // handle error\n}\n\n// p is []byte containing the JSON\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 165, "user_id": 4446276, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/e5a3f1799f648d453d1a304df5549b3a?s=128&d=identicon&r=PG&f=1", "display_name": "P456678", "link": "https://stackoverflow.com/users/4446276/p456678"}, "edited": false, "score": 0, "creation_date": 1477316399, "post_id": 39969927, "comment_id": 67703074, "body": "thanks, this seems slower than putting it into a struct, I thought it would have been faster."}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 1, "last_activity_date": 1476155292, "creation_date": 1476155292, "answer_id": 39969927, "question_id": 39964166, "link": "https://stackoverflow.com/questions/39964166/stream-straight-from-mgo-result-to-json-without-unserializing-to-struct-in-go/39969927#39969927", "title": "Stream straight from mgo result to json without unserializing to struct in go", "body": "<p>The method <a href=\"https://godoc.org/labix.org/v2/mgo#Query.One\" rel=\"nofollow\">One()</a> according with the documentation: <em>executes the query and unmarshals the first obtained document into the result argument</em>, so it's doing the Marshal anyways, but we can \"trick\" it using the type <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow\">json.RawMessage</a> that is just a slice of bytes and it's in the std library.</p>\n\n<pre><code>var result json.RawMessage\n\nif err := c.Find(query).One(&amp;result); err != nil { ... }\n</code></pre>\n\n<p>There's a full example <a href=\"https://play.golang.org/p/IR1_O87SHv\" rel=\"nofollow\">here</a> about RawMessage.</p>\n"}], "owner": {"reputation": 165, "user_id": 4446276, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/e5a3f1799f648d453d1a304df5549b3a?s=128&d=identicon&r=PG&f=1", "display_name": "P456678", "link": "https://stackoverflow.com/users/4446276/p456678"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1476155292, "creation_date": 1476122622, "question_id": 39964166, "link": "https://stackoverflow.com/questions/39964166/stream-straight-from-mgo-result-to-json-without-unserializing-to-struct-in-go", "title": "Stream straight from mgo result to json without unserializing to struct in go", "body": "<p>is there a way to go straight from an mgo result to a JSON byte array without having to serialize to a slice of structs first?</p>\n"}, {"tags": ["arrays", "json", "go"], "answers": [{"comments": [{"owner": {"reputation": 38, "user_id": 6949990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f883a2ec52bac5a5a9abcb3acc323a9?s=128&d=identicon&r=PG&f=1", "display_name": "sneeze", "link": "https://stackoverflow.com/users/6949990/sneeze"}, "edited": false, "score": 0, "creation_date": 1476121658, "post_id": 39962365, "comment_id": 67207625, "body": "Thanks Ainar-G, but this appears to have the structure of     &quot;nestedarray&quot;: [         {             &quot;address&quot;: {&quot;street&quot;: &quot;foo&quot;},             &quot;phone&quot;: {&quot;cell&quot;: &quot;&quot;}         },         {             &quot;address&quot;: {&quot;street&quot;: &quot;&quot;},             &quot;phone&quot;: {&quot;cell&quot;: &quot;bar&quot;}         }     ]`"}, {"owner": {"reputation": 38, "user_id": 6949990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f883a2ec52bac5a5a9abcb3acc323a9?s=128&d=identicon&r=PG&f=1", "display_name": "sneeze", "link": "https://stackoverflow.com/users/6949990/sneeze"}, "edited": false, "score": 0, "creation_date": 1476195075, "post_id": 39962365, "comment_id": 67237275, "body": "Ainar-G, Thanks again, I was able to modify your answer a bit using interfaces, and with your help I believe I am close to a solution. The last piece to my puzzle is this. How do I append? <a href=\"https://play.golang.org/p/0i0t8O_KrN\" rel=\"nofollow noreferrer\">play.golang.org/p/0i0t8O_KrN</a> Thanks!"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 38, "user_id": 6949990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f883a2ec52bac5a5a9abcb3acc323a9?s=128&d=identicon&r=PG&f=1", "display_name": "sneeze", "link": "https://stackoverflow.com/users/6949990/sneeze"}, "edited": false, "score": 1, "creation_date": 1476196222, "post_id": 39962365, "comment_id": 67238083, "body": "@sneeze You don&#39;t need interfaces here, pointers are enough. Also, when you append, you should use a value, not a slice. <a href=\"https://play.golang.org/p/hs4SGHSn7Q\" rel=\"nofollow noreferrer\">play.golang.org/p/hs4SGHSn7Q</a>"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1476115657, "creation_date": 1476115657, "answer_id": 39962365, "question_id": 39962222, "link": "https://stackoverflow.com/questions/39962222/how-do-i-populate-and-append-a-nested-array-in-json-using-golang/39962365#39962365", "title": "How do I populate and append a nested array in JSON using golang?", "body": "<p>Instead of defining <code>NestedArray</code> as a slice of anonymous structs, it's better to redefine it in <code>JSONDoc</code> as such:</p>\n\n<pre><code>type JSONDoc struct {\n    JustArray    []string          `json:\"justanarray\"`\n    NestedString NestedString      `json:\"nestedstring\"`\n    NestedArray  []NestedArrayElem `json:\"nestedarray\"`\n}\n\n//Nested array\ntype NestedArrayElem struct {\n    Address Address `json:\"address,omitempty\"`\n    Phone   Phone   `json:\"phone,omitempty\"`\n}\n</code></pre>\n\n<p>Then, you can do:</p>\n\n<pre><code>res2B := &amp;JSONDoc{}\nres2B.NestedArray = []NestedArrayElem{\n    {Address: Address{Street: \"foo\"}},\n    {Phone: Phone{Cell: \"bar\"}},\n}\nMarshalIt(res2B)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/_euwT-TEWp\" rel=\"nofollow\">https://play.golang.org/p/_euwT-TEWp</a>.</p>\n"}], "owner": {"reputation": 38, "user_id": 6949990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f883a2ec52bac5a5a9abcb3acc323a9?s=128&d=identicon&r=PG&f=1", "display_name": "sneeze", "link": "https://stackoverflow.com/users/6949990/sneeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1584, "favorite_count": 0, "accepted_answer_id": 39962365, "answer_count": 1, "score": 1, "last_activity_date": 1476115657, "creation_date": 1476115224, "question_id": 39962222, "link": "https://stackoverflow.com/questions/39962222/how-do-i-populate-and-append-a-nested-array-in-json-using-golang", "title": "How do I populate and append a nested array in JSON using golang?", "body": "<p>I am trying to learn how to create and manipulate JSON in this format on the fly using golang:</p>\n\n<pre><code>{ \n\"justanarray\": [ \n    \"One\", \n    \"Two\" \n], \n\"nestedstring\": {\"name\": {\"first\": \"Dave\"}}, \n\"nestedarray\": [ \n    {\"address\": {\"street\": \"Central\"}},  \n    {\"phone\": {\"cell\": \"(012)-345-6789\"}}  \n] \n} \n</code></pre>\n\n<p>I can create and manipulate everything but the nested array.</p>\n\n<p>Here is a play for the code below. <a href=\"https://play.golang.org/p/pxKX4IOE8v\" rel=\"nofollow\">https://play.golang.org/p/pxKX4IOE8v</a></p>\n\n<pre><code>package main \n\nimport ( \n        \"fmt\" \n        \"encoding/json\" \n) \n\n\n\n\n\n//############ Define Structs ################ \n\n//Top level of json doc \ntype JSONDoc struct { \n        JustArray   []string    `json:\"justanarray\"` \n    NestedString    NestedString    `json:\"nestedstring\"` \n        NestedArray []NestedArray   `json:\"nestedarray\"` \n\n\n} \n\n//nested string \ntype NestedString struct { \n        Name   Name   `json:\"name\"` \n} \ntype Name struct { \n        First string `json:\"first\"` \n} \n\n//Nested array \ntype NestedArray []struct { \n        Address   Address   `json:\"address,omitempty\"` \n        Phone Phone `json:\"phone,omitempty\"` \n} \ntype Address struct { \n        Street string `json:\"street\"` \n} \ntype Phone struct { \n        Cell string `json:\"cell\"` \n} \n\n\n\n\n\n\nfunc main() { \n\n        res2B := &amp;JSONDoc{} \n    fmt.Println(\"I can create a skeleton json doc\") \n    MarshalIt(res2B) \n\n    fmt.Println(\"\\nI can set value of top level key that is an array.\") \n        res2B.JustArray = []string{\"One\"} \n    MarshalIt(res2B)    \n\n    fmt.Println(\"\\nI can append this top level array.\") \n        res2B.JustArray = append(res2B.JustArray, \"Two\") \n    MarshalIt(res2B) \n\n    fmt.Println(\"\\nI can set value of a nested key.\") \n        res2B.NestedString.Name.First = \"Dave\" \n        MarshalIt(res2B) \n\n\n    fmt.Println(\"\\nHow in the heck do I populate, and append a nested array?\") \n\n\n} \n\nfunc MarshalIt(res2B *JSONDoc){ \n        res, _ := json.Marshal(res2B) \n        fmt.Println(string(res)) \n}\n</code></pre>\n\n<p>Thanks for any help.</p>\n"}, {"tags": ["windows", "winapi", "networking", "go", "dll"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476113504, "post_id": 39961171, "comment_id": 67203293, "body": "A Go string is not the same as a C string, and in this case the docs look like the fields are supposed to be wide chars (?), so those should probably be <code>*uint16</code> instead of string. You are also passing a pointer to a pointer to the syscall, which only requires a single pointer. get rid of the extra <code>&amp;</code> in the arguments."}, {"owner": {"reputation": 1166, "user_id": 211195, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/47ffd6538b8c1694db320e07af4397ff?s=128&d=identicon&r=PG", "display_name": "rosencreuz", "link": "https://stackoverflow.com/users/211195/rosencreuz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476173108, "post_id": 39961171, "comment_id": 67224808, "body": "Thanks for the tip. How do I convert the <code>*uint16</code> to a go string? I&#39;ve found <code>UTF16PtrFromString</code> doing the opposite conversion, but nothing to convert back."}], "answers": [{"comments": [{"owner": {"reputation": 1166, "user_id": 211195, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/47ffd6538b8c1694db320e07af4397ff?s=128&d=identicon&r=PG", "display_name": "rosencreuz", "link": "https://stackoverflow.com/users/211195/rosencreuz"}, "edited": false, "score": 0, "creation_date": 1476193473, "post_id": 39962998, "comment_id": 67236178, "body": "You are right. However there&#39;s still problem with the type of <code>lpszProxy</code>. <code>string</code> doesn&#39;t seem to be right. I tried <code>*uint16</code>, but I cannot find a way to convert it to string."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1476117918, "creation_date": 1476117918, "answer_id": 39962998, "question_id": 39961171, "link": "https://stackoverflow.com/questions/39961171/golang-winapi-call-with-struct-parameter/39962998#39962998", "title": "golang: winapi call with struct parameter", "body": "<p>You take the address of an address here:</p>\n\n<pre><code>// The type of settings is *WINHTTP_CURRENT_USER_IE_PROXY_CONFIG\nsettings := new(WINHTTP_CURRENT_USER_IE_PROXY_CONFIG)\n\n// ...\n\n// The type of &amp;settings is **WINHTTP_CURRENT_USER_IE_PROXY_CONFIG\nret, _, callErr := syscall.Syscall(uintptr(getIEProxy), nargs, uintptr(unsafe.Pointer(&amp;settings)), 0, 0)\n</code></pre>\n\n<p>Remove the <code>&amp;</code> from <code>Syscall</code> call an it should work.</p>\n"}, {"comments": [{"owner": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "edited": false, "score": 1, "creation_date": 1594809659, "post_id": 39978732, "comment_id": 111254796, "body": "Pro tip: string conversion is a lot easier with <code>syscall.UTF16ToString</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "edited": false, "score": 0, "creation_date": 1594821921, "post_id": 39978732, "comment_id": 111261500, "body": "@Rodrigo: It does not make it <i>a lot</i> easier, it only does half the work here of decoding the utf16, you still have a <code>*uint16</code> to <code>[]uint16</code> conversion to make, which is exactly what the unexported <code>utf16PtrToString</code> function does. Now that I think about it, I should just copy that function in since it doesn&#39;t leave the overflow prevention as an exercise for the reader."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1594822252, "last_edit_date": 1594822252, "creation_date": 1476193465, "answer_id": 39978732, "question_id": 39961171, "link": "https://stackoverflow.com/questions/39961171/golang-winapi-call-with-struct-parameter/39978732#39978732", "title": "golang: winapi call with struct parameter", "body": "<p>You need to pass a pointer to your allocated struct, which you already created with the <code>new</code> function. Remove the extra <code>&amp;</code> from the syscall; <code>uintptr(unsafe.Pointer(settings))</code></p>\n<p>You also need to have a struct that has the same layout as the C struct expected by the syscall. The struct definition looks like:</p>\n<pre><code>typedef struct {\n  BOOL   fAutoDetect;\n  LPWSTR lpszAutoConfigUrl;\n  LPWSTR lpszProxy;\n  LPWSTR lpszProxyBypass;\n} WINHTTP_CURRENT_USER_IE_PROXY_CONFIG;\n</code></pre>\n<p>Which should translate to</p>\n<pre><code>type WINHTTP_CURRENT_USER_IE_PROXY_CONFIG struct {\n    fAutoDetect       bool\n    lpszAutoConfigUrl *uint16\n    lpszProxy         *uint16\n    lpszProxyBypass   *uint16\n}\n</code></pre>\n<p>Each of those <code>LPWSTR</code> fields is going to be a null-terminated, 16bit/char string. For windows you can generally use the syscall <code>UTF16</code> functions, but here we first need to convert the <code>*uint16</code> to a <code>[]uint16</code> slice, then decode that slice to a utf8 string. There function that the syscall pakcage uses to do this isn't exported, but we can easily copy that:</p>\n<pre><code>// utf16PtrToString is like UTF16ToString, but takes *uint16\n// as a parameter instead of []uint16.\n// max is how many times p can be advanced looking for the null terminator.\n// If max is hit, the string is truncated at that point.\nfunc utf16PtrToString(p *uint16, max int) string {\n    if p == nil {\n        return &quot;&quot;\n    }\n    // Find NUL terminator.\n    end := unsafe.Pointer(p)\n    n := 0\n    for *(*uint16)(end) != 0 &amp;&amp; n &lt; max {\n        end = unsafe.Pointer(uintptr(end) + unsafe.Sizeof(*p))\n        n++\n    }\n    s := (*[(1 &lt;&lt; 30) - 1]uint16)(unsafe.Pointer(p))[:n:n]\n    return string(utf16.Decode(s))\n}\n</code></pre>\n<p>Or use the exported version that was recently added to <code>golang.org/x/sys/windows</code>, <a href=\"https://pkg.go.dev/golang.org/x/sys/windows?tab=doc#UTF16PtrToString\" rel=\"nofollow noreferrer\"><code>windows.UTF16PtrToString</code></a>.</p>\n"}], "owner": {"reputation": 1166, "user_id": 211195, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/47ffd6538b8c1694db320e07af4397ff?s=128&d=identicon&r=PG", "display_name": "rosencreuz", "link": "https://stackoverflow.com/users/211195/rosencreuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1688, "favorite_count": 1, "accepted_answer_id": 39978732, "answer_count": 2, "score": 5, "last_activity_date": 1594822252, "creation_date": 1476111478, "question_id": 39961171, "link": "https://stackoverflow.com/questions/39961171/golang-winapi-call-with-struct-parameter", "title": "golang: winapi call with struct parameter", "body": "<p>I'm trying to call <code>WinHttpGetIEProxyConfigForCurrentUser</code> function to get the automatically detected IE proxy settings. It accepts an inout struct parameter according to <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa384096(v=vs.85).aspx\" rel=\"noreferrer\">documentation</a>. I'm using following code:</p>\n\n<pre><code>func GetProxySettings() {\n    winhttp, _ := syscall.LoadLibrary(\"winhttp.dll\")\n    getIEProxy, _ := syscall.GetProcAddress(winhttp, \"WinHttpGetIEProxyConfigForCurrentUser\")\n\n    settings := new(WINHTTP_CURRENT_USER_IE_PROXY_CONFIG)\n    var nargs uintptr = 1\n\n    ret, _, callErr := syscall.Syscall(uintptr(getIEProxy), nargs, uintptr(unsafe.Pointer(&amp;settings)), 0, 0)\n    fmt.Println(ret, callErr)\n    if settings != nil {\n        fmt.Println(settings.fAutoDetect)\n        fmt.Println(settings.lpszAutoConfigUrl)\n        fmt.Println(settings.lpszProxy)\n        fmt.Println(settings.lpszProxyBypass)\n    }\n}\n\ntype WINHTTP_CURRENT_USER_IE_PROXY_CONFIG struct {\n    fAutoDetect       bool\n    lpszAutoConfigUrl string\n    lpszProxy         string\n    lpszProxyBypass   string\n}\n</code></pre>\n\n<p>It looks like the call is successful, <code>settings</code> is not nil, but as soon as I access it I get panic. Here's the output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>1 The operation completed successfully.\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x1 pc=0x4d2bb4]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "is_accepted": true, "score": 1, "last_activity_date": 1476100625, "creation_date": 1476100625, "answer_id": 39957744, "question_id": 39957389, "link": "https://stackoverflow.com/questions/39957389/error-when-trying-to-build-transfer-sh/39957744#39957744", "title": "Error when trying to build transfer.sh", "body": "<p>run <code>go get github.com/dutchcoders/go-virustotal</code> it should download that package for you</p>\n"}], "owner": {"reputation": 1947, "user_id": 1475898, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/09d3a80a2c8bf17d4a755fcfd955efd8?s=128&d=identicon&r=PG", "display_name": "Comforse", "link": "https://stackoverflow.com/users/1475898/comforse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 39957744, "answer_count": 1, "score": 0, "last_activity_date": 1476100625, "creation_date": 1476099462, "question_id": 39957389, "link": "https://stackoverflow.com/questions/39957389/error-when-trying-to-build-transfer-sh", "title": "Error when trying to build transfer.sh", "body": "<p>I am trying to deploy a local instance of <a href=\"https://github.com/dutchcoders/transfer.sh\" rel=\"nofollow\">transfer.sh</a>.</p>\n\n<p>However, when I run:</p>\n\n<pre><code>go run transfersh-server/*.go -provider=local --port 8080 --temp=/tmp/ --basedir=/tmp/\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>transfersh-server/virustotal.go:30:2: cannot find package \"github.com/dutchcoders/go-virustotal\" in any of:\n    /usr/lib/go-1.6/src/github.com/dutchcoders/go-virustotal (from $GOROOT)\n    /usr/share/go/src/github.com/dutchcoders/go-virustotal (from $GOPATH)\ntransfersh-server/handlers.go:56:2: cannot find package \"github.com/russross/blackfriday\" in any of:\n    /usr/lib/go-1.6/src/github.com/russross/blackfriday (from $GOROOT)\n    /usr/share/go/src/github.com/russross/blackfriday (from $GOPATH)\nroot@mmv:/home/mihai/transfer.sh# echo $GOROOT\n</code></pre>\n\n<p>The <code>$GOPATH</code> is:</p>\n\n<pre><code>/usr/share/go\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "polymer", "vaadin"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1476097117, "post_id": 39955057, "comment_id": 67192930, "body": "1. Find out <b>where</b> your code fails. 2. Make sure stuff like <code>&quot;.&#47;test&#47;&quot;+handler.Filename</code> actually produces something suitable for writing (e.g. ./test must exist)."}, {"owner": {"reputation": 419, "user_id": 4400203, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e5fea776f47fd32c002d302469cc952?s=128&d=identicon&r=PG&f=1", "display_name": "Saransh", "link": "https://stackoverflow.com/users/4400203/saransh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1476105512, "post_id": 39955057, "comment_id": 67197984, "body": "My code fails at this part file, handler, err := r.FormFile(&quot;uploadFile&quot;)"}, {"owner": {"reputation": 419, "user_id": 4400203, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e5fea776f47fd32c002d302469cc952?s=128&d=identicon&r=PG&f=1", "display_name": "Saransh", "link": "https://stackoverflow.com/users/4400203/saransh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1476105649, "post_id": 39955057, "comment_id": 67198082, "body": "That is what I want to know how do I handle this. I don&#39;t know what to write here FormFile(&quot;WHAT!!&quot;). Because of this the code is giving error"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1476106702, "post_id": 39955057, "comment_id": 67198804, "body": "Well, that&#39;s a vaadin-only question. Dump the request and see. Or track what your browser does with the developer tools of your browser."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1476154236, "post_id": 39955057, "comment_id": 67218960, "body": "May you add the full line of error? just to check what line is failing. Also I don&#39;t see the <b>name</b> field in your html tag, remember the value of the attribute <b>name</b> has to be the same for <code>r.FormFile(&quot;value_name&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 4400203, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e5fea776f47fd32c002d302469cc952?s=128&d=identicon&r=PG&f=1", "display_name": "Saransh", "link": "https://stackoverflow.com/users/4400203/saransh"}, "edited": false, "score": 0, "creation_date": 1476209359, "post_id": 39982229, "comment_id": 67246313, "body": "Thanks for the answer. Yes you are right. After posting this question I found some code same as your code for uploading without knowing the key value."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1535492950, "post_id": 39982229, "comment_id": 91083638, "body": "What headeache, I had the problem that only one file will upload and the others remain in cero bytes, thanks !!"}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 3, "last_activity_date": 1476203587, "creation_date": 1476203587, "answer_id": 39982229, "question_id": 39955057, "link": "https://stackoverflow.com/questions/39955057/not-able-to-save-uploaded-file-on-server-using-golang-and-polymer-http-no-such/39982229#39982229", "title": "Not able to save uploaded file on server using GOLANG and POLYMER http: no such file", "body": "<p>Did a quick test and it appears that the <code>vaadin-upload</code> uses <code>file</code> as the form data parameter name for the file. So in the line</p>\n\n<pre><code>file, handler, err := r.FormFile(\"uploadFile\")\n</code></pre>\n\n<p>replace <code>uploadFile</code> with <code>file</code> and it should work. </p>\n\n<p>It is <a href=\"https://vaadin.com/docs/-/part/elements/vaadin-upload/vaadin-upload-server.html\" rel=\"nofollow\">documented on the vaadin homepage</a> that</p>\n\n<blockquote>\n  <p>In order to support simultaneous uploads, instead of reusing the same FormData and XMLHttpRequest, we create a new one for each file. It is therefore alright for the server to only consider receiving one file per request.</p>\n</blockquote>\n\n<p>However, I didn't see the parameter name (<code>file</code>) documented, so to be safe you should write your code so that it wouldn't use the name, ie something like</p>\n\n<pre><code>r.ParseMultipartForm(32 &lt;&lt; 20)\nm := r.MultipartForm\nfor _, v := range m.File {\n    for _, f := range v {\n        file, err := f.Open()\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer file.Close()\n        // do something with the file data\n        ...\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2891, "user_id": 874249, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fOtzh.jpg?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/874249/justin"}, "edited": false, "score": 0, "creation_date": 1603524458, "post_id": 39983904, "comment_id": 114069773, "body": "Thank you for your final implementation. While posting your final solution for future programmers is very good, the accepted answer should go to @ain."}], "tags": [], "owner": {"reputation": 419, "user_id": 4400203, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e5fea776f47fd32c002d302469cc952?s=128&d=identicon&r=PG&f=1", "display_name": "Saransh", "link": "https://stackoverflow.com/users/4400203/saransh"}, "is_accepted": true, "score": 3, "last_activity_date": 1476209599, "creation_date": 1476209599, "answer_id": 39983904, "question_id": 39955057, "link": "https://stackoverflow.com/questions/39955057/not-able-to-save-uploaded-file-on-server-using-golang-and-polymer-http-no-such/39983904#39983904", "title": "Not able to save uploaded file on server using GOLANG and POLYMER http: no such file", "body": "<p><strong>Answering my own question for those who are facing same problem. Found out some code which can access file without knowing the key value.</strong></p>\n\n<pre><code>func UploadHandler(res http.ResponseWriter, req *http.Request) {  \n      var (  \n           status int  \n           err  error  \n      )  \n      defer func() {  \n           if nil != err {  \n                http.Error(res, err.Error(), status)  \n           }  \n      }()  \n      // parse request  \n     // const _24K = (1 &lt;&lt; 20) * 24  \n      if err = req.ParseMultipartForm(32 &lt;&lt; 20); nil != err {  \n           status = http.StatusInternalServerError  \n           return  \n      } \n        fmt.Println(\"No memory problem\")\n      for _, fheaders := range req.MultipartForm.File {  \n           for _, hdr := range fheaders {  \n                // open uploaded  \n                var infile multipart.File  \n                if infile, err = hdr.Open(); nil != err {  \n                     status = http.StatusInternalServerError  \n                     return  \n                }  \n                // open destination  \n                var outfile *os.File  \n                if outfile, err = os.Create(\"./uploaded/\" + hdr.Filename); nil != err {  \n                     status = http.StatusInternalServerError  \n                     return  \n                }  \n                // 32K buffer copy  \n                var written int64  \n                if written, err = io.Copy(outfile, infile); nil != err {  \n                     status = http.StatusInternalServerError  \n                     return  \n                }  \n                res.Write([]byte(\"uploaded file:\" + hdr.Filename + \";length:\" + strconv.Itoa(int(written))))  \n           }  \n      }  \n } \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49, "user_id": 8767544, "user_type": "registered", "profile_image": "https://graph.facebook.com/1462728897114582/picture?type=large", "display_name": "Anurag Shinde", "link": "https://stackoverflow.com/users/8767544/anurag-shinde"}, "is_accepted": false, "score": 0, "last_activity_date": 1556830627, "last_edit_date": 1556830627, "creation_date": 1556813297, "answer_id": 55956363, "question_id": 39955057, "link": "https://stackoverflow.com/questions/39955057/not-able-to-save-uploaded-file-on-server-using-golang-and-polymer-http-no-such/55956363#55956363", "title": "Not able to save uploaded file on server using GOLANG and POLYMER http: no such file", "body": "<p>Use exactly the same name for doing r.FormFile(\"selectedFile\") that is there in your HTML tag. The key is mapped to input name used in your frontend HTML tag. </p>\n\n<p>Below is my implementation:</p>\n\n<pre><code>&lt;file\n    type=\"file\"\n    name=\"selectedFile\"\n/&gt;\n\nconst (\n    S3_REGION = \"Your region\"\n    S3_BUCKET = \"Your Bucket Name\"\n)\n\nfunc uploadFile(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Uploading File\")\n    r.ParseMultipartForm(32 &lt;&lt; 20)\n\n    file, handler, err := r.FormFile(\"selectedFile\") // \n    if err != nil {\n            fmt.Println(\"Error Retrieving the File\")\n            fmt.Println(err)\n            return\n    }\n\n    defer file.Close()\n\n    fmt.Printf(\"Uploaded File: %+v\\n\", handler.Filename)\n    fmt.Printf(\"File Size: %+v\\n\", handler.Size)\n    fmt.Printf(\"MIME Header: %+v\\n\", handler.Header)\n\n    s, err := session.NewSession(&amp;aws.Config{Region: aws.String(S3_REGION)})\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var size int64 = handler.Size\n    buffer := make([]byte, size)\n    file.Read(buffer)\n\n    _, err = s3.New(s).PutObject(&amp;s3.PutObjectInput{\n        Bucket:               aws.String(S3_BUCKET),\n        Key:                  aws.String(handler.Filename),\n        ACL:                  aws.String(\"private\"),\n        Body:                 bytes.NewReader(buffer),\n        ContentLength:        aws.Int64(size),\n        ContentType:          aws.String(http.DetectContentType(buffer)),\n        ContentDisposition:   aws.String(\"attachment\"),\n        ServerSideEncryption: aws.String(\"AES256\"),\n    })       \n}\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 4400203, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e5fea776f47fd32c002d302469cc952?s=128&d=identicon&r=PG&f=1", "display_name": "Saransh", "link": "https://stackoverflow.com/users/4400203/saransh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4983, "favorite_count": 0, "accepted_answer_id": 39983904, "answer_count": 3, "score": 5, "last_activity_date": 1556830627, "creation_date": 1476091207, "question_id": 39955057, "link": "https://stackoverflow.com/questions/39955057/not-able-to-save-uploaded-file-on-server-using-golang-and-polymer-http-no-such", "title": "Not able to save uploaded file on server using GOLANG and POLYMER http: no such file", "body": "<p>I am using vaadin upload to upload files on web application with polymer. And I am using golang for back-end.</p>\n\n<pre><code>&lt;vaadin-upload target=\"../upload\" max-files=\"20\" accept=\"application/pdf,image/*\" \nmethod=\"POST\"&gt; &lt;/vaadin-upload&gt;\n</code></pre>\n\n<p>I checked that encoding type used in vaadin upload is <strong>multipart/form-data</strong>.\nMy golang code is below.</p>\n\n<pre><code>func upload(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method)\n    if r.Method == \"GET\" {\n        crutime := time.Now().Unix()\n        h := md5.New()\n        io.WriteString(h, strconv.FormatInt(crutime, 10))\n        token := fmt.Sprintf(\"%x\", h.Sum(nil))\n\n        t, _ := template.ParseFiles(\"upload.gtpl\")\n        t.Execute(w, token)\n    } else {\n        r.ParseMultipartForm(32 &lt;&lt; 20)\n        file, handler, err := r.FormFile(\"uploadFile\")\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer file.Close()\n        fmt.Fprintf(w, \"%v\", handler.Header)\n        f, err := os.OpenFile(\"./test/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer f.Close()\n        io.Copy(f, file)\n    }\n}\n</code></pre>\n\n<p>It gives error on server side <strong>http: no such file</strong>. I checked this error is returned by FormFile when the provided file field name is either not present in the request or not a file field.</p>\n\n<p><strong>How do I correct my form file name</strong>. Although everything seems fine on front-end\n<a href=\"https://i.stack.imgur.com/ToTU9.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/ToTU9.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["http", "go", "https", "simplehttpserver"], "comments": [{"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 2, "creation_date": 1476091285, "post_id": 39954859, "comment_id": 67189763, "body": "Every new session requires a full SSL negotiation. That would provide ~1-10 MB/s of extra network bandwidth just from the SSL certificates (so .1% to 1% of just the file transfers). It also adds a couple of round-trips and some public-key cryptography, which is most likely the heaviest hitter."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476106007, "post_id": 39954859, "comment_id": 67198322, "body": "You haven&#39;t included anything here about how you&#39;re configuring &quot;large packets&quot; (do you mean jumbo frames?), but you are essentially making more requests than the server can handle. If 1000req/s saturates the connection with HTTP, you simply can&#39;t make the same number of requests with HTTPS."}, {"owner": {"reputation": 33, "user_id": 6767074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29ef5865f6806ab604df98299743b56?s=128&d=identicon&r=PG&f=1", "display_name": "Pieterjan Lambein", "link": "https://stackoverflow.com/users/6767074/pieterjan-lambein"}, "edited": false, "score": 0, "creation_date": 1476173954, "post_id": 39954859, "comment_id": 67225222, "body": "No not jumbo frames, just normal packets sending a large file (1MB). Okay thanks, I just didn&#39;t quite expect the TLS overhead to be this big!"}], "owner": {"reputation": 33, "user_id": 6767074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29ef5865f6806ab604df98299743b56?s=128&d=identicon&r=PG&f=1", "display_name": "Pieterjan Lambein", "link": "https://stackoverflow.com/users/6767074/pieterjan-lambein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 273, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1476090483, "creation_date": 1476090483, "question_id": 39954859, "link": "https://stackoverflow.com/questions/39954859/golang-https-can-not-handle-large-packets", "title": "Golang HTTPS can not handle large packets", "body": "<p>I'm stress testing a simple HTTPS Golang web server which looks like this:</p>\n\n<pre><code>func main() {\n    srv := &amp;http.Server{\n        Addr:         \":\" + port,\n        ReadTimeout:  5 * time.Second,\n        WriteTimeout: 10 * time.Second,\n    }\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/bigpacket\", bigpacket)\n    srv.Handler = mux\n\n    log.Fatalln(srv.ListenAndServeTLS(certPath+\"cert.pem\", certPath+\"key.pem\"))\n}\n\n// Sends 1MB file\nfunc bigpacket(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"./bigpacket\")\n}\n</code></pre>\n\n<p>So it's just a very basic server, which returns a 1MB file on the url: /bigpacket. The test I'm running does 1000 requests per second (so about 1GB per second is send over the connection) for 30 seconds.</p>\n\n<p>When testing this, only about 30% of the requests are successful! However, when I switch to HTTP (by using <code>log.Fatalln(srv.ListenAndServe())</code>) all requests are successful.. (100%)\nCould these results be correct? Has HTTPS that much overhead over HTTP?</p>\n\n<p>These are the errors I get:</p>\n\n<pre><code>read tcp 10.132.0.4:36248-&gt;10.132.0.3:8080: read: connection reset by peer\nunexpected EOF\nGet https://10.132.0.3:8080/bigpacket: unexpected EOF\nread tcp 10.132.0.4:34573-&gt;10.132.0.3:8080: read: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: read tcp 10.132.0.4:34573-&gt;10.132.0.3:8080: read: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: write tcp 10.132.0.4:38955-&gt;10.132.0.3:8080: write: broken pipe\nGet https://10.132.0.3:8080/bigpacket: http2: no cached connection was available\nGet https://10.132.0.3:8080/bigpacket: read tcp 10.132.0.4:59658-&gt;10.132.0.3:8080: read: connection reset by peer\nread tcp 10.132.0.4:59658-&gt;10.132.0.3:8080: read: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: write tcp 10.132.0.4:57612-&gt;10.132.0.3:8080: write: connection reset by peer\nread tcp 10.132.0.4:48971-&gt;10.132.0.3:8080: read: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: write tcp 10.132.0.4:42138-&gt;10.132.0.3:8080: write: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: write tcp 10.132.0.4:33734-&gt;10.132.0.3:8080: write: broken pipe\nread tcp 10.132.0.4:55605-&gt;10.132.0.3:8080: read: connection reset by peer\nread tcp 10.132.0.4:34132-&gt;10.132.0.3:8080: read: connection reset by peer\nread tcp 10.132.0.4:59141-&gt;10.132.0.3:8080: read: connection reset by peer\nGet https://10.132.0.3:8080/bigpacket: read tcp 10.132.0.4:59141-\n</code></pre>\n"}, {"tags": ["http", "go", "dns", "webserver"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "edited": false, "score": 0, "creation_date": 1476084906, "post_id": 39953022, "comment_id": 67186473, "body": "Yes , I saw that, but it&#39;s subdomain and it&#39;s in the same program , I want a way to handler domains with multi-programs. But I don&#39;t know how can I run two or three programs on port 80. Thanks for your answer"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "edited": false, "score": 0, "creation_date": 1476090931, "post_id": 39953022, "comment_id": 67189561, "body": "what you need is a reverse proxy or a load balance"}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1476083798, "creation_date": 1476083798, "answer_id": 39953022, "question_id": 39952707, "link": "https://stackoverflow.com/questions/39952707/is-it-possible-to-handle-multi-domains-in-golang/39953022#39953022", "title": "Is it possible to handle multi domains in Golang?", "body": "<p>Yes, it's possible since the domain is in the URL you can filter easily which handler you want to use. I found this guide <a href=\"http://codepodu.com/subdomains-with-golang/\" rel=\"nofollow\">http://codepodu.com/subdomains-with-golang/</a></p>\n"}, {"comments": [{"owner": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "edited": false, "score": 1, "creation_date": 1476091583, "post_id": 39954131, "comment_id": 67189917, "body": "Great ! That was what I want !"}], "tags": [], "owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "is_accepted": true, "score": 8, "last_activity_date": 1476087974, "creation_date": 1476087974, "answer_id": 39954131, "question_id": 39952707, "link": "https://stackoverflow.com/questions/39952707/is-it-possible-to-handle-multi-domains-in-golang/39954131#39954131", "title": "Is it possible to handle multi domains in Golang?", "body": "<p>Your Go programs can't all listen on port 80. You'd need something in front, like <a href=\"http://nginx.org/\" rel=\"noreferrer\">nginx</a>, to act as a reverse proxy. The following nginx config excerpt would forward two domains on to two different programs, each listening on different ports:</p>\n\n<pre><code>server {\n        listen 80;\n        server_name www.domain1.com;\n\n        location / {\n                proxy_pass http://127.0.0.1:8080;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header Host            $host;\n                proxy_read_timeout 600s;\n        }\n\n}  \n\nserver {\n        listen 80;\n        server_name www.domain2.com;\n\n        location / {\n                proxy_pass http://127.0.0.1:8081;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header Host            $host;\n                proxy_read_timeout 600s;\n        }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": false, "score": 2, "last_activity_date": 1476090646, "last_edit_date": 1495540498, "creation_date": 1476090646, "answer_id": 39954887, "question_id": 39952707, "link": "https://stackoverflow.com/questions/39952707/is-it-possible-to-handle-multi-domains-in-golang/39954887#39954887", "title": "Is it possible to handle multi domains in Golang?", "body": "<p>You don't really need anything in front, like nginx,\nalthough in some cases it is recommended. </p>\n\n<p>Please find similar answer here \"<a href=\"https://stackoverflow.com/questions/39894171/host-multiple-golang-sites-on-one-ip-and-serve-depending-on-domain-request\">Host Multiple Golang Sites on One IP and Serve Depending on Domain Request</a>\"</p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 6712424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BXE5L.jpg?s=128&g=1", "display_name": "Sarkar", "link": "https://stackoverflow.com/users/6712424/sarkar"}, "is_accepted": false, "score": 1, "last_activity_date": 1531556726, "creation_date": 1531556726, "answer_id": 51336698, "question_id": 39952707, "link": "https://stackoverflow.com/questions/39952707/is-it-possible-to-handle-multi-domains-in-golang/51336698#51336698", "title": "Is it possible to handle multi domains in Golang?", "body": "<p>I use both but Prefer second solution the most :</p>\n\n<ol>\n<li><p>nginx as proxy having multiple Golang app on multiple port\ni.e. GoApp1:8081 GoApp2:8082 GoApp3:8083 ....</p>\n\n<p>server {\n       ...\n       server_name www.example1.com example1.com;\n       ...\n       location / {\n          proxy_pass app_ip:8081;\n       }\n       ...\n    }\n    server {\n       ...\n       server_name www.example2.com example2.com;\n       ...\n       location / {\n          proxy_pass app_ip:8082;\n       }\n       ...\n    }\n    .\n    .\n    .</p></li>\n<li><p>nginx as proxy having multiple Golang app on same port(8081)\nseparating by(Golang) func (u *URL) Hostname() string</p>\n\n<p>server {\n   ...\n   server_name www.example1.com example1.com;\n   ...\n   location / {\n      proxy_pass app_ip:8081;\n   }\n   ...\n}</p></li>\n</ol>\n\n<p>There is another way around(without nginx):\nsudo apt-get install iptables-persistent</p>\n\n<pre><code>sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8081\nsudo netfilter-persistent save\nsudo netfilter-persistent reload\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3893, "favorite_count": 2, "accepted_answer_id": 39954131, "answer_count": 4, "score": 2, "last_activity_date": 1531556726, "creation_date": 1476082447, "question_id": 39952707, "link": "https://stackoverflow.com/questions/39952707/is-it-possible-to-handle-multi-domains-in-golang", "title": "Is it possible to handle multi domains in Golang?", "body": "<p>I want to handle multi-domains with Golang. </p>\n\n<p>Like this , If browser sends request for <a href=\"http://sampledomain.me\" rel=\"nofollow\">http://sampledomain.me</a> handles it with specific Golang program , </p>\n\n<p>In other cases , I want many programs on one server and tell each one of them , to handle each domain.</p>\n\n<p>All programs are listening on 80 and many domains point to one server.</p>\n\n<p>Can anybody help me ? </p>\n\n<p>Thx...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476108094, "post_id": 39952080, "comment_id": 67199733, "body": "You&#39;re converting an <code>int</code> to a <code>float64</code>, then using <code>math.Floor</code> on what is already an even integer value, then converting it back to an <code>int</code>. None of that does anything useful, just use the original integer division result."}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476118082, "post_id": 39952080, "comment_id": 67205799, "body": "@JimB Good catch, that was rather amateur of me"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1476108984, "post_id": 39952363, "comment_id": 67200318, "body": "You don&#39;t need to make the temp slice, the documented method for slice insertion is fine (you can keep the short circuit if you&#39;d like). I also wouldn&#39;t accept an invalid index value and return the incorrect result. Indexing out of range should panic or at least provide an error, not silently create the wrong slice. <a href=\"https://play.golang.org/p/dLeNTmYKM7\" rel=\"nofollow noreferrer\">play.golang.org/p/dLeNTmYKM7</a>"}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476118256, "post_id": 39952363, "comment_id": 67205870, "body": "@JimB can you explain why my original attempt to &#39;grow&#39; the slice was not instantiating a new slice with larger memory capacity?"}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476118503, "post_id": 39952363, "comment_id": 67205998, "body": "@abhink The reason I utilized pointers to the original slice was I wanted to limit my memory footprint. Do you think there is anyway to expand without copying to a new slice everytime? Also, JimB stated that you could go without the tmp declaration. If that is true I am assuming it would be viable to just declare:  copy(tmp, slice[:index+1])  ?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 1, "creation_date": 1476124031, "post_id": 39952363, "comment_id": 67208692, "body": "@Rice Since you are doing random insertions to your array, it&#39;ll always be linear time. Because arrays (or slices here) are contiguous blocks of memory, you cannot insert something in the middle without moving every subsequent element of the array one place over. So extensive copying will be required. If you don&#39;t need random access (i.e. slice element access is always linear, from beginning to end), you can try using a linked list type structures. Also, JimB&#39;s answer is similar to mine but better implemented so use that if you have to."}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476124647, "post_id": 39952363, "comment_id": 67208999, "body": "@abhink Thank you so much for the guided example/explanation. Very helpful"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1476080735, "creation_date": 1476080735, "answer_id": 39952363, "question_id": 39952080, "link": "https://stackoverflow.com/questions/39952080/expanding-a-slices-size-to-prevent-slice-bounds-out-of-range-error/39952363#39952363", "title": "Expanding a slice&#39;s size to prevent slice bounds out of range error", "body": "<p>First of all, a slice is already a reference type. So you don't need to pass its pointer around if you are not going to change its capacity. So your <code>main</code> can be simplified as:</p>\n\n<pre><code>func main() {\n    fileInputBytes, err := ioutil.ReadFile(\"/tmp/test\")\n    byteSize2 := len(fileInputBytes)\n\n    // No need to use pointer to slice. If you want a brand new slice\n    // that does not affect the original slice values, use copy()\n    inputFileByteArray := fileInputBytes\n    var numberOfIndexes = math.Floor(float64(byteSize / indexingOffset))\n\n    for i := 1; i &lt;= int(numberOfIndexes); i++ {\n        var v int = (i * indexingOffset) + i\n\n        // Insert needs to return the newly updated slice reference\n        // which should be assigned in each iteration.\n        inputFileByteArray = Insert(inputFileByteArray, v+i, indexingByteValue)\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>Then, the <code>Insert</code> function can be simplified simply by using <code>append</code> along with <code>copy</code> and returning the newly created slice:</p>\n\n<pre><code>func Insert(slice []byte, index int, value byte) []byte {\n    if index &gt;= len(slice) {\n        // add to the end of slice in case of index &gt;= len(slice)\n        return append(slice, value)\n    }\n    tmp := make([]byte, len(slice[:index + 1]))\n    copy(tmp, slice[:index])\n    tmp[index] = value\n    return append(tmp, slice[index:]...)\n}\n</code></pre>\n\n<p>This may not be the best implementation but it is simple enough. Example usage at: <a href=\"https://play.golang.org/p/Nuq4RX9XQD\" rel=\"nofollow\">https://play.golang.org/p/Nuq4RX9XQD</a></p>\n"}, {"comments": [{"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476119470, "post_id": 39963285, "comment_id": 67206538, "body": "By your logic (in the second function you wrote), the memory capacity also grows by the use of append?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476120022, "post_id": 39963285, "comment_id": 67206775, "body": "@Rice: I&#39;m not sure what you mean. These 2 functions are basically identical, and only differ in how you call them."}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476121290, "post_id": 39963285, "comment_id": 67207415, "body": "Sorry I need to be more specific. My simple need (originally) was to grow the actual memory capacity of the slice, not just the length. Will append do the job?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476121517, "post_id": 39963285, "comment_id": 67207550, "body": "@Rice: that&#39;s what append does. You can&#39;t grow the length beyond capacity, without increasing the capacity."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1476119974, "last_edit_date": 1476119974, "creation_date": 1476119017, "answer_id": 39963285, "question_id": 39952080, "link": "https://stackoverflow.com/questions/39952080/expanding-a-slices-size-to-prevent-slice-bounds-out-of-range-error/39963285#39963285", "title": "Expanding a slice&#39;s size to prevent slice bounds out of range error", "body": "<p>Your function only works if the slice happens to have enough initial capacity. If you need more capacity, you can only \"grow\" the slice using the <code>append</code> function. You can still use the <code>*[]byte</code> pointer argument to modify the slice in place like so:</p>\n\n<pre><code>func Insert(slice *[]byte, index int, value byte) {\n    *slice = append(*slice, 0)\n    copy((*slice)[index+1:], (*slice)[index:])\n    (*slice)[index] = value\n}\n</code></pre>\n\n<p>However, it's more customary to return a new slice value, and reassign it each time. This gives you a similar function signature to the builtin <code>append</code>.</p>\n\n<pre><code>func Insert(slice []byte, index int, value byte) []byte {\n    slice = append(slice, 0)\n    copy(slice[index+1:], slice[index:])\n    slice[index] = value\n    return slice\n}\n</code></pre>\n"}], "owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1476119974, "creation_date": 1476079162, "last_edit_date": 1476079981, "question_id": 39952080, "link": "https://stackoverflow.com/questions/39952080/expanding-a-slices-size-to-prevent-slice-bounds-out-of-range-error", "title": "Expanding a slice&#39;s size to prevent slice bounds out of range error", "body": "<p>I have written the following:</p>\n\n<pre><code>func main() {\n    //inside main        \n        fileInputBytes, err := ioutil.ReadFile(\"/tmp/test\")\n        byteSize2 := len(fileInputBytes)\n\n        var inputFileByteSlice = fileInputBytes[0:]\n        var numberOfIndexes = math.Floor(float64(byteSize / indexingOffset))\n\n        for i := 1; i &lt;= int(numberOfIndexes); i++ {\n            // adding i to the indexer insures that we use lookahed to ignore previously inserted indexing values\n            var v int = (i * indexingOffset) + i\n            Insert(&amp;inputFileByteSlice, v+i, indexingByteValue)\n            fmt.Println(i)\n        }\n    }\n    //outside main\n    //variation of https://blog.golang.org/slices with pointers and such\n        func Insert(slice *[]byte, index int, value byte) {\n            // Grow the slice by one element.\n            (*slice) = (*slice)[0 : len(*slice)+1]\n            // Use copy to move the upper part of the slice out of the way and open a hole.\n            copy((*slice)[index+1:], (*slice)[index:])\n            // Store the new value.\n            (*slice)[index] = value\n            // Return the result.\n        }\n</code></pre>\n\n<p>The <code>slice bounds out of range</code> error is getting on my nerves. The length of the slice grows outside of the size and overflows, the reason I don't understand is that I thought the call to 'grow' the slice by one element(before copy) will dynamically allocate more space. Since that is not the case, can anyone offer me a better suggestion?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "edited": false, "score": 3, "creation_date": 1476067938, "post_id": 39950643, "comment_id": 67181458, "body": "Hmm, seems to me <code>isPrime</code> will return true for all odd numbers and false for all even numbers."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6929867"}, "is_accepted": false, "score": 0, "last_activity_date": 1476068885, "creation_date": 1476068885, "answer_id": 39950777, "question_id": 39950643, "link": "https://stackoverflow.com/questions/39950643/prime-numbers-program-gives-wrong-answer/39950777#39950777", "title": "prime numbers program gives wrong answer", "body": "<p>As it is, your code is only checking if a number's parity and returning false if it is even. I don't actually know Go, but I did manage to work out this problem for you using the following code:</p>\n\n<pre><code>func isPrime(num int) bool {\n    for x := 2; x &lt; num; x++{\n        if num%x == 0 &amp;&amp; num!=2{\n            return false\n        }\n    }return true;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1503249257, "last_edit_date": 1503249257, "creation_date": 1476069034, "answer_id": 39950795, "question_id": 39950643, "link": "https://stackoverflow.com/questions/39950643/prime-numbers-program-gives-wrong-answer/39950795#39950795", "title": "prime numbers program gives wrong answer", "body": "<p>According to <a href=\"https://en.wikipedia.org/wiki/Prime_number\" rel=\"nofollow noreferrer\">prime number definition</a> <em>A prime number (or a prime) is a natural number greater than 1 that has no positive divisors other than 1 and itself</em>, in your code you're only checking if it's <strong>odd</strong> or not.</p>\n\n<p>I left you a fast solution in Go <a href=\"https://play.golang.org/p/2XXTUFbjhy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2XXTUFbjhy</a> It does only go until the square root of the number.</p>\n\n<pre><code>func isPrime(n int) bool {\n    if n &lt;= 1 {\n        return false\n    }\n    for ix, sqn := 2, int(math.Sqrt(float64(n))); ix &lt;= sqn; ix++ {\n        if n%ix == 0 {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>Also if you're interested in a faster way to know if a number is primer or not I recommend you read about the <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow noreferrer\">Sieve of Eratosthenes</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1476110142, "last_edit_date": 1476110142, "creation_date": 1476078123, "answer_id": 39951894, "question_id": 39950643, "link": "https://stackoverflow.com/questions/39950643/prime-numbers-program-gives-wrong-answer/39951894#39951894", "title": "prime numbers program gives wrong answer", "body": "<p>1- Here is the working version of your code: try it on <a href=\"https://play.golang.org/p/gFGlQiUFJE\" rel=\"nofollow noreferrer\">The Go Playground</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc isPrime(num int) bool {\n    if num &lt; 2 {\n        return false\n    }\n    for x := 2; x &lt; num; x++ {\n        if num%x == 0 {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Printf(\"is it a prime number: %v \\n\", isPrime(9))\n}\n</code></pre>\n\n<hr>\n\n<p>2- The only even prime is 2, so it is better to check it first:</p>\n\n<pre><code>if n == 2 {\n    return true\n}\n</code></pre>\n\n<p>Then there is no other even prime number: remove them all, and there is no prime number less than 2:</p>\n\n<pre><code>if n &lt; 2 || n&amp;1 == 0 {\n    return false\n}\n</code></pre>\n\n<p>and you don't need to check more than square root of <code>n</code>:</p>\n\n<pre><code>sqrt := int(math.Sqrt(float64(n)))\n</code></pre>\n\n<p>And now you may start from 3, with just odd numbers (<code>i += 2</code>):</p>\n\n<pre><code>for i := 3; i &lt;= sqrt; i += 2 {\n    if n%i == 0 {\n        return false\n    }\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/8UhlNO7u4e\" rel=\"nofollow noreferrer\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc isPrime(n int) bool {\n    if n == 2 {\n        return true\n    }\n    if n &lt; 2 || n&amp;1 == 0 {\n        return false\n    }\n    sqrt := int(math.Sqrt(float64(n)))\n    for i := 3; i &lt;= sqrt; i += 2 {\n        if n%i == 0 {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Printf(\"is it a prime number: %v \\n\", isPrime(9))\n    for i := 0; i &lt; 120; i++ {\n        if isPrime(i) {\n            fmt.Print(i, \" \")\n        }\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>is it a prime number: false \n2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97 101 103 107 109 113\n</code></pre>\n\n<hr>\n\n<p>See:<br>\n<a href=\"https://en.wikipedia.org/wiki/Prime_number\" rel=\"nofollow noreferrer\">Prime number</a><br>\n<a href=\"https://en.wikipedia.org/wiki/Generating_primes\" rel=\"nofollow noreferrer\">Generating primes</a>  </p>\n\n<p><a href=\"https://i.stack.imgur.com/TVcsK.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TVcsK.gif\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 53, "user_id": 1933049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8279d4f8ac73861eb97bd8de321d5b49?s=128&d=identicon&r=PG", "display_name": "user1933049", "link": "https://stackoverflow.com/users/1933049/user1933049"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 39951894, "answer_count": 3, "score": 1, "last_activity_date": 1503249257, "creation_date": 1476067592, "last_edit_date": 1476079095, "question_id": 39950643, "link": "https://stackoverflow.com/questions/39950643/prime-numbers-program-gives-wrong-answer", "title": "prime numbers program gives wrong answer", "body": "<p>I recently created a program which will tell you if a number is prime or not. It gets all answers right but the prime number of 9.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc isPrime(num int) bool {\n    for x := 2; x &gt; 1; x++ {\n        if num%2 == 0 {\n            return false\n        } else {\n            return true\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Printf(\"is it a prime number: %v \\n\", isPrime(9))\n}\n</code></pre>\n\n<p>What is the problem?<br>\nThanks in advance!</p>\n"}, {"tags": ["go", "formatting", "go-templates"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1476048156, "post_id": 39948383, "comment_id": 67177637, "body": "Are you sure you got the error? I copy-paste the template in <a href=\"https://play.golang.org/p/iNaEYCMn2D\" rel=\"nofollow noreferrer\">playground</a>, it works as expected. Probably you forgot to put <code>space</code> between <code>-</code> and <code>syntax</code>."}, {"owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 3, "creation_date": 1476052141, "post_id": 39948383, "comment_id": 67178630, "body": "Maybe your go version is too old? As far as I remember this is a new feature."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 1, "creation_date": 1476053352, "post_id": 39948383, "comment_id": 67178878, "body": "@SvenWalter you are correct, it was introduced <a href=\"https://golang.org/doc/go1.6#template\" rel=\"nofollow noreferrer\">since 1.6</a>"}, {"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1476079651, "post_id": 39948383, "comment_id": 67184222, "body": "@putu I&#39;ll double-check."}, {"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "reply_to_user": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 0, "creation_date": 1476118227, "post_id": 39948383, "comment_id": 67205863, "body": "@SvenWalter pebcak -- it was actually Go 1.5 running on that machine"}, {"owner": {"reputation": 116, "user_id": 2529547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aeb8c6947c394a9d7ae94afbda638a0d?s=128&d=identicon&r=PG", "display_name": "midacts", "link": "https://stackoverflow.com/users/2529547/midacts"}, "edited": false, "score": 0, "creation_date": 1589311467, "post_id": 39948383, "comment_id": 109242454, "body": "Adding the &quot;-&quot; before the if/end worked for me."}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "edited": false, "score": 0, "creation_date": 1476079734, "post_id": 39948718, "comment_id": 67184256, "body": "Technically, this solution is correct. However, I&#39;d like to keep the newlines in the template to improve readability."}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1476048431, "creation_date": 1476048431, "answer_id": 39948718, "question_id": 39948383, "link": "https://stackoverflow.com/questions/39948383/how-to-avoid-newlines-caused-by-conditionals/39948718#39948718", "title": "How to avoid newlines caused by conditionals?", "body": "<p>There is a new line because you're adding a new line after colons (:)</p>\n\n<p>This works <a href=\"https://play.golang.org/p/k4lazGhE-r\" rel=\"nofollow\">https://play.golang.org/p/k4lazGhE-r</a>\nNote I just start the first <strong>if</strong> right after the first colons</p>\n"}, {"comments": [{"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "edited": false, "score": 0, "creation_date": 1476118432, "post_id": 39953936, "comment_id": 67205960, "body": "I&#39;ll accept your answer as this is obviously how we expect to solve this since Go 1.6. +1 for also explaining variations. In my case, the problem was an old Go version floating around, which shouldn&#39;t normally happen."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1476092937, "last_edit_date": 1476092937, "creation_date": 1476087204, "answer_id": 39953936, "question_id": 39948383, "link": "https://stackoverflow.com/questions/39948383/how-to-avoid-newlines-caused-by-conditionals/39953936#39953936", "title": "How to avoid newlines caused by conditionals?", "body": "<p>In your first template, you have a newline after the static text <code>\"Let's say:\"</code>, and the 2nd line contains only the <code>{{if}}</code> action, and it also contains a newline, and its body <code>\"Hello, StackOverflow!\"</code> starts in the 3rd line. If this is rendered, there will be 2 newlines between the 2 static texts, so you'll see an empty line (as you posted).</p>\n\n<p>You may use <code>{{- if...</code> to get rid of the first newline, so when rendered, only 1 newline gets to the output, resulting in 2 different lines but no newlines between them:</p>\n\n<pre><code>Let's say:\n{{- if eq .Foo \"foo\" }}\nHello, StackOverflow!\n{{- else if eq .Foo \"bar\" }}\nHello, World!\n{{- end }}\n</code></pre>\n\n<p>Output when <code>Foo</code> is <code>\"foo\"</code>:</p>\n\n<pre><code>Let's say:\nHello, StackOverflow!\n</code></pre>\n\n<p>Output when <code>Foo</code> is <code>\"bar\"</code>:</p>\n\n<pre><code>Let's say:\nHello, World!\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/TN1o7qe778\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Note that this was added in <a href=\"https://golang.org/doc/go1.6#template\" rel=\"noreferrer\">Go 1.6: Template</a>, and is documented at <a href=\"https://golang.org/pkg/text/template/#hdr-Text_and_spaces\" rel=\"noreferrer\"><code>text/template</code>: Text and Spaces</a>.</p>\n\n<p>If you use the <code>-</code> sign at the closing of the actions <code>-}}</code>, you can even remove all the newlines:</p>\n\n<pre><code>Let's say:\n{{- if eq .Foo \"foo\" -}}\nHello, StackOverflow!\n{{- else if eq .Foo \"bar\" -}}\nHello, World!\n{{- end -}}\n</code></pre>\n\n<p>Output when <code>Foo</code> is <code>\"foo\"</code> and <code>Foo</code> is <code>\"bar\"</code>:</p>\n\n<pre><code>Let's say:Hello, StackOverflow!\nLet's say:Hello, World!\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/SsCVKej9UD\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3783, "favorite_count": 2, "accepted_answer_id": 39953936, "answer_count": 2, "score": 8, "last_activity_date": 1476092937, "creation_date": 1476046117, "last_edit_date": 1476046692, "question_id": 39948383, "link": "https://stackoverflow.com/questions/39948383/how-to-avoid-newlines-caused-by-conditionals", "title": "How to avoid newlines caused by conditionals?", "body": "<p>Given this Go text/template code:</p>\n\n<pre><code>Let's say:\n{{ if eq .Foo \"foo\" }}\nHello, StackOverflow!\n{{ else if eq .Foo \"bar\" }}\nHello, World!\n{{ end }}\n</code></pre>\n\n<p>We get the following output in case <code>Foo</code> equals <code>\"foo\"</code>:</p>\n\n<pre><code>Let's say:\n\nHello, StackOverflow!\n</code></pre>\n\n<p>(followed by a newline)</p>\n\n<p>Is there a way to get rid of the extra newlines?</p>\n\n<p>I would expect that this can be accomplished using the <code>{{-</code> and <code>-}}</code> syntax:</p>\n\n<pre><code>Let's say:\n{{- if eq .Foo \"foo\" }}\nHello, StackOverflow!\n{{- else if eq .Foo \"bar\" }}\nHello, World!\n{{- end }}\n</code></pre>\n\n<p>However, that yields an <code>illegal number syntax: \"-\"</code> error.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 584, "user_id": 2528719, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1ef4da676524b97d525de1c3a5ad3e87?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2528719/aaron"}, "edited": false, "score": 0, "creation_date": 1476317672, "post_id": 39948027, "comment_id": 67298652, "body": "I&#39;ve seen this issue in the past, it was usually resolved by making sure that all the <code>vendor</code> directories for the repositories that I was building were properly setup. What&#39;s the command you&#39;re running that results in this error?"}, {"owner": {"reputation": 2103, "user_id": 1085938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3122451f536ef0f24247e15f1c35b2a?s=128&d=identicon&r=PG", "display_name": "emidander", "link": "https://stackoverflow.com/users/1085938/emidander"}, "reply_to_user": {"reputation": 584, "user_id": 2528719, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1ef4da676524b97d525de1c3a5ad3e87?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2528719/aaron"}, "edited": false, "score": 0, "creation_date": 1476369979, "post_id": 39948027, "comment_id": 67325573, "body": "The error was from dev_appserver.py. It seems reasonable to assume the vendor directories are not set up correctly, but do you have any clue how? It looks ok to me and our unittests run without any problem."}, {"owner": {"reputation": 584, "user_id": 2528719, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1ef4da676524b97d525de1c3a5ad3e87?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2528719/aaron"}, "edited": false, "score": 0, "creation_date": 1476376361, "post_id": 39948027, "comment_id": 67330146, "body": "As I understand it, the <code>go-app-builder</code> tool works a bit differently from the standard go tooling in order to facilitate the App Engine specific builds, so that might be why you&#39;re seeing a discrepancy in the behavior. What version of the SDK are you using?"}], "answers": [{"tags": [], "owner": {"reputation": 584, "user_id": 2528719, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1ef4da676524b97d525de1c3a5ad3e87?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2528719/aaron"}, "is_accepted": false, "score": 1, "last_activity_date": 1476806247, "creation_date": 1476806247, "answer_id": 40112902, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine/40112902#40112902", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>I just ran into this issue myself actually. The problem occurs when you're using the App Engine tools to build any package which imports something that is using vendoring, but the package you're trying to run doesn't have the import within it's vendor directory.</p>\n\n<p>So, for example, if I'm trying to run package <code>foo</code>, which imports package <code>bar</code>, and both of which use the <code>github.com/gorilla/mux</code> library, if the <code>bar</code> repository has a <code>vendor/</code> directory that contains gorilla/mux, but the <code>foo</code> package doesn't have gorilla mux in it's <code>vendor/</code> directory, this error will occur.</p>\n\n<p>The reason this happens is that the <code>bar</code> package will prioritize it's own <code>vendor</code> package over the one in the <code>GOPATH</code>, which is what <code>foo</code> will be using, causing a difference in the actual location of the imported paths.</p>\n\n<p>The solution I found to this issue is to make sure that the <code>foo</code> directory is in the <code>GOPATH</code> and has the vendor directory properly installed. It's important to note that the <code>vendor/</code> convention only works from within the <code>GOPATH</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1320, "user_id": 4359699, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d7433b53d461a631e4e1cda7017c28db?s=128&d=identicon&r=PG&f=1", "display_name": "hraban", "link": "https://stackoverflow.com/users/4359699/hraban"}, "edited": false, "score": 1, "creation_date": 1487434705, "post_id": 40118834, "comment_id": 71788423, "body": "This is madness. Now it has to live <i>outside</i> GOPATH? Where does it end with the build idiosyncracies? Thank you, though. Seriously."}, {"owner": {"reputation": 636, "user_id": 2063744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43SNP.png?s=128&g=1", "display_name": "nikolay_turpitko", "link": "https://stackoverflow.com/users/2063744/nikolay-turpitko"}, "edited": false, "score": 0, "creation_date": 1512921456, "post_id": 40118834, "comment_id": 82441334, "body": "Nice answer. I created a simple app on GitHub to test this approach, it works: <a href=\"https://github.com/nikolay-turpitko/x-gae-dep\" rel=\"nofollow noreferrer\">github.com/nikolay-turpitko/x-gae-dep</a>"}], "tags": [], "owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "is_accepted": false, "score": 9, "last_activity_date": 1476828511, "last_edit_date": 1476828511, "creation_date": 1476828142, "answer_id": 40118834, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine/40118834#40118834", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>Your project directory (where app.yaml is) is probably in the GOPATH/src.\nIt shouldn't be.\nThe go-app-builder will take everything in the app.yaml folder (and below) and additionally merge your GOPATH into it, meaning now you have it twice.</p>\n\n<p>The solution is to move app.yaml out of the GOPATH/src folder.\nAdditionally you'll find that <code>goapp test</code> works differently from <code>goapp serve</code> and <code>goapp deploy</code> when it comes to resolving dependencies.</p>\n\n<p>So this is the solution I have been using (haven't used golang app engine in a while already) and it's the only setup I've found to work properly for all the <code>goapp</code> commands and for <code>govendor</code> to work properly (not sure about <code>godep</code>)</p>\n\n<pre><code>/GOPATH\n\u251c\u2500\u2500/appengine\n|   \u251c\u2500\u2500 app.yaml\n|   \u2514\u2500\u2500 aeloader.go\n\u2514\u2500\u2500/src\n    \u2514\u2500\u2500 /MYPROJECT\n         \u251c\u2500\u2500 main.go\n         \u251c\u2500\u2500 /handler\n         |    \u2514\u2500\u2500 handler.go\n         \u2514\u2500\u2500 /vendor\n</code></pre>\n\n<p>details:</p>\n\n<pre><code>file: GOPATH/appengine/aeloader.go (NOTE the init function is necessary, probably a bug though)\npackage mypackage\n\nimport (\n    _ \"MYPROJECT\"\n)\n\nfunc init() {\n}\n</code></pre>\n\n<p>now run <code>goapp serve</code> and <code>goapp deploy</code> from <code>../GOPATH/appengine/</code> and <code>goapp test ./...</code> from <code>../GOPATH/src/MYPROJECT</code></p>\n\n<p>P.S. I find the global GOPATH thing silly and simply set my GOPATH to current project folder (in the example above <code>/GOPATH</code>) and check the whole thing into version control.</p>\n"}, {"tags": [], "owner": {"reputation": 2103, "user_id": 1085938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3122451f536ef0f24247e15f1c35b2a?s=128&d=identicon&r=PG", "display_name": "emidander", "link": "https://stackoverflow.com/users/1085938/emidander"}, "is_accepted": true, "score": 1, "last_activity_date": 1482229095, "creation_date": 1482229095, "answer_id": 41239914, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine/41239914#41239914", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>I managed to resolve this error using govendor instead of Godeps. The root cause appears to have been that vendored references with their own vendored references was not resolved correctly by Godeps.</p>\n\n<p>The answer provided by Su-Au Hwang is also correct - you do have to keep app.yaml separate from your source.</p>\n"}, {"tags": [], "owner": {"reputation": 251, "user_id": 4800887, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9c0752eaedc4176a43e122960bdc87ce?s=128&d=identicon&r=PG", "display_name": "dmitryb", "link": "https://stackoverflow.com/users/4800887/dmitryb"}, "is_accepted": false, "score": 1, "last_activity_date": 1510396218, "creation_date": 1510396218, "answer_id": 47236909, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine/47236909#47236909", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>Also got the same problem.\nIn the <a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-go-libraries\" rel=\"nofollow noreferrer\">docs</a> Google suggests the following:</p>\n\n<blockquote>\n  <p>For best results, we recommend the following:</p>\n  \n  <ul>\n  <li>Create a separate directory in your app's directory for each service.</li>\n  <li>Each service's directory should contain the service's app.yaml file and one or more .go files.</li>\n  <li>Do not include any subdirectories in a service's directory.</li>\n  <li>Your GOPATH should specify a directory that is outside your app's directory and contain all the dependencies that your app imports.</li>\n  </ul>\n</blockquote>\n\n<p>But this messes up my project structure, which looks like this:</p>\n\n<pre><code>GOPATH/\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 github.com\n        \u2514\u2500\u2500 username\n            \u2514\u2500\u2500 myproject\n                \u251c\u2500\u2500 app.yaml\n                \u251c\u2500\u2500 cmd\n                \u2502\u00a0\u00a0 \u2514\u2500\u2500 myproject\n                \u2502\u00a0\u00a0     \u2514\u2500\u2500 main.go\n                \u251c\u2500\u2500 handlers\n                \u2502\u00a0\u00a0 \u2514\u2500\u2500 api.go\n                \u251c\u2500\u2500 mw\n                \u2502\u00a0\u00a0 \u251c\u2500\u2500 auth.go\n                \u2502\u00a0\u00a0 \u2514\u2500\u2500 logger.go\n                \u2514\u2500\u2500 vendor\n</code></pre>\n\n<p>Where the <code>myproject</code> directory is a git project and the <code>vendor</code> folder contains all dependencies.\nRunning <code>gcloud deploy</code> from the <code>myproject</code> directory where <code>app.yaml</code> file lives doesn't work because first, <code>main.go</code> file is not in the same directory and second (from the same doc):</p>\n\n<blockquote>\n  <p>you must be careful not to place your source code at or below your app's directory where the app.yaml file is located</p>\n</blockquote>\n\n<p>What I ended up doing is building my own custom runtime instead, which turned out to be a very clean solution.<br>\nSimply generate the <code>Dockerfile</code> with the following command:</p>\n\n<pre><code>gcloud beta app gen-config --custom\n</code></pre>\n\n<p>Modify it, then specify <code>runtime: custom</code> in your <code>app.yaml</code> and deploy normally.<br>\nThe trick here is of course that you're in control what gets copied where.<br>\nHere is my <code>Dockerfile</code>:</p>\n\n<pre><code># Dockerfile extending the generic Go image with application files for a\n# single application.\nFROM gcr.io/google-appengine/golang\n\nENV GOPATH /go\n\n# The files which are copied are specified in the .dockerignore file\nCOPY . /go/src/github.com/username/myproject/\n\nWORKDIR /go/src/github.com/username/myproject/\n\nRUN go build -o dist/bin/myproject ./cmd/myproject\n\n# All configuration parameters are passed through environment variables and specified in app.yaml\nCMD [\"/go/src/github.com/username/myproject/dist/bin/myproject\"]\n</code></pre>\n\n<p>Don't forget that App Engine expects your application listening on port 8080. Check out <a href=\"https://cloud.google.com/appengine/docs/flexible/custom-runtimes/build\" rel=\"nofollow noreferrer\">Building Custom Runtimes</a> doc for more details.</p>\n"}, {"comments": [{"owner": {"reputation": 5155, "user_id": 645924, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2bcc518c6f92a560dc32647190319ace?s=128&d=identicon&r=PG", "display_name": "Ryan", "link": "https://stackoverflow.com/users/645924/ryan"}, "edited": false, "score": 2, "creation_date": 1522665503, "post_id": 48132666, "comment_id": 86225734, "body": "This is probably the best answer. You can keep your project not apengine specific and than just create a prebuild step like this and get your project in the exact format appengine wants"}, {"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1534378733, "post_id": 48132666, "comment_id": 90687905, "body": "best approach/ answer"}], "tags": [], "owner": {"reputation": 2336, "user_id": 1826232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DldsJ.png?s=128&g=1", "display_name": "Asdine", "link": "https://stackoverflow.com/users/1826232/asdine"}, "is_accepted": false, "score": 7, "last_activity_date": 1534392174, "last_edit_date": 1534392174, "creation_date": 1515278828, "answer_id": 48132666, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine/48132666#48132666", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>I use a Makefile to move the <code>vendor</code> directory to a temporary <code>GOPATH</code>:</p>\n\n<pre><code>TMPGOPATH := $(shell mktemp -d)\n\ndeploy:\n  mv vendor $(TMPGOPATH)/src\n  GOPATH=$(TMPGOPATH) gcloud app deploy\n  mv $(TMPGOPATH)/src vendor \n</code></pre>\n\n<p>I store this <code>Makefile</code> at the root of my service near the <code>vendor</code> directory and simply use <code>make deploy</code> to deploy manually or from the CI.</p>\n\n<p>It works with Glide, Godeps or any tool that respects the Go vendor spec.</p>\n\n<p>Please note, that you really need to move the <code>vendor</code> directory out of the build directory, otherwise the GoAppEngine compiler will try to build the vendor dependencies, potentially causing compile errors. </p>\n"}], "owner": {"reputation": 2103, "user_id": 1085938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3122451f536ef0f24247e15f1c35b2a?s=128&d=identicon&r=PG", "display_name": "emidander", "link": "https://stackoverflow.com/users/1085938/emidander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3442, "favorite_count": 5, "accepted_answer_id": 41239914, "answer_count": 5, "score": 12, "last_activity_date": 1534392174, "creation_date": 1476043658, "question_id": 39948027, "link": "https://stackoverflow.com/questions/39948027/how-do-i-make-vendoring-work-with-google-app-engine", "title": "How do I make vendoring work with Google App Engine?", "body": "<p>I am trying to introduce Go vendoring (storing dependencies in a folder called <code>vendor</code>) to an existing App Engine project. I have stored all dependencies in the vendor folder (using Godep as a helper) and it looks right, but running the application locally I get the following error: </p>\n\n<p><code>go-app-builder: Failed parsing input: package \"golang.org/x/net/context\" is imported from multiple locations: \"/Users/erik/go/src/github.com/xyz/abc/vendor/golang.org/x/net/context\" and \"/Users/erik/go/src/golang.org/x/net/context\"</code></p>\n\n<p>I believe the two locations should resolve to the same location, as Go applications should look in the <code>vendor</code> folder first. Is there a way to make Appengine understand that both dependencies are the same?</p>\n"}, {"tags": ["html", "go", "web-scraping"], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 1, "creation_date": 1476047663, "post_id": 39948581, "comment_id": 67177492, "body": "Thank you soo much  i am new to go so never knew about this"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1476047894, "post_id": 39948581, "comment_id": 67177545, "body": "You&#39;re welcome! just remember always re-check your answer and example so people can help you better :)"}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": true, "score": 1, "last_activity_date": 1476047485, "creation_date": 1476047485, "answer_id": 39948581, "question_id": 39947716, "link": "https://stackoverflow.com/questions/39947716/how-to-access-inner-tags-token-in-golang/39948581#39948581", "title": "How to access inner tags token in golang?", "body": "<p>Well first of all your HTML example is wrong, you missed all the close tags  <strong>&lt;</strong>/ tr <strong>></strong> and <strong>&lt;</strong>/ td <strong>></strong></p>\n\n<p>For this kind of job is always better use some sort of DOM selectors like jQuery. For Go I recommend <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">goquery</a>, it's little library and works pretty well. Your solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc main() {\n    doc, err := goquery.NewDocument(\"http://your.url.com/foo.html\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    doc.Find(\"table tr\").Each(func(_ int, tr *goquery.Selection) {\n\n        // for each &lt;tr&gt; found, find the &lt;td&gt;s inside\n        // ix is the index\n        tr.Find(\"td\").Each(func(ix int, td *goquery.Selection) {\n\n            // print only the td number 2 (index == 1)\n            if ix == 1 {\n                log.Printf(\"index: %d content: '%s'\", ix, td.Text())\n            }\n        })\n    })\n}\n</code></pre>\n\n<p>As you may note <strong>td.Text()</strong> has the content of each <em>td</em> tag.\nI left you the full file that I used for testing <a href=\"https://play.golang.org/p/Rtb1Tqz1Wb\" rel=\"nofollow\">https://play.golang.org/p/Rtb1Tqz1Wb</a></p>\n"}, {"tags": [], "owner": {"reputation": 750, "user_id": 654493, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/048fb052b006f21b685400b71e964b32?s=128&d=identicon&r=PG", "display_name": "David Smith", "link": "https://stackoverflow.com/users/654493/david-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1522669321, "creation_date": 1522669321, "answer_id": 49610625, "question_id": 39947716, "link": "https://stackoverflow.com/questions/39947716/how-to-access-inner-tags-token-in-golang/49610625#49610625", "title": "How to access inner tags token in golang?", "body": "<p>Another way using golang.org/x/net/html.</p>\n\n<p>(NB Speed may be gained by substituting t.DataAtom for t.Data as integer matching may be more efficient.)</p>\n\n<pre><code>package main\n\n// https://stackoverflow.com/questions/39947716/how-to-access-inner-tags-token-in-golang\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n\n    r := strings.NewReader(s)\n\n    z := html.NewTokenizer(r)\n\n    i := 0\n\n    for {\n        tt := z.Next()\n        switch tt {\n\n        case html.ErrorToken:\n            return\n\n        case html.StartTagToken:\n            t := z.Token()\n\n            switch t.Data {\n\n            case \"tr\":\n                i = 0\n\n            case \"td\":\n                if i == 1 {\n                    z.Next()\n                    t = z.Token()\n                    fmt.Println(t.Data)\n                }\n                i++\n            }\n        }\n    }\n}\n\nvar s string = `\n&lt;table&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;keep&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;it&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;simple&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;sister&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n&lt;/table&gt;`\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tAORrHy8eFJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tAORrHy8eFJ</a></p>\n"}], "owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1076, "favorite_count": 1, "accepted_answer_id": 39948581, "answer_count": 2, "score": 2, "last_activity_date": 1522669321, "creation_date": 1476041641, "last_edit_date": 1476464247, "question_id": 39947716, "link": "https://stackoverflow.com/questions/39947716/how-to-access-inner-tags-token-in-golang", "title": "How to access inner tags token in golang?", "body": "<p>I am making a webscraper and i have never done it before so please point out if i am doing anything wrong</p>\n\n<p>I am using golang to scrap</p>\n\n<p>suppose i have been given a table</p>\n\n<pre><code>&lt;table&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n   &lt;tr&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt;\n         &lt;td&gt;XYZ&lt;/td&gt; \n   &lt;/tr&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>i want to extract data from each tr but only the second td</p>\n\n<p>also can i return a new html string only having the content inside the table tag and remove everything elese in the html outside table tag?</p>\n"}, {"tags": ["go", "webstorm"], "comments": [{"owner": {"reputation": 3035, "user_id": 5230894, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d83dd5a0c29ea68de6220f01cc56c08b?s=128&d=identicon&r=PG&f=1", "display_name": "npr", "link": "https://stackoverflow.com/users/5230894/npr"}, "edited": false, "score": 0, "creation_date": 1476037768, "post_id": 39947032, "comment_id": 67174349, "body": "Im using below : Go plugin : 0.10.1726 Mac osx : 10.11.x"}], "answers": [{"comments": [{"owner": {"reputation": 3035, "user_id": 5230894, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d83dd5a0c29ea68de6220f01cc56c08b?s=128&d=identicon&r=PG&f=1", "display_name": "npr", "link": "https://stackoverflow.com/users/5230894/npr"}, "edited": false, "score": 0, "creation_date": 1476038843, "post_id": 39947157, "comment_id": 67174677, "body": "You were right abt sdk - /usr/local/go is my path : I had to restart webstorm so that it picked it up. Thank you."}], "tags": [], "owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "is_accepted": true, "score": 1, "last_activity_date": 1476038287, "creation_date": 1476038287, "answer_id": 39947157, "question_id": 39947032, "link": "https://stackoverflow.com/questions/39947032/go-binary-not-identified-by-webstorm/39947157#39947157", "title": "Go binary not identified by WebStorm", "body": "<p><code>webstorm</code> is not expecting the path to the <code>go</code> binary here. Instead, you have to give the path to Go's SDK. On my setup, it is <code>/usr/lib/golang</code>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/pcUVm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pcUVm.png\" alt=\"go plugin\"></a></p>\n\n<pre><code>$ ls /usr/lib/golang \napi  bin  favicon.ico  lib  pkg  robots.txt  src  test  VERSION\n</code></pre>\n"}], "owner": {"reputation": 3035, "user_id": 5230894, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d83dd5a0c29ea68de6220f01cc56c08b?s=128&d=identicon&r=PG&f=1", "display_name": "npr", "link": "https://stackoverflow.com/users/5230894/npr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 39947157, "answer_count": 1, "score": 0, "last_activity_date": 1476053678, "creation_date": 1476037606, "last_edit_date": 1476053678, "question_id": 39947032, "link": "https://stackoverflow.com/questions/39947032/go-binary-not-identified-by-webstorm", "title": "Go binary not identified by WebStorm", "body": "<p>I installed go and ran a hello world from terminal. Now when I try setup Go SDK in WebStorm it fails to identify it.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZHbd0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZHbd0.png\" alt=\"enter image description here\"></a></p>\n\n<p>The go binary is located in that path and I am able to see it version as well. But WebStorm is not happy for some reason.</p>\n\n<p>How do I resolve this?</p>\n"}, {"tags": ["design-patterns", "go", "request", "timeout"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1476055512, "post_id": 39946583, "comment_id": 67179318, "body": "Do you want to implement middleware utilizing context introduced in go 1.7 or do you want to implement  middleware having own context for pre 1.7? The former will be much easier with newly introduced methods such as <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\"><code>Request.Context</code></a>,  <code>Request.WithContext</code> and <a href=\"https://golang.org/pkg/context/#WithValue\" rel=\"nofollow noreferrer\"><code>context.WithValue</code></a>"}, {"owner": {"reputation": 2023, "user_id": 1698398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/90a6b9d6a6d9f099bc6ad6158e096b2c?s=128&d=identicon&r=PG&f=1", "display_name": "user937284", "link": "https://stackoverflow.com/users/1698398/user937284"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1476077794, "post_id": 39946583, "comment_id": 67183577, "body": "I am using go 1.7 and like to use Request.Context."}], "answers": [{"tags": [], "owner": {"reputation": 368, "user_id": 276707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3337f167ea6d3c57f99384a5f05376cc?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/276707/daniel"}, "is_accepted": false, "score": 20, "last_activity_date": 1520912320, "creation_date": 1520912320, "answer_id": 49247940, "question_id": 39946583, "link": "https://stackoverflow.com/questions/39946583/how-to-pass-context-in-golang-request-to-middleware/49247940#49247940", "title": "How to pass context in golang request to middleware", "body": "<p>If you look at the <a href=\"https://blog.golang.org/context#TOC_3.1.\" rel=\"noreferrer\">first example at that Go Concurrency Patterns blog post</a>, you'll notice that they're \"deriving\" their contexts from the <code>Background</code> context. That, combined with the <code>Context</code> and <code>WithContext</code> methods on your <code>Request</code> object, gives you what you need.</p>\n\n<p>I just figured this out (and it wasn't my first run at reading those docs); when you \"derive\" a context, you're making another one with one change. I was already wrapping the <code>http.Handler</code> (actually using <code>httprouter.Handle</code>). The cool thing about <code>Request.Context</code> is that it never returns <code>nil</code>; if no other context has been created, it returns the background context.</p>\n\n<p>To specify a timeout, within your handler (just above your \"// perform GET request\" comment), you can do something like:</p>\n\n<pre><code>ctx, cancel := context.WithTimeout(r.Context(), time.Duration(60*time.Second))\ndefer cancel()\nr = r.WithContext(ctx)\n</code></pre>\n\n<p>The first line creates the context and gives you the cancel hook, which you defer; any derived contexts (AKA the ones to which you add your variables) will be cancelled when this deferred call (line 2) is executed, once the request has been served. Finally, line 3 replaces the request, which now contains your updated context.</p>\n\n<p>In your authorization checker, once you have established that the user is valid, you can add the user's information to the context before calling <code>ServeHTTP</code>. Keys for the context can't use built-in types, but you can create a new type that's simply an alias to the built-in type. It's a good idea to define constants for your key values as well. An example:</p>\n\n<pre><code>type ContextKey string\n\nconst ContextUserKey ContextKey = \"user\"\n\n// Then, just above your call to ServeHTTP...\n\nctx := context.WithValue(r.Context(), ContextUserKey, \"theuser\")\nh.ServeHTTP(w, r.WithContext(ctx))\n</code></pre>\n\n<p>This passes the now-twice-derived context (that now has the timeout <strong>and</strong> the user ID) to the handler.</p>\n\n<p>Finally, the last piece of the puzzle - how to get the user ID from within the handler. This is the most straightforward part; we simply use the <code>Value</code> method on the value returned from the request's <code>Context</code> method. The type is <code>interface{}</code>, so you'll need a type assertion if you want to treat it as a string (as this example does).</p>\n\n<pre><code>user := r.Context().Value(ContextUserKey)\ndoSomethingForThisUser(user.(string))\n</code></pre>\n\n<p>You're not limited to one change per method; as long as you keep deriving the same context, it'll all get cleaned up once the request has been served, when the initially derived context (the one, in this example, where we specified the timeout) is cancelled when the deferred <code>cancel()</code> call fires.</p>\n"}, {"comments": [{"owner": {"reputation": 13872, "user_id": 10176, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b2507d479af955f05ee995b8d5daa6ac?s=128&d=identicon&r=PG", "display_name": "Jonathan Hartley", "link": "https://stackoverflow.com/users/10176/jonathan-hartley"}, "edited": false, "score": 0, "creation_date": 1548882147, "post_id": 53388060, "comment_id": 95707668, "body": "is that an erroneous comma towards the end of your &quot;return ctx.Value(userKey) <i>,</i> (string)&quot; ?"}, {"owner": {"reputation": 508, "user_id": 878792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c31138045abd812fcf28cee493692e?s=128&d=identicon&r=PG", "display_name": "jabbrwcky", "link": "https://stackoverflow.com/users/878792/jabbrwcky"}, "reply_to_user": {"reputation": 13872, "user_id": 10176, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b2507d479af955f05ee995b8d5daa6ac?s=128&d=identicon&r=PG", "display_name": "Jonathan Hartley", "link": "https://stackoverflow.com/users/10176/jonathan-hartley"}, "edited": false, "score": 1, "creation_date": 1549004165, "post_id": 53388060, "comment_id": 95756051, "body": "Yes, it was supposed to be a &#39;.&#39; - then the typecast actually works ;)"}, {"owner": {"reputation": 1819, "user_id": 2133814, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/5e44e61af952612c3c45385b62806c67?s=128&d=identicon&r=PG", "display_name": "user2133814", "link": "https://stackoverflow.com/users/2133814/user2133814"}, "edited": false, "score": 0, "creation_date": 1605733737, "post_id": 53388060, "comment_id": 114745603, "body": "a slight improvement would be have <code>type contextKey string</code> so its private which ensures it never conflicts with any other context keys from other packages."}], "tags": [], "owner": {"reputation": 508, "user_id": 878792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c31138045abd812fcf28cee493692e?s=128&d=identicon&r=PG", "display_name": "jabbrwcky", "link": "https://stackoverflow.com/users/878792/jabbrwcky"}, "is_accepted": false, "score": 2, "last_activity_date": 1549004110, "last_edit_date": 1549004110, "creation_date": 1542698446, "answer_id": 53388060, "question_id": 39946583, "link": "https://stackoverflow.com/questions/39946583/how-to-pass-context-in-golang-request-to-middleware/53388060#53388060", "title": "How to pass context in golang request to middleware", "body": "<p>You can improve Daniels solution by adding a funtion to retrieve the value from the context in a typesafe manner: </p>\n\n<pre><code>type ContextKey string\n\nconst ContextUserKey ContextKey = \"user\"\n\nfunc UserFromContext(ctx context.Context) string {\n    return ctx.Value(ContextUserKey).(string)\n}\n\n// Then, just above your call to ServeHTTP... \n\nctx := context.WithValue(r.Context(), userKey, \"theuser\")\nh.ServeHTTP(w, r.WithContext(ctx))\n</code></pre>\n\n<p>The handler does not have to cast the type and it even does not need to know the context key.</p>\n"}], "owner": {"reputation": 2023, "user_id": 1698398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/90a6b9d6a6d9f099bc6ad6158e096b2c?s=128&d=identicon&r=PG&f=1", "display_name": "user937284", "link": "https://stackoverflow.com/users/1698398/user937284"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18036, "favorite_count": 3, "answer_count": 2, "score": 12, "last_activity_date": 1549004110, "creation_date": 1476034955, "question_id": 39946583, "link": "https://stackoverflow.com/questions/39946583/how-to-pass-context-in-golang-request-to-middleware", "title": "How to pass context in golang request to middleware", "body": "<p>I am trying to understand how the context introduced in Golang 1.7 works and what would be the appropriate way to pass it to middleware and to a <code>HandlerFunc</code>. Should the context get initialized in the main function and passed to the <code>checkAuth</code> function then? And how to pass it to <code>Hanlder</code> and the <code>ServeHTTP</code> function?\nI read <a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">Go concurrency patterns</a> and <a href=\"https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39#.7dcv2847z\" rel=\"noreferrer\">How to use Context</a> but I struggle to adapt those patterns to my code.</p>\n\n<pre><code>func checkAuth(authToken string) util.Middleware {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            if r.Header.Get(\"Auth\") != authToken {\n                util.SendError(w, \"...\", http.StatusForbidden, false)\n                return\n            }\n            h.ServeHTTP(w, r)\n        })\n    }\n}\n\n// Handler is a struct\ntype Handler struct {\n    ...\n    ...\n}\n\n// ServeHTTP is the handler response to an HTTP request\nfunc (h *HandlerW) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    decoder := json.NewDecoder(r.Body)\n\n    // decode request / context and get params\n    var p params\n    err := decoder.Decode(&amp;p)\n    if err != nil {\n       ...\n        return\n    }\n\n    // perform GET request and pass context\n    ...\n\n\n}\n\n\nfunc main() {\n    router := mux.NewRouter()\n\n    // How to pass context to authCheck?\n    authToken, ok := getAuthToken()\n    if !ok {\n        panic(\"...\")\n    }\n    authCheck := checkAuth(authToken)\n\n    // initialize middleware handlers\n    h := Handler{\n       ...\n   } \n\n   // chain middleware handlers and pass context\n   router.Handle(\"/hello\", util.UseMiddleware(authCheck, Handler, ...))\n}\n</code></pre>\n"}, {"tags": ["loops", "go", "tokenize"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3646022"}, "edited": false, "score": 0, "creation_date": 1550002126, "post_id": 39946185, "comment_id": 96107203, "body": "Also look here: <a href=\"https://github.com/golang/go/issues/85\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/85</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1535858129, "post_id": 39946278, "comment_id": 91217740, "body": "Isn&#39;t that go to statement? but that is a bad design"}], "tags": [], "owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "is_accepted": true, "score": 1, "last_activity_date": 1476033469, "last_edit_date": 1476033469, "creation_date": 1476033081, "answer_id": 39946278, "question_id": 39946185, "link": "https://stackoverflow.com/questions/39946185/infinite-loop-causing-unreachable-code/39946278#39946278", "title": "&quot;Infinite loop&quot; causing unreachable code", "body": "<p>There's no <code>break</code> in the loop. The only way it ends is via a <code>return</code> which sends control out of this function. This means that <code>fmt.Println(urls)</code> is not reachable. </p>\n\n<p>Try this:</p>\n\n<pre><code>L:\nfor {\n    tt := z.Next()\n\n    switch {\n    case tt == html.ErrorToken:\n        break L\n    case tt == html.StartTagToken:\n        t := z.Token()\n\n        isAnchor := t.Data == \"a\"\n        if !isAnchor {\n            continue\n        }\n\n        ok, url := getHref(t)\n        if !ok {\n            continue\n        }\n        if strings.Contains(url, \"somestring\") {\n            urls = append(urls, url)\n        }\n\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6475786, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-trJy0f7CYpM/AAAAAAAAAAI/AAAAAAAAEPA/rkjVCyWrsLo/photo.jpg?sz=128", "display_name": "Jonathan Shahen", "link": "https://stackoverflow.com/users/6475786/jonathan-shahen"}, "is_accepted": false, "score": 1, "last_activity_date": 1476033453, "creation_date": 1476033453, "answer_id": 39946342, "question_id": 39946185, "link": "https://stackoverflow.com/questions/39946185/infinite-loop-causing-unreachable-code/39946342#39946342", "title": "&quot;Infinite loop&quot; causing unreachable code", "body": "<p>Use the example they provided here: <a href=\"https://godoc.org/golang.org/x/net/html#example-Parse\" rel=\"nofollow\">https://godoc.org/golang.org/x/net/html#example-Parse</a></p>\n\n<p>Modifying your code to fit this:</p>\n\n<pre><code>resp, err = client.Get(\"someurl\")\nvar urls []string\n\nif err != nil {\n    log.Fatal(err)\n}\n\ndoc, err := html.Parse(strings.NewReader(resp.Body))\nif err != nil {\n    log.Fatal(err)\n}\n\nvar f func(*html.Node)\nf = func(n *html.Node) {\n    if n.Type == html.ElementNode &amp;&amp; n.Data == \"a\" {\n        for _, a := range n.Attr {\n            if a.Key == \"href\" {\n                fmt.Println(a.Val)\n\n                if strings.Contains(a.Val, \"somestring\") {\n                    urls = append(urls, a.Val)\n                }\n\n                break\n            }\n        }\n    }\n    for c := n.FirstChild; c != nil; c = c.NextSibling {\n        f(c)\n    }\n}\nf(doc)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 39946278, "answer_count": 2, "score": 1, "last_activity_date": 1476033469, "creation_date": 1476032663, "question_id": 39946185, "link": "https://stackoverflow.com/questions/39946185/infinite-loop-causing-unreachable-code", "title": "&quot;Infinite loop&quot; causing unreachable code", "body": "<p>i'm currently trying to work with the html tokenizer <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow\">https://godoc.org/golang.org/x/net/html</a>.</p>\n\n<p>So what i want to do is following: get all links from url and if url contains a certain string -> add to url-list. </p>\n\n<pre><code>resp, err = client.Get(\"someurl\")\nvar urls []string\n\nif err != nil {\n    log.Fatal(err)\n}\n\nz := html.NewTokenizer(resp.Body)\n\nfor {\n    tt := z.Next()\n\n    switch {\n    case tt == html.ErrorToken:\n        return\n    case tt == html.StartTagToken:\n        t := z.Token()\n\n        isAnchor := t.Data == \"a\"\n        if !isAnchor {\n            continue\n        }\n\n        ok, url := getHref(t)\n        if !ok {\n            continue\n        }\n        if strings.Contains(url, \"somestring\") {\n            urls = append(urls, url)\n        }\n\n    }\n}\n\nfmt.Println(urls)\n</code></pre>\n\n<p>This doesn't work since \"fmt.Println(urls)\" is unreachable. The loop ofc ends at some point.... but this doesn't compile. How do i get the code after the loop to be reachable?</p>\n\n<p>Regards</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "edited": false, "score": 0, "creation_date": 1476037043, "post_id": 39946509, "comment_id": 67174092, "body": "Cool, I&#39;d tried that but it was outputting null... I hadn&#39;t realised that trying to do so after a decode would do this. Two lessons learned, cheers big ears."}, {"owner": {"reputation": 1304, "user_id": 5125201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff70a4545b368f2aca2a97de7b234b2?s=128&d=identicon&r=PG", "display_name": "Ammar Bandukwala", "link": "https://stackoverflow.com/users/5125201/ammar-bandukwala"}, "edited": false, "score": 0, "creation_date": 1476045894, "post_id": 39946509, "comment_id": 67176972, "body": "It&#39;s a good idea to keep in mind that <code>io.Copy</code> makes an allocation. You&#39;ll probably want to use <code>io.CopyBuffer</code> in the hot path."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1304, "user_id": 5125201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff70a4545b368f2aca2a97de7b234b2?s=128&d=identicon&r=PG", "display_name": "Ammar Bandukwala", "link": "https://stackoverflow.com/users/5125201/ammar-bandukwala"}, "edited": false, "score": 2, "creation_date": 1476047088, "post_id": 39946509, "comment_id": 67177315, "body": "@AmmarBandukwala, unless you have a buffer already, they&#39;re identical, Copy just calls CoffyBuffer. You need to make the allocation at some point, and in the scheme of a std lib http request, it&#39;s one of many such allocations and is likely to be insignificant."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 53, "last_activity_date": 1476035185, "last_edit_date": 1476035185, "creation_date": 1476034521, "answer_id": 39946509, "question_id": 39945968, "link": "https://stackoverflow.com/questions/39945968/most-efficient-way-to-convert-io-readcloser-to-byte-array/39946509#39946509", "title": "Most efficient way to convert io.ReadCloser to byte array", "body": "<p>You convert a Reader to bytes, by reading it. There's not really a more efficient way to do it. </p>\n\n<pre><code>body, err := ioutil.ReadAll(r.Body)\n</code></pre>\n\n<p>If you are unconditionally transferring bytes from an <code>io.Reader</code> to an <code>io.Writer</code>, you can just use <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"noreferrer\"><code>io.Copy</code></a></p>\n"}], "owner": {"reputation": 1326, "user_id": 789125, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/7484bfbfd4f46d5621315de848b5a996?s=128&d=identicon&r=PG", "display_name": "Jenny Blunt", "link": "https://stackoverflow.com/users/789125/jenny-blunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26643, "favorite_count": 2, "accepted_answer_id": 39946509, "answer_count": 1, "score": 32, "last_activity_date": 1476035185, "creation_date": 1476031232, "last_edit_date": 1495540114, "question_id": 39945968, "link": "https://stackoverflow.com/questions/39945968/most-efficient-way-to-convert-io-readcloser-to-byte-array", "title": "Most efficient way to convert io.ReadCloser to byte array", "body": "<p>I have a very simple Go webserver. It's job is to receive an inbound json payload. It then publishes the payload to one or more services that expect a byte array. The payload doesn't need to be checked. Just sent over.</p>\n\n<p>In this case, it receives an inbound job and sends it to Google PubSub. It might be another service - it doesn't really matter. <strong>I'm trying to find the most efficient way to convert the object to a byte array without first decoding it.</strong></p>\n\n<p>Why? Seems a bit wasteful to decode and convert to JSON on one server, only to unmarshal it later. Plus, I don't want to maintain two identical structs in two packages.</p>\n\n<p>How is it possible to convert the io.ReadCloser to a byte array so I only need to unmarshal once. I tried something like this answer but don't think that's the most efficient way either:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/9644139/from-io-reader-to-string-in-go\">From io.Reader to string in Go</a></p>\n\n<p>My http server code looks like this:</p>\n\n<pre><code>func Collect(d DbManager) http.HandlerFunc {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\n\n    code := 422\n    obj := Report{}\n    response := Response{}\n    response.Message = \"Invalid request\"\n\n    decoder := json.NewDecoder(r.Body)\n    decoder.Decode(&amp;obj)\n\n    if obj.Device.MachineType != \"\" {\n        msg,_ := json.Marshal(obj)\n        if d.Publish(msg, *Topic) {\n          code = 200\n        }\n        response.Message = \"Ok\"\n    }\n\n    a, _ := json.Marshal(response)\n    w.WriteHeader(code)\n    w.Write(a)\n    return\n})\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "edited": false, "score": 0, "creation_date": 1476033082, "post_id": 39946177, "comment_id": 67172666, "body": "Yes, obv if initialize after it will work. Thats not my question. I run it a lot on linux and never get this error. But as soon as i launch on windows - nil error ( which is gone if move db init after goroutine). So i want to understand why it never produce this error on linux, but 100% on windows."}, {"owner": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "reply_to_user": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "edited": false, "score": 0, "creation_date": 1476033256, "post_id": 39946177, "comment_id": 67172730, "body": "Have you tried to put a sleep after <code>go feedChan()</code>? Maybe a few seconds just to make sure the routine starts before <code>db</code> is ready. It would be interesting to see if it still works on Linux."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "edited": false, "score": 2, "creation_date": 1476033558, "post_id": 39946177, "comment_id": 67172845, "body": "@Aldarund, like with any case of UB, those kind of question are meaningless. It&#39;s UB, so anything could happen. It could break on Linux some day, it could work on it every time or your PC could become alive and run away from you. That doesn&#39;t matter. Your code still has a UB. It has two threads of execution that try to access the resource without any kind of synchronization - <code>func init()</code> and <code>func feedChan()</code>. At this point anything could happen, because it&#39;s a race condition between two threads."}, {"owner": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1476055817, "post_id": 39946177, "comment_id": 67179392, "body": "@creker Could you please explain what UB stands for?"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1476058328, "post_id": 39946177, "comment_id": 67179926, "body": "@beatngu13, undefined behavior"}, {"owner": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "edited": false, "score": 0, "creation_date": 1476093103, "post_id": 39946177, "comment_id": 67190778, "body": "@beatngu13 adding sleep produce same error on linux. So i guess its could be a difference in speed linus vps vs my pretty fast pc on win."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "edited": false, "score": 0, "creation_date": 1476099068, "post_id": 39946177, "comment_id": 67193946, "body": "@Aldarund, it could be because Go runtime is singlethreaded on your linux. Check the value of <code>runtime.GOMAXPROCS(-1)</code> on both machines. It will tell you, roughly, how many OS threads Go runtime will use to execute goroutines."}], "tags": [], "owner": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "is_accepted": true, "score": 1, "last_activity_date": 1476033928, "last_edit_date": 1476033928, "creation_date": 1476032608, "answer_id": 39946177, "question_id": 39945856, "link": "https://stackoverflow.com/questions/39945856/goroutine-behaves-differently-on-windows-and-linux/39946177#39946177", "title": "Goroutine behaves differently on Windows and Linux", "body": "<p>That's probably a <a href=\"https://en.wikipedia.org/wiki/Race_condition\" rel=\"nofollow\">race condition</a>. Import <code>\"time\"</code>, put this line after <code>go feedChan()</code>, and see if it still works on Linux:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>time.Sleep(3 * time.Second)\n</code></pre>\n\n<p>In order to avoid this situation, you could either initialize <code>db</code> <em>before</em> you spawn the routine (which uses <code>db</code>) or use some sort of <a href=\"https://en.wikipedia.org/wiki/Barrier_(computer_science)\" rel=\"nofollow\">barrier</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func init() {\n    barrier := make(chan int)\n    go feedChan(barrier)\n\n    connString := os.Getenv(\"DB_CONN\")\n    var err error\n    db, err = sql.Open(\"postgres\", connString)\n\n    if err != nil {\n        log.Fatalf(\"Failed to connect to database at %q: %q\\n\", connString, err)\n        // Retry.\n    } else {\n        barrier &lt;- 1 // Opens barrier.\n    }\n    // ...\n}\n\n\nfunc feedChan(barrier chan int) {\n    &lt;-barrier // Blocks until db is ready.\n    selectQuery, err := db.Prepare(`\n        SELECT id, proxy\n        FROM proxy\n        WHERE fail_count &lt; 2\n        ORDER BY date_added DESC, last_used ASC, fail_count ASC\n        LIMIT 5\n    `)\n    // ...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "edited": false, "score": 0, "creation_date": 1476079798, "post_id": 39950143, "comment_id": 67184283, "body": "Two threads are accessing a shared resource (<code>dB</code>) without synchronization. The output of the program fully depends on timing. I&#39;m pretty sure it <i>is</i> a race condition..."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "edited": false, "score": 0, "creation_date": 1476084368, "post_id": 39950143, "comment_id": 67186190, "body": "Well yes there&#39;s a race condition, but the problem here is an uninitialized variable. All we have to do is start the goroutine <code>go feedChan()</code> after the initialization of <b>db</b>"}, {"owner": {"reputation": 3492, "user_id": 3429133, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Dmyzd.png?s=128&g=1", "display_name": "beatngu13", "link": "https://stackoverflow.com/users/3429133/beatngu13"}, "edited": false, "score": 0, "creation_date": 1476087828, "post_id": 39950143, "comment_id": 67187894, "body": "The variable is initialized on one machine, but isn&#39;t on the other. How do you explain that? If the thread executing <code>init()</code> is fast enough, <code>db</code> will be ready <i>before</i> the thread that runs <code>feedChan()</code> is accessing it. If not, you&#39;ll get that nil error."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 1, "creation_date": 1476098833, "post_id": 39950143, "comment_id": 67193813, "body": "@YandryPozo, the only problem here is a race condition, which triggers an error with uninitialized variable. The latter is an effect, not the cause. Your solution fixes the race condition."}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1476084301, "last_edit_date": 1476084301, "creation_date": 1476062196, "answer_id": 39950143, "question_id": 39945856, "link": "https://stackoverflow.com/questions/39945856/goroutine-behaves-differently-on-windows-and-linux/39950143#39950143", "title": "Goroutine behaves differently on Windows and Linux", "body": "<p>After reading the first lines of your functions I just can say you that your legacy code has a <strong>huge</strong> bug and it can be easily fixed just moving this line <code>go feedChan()</code> to the end of the <code>init()</code> function.</p>\n\n<p>Also note the main reason is not a race condition, just a matter of wait for the correct initialization of <strong>db</strong> variable.</p>\n"}], "owner": {"reputation": 14517, "user_id": 239354, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e77a08f46144e1af3354f980911a94c9?s=128&d=identicon&r=PG", "display_name": "Aldarund", "link": "https://stackoverflow.com/users/239354/aldarund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 39946177, "answer_count": 2, "score": 0, "last_activity_date": 1476084301, "creation_date": 1476030427, "question_id": 39945856, "link": "https://stackoverflow.com/questions/39945856/goroutine-behaves-differently-on-windows-and-linux", "title": "Goroutine behaves differently on Windows and Linux", "body": "<p>I`m new to the GO. I have a following legacy code.</p>\n\n<pre><code>var db *sql.DB\n\nfunc init() {\n    go feedChan()\n\n    connString := os.Getenv(\"DB_CONN\")\n    var err error\n\n    db, err = sql.Open(\"postgres\", connString)\n    if err != nil {\n        log.Fatalf(\"Failed to connect to database at %q: %q\\n\", connString, err)\n    }\n\n    // confirm connection\n    if err = db.Ping(); err != nil {\n        log.Fatalf(\"Unable to ping database at %q: %q\\n\", connString, err)\n    }\n}\n\n\nfunc feedChan() {\n    selectQuery, err := db.Prepare(`\n        SELECT id, proxy\n        FROM proxy\n        WHERE fail_count &lt; 2\n        ORDER BY date_added DESC, last_used ASC, fail_count ASC\n        LIMIT 5\n    `)\n    ....\n</code></pre>\n\n<p>Following code works on linux. But it fails on windows with nil error on</p>\n\n<pre><code>selectQuery, err := db.Prepare(`\n</code></pre>\n\n<p>Which make sense for me, since db initialized after a launch of feedChan goroutine. What doesnt make sense for me is why it work on linux.</p>\n\n<p>So the question is why this code work at linux without errors?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1476026853, "post_id": 39945207, "comment_id": 67170703, "body": "Hi Bazzz! Thanks a lot for your answer. Now I understand ...It works :)"}, {"owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "reply_to_user": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1476027001, "post_id": 39945207, "comment_id": 67170758, "body": "Hi Nikola, good to hear that you managed to solve the issue. Please tick my answer as &quot;correct&quot; so that others who use search to find a solution will see that this is the correct one."}, {"owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "edited": false, "score": 0, "creation_date": 1476027298, "post_id": 39945207, "comment_id": 67170861, "body": "Sure Bazzz :) I just can&#39;t &#39;cause I&#39;ve to wait some minutes. But then I&#39;ll definitively :)"}], "tags": [], "owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "is_accepted": true, "score": 1, "last_activity_date": 1476027249, "last_edit_date": 1476027249, "creation_date": 1476026588, "answer_id": 39945207, "question_id": 39945195, "link": "https://stackoverflow.com/questions/39945195/how-can-i-access-a-variable-when-ive-outsourced-my-models-in-a-own-package/39945207#39945207", "title": "How can I access a variable when I&#39;ve outsourced my models in a own package", "body": "<p>You need to write the attribute <code>name</code> with a capital letter <code>N</code> and it will work.\nLike this:</p>\n\n<pre><code>package models\n\ntype Student struct {\n    Name string\n    Number int\n}\n</code></pre>\n\n<p>Small letter means unexported (private) in Go and capital letter means exported (public).<br/>\nAlso see: <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow\">A Tour of Go</a></p>\n"}], "owner": {"reputation": 457, "user_id": 6171578, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9e035177e9539ce163b0197a777b34f7?s=128&d=identicon&r=PG&f=1", "display_name": "botscripter", "link": "https://stackoverflow.com/users/6171578/botscripter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 39945207, "answer_count": 1, "score": 1, "last_activity_date": 1476027249, "creation_date": 1476026496, "question_id": 39945195, "link": "https://stackoverflow.com/questions/39945195/how-can-i-access-a-variable-when-ive-outsourced-my-models-in-a-own-package", "title": "How can I access a variable when I&#39;ve outsourced my models in a own package", "body": "<p>Hi guys and thanks in advance for your help! :)</p>\n\n<p>I try to learn Go and wanna ask how I can access a variable defined in a struct in an own class. How do you make your models in go? I really wanna put the models in a own class.</p>\n\n<p>When I do this I cant access the Variables of my struct Student.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/nikolastankovic/hello/models\"\n)\n\nfunc main() {\n    var nikola models.Student\n    nikola.name = \"nikola\" // THIS DOESN'T WORK :(\n    fmt.Println(nikola)\n}\n</code></pre>\n\n<p>Model Student in subpackage models:</p>\n\n<pre><code>package models\n\ntype Student struct {\n    name string\n    number int\n}\n</code></pre>\n"}, {"tags": ["intellij-idea", "go"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1476023597, "post_id": 39943469, "comment_id": 67169705, "body": "List your $GOPATH environment variable."}, {"owner": {"reputation": 421, "user_id": 6862012, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/f6e2aaae0112ecfad3fed2ba18452b7f?s=128&d=identicon&r=PG&f=1", "display_name": "John Dui", "link": "https://stackoverflow.com/users/6862012/john-dui"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1476069041, "post_id": 39943469, "comment_id": 67181700, "body": "@eduncan911, the GOPATH that is set on my system is: <code>&#47;Users&#47;&lt;username&gt;&#47;Desktop&#47;Work&#47;Cloud&#47;godir</code>. And my project is at, <code>&#47;Users&#47;&lt;username&gt;Desktop&#47;Work&#47;Cloud&#47;godir&#47;src&#47;stash&#47;cloud&#47;co&zwnj;&#8203;nduc</code>."}, {"owner": {"reputation": 12819, "user_id": 2387977, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b867b7871c56b1308ee19a2a08b45563?s=128&d=identicon&r=PG", "display_name": "Dherik", "link": "https://stackoverflow.com/users/2387977/dherik"}, "edited": false, "score": 0, "creation_date": 1586452663, "post_id": 39943469, "comment_id": 108140068, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/37282285/intellij-cannot-find-any-declarations\">IntelliJ cannot find any declarations</a>"}, {"owner": {"reputation": 538, "user_id": 9229923, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyFBF.jpg?s=128&g=1", "display_name": "Jingnan Jia", "link": "https://stackoverflow.com/users/9229923/jingnan-jia"}, "edited": false, "score": 0, "creation_date": 1604931337, "post_id": 39943469, "comment_id": 114489771, "body": "Did you set the correct Interpreter?"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 7630232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e6bcad282380b7fc730bf78e05523d?s=128&d=identicon&r=PG&f=1", "display_name": "user7630232", "link": "https://stackoverflow.com/users/7630232/user7630232"}, "edited": false, "score": 0, "creation_date": 1607497828, "post_id": 46590346, "comment_id": 115287906, "body": "this worked. However, I had to perform one additional step after 4, to manually add back .iml file, as it was not created automatically."}], "tags": [], "owner": {"reputation": 8004, "user_id": 973737, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d950f527c72c44682f219f09c6803981?s=128&d=identicon&r=PG", "display_name": "Rich Sutton", "link": "https://stackoverflow.com/users/973737/rich-sutton"}, "is_accepted": false, "score": 1, "last_activity_date": 1507220142, "creation_date": 1507220142, "answer_id": 46590346, "question_id": 39943469, "link": "https://stackoverflow.com/questions/39943469/why-cannot-find-declaration-to-go-to-in-intellij-idea/46590346#46590346", "title": "Why cannot find declaration to go to in IntelliJ Idea?", "body": "<p>I'm using Gogland, which is also a JetBrains IDE, but I also had a problem with symbols not getting resolved.</p>\n\n<p>I fixed it by deleting the project's index file.</p>\n\n<ol>\n<li>Close the IDE.</li>\n<li>In your project directory, find a directory named \".idea\".</li>\n<li>Delete all files with the extension \".iml\" in that directory.</li>\n<li>Restart the IDE.</li>\n</ol>\n\n<p>The project should get reindexed and symbols will be resolved.</p>\n\n<p><a href=\"https://www.jetbrains.org/intellij/sdk/docs/basics/project_structure.html?search=.iml\" rel=\"nofollow noreferrer\">https://www.jetbrains.org/intellij/sdk/docs/basics/project_structure.html?search=.iml</a></p>\n"}, {"tags": [], "owner": {"reputation": 538, "user_id": 9229923, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyFBF.jpg?s=128&g=1", "display_name": "Jingnan Jia", "link": "https://stackoverflow.com/users/9229923/jingnan-jia"}, "is_accepted": false, "score": 0, "last_activity_date": 1604931421, "creation_date": 1604931421, "answer_id": 64753328, "question_id": 39943469, "link": "https://stackoverflow.com/questions/39943469/why-cannot-find-declaration-to-go-to-in-intellij-idea/64753328#64753328", "title": "Why cannot find declaration to go to in IntelliJ Idea?", "body": "<p>For my case, I have 2 virtual environments, and I found that I did not set the correct environment in Pycharm. The environment I used did not include these packages. After I changed the environment, everything goes well.</p>\n"}], "owner": {"reputation": 421, "user_id": 6862012, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/f6e2aaae0112ecfad3fed2ba18452b7f?s=128&d=identicon&r=PG&f=1", "display_name": "John Dui", "link": "https://stackoverflow.com/users/6862012/john-dui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15144, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1607544415, "creation_date": 1476015045, "question_id": 39943469, "link": "https://stackoverflow.com/questions/39943469/why-cannot-find-declaration-to-go-to-in-intellij-idea", "title": "Why cannot find declaration to go to in IntelliJ Idea?", "body": "<p>I have a code in go, and I am using IntelliJIdea for development. It used to work fine, but since the time I have changed the folder where the code used to be, IntelliJ has been behaving in a weird manner. It shows me a lot of <code>unable to find declaration to go to errors</code>. After changing the folder where my project used to be, I changed the GOPATH and imported from the new directory once again. </p>\n\n<p>I am attaching the screenshot as that will be better for understanding. </p>\n\n<p><a href=\"http://i.stack.imgur.com/9gUUf.png\" rel=\"nofollow\">See the conductor.Start(). This function is right there in the package app. But it can't find this.</a></p>\n\n<p>PS: I have tried importing the project from scratch and invalidating and restarting multiple times, but that didn't help. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "edited": false, "score": 0, "creation_date": 1476021681, "post_id": 39943799, "comment_id": 67169126, "body": "That appears to make sense, but unfortunately I still get the same <code>cannot use timer_modules (type []Timer) as type []Module in argument to RegisterModules</code>"}, {"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "edited": false, "score": 0, "creation_date": 1476022124, "post_id": 39943799, "comment_id": 67169262, "body": "It does work if I only pass single instances of <code>Timer</code>, but it doesn&#39;t for a slice of timers <code>[]Timer</code>."}, {"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "edited": false, "score": 0, "creation_date": 1476022220, "post_id": 39943799, "comment_id": 67169287, "body": "Updated the question accordingly"}], "tags": [], "owner": {"reputation": 76, "user_id": 2014640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231f12584c6c45ca62a176ba332eaca0?s=128&d=identicon&r=PG", "display_name": "John Murphy", "link": "https://stackoverflow.com/users/2014640/john-murphy"}, "is_accepted": false, "score": 0, "last_activity_date": 1476017240, "creation_date": 1476017240, "answer_id": 39943799, "question_id": 39943369, "link": "https://stackoverflow.com/questions/39943369/interface-hierarchy-in-go/39943799#39943799", "title": "Interface hierarchy in Go", "body": "<p>Change your declaration of Timer</p>\n\n<pre><code>type Timer interface {\n  Module\n  GetTicker()(*time.Ticker)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1476080234, "post_id": 39950654, "comment_id": 67184443, "body": "what if you use the variadic <code>...</code> operator ? so the range loop an be removed?"}, {"owner": {"reputation": 26, "user_id": 2692599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e49b37247758c1776a9eac4ecd6ec3a8?s=128&d=identicon&r=PG&f=1", "display_name": "steve wang", "link": "https://stackoverflow.com/users/2692599/steve-wang"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1476090950, "post_id": 39950654, "comment_id": 67189572, "body": "<code>...</code> behaves the way same with slice and does not work."}, {"owner": {"reputation": 26, "user_id": 2692599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e49b37247758c1776a9eac4ecd6ec3a8?s=128&d=identicon&r=PG&f=1", "display_name": "steve wang", "link": "https://stackoverflow.com/users/2692599/steve-wang"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1476091084, "post_id": 39950654, "comment_id": 67189648, "body": "The other way is to introduce reflect, which brings performance lost and code complexity."}], "tags": [], "owner": {"reputation": 26, "user_id": 2692599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e49b37247758c1776a9eac4ecd6ec3a8?s=128&d=identicon&r=PG&f=1", "display_name": "steve wang", "link": "https://stackoverflow.com/users/2692599/steve-wang"}, "is_accepted": false, "score": 1, "last_activity_date": 1476067702, "creation_date": 1476067702, "answer_id": 39950654, "question_id": 39943369, "link": "https://stackoverflow.com/questions/39943369/interface-hierarchy-in-go/39950654#39950654", "title": "Interface hierarchy in Go", "body": "<p><a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow\">https://golang.org/doc/faq#convert_slice_of_interface</a> gives explanations.\nOne of the workarounds is to implement a new register function:</p>\n\n<pre><code>func RegisterModule(m Module) {\n  modules = append(modules, m)\n}\n</code></pre>\n\n<p>and invoke the function in a range at the cost of only two more lines:</p>\n\n<pre><code>func NewTimerFactory() TimerFactory {\n  tfact := TimerFactory{}\n  for _, t := range timer_modules {\n    RegisterModule(t)\n  }\n  return tfact\n}\n</code></pre>\n"}], "owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1476067702, "creation_date": 1476014461, "last_edit_date": 1476022200, "question_id": 39943369, "link": "https://stackoverflow.com/questions/39943369/interface-hierarchy-in-go", "title": "Interface hierarchy in Go", "body": "<p>I have a program where multiple types of modules are used, but all the different types of modules share certain methods. I'm trying to build a generic factory that can be reused for the different types of modules, but I'm missing something like interface inheritance or however that would be called in Go. </p>\n\n<p>This is an example that I tried to simplify as good as possible:</p>\n\n<p>There is a generic factory which uses a generic <code>Module</code> interface:</p>\n\n<pre><code>package main\n\nvar (\n  modules []Module\n)\n\ntype Module interface {\n  RegisterFlagSet()\n  GetName() (string)\n}\n\ntype Factory struct {\n  instances []Module\n}\n\nfunc RegisterModules(modules []Module) {\n  modules = modules\n}\n\nfunc (f *Factory) registerFlagSets() {\n  for _,inst := range f.instances {\n    inst.RegisterFlagSet()\n  }\n}\n\nfunc (f *Factory) GetInstance(seek string)(Module) {\n  for _,inst := range f.instances {\n    if (inst.GetName() == seek) {\n      return inst\n    }\n  }\n  panic(\"cannot find module\")\n}\n</code></pre>\n\n<p>Then there's a more specific implementation for the module type <code>Timer</code>. I'm trying to reuse as much of the factory as possible:</p>\n\n<pre><code>package main\n\nimport (\n  \"time\"\n)\n\nvar (\n  timer_modules = []Timer{\n    // list all the timer modules here\n  }\n)\n\ntype Timer interface {\n  Module\n  GetTicker() (*time.Ticker)\n}\n\ntype TimerFactory struct {\n  Factory\n}\n\nfunc NewTimerFactory() TimerFactory {\n  tfact := TimerFactory{}\n  RegisterModules(timer_modules)\n  return tfact\n}\n</code></pre>\n\n<p>When I try to build that I get this error:</p>\n\n<pre><code>timer_factory.go:25: cannot use timer_modules (type []Timer) as type []Module in argument to RegisterModules\n</code></pre>\n\n<p>I don't understand why a variable of <code>type []Timer</code> cannot be used as <code>type []Module</code> because all the methods of the interface <code>Module</code> are also in the interface <code>Timer</code>, so they should be compatible or not? Is there a way to make them compatible?</p>\n"}, {"tags": ["json", "mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "edited": false, "score": 0, "creation_date": 1476022075, "post_id": 39943111, "comment_id": 67169247, "body": "So in the above example what would be your expected output?"}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "edited": false, "score": 0, "creation_date": 1476022839, "post_id": 39943111, "comment_id": 67169464, "body": "oh I will update example with output"}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "edited": false, "score": 0, "creation_date": 1476023132, "post_id": 39943111, "comment_id": 67169556, "body": "@chridam I updated question."}], "answers": [{"comments": [{"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476027424, "post_id": 39944933, "comment_id": 67170901, "body": "Thank you @chridam, I&#39;ll go through your answer and give a feedback soon."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476031527, "post_id": 39944933, "comment_id": 67172158, "body": "Can we retrieve each count without mentioning name such as mentioning linux or ubuntu..because we cannot defined it. some time there can be different OS such as windows..can we achieve it. Please give soultion for that. @chridam"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476031951, "post_id": 39944933, "comment_id": 67172276, "body": "Yes, but that means your initial expected output structure will change since the alternative approach does not take into consideration the totals as key/value pair. Check updated answer."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476033817, "post_id": 39944933, "comment_id": 67172950, "body": "Thanks @ chridam your support.I am appreciate that. I&#39;ll give update you after checking on my side."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476078061, "post_id": 39944933, "comment_id": 67183657, "body": "@chiridam there was an error happen following like this. &quot;Unrecognized pipeline stage name: &#39;match&#39;"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476078329, "post_id": 39944933, "comment_id": 67183740, "body": "@SandunPriyanka That was a typo on my part, now corrected."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476078892, "post_id": 39944933, "comment_id": 67183936, "body": "I also remove  double quotation marks between aggregation stages then it is works.Thank you,It is reduce my time."}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476079012, "post_id": 39944933, "comment_id": 67183980, "body": "@SandunPriyanka No worries, always happy to help :)"}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476185239, "post_id": 39944933, "comment_id": 67231048, "body": "@chiridam.. how I get distinct all useragents in the venuelist one query. i used following query but it is not given by aspected result  db.useragents.aggregate([       {          &quot;$group&quot;: {             &quot;_id&quot;: &quot;$venueList.sum.name&quot;         }     },     {          &quot;$group&quot;: {             &quot;_id&quot;: null,             &quot;counts&quot;: {                 &quot;$push&quot;: {                     &quot;name&quot;: &quot;$_id&quot;,                 }             }         }     } ])   I want get array all distinct useagents OS list"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1476185566, "post_id": 39944933, "comment_id": 67231218, "body": "Hard to follow what you are asking. Can you please open a new question detailing what is wrong and what your expected output is? Because it&#39;s not recommended here on StackOverflow to update an accepted answer where the <a href=\"http://meta.stackexchange.com/questions/43478/exit-strategies-for-chameleon-questions\"><b>question changes</b></a>."}], "tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": true, "score": 2, "last_activity_date": 1476078285, "last_edit_date": 1476078285, "creation_date": 1476024743, "answer_id": 39944933, "question_id": 39943111, "link": "https://stackoverflow.com/questions/39943111/retrieve-item-list-by-checking-multiple-attribute-values-in-mongodb-in-golang/39944933#39944933", "title": "Retrieve item list by checking multiple attribute values in MongoDB in golang", "body": "<p>You'd need to use the aggregation framework where you would run an aggregation pipeline that first filters the documents in the collection based on \nthe <code>venueList</code> ids using the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\" rel=\"nofollow\"><code>$match</code></a></strong> operator. </p>\n\n<p>The second pipeline would entail flattening the <code>venueList</code> and <code>sum</code> subdocument arrays in order for the data in the documents to be processed further down the pipeline as denormalised entries. The <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind\" rel=\"nofollow\"><code>$unwind</code></a></strong> operator is useful here. </p>\n\n<p>A further filter using <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match\" rel=\"nofollow\"><code>$match</code></a></strong> is necessary after unwinding so that only the documents you want to aggregate are allowed into the next pipeline.</p>\n\n<p>The main pipeline would be the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group\" rel=\"nofollow\"><code>$group</code></a></strong> operator stage which aggregates the filtered documents to create the desired sums using the accumulator operator <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum\" rel=\"nofollow\"><code>$sum</code></a></strong>. For the desired result, you would need to use a tenary operator like <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/cond/#exp._S_cond\" rel=\"nofollow\"><code>$cond</code></a></strong> to create the independent count fields since that will feed the number of documents to the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/sum/#grp._S_sum\" rel=\"nofollow\"><code>$sum</code></a></strong> expression depending on the name value.</p>\n\n<p>Putting this altogether, consider running the following pipeline:</p>\n\n<pre><code>db.collection.aggregate([\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList\" },\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList.sum\" },    \n    {\n        \"$group\": {\n            \"_id\": null,\n            \"linux\": {\n                \"$sum\": {\n                    \"$cond\": [ \n                        { \"$eq\": [ \"$venueList.sum.name\", \"linux\" ] }, \n                        \"$venueList.sum.value\", 0 \n                    ]\n                }\n            },\n            \"ubuntu\": {\n                \"$sum\": {\n                    \"$cond\": [ \n                        { \"$eq\": [ \"$venueList.sum.name\", \"ubuntu\" ] }, \n                        \"$venueList.sum.value\", 0 \n                    ]\n                }\n            }\n        }\n    }\n])\n</code></pre>\n\n<p>For usage with mGo, you can convert the above pipeline using the guidance in <a href=\"http://godoc.org/labix.org/v2/mgo#Collection.Pipe\" rel=\"nofollow\">http://godoc.org/labix.org/v2/mgo#Collection.Pipe</a></p>\n\n<hr>\n\n<p>For a more flexible and better performant alternative which executes much faster than the above, and also takes into consideration unknown values for the sum list, run the alternative pipeline as follows</p>\n\n<pre><code>db.collection.aggregate([\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList\" },\n    { \"$match\": { \"venueList.id\": { \"$in\": [\"VID1212\", \"VID4343\"] } } },\n    { \"$unwind\": \"$venueList.sum\" },    \n    { \n        \"$group\": {\n            \"_id\": \"$venueList.sum.name\",\n            \"count\": { \"$sum\": \"$venueList.sum.value\" }\n        }\n    },\n    { \n        \"$group\": {\n            \"_id\": null,\n            \"counts\": {\n                \"$push\": {\n                    \"name\": \"$_id\",\n                    \"count\": \"$count\"\n                }\n            }\n        }\n    }\n])\n</code></pre>\n"}], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1027, "favorite_count": 0, "accepted_answer_id": 39944933, "answer_count": 1, "score": 5, "last_activity_date": 1476078285, "creation_date": 1476012830, "last_edit_date": 1476028157, "question_id": 39943111, "link": "https://stackoverflow.com/questions/39943111/retrieve-item-list-by-checking-multiple-attribute-values-in-mongodb-in-golang", "title": "Retrieve item list by checking multiple attribute values in MongoDB in golang", "body": "<p>This question based on MongoDB,How to retrieve selected items retrieve by selecting multiple condition.It is like IN condition in Mysql </p>\n\n<blockquote>\n  <p>SELECT * FROM venuelist WHERE venueid IN (venueid1, venueid2)</p>\n</blockquote>\n\n<p>I have attached json data structure that I have used.<strong><em>[Ref: JSON STRUCTUE OF MONGODB ]</em></strong>.</p>\n\n<p>As an example, it has a venueList then inside the venue list, It has several attribute venue id and sum of user agents name and total count as value.user agents mean user Os,browser and device information. In this case I used os distribution.In that case i was count linux,ubuntu count on particular venueid.</p>\n\n<p>it is like that,</p>\n\n<pre><code>\"sum\" : [\n    {\n        \"name\" : \"linux\",\n        \"value\" : 12\n    },\n    {\n        \"name\" : \"ubuntu\",\n        \"value\" : 4\n    }\n],\n</code></pre>\n\n<p>Finally I want to get count of all linux user count by selecting venueid list in one find query in MongoDB.</p>\n\n<p>As example, I want to select all count of linux users by conditioning if venue id <strong><em>VID1212</em></strong> or <strong><em>VID4343</em></strong></p>\n\n<p><strong>Ref: JSON STRUCTUE OF MONGODB</strong></p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"57f940c4932a00aba387b0b0\"),\n    \"tenantID\" : 1,\n    \"date\" : \"2016-10-09 00:23:56\",\n    \"venueList\" : [\n        {\n            \"id\" : \u201cVID1212\u201d,\n            \"sum\" : [\n                {\n                      \"name\" : \"linux\",\n                      \"value\" : 12\n                },\n                {\n                    \"name\" : \"ubuntu\",\n                    \"value\" : 4\n                }\n            ],\n            \u201cssidList\u201d : [    // this is list of ssid\u2019s in venue\n                {\n                    \"id\" : \u201cSSID1212\u201d,\n                    \"sum\" : [\n                        {\n                            \"name\" : \"linux\",\n                            \"value\" : 8\n                        },\n                        {\n                            \"name\" : \"ubuntu\",\n                            \"value\" : 6\n                        }\n                    ],\n                    \u201cmacList\u201d : [  // this is mac list inside particular ssid  ex: this is mac list inside the SSID1212\n                        {\n                            \"id\" : \u201c12:12:12:12:12:12\u201d,\n                            \"sum\" : [\n                                {\n                                    \"name\" : \"linux\",\n                                    \"value\" : 12\n                                },\n                                {\n                                    \"name\" : \"ubuntu\",\n                                    \"value\" : 1\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        },\n        {\n            \"id\" : \u201cVID4343\u201d,\n            \"sum\" : [\n                {\n                     \"name\" : \"linux\",\n                     \"value\" : 2\n                }\n            ],\n            \"ssidList\" : [\n                {\n                    \"id\" : \u201cSSID4343\u201d,\n                    \"sum\" : [\n                        {\n                            \"name\" : \"linux\",\n                            \"value\" : 2\n                        }\n                    ],\n                    \"macList\" : [\n                        {\n                            \"id\" : \u201c43:43:43:43:43:34\u201d,\n                            \"sum\" : [\n                                {\n                                    \"name\" : \"linux\",\n                                    \"value\" : 2\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>I am using golang as language to manipulation data with mongoldb using mgo.v2 package</p>\n\n<blockquote>\n  <p>expected out put is :</p>\n  \n  <p>output</p>\n  \n  <ul>\n  <li>linux : 12+2 = 14 </li>\n  <li>ubuntu : 4+0 = 4</li>\n  </ul>\n  \n  <p>Don't consider inner list in venuelist.</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 407, "user_id": 74375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c25b3f805ce3af359a16cb5a2de22964?s=128&d=identicon&r=PG", "display_name": "sudorandom", "link": "https://stackoverflow.com/users/74375/sudorandom"}, "edited": false, "score": 1, "creation_date": 1475993579, "post_id": 39940528, "comment_id": 67162283, "body": "benchmark/parse isn&#39;t a main package. There is no binary generated from that path."}, {"owner": {"reputation": 407, "user_id": 74375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c25b3f805ce3af359a16cb5a2de22964?s=128&d=identicon&r=PG", "display_name": "sudorandom", "link": "https://stackoverflow.com/users/74375/sudorandom"}, "edited": false, "score": 2, "creation_date": 1475993641, "post_id": 39940528, "comment_id": 67162290, "body": "See here: <a href=\"https://github.com/golang/tools/tree/master/benchmark/parse\" rel=\"nofollow noreferrer\">github.com/golang/tools/tree/master/benchmark/parse</a>  You probably want <code>go get golang.org&#47;x&#47;tools&#47;cmd&#47;...</code>. That will fetch all of the &#39;official&#39; go tools at once."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476018113, "post_id": 39940528, "comment_id": 67168159, "body": "Also <code>$GOPATH&#47;golang.org&#47;x&#47;tools&#47;benchmark&#47;parse</code> isn&#39;t a valid source path. The source should be in <code>$GOPATH&#47;src</code>"}, {"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476046166, "post_id": 39940528, "comment_id": 67177046, "body": "@JimB Sorry that was a typo"}], "answers": [{"comments": [{"owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "edited": false, "score": 0, "creation_date": 1476209152, "post_id": 39983271, "comment_id": 67246198, "body": "Thanks, I&#39;m new to the whole GoLang scene and appreciate the answers to rookie questions like these. Part of the misunderstanding was that build didn&#39;t spit any kind of error out."}], "tags": [], "owner": {"reputation": 13175, "user_id": 2529592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/817d84aa4a92cb949ad6c24d91168328?s=128&d=identicon&r=PG", "display_name": "wgj", "link": "https://stackoverflow.com/users/2529592/wgj"}, "is_accepted": true, "score": 5, "last_activity_date": 1476207403, "creation_date": 1476207403, "answer_id": 39983271, "question_id": 39940528, "link": "https://stackoverflow.com/questions/39940528/cant-build-or-install-go-tools-binaries/39983271#39983271", "title": "Can&#39;t build or install GO tools binaries", "body": "<p>You can't build benchmark/parse, but you can import it.</p>\n\n<p>From <a href=\"https://godoc.org/golang.org/x/tools\" rel=\"noreferrer\">Godoc for Tools</a>:</p>\n\n<blockquote>\n  <p>Package parse provides support for parsing benchmark results as generated by 'go test -bench'.</p>\n</blockquote>\n\n<p>sudorandom's comment is right, <a href=\"https://github.com/golang/tools/blob/master/benchmark/parse/parse.go\" rel=\"noreferrer\">parse.go</a> doesn't use <code>package main</code>, so it won't generate a binary, while you can use it within your own code with <code>import \"golang.org/x/tools/benchmark/parse\"</code>.</p>\n"}], "owner": {"reputation": 2697, "user_id": 3174123, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/JQalB.png?s=128&g=1", "display_name": "Rice", "link": "https://stackoverflow.com/users/3174123/rice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 39983271, "answer_count": 1, "score": 4, "last_activity_date": 1476207403, "creation_date": 1475992879, "last_edit_date": 1476046190, "question_id": 39940528, "link": "https://stackoverflow.com/questions/39940528/cant-build-or-install-go-tools-binaries", "title": "Can&#39;t build or install GO tools binaries", "body": "<p>I am trying to build some GO tools in my project. I first run </p>\n\n<pre><code>go get golang.org/x/tools/benchmark/parse\n</code></pre>\n\n<p>The folder/binary structure does appear correctly under </p>\n\n<pre><code>$GOPATH/src/golang.org/x/tools/benchmark/parse\n</code></pre>\n\n<p>I tried running: <code>go build golang.org/x/tools/benchmark/parse</code></p>\n\n<p>and</p>\n\n<p><code>go install golang.org/x/tools/benchmark/parse</code></p>\n\n<p>however the binaries still do not appear in my <code>$GOPATH/bin</code></p>\n\n<p>Any help is greatly appreciated!</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1475972308, "post_id": 39938668, "comment_id": 67159059, "body": "I know you dropped Gorilla, but the Gorilla chat example is a great place to start.  With the Gorilla example, you can send to a single connection using <code>client.send &lt;- message</code>.  In other words, send to one connection instead of loop over all connections."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4360057"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1475972552, "post_id": 39938668, "comment_id": 67159094, "body": "Noted. I shall take a look at that example!"}], "owner": {"user_type": "does_not_exist", "display_name": "user4360057"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475971554, "creation_date": 1475971554, "question_id": 39938668, "link": "https://stackoverflow.com/questions/39938668/retrieve-a-specific-websocket-connection", "title": "Retrieve a specific websocket connection", "body": "<p>I am trying to send a message to a WebSocket by referencing it's specific connection, which I maintain in a map of <code>map[*websocket.Conn]bool</code>. I do <em>not</em> want to broadcast the message using a channel but instead want to send a direct message to a specific connection.</p>\n\n<pre><code>(godebug) p clients.conn\nmap[*websocket.Conn]bool{(*websocket.Conn)(0xc420126000):true, (*websocket.Conn)(0xc4200f86c0):true}\n</code></pre>\n\n<p>I have opted out of Gorilla for now and am using the <code>x/net/websocket</code> sub-repository.</p>\n\n<p>Any tips would be appreciated.</p>\n"}, {"tags": ["go", "middleware"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1476293791, "post_id": 39938624, "comment_id": 67287740, "body": "Can you try logging the headers directly in recorderFunc ? <code>log.Println(req.Header.Get(TransIDHeader), w.Header().Get(TransIDHeader))</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088543"}, "reply_to_user": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1476475343, "post_id": 39938624, "comment_id": 67378451, "body": "I <i>thought</i> I did that earlier, and it printed the empty string, but I can try again."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1476528516, "post_id": 39938624, "comment_id": 67390682, "body": "Can you confirm that <code>TransIDPrefix + tid.String()</code> is not an empty string because, I was able to print the values when I used hardcoded strings."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3088543"}, "reply_to_user": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1476721598, "post_id": 39938624, "comment_id": 67455280, "body": "It was when I did a println(), but I&#39;ll verify. I&#39;ve been pulled off on other projects for the time being. Should be back to it this week."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3088543"}, "edited": false, "score": 1, "creation_date": 1477152828, "post_id": 40100240, "comment_id": 67654438, "body": "Good catch. I messed that up trying to fix this test due to an unrelated problem. Writing while sleepy is a bad idea. :-/"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 1, "last_activity_date": 1476769993, "last_edit_date": 1476769993, "creation_date": 1476768741, "answer_id": 40100240, "question_id": 39938624, "link": "https://stackoverflow.com/questions/39938624/modify-request-header-in-middleware/40100240#40100240", "title": "Modify request header in middleware", "body": "<p>In your test, <code>req.Header.Get(RequestTestHeader)</code> will always remain an empty string because you are not setting the Key as 'RequestTestHeader' in the request header but in the ResponseWriter  <code>w.Header().Set(RequestTestHeader, req.Header.Get(TransIDHeader))</code></p>\n\n<p>On an unrelated note, It would be considered idomatic Go, to have your middleware function signature using the http.Handler interface, <code>func HandleTransactionID(fn http.Handler) http.Handler</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3088543"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1488, "favorite_count": 0, "accepted_answer_id": 40100240, "answer_count": 1, "score": 0, "last_activity_date": 1476769993, "creation_date": 1475971230, "last_edit_date": 1476102693, "question_id": 39938624, "link": "https://stackoverflow.com/questions/39938624/modify-request-header-in-middleware", "title": "Modify request header in middleware", "body": "<p>Hopefully, this is an easy way to earn some rep. This seems very simple, so I must be doing something wrong and just cant see it.</p>\n\n<p>I have a simple middleware which a transaction id and adds it to the request and response headers.</p>\n\n<pre><code>    func HandleTransactionID(fn http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, req *http.Request) {\n        tid := uuid.NewV4()\n        req.Header.Set(TransIDHeader, TransIDPrefix + tid.String())\n        w.Header().Set(TransIDHeader, TransIDPrefix + tid.String())\n        fn(w, req)\n    }\n}\n</code></pre>\n\n<p>In my unit tests, I've confirmed the response header is successfully set, but it doesn't appear the the request header is being set. I would assume that it is possible to modify the request headers, so ?</p>\n\n<pre><code>const (\n    WriteTestHeader = \"WriterTransHeader\"\n    RequestTestHeader = \"ReqTransHeader\"\n)\n\n\nfunc recorderFunc(w http.ResponseWriter, req *http.Request){\n    w.Header().Set(WriteTestHeader, w.Header().Get(TransIDHeader))\n    w.Header().Set(RequestTestHeader, req.Header.Get(TransIDHeader))\n}\n\nfunc TestHandleTransactionID(t *testing.T) {\n    recorder := httptest.NewRecorder()\n    req := httptest.NewRequest(\"GET\", \"/foo\", nil)\n    middleware.HandleTransactionID(recorderFunc)(recorder, req)\n\n    if req.Header.Get(RequestTestHeader) == \"\" {\n        t.Error(\"request header is nil\")\n    }\n    if recorder.Header().Get(WriteTestHeader) == \"\" {\n        t.Error(\"response header is nil\")\n    }\n    if req.Header.Get(RequestTestHeader) != recorder.Header().Get(WriteTestHeader) {\n        t.Errorf(\"header value mismatch: %s != %s\",\n            req.Header.Get(RequestTestHeader),\n            recorder.Header().Get(WriteTestHeader))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "travis-ci", "hugo"], "answers": [{"comments": [{"owner": {"reputation": 984, "user_id": 6641516, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-b__FzxzSmgU/AAAAAAAAAAI/AAAAAAAABqE/zRhjNLBdLQE/photo.jpg?sz=128", "display_name": "Derick Alangi", "link": "https://stackoverflow.com/users/6641516/derick-alangi"}, "edited": false, "score": 0, "creation_date": 1502660019, "post_id": 39937565, "comment_id": 78287841, "body": "Wonderful. This worked for me. Spared me some great amount of time. Thank you :)"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 8, "last_activity_date": 1512316688, "last_edit_date": 1512316688, "creation_date": 1475962043, "answer_id": 39937565, "question_id": 39937224, "link": "https://stackoverflow.com/questions/39937224/travis-go-error-the-command-eval-go-get-t-v-failed/39937565#39937565", "title": "travis go error &#39;The command &quot;eval go get -t -v ./...&quot; failed&#39;", "body": "<p>Read <a href=\"https://docs.travis-ci.com/user/languages/go#Dependency-Management\" rel=\"noreferrer\">this</a>, the <code>go get ....</code> is part of the default go build script on travis, if no makefile is found.</p>\n\n<p>A simple solution may be to add a Makefile with an <a href=\"https://www.gnu.org/software/make/manual/html_node/Empty-Recipes.html\" rel=\"noreferrer\">empty recipe</a></p>\n\n<pre><code>$ cat Makefile\ntarget: ;\n$ make &amp;&amp; echo \"ok\"\nmake: \u00ab\u00a0target\u00a0\u00bb uptodate.\nok\n</code></pre>\n\n<p>So travis will set the default install step to true, which should avoid the <code>got get</code></p>\n"}], "owner": {"reputation": 1249, "user_id": 1123094, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/e38ffc400eb167249f7703e25f0f838b?s=128&d=identicon&r=PG", "display_name": "willwade", "link": "https://stackoverflow.com/users/1123094/willwade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 865, "favorite_count": 0, "accepted_answer_id": 39937565, "answer_count": 1, "score": 6, "last_activity_date": 1512316688, "creation_date": 1475959715, "question_id": 39937224, "link": "https://stackoverflow.com/questions/39937224/travis-go-error-the-command-eval-go-get-t-v-failed", "title": "travis go error &#39;The command &quot;eval go get -t -v ./...&quot; failed&#39;", "body": "<p>I have a pretty straightforward setup.. \n- a Travis.yml file : <a href=\"https://github.com/openassistive/OpenATFrontEnd/blob/master/.travis.yml\" rel=\"noreferrer\">https://github.com/openassistive/OpenATFrontEnd/blob/master/.travis.yml</a></p>\n\n<p>which has this line:</p>\n\n<pre><code>before_script:\n   - go get -u -v github.com/spf13/hugo\n</code></pre>\n\n<p>but it fails - with</p>\n\n<blockquote>\n  <p>The command \"eval go get -t -v ./...\" failed. Retrying, 2 of 3.</p>\n</blockquote>\n\n<p>(<a href=\"https://travis-ci.org/openassistive/OpenATFrontEnd/builds/166105574\" rel=\"noreferrer\">https://travis-ci.org/openassistive/OpenATFrontEnd/builds/166105574</a>)\nI can't figure it out. I see the language is set correctly - and looking at other SO posts the version number is correct. Is there a different version I should be using?</p>\n"}, {"tags": ["go", "multipartform-data", "multipart"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475971980, "post_id": 39936947, "comment_id": 67158989, "body": "How do you define <code>custReqObj</code>? I think you need to embed/include <code>Request</code> object in your custom request, so you can use methods defined in <code>http.Request</code>. As stated in <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">the doc</a>, <code>Request.FormFile</code> return only the first file. If you have multiple files or multiple section, you should use <a href=\"https://golang.org/pkg/net/http/#Request.MultipartReader\" rel=\"nofollow noreferrer\"><code>Request.MultipartReader</code></a> to read each part, then call <code>Part.FileName</code> or <code>Part.FormName</code> to access corresponding data."}], "answers": [{"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 3, "last_activity_date": 1475999629, "last_edit_date": 1475999629, "creation_date": 1475999308, "answer_id": 39941256, "question_id": 39936947, "link": "https://stackoverflow.com/questions/39936947/multipart-file-upload-how-to-handle-fileheaders/39941256#39941256", "title": "Multipart File Upload: How to Handle FileHeaders", "body": "<p>You should call <code>req.ParseMultipartForm(SOME_SIZE)</code> before using <code>req.MultipartForm</code>; something like:</p>\n\n<pre><code>err := req.ParseMultipartForm(SOME_SIZE)\nif err != nil {\n    // ...\n}\n\nformdata := req.MultipartForm\nfor k, files := range formdata.File {\n    for i := range files {\n        file, err := files[i].Open()\n        defer file.Close()\n        if err != nil {\n            // ...\n        }\n\n        fp := filepath.Join(someDirWithProperAccess, files[i].Filename)\n        out, err := os.Create(fp)\n        defer out.Close()\n        if err != nil {\n            // ...\n        }\n\n        _, err = io.Copy(out, file)\n\n        if err != nil {\n            logrus.Error(err)\n            return\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1534, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1475999629, "creation_date": 1475957861, "question_id": 39936947, "link": "https://stackoverflow.com/questions/39936947/multipart-file-upload-how-to-handle-fileheaders", "title": "Multipart File Upload: How to Handle FileHeaders", "body": "<p>I need to read a multipart form file. I'm passing custom req obj to handler function rather than the http.request object, I'm using Gorilla Mux.\nHandler Signature is something like this:<br> </p>\n\n<pre><code>func handlerFunc(w http.ResponseWriter, cR *custReqObj)\n</code></pre>\n\n<p>I'm accessing it like this:</p>\n\n<pre><code>fileHeaders := cR.MultipartForm.File[\"file\"]\nfileHeader := fileHeaders[0]\nfileName := fileHeader.Filename\nfile, err := fileHeader.Open()\n</code></pre>\n\n<p>Since I dont have a request object, i cannot do this:</p>\n\n<pre><code>request.FormFile[\"file\"]\n</code></pre>\n\n<p>I have gone through http.FormFile, it also returns the first file header.</p>\n\n<pre><code>if r.MultipartForm != nil &amp;&amp; r.MultipartForm.File != nil {\n        if fhs := r.MultipartForm.File[key]; len(fhs) &gt; 0 {\n            f, err := fhs[0].Open()\n            return f, fhs[0], err\n        }\n}\n</code></pre>\n\n<p><strong>Is my approach correct and in which cases I'll need to consider multiple file headers?</strong>\nI'd really appreciate if you can shed some light on what is file header and how does multipart package work in golang.</p>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475952743, "post_id": 39936099, "comment_id": 67154078, "body": "This is possible. See possible duplicates: 1. <a href=\"http://stackoverflow.com/questions/38897529/golang-pass-method-to-function/38897667#38897667\"><b>golang - pass method to function</b></a>; 2. <a href=\"http://stackoverflow.com/questions/28251283/golang-function-alias-on-method-receiver/28252088#28252088\"><b>golang function alias on method receiver</b></a>."}], "answers": [{"comments": [{"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "edited": false, "score": 0, "creation_date": 1476016341, "post_id": 39936193, "comment_id": 67167659, "body": "great! Thanks for the comprehensive answer! The Method Expressions did the job"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1475955113, "last_edit_date": 1495535358, "creation_date": 1475953123, "answer_id": 39936193, "question_id": 39936099, "link": "https://stackoverflow.com/questions/39936099/syntax-for-map-with-callback-to-functions-which-have-a-receiver/39936193#39936193", "title": "Syntax for Map with Callback to functions which have a receiver", "body": "<h3>With Method Values</h3>\n\n<p>You may use <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">Method values</a> for this purpose. A method value is a function value with implicit receiver. Quoting from <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">Spec: Method values</a>:</p>\n\n<blockquote>\n  <p>If the expression <code>x</code> has static type <code>T</code> and <code>M</code> is in the method set of type <code>T</code>, <code>x.M</code> is called a method value.</p>\n</blockquote>\n\n<p>So the syntax for a method value is <code>x.M</code>, where for example <code>x</code> is a value of the type, <code>M</code> is the name of the method. This results in a function with the same parameters (and return types) as the method without a receiver, as the receiver will be saved with the method value and will be implicit.</p>\n\n<p>So this means to store method values for your <code>doSometing()</code> and <code>doAnotherThing()</code> methods, the function type will simply be <code>func (int)</code> (no receiver).</p>\n\n<p>Here's a working example:</p>\n\n<pre><code>type mystruct struct {\n    name string\n}\n\nfunc (my *mystruct) doA(i int) {\n    fmt.Printf(\"[doA]: I'm %s, param is: %d\\n\", my.name, i)\n}\n\nfunc (my *mystruct) doB(i int) {\n    fmt.Printf(\"[doB]: I'm %s, param is: %d\\n\", my.name, i)\n}\n\nfunc main() {\n    my1 := &amp;mystruct{\"Bob\"}\n    my2 := &amp;mystruct{\"Alice\"}\n    lookupMap := map[string]func(int){\n        \"action1\": my1.doA,\n        \"action2\": my2.doB,\n    }\n\n    lookupMap[\"action1\"](11)\n    lookupMap[\"action2\"](22)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/UhqqrV1Ngu\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[doA]: I'm Bob, param is: 11\n[doB]: I'm Alice, param is: 22\n</code></pre>\n\n<h3>With Method Expressions</h3>\n\n<p>If you don't want the receiver saved in the dictionary (within the method values), you can go along with the <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow noreferrer\">Method expressions</a>.</p>\n\n<p>The difference is that when you obtain a function value, you don't use <code>x.M</code> but <code>T.M</code>, which will result in a function value, with a function type having the same parameters (and return types), but the receiver type will also be in the parameter list, and in the first place. See quote from <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow noreferrer\">Spec: Method expressions</a>:</p>\n\n<blockquote>\n  <p>If <code>M</code> is in the method set of type <code>T</code>, <code>T.M</code> is a function that is callable as a regular function with the same arguments as <code>M</code> prefixed by an additional argument that is the receiver of the method.</p>\n</blockquote>\n\n<p>So the function type to work with will look like this in your case: <code>func(*mystruct, int)</code></p>\n\n<p>Also, since the receiver will not be saved, you have to provide it when calling these functions.</p>\n\n<p>See this working example (which is the modification of the first example):</p>\n\n<pre><code>type mystruct struct {\n    name string\n}\n\nfunc (my *mystruct) doA(i int) {\n    fmt.Printf(\"[doA]: I'm %s, param is: %d\\n\", my.name, i)\n}\n\nfunc (my *mystruct) doB(i int) {\n    fmt.Printf(\"[doB]: I'm %s, param is: %d\\n\", my.name, i)\n}\n\nfunc main() {\n    lookupMap := map[string]func(*mystruct, int){\n        \"action1\": (*mystruct).doA,\n        \"action2\": (*mystruct).doB,\n    }\n\n    my1 := &amp;mystruct{\"Bob\"}\n    my2 := &amp;mystruct{\"Alice\"}\n    lookupMap[\"action1\"](my1, 11)\n    lookupMap[\"action2\"](my2, 22)\n}\n</code></pre>\n\n<p>Output is the same (try it on the <a href=\"https://play.golang.org/p/GpRYOJkjqt\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[doA]: I'm Bob, param is: 11\n[doB]: I'm Alice, param is: 22\n</code></pre>\n\n<hr>\n\n<p>See similar questions: </p>\n\n<p><a href=\"https://stackoverflow.com/questions/38897529/golang-pass-method-to-function/38897667#38897667\">golang - pass method to function</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/28251283/golang-function-alias-on-method-receiver/28252088#28252088\">golang function alias on method receiver</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11467944, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-EDcjhxJ37fo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdBHB4omis9dTOTcVQROxy0su20Ig/mo/photo.jpg?sz=128", "display_name": "Jacob Lister", "link": "https://stackoverflow.com/users/11467944/jacob-lister"}, "is_accepted": false, "score": 0, "last_activity_date": 1557290206, "creation_date": 1557290206, "answer_id": 56033622, "question_id": 39936099, "link": "https://stackoverflow.com/questions/39936099/syntax-for-map-with-callback-to-functions-which-have-a-receiver/56033622#56033622", "title": "Syntax for Map with Callback to functions which have a receiver", "body": "<p>Similar to Method Values, this can also be achieved with closure scope</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype mystruct struct {\n    name string\n}\n\nfunc addCallbackToMap(lookupMap map[string]func(int), key string, my *mystruct) {\n    lookupMap[key] = func(i int) {\n        fmt.Printf(\"I'm %s, param is: %d\\n\", my.name, i)\n    }\n}\n\nfunc main() {\n    my1 := &amp;mystruct{\"Bob\"}\n    my2 := &amp;mystruct{\"Alice\"}\n\n    lookupMap := map[string]func(int){}\n    addCallbackToMap(lookupMap, \"action1\", my1)\n    addCallbackToMap(lookupMap, \"action2\", my2)\n\n    lookupMap[\"action1\"](11)\n    lookupMap[\"action2\"](22)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Rf1fiQK69ma\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>I'm Bob, param is: 11\nI'm Alice, param is: 22\n</code></pre>\n"}], "owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "accepted_answer_id": 39936193, "answer_count": 2, "score": 4, "last_activity_date": 1557290206, "creation_date": 1475952613, "last_edit_date": 1475952857, "question_id": 39936099, "link": "https://stackoverflow.com/questions/39936099/syntax-for-map-with-callback-to-functions-which-have-a-receiver", "title": "Syntax for Map with Callback to functions which have a receiver", "body": "<p>is it possible to create in golang a map containing functions which have a receiver? </p>\n\n<p>I want to accomplish the following</p>\n\n<p><strong>Function Callbacks:</strong></p>\n\n<pre><code>func (my *mystruct) doSometing(int parameter1){\n// do something\n}\n\nfunc (my *mystruct) doAnotherThing(int parameter1){\n// do something\n}\n</code></pre>\n\n<p><strong>Map containing a pointer to the function</strong></p>\n\n<pre><code>var lookupMap = map[string]func(int){\n    \"action1\" : doSomething,\n    \"action2\" : doAnotherThing\n}\n</code></pre>\n\n<p>This unfortunately doesn't work because the callback functions are bound to a receiver. Go compiler says: </p>\n\n<pre><code>\"undefined doSomething\"\n</code></pre>\n\n<p><strong>My Question:</strong></p>\n\n<p>What is the syntax to create a map where the values are functions which are bound to a specific receiver? </p>\n\n<p>Something like (pseudo code):</p>\n\n<pre><code>var lookupMap = map[string]((*mystruct)func(int)){\n}\n</code></pre>\n\n<p>Any help appreciated!</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1476086511, "last_edit_date": 1476086511, "creation_date": 1476086194, "answer_id": 39953646, "question_id": 39934978, "link": "https://stackoverflow.com/questions/39934978/how-do-i-get-the-current-namespace-in-and-app-engine-delay-function-using-go/39953646#39953646", "title": "How do I get the current namespace in and App Engine delay function using Go?", "body": "<p>Unfortunately you're out of luck. Appengine does not provide an (exported) API call to access the namespace associated with the context.</p>\n\n<p>The namespace association with the context is handled by the <a href=\"https://godoc.org/google.golang.org/appengine/internal\" rel=\"nofollow\"><code>appengine/internal</code></a> package, but <em>\"programs should not use this package directly\"</em>. The context with namespace is obtained by the <a href=\"https://godoc.org/google.golang.org/appengine/internal#NamespacedContext\" rel=\"nofollow\"><code>internal.NamespacedContext()</code></a> call, and the namespace \"extraction\" from context is implemented in <a href=\"https://godoc.org/google.golang.org/appengine/internal#NamespaceFromContext\" rel=\"nofollow\"><code>internal.NamespaceFromContext()</code></a>. These are not part of the public API, so you can't (shouldn't) use them.</p>\n\n<p>You basically have 2 options. One is the \"hacky\" way you presented, which works and you may continue to use it.</p>\n\n<p>Another one is to manually handle it, e.g. by manually putting the namespace into the context with your own key, e.g.:</p>\n\n<pre><code>var namespaceKey = \"myNsKey\"\n\n\nctx = context.WithValue(ctx, namespaceKey, \"mynamespace\")\n</code></pre>\n\n<p>And when you need it, you can get it like:</p>\n\n<pre><code>ns := ctx.Value(namespaceKey)\n</code></pre>\n\n<p>Yes, this has the burden of having to manually update it, and if you'd forgot, you would get an \"invalid\" or empty namespace. So personally I would go with your \"hacky\" way for now (until this functionality is added to the public API, if ever).</p>\n\n<p>If you go with the manual way, to get rid of the \"risk\" factor, you could create a helper function which could take care of this along with the <a href=\"https://godoc.org/google.golang.org/appengine#Namespace\" rel=\"nofollow\"><code>appengine.Namespace()</code></a> call, so you would not forget about it and it would be safe. It could look like this:</p>\n\n<pre><code>func SetNS(ctx context.Context, ns string) context.Context {\n    ctx = ctx, err := appengine.Namespace(ctx, ns)\n    if err != nil {\n        // handle error\n    }\n    ctx = context.WithValue(ctx, namespaceKey, ns)\n    return ctx\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>ctx = SetNS(ctx, \"mynamespace\")\n</code></pre>\n\n<p>But it may be a rare case when you need to access namespace from the context, as when you would need it, it might just be enough to pass the context to the proper (Appengine) API call which can extract it from the context.</p>\n"}], "owner": {"reputation": 3946, "user_id": 736070, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2ffe94c53681b5b72e448cd8a575e687?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/736070/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 39953646, "answer_count": 1, "score": 1, "last_activity_date": 1476086511, "creation_date": 1475945948, "question_id": 39934978, "link": "https://stackoverflow.com/questions/39934978/how-do-i-get-the-current-namespace-in-and-app-engine-delay-function-using-go", "title": "How do I get the current namespace in and App Engine delay function using Go?", "body": "<p>If I set the namespace of my <code>context.Context</code> and call a delay function:</p>\n\n<pre><code>ctx := appengine.NewContext(r)\nctx, err := appengine.Namespace(ctx, \"mynamespace\")\n\ndelayFunc.Call(ctx)\n</code></pre>\n\n<p>How can I find its name:</p>\n\n<pre><code>var delayFunc = delay.Func(\"my-func\", func(ctx context.Context) {\n    // How do I extract \"mynamespace\" from ctx?\n})\n</code></pre>\n\n<p>Is the following acceptable practice?</p>\n\n<pre><code>var delayFunc = delay.Func(\"my-func\", func(ctx context.Context) {\n    n := datastore.NewKey(ctx, \"E\", \"e\", 0, nil).Namespace()\n    // n == \"mynamespace\"\n})\n</code></pre>\n\n<p>It works but feels like a hack.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475939928, "post_id": 39933913, "comment_id": 67149893, "body": "UDP isn&#39;t a stream, so there&#39;s nothing to be &quot;broken&quot;. You also should not use buffered IO on a udp connection, since you need to be incontrol of the individual read size for the datagrams."}, {"owner": {"reputation": 241, "user_id": 782368, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8544465753d56e89bd1bb2c92e9cea7a?s=128&d=identicon&r=PG", "display_name": "Daniyal", "link": "https://stackoverflow.com/users/782368/daniyal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476010213, "post_id": 39933913, "comment_id": 67165945, "body": "I&#39;ve changed the script above. Is there any way to determine if I terminate my UDP server on the other side?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1476017931, "post_id": 39933913, "comment_id": 67168104, "body": "No. UDP is a series of unrelated datagrams. There&#39;s no &quot;connection&quot; to detect being closed or broken. You need another protocol for that, which is usually TCP."}], "owner": {"reputation": 241, "user_id": 782368, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8544465753d56e89bd1bb2c92e9cea7a?s=128&d=identicon&r=PG", "display_name": "Daniyal", "link": "https://stackoverflow.com/users/782368/daniyal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1476010094, "creation_date": 1475939122, "last_edit_date": 1476010094, "question_id": 39933913, "link": "https://stackoverflow.com/questions/39933913/how-can-i-determine-in-go-if-the-connection-to-a-stream-is-broken", "title": "How can I determine in Go if the connection to a stream is broken?", "body": "<p>The following code listens to a stream.</p>\n\n<pre><code>func listen() {\n  conn, err := net.Dial(\"udp\", \"127.0.0.1:10001\")\n  checkError(err)\n\n  conn.Write([]byte(\"PROCEED\"))\n\n  for {\n    s := make([]byte, 1024)\n    conn.Read(s)\n    data := string(s)\n\n    if len(data) &gt; 0 {\n      go processData(data)\n    } else {\n      fmt.Println(\"No bytes received!!!\")\n    }\n  }\n}\n</code></pre>\n\n<p>How can I know in the for loop if my connection is broken?</p>\n"}, {"tags": ["java", "go", "interface"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594368713, "post_id": 39932713, "comment_id": 111107146, "body": "Interfaces do not need to be explicitly implemented by code. They can be embedded in other interfaces and in structs. See <a href=\"https://stackoverflow.com/questions/11054830/if-gos-interfaces-arent-enforced-are-they-necessary/62297796#62297796\" title=\"if gos interfaces arent enforced are they necessary\">stackoverflow.com/questions/11054830/&hellip;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "edited": false, "score": 0, "creation_date": 1475933324, "post_id": 39932840, "comment_id": 67147839, "body": "Thanks bro, but I think this difference is at the level of syntax-sugar, I want to know differences at the programming-language/compiler/runtime level. Something like method table, method finding, runtime type checking, etc..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "edited": false, "score": 0, "creation_date": 1475939923, "post_id": 39932840, "comment_id": 67149891, "body": "@fding See new Edit. I hope this helps."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 6, "last_activity_date": 1475942822, "last_edit_date": 1495540897, "creation_date": 1475932703, "answer_id": 39932840, "question_id": 39932713, "link": "https://stackoverflow.com/questions/39932713/whats-the-differences-between-go-and-java-about-interface/39932840#39932840", "title": "What&#39;s the differences between Go and Java about interface?", "body": "<p><a href=\"http://research.swtch.com/interfaces\" rel=\"noreferrer\">Go Data Structures: Interfaces</a> by Russ Cox</p>\n\n<blockquote>\n  <p>Go's interfaces\u2014static, checked at compile time, dynamic when asked\n  for<br>\n  Go's interfaces let you use duck typing like you would in a purely\n  dynamic language like Python but still have the compiler catch obvious\n  mistakes like passing an int where an object with a Read method was\n  expected, or like calling the Read method with the wrong number of\n  arguments.<br>\n  Interfaces aren't restricted to static checking, though. You can check\n  dynamically whether a particular interface value has an additional\n  method.   </p>\n  \n  <p><strong>Interface Values</strong><br>\n  Languages with methods typically fall into one of two camps: prepare\n  tables for all the method calls statically (as in C++ and Java), or do\n  a method lookup at each call (as in Smalltalk and its many imitators,\n  JavaScript and Python included) and add fancy caching to make that\n  call efficient. <strong>Go sits halfway between the two: it has method tables\n  but computes them at run time.</strong> I don't know whether Go is the first\n  language to use this technique, but it's certainly not a common one.<br>\n  Interface values are represented as a two-word pair giving a pointer\n  to information about the type stored in the interface and a pointer to\n  the associated data. Assigning b to an interface value of type\n  Stringer sets both words of the interface value.  </p>\n  \n  <p>The first word in the interface value points at what I call an\n  interface table or itable (pronounced i-table; in the runtime\n  sources). The itable begins with some metadata about the types\n  involved and then becomes a list of function pointers. Note that the\n  itable corresponds to the interface type, not the dynamic type.<br>\n  The second word in the interface value points at the actual data, in\n  this case a copy of b.</p>\n  \n  <p>Go's dynamic type conversions mean that it isn't reasonable for the\n  compiler or linker to precompute all possible itables: there are too\n  many (interface type, concrete type) pairs, and most won't be needed.\n  Instead, the compiler generates a type description structure for each\n  concrete type like Binary or int or func(map[int]string). Among other\n  metadata, the type description structure contains a list of the\n  methods implemented by that type. Similarly, the compiler generates a\n  (different) type description structure for each interface type like\n  Stringer; it too contains a method list. The interface runtime\n  computes the itable by looking for each method listed in the interface\n  type's method table in the concrete type's method table. The runtime\n  caches the itable after generating it, so that this correspondence\n  need only be computed once.    </p>\n  \n  <p><strong>Method Lookup Performance</strong><br>\n  Smalltalk and the many dynamic systems that have followed it perform a\n  method lookup every time a method gets called. For speed, many\n  implementations use a simple one-entry cache at each call site, often\n  in the instruction stream itself. In a multithreaded program, these\n  caches must be managed carefully, since multiple threads could be at\n  the same call site simultaneously. Even once the races have been\n  avoided, the caches would end up being a source of memory contention.</p>\n  \n  <p>Because Go has the hint of static typing to go along with the dynamic\n  method lookups, it can move the lookups back from the call sites to\n  the point when the value is stored in the interface.</p>\n</blockquote>\n\n<hr>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/osyRcx_hcH8\" rel=\"noreferrer\">How does Go interface dispatch work?</a></p>\n\n<blockquote>\n  <p>Method dispatch on an interface variable   is the same as a vtable\n  dispatch.<br>\n  The first time a concrete type hits an   interface type, it builds a\n  hash table entry that points to a vtable.    Second and subsequent\n  assignments of the same type will do a much   cheaper hash lookup to\n  find the vtable.   But the method dispatch   itself is always\n  equivalent to a vtable lookup.</p>\n</blockquote>\n\n<hr>\n\n<p>Spec: <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">Interface types</a></p>\n\n<p>For more details see: <a href=\"https://stackoverflow.com/questions/23148812/go-whats-the-meaning-of-interface\">Go: What&#39;s the meaning of interface{}?</a>  </p>\n\n<hr>\n\n<p>Here, two interesting use cases of interfaces in Go:\n<a href=\"https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang\">Why are interfaces needed in Golang?</a></p>\n\n<hr>\n\n<p>The error type is an interface type: <a href=\"https://stackoverflow.com/questions/39121172/how-to-compare-golang-error-objects\">How to compare Golang error objects</a></p>\n\n<hr>\n\n<p>Calculate Area of 4 different shapes: Circle, Square, Rectangle and Triangle:<br>\n<a href=\"https://stackoverflow.com/questions/38816843/explain-type-assertions-in-go\">Explain Type Assertions in Go</a></p>\n\n<hr>\n\n<p>Here in Go you don't need do any thing special like Java keyword <code>implements</code> for implementing an interface, in Go it is enough that your type just has that method with right signature.   </p>\n\n<p>Here is the code (try it on <a href=\"https://play.golang.org/p/fjhWYXQ7p4\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Work struct {\n    Name string\n}\n\nfunc (t Work) String() string {\n    return \"Stringer called.\"\n}\n\nfunc main() {\n    w := Work{\"Hi\"}\n    fmt.Println(w)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Stringer called.\n</code></pre>\n\n<hr>\n\n<p>Spec: <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"noreferrer\">type Stringer</a>, and see the <a href=\"https://golang.org/src/fmt/print.go?s=1955:1999#L52\" rel=\"noreferrer\">source</a>:</p>\n\n<pre><code>type Stringer interface {\n        String() string\n}\n</code></pre>\n\n<blockquote>\n  <p>Stringer is implemented by any value that has a String method, which\n  defines the \u201cnative\u201d format for that value. The String method is used\n  to print values passed as an operand to any format that accepts a\n  string or to an unformatted printer such as Print.</p>\n</blockquote>\n\n<hr>\n\n<p>Also see:  </p>\n\n<p><a href=\"https://stackoverflow.com/questions/13511203/why-cant-i-assign-a-struct-to-an-interface\">Why can&#39;t I assign a *Struct to an *Interface?</a><br>\n<a href=\"https://stackoverflow.com/questions/24537443/meaning-of-a-struct-with-embedded-anonymous-interface\">Meaning of a struct with embedded anonymous interface?</a><br>\n<a href=\"https://stackoverflow.com/questions/13905398/embedded-interface\">Embedded Interface</a><br>\n<a href=\"https://stackoverflow.com/questions/18048541/golang-whats-the-point-of-interfaces-when-you-have-multiple-inheritence\">Golang: what&#39;s the point of interfaces when you have multiple inheritence</a>  </p>\n"}], "owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3732, "favorite_count": 4, "closed_date": 1475933668, "accepted_answer_id": 39932840, "answer_count": 1, "score": 3, "last_activity_date": 1475942822, "creation_date": 1475931985, "last_edit_date": 1475940025, "question_id": 39932713, "link": "https://stackoverflow.com/questions/39932713/whats-the-differences-between-go-and-java-about-interface", "closed_reason": "Needs more focus", "title": "What&#39;s the differences between Go and Java about interface?", "body": "<p>Recently I've been asked a question which is, what's the difference between Golang and Java about <strong>interface</strong>?</p>\n\n<p>I know there are some 'syntactic sugar level' differences, what I am interested is anything beneath the ground, like how does Golang and Java implement interface? What's the most difference? Which one is more efficient? Why?</p>\n\n<p>Could anyone post blogs link or source code about this topic? Source code is better.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1475930506, "last_edit_date": 1475930506, "creation_date": 1475930389, "answer_id": 39932459, "question_id": 39932216, "link": "https://stackoverflow.com/questions/39932216/failure-to-do-a-simple-http-post-using-the-net-library-in-go-what-am-i-doing-wr/39932459#39932459", "title": "Failure to do a simple HTTP POST using the net library in GO. What am I doing wrong?", "body": "<p>Because the Content-Length header is absent, the server is waiting to read to EOF before completing the request.  Try this:</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", \"127.0.0.1:80\" )\nfmt.Fprintf(conn, \"POST /handleupload.php HTTP/1.0\\r\\n\\r\\n\")\nn, err := conn.Write([]byte(\"ABCDEFGHIJ\"))\nif c, ok := conn.(*net.TCPConn); ok {\n    c.CloseWrite()\n}\nstatus, err := bufio.NewReader(conn).ReadString('z')\nfmt.Println( status )\n</code></pre>\n\n<p>Another option is to write a Content-Length request header.</p>\n"}], "owner": {"reputation": 23, "user_id": 3921154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bd2060b2215bb8b8ebf8c9622cb9644?s=128&d=identicon&r=PG&f=1", "display_name": "freezingfire", "link": "https://stackoverflow.com/users/3921154/freezingfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 39932459, "answer_count": 1, "score": 0, "last_activity_date": 1475930506, "creation_date": 1475928837, "question_id": 39932216, "link": "https://stackoverflow.com/questions/39932216/failure-to-do-a-simple-http-post-using-the-net-library-in-go-what-am-i-doing-wr", "title": "Failure to do a simple HTTP POST using the net library in GO. What am I doing wrong?", "body": "<p>I'm trying to do a simple RAW data UPLOAD using the net library (not the net/http). I have a simple php script that just spits out whatever was sent to it. The problem is that the php script doesn't receive anything. What am I doing wrong?</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", \"127.0.0.1:80\" )\nfmt.Fprintf(conn, \"POST /handleupload.php HTTP/1.0\\r\\n\\r\\n\")\nn, err := conn.Write([]byte(\"ABCDEFGHIJ\"))\nstatus, err := bufio.NewReader(conn).ReadString('z')\nfmt.Println( status )\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475916133, "post_id": 39930392, "comment_id": 67143446, "body": "I hope this helps. Is this what you are looking for?"}, {"owner": {"reputation": 671, "user_id": 1142154, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/96b9d5e6f06a19bafbe3be141278c333?s=128&d=identicon&r=PG", "display_name": "Peter89", "link": "https://stackoverflow.com/users/1142154/peter89"}, "edited": false, "score": 0, "creation_date": 1475916763, "post_id": 39930392, "comment_id": 67143608, "body": "I think your way is better than mine. Thanks Amd . I just get started golang. Do you know any forum or blog guid new guy like me to get better coding :)"}, {"owner": {"reputation": 671, "user_id": 1142154, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/96b9d5e6f06a19bafbe3be141278c333?s=128&d=identicon&r=PG", "display_name": "Peter89", "link": "https://stackoverflow.com/users/1142154/peter89"}, "edited": false, "score": 1, "creation_date": 1475917096, "post_id": 39930392, "comment_id": 67143698, "body": "Yup! Thanks a ton ;)"}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 671, "user_id": 1142154, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/96b9d5e6f06a19bafbe3be141278c333?s=128&d=identicon&r=PG", "display_name": "Peter89", "link": "https://stackoverflow.com/users/1142154/peter89"}, "edited": false, "score": 1, "creation_date": 1475933115, "post_id": 39930392, "comment_id": 67147786, "body": "@Peter_175 A few good resources: <a href=\"http://reddit.com/r/golang\" rel=\"nofollow noreferrer\">reddit.com/r/golang</a>, <a href=\"http://forum.golangbridge.org\" rel=\"nofollow noreferrer\">forum.golangbridge.org</a>, and #go-nuts IRC channel (<a href=\"http://irc.lc/freenode/go-nuts\" rel=\"nofollow noreferrer\">irc.lc/freenode/go-nuts</a>)"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475916867, "last_edit_date": 1475916867, "creation_date": 1475915757, "answer_id": 39930392, "question_id": 39930200, "link": "https://stackoverflow.com/questions/39930200/how-to-return-from-function-with-some-error-checking-in-go/39930392#39930392", "title": "How to return from function with some error checking in Go", "body": "<p>With error in A (try it on <a href=\"https://play.golang.org/p/5YnhFN0TMC\" rel=\"nofollow\">The Go Playground</a>), output:</p>\n\n<pre><code>LoadModelA\n2009/11/10 23:00:00 LogError\n2009/11/10 23:00:00 Error LoadModelB\n</code></pre>\n\n<p>With error in B (try it on <a href=\"https://play.golang.org/p/-vZeZi5Moh\" rel=\"nofollow\">The Go Playground</a>), output:</p>\n\n<pre><code>LoadModelA\nLoadModelB\n2009/11/10 23:00:00 LogError\n2009/11/10 23:00:00 Error LoadModelB\n</code></pre>\n\n<p>Without error (try it on<a href=\"https://play.golang.org/p/T0It5A5cXS\" rel=\"nofollow\">The Go Playground</a>), output:</p>\n\n<pre><code>LoadModelA\nLoadModelB\nDone.\nmain Done.\n</code></pre>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\nfunc (worker *Worker) GetData() error {\n    if err := worker.LoadModelA(); err != nil {\n        worker.LogError()\n        return err\n    }\n    if err := worker.LoadModelB(); err != nil {\n        worker.LogError()\n        return err\n    }\n    fmt.Println(\"Done.\")\n    return nil\n}\n\nfunc main() {\n    w := &amp;Worker{}\n    err := w.GetData()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"main Done.\")\n}\n\ntype Worker struct{}\n\nfunc (w *Worker) LoadModelA() error {\n    fmt.Println(\"LoadModelA\")\n    return nil\n    //return fmt.Errorf(\"Error LoadModelB\")\n}\nfunc (w *Worker) LoadModelB() error {\n    fmt.Println(\"LoadModelB\")\n    return nil\n    //return fmt.Errorf(\"Error LoadModelB\")\n}\nfunc (w *Worker) LogError() error {\n    log.Println(\"LogError\")\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": false, "score": 0, "last_activity_date": 1475919656, "last_edit_date": 1495541807, "creation_date": 1475919656, "answer_id": 39930907, "question_id": 39930200, "link": "https://stackoverflow.com/questions/39930200/how-to-return-from-function-with-some-error-checking-in-go/39930907#39930907", "title": "How to return from function with some error checking in Go", "body": "<p>With a small number of \"several\" you can simply have </p>\n\n<pre><code>func (worker *Worker) GetData() (err error) {\n    if err = worker.LoadModelA(); err == nil {\n        if err = worker.LoadModelB(); err == nil {\n            return\n        }\n    }\n    worker.LogError()\n    return\n}\n</code></pre>\n\n<p>On large numbers you can <a href=\"https://stackoverflow.com/questions/23350173/how-do-you-loop-through-the-fields-in-a-golang-struct-to-get-and-set-values-in-a\">loop through the fields of struct</a></p>\n"}], "owner": {"reputation": 671, "user_id": 1142154, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/96b9d5e6f06a19bafbe3be141278c333?s=128&d=identicon&r=PG", "display_name": "Peter89", "link": "https://stackoverflow.com/users/1142154/peter89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 39930392, "answer_count": 2, "score": 0, "last_activity_date": 1475919656, "creation_date": 1475914320, "last_edit_date": 1475916598, "question_id": 39930200, "link": "https://stackoverflow.com/questions/39930200/how-to-return-from-function-with-some-error-checking-in-go", "title": "How to return from function with some error checking in Go", "body": "<p>I have several data to load, and If one of them fails, I have to log error and not continue to run the code.<br>\nIs this code OK? And how to do that?</p>\n\n<pre><code>func (worker *Worker) GetData() error {\n  err := worker.LoadModelA()\n  if err != nil &amp;&amp; worker.LogError()  // LogError alway return true\n    return err\n\n  err = worker.LoadModelB()\n  if err != nil &amp;&amp; worker.LogError()  // LogError alway return true\n    return err\n\n  return err\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6940495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c822d1183ae89344229d913735eae9?s=128&d=identicon&r=PG&f=1", "display_name": "mister87", "link": "https://stackoverflow.com/users/6940495/mister87"}, "edited": false, "score": 0, "creation_date": 1475915001, "post_id": 39930127, "comment_id": 67143214, "body": "Thanks! It works! Also I found one more method: \tfunc main() { \t\tcmd := exec.Command(&quot;/bin/bash&quot;, &quot;script.sh&quot;) \t\tcmd.Stdin = strings.NewReader(&quot;text of the test.txt file&quot;) \t\tvar out bytes.Buffer \t\tcmd.Stdout = &amp;out \t\terr := cmd.Run() \t\tif err != nil { \t\t\tlog.Fatal(err) \t\t\tos.Exit(1) \t\t} \t\tfmt.Println(out.String()) \t}"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 43, "user_id": 6940495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c822d1183ae89344229d913735eae9?s=128&d=identicon&r=PG&f=1", "display_name": "mister87", "link": "https://stackoverflow.com/users/6940495/mister87"}, "edited": false, "score": 0, "creation_date": 1475916818, "post_id": 39930127, "comment_id": 67143624, "body": "@Konstantin You can add the other method as a new answer. I would just use <code>os.Open</code> to read the file."}, {"owner": {"reputation": 43, "user_id": 6940495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c822d1183ae89344229d913735eae9?s=128&d=identicon&r=PG&f=1", "display_name": "mister87", "link": "https://stackoverflow.com/users/6940495/mister87"}, "edited": false, "score": 0, "creation_date": 1476133175, "post_id": 39930127, "comment_id": 67213206, "body": "Hello! Yes, it is already possible! Thank you for the help!  Whether interestingly, perhaps to make similar not only through execution of bash-commands (a package of <b>&quot;os/exec&quot;</b>), and through implementation of the client of ssh (for example, means of a package of <b>&quot;crypto/ssh&quot;</b>)?"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 3, "last_activity_date": 1475913610, "creation_date": 1475913610, "answer_id": 39930127, "question_id": 39930109, "link": "https://stackoverflow.com/questions/39930109/golang-execute-command/39930127#39930127", "title": "Golang - Execute command", "body": "<p>The command you should execute is:</p>\n\n<pre><code>/bin/bash -c 'script.sh &lt; text.txt'\n</code></pre>\n\n<p>So</p>\n\n<pre><code>argstr := []string{\"-c\", \"script.sh &lt; text.txt\"}\n</code></pre>\n\n<p>Bash will interpret input redirection and will do the job.</p>\n"}, {"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505696223, "post_id": 46270206, "comment_id": 79502907, "body": "Is it for some other question?"}, {"owner": {"reputation": 694, "user_id": 813307, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o3rsB.jpg?s=128&g=1", "display_name": "flapjack", "link": "https://stackoverflow.com/users/813307/flapjack"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505773322, "post_id": 46270206, "comment_id": 79541087, "body": "Yeah, thinking better. The title and the question were somewhat confusing. :\\ Looks like the problem it&#39;s pretty much about how to handle parameters with <code>exec.Command()</code> and <code>bash</code>."}], "tags": [], "owner": {"reputation": 694, "user_id": 813307, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o3rsB.jpg?s=128&g=1", "display_name": "flapjack", "link": "https://stackoverflow.com/users/813307/flapjack"}, "is_accepted": false, "score": 0, "last_activity_date": 1505774431, "last_edit_date": 1505774431, "creation_date": 1505696077, "answer_id": 46270206, "question_id": 39930109, "link": "https://stackoverflow.com/questions/39930109/golang-execute-command/46270206#46270206", "title": "Golang - Execute command", "body": "<p><strong>Pro Tip: Don't forget to timeout</strong></p>\n\n<pre><code>ctx, cancel := context.WithTimeout(context.Background(), 4*time.Second)\ndefer cancel()\nargstr := []string{\"/bin/bash\", \"-c\", \"script.sh &lt; text.txt\"}\ncmd := exec.CommandContext(ctx, argstr...)\ncmd.Stderr = &amp;errorBuffer\ncmd.Stdout = &amp;outputBuffer\nerr := cmd.Run()\nif err != nil {\n    return fmt.Errorf(\"something bad happened: %v\", err)\n}\n</code></pre>\n\n<p>I always suggest to play safe.</p>\n"}], "owner": {"reputation": 43, "user_id": 6940495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c822d1183ae89344229d913735eae9?s=128&d=identicon&r=PG&f=1", "display_name": "mister87", "link": "https://stackoverflow.com/users/6940495/mister87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5393, "favorite_count": 0, "accepted_answer_id": 39930127, "answer_count": 2, "score": 3, "last_activity_date": 1505774431, "creation_date": 1475913503, "question_id": 39930109, "link": "https://stackoverflow.com/questions/39930109/golang-execute-command", "title": "Golang - Execute command", "body": "<p>Prompt as in golang to execute such command:</p>\n\n<pre><code>/bin/bash script.sh &lt; text.txt\n</code></pre>\n\n<p>I execute a script with parameters so:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    argstr := []string{\"script.sh\", \"arg1\", \"arg2\"}\n    out, err := exec.Command(\"/bin/bash\", argstr...).Output()\n    if err != nil {\n        log.Fatal(err)\n        os.Exit(1)\n    }\n    fmt.Println(string(out))\n}\n</code></pre>\n\n<p>And here is how to transfer an output from the text file?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 1, "creation_date": 1476068196, "post_id": 39929124, "comment_id": 67181519, "body": "I had a similar situation. This questioned I posed before may help. <a href=\"http://stackoverflow.com/questions/34447124/using-google-cloud-storage-with-golang-on-appengine\" title=\"using google cloud storage with golang on appengine\">stackoverflow.com/questions/34447124/&hellip;</a>"}, {"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "reply_to_user": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 0, "creation_date": 1476132916, "post_id": 39929124, "comment_id": 67213081, "body": "I&#39;ve seen this post before, however the code with the working example is no longer available on github."}], "answers": [{"tags": [], "owner": {"reputation": 584, "user_id": 2528719, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1ef4da676524b97d525de1c3a5ad3e87?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2528719/aaron"}, "is_accepted": true, "score": 0, "last_activity_date": 1476317566, "creation_date": 1476317566, "answer_id": 40010328, "question_id": 39929124, "link": "https://stackoverflow.com/questions/39929124/use-google-cloud-storage-api-with-go-appengine/40010328#40010328", "title": "Use Google Cloud Storage API with Go AppEngine", "body": "<p>I've had issues with the <code>google.DefaultClient</code> method in the past. Here's a more explicit strategy for configuring the storage client object that might be of use for you:</p>\n\n<pre><code>httpClient = &amp;http.Client{\n    Transport: &amp;oauth2.Transport{\n        Source: google.AppEngineTokenSource(ctx, scopes...),\n        Base:   &amp;urlfetch.Transport{Context: ctx},\n    },\n}\n\nservice, err := storage.New(httpClient)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>However, I'm not familiar with the <code>forbiddenFinished</code> error message, which may indicate that the issue lies elsewhere.</p>\n\n<p>Additionally, if you don't have a specific reason for using the autogenerated <code>google.golang.org/api/storage/v1</code> library, I'd recommend using the higher level interface, which can be found at <code>cloud.google.com/go/storage</code>. Here's the go doc for it:</p>\n\n<p><a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"nofollow\">https://godoc.org/cloud.google.com/go/storage</a></p>\n"}], "owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 40010328, "answer_count": 1, "score": 1, "last_activity_date": 1476317566, "creation_date": 1475905506, "last_edit_date": 1475908053, "question_id": 39929124, "link": "https://stackoverflow.com/questions/39929124/use-google-cloud-storage-api-with-go-appengine", "title": "Use Google Cloud Storage API with Go AppEngine", "body": "<p>I've written a test code to list buckets from <a href=\"https://cloud.google.com/storage/docs/\" rel=\"nofollow\">Google Cloud Storage</a> through the Cloud Storage API, however I'm getting the error below when I run the code:</p>\n\n<pre><code>googleapi: Error 403: Forbidden, forbiddenFinished\n</code></pre>\n\n<p>I've checked the permissions and the appengine service account has access to the buckets and both the appengine app and cloud storage bucket are on the same project.</p>\n\n<p>This is my sample code:</p>\n\n<pre><code>package src\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"golang.org/x/oauth2/google\"\n    storage \"google.golang.org/api/storage/v1\"\n    appengine \"google.golang.org/appengine\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", index)\n}\n\nfunc ListBuckets(r *http.Request, projectID string) ([]*storage.Bucket, error) {\n\n    ctx := appengine.NewContext(r)\n\n    client, err := google.DefaultClient(ctx, storage.DevstorageReadOnlyScope)\n    if err != nil {\n        return nil, err\n    }\n\n    service, err := storage.New(client)\n    if err != nil {\n        return nil, err\n    }\n\n    buckets, err := service.Buckets.List(projectID).Do()\n    if err != nil {\n        return nil, err\n    }\n\n    return buckets.Items, nil\n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    r.Header.Set(\"x-goog-project-id\", \"theIdProvidedByTheAPI\")\n    bucket, err := ListBuckets(r,\"myProject\")\n    if err != nil {\n        fmt.Fprint(w,err.Error())\n    }\n    for i:=range bucket {\n    fmt.Fprint(w,bucket[i].Name)\n    }\n    fmt.Fprint(w,\"\\n\",\"Finished.\")\n\n}\n</code></pre>\n\n<p>And this is the yaml file:</p>\n\n<pre><code>application: myProject\nversion: alpha-001\nruntime: go\napi_version: go1\n\nhandlers:\n\n- url: /\n  script: _go_app\n</code></pre>\n\n<p>The error message is nor helpful as it does not provide much useful information. I just can't figure out what I'm missing.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475906185, "post_id": 39929023, "comment_id": 67141418, "body": "What version of Go are you using?"}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "reply_to_user": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475954586, "post_id": 39929023, "comment_id": 67154646, "body": "go version go1.6.2 (appengine-1.9.40) darwin/amd64"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1476098041, "post_id": 39929023, "comment_id": 67193374, "body": "Did you set your <code>$GOPATH</code> to <code>&#47;Users&#47;nyname&#47;go&#47;</code>?"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1476098091, "post_id": 39929023, "comment_id": 67193402, "body": "Also, it is not recommended to have <code>$GOPATH</code> set the same as <code>$GOROOT</code>."}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "reply_to_user": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1476172116, "post_id": 39929023, "comment_id": 67224283, "body": "@KoalaYeung: $GOPATH is set to /Users/nyname/go (no ending slash). $GOROOT is not set to anything"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1476173337, "post_id": 39929023, "comment_id": 67224950, "body": "Where did you install your go binary and the source (golang itself)?"}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "reply_to_user": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1476193580, "post_id": 39929023, "comment_id": 67236248, "body": "@KoalaYeung: I have go_appengine in /Users/myname/. I have not installed golang separately from goapp as golang was included in goapp. I store my source code in /Users/nyname/go"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 354, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475904587, "creation_date": 1475904587, "question_id": 39929023, "link": "https://stackoverflow.com/questions/39929023/cant-load-package-and-use-of-internal-package-not-allowed-when-running-goap", "title": "&quot;Can&#39;t load package&quot; and &quot;Use of internal package not allowed&quot; when running goapp test", "body": "<p>When I run the command:</p>\n\n<pre><code>goapp test ./...\n</code></pre>\n\n<p>I get the errors:</p>\n\n<pre><code>can't load package: package github.com/projectname/oauth2: code in directory /Users/nyname/go/src/github.com/projectname/oauth2 expects import \"github.com/projectname/oauth2\"\ncan't load package: package github.com/projectname/oauth2/clientcredentials: code in directory /Users/nyname/go/src/github.com/projectname/oauth2/clientcredentials expects import \"github.com/projectname/oauth2/clientcredentials\"\ncan't load package: package github.com/projectname/oauth2/google: code in directory /Users/nyname/go/src/github.com/projectname/oauth2/google expects import \"github.com/projectname/oauth2/google\"\ncan't load package: package github.com/projectname/oauth2/jws: code in directory /Users/nyname/go/src/github.com/projectname/oauth2/jws expects import \"github.com/projectname/oauth2/jws\"\npackage github.com/projectname/oauth2/jwt\n        imports github.com/projectname/oauth2/internal: use of internal package not allowed\n</code></pre>\n\n<p>It seems like no one else on my team get's this error.</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475905403, "post_id": 39928674, "comment_id": 67141247, "body": "Have you consider to declare a struct that resemble the XML structure, then you convert that into your KillMailsXML struct? After reading the documentation, I don&#39;t think you can specify an element based on its attribute. Better to have Attackers and Items in the same field, then write a converter that translates it correctly"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475905910, "post_id": 39928674, "comment_id": 67141362, "body": "Probably something like <a href=\"https://play.golang.org/p/yAkpMaZ2RW\" rel=\"nofollow noreferrer\">this</a>, then convert the result to the structure you wanted?"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1475908703, "last_edit_date": 1475908703, "creation_date": 1475907021, "answer_id": 39929278, "question_id": 39928674, "link": "https://stackoverflow.com/questions/39928674/go-unmarshal-nested-arrays-with-identical-name-but-separate-elements/39929278#39929278", "title": "Go unmarshal nested arrays with identical name but separate elements", "body": "<p>This works fine, try it on <a href=\"https://play.golang.org/p/-hViom7Bum\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nfunc main() {\n    var v *KillMailsXML\n    if err := xml.Unmarshal([]byte(str), &amp;v); err != nil {\n        panic(err)\n    }\n    for _, ks := range v.Kills {\n        for _, rs := range ks.Rowsets {\n            fmt.Println(rs.Who, rs.Rows)\n        }\n    }\n}\n\ntype KillMailsXML struct {\n    Kills []struct {\n        // Generic kill information\n        KillID        int64 `xml:\"killID,attr\"`\n        Hash          string\n        SolarSystemID int64 `xml:\"solarSystemID,attr\"`\n        MoonID        int64 `xml:\"moonID,attr\"`\n\n        // Victim Information\n        Victim struct {\n            AllianceID      int64   `xml:\"allianceID,attr\"`\n            AllianceName    string  `xml:\"allianceName,attr\"`\n            CharacterID     int64   `xml:\"characterID,attr\"`\n            CharacterName   string  `xml:\"characterName,attr\"`\n            CorporationID   int64   `xml:\"corporationID,attr\"`\n            CorporationName string  `xml:\"corporationName,attr\"`\n            DamageTaken     int64   `xml:\"damageTaken,attr\"`\n            FactionID       int64   `xml:\"factionID,attr\"`\n            FactionName     string  `xml:\"factionName,attr\"`\n            ShipTypeID      int64   `xml:\"shipTypeID,attr\"`\n            X               float64 `xml:\"x,attr\"`\n            Y               float64 `xml:\"y,attr\"`\n            Z               float64 `xml:\"z,attr\"`\n        } `xml:\"victim\"`\n        Rowsets []struct {\n            Who  string `xml:\"name,attr\"` // Attackers or Items\n            Rows []struct {\n                //              Attackers struct {\n                AllianceID      int64   `xml:\"allianceID,attr\"`\n                AllianceName    string  `xml:\"allianceName,attr\"`\n                CharacterID     int64   `xml:\"characterID,attr\"`\n                CharacterName   string  `xml:\"characterName,attr\"`\n                CorporationID   int64   `xml:\"corporationID,attr\"`\n                CorporationName string  `xml:\"corporationName,attr\"`\n                DamageDone      int64   `xml:\"damageDone,attr\"`\n                FactionID       int64   `xml:\"factionID,attr\"`\n                FactionName     string  `xml:\"factionName,attr\"`\n                FinalBlow       bool    `xml:\"finalBlow,attr\"`\n                SecurityStatus  float64 `xml:\"securityStatus,attr\"`\n                ShipTypeID      int64   `xml:\"shipTypeID,attr\"`\n                WeaponTypeID    int64   `xml:\"weaponTypeID,attr\"`\n                //              }\n                //              Items struct {\n                QtyDestroyed int64 `xml:\"qtyDestroyed,attr\"`\n                QtyDropped   int64 `xml:\"qtyDropped,attr\"`\n                TypeID       int64 `xml:\"typeID,attr\"`\n                Flag         int64 `xml:\"flag,attr\"`\n                Singleton    int64 `xml:\"singleton,attr\"`\n                //              }\n            } `xml:\"row\"`\n        } `xml:\"rowset\"`\n    } `xml:\"result&gt;rowset&gt;row\"`\n}\n\nvar str = `&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n&lt;eveapi version=\"2\"&gt;\n  &lt;currentTime&gt;2016-07-06 05:49:28&lt;/currentTime&gt;\n  &lt;result&gt;\n    &lt;rowset name=\"kills\" key=\"killID\" columns=\"killID,solarSystemID,killTime,moonID\"&gt;\n      &lt;row killID=\"54933226\" solarSystemID=\"31001222\" killTime=\"2016-07-03 22:29:19\" moonID=\"0\"&gt;\n        &lt;victim characterID=\"93811169\" characterName=\"Madcat326\" corporationID=\"98008818\" corporationName=\"Haight Industries LLC\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" damageTaken=\"63039\" shipTypeID=\"17918\" x=\"59788513854.179\" y=\"-13687850177.3741\" z=\"157817245029.115\" /&gt;\n        &lt;rowset name=\"attackers\" columns=\"characterID,characterName,corporationID,corporationName,allianceID,allianceName,factionID,factionName,securityStatus,damageDone,finalBlow,weaponTypeID,shipTypeID\"&gt;\n          &lt;row characterID=\"91316135\" characterName=\"Celeo Servasse\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.0646369409683\" damageDone=\"7825\" finalBlow=\"1\" weaponTypeID=\"3520\" shipTypeID=\"12003\" /&gt;\n          &lt;row characterID=\"95273329\" characterName=\"Mupoc Kashuken\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.2\" damageDone=\"16656\" finalBlow=\"0\" weaponTypeID=\"31882\" shipTypeID=\"12023\" /&gt;\n          &lt;row characterID=\"94389072\" characterName=\"Johanis Cal-dahari\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"2\" damageDone=\"11999\" finalBlow=\"0\" weaponTypeID=\"24486\" shipTypeID=\"29986\" /&gt;\n          &lt;row characterID=\"92090484\" characterName=\"Foxstar Damaskeenus\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.4\" damageDone=\"10383\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"95708401\" characterName=\"Bibet Shakure\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.3\" damageDone=\"6928\" finalBlow=\"0\" weaponTypeID=\"24490\" shipTypeID=\"29986\" /&gt;\n          &lt;row characterID=\"0\" characterName=\"\" corporationID=\"500020\" corporationName=\"Serpentis\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"0\" damageDone=\"3903\" finalBlow=\"0\" weaponTypeID=\"0\" shipTypeID=\"38659\" /&gt;\n          &lt;row characterID=\"96420826\" characterName=\"D Joker\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"0\" damageDone=\"2858\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"33470\" /&gt;\n          &lt;row characterID=\"0\" characterName=\"\" corporationID=\"500011\" corporationName=\"Angel Cartel\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"0\" damageDone=\"2487\" finalBlow=\"0\" weaponTypeID=\"0\" shipTypeID=\"42127\" /&gt;\n          &lt;row characterID=\"94791823\" characterName=\"chaosInjection\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"-1\" damageDone=\"0\" finalBlow=\"0\" weaponTypeID=\"12267\" shipTypeID=\"29986\" /&gt;\n          &lt;row characterID=\"90957994\" characterName=\"Conner Asanari\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" securityStatus=\"0.5\" damageDone=\"0\" finalBlow=\"0\" weaponTypeID=\"16521\" shipTypeID=\"22452\" /&gt;\n        &lt;/rowset&gt;\n        &lt;rowset name=\"items\" columns=\"typeID,flag,qtyDropped,qtyDestroyed,singleton\"&gt;\n          &lt;row typeID=\"394\" flag=\"20\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"24427\" flag=\"32\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2446\" flag=\"87\" qtyDropped=\"1\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"28209\" flag=\"87\" qtyDropped=\"2\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"4405\" flag=\"15\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"33450\" flag=\"27\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"19215\" flag=\"23\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2456\" flag=\"87\" qtyDropped=\"5\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"26448\" flag=\"93\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"33450\" flag=\"28\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"394\" flag=\"24\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"394\" flag=\"21\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"19215\" flag=\"19\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"4405\" flag=\"14\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"1422\" flag=\"12\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2048\" flag=\"16\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"26448\" flag=\"94\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"33450\" flag=\"29\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"33450\" flag=\"30\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2629\" flag=\"5\" qtyDropped=\"1750\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"33450\" flag=\"31\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2281\" flag=\"22\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"19241\" flag=\"25\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"1422\" flag=\"13\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"26448\" flag=\"92\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"1422\" flag=\"11\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n        &lt;/rowset&gt;\n      &lt;/row&gt;\n      &lt;row killID=\"54868503\" solarSystemID=\"31000868\" killTime=\"2016-06-30 03:39:22\" moonID=\"0\"&gt;\n        &lt;victim characterID=\"91316135\" characterName=\"Celeo Servasse\" corporationID=\"98134538\" corporationName=\"Wormbro\" allianceID=\"0\" allianceName=\"\" factionID=\"0\" factionName=\"\" damageTaken=\"18472\" shipTypeID=\"11987\" x=\"685670430496.578\" y=\"-376814977944.382\" z=\"-365907110851.975\" /&gt;\n        &lt;rowset name=\"attackers\" columns=\"characterID,characterName,corporationID,corporationName,allianceID,allianceName,factionID,factionName,securityStatus,damageDone,finalBlow,weaponTypeID,shipTypeID\"&gt;\n          &lt;row characterID=\"641035756\" characterName=\"Lenex Raay\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"5.00297218487895\" damageDone=\"1169\" finalBlow=\"1\" weaponTypeID=\"2969\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"1817541889\" characterName=\"gr33nCO\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.1\" damageDone=\"2163\" finalBlow=\"0\" weaponTypeID=\"2456\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"92060039\" characterName=\"Braxus Deninard\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.7\" damageDone=\"1770\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"1734877398\" characterName=\"Pantuf\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"4.9\" damageDone=\"1681\" finalBlow=\"0\" weaponTypeID=\"2456\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"92941592\" characterName=\"Foedus Latro\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.2\" damageDone=\"1663\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"782985098\" characterName=\"AwingendeR\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"1.9\" damageDone=\"1501\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"93802816\" characterName=\"Tycho Loor\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.9\" damageDone=\"1405\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"91004291\" characterName=\"Broxis Khoros\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.8\" damageDone=\"1228\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"92007576\" characterName=\"Dean Mintar\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"3.1\" damageDone=\"1057\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"91702100\" characterName=\"EMU EVIL\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-1.4\" damageDone=\"792\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"11978\" /&gt;\n          &lt;row characterID=\"95430803\" characterName=\"Violet Dawn\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"1\" damageDone=\"789\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"33157\" /&gt;\n          &lt;row characterID=\"647412341\" characterName=\"Lysus\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-2\" damageDone=\"761\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"91986431\" characterName=\"sHanQ Myteia\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-1\" damageDone=\"497\" finalBlow=\"0\" weaponTypeID=\"2456\" shipTypeID=\"11963\" /&gt;\n          &lt;row characterID=\"90571681\" characterName=\"Pyrric Skloric\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"0.1\" damageDone=\"356\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"964223112\" characterName=\"Tisisan\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"0.9\" damageDone=\"313\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"1039287135\" characterName=\"J3rz11\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"0.4\" damageDone=\"265\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"91343130\" characterName=\"Sophia Utama\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"0.6\" damageDone=\"237\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"94149890\" characterName=\"Minnie Sodom\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"2.6\" damageDone=\"225\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"11978\" /&gt;\n          &lt;row characterID=\"91875279\" characterName=\"Derek Itinen\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"0.8\" damageDone=\"210\" finalBlow=\"0\" weaponTypeID=\"2488\" shipTypeID=\"11978\" /&gt;\n          &lt;row characterID=\"1556079273\" characterName=\"Alita Hayes\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.1\" damageDone=\"186\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"2086742079\" characterName=\"Turd Destroyer\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"3.3\" damageDone=\"115\" finalBlow=\"0\" weaponTypeID=\"22444\" shipTypeID=\"22444\" /&gt;\n          &lt;row characterID=\"91044028\" characterName=\"Viktoria Bernhardt\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"2.8\" damageDone=\"89\" finalBlow=\"0\" weaponTypeID=\"28215\" shipTypeID=\"11978\" /&gt;\n          &lt;row characterID=\"941167595\" characterName=\"Justin Cody\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"1.6\" damageDone=\"0\" finalBlow=\"0\" weaponTypeID=\"15891\" shipTypeID=\"11969\" /&gt;\n          &lt;row characterID=\"686125406\" characterName=\"NoobMan\" corporationID=\"98040755\" corporationName=\"Hard Knocks Inc.\" allianceID=\"99005065\" allianceName=\"Hard Knocks Citizens\" factionID=\"0\" factionName=\"\" securityStatus=\"-0.1\" damageDone=\"0\" finalBlow=\"0\" weaponTypeID=\"2873\" shipTypeID=\"11186\" /&gt;\n        &lt;/rowset&gt;\n        &lt;rowset name=\"items\" columns=\"typeID,flag,qtyDropped,qtyDestroyed,singleton\"&gt;\n          &lt;row typeID=\"16455\" flag=\"30\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"16455\" flag=\"28\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"31366\" flag=\"92\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"16487\" flag=\"32\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"6005\" flag=\"19\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"16487\" flag=\"31\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"29011\" flag=\"5\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"31366\" flag=\"93\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"29009\" flag=\"5\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"13970\" flag=\"11\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"13982\" flag=\"12\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2048\" flag=\"14\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"18712\" flag=\"13\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"20353\" flag=\"15\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"16455\" flag=\"27\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"16455\" flag=\"29\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"2488\" flag=\"87\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"41155\" flag=\"20\" qtyDropped=\"0\" qtyDestroyed=\"1\" singleton=\"0\" /&gt;\n          &lt;row typeID=\"1952\" flag=\"20\" qtyDropped=\"1\" qtyDestroyed=\"0\" singleton=\"0\" /&gt;\n        &lt;/rowset&gt;\n      &lt;/row&gt;\n    &lt;/rowset&gt;\n  &lt;/result&gt;\n  &lt;cachedUntil&gt;2016-07-06 06:16:28&lt;/cachedUntil&gt;\n&lt;/eveapi&gt;`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1475913126, "last_edit_date": 1475913126, "creation_date": 1475912052, "answer_id": 39929912, "question_id": 39928674, "link": "https://stackoverflow.com/questions/39928674/go-unmarshal-nested-arrays-with-identical-name-but-separate-elements/39929912#39929912", "title": "Go unmarshal nested arrays with identical name but separate elements", "body": "<p>If you can't change the structure of <code>xml</code> data, then defer unmarshaling <code>rowset</code> with the following steps (Working example can be found at <a href=\"https://play.golang.org/p/-aNl1WvMjJ\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<ol>\n<li>Unmarshal elements except <code>rowset</code> which are related to <code>victim</code>. During this step, the <code>rowset</code> will be unmarshaled into raw XML data.</li>\n<li>Decode raw XML separately using <code>Decoder.DecodeElement</code>. </li>\n</ol>\n\n<p>First declare the data structure as follows (declaration of <code>Victim</code>, <code>Attacker</code>, <code>Item</code> is omitted):</p>\n\n<pre><code>type Kill struct{\n    // Generic kill information\n    KillID              int64      `xml:\"killID,attr\"`\n    Hash                string\n    SolarSystemID       int64      `xml:\"solarSystemID,attr\"`\n    MoonID              int64      `xml:\"moonID,attr\"`\n    // Victim Information\n    Victim              Victim     `xml:\"victim\"`      \n    RawAttackersItems   []byte     `xml:\",innerxml\" json:\"-\"`\n    Attackers           []Attacker `xml:\"-\"`\n    Items               []Item     `xml:\"-\"`        \n} \n\ntype Kills struct {\n    Kills []Kill `xml:\"result&gt;rowset&gt;row\"`\n}\n</code></pre>\n\n<p>Next, code lines for unmarshaling the xml:</p>\n\n<pre><code>//Step (1). Unmarshal to Kills\nv := &amp;Kills{}\nif err := xml.Unmarshal([]byte(xmlText()), v); err != nil {\n    fmt.Printf(\"Error unmarshaling: %v\\n\", err)\n    return\n}\n\n//Step (2). Decode attackers and items related to victim\nfor i, k := range v.Kills {   \n    v.Kills[i].Attackers, v.Kills[i].Items = decodeAttackerAndItems(k.RawAttackersItems)\n}\n</code></pre>\n\n<p>and finally the decoder function:</p>\n\n<pre><code>func decodeAttackerAndItems(data []byte) ([]Attacker, []Item) {\n    xmlReader := bytes.NewReader(data)\n    decoder := xml.NewDecoder(xmlReader)\n\n    const (\n        unknown int = iota\n        attackers\n        items\n    )    \n    rowset := unknown\n\n    attackerList := []Attacker{}\n    itemList := []Item{}\n\n    for {\n        t, _ := decoder.Token() \n        if t == nil { \n            break \n        } \n\n        switch se := t.(type) { \n        case xml.StartElement: \n            if se.Name.Local == \"rowset\" {\n                rowset = unknown\n                for _, attr := range se.Attr {\n                    if attr.Name.Local == \"name\" {\n                        if attr.Value == \"attackers\" {\n                            rowset = attackers\n                            break\n                        } else if attr.Value == \"items\" {\n                            rowset = items\n                            break\n                        }\n                    }\n                }\n            } else if se.Name.Local == \"row\" {\n                switch rowset {\n                case attackers:\n                    a := Attacker{}\n                    if err := decoder.DecodeElement(&amp;a, &amp;se); err == nil {\n                        attackerList = append(attackerList, a)\n                    }\n                case items:\n                    it := Item{}\n                    if err := decoder.DecodeElement(&amp;it, &amp;se); err == nil {\n                        itemList = append(itemList, it)\n                    }\n                }\n            }\n        }\n    }\n\n    return attackerList, itemList\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6793484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d326e8177be82bf3230f2f2df096459?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/6793484/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 39929912, "answer_count": 2, "score": 2, "last_activity_date": 1475913126, "creation_date": 1475900826, "last_edit_date": 1475907218, "question_id": 39928674, "link": "https://stackoverflow.com/questions/39928674/go-unmarshal-nested-arrays-with-identical-name-but-separate-elements", "title": "Go unmarshal nested arrays with identical name but separate elements", "body": "<p>I have a problem where an API returns two nested XML arrays in a response both with the name <code>rowset</code> but different elements. Trying to unmarshal into a struct causes the error <code>field \"Attackers\" with tag \"rowset&gt;row\" conflicts with field \"Items\" with tag \"rowset&gt;row\"</code>.</p>\n\n<p>They both have an attribute <code>name</code> which are unique. Is it possible to influence the parser with this attribute?</p>\n\n<p>See example: <a href=\"https://play.golang.org/p/BinDfC3XsW\" rel=\"nofollow\">https://play.golang.org/p/BinDfC3XsW</a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1475896409, "last_edit_date": 1475896409, "creation_date": 1475895790, "answer_id": 39928265, "question_id": 39928148, "link": "https://stackoverflow.com/questions/39928148/golang-connect-2-different-type-database-at-same-time/39928265#39928265", "title": "golang connect 2 different type database at same time", "body": "<p>There's no problem importing both because the drivers use different names. The driver name is the first argument to <a href=\"https://godoc.org/database/sql#Open\" rel=\"nofollow\">sql.Open</a>.</p>\n\n<p>If they should happen to use the same name, then the  driver registration function <a href=\"https://golang.org/src/database/sql/sql.go#L45\" rel=\"nofollow\">panics</a>.</p>\n"}], "owner": {"reputation": 127, "user_id": 4859529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7548cde42ced53ff87af39ff8ab7991a?s=128&d=identicon&r=PG&f=1", "display_name": "QthCN", "link": "https://stackoverflow.com/users/4859529/qthcn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 0, "accepted_answer_id": 39928265, "answer_count": 1, "score": 1, "last_activity_date": 1475896409, "creation_date": 1475894370, "question_id": 39928148, "link": "https://stackoverflow.com/questions/39928148/golang-connect-2-different-type-database-at-same-time", "title": "golang connect 2 different type database at same time", "body": "<p>I need to connect mysql and oracle at same time for a database related application. From the document I learned that in go the database drivers are initialized in \"init()\" function. So I want to know if I import 2 different database drivers, does the later driver will override the former one?</p>\n"}, {"tags": ["image", "go", "io"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1475884812, "last_edit_date": 1495541341, "creation_date": 1475884202, "answer_id": 39927234, "question_id": 39927182, "link": "https://stackoverflow.com/questions/39927182/looking-for-better-way-to-save-an-in-memory-image-to-file/39927234#39927234", "title": "Looking for better way to save an in memory image to file", "body": "<p><a href=\"https://golang.org/pkg/image/jpeg/#Encode\" rel=\"noreferrer\"><code>jpeg.Encode()</code></a> expects an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code></a> to write the encoded image to (in JPEG format). Both <a href=\"https://golang.org/pkg/os/#File\" rel=\"noreferrer\"><code>*os.File</code></a> and <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\"><code>http.ResponseWriter</code></a> implement <code>io.Writer</code> too, so instead of a <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"noreferrer\"><code>bytes.Buffer</code></a>, you can directly pass a file or HTTP response writer too.</p>\n\n<p>To save an image directly to a file:</p>\n\n<pre><code>f, err := os.Create(\"img.jpg\")\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\njpeg.Encode(f, target, nil)\n</code></pre>\n\n<p>To serve it as an image:</p>\n\n<pre><code>// w is of type http.ResponseWriter:\njpeg.Encode(w, target, nil)\n</code></pre>\n\n<p>You can see some examples in these questions (saving/loading JPEG and PNG images):</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28992396/draw-a-rectangle-in-golang/29004191#29004191\">Draw a rectangle in Golang?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/38299930/how-to-add-a-simple-text-label-to-an-image-in-go/38300583#38300583\">How to add a simple text label to an image in Go?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-go-lang-image/36577076#36577076\">Change color of a single pixel - Go lang image</a></p>\n"}], "owner": {"reputation": 3178, "user_id": 32032, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/65bde8d6633e09cab738956cfd2d6ee5?s=128&d=identicon&r=PG", "display_name": "coulix", "link": "https://stackoverflow.com/users/32032/coulix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10150, "favorite_count": 1, "accepted_answer_id": 39927234, "answer_count": 1, "score": 6, "last_activity_date": 1475936929, "creation_date": 1475883727, "last_edit_date": 1475936929, "question_id": 39927182, "link": "https://stackoverflow.com/questions/39927182/looking-for-better-way-to-save-an-in-memory-image-to-file", "title": "Looking for better way to save an in memory image to file", "body": "<p>The goal of the code is to download an image, stick it to a larger parent image and save the result.</p>\n\n<p>After quite a few failures I ended up with the following code that does work.</p>\n\n<p>However, is there a better way than using <code>bytes.Buffer</code> and a <code>writer</code> to save the target image to a file / pass it to an httpResponse?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"image\"\n    \"image/draw\"\n    \"image/jpeg\"\n    \"os\"\n    // \"image/color\"\n    // \"io/ioutil\"\n    // \"fmt\"\n    \"bufio\"\n    \"bytes\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    // Fetch an image.\n    resp, err := http.Get(\"http://katiebrookekennels.com/wp-content/uploads/2014/10/dog-bone4.jpg\")\n    if err != nil {\n        log.Panic(err)\n    }\n    defer resp.Body.Close()\n\n    // Keep an in memory copy.\n    myImage, err := jpeg.Decode(resp.Body)\n\n    if err != nil {\n        log.Panic(err)\n    }\n\n    // Prepare parent image where we want to position child image.\n    target := image.NewRGBA(image.Rect(0, 0, 800, 800))\n    // Draw white layer.\n    draw.Draw(target, target.Bounds(), image.White, image.ZP, draw.Src)\n    // Draw child image.\n    draw.Draw(target, myImage.Bounds(), myImage, image.Point{0, 0}, draw.Src)\n\n    // Encode to jpeg.\n    var imageBuf bytes.Buffer\n    err = jpeg.Encode(&amp;imageBuf, target, nil)\n\n    if err != nil {\n        log.Panic(err)\n    }\n\n    // Write to file.\n    fo, err := os.Create(\"img.jpg\")\n    if err != nil {\n        panic(err)\n    }\n    fw := bufio.NewWriter(fo)\n\n    fw.Write(imageBuf.Bytes())\n}\n</code></pre>\n"}, {"tags": ["random", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475874764, "post_id": 39925784, "comment_id": 67135412, "body": "If you want to guarantee a unique random series with only the std library, you&#39;ll need to implement a full cycle PRNG. If predictability isn&#39;t as much of a concern there are simpler Linear congruential generators you can use."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475877020, "post_id": 39925784, "comment_id": 67136159, "body": "See: How to generate unique random string in a length range using Golang?: <a href=\"http://stackoverflow.com/questions/38418171/how-to-generate-unique-random-string-in-a-length-range-using-golang\" title=\"how to generate unique random string in a length range using golang\">stackoverflow.com/questions/38418171/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475877145, "post_id": 39925784, "comment_id": 67136201, "body": "but it is (pseudo ) random number, How do you mean by unique? When you say random it is just random not unique! e.g. 99999 is random number! and in true RNG the next number may be again 99999 by chance! (it is random, isn&#39;t it!?"}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475878755, "post_id": 39925784, "comment_id": 67136673, "body": "@Amd I do see your point, and I know that by requiring the number to be unique, it wouldn&#39;t be pure random any more. But I&#39;m not trying to be a cryptologist here. All I need to do is to benchmark a go program with 10K, 100K, 1M pseudo-random number that has no duplication."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475879130, "post_id": 39925784, "comment_id": 67136774, "body": "if it is just benchmark why not just count from 1,2,3,.... it is unique, in congruential generators they use (a*x+b)%n so simply it is counting with prime steps..., e.g. 1,11,21,31,..., and see: Mersenne Twister, I hope this helps."}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475880899, "post_id": 39925784, "comment_id": 67137154, "body": "@Amd I want to verify the behavior under sequential input, and random input....any pre-set formula seems too deterministic to be convincingly random especially with sequential count..."}, {"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 0, "creation_date": 1475883677, "post_id": 39925784, "comment_id": 67137820, "body": "@cookieisaac Can you not generate 1,2,3... sequence and then just shuffle it? If the magnitude of the numbers is irrelevant, you just want a random order, this is probably the simplest solution that absolutely guarantees no repetition."}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "reply_to_user": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 0, "creation_date": 1475885208, "post_id": 39925784, "comment_id": 67138147, "body": "@biziclop technically I could, that is my guess(1). However, I want to get N numbers from [-2^31, 2^31), then I have to shuffle 2^32 numbers and retrieve only the first N numbers. That is too much of an overkill when N &lt;&lt; 2^32. (N is roughly 100 thousand and 2^32 is roughly 4 billion )"}, {"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 0, "creation_date": 1475918642, "post_id": 39925784, "comment_id": 67144037, "body": "@cookieisaac Yes, if you aren&#39;t only interested in the order, shuffling won&#39;t help you."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1527472422, "post_id": 39925784, "comment_id": 88127171, "body": "&quot;<i>To benchmark a Go program with 10K, 100K, 1M pseudo-random number that has no duplications.</i>&quot; Benchmarking or testing? If you&#39;re benchmarking, assume it works and just time how long it takes to get N numbers. If you&#39;re <i>testing</i> then you&#39;re testing the wrong thing. Random number generators can have duplicates, they&#39;re random. What you want to test instead is whether they&#39;re <a href=\"https://stackoverflow.com/a/2130691/14660\">distributed evenly</a>."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1475875112, "post_id": 39925864, "comment_id": 67135529, "body": "after choosing 4 billion numbers from a 64bit range, you have over a 25% change of collision (<a href=\"https://en.wikipedia.org/wiki/Birthday_problem#Probability_table\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Birthday_problem#Probability_table</a>)"}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475876213, "post_id": 39925864, "comment_id": 67135894, "body": "I&#39;m trying to generate around 40000 unique int32, and my observation is that somehow I always manage to run into collisions using rand.Int()"}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475878071, "post_id": 39925864, "comment_id": 67136475, "body": "@JimB - you have a 25% of having a <i>single</i> collision. I&#39;m talking about the probability that, in any given generation event, the new number you generate is one you&#39;ve generated in the past."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475878118, "post_id": 39925864, "comment_id": 67136491, "body": "@cookieisaac It may be that rand.Int doesn&#39;t have very good randomness properties. You may want to check out <code>crypto&#47;rand</code> instead."}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 1, "creation_date": 1475879399, "post_id": 39925864, "comment_id": 67136824, "body": "@joshlf Actually, it&#39;s a 25% chance of having <i>at least</i> one collision."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 0, "creation_date": 1475900512, "post_id": 39925864, "comment_id": 67140450, "body": "@pjs Close enough ;)"}, {"owner": {"reputation": 16237, "user_id": 2166798, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/417356917295f5176d2a3e7c21d8f9e8?s=128&d=identicon&r=PG", "display_name": "pjs", "link": "https://stackoverflow.com/users/2166798/pjs"}, "edited": false, "score": 3, "creation_date": 1475901634, "post_id": 39925864, "comment_id": 67140618, "body": "@joshlf Not in my prob &amp; stats class it ain&#39;t!"}], "tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": false, "score": 3, "last_activity_date": 1527467418, "last_edit_date": 1527467418, "creation_date": 1475874668, "answer_id": 39925864, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/39925864#39925864", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>You should absolutely go with approach 2. Let's assume you're running on a 64-bit machine, and thus generating 63-bit integers (64 bits, but <code>rand.Int</code> never returns negative numbers). Even if you generate 4 billion numbers, there's still only a 1 in 4 billion chance that any given number will be a duplicate. Thus, you'll almost never have to regenerate, and almost <em>never</em> never have to regenerate twice.</p>\n\n<p>Try, for example:</p>\n\n<pre><code>type UniqueRand struct {\n    generated map[int]bool\n}\n\nfunc (u *UniqueRand) Int() int {\n    for {\n        i := rand.Int()\n        if !u.generated[i] {\n            u.generated[i] = true\n            return i\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475952280, "post_id": 39926743, "comment_id": 67153929, "body": "Thanks for the elaborate answer. Here&#39;s a few comments: Code snippet &lt;1&gt; is the same idea as @joshlf&#39;s answer, and thanks for benchmarking the result. Code snippet &lt;2&gt; is a cool hack that I wasn&#39;t aware of before. However, it doesn&#39;t suite my current use case, as in for any given fixed N, the array generated will always be the same, which sort of defeats the purpose of having a pseudo random number generator. Code snippet &lt;3&gt; inherits the same flaw as snippet &lt;2&gt; if I save it to the file, but only slower."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1475954243, "post_id": 39926743, "comment_id": 67154548, "body": "@cookieisaac You&#39;re welcome, in <code>map[int32]struct{}</code> using  the empty struct <code>struct{}</code> consumes zero bytes of memory, and is 30ms faster, see: <a href=\"http://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"nofollow noreferrer\">dave.cheney.net/2014/03/25/the-empty-struct</a>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1475911463, "last_edit_date": 1475911463, "creation_date": 1475880294, "answer_id": 39926743, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/39926743#39926743", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>1- <a href=\"https://play.golang.org/p/EqM16nLQQ9\" rel=\"nofollow\">Fast positive and negative <code>int32</code> unique  pseudo random numbers in 296ms using std lib</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    const n = 1000000\n    rand.Seed(time.Now().UTC().UnixNano())\n    duplicate := 0\n    mp := make(map[int32]struct{}, n)\n    var r int32\n    t := time.Now()\n    for i := 0; i &lt; n; {\n        r = rand.Int31()\n        if i&amp;1 == 0 {\n            r = -r\n        }\n        if _, ok := mp[r]; ok {\n            duplicate++\n        } else {\n            mp[r] = zero\n            i++\n        }\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(\"len: \", len(mp))\n    fmt.Println(\"duplicate: \", duplicate)\n    positive := 0\n    for k := range mp {\n        if k &gt; 0 {\n            positive++\n        }\n    }\n    fmt.Println(`n=`, n, `positive=`, positive)\n}\n\nvar zero = struct{}{}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>296.0169ms\nlen:  1000000\nduplicate:  118\nn= 1000000 positive= 500000\n</code></pre>\n\n<hr>\n\n<p>2- Just fill the <code>map[int32]struct{}</code>:</p>\n\n<pre><code>for i := int32(0); i &lt; n; i++ {\n        m[i] = zero\n}\n</code></pre>\n\n<p>When reading it is not in order in Go:</p>\n\n<pre><code>for k := range m {\n    fmt.Print(k, \" \")\n}\n</code></pre>\n\n<p>And this just takes 183ms for 1000000 unique numbers, no duplicate (<a href=\"https://play.golang.org/p/b6nARIrWUS\" rel=\"nofollow\">The Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    const n = 1000000\n    m := make(map[int32]struct{}, n)\n    t := time.Now()\n    for i := int32(0); i &lt; n; i++ {\n        m[i] = zero\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(\"len: \", len(m))\n    //  for k := range m {\n    //      fmt.Print(k, \" \")\n    //  }\n}\n\nvar zero = struct{}{}\n</code></pre>\n\n<hr>\n\n<p>3- Here is the simple but slow (this takes 22s for 200000 unique numbers), so you may generate and save it to a file once:</p>\n\n<pre><code>package main\n\nimport \"time\"\nimport \"fmt\"\nimport \"math/rand\"\n\nfunc main() {\n    dup := 0\n    t := time.Now()\n    const n = 200000\n    rand.Seed(time.Now().UTC().UnixNano())\n    var a [n]int32\n    var exist bool\n    for i := 0; i &lt; n; {\n        r := rand.Int31()\n        exist = false\n        for j := 0; j &lt; i; j++ {\n            if a[j] == r {\n                dup++\n                fmt.Println(dup)\n                exist = true\n                break\n            }\n        }\n        if !exist {\n            a[i] = r\n            i++\n        }\n    }\n    fmt.Println(time.Since(t))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "is_accepted": true, "score": 0, "last_activity_date": 1476397218, "last_edit_date": 1476397218, "creation_date": 1475881307, "answer_id": 39926884, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/39926884#39926884", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>Temporary workaround based on @joshlf's answer</p>\n\n<pre><code>type UniqueRand struct {\n    generated   map[int]bool    //keeps track of\n    rng         *rand.Rand      //underlying random number generator\n    scope       int             //scope of number to be generated\n}\n\n//Generating unique rand less than N\n//If N is less or equal to 0, the scope will be unlimited\n//If N is greater than 0, it will generate (-scope, +scope)\n//If no more unique number can be generated, it will return -1 forwards\nfunc NewUniqueRand(N int) *UniqueRand{\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n    return &amp;UniqueRand{\n        generated: map[int]bool{},\n        rng:        r1,\n        scope:      N,\n    }\n}\n\nfunc (u *UniqueRand) Int() int {\n    if u.scope &gt; 0 &amp;&amp; len(u.generated) &gt;= u.scope {\n        return -1\n    }\n    for {\n        var i int\n        if u.scope &gt; 0 {\n            i = u.rng.Int() % u.scope\n        }else{\n            i = u.rng.Int()\n        }\n        if !u.generated[i] {\n            u.generated[i] = true\n            return i\n        }\n    }\n}\n</code></pre>\n\n<p>Client side code</p>\n\n<pre><code>func TestSetGet2(t *testing.T) {\n    const N = 10000\n    for _, mask := range []int{0, -1, 0x555555, 0xaaaaaa, 0x333333, 0xcccccc, 0x314159} {\n        rng := NewUniqueRand(2*N)\n        a := make([]int, N)\n        for i := 0; i &lt; N; i++ {\n            a[i] = (rng.Int() ^ mask) &lt;&lt; 1\n        }\n\n        //Benchmark Code\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1527613031, "post_id": 50558119, "comment_id": 88188137, "body": "Neither was the reason when I asked the question. The use case is that I improved a previous B+ tree delete/insertion algorithm for input with no duplicates. I want to make claims such as &#39;This algorithm improves previous version by X% for case Y at size Z&#39;. Different benchmark case scenarios includes sequential and random. To construct the tree for the testing as well as to construct the input data set, I need a stream of &quot;random&quot; number that have no duplicates."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1527619940, "post_id": 50558119, "comment_id": 88191528, "body": "@cookieisaac The point still stands. You don&#39;t need all the extra work and memory to guarantee uniqueness, you just need all but guaranteed uniqueness. <code>math.Rand.Int63</code> producing 1 million numbers has a roughly 1 in 18 million chance of producing a duplicate. That&#39;s <a href=\"https://en.wikipedia.org/wiki/Orders_of_magnitude_(probability)\" rel=\"nofollow noreferrer\">about 5 sigma or the likelihood of dying on aircraft flight</a>. For the purposes of a benchmark, this is fine. If you use <code>crypto&#47;rand</code> you can make it even more unlikely."}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1527790319, "post_id": 50558119, "comment_id": 88270680, "body": "That project was wrapped up a while ago, but I remember there was some requirement stopping me from using <code>Int63</code> and have to use <code>Int</code> (32-bit). With <code>int</code>(32), I always (for some reason) run into duplicates even for 100K samples and crash the algorithm. With increased integer bit size, it surely works in favor for dodging the collision, but unnecessarily doubled the memory footprint for the tree. So I resort to sample a million unique numbers from int32 range <code>[-2,147,483,648 to 2,147,483,647]</code>"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "edited": false, "score": 0, "creation_date": 1527791923, "post_id": 50558119, "comment_id": 88271496, "body": "@cookieisaac Ahh, if you&#39;re restricted to just 32 bit numbers then yes, generating 1 million 32 bit numbers is guaranteed to have a collision. There&#39;s about a 50% chance at about 70,000."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 0, "last_activity_date": 1527472854, "last_edit_date": 1527472854, "creation_date": 1527471657, "answer_id": 50558119, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/50558119#50558119", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>I see two reasons for wanting this. You want to test a random number generator, or you want unique random numbers.</p>\n\n<h1>You're Testing A Random Number Generator</h1>\n\n<p>My first question is why? There's plenty of solid random number generators available. Don't write your own, it's basically dabbling in cryptography and that's never a good idea. Maybe you're testing a system that <em>uses</em> a random number generator to generate random output?</p>\n\n<p>There's a problem: there's no guarantee random numbers are unique. They're random. There's always a possibility of collision. Testing that random output is unique is incorrect.</p>\n\n<p>Instead, <strong><em>you want to test the results are distributed evenly</em></strong>. To do this I'll reference <a href=\"https://stackoverflow.com/a/2130691/14660\">another answer about how to test a random number generator</a>.</p>\n\n<h1>You Want Unique Random Numbers</h1>\n\n<p>From a practical perspective you don't need guaranteed uniqueness, but to make collisions so unlikely that it's not a concern. This is what <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_(random)\" rel=\"nofollow noreferrer\">UUIDs</a> are for. They're 128 bit Universally Unique IDentifiers. There's a number of ways to generate them for particular scenarios.</p>\n\n<p>UUIDv4 is basically just a 122 bit random number which has some ungodly small chance of a collision. <a href=\"https://en.wikipedia.org/wiki/Birthday_problem#Square_approximation\" rel=\"nofollow noreferrer\">Let's approximate it</a>.</p>\n\n<pre><code>n = how many random numbers you'll generate\nM = size of the keyspace (2^122 for a 122 bit random number)\nP = probability of collision\n\nP = n^2/2M\n</code></pre>\n\n<p>Solving for n...</p>\n\n<pre><code>n = sqrt(2MP)\n</code></pre>\n\n<p>Setting P to something absurd like 1e-12 (one in a trillion), we find you can generate about 3.2 trillion UUIDv4s with a 1 in a trillion chance of collision. You're 1000 times more likely to win the lottery than have a collision in 3.2 trillion UUIDv4s. I think that's acceptable.</p>\n\n<p>Here's <a href=\"https://github.com/frankenbeanies/uuid4\" rel=\"nofollow noreferrer\">a UUIDv4 library in Go to use</a> and a demonstration of generating 1 million unique random 128 bit values.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/frankenbeanies/uuid4\"\n)\n\nfunc main() {\n    for i := 0; i &lt;= 1000000; i++ {\n        uuid := uuid4.New().Bytes()\n\n        // use the uuid\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 39247, "user_id": 13760, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/d7951e5f68ad9562c47212f4e651edda?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/13760/carl"}, "is_accepted": false, "score": 0, "last_activity_date": 1528840832, "creation_date": 1528840832, "answer_id": 50826436, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/50826436#50826436", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>I'm typing this on a phone, so please forgive the lack of code or incorrect formatting.</p>\n\n<p>This is how I'd do it:</p>\n\n<p>Generate the list of ordered unique numbers.</p>\n\n<p>Choose any two random indices and swap their elements.</p>\n\n<p>Continue swapping for a certain number of iterations. </p>\n\n<p>The slice you're left with is your random unique list.</p>\n\n<p>Notes:</p>\n\n<p>It's simple and memory use is proportional to size</p>\n\n<p>The list can be generated and randomised at any time, even pre-compile using go generate</p>\n\n<p>When you want a number, you get the next element in the list.</p>\n\n<p>You have full control of its properties.</p>\n"}, {"tags": [], "owner": {"reputation": 3320, "user_id": 4950680, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C8cEh.jpg?s=128&g=1", "display_name": "Martin Zinovsky", "link": "https://stackoverflow.com/users/4950680/martin-zinovsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1603294116, "last_edit_date": 1603294116, "creation_date": 1575558705, "answer_id": 59198083, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/59198083#59198083", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>I had similar task to pick elements from initial slice by random uniq index. So from slice with 10k elements get 1k random uniq elements.</p>\n<p>Here is simple head on solution:</p>\n<pre><code>import (\n    &quot;time&quot;\n    &quot;math/rand&quot;\n)\n\nfunc getRandomElements(array []string) []string {\n    result := make([]string, 0)\n    existingIndexes := make(map[int]struct{}, 0)\n    randomElementsCount := 1000\n\n    for i := 0; i &lt; randomElementsCount; i++ {\n        randomIndex := randomIndex(len(array), existingIndexes)\n        result = append(result, array[randomIndex])\n    }\n\n    return result\n}\n\nfunc randomIndex(size int, existingIndexes map[int]struct{}) int {\n    rand.Seed(time.Now().UnixNano())\n\n    for {\n        randomIndex := rand.Intn(size)\n\n        _, exists := existingIndexes[randomIndex]\n        if !exists {\n            existingIndexes[randomIndex] = struct{}{}\n            return randomIndex\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 327, "user_id": 9617771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MTAUf.jpg?s=128&g=1", "display_name": "benyamin", "link": "https://stackoverflow.com/users/9617771/benyamin"}, "is_accepted": false, "score": 0, "last_activity_date": 1580646776, "last_edit_date": 1580646776, "creation_date": 1579612242, "answer_id": 59841948, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library/59841948#59841948", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>you can generate a unique random number with len(12) using UnixNano in golang time package : </p>\n\n<pre><code>uniqueNumber:=time.Now().UnixNano()/(1&lt;&lt;22)\nprintln(uniqueNumber)\n</code></pre>\n\n<p>it's always random :D</p>\n"}], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11942, "favorite_count": 2, "accepted_answer_id": 39926884, "answer_count": 7, "score": 11, "last_activity_date": 1603294116, "creation_date": 1475874288, "last_edit_date": 1495541342, "question_id": 39925784, "link": "https://stackoverflow.com/questions/39925784/how-to-generate-unique-random-number-in-go-using-standard-library", "title": "How to generate *unique* random number in Go using standard library", "body": "<p>Question: How can I generate a stream of <strong>unique</strong> random number in Go?</p>\n\n<p>Namely, I want to guarantee there's no duplication in array <code>a</code> using <code>math/rand</code> and/or standard Go library utilities.</p>\n\n<pre><code>func RandomNumberGenerator() *rand.Rand {\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)          \n    return r1\n}\nrng := RandomNumberGenerator()    \nN := 10000\nfor i := 0; i &lt; N; i++ {\n    a[i] = rng.Int()\n}\n</code></pre>\n\n<hr>\n\n<p>There are questions and solutions on how to generate a series of random number in Go, for example, <a href=\"https://stackoverflow.com/questions/6181260/generating-random-numbers-in-go\">here</a>. </p>\n\n<p>But right now I want to generate a series of random number that does not duplicate with previous value. Is there a standard/recommended way to do it in Go? </p>\n\n<p>My guess is to (1)use permutation or to (2) keep track of previously generated numbers and regenerate a value if it's been generated before. </p>\n\n<p>But solution (1) sounds like an overkill if I only want a few number and (2) sounds very time consuming if I end up generating a long series of random numbers due to collision, and I guess it's also very memory-consuming.</p>\n\n<hr>\n\n<p><strong>Use Case</strong>: To benchmark a Go program with 10K, 100K, 1M pseudo-random number that has no duplications.</p>\n"}, {"tags": ["go", "kubernetes", "coreos", "go-templates", "confd"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1475882105, "post_id": 39925606, "comment_id": 67137450, "body": "Why don&#39;t you check the condition in normal Go code with normal json handling and then just pass a bool into the template? Accessing the values in your json is pretty straight forward regardless of which variation it is however I&#39;m not really sure how you would do that given the libraries in play in that context. Unless the <code>$data</code> object is used heavily elsewhere I don&#39;t think it should be passed to the template at all since most of it is irrelevant in that context. In fact you should probably just extract the addresses list and pass that and have none of this logic in your template."}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 1, "last_activity_date": 1475899290, "last_edit_date": 1475899290, "creation_date": 1475898846, "answer_id": 39928505, "question_id": 39925606, "link": "https://stackoverflow.com/questions/39925606/go-templates-check-whether-a-key-exists-in-json-list/39928505#39928505", "title": "Go Templates - Check whether a key exists in json list", "body": "<p>The <code>$data.subsets[0].addresses</code> is illegal template expression (contains <code>[</code> and <code>]</code>). Try the following template definition:</p>\n\n<pre><code>{{range $cfg := getvs \"/registry/services/endpoints/*/app\"}}\n{{$data := json $cfg}}\n{{range $data.subsets}}{{range $addr := .addresses}}\n{{with $ns := $addr.targetRef.namespace}}\nupstream {{$ns}}_{{$addr.targetRef.name}}_pool {\n    {{range $data.subsets}}{{range $port := .ports}}\n        {{/* \n            Split port.name then test if address namespace \n            match the port.name. Test Condition:\n            len($portDesc) &gt; 0 &amp;&amp; $portDesc[0] == $ns\n        */}}\n        {{$portDesc := split $port.name \"-\"}}\n        {{if and (gt (len $portDesc) 0) (eq (index $portDesc 0) $ns)}}\n  server {{ $addr.ip }}:{{ $port.port }};\n        {{end}}\n    {{end}}{{ end }}\n}\n{{end}}\n{{end}}{{end}}\n</code></pre>\n\n<p>Generated output(after removing empty lines) for the above three json data should be:</p>\n\n<pre><code>upstream ns1_app-3869480132-kfthi_pool {\n  server 10.254.18.11:8080;\n}\nupstream ns1_app-3869480132-9bufk_pool {\n  server 10.254.18.9:8080;\n}\n</code></pre>\n\n<p>The key is <code>range</code> action in <code>{{range $data.subsets}}{{range $addr := .addresses}}</code>. Nothing will be written if <code>len</code> of pipeline (<code>subsets</code> or <code>addresses</code>) is zero, i.e. when <code>subsets</code> does not contains element or <code>addresses</code> is <code>null</code> (no subsets element named <code>addresses</code>).  </p>\n"}], "owner": {"reputation": 4687, "user_id": 408913, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/yZwgk.jpg?s=128&g=1", "display_name": "David Houde", "link": "https://stackoverflow.com/users/408913/david-houde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1737, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499761428, "creation_date": 1475873438, "last_edit_date": 1499761428, "question_id": 39925606, "link": "https://stackoverflow.com/questions/39925606/go-templates-check-whether-a-key-exists-in-json-list", "title": "Go Templates - Check whether a key exists in json list", "body": "<p>I am using <a href=\"https://github.com/kelseyhightower/confd\" rel=\"nofollow\">confd</a> for a dynamic nginx service reconfiguration and having a bit of a struggle with the Go Templates. I have a json object named <code>$data</code> and <code>$data.subsets</code> may contain a key named 'addresses' -- I want to only execute the template inside the loop if that condition is met. </p>\n\n<p>I've tried various things like the <code>$data.subsets[0].addresses</code> you see below which is completely wrong. I am not really sure how this can be done correctly.</p>\n\n<p>This is a piece of my nginx template that I only want to render if there is at least 1 upstream service, not if there are none/unavailable. </p>\n\n<p>Following the template is the json objects for <code>$data</code> on success any failure. </p>\n\n<p>Thank you in advance for the help, it's greatly appreciated!</p>\n\n<pre><code>{{ range $ns := getvs \"/registry/services/endpoints/*/app\" }}\n{{ $data := json $ns }}\n    {{ if $data.subsets[0].addresses }}\nupstream {{ $data.metadata.namespace }}_{{ $data.metadata.name }}_pool {\n        {{ range $subset := $data.subsets }}{{ range $ref := $subset.addresses }}{{ range $portConfig := $subset.ports }}\n server {{ $ref.ip }}:{{ $portConfig.port }};\n        {{ end }}{{ end }}{{ end }}\n}\n    {{ end }}\n{{ end }}\n</code></pre>\n\n<p>Example of <code>$data</code> when there are no Pods scheduled:</p>\n\n<pre><code>{  \n   \"kind\":\"Endpoints\",\n   \"apiVersion\":\"v1\",\n   \"metadata\":{  \n      \"name\":\"app\",\n      \"namespace\":\"ns1\",\n      \"selfLink\":\"/api/v1/namespaces/ns1/endpoints/app\",\n      \"labels\":{  \n         \"app\":\"app\"\n      }\n   },\n   \"subsets\":[]\n}\n</code></pre>\n\n<p>Example of <code>$data</code> when there are pods running but not healthy:</p>\n\n<pre><code>{  \n   \"kind\":\"Endpoints\",\n   \"apiVersion\":\"v1\",\n   \"metadata\":{  \n      \"name\":\"app\",\n      \"namespace\":\"ns1\",\n      \"labels\":{  \n         \"app\":\"app\"\n      }\n   },\n   \"subsets\":[  \n      {  \n         \"notReadyAddresses\":[  \n            {  \n               \"ip\":\"10.254.60.5\",\n               \"targetRef\":{  \n                  \"kind\":\"Pod\",\n                  \"namespace\":\"ns1\",\n                  \"name\":\"app-421757659-83rfg\",\n               }\n            }\n         ],\n         \"ports\":[  \n            {  \n               \"name\":\"ns1-app-8080\",\n               \"port\":8080,\n               \"protocol\":\"TCP\"\n            }\n         ]\n      }\n   ]\n}\n</code></pre>\n\n<p>Example of <code>$data</code> when there are pods running and available. This is the only condition I wish to meet for the iteration of the template to render.</p>\n\n<pre><code>{  \n   \"kind\":\"Endpoints\",\n   \"apiVersion\":\"v1\",\n   \"metadata\":{  \n      \"name\":\"app\",\n      \"namespace\":\"ns1\",\n      \"selfLink\":\"/api/v1/namespaces/ns1/endpoints/app\",\n      \"labels\":{  \n         \"app\":\"app\"\n      }\n   },\n   \"subsets\":[  \n      {  \n         \"addresses\":[  \n            {  \n               \"ip\":\"10.254.18.11\",\n               \"targetRef\":{  \n                  \"kind\":\"Pod\",\n                  \"namespace\":\"ns1\",\n                  \"name\":\"app-3869480132-kfthi\"\n               }\n            },\n            {  \n               \"ip\":\"10.254.18.9\",\n               \"targetRef\":{  \n                  \"kind\":\"Pod\",\n                  \"namespace\":\"ns1\",\n                  \"name\":\"app-3869480132-9bufk\"\n               }\n            }\n         ],\n         \"ports\":[  \n            {  \n               \"name\":\"ns1-app-8080\",\n               \"port\":8080,\n               \"protocol\":\"TCP\"\n            }\n         ]\n      }\n   ]\n}\n</code></pre>\n"}, {"tags": ["go", "refactoring"], "comments": [{"owner": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475871090, "post_id": 39924136, "comment_id": 67133929, "body": "@JimB Appreciate the ideas, thank you. Unfortunately we have spotty code coverage. The <code>guru</code> tool could be useful."}], "answers": [{"tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": false, "score": 2, "last_activity_date": 1475868883, "creation_date": 1475868883, "answer_id": 39924613, "question_id": 39924136, "link": "https://stackoverflow.com/questions/39924136/find-dead-code-in-golang-monorepo/39924613#39924613", "title": "Find dead code in Golang monorepo", "body": "<p>Try running <code>go build -gcflags -live</code>. This passes the <code>-live</code> flag to the compiler (<code>go tool compile</code>), instructing it to output debugging messages about liveness analysis. Unfortunately, it only prints when it's found live code, not dead code, but you could in theory look to see what <em>doesn't</em> show up in the output.</p>\n\n<p>Here's an example from compiling the following program stored in <code>dead.go</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    if true {\n        fmt.Println(true)\n    } else {\n        fmt.Println(false)\n    }\n}\n</code></pre>\n\n<p>Output of <code>go build -gcflags -live</code>:</p>\n\n<pre><code># _/tmp/dead\n./dead.go:7: live at call to convT2E: autotmp_5\n./dead.go:7: live at call to Println: autotmp_5\n</code></pre>\n\n<p>If I'm reading this correctly, the second line states that the implicit call to <code>convT2E</code> (which converts non-interface types to interface types, since <code>fmt.Println</code> takes arguments of type <code>interface{}</code>) is live, and the third line states that the call to <code>fmt.Println</code> is live. Note that it <em>doesn't</em> say that the <code>fmt.Println(false)</code> call is live, so we can deduce that it must be dead.</p>\n\n<p>I know that's not a perfect answer, but I hope it helps.</p>\n"}, {"comments": [{"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1595960499, "post_id": 39924951, "comment_id": 111653400, "body": "It seems like <code>unused</code> doesn&#39;t exist anymore as a standalone tool and was replaced by <code>staticcheck</code>. I don&#39;t seem to be able to do this with <code>staticcheck</code>, do you know how?"}, {"owner": {"reputation": 4152, "user_id": 592254, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/abe56303903304bb666b0e47ca9d42fd?s=128&d=identicon&r=PG", "display_name": "Adrien Joly", "link": "https://stackoverflow.com/users/592254/adrien-joly"}, "edited": false, "score": 1, "creation_date": 1597239143, "post_id": 39924951, "comment_id": 112067938, "body": "thank you! <code>$ go run honnef.co&#47;go&#47;tools&#47;cmd&#47;staticcheck --unused.whole-program=true -- .&#47;...</code> worked well for me!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 31, "last_activity_date": 1618260040, "last_edit_date": 1618260040, "creation_date": 1475870578, "answer_id": 39924951, "question_id": 39924136, "link": "https://stackoverflow.com/questions/39924136/find-dead-code-in-golang-monorepo/39924951#39924951", "title": "Find dead code in Golang monorepo", "body": "<p><strong>UPD 2020:</strong>  The <code>unused</code> tool has been incorporated into <code>staticcheck</code>.\nUnfortunately, <code>v0.0.1-2020.1.4</code> will probably be the last to support this\nfeature.  Dominik <a href=\"//github.com/dominikh/go-tools/commit/5cfc85b7\" rel=\"nofollow noreferrer\">explains</a> that it is because the check consumes a lot of\nresources and is hard to get right.</p>\n<p>To get that version:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>env GO111MODULE=on go get honnef.co/go/tools/cmd/staticcheck@v0.0.1-2020.1.4\n</code></pre>\n<p>To use it:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ staticcheck --unused.whole-program=true -- ./...\n./internal/pkg/a.go:5:6: type A is unused (U1001)\n</code></pre>\n<p>Original answer below.</p>\n<hr />\n<p>Dominik Honnef's <a href=\"//github.com/dominikh/go-tools\" rel=\"nofollow noreferrer\"><code>unused</code></a> tool might be what you're looking for:</p>\n<blockquote>\n<p>Optionally via the -exported flag, unused can analyse all arguments as a\nsingle program and report unused exported identifiers. This can be useful for\nchecking &quot;internal&quot; packages, or large software projects that do not export\nan API to the public, but use exported methods between components.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 9514853, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OQO2Uqqjexk/AAAAAAAAAAI/AAAAAAAAEhs/KjYXhe-QWBs/photo.jpg?sz=128", "display_name": "Reed Wade", "link": "https://stackoverflow.com/users/9514853/reed-wade"}, "is_accepted": false, "score": -1, "last_activity_date": 1551672823, "creation_date": 1551672823, "answer_id": 54976528, "question_id": 39924136, "link": "https://stackoverflow.com/questions/39924136/find-dead-code-in-golang-monorepo/54976528#54976528", "title": "Find dead code in Golang monorepo", "body": "<p>A reliable but inelegant method I've used is to rename or comment out functions you suspect might not be used and then recompile everything -- no errors means you didn't need them.</p>\n\n<p>If they are needed, it shows you where these functions are called so it's good for getting familiar with a code base and seeing how things connect.</p>\n"}, {"tags": [], "owner": {"reputation": 17, "user_id": 3001983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0d2ef0e7ce0720f2b0b95f20211d66?s=128&d=identicon&r=PG", "display_name": "dionbosschieter", "link": "https://stackoverflow.com/users/3001983/dionbosschieter"}, "is_accepted": false, "score": -2, "last_activity_date": 1584456988, "creation_date": 1584456988, "answer_id": 60724885, "question_id": 39924136, "link": "https://stackoverflow.com/questions/39924136/find-dead-code-in-golang-monorepo/60724885#60724885", "title": "Find dead code in Golang monorepo", "body": "<p>It is a bit dirty, but it works for me.\nI had a lot of structs which I did not want to test manually, so I wrote a script that renames the struct then runs all the tests (ci/test.sh) and renames it back if any test failed:</p>\n\n<pre><code>#!/bin/sh\n\nset -e\n\ngit grep 'struct {' | grep type | while read line; do\n  file=$(echo $line | awk -F ':' '{print $1}')\n  struct=$(echo $line | awk '{print $2}') \n\n  sed \"s/$struct struct/_$struct struct/g\" -i $file\n\n  echo \"testing for struct $struct changed in file $file\"\n\n  if ! ./ci/test.sh; then\n    sed \"s/_$struct struct/$struct struct/g\" -i $file\n  fi\ndone\n</code></pre>\n"}], "owner": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8794, "favorite_count": 1, "accepted_answer_id": 39924951, "answer_count": 4, "score": 20, "last_activity_date": 1618260040, "creation_date": 1475866678, "question_id": 39924136, "link": "https://stackoverflow.com/questions/39924136/find-dead-code-in-golang-monorepo", "title": "Find dead code in Golang monorepo", "body": "<p>My team has all our Golang code in a monorepo.</p>\n\n<ul>\n<li>Various package subdirectories with library code.</li>\n<li>Binaries/services/tools under <code>cmd</code></li>\n</ul>\n\n<p>We've had it for a while and are doing some cleanup. Are there any tools or techniques that can find functions not used by the binaries under <code>cmd</code>?</p>\n\n<p>I know <code>go vet</code> can find private functions that are unused in a package. However I suspect we also have exported library functions that aren't used either.</p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6938349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527f2993fd572b5feb7cc2904a488b48?s=128&d=identicon&r=PG&f=1", "display_name": "user6938349", "link": "https://stackoverflow.com/users/6938349/user6938349"}, "edited": false, "score": 1, "creation_date": 1476021676, "post_id": 39922748, "comment_id": 67169123, "body": "Thanks, I used the http.StatusPermanentRedirect and it works."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1475872330, "last_edit_date": 1475872330, "creation_date": 1475860672, "answer_id": 39922748, "question_id": 39922263, "link": "https://stackoverflow.com/questions/39922263/using-gin-how-to-pass-original-json-payload-to-a-redirect-post/39922748#39922748", "title": "Using Gin: How to pass original JSON payload to a Redirect POST", "body": "<p>This doesn't have anything to do with Go or gin. </p>\n\n<p>This is the expected behavior of a user agent, which should change the method from POST to GET with either a 301 or 302 redirect. </p>\n\n<p>To instruct the user agent to repeat the request with the same method, use 307 (<code>http.StatusTemporaryRedirect</code>) or 308 (<code>http.StatusPermanentRedirect</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 68, "user_id": 10114750, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-g2LJW3hcb9c/AAAAAAAAAAI/AAAAAAAAAhs/-K6dxblRlNQ/photo.jpg?sz=128", "display_name": "Ravishankar S R", "link": "https://stackoverflow.com/users/10114750/ravishankar-s-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1537972749, "creation_date": 1537972749, "answer_id": 52520362, "question_id": 39922263, "link": "https://stackoverflow.com/questions/39922263/using-gin-how-to-pass-original-json-payload-to-a-redirect-post/52520362#52520362", "title": "Using Gin: How to pass original JSON payload to a Redirect POST", "body": "<p>You must use <strong>301</strong> or <strong>302</strong> as a redirect status code.    </p>\n\n<pre><code>c.Redirect(301, \"http://www.google.com/\")\n</code></pre>\n\n<p>Please refer the documentation <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Redirect\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 537, "user_id": 1155318, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FXiSZ.jpg?s=128&g=1", "display_name": "Vuong", "link": "https://stackoverflow.com/users/1155318/vuong"}, "is_accepted": false, "score": 0, "last_activity_date": 1561704218, "creation_date": 1561704218, "answer_id": 56802084, "question_id": 39922263, "link": "https://stackoverflow.com/questions/39922263/using-gin-how-to-pass-original-json-payload-to-a-redirect-post/56802084#56802084", "title": "Using Gin: How to pass original JSON payload to a Redirect POST", "body": "<p>I've got the problem too many requests (loop), so I'm fine with this one.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err != nil {\n    session.AddFlash(\"The error I would like to show.\", \"error\")\n    c.Redirect(http.StatusMovedPermanently, \"/my/route\")\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6938349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527f2993fd572b5feb7cc2904a488b48?s=128&d=identicon&r=PG&f=1", "display_name": "user6938349", "link": "https://stackoverflow.com/users/6938349/user6938349"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4595, "favorite_count": 0, "accepted_answer_id": 39922748, "answer_count": 3, "score": 4, "last_activity_date": 1561704218, "creation_date": 1475858784, "last_edit_date": 1489443481, "question_id": 39922263, "link": "https://stackoverflow.com/questions/39922263/using-gin-how-to-pass-original-json-payload-to-a-redirect-post", "title": "Using Gin: How to pass original JSON payload to a Redirect POST", "body": "<p>I'm a newbie when it comes to Go and Gin, so please excuse my ignorance.</p>\n\n<p>I've setup a server using Gin which supports a POST request. I would like the user to POST their request which includes a required JSON payload redirecting that request to another URL. As part of the redirect I need to pass the original JSON payload. For example, if the user issues this CURL request:</p>\n\n<p>curl -H \"Content-Type: application/json\" -d '{ \"name\": \"NewTest Network\", \"organizationId\": 534238, \"type\": \"wireless\"}' -X POST \"<a href=\"http://localhost:8080/network\" rel=\"nofollow\">http://localhost:8080/network</a>\"</p>\n\n<p>My Gin code does this:</p>\n\n<pre><code>r.POST(\"/network\", func(c *gin.Context) {\n    c.Redirect(http.StatusMovedPermanently, networks_url)\n})\n</code></pre>\n\n<p>where: networks_url is the redirected URL. I need a way to pass the original JSON payload to the redirected URL.</p>\n\n<p>Any help you could provide would be greatly appreciated.</p>\n"}, {"tags": ["postgresql", "amazon-web-services", "go", "go-gorm"], "comments": [{"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1475867723, "post_id": 39920283, "comment_id": 67132370, "body": "Not running into firewall issues?  I could see that causing a hang."}, {"owner": {"reputation": 1517, "user_id": 1652820, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/239c4c728f22317fd010b2ce40558085?s=128&d=identicon&r=PG", "display_name": "thisisnotabus", "link": "https://stackoverflow.com/users/1652820/thisisnotabus"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1475868240, "post_id": 39920283, "comment_id": 67132582, "body": "I connect to this AWS database using PG Admin, as well as SQL-Tabs all the time, using an identical connection string."}], "answers": [{"tags": [], "owner": {"reputation": 1517, "user_id": 1652820, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/239c4c728f22317fd010b2ce40558085?s=128&d=identicon&r=PG", "display_name": "thisisnotabus", "link": "https://stackoverflow.com/users/1652820/thisisnotabus"}, "is_accepted": true, "score": 0, "last_activity_date": 1480351958, "creation_date": 1480351958, "answer_id": 40849531, "question_id": 39920283, "link": "https://stackoverflow.com/questions/39920283/gorm-hangs-on-gorm-open-no-error-but-no-response/40849531#40849531", "title": "Gorm hangs on gorm.Open, no error but no response", "body": "<p>The issue was not in the code block I posted above, but in the <code>main</code> function that calls <code>initDB</code>. The call to <code>initDB</code> was after <code>http.ListenAndServe</code> which blocks forever.</p>\n"}], "owner": {"reputation": 1517, "user_id": 1652820, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/239c4c728f22317fd010b2ce40558085?s=128&d=identicon&r=PG", "display_name": "thisisnotabus", "link": "https://stackoverflow.com/users/1652820/thisisnotabus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 40849531, "answer_count": 1, "score": 0, "last_activity_date": 1480351958, "creation_date": 1475852336, "last_edit_date": 1479762419, "question_id": 39920283, "link": "https://stackoverflow.com/questions/39920283/gorm-hangs-on-gorm-open-no-error-but-no-response", "title": "Gorm hangs on gorm.Open, no error but no response", "body": "<p>I'm trying to use gorm as an ORM for an app, but <code>gorm.Open</code> doesn't appear to ever return, which is making my app hang.  The only difference between my test case and all the examples I've seen online is my test case is connected to an AWS box, whereas all the others are connecting to local Postgres instances. Does that matter?</p>\n\n<p>The code that I have is:</p>\n\n<pre><code>func initDB() {\n    var err error\n    db, err := gorm.Open(\"postgres\", \"host=something.rds.amazonaws.com user=awsuser dbname=db sslmode=disable password=awspassword\")\n    if err != nil {\n       panic(err)\n    }\n    log.Printf(\"Connected\")\n    defer db.Close()\n}\n</code></pre>\n\n<p>I've tried switching <code>sslmode</code>, I've tried using the postgres connection string (pulled straight from a postgres client so it is valid), I've tried switching to <code>sql.Open</code>. I don't know what else there is to try. FWIW  I can see that none of my requests are hitting AWS.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475850681, "post_id": 39919615, "comment_id": 67123119, "body": "Your <code>Context</code> type has an embedded interface; <code>echo.Context</code>, which needs a value. I&#39;m not sure what you&#39;re trying to do here exactly, since you&#39;re not working with any Requests or Responses."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1475850690, "post_id": 39919615, "comment_id": 67123125, "body": "The <code>TestRoot</code> function must set c.Context to a non-nil interface value before calling methods on that interface.  Perhaps the Echo package provides a way to create such a context for tests."}, {"owner": {"reputation": 4033, "user_id": 1062194, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1353eb20d212e3ca5f6f93b516d3032d?s=128&d=identicon&r=PG&f=1", "display_name": "ohboy21", "link": "https://stackoverflow.com/users/1062194/ohboy21"}, "edited": false, "score": 0, "creation_date": 1475850935, "post_id": 39919615, "comment_id": 67123270, "body": "That&#39;s my question. In the Unit tests I am used to do, I just test if the root function is returning the right object with a proper value. How can I do that in Go (or shouldn&#39;t I do this at all?)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475851285, "post_id": 39919615, "comment_id": 67123505, "body": "@gruberb: this is part of what I don&#39;t understand, you&#39;re not even calling &quot;root&quot;, and that function only returns the error from the String method (which will be <code>nil</code> if everything worked).  All you&#39;re doing is calling the <code>String</code>method on an interface which you left <code>nil</code>. I also don&#39;t understand what the value of comparing the 2 error values from 2 identical method calls is, since they should always be the same given the method is deterministic."}, {"owner": {"reputation": 4033, "user_id": 1062194, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1353eb20d212e3ca5f6f93b516d3032d?s=128&d=identicon&r=PG&f=1", "display_name": "ohboy21", "link": "https://stackoverflow.com/users/1062194/ohboy21"}, "edited": false, "score": 0, "creation_date": 1475851535, "post_id": 39919615, "comment_id": 67123650, "body": "Yeah, I am not there yet. I just wanted to see how this assert works and how I create simple test data. Looks like I have to dig a bit deeper on that. Thanks for your help though!"}], "owner": {"reputation": 4033, "user_id": 1062194, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1353eb20d212e3ca5f6f93b516d3032d?s=128&d=identicon&r=PG&f=1", "display_name": "ohboy21", "link": "https://stackoverflow.com/users/1062194/ohboy21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 597, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475876584, "creation_date": 1475850355, "last_edit_date": 1475851097, "question_id": 39919615, "link": "https://stackoverflow.com/questions/39919615/invalid-memory-address-while-testing-in-go", "title": "&quot;Invalid memory address&quot; while testing in Go", "body": "<p>I have a simple Go function which I want to test:</p>\n\n<pre><code>func root(c echo.Context) error {\n    return c.String(http.StatusOK, \"This is the root!\")\n}\n</code></pre>\n\n<p>My tests look like this:</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"testing\"\n\n    \"github.com/labstack/echo\"\n    \"github.com/stretchr/testify/assert\"\n)\n\ntype Context struct {\n    echo.Context\n}\n\nfunc TestRoot(t *testing.T) {\n    c := new(Context)\n    expectedResult := c.String(http.StatusOK, \"This is the root!\")\n    actualResult := c.String(http.StatusOK, \"This is the root!\")\n\n    assert.Equal(t, expectedResult, actualResult, \"they should be equal\")\n}\n</code></pre>\n\n<p>Now, when I run the test, I am getting this error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference [recovered]\n        panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>I am fairly new to Go and just want to try to make sense of it. I get it that when I address an object which does not exist, I am getting this error. But every variable assignment I am doing has no change to be <code>nil</code>.</p>\n\n<blockquote>\n  <p>Can somebody point me to a solution? Or tell me how simple unit tests should look like in Go?</p>\n</blockquote>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 2107, "user_id": 1380407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7dbe0eaece49b2688be4b11c93d12f?s=128&d=identicon&r=PG", "display_name": "Sai Pullabhotla", "link": "https://stackoverflow.com/users/1380407/sai-pullabhotla"}, "edited": false, "score": 1, "creation_date": 1475884518, "post_id": 39919201, "comment_id": 67138010, "body": "If I understood your question correctly, you are probably looking for kindless ancestor queries - <a href=\"https://cloud.google.com/appengine/docs/python/datastore/queries#kindless_ancestor_queries\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/python/datastore/&hellip;</a>"}, {"owner": {"reputation": 451, "user_id": 933670, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/u1O9u.jpg?s=128&g=1", "display_name": "etnbrd", "link": "https://stackoverflow.com/users/933670/etnbrd"}, "reply_to_user": {"reputation": 2107, "user_id": 1380407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7dbe0eaece49b2688be4b11c93d12f?s=128&d=identicon&r=PG", "display_name": "Sai Pullabhotla", "link": "https://stackoverflow.com/users/1380407/sai-pullabhotla"}, "edited": false, "score": 0, "creation_date": 1475936754, "post_id": 39919201, "comment_id": 67148834, "body": "Yes, exactly. It is possible in Python, but not in Go : <a href=\"http://stackoverflow.com/questions/14948440/kindless-queries-in-app-engine-go\" title=\"kindless queries in app engine go\">stackoverflow.com/questions/14948440/&hellip;</a> I guess it is because of the static typing of Go."}, {"owner": {"reputation": 2107, "user_id": 1380407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7dbe0eaece49b2688be4b11c93d12f?s=128&d=identicon&r=PG", "display_name": "Sai Pullabhotla", "link": "https://stackoverflow.com/users/1380407/sai-pullabhotla"}, "edited": false, "score": 0, "creation_date": 1475956510, "post_id": 39919201, "comment_id": 67155254, "body": "I do not know much about Go, but found this in the AppEngine Go documentation. Seems like there is support for what you are asking - <a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#kindless_ancestor_queries\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/go/datastore/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": false, "score": 1, "last_activity_date": 1475853454, "creation_date": 1475853454, "answer_id": 39920674, "question_id": 39919201, "link": "https://stackoverflow.com/questions/39919201/retrieve-entity-of-different-kind-with-a-common-ancestor/39920674#39920674", "title": "Retrieve entity of different kind with a common ancestor", "body": "<p>From <a href=\"https://cloud.google.com/appengine/docs/go/datastore/creating-entity-keys#Go_Ancestor_paths\" rel=\"nofollow\">Using ancestor paths</a>:</p>\n\n<blockquote>\n  <p>The complete key identifying the entity consists of a sequence of\n  kind-identifier pairs specifying its ancestor path and terminating\n  with those of the entity itself:</p>\n\n<pre><code>[Person:GreatGrandpa, Person:Grandpa, Person:Dad, Person:Me]\n</code></pre>\n  \n  <p>For a root entity, the ancestor path is empty and the key consists\n  solely of the entity's own kind and identifier:</p>\n\n<pre><code>[Person:GreatGrandpa]\n</code></pre>\n</blockquote>\n\n<p>In other words the key of <strong>any</strong> of the entities in an entity group (including the root entity - the common ancestor) is a list of keys for the entire ancestry path, which starts with the root entity's key.</p>\n\n<p>So, to obtain the root entity key from any of the descendants just get the 1st element in that entity's key list.</p>\n\n<p>Not familiar with <code>go</code>, but in <code>python</code> a particular item in the ancestry path is a tuple (pair) and to obtain the root entity key from any entity key it'd be something like this:</p>\n\n<pre><code>root_entity_key = ndb.Key(pairs=tuple(list(entity_key.pairs())[0])\n</code></pre>\n\n<p>Now, with the root entity (common ancestor) key you can perform <a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#ancestor_queries\" rel=\"nofollow\">ancestor queries</a> for any descendant kind you desire.</p>\n"}], "owner": {"reputation": 451, "user_id": 933670, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/u1O9u.jpg?s=128&g=1", "display_name": "etnbrd", "link": "https://stackoverflow.com/users/933670/etnbrd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1476046028, "creation_date": 1475849077, "last_edit_date": 1476046028, "question_id": 39919201, "link": "https://stackoverflow.com/questions/39919201/retrieve-entity-of-different-kind-with-a-common-ancestor", "title": "Retrieve entity of different kind with a common ancestor", "body": "<p>I want to store hierarchical entities in the datastore.\nThe children entities would have different kind, to represent something like this :</p>\n\n<pre><code>type EntityA struct {\n    Id        string\n    LeafA     *EntityA\n    LeafB     *EntityB\n    SomeValue string\n}\n\ntype EntityB struct {\n    Id         string\n    OtherValue string\n}\n</code></pre>\n\n<p>I planned to use ancestors, but it seems impossible to retrieve the children of a common ancestor that have different kind.</p>\n\n<p>To retrieve the whole parent, is it possible to query all children of a common ancestors without specifying the kind ?</p>\n\n<p>Or is there another possibility to solve this problem ?</p>\n"}, {"tags": ["git", "go", "symlink", "git-submodules"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1475848159, "creation_date": 1475848159, "answer_id": 39918880, "question_id": 39918756, "link": "https://stackoverflow.com/questions/39918756/go-cannot-package-in-symlink/39918880#39918880", "title": "Go: cannot package in symlink", "body": "<p>The Go tools purposely don't follow symlinks. Make sure there aren't any in your GOPATH, and always use the full import path relative to <code>$GOPATH/src/</code> for installed packages, and relative to the <code>vendor/</code> directory for vendored packages. </p>\n"}], "owner": {"reputation": 4842, "user_id": 1493868, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7a84611ec325ce3125ec56149b2cfcb6?s=128&d=identicon&r=PG", "display_name": "Tr\u1ea7n Kim D\u1ef1", "link": "https://stackoverflow.com/users/1493868/tr%e1%ba%a7n-kim-d%e1%bb%b1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 39918880, "answer_count": 1, "score": -1, "last_activity_date": 1475848159, "creation_date": 1475847803, "question_id": 39918756, "link": "https://stackoverflow.com/questions/39918756/go-cannot-package-in-symlink", "title": "Go: cannot package in symlink", "body": "<p>I have one go project. In this project, for example I have a <code>lib_project</code> that is a symlink to another directory, for example: <code>github_project</code></p>\n\n<p>After I pull source code to local, I update another git submodules (<code>github_project</code> is one submodule). And then I go here and compile project.</p>\n\n<p>After that, I go to my main project and try to run command go. I meet exception:</p>\n\n<pre><code>package github.com/main_project/test.go: cannot find package \"github.com/main_project/lib_project/some_random_file.go\" in any of:\n\n        /usr/local/Cellar/go/1.7.1/libexec/src/github.com/main_project/lib_project/some_random_file.go (from $GOROOT)\n\n        /Users/my_user/Documents/go/src/github.com/main_project/lib_project/some_random_file.go (from $GOPATH)\n</code></pre>\n\n<p>I have tested and see that the directory <code>github.com/main_project/lib_project/some_random_file.go</code> is exsit. I can cd to this and open file. That looks like Go doesn't recognize symlink folder (in this case is <code>lib_project</code>)</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475845411, "post_id": 39916836, "comment_id": 67119830, "body": "The error is because you&#39;re trying to treat a DSA key as an RSA key. There&#39;s no code to work with DSA keys in the go crypto library or the ssh package, probably because they&#39;ve been deprecated and not really used much for many years."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475846743, "post_id": 39916836, "comment_id": 67120621, "body": "Here&#39;s an explanation from AGL showing how to determine the key structure to <code>asn1.Unmarshal</code> into: <a href=\"https://groups.google.com/d/topic/golang-nuts/0WLCbeG1vfY/discussion\" rel=\"nofollow noreferrer\">groups.google.com/d/topic/golang-nuts/0WLCbeG1vfY/discussion</a> with a working example: <a href=\"http://play.golang.org/p/2IbFYl9WBD\" rel=\"nofollow noreferrer\">play.golang.org/p/2IbFYl9WBD</a>"}, {"owner": {"reputation": 5767, "user_id": 27800, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8d805c02bfa80a79df1381984ac5d3a?s=128&d=identicon&r=PG", "display_name": "Peter Miehle", "link": "https://stackoverflow.com/users/27800/peter-miehle"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475847430, "post_id": 39916836, "comment_id": 67121064, "body": "@JimB is there a tool to convert the &quot;DSA key file&quot; into a RSA file?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475847708, "post_id": 39916836, "comment_id": 67121248, "body": "It&#39;s not a matter of converting a format, DSA and RSA are different things with different capabilities."}], "owner": {"reputation": 5767, "user_id": 27800, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8d805c02bfa80a79df1381984ac5d3a?s=128&d=identicon&r=PG", "display_name": "Peter Miehle", "link": "https://stackoverflow.com/users/27800/peter-miehle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475843482, "creation_date": 1475841853, "question_id": 39916836, "link": "https://stackoverflow.com/questions/39916836/reading-a-private-dsa-key-for-signing", "title": "Reading a Private DSA Key for signing", "body": "<p>I am new to golang and want to implement a functionality from my olde C-Program.</p>\n\n<p>I have a \"DSA PRIVATE KEY\" with passphrase and a \"CERTIFICATE\"</p>\n\n<p>In C I did:</p>\n\n<pre><code>{\nchar *privkey=\n  \"-----BEGIN DSA PRIVATE KEY-----\\n\"\n  \"Proc-Type: 4,ENCRYPTED\\n\"\n  \"DEK-Info: DES-EDE3-CBC, xxxxxx\\n\"\n  \"-----END DSA PRIVATE KEY-----\\n\"\n  \"-----BEGIN CERTIFICATE-----\\n\"\n  \"xxxx\\n\"\n  \"Og==\\n\"\n  \"-----END CERTIFICATE-----\\n\"\n;\nERR_load_crypto_strings();\nOpenSSL_add_all_algorithms();\nBIO *mem = BIO_new(BIO_s_mem());\nBIO_puts(mem, privkey);\ndsa = PEM_read_bio_DSAPrivateKey(mem, NULL, NULL, \"passphrase\");\n\nByte hash[EVP_MAX_MD_SIZE];\nunsigned int hashLen = EVP_MAX_MD_SIZE;\nEVP_MD_CTX mdctx;\nEVP_MD_CTX_init(&amp;mdctx);\nEVP_DigestInit_ex(&amp;mdctx, EVP_dss1(), NULL);\nEVP_DigestUpdate(&amp;mdctx, data, dataLen);\nEVP_DigestFinal_ex(&amp;mdctx, hash, &amp;hashLen);\nEVP_MD_CTX_cleanup(&amp;mdctx);\n\nByte signatur[1024];\nmemset(signatur, 0, 1024);\nchar buf[200];\nshort fehler = 0;\nsignaturLen = DSA_size(dsa);\nfehler = !DSA_sign(0, hash, hashLen, signatur, &amp;signaturLen, dsa);\nif (fehler) {\n  ps(\"FEHLER: signieren gescheitert\");\n  ps(ERR_error_string(ERR_get_error(), buf));\n}\n\n// do something with signatur\n\nDSA_free(dsa);\n}\n</code></pre>\n\n<p>and it worked as expected. how do I achieve this with golang? I tried</p>\n\n<pre><code>func (s SignConfig) ReadPrivateKey() (*rsa.PrivateKey, error) {\n  b, e := ioutil.ReadFile(filepath.Join(core.ConfigDir(), s.PrivateKey))\n  if e != nil {\n    return nil, e\n  }\n\n  block, _ := pem.Decode(b)\n  b, e = x509.DecryptPEMBlock(block, []byte(s.PassPhrase))\n  priv, e := x509.ParsePKCS1PrivateKey(b)\n\n  if e != nil {\n    return nil, e\n  }\n\n  return priv, nil\n}\n</code></pre>\n\n<p>to read the private key, but I got <code>asn1.StructuralError{Msg:\"integer too large\"}</code></p>\n"}, {"tags": ["go", "google-api", "google-calendar-api", "google-oauth", "service-accounts"], "comments": [{"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 0, "creation_date": 1475841561, "post_id": 39916650, "comment_id": 67117370, "body": "So what you want to know how to get service account authentication to work with GO? or you want to know how to make a request in Go to Google Calendar using an access token gotten from the PHP authentication process?"}, {"owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "reply_to_user": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 0, "creation_date": 1475843366, "post_id": 39916650, "comment_id": 67118541, "body": "I want (1) my Go app to be identified as the Google account ID used by my PHP app. The same that my users share their calendar with. This is to avoid them having to re-share their calendar with another ID. And (2) use any key to access the calendars. Sorry if this is not clear, but the whole Google API looks like black magic to me. Could get it work once with PHP using the <a href=\"https://developers.google.com/google-apps/calendar/v3/reference/calendarList/get\" rel=\"nofollow noreferrer\">examples</a> from Google, but no examples scripts yet for Go."}, {"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 0, "creation_date": 1475843552, "post_id": 39916650, "comment_id": 67118652, "body": "It is a bit like black magic until you get the hang of it.  The thing is if you are using a service account then users aren&#39;t approving anything really.  If you want access to their accounts you should probably be using Oauth2"}, {"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 1, "creation_date": 1475843946, "post_id": 39916650, "comment_id": 67118900, "body": "Note: I do not have the power of Go. But do have Google API black magic powers.   How about this <a href=\"http://stackoverflow.com/q/15374625/1841839\">stackoverflow.com/q/15374625/1841839</a>"}, {"owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "reply_to_user": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 0, "creation_date": 1475844238, "post_id": 39916650, "comment_id": 67119084, "body": "I thought that I was already using Oaut2 in my PHP app. I that p12 key file not generated in the Oauth2 creation process? Anyway, what should I do to access the calendar of my users that are already shared with my Account Key <code>******@developer.gservice.com</code>? I am nowhere in that project due to my lack of knowledge of the Google API but I am tenacious!"}, {"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 0, "creation_date": 1475844339, "post_id": 39916650, "comment_id": 67119146, "body": "You said uses a binary p12 that&#39;s only used with service account credentials.     You will need to switch to Oauth2 and have the user authenticate your application or stick with using service account.   Its just going to be hard IMO to keep track of who is who with that service account sharing of calendars."}, {"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 1, "creation_date": 1475844432, "post_id": 39916650, "comment_id": 67119199, "body": "Here is my article on service accounts <a href=\"http://www.daimto.com/google-developer-console-service-account/\" rel=\"nofollow noreferrer\">daimto.com/google-developer-console-service-account</a>  vs Oauth2 <a href=\"http://www.daimto.com/google-developer-console-oauth2/\" rel=\"nofollow noreferrer\">daimto.com/google-developer-console-oauth2</a>"}, {"owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "reply_to_user": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 1, "creation_date": 1475858373, "post_id": 39916650, "comment_id": 67127814, "body": "After reading your interesting blog, I now understand that I definitely need to access my user&#39;s calendar with a Google Developer console service account. I will investigate how to do that in Go. Thanks a lot for your input. JL"}], "owner": {"reputation": 2714, "user_id": 752297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/lDqC1.jpg?s=128&g=1", "display_name": "ripat", "link": "https://stackoverflow.com/users/752297/ripat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 683, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475841603, "creation_date": 1475841284, "last_edit_date": 1475841603, "question_id": 39916650, "link": "https://stackoverflow.com/questions/39916650/go-and-google-calendar-api", "title": "Go and google calendar api", "body": "<p>I want to rewrite in Go a PHP app that read/write events to and from my user's calendars. That app uses an API service account key looking like this: <code>207000******-***********@developer.gserviceaccount.com</code>. My PHP script also uses a binary p12 key to access the user's calendars that have granted r/w access to these credentials.</p>\n\n<p>I want to reuse these credentials in my Go app. I have been googling around to find a easy Go howto, step by step kind of thing, unsuccessfully so far.</p>\n\n<p>I could get the <a href=\"https://developers.google.com/drive/v3/web/quickstart/go\" rel=\"nofollow\">quickstart.go</a> to work with a new \nclient ID (it produces a list of the events from my own calendar). And I am stuck there. I need some examples and/or step by step directions.</p>\n\n<p>Can someone point me in the right direction?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1475836840, "post_id": 39915246, "comment_id": 67114591, "body": "I&#39;m getting the following Error:  <code>cannot use stdout (type []byte) as type io.Reader in argument to bufio.NewScanner: \t[]byte does not implement io.Reader (missing Read method)</code>"}, {"owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1475843869, "post_id": 39915246, "comment_id": 67118850, "body": "I&#39;m getting the output, but not with proper alignment."}, {"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "reply_to_user": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1476082643, "post_id": 39915246, "comment_id": 67185398, "body": "What do You mean by alignment? You get every line in a slice of strings &quot;a&quot; and you can get every line with a[lineNumber]."}, {"owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1476274279, "post_id": 39915246, "comment_id": 67274238, "body": "Thank you kingSlayer, it was very useful."}], "tags": [], "owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "is_accepted": true, "score": 2, "last_activity_date": 1475836598, "creation_date": 1475836598, "answer_id": 39915246, "question_id": 39915045, "link": "https://stackoverflow.com/questions/39915045/in-golang-im-getting-the-record-through-exe-command-how-to-print-it-line-by-li/39915246#39915246", "title": "In Golang I&#39;m getting the record through exe command. how to print it line by line?", "body": "<p>It is simple:</p>\n\n<pre><code>a := []string{}\nfor s.Scan() {       \n    a = append(a, s.Text())\n}\n</code></pre>\n\n<p>And You have a slice of strings.</p>\n"}], "owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 39915246, "answer_count": 1, "score": 1, "last_activity_date": 1475836598, "creation_date": 1475835890, "question_id": 39915045, "link": "https://stackoverflow.com/questions/39915045/in-golang-im-getting-the-record-through-exe-command-how-to-print-it-line-by-li", "title": "In Golang I&#39;m getting the record through exe command. how to print it line by line?", "body": "<p>I want to print the results line by line.</p>\n\n<p>I'm getting the record's data through exe command.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n\"bufio\"\n\"fmt\"\n\"os/exec\"\n)\n\nfunc main() {\napp := \"df\"\n//app := \"buah\"\n\narg0 := \"-h\"\n\ncmd := exec.Command(app, arg0)\nstdout, err := cmd.Output()\n\nif err != nil {\n    println(err.Error())\n    return\n}\n\n// bytes, _ := ioutil.ReadAll(stdout)\n\ns := bufio.NewScanner(stdout)\n\nfmt.Println(s)\n\n}\n</code></pre>\n\n<p>Thanks in advance.\nAny help is greatly appreciated.</p>\n"}, {"tags": ["go", "slice", "variadic-functions"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1475855482, "last_edit_date": 1592644375, "creation_date": 1475836810, "answer_id": 39915311, "question_id": 39914447, "link": "https://stackoverflow.com/questions/39914447/unpacking-slice-of-slices/39915311#39915311", "title": "Unpacking slice of slices", "body": "<p>This is covered in <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">Spec: Passing arguments to ... parameters</a>:</p>\n<blockquote>\n<p>If <code>f</code> is variadic with a final parameter <code>p</code> of type <code>...T</code>, then within <code>f</code> the type of <code>p</code> is equivalent to type <code>[]T</code>.</p>\n<p>...</p>\n<p><strong>If the final argument is assignable to a slice type <code>[]T</code>, it may be passed unchanged as the value for a <code>...T</code> parameter if the argument is followed by <code>...</code>.</strong> In this case no new slice is created.</p>\n</blockquote>\n<p><strong>So in short:</strong> it is a compile-time error because <code>sliceOfSlices</code> (which is of type <code>[][]interface{}</code>) cannot be assigned to <code>args</code> (which is of type <code>[]interface{}</code>) (<a href=\"https://play.golang.org/p/Pu2Zo9_kIl\" rel=\"noreferrer\">proof on Playground</a>).</p>\n<p><strong>In long:</strong></p>\n<p>In your first example when you do <code>unpack(slice)</code>, since <code>unpack()</code> expects values of <code>interface{}</code>, therefore <code>slice</code> (which is of type <code>[]interface{}</code>) will be wrapped in a <em>new</em> <code>interface{}</code> value, and it will be passed as a <em>single</em> argument.</p>\n<p>When you do <code>unpack(slice...)</code>, this will pass all the values of <code>slice</code> as separate values to <code>unpack()</code>; this is possible because type of <code>slice</code> is <code>[]interface{}</code>, it matches the type of the variadic parameter (<code>args ...interface{}</code>).</p>\n<p>In your second example when you do <code>unpack(sliceOfSlices)</code>, again, <code>sliceOfSlices</code> will be wrapped in a <em>new</em> <code>interface{}</code> value and passed as a <em>single</em> argument.</p>\n<p>But when you try <code>unpack(sliceOfSlices...)</code>, that would want to pass each element of <code>sliceOfSlices</code> to <code>unpack()</code>, but type of <code>sliceOfSlices</code> (which is <code>[][]interface{}</code>) does not match the type of the variadic parameter, hence the compile-time error.</p>\n<p>The only way to pass <code>sliceOfSlices</code> to <code>unpack()</code> &quot;exploded&quot; is to create a new slice whose type must be <code>[]interface{}</code>, copy the elements, then you can pass it using <code>...</code>.</p>\n<p>Example:</p>\n<pre><code>var sliceOfSlices2 []interface{}\nfor _, v := range sliceOfSlices {\n    sliceOfSlices2 = append(sliceOfSlices2, v)\n}\n\nunpack(sliceOfSlices2...)\n</code></pre>\n<p>Try it on the <a href=\"https://play.golang.org/p/0mc2V5PSoD\" rel=\"noreferrer\">Go Playground</a>.</p>\n<p>Let's use the following <code>unpack()</code> function to verify the number of arguments:</p>\n<pre><code>func unpack(args ...interface{}) {\n    fmt.Println(len(args))\n}\n</code></pre>\n<p>Running your example (and with my new slice creation), output is:</p>\n<pre><code>1\n3\n1\n2\n</code></pre>\n<p>Which proves without <code>...</code> only a single argument is passed (wrapped in <code>interface{}</code>), and using <code>...</code> all elements will be passed separately.</p>\n<p>Try this test on the <a href=\"https://play.golang.org/p/s95l3ERKpB\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1046, "user_id": 1212463, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2f71fd74e5a4d487a4db70e4039d655b?s=128&d=identicon&r=PG", "display_name": "lmazgon", "link": "https://stackoverflow.com/users/1212463/lmazgon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 912, "favorite_count": 1, "accepted_answer_id": 39915311, "answer_count": 1, "score": 4, "last_activity_date": 1475855482, "creation_date": 1475834142, "question_id": 39914447, "link": "https://stackoverflow.com/questions/39914447/unpacking-slice-of-slices", "title": "Unpacking slice of slices", "body": "<p>I am curious about unpacking a slice of slices and sending them as arguments to a variadic function.</p>\n\n<p>Let's say we have a function with variadic parameters:</p>\n\n<pre><code>func unpack(args ...interface{})\n</code></pre>\n\n<p>If we wan't to pass in a slice of interfaces it works, it doesn't matter if we unpack it or not:</p>\n\n<pre><code>slice := []interface{}{1,2,3}\nunpack(slice) // works\nunpack(slice...) // works\n</code></pre>\n\n<p>It gets tricky if we have a slice of slices. Here the compiler doesn't let us pass in an unpacked version:</p>\n\n<pre><code>sliceOfSlices := [][]interface{}{\n    []interface{}{1,2},\n    []interface{}{101,102},\n}\nunpack(sliceOfSlices) // works\nunpack(sliceOfSlices...) // compiler error\n</code></pre>\n\n<p>The error says:</p>\n\n<blockquote>\n  <p>cannot use sliceOfSlices (type [][]interface {}) as type []interface {} in argument to unpack</p>\n</blockquote>\n\n<p>I don't know why this happens, as we can clearly pass an <code>[]interface{}</code> type into the function. How can I call the method unpack with the unpacked content of <code>sliceOfSlices</code> as arguments?</p>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/O3AYba8h4i\">https://play.golang.org/p/O3AYba8h4i</a></p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 728, "user_id": 1407544, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/15af6c9f81387924f91fd65a8bd13951?s=128&d=identicon&r=PG", "display_name": "Redwan", "link": "https://stackoverflow.com/users/1407544/redwan"}, "is_accepted": false, "score": 0, "last_activity_date": 1475835635, "creation_date": 1475835635, "answer_id": 39914943, "question_id": 39914425, "link": "https://stackoverflow.com/questions/39914425/golang-unmarshal-json/39914943#39914943", "title": "Golang Unmarshal JSON", "body": "<p>Your response json is invalid. You use array instead of structure with fields specified in type D.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475845946, "last_edit_date": 1475845946, "creation_date": 1475837438, "answer_id": 39915468, "question_id": 39914425, "link": "https://stackoverflow.com/questions/39914425/golang-unmarshal-json/39915468#39915468", "title": "Golang Unmarshal JSON", "body": "<p>1- Here is the working code,try it on <a href=\"https://play.golang.org/p/yr6RK_wdm7\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var d *R\n    err := json.Unmarshal([]byte(str), &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    var data R2\n    data.Count = int(d.Response[0].(float64))\n\n    for _, v := range d.Response[1:] {    \n        bs, err := json.Marshal(v)\n        if err != nil {\n            panic(err)\n        }\n        var d1 *D\n        err = json.Unmarshal(bs, &amp;d1)\n        if err != nil {\n            panic(err)\n        }\n        data.Response = append(data.Response, *d1)\n    }\n    fmt.Println(data)    \n}\n\ntype R struct {\n    Response []interface{} `json:\"response\"`\n}\n\nvar str = ` {\n  \"response\": [\n    777,  \n    {\n      \"id\": 888,\n      \"from_id\": 999,\n      \"to_id\": 888,\n      \"text\": \"hello\"\n    },\n        {\n      \"id\": 999,\n      \"from_id\": 888,\n      \"to_id\": 999,\n            \"text\": \"goodbye\"\n    }\n  ]\n}`\n\ntype D struct {\n    Id     int    `json:\"id\"`\n    FromId int    `json:\"from_id\"`\n    ToId   int    `json:\"to_id\"`\n    Text   string `json:\"text\"`\n}\ntype R2 struct {\n    Count    int\n    Response []D\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{777 [{888 999 888 hello} {999 888 999 goodbye}]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1476138884, "creation_date": 1476138884, "answer_id": 39967773, "question_id": 39914425, "link": "https://stackoverflow.com/questions/39914425/golang-unmarshal-json/39967773#39967773", "title": "Golang Unmarshal JSON", "body": "<p>I have a different approach: <a href=\"https://play.golang.org/p/9Xnxk7tVxE\" rel=\"nofollow\">https://play.golang.org/p/9Xnxk7tVxE</a></p>\n\n<p>All you have to do is implement the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow\">Unmarshaler</a> interface and add the logic inside the method UnmarshalJSON. It's a similar solution to the other one, but it's more portable since you don't have to do that in the main or external method and it's little more robust :)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nvar j = `{\n  \"response\": [\n    777,\n    {\n      \"id\": 888,\n      \"from_id\": 999,\n      \"to_id\": 888,\n      \"text\": \"hello...\"\n    },\n    {\n      \"id\": 999,\n      \"from_id\": 888,\n      \"to_id\": 999,\n            \"text\": \"goodbye...\"\n    }\n  ]\n}`\n\ntype D struct {\n    Id     int    `json:\"id\"`\n    FromId int    `json:\"from_id\"`\n    ToId   int    `json:\"to_id\"`\n    Text   string `json:\"text\"`\n}\n\ntype R struct {\n    Count    int\n    Response []D\n}\n\nfunc (r *R) UnmarshalJSON(data []byte) error {\n    var values struct {\n        Resp []interface{} `json:\"response\"`\n    }\n\n    if err := json.Unmarshal(data, &amp;values); err != nil {\n        return err\n    }\n\n    if len(values.Resp) &lt; 1 {\n        return fmt.Errorf(\"empty response %v\", values.Resp)\n    }\n\n    count, isNumber := values.Resp[0].(float64)\n    if !isNumber {\n        return fmt.Errorf(\"first element has to be a number, we got '%T'\", values.Resp[0])\n    }\n    r.Count = int(count)\n\n    for _, elem := range values.Resp[1:] {\n        de, err := json.Marshal(elem)\n        if err != nil {\n            return err\n        }\n        var d D\n        if err := json.Unmarshal(de, &amp;d); err != nil {\n            return err\n        }\n        r.Response = append(r.Response, d)\n    }\n    return nil\n}\n\nfunc main() {\n    var data = new(R)\n    if err := json.Unmarshal([]byte(j), &amp;data); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(*data)\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5738304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f90d3e197eae853bc7134a3159c9aa5d?s=128&d=identicon&r=PG&f=1", "display_name": "topas", "link": "https://stackoverflow.com/users/5738304/topas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 1, "accepted_answer_id": 39915468, "answer_count": 3, "score": 2, "last_activity_date": 1476138884, "creation_date": 1475834084, "last_edit_date": 1475882751, "question_id": 39914425, "link": "https://stackoverflow.com/questions/39914425/golang-unmarshal-json", "title": "Golang Unmarshal JSON", "body": "<p>My input JSON, has a list of different elements.<br>\nI have problems with the number of the first element of response.</p>\n\n<p><a href=\"https://play.golang.org/p/jpOS88Isun\" rel=\"nofollow\">Simplified example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"encoding/json\"\n)\n\nvar j = ` {\n  \"response\": [\n    777, // problem here !!!\n    {\n      \"id\": 888,\n      \"from_id\": 999,\n      \"to_id\": 888,\n      \"text\": \"hello...\"\n    },\n        {\n      \"id\": 999,\n      \"from_id\": 888,\n      \"to_id\": 999,\n            \"text\": \"goodbye...\"\n    }\n  ]\n}`\n\ntype D struct {\n    Id     int `json:\"id\"`\n    FromId int `json:\"from_id\"`\n    ToId   int `json:\"to_id\"`\n    Text   string `json:\"text\"`\n}\n\ntype R struct {\n    Count    int\n    Response []D `json:\"response\"`\n}\n\nfunc main() {\n    var data = new(R)\n    err := json.Unmarshal([]byte(j), &amp;data)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(data.Response)\n}\n</code></pre>\n\n<p>Error on output. I do not understand where the error. Help me please.</p>\n\n<hr>\n"}, {"tags": ["go", "stomp", "apollo"], "answers": [{"tags": [], "owner": {"reputation": 6338, "user_id": 641170, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/mc98F.jpg?s=128&g=1", "display_name": "Rudy", "link": "https://stackoverflow.com/users/641170/rudy"}, "is_accepted": true, "score": 1, "last_activity_date": 1476071227, "creation_date": 1476071227, "answer_id": 39951033, "question_id": 39914161, "link": "https://stackoverflow.com/questions/39914161/how-to-solve-go-stomp-read-timeout/39951033#39951033", "title": "How to solve Go-Stomp read timeout", "body": "<p>Solved by adding these lines :</p>\n\n<p>in Apollo, noticed that the queue deleted after being empty after several secs, so put auto_delete_after to several hours in apollo.xml , eg :</p>\n\n<pre><code>&lt;queue id=\"hflc-in\" dlq=\"dlq-in\" nak_limit=\"3\" auto_delete_after=\"7200\"/&gt;\n&lt;queue id=\"hflc-log\" dlq=\"dlq-log\" nak_limit=\"3\" auto_delete_after=\"7200\"/&gt;\n&lt;queue id=\"hflc-out\" dlq=\"dlq-out\" nak_limit=\"3\" auto_delete_after=\"7200\"/&gt;\n</code></pre>\n\n<p>in Go, noticed that go-stomp will just give up right after it can't found any message in queue, so in the conn options, add HeartBeat Error</p>\n\n<pre><code>var options []func(*stomp.Conn) error = []func(*stomp.Conn) error{\n   //.... original configuration\n   stomp.ConnOpt.HeartBeatError(360 * time.Second),\n}\n</code></pre>\n\n<p>However still confused about the question no 2.</p>\n"}], "owner": {"reputation": 6338, "user_id": 641170, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/mc98F.jpg?s=128&g=1", "display_name": "Rudy", "link": "https://stackoverflow.com/users/641170/rudy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1474, "favorite_count": 0, "accepted_answer_id": 39951033, "answer_count": 1, "score": 1, "last_activity_date": 1476071227, "creation_date": 1475833302, "last_edit_date": 1476067655, "question_id": 39914161, "link": "https://stackoverflow.com/questions/39914161/how-to-solve-go-stomp-read-timeout", "title": "How to solve Go-Stomp read timeout", "body": "<p>Try subscribing ActiveMQ(Apollo) using Go-Stomp, but I am having read timeout error. My app should be alive 24 hours per day to process incoming message.</p>\n\n<p><strong>Question</strong> : </p>\n\n<ol>\n<li>Is there a way to keep the subcription although there is no more message exist in the queue? Trying to put ConnOpt.HeartBeat also does not seems to work</li>\n<li>Why after the readTimeout, it seems that I still accept one more message ?</li>\n</ol>\n\n<p>Below is my steps :</p>\n\n<ul>\n<li>I put 1000 messages for testing in the inputQueue </li>\n<li>Run a subscriber, code provided below  </li>\n<li>Subscriber finished reading 1000 messages After 2-3 seconds, saw error \" 2016/10/07 17:12:44 Subscription 1: /queue/hflc-in: ERROR message:read timeout\".  </li>\n<li>Put another 1000 messages, but it seems the subscription is already down, therefore no message is not being processed</li>\n</ul>\n\n<p>My Code :</p>\n\n<pre><code>  var(\n   serverAddr   = flag.String(\"server\", \"10.92.10.10:61613\", \"STOMP server    endpoint\")\n   messageCount = flag.Int(\"count\", 10, \"Number of messages to send/receive\")\n   inputQ       = flag.String(\"inputq\", \"/queue/hflc-in\", \"Input queue\")\n)\n\nvar options []func(*stomp.Conn) error = []func(*stomp.Conn) error{\n   stomp.ConnOpt.Login(\"userid\", \"userpassword\"),\n   stomp.ConnOpt.Host(\"mybroker\"),\n   stomp.ConnOpt.HeartBeat(360*time.Second, 360*time.Second), // I put this but seems no impact\n}\n\nfunc main() {\n  flag.Parse()\n  jobschan := make(chan bean.Request, 10)\n  //my init setup\n  go getInput(1, jobschan)\n}\n\nfunc getInput(id int, jobschan chan bean.Request) {\n   conn, err := stomp.Dial(\"tcp\", *serverAddr, options...)\n\n   if err != nil {\n      println(\"cannot connect to server\", err.Error())\n      return\n   }\n   fmt.Printf(\"Connected %v \\n\", id)\n\n   sub, err := conn.Subscribe(*inputQ, stomp.AckClient)\n   if err != nil {\n     println(\"cannot subscribe to\", *inputQ, err.Error())\n     return\n   }\n\n   fmt.Printf(\"Subscribed %v \\n\", id)\n   var messageCount int\n   for {\n    msg := &lt;-sub.C\n    //expectedText := fmt.Sprintf(\"Message #%d\", i)\n    if msg != nil {\n\n        actualText := string(msg.Body)\n\n        var req bean.Request\n        if actualText != \"SHUTDOWN\" {\n            messageCount = messageCount + 1\n            var err2 = easyjson.Unmarshal([]byte(actualText), &amp;req)\n            if err2 != nil {\n                log.Error(\"Unable unmarshall\", zap.Error(err))\n                println(\"message body %v\", msg.Body) // what is [0/0]0x0 ?\n            } else {\n                fmt.Printf(\"Subscriber %v received message, count %v \\n  \", id, messageCount)\n                jobschan &lt;- req\n            }\n        } else {\n            logchan &lt;- \"got some issue\"\n        }\n    }\n   }\n  }\n</code></pre>\n\n<p>Error :</p>\n\n<blockquote>\n  <p>2016/10/07 17:12:44 Subscription 1: /queue/hflc-in: ERROR message:read timeout<br>\n  [E] 2016-10-07T09:12:44Z Unable unmarshall<br>\n  message body %v [0/0]0x0              </p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "is_accepted": true, "score": 4, "last_activity_date": 1475830977, "last_edit_date": 1592644375, "creation_date": 1475830977, "answer_id": 39913430, "question_id": 39913328, "link": "https://stackoverflow.com/questions/39913328/import-statement-location/39913430#39913430", "title": "Import statement location", "body": "<p>Because the <a href=\"https://golang.org/ref/spec#Source_file_organization\" rel=\"nofollow noreferrer\">spec</a> defines it like that:</p>\n<blockquote>\n<p>Each source file consists of a package clause defining the package to which it belongs, followed by a possibly empty set of import declarations that declare packages whose contents it wishes to use, followed by a possibly empty set of declarations of functions, types, variables, and constants.</p>\n<p><code>SourceFile       = PackageClause &quot;;&quot; { ImportDecl &quot;;&quot; } { TopLevelDecl &quot;;&quot; } .</code></p>\n</blockquote>\n<p>Which means you need to put your <code>import</code> statements before any other declaration.</p>\n"}], "owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 39913430, "answer_count": 1, "score": 0, "last_activity_date": 1475830977, "creation_date": 1475830609, "question_id": 39913328, "link": "https://stackoverflow.com/questions/39913328/import-statement-location", "title": "Import statement location", "body": "<p>I am not able to understand why this error is coming and not able to find explanation wherever i have searched. </p>\n\n<p>On running </p>\n\n<pre><code>package main\n\nvar a = 23\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>I am getting this error</p>\n\n<pre><code># command-line-arguments\n./test.go:5: syntax error: non-declaration statement outside function body\n</code></pre>\n\n<p>I understand that if i keep import just after package declaration it works  fine. What i am not able to understand is WHY import needs to be after package declaration and not this way.</p>\n"}, {"tags": ["web", "go", "request"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475849823, "post_id": 39913185, "comment_id": 67122596, "body": "this was cross-posted at: <a href=\"https://groups.google.com/d/topic/golang-nuts/lgMQFn2INaQ/discussion\" rel=\"nofollow noreferrer\">groups.google.com/d/topic/golang-nuts/lgMQFn2INaQ/discussion</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": false, "score": 1, "last_activity_date": 1475834223, "last_edit_date": 1489747555, "creation_date": 1475834223, "answer_id": 39914468, "question_id": 39913185, "link": "https://stackoverflow.com/questions/39913185/listen-to-outgoing-http-https-requests-in-golang/39914468#39914468", "title": "Listen to outgoing http/https requests in GoLang", "body": "<p>Techniques for \"getting every request\" off a computer will vary a bit if your intent is to trap things that don't use common HTTP proxy settings (and things get a bit weird if <a href=\"https://security.stackexchange.com/q/8145\">SSL/TLS is involved</a>, which on the modern Internet it almost assuredly is).  So let's ignore the complications of trying to actually get an unencrypted channel to MitM...</p>\n\n<p>Assuming you're writing a simple HTTP proxy at first and expanding on that, try <a href=\"https://github.com/elazarl/goproxy\" rel=\"nofollow noreferrer\">GoProxy</a>.  It has a good list of examples and a decent feature list.</p>\n"}], "owner": {"reputation": 1, "user_id": 5909940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf5a8c8fecbf060d3b9de34398aaf182?s=128&d=identicon&r=PG&f=1", "display_name": "MicroDev", "link": "https://stackoverflow.com/users/5909940/microdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475834223, "creation_date": 1475830138, "last_edit_date": 1475831512, "question_id": 39913185, "link": "https://stackoverflow.com/questions/39913185/listen-to-outgoing-http-https-requests-in-golang", "title": "Listen to outgoing http/https requests in GoLang", "body": "<p>I'm trying to make a GoLang program, that logs every outgoing http/https request when it runs on the computer, for example, when it's running it on my computer, when I open a browser and open <a href=\"http://example.com\" rel=\"nofollow\">http://example.com</a>, it logs it.\nAn appreciated extra would be a way to redirect some unwanted website requests (like a parental control)</p>\n\n<p>I've been trying and looking all around and it seems that all the examples out there consider the computer where the Go exe is running as a server.. That's not what I want</p>\n\n<p>Thank you very much</p>\n"}, {"tags": ["go", "web-applications", "pug", "template-engine"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 1, "creation_date": 1475823369, "post_id": 39909244, "comment_id": 67106911, "body": "You&#39;re looking to this <a href=\"https://github.com/Joker/jade\" rel=\"nofollow noreferrer\">github.com/Joker/jade</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": false, "score": 0, "last_activity_date": 1475827729, "last_edit_date": 1495542649, "creation_date": 1475827729, "answer_id": 39912468, "question_id": 39909244, "link": "https://stackoverflow.com/questions/39909244/in-golang-web-application-development-is-it-possible-to-use-gos-template-with/39912468#39912468", "title": "In Golang web application development, is it possible to use Go&#39;s template with the jade (pug) template engine?", "body": "<p>The hard way would be to have a separated nodejs process to compile the template on the go. The easy way would be, like <a href=\"https://stackoverflow.com/users/6452829/mario-alexandro-santini\">@Mario</a> said, to use a golang implementation of jade engine.</p>\n\n<p>Take a look at <a href=\"https://github.com/Joker/jade\" rel=\"nofollow noreferrer\">this library</a> and the <a href=\"https://godoc.org/github.com/Joker/jade\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 1849571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16ed4d41a5f244d1b10de1b791657989?s=128&d=identicon&r=PG", "display_name": "Eduard Urbach", "link": "https://stackoverflow.com/users/1849571/eduard-urbach"}, "is_accepted": false, "score": 1, "last_activity_date": 1559955545, "last_edit_date": 1559955545, "creation_date": 1558700977, "answer_id": 56292726, "question_id": 39909244, "link": "https://stackoverflow.com/questions/39909244/in-golang-web-application-development-is-it-possible-to-use-gos-template-with/56292726#56292726", "title": "In Golang web application development, is it possible to use Go&#39;s template with the jade (pug) template engine?", "body": "<p><a href=\"https://github.com/aerogo/pixy\" rel=\"nofollow noreferrer\">pixy</a> is very similar to Pug / Jade and offers a code generator via <a href=\"https://github.com/aerogo/pack\" rel=\"nofollow noreferrer\">pack</a> to achieve very high performance with Go type-safety.</p>\n"}], "owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 953, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1559955545, "creation_date": 1475813391, "question_id": 39909244, "link": "https://stackoverflow.com/questions/39909244/in-golang-web-application-development-is-it-possible-to-use-gos-template-with", "title": "In Golang web application development, is it possible to use Go&#39;s template with the jade (pug) template engine?", "body": "<p>I'm developing Go web application and using Go's built-in template. I can use <code>Emmet</code> to quickly generate HTML code snippets. However, I do prefer the succinct <a href=\"https://github.com/pugjs/pug\" rel=\"nofollow\"><code>jade</code> template engine</a> (renamed to pug recently). I want to know if it possible to use <code>jade (pug)</code> with Go and how to set it up. Thanks in advance. </p>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "is_accepted": false, "score": 1, "last_activity_date": 1475827634, "last_edit_date": 1475827634, "creation_date": 1475812559, "answer_id": 39909121, "question_id": 39908955, "link": "https://stackoverflow.com/questions/39908955/golang-regex-get-value-inside-parentheses/39909121#39909121", "title": "Golang regex get value inside parentheses", "body": "<p>I got My problem solved by this regex </p>\n\n<pre><code>r := regexp.MustCompile(`\\((.*?)\\)`)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "edited": false, "score": 0, "creation_date": 1475923451, "post_id": 39913100, "comment_id": 67145184, "body": "Hey, thx. yes for my program the speed of execution is really matters :)"}, {"owner": {"reputation": 193, "user_id": 2125771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb05100f7343572ef77f2a0cf8302cb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/2125771/matt"}, "edited": false, "score": 2, "creation_date": 1508535028, "post_id": 39913100, "comment_id": 80662840, "body": "The match function has a typo in the return - it produces a slice bounds out of range error at runtime. It should be return s[i+1 : <b>j+i</b>]    <code>func match(s string) string {       i := strings.Index(s, &quot;(&quot;)       if i &gt;= 0 {           j := strings.Index(s[i:], &quot;)&quot;)           if j &gt;= 0 {               return s[i+1 : j+i]           }       }       return &quot;&quot;   }</code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 12, "last_activity_date": 1601008885, "last_edit_date": 1601008885, "creation_date": 1475829866, "answer_id": 39913100, "question_id": 39908955, "link": "https://stackoverflow.com/questions/39908955/golang-regex-get-value-inside-parentheses/39913100#39913100", "title": "Golang regex get value inside parentheses", "body": "<p>1- While it is simple using regex (try it on <a href=\"https://play.golang.org/p/nun3TQwyBk\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;regexp&quot;\n)\n\nvar rgx = regexp.MustCompile(`\\((.*?)\\)`)\n\nfunc main() {\n    s := `(tag)SomeText`\n    rs := rgx.FindStringSubmatch(s)\n    fmt.Println(rs[1])\n}\n</code></pre>\n<p>output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>tag\n</code></pre>\n<hr />\n<p>2- but sometimes using <code>strings.Index</code> is fast enough (try it on <a href=\"https://play.golang.org/p/ufHGIwxp6ki\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;strings&quot;\n)\n\nfunc match(s string) string {\n    i := strings.Index(s, &quot;(&quot;)\n    if i &gt;= 0 {\n        j := strings.Index(s, &quot;)&quot;)\n        if j &gt;= 0 {\n            return s[i+1 : j]\n        }\n    }\n    return &quot;&quot;\n}\n\nfunc main() {\n    s := `Some(tag)Text`\n    r := match(s)\n    fmt.Println(r)\n\n}\n</code></pre>\n<p>output:</p>\n<pre><code>tag\n</code></pre>\n<hr />\n<p>3- This simple benchmark shows using regex takes 931ms and using <code>strings.Index</code> takes 43ms for 1000000 iterations.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;regexp&quot;\n    &quot;strings&quot;\n    &quot;time&quot;\n)\n\nvar rgx = regexp.MustCompile(`\\((.*?)\\)`)\n\nconst n = 1000000\n\nfunc main() {\n    var rs []string\n    var r string\n    s := `(tag)SomeText`\n    t := time.Now()\n    for i := 0; i &lt; n; i++ {\n        rs = rgx.FindStringSubmatch(s)\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(rs[1]) // [(tag) tag]\n\n    t = time.Now()\n    for i := 0; i &lt; n; i++ {\n        r = match(s)\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(r)\n\n}\n\nfunc match(s string) string {\n    i := strings.Index(s, &quot;(&quot;)\n    if i &gt;= 0 {\n        j := strings.Index(s, &quot;)&quot;)\n        if j &gt;= 0 {\n            return s[i+1 : j]\n        }\n    }\n    return &quot;&quot;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 6513756, "user_type": "registered", "profile_image": "https://graph.facebook.com/1234625596547746/picture?type=large", "display_name": "Hyun Seok Jeong", "link": "https://stackoverflow.com/users/6513756/hyun-seok-jeong"}, "is_accepted": false, "score": 0, "last_activity_date": 1596074003, "creation_date": 1596074003, "answer_id": 63164992, "question_id": 39908955, "link": "https://stackoverflow.com/questions/39908955/golang-regex-get-value-inside-parentheses/63164992#63164992", "title": "Golang regex get value inside parentheses", "body": "<p>Refer to answers, I made my version of the code.\nlink: <a href=\"https://play.golang.org/p/b82iPZGU1gw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/b82iPZGU1gw</a></p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;strings&quot;\n)\n\nfunc match(start, end, s string) string {\n    i := strings.Index(s, start)\n    if i &gt;= 0 {\n        j := strings.Index(s[i:], end)\n        if j &gt;= 0 {\n            return s[i+len(start) : i+j]\n        }\n    }\n    return &quot;&quot;\n}\n\nfunc main() {\n    errText := `facebook: Error validating access token: Session has expired on Tuesday, 28-Jul-20 22:00:00 PDT. The current time is Wednesday, 29-Jul-20 17:55:22 PDT. (code: 190; error_subcode: 463, error_user_title: , error_user_msg: )`\n    start := &quot;code: &quot;\n    end := &quot;;&quot;\n    r := match(start, end, errText)\n    fmt.Println(r)\n}\n</code></pre>\n"}], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13035, "favorite_count": 1, "accepted_answer_id": 39913100, "answer_count": 3, "score": 6, "last_activity_date": 1601008885, "creation_date": 1475811378, "last_edit_date": 1475829954, "question_id": 39908955, "link": "https://stackoverflow.com/questions/39908955/golang-regex-get-value-inside-parentheses", "title": "Golang regex get value inside parentheses", "body": "<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    r := regexp.MustCompile(`((.*))`)\n    s := `(tag)SomeText`\n\n    res := r.FindStringSubmatch(s)\n    fmt.Println(res[1])\n}\n</code></pre>\n\n<p>How to Get Value inside parentheses?</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 2301, "user_id": 6809935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Achu.jpg?s=128&g=1", "display_name": "satish chennupati", "link": "https://stackoverflow.com/users/6809935/satish-chennupati"}, "edited": false, "score": 1, "creation_date": 1475811262, "post_id": 39908192, "comment_id": 67102913, "body": "can you post how your document looks like ? from what i am seeing your approach is wrong because $add is something that you use with aggregation, you cannot simply use it with normal CRUD queries."}, {"owner": {"reputation": 2041, "user_id": 5824483, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1045400122183130/picture?type=large", "display_name": "Amulya Kashyap", "link": "https://stackoverflow.com/users/5824483/amulya-kashyap"}, "edited": false, "score": 1, "creation_date": 1475814778, "post_id": 39908192, "comment_id": 67103761, "body": "you cannot use $add normally.... it&#39;s only for aggregation part dude"}], "answers": [{"tags": [], "owner": {"reputation": 2301, "user_id": 6809935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Achu.jpg?s=128&g=1", "display_name": "satish chennupati", "link": "https://stackoverflow.com/users/6809935/satish-chennupati"}, "is_accepted": false, "score": 0, "last_activity_date": 1475812172, "creation_date": 1475812172, "answer_id": 39909058, "question_id": 39908192, "link": "https://stackoverflow.com/questions/39908192/need-to-use-add-and-gt-in-remove-using-mgo-golang-mongodb/39909058#39909058", "title": "Need to use $add and $gt in remove using mgo (Golang &amp;&amp; MongoDB)", "body": "<p>Here is what i propose. You can do it in two steps rather then in one.</p>\n\n<p>first find all the entries that matches you delete criteria. Then delete those matching entries using remove() query.</p>\n\n<p>The below query will return all the documents with currentTime greater then 200.(add 100 to 100).</p>\n\n<pre><code>db.Collection.aggregate(\n   [\n     { $project: { currentTime: 1, current_time:{ $gt: [ \"$currentTime\", { $add: [ 100,100 ] } ] } }}\n   ]\n)\n</code></pre>\n\n<p>i created a sample collection with the following data :</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"57f714f0b30252798d8a2988\"), \"currentTime\" : 1000 }\n{ \"_id\" : ObjectId(\"57f714f4b30252798d8a2989\"), \"currentTime\" : 100 }\n{ \"_id\" : ObjectId(\"57f714f7b30252798d8a298a\"), \"currentTime\" : 150 }\n{ \"_id\" : ObjectId(\"57f714fcb30252798d8a298b\"), \"currentTime\" : 1250 }\n</code></pre>\n\n<p>and the result of the above query on this collection is :</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"57f714f0b30252798d8a2988\"), \"currentTime\" : 1000, \"current_time\" : true }\n{ \"_id\" : ObjectId(\"57f714f4b30252798d8a2989\"), \"currentTime\" : 100, \"current_time\" : false }\n{ \"_id\" : ObjectId(\"57f714f7b30252798d8a298a\"), \"currentTime\" : 150, \"current_time\" : false }\n{ \"_id\" : ObjectId(\"57f714fcb30252798d8a298b\"), \"currentTime\" : 1250, \"current_time\" : true }\n</code></pre>\n\n<p>as you can see from the results that documents which has currentTime as 100 and 150 have returned false since they are less then 200.</p>\n"}, {"tags": [], "owner": {"reputation": 2041, "user_id": 5824483, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1045400122183130/picture?type=large", "display_name": "Amulya Kashyap", "link": "https://stackoverflow.com/users/5824483/amulya-kashyap"}, "is_accepted": false, "score": 0, "last_activity_date": 1475815244, "creation_date": 1475815244, "answer_id": 39909514, "question_id": 39908192, "link": "https://stackoverflow.com/questions/39908192/need-to-use-add-and-gt-in-remove-using-mgo-golang-mongodb/39909514#39909514", "title": "Need to use $add and $gt in remove using mgo (Golang &amp;&amp; MongoDB)", "body": "<p><strong><em>Now this is the way to remove your documents</em></strong> : </p>\n\n<p><strong>What you were doing :</strong></p>\n\n<blockquote>\n  <p>you cannot simply use $add as this operator only works with aggregate system</p>\n</blockquote>\n\n<p><strong>What you should do actually</strong></p>\n\n<ol>\n<li>Get All Records to be deleted using Aggregate methodology</li>\n<li>Run a loop over them and remove</li>\n</ol>\n\n<p><strong><em>Example</em></strong>:</p>\n\n<p><code>var cursor = db.Collection.aggregate([\n { $match: { currenttime: { $gt:{ $add:[100,100] }}}}\n]);\ncursor.forEach(function (doc){\n    db.Collection.remove({\"_id\": doc._id});\n});</code></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 4, "last_activity_date": 1475832219, "last_edit_date": 1495542254, "creation_date": 1475819045, "answer_id": 39910201, "question_id": 39908192, "link": "https://stackoverflow.com/questions/39908192/need-to-use-add-and-gt-in-remove-using-mgo-golang-mongodb/39910201#39910201", "title": "Need to use $add and $gt in remove using mgo (Golang &amp;&amp; MongoDB)", "body": "<p>1- If you need to remove rows with field e.g. <code>time &gt; t + 10</code> from the MongoDB, you do't need <code>$add</code>, you may use:</p>\n\n<pre><code>info, err := c.RemoveAll(bson.M{\"time\": bson.M{\"$gt\": t + 10}})\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Here is the working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nfunc main() {\n    session, err := mgo.Dial(\"localhost\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true) // Optional. Switch the session to a monotonic behavior.\n    c := session.DB(\"test\").C(\"Model\")\n    c.DropCollection()\n    t := time.Now().UTC().Unix()\n    err = c.Insert(\n        &amp;Model{bson.NewObjectId(), \"n1\", t},\n        &amp;Model{bson.NewObjectId(), \"n2\", t + 50},\n        &amp;Model{bson.NewObjectId(), \"n3\", t + 100},\n        &amp;Model{bson.NewObjectId(), \"n4\", t + 150})\n    if err != nil {\n        panic(err)\n    }\n    r := []Model{}\n    err = c.Find(nil).All(&amp;r)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(r)\n\n    info, err := c.RemoveAll(bson.M{\"time\": bson.M{\"$gt\": t + 10}})\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(info)\n\n    r2 := []Model{}\n    err = c.Find(nil).All(&amp;r2)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(r2)\n}\n\ntype Model struct {\n    ID   bson.ObjectId `json: \"_id,omitempty\" bson: \"_id,omitempty\"`\n    Name string        `json: \"name\" bson: \"name\"`\n    Time int64         `json: \"time\" bson: \"time\"`\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[{ObjectIdHex(\"57f7354cc3176906c0ca7516\") n1 1475818828} {ObjectIdHex(\"57f7354cc3176906c0ca7517\") n2 1475818878} {ObjectIdHex(\"57f7354cc3176906c0ca7518\") n3 1475818928} {ObjectIdHex(\"57f7354cc3176906c0ca7519\") n4 1475818978}]\n&amp;{0 3 3 &lt;nil&gt;}\n[{ObjectIdHex(\"57f7354cc3176906c0ca7516\") n1 1475818828}]\n</code></pre>\n\n<hr>\n\n<p>2- For <code>$add</code>, see:<br>\n<a href=\"https://stackoverflow.com/questions/39882159/query-where-sum-of-two-fields-is-less-than-given-value\">Query where sum of two fields is less than given value</a><br>\n<a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/add/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/reference/operator/aggregation/add/</a>  </p>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1475827511, "creation_date": 1475827511, "answer_id": 39912415, "question_id": 39908192, "link": "https://stackoverflow.com/questions/39908192/need-to-use-add-and-gt-in-remove-using-mgo-golang-mongodb/39912415#39912415", "title": "Need to use $add and $gt in remove using mgo (Golang &amp;&amp; MongoDB)", "body": "<p>Based on your sample code, I can observe that you use MongoDB <code>remove</code> command to filter only values of field <code>currenttime</code> greater than a particular value. </p>\n\n<p>If you intend to delete certain documents after they passed certain time, you should check out MongoDB <a href=\"https://docs.mongodb.com/v3.2/reference/glossary/#term-ttl\" rel=\"nofollow\">Time To Live</a> feature. Where you can <a href=\"https://docs.mongodb.com/v3.2/tutorial/expire-data/\" rel=\"nofollow\">Expire Data from Collections</a></p>\n\n<p>For example, you can specify : </p>\n\n\n\n<pre><code>db.collection.createIndex( { \"field_containing_time\": 1 }, { expireAfterSeconds: 3600 } )\n</code></pre>\n\n<p>To expire any documents from a collection after one hour. See also <a href=\"https://docs.mongodb.com/v3.2/core/index-ttl/\" rel=\"nofollow\">TTL Indexes</a></p>\n\n<p>Although this answer contain no Golang related code, if this is what you are trying to do in the big picture, it may be beneficial for your use case. </p>\n"}], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2122, "favorite_count": 0, "accepted_answer_id": 39910201, "answer_count": 4, "score": 1, "last_activity_date": 1475832219, "creation_date": 1475805370, "last_edit_date": 1475831928, "question_id": 39908192, "link": "https://stackoverflow.com/questions/39908192/need-to-use-add-and-gt-in-remove-using-mgo-golang-mongodb", "title": "Need to use $add and $gt in remove using mgo (Golang &amp;&amp; MongoDB)", "body": "<p>I'm using  Golang as my backend and MongoDB as the database for my web application. I'm in need of adding two values and check if the value in the database is greater than the added value and if it is, I need to remove the row from the MongoDB.<br>\nThe code which I wrote is as follows</p>\n\n<pre><code>err, err1 := c.RemoveAll(bson.M{\n        \"currenttime\": bson.M{\n            \"$gt\": bson.M{\n                \"$add\": []interface{}{time.Now().Unix(),\"100\"},\n            },\n        },\n     })\n</code></pre>\n\n<p>FYI: I wrote the sample code for MongoDB but this is not working as well</p>\n\n<pre><code>db.Collection.remove(\n   {currenttime:{\n        $gt:{\n                $add:[100,100]\n             }\n              }\n    }\n )\n</code></pre>\n\n<p>Please let me know if this is possible. And please give me any alternative way to do this.<br>\nThanks</p>\n"}, {"tags": ["go", "unicode", "buffer"], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1476060873, "post_id": 39907794, "comment_id": 67180341, "body": "Accepted because it explicitly shows how to work with buffers. Amd&#39;s answer is also worth looking at as it explores variations of my problem."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1476066935, "last_edit_date": 1476066935, "creation_date": 1475801702, "answer_id": 39907794, "question_id": 39907667, "link": "https://stackoverflow.com/questions/39907667/how-to-remove-unicode-characters-from-byte-buffer-in-go/39907794#39907794", "title": "How to remove Unicode characters from byte buffer in Go?", "body": "<p>To remove the <em>ith</em> rune from a slice of bytes, loop through the slice counting runes. When the ith rune is found, copy the bytes following the rune down to the position of the <em>ith</em> rune:</p>\n\n<pre><code>func removeAtBytes(p []byte, i int) []byte {\n    j := 0\n    k := 0\n    for k &lt; len(p) {\n        _, n := utf8.DecodeRune(p[k:])\n        if i == j {\n            p = p[:k+copy(p[k:], p[k+n:])]\n        }\n        j++\n        k += n\n    }\n    return p\n}\n</code></pre>\n\n<p>This function modifies the backing array of the argument slice, but it does not allocate memory.</p>\n\n<p>Use this function to remove a rune from a <code>bytes.Buffer</code>.</p>\n\n<pre><code>p := removeAtBytes(mbuf.Bytes(), i)\nmbuf.Truncate(len(p)) // backing bytes were updated, adjust length\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/q22GK_nq0j\" rel=\"nofollow\">playground example</a></p>\n\n<p>To remove the <em>ith</em> rune from a string, loop through the string counting runes. When the ith rune is found, create a string by concatenating the segment of the string before the rune with the segment of the string after the rune.</p>\n\n<pre><code>func removeAt(s string, i int) string {\n    j := 0  // count of runes\n    k := 0  // index in string of current rune\n   for k &lt; len(s) {\n        _, n := utf8.DecodeRuneInString(s[k:])\n        if i == j {\n            return s[:k] + s[k+n:]\n        }\n        j++\n        k += n\n    }\n    return s\n}\n</code></pre>\n\n<p>This function allocates a single string, the result. <a href=\"https://godoc.org/unicode/utf8#DecodeRuneInString\" rel=\"nofollow\">DecodeRuneInString</a> is a function in the standard library unicode/utf8 package.</p>\n"}, {"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 0, "last_activity_date": 1475805811, "creation_date": 1475805811, "answer_id": 39908242, "question_id": 39907667, "link": "https://stackoverflow.com/questions/39907667/how-to-remove-unicode-characters-from-byte-buffer-in-go/39908242#39908242", "title": "How to remove Unicode characters from byte buffer in Go?", "body": "<p>Taking a step back, go often works on <code>Reader</code>s and <code>Writer</code>s, so an alternative solution would be to use the <a href=\"https://godoc.org/golang.org/x/text/transform#Transformer\" rel=\"nofollow\">text/transform</a> package. You create a <code>Transformer</code>, attach it to a <code>Reader</code> and use the new <code>Reader</code> to produce a transformed string. For example here's a skipper:</p>\n\n<pre><code>func main() {\n    src := strings.NewReader(\"\u06a9\u06cc\u0627 \u062d\u0627\u0644 \u06be\u06d2\u061f\")\n    skipped := transform.NewReader(src, NewSkipper(5))\n    var buf bytes.Buffer\n    io.Copy(&amp;buf, skipped)\n    fmt.Println(\"RESULT:\", buf.String())\n}\n</code></pre>\n\n<p>And here's the implementation:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"strings\"\n    \"unicode/utf8\"\n\n    \"golang.org/x/text/transform\"\n)\n\ntype skipper struct {\n    pos int\n    cnt int\n}\n\n// NewSkipper creates a text transformer which will remove the rune at pos\nfunc NewSkipper(pos int) transform.Transformer {\n    return &amp;skipper{pos: pos}\n}\n\nfunc (s *skipper) Transform(dst, src []byte, atEOF bool) (nDst, nSrc int, err error) {\n    for utf8.FullRune(src) {\n        _, sz := utf8.DecodeRune(src)\n        // not enough space in the dst\n        if len(dst) &lt; sz {\n            return nDst, nSrc, transform.ErrShortDst\n        }\n        if s.pos != s.cnt {\n            copy(dst[:sz], src[:sz])\n            // track that we stored in dst\n            dst = dst[sz:]\n            nDst += sz\n        }\n        // track that we read from src\n        src = src[sz:]\n        nSrc += sz\n        // on to the next rune\n        s.cnt++\n    }\n    if len(src) &gt; 0 &amp;&amp; !atEOF {\n        return nDst, nSrc, transform.ErrShortSrc\n    }\n    return nDst, nSrc, nil\n}\n\nfunc (s *skipper) Reset() {\n    s.cnt = 0\n}\n</code></pre>\n\n<p>There may be bugs with this code, but hopefully you can see the idea.</p>\n\n<p>The benefit of this approach is it could work on a potentially infinite amount of data without having to store all of it in memory. For example you could transform a file this way.</p>\n"}, {"comments": [{"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 1, "creation_date": 1475859870, "post_id": 39911980, "comment_id": 67128639, "body": "Thanks. But I think this will replace <i>all</i> instances of a character and not the character in the <i>ith</i> position in the buffer."}, {"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1475873255, "post_id": 39911980, "comment_id": 67134802, "body": "Thanks again, but I think you misunderstood: I want to remove whatever character that is at the <i>ith</i> position in the buffer. <i>Not</i> the <i>ith</i> instance of some character. Essentially, a solution should only need the index in the buffer to remove, nothing else. So I think using <code>replace</code> is inherently unsuitable here because <code>replace</code> asks for what <i>character</i> to substitute, not what <i>position</i> to remove.       So if I have a buffer <code>b</code> containing <code>hello</code>, the function <code>removeAt(b,1)</code>  should modify <code>b</code> so it contains <code>hllo</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1475873754, "post_id": 39911980, "comment_id": 67135008, "body": "@hazrmard : remove at byte position or rune position?"}, {"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1475873787, "post_id": 39911980, "comment_id": 67135020, "body": "Remove the <i>ith</i> rune in the buffer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1475874508, "post_id": 39911980, "comment_id": 67135308, "body": "@See new Edit at the top , I hope this helps."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1475874664, "post_id": 39911980, "comment_id": 67135379, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/125209/discussion-between-amd-and-hazrmard\">continue this discussion in chat</a>."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1475876614, "last_edit_date": 1475876614, "creation_date": 1475826056, "answer_id": 39911980, "question_id": 39907667, "link": "https://stackoverflow.com/questions/39907667/how-to-remove-unicode-characters-from-byte-buffer-in-go/39911980#39911980", "title": "How to remove Unicode characters from byte buffer in Go?", "body": "<p>Edit:  </p>\n\n<p>Remove the ith rune in the buffer:<br>\nA: Shift all runes one location to the left (Here A is faster than B), try it on <a href=\"https://play.golang.org/p/AoHjwuS7at\" rel=\"nofollow\">The Go Playground</a>:  </p>\n\n<pre><code>func removeRuneAt(s string, runePosition int) string {\n    if runePosition &lt; 0 {\n        return s\n    }\n    r := []rune(s)\n    if runePosition &gt;= len(r) {\n        return s\n    }\n    copy(r[runePosition:], r[runePosition+1:])\n    return string(r[:len(r)-1])\n}\n</code></pre>\n\n<p>B: Copy to new buffer, try it on <a href=\"https://play.golang.org/p/m8cFYwVHJt\" rel=\"nofollow\">The Go Playground</a></p>\n\n<pre><code>func removeRuneAt(s string, runePosition int) string {\n    if runePosition &lt; 0 {\n        return s // avoid allocation\n    }\n    r := []rune(s)\n    if runePosition &gt;= len(r) {\n        return s // avoid allocation\n    }\n    t := make([]rune, len(r)-1) // Apply replacements to buffer.\n    w := copy(t, r[:runePosition])\n    w += copy(t[w:], r[runePosition+1:])\n    return string(t[:w])\n}\n</code></pre>\n\n<p>C: Try it on <a href=\"https://play.golang.org/p/UGszdB324z\" rel=\"nofollow\">The Go Playground</a>: </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := \"hello\"\n    fmt.Println(str)\n    fmt.Println(removeRuneAt(str, 1))\n\n    buf := bytes.NewBuffer([]byte(str))\n    fmt.Println(buf.Bytes())\n\n    buf = bytes.NewBuffer([]byte(removeRuneAt(buf.String(), 1)))\n    fmt.Println(buf.Bytes())\n}\nfunc removeRuneAt(s string, runePosition int) string {\n    if runePosition &lt; 0 {\n        return s // avoid allocation\n    }\n    r := []rune(s)\n    if runePosition &gt;= len(r) {\n        return s // avoid allocation\n    }\n\n    t := make([]rune, len(r)-1) // Apply replacements to buffer.\n    w := copy(t, r[0:runePosition])\n    w += copy(t[w:], r[runePosition+1:])\n    return string(t[0:w])\n}\n</code></pre>\n\n<p>D: <a href=\"https://play.golang.org/p/TVS9SxBZNt\" rel=\"nofollow\">Benchmark</a>:<br>\nA: 745.0426ms<br>\nB: 1.0160581s<br>\nfor 2000000 iterations  </p>\n\n<hr>\n\n<p>1- Short Answer: to replace all (<code>n</code>) instances of a character (or even a <code>string</code>):</p>\n\n<pre><code>n := -1\nnewR := \"\"\nold := \"\u00b5\"\nbuf = bytes.NewBuffer([]byte(strings.Replace(buf.String(), old, newR, n)))\n</code></pre>\n\n<hr>\n\n<p>2- For replacing the character(<code>string</code>) in the <code>ith</code> instance in the buffer, you may use:</p>\n\n<pre><code>buf = bytes.NewBuffer([]byte(Replace(buf.String(), oldString, newOrEmptyString, ith)))\n</code></pre>\n\n<p>See:</p>\n\n<pre><code>// Replace returns a copy of the string s with the ith\n// non-overlapping instance of old replaced by new.\nfunc Replace(s, old, new string, ith int) string {\n    if len(old) == 0 || old == new || ith &lt; 0 {\n        return s // avoid allocation\n    }\n    i, j := 0, 0\n    for ; ith &gt;= 0; ith-- {\n        j = strings.Index(s[i:], old)\n        if j &lt; 0 {\n            return s // avoid allocation\n        }\n        j += i\n        i = j + len(old)\n    }\n    t := make([]byte, len(s)+(len(new)-len(old))) // Apply replacements to buffer.\n    w := copy(t, s[0:j])\n    w += copy(t[w:], new)\n    w += copy(t[w:], s[j+len(old):])\n    return string(t[0:w])\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/OzBPOJjwBs\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    str := `How are you?\u00b5`\n    fmt.Println(str)\n    fmt.Println(Replace(str, \"\u00b5\", \"\", 0))\n\n    buf := bytes.NewBuffer([]byte(str))\n    fmt.Println(buf.Bytes())\n\n    buf = bytes.NewBuffer([]byte(Replace(buf.String(), \"\u00b5\", \"\", 0)))\n\n    fmt.Println(buf.Bytes())\n}\nfunc Replace(s, old, new string, ith int) string {\n    if len(old) == 0 || old == new || ith &lt; 0 {\n        return s // avoid allocation\n    }\n    i, j := 0, 0\n    for ; ith &gt;= 0; ith-- {\n        j = strings.Index(s[i:], old)\n        if j &lt; 0 {\n            return s // avoid allocation\n        }\n        j += i\n        i = j + len(old)\n    }\n    t := make([]byte, len(s)+(len(new)-len(old))) // Apply replacements to buffer.\n    w := copy(t, s[0:j])\n    w += copy(t[w:], new)\n    w += copy(t[w:], s[j+len(old):])\n    return string(t[0:w])\n}\n</code></pre>\n\n<hr>\n\n<p>3- If you want to remove all instances of Unicode character (<code>old</code> string) from any position in the string, you may use:</p>\n\n<pre><code>strings.Replace(str, old, \"\", -1)\n</code></pre>\n\n<p>4- Also this works fine for removing from <code>bytes.buffer</code>:</p>\n\n<pre><code>strings.Replace(buf.String(), old, newR, -1)\n</code></pre>\n\n<p>Like so:</p>\n\n<pre><code>buf = bytes.NewBuffer([]byte(strings.Replace(buf.String(), old, newR, -1)))\n</code></pre>\n\n<p>Here is the complete working code (try it on <a href=\"https://play.golang.org/p/0hqdwQ6n05\" rel=\"nofollow\">The Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    str := `\u06a9\u06cc\u0627 \u062d\u0627\u0644 \u06be\u06d2\u061f` //How are you?\n    old := `\u06a9`\n    newR := \"\"\n    fmt.Println(strings.Replace(str, old, newR, -1))\n\n    buf := bytes.NewBuffer([]byte(str))\n    //  for _, r := range str {\n    //      buf.WriteRune(r)\n    //  }\n    fmt.Println(buf.Bytes())\n\n    bs := []byte(strings.Replace(buf.String(), old, newR, -1))\n    buf = bytes.NewBuffer(bs)\n\n    fmt.Println(\"       \", buf.Bytes())\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>\u06cc\u0627 \u062d\u0627\u0644 \u06be\u06d2\u061f\n[218 169 219 140 216 167 32 216 173 216 167 217 132 32 218 190 219 146 216 159]\n        [219 140 216 167 32 216 173 216 167 217 132 32 218 190 219 146 216 159]\n</code></pre>\n\n<hr>\n\n<p>5- <code>strings.Replace</code> is very efficient, see inside:</p>\n\n<blockquote>\n<pre><code>// Replace returns a copy of the string s with the first n\n// non-overlapping instances of old replaced by new.\n// If old is empty, it matches at the beginning of the string\n// and after each UTF-8 sequence, yielding up to k+1 replacements\n// for a k-rune string.\n// If n &lt; 0, there is no limit on the number of replacements.\nfunc Replace(s, old, new string, n int) string {\n  if old == new || n == 0 {\n      return s // avoid allocation\n  }\n\n  // Compute number of replacements.\n  if m := Count(s, old); m == 0 {\n      return s // avoid allocation\n  } else if n &lt; 0 || m &lt; n {\n      n = m\n  }\n\n  // Apply replacements to buffer.\n  t := make([]byte, len(s)+n*(len(new)-len(old)))\n  w := 0\n  start := 0\n  for i := 0; i &lt; n; i++ {\n      j := start\n      if len(old) == 0 {\n          if i &gt; 0 {\n              _, wid := utf8.DecodeRuneInString(s[start:])\n              j += wid\n          }\n      } else {\n          j += Index(s[start:], old)\n      }\n      w += copy(t[w:], s[start:j])\n      w += copy(t[w:], new)\n      start = j + len(old)\n  }\n  w += copy(t[w:], s[start:])\n  return string(t[0:w])\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4458, "favorite_count": 0, "accepted_answer_id": 39907794, "answer_count": 3, "score": 2, "last_activity_date": 1476066935, "creation_date": 1475800632, "last_edit_date": 1495541341, "question_id": 39907667, "link": "https://stackoverflow.com/questions/39907667/how-to-remove-unicode-characters-from-byte-buffer-in-go", "title": "How to remove Unicode characters from byte buffer in Go?", "body": "<p>I have a <code>bytes.Buffer</code> type variable which I filled with Unicode characters:  </p>\n\n<pre><code>var mbuff bytes.Buffer\nunicodeSource := '\u06a9\u06cc\u0627 \u062d\u0627\u0644 \u06be\u06d2\u061f'    \nfor i,r := range(unicodeSource) {\n    mbuff.WriteRune(r)\n}\n</code></pre>\n\n<p>Note: I iterated over a Unicode literals here, but really the source is an infinite loop of user input characters.  </p>\n\n<p>Now, I want to remove a Unicode character from any position in the buffer <code>mbuff</code>. The problem is that characters may be of variable byte sizes. So I cannot just pick out the <em>ith</em> byte from <code>mbuff.String()</code> as it might be the beginning, middle, or end of a character. This is my trivial (and horrendous) solution:  </p>\n\n<pre><code>// removing Unicode character at position n\nvar tempString string\ncurrChar := 0\nfor _, ch := range(mbuff.String()) { // iterate over Unicode chars\n    if currChar != n {               // skip concatenating nth char\n        tempString += ch\n    }\n    currChar++\n}\nmbuff.Reset()                        // empty buffer\nmbuff.WriteString(tempString)        // write new string\n</code></pre>\n\n<p>This is bad in many ways. For one, I convert buffer to string, remove <em>ith</em> element, and write a new string back into the buffer. Too many operations. Second, I use the <code>+=</code> operator in the loop to concatenate Unicode characters into a new string. I am using buffers in the first place exactly to avoid concatenation using <code>+=</code> which is slow as <a href=\"https://stackoverflow.com/a/1766304/4591810\">this answer points out</a>.</p>\n\n<p>What is an efficient method to remove the <em>ith</em> Unicode character in a <code>bytes.Buffer</code>?<br>\nAlso what is an efficient way to insert a Unicode character after <em>i-1</em> Unicode characters (i.e. in the <em>ith</em> place)?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475792799, "post_id": 39906363, "comment_id": 67098474, "body": "Are you accessing the map in multiple places concurrently? Run your code with the race detector."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475792855, "post_id": 39906363, "comment_id": 67098497, "body": "oh I just need a mutex? I thought golang had atomic ops on hash like that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1475793514, "post_id": 39906363, "comment_id": 67098720, "body": "I&#39;m not sure what you mean, but <i>no</i> values in Go are safe for concurrent reads and writes. The only &quot;atomic&quot; operations are through the &quot;sync/atomic&quot; package."}], "answers": [{"comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1475883704, "post_id": 39914751, "comment_id": 67137823, "body": "thanks for the chan and operation idea. that&#39;s such a good idea. made the code more simple too."}, {"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "reply_to_user": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1476089579, "post_id": 39914751, "comment_id": 67188801, "body": "@AndrewArrow I took the liberty of replacing your image with in-line code."}], "tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": false, "score": 1, "last_activity_date": 1476089558, "last_edit_date": 1476089558, "creation_date": 1475835031, "answer_id": 39914751, "question_id": 39906363, "link": "https://stackoverflow.com/questions/39906363/is-delete-guaranteed-to-delete-from-a-hash-in-golang/39914751#39914751", "title": "is delete guaranteed to delete from a hash in golang?", "body": "<p>Maps are not safe for concurrent access. I would do this either using a mutex to moderate map access or having a goroutine reading either a channel of \"op\" structs or have a \"add\" channel and a \"delete\" channel.</p>\n\n<p>You're probably safe having multiple read-only accesses concurrently, but once you have writes in the mix, you really want to ensure you only have one access at a time.</p>\n\n<p>If you are set on using a goroutine to manage the count, one way would be something like:</p>\n\n<pre><code>import \"sync/atomic\"\n\nvar TransferChan chan int32\nvar TransfersInFlight int32\n\nfunc TransferManager() {\n  TransfersInFlight = 0\n  for delta := range TransferChan {\n    // You're *probably* safe just using +=, but, you know...\n    atomic.AddInt32(&amp;TransfersInFlight, delta)\n  }\n}\n</code></pre>\n\n<p>That way, you only need to do <code>go TransferManager()</code> and then pass your increments and decrements over the <code>TransferChan</code> channel.</p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1476089558, "creation_date": 1475791667, "question_id": 39906363, "link": "https://stackoverflow.com/questions/39906363/is-delete-guaranteed-to-delete-from-a-hash-in-golang", "title": "is delete guaranteed to delete from a hash in golang?", "body": "<p>I have a hash like this:</p>\n\n<pre><code>  var TransfersInFlight map[string]string = make(map[string]string)\n</code></pre>\n\n<p>And before I send a file I make a key for it store, send it, delete it:</p>\n\n<pre><code>  timeKey := fmt.Sprintf(\"%v\",time.Now().UnixNano())\n  TransfersInFlight[timeKey] = filename\n  total, err := sendTheFile(filename)\n  delete(TransfersInFlight, timeKey)\n</code></pre>\n\n<p>i.e. during the time it takes to send the file, there is a key in the hash with a timestamp pointing to the filename.</p>\n\n<p>the func <code>sendTheFile</code> always either works, or has an err but never throws a stacktrace exception and crashes the whole program so the line:</p>\n\n<pre><code>  delete(TransfersInFlight, timeKey)\n</code></pre>\n\n<p>should be called 100% of the time. And yet, I sometimes find cases where it's like this line was never called and the file is stuck in TransfersInFlight forever. How is this possible?</p>\n"}]