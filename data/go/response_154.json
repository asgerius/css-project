[{"tags": ["go", "asn.1", "search-guard"], "answers": [{"comments": [{"owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "edited": false, "score": 0, "creation_date": 1513827524, "post_id": 47917273, "comment_id": 82803070, "body": "Thanks a lot for the explanation @dave_thompson_085 !"}], "tags": [], "owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "is_accepted": true, "score": 5, "last_activity_date": 1513825003, "creation_date": 1513825003, "answer_id": 47917273, "question_id": 47915663, "link": "https://stackoverflow.com/questions/47915663/how-to-parse-der-bytes/47917273#47917273", "title": "How to parse DER bytes?", "body": "<p>Mostly dupe <a href=\"https://stackoverflow.com/questions/5929050/how-does-asn-1-encode-an-object-identifier\">How does ASN.1 encode an object identifier?</a> </p>\n\n<p>The encoding of the (X.509=PKIX) SAN extension's value is defined in rfc5280 as:</p>\n\n<pre><code>SubjectAltName ::= GeneralNames\nGeneralNames ::= SEQUENCE SIZE (1..MAX) OF GeneralName\nGeneralName ::= CHOICE { // tags implicit\n     otherName                 [0]  AnotherName,\n     rfc822Name                [1]  IA5String,\n     dNSName                   [2]  IA5String,\n     x400Address               [3]  ORAddress,\n     directoryName             [4]  Name,\n     ediPartyName              [5]  EDIPartyName,\n     uniformResourceIdentifier [6]  IA5String,\n     iPAddress                 [7]  OCTET STRING,\n     registeredID              [8]  OBJECT IDENTIFIER }\n</code></pre>\n\n<p>For this CHOICE, your first octet 0x88 is the tag value for context-specific #8 (meaning registeredID), and your second octet 0x05 is the length of the value, which is encoded as 0x2A 0x03 0x04 0x05 0x05. Since this value is an object identifier, to decode it look at the section on encoding under OBJECT IDENTIFIER in the Kaliski document:</p>\n\n<blockquote>\n  <p><b>BER encoding.</b> Primitive. Contents octets are as follows, where\n  value1, ..., valuen denote the integer values of the components in the\n  complete object identifier:</p>\n  \n  <ol>\n  <li><p>The first octet has value 40 * value1 + value2. (This is unambiguous, since value1 is limited to values 0, 1, and 2; value2 is\n  limited to the range 0 to 39 when value1 is 0 or 1; and, according to\n  X.208, n is always at least 2.)</p></li>\n  <li><p>The following octets, if any, encode value3, ..., valuen. Each value is encoded base 128, most significant digit first, with as few\n  digits as possible, and the most significant bit of each octet except\n  the last in the value's encoding set to \"1.\"</p></li>\n  </ol>\n</blockquote>\n\n<p>The first value octet 0x2A is decimal 42 and 42 = 40 * 1 + 2, so the first two components of the OID are 1 and 2. All of the remaining octets do not have their most-significant bit set so they each encode one component: 3 4 5 5. The OID consisting of the components 1 2 3 4 5 5 is in the usual shorthand notation 1.2.3.4.5.5 (but there are other equivalent notations as shown in Kaliski).</p>\n\n<p>Incidentally, that OID is invalid because it would have to be under the member-body of the country with ISO3166 numeric code 3 and there is no such country.</p>\n"}], "owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 984, "favorite_count": 1, "accepted_answer_id": 47917273, "answer_count": 1, "score": 5, "last_activity_date": 1588324940, "creation_date": 1513811504, "last_edit_date": 1588324940, "question_id": 47915663, "link": "https://stackoverflow.com/questions/47915663/how-to-parse-der-bytes", "title": "How to parse DER bytes?", "body": "<p>I am trying to create cert for <a href=\"https://github.com/floragunncom/search-guard-ssl/blob/a2d1e8e9b25a10ecaf1cb47e48cf04328af7d7fb/example-pki-scripts/gen_node_cert.sh#L55\" rel=\"nofollow noreferrer\">Elasticsearch Searchguard</a>. One requirement is that the cert must include <code>oid:1.2.3.4.5.5</code> in SANs. I am using GO to generate that cert. After some trial and error I have figured out that if I use <code>[]byte{0x88, 0x05, 0x2A, 0x03, 0x04, 0x05, 0x05}</code> as Raw ASN.1 bytes, this turns into <code>oid:1.2.3.4.5.5</code> in SANs . I want to understand how these bytes represent the value <code>oid:1.2.3.4.5.5</code>. I have read <a href=\"http://luca.ntop.org/Teaching/Appunti/asn1.html\" rel=\"nofollow noreferrer\">this</a>, but I am still confused. Can you help me understand how this []byte represents <code>oid:1.2.3.4.5.5</code>?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "edited": false, "score": 0, "creation_date": 1513808966, "post_id": 47915205, "comment_id": 82798597, "body": "are you sure about the <code>omitempty</code> tag for bson _id? maybe its causing you issues"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1513809065, "post_id": 47915205, "comment_id": 82798635, "body": "you cannot have any document in mongo without <code>_id</code>, check <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.insert/#id-field\" rel=\"nofollow noreferrer\">this</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "is_accepted": true, "score": 0, "last_activity_date": 1513810973, "creation_date": 1513810973, "answer_id": 47915599, "question_id": 47915205, "link": "https://stackoverflow.com/questions/47915205/how-to-search-with-empty-id-with-mgo/47915599#47915599", "title": "How to search with empty _id with mgo", "body": "<p>This is a working example based on your code. It first connects, then insert and finally find a specific string. As you see if you insert your documents correctly your search function works fine.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype task struct {\n    ID   *bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n    Text string         `json:\"text\" bson:\"text,omitempty\"`\n    // other params\n}\n\nfunc main() {\n    session, err := mgo.Dial(\"127.0.0.1\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    c := session.DB(\"test\").C(\"test\")\n\n    err = c.Insert(task{\n        Text: \"Hello\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var result task\n    err = c.Find(task{\n        ID:   nil,\n        Text: \"Hello\",\n    }).One(&amp;result)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(result)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "is_accepted": false, "score": 0, "last_activity_date": 1513892740, "creation_date": 1513892740, "answer_id": 47933140, "question_id": 47915205, "link": "https://stackoverflow.com/questions/47915205/how-to-search-with-empty-id-with-mgo/47933140#47933140", "title": "How to search with empty _id with mgo", "body": "<p>I checked the implementation of <code>insert</code> and found that the behavior changed, did not account for this</p>\n\n<pre><code>`Status string` json: \"status\" `\n</code></pre>\n\n<p>fixed on the <code>Status string 'json: \"status\" bson: \"-\"'</code> and everything worked properly</p>\n"}], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 47915599, "answer_count": 2, "score": 0, "last_activity_date": 1513892740, "creation_date": 1513808455, "last_edit_date": 1513809457, "question_id": 47915205, "link": "https://stackoverflow.com/questions/47915205/how-to-search-with-empty-id-with-mgo", "title": "How to search with empty _id with mgo", "body": "<p>My structure</p>\n\n<pre><code>struct task {\n  Id *bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n  Text string `json:\"text\" bson:\"text,omitempty\"`\n  // other params\n}\n</code></pre>\n\n<p>Get data from form</p>\n\n<pre><code>var task Task{}\ntask.Text = FORM.Text\n</code></pre>\n\n<p>and my function to find tasks</p>\n\n<pre><code>func FindOne(task Task) (Task, error) {\n    err := db.Session.DB(\"tasks\").C(CollectionTask).Find(&amp;task).One(&amp;task)\n    if err != nil {\n        return task, err\n    }\n\n    return task, nil\n}\n</code></pre>\n\n<p>From the search form I only get a line <code>text</code>, without a field<code>id</code>, in this case, _id -> nil and mgo (mongo) finds nothing <code>not found</code></p>\n\n<p>How do I modify the search function or structure of the data to carry out a correct search?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513797456, "post_id": 47912327, "comment_id": 82793577, "body": "The sample JSON is invalid."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1513799590, "post_id": 47912327, "comment_id": 82794552, "body": "Duplicate. The 3&#39;000ths."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1513801606, "post_id": 47912327, "comment_id": 82795454, "body": "We need to pick a canonical &quot;export your fields&quot; question/answer so we can easily close duplicates..."}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 2008301, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/9c2cfe5c1e45ed7d5052c4e8a81085d1?s=128&d=identicon&r=PG", "display_name": "Mike F", "link": "https://stackoverflow.com/users/2008301/mike-f"}, "edited": false, "score": 0, "creation_date": 1513802890, "post_id": 47912781, "comment_id": 82796101, "body": "Thanks, that did work. Why do I need to export the fields?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 179, "user_id": 2008301, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/9c2cfe5c1e45ed7d5052c4e8a81085d1?s=128&d=identicon&r=PG", "display_name": "Mike F", "link": "https://stackoverflow.com/users/2008301/mike-f"}, "edited": false, "score": 0, "creation_date": 1513803129, "post_id": 47912781, "comment_id": 82796210, "body": "@MikeF because fields whose name starts with a lower-case letter are &quot;private&quot; (not available outside of the named package) and fields whose name starts with an upper-case letter are &quot;exported&quot; (i.e. public, available outside of the named package). The <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">JSON un/marshaler</a> was designed to only consider <i>exported</i> fields. See also this article about <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">JSON and Go</a>."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1513796652, "creation_date": 1513796652, "answer_id": 47912781, "question_id": 47912327, "link": "https://stackoverflow.com/questions/47912327/json-and-type-casting/47912781#47912781", "title": "json and type casting", "body": "<p>You must export the fields of the \"Content\" struct that you wish to de/serialize by using capital letters:</p>\n\n<pre><code>type Content struct {\n  Title string\n  Tags  []int\n}\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>type Content struct {\n  Title string\n  Tags  []int\n}\n\nfunc main() {\n  jsonstr := `[{\"title\":\"hi\",\"tags\":[1,2,3,4,5,6]}]`\n  contents := []Content{}\n\n  err := json.Unmarshal([]byte(jsonstr), &amp;contents)\n  if err != nil {\n    panic(err)\n  }\n\n  fmt.Printf(\"%#v\\n\", contents)\n  // =&gt; []main.Content{main.Content{Title:\"hi\", Tags:[]int{1, 2, 3, 4, 5, 6}}}\n\n}\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 2008301, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/9c2cfe5c1e45ed7d5052c4e8a81085d1?s=128&d=identicon&r=PG", "display_name": "Mike F", "link": "https://stackoverflow.com/users/2008301/mike-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 47912781, "answer_count": 1, "score": -3, "last_activity_date": 1513798931, "creation_date": 1513794706, "last_edit_date": 1513798931, "question_id": 47912327, "link": "https://stackoverflow.com/questions/47912327/json-and-type-casting", "title": "json and type casting", "body": "<p>I am attempting to read a json file that looks like</p>\n\n<pre><code> [{ \"title\": \"hi\", \"tags\": [1,2,3,4,5,6] }, {...}, {...}]\n</code></pre>\n\n<p>and the code looks like this</p>\n\n<pre><code> contentdat, err := ioutil.ReadFile(\"content.json\")\n check(err)\n var content []interface{}\n err = json.Unmarshal(contentdat, &amp;content)\n check(err)\n\n\nfor i, contentItem := range content {\n    vertedContentItem := contentItem.(map[string]interface{})\n    contentTags := vertedContentItem[\"tags\"].([]interface{})\n    contentItemTags := make([]int, len(contentTags))\n    for i, ctv := range contentTags {\n        contentItemTags[i] = int(ctv.(float64))\n    }\n</code></pre>\n\n<p>what I am trying to figure out is how I can avoid the doing all the type casting and just access the json obj directly or maybe just type cast once for the entire json structure. I had a idea about defining the structure of the internal object like so</p>\n\n<pre><code>type Content struct {\n  title string\n  tags []int\n}\n</code></pre>\n\n<p>and then declare content as </p>\n\n<pre><code>var content []Content\n</code></pre>\n\n<p>instead of interface{} and just loop through the structure as expected but that didn't work. Any ideas?</p>\n"}, {"tags": ["go", "tcp", "tcpserver"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513794675, "post_id": 47912263, "comment_id": 82792251, "body": "I don&#39;t see what you&#39;re doing for an idle timeout here at all. The docs state: <code>An idle timeout can be implemented by repeatedly extending the deadline after successful Read or Write calls.</code>. Have you tried that?"}, {"owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513794876, "post_id": 47912263, "comment_id": 82792354, "body": "I want it to timeout in the first place. Extending comes after this. The point is, its not closing my connection. <b>netstat -a</b> still shows active connections, even after 2 secs of connection."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513795096, "post_id": 47912263, "comment_id": 82792457, "body": "Yes, so every Read (and/or Write) you set a new deadline."}, {"owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513795354, "post_id": 47912263, "comment_id": 82792567, "body": "But, I want to end <code>idle</code> connections. Using my python client, I want to simulate an idle connection (by sending nothing to the server). Now, Ideally, it should close the connection after 2 seconds, but it isn&#39;t."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513795535, "post_id": 47912263, "comment_id": 82792644, "body": "Timeouts don&#39;t close connections. That&#39;s always up to you to properly call Close."}, {"owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513795825, "post_id": 47912263, "comment_id": 82792779, "body": "Is there some sort of callback I need to pass to close an idle connection? How can I handle idle timeout events?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513795957, "post_id": 47912263, "comment_id": 82792839, "body": "The &quot;callbacks&quot; are the Read and Write calls themselves. I&#39;ll add an example of an idle timeout, but calling Close is always required. <code>c.settimeout(1)</code> and <code>c.recv(1)</code> in python isn&#39;t going to close the connection either."}], "answers": [{"comments": [{"owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "edited": false, "score": 0, "creation_date": 1513796441, "post_id": 47912649, "comment_id": 82793074, "body": "Thanks for the answer. But where are we closing connection?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "edited": false, "score": 0, "creation_date": 1513796518, "post_id": 47912649, "comment_id": 82793116, "body": "That&#39;s up to your code. You close the connection when you&#39;re done with it. If the timeout was reached, the Read will return, and you&#39;ll have a deadline error."}, {"owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "edited": false, "score": 0, "creation_date": 1513797899, "post_id": 47912649, "comment_id": 82793778, "body": "Ok. Have you any idea of how can I make it work with <code>bufio.Scanner</code>? The code is written that way (using scanner). Can I make <code>scanner.Scan</code> call return after either read bytes or N seconds?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "edited": false, "score": 0, "creation_date": 1513798319, "post_id": 47912649, "comment_id": 82794005, "body": "That&#39;s what this does already. The fact that you&#39;re using <code>bufio.Scanner</code> is beside the point."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1513796101, "creation_date": 1513796101, "answer_id": 47912649, "question_id": 47912263, "link": "https://stackoverflow.com/questions/47912263/idletimeout-in-tcp-server/47912649#47912649", "title": "IdleTimeout in tcp server", "body": "<p>In the <code>net</code> package documentation for <code>SetDeadline</code>, it states</p>\n\n<blockquote>\n<pre><code>   // An idle timeout can be implemented by repeatedly extending\n   // the deadline after successful Read or Write calls.\n</code></pre>\n</blockquote>\n\n<p>You do this by creating your own <code>net.Conn</code> type to implement the call you want to have timeout. Since an idle connection would normally be waiting in <code>Read</code>, that is usually where you want to set the deadline.</p>\n\n<pre><code>type Conn struct {\n    net.Conn\n    idleTimeout time.Duration\n}\n\nfunc (c *Conn) Read(b []byte) (int, error) {\n    err := c.Conn.SetReadDeadline(time.Now().Add(c.idleTimeout))\n    if err != nil {\n        return 0, err\n    }\n    return c.Conn.Read(b)\n}\n</code></pre>\n"}], "owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1617, "favorite_count": 0, "accepted_answer_id": 47912649, "answer_count": 1, "score": 1, "last_activity_date": 1513796142, "creation_date": 1513794485, "last_edit_date": 1513796142, "question_id": 47912263, "link": "https://stackoverflow.com/questions/47912263/idletimeout-in-tcp-server", "title": "IdleTimeout in tcp server", "body": "<p>I am working on a project in the Go language which includes <em>TCP server</em>. I am trying to implement an <em>idle timeout</em> on server sockets, but couldn't do it. The Go code I am using goes like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc main() {\n    startServer(6666, time.Duration(2)*time.Second)\n}\n\nfunc startServer(port int, deadline time.Duration) {\n    // Listen for incoming connections.\n    strPort := strconv.Itoa(port)\n    l, err := net.Listen(\"tcp\", \":\"+strPort)\n    if err != nil {\n        fmt.Println(\"Error listening:\", err.Error())\n        os.Exit(1)\n    }\n    // Close the listener when the application closes.\n    defer l.Close()\n    fmt.Println(\"Listening on port:\" + strPort)\n    for {\n        // Listen for an incoming connection.\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n\n        fmt.Println(\"Got new connection\")\n\n        // Set read timeout\n        conn.SetReadDeadline(time.Now().Add(deadline))\n\n        // Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\n\nfunc handleRequest(conn net.Conn) {\n    reader := bufio.NewReader(conn)\n    scanner := bufio.NewScanner(reader)\n\n    for scanner.Scan() {\n        fmt.Println(scanner.Bytes())\n    }\n}\n</code></pre>\n\n<p>I want it to <strong>timeout</strong> and close the connection after 2 seconds. Could anybody please tell me what I might be doing wrong. In order to test it, I am using a TCP client I wrote as Python scipt. The client code goes like this:</p>\n\n<pre><code>\u03bb python\nPython 3.5.1 (v3.5.1:37a07cee5969, Dec  6 2015, 01:54:25) [MSC v.1900 64 bit (AMD64)] on win32\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; from socket import *\n&gt;&gt;&gt; c = socket(family=AF_INET, type=SOCK_STREAM)\n&gt;&gt;&gt; c.connect(('localhost', 6666))\n</code></pre>\n\n<p>I can always keep track of all the open connections, along with their last active time in some sort of data structure and launch a goroutine which periodically checks for time elapsed for every connection, closing the ones I haven't heard from in a while. But I wanted to utilize the built-in method <code>SetReadDeadline()</code> for the job.</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 0, "creation_date": 1513791002, "post_id": 47911187, "comment_id": 82790419, "body": "I would start by looking at the example provided on the Go web site: <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json</a> (look under &quot;Example (CustomMarshalJSON)&quot;)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1513795275, "post_id": 47911187, "comment_id": 82792523, "body": "See the &quot;Example (Unmarshal)&quot; for the <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code> type</a>."}], "answers": [{"tags": [], "owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "is_accepted": true, "score": 10, "last_activity_date": 1513791654, "creation_date": 1513791654, "answer_id": 47911600, "question_id": 47911187, "link": "https://stackoverflow.com/questions/47911187/golang-elegantly-json-decode-different-structures/47911600#47911600", "title": "Golang elegantly JSON decode different structures", "body": "<p>So, there are a couple ways of doing this, but the easiest is probably deserializing the payload twice and having conditional branches based off of the \"AnimalType\" attribute in your payload. Here's a simple example using an intermediate deserialization model:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"encoding/json\"\n)\n\ntype Dog struct {\n  AnimalType string //will always be \"dog\"\n  BarkLoudnessLevel int\n}\n\ntype Cat struct {\n  AnimalType string //will always be \"cat\"\n  SleepsAtNight bool\n}\n\nvar (\n  payloadOne = `{\"AnimalType\":\"dog\",\"BarkLoudnessLevel\":1}`\n  payloadTwo = `{\"AnimalType\":\"cat\",\"SleepsAtNight\":false}`\n)\n\nfunc main() {\n  parseAnimal(payloadOne)\n  parseAnimal(payloadTwo)\n}\n\nfunc parseAnimal(payload string) {\n  animal := struct{\n    AnimalType string\n  }{} \n  if err := json.Unmarshal([]byte(payload), &amp;animal); err != nil {\n    panic(err)\n  }\n  switch animal.AnimalType {\n  case \"dog\":\n    dog := Dog{}\n    if err := json.Unmarshal([]byte(payload), &amp;dog); err != nil {\n      panic(err)\n    }\n    fmt.Printf(\"Got a dog: %v\\n\", dog)\n  case \"cat\":\n    cat := Cat{}\n    if err := json.Unmarshal([]byte(payload), &amp;cat); err != nil {\n      panic(err)\n    }\n    fmt.Printf(\"Got a cat: %v\\n\", cat)\n  default:\n    fmt.Println(\"Unknown animal\")\n  }\n}\n</code></pre>\n\n<p>See it in action <a href=\"https://play.golang.org/p/EsMIMhifLH\" rel=\"noreferrer\">here</a>.</p>\n\n<hr>\n\n<p>IMO a better way of approaching this is moving the \"metadata\" for the payload into a parent structure, though this requires modifying the expected json payload. So, for example, if you were working with payloads that looked like:</p>\n\n<pre><code>{\"AnimalType\":\"dog\", \"Animal\":{\"BarkLoudnessLevel\": 1}}\n</code></pre>\n\n<p>Then you could use something like <code>json.RawMessage</code> to partially parse the structure and then conditionally parse the rest as needed (rather than parsing everything twice)--also results in a nicer separation of structure attributes. Here's an example of how you'd do that:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Animal struct {\n    AnimalType string\n    Animal     json.RawMessage\n}\n\ntype Dog struct {\n    BarkLoudnessLevel int\n}\n\ntype Cat struct {\n    SleepsAtNight bool\n}\n\nvar (\n    payloadOne = `{\"AnimalType\":\"dog\", \"Animal\":{\"BarkLoudnessLevel\": 1}}`\n    payloadTwo = `{\"AnimalType\":\"cat\", \"Animal\":{\"SleepsAtNight\": false}}`\n)\n\nfunc main() {\n    parseAnimal(payloadOne)\n    parseAnimal(payloadTwo)\n}\n\nfunc parseAnimal(payload string) {\n    animal := &amp;Animal{}\n    if err := json.Unmarshal([]byte(payload), &amp;animal); err != nil {\n        panic(err)\n    }\n    switch animal.AnimalType {\n    case \"dog\":\n        dog := Dog{}\n        if err := json.Unmarshal(animal.Animal, &amp;dog); err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"Got a dog: %v\\n\", dog)\n    case \"cat\":\n        cat := Cat{}\n        if err := json.Unmarshal(animal.Animal, &amp;cat); err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"Got a cat: %v\\n\", cat)\n    default:\n        fmt.Println(\"Unknown animal\")\n    }\n}\n</code></pre>\n\n<p>And in action <a href=\"https://play.golang.org/p/MWTMl0HksJ\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2155, "favorite_count": 1, "accepted_answer_id": 47911600, "answer_count": 1, "score": 2, "last_activity_date": 1513791654, "creation_date": 1513790037, "question_id": 47911187, "link": "https://stackoverflow.com/questions/47911187/golang-elegantly-json-decode-different-structures", "title": "Golang elegantly JSON decode different structures", "body": "<p>I have different structures that share a field and I need to decode a JSON file into its corresponding structure in Go. </p>\n\n<p>Example:</p>\n\n<pre><code>type Dog struct {\n  AnimalType string //will always be \"dog\"\n  BarkLoudnessLevel int\n}\n\ntype Cat struct {\n  AnimalType string //will always be \"cat\"\n  SleepsAtNight bool\n}\n</code></pre>\n\n<p>If I am receiving one of these structures as a JSON string, what would be the most elegant way of parsing it into its proper structure?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1513790190, "post_id": 47911122, "comment_id": 82789998, "body": "I&#39;ve found this: <a href=\"https://stackoverflow.com/questions/14938960/what-does-a-function-without-body-mean\">What does a function without body mean?</a>, which might help you..."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 4, "last_activity_date": 1513790120, "creation_date": 1513790120, "answer_id": 47911208, "question_id": 47911122, "link": "https://stackoverflow.com/questions/47911122/where-is-time-sleep-function-declaration/47911208#47911208", "title": "Where is time.Sleep function declaration?", "body": "<p>It's in <a href=\"https://golang.org/src/runtime/time.go#L47\" rel=\"nofollow noreferrer\">runtime/time.go</a>.</p>\n\n<p>See the <a href=\"https://golang.org/cmd/compile/#hdr-Compiler_Directives\" rel=\"nofollow noreferrer\">compiler directives</a> for details on <code>go:linkname</code>.</p>\n"}], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "closed_date": 1513800307, "answer_count": 1, "score": 0, "last_activity_date": 1513796133, "creation_date": 1513789737, "question_id": 47911122, "link": "https://stackoverflow.com/questions/47911122/where-is-time-sleep-function-declaration", "closed_reason": "Duplicate", "title": "Where is time.Sleep function declaration?", "body": "<p>Here are the first lines of the file <a href=\"https://golang.org/src/time/sleep.go?s=308:330#L1\" rel=\"nofollow noreferrer\"><code>sleep.go</code></a> in the <code>time</code> package of the Go core library:</p>\n\n<pre><code>// Sleep pauses the current goroutine for at least the duration d.\n// A negative or zero duration causes Sleep to return immediately.\n\nfunc Sleep(d Duration)\n\n// runtimeNano returns the current value of the runtime clock in nanoseconds.\nfunc runtimeNano() int64\n</code></pre>\n\n<p>Why is there no declaration of the function <code>time.Sleep</code> here? Where is it?</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1513784042, "post_id": 47909478, "comment_id": 82786370, "body": "Only seed a PRNG once. I don&#39;t understand the rest, <code>time.Sleep()</code> doesn&#39;t start a new goroutine."}, {"owner": {"reputation": 327, "user_id": 7361051, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/d7e6adb336291b74ec9277ccb178f25d?s=128&d=identicon&r=PG&f=1", "display_name": "bradley", "link": "https://stackoverflow.com/users/7361051/bradley"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513784616, "post_id": 47909478, "comment_id": 82786788, "body": "Okay. My //Do stuff is running once on the first iteration, twice on the second, three times on the third and so on...how would i make it only run once everytime?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1513784633, "post_id": 47909478, "comment_id": 82786801, "body": "This will also sleep for a random duration between 0ms and 292271 millenia (on a 64-bit system; up to 24 days on 32-bit), which seems like it&#39;s probably not what you want."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513784756, "post_id": 47909478, "comment_id": 82786876, "body": "Nothing in the code quoted would cause the behavior you&#39;re describing, but there&#39;s not much to go on. Can you provide a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a> that exhibits the problem?"}, {"owner": {"reputation": 327, "user_id": 7361051, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/d7e6adb336291b74ec9277ccb178f25d?s=128&d=identicon&r=PG&f=1", "display_name": "bradley", "link": "https://stackoverflow.com/users/7361051/bradley"}, "edited": false, "score": 0, "creation_date": 1513785008, "post_id": 47909478, "comment_id": 82787045, "body": "You are correct. Figured it out after realizing it wasn&#39;t the sleep. Thank you."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1513785051, "creation_date": 1513785051, "answer_id": 47909864, "question_id": 47909478, "link": "https://stackoverflow.com/questions/47909478/golang-wait-x-amount-of-time-before-looping-again-without-starting-new-goroutin/47909864#47909864", "title": "Golang: Wait x amount of time before looping again without starting new goroutine", "body": "<p><code>for</code> loop doesn't spawn new goroutines unless you do it explicitly in cycle. By default next cycle starts only after previous is done. So you do not need any delay. Just make sure you do not use <code>go</code> keyword in your cycle.</p>\n\n<p>If you want to launch goroutines:</p>\n\n<pre><code>for {\n    rand.Seed(time.Now().UnixNano())\n    r := rand.Int()\n    //Do stuff in separate goroutine\n    go DoStuff()\n    t, _ := time.ParseDuration(string(r) + \"ms\")\n    time.Sleep(t)\n}\n</code></pre>\n\n<p>This way new goroutine will be launched.</p>\n"}, {"comments": [{"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1513842183, "post_id": 47910527, "comment_id": 82807783, "body": "I would also include <code>d := time.Duration(r) * time.Millisecond</code> in case the user needs the integer to be milliseconds. He may be limiting it somehow or the random part may be just for this question."}], "tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": false, "score": 4, "last_activity_date": 1513800719, "last_edit_date": 1513800719, "creation_date": 1513787411, "answer_id": 47910527, "question_id": 47909478, "link": "https://stackoverflow.com/questions/47909478/golang-wait-x-amount-of-time-before-looping-again-without-starting-new-goroutin/47910527#47910527", "title": "Golang: Wait x amount of time before looping again without starting new goroutine", "body": "<p>You should check the error you are currently discarding from <code>t, _ := time.ParseDuration</code>: the <code>time.Duration</code> you are passing to Sleep is in its zero value, which causes the function to sleep for 0 nanoseconds.</p>\n\n<h2>Change #1: handle the error</h2>\n\n<pre><code>    t, err := time.ParseDuration(string(r) + \"ms\")\n    if err != nil {\n        log.Println(err)\n        return\n    }\n</code></pre>\n\n<p>Resulting in:</p>\n\n<p><code>time: invalid duration \ufffdms</code></p>\n\n<p>Since you are directly casting an integer to a string, you are messing with a whole lot of unicode logic you don't really want to.</p>\n\n<h2>Change #2: use <code>strconv</code>:</h2>\n\n<pre><code>    t, err := time.ParseDuration(strconv.Itoa(r) + \"ms\")\n    if err != nil {\n        log.Println(err)\n        return\n    }\n</code></pre>\n\n<p>Result:</p>\n\n<p><code>time: invalid duration 7936209096285811603ms</code></p>\n\n<p>You get this error because <code>time.Duration</code> is represented using a <code>int64</code> for storing nanoseconds. You are trying to pass an <code>int</code> representing MILLIseconds: you will be overflowing most of the time.</p>\n\n<h2>Change #3: directly assign to the Duration</h2>\n\n<pre><code>for {\n    rand.Seed(time.Now().UnixNano())\n    r := rand.Int()\n    log.Println(r)\n    d := time.Duration(r)\n    time.Sleep(d)\n}\n</code></pre>\n\n<p>Now it works! The first integer generated by my function is 649508928394582529, which I am casting to <code>time.Duration</code> (again, this is an <code>int64</code> of nanoseconds).\nThis is approximatively 649508928 seconds: just over a week.</p>\n\n<p>It looks like a lot. But keep in mind that you were trying to use the generated <code>int</code> as milliseconds: that is 10^6 times more.</p>\n\n<h2>Change #4: Seed outside the loop</h2>\n\n<p>While we are at it, let's polish a bit:</p>\n\n<pre><code>rand.Seed(time.Now().UnixNano())\nfor {\n    r := rand.Int()\n    log.Println(r)\n    d := time.Duration(r)\n    time.Sleep(d)\n}\n</code></pre>\n\n<p>Explanation: a pseudorandom number generator is a state machine. You have to feed it a seed once, and then it will work forever. Giving it a different seed every time you run it is not improving its randomness: it's applying the same algorithm over and over on a predictable value (time). You can achieve the same exact degree of randomness by directly using <code>time.Now()Unix()</code></p>\n"}], "owner": {"reputation": 327, "user_id": 7361051, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/d7e6adb336291b74ec9277ccb178f25d?s=128&d=identicon&r=PG&f=1", "display_name": "bradley", "link": "https://stackoverflow.com/users/7361051/bradley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1860, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1513800719, "creation_date": 1513783827, "last_edit_date": 1513789317, "question_id": 47909478, "link": "https://stackoverflow.com/questions/47909478/golang-wait-x-amount-of-time-before-looping-again-without-starting-new-goroutin", "title": "Golang: Wait x amount of time before looping again without starting new goroutine", "body": "<p>I have a loop that needs to wait a random amount of time before looping again.</p>\n\n<p>What I have: </p>\n\n<pre><code>for {\n    rand.Seed(time.Now().UnixNano())\n    r := rand.Int()\n    //Do stuff\n    t, _ := time.ParseDuration(string(r) + \"ms\")\n    time.Sleep(t)\n}\n</code></pre>\n\n<p>Unfortunately, the loops run multiple times, just like if <code>time.Sleep</code> was not working.</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 817, "user_id": 293406, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/72d77d157a7ad6f6d24cae43f30f7aee?s=128&d=identicon&r=PG", "display_name": "AlexS", "link": "https://stackoverflow.com/users/293406/alexs"}, "edited": false, "score": 0, "creation_date": 1513783998, "post_id": 47909396, "comment_id": 82786349, "body": "BTW code works just fine if i create actual clientSet connected to actual cluster."}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "edited": false, "score": 0, "creation_date": 1513803042, "post_id": 47909396, "comment_id": 82796173, "body": "is that the full stacktrace?"}], "answers": [{"tags": [], "owner": {"reputation": 817, "user_id": 293406, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/72d77d157a7ad6f6d24cae43f30f7aee?s=128&d=identicon&r=PG", "display_name": "AlexS", "link": "https://stackoverflow.com/users/293406/alexs"}, "is_accepted": false, "score": 0, "last_activity_date": 1515919591, "creation_date": 1515919591, "answer_id": 48247981, "question_id": 47909396, "link": "https://stackoverflow.com/questions/47909396/k8s-newlistwatchfromclient-crashes-with-newsimpleclientset/48247981#48247981", "title": "k8s NewListWatchFromClient crashes with NewSimpleClientset", "body": "<p>Figured it out.\nk8s go lib is very hard to grasp. Lots of objects and interfaces, that duplicate themselves.</p>\n\n<p>You have to use \nNewFakeControllerSource from \"k8s.io/client-go/tools/cache/testing\"</p>\n\n<pre><code>dpl := GenerateFakeDeployment()\n\nwatchlist := fcache.NewFakeControllerSource()\nwatchlist.Add(&amp;dpl)\n\nvar expectedObj interface{}\n\nresyncPeriod := 30 * time.Minute\n\n_, eController := cache.NewInformer(\n    watchlist,\n    &amp;v1beta1.Deployment{},\n    resyncPeriod,\n    cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            expectedObj = obj\n        },\n        DeleteFunc: func(obj interface{}) {\n            expectedObj = obj\n        },\n        UpdateFunc: func(oldObj interface{}, newObj interface{}) {\n            expectedObj = oldObj\n        },\n    },\n)\nstopChan := make(chan struct{})\ngo eController.Run(stopChan)\n</code></pre>\n"}], "owner": {"reputation": 817, "user_id": 293406, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/72d77d157a7ad6f6d24cae43f30f7aee?s=128&d=identicon&r=PG", "display_name": "AlexS", "link": "https://stackoverflow.com/users/293406/alexs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1515919591, "creation_date": 1513783554, "last_edit_date": 1513788526, "question_id": 47909396, "link": "https://stackoverflow.com/questions/47909396/k8s-newlistwatchfromclient-crashes-with-newsimpleclientset", "title": "k8s NewListWatchFromClient crashes with NewSimpleClientset", "body": "<p>I am implementing tests for my kubernetis controller.\nI'm using NewSimpleClientset.\nI want to receive a single object to see whether objects are passed properly through informer.</p>\n\n<p>My Test function looks like this</p>\n\n<pre><code>func Test_TestListInformer(t *testing.T) {\n    dpl := GenerateHelloWorldDeployment()\n    clientSet := fake.NewSimpleClientset(&amp;dpl)\n    watchlist := cache.NewListWatchFromClient(clientSet.ExtensionsV1beta1().RESTClient(), \"deployments\", api_v1.NamespaceAll, fields.Everything())\n    var expectedObj interface{}\n\n    resyncPeriod := 30 * time.Minute\n\n    _, eController := cache.NewInformer(\n        watchlist,\n        &amp;v1beta1.Deployment{},\n        resyncPeriod,\n        cache.ResourceEventHandlerFuncs{\n            AddFunc: func(obj interface{}) {\n                expectedObj = obj\n            },\n            DeleteFunc: func(obj interface{}) {\n                expectedObj = obj\n            },\n            UpdateFunc: func(oldObj interface{}, newObj interface{}) {\n                expectedObj = oldObj\n            },\n        },\n    )\n    stopChan := make(chan struct{})\n    go eController.Run(stopChan)\n    time.Sleep(time.Second)\n    close(stopChan)\n\n\n}\n</code></pre>\n\n<p>it crashes </p>\n\n<pre><code>E1220 17:06:06.304112   35412 runtime.go:66] Observed a panic: \"invalid memory address or nil pointer dereference\" (runtime error: invalid memory address or nil pointer dereference)\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:72\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:65\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/runtime/runtime.go:51\n/usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:509\n/usr/local/Cellar/go/1.9.2/libexec/src/runtime/panic.go:491\n/usr/local/Cellar/go/1.9.2/libexec/src/runtime/panic.go:63\n/usr/local/Cellar/go/1.9.2/libexec/src/runtime/signal_unix.go:367\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/rest/client.go:222\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/rest/client.go:247\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/tools/cache/listwatch.go:68\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/tools/cache/listwatch.go:101\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/tools/cache/reflector.go:249\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/tools/cache/reflector.go:204\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:133\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:134\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:88\n/Users/myuser/dev/go/src/github.com//vendor/k8s.io/client-go/tools/cache/reflector.go:203\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/client-go/tools/cache/controller.go:122\n/Users/myuser/dev/go/src/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:54\n/Users/myuser/dev/go/srmyrepo/myprojc/github.com/myrepo/myproj/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:71\n/usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337\n</code></pre>\n\n<p>Deployment object that <strong>GenerateHelloWorldDeployment</strong> returns is good.\nI can retrive it with <code>clientSet.ExtensionsV1beta1().Deployments(\"\").Get(\"hello-world-deployment\",meta_v1.GetOptions{})</code></p>\n\n<p>Why does the informer crash?</p>\n"}, {"tags": ["go", "types", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513779244, "post_id": 47907751, "comment_id": 82783091, "body": "@JimB Except that this method has a parameter with a type defined in that package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1513779323, "post_id": 47907751, "comment_id": 82783136, "body": "@icza, Yeah, that wasn&#39;t worded well, I meant to highly the <i>implicitly</i> part. It should be obvious you need to import the package to put that package&#39;s type in the method."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1513780661, "post_id": 47907751, "comment_id": 82784035, "body": "This seems like an XY Problem - if you have a need to implement this specific interface, then logically <i>you must already be importing this package in your application</i>. It doesn&#39;t matter if a particular <i>file</i> imports a package, what matters is whether <i>anywhere in the application</i> imports a package."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513788395, "post_id": 47907751, "comment_id": 82789055, "body": "Then you should segregate any code that references that package into its own package. Then people that need it can import it, and those that don&#39;t won&#39;t have to take on the transient dependency."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1513849401, "last_edit_date": 1513849401, "creation_date": 1513778661, "answer_id": 47907806, "question_id": 47907751, "link": "https://stackoverflow.com/questions/47907751/implement-interface-using-custom-type-without-importing-package/47907806#47907806", "title": "Implement interface using custom type without importing package", "body": "<p>There is not.</p>\n\n<p>To implement the <code>giantpackage.CoolInterface</code>, your type must have a method:</p>\n\n<pre><code>DoSomethingAwesome(giantpackage.UselessInfo) (string, error)\n</code></pre>\n\n<p>And to have a method that matches this signature, you have to import <code>giantpackage</code>, else using any other type for the parameter, it won't match the required method.</p>\n\n<p>In your comments you indicated you plan to create a library, and providing an implementation of this interface will be a \"nice to have\" feature to <em>some</em> of the users of your library.</p>\n\n<p>Then the recommended way is to create a \"core\" package of your library which does <strong>not</strong> contain this interface implementation and thus does not depend on <code>giantpackage</code>. Users of your library that do not need this will only import your \"core\" package and so they will also not depend on <code>giantpackage</code>.</p>\n\n<p>Create another \"extension\" package of your library which will contain the implementation of this interface (and which may also use your \"core\" package if needed). Users that do need this can import this package as well.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9122984"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 47907806, "answer_count": 1, "score": 2, "last_activity_date": 1513849401, "creation_date": 1513778497, "last_edit_date": 1513782467, "question_id": 47907751, "link": "https://stackoverflow.com/questions/47907751/implement-interface-using-custom-type-without-importing-package", "title": "Implement interface using custom type without importing package", "body": "<p>Suppose there's a 3rd party package that makes an interface available:</p>\n\n<pre><code>package giantpackage\n\ntype UselessInfo struct {\n    wontUse     string\n    alsoWontUse string\n}\n\ntype CoolInterface interface {\n    DoSomethingAwesome(ui UselessInfo) (string, error)\n}\n</code></pre>\n\n<p>It seems easy to implement as such:</p>\n\n<pre><code>package main\n\nimport giantpackage\n\ntype Jedi struct {\n    name string\n    age  int\n}\n\nfunc (j Jedi) DoSomethingAwesome(ui giantpackage.UselessInfo) (string, error)\n    return \"Hello world.\", nil\n}\n</code></pre>\n\n<p><strong>Assuming:</strong><br>\n1) I don't actually use the UselessInfo struct in my DoSomethingAwesome function.<br>\n2) The package that I have to import is HUGE.<br>\n3) The package that I have to import is no longer maintained, and cannot be modified.</p>\n\n<p><strong>My question:</strong><br>\nIs there any way to implement CoolInterface without importing giantpackage?</p>\n"}, {"tags": ["c", "go", "glib"], "answers": [{"tags": [], "owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "is_accepted": true, "score": 0, "last_activity_date": 1514319253, "creation_date": 1514319253, "answer_id": 47983313, "question_id": 47907238, "link": "https://stackoverflow.com/questions/47907238/convert-glib-c-method-with-string-array-as-parameter-to-go/47983313#47983313", "title": "Convert glib C method with string array as parameter to Go", "body": "<p>This code works and does what is supposed to:</p>\n\n<pre><code>// SetStrv is a wrapper around g_settings_set_strv().\nfunc (v *Settings) SetStrv(name string, values []string) bool {\n    cstr1 := (*C.gchar)(C.CString(name))\n    defer C.free(unsafe.Pointer(cstr1))\n\n    // cvalues := C.make_strings(C.int(len(values) + 1))\n    cvalues := make([]*C.gchar, len(values))\n\n    for i, accel := range values {\n        cvalues[i] = (*C.gchar)(C.CString(accel))\n        defer C.free(unsafe.Pointer(cvalues[i]))\n    }\n    cvalues = append(cvalues, nil)\n\n    // C.set_string(cvalues, C.int(len(values)), nil)\n    return gobool(C.g_settings_set_strv(v.native(), cstr1, &amp;cvalues[0]))\n}\n</code></pre>\n\n<p>Thanks to <a href=\"https://github.com/tommyshem\" rel=\"nofollow noreferrer\">tommyshem from github</a> for his help (<a href=\"https://github.com/gotk3/gotk3/pull/225#issuecomment-353794102\" rel=\"nofollow noreferrer\">commit fix</a>).</p>\n"}], "owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 47983313, "answer_count": 1, "score": 1, "last_activity_date": 1514319253, "creation_date": 1513776762, "last_edit_date": 1513815801, "question_id": 47907238, "link": "https://stackoverflow.com/questions/47907238/convert-glib-c-method-with-string-array-as-parameter-to-go", "title": "Convert glib C method with string array as parameter to Go", "body": "<p>I am trying to add some methods to the <a href=\"https://github.com/gotk3/gotk3/tree/master/glib\" rel=\"nofollow noreferrer\">gotk3/glib</a> Go repository, but I am having troubles converting the method <a href=\"https://developer.gnome.org/gio/stable/GSettings.html#g-settings-set-strv\" rel=\"nofollow noreferrer\"><code>g_settings_set_strv</code></a> to Go; the C signature is this:</p>\n\n<pre><code>gboolean\ng_settings_set_strv (GSettings *settings,\n                     const gchar *key,\n                     const gchar *const *value);\n</code></pre>\n\n<p>And this is what I have in Go (adapted copy paste, I am not a C guy, only Java, Python, etc.):</p>\n\n<pre><code>// SetStrv is a wrapper around g_settings_set_strv().\nfunc (v *Settings) SetStrv(name string, values []string) bool {\n    cstr1 := (*C.gchar)(C.CString(name))\n    defer C.free(unsafe.Pointer(cstr1))\n\n    cvalues := C.make_strings(C.int(len(values) + 1))\n    defer C.destroy_strings(cvalues)\n\n    for i, accel := range values {\n        cstr := C.CString(accel)\n        defer C.free(unsafe.Pointer(cstr))\n        C.set_string(cvalues, C.int(i), (*C.gchar)(cstr))\n    }\n    C.set_string(cvalues, C.int(len(values)), nil)\n    return gobool(C.g_settings_set_strv(v.native(), cstr1, cvalues))\n}\n</code></pre>\n\n<p>But build fails with this message:</p>\n\n<pre><code>./settings.go:246: cannot use (*C.gchar)(cstr) (type *C.gchar) as type *C.char in argument to func literal\n./settings.go:249: cannot use cvalues (type **C.char) as type **C.gchar in argument to func literal\n</code></pre>\n\n<p>I am stuck in this...</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 316, "user_id": 8621025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a38189853a123f2a23a189d5a95997f?s=128&d=identicon&r=PG&f=1", "display_name": "rjsberry", "link": "https://stackoverflow.com/users/8621025/rjsberry"}, "edited": false, "score": 1, "creation_date": 1513775967, "post_id": 47906837, "comment_id": 82780936, "body": "Have you looked at <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">viper</a>? Rather than load your YAML data into a struct, you can make generic lookups with <code>viper.Get()</code> and type assert the return to whatever you need to. If you need &quot;dynamic&quot; access and don&#39;t want to define a struct with every possible key, you may find viper easier to use."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513776611, "post_id": 47906837, "comment_id": 82781352, "body": "A map maybe? Just a guess...."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513796345, "post_id": 47906837, "comment_id": 82793021, "body": "@Volker - thanks, there is option in the docs to <code>map[interface{}]interface{}</code>, but not sure how to use it in my context..."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1513795434, "post_id": 47907842, "comment_id": 82792597, "body": "Thanks but this is not exactly what I want, see that <code>name</code> and <code>group</code> are some kind of const and <code>a1</code> <code>b1</code> <code>z10</code> is some dynamic fields which can be many with diff key fields...can you explain with your answer how would you parse those dyanamic fields ?"}, {"owner": {"reputation": 1024, "user_id": 2702306, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/FlJhs.jpg?s=128&g=1", "display_name": "IhtkaS", "link": "https://stackoverflow.com/users/2702306/ihtkas"}, "edited": false, "score": 0, "creation_date": 1518093032, "post_id": 47907842, "comment_id": 84368403, "body": "Install is just a map. You can range(loop) through the map or write a get func which accepts a key to look up the map. You can get the dynamic fields with these functions easily."}], "tags": [], "owner": {"reputation": 1024, "user_id": 2702306, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/FlJhs.jpg?s=128&g=1", "display_name": "IhtkaS", "link": "https://stackoverflow.com/users/2702306/ihtkas"}, "is_accepted": true, "score": 2, "last_activity_date": 1513778787, "creation_date": 1513778787, "answer_id": 47907842, "question_id": 47906837, "link": "https://stackoverflow.com/questions/47906837/parse-yaml-to-struct-with-dynamic-fields/47907842#47907842", "title": "Parse yaml to struct with dynamic fields", "body": "<p>Map instead of a struct for Install will help to solve the problem. </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/go-yaml/yaml\"\n)\n\ntype File struct {\n    TypeVersion string `yaml:\"_type-version\"`\n    Dependency  []Dependency\n}\n\ntype Dependency struct {\n    Name     string\n    Type     string\n    CWD      string\n    Install  []Install\n    Requires []Requires\n}\n\ntype Install map[string]string\n\nfunc (i Install) name() string {\n    return i[\"name\"]\n}\n\nfunc (i Install) group() string {\n    return i[\"group\"]\n}\n\ntype Requires struct {\n    Name string\n    Type string\n}\n\nvar data = `\n_type-version: \"1.0.0\"\ndependency:\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n         group: test\n    requires:\n      - name: db\n      - type: mongo\n      - name: rst\n      - name: test\n      - name: test2\n`\n\nfunc main() {\n    f := File{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t:\\n%v\\n\\n\", f)\n\n    d, err := yaml.Marshal(&amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t dump:\\n%s\\n\\n\", string(d))\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1273, "favorite_count": 1, "accepted_answer_id": 47907842, "answer_count": 1, "score": 2, "last_activity_date": 1513795472, "creation_date": 1513775427, "last_edit_date": 1513795472, "question_id": 47906837, "link": "https://stackoverflow.com/questions/47906837/parse-yaml-to-struct-with-dynamic-fields", "title": "Parse yaml to struct with dynamic fields", "body": "<p>I use the following code to parse yaml to struct which works okay.\nNow let's assume that I have a struct like <code>install</code> which I know to have two const <code>properties</code> like <code>Name</code> and <code>Group</code> <strong>but</strong> in addition we can have additional <code>key val properties</code> which could change, <strong>you can get any key val properties</strong> (dynamic)</p>\n\n<p>How should I define this struct? the idea is to read the yaml file modify some values and <strong>write it back</strong> (with exact same structure with modified value) to <strong>FS</strong>, <strong>therefore</strong> I don't want to miss some dynamically fields which could be in the some yaml file which need to be modified</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/go-yaml/yaml\"\n)\n\ntype File struct {\n    TypeVersion string `yaml:\"_type-version\"`\n    Dependency []Dependency\n}\n\ntype Dependency struct {\n    Name     string\n    Type     string\n    CWD      string\n    Install  []Install\n    Requires []Requires\n}\n\ntype Install struct {\n    Name  string\n    Group string\n   //Here any key value can be\n}\n\ntype Requires struct {\n    Name string\n    Type string\n}\n\nvar data = `\n_type-version: \"1.0.0\"\ndependency:\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n         group: test\n    requires:\n      - name: db\n      - type: mongo\n      - name: rst\n      - name: test\n      - name: test2\n`\n\nfunc main() {\n    f := File{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t:\\n%v\\n\\n\", f)\n\n    d, err := yaml.Marshal(&amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t dump:\\n%s\\n\\n\", string(d))\n}\n</code></pre>\n\n<p>Example \n<code>Install</code> can be like above and also like this</p>\n\n<pre><code>    install:\n       - name: api\n         group: test\n         a1:test2\n         b1:test2\n</code></pre>\n\n<p>And also</p>\n\n<pre><code>   install:\n           - name: api\n             group: test\n             z10:123\n             zzz:111\n</code></pre>\n\n<p>And many more fields after <code>name</code> and <code>group</code></p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1513765081, "post_id": 47903531, "comment_id": 82773935, "body": "if I use dep inside docker file it tries to get my libraries files and vendor packages into docker image ? or it tries to install from github.com ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 4, "creation_date": 1513767031, "post_id": 47903531, "comment_id": 82775194, "body": "Why are you building your code inside Docker in the first place? Why not build, then just copy the executable, and any other needed artifacts, into the Docker image?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1513767971, "post_id": 47903531, "comment_id": 82775829, "body": "But to answer your question, it would install from the network typically (whether github or not, I have no idea, since I don&#39;t know what you&#39;re importing)"}, {"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1513773283, "post_id": 47903531, "comment_id": 82779156, "body": "this is for my development setup. I need to run 10 services on my machine and should be able to edit codes. I can copy and just run main.go."}, {"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1513773360, "post_id": 47903531, "comment_id": 82779204, "body": "How can I copy &quot;An alternative is just to copy the vendor directory directly in your Dockerfile&quot; because these are outside the directory of docker file. I tried with ADD ... but no file or directory found error.  Any way to copy ?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1513764698, "creation_date": 1513764698, "answer_id": 47903531, "question_id": 47903434, "link": "https://stackoverflow.com/questions/47903434/golang-build-by-copying-vendor-folder/47903531#47903531", "title": "golang build by copying vendor folder", "body": "<p>The normal way is to use a dependency manager such as <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a>.</p>\n\n<p>An alternative is just to copy the vendor directory directly in your Dockerfile, but this is not ideal, as it will copy the entire vendor directory verbatim, even if it contains old or unused imports.</p>\n"}, {"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1513882733, "creation_date": 1513882733, "answer_id": 47931157, "question_id": 47903434, "link": "https://stackoverflow.com/questions/47903434/golang-build-by-copying-vendor-folder/47931157#47931157", "title": "golang build by copying vendor folder", "body": "<p>Assuming you have a kind of monorepo setup, with vendor at the top level and then dockerfiles in each of the sub directories (/services) you could use a top level <code>docker-compose.yml</code> file (<a href=\"https://docs.docker.com/compose/\" rel=\"nofollow noreferrer\">docs</a>) to define all the services and then use volume mounts to ensure that vendor ends up inside the containers.</p>\n\n<p>Taking your example</p>\n\n<pre><code>.../repo\n - libraries\n - services\n     - service-api-signup\n          - Dockerfile\n          - main.go\n     - service-api-second\n          - ...\n - vendor\n - docker-compose.yml\n</code></pre>\n\n<p>The <code>docker-compose.yml</code> would look something like:</p>\n\n<pre><code>version: '3'\nservices:\n  service-api-signup:\n    container_name: api-signup\n    build:\n      context: ./service-api-signup\n    volumes:\n      - ./vendor:/go/src/github.com/user/services/service-api-signup/vendor\n  service-api-second:\n    container_name: api-second\n    build:\n      context: ./service-api-second\n    volumes:\n      - ./vendor:/go/src/github.com/user/services/service-api-second/vendor\n</code></pre>\n\n<p>There's also an option to override the command and entrypoint of a dockerfile allowing you to set custom scripts as the entrypoint when running through docker-compose</p>\n\n<pre><code>entrypoint: /go/src/github.com/user/services/service-api-signup\n</code></pre>\n\n<p>Maybe that script (that you would need to create and put in your repo somewhere) could make use of a live reload tool like <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">gin</a> and might look like:</p>\n\n<pre><code>#!/bin/bash\n\ngo get github.com/codegangsta/gin\n\nexec gin --immediate -appPort 8080 run\n</code></pre>\n\n<p>This would still mean that you are building the application inside docker (which in OS's that aren't linux will mean worse performance). But it does mean that you get docker-compose convenience, live reload and don't need to rebuild containers.</p>\n"}], "owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1584, "favorite_count": 0, "accepted_answer_id": 47903531, "answer_count": 2, "score": 1, "last_activity_date": 1513882733, "creation_date": 1513764409, "question_id": 47903434, "link": "https://stackoverflow.com/questions/47903434/golang-build-by-copying-vendor-folder", "title": "golang build by copying vendor folder", "body": "<p>My Project structure</p>\n\n<pre><code>/github.com/user\n - libraries\n - services\n     - service-api-signup\n          - Dockerfile\n          - main.go\n     - service-api-second\n          - ...\n - vendor\n</code></pre>\n\n<p>Docker file inside service-api-signup</p>\n\n<pre><code>FROM golang\nCOPY . /go/src/github.com/user/services/service-api-signup\n\n# need to copy all the dependencies on vendor to /go/src/github.com/..\n</code></pre>\n\n<p>How can copy all my dependencies on vendor and libraries folder to go path on docker image to build ?\n(need to copy from parent directory and build)</p>\n\n<p>Any way to setup my development environment ?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1513769473, "post_id": 47903847, "comment_id": 82776713, "body": "Thanks a lot i&#39;ll check it now and close the question. one question, assume that you have struct like <code>install</code> which you know that it have 2 const properties like <code>name</code> and <code>group</code>  but you can have additional key val properties which could change , you can get  any key val properties, how would you define this struct , the idea is to read the yaml file modify some values and write it back to fs. thanks!"}, {"owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "edited": false, "score": 0, "creation_date": 1513769951, "post_id": 47903847, "comment_id": 82777004, "body": "In the case of only modifying specific values and keeping everything else intact you might be better of not using a type and use <code>map[interface{}]interface{}</code> instead. Navigating this kind of structure is then a bit more work, but you are prepared for unforeseen properties."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1513770352, "post_id": 47903847, "comment_id": 82777248, "body": "thanks it will be great if you can add to your answer e.g. how it should look like. thanks for support!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1513795618, "post_id": 47903847, "comment_id": 82792688, "body": "Hi, see if you can help also here :) <a href=\"https://stackoverflow.com/questions/47906837/parse-yaml-to-struct-with-dynamic-fields\" title=\"parse yaml to struct with dynamic fields\">stackoverflow.com/questions/47906837/&hellip;</a>"}], "tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 1, "last_activity_date": 1513765650, "creation_date": 1513765650, "answer_id": 47903847, "question_id": 47903113, "link": "https://stackoverflow.com/questions/47903113/how-to-build-repetitive-struct/47903847#47903847", "title": "How to build repetitive struct", "body": "<p>The yaml package actually allows you to remap the the name for the properties, you can use this to handle your <code>_type-version</code> Property.\nAnd your initial question: Just define <code>Requires</code> the same as <code>Install</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/go-yaml/yaml\"\n)\n\ntype File struct {\n    TypeVersion string `yaml:\"_type-version\"`\n    Dependency []Dependency\n}\n\ntype Dependency struct {\n    Name     string\n    Type     string\n    CWD      string\n    Install  []Install\n    Requires []Requires\n}\n\ntype Install struct {\n    Name  string\n    Group string\n}\n\ntype Requires struct {\n    Name string\n    Type string\n}\n\nvar data = `\n_type-version: \"1.0.0\"\ndependency:\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n         group: test\n    requires:\n      - name: db\n      - type: mongo\n      - name: rst\n      - name: test\n      - name: test2\n`\n\nfunc main() {\n    f := File{}\n\n    err := yaml.Unmarshal([]byte(data), &amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t:\\n%v\\n\\n\", f)\n\n    d, err := yaml.Marshal(&amp;f)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n    fmt.Printf(\"--- t dump:\\n%s\\n\\n\", string(d))\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "accepted_answer_id": 47903847, "answer_count": 1, "score": 1, "last_activity_date": 1513765650, "creation_date": 1513763449, "last_edit_date": 1513763839, "question_id": 47903113, "link": "https://stackoverflow.com/questions/47903113/how-to-build-repetitive-struct", "title": "How to build repetitive struct", "body": "<p>I have a program which parses yamls file to an objects (structs).\nI use the following repo to do it </p>\n\n<p><a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a></p>\n\n<p>for example in the file I have:</p>\n\n<pre><code>dependency :\n  - name: ui\n    type: runner\n    cwd: /ui\n    install:\n       - name: api\n         group: test\n</code></pre>\n\n<p>And I use the following struct for it </p>\n\n<pre><code>type Dependency struct {\n    Name     string\n    Type     string\n    CWD      string\n    Install  []Install\n    //here I have the issue\n    Requires   ? \n}\n\ntype Install struct {\n    Name       string\n    Group      string\n}\n</code></pre>\n\n<p>Now I have two few issue with a bit complex struct.</p>\n\n<p>This is the entry which could be inside the <code>Dependency</code> struct and this is how it look in the yaml file</p>\n\n<pre><code>   requires:\n       - name: db\n       - type: mongo\n</code></pre>\n\n<p>but it also can be </p>\n\n<pre><code>requires:\n       - name: db\n       - name: rst\n       - name: test\n       - name: test2\n</code></pre>\n\n<p>Since it have multiple name properties how should I got build this struct</p>\n\n<p>In addition I've field in the yaml </p>\n\n<p><code>_type-version: \"1.0.0\"</code></p>\n\n<p>when I put it inside struct like following I got error since I use <code>-</code></p>\n\n<pre><code>type TypeVer struct{\n    _Type-version string\n}\n</code></pre>\n\n<p>How to overcome this?</p>\n"}, {"tags": ["json", "go", "post", "gorilla", "mux"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1513762822, "post_id": 47901857, "comment_id": 82772466, "body": "What does &quot;It works when I pass my JSON in String format i.e. raw text but when it Send a JSON&quot; mean? JSON is a text format and is send always as &quot;string&quot; or &quot;text&quot;. What did you do <i>exactly</i>?"}, {"owner": {"reputation": 468, "user_id": 5010637, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/73a26fdb7610d7990544113db335999c?s=128&d=identicon&r=PG", "display_name": "Rishabh Jain", "link": "https://stackoverflow.com/users/5010637/rishabh-jain"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513763043, "post_id": 47901857, "comment_id": 82772595, "body": "When I was sending data after Doing JSON.stringify(data) it worked, but when I was sending data as is . It wasn&#39;t working. But it used to work with NodeJS server"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513763510, "post_id": 47901857, "comment_id": 82772902, "body": "It sounds like your client-side code isn&#39;t producing JSON, then, and there&#39;s nothing wrong with your Go."}, {"owner": {"reputation": 468, "user_id": 5010637, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/73a26fdb7610d7990544113db335999c?s=128&d=identicon&r=PG", "display_name": "Rishabh Jain", "link": "https://stackoverflow.com/users/5010637/rishabh-jain"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513764083, "post_id": 47901857, "comment_id": 82773257, "body": "@Flimzy this is my body data -&gt;  let data = {         &quot;user&quot;: user,         &quot;password&quot;: password     }"}, {"owner": {"reputation": 468, "user_id": 5010637, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/73a26fdb7610d7990544113db335999c?s=128&d=identicon&r=PG", "display_name": "Rishabh Jain", "link": "https://stackoverflow.com/users/5010637/rishabh-jain"}, "edited": false, "score": 0, "creation_date": 1513764115, "post_id": 47901857, "comment_id": 82773281, "body": "Sending it as is is throwing 403, but stringifying it and sending is working"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1513764363, "post_id": 47901857, "comment_id": 82773447, "body": "If you want to consume JSON you must send JSON. I have no idea how Node serializes an arbitrary object. So: Simply send JSON (and not random garbage)."}], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 4, "last_activity_date": 1513766314, "creation_date": 1513766314, "answer_id": 47904089, "question_id": 47901857, "link": "https://stackoverflow.com/questions/47901857/post-request-to-golang-api-to-send-json-and-stringy-fied-json/47904089#47904089", "title": "Post request to Golang API to send JSON and stringy-fied JSON", "body": "<p>When sending JSON to any http server you always have to use <code>JSON.stringify()</code>.</p>\n\n<p>Not doing so will result in sending <code>[object Object]</code>... \nThere are client libraries that do this kind of heavy lifting for you, but behind the scenes the JSON is always send as a string.</p>\n\n<hr>\n\n<p>Node.JS handles it the same way... it receives the string representation and usually something like body parser is run on the incoming request to extract the JSON from the string. So it might happen here behind the scenes, but it still happens.</p>\n"}], "owner": {"reputation": 468, "user_id": 5010637, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/73a26fdb7610d7990544113db335999c?s=128&d=identicon&r=PG", "display_name": "Rishabh Jain", "link": "https://stackoverflow.com/users/5010637/rishabh-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1376, "favorite_count": 0, "accepted_answer_id": 47904089, "answer_count": 1, "score": 1, "last_activity_date": 1544603126, "creation_date": 1513759208, "last_edit_date": 1544603126, "question_id": 47901857, "link": "https://stackoverflow.com/questions/47901857/post-request-to-golang-api-to-send-json-and-stringy-fied-json", "title": "Post request to Golang API to send JSON and stringy-fied JSON", "body": "<p>While making a <code>POST</code> request to Golang API, if I send stringy-fied <code>JSON</code> data it returns success but when I send <code>JSON</code> data it returns error with <code>status 403</code>.</p>\n\n<p>Please help me understanding this behavior and how can I send <code>JSON</code> data using a <code>POST</code> request method.</p>\n\n<p>File: main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"devmgmtv2/auth\"\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n    auth.AuthInit(router)\n    ssid.SsidInit(router)\n    headersOk := handlers.AllowedHeaders([]string{\"X-Requested-With\"})\n    originsOk := handlers.AllowedOrigins([]string{\"*\"})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n    router.HandleFunc(\"/auth/login\", Login).Methods(\"POST\", \"OPTIONS\")\n    log.Fatal(http.ListenAndServe(\":8000\", handlers.CORS(headersOk, originsOk, methodsOk)(router)))\n}\n\nfunc Login(w http.ResponseWriter, r *http.Request) {\n    //Create User Struct\n    var user User\n    json.NewDecoder(r.Body).Decode(&amp;user)\n    userPassword := getUserPassword(user.User)\n    // call get value for that user\n    // check for equality if true, return the structure\n    // if false return error\n    if user.Password == userPassword {\n        w.Header().Set(\"Content-Type\", \"text/plain\")\n        w.Write([]byte(\"success\"))\n    } else {\n        http.Error(w, \"Forbidden\", http.StatusForbidden)\n    }\n}\n</code></pre>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 0, "creation_date": 1513757227, "post_id": 47901201, "comment_id": 82769301, "body": "<code>Could not resolve host: github.com package github.com&#47;julienschmidt&#47;httprouter: exit status 128 </code> This clearly says your docker can&#39;t find the route to the github domain (DNS). So this means your container probably doesn&#39;t have internet connection. Can you look at your iptables and check that the docker group is in here ?"}, {"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "reply_to_user": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 0, "creation_date": 1513757915, "post_id": 47901201, "comment_id": 82769635, "body": "I found this is something with https rsa keys. I plan to remove the build  inside docker."}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1513773059, "post_id": 47903107, "comment_id": 82778992, "body": "Thanks. I have some libraries outside the directory of dockerfile. How can I copy those to build it. ? I think we cannot copy parent directory. Any ways to do ?"}], "tags": [], "owner": {"reputation": 91, "user_id": 8578926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7353fb70736d80e3d62093442eb586?s=128&d=identicon&r=PG", "display_name": "z1bun", "link": "https://stackoverflow.com/users/8578926/z1bun"}, "is_accepted": true, "score": 5, "last_activity_date": 1513763710, "last_edit_date": 1513763710, "creation_date": 1513763426, "answer_id": 47903107, "question_id": 47901201, "link": "https://stackoverflow.com/questions/47901201/dockerfile-golang-build/47903107#47903107", "title": "Dockerfile golang build", "body": "<ol>\n<li>Check DNS server</li>\n<li>Check internet connection </li>\n<li><p>You can clone the repository with a script in a folder, and then copy the folder to the docker and build the project. Example</p>\n\n<pre><code>FROM golang:1.9 as builder  \nRUN mkdir -p /go/src/folder   \nWORKDIR /go/src/folder    \nCOPY src/ .  \nRUN go get -d  \nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -installsuffix cgo -o app .    \n\n\n\nFROM alpine:latest  \nWORKDIR /\nCOPY --from=builder /go/src/folder/app .  \nCMD [\"/app\"]\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1133, "favorite_count": 0, "accepted_answer_id": 47903107, "answer_count": 1, "score": 0, "last_activity_date": 1569746401, "creation_date": 1513756469, "last_edit_date": 1569746401, "question_id": 47901201, "link": "https://stackoverflow.com/questions/47901201/dockerfile-golang-build", "title": "Dockerfile golang build", "body": "<p>I am building my Go application. I am getting error like below</p>\n\n<pre><code># cd .; git clone https://github.com/julienschmidt/httprouter /go/src/github.com/julienschmidt/httprouter Cloning into\n'/go/src/github.com/julienschmidt/httprouter'... fatal: unable to\naccess 'https://github.com/julienschmidt/httprouter/': Could not\nresolve host: github.com package github.com/julienschmidt/httprouter:\nexit status 128\nThe command '/bin/sh -c go get ./' returned a non-zero code: 1\n</code></pre>\n\n<p>docker file.</p>\n\n<pre><code># install dependencies first\nRUN go get ./\n\nRUN go build\n\nCMD if [ ${APP_ENV} = production ]; \\\n    then \\\n    main; \\\n    else \\\n    go get github.com/pilu/fresh &amp;&amp; \\\n    fresh; \\\n    fi\n\nEXPOSE 8080\n</code></pre>\n\n<p>build command:</p>\n\n<pre><code>docker image build -t test:1.0 .\n</code></pre>\n\n<p>Thanks. Any help please?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 36, "user_id": 6627572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff886e6f86de701174f11cf1ae26a6a?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Di", "link": "https://stackoverflow.com/users/6627572/dave-di"}, "edited": false, "score": 0, "creation_date": 1513759687, "post_id": 47901957, "comment_id": 82770603, "body": "See Also: <a href=\"https://docs.mongodb.com/manual/reference/operator/update/positional/#up._S_\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/operator/update/positional&zwnj;&#8203;/&hellip;</a>"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 0, "creation_date": 1513761084, "post_id": 47901957, "comment_id": 82771391, "body": "Thanks for the response, But I am doing the same thing.. In the query I have tried by removing &quot;document&quot; (which I am using here to represent as object name i.e. same as the collection name) but it is not updating the object."}, {"owner": {"reputation": 36, "user_id": 6627572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff886e6f86de701174f11cf1ae26a6a?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Di", "link": "https://stackoverflow.com/users/6627572/dave-di"}, "reply_to_user": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 0, "creation_date": 1513761367, "post_id": 47901957, "comment_id": 82771551, "body": "Maybe something wrong, pls print the err value when call col.update()"}], "tags": [], "owner": {"reputation": 36, "user_id": 6627572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff886e6f86de701174f11cf1ae26a6a?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Di", "link": "https://stackoverflow.com/users/6627572/dave-di"}, "is_accepted": true, "score": 0, "last_activity_date": 1513759576, "creation_date": 1513759576, "answer_id": 47901957, "question_id": 47900206, "link": "https://stackoverflow.com/questions/47900206/why-my-query-is-not-updating-the-object-inside-an-array/47901957#47901957", "title": "Why my query is not updating the object inside an array?", "body": "<p>For simple, I delete the members.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nfunc main() {\n    session, err := mgo.Dial(\"127.0.0.1\")\n    if err != nil {\n       panic(err)\n    }\n\n    defer session.Close()\n\n    // Optional. Switch the session to a monotonic behavior.\n    session.SetMode(mgo.Monotonic, true)\n    c := session.DB(\"test\").C(\"mgo\")\n\n    cond := bson.M{\"$and\": []bson.M{bson.M{\"details\": bson.M{\"$elemMatch\": bson.M{\"category\": \"A\"}}}, bson.M{\"status\": 0}}}\n    query := bson.M{\"$set\": bson.M{\"details.$.obj.guava\": 15}}\n\n    res := []interface{}{}\n    err = c.Find(cond).All(&amp;res)\n\n    if err != nil {\n        fmt.Println(\"Before Update Read Error:\", err)\n        return\n    }\n\n    data, _ := json.MarshalIndent(res, \"\", \" \")\n    fmt.Printf(\"Before Update Read: %s\\n\", string(data))\n\n    err = c.Update(cond, query)\n\n    if err != nil {\n        fmt.Println(\"Update Error:\", err)\n        return\n    }\n\n    fmt.Println(\"Update Succeed!\")\n\n    err = c.Find(cond).All(&amp;res)\n    if err != nil {\n        fmt.Println(\"After Update Read Error:\", err)\n        return\n    }\n\n    data, _ = json.MarshalIndent(res, \"\", \" \")\n    fmt.Printf(\"After Update Read: %s\\n\", string(data))\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Before Update Read: [\n {\n  \"_id\": 2,\n  \"details\": [\n   {\n    \"category\": \"A\",\n    \"id\": 2,\n    \"obj\": {\n     \"apple\": 5,\n     \"banana\": 2,\n     \"cherry\": 10\n    }\n   }\n  ],\n  \"status\": 0\n }\n]\n\nUpdate Succeed!\n\nAfter Update Read: [\n {\n  \"_id\": 2,\n  \"details\": [\n   {\n    \"category\": \"A\",\n    \"id\": 2,\n    \"obj\": {\n     \"apple\": 5,\n     \"banana\": 2,\n     \"cherry\": 10,\n     \"guava\": 15\n    }\n   }\n  ],\n  \"status\": 0\n }\n]\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 47901957, "answer_count": 1, "score": 0, "last_activity_date": 1513763712, "creation_date": 1513752245, "last_edit_date": 1513763712, "question_id": 47900206, "link": "https://stackoverflow.com/questions/47900206/why-my-query-is-not-updating-the-object-inside-an-array", "title": "Why my query is not updating the object inside an array?", "body": "<p>I am trying to update an object inside an array of a document using mgo. The object structure is as following:</p>\n\n<pre><code>{\n\"_id\": 2,\n\"status\": 0,\n\"details\": [{\n    \"id\": 2,\n    \"category\": \"A\",\n    \"obj\": {\n        \"apple\": 5,\n        \"banana\": 2,\n        \"cherry\": 10\n    },\n    \"members\": [{\n            \"id\": 3,\n            \"category\": \"A\",\n            \"obj\": {\n                \"apple\": 5,\n                \"banana\": 2,\n                \"cherry\": 10\n            }\n        },\n        {\n            \"id\": 4,\n            \"category\": \"A\",\n            \"obj\": {\n                \"apple\": 5,\n                \"banana\": 2,\n                \"cherry\": 10\n            }\n        }\n    ]\n}]\n}\n</code></pre>\n\n<p><strong>Query1:</strong>\nI am first trying to update <code>details &gt; obj</code> where trying to add another attribute <code>\"guava\": 15</code> using the following query</p>\n\n<pre><code>cond  := bson.M{ \"$and\": []bson.M{ bson.M{\"document.details\":bson.M{ \"$elemMatch\": bson.M{ \"category\": \"A\"} } }, bson.M{\"document.status\":0} } }\nquery := bson.M{ \"$set\": bson.M{ \"document.details.$.obj.guava\":15 } }\n_, err := models.DbUpdateAll(Collection, cond, query)\n</code></pre>\n\n<p>This query is neither producing any error nor updating the doc. Can anyone please tell how can I accomplish it</p>\n\n<p><strong>Note:</strong> I have searched over google but could not find relevant to what I need.</p>\n\n<p><strong>Query2:</strong>\nI also need to update the <code>details &gt; members &gt; obj</code> the same way I am trying to do for <code>details &gt; obj</code>. Please also tell me how can I achieve the same for <code>details &gt; members &gt; obj</code>.</p>\n\n<p>I have spent hours on figuring this out but nothing worked out.  I shall be thankful if anyone could guide me.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38170, "user_id": 57135, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/S9roh.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/57135/joe"}, "edited": false, "score": 6, "creation_date": 1513740523, "post_id": 47898327, "comment_id": 82763498, "body": "That\u2019s not valid JSON. If you have a group of items you likely need them in an array, with each element separated by a comma."}, {"owner": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "reply_to_user": {"reputation": 38170, "user_id": 57135, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/S9roh.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/57135/joe"}, "edited": false, "score": 0, "creation_date": 1513740605, "post_id": 47898327, "comment_id": 82763515, "body": "Could you show me an example of what it should look like? I have looked all over the web but I am quite confused. @Joe"}, {"owner": {"reputation": 38170, "user_id": 57135, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/S9roh.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/57135/joe"}, "edited": false, "score": 2, "creation_date": 1513741087, "post_id": 47898327, "comment_id": 82763617, "body": "[ { \u201ccl\u201d:\u201d[v1]\u201d, ... }, { \u201ccl\u201d:\u201d[v2]\u201d, ... } ]"}, {"owner": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "edited": false, "score": 0, "creation_date": 1513743958, "post_id": 47898327, "comment_id": 82764170, "body": "By stream do you mean a bunch of values that keep being added? Then I intend to have a stream of values, I am storing User Data."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "edited": false, "score": 0, "creation_date": 1513776392, "post_id": 47898571, "comment_id": 82781211, "body": "How would you append to the file then? I tried unmarshaling it, adding data, then marshaling it again, but it just appends a whole new data set."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "edited": false, "score": 0, "creation_date": 1513778471, "post_id": 47898571, "comment_id": 82782583, "body": "I&#39;ll add an example in a bit"}, {"owner": {"reputation": 233, "user_id": 7754272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cfeb16e28f562b8aedfe985ce41553ab?s=128&d=identicon&r=PG&f=1", "display_name": "GoofBall101", "link": "https://stackoverflow.com/users/7754272/goofball101"}, "edited": false, "score": 0, "creation_date": 1513807979, "post_id": 47898571, "comment_id": 82798253, "body": "I&#39;m also curious about how you would append the data to the file. :)"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 233, "user_id": 7754272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cfeb16e28f562b8aedfe985ce41553ab?s=128&d=identicon&r=PG&f=1", "display_name": "GoofBall101", "link": "https://stackoverflow.com/users/7754272/goofball101"}, "edited": false, "score": 0, "creation_date": 1513808140, "post_id": 47898571, "comment_id": 82798316, "body": "@GoofBall101 my answer has been updated to append. Now if the object loading into the file is an array of json objects, what would have to be done is slightly different. You&#39;d have to open the file, unmarshal the bytes until the proper struct. Append to that struct and override that file with the marshalled contents."}, {"owner": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "edited": false, "score": 0, "creation_date": 1513811508, "post_id": 47898571, "comment_id": 82799346, "body": "Thank you. I think I had it, but I was not overriding the file. I just kept appending to the file."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1513811701, "post_id": 47898571, "comment_id": 82799399, "body": "Remove the |OS.O_APPEND from os.FileOpen. That&#39;s just a flag. The remaining two flags are to create the file if it doesn&#39;t exist and to make the file open for reading and writing. Without the append flag. Writing should override the data"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 2, "last_activity_date": 1513782094, "last_edit_date": 1513782094, "creation_date": 1513742207, "answer_id": 47898571, "question_id": 47898327, "link": "https://stackoverflow.com/questions/47898327/properly-create-a-json-file-and-read-from-it/47898571#47898571", "title": "Properly Create a JSON File and Read from It", "body": "<p>So other than the json not being formatted correctly, here is an example of how to create json using a struct and json struct tags.</p>\n\n<p>Proper JSON </p>\n\n<p>[\n  {key:value, key value},\n  {key:value, key value}\n]</p>\n\n<p>What you have is\n{key:value, key value}\n{key:value, key value}</p>\n\n<p>Which is two separate objects instead of one object in an array.</p>\n\n<p>If you are reading this from file and the data is returned like your example then you might have to split on the newline to separate each object and unmarshal them separately.</p>\n\n<p>Otherwise the below should server as an example.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"strconv\"\n)\n\ntype j struct {\n    Cl []string `json:\"cl\"`\n    Gr []string `json:\"gr\"`\n    Cr []string `json:\"cr\"`\n}\n\nfunc main() {\n    // create an instance of j as a slice\n    var data []j\n    // using a for loop for create dummy data fast\n    for i := 0; i &lt; 5; i++ {\n        v := strconv.Itoa(i)\n        data = append(data, j{\n            Cl: []string{\"foo \" + v},\n            Gr: []string{\"bar \" + v},\n            Cr: []string{\"foobar \" + v},\n        })\n    }\n\n    // printing out json neatly to demonstrate\n    b, _ := json.MarshalIndent(data, \"\", \" \")\n    fmt.Println(string(b))\n\n    // writing json to file\n\n    _ = ioutil.WriteFile(\"file.json\", b, 0644)\n\n    // to append to a file\n    // create the file if it doesn't exists with O_CREATE, Set the file up for read write, add the append flag and set the permission\n    f, err := os.OpenFile(\"/var/log/debug-web.log\", os.O_CREATE|os.O_RDWR|os.O_APPEND, 0660)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // write to file, f.Write()\n    f.Write(b)\n\n    // if you are doing alot of I/O work you may not want to write out to file often instead load up a bytes.Buffer and write to file when you are done... assuming you don't run out of memory when loading to bytes.Buffer\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 9095566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33c32bd561d265d4ecae08f758e62e8b?s=128&d=identicon&r=PG&f=1", "display_name": "HubbA", "link": "https://stackoverflow.com/users/9095566/hubba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4156, "favorite_count": 1, "accepted_answer_id": 47898571, "answer_count": 1, "score": 0, "last_activity_date": 1513782094, "creation_date": 1513740187, "last_edit_date": 1513765667, "question_id": 47898327, "link": "https://stackoverflow.com/questions/47898327/properly-create-a-json-file-and-read-from-it", "title": "Properly Create a JSON File and Read from It", "body": "<p>I am trying to create a JSON file with Golang. I have little knowledge of JSON Files and creating them but I have created a program that creates them. In this program, it takes form data from a website and then puts the data into a JSON struct, then adds the information into a folder. I have the 2 sections of data here. I put a comment where the error occurs along with the error</p>\n\n<pre><code>{\n    \"cl\":\"[v1]\",\n    \"gr\":\"[A]\",\n    \"cr\":\"[8]\"\n} // End Of File Expected\n{\n    \"cl\":\"[v2]\",\n    \"gr\":\"[Z]\",\n    \"cr\":\"[8]\"\n}\n</code></pre>\n\n<p>So my questions are (1) What does the error mean, and (2) How/can I fix this when creating a JSON file with Golang? I can supply the Golang if needed. </p>\n"}, {"tags": ["winapi", "go"], "comments": [{"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1513746172, "post_id": 47898240, "comment_id": 82764756, "body": "Look at Win32 API functions like <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633499.aspx\" rel=\"nofollow noreferrer\"><code>FindWindow()</code></a>, <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633519.aspx\" rel=\"nofollow noreferrer\"><code>GetWindowRect()</code></a>, <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633522.aspx\" rel=\"nofollow noreferrer\"><code>GetWindowThreadProcessId()</code></a>, etc"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1513765884, "post_id": 47898240, "comment_id": 82774490, "body": "Please study <a href=\"https://stackoverflow.com/search?q=%5Bwinapi%5D+enumerate+processes\">this</a> and then <a href=\"https://stackoverflow.com/questions/tagged/winapi+go\">this</a> in general. You will learn 1) how to enumerate processes running in the system; 2) how to do Win32 API calls from Go in general."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 2, "creation_date": 1513769664, "post_id": 47898240, "comment_id": 82776838, "body": "The question title and question text ask for different things. And then, the code you posted does something else again. Please read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> and fix your question."}], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": true, "score": 1, "last_activity_date": 1513769694, "creation_date": 1513769694, "answer_id": 47905117, "question_id": 47898240, "link": "https://stackoverflow.com/questions/47898240/how-to-get-windows-applications-position-and-area-such-as-google-chrome/47905117#47905117", "title": "How to get windows application&#39;s position and area (such as &quot;Google Chrome&quot;)?", "body": "<p>Despite the code you posted (which would only work under Linux), everybody seems to be assuming that you asking how it can be done under Windows.</p>\n\n<p>As @remy-lebeau mentioned you can use <code>FindWindow()</code> and <code>GetWindowRect()</code> to achieve this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    \"unsafe\"\n)\n\ntype HWND uintptr\n\ntype RECT struct {\n    Left, Top, Right, Bottom int32\n}\n\nvar (\n    user32, _     = syscall.LoadLibrary(\"user32.dll\")\n    findWindowW, _ = syscall.GetProcAddress(user32, \"FindWindowW\")\n    getWindowRect, _ = syscall.GetProcAddress(user32, \"GetWindowRect\")\n)\n\n//HWND WINAPI FindWindow(\n//  _In_opt_ LPCTSTR lpClassName,\n//  _In_opt_ LPCTSTR lpWindowName\n//);\nfunc FindWindowByTitle(title string) HWND {\n    ret, _, _ := syscall.Syscall(\n        findWindowW,\n        2,\n        0,\n        uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(title))),\n        0,\n    )\n    return HWND(ret)\n}\n\n//BOOL WINAPI GetWindowRect(\n//  _In_  HWND   hWnd,\n//  _Out_ LPRECT lpRect\n//);\nfunc GetWindowDimensions(hwnd HWND) *RECT {\n    var rect RECT\n\n    syscall.Syscall(\n        getWindowRect,\n        2,\n        uintptr(hwnd),\n        uintptr(unsafe.Pointer(&amp;rect)),\n        0,\n    )\n\n    return &amp;rect\n}\n\nfunc main() {\n    defer syscall.FreeLibrary(user32)\n\n    hwnd := FindWindowByTitle(\"New Tab - Google Chrome\")\n    fmt.Printf(\"Return: %d\\n\", hwnd)\n\n    if hwnd &gt; 0 {\n        rect := GetWindowDimensions(hwnd)\n        fmt.Printf(\"Return: %v\\n\", rect)\n    }\n}\n</code></pre>\n\n<p>Be aware that for brevity no error handling is done.</p>\n"}], "owner": {"reputation": 117, "user_id": 4172439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OjKVY.png?s=128&g=1", "display_name": "Wilon", "link": "https://stackoverflow.com/users/4172439/wilon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "closed_date": 1513784922, "accepted_answer_id": 47905117, "answer_count": 1, "score": -3, "last_activity_date": 1513857152, "creation_date": 1513739385, "last_edit_date": 1513857152, "question_id": 47898240, "link": "https://stackoverflow.com/questions/47898240/how-to-get-windows-applications-position-and-area-such-as-google-chrome", "closed_reason": "Needs details or clarity", "title": "How to get windows application&#39;s position and area (such as &quot;Google Chrome&quot;)?", "body": "<p>How can I get pid and Handle, then get the position? </p>\n\n<p>I don't have a clue about that. Please ignore the following code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"syscall\"\n)\n\nfunc main () {\n    if err := syscall.Setregid(int(233), int(233)); err != nil {\n        fmt.Println(\"setregid:\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "go", "swig", "cgo"], "comments": [{"owner": {"reputation": 55268, "user_id": 941764, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b874953e067d60b5f07bb98c74bf48c8?s=128&d=identicon&r=PG", "display_name": "jgillich", "link": "https://stackoverflow.com/users/941764/jgillich"}, "edited": false, "score": 0, "creation_date": 1513727054, "post_id": 47896459, "comment_id": 82760464, "body": "@user0042 Both, the <code>-backend</code> file is compiled with g++ but there&#39;s also a <code>libxmr-stak-c.a</code> file compiled as C. Running <code>nu</code> on the first shows lots of (mangled) symbols, it kinda sucks that ld doesn&#39;t give more details other than &quot;cannot find&quot;..."}], "answers": [{"tags": [], "owner": {"reputation": 55268, "user_id": 941764, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b874953e067d60b5f07bb98c74bf48c8?s=128&d=identicon&r=PG", "display_name": "jgillich", "link": "https://stackoverflow.com/users/941764/jgillich"}, "is_accepted": false, "score": 0, "last_activity_date": 1513728586, "creation_date": 1513728586, "answer_id": 47897032, "question_id": 47896459, "link": "https://stackoverflow.com/questions/47896459/how-do-i-link-a-c-library-with-cgo-and-swig/47897032#47897032", "title": "How do I link a C++ library with CGO and Swig?", "body": "<p>This fixed it for me:</p>\n\n<pre><code>// #cgo LDFLAGS: -L${SRCDIR} -lxmr-stak-backend\nimport \"C\"\n</code></pre>\n\n<p>Seems like I was just using ld wrong.</p>\n"}], "owner": {"reputation": 55268, "user_id": 941764, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b874953e067d60b5f07bb98c74bf48c8?s=128&d=identicon&r=PG", "display_name": "jgillich", "link": "https://stackoverflow.com/users/941764/jgillich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 575, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1513728586, "creation_date": 1513724566, "question_id": 47896459, "link": "https://stackoverflow.com/questions/47896459/how-do-i-link-a-c-library-with-cgo-and-swig", "title": "How do I link a C++ library with CGO and Swig?", "body": "<p>I want to use the C++ program <a href=\"https://github.com/fireice-uk/xmr-stak\" rel=\"nofollow noreferrer\">xmr-stak</a> in my Go program. After some research, I settled on <a href=\"http://www.swig.org/\" rel=\"nofollow noreferrer\">SWIG</a> to generate the bindings. The issue is that ld cannot find the library file. I'll just write down step by step what I did.</p>\n\n<p>I created this file at <code>src/miner/xmrstak/xmrstak.swigcxx</code> along with the source code of xmr-stak:</p>\n\n<pre><code> %module xmrstak\n %{\n#include \"xmrstak/net/jpsock.hpp\"\n#include \"xmrstak/jconf.hpp\"\n#include \"xmrstak/misc/executor.hpp\"\n %}\n\n\n%include \"xmrstak/misc/executor.hpp\"\n</code></pre>\n\n<p>Since Swig is supported by Go, it will automatically generate the bindings at build time. But Go still requires a package name, so I've just created <code>package.go</code>:</p>\n\n<pre><code>package xmrstak\n</code></pre>\n\n<p>Now, I can build this project, which results in lots of errors like:</p>\n\n<pre><code>/tmp/go-build176223381/gitlab.com/jgillich/autominer/miner/xmrstak/_obj/xmrstak_wrap.cxx.o: In function `executor::inst()':\n./xmrstak/misc/executor.hpp:35: undefined reference to `executor::executor()'\n</code></pre>\n\n<p>To fix this, it appears I need to tell ld to link the library. I've added the following to my <code>package.go</code>:</p>\n\n<pre><code>// #cgo LDFLAGS: -L${SRCDIR}/xmrstak/ -l${SRCDIR}/libxmr-stak-backend.a\nimport \"C\"\n</code></pre>\n\n<p>And copied the <code>libxmr-stak-backend.a</code> in the same folder. This file is obtained by building xmr-stak using <code>cmake . &amp;&amp; make</code> and should include everything I need (for now).</p>\n\n<p>My issue is that this doesn't actually work. I get the following output:</p>\n\n<pre><code>$ go install\n# gitlab.com/jgillich/autominer/miner/xmrstak\nxmrstak/misc/executor.hpp:43: Warning 507: No Go typemap defined for ex_event &amp;&amp;\n[further warnings ommitted]\n# gitlab.com/jgillich/autominer/miner/xmrstak\n/usr/bin/ld: cannot find -l/home/jgillich/go/src/gitlab.com/jgillich/autominer/miner/xmrstak/libxmr-stak-backend.a\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>The file however definitely exists:</p>\n\n<pre><code>$ ls\nlibxmr-stak-backend.a  package.go  xmrstak  xmrstak.swigcxx\n\n$ file /home/jgillich/go/src/gitlab.com/jgillich/autominer/miner/xmrstak/libxmr-stak-backend.a\n/home/jgillich/go/src/gitlab.com/jgillich/autominer/miner/xmrstak/libxmr-stak-backend.a: current ar archive\n</code></pre>\n\n<p>Did I do anything wrong here?</p>\n"}, {"tags": ["excel", "go"], "comments": [{"owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "edited": false, "score": 1, "creation_date": 1513738196, "post_id": 47895103, "comment_id": 82763013, "body": "If it&#39;s xlsx you can parse the relevant parts of xml using very little memory"}], "answers": [{"comments": [{"owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "edited": false, "score": 0, "creation_date": 1513721163, "post_id": 47895524, "comment_id": 82758532, "body": "my problem is memory. I have a python script that I want to port to golang. I am not sure if python reads the whole excel in memory. go: More than 1GB of memory python: a few MBs Also in python I load and process the file in 13s and in go just to read 45s."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "edited": false, "score": 1, "creation_date": 1513721741, "post_id": 47895524, "comment_id": 82758755, "body": "I suggest you file a feature request with the devs of the go library to allow for iterative modes as opposed to loading the entire sheet."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 2, "last_activity_date": 1513719291, "creation_date": 1513719291, "answer_id": 47895524, "question_id": 47895103, "link": "https://stackoverflow.com/questions/47895103/get-number-of-rows-and-number-of-columns-in-excel-sheet/47895524#47895524", "title": "Get number of rows and number of columns in Excel sheet", "body": "<p>Excel doesn't have a fixed number of columns. What you want is the largest number of columns found across all the rows.</p>\n\n<p>This is exactly what <code>Sheet.ncols</code> does.\nYou can get the same result with <code>excelize</code> by calling <code>GetRows</code>, iterating over all rows, and finding the highest count of columns across all rows.</p>\n"}, {"comments": [{"owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "edited": false, "score": 0, "creation_date": 1513724417, "post_id": 47896037, "comment_id": 82759719, "body": "nice catch. Unfortunately it reads everything in memory when you OpenFile . I will investigate a bit more"}], "tags": [], "owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "is_accepted": false, "score": 2, "last_activity_date": 1513722079, "creation_date": 1513722079, "answer_id": 47896037, "question_id": 47895103, "link": "https://stackoverflow.com/questions/47895103/get-number-of-rows-and-number-of-columns-in-excel-sheet/47896037#47896037", "title": "Get number of rows and number of columns in Excel sheet", "body": "<p>It looks like they have a function in the library that does exactly what you want, it's just not public. See <a href=\"https://github.com/360EntSecGroup-Skylar/excelize/blob/ebafbdde73e3e0498e547a2bd862552d9e304701/rows.go#L72\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I'd file a PR to see if this can be exposed publicly. The reason that memory is an issue is that the only method for getting the total number of rows/columns at the moment in the library is that a map is constructed of every single cell (see <a href=\"https://github.com/360EntSecGroup-Skylar/excelize/blob/ebafbdde73e3e0498e547a2bd862552d9e304701/rows.go#L21\" rel=\"nofollow noreferrer\"><code>GetRows</code></a>).</p>\n"}], "owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1547, "favorite_count": 0, "closed_date": 1513776281, "answer_count": 2, "score": 0, "last_activity_date": 1513743549, "creation_date": 1513717157, "last_edit_date": 1513743549, "question_id": 47895103, "link": "https://stackoverflow.com/questions/47895103/get-number-of-rows-and-number-of-columns-in-excel-sheet", "closed_reason": "Not suitable for this site", "title": "Get number of rows and number of columns in Excel sheet", "body": "<p>I am trying to read a big excel file in golang.\nI need to find the number of columns.</p>\n\n<p>I am using the <a href=\"https://godoc.org/github.com/360EntSecGroup-Skylar/excelize\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/360EntSecGroup-Skylar/excelize</a>\nlibrary but I could not find such a function.</p>\n\n<p>In python there is the <a href=\"https://xlrd.readthedocs.io/en/latest/api.html#xlrd.sheet.Sheet.ncols\" rel=\"nofollow noreferrer\">https://xlrd.readthedocs.io/en/latest/api.html#xlrd.sheet.Sheet.ncols</a></p>\n\n<p>Anything similar in Golang?</p>\n"}, {"tags": ["go", "32-bit", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1513705558, "post_id": 47892482, "comment_id": 82751509, "body": "You have to enable cgo explicitly when cross-compiling."}, {"owner": {"reputation": 143, "user_id": 7934984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b973af1f51e994b67e4e076458b9815?s=128&d=identicon&r=PG", "display_name": "putitonmytab", "link": "https://stackoverflow.com/users/7934984/putitonmytab"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513752466, "post_id": 47892482, "comment_id": 82766969, "body": "Thanks @JimB not sure how I missed that!"}], "answers": [{"tags": [], "owner": {"reputation": 143, "user_id": 7934984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b973af1f51e994b67e4e076458b9815?s=128&d=identicon&r=PG", "display_name": "putitonmytab", "link": "https://stackoverflow.com/users/7934984/putitonmytab"}, "is_accepted": false, "score": 2, "last_activity_date": 1513752411, "creation_date": 1513752411, "answer_id": 47900248, "question_id": 47892482, "link": "https://stackoverflow.com/questions/47892482/cannot-go-build-on-32-bit-linux-using-cgo/47900248#47900248", "title": "Cannot &#39;go build&#39; on 32 bit linux using cgo", "body": "<p>Thanks to JimB who has it right in the comments:</p>\n\n<blockquote>\n  <p>You have to enable cgo explicitly when cross-compiling. \u2013 JimB</p>\n</blockquote>\n\n<p>Specifically, this worked for me:</p>\n\n<pre><code>CGO_ENABLED=1 GOOS=linux GOARCH=386 go build\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 7934984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b973af1f51e994b67e4e076458b9815?s=128&d=identicon&r=PG", "display_name": "putitonmytab", "link": "https://stackoverflow.com/users/7934984/putitonmytab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1513752411, "creation_date": 1513705381, "question_id": 47892482, "link": "https://stackoverflow.com/questions/47892482/cannot-go-build-on-32-bit-linux-using-cgo", "title": "Cannot &#39;go build&#39; on 32 bit linux using cgo", "body": "<p>I am trying to build a application which will use 32bit Linux libraries via cgo (64bit version doesn't exist). </p>\n\n<p>Trying to build as 64bit doesn't work with the 32bit libraries:</p>\n\n<pre><code>[performance goListen]&gt; go build\n# goListen\n/usr/bin/ld: skipping incompatible /apps/install/tibco/tibrv/live/lib/libtibrv.so when searching for -ltibrv\n/usr/bin/ld: skipping incompatible /apps/install/tibco/tibrv/live/lib/libtibrv.a when searching for -ltibrv\n/usr/bin/ld: cannot find -ltibrv\ncollect2: ld returned 1 exit status\n</code></pre>\n\n<p>When I try to build it as 32bit it complains that there are no buildable source files:</p>\n\n<pre><code>[performance goListen]&gt; GOARCH=386 go build\ncan't load package: package goListen: no buildable Go source files in /apps/sierra/shares/sierra_aps/godev/src/goListen\n</code></pre>\n\n<p>Here is my code - I know it won't work but I just want it to try and compile!</p>\n\n<pre><code>package main\n\n/*\n#cgo !windows CFLAGS: -I/apps/install/tibco/tibrv/live/include/tibrv\n#cgo !windows LDFLAGS: -L/apps/install/tibco/tibrv/live/lib -ltibrv\n#cgo windows CFLAGS: -ID:/Rendez-vous/include/tibrv\n#cgo windows LDFLAGS: -LD:/Rendez-vous/lib -ltibrv\n#include \"tibrv.h\"\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(C.tibrv_Open())\n}\n</code></pre>\n\n<p>Any advice would be greatly appreciated.</p>\n"}, {"tags": ["c++", "c", "go", "preprocessor", "cgo"], "comments": [{"owner": {"reputation": 554, "user_id": 8199273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c74786754d406e4c09a33144d43f8beb?s=128&d=identicon&r=PG&f=1", "display_name": "tgregory", "link": "https://stackoverflow.com/users/8199273/tgregory"}, "edited": false, "score": 2, "creation_date": 1513700788, "post_id": 47890922, "comment_id": 82748735, "body": "Did you try something along the lines <code>&#47;&#47; #cgo CFLAGS: -D__cplusplus</code>?"}, {"owner": {"reputation": 55, "user_id": 3839217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8df82646de69cdd0090328e773ac0f0?s=128&d=identicon&r=PG&f=1", "display_name": "serg.dudk", "link": "https://stackoverflow.com/users/3839217/serg-dudk"}, "reply_to_user": {"reputation": 554, "user_id": 8199273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c74786754d406e4c09a33144d43f8beb?s=128&d=identicon&r=PG&f=1", "display_name": "tgregory", "link": "https://stackoverflow.com/users/8199273/tgregory"}, "edited": false, "score": 0, "creation_date": 1513702604, "post_id": 47890922, "comment_id": 82749859, "body": "@tgregory thanks for your comment! that&#39;s exactly what I need! can you post it as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 554, "user_id": 8199273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c74786754d406e4c09a33144d43f8beb?s=128&d=identicon&r=PG&f=1", "display_name": "tgregory", "link": "https://stackoverflow.com/users/8199273/tgregory"}, "is_accepted": true, "score": 1, "last_activity_date": 1513705508, "creation_date": 1513705508, "answer_id": 47892516, "question_id": 47890922, "link": "https://stackoverflow.com/questions/47890922/how-to-use-cgo-for-header-file-with-conditionally-inline-function/47892516#47892516", "title": "How to use CGO for header file with conditionally inline function?", "body": "<p>It is possible to pass some additional info to cgo via special comments. In this case <code>// #cgo CFLAGS: -D__cplusplus</code></p>\n\n<p>More info <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 55, "user_id": 3839217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8df82646de69cdd0090328e773ac0f0?s=128&d=identicon&r=PG&f=1", "display_name": "serg.dudk", "link": "https://stackoverflow.com/users/3839217/serg-dudk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 47892516, "answer_count": 1, "score": 0, "last_activity_date": 1513705508, "creation_date": 1513699882, "question_id": 47890922, "link": "https://stackoverflow.com/questions/47890922/how-to-use-cgo-for-header-file-with-conditionally-inline-function", "title": "How to use CGO for header file with conditionally inline function?", "body": "<p>I\u00b4m currently writing a Go wrapper for C api which contains header with this ifdef:</p>\n\n<pre><code>#ifdef  __cplusplus\n#define TEST_INLINE inline\n#else\n#define TEST_INLINE \n#endif\n\nTEST_INLINE int callC_inline (){\n    return 1;\n}\n</code></pre>\n\n<p>Unfortunately, I cannot change header since it's a third-party code. The code compiles fine if I pass <strong>-Wl,--allow-multiple-definition</strong> to linker, but I think it's a bad practice. So, I'm interested is there any flag I can pass to CGO or trick to satisfy <strong>#ifdef  __cplusplus</strong> condition?</p>\n\n<p>Compilation exception:</p>\n\n<pre><code>C:\\Temp\\go-build318595762\\cgo_issue\\_obj\\lib.o: In function `callC_inline':\n./lib.h:11: multiple definition of `callC_inline'\nC:\\Temp\\go-build318595762\\cgo_issue\\_obj\\main.cgo2.o:D:/work/go/cgo_issue/lib.h:11: first defined here\ncollect2.exe: error: ld returned 1 exit status\n</code></pre>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\n//#cgo CFLAGS: -std=gnu99\n//#include \"lib.h\"\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"Go call\\n\")\n    C.callC()\n}\n</code></pre>\n\n<p>lib.h:</p>\n\n<pre><code>void callC();\n\n#ifdef  __cplusplus\n#define TEST_INLINE inline\n#else\n#define TEST_INLINE \n#endif\n\nTEST_INLINE int callC_inline (){\n    return 1;\n}\n</code></pre>\n\n<p>lib.c:</p>\n\n<pre><code>#include \"lib.h\"\n#include  &lt;stdio.h&gt;\n\nvoid callC(){\n    printf(\"C call\\n\");\n}\n</code></pre>\n"}, {"tags": ["go", "cryptography", "pkcs#11", "elliptic-curve", "hsm"], "comments": [{"owner": {"reputation": 744, "user_id": 3076107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/427f1e810d9f59359639e595a74ae26d?s=128&d=identicon&r=PG&f=1", "display_name": "Egl", "link": "https://stackoverflow.com/users/3076107/egl"}, "edited": false, "score": 0, "creation_date": 1513701482, "post_id": 47890275, "comment_id": 82749144, "body": "If you can get the certificate, then you can parse it and get the public key (it&#39;s part of the information included in the certificate)."}], "answers": [{"comments": [{"owner": {"reputation": 1707, "user_id": 1127809, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/swoRv.jpg?s=128&g=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/1127809/florian"}, "edited": false, "score": 0, "creation_date": 1513729468, "post_id": 47895916, "comment_id": 82761050, "body": "But the public key is part of the certificate, no?"}, {"owner": {"reputation": 10317, "user_id": 3325704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05e4a580cb87d91c7fd3f50c9f34f31a?s=128&d=identicon&r=PG", "display_name": "jariq", "link": "https://stackoverflow.com/users/3325704/jariq"}, "reply_to_user": {"reputation": 1707, "user_id": 1127809, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/swoRv.jpg?s=128&g=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/1127809/florian"}, "edited": false, "score": 1, "creation_date": 1513756360, "post_id": 47895916, "comment_id": 82768866, "body": "@Florian Yes it is, but PKCS#11 does not parse or interpret certificate value in any other way then just store it."}], "tags": [], "owner": {"reputation": 10317, "user_id": 3325704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05e4a580cb87d91c7fd3f50c9f34f31a?s=128&d=identicon&r=PG", "display_name": "jariq", "link": "https://stackoverflow.com/users/3325704/jariq"}, "is_accepted": false, "score": 4, "last_activity_date": 1513721319, "creation_date": 1513721319, "answer_id": 47895916, "question_id": 47890275, "link": "https://stackoverflow.com/questions/47890275/how-to-get-pkcs11-publickey-via-template/47895916#47895916", "title": "How to get PKCS11 PublicKey via Template", "body": "<p>As you have already written in your question, you have created/imported only two persistent token objects - certificate object (<code>CKA_CLASS = CKO_CERTIFICATE</code>) and private key object (<code>CKA_CLASS = CKO_PRIVATE_KEY</code>) - so naturally you can find only these two objects by calling <code>FindObjectsInit</code> and <code>FindObjects</code>.</p>\n\n<p>If you want to find also a public key object (<code>CKA_CLASS = CKO_PUBLIC_KEY</code>) then you will need to create/import it first.</p>\n"}, {"tags": [], "owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "is_accepted": true, "score": 4, "last_activity_date": 1513733982, "creation_date": 1513733982, "answer_id": 47897639, "question_id": 47890275, "link": "https://stackoverflow.com/questions/47890275/how-to-get-pkcs11-publickey-via-template/47897639#47897639", "title": "How to get PKCS11 PublicKey via Template", "body": "<p>Although the public key is part of the certificate, the <code>CKO_PUBLIC_KEY</code> object may not be separately available, and there isn't a <code>CKA_PUBLIC</code> attribute either for certificates.</p>\n\n<p>To get to the public key you'll have to retrieve the <code>CKA_VALUE</code> of the certificate and parse it using your favorite X.509v3 certificate parser. The result will undoubtedly return either the encoded public key value or a public key as structure in your favorite runtime.</p>\n"}], "owner": {"reputation": 1707, "user_id": 1127809, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/swoRv.jpg?s=128&g=1", "display_name": "Florian", "link": "https://stackoverflow.com/users/1127809/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1422, "favorite_count": 0, "accepted_answer_id": 47897639, "answer_count": 2, "score": 5, "last_activity_date": 1513733982, "creation_date": 1513697526, "question_id": 47890275, "link": "https://stackoverflow.com/questions/47890275/how-to-get-pkcs11-publickey-via-template", "title": "How to get PKCS11 PublicKey via Template", "body": "<p>I have a GO Application, that stores it's certificate to a HSM via opencryptoki (pkcs11) in a softwaretoken. But it's not a go question, more a general pkcs11 question I think.</p>\n\n<p>I set my certificates and privatekey like this:</p>\n\n<pre><code>    certTemplate := []*pkcs11.Attribute{\n        pkcs11.NewAttribute(pkcs11.CKA_CLASS, pkcs11.CKO_CERTIFICATE),\n        pkcs11.NewAttribute(pkcs11.CKA_CERTIFICATE_TYPE, pkcs11.CKC_X_509),\n        pkcs11.NewAttribute(pkcs11.CKA_TOKEN, true),\n        pkcs11.NewAttribute(pkcs11.CKA_VALUE, certBytes),\n        pkcs11.NewAttribute(pkcs11.CKA_SUBJECT, template.SubjectKeyId),\n        pkcs11.NewAttribute(pkcs11.CKA_ID, pkcs11KeyID),\n    }\n\n    privateKeyTemplate := []*pkcs11.Attribute{\n        pkcs11.NewAttribute(pkcs11.CKA_CLASS, pkcs11.CKO_PRIVATE_KEY),\n        pkcs11.NewAttribute(pkcs11.CKA_KEY_TYPE, pkcs11.CKK_ECDSA),\n        pkcs11.NewAttribute(pkcs11.CKA_TOKEN, true), \n        pkcs11.NewAttribute(pkcs11.CKA_ID, pkcs11KeyID),\n        pkcs11.NewAttribute(pkcs11.CKA_EC_PARAMS, []byte{0x06, 0x08, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x03, 0x01, 0x07}),\n        pkcs11.NewAttribute(pkcs11.CKA_VALUE, ecdsaPrivKeyD),\n    }\n\nctx.CreateObject(session, certTemplate)\nctx.CreateObject(session, privateKeyTemplate)\n</code></pre>\n\n<p>This works perfectly. I can also get the Certificate via</p>\n\n<pre><code>findTemplate := []*pkcs11.Attribute{\n    pkcs11.NewAttribute(pkcs11.CKA_TOKEN, true),\n    pkcs11.NewAttribute(pkcs11.CKA_CLASS, pkcs11.CKO_CERTIFICATE),\n    pkcs11.NewAttribute(pkcs11.CKA_CERTIFICATE_TYPE, pkcs11.CKC_X_509),\n}\n\nctx.FindObjectsInit(session, findTemplate); \nobjs, b, err := ctx.FindObjects(session, numSlots)\n</code></pre>\n\n<p>But I cannot get my public key, as I expected</p>\n\n<pre><code>findTemplate := []*pkcs11.Attribute{\n        pkcs11.NewAttribute(pkcs11.CKA_TOKEN, true),\n        pkcs11.NewAttribute(pkcs11.CKA_ID, pkcs11KeyID),\n        pkcs11.NewAttribute(pkcs11.CKA_CLASS, pkcs11.CKO_PUBLIC_KEY),\n    }\nctx.FindObjectsInit(session, findTemplate); \nobj, _, err := ctx.FindObjects(session, 1)\n</code></pre>\n\n<p>There is no error, just that there are no keys in the hsm store.</p>\n"}, {"tags": ["go", "ipv6"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513691264, "post_id": 47888302, "comment_id": 82742721, "body": "You&#39;ve x&#39;ed out the IP address prefix so I can&#39;t tell, but are you sure that&#39;s a routable ipv6 address? Did you try using the <code>tcp6</code> network specifically?"}, {"owner": {"reputation": 1624, "user_id": 3577360, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/62ed0f4309cffd5b9ce23f7d8afb34d1?s=128&d=identicon&r=PG&f=1", "display_name": "Zander17", "link": "https://stackoverflow.com/users/3577360/zander17"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513691408, "post_id": 47888302, "comment_id": 82742809, "body": "@JimB I&#39;ve intentionally &quot;x&quot; the IPv6 address out. I&#39;ve doubled check to make sure the IPv6 address I&#39;m using is valid. Also, I did trying using tcp6 specifically unfortunately I still have the same issue."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513693477, "post_id": 47888302, "comment_id": 82744044, "body": "I know you x&#39;ed it out intentionally, but it&#39;s obfuscating the type of address it is. Guessing by the pattern of x&#39;s, you may be binding a non-routable address without a proper scope, which will give you this error. Is this really a valid, globally scoped address?"}, {"owner": {"reputation": 1624, "user_id": 3577360, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/62ed0f4309cffd5b9ce23f7d8afb34d1?s=128&d=identicon&r=PG&f=1", "display_name": "Zander17", "link": "https://stackoverflow.com/users/3577360/zander17"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513694242, "post_id": 47888302, "comment_id": 82744582, "body": "@JimB Sorry, you are right I was using a non-routable IPv6 address. It now works. Perhaps the error should be a little more descriptive. I appreciate your support and time."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1513696161, "last_edit_date": 1513696161, "creation_date": 1513695344, "answer_id": 47889629, "question_id": 47888302, "link": "https://stackoverflow.com/questions/47888302/golang-net-listen-ipv6/47889629#47889629", "title": "Golang net.Listen IPv6", "body": "<p>Attempting to bind a link-scoped ipv6 address without a proper scope will result in this error from the operating system. If you actually want a link-scoped address, you have to provide the proper scope id, e.g.</p>\n\n<pre><code>\"[fe80::4c3:3cff:fe4f:7e0b%eth0]:9443\"\n</code></pre>\n\n<p>Otherwise you need to use a valid globally scoped ipv6 address.</p>\n\n<pre><code>\"[2600:1f18:63ef:e802:355f:aede:dbba:2c03]:9443\"\n</code></pre>\n"}], "owner": {"reputation": 1624, "user_id": 3577360, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/62ed0f4309cffd5b9ce23f7d8afb34d1?s=128&d=identicon&r=PG&f=1", "display_name": "Zander17", "link": "https://stackoverflow.com/users/3577360/zander17"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1711, "favorite_count": 0, "accepted_answer_id": 47889629, "answer_count": 1, "score": 2, "last_activity_date": 1513696161, "creation_date": 1513690825, "question_id": 47888302, "link": "https://stackoverflow.com/questions/47888302/golang-net-listen-ipv6", "title": "Golang net.Listen IPv6", "body": "<p>I'm attempting to get IPv6 working with Golang net.Listen() however I keep getting the following error:</p>\n\n<blockquote>\n  <p>listen tcp [xxxx::xxx:xxxx:fe4f:7e0b]:9443: bind: invalid argument</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>s.Listener, err = net.Listen(\"tcp\", config.LocalNode().IP+\":\"+config.LocalNode().Port)\n</code></pre>\n\n<p>Any ideas why I'm running into this problem? IPv4 seems to work np</p>\n"}, {"tags": ["http", "go", "httprequest", "httpresponse", "http-response-codes"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1513687265, "post_id": 47887242, "comment_id": 82740160, "body": "Thats what HEAD is for."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1513687394, "post_id": 47887242, "comment_id": 82740250, "body": "@Volker I have a feeling OP is working with a RESTful webservice that uses <code>POST</code> to create a resource and returns status code 201 upon success, so in that context I can imagine why he would want to ignore the response body."}, {"owner": {"reputation": 23, "user_id": 1277284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd6ef50f3367a4010ab5ea6d57bdab8?s=128&d=identicon&r=PG", "display_name": "Erkan Erdem", "link": "https://stackoverflow.com/users/1277284/erkan-erdem"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513687548, "post_id": 47887242, "comment_id": 82740333, "body": "@Volker but I need to do POST request on the server like that. I cant use HEAD or other methods."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 2, "creation_date": 1513687696, "post_id": 47887242, "comment_id": 82740407, "body": "@ErkanErdem The response body is not &quot;downloaded&quot; until you explicitly read from res.Body, so simply closing the stream is all you need to do."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513687959, "post_id": 47887242, "comment_id": 82740560, "body": "Are you sure you need <code>POST</code> method? Purpose of this method is to <i>send data</i> to server or <i>perform</i> some action"}, {"owner": {"reputation": 23, "user_id": 1277284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd6ef50f3367a4010ab5ea6d57bdab8?s=128&d=identicon&r=PG", "display_name": "Erkan Erdem", "link": "https://stackoverflow.com/users/1277284/erkan-erdem"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1513688207, "post_id": 47887242, "comment_id": 82740732, "body": "@EmilePels i checked in mitmproxy. body is downloading here."}, {"owner": {"reputation": 23, "user_id": 1277284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd6ef50f3367a4010ab5ea6d57bdab8?s=128&d=identicon&r=PG", "display_name": "Erkan Erdem", "link": "https://stackoverflow.com/users/1277284/erkan-erdem"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513688211, "post_id": 47887242, "comment_id": 82740736, "body": "@EugeneLisitsky api owner is not me. i just write like web scrapper"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513688299, "post_id": 47887242, "comment_id": 82740790, "body": "Try to use custom http client and set very little buffer to it. Then close body"}, {"owner": {"reputation": 23, "user_id": 1277284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd6ef50f3367a4010ab5ea6d57bdab8?s=128&d=identicon&r=PG", "display_name": "Erkan Erdem", "link": "https://stackoverflow.com/users/1277284/erkan-erdem"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513688521, "post_id": 47887242, "comment_id": 82740945, "body": "@EugeneLisitsky  but I need some help with how I can do it"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513693611, "post_id": 47887242, "comment_id": 82744153, "body": "@ErkanErdem: what exactly do you need help with? You either read the body, or you don&#39;t. It&#39;s up to you, but in a full program you always need to close it."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513724694, "post_id": 47891929, "comment_id": 82759802, "body": "I&#39;m not sure I understand the second paragraph. The Client won&#39;t download the full body unless you actually read it (minus what&#39;s pulled into the relatively small buffer). If you close the body without reading it, the transport will close and discard the connection, eventually resulting an an RST if the server continues to send."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 3, "last_activity_date": 1513703640, "last_edit_date": 1513703640, "creation_date": 1513703260, "answer_id": 47891929, "question_id": 47887242, "link": "https://stackoverflow.com/questions/47887242/how-can-i-get-only-status-code-without-parsing-the-body/47891929#47891929", "title": "How can I get only status code without parsing the body?", "body": "<p>The short answer is... it's probably not possible.</p>\n\n<p>Generally speaking, an HTTP client will <em>always</em> retrieve the full response (status, headers, <em>and</em> body) for any response that includes a body since that is just how HTTP works. Note that the \"HEAD\" method specifically does what you want but since you must use the \"POST\" method it obviously doesn't apply here.</p>\n\n<p>As commenters have mentioned, in some sense you can simply ignore the response body by not reading it (as your current example does) but the client system will still incur the network cost of downloading the body - it just won't surface in your application.</p>\n\n<p>It's theoretically possible that you could implement a custom HTTP client (or perhaps configure an existing client) so that it attempts to terminate the underlying TCP connection as soon as the HTTP status is retrieved and ignores the remainder of the HTTP response; however, this strategy is likely very complicated and would be subject to a large number of factors that might be out of control of the application.</p>\n\n<p>Ultimately, your example code is probably the best you can do to pay attention only to the status code and ignore the response body. It might be worth closing the response reader immediately to indicate to the HTTP library that the associated resources are not needed and can be freed immediately; however, there's no guarantee that it would have any effect. Moreover, you might be able to configure the HTTP client to use a very small buffer for the response body in an attempt to minimize the resources used before closing the body, but again, probably no guarantee that this would actually prevent the response body from being sent over the network.</p>\n"}], "owner": {"reputation": 23, "user_id": 1277284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfd6ef50f3367a4010ab5ea6d57bdab8?s=128&d=identicon&r=PG", "display_name": "Erkan Erdem", "link": "https://stackoverflow.com/users/1277284/erkan-erdem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1481, "favorite_count": 0, "closed_date": 1513706332, "accepted_answer_id": 47891929, "answer_count": 1, "score": -1, "last_activity_date": 1608106227, "creation_date": 1513687072, "last_edit_date": 1608106227, "question_id": 47887242, "link": "https://stackoverflow.com/questions/47887242/how-can-i-get-only-status-code-without-parsing-the-body", "closed_reason": "Needs details or clarity", "title": "How can I get only status code without parsing the body?", "body": "<p>Title is say.\nI need only status code. Not response body.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    req, _ := http.NewRequest(\"POST\", \"http://api.example.com/getUserList\", nil)\n    res, _ := http.DefaultClient.Do(req) // &lt;-- 300KB Full page downloading here\n    fmt.Print(\"status code\", res.StatusCode)\n}\n</code></pre>\n\n<p>How can i interrupt response stream after got status code?\n(or its possible?)</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "google-cloud-sql", "gcp", "cloud-sql-proxy"], "answers": [{"comments": [{"owner": {"reputation": 643, "user_id": 7552759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ldvQc.jpg?s=128&g=1", "display_name": "Anurope", "link": "https://stackoverflow.com/users/7552759/anurope"}, "edited": false, "score": 0, "creation_date": 1513701686, "post_id": 47889650, "comment_id": 82749284, "body": "Thanks, I have found the <code>github.com&#47;GoogleCloudPlatform&#47;cloudsql-proxy&#47;proxy&#47;dialers&#47;&zwnj;&#8203;mysql</code> library which does exactly what I want."}, {"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1513728786, "post_id": 47889650, "comment_id": 82760866, "body": "You mentioned concerns with performance in your original question -- the performance using the library will be about the same as using the proxy through UNIX sockets."}], "tags": [], "owner": {"reputation": 1867, "user_id": 780157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8456225507a9cd4fd3abdbf8922a4be2?s=128&d=identicon&r=PG", "display_name": "defectus", "link": "https://stackoverflow.com/users/780157/defectus"}, "is_accepted": true, "score": 0, "last_activity_date": 1513695398, "creation_date": 1513695398, "answer_id": 47889650, "question_id": 47886971, "link": "https://stackoverflow.com/questions/47886971/optimal-way-to-access-cloudsql-without-the-clouds-sql-proxy/47889650#47889650", "title": "Optimal way to access CloudSQL without the clouds_sql proxy", "body": "<p>If you're on Postgresql you can use their <code>go</code> library: <a href=\"https://cloud.google.com/sql/docs/postgres/connect-external-app#go\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/postgres/connect-external-app#go</a></p>\n\n<p>For MySQL see this document:\n<a href=\"https://cloud.google.com/sql/docs/mysql/connect-external-app#go\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/mysql/connect-external-app#go</a></p>\n\n<p>Haven't tested this approach (that would vendor lock me to gcloud) but their documentation tends to be reliable and up to date.</p>\n"}], "owner": {"reputation": 643, "user_id": 7552759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ldvQc.jpg?s=128&g=1", "display_name": "Anurope", "link": "https://stackoverflow.com/users/7552759/anurope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 0, "accepted_answer_id": 47889650, "answer_count": 1, "score": 0, "last_activity_date": 1513695398, "creation_date": 1513686190, "question_id": 47886971, "link": "https://stackoverflow.com/questions/47886971/optimal-way-to-access-cloudsql-without-the-clouds-sql-proxy", "title": "Optimal way to access CloudSQL without the clouds_sql proxy", "body": "<p>I'm writing a service (Golang) that is meant to access a CloudSQL database.</p>\n\n<p>The recommended way to connect to the CloudSQL instance is to use the cloud_sql proxy - to authenticate with the database and handle the SSL.</p>\n\n<p>However, for performance and few other reasons I would like to access the database directly using a Golang package that handles the authentication. </p>\n\n<p>Currently, using the <code>database/sql</code> package to initiate a connection to the database won't work because I need to whitelist the machine IP with CloudSQL. But given that I'm using Kubernetes to deploy my application, the origin IP could change at any moment.</p>\n\n<p>I'd love to know if anyone knows what would be the best way of going about solving this problem.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1513685416, "post_id": 47886499, "comment_id": 82739022, "body": "Manually, there is no help from the Go tool suite here."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513685567, "post_id": 47886499, "comment_id": 82739118, "body": "@volker so it seam that I should erase the content of <code>bin</code> and <code>pkg</code> and call <code>go install all</code> ? I currently don&#39;t have any to try out. I&#39;m installing a new host."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 2, "creation_date": 1513686306, "post_id": 47886499, "comment_id": 82739559, "body": "@scott that feels unsafe. I just want to recompile everything. The reason is that if I don&#39;t do that, I may see behavior that people using a clean compilation with the latest version don&#39;t see."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1513687100, "post_id": 47886499, "comment_id": 82740043, "body": "I just tried <code>go install all</code> on a fresh install with binaries and I get an error : <code>go install cmd&#47;vendor&#47;github.com&#47;google&#47;pprof: open &#47;usr&#47;local&#47;go&#47;bin&#47;pprof: permission denied</code>. I had to untar as root in <code>&#47;usr&#47;local</code>. In <code>go help packages</code> it said that <code>all</code> is used to identify packages in the <code>$GOPATH</code>. This is confusing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513691538, "post_id": 47886499, "comment_id": 82742888, "body": "The <code>all</code> target rebuild some tools in GOROOT too. If you don&#39;t want to do that, then you just rebuild what you&#39;re interested in. If you want to make sure all <i>dependencies</i> of a package are rebuilt, then use the install <code>-a</code> flag."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1513696353, "post_id": 47886499, "comment_id": 82746002, "body": "I would strongly advise against @ScottStensland&#39;s advice. There is absolutely no reason at all to delete source in this case, and the potential for losing changes in progress in various projects you may have checked out isn&#39;t worth the risk."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1520514274, "post_id": 47886499, "comment_id": 85352470, "body": "have you tried go build -a?, i remember that fixing your problem in previous go versions"}], "answers": [{"tags": [], "owner": {"reputation": 104, "user_id": 7469282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaf85426fc47cf34f1fceed8bbe6fea0?s=128&d=identicon&r=PG&f=1", "display_name": "Francisco Claude", "link": "https://stackoverflow.com/users/7469282/francisco-claude"}, "is_accepted": false, "score": 3, "last_activity_date": 1522787428, "creation_date": 1522787428, "answer_id": 49638662, "question_id": 47886499, "link": "https://stackoverflow.com/questions/47886499/recompile-all-packages-after-upgrading-go/49638662#49638662", "title": "Recompile all packages after upgrading Go?", "body": "<p>Assuming you have a single GOPATH path, you can update all packages by running this:</p>\n\n<p><code>cd $GOPATH/src\ngo get -u -v ./...\n</code></p>\n\n<p>If you have multiple GOPATHs you need to go into the <code>src</code> folder of each one of them and run:</p>\n\n<p><code>go get -u -v ./...\n</code></p>\n\n<p>Then run <code>go install all</code></p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1760, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1522787428, "creation_date": 1513684650, "question_id": 47886499, "link": "https://stackoverflow.com/questions/47886499/recompile-all-packages-after-upgrading-go", "title": "Recompile all packages after upgrading Go?", "body": "<p>After I upgraded Go, how do I make sure all my packages in <code>$GOPATH/pkg</code> and binaries in <code>$GOPATH/bin</code> are recompiled using the new version ? </p>\n\n<p>I would like that any upgrade errors are reported as warnings, not errors causing the operation to abort. </p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore", "datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1513676308, "post_id": 47883783, "comment_id": 82733521, "body": "You gotta give more details than that. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1513679966, "post_id": 47883783, "comment_id": 82735844, "body": "I am Just editing my post with details"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515159562, "post_id": 47886646, "comment_id": 83205392, "body": "Thank you for your help  But I have a conflict that the end user should search with either PHONE or FIRSTNAME or LASTNAME of the patient. can you help me how to  solve this."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515159672, "post_id": 47886646, "comment_id": 83205459, "body": "@SrinathReddy You mean only one condition is used in the query, or there are multiple conditions with logical OR connection in one query?"}, {"owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515160038, "post_id": 47886646, "comment_id": 83205687, "body": "with logical OR connection in one query"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515160492, "post_id": 47886646, "comment_id": 83205955, "body": "@SrinathReddy Datastore queries generally do not support logical OR connection. I believe some support was added but what it does is it runs multiple queries in parallel, and merges the result. I don&#39;t think the Golang query API contains this though. Your best bet is to run those multiple queries yourself, and merge the results."}, {"owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515162081, "post_id": 47886646, "comment_id": 83206861, "body": "Really i don&#39;t have any solution for my problem"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515162216, "post_id": 47886646, "comment_id": 83206953, "body": "@SrinathReddy If for example you want patients where firstName is &quot;Bob&quot; OR lastName is &quot;Smith&quot;, then you run 2 queries: one where you only filter by <code>firstname=Bob</code>, and the other where you only filter by <code>lastName=Smith</code>. Now you have 2 patient slices, and you &quot;merge&quot; these by appending patients from the 2nd slice to the first that are not yet in the first slice. And the result will be the first slice."}, {"owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515166419, "post_id": 47886646, "comment_id": 83209451, "body": "I am new to the coding .can you help me to sort out the solution"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "edited": false, "score": 0, "creation_date": 1515166606, "post_id": 47886646, "comment_id": 83209586, "body": "@SrinathReddy You should post that as a new, follow-up question, linking to this as the original."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1513685132, "creation_date": 1513685132, "answer_id": 47886646, "question_id": 47883783, "link": "https://stackoverflow.com/questions/47883783/unable-to-get-the-record-based-on-struct-value-from-datastore-using-golang/47886646#47886646", "title": "Unable to get the record based on struct value from datastore using golang", "body": "<p><a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/reference#Get\" rel=\"nofollow noreferrer\"><code>datastore.Get()</code></a> can only be used to get an entity from the datastore by its key, so its key must be known / present.</p>\n\n<p>This is obviously not what you're trying to do. You are trying to fetch entities by properties which are not the key. To do that, you need to run a <em>query</em>.</p>\n\n<p>Datastore queries are represented by the <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/reference#Query\" rel=\"nofollow noreferrer\"><code>datastore.Query</code></a> type. You need to create a query and set filters on it. In your case, you want to filter by the username and/or phone properties.</p>\n\n<p>This is how it could look like. Fetch patient entities filtered by phone:</p>\n\n<pre><code>q :=  datastore.NewQuery(\"Patient\").Filter(\"phone =\", patient.Phone)\n\nvar patients []*Patient\nkeys, err := q.GetAll(ctx, &amp;patients)\nif err != nil {\n    // Handle error\n    return\n}\n\n// patients contains patients with the given phone number\n</code></pre>\n\n<p>An example fetching patients filtered by phone number AND user name:</p>\n\n<pre><code>q :=  datastore.NewQuery(\"Patient\").\n    Filter(\"phone =\", patient.Phone).\n    Filter(\"username =\", patient.UserName)\n\nvar patients []*Patient\nkeys, err := q.GetAll(ctx, &amp;patients)\nif err != nil {\n    // Handle error\n    return\n}\n\n// patients contains patients with the given phone number and username\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 8295662, "user_type": "registered", "profile_image": "https://graph.facebook.com/1187650834683871/picture?type=large", "display_name": "Srinath Reddy", "link": "https://stackoverflow.com/users/8295662/srinath-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 47886646, "answer_count": 1, "score": 2, "last_activity_date": 1513766828, "creation_date": 1513675778, "last_edit_date": 1513766828, "question_id": 47883783, "link": "https://stackoverflow.com/questions/47883783/unable-to-get-the-record-based-on-struct-value-from-datastore-using-golang", "title": "Unable to get the record based on struct value from datastore using golang", "body": "<p>I am writing a service for search functionality.  when i am passing values in the body to get the specific record i am unable to get it based on the struct value.\nex:phone number or username</p>\n\n<p><strong>Edit1:</strong></p>\n\n<pre><code>type PatientData struct {\n    ID            int64    datastore:\"-\"\n    FirstName     string   json:\"firstname,omitempty\"\n    LastName      string   json:\"lastname,omitempty\"\n    UserName      string   json:\"username,omitempty\"\n    Phone         string   json:\"phone,omitempty\"     \n}\n</code></pre>\n\n<p>I want to get the full struct values based on Username or Phone. Below is  my code:</p>\n\n<pre><code>func searchValue (res http.ResponseWriter, req *http.Request){\n\n    log.Printf(\"%#v Getting values url - x \", \"called search\")\n\n    patient := &amp;PatientData{}\n    if err := json.NewDecoder(req.Body).Decode(patient); err != nil {\n        panic(err)\n    }\n    ctx := appengine.NewContext(req)\n    ctx, err := appengine.Namespace(ctx, NAMESPACENAME)\n    if err != nil {\n        panic(err)\n    }\n\n    m := patient.Phone\n    i, err := strconv.ParseInt(m, 10, 64)\n    log.Printf(\"%#v Getting values m \", m)\n    log.Printf(\"%#v Getting values url -yyy \",i)\n\n    key := datastore.NewKey(ctx, \"Patient\",\"\" , i, nil)\n    log.Printf(\"%#v Getting values url - key \", key)\n    err = datastore.Get(ctx, key, patient)\n    if err := json.NewEncoder(res).Encode(patient); err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n\n<p>As i am passing PHONE in my Newkey i am unable to generate  the values based on PHONE</p>\n\n<p>I don't want to use Newkey in put functionality to generate a keyname and based on that KEYNAME i dont want to get Values.</p>\n"}, {"tags": ["go", "serialization"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1513669300, "creation_date": 1513669300, "answer_id": 47882114, "question_id": 47881732, "link": "https://stackoverflow.com/questions/47881732/serialize-struct-fields-to-pre-existing-slice-of-bytes/47882114#47882114", "title": "Serialize struct fields to pre existing slice of bytes", "body": "<p>Given the preallocated buffer <code>buf</code>, you can reverse the process like this:</p>\n\n<pre><code>buf[0] = byte(40+len(userSession.Username))\nbinary.LittleEndian.PutUint32(buf[1:], uint32(int32(userSession.UID)))\ncopy(buf[5:41], userSession.UUID)\ncopy(buf[41:], userSession.Username)\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8725011"}, "is_accepted": false, "score": 0, "last_activity_date": 1513672939, "creation_date": 1513672939, "answer_id": 47882970, "question_id": 47881732, "link": "https://stackoverflow.com/questions/47881732/serialize-struct-fields-to-pre-existing-slice-of-bytes/47882970#47882970", "title": "Serialize struct fields to pre existing slice of bytes", "body": "<p>Given two helper functions.</p>\n\n<p>One to encode a primitive to a byte slice:\n</p>\n\n<pre><code>func EncodeNumber2NetworkOrder(v interface{}) ([]byte, error) {\n   switch v.(type) {\n   case int: // int is at least 32 bits\n       b := make([]byte, 4)\n       binary.BigEndian.PutUint32(b, uint32(v.(int)))\n       return b, nil\n   case int8:\n       b := []byte{byte(v.(int8))}\n       return b, nil\n   // ... truncated\n</code></pre>\n\n<p>and one to convert primitive, non-byte slices to a byte slice\n</p>\n\n<pre><code>func EncodeBigEndian(in []float64) []byte {\n   var out []byte = make([]byte, len(in)*8)\n   var wg sync.WaitGroup\n\n   wg.Add(len(in))\n   for i := 0; i &lt; len(in); i++ {\n       go func(out *[]byte, i int, f float64) {\n           defer wg.Done()\n           binary.BigEndian.PutUint64((*out)[(i&lt;&lt;3):], math.Float64bits(f))\n       }(&amp;out, i, in[i])\n   }\n   wg.Wait()\n\n   return out\n}\n</code></pre>\n\n<p>your binary serialization might look like this for a bogus struct like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code> type Foo struct {\n     time int64\n     data []float64\n }\n\n func Encode(f *Foo) []byte {\n    da := encoder.EncodeBigEndian(f.data)\n    bytes := make([]byte,0)\n    bytes = append(bytes, da...)\n    return bytes\n }\n</code></pre>\n"}], "owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 47882114, "answer_count": 2, "score": 0, "last_activity_date": 1513673734, "creation_date": 1513667608, "last_edit_date": 1513673734, "question_id": 47881732, "link": "https://stackoverflow.com/questions/47881732/serialize-struct-fields-to-pre-existing-slice-of-bytes", "title": "Serialize struct fields to pre existing slice of bytes", "body": "<p>I have a setup where I receive data over the network and serialize it to my struct. It works fine, but now I need to serialize the data to a slice buffer to send it across the network.</p>\n\n<p>I am trying to avoid having to allocate more than needed so I have already set up a buffer which I like to write to for all my serializing. But am not sure how to do this.</p>\n\n<p>My setup is like this:</p>\n\n<pre><code>recieveBuffer := make([]byte, 1500)\nheader := recieveBuffer[0:1]\nmessage := recieveBuffer[1:]\n</code></pre>\n\n<p>So I am trying to write fields from a struct to <code>message</code> and the total number of bytes for all the fields as a value for <code>header</code>.</p>\n\n<p>This was how I deserialized to the struct:</p>\n\n<pre><code>// Deserialize ...\nfunc (userSession *UserSession) Deserialize(message []byte) {\n    userSession.UID = int64(binary.LittleEndian.Uint32(message[0:4]))\n    userSession.UUID = string(message[4:40])\n    userSession.Username = string(message[40:])\n}\n</code></pre>\n\n<p>I don't really know how to do the reverse of this, however. Is it possible without creating buffers for each field I want to serialize before copying to <code>message</code>?</p>\n"}, {"tags": ["docker", "go", "google-api", "google-custom-search"], "comments": [{"owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "edited": false, "score": 1, "creation_date": 1513681510, "post_id": 47879823, "comment_id": 82736743, "body": "To get more information to work with you can enable debug printouts for Go&#39;s http library, set the env variable <code>GODEBUG=http2debug=2</code>. With the scratch image it should work to do: <code>docker run --env=&quot;GODEBUG=http2debug=2&quot; my-image</code>"}, {"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "reply_to_user": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "edited": false, "score": 0, "creation_date": 1513688004, "post_id": 47879823, "comment_id": 82740591, "body": "@johlo Cool never know you could do that  Added Output to edit"}, {"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "reply_to_user": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "edited": false, "score": 0, "creation_date": 1513688243, "post_id": 47879823, "comment_id": 82740756, "body": "I&#39;m nit sure if this is a Docker issue or a Go issue"}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "edited": false, "score": 1, "creation_date": 1513720294, "post_id": 47879823, "comment_id": 82758217, "body": "have you mounted /etc/ssl/certs from the host? (like docker -v /etc/ssl/certs) ? does it have a client cert in there ? i would expect that you need the ca cert to verify the other endpoint and then the client cert for your session."}, {"owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "reply_to_user": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "edited": false, "score": 0, "creation_date": 1513785421, "post_id": 47879823, "comment_id": 82787344, "body": "Most likely there&#39;s some certificate problem, you should try @ramrunner&#39;s suggestion and try to mount/copy the hosts certificates in the container."}], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4038, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1513688058, "creation_date": 1513655787, "last_edit_date": 1513688058, "question_id": 47879823, "link": "https://stackoverflow.com/questions/47879823/getting-stream-error-stream-id-1-protocol-error-when-using-google-search-api-i", "title": "Getting stream error: stream ID 1; PROTOCOL_ERROR when using Google Search API in Golang in a Container", "body": "<p>When using a Go program inside of a docker swarm service I get a 400 status and an error message <code>stream ID 1; PROTOCOL_ERROR</code> when I call a <code>client.Get(url)</code> ) I get a 200 and the results when I <code>go run *.go</code>. I use a \"Bundle of CA Root Certificates\" inside of the container from Mozilla. Any Help Appreciated. My code is below.</p>\n\n<pre><code>client := &amp;http.Client{Timeout: 30 * time.Second, Transport: &amp;http.Transport{\n        DisableCompression: true,\n        DisableKeepAlives:  true,\n    }}\n\n    r, err := client.Get(url)\n    if err != nil {\n        return err\n    }\n    defer r.Body.Close()\n    bodyBytes, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        fmt.Println(url, err) // The Google Search url and err: stream error: stream ID 1; PROTOCOL_ERROR\n\n        return err\n    }\n    fmt.Println(r.StatusCode, string(bodyBytes))\n\n    return json.NewDecoder(r.Body).Decode(target)\n</code></pre>\n\n<p>My Dockerfile:</p>\n\n<pre><code>FROM scratch\n\nADD ca-certificates.crt /etc/ssl/certs/\n\nENV MODE=production\n\nADD main /\nCMD [\"/main\"]\n</code></pre>\n\n<p>Edit:\nOutput from Debug</p>\n\n<pre><code>mycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport creating client conn 0xc42030b340 to 172.217.2.234:443\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: wrote SETTINGS len=18, settings: ENABLE_PUSH=0, INITIAL_WINDOW_SIZE=4194304, MAX_HEADER_LIST_SIZE=10485760\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: wrote WINDOW_UPDATE len=4 (conn) incr=1073741824\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport encoding header \":authority\" = \"www.googleapis.com\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport encoding header \":method\" = \"GET\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport encoding header \":path\" = \"/customsearch/v1?key=hidingmykey&amp;cx=hidingmycx&amp;q=liquid+nitrogen&amp;num=10&amp;start=1\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport encoding header \":scheme\" = \"https\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport encoding header \"user-agent\" = \"Go-http-client/2.0\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: wrote HEADERS flags=END_STREAM|END_HEADERS stream=1 len=140\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: read SETTINGS len=18, settings: MAX_CONCURRENT_STREAMS=100, INITIAL_WINDOW_SIZE=1048576, MAX_HEADER_LIST_SIZE=16384\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport received SETTINGS len=18, settings: MAX_CONCURRENT_STREAMS=100, INITIAL_WINDOW_SIZE=1048576, MAX_HEADER_LIST_SIZE=16384\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: wrote SETTINGS flags=ACK len=0\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: read WINDOW_UPDATE len=4 (conn) incr=983041\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport received WINDOW_UPDATE len=4 (conn) incr=983041\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: read SETTINGS flags=ACK len=0\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport received SETTINGS flags=ACK len=0\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: read HEADERS flags=END_HEADERS stream=1 len=72\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: decoded hpack field header field \":status\" = \"400\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: decoded hpack field header field \"content-type\" = \"text/html; charset=UTF-8\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: decoded hpack field header field \"referrer-policy\" = \"no-referrer\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: decoded hpack field header field \"content-length\" = \"1555\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: decoded hpack field header field \"date\" = \"Tue, 19 Dec 2017 12:50:17 GMT\"\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport received HEADERS flags=END_HEADERS stream=1 len=72\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: read RST_STREAM stream=1 len=4 ErrCode=PROTOCOL_ERROR\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Transport received RST_STREAM stream=1 len=4 ErrCode=PROTOCOL_ERROR\nmycontainer.1.jdl70gy26uds@moby    | 2017/12/19 12:50:16 http2: Framer 0xc4204862a0: wrote RST_STREAM stream=1 len=4 ErrCode=CANCEL\n</code></pre>\n"}, {"tags": ["go", "delve", "goland"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1513649315, "post_id": 47879070, "comment_id": 82724149, "body": "What debugger are you using?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1513673810, "post_id": 47879070, "comment_id": 82732081, "body": "&quot;Is there an equivalent in Go?&quot; One would hope not. Code should behave the same while debugging as when not. Otherwise, you&#39;re not properly debugging."}, {"owner": {"reputation": 618, "user_id": 813016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0335bf86ceb7796caabc3bf417b6b03?s=128&d=identicon&r=PG", "display_name": "Philip Beber", "link": "https://stackoverflow.com/users/813016/philip-beber"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513696290, "post_id": 47879070, "comment_id": 82745958, "body": "Thanks @Adrian, I updated the question."}, {"owner": {"reputation": 618, "user_id": 813016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0335bf86ceb7796caabc3bf417b6b03?s=128&d=identicon&r=PG", "display_name": "Philip Beber", "link": "https://stackoverflow.com/users/813016/philip-beber"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1513696441, "post_id": 47879070, "comment_id": 82746058, "body": "@Flimzy - debugged code will execute slower than non-debugged code. This seems unavoidable to me. Are you suggesting to &quot;properly debug&quot; that I step through the code at 10,000 lines per second?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513696931, "post_id": 47879070, "comment_id": 82746342, "body": "Check the GoLand documentation. I know in the case of Delve, you can pass build tags in the <code>dlv</code> command, which you could use to switch behavior to be more debug-able."}, {"owner": {"reputation": 4411, "user_id": 133665, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/5aca5471e63b2db8107f171752ca2e04?s=128&d=identicon&r=PG", "display_name": "HuBeZa", "link": "https://stackoverflow.com/users/133665/hubeza"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576748773, "post_id": 47879070, "comment_id": 105001883, "body": "@Flimzy it could be easily abused, but it can make debugging much more practical. For instance, I like to increase timeouts when debugging."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576749597, "post_id": 47879070, "comment_id": 105002295, "body": "That&#39;s easily done without using evil anti-patterns, too."}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 7, "last_activity_date": 1570474703, "last_edit_date": 1570474703, "creation_date": 1513697522, "answer_id": 47890273, "question_id": 47879070, "link": "https://stackoverflow.com/questions/47879070/how-can-i-see-if-the-goland-debugger-is-running-in-the-program/47890273#47890273", "title": "How can I see if the GoLand debugger is running in the program?", "body": "<p>As far as I know, there is no built-in way to do this in the manner you described. But you can do more or less the same using build tags to indicate that the delve debugger is running. You can pass build tags to <code>dlv</code> with the <code>--build-flags</code> argument. This is basically the same technique as I described in <a href=\"https://stackoverflow.com/a/44944960/660921\">How can I check if the race detector is enabled at runtime?</a></p>\n\n<p><code>isdelve/delve.go</code></p>\n\n<pre><code>// +build delve\n\npackage isdelve\n\nconst Enabled = true\n</code></pre>\n\n<p><code>isdelve/nodelve.go</code>:</p>\n\n<pre><code>// +build !delve\n\npackage isdelve\n\nconst Enabled = false\n</code></pre>\n\n<p><code>a.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"isdelve\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"delve\", isdelve.Enabled)\n}\n</code></pre>\n\n<p>In Goland, you can enable this under 'Run/Debug Configurations', by adding the following into 'Go tool arguments:'</p>\n\n<pre><code>-tags=delve\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/fPKA2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fPKA2.png\" alt=\"Goland Run/Debug Configurations window\"></a></p>\n\n<hr>\n\n<p>If you are outside of Goland, running <code>go run a.go</code> will report <code>delve false</code>, if you want to run dlv on its own, use\n<code>dlv debug --build-flags='-tags=delve' a.go</code>; this will report <code>delve true</code>.</p>\n\n<hr>\n\n<p>Alternatively, you can use delve's <code>set</code> command to manually set a variable after starting the debugger.</p>\n"}, {"tags": [], "owner": {"reputation": 513, "user_id": 514248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5df6d280d6e587f4a85a3692f8d55e4d?s=128&d=identicon&r=PG", "display_name": "John Rusk - MSFT", "link": "https://stackoverflow.com/users/514248/john-rusk-msft"}, "is_accepted": true, "score": 1, "last_activity_date": 1592031243, "creation_date": 1592031243, "answer_id": 62356533, "question_id": 47879070, "link": "https://stackoverflow.com/questions/47879070/how-can-i-see-if-the-goland-debugger-is-running-in-the-program/62356533#62356533", "title": "How can I see if the GoLand debugger is running in the program?", "body": "<p>If you assume that the debugger used will be Delve, you can check on the Delve process(es). There are at least two cases to consider (maybe more).</p>\n\n<ol>\n<li>Delve launched your process. In this case, when you call <code>os.Getppid()</code> to get the pid of your parent process, that process will be Delve.</li>\n<li>Delve didn't launch your process, but did attach to it later. In this case, you'd need to look for all running Delve processes, look at their command lines, and see if any was launched with a command line including \"attach \", where  is the result of calling <code>os.Getpid()</code>. This relies on the assumption that you're not finding an old Delve, running with an older PID that happens to match yours. (I forget what the rules on on reuse of PIDs by the OS).  </li>\n</ol>\n\n<p>Note that the os functions used by 1 and 2 are different. One gets the parent PID, the other gets your PID.</p>\n\n<p>Some very basic code to do 1 looks like this:</p>\n\n<pre><code>func isLaunchedByDebugger() bool {\n    // gops executable must be in the path. See https://github.com/google/gops\n    gopsOut, err := exec.Command(\"gops\", strconv.Itoa(os.Getppid())).Output()\n    if err == nil &amp;&amp; strings.Contains(string(gopsOut), \"\\\\dlv.exe\") {\n        // our parent process is (probably) the Delve debugger\n        return true\n    }\n    return false\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 618, "user_id": 813016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0335bf86ceb7796caabc3bf417b6b03?s=128&d=identicon&r=PG", "display_name": "Philip Beber", "link": "https://stackoverflow.com/users/813016/philip-beber"}, "edited": false, "score": 1, "creation_date": 1598843029, "post_id": 63291864, "comment_id": 112578738, "body": "Thanks but I&#39;m not sure what this has to do with my question. I wasn&#39;t asking about attaching a debugger. I want to know if a debugger is attached already."}], "tags": [], "owner": {"reputation": 31, "user_id": 5406102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/260fde88de7a7062d8347cd5ffde5a6c?s=128&d=identicon&r=PG&f=1", "display_name": "kosta", "link": "https://stackoverflow.com/users/5406102/kosta"}, "is_accepted": false, "score": 0, "last_activity_date": 1596749659, "last_edit_date": 1596749659, "creation_date": 1596748636, "answer_id": 63291864, "question_id": 47879070, "link": "https://stackoverflow.com/questions/47879070/how-can-i-see-if-the-goland-debugger-is-running-in-the-program/63291864#63291864", "title": "How can I see if the GoLand debugger is running in the program?", "body": "<p>For case 2 we can set the program to wait for some signal (SIGUSR1) and attach debugger during this wait.<br />\nThe code of main.go can be like this:</p>\n<pre><code>package main\n\nimport (\n    &quot;os&quot;\n    &quot;os/signal&quot;\n    &quot;syscall&quot;\n    &quot;fmt&quot;\n    &quot;github.com/my/repo/cmd&quot;\n)\n\nconst (\n    waitForSignalEnv       = &quot;WAIT_FOR_DEBUGGER&quot;\n    debuggerPort           = &quot;4321&quot;\n)\n\nfunc main() {\n    // Waiting for debugger attach in case if waitForSignalEnv!=&quot;&quot;\n    if os.Getenv(waitForSignalEnv) != &quot;&quot; {\n        sigs := make(chan os.Signal, 1)\n        goOn := make(chan bool, 1)\n        signal.Notify(sigs, syscall.SIGTERM, syscall.SIGINT, syscall.SIGUSR1)\n\n        go func() {\n            sig := &lt;-sigs\n            if sig == syscall.SIGUSR1 {\n                goOn &lt;- true\n            } else if (sig == syscall.SIGTERM || sig == syscall.SIGINT ){\n                fmt.Printf(&quot;Exiting ...&quot;)\n                os.Exit(0)\n            }\n        }()     \n            \n        fmt.Printf(&quot;%s env is set, waiting SIGUSR1.\\nYou can run remote debug in vscode and attach dlv debugger:\\n\\n&quot;, waitForSignalEnv)\n    \n        pid := os.Getpid()\n        fmt.Printf(&quot;dlv attach --continue --accept-multiclient --headless --listen=:%s %d\\n&quot;, debuggerPort, pid)\n        fmt.Printf(&quot;\\nLaunch remote debugger in vscode to port %d and then give SIGUSR1 to the process\\n&quot;, debuggerPort)\n        fmt.Printf(&quot;kill -SIGUSR1 %d\\n&quot;, pid)\n        \n        &lt;-goOn\n        fmt.Printf(&quot;Continue ...&quot;)\n    }\n    cmd.Execute()\n}\n</code></pre>\n<p>launch.json of vscode:</p>\n<pre><code>{\n    &quot;name&quot;: &quot;myprog-remote-debug&quot;,\n    &quot;type&quot;: &quot;go&quot;,\n    &quot;request&quot;: &quot;launch&quot;,\n    &quot;remotePath&quot;: &quot;${env:GOPATH}/src/github.com/my/repo&quot;,\n    &quot;mode&quot;: &quot;remote&quot;,\n    &quot;port&quot;: 4321,\n    &quot;host&quot;: &quot;127.0.0.1&quot;,\n    &quot;program&quot;: &quot;${env:GOPATH}/src/github.com/my/repo&quot;,   \n    &quot;showLog&quot;: true,\n    &quot;trace&quot;: &quot;verbose&quot; \n\n}\n</code></pre>\n<p>Explanation:\nwe launch the program with env WAIT_FOR_DEBUGGER=true, for example</p>\n<pre><code>export WAIT_FOR_DEBUGGER=true\n./myprog -f values.yaml\n</code></pre>\n<p>It will output <code>dlv attach ...</code> command and <code>kill -SIGUSR &lt;pid&gt; </code>:</p>\n<pre><code>WAIT_FOR_DEBUGGER env is set, waiting SIGUSR1.\nYou can run remote debug in vscode and attach dlv debugger:\n\ndlv attach --continue --accept-multiclient --headless --listen=:4321 556127\n\nLaunch remote debugger in vscode to port 4321 and then give SIGUSR1 to the process\nkill -SIGUSR1 556127\n</code></pre>\n<p>Run the <code>dlv attach ... </code> above<br />\nThen go to VS Code and run myprog-remote-debug. Set breakpoints before<br />\nThen give him <code>kill -SIGUSR1 556127</code></p>\n<p>and breakpoints will work</p>\n"}], "owner": {"reputation": 618, "user_id": 813016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0335bf86ceb7796caabc3bf417b6b03?s=128&d=identicon&r=PG", "display_name": "Philip Beber", "link": "https://stackoverflow.com/users/813016/philip-beber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2462, "favorite_count": 2, "accepted_answer_id": 62356533, "answer_count": 3, "score": 3, "last_activity_date": 1596749659, "creation_date": 1513649226, "last_edit_date": 1513698404, "question_id": 47879070, "link": "https://stackoverflow.com/questions/47879070/how-can-i-see-if-the-goland-debugger-is-running-in-the-program", "title": "How can I see if the GoLand debugger is running in the program?", "body": "<p>In C# the executing program can detect if it's running in the debugger using:</p>\n\n<pre><code>System.Diagnostics.Debugger.IsAttached\n</code></pre>\n\n<p>Is there an equivalent in Go? I have some timeouts which I would like to be disabled while I am stepping through the code. Thanks!</p>\n\n<p>I am using the GoLand debugger.</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1513652915, "post_id": 47878994, "comment_id": 82724938, "body": "You could have the goroutine itself stop after it runs out of time instead of doing that in <code>main</code>. If you do need to do it outside of the goroutine, you could create another channel for the goroutine to check, and then you can close that in <code>main</code> to tell the goroutine  to stop."}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1513673667, "creation_date": 1513673667, "answer_id": 47883167, "question_id": 47878994, "link": "https://stackoverflow.com/questions/47878994/receiving-values-from-goroutine-for-certain-amount-of-time/47883167#47883167", "title": "Receiving values from goroutine for certain amount of time", "body": "<p>You are getting a panic because your sending goroutine <code>runSearch</code> apparently outlives the timer and it is trying to send a value on the channel which is already closed by your <code>main</code> goroutine. You need to devise a way to signal the sending go routine not to send any values once your timer is lapsed and before you close the channel in main. On the other hand if your search gets over sooner you also need to communicate to <code>main</code> to move on. You can use one channel and synchronize so that there are no race conditions. And finally you need to know when your consumer has processed all the data before you can exit main.</p>\n\n<p>Here's something which may help.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar mu sync.Mutex //To protect the stopped variable which will decide if a value is to be sent on the signalling channel\nvar stopped bool\n\nfunc search(i int) int {\n    time.Sleep(1 * time.Millisecond)\n    return (i + 1)\n}\n\n// (or at least a very long time for high values of depth)\nfunc runSearch(depth int, ch chan int, stopSearch chan bool) {\n\n    for i := 1; i &lt;= depth; i++ {\n        fmt.Printf(\"Searching to depth %v\\n\", i)\n        n := search(i)\n        select {\n        case &lt;-stopSearch:\n            fmt.Println(\"Timer over! Searched till \", i)\n            return\n        default:\n        }\n\n        ch &lt;- n\n        fmt.Printf(\"Sent depth %v result for processing\\n\", i)\n    }\n\n    mu.Lock() //To avoid race condition with timer also being\n    //completed at the same time as execution of this code\n    if stopped == false {\n        stopped = true\n        stopSearch &lt;- true\n        fmt.Println(\"Search completed\")\n    }\n    mu.Unlock()\n\n}\n\n// consumes progressively better values until the channel is closed\nfunc awaitBestResult(ch chan int, doneProcessing chan bool) {\n    var best int\n\n    for result := range ch {\n        best = result\n    }\n    fmt.Println(\"Best result \", best)\n    // do something with best result here\n\n    //and communicate to main when you are done processing the result\n    doneProcessing &lt;- true\n\n}\n\nfunc main() {\n    doneProcessing := make(chan bool)\n    stopSearch := make(chan bool)\n\n    // timer := time.NewTimer(time.Millisecond * 2000)\n    timer := time.NewTimer(time.Millisecond * 12)\n\n    ch := make(chan int)\n\n    go runSearch(1000, ch, stopSearch)\n    go awaitBestResult(ch, doneProcessing)\n    select {\n    case &lt;-timer.C:\n        //If at the same time runsearch is also completed and trying to send a value !\n        //So we hold a lock before sending value on the channel\n        mu.Lock()\n        if stopped == false {\n            stopped = true\n            stopSearch &lt;- true\n            fmt.Println(\"Timer expired\")\n        }\n        mu.Unlock()\n\n    case &lt;-stopSearch:\n        fmt.Println(\"runsearch goroutine completed\")\n    }\n    close(ch)\n\n    //Wait for your consumer to complete processing\n    &lt;-doneProcessing\n    //Safe to exit now\n}\n</code></pre>\n\n<p>On <a href=\"https://play.golang.org/p/aWKOya-mf8\" rel=\"nofollow noreferrer\">playground</a>. Change the value of <code>timer</code> to observe both the scenarios.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1513674363, "creation_date": 1513674363, "answer_id": 47883366, "question_id": 47878994, "link": "https://stackoverflow.com/questions/47878994/receiving-values-from-goroutine-for-certain-amount-of-time/47883366#47883366", "title": "Receiving values from goroutine for certain amount of time", "body": "<p>You need to ensure that the goroutine knows when it is done processing, so that it doesn't attempt to write to a closed channel, and panic.</p>\n\n<p>This sounds like a perfect case for the <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\"><code>context</code></a> package:</p>\n\n<pre><code>func runSearch(ctx context.Context, depth int, ch chan int) {\n    for i := 1; i &lt;= depth; i++ {\n        select {\n        case &lt;- ctx.Done()\n            // Context cancelled, return\n            return\n        default:\n        }\n        fmt.Printf(\"Searching to depth %v\\n\", i)\n        ch &lt;- search(i)\n    }\n}\n</code></pre>\n\n<p>Then in <code>main()</code>:</p>\n\n<pre><code>// run both consumer and producer\nfunc main() {\n    ctx := context.WithTimeout(context.Background, 2 * time.Second)\n\n    ch := make(chan int)\n\n    go runSearch(ctx, 1000, ch)\n    go awaitBestResult(ch)\n\n    close(ch)\n}\n</code></pre>\n"}], "owner": {"reputation": 451, "user_id": 2243777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4410a797c941eec0f2a81abd5f1345d8?s=128&d=identicon&r=PG", "display_name": "Cadel Watson", "link": "https://stackoverflow.com/users/2243777/cadel-watson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 1, "accepted_answer_id": 47883366, "answer_count": 2, "score": 0, "last_activity_date": 1513674363, "creation_date": 1513648646, "question_id": 47878994, "link": "https://stackoverflow.com/questions/47878994/receiving-values-from-goroutine-for-certain-amount-of-time", "title": "Receiving values from goroutine for certain amount of time", "body": "<p>I have a goroutine which can generate an infinite number of values (each more suitable than the last), but it takes progressively longer to find each values. I'm trying to find a way to add a time limit, say 10 seconds, after which my function does something with the best value received so far.</p>\n\n<p>This is my current \"solution\", using a channel and timer:</p>\n\n<pre><code>// the goroutine which runs infinitely\n// (or at least a very long time for high values of depth)\nfunc runSearch(depth int, ch chan int) {\n    for i := 1; i &lt;= depth; i++ {\n        fmt.Printf(\"Searching to depth %v\\n\", i)\n        ch &lt;- search(i)\n    }\n}\n\n// consumes progressively better values until the channel is closed\nfunc awaitBestResult(ch chan int) {\n    var result int\n    for result := range ch {\n        best = result\n    }\n\n    // do something with best result here\n}\n\n// run both consumer and producer\nfunc main() {\n    timer := time.NewTimer(time.Millisecond * 2000)\n\n    ch := make(chan int)\n\n    go runSearch(1000, ch)\n    go awaitBestResult(ch)\n\n    &lt;-timer.C\n    close(ch)\n}\n</code></pre>\n\n<p>This mostly works - the best result is processed after the timer ends and the channel is closed. However, I then get a panic (<code>panic: send on closed channel</code>) from the <code>runSearch</code> goroutine, since the channel has been closed by the main function.</p>\n\n<p>How can I stop the first goroutine running after the timer has completed? Any help is very appreciated. </p>\n"}, {"tags": ["azure", "go", "azure-storage"], "comments": [{"owner": {"reputation": 64493, "user_id": 272109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32170c62eb744820e8afdd023379a95a?s=128&d=identicon&r=PG", "display_name": "David Makogon", "link": "https://stackoverflow.com/users/272109/david-makogon"}, "edited": false, "score": 1, "creation_date": 1513645528, "post_id": 47877467, "comment_id": 82723302, "body": "As written, this question is rather unclear. Great that you linked to the library you&#39;re using but... you haven&#39;t shown all your code. For instance: how you set up the storage client (e.g. how did you initialize <code>container</code>?). We don&#39;t know if it&#39;s something you did wrong, an issue with the library you&#39;re using, or something else. Please edit your question to be more specific. (<b>Note: When editing, do not include your real connection string; just show your code</b>)"}], "answers": [{"tags": [], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "is_accepted": true, "score": 0, "last_activity_date": 1514855994, "last_edit_date": 1514855994, "creation_date": 1513648585, "answer_id": 47878985, "question_id": 47877467, "link": "https://stackoverflow.com/questions/47877467/azure-storage-copy-the-value-for-one-of-the-http-headers-is-not-in-the-correct/47878985#47878985", "title": "azure storage copy: The value for one of the HTTP headers is not in the correct format", "body": "<p>The source to Copy must be absolute:</p>\n\n<pre><code>destBlob := h.client.GetBlobReference(to)\nsourceBlob := h.client.GetBlobReference(from)\nerr := destBlob.Copy(sourceBlob.GetURL(), nil)\n</code></pre>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1375, "favorite_count": 0, "accepted_answer_id": 47878985, "answer_count": 1, "score": 0, "last_activity_date": 1514855994, "creation_date": 1513636733, "last_edit_date": 1514855976, "question_id": 47877467, "link": "https://stackoverflow.com/questions/47877467/azure-storage-copy-the-value-for-one-of-the-http-headers-is-not-in-the-correct", "title": "azure storage copy: The value for one of the HTTP headers is not in the correct format", "body": "<p>I'm using <a href=\"https://godoc.org/github.com/Azure/azure-sdk-for-go/storage#Blob.Copy\" rel=\"nofollow noreferrer\">this library</a>.</p>\n\n<p>When I run:</p>\n\n<pre><code>b := container.GetBlobReference(\"bar\")\nerr := b.Copy(\"foo\", nil)\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>storage: service returned error: StatusCode=400,\n  ErrorCode=InvalidHeaderValue, ErrorMessage=The value for one of the\n  HTTP headers is not in the correct format.\n  RequestId:66d0164b-001e-0028-2c4f-78a847000000\n  Time:2017-12-18T22:26:59.9585462Z, RequestInitiated=Mon, 18 Dec 2017\n  22:26:59 GMT, RequestId=66d0164b-001e-0028-2c4f-78a847000000, API\n  Version=2016-05-31, QueryParameterName=, QueryParameterValue=</p>\n</blockquote>\n\n<p>File \"foo\" <strong>does</strong> exist.</p>\n\n<p>Perhaps the hint is in <code>QueryParameterName</code> and <code>QueryParameterValue</code> having no values.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "edited": false, "score": 0, "creation_date": 1513633068, "post_id": 47876715, "comment_id": 82719158, "body": "Why would <code>password, ok := m[&quot;password&quot;]</code> assign to <code>output</code>? Shouldn&#39;t that just assign <code>password</code>? If I remove the <code>:</code> I get back a message saying password isn&#39;t defined."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "edited": false, "score": 0, "creation_date": 1513633107, "post_id": 47876715, "comment_id": 82719178, "body": "I was refering only to the if statements"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513633130, "post_id": 47876715, "comment_id": 82719191, "body": "Answer isn&#39;t referring to that line, it&#39;s referring to, as it says, &quot;in the <code>if&#47;else</code> statement&quot;. I.e. the two declarations in the <code>if</code> and <code>else</code> blocks."}, {"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "edited": false, "score": 0, "creation_date": 1513633147, "post_id": 47876715, "comment_id": 82719199, "body": "ok that makes sense"}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 5, "last_activity_date": 1513633340, "last_edit_date": 1513633340, "creation_date": 1513632778, "answer_id": 47876715, "question_id": 47876680, "link": "https://stackoverflow.com/questions/47876680/go-setting-a-variable-based-on-if-else/47876715#47876715", "title": "Go setting a variable based on if else", "body": "<p>Remove the <code>:</code> before <code>=</code> in the <code>if/else</code> statement.</p>\n\n<p>Using <code>:=</code> in a <code>if statement</code> with the variable declared above, it means you redeclare the variable in that scope. If you will use <code>=</code> this would mean assignment into the already declared variable <code>output</code>.</p>\n\n<p>Read about it here: <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">Short variable declarations</a> vs <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">Assignmets</a></p>\n"}], "owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "closed_date": 1515161943, "accepted_answer_id": 47876715, "answer_count": 1, "score": -8, "last_activity_date": 1513633340, "creation_date": 1513632572, "question_id": 47876680, "link": "https://stackoverflow.com/questions/47876680/go-setting-a-variable-based-on-if-else", "closed_reason": "Duplicate", "title": "Go setting a variable based on if else", "body": "<p>I want to set a string to one of two things based on an if/else statement:</p>\n\n<pre><code>    var output string\n    password, ok := m[\"password\"]\n    if ok {\n            output := runcmd(\"connect.sh \"+ssid+\" \"+password)\n    } else {\n            output := runcmd(\"connect.sh \"+ssid)\n    }\n    fmt.Println(output)\n</code></pre>\n\n<p>During compile I get back:</p>\n\n<blockquote>\n  <p>output declared and not used</p>\n</blockquote>\n\n<p>I understand that this is because <code>output</code> is a local variable inside <code>ok { ... }</code>, what would the proper way to do this be?</p>\n\n<p><em>Also tried using a capital for <code>Output</code> as I've had to do that to make struct properties accessible before.</em></p>\n"}, {"tags": ["go", "glide-golang"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1513630292, "post_id": 47876025, "comment_id": 82717865, "body": "Is there any other file in <code>$GOPATH&#47;src&#47;gitlab.myfirm.ru&#47;golang&#47;rkn&#47;event</code> besides <code>events.go</code> ? What happens if you remove <code>&#47;Users&#47;droot&#47;.glide&#47;cache&#47;src&#47;https-gitlab.myfirm.ru-golang-&zwnj;&#8203;rkn&#47;events</code> ?"}, {"owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 1, "creation_date": 1513630548, "post_id": 47876025, "comment_id": 82718003, "body": "nope only events.go, use <code>glide cc</code> (clear cache) same result"}], "answers": [{"tags": [], "owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "is_accepted": false, "score": 6, "last_activity_date": 1513674634, "last_edit_date": 1513674634, "creation_date": 1513634379, "answer_id": 47877036, "question_id": 47876025, "link": "https://stackoverflow.com/questions/47876025/glide-cannot-find-package-in/47877036#47877036", "title": "Glide cannot find package &quot;.&quot; in", "body": "<p>I found the answer.</p>\n\n<p>When glide makes cache files, git is in there.</p>\n\n<p>If <code>master</code> have <code>foo package</code> and <code>someBranch</code> have also <code>bar package</code> when you make <code>glide install</code> glide also cache git branches and give from cache <code>master</code> branch as default.</p>\n\n<p>The solution is <code>cd /Users/droot/.glide/cache/src/https-gitlab.myfirm.ru-golang-\u200c\u200brkn/</code> and checkout cache branch <code>git checkout someBranch</code></p>\n"}, {"tags": [], "owner": {"reputation": 49, "user_id": 6831831, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VuD_aRu2y64/AAAAAAAAAAI/AAAAAAAAAAs/aDg7RnZcJC8/photo.jpg?sz=128", "display_name": "Forest Johnson", "link": "https://stackoverflow.com/users/6831831/forest-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1516917853, "creation_date": 1516917853, "answer_id": 48452645, "question_id": 47876025, "link": "https://stackoverflow.com/questions/47876025/glide-cannot-find-package-in/48452645#48452645", "title": "Glide cannot find package &quot;.&quot; in", "body": "<p>I have found that this error can occur when your Go code attempts to import a package which does not exist in Github or no longer exists. </p>\n\n<p>For example, it used to be that the package <code>github.com/hashicorp/terraformbuiltin/providers/aws</code>  existed:</p>\n\n<p><a href=\"https://github.com/hashicorp/terraform/tree/v0.9.6/builtin/providers\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform/tree/v0.9.6/builtin/providers</a></p>\n\n<p>But as of Terraform 0.11, it has been moved: \n<a href=\"https://github.com/hashicorp/terraform/tree/v0.11.2/builtin/providers\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/terraform/tree/v0.11.2/builtin/providers</a>\n<a href=\"https://github.com/terraform-providers/terraform-provider-aws\" rel=\"nofollow noreferrer\">https://github.com/terraform-providers/terraform-provider-aws</a></p>\n"}], "owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8417, "favorite_count": 0, "answer_count": 2, "score": 9, "last_activity_date": 1553443749, "creation_date": 1513629364, "last_edit_date": 1553443749, "question_id": 47876025, "link": "https://stackoverflow.com/questions/47876025/glide-cannot-find-package-in", "title": "Glide cannot find package &quot;.&quot; in", "body": "<p>My project tree is <code>$GOPATH/src/gillab.myfirm.ru/golang/rkn</code></p>\n\n<p>I try to use glide for get dependency <code>glide install</code> and I am stuck with a problem:</p>\n\n<pre><code>[ERROR] Error scanning gitlab.myfirm.ru/golang/rkn/events: cannot find package \".\" in:\n    /Users/droot/.glide/cache/src/https-gitlab.myfirm.ru-golang-rkn/events\n</code></pre>\n\n<p>I don't understand what exactly glide want from me.  What such package is this <code>\".\"</code> ?</p>\n\n<p><code>$GOPATH/src/gitlab.myfirm.ru/golang/rkn/event/events.go</code> have only 4 imports</p>\n\n<pre><code>package events\n\nimport (\n    \"github.com/streadway/amqp\"\n    log \"github.com/Sirupsen/logrus\"\n    \"fmt\"\n    \"gitlab.myfirm.ru/golang/rkn/config\"\n)\n........\n</code></pre>\n\n<p>same problem I got with another 4 packages.</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "edited": false, "score": 0, "creation_date": 1513630662, "post_id": 47875953, "comment_id": 82718072, "body": "What framework/library are you using? What does mux.Vars return?"}, {"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1513630862, "post_id": 47875953, "comment_id": 82718143, "body": "@CeriseLim&#243;n I updated the question with the params I&#39;m trying to capture."}, {"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "reply_to_user": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "edited": false, "score": 0, "creation_date": 1513630877, "post_id": 47875953, "comment_id": 82718149, "body": "@Howl I&#39;m using <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a>"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1513630941, "post_id": 47875953, "comment_id": 82718186, "body": "@PhilipKirkbride update your question to include the name (and a link) of the library you are using; otherwise people will have no idea what type <code>mux.Vars</code> is or how to help in general..."}, {"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1513630982, "post_id": 47875953, "comment_id": 82718205, "body": "@maerics ok will do I assumed <code>mux</code> was a really popular library"}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "edited": false, "score": 0, "creation_date": 1513673949, "post_id": 47875953, "comment_id": 82732148, "body": "It is, but don&#39;t assume anything unless it&#39;s the standard library (and even then it&#39;s better to specify) ;)"}], "answers": [{"comments": [{"owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "edited": false, "score": 0, "creation_date": 1513631394, "post_id": 47876389, "comment_id": 82718394, "body": "I think this would be correct if I was using params correctly(?) I don&#39;t know if it&#39;s right because when I post with and without a password the code inside <code>ok</code> runs but it just prints blank."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1513631512, "last_edit_date": 1513631512, "creation_date": 1513631037, "answer_id": 47876389, "question_id": 47875953, "link": "https://stackoverflow.com/questions/47875953/mux-return-if-variable-not-defined/47876389#47876389", "title": "Mux return if variable not defined?", "body": "<p>Use the following to check for presence of a mux request variable:</p>\n\n<pre><code>params := mux.Vars(r)   \npassword, ok := params[\"password\"] \nif ok {\n   // password is set\n} else {\n   // password is not set\n}\n</code></pre>\n\n<p>This code uses <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">the two value index expression</a> to check for presence of the key in the map.</p>\n\n<p>It looks like your intent is to parse a JSON request body and not to access the mux variables.  Do this in your handler:</p>\n\n<pre><code> var m map[string]string\n err := json.NewDecoder(r.Body).Decode(&amp;m)\n if err != nil {\n     // handle error\n }\n password, ok := m[\"password\"]\n if ok {\n   // password is set\n } else {\n   // password is not set\n }\n</code></pre>\n"}], "owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 0, "accepted_answer_id": 47876389, "answer_count": 1, "score": 1, "last_activity_date": 1513674465, "creation_date": 1513628981, "last_edit_date": 1513674465, "question_id": 47875953, "link": "https://stackoverflow.com/questions/47875953/mux-return-if-variable-not-defined", "title": "Mux return if variable not defined?", "body": "<p>I want to handle the situation where a param wasn't defined.</p>\n\n<pre><code>import (\n    // ...\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/connect\", Connect).Methods(\"POST\")\n    log.Fatal(http.ListenAndServe(\":7777\", router))\n}\n\n\n\n// ...\n\nfunc Connect(w http.ResponseWriter, r *http.Request) {\n    params := mux.Vars(r)\n\n    if params[\"password\"] == nil {\n        fmt.Println(\"login without password\")\n    } else {\n        fmt.Println(\"login with password\")\n    }\n}\n</code></pre>\n\n<p>I also tried <code>if !params[\"ssid\"] {</code></p>\n\n<p>What is the right syntax for this?</p>\n\n<hr>\n\n<p>With <code>mux.Vars(r)</code> I'm trying to capture the post params from:</p>\n\n<pre><code>curl -H 'Content-Type: application/json' -d '{\"ssid\":\"wifi\"}' -X POST http://localhost:7777/connect\n</code></pre>\n\n<p><code>ssid</code> is required but <code>password</code> is optional.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513626678, "post_id": 47875422, "comment_id": 82716288, "body": "Please show us the <i>exact code</i> with your <i>exact</i> error. It&#39;s hard to tell you how to improve your code when you have different, conflicting error messages."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1513626701, "post_id": 47875422, "comment_id": 82716306, "body": "Also, you shouldn&#39;t need to pass a pointer to a slice--slices are already passed by reference."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1513628294, "post_id": 47875422, "comment_id": 82716991, "body": "you <b>must</b> read that, <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>. Slice is quiet special thing."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513627646, "post_id": 47875603, "comment_id": 82716733, "body": "That&#39;s not valid, <code>s</code> is an integer. If <code>s</code> were a <code>*student</code>, you don&#39;t dereference <code>s.age</code>, because <code>age</code> isn&#39;t a pointer."}], "tags": [], "owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "is_accepted": false, "score": 2, "last_activity_date": 1513627672, "last_edit_date": 1513627672, "creation_date": 1513627373, "answer_id": 47875603, "question_id": 47875422, "link": "https://stackoverflow.com/questions/47875422/how-to-pass-slice-of-struct-as-pointer-to-a-function-and-modify-it/47875603#47875603", "title": "How to pass slice of struct as pointer to a function and modify it?", "body": "<p>in Go you can pass items by value ([]student) or by reference ([]*student). When you want to operate on the values of a <code>struct{}</code> you should pass it to a function with its <em>reference</em> (the pointer).</p>\n\n<p>So you can do something like this:</p>\n\n<pre><code>type student struct {\n    name string\n    age int\n}\n\nfunc addTwoYearsToAll(students []*student){\n  for _, s := range students {\n        s.age += 2\n     }\n}\n</code></pre>\n\n<p>This way you're working with the same exact items you build when appending to the slice. <a href=\"https://play.golang.org/p/diFFLj0jmq\" rel=\"nofollow noreferrer\">Playground example</a>.</p>\n\n<p>Also take a look at <a href=\"https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write\">Are Golang function parameter passed as copy-on-write?</a></p>\n"}, {"tags": [], "owner": {"reputation": 698, "user_id": 5617424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rmoz.jpg?s=128&g=1", "display_name": "Vane Trajkov", "link": "https://stackoverflow.com/users/5617424/vane-trajkov"}, "is_accepted": true, "score": 4, "last_activity_date": 1513629180, "creation_date": 1513629180, "answer_id": 47875988, "question_id": 47875422, "link": "https://stackoverflow.com/questions/47875422/how-to-pass-slice-of-struct-as-pointer-to-a-function-and-modify-it/47875988#47875988", "title": "How to pass slice of struct as pointer to a function and modify it?", "body": "<p>Slices are passed by reference, so as long as you are modifying the existing slice content you should not explicitly pass a pointer. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype student struct {\n    name string\n    age int\n}\n\nfunc main() {\n    students := []student{\n        {\"Doraemon\", 30},\n        {\"King Kong\", 25},\n    }\n\n    err := addAge (students)\n\n    fmt.Println(students)\n    if err != nil {\n        fmt.Println(\"error\")\n    }\n}\n\nfunc addAge (s []student) error {\n    for i, _ := range s {\n        s[i].age = 3\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now, for your <code>addAdditinalStudent</code> function you should actually use the <a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">append</a> function. Plus, have in mind</p>\n\n<blockquote>\n  <p>..., since the slice header is always updated by a call to\n  append, you need to save the returned slice after the call. In fact,\n  the compiler won't let you call append without saving the result.\n  <a href=\"https://blog.golang.org/slices#TOC_10.\" rel=\"nofollow noreferrer\">Slices#append</a></p>\n</blockquote>\n\n<pre><code>// add student\nstudents = append(students, student{\"Test\", 33})\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4xT_v3krbh\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3038, "favorite_count": 0, "accepted_answer_id": 47875988, "answer_count": 2, "score": 2, "last_activity_date": 1513629180, "creation_date": 1513626501, "question_id": 47875422, "link": "https://stackoverflow.com/questions/47875422/how-to-pass-slice-of-struct-as-pointer-to-a-function-and-modify-it", "title": "How to pass slice of struct as pointer to a function and modify it?", "body": "<p>I have a slice of struct <code>[]student</code>, and I want to modify its content with function.</p>\n\n<pre><code>type student struct {\n    name string\n    age int\n}\n\nstudents := []student{\n    {\"Doraemon\", 30},\n    {\"King Kong\", 25},\n}\n</code></pre>\n\n<p>Thus, I decided to pass it as a pointer. May I know how to pass the slice as a reference to a function?</p>\n\n<pre><code>func addAge (s *[]student) error { //this code has error\n    //everyone add 2 years old\n    for i, e := range *s {\n        s[i].age = s[i].age + 2\n    }\n    //make the first student much older\n    s[0].age = s[0].age + 5\n    return nil\n}\n</code></pre>\n\n<p>I keep playing with <a href=\"https://play.golang.org/p/lHN-MBhtrX\" rel=\"nofollow noreferrer\">Go Playground</a>, but it gives many complains, such as </p>\n\n<pre><code>cannot range over s (type *[]student)\ninvalid operation: s[i] (type *[]student does not support indexing)\ninvalid indirect of s\n...\n</code></pre>\n\n<p>How to precisely pass the reference of a <code>slice of struct</code> to a function? How to <strong>range</strong> the slice of struct? And how to <strong>change</strong> the value of the struct (modify the same struct in THE slice)? </p>\n\n<p>I keep getting error while playing with <code>s *[]student</code>, <code>range *s</code>, <code>s []student</code>, <code>s *[]*student</code> ... so hard to get it correct...</p>\n\n<p><em>sorry for my NEWBIE question, still learning GO... trying hard</em></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513625825, "post_id": 47875189, "comment_id": 82715915, "body": "What do you expect to see, and what happens instead? You&#39;re not checking the buffered data after flush in this example. This works as expected: <a href=\"https://play.golang.org/p/v2wDgGJIiq\" rel=\"nofollow noreferrer\">play.golang.org/p/v2wDgGJIiq</a>"}, {"owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513625890, "post_id": 47875189, "comment_id": 82715945, "body": "Output: 2017/12/18 16:37:39 Available 8192 2017/12/18 16:37:39 written bytes: 1 2017/12/18 16:37:39 Available: 8191 2017/12/18 16:37:39 buffered: 1 $ ls -l -rw-rw-r-- 1 stingo stingo 0 dic 18 16:37 test"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513626008, "post_id": 47875189, "comment_id": 82716003, "body": "I&#39;m not sure what to make from that comment, please format in your question."}, {"owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513626033, "post_id": 47875189, "comment_id": 82716015, "body": "Sorry I was adding more data. File is created but nothing is added to it. I believe Flush() should write &quot;A&quot;. Thanks."}, {"owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513626256, "post_id": 47875189, "comment_id": 82716118, "body": "Please look at this: <a href=\"https://play.golang.org/p/-qCC4Zl-Es\" rel=\"nofollow noreferrer\">play.golang.org/p/-qCC4Zl-Es</a> I have modified your example and nothing is being written even Flush() is executed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513626288, "post_id": 47875189, "comment_id": 82716129, "body": "No, <code>Flush</code> has nothing to do with the underlying file. If you want to ensure that the data is written to storage, you need to fall <a href=\"https://golang.org/pkg/os/#File.Sync\" rel=\"nofollow noreferrer\"><code>File.Sync()</code></a> and remove the doubled up buffer."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "edited": false, "score": 0, "creation_date": 1513626481, "post_id": 47875373, "comment_id": 82716214, "body": "I tried and still the same issue. Even with bytes buffer I am having the same issue. Please see: <a href=\"https://play.golang.org/p/-qCC4Zl-Es\" rel=\"nofollow noreferrer\">play.golang.org/p/-qCC4Zl-Es</a>"}], "tags": [], "owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "is_accepted": false, "score": 1, "last_activity_date": 1513626272, "creation_date": 1513626272, "answer_id": 47875373, "question_id": 47875189, "link": "https://stackoverflow.com/questions/47875189/golang-bufio-writer-flush-does-not-write-small-data-when-big-buffer-size/47875373#47875373", "title": "Golang Bufio writer .Flush() does not write small data when big buffer size", "body": "<p>I believe you're missing the <code>Sync()</code> call to the file pointer, so the file is not written to the file system; <code>Flush()</code> will just pass the buffer to the file writer, but then you need to push the file to the disk.</p>\n\n<p>See <a href=\"https://golang.org/src/os/file_posix.go?s=3352:3379#L120\" rel=\"nofollow noreferrer\">src/os/file_posix.go#L120</a> and <a href=\"https://golang.org/pkg/bufio/#Writer.Flush\" rel=\"nofollow noreferrer\">pkg/bufio/#Writer.Flush</a></p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "edited": false, "score": 0, "creation_date": 1513626617, "post_id": 47875401, "comment_id": 82716268, "body": "Worked like a charm. Thank you very much!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 10, "last_activity_date": 1513626427, "creation_date": 1513626427, "answer_id": 47875401, "question_id": 47875189, "link": "https://stackoverflow.com/questions/47875189/golang-bufio-writer-flush-does-not-write-small-data-when-big-buffer-size/47875401#47875401", "title": "Golang Bufio writer .Flush() does not write small data when big buffer size", "body": "<p>The problem is that the application has two layers of bufio writers:</p>\n\n<pre><code>w := bufio.NewWriter(file)\nw = bufio.NewWriterSize(\n    w,\n    4096*2,\n)\n</code></pre>\n\n<p>One bufio.Writer wraps the other.  The application flushes the outer bufio.Writer, but there's no code that flushes the inner bufio.Writer.   Change the code to use a single bufio.Writer and the program will work as expected.</p>\n\n<pre><code>w := bufio.NewWriterSize(\n    file,\n    4096*2,\n)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5140618, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-1PGuly3GeDo/AAAAAAAAAAI/AAAAAAAADVI/-bxj-ntDOLo/photo.jpg?sz=128", "display_name": "Juan Cruz", "link": "https://stackoverflow.com/users/5140618/juan-cruz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6110, "favorite_count": 0, "accepted_answer_id": 47875401, "answer_count": 2, "score": 0, "last_activity_date": 1513626427, "creation_date": 1513625473, "question_id": 47875189, "link": "https://stackoverflow.com/questions/47875189/golang-bufio-writer-flush-does-not-write-small-data-when-big-buffer-size", "title": "Golang Bufio writer .Flush() does not write small data when big buffer size", "body": "<p>Golang Bufio writer .Flush() does not write small data when big buffer size (example 4096(standard size)*2)</p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"os\"\n    \"bufio\"\n)\nfunc main() {\n    file, err := os.Create(\"test\")\n    defer file.Close()\n    w := bufio.NewWriter(file)\n\n    w = bufio.NewWriterSize(\n        w,\n        4096*2,\n    )\n    bytesAvailable := w.Available()\n    log.Printf(\"Available %v\\n\", bytesAvailable)\n    bw, _ := w.Write(\n      []byte(\"A\"),\n    )\n    log.Printf(\"written bytes: %v\\n\", bw)\n    bytesAvailable = w.Available()\n    log.Printf(\"Available: %v\\n\", bytesAvailable)\n    buf := w.Buffered()\n    log.Printf(\"buffered: %d\\n\", buf)\n    err = w.Flush()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>When I use the standard size or I write more data it works as expected.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513620212, "post_id": 47873964, "comment_id": 82713445, "body": "Unless you have an example of where you&#39;re having a problem implementing a solution in Go, this isn&#39;t really relevant to Go."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1513620875, "post_id": 47873964, "comment_id": 82713757, "body": "<a href=\"https://stackoverflow.com/a/46891608/720999\">Here&#39;s one way to do it</a>."}, {"owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "edited": false, "score": 0, "creation_date": 1513620878, "post_id": 47873964, "comment_id": 82713760, "body": "you can use websockets to keep a full duplex open channel between client and server where you can send from client to server and vice versa. usually you can use this for pushing update progress to client"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1513621534, "post_id": 47873964, "comment_id": 82714043, "body": "If the client is a web browser, then polling and websockets are your best options.   SSE is an option if you <a href=\"https://caniuse.com/#feat=eventsource\" rel=\"nofollow noreferrer\">don&#39;t need to support Microsoft&#39;s browsers</a>.   Is the client a web browser, or something else?"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1513621798, "post_id": 47873964, "comment_id": 82714160, "body": "Thanks everyone, I already use a REST API. It sounds like the best/easiest option for me would be to send a unique ID back to the client that can be used to poll with."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1513622179, "creation_date": 1513622179, "answer_id": 47874457, "question_id": 47873964, "link": "https://stackoverflow.com/questions/47873964/sending-multiple-responses-to-client/47874457#47874457", "title": "sending multiple responses to client", "body": "<p>You may create some \u201cguards\u201d for slow functions. They limit execution time, of function succeeded during this time they return result, if not - default value is returned and function is cancelled. </p>\n\n<p>Example of code:</p>\n\n<pre><code>select {\ncase result := &lt;-successChan:\n    return result, nil\ncase &lt;-timeoutChan:\n    return \"\", nil\n}\n</code></pre>\n\n<p>Example of usage: <a href=\"https://github.com/lisitsky/go-site-search-string\" rel=\"nofollow noreferrer\">https://github.com/lisitsky/go-site-search-string</a></p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1513622179, "creation_date": 1513619987, "question_id": 47873964, "link": "https://stackoverflow.com/questions/47873964/sending-multiple-responses-to-client", "title": "sending multiple responses to client", "body": "<p>I have a web client and a Go server. The client send some json data, which is processed and the server then return a json response.</p>\n\n<p>But what can I do when I want to inform the client about the results of a very slow process, and even allow the client to stop the process?</p>\n\n<p>I've been thinking maybe I could keep sending new requests every 5-10 seconds for updates, but that doesn't seem very efficient, and it wouldn't allow me to stop a process I started using <code>go mySlowFunc()</code></p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 4, "last_activity_date": 1513614690, "creation_date": 1513614690, "answer_id": 47872616, "question_id": 47872533, "link": "https://stackoverflow.com/questions/47872533/go-return-json-variables-without-capitals/47872616#47872616", "title": "Go return json variables without capitals", "body": "<p>When the field names in your struct do not match the json field names, you can use field tags.\neg: </p>\n\n<pre><code>Ssid string `json:\"myOtherFieldName\"`\n</code></pre>\n\n<p>Please read the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">json docs</a> for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 1, "last_activity_date": 1513615385, "creation_date": 1513615385, "answer_id": 47872821, "question_id": 47872533, "link": "https://stackoverflow.com/questions/47872533/go-return-json-variables-without-capitals/47872821#47872821", "title": "Go return json variables without capitals", "body": "<p>This tool very convenient for learning: </p>\n\n<p><a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a></p>\n\n<p>Give it example of JSON that you want it will recommend golang. </p>\n\n<p>e.g. JSON\n</p>\n\n<pre><code>{\n   \"ssid\": \"some very long ssid\",\n   \"security\": \"big secret\",\n   \"bitrate\": 1024\n}\n</code></pre>\n\n<p>will suggest golang:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type AutoGenerated struct {\n    Ssid     string `json:\"ssid\"`\n    Security string `json:\"security\"`\n    Bitrate  int    `json:\"bitrate\"`\n}\n</code></pre>\n\n<p>now you can change <code>AutogGenerated, Ssid, Security, Bitrate</code> to whatever you want. </p>\n"}], "owner": {"reputation": 17167, "user_id": 773263, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e2581b53db32340d7e1b5be6b99c2bb1?s=128&d=identicon&r=PG", "display_name": "Philip Kirkbride", "link": "https://stackoverflow.com/users/773263/philip-kirkbride"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "closed_date": 1513616501, "accepted_answer_id": 47872616, "answer_count": 2, "score": -1, "last_activity_date": 1513615385, "creation_date": 1513614436, "question_id": 47872533, "link": "https://stackoverflow.com/questions/47872533/go-return-json-variables-without-capitals", "closed_reason": "Duplicate", "title": "Go return json variables without capitals", "body": "<p>I'm a new user converting an application to Go. I have something like the following which is working:</p>\n\n<pre><code>type Network struct {\n        Ssid     string\n        Security string\n        Bitrate  string\n}\n\nfunc Scan(w http.ResponseWriter, r *http.Request) {\n        output := runcmd(scripts+\"scan.sh\", true)\n        bytes := []byte(output)\n        var networks []Network\n        json.Unmarshal(bytes, &amp;networks)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        json.NewEncoder(w).Encode(networks)\n}\n</code></pre>\n\n<p>The problem is the old version didn't use capitals on the json variables returned. </p>\n\n<p>I want the front-end to see <code>ssid</code> not <code>Ssid</code>. If I make the attributes in the struct lowercase the code no longer works as they become unexported variables.</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 166, "user_id": 6442702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0c01feb215003f7f4271ad586ba675?s=128&d=identicon&r=PG&f=1", "display_name": "WillySchu", "link": "https://stackoverflow.com/users/6442702/willyschu"}, "edited": false, "score": 0, "creation_date": 1513646330, "post_id": 47872193, "comment_id": 82723481, "body": "I believe you want <code>x-max-priority</code>, not <code>x-priority</code> for your args table."}, {"owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "reply_to_user": {"reputation": 166, "user_id": 6442702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0c01feb215003f7f4271ad586ba675?s=128&d=identicon&r=PG&f=1", "display_name": "WillySchu", "link": "https://stackoverflow.com/users/6442702/willyschu"}, "edited": false, "score": 0, "creation_date": 1513672331, "post_id": 47872193, "comment_id": 82731276, "body": "I changed the arg to x-max-priority, but alas that did not solve the problem."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "edited": false, "score": 0, "creation_date": 1513691744, "post_id": 47887144, "comment_id": 82742995, "body": "I added x-max-priority to the sending program and even merged both program so that they use the same queue when adding to it, however I still get the same result."}, {"owner": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "reply_to_user": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "edited": false, "score": 0, "creation_date": 1513705026, "post_id": 47887144, "comment_id": 82751265, "body": "Did you also delete the queue created during your previous tests?"}, {"owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "edited": false, "score": 0, "creation_date": 1513782642, "post_id": 47887144, "comment_id": 82785459, "body": "I&#39;ve tried it with a new queue but I still get the same result. Even sometimes I only receive receive the first message from the queue."}], "tags": [], "owner": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "is_accepted": false, "score": 0, "last_activity_date": 1513686770, "creation_date": 1513686770, "answer_id": 47887144, "question_id": 47872193, "link": "https://stackoverflow.com/questions/47872193/amqp-golang-priority-not-working/47887144#47887144", "title": "AMQP Golang priority not working", "body": "<p>This is what I can figure out from your code, and the description of the steps you follow.</p>\n\n<p>It seems the issue is you do not create the queue the same way in each piece of code, the low and high priority producers create the queue withouth x-max-priority argument. </p>\n\n<p>As a queue is defined as a priority queue upon creation, and only at that time, you actually created a \"standard\" queue.</p>\n\n<p>You should be able to easily confirm this checking the created queue and its arguments.</p>\n"}, {"comments": [{"owner": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "edited": false, "score": 0, "creation_date": 1513791463, "post_id": 47910270, "comment_id": 82790652, "body": "Which version did you use prior to the update? as is stated <a href=\"https://www.rabbitmq.com/priority.html\" rel=\"nofollow noreferrer\">here</a>, priority queue is part of core rabbitmq since 3.5, so if you had been using an older version, you probably would have had to install a module for it to be available"}, {"owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "reply_to_user": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "edited": false, "score": 0, "creation_date": 1513858544, "post_id": 47910270, "comment_id": 82817068, "body": "However, I am now using the func (*Channel) Get instead of the func (*Channel) Consume, because with func (*Channel) Consume it does not seem to sort by priority if I leave it running."}, {"owner": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "edited": false, "score": 0, "creation_date": 1513867514, "post_id": 47910270, "comment_id": 82822787, "body": "They do indicate in the documentation that you should leave enough time for the server to sort the queue, had you configured the prefetch in your consumer config?"}, {"owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "reply_to_user": {"reputation": 2126, "user_id": 3864737, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Lozpu.jpg?s=128&g=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/3864737/olivier"}, "edited": false, "score": 0, "creation_date": 1513934661, "post_id": 47910270, "comment_id": 82846844, "body": "<code>ch.Qos(1, 0, false)</code> in both the receiver and sender but I still have the same problem"}], "tags": [], "owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "is_accepted": true, "score": 0, "last_activity_date": 1514371453, "last_edit_date": 1514371453, "creation_date": 1513786529, "answer_id": 47910270, "question_id": 47872193, "link": "https://stackoverflow.com/questions/47872193/amqp-golang-priority-not-working/47910270#47910270", "title": "AMQP Golang priority not working", "body": "<p>I updated to the most recent rabbitmq and it worked, I do not know if this is the only solution.</p>\n\n<p>As well as callign <code>ch.Qos(1, 0, false)</code> I also needed to remove the <code>auto-ack</code> and acknowledge the message manually afterwards so that it doesn't acknowledge all the messages in the queue. </p>\n"}], "owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1405, "favorite_count": 1, "accepted_answer_id": 47910270, "answer_count": 2, "score": 2, "last_activity_date": 1514371453, "creation_date": 1513613171, "last_edit_date": 1513691687, "question_id": 47872193, "link": "https://stackoverflow.com/questions/47872193/amqp-golang-priority-not-working", "title": "AMQP Golang priority not working", "body": "<p>I am currently testing rabbitmq with golang (github.com/streadway/amqp), and I have three programs, two of them sending messages to the queue with different priorities and one reading from the queue.<br>\nAnd the problem I am having is that after sending a few messages with the two programs I then proceed to launch the program that will read from the queue and when it starts to read from the queue it output the result like a FIFO.<br>\nI expected to output the high priority first followed by the lower priority message.<br>\nDid I misunderstand how rabbitmq works or am I doing something wrong?</p>\n\n<p>Sending to queues\n    package main</p>\n\n<pre><code>import (\n        \"log\"\n\n        \"github.com/streadway/amqp\"\n)\n\nfunc failOnError(err error, msg string) {\n        if err != nil {\n                log.Fatalf(\"%s: %s\", msg, err)\n        }\n}\n\nfunc main() {\n        args := make(amqp.Table)\n        args[\"x-max-priority\"] = int64(9)\n\n        conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n        failOnError(err, \"Failed to connect to RabbitMQ\")\n        defer conn.Close()\n\n        ch, err := conn.Channel()\n        failOnError(err, \"Failed to open a channel\")\n        defer ch.Close()\n\n        q, err := ch.QueueDeclare(\n                \"test\", // name                                                                                                                                                                                     \n                false,   // durable                                                                                                                                                                                 \n                false,   // delete when unused                                                                                                                                                                      \n                false,   // exclusive                                                                                                                                                                               \n                false,   // no-wait                                                                                                                                                                                 \n                args,     // arguments                                                                                                                                                                              \n        )\n        failOnError(err, \"Failed to declare a queue\")\n\n        body := \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n        body = \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n        body = \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n\n        body = \"high\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 9,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n\n        body = \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n\n        body = \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n\n        body = \"low\"\n        err = ch.Publish(\n                \"\",     // exchange                                                                                                                                                                                 \n                q.Name, // routing key                                                                                                                                                                              \n                false,  // mandatory                                                                                                                                                                                \n                false,  // immediate                                                                                                                                                                                \n                amqp.Publishing{\n                        Headers:         amqp.Table{},\n                        ContentType:     \"text/plain\",\n                        ContentEncoding: \"\",\n                        Body:            []byte(body),\n                        DeliveryMode:    amqp.Transient, // 1=non-persistent, 2=persistent                                                                                                                          \n                        Priority: 0,\n                })\n        log.Printf(\" [x] Sent %s\", body)\n        failOnError(err, \"Failed to publish a message\")\n\n}\n</code></pre>\n\n<p>Reading queue:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n\n        \"github.com/streadway/amqp\"\n)\n\nfunc failOnError(err error, msg string) {\n        if err != nil {\n                log.Fatalf(\"%s: %s\", msg, err)\n        }\n}\n\nfunc main() {\n        args := make(amqp.Table)\n        args[\"x-max-priority\"] = int64(9)\n\n        conn, err := amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n        failOnError(err, \"Failed to connect to RabbitMQ\")\n\n        ch, err := conn.Channel()\n        failOnError(err, \"Failed to open a channel\")\n\n        q, err := ch.QueueDeclare(\n                \"test\", // name                                                                                                                                                                                     \n                false,   // durable                                                                                                                                                                                 \n                false,   // delete when unused                                                                                                                                                                      \n                false,   // exclusive                                                                                                                                                                               \n                false,   // no-wait                                                                                                                                                                                 \n                args,     // arguments                                                                                                                                                                              \n        )\n        failOnError(err, \"Failed to declare a queue\")\n\n        msgs, err := ch.Consume(\n                q.Name, // queue                                                                                                                                                                                    \n                \"\",     // consumer                                                                                                                                                                                 \n                true,   // auto-ack                                                                                                                                                                                 \n                false,  // exclusive                                                                                                                                                                                \n                false,  // no-local                                                                                                                                                                                 \n                false,  // no-wait                                                                                                                                                                                  \n                args,    // args                                                                                                                                                                                    \n        )\n        failOnError(err, \"Failed to register a consumer\")\n\n        defer ch.Close()\n        defer conn.Close()\n\n        forever := make(chan bool)\n\n        go func() {\n                for d := range msgs {\n                        log.Printf(\"Received a message: %s\", d.Body)\n                }\n        }()\n\n        log.Printf(\" [*] Waiting for messages. To exit press CTRL+C\")\n        &lt;-forever\n}\n</code></pre>\n\n<p>First I launch the code sending the messages to the queue the following values:</p>\n\n<ul>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n<li>high</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n</ul>\n\n<p>With the <code>low</code> messages having a priority of 0 and the <code>high</code> a priority of 9.<br>\nThen I launch the program that will receive the queue.<br>\nExpected output:<br></p>\n\n<ul>\n<li>high</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n</ul>\n\n<p>Actual output:<br></p>\n\n<ul>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n<li>high</li>\n<li>low</li>\n<li>low</li>\n<li>low</li>\n</ul>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "is_accepted": false, "score": 0, "last_activity_date": 1513692176, "creation_date": 1513692176, "answer_id": 47888663, "question_id": 47871117, "link": "https://stackoverflow.com/questions/47871117/how-to-update-with-a-many-to-many-relationship/47888663#47888663", "title": "How to update with a many-to-many relationship", "body": "<p>So far the only I found is this one:</p>\n\n<pre><code>db.Table(\"entities\").\n    Where(\n        \"id in (?)\",\n        db.Table(\"data_entities\").\n            Select(\"entity_id\").\n            Where(\n                \"data_id = ?\",\n                data.ID,\n            ).\n            QueryExpr(),\n    ).\n    Where(\"entity_name = ?\", *entityName).\n    Update(&amp;data.Entity)\n</code></pre>\n\n<p>But I found 2 problems here:</p>\n\n<p>1) Impossible to do a deeper subrequest:</p>\n\n<pre><code>Select(\"entity_id\").\n    Where(\n        \"data_id = ?\",\n        data.ID,\n    )...\n</code></pre>\n\n<p>Won't work if instead of <code>data.ID</code> I want to go deeper with an other sub-request.\n2) in case of multiple many-2-many I assume I would need to duplicate the query.</p>\n"}, {"comments": [{"owner": {"reputation": 149, "user_id": 9144511, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_VbT8TZ2f5M/AAAAAAAAAAI/AAAAAAAAAFM/ZSplr4rJEt4/photo.jpg?sz=128", "display_name": "Daniel Kurniadi", "link": "https://stackoverflow.com/users/9144511/daniel-kurniadi"}, "edited": false, "score": 0, "creation_date": 1590735954, "post_id": 48446015, "comment_id": 109798015, "body": "Hi @Battalgazi, I notice that this solution is from the gorm documentation itself. I came here from the docs there because adding new entities as the above doesn&#39;t work. Have you tried yourself?"}, {"owner": {"reputation": 2429, "user_id": 5091805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e4vgq.png?s=128&g=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/5091805/ari"}, "edited": false, "score": 0, "creation_date": 1612181153, "post_id": 48446015, "comment_id": 116677586, "body": "Check your database, append will add new records every time, so its not actually updating the association, just writing a new record and leaving the old ones there."}], "tags": [], "owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "is_accepted": false, "score": 1, "last_activity_date": 1516893269, "last_edit_date": 1516893269, "creation_date": 1516892808, "answer_id": 48446015, "question_id": 47871117, "link": "https://stackoverflow.com/questions/47871117/how-to-update-with-a-many-to-many-relationship/48446015#48446015", "title": "How to update with a many-to-many relationship", "body": "<p>I do it like this:</p>\n\n<p>To update your data just pass a struct with only the fields you wanna update: </p>\n\n<pre><code>db.Model(&amp;data).Updates(Data{UserID: 2, AnswerID: 2})\n</code></pre>\n\n<p>and to add new entities:</p>\n\n<pre><code>db.Model(&amp;data).Association(\"Entities\").Append([]*Entity{&amp;Entity{Name: \"mynewentity\"}})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2429, "user_id": 5091805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e4vgq.png?s=128&g=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/5091805/ari"}, "edited": false, "score": 0, "creation_date": 1612180478, "post_id": 63211713, "comment_id": 116677297, "body": "If you check your Entities table you will probably notice it is still duplicating values, but just updates the join table to the new value."}], "tags": [], "owner": {"reputation": 21, "user_id": 11321966, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/961hX.jpg?s=128&g=1", "display_name": "Lgomes_dev", "link": "https://stackoverflow.com/users/11321966/lgomes-dev"}, "is_accepted": false, "score": 0, "last_activity_date": 1596657288, "last_edit_date": 1596657288, "creation_date": 1596334267, "answer_id": 63211713, "question_id": 47871117, "link": "https://stackoverflow.com/questions/47871117/how-to-update-with-a-many-to-many-relationship/63211713#63211713", "title": "How to update with a many-to-many relationship", "body": "<p>I was able to resolve according to the documentation using the Association.Replace\n<a href=\"http://gorm.io/docs/associations.html#Replace-Associations\" rel=\"nofollow noreferrer\">http://gorm.io/docs/associations.html#Replace-Associations</a></p>\n<pre><code>db.Debug().First(&amp;data)\n\ndata.Name = &quot;New Name&quot;\n\ndb.Save(&amp;data).Association(&quot;Entities&quot;).Replace([]Entity{{Name: &quot;mynewentity&quot;}})\n</code></pre>\n"}], "owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1596657288, "creation_date": 1513609282, "last_edit_date": 1513609475, "question_id": 47871117, "link": "https://stackoverflow.com/questions/47871117/how-to-update-with-a-many-to-many-relationship", "title": "How to update with a many-to-many relationship", "body": "<p>I'm facing a difficulty with the go orm gorm:</p>\n\n<p>I have a structure like this:</p>\n\n<pre><code>type Data struct {\n  gorm.Model\n  UserID   int `json:\"user_id,omitempty\"`\n  AnswerID int `json:\"answer_id,omitempty\"`\n  Entities []Entity `gorm:\"many2many:data_entities;\"`\n}\n\ntype Entity struct {\n  gorm.Model\n  Name string\n}\n</code></pre>\n\n<p>And now, either if I do:</p>\n\n<pre><code>db.Model(&amp;data).Where(Data{AnswerID: data.AnswerID}).Assign(&amp;data).FirstOrCreate(&amp;data)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>db.Model(&amp;data).Where(Data{AnswerID: d.AnswerID}).Update(&amp;data)\n</code></pre>\n\n<p>My many-to-many fields aren't updated but created... Leading to duplications if already exists.</p>\n\n<p>If I try to play with the <code>Related()</code> function, it simply stop updating the foreign field.</p>\n\n<p>Is there a way to update or create properly every tables linked?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513605440, "post_id": 47869988, "comment_id": 82705022, "body": "This may help: <a href=\"https://stackoverflow.com/questions/30219751/go-get-signal-origin/30226279#30226279\" title=\"go get signal origin\">stackoverflow.com/questions/30219751/go-get-signal-origin/&hellip;</a>"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1513928431, "post_id": 47869988, "comment_id": 82844281, "body": "I run your code on Ubuntu17.10 x64, Go1.8.3, and its work very well. Even I add GoRoutine on go side."}, {"owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 1, "creation_date": 1552637869, "post_id": 47869988, "comment_id": 97094368, "body": "which OS are you running your code?"}], "owner": {"reputation": 101, "user_id": 9113659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5f842098e4d8efe85d6ef8413e3cc99?s=128&d=identicon&r=PG&f=1", "display_name": "Sy.Z", "link": "https://stackoverflow.com/users/9113659/sy-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 936, "favorite_count": 2, "answer_count": 0, "score": 10, "last_activity_date": 1592804239, "creation_date": 1513605334, "last_edit_date": 1592804239, "question_id": 47869988, "link": "https://stackoverflow.com/questions/47869988/how-does-cgo-handle-signals", "title": "How does cgo handle signals?", "body": "<p>I ran into a problem where the Go program uses a .so lib, and the c code needs to deal with a signal SIGALRM. But it seems that once a signal SIGALRM is released, the program crashes.\nFrom &quot;The Go Programming Language&quot; I see this:</p>\n<blockquote>\n<p>If the non-Go code installs any signal handlers, it must use the SA_ONSTACK flag with sigaction. Failing to do so is likely to cause the program to crash if the signal is received.</p>\n</blockquote>\n<p>Can anyone please show the correct usage of SA_ONSTACK flag with sigaction. I would appreciate it very much.</p>\n<p>Below is my code:</p>\n<pre><code>// LIC_TIMER_CALLBACK_FUNC is a function pointer\n\nstatic LIC_TIMER_CALLBACK_FUNC s_pfnTmCallBack;\n\nstatic void _OS_TriggerTask(int iSig)\n{\n    logInfo(&quot;_OS_TriggerTask start...&quot;);\n    if (LIC_NULL_PTR != s_pfnTmCallBack)\n    {\n        logInfo(&quot;call timer callback...&quot;);\n        s_pfnTmCallBack(0);    \n    }\n    logInfo(&quot;_OS_TriggerTask end...&quot;);\n}\n\n// set the trigger\nint OS_StartTrigger(int ulLength, LIC_TIMER_CALLBACK_FUNC pfnTmCallBack)\n{    \n    logInfo(&quot;OS_StartTrigger start...&quot;);\n\ns_pfnTmCallBack = pfnTmCallBack;\n\nstruct sigaction stSigact; \n\nstSigact.sa_handler = _OS_TriggerTask;\nstSigact.sa_flags   = SA_ONSTACK;\nsigemptyset(&amp;stSigact.sa_mask);\nint iRet = sigaction(SIGALRM, &amp;stSigact, NULL);\n\nif(0 != iRet)\n{\n    logError(&quot;set signal failed...&quot;);\n}\nelse\n{\n    logInfo(&quot;set signal success...&quot;);\n}\n\n/* set time interval */\nstruct itimerval stItimerVal;\nstItimerVal.it_value.tv_sec = 60;\nstItimerVal.it_value.tv_usec = 0;\nstItimerVal.it_interval = stItimerVal.it_value;\n\niRet = setitimer(ITIMER_REAL, &amp;stItimerVal, NULL);\n\nif(0 != iRet)\n{\n    logError(&quot;set timer failed...&quot;);\n    return -1;\n}\n\nlogInfo(&quot;OS_StartTrigger end...&quot;);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1513603651, "post_id": 47869476, "comment_id": 82704022, "body": "We can&#39;t tell what <code>db.Model</code>, <code>models.User</code>, and <code>Count</code> are or what they do. Please provide a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>."}], "answers": [{"comments": [{"owner": {"reputation": 2634, "user_id": 2566671, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/sIAd4.jpg?s=128&g=1", "display_name": "pyprism", "link": "https://stackoverflow.com/users/2566671/pyprism"}, "edited": false, "score": 0, "creation_date": 1513604026, "post_id": 47869593, "comment_id": 82704238, "body": "its still printing 0"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1513607609, "post_id": 47869593, "comment_id": 82706322, "body": "enable <a href=\"http://jinzhu.me/gorm/advanced.html#logger\" rel=\"nofollow noreferrer\">logging</a> to see the generated query, then try it against your database."}], "tags": [], "owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "is_accepted": true, "score": 1, "last_activity_date": 1513603811, "creation_date": 1513603811, "answer_id": 47869593, "question_id": 47869476, "link": "https://stackoverflow.com/questions/47869476/count-returns-wrong-result/47869593#47869593", "title": "Count returns wrong result", "body": "<p>You need to pass the <code>count</code> variable to <code>Counter</code> as a reference, as it is now it is passed by value. You should do:</p>\n\n<pre><code>db.Model(&amp;models.User{}).Count(&amp;count)\n</code></pre>\n"}], "owner": {"reputation": 2634, "user_id": 2566671, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/sIAd4.jpg?s=128&g=1", "display_name": "pyprism", "link": "https://stackoverflow.com/users/2566671/pyprism"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 47869593, "answer_count": 1, "score": 0, "last_activity_date": 1513603841, "creation_date": 1513603438, "last_edit_date": 1513603841, "question_id": 47869476, "link": "https://stackoverflow.com/questions/47869476/count-returns-wrong-result", "title": "Count returns wrong result", "body": "<p>I have a user model and currently there is only one row. I am trying to count number of rows of whole User table,  here is my code:</p>\n\n<pre><code>var count int64\ndb.Model(&amp;models.User{}).Count(count)\nfmt.Println(count)\n</code></pre>\n\n<p>I am expecting <strong>1</strong> but it is  printing <strong>0</strong>.\nWhat is the correct way to print number of row in table using <strong>gorm</strong>?  </p>\n\n<p>update: My user model:</p>\n\n<pre><code>package models\n\nimport \"github.com/jinzhu/gorm\"\n\ntype User struct {\n    gorm.Model\n    Name string\n    Password string\n    Admin bool\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "struct", "default-value"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1513602859, "creation_date": 1513602859, "answer_id": 47869302, "question_id": 47869253, "link": "https://stackoverflow.com/questions/47869253/how-search-in-mongo-with-using-custom-structure/47869302#47869302", "title": "How search in mongo with using custom structure?", "body": "<p><a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> is a struct type, and its <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero</a> value is a valid time value and is not considered \"empty\". So in case of <code>time.Time</code> if you need to differentiate between the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero</a> and empty values, use a pointer to it instead, that is <code>*time.Time</code>. The <code>nil</code> pointer value will be the <em>empty</em> value, and any non-<code>nil</code> pointer values will denote non-empty time values.</p>\n\n<pre><code>type User struct {\n    Mail      string     `json:\"mail\" bson:\"mail,omitempty\"`\n    Password  string     `json:\"password\" bson:\"password,omitempty\"`\n    CreatedAt *time.Time `json:\"created_at\" bson:\"created_at,omitempty\"`\n    UpdatedAt *time.Time `json:\"updated_at\" bson:\"updated_at,omitempty\"`\n}\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/32643815/golang-json-omitempty-with-time-time-field/32646035#32646035\">Golang JSON omitempty With time.Time Field</a></p>\n"}], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 47869302, "answer_count": 1, "score": 2, "last_activity_date": 1513602859, "creation_date": 1513602698, "question_id": 47869253, "link": "https://stackoverflow.com/questions/47869253/how-search-in-mongo-with-using-custom-structure", "title": "How search in mongo with using custom structure?", "body": "<p>How to ignore the default values of the <code>time</code> field in the query?<br>\nBecause they are set in <code>0001-01-01 00:00:00 +0000 UTC</code>, I can not find the right document</p>\n\n<pre><code>// User model\ntype User struct {\n    Mail      string        `json:\"mail\" bson:\"mail,omitempty\"`\n    Password  string        `json:\"password\" bson:\"password,omitempty\"`\n    CreatedAt time.Time     `json:\"created_at\" bson:\"created_at,omitempty\"`\n    UpdatedAt time.Time     `json:\"updated_at\" bson:\"updated_at,omitempty\"`\n}\n</code></pre>\n\n<p>Example <a href=\"https://play.golang.org/p/P2P30PPtl0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/P2P30PPtl0</a></p>\n"}, {"tags": ["linux", "docker", "go", "memory", "containers"], "comments": [{"owner": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1513591094, "post_id": 47865559, "comment_id": 82696702, "body": "Isn&#39;t that caused by the forever loop that you made?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1513591354, "post_id": 47865559, "comment_id": 82696868, "body": "@DharmaSaputra: The forever loop just prints data to a file. It doesn&#39;t continually use memory."}, {"owner": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1513593029, "post_id": 47865559, "comment_id": 82697880, "body": "I tried the code on my machine. Actually <code>defer file.Close()</code> never executed, and the file <code>test.txt</code> is getting bigger and bigger. Because it keeps append."}, {"owner": {"reputation": 33, "user_id": 9112652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f639c96b8545259bff892f1ef2871774?s=128&d=identicon&r=PG&f=1", "display_name": "kmat", "link": "https://stackoverflow.com/users/9112652/kmat"}, "edited": false, "score": 0, "creation_date": 1513606967, "post_id": 47865559, "comment_id": 82705904, "body": "Thank you guys. The answer from Alex solved my problem. Will use file.Sync() but not everytime for performance reason."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9112652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f639c96b8545259bff892f1ef2871774?s=128&d=identicon&r=PG&f=1", "display_name": "kmat", "link": "https://stackoverflow.com/users/9112652/kmat"}, "edited": false, "score": 0, "creation_date": 1513594540, "post_id": 47866256, "comment_id": 82698797, "body": "Thanks! file.Sync() works. I&#39;d like to know if you recommend to use file.Sync()  or to call file.Close() in terms of application performance."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 33, "user_id": 9112652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f639c96b8545259bff892f1ef2871774?s=128&d=identicon&r=PG&f=1", "display_name": "kmat", "link": "https://stackoverflow.com/users/9112652/kmat"}, "edited": false, "score": 0, "creation_date": 1513596516, "post_id": 47866256, "comment_id": 82699962, "body": "I would call File.Sync if you are planning to continuously write to a file. Because closing the file and opening it again when I need to write, would be more labour intensive."}, {"owner": {"reputation": 657, "user_id": 4394926, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LIjcL.jpg?s=128&g=1", "display_name": "node_saini", "link": "https://stackoverflow.com/users/4394926/node-saini"}, "edited": false, "score": 0, "creation_date": 1569585298, "post_id": 47866256, "comment_id": 102654841, "body": "@AlexEfimov I am facing the same issue but there is no for loop. I have createwritestream and i am not closing it. As a best practice, I will close it but this method gets executed only at specific conditions. So basically my program is sitting idle and still, the memory is going high. Can you please tell why?"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1569585650, "post_id": 47866256, "comment_id": 102655007, "body": "I am guessing that the stream you create is writing to memory, without writing it to disk. What is the exact code you are using?"}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 6, "last_activity_date": 1513592708, "last_edit_date": 1513592708, "creation_date": 1513592233, "answer_id": 47866256, "question_id": 47865559, "link": "https://stackoverflow.com/questions/47865559/docker-container-keep-increasing-memory-usage-when-writing-into-a-file-in-a-moun/47866256#47866256", "title": "docker container keep increasing memory usage when writing into a file in a mounted directory", "body": "<p>Call this from time to time. </p>\n\n<pre><code>file.Sync() \n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/os/#File.Sync\" rel=\"noreferrer\">https://golang.org/pkg/os/#File.Sync</a></p>\n\n<p>If you do not call this it writes to memory and waits for <code>file.Close()</code> in order to commit the changes to the file.\nAnd in this case <code>Close in not called</code> because it is in a <code>defer</code> (this means it is called when the function returns, and here it will never return since it is a never-ending for).</p>\n\n<p>LE: \nAlso try using:</p>\n\n<pre><code>file.WriteString(\"hello world\")\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>fmt.Fprintln(file, \"hello world\")\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9112652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f639c96b8545259bff892f1ef2871774?s=128&d=identicon&r=PG&f=1", "display_name": "kmat", "link": "https://stackoverflow.com/users/9112652/kmat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2415, "favorite_count": 0, "accepted_answer_id": 47866256, "answer_count": 1, "score": 3, "last_activity_date": 1513592708, "creation_date": 1513589946, "last_edit_date": 1513590424, "question_id": 47865559, "link": "https://stackoverflow.com/questions/47865559/docker-container-keep-increasing-memory-usage-when-writing-into-a-file-in-a-moun", "title": "docker container keep increasing memory usage when writing into a file in a mounted directory", "body": "<p>I'm facing an issue that memory used by a container keep increasing when an app inside the container writing log into a file in a mounted directory.</p>\n\n<p>I'd expect memory usage doesn't increase by this.\nDoes anyone have idea why it increases ?\nThank you !!</p>\n\n<p>Here is what I did:</p>\n\n<ol>\n<li><p>Write an app which just writes \"hello world\" into \"/home/mylog/test.txt\".</p>\n\n<pre><code>func main(){\nfile, _ := os.OpenFile(\"/home/mylog/test.txt\", os.O_WRONLY|os.O_CREATE, 0666)\ndefer file.Close()\nfor {\n    fmt.Fprintln(file, \"hello world\")\n    }\n}\n</code></pre></li>\n<li><p>Build a docker image</p></li>\n</ol>\n\n<pre>\n\n    docker build -t mylog .\n\n</pre>\n\n<p>Dockerfile</p>\n\n<pre>\n\n    FROM golang\n    RUN mkdir -p /home/mylog\n    COPY main.go /go\n    WORKDIR /go\n    CMD [\"go\",\"run\",\"main.go\"]\n\n</pre>\n\n<ol start=\"3\">\n<li>Run a container with -v option mouting the current dir.</li>\n</ol>\n\n<pre>\n\n    docker run -d -v $PWD:/home/mylog mylog \n\n</pre>\n\n<ol start=\"4\">\n<li>Check memory usage</li>\n</ol>\n\n<pre>\n\n    docker stats \n\n</pre>\n\n<ol start=\"5\">\n<li>It's using 527MiB.</li>\n</ol>\n\n<pre>\n    CONTAINER CPU% MEMUSAGE / LIMIT MEM% NET I/O BLOCK I/O PIDS \n     100.41% 527MiB / 15.5GiB 3.32% 648B /0B 72.3MB / 0B 15\n</pre>\n\n<ol start=\"6\">\n<li>After a few seconds, it is 844.8 MiB</li>\n</ol>\n\n<pre>\n\n    CONTAINER CPU% MEMUSAGE / LIMIT MEM% NET I/O BLOCK I/O PIDS\n     100.15% 844.8MiB / 15.5GiB 5.32% 648B /0B 72.3MB / 0B 15\n\n</pre>\n\n<ol start=\"7\">\n<li>It keeps increasing and the host downs in the end.</li>\n</ol>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 6781453, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5c42967fa7f354ebfdc017545350f3a?s=128&d=identicon&r=PG&f=1", "display_name": "fauzanrazandi", "link": "https://stackoverflow.com/users/6781453/fauzanrazandi"}, "edited": false, "score": 0, "creation_date": 1513644431, "post_id": 47865191, "comment_id": 82723053, "body": "Well thanks for the suggestion, I was also thinking about create a small function for repetitive test. :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1513588455, "creation_date": 1513588455, "answer_id": 47865191, "question_id": 47865060, "link": "https://stackoverflow.com/questions/47865060/multiple-httptest-newrequest-with-different-condition-in-go-test/47865191#47865191", "title": "Multiple httptest.NewRequest with different condition in Go Test", "body": "<p>There is little reason to optimize tests for performance, as tests don't get compiled into your app and they don't run with your app; just don't do \"senseless\" slow things. They run \"offline\" to verify the correctness of your app, so performance of tests is nowhere near critical.</p>\n\n<p>So write your tests to be clean and short in source code.</p>\n\n<p>But that being said, you can create a utility function to create and set up similar requests, for example:</p>\n\n<pre><code>func newRequest(url string) *http.Request {\n    r := httptest.NewRequest(\"GET\", url, nil)\n    r.Header.Add(\"Accept-Language\", \"id\")\n    return r\n}\n</code></pre>\n\n<p>And using it to reconstruct your example:</p>\n\n<pre><code>r1 := newRequest(url)\nr1.AddCookie(&amp;cookie)\n\nr2 := newRequest(url)\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 6781453, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d5c42967fa7f354ebfdc017545350f3a?s=128&d=identicon&r=PG&f=1", "display_name": "fauzanrazandi", "link": "https://stackoverflow.com/users/6781453/fauzanrazandi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 689, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513588455, "creation_date": 1513587922, "question_id": 47865060, "link": "https://stackoverflow.com/questions/47865060/multiple-httptest-newrequest-with-different-condition-in-go-test", "title": "Multiple httptest.NewRequest with different condition in Go Test", "body": "<p>I am still new in Golang. Do you have any ideas on how to create a multiple httptest.NewRequest efficiently in your Go test file? Usually I initiate a new variable two create new request.</p>\n\n<p>For instance :</p>\n\n<pre><code>r1 := httptest.NewRequest(\"GET\", url, nil)\nr1.Header.Add(\"Accept-Language\", \"id\")\nr1.AddCookie(&amp;cookie)\n\nr2 := httptest.NewRequest(\"GET\", url, nil)\nr1.Header.Add(\"Accept-Language\", \"id\")\n</code></pre>\n\n<p>So I want to create 2 different request, in fact I have to initiate 2 variable in order to generate new request. I also uses test table so I can't add the cookie after the first test is running.</p>\n"}, {"tags": ["performance", "file", "go", "io", "fwrite"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513587336, "post_id": 47864800, "comment_id": 82694682, "body": "Probably because your disk buffer is saturated at that point?"}, {"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513588171, "post_id": 47864800, "comment_id": 82695122, "body": "Several months ago,  I wrote a similar process using <code>writev</code> method in C language. I found the writing speed is almost equal to disk I/O speed. Does this can prove that it&#39;s not related to disk buffer?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1513596933, "post_id": 47864800, "comment_id": 82700206, "body": "Profile your code, that&#39;s about the best hope you have. If performance degrades beyond 21G, you should see something in the profiles. Most likely io wait."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1513597053, "post_id": 47864800, "comment_id": 82700268, "body": "<i>My disk I/O speed is about 1000M/s.</i>  It&#39;s not that simple.  How big are your IO operations?  Are there any seek operations that move any physical disk heads between IO operations?   I guarantee you that if you do 512-byte IO operations to/from random locations on a physical, spinning disk drive you won&#39;t see IO rates anwhere near &quot;about 1000M/s&quot;.  On a consumer-grade SATA disk, you might see IO rates down as low as 20 KB/sec or maybe even less."}, {"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1513649221, "post_id": 47864800, "comment_id": 82724123, "body": "I know multiple threads writing the same disk simultaneously is a slow operation. Because disk header seek position cost much time.  So I choose a clean disk for that testing. There is no other data and no running program reading from or writing to the disk."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1513701764, "post_id": 47864800, "comment_id": 82749324, "body": "I think we need to see the C program or some other evidence..."}, {"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1513737956, "post_id": 47864800, "comment_id": 82762972, "body": "I upload my C code here. I think I have made something wrong. Thank every one."}, {"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513740273, "post_id": 47864800, "comment_id": 82763447, "body": "@Flimzy, Thank you. I think you are right."}], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1513739110, "post_id": 47889346, "comment_id": 82763207, "body": "I tried to comment code here, but I don&#39;t know how. So I uploaded my test result in my issue again.  I think I have gotten something wrong with my speed testing. Thank you."}, {"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1513740338, "post_id": 47889346, "comment_id": 82763459, "body": "Thanks. I think I have gotten the answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1513694499, "creation_date": 1513694499, "answer_id": 47889346, "question_id": 47864800, "link": "https://stackoverflow.com/questions/47864800/disk-write-performance-in-golang/47889346#47889346", "title": "disk write performance in golang", "body": "<p>Your issue is not reproducible. Your code has bugs.</p>\n\n<p>We would expect that disk write time would be affected by a number of factors: the program, other programs, the operating system, hardware, and so on.</p>\n\n<p>Boot a standalone, dedicated machine, and run the <code>diskio.go</code> program. What results do you get? For example, on my machine:</p>\n\n<pre><code>$ go build diskio.go\n$ time ./diskio -size=32\nwritten: 34359738368B 154333936544ns 34.36GB 154.33s 222.63MB/s\nreal    2m35.323s\nuser    0m6.418s\nsys     0m41.994s\n$ time ./diskio -size=16\nwritten: 17179869184B 77901269159ns 17.18GB 77.90s 220.53MB/s\nreal    1m18.746s\nuser    0m2.849s\nsys     0m21.721s\n$ time ./diskio -size=8\nwritten: 8589934592B 38940248134ns 8.59GB 38.94s 220.59MB/s\nreal    0m39.625s\nuser    0m1.719s\nsys     0m12.493s\n$ time ./diskio -size=1\nwritten: 1073741824B 4738082404ns 1.07GB 4.74s 226.62MB/s\nreal    0m4.851s\nuser    0m0.069s\nsys     0m0.755s\n$ \n</code></pre>\n\n<p>As expected, little time is spent in the program, more time is spent in the operating system, a lot of time is spent waiting on the disk. There is no precipitous change in write speed.</p>\n\n<p><code>diskio.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc writeFile(fSize int64) error {\n    fName := `/home/peter/diskio` // test file\n    defer os.Remove(fName)\n    f, err := os.Create(fName)\n    if err != nil {\n        return err\n    }\n    const defaultBufSize = 4096\n    buf := make([]byte, defaultBufSize)\n    buf[len(buf)-1] = '\\n'\n    w := bufio.NewWriterSize(f, len(buf))\n\n    start := time.Now()\n    written := int64(0)\n    for i := int64(0); i &lt; fSize; i += int64(len(buf)) {\n        nn, err := w.Write(buf)\n        written += int64(nn)\n        if err != nil {\n            return err\n        }\n    }\n    err = w.Flush()\n    if err != nil {\n        return err\n    }\n    err = f.Sync()\n    if err != nil {\n        return err\n    }\n    since := time.Since(start)\n\n    err = f.Close()\n    if err != nil {\n        return err\n    }\n    fmt.Printf(\"written: %dB %dns %.2fGB %.2fs %.2fMB/s\\n\",\n        written, since,\n        float64(written)/1000000000, float64(since)/float64(time.Second),\n        (float64(written)/1000000)/(float64(since)/float64(time.Second)),\n    )\n    return nil\n}\n\nvar size = flag.Int(\"size\", 8, \"file size in GiB\")\n\nfunc main() {\n    flag.Parse()\n    fSize := int64(*size) * (1024 * 1024 * 1024)\n    err := writeFile(fSize)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, fSize, err)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/vnjnpgMzsV\" rel=\"noreferrer\">https://play.golang.org/p/vnjnpgMzsV</a></p>\n"}, {"tags": [], "owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "is_accepted": true, "score": 1, "last_activity_date": 1513742911, "creation_date": 1513742911, "answer_id": 47898657, "question_id": 47864800, "link": "https://stackoverflow.com/questions/47864800/disk-write-performance-in-golang/47898657#47898657", "title": "disk write performance in golang", "body": "<p>I think I get the answer to this question. Because my disk I/O speed is about 194M/s, and disk buffer I/O is about 9093M/s. But disk buffer size is about 18166M. So the writing speed is faster when file size is smaller than 20G. I used this command to test my disk I/O speed:</p>\n\n<pre><code>hdparm -Tt /dev/sde1\n/dev/sde1:\nTiming cached reads:   18166 MB in  2.00 seconds = 9093.93 MB/sec\nTiming buffered disk reads: 584 MB in  3.01 seconds = 194.18 MB/sec\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 6705425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MK7ES.jpg?s=128&g=1", "display_name": "scaszoo", "link": "https://stackoverflow.com/users/6705425/scaszoo"}, "is_accepted": false, "score": 0, "last_activity_date": 1584808186, "creation_date": 1584808186, "answer_id": 60790339, "question_id": 47864800, "link": "https://stackoverflow.com/questions/47864800/disk-write-performance-in-golang/60790339#60790339", "title": "disk write performance in golang", "body": "<p>\"18166 MB in  2.00 seconds\" were read. That is not the size of your cache. There may be disks with huge caches but its more in the three digit MB range.</p>\n"}], "owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5834, "favorite_count": 1, "accepted_answer_id": 47898657, "answer_count": 3, "score": 9, "last_activity_date": 1584808186, "creation_date": 1513586879, "last_edit_date": 1513740198, "question_id": 47864800, "link": "https://stackoverflow.com/questions/47864800/disk-write-performance-in-golang", "title": "disk write performance in golang", "body": "<p>In the following code, I write messages to a file using bufio in golang. My disk I/O speed is about 1000M/s. Strangely, when the size of the written file is less than 20G, the writing speed is about 800M~900M per second, a little bit less than the I/O speed. But, when the file size is more than 21G, I found the writing speed is about 200M per second, much less than the I/O speed. I don't know why, anybody can help me? Thank you.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport (\n    \"os\"\n    \"time\"\n    \"flag\"\n    \"bufio\"\n)\n\nfunc main() {\n    var pRound = flag.Int64(\"round\", 3500000, \"loop round\")\n    flag.Parse()\n\n    var message string\n    for i := 0; i &lt; 1024; i++ {\n        message += \"1234567890\"\n    }\n    message += \"\\n\"\n\n    f, err := os.OpenFile(\"server\", os.O_CREATE|os.O_APPEND|os.O_RDWR, 0666)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    w := bufio.NewWriter(f)\n\n    var i int64 = 0\n    round := *pRound\n    start := time.Now()\n    for i = 0; i &lt; round; i++ {\n        w.WriteString(message)\n    }\n    w.Flush()\n    f.Close()\n    end := time.Now()\n\n    nanoseconds := end.Sub(start).Nanoseconds()\n    speed := 1000000000 * round / nanoseconds\n\n    fmt.Printf(\"round: %v\\n\", round)\n    fmt.Printf(\"Nanoseconds: %v\\n\", nanoseconds)\n    fmt.Printf(\"speed: %v\\n\", speed)\n}\n</code></pre>\n\n<p>I think I have asked a foolish question. On the response of <code>Vorsprung</code>, I show my C code here. And I test it again in C language. I find the same result with go language. My test result is: </p>\n\n<pre><code>./a.out 10000\nseconds: 7\nmilliseconds: 260910\ntotal: 10485760000 Bytes\ntotal: 10000 M\ntotal: 9.76562 G\nspeed: 1377.24 M/s\n\n\n./a.out 20000\nseconds: 24\nmilliseconds: 7249\ntotal: 20971520000 Bytes\ntotal: 20000 M\ntotal: 19.5312 G\nspeed: 833.082 M/s\n\n\n./a.out 30000\nseconds: 80\nmilliseconds: 518970\ntotal: 31457280000 Bytes\ntotal: 30000 M\ntotal: 29.2969 G\nspeed: 372.583 M/s\n\n\n\n./a.out 40000\nseconds: 134\nmilliseconds: 615910\ntotal: 41943040000 Bytes\ntotal: 40000 M\ntotal: 39.0625 G\nspeed: 297.142 M/s\n</code></pre>\n\n<p>The following is my C code:</p>\n\n<pre><code>#include &lt;fcntl.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;limits.h&gt;\n#include &lt;sys/uio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;iostream&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(int argc, char* argv[]) {\n  if (argc != 2) {\n    std::cout &lt;&lt; \"usage: \" &lt;&lt; argv[0] &lt;&lt; \" round\" &lt;&lt; std::endl;\n    return -1;\n  }\n  int round = atoi(argv[1]);\n\n  int fd = open(\"file.data\", O_CREAT | O_APPEND | O_RDWR, 0666);\n  if (fd == -1) {\n    std::cout &lt;&lt; \"open file error: \" &lt;&lt; strerror(errno) &lt;&lt; std::endl;\n    return -1;\n  }\n\n  struct iovec vec[IOV_MAX];\n  int len = 1024;\n  for (int i = 0; i &lt; IOV_MAX; i++) {\n    vec[i].iov_base = new char[len];\n    vec[i].iov_len = len;\n\n    char *buf = NULL;\n    for (int j = 0; j &lt; len - 1; j++) {\n      buf = (char*)vec[i].iov_base;\n      buf[j] = j % 10 + '1';\n    }\n    buf[len - 1] = '\\n';\n  }\n\n  timeval tv1;\n  gettimeofday(&amp;tv1, NULL);\n  for (int i = 0; i &lt; round; i++) {\n    writev(fd, vec, IOV_MAX);\n  }\n\n  close(fd);\n\n  timeval tv2;\n  gettimeofday(&amp;tv2, NULL);\n\n  for (int i = 0; i &lt; IOV_MAX; i++) {\n     char* buf = (char*)vec[i].iov_base;\n     delete[] buf;\n  }\n\n  std::cout &lt;&lt; \"seconds: \" &lt;&lt; tv2.tv_sec - tv1.tv_sec &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"milliseconds: \" &lt;&lt; tv2.tv_usec - tv1.tv_usec &lt;&lt; std::endl;\n  int64_t total = int64_t(len) * IOV_MAX * round;\n  float t = (tv2.tv_sec - tv1.tv_sec) * 1000000.0 + (tv2.tv_usec - tv1.tv_usec);\n  float speed = 1000000.0 * total / t / 1024 / 1024;\n  std::cout &lt;&lt; \"total: \" &lt;&lt; total &lt;&lt; \" Bytes\" &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"total: \" &lt;&lt; total / 1024.0 / 1024.0 &lt;&lt; \" M\" &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"total: \" &lt;&lt; total / 1024.0 / 1024.0 / 1024.0 &lt;&lt; \" G\" &lt;&lt; std::endl;\n  std::cout &lt;&lt; \"speed: \" &lt;&lt; speed &lt;&lt; \" M/s\" &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre>\n\n<p>Now my diskio.go test result show here. because I don't know how to comment a easy-reading result in comment, I show it here.</p>\n\n<pre><code>time ./diskio -size=4\nwritten: 4294967296B 26237051975ns 4.29GB 26.24s 163.70MB/s\nreal    0m26.980s\nuser    0m0.397s\nsys     0m4.874s\n\n\ntime ./diskio -size=8\nwritten: 8589934592B 57803019028ns 8.59GB 57.80s 148.61MB/s\nreal    0m59.192s\nuser    0m0.813s\nsys     0m9.607s\n\n\n\ntime ./diskio -size=10\nwritten: 10737418240B 68331989999ns 10.74GB 68.33s 157.14MB/s\nreal    1m10.288s\nuser    0m0.946s\nsys     0m12.024s\n\n\n\n\ntime ./diskio -size=20\nwritten: 21474836480B 141169506440ns 21.47GB 141.17s 152.12MB/s\nreal    2m25.037s\nuser    0m1.881s\nsys     0m24.029s\n\n\ntime ./diskio -size=30\nwritten: 32212254720B 203807569664ns 32.21GB 203.81s 158.05MB/s\nreal    3m29.345s\nuser    0m2.925s\nsys     0m33.528s\n</code></pre>\n\n<p>diskio.go comes from <a href=\"https://stackoverflow.com/a/47889346/5616809\">https://stackoverflow.com/a/47889346/5616809</a></p>\n\n<p>I think I get the answer, the testing result is caused by the disk buffer reason. I tested my disk speed using <code>hdparm</code> commend, and I got this:</p>\n\n<pre><code>hdparm -Tt /dev/sde1\n/dev/sde1:\nTiming cached reads:   18166 MB in  2.00 seconds = 9093.93 MB/sec\nTiming buffered disk reads: 584 MB in  3.01 seconds = 194.18 MB/sec\n</code></pre>\n\n<p>So maybe my program is writting bytes to buffer when file size is less than about 18166M. After that the program is writting to the disk, so it's speed is slower.</p>\n"}, {"tags": ["go", "concurrency", "hashmap", "synchronization"], "comments": [{"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 2, "creation_date": 1513584646, "post_id": 47864261, "comment_id": 82693497, "body": "Please provide a code sample showing your error. Seems like you are creating normal maps (e.g. with <code>make(map[string]interface{}</code>) and accessing them in a concurrent manner."}, {"owner": {"reputation": 31, "user_id": 3833087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c96c8b681bc0ae05ce986393336659b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arjun Tomar", "link": "https://stackoverflow.com/users/3833087/arjun-tomar"}, "reply_to_user": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1513585832, "post_id": 47864261, "comment_id": 82693996, "body": "@ArmanOrdookhani updated the question."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 1, "creation_date": 1513586404, "post_id": 47864261, "comment_id": 82694262, "body": "Is <code>recSet</code> shared between some goroutines by any chance? Try to run your code like <code>go run -race main.go</code> to get stack traces of where you are concurrently accessing a map."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1513600524, "post_id": 47864261, "comment_id": 82702245, "body": "Use the race detector. The sync.Map doesn\u2019t magically make its contents safe for concurrent reads and writes"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1513616173, "post_id": 47864261, "comment_id": 82711383, "body": "Show us the part that does the <code>delete()</code>. Pay attention to that part. I bet you will find the problem yourself right in there..."}, {"owner": {"reputation": 31, "user_id": 3833087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c96c8b681bc0ae05ce986393336659b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arjun Tomar", "link": "https://stackoverflow.com/users/3833087/arjun-tomar"}, "edited": false, "score": 0, "creation_date": 1513750993, "post_id": 47864261, "comment_id": 82766341, "body": "thanks for taking time to respond. I figured out the problem with the code. See the answer below."}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 3833087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c96c8b681bc0ae05ce986393336659b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arjun Tomar", "link": "https://stackoverflow.com/users/3833087/arjun-tomar"}, "is_accepted": true, "score": 1, "last_activity_date": 1513750837, "creation_date": 1513750837, "answer_id": 47899888, "question_id": 47864261, "link": "https://stackoverflow.com/questions/47864261/facing-concurrency-issues-with-go-sync-maps/47899888#47899888", "title": "Facing concurrency issues with Go sync maps", "body": "<p>I figured out what the problem with the code was. I used the sync.Map as Value type instead of pointers. </p>\n\n<p>So, I was making copies of the underlying mutexes. And on read/write operations the lock was on the copy instead of original mutex.</p>\n\n<p>Changing the map to use pointers solved the problem.</p>\n"}], "owner": {"reputation": 31, "user_id": 3833087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c96c8b681bc0ae05ce986393336659b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arjun Tomar", "link": "https://stackoverflow.com/users/3833087/arjun-tomar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 0, "accepted_answer_id": 47899888, "answer_count": 1, "score": 1, "last_activity_date": 1513750837, "creation_date": 1513584263, "last_edit_date": 1513586477, "question_id": 47864261, "link": "https://stackoverflow.com/questions/47864261/facing-concurrency-issues-with-go-sync-maps", "title": "Facing concurrency issues with Go sync maps", "body": "<p>I am having problems with Go's <code>sync.Map</code>. Below are the details:</p>\n\n<p>I created a global sync map like:</p>\n\n<pre><code>var MySyncGlobalMap = sync.Map{}\n</code></pre>\n\n<p>and on an event I populate this map with the intended structure as \n<code>map[int64]map[string]interface{}</code>. So basically I want to populate the <strong>sync map</strong> with key as <code>int64</code> and value as another <strong>sync map</strong> of structure <code>map[string]interface{}</code>. Below is how I populate the map:</p>\n\n<pre><code>//below is the innerSync map. recSet is returned from DB call in the format : []map[string]interface{}\nvar innerSyncMap = sync.Map{}\nfor _, record := range recSet {\n\n    sKey := record[\"key\"].(string)\n    value := record[\"value\"]\n    innerSyncMap.Store(sKey, value)\n}\nMySyncGlobalMap.Store(jobID, innerSyncMap)\n</code></pre>\n\n<p>Now there will be multiple threads which will be accessing this map and do some operations. There will be constant updates to the inner sync map. Once the processing is done on the key of the inner sync map, that key will be deleted from that map. </p>\n\n<p>I will know that a job is complete once the inner sync map becomes empty. </p>\n\n<p>Now since there are multiple threads accessing this map I receiving a panic:</p>\n\n<blockquote>\n  <p>Fatal error: concurrent read and write</p>\n</blockquote>\n\n<p>I am still wondering that even after using <strong>sync map</strong> I am facing this issue. </p>\n\n<p>Can any one point out what am I doing wrong?</p>\n"}, {"tags": ["google-app-engine", "firebase", "go", "firebase-authentication", "firebase-admin"], "comments": [{"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1513649055, "post_id": 47864216, "comment_id": 82724078, "body": "This will get addressed eventually when <a href=\"https://github.com/firebase/firebase-admin-go/issues/52\" rel=\"nofollow noreferrer\">github.com/firebase/firebase-admin-go/issues/52</a> is resolved. But it will take some time, since it essentially requires a breaking API change. But you can do the change locally if you wish."}, {"owner": {"reputation": 289, "user_id": 5456612, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-h3gOyj8CNgY/AAAAAAAAAAI/AAAAAAAAAiQ/3Jy9aCOOyYQ/photo.jpg?sz=128", "display_name": "Matti", "link": "https://stackoverflow.com/users/5456612/matti"}, "reply_to_user": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1521098877, "post_id": 47864216, "comment_id": 85589665, "body": "I scanned through <a href=\"https://github.com/firebase/firebase-admin-go/pull/88/files\" rel=\"nofollow noreferrer\">github.com/firebase/firebase-admin-go/pull/88/files</a> .. but will supplying Context to each call be enough? Not sure how the http client passed upon auth client creation with option.WithHTTPClient(urlfetch.Client(ctx)) behaves, like if the http client itself will become stale or not with the Context it was created with."}], "owner": {"reputation": 289, "user_id": 5456612, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-h3gOyj8CNgY/AAAAAAAAAAI/AAAAAAAAAiQ/3Jy9aCOOyYQ/photo.jpg?sz=128", "display_name": "Matti", "link": "https://stackoverflow.com/users/5456612/matti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1513586508, "creation_date": 1513584060, "last_edit_date": 1513586508, "question_id": 47864216, "link": "https://stackoverflow.com/questions/47864216/making-the-auth-client-cacheable-on-appengine", "title": "Making the Auth client cacheable on AppEngine", "body": "<p>This is about using the Firebase Admin SDK for Go: <a href=\"https://github.com/firebase/firebase-admin-go/\" rel=\"nofollow noreferrer\">https://github.com/firebase/firebase-admin-go/</a> (in Google AppEngine)</p>\n\n<p>Is there a nice way (without forking the firebase-admin-go repo) to make the created Auth clients cacheable on AppEngine? They cannot be cached as such because the supplied Context will rot quite soon (resulting after a while in: Call error 3: invalid security ticket). The reason they should be cached is that the client internally fetches the public keys over the internet, making any token verification take almost 200ms on that first time. </p>\n\n<p>If I were to modify this myself, I'd probably do something like this:</p>\n\n<ol>\n<li>create a new client every request (as per how Context works in\nAppEngine)</li>\n<li>have the client accept some kind of configuration option that would enable me to pass an old client instance to it</li>\n<li>have the new client instance would check the old client's key cache and use it if it is still non-expired</li>\n</ol>\n\n<p>As far as I can tell, this is not possible with the current API. Any workarounds I could be missing? Suggesting a breaking change to the library is not something I'd lightly be willing to do.</p>\n"}, {"tags": ["debugging", "go", "goland"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513586545, "post_id": 47863299, "comment_id": 82694319, "body": "The best way to fix it would be not to use global variables."}], "answers": [{"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 2, "last_activity_date": 1513594254, "creation_date": 1513594254, "answer_id": 47866878, "question_id": 47863299, "link": "https://stackoverflow.com/questions/47863299/how-to-inspect-global-variables-in-goland-when-debugging-a-golang-program/47866878#47866878", "title": "How to inspect global variables in GoLand when debugging a golang program?", "body": "<p>I think there is no way to show all global variables automatically. Just add them manually (by clicking plus sign or pressing <kbd>Insert</kbd>).</p>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 8030966, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/615a6c4202afe09ab1459393c3f1e94f?s=128&d=identicon&r=PG&f=1", "display_name": "hc ch", "link": "https://stackoverflow.com/users/8030966/hc-ch"}, "is_accepted": false, "score": 3, "last_activity_date": 1520258876, "creation_date": 1520258876, "answer_id": 49112292, "question_id": 47863299, "link": "https://stackoverflow.com/questions/47863299/how-to-inspect-global-variables-in-goland-when-debugging-a-golang-program/49112292#49112292", "title": "How to inspect global variables in GoLand when debugging a golang program?", "body": "<p>We can use Evaluate function to get the value of global variables, but can only get one value each time</p>\n\n<p><a href=\"https://i.stack.imgur.com/uXBqY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uXBqY.png\" alt=\"evaluate\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 5099417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tm93i.jpg?s=128&g=1", "display_name": "Srikanth Lankapalli", "link": "https://stackoverflow.com/users/5099417/srikanth-lankapalli"}, "is_accepted": false, "score": 0, "last_activity_date": 1537660705, "creation_date": 1537660705, "answer_id": 52461853, "question_id": 47863299, "link": "https://stackoverflow.com/questions/47863299/how-to-inspect-global-variables-in-goland-when-debugging-a-golang-program/52461853#52461853", "title": "How to inspect global variables in GoLand when debugging a golang program?", "body": "<p>visual code will show both local and global variables.</p>\n"}, {"tags": [], "owner": {"reputation": 393, "user_id": 2325028, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4FReE.jpg?s=128&g=1", "display_name": "Gakio", "link": "https://stackoverflow.com/users/2325028/gakio"}, "is_accepted": false, "score": 2, "last_activity_date": 1589303016, "creation_date": 1589303016, "answer_id": 61757627, "question_id": 47863299, "link": "https://stackoverflow.com/questions/47863299/how-to-inspect-global-variables-in-goland-when-debugging-a-golang-program/61757627#61757627", "title": "How to inspect global variables in GoLand when debugging a golang program?", "body": "<p>You can also right click the variable in the editor and \"Add to Watches\".</p>\n"}], "owner": {"reputation": 137, "user_id": 8030966, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/615a6c4202afe09ab1459393c3f1e94f?s=128&d=identicon&r=PG&f=1", "display_name": "hc ch", "link": "https://stackoverflow.com/users/8030966/hc-ch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1841, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1589303016, "creation_date": 1513579251, "last_edit_date": 1513586534, "question_id": 47863299, "link": "https://stackoverflow.com/questions/47863299/how-to-inspect-global-variables-in-goland-when-debugging-a-golang-program", "title": "How to inspect global variables in GoLand when debugging a golang program?", "body": "<p>When I debug a go program in GoLand, I can't see the value of global variable. Can anyone tell me why and how to fix it?</p>\n\n<p>Here is an example:</p>\n\n<p>I set a breakpoint in the last line of main function. But as shown in the picture, we can only get the value of 'a', but not 'a' and 'xx'.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar xx int = 1\n\nfunc main() {\n    var a int = 1\n    fmt.Println(a)\n    xx = 3\n    fmt.Println(\"end\")\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/ghGJ2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ghGJ2.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["git", "go", "go-git"], "comments": [{"owner": {"reputation": 594, "user_id": 1054114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc175ba42a40a2cd3d3ba24910f9bfa1?s=128&d=identicon&r=PG", "display_name": "orirawlings", "link": "https://stackoverflow.com/users/1054114/orirawlings"}, "edited": false, "score": 0, "creation_date": 1513612275, "post_id": 47862844, "comment_id": 82709199, "body": "<a href=\"https://github.com/src-d/go-git/issues/679\" rel=\"nofollow noreferrer\">github.com/src-d/go-git/issues/679</a>"}], "answers": [{"tags": [], "owner": {"reputation": 20825, "user_id": 717372, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/048230d83d50ff15f0b4fb4e0c033e5e?s=128&d=identicon&r=PG", "display_name": "Philippe", "link": "https://stackoverflow.com/users/717372/philippe"}, "is_accepted": false, "score": 0, "last_activity_date": 1513580157, "creation_date": 1513580157, "answer_id": 47863453, "question_id": 47862844, "link": "https://stackoverflow.com/questions/47862844/how-to-find-common-ancestor-for-two-branches-programmatically/47863453#47863453", "title": "How to find common ancestor for two branches programmatically", "body": "<p>You could use the result of the command:</p>\n\n<pre><code> git merge-base branch1 branch2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 594, "user_id": 1054114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc175ba42a40a2cd3d3ba24910f9bfa1?s=128&d=identicon&r=PG", "display_name": "orirawlings", "link": "https://stackoverflow.com/users/1054114/orirawlings"}, "is_accepted": true, "score": 1, "last_activity_date": 1513700096, "creation_date": 1513700096, "answer_id": 47890972, "question_id": 47862844, "link": "https://stackoverflow.com/questions/47862844/how-to-find-common-ancestor-for-two-branches-programmatically/47890972#47890972", "title": "How to find common ancestor for two branches programmatically", "body": "<p>Here is small program using <code>go-git</code> that mimics the behavior of <code>git merge-base --all</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"gopkg.in/src-d/go-git.v4\"\n    . \"gopkg.in/src-d/go-git.v4/_examples\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/object\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/storer\"\n)\n\n// store h in set, s, handling nil s if necessary. Return new set.\nfunc store(s map[plumbing.Hash]bool, h plumbing.Hash) map[plumbing.Hash]bool {\n    if s == nil {\n        s = make(map[plumbing.Hash]bool)\n    }\n    s[h] = true\n    return s\n}\n\n// mergeBase finds best common ancestors between two commits to use in a\n// three-way merge. One common ancestor is better than another common ancestor\n// if the latter is an ancestor of the former. A common ancestor that does not\n// have any better common ancestor is a best common ancestor, i.e. a merge base.\n// Note that there can be more than one merge base for a pair of commits.\nfunc mergeBase(s storer.EncodedObjectStorer, a, b plumbing.Hash) ([]plumbing.Hash, error) {\n    commitA, err := object.GetCommit(s, a)\n    if err != nil {\n        return nil, err\n    }\n\n    commitB, err := object.GetCommit(s, b)\n    if err != nil {\n        return nil, err\n    }\n\n    // Mapping of direct descendants of each commit we visit\n    desc := make(map[plumbing.Hash]map[plumbing.Hash]bool)\n\n    // Set of commits reachable from a\n    reachableFromA := make(map[plumbing.Hash]bool)\n\n    // Walk commits reachable from A\n    err = object.NewCommitPreorderIter(commitA, nil, nil).ForEach(func(c *object.Commit) error {\n        reachableFromA[c.Hash] = true\n        for _, h := range c.ParentHashes {\n            desc[h] = store(desc[h], c.Hash)\n        }\n        return nil\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    // Set of common commits between a and b\n    common := make(map[plumbing.Hash]bool)\n\n    // Walk commits reachable from B\n    err = object.NewCommitPreorderIter(commitB, nil, nil).ForEach(func(c *object.Commit) error {\n        if reachableFromA[c.Hash] {\n            common[c.Hash] = true\n        }\n        for _, h := range c.ParentHashes {\n            desc[h] = store(desc[h], c.Hash)\n        }\n        return nil\n    })\n    if err != nil {\n        return nil, err\n    }\n\n    best := make(map[plumbing.Hash]bool)\n\n    // Trim down the set of common commits to only those that are best\n    for h := range common {\n        best[h] = true\n        for child := range desc[h] {\n            if common[child] {\n                // there is a descendant to h that is common to both a and b. h is not in best.\n                delete(best, h)\n                break\n            }\n        }\n    }\n\n    var result []plumbing.Hash\n    for h := range best {\n        result = append(result, h)\n    }\n    return result, nil\n}\n\n// Open an existing repository in a specific folder.\nfunc main() {\n    CheckArgs(\"&lt;path&gt; &lt;commitA&gt; &lt;commitB&gt;\")\n    path := os.Args[1]\n    a := plumbing.NewHash(os.Args[2])\n    b := plumbing.NewHash(os.Args[3])\n\n    r, err := git.PlainOpen(path)\n    CheckIfError(err)\n\n    bases, err := mergeBase(r.Storer, a, b)\n    CheckIfError(err)\n\n    for _, b := range bases {\n        fmt.Println(b)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6621961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22a18e9951bc4b8029ad74b924e61ea0?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/6621961/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 47890972, "answer_count": 2, "score": 2, "last_activity_date": 1513700096, "creation_date": 1513576674, "question_id": 47862844, "link": "https://stackoverflow.com/questions/47862844/how-to-find-common-ancestor-for-two-branches-programmatically", "title": "How to find common ancestor for two branches programmatically", "body": "<p>I am working on a project where I integrated my project with <code>git</code>. For integration purpose, I am using <code>go-git</code> library. My question is how can I find a common ancestor for two branches programmatically? I want to implement this function. Looks like <code>go-git</code>and other go library do not provide such functionality.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 545, "user_id": 3454167, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YFR0h.png?s=128&g=1", "display_name": "kasyauqi", "link": "https://stackoverflow.com/users/3454167/kasyauqi"}, "edited": false, "score": 0, "creation_date": 1513562819, "post_id": 47861022, "comment_id": 82687395, "body": "Ah, right there in the spec... Thanks for the answer and the code link."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 4, "last_activity_date": 1513560023, "creation_date": 1513560023, "answer_id": 47861022, "question_id": 47860964, "link": "https://stackoverflow.com/questions/47860964/go-shift-count-too-large/47861022#47861022", "title": "Go shift count too large", "body": "<p>512 is kind of an arbitrary limit. The only thing the spec says is:</p>\n\n<blockquote>\n  <p>Implementation restriction: Although numeric constants have arbitrary\n  precision in the language, a compiler may implement them using an\n  internal representation with limited precision. That said, every\n  implementation must:</p>\n  \n  <p>Represent integer constants with at least 256 bits.</p>\n</blockquote>\n\n<p>Unfortunately, the <a href=\"https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/mpfloat.go#L16\" rel=\"nofollow noreferrer\">comments around the limits</a> don't give a reason.</p>\n\n<p>At some point, a limit has to be used. I would recommend sticking to the required 256.</p>\n"}], "owner": {"reputation": 545, "user_id": 3454167, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YFR0h.png?s=128&g=1", "display_name": "kasyauqi", "link": "https://stackoverflow.com/users/3454167/kasyauqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 47861022, "answer_count": 1, "score": 3, "last_activity_date": 1513560023, "creation_date": 1513559257, "question_id": 47860964, "link": "https://stackoverflow.com/questions/47860964/go-shift-count-too-large", "title": "Go shift count too large", "body": "<p>In Go's <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">constant specification</a>, it is mentioned that:</p>\n\n<blockquote>\n  <p>Numeric constants represent exact values of arbitrary precision and do not overflow. </p>\n</blockquote>\n\n<p>So I tried  </p>\n\n<p><code>const VeryVeryBigNumber = 1 &lt;&lt; 200</code> </p>\n\n<p>and it works. However, the biggest shift count I could try is 511 and using 512 will throw:</p>\n\n<p><code>shift count too large: 512</code>.</p>\n\n<p>What does 512 represents? I have no intention to use it, I just want to know why is it limited to 511 in my machine (I'm using ubuntu 64 bit and go 1.9.2)?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "struct", "toml"], "comments": [{"owner": {"reputation": 316, "user_id": 8621025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a38189853a123f2a23a189d5a95997f?s=128&d=identicon&r=PG&f=1", "display_name": "rjsberry", "link": "https://stackoverflow.com/users/8621025/rjsberry"}, "edited": false, "score": 0, "creation_date": 1513617594, "post_id": 47860883, "comment_id": 82712117, "body": "Seeing as <code>part</code> is a sub-array of <code>item</code>, if you want to print out all of <code>item.part</code> for each item you need a nested loop."}, {"owner": {"reputation": 21, "user_id": 9110574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kFtO3.jpg?s=128&g=1", "display_name": "Voodoopants", "link": "https://stackoverflow.com/users/9110574/voodoopants"}, "reply_to_user": {"reputation": 316, "user_id": 8621025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a38189853a123f2a23a189d5a95997f?s=128&d=identicon&r=PG&f=1", "display_name": "rjsberry", "link": "https://stackoverflow.com/users/8621025/rjsberry"}, "edited": false, "score": 0, "creation_date": 1513704149, "post_id": 47860883, "comment_id": 82750803, "body": "That&#39;s pretty much where I failed. I don&#39;t know yet how to get that data. I tried setting up a <code>parts</code> struct like the <code>items</code> and put the <code>for</code> iteration for that within the <code>for _, items</code>. Nope. I think the problem stems from reading <code>demo.toml</code> into <code>allitems</code> and not knowing how I can properly reach into that sack of data from within the loop.  ...means: &quot;Help!&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9110574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kFtO3.jpg?s=128&g=1", "display_name": "Voodoopants", "link": "https://stackoverflow.com/users/9110574/voodoopants"}, "edited": false, "score": 0, "creation_date": 1513790064, "post_id": 47899607, "comment_id": 82789927, "body": "That&#39;s actually a lot simpler than anything I had tried and so much more direct. Forest vs trees. Thank you so much for your help."}], "tags": [], "owner": {"reputation": 1320, "user_id": 1600612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab513043b9b486138701a4b2a98648c8?s=128&d=identicon&r=PG", "display_name": "dvk", "link": "https://stackoverflow.com/users/1600612/dvk"}, "is_accepted": true, "score": 1, "last_activity_date": 1513749278, "creation_date": 1513749278, "answer_id": 47899607, "question_id": 47860883, "link": "https://stackoverflow.com/questions/47860883/how-to-parse-nested-arrays-sub-tables-in-toml/47899607#47899607", "title": "How to parse nested arrays / sub tables in TOML?", "body": "<p>As pointed out in the comments, you need a nested loop. Instead of this:</p>\n\n<pre><code>    fmt.Printf(\"    Part Name: %s \\n\", items.Part[0].PartName)\n    fmt.Printf(\"    Part Link: %s \\n\", items.Part[0].PartLink)\n</code></pre>\n\n<p>use this:</p>\n\n<pre><code>    for _, part := range items.Part {\n        fmt.Printf(\"    Part Name: %s \\n\", part.PartName)\n        fmt.Printf(\"    Part Link: %s \\n\", part.PartLink)\n    }\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9110574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kFtO3.jpg?s=128&g=1", "display_name": "Voodoopants", "link": "https://stackoverflow.com/users/9110574/voodoopants"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2761, "favorite_count": 0, "accepted_answer_id": 47899607, "answer_count": 1, "score": 1, "last_activity_date": 1513749278, "creation_date": 1513558422, "last_edit_date": 1513744833, "question_id": 47860883, "link": "https://stackoverflow.com/questions/47860883/how-to-parse-nested-arrays-sub-tables-in-toml", "title": "How to parse nested arrays / sub tables in TOML?", "body": "<p>I'm starting with <strong>Go</strong> and the official <a href=\"https://golang.org/doc/\" rel=\"nofollow noreferrer\">documentation</a> seems more for people who know Go already and just want to look stuff up. I'm hoping for a little nudge in the right direction here.</p>\n\n<p><strong>What I'm looking to do:</strong> Parse a <code>TOML</code> config file with <em>BurntSushi's</em> TOML parser that consists of several elements sharing the same base characteristics. </p>\n\n<p><strong>Where I'm stuck:</strong> I want each item's respective parts to be listed with the item. So far I can only get one of them by its index. What I'm looking for is how to set it up in a way that lists all sub parts of the respective index instead of just a specific one. I can get a JSON list with <code>[:]</code> but can't seem to adapt that to get <em>normal</em> output.</p>\n\n<p>Initially I had considered <code>[[item.part.001]]</code> and so on because it looked right in the online JSON parsers, but wasn't able to figure out how to read that properly into Go. Since I'm stuck anyway, I'm open to both types, whatever works best.</p>\n\n<p>Thanks in advance. Here are the files as an abbreviated minimum working example.</p>\n\n<hr>\n\n<blockquote>\n  <p>demo.toml</p>\n</blockquote>\n\n<pre><code># \u2014 \u2014 \u2014 \u2014 \u2014  \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \n#                   First Item\n# \u2014 \u2014 \u2014 \u2014 \u2014  \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \n\n[[item]]\nitemname = \"Fragments\"\nitemdesc = \"This one can get a bit longer.\"\n\n    [item.attributes]\n    material = \"Basematname\"\n    light    = \"Lightname\"\n    transpc  = \"full\"\n    displace = \"height\"\n\n    [[item.part]]\n    partname = \"Shard\"\n    partlink = \"active\"\n\n    [[item.part]]\n    partname = \"Tear\"\n    partlink = \"deferred\"\n\n    [[item.part]]\n    partname = \"crater\"\n    partlink = \"disabled\"\n\n\n# \u2014 \u2014 \u2014 \u2014 \u2014  \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \n#                   Second Item\n# \u2014 \u2014 \u2014 \u2014 \u2014  \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \n\n[[item]]\nitemname = \"Splash\"\nitemdesc = \"This one also can get a bit longer.\"\n\n    [item.attributes]\n    material = \"Other Basematname\"\n    light    = \"Other Lightname\"\n    transpc  = \"half\"\n    displace = \"bump\"\n\n    [[item.part]]\n    partname = \"Drops\"\n    partlink = \"active\"\n\n    [[item.part]]\n    partname = \"Wave\"\n    partlink = \"deferred\"\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>demo.go</p>\n</blockquote>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"github.com/BurntSushi/toml\"\n)\n\ntype item struct {\n    ItemName    string\n    ItemDesc    string\n    Attributes  attributes\n    Part        []part\n}\n\ntype part struct {\n    PartName    string\n    PartLink    string\n}\n\ntype attributes struct {\n    Material    string\n    Light       string\n    TransPC     string\n    Displace    string\n}\n\ntype items struct {\n    Item    []item\n}\n\n\n\nfunc main() {\n\n\n    var allitems items\n\n    if _, err := toml.DecodeFile(\"demo.toml\", &amp;allitems); err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Printf(\"\\n\")\n\n    for _, items := range allitems.Item {\n        fmt.Printf(\"    Item Name: %s \\n\", items.ItemName)\n        fmt.Printf(\"  Description: %s \\n\\n\", items.ItemDesc)\n\n        fmt.Printf(\"     Material: %s \\n\", items.Attributes.Material)\n        fmt.Printf(\"     Lightmap: %s \\n\", items.Attributes.Light)\n        fmt.Printf(\" TL Precision: %s \\n\", items.Attributes.TransPC)\n        fmt.Printf(\"   DP Channel: %s \\n\", items.Attributes.Displace)\n\n\n        fmt.Printf(\"    Part Name: %s \\n\", items.Part[0].PartName)\n        fmt.Printf(\"    Part Link: %s \\n\", items.Part[0].PartLink)\n        #                                             ^\n        #                              That's where [:] won't do it.   \n\n        fmt.Printf(\"\\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\\n\\n\")\n\n\n    }\n\n    fmt.Printf(\"\\n\")\n\n\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "exec", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1513556535, "last_edit_date": 1513556535, "creation_date": 1513556063, "answer_id": 47860712, "question_id": 47860671, "link": "https://stackoverflow.com/questions/47860671/main-thread-not-running-after-goroutine-calls-exec/47860712#47860712", "title": "Main thread not running after goroutine calls exec?", "body": "<p><code>syscall.Exec</code> replaces the current process with the one invoked.</p>\n\n<p>If you want to run an external command while keeping the original program running, you need to use <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\">exec.Command</a></p>\n\n<p>By the way, the link you included does say:</p>\n\n<blockquote>\n  <p>Sometimes we just want to completely replace the current Go process\n  with another (perhaps non-Go) one.</p>\n</blockquote>\n\n<p>If you really want to use the <code>syscall</code> package, you can use <code>syscall.StartProcess</code> which does a fork/exec as opposed to a plain exec.</p>\n"}], "owner": {"reputation": 3, "user_id": 9111338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/057a5cd9e4f98df3aa0ab03fe7a035ae?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy", "link": "https://stackoverflow.com/users/9111338/valeriy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 47860712, "answer_count": 1, "score": 0, "last_activity_date": 1513586744, "creation_date": 1513555597, "last_edit_date": 1513586744, "question_id": 47860671, "link": "https://stackoverflow.com/questions/47860671/main-thread-not-running-after-goroutine-calls-exec", "title": "Main thread not running after goroutine calls exec?", "body": "<p>I was reading about exec in Go <a href=\"https://gobyexample.com/execing-processes\" rel=\"nofollow noreferrer\">https://gobyexample.com/execing-processes</a>, and tried to do the same using goroutines.</p>\n\n<p>In the following code, I'm trying to make Go run <code>ls</code>, then print a success message in the main thread. However, it's only printing the ls, but not the success message.</p>\n\n<p>What's going on?</p>\n\n<p>Thanks.</p>\n\n<pre><code>package main\n\nimport \"syscall\"\nimport \"os\"\nimport \"os/exec\"\nimport \"fmt\"\n\nfunc main() {\n    p := fmt.Println\n    done := make(chan bool)\n    binary, lookErr := exec.LookPath(\"ls\")\n    if lookErr != nil {\n        panic(lookErr)\n    }\n\n    args := []string{\"ls\", \"-a\", \"-l\", \"-h\"}\n\n    env := os.Environ()\n\n    go func() {\n        execErr := syscall.Exec(binary, args, env)\n        if execErr != nil {\n            panic(execErr)\n        }\n        done &lt;- true\n    }()\n\n    &lt;-done\n\n    p(\"Done with exec\")\n}\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>Valeriys-MacBook-Pro:test valeriy$ go run test.go \ntotal 8\ndrwxr-xr-x  3 valeriy  staff    96B Dec 17 15:46 .\ndrwxr-xr-x  8 valeriy  staff   256B Dec 17 00:06 ..\n-rw-r--r--  1 valeriy  staff   433B Dec 17 15:38 test.go\n</code></pre>\n"}, {"tags": ["mongodb", "go", "struct", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 220, "user_id": 1897184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DFHEx.jpg?s=128&g=1", "display_name": "vmathieu", "link": "https://stackoverflow.com/users/1897184/vmathieu"}, "edited": false, "score": 0, "creation_date": 1513587336, "post_id": 47864650, "comment_id": 82694683, "body": "Thanks for this, it works and will save me a lot of work!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1513592278, "last_edit_date": 1513592278, "creation_date": 1513586268, "answer_id": 47864650, "question_id": 47860637, "link": "https://stackoverflow.com/questions/47860637/virtuals-property-on-bson-scheme/47864650#47864650", "title": "Virtuals property on bson scheme", "body": "<p>Easiest would be to simply add a method to the struct which calculates the value you want, and when you need it, call that method.</p>\n\n<p>For example:</p>\n\n<pre><code>type Person struct {\n    FirstName string `bson:\"firstName\"`\n    LastName  string `bson:\"lastName\"`\n}\n\nfunc (p *Person) Name() string {\n    return p.FirstName + \" \" + p.LastName\n}\n\nfunc main() {\n    p := &amp;Person{FirstName: \"Bob\", LastName: \"Archer\"}\n    fmt.Println(p.Name())\n}\n</code></pre>\n\n<p>Advantage of this is that <code>Name()</code> will always return the \"correct\" name even if you modify the first or last name after retrieving the document.</p>\n\n<p>If you want to avoid having to always calculate the result, you could store it in a field, e.g.:</p>\n\n<pre><code>type Person struct {\n    FirstName string `bson:\"firstName\"`\n    LastName  string `bson:\"lastName\"`\n    name      string\n}\n\nfunc (p *Person) Name() string {\n    if p.name == \"\" {\n        p.name = p.FirstName + \" \" + p.LastName\n    }\n    return p.name\n}\n</code></pre>\n\n<p>Note that when saving a value of <code>Person</code>, the <code>name</code> field would not get persisted as it is not exported.</p>\n\n<p>And if you wan to automate this (e.g. you want the <code>name</code> to be calculated automatically when you fetch your documents from MongoDB), you can write your custom unmarshaling logic by implementing the <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Setter\" rel=\"nofollow noreferrer\"><code>bson.Setter</code></a> interface. The custom unmarshaling logic would be nothing special, just calculating and setting the <code>name</code> field after doing the default marshaling logic.</p>\n\n<p>For example:</p>\n\n<pre><code>type Person struct {\n    FirstName string `bson:\"firstName\"`\n    LastName  string `bson:\"lastName\"`\n    name      string\n}\n\nfunc (p *Person) SetBSON(raw bson.Raw) (err error) {\n    type my Person\n    if err = raw.Unmarshal((*my)(p)); err != nil {\n        return\n    }\n    p.name = p.FirstName + \" \" + p.LastName\n    return nil\n}\n</code></pre>\n\n<p>And if you want the <code>name</code> field to be exported, e.g. <code>Name</code>, then you may use the <code>-</code> bson tag value to exclude this field from saving it to MongoDB, e.g.:</p>\n\n<pre><code>type Person struct {\n    FirstName string `bson:\"firstName\"`\n    LastName  string `bson:\"lastName\"`\n    Name      string `bson:\"-\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 220, "user_id": 1897184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DFHEx.jpg?s=128&g=1", "display_name": "vmathieu", "link": "https://stackoverflow.com/users/1897184/vmathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 47864650, "answer_count": 1, "score": 1, "last_activity_date": 1513592290, "creation_date": 1513555318, "last_edit_date": 1513592290, "question_id": 47860637, "link": "https://stackoverflow.com/questions/47860637/virtuals-property-on-bson-scheme", "title": "Virtuals property on bson scheme", "body": "<p>I always use <a href=\"http://mongoosejs.com/docs/guide.html#virtuals\" rel=\"nofollow noreferrer\">virtuals properties</a> on documents with mongoose in my nodes projects, and want to use the same mechanism in my golang projects. I can't find the best way to implement something like this.</p>\n\n<p>I have some struct, retrieved from my DB and want to add field based on my server config (like IP address, etc...). I want to avoid calling the same function every time I fetch this collection's documents.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1513546943, "post_id": 47859551, "comment_id": 82684189, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/20849591/storing-nested-structs-with-mgo\">Storing nested structs with mgo</a>"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1513546795, "creation_date": 1513546795, "answer_id": 47859733, "question_id": 47859551, "link": "https://stackoverflow.com/questions/47859551/how-to-properly-unmarshal-mgo-result-into-struct-with-bson-objectid-fields/47859733#47859733", "title": "How to properly unmarshal mgo result into struct with bson.ObjectId Fields", "body": "<p>You need to use the <code>inline</code> flag:</p>\n\n<pre><code>type ProductCategory struct {\n    Document `bson:\",inline\"`\n    // other fields ...\n}\n</code></pre>\n\n<p>See the <a href=\"https://godoc.org/labix.org/v2/mgo/bson#Marshal\" rel=\"nofollow noreferrer\">bson Marshal docs</a> for more info:</p>\n\n<pre><code>inline     Inline the field, which must be a struct or a map,\n           causing all of its fields or keys to be processed as if\n           they were part of the outer struct. For maps, keys must\n           not conflict with the bson keys of other struct fields.\n</code></pre>\n"}], "owner": {"reputation": 574, "user_id": 4492899, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/anTtJ.jpg?s=128&g=1", "display_name": "Sean Parsons", "link": "https://stackoverflow.com/users/4492899/sean-parsons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1007, "favorite_count": 0, "accepted_answer_id": 47859733, "answer_count": 1, "score": 2, "last_activity_date": 1513546795, "creation_date": 1513545544, "question_id": 47859551, "link": "https://stackoverflow.com/questions/47859551/how-to-properly-unmarshal-mgo-result-into-struct-with-bson-objectid-fields", "title": "How to properly unmarshal mgo result into struct with bson.ObjectId Fields", "body": "<p>I'm using the mgo package for Mongo database interactions.</p>\n\n<p>I currently have a base struct that looks like:</p>\n\n<pre><code>type Document struct {\n    ID bson.ObjectId `bson:\"_id\"` // Unique document _id.\n\n    EntityId bson.ObjectId `bson:\"entity_id\"` // Used to create relationships between collections.\n\n    EffectiveDate time.Time `bson:\"effective_date\"` // Date this document becomes effective.\n\n    // Audit Fields.\n    CreatedAt time.Time     `bson:\"created_at\"`\n    CreatedBy bson.ObjectId `bson:\"created_by\"`\n\n    UpdatedAt time.Time     `bson:\"updated_at\"`\n    UpdatedBy bson.ObjectId `bson:\"updated_by\"`\n\n    // Document state(stale, current, etc..)\n    IsActive  bool `bson:\"is_active\"`\n    IsDeleted bool `bson:\"is_deleted\"`\n    IsMaster  bool `bson:\"is_master\"`\n\n    ExternalID string `bson:\"external_id\"`\n\n    CompanyID bson.ObjectId `bson:\"company_id\"` // The unique ObjectId for that company.\n}\n</code></pre>\n\n<p>I embedded this Document struct into more specific collection defined structs that look like:</p>\n\n<pre><code>// Represents a product-category document.\ntype ProductCategory struct {\n    Document // Embedded base document struct contains all base fields.\n\n    Name       string `bson:\"name\"`        // Name of the category\n    CategoryID string `bson:\"category_id\"` // Unique id of the category.\n}\n</code></pre>\n\n<p>I'm able to run queries like this one below and get all the fields I need besides the <code>bson.ObjectId</code> fields including ID(_id).</p>\n\n<pre><code>  var pc collections.ProductCategory\n    col := session.DB(\"some_db\").C(\"product-category\")\n\n    col.Find(nil).One(&amp;pc)\n\n    // All fields are here besides [Id, CompanyId, CreatedBy, UpdatedBy] etc..\n</code></pre>\n\n<p>Is there any glaring issues on why the Fields I need aren't being added to the struct?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513544388, "post_id": 47859348, "comment_id": 82683493, "body": "Addr() already returns a pointer value. Calling Pointer() on it is wrong. Probably you should extract the actual pointer via Interface() instead of Pointer()."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1513572449, "last_edit_date": 1513572449, "creation_date": 1513546177, "answer_id": 47859648, "question_id": 47859348, "link": "https://stackoverflow.com/questions/47859348/convert-uintptr-from-reflection-into-pointer/47859648#47859648", "title": "Convert uintptr from reflection into pointer (*)", "body": "<p>Use <a href=\"http://godoc.org/unsafe#Pointer\" rel=\"nofollow noreferrer\">unsafe.Pointer</a> to convert a uintptr to a pointer of some type. As an example, the following expression converts uintptr <code>u</code> to a <code>T</code> pointer:</p>\n\n<pre><code>(*T)(unsafe.Pointer(u))\n</code></pre>\n\n<p>This conversion does not help in <code>StructAttributesToPointersSlice</code> because the struct fields can be of any type.  Also, the conversion from <code>uintptr</code> is not needed and unsafe.</p>\n\n<p>The expression <code>valueField.Addr()</code> is the reflect.Value for the pointer to the field. Call <code>Interface()</code> to get the actual pointer. To fix the program, change</p>\n\n<pre><code>ptrs = append(ptrs, valueField.Addr().Pointer())\n</code></pre>\n\n<p>to </p>\n\n<pre><code>ptrs = append(ptrs, valueField.Addr().Interface())\n</code></pre>\n\n<p>Here's a simplified version of the function:</p>\n\n<pre><code>func StructAttributesToPointersSlice(object interface{}) []interface{} {\n    v := reflect.ValueOf(object)\n    if v.Kind() != reflect.Ptr || v.Elem().Kind() != reflect.Struct {\n        panic(\"argument must be a pointer to struct\")\n    }\n\n    v = v.Elem()\n    var result []interface{}\n    for i := 0; i &lt; v.NumField(); i++ {\n        f := v.Field(i)\n        if !f.CanSet() {\n            continue\n        }\n        result = append(result, f.Addr().Interface())\n\n    }\n    return result\n}\n</code></pre>\n\n<p>Some notes about this code:</p>\n\n<ul>\n<li>The argument must be a pointer to a struct. </li>\n<li>There's no need to call CanAddr on the fields. The check for pointer to struct covers this.</li>\n<li>The CanSet() skips over unexported fields. You may want it to panic instead.</li>\n<li>The function panics for errors in the caller. Consider returning an error instead.</li>\n</ul>\n\n<p><a href=\"https://play.golang.org/p/kKNd_giJs2\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1226, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513585870, "creation_date": 1513543991, "last_edit_date": 1513585870, "question_id": 47859348, "link": "https://stackoverflow.com/questions/47859348/convert-uintptr-from-reflection-into-pointer", "title": "Convert uintptr from reflection into pointer (*)", "body": "<p>I just can't find the way to get a slice of pointer to each attribute of a given struct. I am using reflection to get my pointers (Thanks to <a href=\"https://stackoverflow.com/a/24348352/6093604\">https://stackoverflow.com/a/24348352/6093604</a>)</p>\n\n<pre><code>if valueField.CanAddr() {\n    address = fmt.Sprintf(\"0x%X\", valueField.Addr().Pointer())\n}\n</code></pre>\n\n<p>As you can see, valueField.Addr().Pointer() returns a pointer addr value, however, using reflection, I would like to get a usable pointer for <code>sql.Rows.Scan()</code></p>\n\n<p>So what did I do is:</p>\n\n<pre><code>func StructAttributesToPointersSlice(object interface{}) []interface{} {\n\n    val := reflect.ValueOf(object)\n\n    if val.Kind() == reflect.Interface &amp;&amp; !val.IsNil() {\n        elm := val.Elem()\n        if elm.Kind() == reflect.Ptr &amp;&amp; !elm.IsNil() &amp;&amp; elm.Elem().Kind() == reflect.Ptr {\n            val = elm\n        }\n    }\n    if val.Kind() == reflect.Ptr {\n        val = val.Elem()\n    }\n\n    var ptrs []interface{}\n    for i := 0; i &lt; val.NumField(); i++ {\n        valueField := val.Field(i)\n\n        if valueField.Kind() == reflect.Ptr {\n            valueField = valueField.Elem()\n\n        }\n        if valueField.CanAddr() {\n            ptrs = append(ptrs, valueField.Addr().Pointer())\n        }\n    }\n\n    return ptrs\n}\n</code></pre>\n\n<p>But when I try to use it for <code>Scan()</code> sql function:</p>\n\n<pre><code>var values []interface{}\n\n// Iterate over each rows got from the query\nfor rows.Next() {\n\n    ptrs := utils.StructAttributesToPointersSlice(&amp;newObject)\n\n    for _, item := range ptrs {\n        fmt.Println(reflect.TypeOf(item))\n    }\n\n    err = rows.Scan(ptrs...)\n    if err != nil {\n        return nil, model.Status{Code: http.StatusInternalServerError, Error: err.Error()}\n    } else {\n        values = append(values, newObject)\n    }\n}\n</code></pre>\n\n<p>I am getting this error: </p>\n\n<blockquote>\n  <p>sql: Scan error on column index 0: destination not a pointer</p>\n</blockquote>\n\n<p>I know it's because it's not the good type since it's a <code>uintptr</code>, but then how to transform it into usable pointer?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["regex", "go", "path", "directory", "filepath"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1513532524, "post_id": 47857770, "comment_id": 82679903, "body": "<code>filepath.Dir</code> and <code>filepath.Base</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 14, "last_activity_date": 1513532805, "creation_date": 1513532805, "answer_id": 47857847, "question_id": 47857770, "link": "https://stackoverflow.com/questions/47857770/get-the-directory-name-not-a-path-of-a-given-file-path-in-golang/47857847#47857847", "title": "Get the directory name (not a path) of a given file path in Golang", "body": "<p>You can use <code>filepath.Base</code> to get the last element of the directory.\nFor example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    paths := []string{\n        \"/home/arnie/amelia.jpg\",\n        \"/mnt/photos/\",\n        \"rabbit.jpg\",\n        \"/usr/local//go\",\n    }\n    for _, p := range paths {\n        dir := filepath.Dir(p)\n        parent := filepath.Base(dir)\n        fmt.Printf(\"input: %q\\n\\tdir: %q\\n\\tparent: %q\\n\", p, dir, parent)\n    }\n}\n</code></pre>\n\n<p>Returns:</p>\n\n<pre><code>input: \"/home/arnie/amelia.jpg\"\n    dir: \"/home/arnie\"\n    parent: \"arnie\"\ninput: \"/mnt/photos/\"\n    dir: \"/mnt/photos\"\n    parent: \"photos\"\ninput: \"rabbit.jpg\"\n    dir: \".\"\n    parent: \".\"\ninput: \"/usr/local//go\"\n    dir: \"/usr/local\"\n    parent: \"local\"\n</code></pre>\n\n<p>(example adapted from the <a href=\"https://golang.org/pkg/path/filepath/#pkg-examples\" rel=\"noreferrer\">filepath examples</a>)</p>\n"}], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9223, "favorite_count": 0, "accepted_answer_id": 47857847, "answer_count": 1, "score": 3, "last_activity_date": 1513532805, "creation_date": 1513532231, "question_id": 47857770, "link": "https://stackoverflow.com/questions/47857770/get-the-directory-name-not-a-path-of-a-given-file-path-in-golang", "title": "Get the directory name (not a path) of a given file path in Golang", "body": "<p>By using the <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\"><code>path/filepath</code></a> package with the following example, you can get the full directory path from a file path.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    // Output: /path/to/dir\n    fmt.Println(filepath.Dir(\"/path//to/dir/file.ext\"))\n}\n</code></pre>\n\n<p>But is there a <code>Parent</code> function to get the <code>dir</code> from the path? (<em>which is the name of the directory of the file</em>):</p>\n\n<pre><code>// The `Parent` is what I want,\n// and this is a pseudo-code example, this won't actually work.\n//\n// Output: dir\nfmt.Println(filepath.Parent(\"/path//to/dir/file.ext\"))\n</code></pre>\n\n<p>If it can't be done with the functions, how do I get the parent's name with RegExp?</p>\n"}, {"tags": ["security", "go"], "answers": [{"comments": [{"owner": {"reputation": 3782, "user_id": 839211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/THWvr.jpg?s=128&g=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/839211/felipe"}, "edited": false, "score": 0, "creation_date": 1513533628, "post_id": 47857805, "comment_id": 82680271, "body": "Hi, thanks for your response. I changed my code to your suggestion, but the <code>tls.Loadx509KeyPair()</code> function also expects a path to a certificate file and a path to a key file and not a byte array containing this information. When I ran your code I got this error: <code>open : The system cannot find the file specified.</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 3782, "user_id": 839211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/THWvr.jpg?s=128&g=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/839211/felipe"}, "edited": false, "score": 0, "creation_date": 1513533941, "post_id": 47857805, "comment_id": 82680359, "body": "Good point. I&#39;ve edited the answer to use <code>tls.X509KeyPair</code>. In the future, you can just look at the source of <a href=\"https://golang.org/src/crypto/tls/tls.go?s=5407:5474#L168\" rel=\"nofollow noreferrer\">Loadx509KeyPair</a> and see what it does."}, {"owner": {"reputation": 3782, "user_id": 839211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/THWvr.jpg?s=128&g=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/839211/felipe"}, "edited": false, "score": 0, "creation_date": 1513534151, "post_id": 47857805, "comment_id": 82680420, "body": "Hi, I changed to use the <code>tls.X509KeyPair</code> and everything works. Thanks for the help!"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 13, "last_activity_date": 1513540620, "last_edit_date": 1513540620, "creation_date": 1513532486, "answer_id": 47857805, "question_id": 47857573, "link": "https://stackoverflow.com/questions/47857573/passing-certificate-and-key-as-string-to-listenandservetls/47857805#47857805", "title": "Passing certificate and key as string to ListenAndServeTLS", "body": "<p>You can build your own server object and still call <code>ListenAndServeTLS</code>. Since your tls config has certificates, it will ignore the passed-in filenames.\nI'm omitting the return on error for conciseness, please do not:</p>\n\n<pre><code>// Generate a key pair from your pem-encoded cert and key ([]byte).\ncert, err := tls.X509KeyPair(&lt;cert contents&gt;, &lt;key contents&gt;)\n\n// Construct a tls.config\ntlsConfig := &amp;tls.Config{\n  Certificates: []tls.Certificate{cert}\n  // Other options\n}\n\n// Build a server:\nserver := http.Server{\n    // Other options\n    TLSConfig: tlsConfig,\n}\n\n// Finally: serve.\nerr = server.ListenAndServeTLS(\"\", \"\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3921, "user_id": 2061684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46ad823a3c12f55ee1103eeec268bc54?s=128&d=identicon&r=PG", "display_name": "jnovack", "link": "https://stackoverflow.com/users/2061684/jnovack"}, "is_accepted": false, "score": 0, "last_activity_date": 1601238483, "creation_date": 1601238483, "answer_id": 64093010, "question_id": 47857573, "link": "https://stackoverflow.com/questions/47857573/passing-certificate-and-key-as-string-to-listenandservetls/64093010#64093010", "title": "Passing certificate and key as string to ListenAndServeTLS", "body": "<p>In my case, I was unable to load files from disk, but did have the certificates passed in to the environment as variables (<code>[]byte</code>).</p>\n<p>Adding on to Marc's answer, I had to only change the top line.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// Append signed leaf certificate and intermediate to a single  \ncertChain := append(leaf.PublicBytes, intermediate.PublicBytes...)\n\n// Generate a key pair from your pem-encoded cert and key ([]byte).\ncert, err := tls.X509KeyPair(certChain, leaf.PrivateBytes)\n...\n</code></pre>\n"}], "owner": {"reputation": 3782, "user_id": 839211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/THWvr.jpg?s=128&g=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/839211/felipe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2185, "favorite_count": 3, "accepted_answer_id": 47857805, "answer_count": 2, "score": 8, "last_activity_date": 1601238483, "creation_date": 1513531038, "last_edit_date": 1513532147, "question_id": 47857573, "link": "https://stackoverflow.com/questions/47857573/passing-certificate-and-key-as-string-to-listenandservetls", "title": "Passing certificate and key as string to ListenAndServeTLS", "body": "<p>I am creating an app using Go and I am trying to start a https server using the <code>ListenAndServeTLS</code> function. Here is my code:</p>\n\n<pre><code>func StartServer() {\n    defer config.CapturePanic()\n    c := config.GetInstance()\n\n    serverAddress := fmt.Sprintf(\":%s\", c.GetConfig().ServerPort)\n    server := http.Server{Addr: serverAddress}\n\n    log.Info(\"Starting local server\")\n    http.HandleFunc(\"/\", login.Handler)\n    http.HandleFunc(\"/login\", login.Handler)\n    http.HandleFunc(\"/settings\", settings.Handler)\n\n    //cert, _ := data.Asset(\"my-cert.pem\")\n    //key, _ := data.Asset(\"my-key.pem\")\n    err := server.ListenAndServeTLS(\"my-cert.crt\", \"my-cert.key\")\n    if err != nil {\n        log.WithError(err).Fatal(\"Error stopping local server\")\n    }\n}\n</code></pre>\n\n<p>The thing is that I would like to embed my certificate and its key inside my executable file and then pass them to the the <code>server.ListeAndServeTLS</code> function as a string or a byte array. However this function does not take these types of arguments. Is there another way to do this?</p>\n\n<p>Note: I am aware that it is a bad practice to embed a private key inside a client application, however what I am trying to do here is just to create a config webpage that will be hosted as <code>https://localhost:8080</code>.</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1513530797, "post_id": 47857315, "comment_id": 82679351, "body": "At a guess (hence why this is a comment, not an answer), I would say it&#39;s to make sure you don&#39;t accidentally implement the Message interface. With only the <code>String</code> and <code>Reset</code> methods, too many things will match. eg: a <code>bytes.Buffer</code> would implement the interface if <code>ProtoMessage()</code> wasn&#39;t required."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1513536476, "last_edit_date": 1513536476, "creation_date": 1513534648, "answer_id": 47858106, "question_id": 47857315, "link": "https://stackoverflow.com/questions/47857315/whats-the-purpose-of-protomessage-method/47858106#47858106", "title": "What&#39;s the purpose of ProtoMessage method?", "body": "<p>Quoting from official doc: <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated\" rel=\"nofollow noreferrer\">Protocol Buffers: Go Generated Code:</a></p>\n\n<blockquote>\n  <p>Given a simple message declaration:</p>\n\n<pre><code>message Foo {}\n</code></pre>\n  \n  <p>the protocol buffer compiler generates a struct called <code>Foo</code>. A <code>*Foo</code> implements the <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Message\" rel=\"nofollow noreferrer\">Message</a> interface. See the inline comments for more information.</p>\n\n<pre><code>type Foo struct {\n}\n\n// Reset sets the proto's state to default values.\nfunc (m *Foo) Reset()         { *m = Foo{} }\n\n// String returns a string representation of the proto.\nfunc (m *Foo) String() string { return proto.CompactTextString(m) }\n\n// ProtoMessage acts as a tag to make sure no one accidentally implements the\n// proto.Message interface.\nfunc (*Foo) ProtoMessage()    {}\n</code></pre>\n  \n  <p>Note that all of these members are always present; the <code>optimize_for</code> option does not affect the output of the Go code generator.</p>\n</blockquote>\n\n<p>This is a (similar) technique described in Go official <a href=\"https://golang.org/doc/faq#guarantee_satisfies_interface\" rel=\"nofollow noreferrer\">FAQ: How can I guarantee my type satisfies an interface?</a></p>\n\n<blockquote>\n  <p>If you wish the users of an interface to explicitly declare that they implement it, you can add a method with a descriptive name to the interface's method set. For example:</p>\n\n<pre><code>type Fooer interface {\n    Foo()\n    ImplementsFooer()\n}\n</code></pre>\n  \n  <p>A type must then implement the <code>ImplementsFooer</code> method to be a <code>Fooer</code>, clearly documenting the fact and announcing it in <a href=\"https://golang.org/cmd/godoc/\" rel=\"nofollow noreferrer\">godoc</a>'s output.</p>\n\n<pre><code>type Bar struct{}\nfunc (b Bar) ImplementsFooer() {}\nfunc (b Bar) Foo() {}\n</code></pre>\n  \n  <p>Most code doesn't make use of such constraints, since they limit the utility of the interface idea. Sometimes, though, they're necessary to resolve ambiguities among similar interfaces.</p>\n</blockquote>\n\n<p>So the <code>ProtoMessage()</code> method basically has 2 purposes:</p>\n\n<ul>\n<li>The main purpose is as documented in the generated code: to make sure you don't pass a value for protobuf serialization / deserialization which otherwise (without this method) would implement the <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Message\" rel=\"nofollow noreferrer\"><code>proto.Message</code></a> interface but is not a \"real\" protobuf message value:  \n\n<blockquote>\n  <p><strong>ProtoMessage acts as a tag to make sure no one accidentally implements the proto.Message interface.</strong></p>\n</blockquote></li>\n<li>And it also documents the fact that the type is a (implements) <code>Message</code>. This may not have a real value at first as the code is generated and you should not bother much with it, but code analyzers and Go IDE's may make good use of it; and it also appears in generated docs.</li>\n</ul>\n"}], "owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2342, "favorite_count": 1, "accepted_answer_id": 47858106, "answer_count": 1, "score": 7, "last_activity_date": 1513536476, "creation_date": 1513529329, "question_id": 47857315, "link": "https://stackoverflow.com/questions/47857315/whats-the-purpose-of-protomessage-method", "title": "What&#39;s the purpose of ProtoMessage method?", "body": "<p>when I generate go code from a protocol buffer file, I noticed that each of the generated structs implement the Message interface, <a href=\"https://github.com/golang/protobuf/blob/master/proto/lib.go#L277\" rel=\"noreferrer\">https://github.com/golang/protobuf/blob/master/proto/lib.go#L277</a></p>\n\n<p>For an example of the code that is generated, see <a href=\"https://github.com/google/go-genproto/blob/master/googleapis/rpc/status/status.pb.go#L97\" rel=\"noreferrer\">https://github.com/google/go-genproto/blob/master/googleapis/rpc/status/status.pb.go#L97</a></p>\n\n<p>Clearly, the other methods on Message interface, String() and Reset(), have an obvious purpose and the concrete implementation example makes that clear. However, I don't understand the purpose of the ProtoMessage() method. The method takes no parameters and returns no arguments, so why is it there?</p>\n"}, {"tags": ["shell", "go", "command-line-interface", "go-cobra"], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513526699, "post_id": 47856870, "comment_id": 82678019, "body": "Thanks, I did it as you said and it create <code>MZR</code> (Unix executable) file in the <code>users&#47;i044442&#47;go&#47;bin</code> dir (I use Mac). how should I run it ? when I double click it prints everthing as before... you write: <code>If the executable is on your path</code> how should verify it? if it is on the bin it&#39;s not sufficient ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513527033, "post_id": 47856870, "comment_id": 82678123, "body": "In the terminal where you typed <code>go run main.go echo test</code>, type <code>MZR echo</code>.  If that does not work, then add the bin directory to your path with the command <code>export PATH=$PATH:users&#47;go&#47;bin</code> and try again."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513527174, "post_id": 47856870, "comment_id": 82678163, "body": "thanks 1+,In case I need to give it to my friend which use windows should I pack it differently ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 1, "creation_date": 1513527562, "post_id": 47856870, "comment_id": 82678295, "body": "in addition in case I want to provide the option to install it and use it like the following repos: <a href=\"https://github.com/nanopack/hoarder\" rel=\"nofollow noreferrer\">github.com/nanopack/hoarder</a> and also this <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">github.com/golang/dep</a> , what I should do ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 2, "creation_date": 1513531251, "post_id": 47856870, "comment_id": 82679509, "body": "@shopiaT Read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>. It&#39;s all explained there."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513535351, "post_id": 47856870, "comment_id": 82680802, "body": "Thanks, I read it already and it doesn&#39;t explain my last comment ...can you please provide the reference/exampe as a answer and i&#39;ll close the question. thanks!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513537589, "post_id": 47856870, "comment_id": 82681398, "body": "Your top-level question is answered.  Feel free to close it out.  As far as the new question in your comment is concerned, please read <a href=\"https://golang.org/doc/code.html#remote\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#remote</a>.  Start a new top-level question if you are still having trouble with the <code>go get</code> command."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513547243, "post_id": 47856870, "comment_id": 82684271, "body": "So if i understand it well , if i put the program in github and some use go get he will able to use the command like mzr echo? Pls correct me if im wrong. Thanks"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513547417, "post_id": 47856870, "comment_id": 82684310, "body": "Ive read the link u provided but not sure how external user can use my  ommands like when u use go dep package. Does the link u provide answer this question too.?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1513573637, "post_id": 47856870, "comment_id": 82689775, "body": "Publish the package to a repository supported by <code>go get</code>.  Run <code>go help importpath</code> for all of the details.   Your friend will then be able to <code>go get</code> the package to download and install to your friend&#39;s $GOPATH/bin."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1513526364, "creation_date": 1513526364, "answer_id": 47856870, "question_id": 47856810, "link": "https://stackoverflow.com/questions/47856810/how-to-provide-go-bin-with-commands/47856870#47856870", "title": "How to provide go bin with commands", "body": "<p>The name of the executable is taken from the directory name. Rename the directory <code>newApp</code> to <code>MZR</code>.  With this change, the <code>go install</code> command will create a executable with the name <code>MZR</code>.  If the executable is on your path, then you can run it from the command line using <code>MZR -h</code> or <code>MZR echo</code>,</p>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 1, "accepted_answer_id": 47856870, "answer_count": 1, "score": -1, "last_activity_date": 1513526416, "creation_date": 1513525916, "last_edit_date": 1513526416, "question_id": 47856810, "link": "https://stackoverflow.com/questions/47856810/how-to-provide-go-bin-with-commands", "title": "How to provide go bin with commands", "body": "<p>I use the following code to create command which should run according to some flags that are \npassed from the cli.</p>\n\n<p>I use the cobra repo \n<a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra</a></p>\n\n<p>when I run it with <code>go run main.go echo test</code></p>\n\n<p>I get </p>\n\n<p><code>Print: test</code></p>\n\n<p>which works.</p>\n\n<p>Now I run <code>go install</code> open the \n bin directory and click on the file <code>newApp</code> (this my name of my app) </p>\n\n<p>and it prints </p>\n\n<pre><code>Usage:\n  MZR [command]\n\nAvailable Commands:\n  echo        Echo anything to the screen\n  help        Help about any command\n  print       Print anything to the screen\n\nFlags:\n  -h, --help   help for MZR\n\nUse \"MZR [command] --help\" for more information about a command.\n\n\n[Process completed]\n</code></pre>\n\n<p>And I c<strong>annot use any commands</strong> (like <code>MZR echo</code>) which I was able when I run it locally with <code>go run main.go echo test</code></p>\n\n<p><strong>But I want to use it like</strong> <strong>following</strong> <code>MZR -h</code>  or <code>MZR echo</code> ,\nHow I can do it ? \n(and also give to my friend the file from the bin that created after <code>go install</code> - which is <code>Unix executable - 3.8 MB</code> )</p>\n\n<p>e.g. like this repo which use the same command line tools and to run it you use <code>hoarder --server</code>\n<a href=\"https://github.com/nanopack/hoarder\" rel=\"nofollow noreferrer\">https://github.com/nanopack/hoarder</a></p>\n\n<p>This is the code for example (to make it more simpler ) </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"github.com/spf13/cobra\"\n)\n\nfunc main() {\n    var echoTimes int\n\n    var cmdPrint = &amp;cobra.Command{\n        Use:   \"print [string to print]\",\n        Short: \"Print anything to the screen\",\n        Long: `print is for printing anything back to the screen.\nFor many years people have printed back to the screen.`,\n        Args: cobra.MinimumNArgs(1),\n        Run: func(cmd *cobra.Command, args []string) {\n            fmt.Println(\"Print: \" + strings.Join(args, \" \"))\n        },\n    }\n\n    var cmdEcho = &amp;cobra.Command{\n        Use:   \"echo [string to echo]\",\n        Short: \"Echo anything to the screen\",\n        Long: `echo is for echoing anything back.\nEcho works a lot like print, except it has a child command.`,\n        Args: cobra.MinimumNArgs(1),\n        Run: func(cmd *cobra.Command, args []string) {\n            fmt.Println(\"Print: \" + strings.Join(args, \" \"))\n        },\n    }\n\n    var cmdTimes = &amp;cobra.Command{\n        Use:   \"times [# times] [string to echo]\",\n        Short: \"Echo anything to the screen more times\",\n        Long: `echo things multiple times back to the user by providing\na count and a string.`,\n        Args: cobra.MinimumNArgs(1),\n        Run: func(cmd *cobra.Command, args []string) {\n            for i := 0; i &lt; echoTimes; i++ {\n                fmt.Println(\"Echo: \" + strings.Join(args, \" \"))\n            }\n        },\n    }\n\n    cmdTimes.Flags().IntVarP(&amp;echoTimes, \"times\", \"t\", 1, \"times to echo the input\")\n\n    var rootCmd = &amp;cobra.Command{Use: \"MZR\"}\n    rootCmd.AddCommand(cmdPrint, cmdEcho)\n    cmdEcho.AddCommand(cmdTimes)\n    rootCmd.Execute()\n}\n</code></pre>\n"}, {"tags": ["go", "random"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 4, "creation_date": 1513524279, "post_id": 47856543, "comment_id": 82677238, "body": "<a href=\"https://golang.org/pkg/math/rand/#Int63n\" rel=\"nofollow noreferrer\">golang.org/pkg/math/rand/#Int63n</a>"}, {"owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1513524541, "post_id": 47856543, "comment_id": 82677333, "body": "@tkausl Int63n returns, as an int64, a non-negative pseudo-random number in [0,n) from the default Source. It panics if n &lt;= 0, so if max is max 64 bit integer it does not return it. Also it accepts a int not an unsigned it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513526642, "post_id": 47856543, "comment_id": 82677996, "body": "@gosom: Converting a uint64 to an int64 is trivial, and should be self-evident."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1513607116, "post_id": 47856543, "comment_id": 82705997, "body": "@gosom: for future reference, the question may have been better received if it wasn&#39;t worded as &quot;here are my requirements, write my function for me&quot;. <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>"}, {"owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513613968, "post_id": 47856543, "comment_id": 82710132, "body": "@Flimzy yes it&#39;s trivial but still it does not include the max int as per documentation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513614469, "post_id": 47856543, "comment_id": 82710423, "body": "@gosom: What documentation? As far as I can tell, the function conforms to documentation exactly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513616371, "post_id": 47856543, "comment_id": 82711490, "body": "@Flimzy: The request is for a random function that can provide a distribution from <code>[0-max]</code> where <code>max&lt;=MaxUint64</code>; while the <code>Int63n</code> function only covers <code>[0-max)</code> where <code>max&lt;=MaxInt64</code>."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513610771, "post_id": 47865090, "comment_id": 82708356, "body": "The question wants <code>[min,max]</code> but neither case in <code>randomHelper</code> includes the max value. I think you want something like <a href=\"https://play.golang.org/p/BLBwWklK7V\" rel=\"nofollow noreferrer\">play.golang.org/p/BLBwWklK7V</a>"}], "tags": [], "owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "is_accepted": false, "score": 1, "last_activity_date": 1513623037, "last_edit_date": 1513623037, "creation_date": 1513588043, "answer_id": 47865090, "question_id": 47856543, "link": "https://stackoverflow.com/questions/47856543/generate-random-uint64-between-min-and-max/47865090#47865090", "title": "generate Random uint64 between min and max", "body": "<p>I'm not sure why you are being downvoted. I think you are worried about the case where <code>max - min</code> is greater than MaxInt64 in which case <code>rand.Int63n</code> would fail as you have remarked. I would handle that case separately.</p>\n\n<pre><code>const maxInt64 uint64 = 1 &lt;&lt; 63 - 1\n\nfunc random(min, max uint64) uint64 {\n    return randomHelper(max - min) + min\n}\n\nfunc randomHelper(n uint64) uint64 {\n    if n &lt; maxInt64 {\n        return uint64(rand.Int63n(int64(n+1)))\n    }\n    x := rand.Uint64()\n    for x &gt; n {\n        x = rand.Uint64()\n    }\n    return x\n}\n</code></pre>\n"}], "owner": {"reputation": 1199, "user_id": 284417, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/VLZSL.jpg?s=128&g=1", "display_name": "gosom", "link": "https://stackoverflow.com/users/284417/gosom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1513623037, "creation_date": 1513524147, "last_edit_date": 1513606935, "question_id": 47856543, "link": "https://stackoverflow.com/questions/47856543/generate-random-uint64-between-min-and-max", "title": "generate Random uint64 between min and max", "body": "<p>How can I generate a random 64 bit unsigned integer in Go?</p>\n\n<p>First I need to call</p>\n\n<pre><code>rand.Seed(0)\n</code></pre>\n\n<p>and then I need a function that returns a uint64 with the following signature</p>\n\n<pre><code>func random(min, max uint64) uint64 {\n}\n</code></pre>\n\n<p>The function above should return a random 64 bit unsigned integer in the\nrange [min, max] (min and max included)</p>\n"}, {"tags": ["go", "oauth-2.0"], "answers": [{"tags": [], "owner": {"reputation": 4531, "user_id": 3011570, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/4Ht66.jpg?s=128&g=1", "display_name": "Eric Broda", "link": "https://stackoverflow.com/users/3011570/eric-broda"}, "is_accepted": false, "score": 1, "last_activity_date": 1513525937, "creation_date": 1513525937, "answer_id": 47856812, "question_id": 47856180, "link": "https://stackoverflow.com/questions/47856180/hydra-creating-policy-using-curl-fails-with-invalid-scope/47856812#47856812", "title": "hydra - creating policy using curl fails with invalid scope", "body": "<p>I found out the issue -- as the error message stated, I have an invalid scope, which could only be caused by the bearer token being generated with an invalid scope.  Sure enough, I had created the bearer token with the scope </p>\n\n<pre><code>\"hydra.clients\"\n</code></pre>\n\n<p>and it should have been:</p>\n\n<pre><code>\"hydra hydra.clients\"\n</code></pre>\n\n<p>The added \"hydra\" allowed the permission to create policies which was not available with the previously defined scope \"hydra.clients\" (which only allowed clients to be created)</p>\n"}], "owner": {"reputation": 4531, "user_id": 3011570, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/4Ht66.jpg?s=128&g=1", "display_name": "Eric Broda", "link": "https://stackoverflow.com/users/3011570/eric-broda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513525954, "creation_date": 1513521604, "last_edit_date": 1513525954, "question_id": 47856180, "link": "https://stackoverflow.com/questions/47856180/hydra-creating-policy-using-curl-fails-with-invalid-scope", "title": "hydra - creating policy using curl fails with invalid scope", "body": "<p>I have successfully configured ory/hydra OAUTH server and it seems to be working well.  However, I am trying to create a policy using \"curl\" instead of the provided CLI and am running into an error:</p>\n\n<pre><code>{\"error\":{\"code\":500,\"message\":\"A validator returned an error: The requested scope is invalid, unknown, or malformed\"}}\n</code></pre>\n\n<p>The error, unfortunately, is not detailed enough to allow me to determine a root cause.</p>\n\n<p>Here is the request that I am issuing via curl:</p>\n\n<pre><code>curl -k -X POST -H Authorization: bearer aValidBearerToken \\\n    -d {\"id\":\"policy-001\", \"description\":\"some description\", \"subjects\":[\"aValidClient\"], \"actions\":[\"read\"], \"effect\":\"allow\", \"resources\":[\"aResource\"] } \\\n    https://localhost:4444/policies\n</code></pre>\n\n<p>Also, I have verified that I have a valid bearer token.</p>\n\n<p>Any ideas are appreciated!</p>\n"}, {"tags": ["javascript", "variables", "go", "gopherjs"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 898, "user_id": 6557621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qbma7.png?s=128&g=1", "display_name": "MCCCS", "link": "https://stackoverflow.com/users/6557621/mcccs"}, "edited": false, "score": 1, "creation_date": 1513605764, "post_id": 47856991, "comment_id": 82705207, "body": "I don&#39;t know what you&#39;re trying to do, so I can&#39;t very well give you the code you&#39;re looking for. It&#39;s not very complex, though."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1513527193, "creation_date": 1513527193, "answer_id": 47856991, "question_id": 47854930, "link": "https://stackoverflow.com/questions/47854930/basic-get-variable-value-using-gopherjs/47856991#47856991", "title": "Basic &quot;Get Variable Value&quot; Using GopherJS", "body": "<p><code>js.Global</code> does not do what you seem to think it does.</p>\n\n<p>The <code>js.Global</code> variable is <a href=\"https://godoc.org/github.com/gopherjs/gopherjs/js#Global\" rel=\"nofollow noreferrer\">documented as</a>:</p>\n\n<blockquote>\n  <p>Global gives JavaScript's global object (\"window\" for browsers and \"GLOBAL\" for Node.js).</p>\n</blockquote>\n\n<p>This means that:</p>\n\n<pre><code>js.Global.Get(\"key\")\n</code></pre>\n\n<p>is accessing <code>window.key</code> in the browser, or <code>GLOBAL.key</code> in Node.js, not a global variable <code>key</code>, as you're trying to do.</p>\n\n<p>More generally, if you want standard JS to access GopherJS-generated code you should use the <code>js.Wrap</code> method <a href=\"https://github.com/gopherjs/gopherjs/wiki/JavaScript-Tips-and-Gotchas#tips\" rel=\"nofollow noreferrer\">as documented</a>.</p>\n"}], "owner": {"reputation": 898, "user_id": 6557621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qbma7.png?s=128&g=1", "display_name": "MCCCS", "link": "https://stackoverflow.com/users/6557621/mcccs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 1, "accepted_answer_id": 47856991, "answer_count": 1, "score": 2, "last_activity_date": 1513527193, "creation_date": 1513512359, "question_id": 47854930, "link": "https://stackoverflow.com/questions/47854930/basic-get-variable-value-using-gopherjs", "title": "Basic &quot;Get Variable Value&quot; Using GopherJS", "body": "<p>I'm trying to use GopherJS, but I couldn't find documentation about how to use it.</p>\n\n<p>Here's the Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gopherjs/gopherjs/js\"\n)\n\nfunc main() {\n    t := js.Global.Get(\"key\").Int()\n    println(t)\n    js.Global.Set(\"keySet\", 4)\n}\n</code></pre>\n\n<p>Then I convert it to JS using GopherJS and paste it:</p>\n\n<p>JS code:</p>\n\n<pre><code>var key = 3\n\n// Pasted GopherJS Code\n\"use strict\";\n(function() {\n...\n}).call(this);\n// End GopherJS Code\n\nconsole.log(keySet)\n</code></pre>\n\n<p>It prints:</p>\n\n<pre><code>0\n4\n</code></pre>\n\n<p>Why? It should've printed</p>\n\n<pre><code>3\n4\n</code></pre>\n\n<p>Here's what I've tried (changing the Go code and re-converting):</p>\n\n<pre><code>func main() {\n    t := js.Global.Get(\"key\").Float()\n    println(t)\n    js.Global.Set(\"keySet\", 4)\n}\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>NaN\n4\n</code></pre>\n\n<hr>\n\n<pre><code>func main() {\n    t := js.Global.Get(\"key\").Int64()\n    println(t)\n    js.Global.Set(\"keySet\", 4)\n}\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>typ { '$high': 0, '$low': 0, '$val': [Circular] }\n4\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4493778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dfa3b4a76a24983501a69172500bc560?s=128&d=identicon&r=PG&f=1", "display_name": "needmorehalp", "link": "https://stackoverflow.com/users/4493778/needmorehalp"}, "edited": false, "score": 0, "creation_date": 1513499109, "post_id": 47853164, "comment_id": 82670940, "body": "wow, I did not think of that! Just have to &quot;reset&quot; the field once I&#39;m done with it.. and then omitempty would just take place as usual... Thanks!"}], "tags": [], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "is_accepted": true, "score": 1, "last_activity_date": 1513496957, "creation_date": 1513496957, "answer_id": 47853164, "question_id": 47853120, "link": "https://stackoverflow.com/questions/47853120/golang-json-unmarshal-to-field-but-not-marshal-into-json-response/47853164#47853164", "title": "Golang JSON Unmarshal to field, but NOT marshal into JSON response", "body": "<p>you were on the right track with <code>omitempty</code> you just have to set <code>SecretField</code> to <code>\"\"</code> for it to take effect</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype MyStruct struct {\n    GoodField string `json:\"goodField\"`\n    SecretField string `json:\"secret,omitempty\"`\n}\n\nfunc main() {\n\n    data := MyStruct{}\n\n    s := `{\"goodField\": \"xxx\", \"secret\": \"yyy\"}`\n\n    json.Unmarshal([]byte(s), &amp;data);\n\n    fmt.Println(data.GoodField, data.SecretField);\n\n    data.SecretField = \"\"\n\n    response, _ := json.Marshal(data)\n\n    fmt.Println(string(response))\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1513499309, "creation_date": 1513499309, "answer_id": 47853405, "question_id": 47853120, "link": "https://stackoverflow.com/questions/47853120/golang-json-unmarshal-to-field-but-not-marshal-into-json-response/47853405#47853405", "title": "Golang JSON Unmarshal to field, but NOT marshal into JSON response", "body": "<p>If you can't, or don't want, to set the field to empty, you can accomplish this with a custom marshaler, as well:</p>\n\n<pre><code>type MyStruct struct {\n    GoodField   string `json:\"goodField\"`\n    SecretField string `json:\"secret\"`\n}\n\nfunc (ms *MyStruct) MarshalJSON() ([]byte, error) {\n    type MyStructWithoutSecretFields struct {\n        GoodField   string `json:\"goodField\"`\n    }\n    noSecrets := MyStructWithoutSecretFields{\n        GoodField: ms.GoodField,\n    }\n    return json.Marshal(noSecrets)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 4493778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dfa3b4a76a24983501a69172500bc560?s=128&d=identicon&r=PG&f=1", "display_name": "needmorehalp", "link": "https://stackoverflow.com/users/4493778/needmorehalp"}, "edited": false, "score": 0, "creation_date": 1513639409, "post_id": 47856200, "comment_id": 82721674, "body": "I&#39;ve discovered this feature as well, however, because its not exported, the field will be ignored when unmarshalled. In my case, I needed access to the field, but not returned in the response."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 95, "user_id": 4493778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dfa3b4a76a24983501a69172500bc560?s=128&d=identicon&r=PG&f=1", "display_name": "needmorehalp", "link": "https://stackoverflow.com/users/4493778/needmorehalp"}, "edited": false, "score": 0, "creation_date": 1513663855, "post_id": 47856200, "comment_id": 82727732, "body": "Yes, you use this structure for all operation except un/marshal. For these operations use another analogue structure with exported field"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1513521748, "creation_date": 1513521748, "answer_id": 47856200, "question_id": 47853120, "link": "https://stackoverflow.com/questions/47853120/golang-json-unmarshal-to-field-but-not-marshal-into-json-response/47856200#47856200", "title": "Golang JSON Unmarshal to field, but NOT marshal into JSON response", "body": "<p>Also if you need this field accessible only from this package (which helps you to control access to it at all) you can make it <em>unexported</em> with first lowercase letter. Use this structure for all operations, except Marshalling/unmarshalling.</p>\n\n<pre><code>type MyStruct struct {\n    GoodField string `json:\"goodField\"`\n    secretField string `json:\"secret\"`\n}\n</code></pre>\n\n<p>And make one more structure what will be used only for Marshalling.</p>\n"}, {"tags": [], "owner": {"reputation": 135, "user_id": 341622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/711f3930045204ae41351b76d011f781?s=128&d=identicon&r=PG", "display_name": "Snargleplax", "link": "https://stackoverflow.com/users/341622/snargleplax"}, "is_accepted": false, "score": 1, "last_activity_date": 1533248821, "creation_date": 1533248821, "answer_id": 51662946, "question_id": 47853120, "link": "https://stackoverflow.com/questions/47853120/golang-json-unmarshal-to-field-but-not-marshal-into-json-response/51662946#51662946", "title": "Golang JSON Unmarshal to field, but NOT marshal into JSON response", "body": "<p>In general I think the best pattern is to use separate request and response types, rather than mutating data just to prevent it from being marshaled; that's an intrusive and destructive approach, and the side-effect could bite you. In line with the Go proverb \"a little duplication is better than a little dependency,\" you're better off just separating those concerns rather than try to have one type serve double duty.</p>\n\n<p>If you want, though, you can try using struct embedding to DRY out the field declarations. With a combination of <code>omitempty</code> and <code>-</code> <code>json</code> tags, you can get the desired results:</p>\n\n<pre><code>type payload struct {\n    A string `json:\"a\"`\n    B string `json:\"b,omitempty\"`\n}\n\ntype request struct {\n    payload\n}\n\ntype response struct {\n    payload\n    B string `json:\"-\"`\n}\n</code></pre>\n\n<p>Here's a <a href=\"https://play.golang.org/p/OdOJlMvoMcy\" rel=\"nofollow noreferrer\">worked example</a> of the above.</p>\n\n<p>It's not without its own issues to be aware of -- there are two fields named <code>B</code> here, not one. It works fine if you're just using dot-operator field access as in my example. If you use struct literals, you've got to be careful not to put the value in the wrong spot. Probably a good idea to write constructors for these types, to centralize that concern in one spot and get it right.</p>\n"}], "owner": {"reputation": 95, "user_id": 4493778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dfa3b4a76a24983501a69172500bc560?s=128&d=identicon&r=PG&f=1", "display_name": "needmorehalp", "link": "https://stackoverflow.com/users/4493778/needmorehalp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2599, "favorite_count": 0, "accepted_answer_id": 47853164, "answer_count": 4, "score": 2, "last_activity_date": 1533248821, "creation_date": 1513496337, "question_id": 47853120, "link": "https://stackoverflow.com/questions/47853120/golang-json-unmarshal-to-field-but-not-marshal-into-json-response", "title": "Golang JSON Unmarshal to field, but NOT marshal into JSON response", "body": "<p>I want to be able to access a struct field that's resulted from a JSON unmarshal, BUT I want to use that same struct to hide the field when it is marshaled.</p>\n\n<p>Example:</p>\n\n<pre><code>type MyStruct struct {\n    GoodField string `json:\"goodField\"`\n    SecretField string `json:\"secret\"`\n}\n</code></pre>\n\n<p>Incoming JSON gets unmarshaled and the <code>secret</code> field is accessible\nUse the same <code>MyStruct</code> in the server response but <em>hide</em> the <code>secret</code> field.</p>\n\n<p>I've looked at using <code>omitempty</code> and <code>-</code> tags, not working.</p>\n"}, {"tags": ["go", "scrape"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1513489740, "post_id": 47852236, "comment_id": 82669435, "body": "What do you get?"}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1513493386, "post_id": 47852236, "comment_id": 82670026, "body": "I&#39;m not sure if this is a pasting issue only for the question, but the HTML is invalid (quotes do not match up)"}], "answers": [{"comments": [{"owner": {"reputation": 1686, "user_id": 1310740, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4e09b49b817d88d050bee0dd6f602e24?s=128&d=identicon&r=PG&f=1", "display_name": "dev-jim", "link": "https://stackoverflow.com/users/1310740/dev-jim"}, "edited": false, "score": 0, "creation_date": 1513703144, "post_id": 47853003, "comment_id": 82750189, "body": "Thanks for the answer. Indeed it has syntax error in html, my mistake. However, now I am using this package <a href=\"https://github.com/anaskhan96/soup\" rel=\"nofollow noreferrer\">github.com/anaskhan96/soup</a> to scrape, it is easier to use. Anyhow, still thanks for the great answer."}], "tags": [], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "is_accepted": true, "score": 0, "last_activity_date": 1513494903, "creation_date": 1513494903, "answer_id": 47853003, "question_id": 47852236, "link": "https://stackoverflow.com/questions/47852236/golang-scrape-how-to-define-matches/47853003#47853003", "title": "Golang scrape how to define matches", "body": "<p><strong>Fixed code:</strong></p>\n\n<pre><code>matcher := func(n *html.Node) bool {\n    if n.Data == \"img\" &amp;&amp; // Is img tag\n        n.Parent != nil &amp;&amp; // Parent exists\n        n.Parent.DataAtom == atom.A &amp;&amp; // Parent is &lt;a&gt;\n        n.Parent.Parent != nil &amp;&amp; // Parent's Parent exists (div)\n        n.Parent.Parent.Parent != nil &amp;&amp; // Parent's Parent's Parent exists (li)\n        n.Parent.Parent.Parent.Parent != nil { // Parent's Parent's Parent's Parent exists (ul)\n        return scrape.Attr(n.Parent.Parent.Parent.Parent, \"class\") == \"list clearfix\"\n    }\n    return false\n}\n\nimages := scrape.FindAll(root, matcher)\nfor i, img := range images {\n    src := scrape.Attr(img, \"src\")\n    fmt.Printf(\"Image %d src=%s\\n\", i, src)\n}\n</code></pre>\n\n<p>I just modified your <code>matcher</code> func to fix the issues you had.</p>\n\n<p>Also note, your HTML in your question is invalid. There were a few missing <code>\"</code>'s along with a mispelt <code>src</code> attribute.</p>\n"}], "owner": {"reputation": 1686, "user_id": 1310740, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4e09b49b817d88d050bee0dd6f602e24?s=128&d=identicon&r=PG&f=1", "display_name": "dev-jim", "link": "https://stackoverflow.com/users/1310740/dev-jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 47853003, "answer_count": 1, "score": -1, "last_activity_date": 1513494903, "creation_date": 1513485563, "question_id": 47852236, "link": "https://stackoverflow.com/questions/47852236/golang-scrape-how-to-define-matches", "title": "Golang scrape how to define matches", "body": "<p>I try to use this <a href=\"https://github.com/yhat/scrape\" rel=\"nofollow noreferrer\">golang package</a> to scrape website images.</p>\n\n<p>This is the html node that I need to scrape.</p>\n\n<pre><code>&lt;ul class=\"list clearfix\"&gt;\n &lt;li&gt; \n     &lt;div&gt;\n          &lt;a href=www.example.com/asda\"&gt;\n                     &lt;img src=\"..sadsada./ssa/3.jpg\"&gt;\n         &lt;/a&gt;\n      &lt;/div&gt;\n   &lt;/li&gt;\n &lt;li&gt; \n     &lt;div&gt;\n          &lt;a href=www.example.comsdsds/sds\"&gt;\n                     &lt;img srr=\"..sadsada./ssa/2.jpg\"&gt;\n         &lt;/a&gt;\n      &lt;/div&gt;\n   &lt;/li&gt;\n &lt;li&gt; \n     &lt;div&gt;\n          &lt;a href=www.example.com/sdds\"&gt;\n                     &lt;img src=\"..sadsada./ssa/1.jpg\"&gt;\n         &lt;/a&gt;\n      &lt;/div&gt;\n   &lt;/li&gt;\n  .......\n&lt;/ul&gt;\n</code></pre>\n\n<p>How do I get the image src?</p>\n\n<p>Here is the matches I tried:</p>\n\n<pre><code>matcher := func(n *html.Node) bool {\n\n        if n.DataAtom == atom.A &amp;&amp; n.Parent != nil &amp;&amp; n.Parent.Parent != nil &amp;&amp; n.Parent.Parent.Parent != nil &amp;&amp; n.Parent.Parent.Parent.Parent != nil {\n\n            return scrape.Attr(n.Parent.Parent.Parent.Parent, \"class\") == \"list clearfix\"\n        }\n        return false\n    }\n\n    images := scrape.FindAll(root, matcher)\n</code></pre>\n\n<p>But it doesn't work.</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1513484523, "creation_date": 1513484523, "answer_id": 47852166, "question_id": 47852010, "link": "https://stackoverflow.com/questions/47852010/variables-in-go-templates/47852166#47852166", "title": "variables in go templates", "body": "<p>The workaround is to define a variable type and template function to create it:</p>\n\n<pre><code>type variable struct {\n    Value interface{}\n}\n\nfunc (v *variable) Set(value interface{}) string {\n    v.Value = value\n    return \"\"\n}\n\nfunc newVariable(initialValue interface{}) *variable {\n    return &amp;variable{initialValue}\n}\n</code></pre>\n\n<p>Add it as a template function like this:</p>\n\n<pre><code>t.Funcs(template.FuncMap{\"var\": newVariable, \"addi\": addi})\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>{{ $total := var 0 }}\n{{range $i, $a := .vars}}\n     {{$total.Set (addi $total.Value $a)}}\n{{end}}\n{{$total.Value}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bCKZOdUq1C\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 72, "user_id": 8850201, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8Ga_nFEa-Yg/AAAAAAAAAAI/AAAAAAAAAAw/QnpLp8KGylQ/photo.jpg?sz=128", "display_name": "Florian", "link": "https://stackoverflow.com/users/8850201/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3813, "favorite_count": 0, "closed_date": 1513495365, "accepted_answer_id": 47852166, "answer_count": 1, "score": 0, "last_activity_date": 1513495410, "creation_date": 1513481897, "question_id": 47852010, "link": "https://stackoverflow.com/questions/47852010/variables-in-go-templates", "closed_reason": "Duplicate", "title": "variables in go templates", "body": "<p>I'm getting an error when executing the following template code:</p>\n\n<pre><code>{{ $total := 0 }}\n{{range $i, $a := .my.vars}}\n     {{ $total = (addi $total $a)}}\n{{end}}\n</code></pre>\n\n<p>Here's the error: <code>unexpected \"=\" in operand</code>. The total variable should also change outside of the <code>range</code>, so I can't use <code>:=</code>, because it would create a new variable inside the <code>range</code> instead of increasing the <code>$total</code> variable.</p>\n\n<p>The <code>addi</code> method is just a simple addition, the error does also occurr without it. It seems like the error is related to the <code>=</code> operator. If go templates don't support it, is there a workaround?</p>\n"}, {"tags": ["go", "sqlite", "cgo"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1513485306, "post_id": 47851774, "comment_id": 82668815, "body": "<code>go run go-sqlite3-test.go</code> works for me on <code>go version go1.8.5 linux&#47;amd64</code>, <code>go version go1.9.2 linux&#47;amd64</code>, and <code>go version devel +2de98eb8de Sat Dec 16 23:30:58 2017 +0000 linux&#47;amd64</code>, after <code>sudo apt install sqlite3 libsqlite3-0</code> and <code>go get -v github.com&#47;mattn&#47;go-sqlite3</code>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1513493750, "post_id": 47851774, "comment_id": 82670089, "body": "I also have <code>gcc</code> and <code>libc6-dev</code> installed."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1513515993, "post_id": 47851774, "comment_id": 82674916, "body": "Thanks for the reply @peterSO, after <code>sudo apt install sqlite3 libsqlite3-0</code> and <code>go get -v github.com&#47;mattn&#47;go-sqlite3</code>, the problem is solved. Do you want to answer, or me deleting this question?"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513481985, "creation_date": 1513478566, "last_edit_date": 1513481985, "question_id": 47851774, "link": "https://stackoverflow.com/questions/47851774/go-sqlite3-code-stop-working-after-upgrade", "title": "Go sqlite3 code stop working after upgrade", "body": "<p>I found that my Go sqlite3 code no longer working any more. </p>\n\n<p>For example, here is a simple Go sqlite3 code, <a href=\"https://github.com/suntong/lang/blob/master/lang/Go/src/db/sqlite/go-sqlite3-test.go\" rel=\"nofollow noreferrer\">go-sqlite3-test.go</a>, that's been working fine for years. I don't know when it broke, but I'm currently using go1.9.2, and I think the go's version upgrade is the main contribution as I don't recall upgrading any of the dependent go packages of the above code. (<strong>UPDATE:</strong> confirmed from another machine that <strong>go1.8.3</strong> + lastest <code>github.com/mattn/go-sqlite3</code> works just fine. All three machines have <code>sqlite3</code> and <code>libsqlite3-0:amd64</code> installed).</p>\n\n<p>In one machine, I got:</p>\n\n<pre><code>$ go run go-sqlite3-test.go\n# github.com/mattn/go-sqlite3\nIn file included from /usr/include/errno.h:35:0,\n                 from cgo-gcc-prolog:21:\n/usr/include/x86_64-linux-gnu/bits/errno.h:24:26: fatal error: linux/errno.h: No such file or directory\n # include &lt;linux/errno.h&gt;\n                          ^\n</code></pre>\n\n<p>In another machine, using the same go1.9.2, downloading the code into <code>/tmp/go-sqlite3-test</code>, I got:</p>\n\n<pre><code>$ go run go-sqlite3-test.go \n# pkg-config --cflags sqlite3\npkg-config: exec: \"pkg-config\": executable file not found in $PATH\n</code></pre>\n\n<p>Having installed <code>pkg-config</code>, in turn I got:</p>\n\n<pre><code>$ go run go-sqlite3-test.go \n# pkg-config --cflags sqlite3\nPackage sqlite3 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `sqlite3.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'sqlite3' found\npkg-config: exit status 1\n\n$ sudo pkg-config --cflags sqlite3 \nPackage sqlite3 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `sqlite3.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'sqlite3' found\n\n$ go build \n# pkg-config --cflags sqlite3\nPackage sqlite3 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `sqlite3.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'sqlite3' found\npkg-config: exit status 1\n</code></pre>\n\n<p>How to get my Go sqlite3 code working again, for both cases? Thx. </p>\n"}, {"tags": ["json", "curl", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1513469424, "post_id": 47850398, "comment_id": 82666616, "body": "See <a href=\"https://mholt.github.io/curl-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/curl-to-go</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513499496, "post_id": 47850398, "comment_id": 82671017, "body": "What do you mean &quot;no result&quot;? Your question includes a result."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513602666, "post_id": 47850398, "comment_id": 82703443, "body": "Your curl example uses GET with a query string, your Go example uses POST with a body. They aren&#39;t interchangeable."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 3635629, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3cfe0710d832bbc6798190d41623db1?s=128&d=identicon&r=PG&f=1", "display_name": "Genzi", "link": "https://stackoverflow.com/users/3635629/genzi"}, "is_accepted": false, "score": -2, "last_activity_date": 1513463210, "creation_date": 1513463210, "answer_id": 47850507, "question_id": 47850398, "link": "https://stackoverflow.com/questions/47850398/sending-curl-like-request-in-golang/47850507#47850507", "title": "Sending curl like request in golang", "body": "<p>This works for me:</p>\n\n<pre><code>    b := bytes.NewBufferString(\" \")\n    res, _ := http.Post(\"http://192.168.1.183:8080/json.htm?type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\", \"Accept: application/json\", b)\n</code></pre>\n\n<p>but I think it is not best way to do that.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1513471478, "creation_date": 1513471478, "answer_id": 47851255, "question_id": 47850398, "link": "https://stackoverflow.com/questions/47850398/sending-curl-like-request-in-golang/47851255#47851255", "title": "Sending curl like request in golang", "body": "<p>Note that in your initial <code>curl</code> command, you missed the <code>-X POST</code> parameter.<br>\nThe <a href=\"https://mholt.github.io/curl-to-go/\" rel=\"nofollow noreferrer\">generated code</a> would then be:</p>\n\n<pre><code>// Generated by curl-to-Go: https://mholt.github.io/curl-to-go\n\nreq, err := http.NewRequest(\"POST\", \"http://192.168.1.183:8080/json.htm?type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\", nil)\nif err != nil {\n    // handle err\n}\nreq.Header.Set(\"Accept\", \"application/json\")\n\nresp, err := http.DefaultClient.Do(req)\nif err != nil {\n    // handle err\n}\ndefer resp.Body.Close()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1513500333, "last_edit_date": 1513500333, "creation_date": 1513499893, "answer_id": 47853466, "question_id": 47850398, "link": "https://stackoverflow.com/questions/47850398/sending-curl-like-request-in-golang/47853466#47853466", "title": "Sending curl like request in golang", "body": "<p>Your curl command and Go code are almost completely unalike.</p>\n\n<ol>\n<li>Your Go sends a POST request, and curl a GET request.</li>\n<li>Your curl command sets an Accept header, your Go code doesn't.</li>\n<li>Your Go command sends a body, your curl command doesn't.</li>\n<li>Your curl command sends URL parameters, your Go code doesn't.</li>\n</ol>\n\n<p>Your go code does the curl equivalent of:</p>\n\n<pre><code>curl -s -i -X POST -H \"Accept: application/json\" \"http://192.168.1.183:8080/json.htm\" -d \"type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\"\n</code></pre>\n\n<p>The simplest way to emulate your curl command in Go is:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://192.168.1.183:8080/json.htm?type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\", nil)\nif err != nil {\n    panic(err)\n}\nreq.Header.Add(\"Accept\", \"application/json\")\nresp, err := http.DefaultClient.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 3635629, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3cfe0710d832bbc6798190d41623db1?s=128&d=identicon&r=PG&f=1", "display_name": "Genzi", "link": "https://stackoverflow.com/users/3635629/genzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2192, "favorite_count": 1, "answer_count": 3, "score": -2, "last_activity_date": 1513500333, "creation_date": 1513462116, "last_edit_date": 1513462776, "question_id": 47850398, "link": "https://stackoverflow.com/questions/47850398/sending-curl-like-request-in-golang", "title": "Sending curl like request in golang", "body": "<p>I try send request like this in golang but with no result:</p>\n\n<pre><code>curl -s -i -H \"Accept: application/json\" \"http://192.168.1.183:8080/json.htm?type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\"\n</code></pre>\n\n<p>How to do that?</p>\n\n<p>I want to send data do Domoticz Home Automation System.\nAnser I got:</p>\n\n<pre><code>{\n   \"status\" : \"ERR\"\n}\n</code></pre>\n\n<p>but should be:</p>\n\n<pre><code>{\n\"status\" : \"OK\",\n\"title\" : \"Update Device\"\n}\n</code></pre>\n\n<p>I try this code:</p>\n\n<pre><code>    b := bytes.NewBufferString(\"type=command&amp;c=getauth&amp;param=udevice&amp;idx=9&amp;nvalue=0&amp;svalue=10;43;2\")\n    res, _ := http.Post(\"http://192.168.1.183:8080/json.htm\", \"Accept: application/json\", b)\n</code></pre>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1513453528, "post_id": 47849300, "comment_id": 82663090, "body": "Probably because you&#39;re never testing the error path. You may want to <a href=\"https://blog.golang.org/cover\" rel=\"nofollow noreferrer\">read up on how cover works</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1513454442, "post_id": 47849300, "comment_id": 82663339, "body": "&quot;how to get 100%?&quot; Don&#39;t. And if you must: Lie. :-)"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1513509838, "post_id": 47849300, "comment_id": 82673167, "body": "Note that &quot;plz&quot;, &quot;dunno&quot;, &quot;bout&quot; (etc) here is usually a lightning conductor for downvotes. It is a fairly reliable indicator of the (lack of) effort that went into a post. Use real words instead, please."}], "answers": [{"comments": [{"owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "edited": false, "score": 0, "creation_date": 1513489842, "post_id": 47849458, "comment_id": 82669444, "body": "thanks a lot man - dunno &#39;bout go tool cover with &quot;html&quot; flag"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1513454252, "creation_date": 1513454252, "answer_id": 47849458, "question_id": 47849300, "link": "https://stackoverflow.com/questions/47849300/how-to-improve-testing-coverage-in-go/47849458#47849458", "title": "How to improve testing coverage in Go?", "body": "<p>See \"<a href=\"https://blog.golang.org/cover\" rel=\"noreferrer\">The Go Blog - The cover story</a>\"</p>\n\n<pre><code>go test -coverprofile=coverage.out \ngo tool cover -html=coverage.out\n</code></pre>\n\n<p>That would display an HTML representation of your source file, where you will clearly see which lines are or are not covered by your test.</p>\n\n<p><a href=\"https://i.stack.imgur.com/F0rXK.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/F0rXK.png\" alt=\"https://blog.golang.org/cover/set.png\"></a></p>\n\n<p>Other Go testing framework would show you the same visualization as well.<br>\nSeee for instance <strong><a href=\"https://github.com/smartystreets/goconvey\" rel=\"noreferrer\">GoConvey</a></strong>.</p>\n"}], "owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 1, "accepted_answer_id": 47849458, "answer_count": 1, "score": -2, "last_activity_date": 1513509896, "creation_date": 1513453110, "last_edit_date": 1513509896, "question_id": 47849300, "link": "https://stackoverflow.com/questions/47849300/how-to-improve-testing-coverage-in-go", "title": "How to improve testing coverage in Go?", "body": "<p>I am doing some testing. I have a file dao.go:</p>\n\n<pre><code>package model_dao\nimport \"io/ioutil\"\nconst fileExtension = \".txt\"\ntype Page struct {\n    Title string\n    Body  []byte\n}\nfunc (p Page) SaveAsFile() (e error) {\n    p.Title = p.Title + fileExtension\n    return ioutil.WriteFile(p.Title, p.Body, 0600)\n}\nfunc LoadFromFile(title string) (*Page, error) {\n    fileName := title + fileExtension\n    body, err := ioutil.ReadFile(fileName)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;Page{title, body}, nil\n}\n</code></pre>\n\n<p>And a test file dao_test.go:</p>\n\n<pre><code>package model_dao_test\nimport (\n    \"shopserver/model/dao\"\n    \"testing\"\n)\nfunc TestDAOFileWorks(t *testing.T) {\n    TITLE := \"test\"\n    BODY := []byte(\"Hello, World!!\")\n    p := &amp;model_dao.Page{TITLE, BODY}\n    p.SaveAsFile()\n    p, _ = model_dao.LoadFromFile(TITLE)\n    result := p.Body\n    if string(BODY) != string(result) {\n        t.Error(\"Body\", BODY, \"saved.\\n\", \"Load:\", result)\n    }\n}\n</code></pre>\n\n<p>Here I test all 2 methods from <em>Page</em>, but after testing I see a message:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CGF03.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CGF03.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why do I only get 85.7%? Where he get this numbers and how to get 100%?</p>\n"}, {"tags": ["bash", "shell", "go", "command-line", "go-cobra"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1513446274, "post_id": 47848366, "comment_id": 82660994, "body": "What did you expect? Your Cli-App doesn&#39;t require any flags or options so it&#39;ll just run the <code>Action</code>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513446947, "post_id": 47848366, "comment_id": 82661202, "body": "if i m correct, you are confused about binary name, and its availability in PATH and the command line argument, sub command. In your current work presented here, you have a binary named greet available in the path. <a href=\"https://github.com/urfave/cli#subcommands\" rel=\"nofollow noreferrer\">github.com/urfave/cli#subcommands</a>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1513446993, "post_id": 47848366, "comment_id": 82661216, "body": "I think what you&#39;re looking for is a <a href=\"https://github.com/urfave/cli#subcommands\" rel=\"nofollow noreferrer\">Subcommand</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513448767, "post_id": 47848366, "comment_id": 82661806, "body": "you cant do &#39;interactive&#39; with this package. To do interactive CLI this package is more suitable <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">github.com/nsf/termbox-go</a>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513449828, "post_id": 47848366, "comment_id": 82662113, "body": "you really need to read the doc. friendly speaking RTFM. to help you a bit more, run <code>go build</code>, the resulting binary is self contained, ready to copy paste. If you need to give it to someone with a different OS than yours, <code>GOOS=YYY go build</code>, give him the resulting binary."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513450944, "post_id": 47848366, "comment_id": 82662400, "body": "the short answer is to add the directory containing the binary to the PATH of user, of put hte binary into PATH of user. Longer answer might be to generate an install-able package that does this for him. search about PATH at first before going forward into packaging, imho."}, {"owner": {"reputation": 124, "user_id": 5391927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f75ac0bce52179c6557547ab329329?s=128&d=identicon&r=PG", "display_name": "nkprince007", "link": "https://stackoverflow.com/users/5391927/nkprince007"}, "edited": false, "score": 0, "creation_date": 1513476195, "post_id": 47848366, "comment_id": 82667603, "body": "possible duplicate of <a href=\"https://stackoverflow.com/questions/35827147/cobra-viper-golang-how-to-test-subcommands\" title=\"cobra viper golang how to test subcommands\">stackoverflow.com/questions/35827147/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514145830, "post_id": 47848366, "comment_id": 82896742, "body": "@mh-cbon - I&#39;ve update my question with the full code.."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1514145860, "post_id": 47848366, "comment_id": 82896750, "body": "@tkausl - I&#39;ve update my question with the full code.."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 124, "user_id": 5391927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f75ac0bce52179c6557547ab329329?s=128&d=identicon&r=PG", "display_name": "nkprince007", "link": "https://stackoverflow.com/users/5391927/nkprince007"}, "edited": false, "score": 0, "creation_date": 1514145899, "post_id": 47848366, "comment_id": 82896758, "body": "@nkprince007 - I&#39;ve update my question with the full code..duplicate this is not :)"}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1514598871, "post_id": 47848366, "comment_id": 83030630, "body": "@Ninawatcher Have you tried my solution? I&#39;ve tested it both in Ubuntu and windows. Worked perfectly. Let me know if you are getting errors with that."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1514205937, "post_id": 47965499, "comment_id": 82906969, "body": "no you can cross platform compile to linux from windows, to mac from linux etc see GOOS, GOARCH"}, {"owner": {"reputation": 124, "user_id": 5391927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f75ac0bce52179c6557547ab329329?s=128&d=identicon&r=PG", "display_name": "nkprince007", "link": "https://stackoverflow.com/users/5391927/nkprince007"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514250983, "post_id": 47965499, "comment_id": 82915790, "body": "yeah, but it doesn&#39;t work for everything, it has improved since 1.5, but it&#39;s not perfect"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514280400, "post_id": 47965499, "comment_id": 82921816, "body": "what do you mean ?"}], "tags": [], "owner": {"reputation": 124, "user_id": 5391927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51f75ac0bce52179c6557547ab329329?s=128&d=identicon&r=PG", "display_name": "nkprince007", "link": "https://stackoverflow.com/users/5391927/nkprince007"}, "is_accepted": false, "score": 2, "last_activity_date": 1514172851, "creation_date": 1514172851, "answer_id": 47965499, "question_id": 47848366, "link": "https://stackoverflow.com/questions/47848366/how-to-provide-go-cmd-app-as-productive-app/47965499#47965499", "title": "How to provide Go cmd app as productive app", "body": "<p>The problem may be because you are building for all three platforms on one platform.</p>\n\n<p>Go build can only build for the current platform. i.e. the platform on which the build is running.</p>\n\n<p>You can however use goreleaser to automate builds for platforms independently.</p>\n\n<p>Reference: <a href=\"https://goreleaser.com/#quick_start\" rel=\"nofollow noreferrer\">https://goreleaser.com/#quick_start</a></p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1514208852, "creation_date": 1514208852, "answer_id": 47969116, "question_id": 47848366, "link": "https://stackoverflow.com/questions/47848366/how-to-provide-go-cmd-app-as-productive-app/47969116#47969116", "title": "How to provide Go cmd app as productive app", "body": "<h3>To the question</h3>\n\n<blockquote>\n  <p>I try to do it with creating make.sh file (see the results in build\n  folder) which create executable files for several OS but when I take\n  the files and try to run it on mac and windows its not working either,\n  what should I do here ?</p>\n</blockquote>\n\n<p>I better have to redirect you to already provided answer than to try to repeat theirs.</p>\n\n<p><a href=\"https://superuser.com/questions/517894/what-is-the-unix-path-variable-and-how-do-i-add-to-it\">https://superuser.com/questions/517894/what-is-the-unix-path-variable-and-how-do-i-add-to-it</a></p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/PATH_(variable)\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/PATH_(variable)</a></p>\n\n<p>tldr: when you copy the executable on the target machines, the directory containing that binary does not exist within the PATH variable, thus, when you call for it, the OS is not capable to locate the file on the file system.</p>\n\n<h3>To the programming aspect of your question</h3>\n\n<p>i took a bit of time to rewrite the program in, what i believe to be, a more appropriate way.</p>\n\n<p>Please check <a href=\"https://github.com/mh-cbon/demotest/tree/master/help\" rel=\"nofollow noreferrer\">https://github.com/mh-cbon/demotest/tree/master/help</a></p>\n\n<p>The caveat around your implementation goal (take <em>any</em> yaml input and convert it to json) is that go is not well suited to do that easily.</p>\n\n<p>As it is a strongly typed language it is way more easier to provide a predefined data structure.</p>\n\n<p>That being said, i don t doubt a solution exist to convert <em>any</em> input to json, it is just more complex and out of the scope, imho.</p>\n"}, {"tags": [], "owner": {"reputation": 702, "user_id": 1597592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e95be1e45ce44c35155324ac4548f5f?s=128&d=identicon&r=PG", "display_name": "Qinsi", "link": "https://stackoverflow.com/users/1597592/qinsi"}, "is_accepted": false, "score": 1, "last_activity_date": 1514442195, "last_edit_date": 1592644375, "creation_date": 1514442195, "answer_id": 48002589, "question_id": 47848366, "link": "https://stackoverflow.com/questions/47848366/how-to-provide-go-cmd-app-as-productive-app/48002589#48002589", "title": "How to provide Go cmd app as productive app", "body": "<p>Hope this can help:</p>\n<p>Create a simple shell script named mzr:</p>\n<blockquote>\n<p>#!/bin/bash -</p>\n<p>exec go run main.go mzr &quot;$@&quot;</p>\n</blockquote>\n<p>Fit your own path, and have luck ;D</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1514800143, "post_id": 48024535, "comment_id": 83068775, "body": "Thanks 1+, It will be great if you can <code>clone</code> the project and make it <code>productive</code> , I&#39;ve provided a 100 bounty points because I&#39;m currently stuck, the project is just an example to my bigger project (and the git repo is fairly small) , and this will help to learn how to do it better since in fairly new to golang..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1514801443, "post_id": 48024535, "comment_id": 83069062, "body": "Sure take your time. please pay attention also to the &#39;make.sh&#39; . thanks!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1514962734, "post_id": 48024535, "comment_id": 83118799, "body": "Hi, any news :-) ?"}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1514962795, "post_id": 48024535, "comment_id": 83118817, "body": "@Ninawatcher submit the changes yesterday. Please check the github issues section."}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 5, "last_activity_date": 1514560217, "last_edit_date": 1514560217, "creation_date": 1514559904, "answer_id": 48024535, "question_id": 47848366, "link": "https://stackoverflow.com/questions/47848366/how-to-provide-go-cmd-app-as-productive-app/48024535#48024535", "title": "How to provide Go cmd app as productive app", "body": "<p>I went through the code base and identified the following should change in-order for this tool to be platform independent.</p>\n\n<p>Users should execute the following commanad as you've mentioned</p>\n\n<p><code>mzr convert toJSON path/to/yaml/</code></p>\n\n<p>path/to/yaml  should be OS independent and it must be the absolute/relative path to the file. For this you can do the following change to convert function. And remove the <code>github.com/mitchellh/go-homedir</code> dependency from converter.go</p>\n\n<pre><code>func convert(args []string) {\n //read file\n // TODO: handle number of arguments and output proper messages.\n yamlFile, err := ioutil.ReadFile(args[0])\n if err != nil {\n    log.Printf(\"yamlFile.Get err   #%v \", err)\n }\n //Format the yaml to json\n fmt.Println(\"Start converting: \" + strings.Join(args, \" \"))\n jsonOut, err := YAML.YAMLToJSON(yamlFile) // TODO: handle error\n fmt.Println(string(jsonOut))\n err = ioutil.WriteFile(\"jsonFile.json\", jsonOut, 0644) // TODO: handle error\n}\n</code></pre>\n\n<p>There are 2 ways to use this tool. </p>\n\n<ol>\n<li><p>Users who have setup a working golang environment</p>\n\n<ul>\n<li>Make your package go gettable.</li>\n</ul></li>\n</ol>\n\n<p>Change for the main.go file(in git diff notation).</p>\n\n<pre><code> package main\n\n-import \"mzr/cmd/commands\"\n+import \"github.com/NinaWatcher/mzr/cmd/commands\"\n</code></pre>\n\n<p>Once you do this users can install the tool with the following command smilar to how <code>godep</code> works</p>\n\n<p><code>go get github.com/NinaWatcher/mzr</code></p>\n\n<ol start=\"2\">\n<li><p>Users who don't have golang installed.</p>\n\n<p>Build OS specific distributions as you are doing with the make.sh file</p></li>\n</ol>\n\n<p>Hope this solved your tool distribution issue. On a side note though, there is lot that can be improved in the code base specially error handling, package hierarchy etc..Better to pay attention to them before distributing this to the users.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 2, "answer_count": 4, "score": 3, "last_activity_date": 1514560217, "creation_date": 1513446151, "last_edit_date": 1514146481, "question_id": 47848366, "link": "https://stackoverflow.com/questions/47848366/how-to-provide-go-cmd-app-as-productive-app", "title": "How to provide Go cmd app as productive app", "body": "<p>I\u2019m creating the following repo which use Go command line tools <a href=\"https://github.com/spf13/cobra\" rel=\"noreferrer\">cobra</a>\nto generate some artifacts , while run the command\n<code>go run main.go mzr convert toJSON ./</code> the program take the yaml file and \ngenerate from it json file.</p>\n\n<p>Now I want that my repo will Behave like the following command lines tool  (user can install it and run help and use the tool supported commands)</p>\n\n<p><a href=\"https://github.com/golang/dep\" rel=\"noreferrer\">https://github.com/golang/dep</a></p>\n\n<p>That the user will be able to install <code>mzr</code> and will be able to run the \ncommand's inside like in the <code>dep</code> repository when user run <code>dep init</code> ,\nIn my case user should run </p>\n\n<p><code>mzr convert toJSON path/to/yaml/</code></p>\n\n<p>This is my repository </p>\n\n<p><a href=\"https://github.com/NinaWatcher/mzr\" rel=\"noreferrer\">https://github.com/NinaWatcher/mzr</a></p>\n\n<p>I\u2019ve the <code>file.yaml</code> inside the root (and the output json for testing only) but the user should provide the path to the file.</p>\n\n<p>The logic is inside the file: <code>cmd/commands/convert.go</code></p>\n\n<p>I try to do it with creating make.sh file (see the results in build folder) which create executable files for several OS\nbut when I take the files and try to run it o<strong>n mac and windows</strong> its not working either, what should I do here ?</p>\n"}, {"tags": ["mysql", "pointers", "go", "interface", "slice"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513444528, "post_id": 47847575, "comment_id": 82660506, "body": "save yourself time, check this <a href=\"https://github.com/volatiletech/sqlboiler\" rel=\"nofollow noreferrer\">github.com/volatiletech/sqlboiler</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1513443535, "post_id": 47847825, "comment_id": 82660188, "body": "That&#39;s interesting, I will give it a try once I can. I&#39;m a C dev so I understand pointers but I see interface {} as void *, and since the function store the results into varargs pointers, I was wondering if I could make it generic, you get me?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1513447451, "post_id": 47847825, "comment_id": 82661353, "body": "interface{} is more like <code>struct { ANY val, Type t }</code>  though, it can hold a value or a pointer to a value.   So, if you store a pointer in a plain old interface, the receiver (sql package) will be able to store stuff at that pointer.      And, since interfaces contain the type, the receiver can even allocate the memory to store the value.  so you can pass an empty pointer (though, in your example, the obj has been allocated)"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1513448859, "post_id": 47847825, "comment_id": 82661843, "body": "Hoooo ok that make sense :) thank you for your answer :) my code doesn&#39;t return the data yet (product is just initialized but not filled with data) but you answer the main question so thanks 10000 times :)"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1513442336, "creation_date": 1513442336, "answer_id": 47847825, "question_id": 47847575, "link": "https://stackoverflow.com/questions/47847575/slice-of-pointers-to-interface-for-mysql-queries-abstractions/47847825#47847825", "title": "Slice of pointers to interface for MySQL queries abstractions", "body": "<p>Interfaces can hold pointers.  There is rarely a reason to make a pointer to an interface.</p>\n\n<p>If you change your type to []interface{} it should work.</p>\n\n<p>If you really want pointers to interfaces, for some reason, you'd have to first store the field in an interface, then get a pointer to that.</p>\n\n<p>ie:</p>\n\n<pre><code>var i interface{} = &amp;_product.Name\nappend(dest, &amp;i)\n</code></pre>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 47847825, "answer_count": 1, "score": 0, "last_activity_date": 1513527182, "creation_date": 1513440614, "last_edit_date": 1513527182, "question_id": 47847575, "link": "https://stackoverflow.com/questions/47847575/slice-of-pointers-to-interface-for-mysql-queries-abstractions", "title": "Slice of pointers to interface for MySQL queries abstractions", "body": "<p>I am trying to abstract my uses of my MySQL database and I'm stuck on a error.</p>\n\n<p>There is the object I will take as example:</p>\n\n<pre><code>package models\n\n// Product : The Product's model\ntype Product struct {\n    ID         int\n    Name       string\n    Price      int\n    PictureURL string\n}\n</code></pre>\n\n<p>I'm going to try to retrieve the Product <code>id = 1</code> in my database. For that, let's say that I already have a connection to my database which is represented by the next variable:</p>\n\n<pre><code>var databaseMySQL *sql.DB\n</code></pre>\n\n<p>In order to query my database, I am using this function:</p>\n\n<pre><code>// QueryMySQL query our MySQL database\nfunc QueryMySQL(sqlquery model.SQLQuery) model.Status {\n\n    // prepare the query\n    stmtOut, err := databaseMySQL.Prepare(sqlquery.Query)\n    if err != nil {\n        return model.Status{Code: http.StatusInternalServerError, Error: err}\n    }\n    defer stmtOut.Close()\n\n    // Run the query\n    err = stmtOut.QueryRow(sqlquery.Args).Scan(sqlquery.Dest)\n    if err != nil {\n        return model.Status{Code: http.StatusInternalServerError, Error: err}\n    } else {\n        return model.Status{Code: http.StatusOK, Error: nil}\n    }\n}\n</code></pre>\n\n<p>The 2 models used over here are <code>SQLQuery</code> &amp; <code>Status</code>. </p>\n\n<pre><code>package models\n\ntype SQLQuery struct {\n    Query string\n    Args  []interface{}\n    Dest  []*interface{}\n}\n</code></pre>\n\n<p><strong><code>Status</code> just basically contains an <code>error</code> and an <code>int</code>.</strong></p>\n\n<p>So, since <code>Scan()</code> as the following prototype <code>Scan func(dest ...interface{}) error</code>, I can pass a <code>[]*interface{}</code> as parameter.</p>\n\n<p>If I'm right, then I should be able to get my <strong>Dest</strong>'s elements filled by <code>T</code> type element, and then cast/transform them into the types I need?</p>\n\n<pre><code>func GetProductByID(ID int) (model.Product, model.Status) {\n\n    // \"SELECT ID, Name, Price, PictureURL FROM Products WHERE ID = ?\"\n    var _product model.Product\n\n    // HERE IS THE PROBLEM\n    var dest []*interface{}\n    append(dest, &amp;_product.Name)\n    append(dest, &amp;_product.Price)\n    append(dest, &amp;_product.PictureURL)\n    // HERE IS THE PROBLEM\n\n    status := QueryMySQL(model.SQLQuery{\n        Query: \"SELECT Name, Price, PictureURL FROM Products WHERE ID = ?\",\n        Args:  []interface{}{ID},\n        Dest:  dest})\n\n    return _product, model.Status{Code: http.StatusOK, Error: nil}\n}\n</code></pre>\n\n<p><em>PS: this function is just a basic test to try my logic</em></p>\n\n<p>However, I am getting an error:</p>\n\n<blockquote>\n  <p>cannot use &amp;_product.Name (type *string) as type *interface {} in append:\n      *interface {} is pointer to interface, not interface</p>\n</blockquote>\n\n<p>To me, there is two errors:</p>\n\n<ul>\n<li><code>cannot use &amp;_product.Name (type *string) as type *interface {}</code></li>\n<li><code>*interface {} is pointer to interface, not interface</code></li>\n</ul>\n\n<p>First, why can't I use a interface to store my string?</p>\n\n<p>Second, since I am passing a pointer on string, what's the matter with <code>interface{}</code>? it should be *interface{}, doesn't it?</p>\n\n<hr>\n\n<h2>The correct code, thanks to David Budworth for his answer</h2>\n\n<p>In addition to the given code, you can pass slice as varargs like I did by adding <code>...</code> after your slice variable's name</p>\n\n<p><em>mysqlproduct.go</em></p>\n\n<pre><code>// GetProductByID returns a Product based on a given ID\nfunc GetProductByID(ID int) (model.Product, model.Status) {\n\n    _product := model.Product{\n        ID: ID}\n\n    status := QueryMySQL(&amp;model.SQLQuery{\n        Query: \"SELECT Name, Price, PictureURL FROM Products WHERE ID = ?\",\n        Args:  []interface{}{_product.ID},\n        Dest:  []interface{}{&amp;_product.Name, &amp;_product.Price, &amp;_product.PictureURL}})\n\n    if status.Code != http.StatusOK {\n        return _product, status\n    }\n\n    return _product, model.Status{Code: http.StatusOK, Error: \"\"}\n}\n</code></pre>\n\n<p><em>mysql.go</em></p>\n\n<pre><code>// QueryMySQL query our MySQL database\nfunc QueryMySQL(sqlquery *model.SQLQuery) model.Status {\n\n    stmtOut, err := databaseMySQL.Prepare(sqlquery.Query)\n    if err != nil {\n        return model.Status{Code: http.StatusInternalServerError, Error: err.Error()}\n    }\n    defer stmtOut.Close()\n\n    // Run the query\n    err = stmtOut.QueryRow(sqlquery.Args...).Scan(sqlquery.Dest...)\n    if err != nil {\n        return model.Status{Code: http.StatusInternalServerError, Error: err.Error()}\n    }\n    defer stmtOut.Close()\n\n    return model.Status{Code: http.StatusOK, Error: \"\"}\n}\n</code></pre>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1513435086, "last_edit_date": 1513435086, "creation_date": 1513434694, "answer_id": 47846689, "question_id": 47846593, "link": "https://stackoverflow.com/questions/47846593/efficiently-inserting-a-slice-into-another-slice/47846689#47846689", "title": "Efficiently inserting a slice into another slice", "body": "<p>Here's a translation to Go assuming a slice of int:</p>\n\n<pre><code>// Reserve space for the combined length of the slices\nc := make([]int, len(a)+len(b))\n\n// Copy the first part of a to the beginning\ncopy(c, a[:i])\n\n// Copy the last part of a to the end\ncopy(c[i+len(b):], a[i:])\n\n// Copy b to the middle\ncopy(c[i:], b)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HBNPuJRvc9\" rel=\"noreferrer\">playground example</a></p>\n\n<p>To take advantage of <code>a</code>'s capacity, do this:</p>\n\n<pre><code>if cap(a) &lt; len(a)+len(b) {\n    // Not enough space, allocate new slice\n    c := make([]int, len(a)+len(b))\n\n    // Copy the first part of a to the beginning\n    copy(c, a[:i])\n\n    // Copy the last part of a to the end\n    copy(c[i+len(b):], a[i:])\n\n    a = c\n} else {\n    // reslice to combined length\n    a = a[:len(a)+len(b)]\n\n    // copy the last part of a to the end\n    copy(a[i+len(b):], a[i:])\n\n}\n// copy b to the middle\ncopy(a[i:], b)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xXxFVEa6vB\" rel=\"noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 47846689, "answer_count": 1, "score": 1, "last_activity_date": 1513435086, "creation_date": 1513433986, "question_id": 47846593, "link": "https://stackoverflow.com/questions/47846593/efficiently-inserting-a-slice-into-another-slice", "title": "Efficiently inserting a slice into another slice", "body": "<p>In Go you can insert a slice into the middle of another slice <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">like this</a>:</p>\n\n<pre><code>a = append(a[:i], append(b, a[i:]...)...)\n</code></pre>\n\n<p>However, as I understand it that will first append <code>a[i:]</code> to <code>b</code> by copying it to the end of <code>b</code> (and potentially reallocating <code>b</code>, and <em>then</em> copy that whole slice to <code>a</code>, again potentially reallocating it.</p>\n\n<p>This seems like there is an extra copy and allocation to what you really need. In C++ I'd do it something like this (I mean... without using <code>insert</code> obviously).</p>\n\n<pre><code>// Reserve enough space in `a` for `a` and `b`.\na.reserve(a.size() + b.size());\n\n// Move the second half of `a` to the end.\nstd::copy(a.begin() + i, a.end(), a.begin() + i + b.size());\n\n// Copy `b` into the middle.\nstd::copy(b.begin(), b.end(), a.begin() + i);\n</code></pre>\n\n<p>Is there a similar way to do this in Go?</p>\n"}, {"tags": ["pointers", "go", "bit-manipulation", "xor"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 7, "creation_date": 1513431285, "post_id": 47846206, "comment_id": 82656413, "body": "Pointer arithmetic is not supported by Go. You can force it, by using the <code>reflect</code> and <code>unsafe</code> packages, but generally this is frowned upon."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513431481, "post_id": 47846206, "comment_id": 82656458, "body": "might this helps <a href=\"https://github.com/anacrolix/dht/blob/master/int160.go\" rel=\"nofollow noreferrer\">github.com/anacrolix/dht/blob/master/int160.go</a>"}, {"owner": {"reputation": 37, "user_id": 6491304, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/011f00f5e469cd5a72b41c58566b6924?s=128&d=identicon&r=PG", "display_name": "dannyBoy", "link": "https://stackoverflow.com/users/6491304/dannyboy"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513432077, "post_id": 47846206, "comment_id": 82656635, "body": "Thank you @Flimzy for pointing that out. I&#39;m still learning it."}, {"owner": {"reputation": 37, "user_id": 6491304, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/011f00f5e469cd5a72b41c58566b6924?s=128&d=identicon&r=PG", "display_name": "dannyBoy", "link": "https://stackoverflow.com/users/6491304/dannyboy"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513432109, "post_id": 47846206, "comment_id": 82656645, "body": "Thank you @mh-cbon for the link"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1513436802, "last_edit_date": 1513436802, "creation_date": 1513432471, "answer_id": 47846393, "question_id": 47846206, "link": "https://stackoverflow.com/questions/47846206/bitwise-xor-on-address-in-golang/47846393#47846393", "title": "Bitwise XOR on address in GoLang", "body": "<p>Use <a href=\"https://godoc.org/unsafe#Pointer\" rel=\"nofollow noreferrer\">unsafe.Pointer</a> for pointer arithmetic:</p>\n\n<pre><code>a := &amp;T{}\nb := &amp;T{}\nx := uintptr(unsafe.Pointer(a)) ^ uintptr(unsafe.Pointer(b))\ny := (*T)(unsafe.Pointer(uintptr(unsafe.Pointer(a)) ^ x))\nfmt.Println(b == y)  // prints true\n</code></pre>\n\n<p>The GC uses pointers to track memory. If the code is rewritten to </p>\n\n<pre><code>a := &amp;T{}\nb := &amp;T{}\nx := uintptr(unsafe.Pointer(a)) ^ uintptr(unsafe.Pointer(b))\nb = nil // clear all pointers to struct\nb = (*T)(unsafe.Pointer(uintptr(unsafe.Pointer(a)) ^ x))\n</code></pre>\n\n<p>then it's possible for the GC to collect the struct pointed to by <code>b</code> before the last assignment to <code>b</code>. </p>\n\n<p>It's not possible to implement a safe XOR list in Go because the GC can collect the elements.</p>\n\n<p>Don't do this.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1513432527, "creation_date": 1513432527, "answer_id": 47846402, "question_id": 47846206, "link": "https://stackoverflow.com/questions/47846206/bitwise-xor-on-address-in-golang/47846402#47846402", "title": "Bitwise XOR on address in GoLang", "body": "<p>You can't implement an XOR Linked List in Go. The Go garbage collector (GC) uses pointer values to keep track of in-use memory. If you mangle a pointer value, the GC will not work. </p>\n"}, {"tags": [], "owner": {"reputation": 37, "user_id": 6491304, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/011f00f5e469cd5a72b41c58566b6924?s=128&d=identicon&r=PG", "display_name": "dannyBoy", "link": "https://stackoverflow.com/users/6491304/dannyboy"}, "is_accepted": false, "score": 0, "last_activity_date": 1513433586, "creation_date": 1513433586, "answer_id": 47846547, "question_id": 47846206, "link": "https://stackoverflow.com/questions/47846206/bitwise-xor-on-address-in-golang/47846547#47846547", "title": "Bitwise XOR on address in GoLang", "body": "<p>Thank you for pointing out that Go doesn't support pointer arithmetic. I did a quick research and, found and used the <em>usafe</em> package Go provides just in case \"unsafe\" work in needed. I solved the problem with the following lines of code:</p>\n\n<pre><code>a := unsafe.Pointer(nodeA)\nb := unsafe.Pointer(nodeB)\nreturn (*Node)(unsafe.Pointer(uintptr(a) ^ uintptr(b)))\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\">docs</a> to unsafe package.</p>\n"}], "owner": {"reputation": 37, "user_id": 6491304, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/011f00f5e469cd5a72b41c58566b6924?s=128&d=identicon&r=PG", "display_name": "dannyBoy", "link": "https://stackoverflow.com/users/6491304/dannyboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 1, "accepted_answer_id": 47846393, "answer_count": 3, "score": 1, "last_activity_date": 1513436802, "creation_date": 1513431148, "question_id": 47846206, "link": "https://stackoverflow.com/questions/47846206/bitwise-xor-on-address-in-golang", "title": "Bitwise XOR on address in GoLang", "body": "<p>I was trying to implement the XOR Linked List in Go where I had to store the XORed address. In C/C++ it's quite simple</p>\n\n<pre><code>(*struct_type)(([unsigned] int)nodeA ^ ([unsigned] int)nodeB)\n</code></pre>\n\n<p>I tried a similar approach in Go. I had a struct named Node with two nodes nodeA and nodeB. To get this I tried the following ways:</p>\n\n<pre><code>*Node(uint(nodeA) ^ uint(nodeB))\n</code></pre>\n\n<p>Which gave me an error saying, can't convert type Node to uint.\nAnother way I tried, which I was sure woundn't work, was</p>\n\n<pre><code>nodeA ^ nodeB\n</code></pre>\n\n<p>Is there a way to parse the address to int type, XOR them and then re-parse them into Node address? Or does Go provide a simple solution to this that I'm not aware of?</p>\n"}, {"tags": ["go", "gif"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513429470, "post_id": 47845669, "comment_id": 82655908, "body": "How do you know it&#39;s an unreadable gif? How are you testing? What exact error messages are you getting?"}, {"owner": {"reputation": 1194, "user_id": 7196144, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JqkLR.jpg?s=128&g=1", "display_name": "Mikita Melnikau", "link": "https://stackoverflow.com/users/7196144/mikita-melnikau"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513517414, "post_id": 47845669, "comment_id": 82675272, "body": "my problem was that I should open it in web browser, and I tryed programs like Mirage... T_T"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513526332, "post_id": 47845669, "comment_id": 82677908, "body": "Your comment doesn&#39;t answer my questions. What exact error message are you getting?"}, {"owner": {"reputation": 1194, "user_id": 7196144, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JqkLR.jpg?s=128&g=1", "display_name": "Mikita Melnikau", "link": "https://stackoverflow.com/users/7196144/mikita-melnikau"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513535406, "post_id": 47845669, "comment_id": 82680817, "body": "I thought if program cant open image, so it is broken image. But answer below shown me that image can be open in firefox. And that&#39;s all. I just a bit lame i know. Sorry."}], "answers": [{"comments": [{"owner": {"reputation": 1194, "user_id": 7196144, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JqkLR.jpg?s=128&g=1", "display_name": "Mikita Melnikau", "link": "https://stackoverflow.com/users/7196144/mikita-melnikau"}, "edited": false, "score": 0, "creation_date": 1513517296, "post_id": 47846608, "comment_id": 82675230, "body": "wow its magic ! and why I cant open it in programs like Mirage =("}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1513434061, "creation_date": 1513434061, "answer_id": 47846608, "question_id": 47845669, "link": "https://stackoverflow.com/questions/47845669/how-to-debug-gif-errors/47846608#47846608", "title": "How to debug gif errors", "body": "<p>Open with the gif file with a gif reader like firefox. For example,</p>\n\n<pre><code>$ go run lissajous.go &gt; lissajous.gif &amp;&amp; firefox lissajous.gif\n</code></pre>\n"}], "owner": {"reputation": 1194, "user_id": 7196144, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JqkLR.jpg?s=128&g=1", "display_name": "Mikita Melnikau", "link": "https://stackoverflow.com/users/7196144/mikita-melnikau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 47846608, "answer_count": 1, "score": 0, "last_activity_date": 1513434061, "creation_date": 1513427256, "last_edit_date": 1513429437, "question_id": 47845669, "link": "https://stackoverflow.com/questions/47845669/how-to-debug-gif-errors", "title": "How to debug gif errors", "body": "<p>I follow <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch1/lissajous/main.go\" rel=\"nofollow noreferrer\">guide by Alan Donovan</a> and try to make gif. But in output all the time I got unreadable gif image. I remember, when I was on Windows 8.0, I can remake this example easy, but today on Ubuntu16.04 I dunno where is my error and how to fix it. My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"image/color\"\n    \"os\"\n    \"io\"\n    \"math/rand\"\n    \"time\"\n    \"image/gif\"\n    \"image\"\n    \"math\"\n)\n\nvar palette = []color.Color{color.White, color.Black}\n\nconst (\n    whiteIndex = 0\n    blackIndex = 1\n)\n\nfunc main() {\n    lissajous(os.Stdout)\n}\n\nfunc lissajous(out io.Writer)  {\n    const (\n        cycles = 5\n        res = 0.001\n        size = 100\n        nframes = 64\n        delay = 8\n    )\n    rand.Seed(time.Now().UTC().UnixNano())\n    freq := rand.Float64()*3.0\n    anim := gif.GIF{LoopCount:nframes}\n    phase := 0.0\n    for i := 0; i &lt; nframes; i++ {\n        rect := image.Rect(0, 0, 2*size+1, 2*size+1)\n        img := image.NewPaletted(rect, palette)\n        for t:=0.0; t&lt; cycles*2*math.Pi; t+= res {\n            x:= math.Sin(t)\n            y:= math.Sin(t*freq + phase)\n            img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5), blackIndex)\n        }\n        phase += 0.2\n        anim.Delay = append(anim.Delay, delay)\n        anim.Image = append(anim.Image, img)\n    }\n    gif.EncodeAll(out, &amp;anim)\n}\n</code></pre>\n\n<p>Just copied from book. Source file placed in '~/go/src/learning/'</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1513419863, "creation_date": 1513419863, "answer_id": 47844638, "question_id": 47844182, "link": "https://stackoverflow.com/questions/47844182/gin-gonic-mapping-request-body-values-into-a-struct/47844638#47844638", "title": "gin-gonic mapping request.body values into a struct", "body": "<p>I guess, instead of</p>\n\n<pre><code>var reqBody requestBody\nerr := c.Bind(reqBody)\n</code></pre>\n\n<p>might be </p>\n\n<pre><code>reqBody := new(requestBody)\nerr := c.Bind(reqBody)\n</code></pre>\n\n<p>second code creates a pointer to requestBody, so Bind can apply to a pointer. If you pass a value it can bind, but you won t get the results. So it is invalid type. More concretely speaking at <code>mapForm: typ := reflect.TypeOf(ptr).Elem()</code> it takes the type, assumes it is a pointer to something (Elem()). When you pass in a value <code>Elem()</code> panics see <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#Value.Elem</a></p>\n\n<p>Why <code>new()</code> and not <code>var reqBody *requestBody</code>. <code>new</code> will create a new object to bind values on. Declaring the pointer in the second case will create a <code>nil</code> pointer, non bindable.</p>\n\n<p>You might also write <code>reqBody := &amp;requestBody{}</code>, that would be the same as the <code>new</code> syntax</p>\n"}], "owner": {"reputation": 1170, "user_id": 4732633, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh6.googleusercontent.com/-3EqkwkKBaTo/AAAAAAAAAAI/AAAAAAAAAAA/hhuYb3A-0qo/photo.jpg?sz=128", "display_name": "Rahul Ganguly", "link": "https://stackoverflow.com/users/4732633/rahul-ganguly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5091, "favorite_count": 0, "accepted_answer_id": 47844638, "answer_count": 1, "score": 1, "last_activity_date": 1513419863, "creation_date": 1513415778, "question_id": 47844182, "link": "https://stackoverflow.com/questions/47844182/gin-gonic-mapping-request-body-values-into-a-struct", "title": "gin-gonic mapping request.body values into a struct", "body": "<p>Am new to the GO programming language. I am building a web server using the gin-gonic framework. I am trying to map the values from req.body onto a struct.</p>\n\n<p>Using Postman I am sending a POST request with the following key/vaules under x-www-form-urlencoded</p>\n\n<p>role : admin</p>\n\n<p>username : adminusername</p>\n\n<p>id: 1</p>\n\n<p>my go code is as follows</p>\n\n<pre><code>package jwtsecuritytoken\n\nimport (\n    \"fmt\"\n    \"github.com/gin-gonic/gin\"\n)\n\ntype requestBody struct {\n    role      string\n    username  string    \n    id        string\n}\n\nfunc GenerateToken(c *gin.Context) {\n    fmt.Println(c.PostForm(\"role\"))\n    var reqBody requestBody\n    err := c.Bind(reqBody)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(reqBody)\n    content := gin.H{\"Hello\": \"World\"}\n    c.JSON(200, content)\n   }\n</code></pre>\n\n<p>I am able to read the value from c.PostForm(\"name\")\nbut when i try to bind it to the struct I get the following error</p>\n\n<pre><code>reflect: Elem of invalid type\nC:/Go/src/runtime/panic.go:491 (0x42bf80)\n    gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))\n C:/Go/src/reflect/type.go:955 (0x4bdb19)\n    (*rtype).Elem: panic(\"reflect: Elem of invalid type\")\n   C:/Learnings/Go/src/github.com/gin-gonic/gin/binding/form_mapping.go:15     (0x8b6b5a)\n    mapForm: typ := reflect.TypeOf(ptr).Elem()\n     C:/Learnings/Go/src/github.com/gin-gonic/gin/binding/form.go:24    \n    formBinding.Bind: if err := mapForm(obj, req.Form); err != nil {\n  &lt;autogenerated&gt;:1 (0x8b9298)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:508 (0x8f3319)\n    (*Context).ShouldBindWith: return b.Bind(c.Request, obj)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:475 (0x8f2e3d)\n    (*Context).MustBindWith: if err = c.ShouldBindWith(obj, b); err != nil {\n    C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:458 (0x8f2a7d)\n    (*Context).Bind: return c.MustBindWith(obj, b)\n    C:/Learnings/Go/src/AuthenticateService/jwtsecuritytoken/jwtsecuritytoken.go:22 (0x905c23)\n    GenerateToken: err := c.Bind(reqBody)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:107 (0x8f10b9)\n    (*Context).Next: c.handlers[c.index](c)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/recovery.go:46 (0x9038f0)\n    RecoveryWithWriter.func1: c.Next()\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:107 (0x8f10b9)\n    (*Context).Next: c.handlers[c.index](c)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/logger.go:83 (0x902c12)\n    LoggerWithWriter.func1: c.Next()\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/context.go:107 (0x8f10b9)\n    (*Context).Next: c.handlers[c.index](c)\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/gin.go:352 (0x8fa52c)\n    (*Engine).handleHTTPRequest: c.Next()\n  C:/Learnings/Go/src/github.com/gin-gonic/gin/gin.go:319 (0x8f9cb1)\n    (*Engine).ServeHTTP: engine.handleHTTPRequest(c)\n  C:/Go/src/net/http/server.go:2619 (0x66b69a)\n     serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)\n  C:/Go/src/net/http/server.go:1801 (0x6676c3)\n    (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)\n   C:/Go/src/runtime/asm_amd64.s:2337 (0x457e70)\n    goexit: BYTE    $0x90   // NOP\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "edited": false, "score": 2, "creation_date": 1513417373, "post_id": 47844123, "comment_id": 82652800, "body": "With the struct slice, you don&#39;t have to define the struct for each element like the following: <a href=\"https://play.golang.org/p/kkJIQq0r_P\" rel=\"nofollow noreferrer\">play.golang.org/p/kkJIQq0r_P</a>"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "reply_to_user": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "edited": false, "score": 0, "creation_date": 1513420264, "post_id": 47844123, "comment_id": 82653421, "body": "That makes it much more handlable. Why not write an additional answer and I retract mine?"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "edited": false, "score": 0, "creation_date": 1513420610, "post_id": 47844123, "comment_id": 82653518, "body": "Feel free to update your answer as I was just building on it. Here&#39;s a version with better indentation: <a href=\"https://play.golang.org/p/0du1TKtOl8\" rel=\"nofollow noreferrer\">play.golang.org/p/0du1TKtOl8</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "edited": false, "score": 2, "creation_date": 1513430483, "post_id": 47844123, "comment_id": 82656183, "body": "Run gofmt with the simplify option  (<code>gofmt -s main.go</code>) on the first answer to get the answer suggested by @Grokify."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 1, "last_activity_date": 1513420564, "last_edit_date": 1513420564, "creation_date": 1513415173, "answer_id": 47844123, "question_id": 47843968, "link": "https://stackoverflow.com/questions/47843968/go-struct-type-fill-embedded-struct-field/47844123#47844123", "title": "Go struct type, fill embedded struct field", "body": "<p><a href=\"https://play.golang.org/p/D17WYx6mRr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/D17WYx6mRr</a></p>\n\n<p>To not relay on links only, whole working program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype ExportJob struct {\n    AssetID    string `json:\"asset_id\"`\n    ObjectType string `json:\"object_type\"`\n    Usage      string `json:\"usage\"`\n    Reference  string `json:\"reference\"`\n    Chunk      string `json:\"chunk_id\"`\n    Ordering   uint64 `json:\"ordering\"`\n    Formats    []struct {\n        SizePreset      string `json:\"size_preset\"`\n        Fit             string `json:\"fit\"`\n        OutputFormat    string `json:\"output_format\"`\n        Location        string `json:\"location\"`\n        BackgroundColor string `json:\"background_color\"`\n        Height          uint64 `json:\"height\"`\n        Width           uint64 `json:\"width\"`\n        Trimfactor      uint64 `json:\"trimfactor\"`\n        Quality         uint64 `json:\"quality\"`\n    } `json:\"formats\"`\n}\n\nfunc main() {\n    job := ExportJob{\n        AssetID:    \"blablat\",\n        ObjectType: \"blablab\",\n        Reference:  \"blbla\",\n        Ordering:   0,\n        Chunk:      \"blablba\",\n        Formats: []struct {\n            SizePreset      string `json:\"size_preset\"`\n            Fit             string `json:\"fit\"`\n            OutputFormat    string `json:\"output_format\"`\n            Location        string `json:\"location\"`\n            BackgroundColor string `json:\"background_color\"`\n            Height          uint64 `json:\"height\"`\n            Width           uint64 `json:\"width\"`\n            Trimfactor      uint64 `json:\"trimfactor\"`\n            Quality         uint64 `json:\"quality\"`\n        }{struct {\n            SizePreset      string `json:\"size_preset\"`\n            Fit             string `json:\"fit\"`\n            OutputFormat    string `json:\"output_format\"`\n            Location        string `json:\"location\"`\n            BackgroundColor string `json:\"background_color\"`\n            Height          uint64 `json:\"height\"`\n            Width           uint64 `json:\"width\"`\n            Trimfactor      uint64 `json:\"trimfactor\"`\n            Quality         uint64 `json:\"quality\"`\n        }{SizePreset: \"no\",\n            Fit:             \"blah\",\n            OutputFormat:    \"blub\",\n            Location:        \"loc\",\n            BackgroundColor: \"green\",\n            Height:          1,\n            Width:           2,\n            Trimfactor:      4,\n            Quality:         7,\n        },\n        },\n    }\n    fmt.Println(job)\n}\n</code></pre>\n\n<p>My opinion: ugly as hell and error prone, as it is easy to miss a tag or omit a field and get compiler errors which aren't that helpful. (They tell you, you can't use that as field value or some such, but don't analyse whats the difference between the type you used and the type that was expected, to make it easier for you, to find your omission/typo.)</p>\n\n<p>And I dread to think about, how that looks if you start to pour more\nthan one element in the slice literal.</p>\n\n<p>And yes, you can't omit the tags, as they take part in type identity, as stated here <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">golang spec</a> last paragraph before the last code example.</p>\n\n<p>As <a href=\"https://stackoverflow.com/users/1908967/grokify\">grokify</a> pointed out, you don't need to repeat the struct type for each slice element, so this works as well:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype ExportJob struct {\n    AssetID    string `json:\"asset_id\"`\n    ObjectType string `json:\"object_type\"`\n    Usage      string `json:\"usage\"`\n    Reference  string `json:\"reference\"`\n    Chunk      string `json:\"chunk_id\"`\n    Ordering   uint64 `json:\"ordering\"`\n    Formats    []struct {\n        SizePreset      string `json:\"size_preset\"`\n        Fit             string `json:\"fit\"`\n        OutputFormat    string `json:\"output_format\"`\n        Location        string `json:\"location\"`\n        BackgroundColor string `json:\"background_color\"`\n        Height          uint64 `json:\"height\"`\n        Width           uint64 `json:\"width\"`\n        Trimfactor      uint64 `json:\"trimfactor\"`\n        Quality         uint64 `json:\"quality\"`\n    } `json:\"formats\"`\n}\n\nfunc main() {\n    job := ExportJob{\n        AssetID:    \"blablat\",\n        ObjectType: \"blablab\",\n        Reference:  \"blbla\",\n        Ordering:   0,\n        Chunk:      \"blablba\",\n        Formats: []struct {\n            SizePreset      string `json:\"size_preset\"`\n            Fit             string `json:\"fit\"`\n            OutputFormat    string `json:\"output_format\"`\n            Location        string `json:\"location\"`\n            BackgroundColor string `json:\"background_color\"`\n            Height          uint64 `json:\"height\"`\n            Width           uint64 `json:\"width\"`\n            Trimfactor      uint64 `json:\"trimfactor\"`\n            Quality         uint64 `json:\"quality\"`\n        }{{SizePreset: \"no\",\n            Fit:             \"blah\",\n            OutputFormat:    \"blub\",\n            Location:        \"loc\",\n            BackgroundColor: \"green\",\n            Height:          1,\n            Width:           2,\n            Trimfactor:      4,\n            Quality:         7,\n        },\n        },\n    }\n    fmt.Println(job)\n}\n</code></pre>\n\n<p>In my opinion slightly better, but still not good, as you still have more work to do if you alter the embedded type. (In comparsion to naming the embedded type).</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1513430351, "creation_date": 1513430351, "answer_id": 47846091, "question_id": 47843968, "link": "https://stackoverflow.com/questions/47843968/go-struct-type-fill-embedded-struct-field/47846091#47846091", "title": "Go struct type, fill embedded struct field", "body": "<p>Name all of the struct types to avoid duplicating the struct type in <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literals</a>:</p>\n\n<pre><code>type Format struct {\n    SizePreset      string `json:\"size_preset\"`\n    Fit             string `json:\"fit\"`\n    OutputFormat    string `json:\"output_format\"`\n    Location        string `json:\"location\"`\n    BackgroundColor string `json:\"background_color\"`\n    Height          uint64 `json:\"height\"`\n    Width           uint64 `json:\"width\"`\n    Trimfactor      uint64 `json:\"trimfactor\"`\n    Quality         uint64 `json:\"quality\"`\n}\n\ntype ExportJob struct {\n    AssetID    string   `json:\"asset_id\"`\n    ObjectType string   `json:\"object_type\"`\n    Usage      string   `json:\"usage\"`\n    Reference  string   `json:\"reference\"`\n    Chunk      string   `json:\"chunk_id\"`\n    Ordering   uint64   `json:\"ordering\"`\n    Formats    []Format `json:\"formats\"`\n}\n</code></pre>\n\n<p>Here's an example of a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> using these types:</p>\n\n<pre><code>job := ExportJob{\n    AssetID:    \"blablat\",\n    ObjectType: \"blablab\",\n    Reference:  \"blbla\",\n    Ordering:   0,\n    Chunk:      \"blablba\",\n    Formats: []Format{\n        {SizePreset: \"no\",\n            Fit:             \"blah\",\n            OutputFormat:    \"blub\",\n            Location:        \"loc\",\n            BackgroundColor: \"green\",\n            Height:          1,\n            Width:           2,\n            Trimfactor:      4,\n            Quality:         7,\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1513430351, "creation_date": 1513413672, "question_id": 47843968, "link": "https://stackoverflow.com/questions/47843968/go-struct-type-fill-embedded-struct-field", "title": "Go struct type, fill embedded struct field", "body": "<p>I have the following struct type:</p>\n\n<pre><code>type ExportJob struct {\n    AssetID    string `json:\"asset_id\"`\n    ObjectType string `json:\"object_type\"`\n    Usage      string `json:\"usage\"`\n    Reference  string `json:\"reference\"`\n    Chunk      string `json:\"chunk_id\"`\n    Ordering   uint64 `json:\"ordering\"`\n    Formats    []struct {\n        SizePreset      string `json:\"size_preset\"`\n        Fit             string `json:\"fit\"`\n        OutputFormat    string `json:\"output_format\"`\n        Location        string `json:\"location\"`\n        BackgroundColor string `json:\"background_color\"`\n        Height          uint64 `json:\"height\"`\n        Width           uint64 `json:\"width\"`\n        Trimfactor      uint64 `json:\"trimfactor\"`\n        Quality         uint64 `json:\"quality\"`\n    } `json:\"formats\"`\n}\n</code></pre>\n\n<p>Now I use this struct in a completely different project, by importing the package, etc. So far so good, but then I want to fill a concrete instance of the struct:</p>\n\n<pre><code>job := workers.ExportJob{\n    AssetID:    \"blablat\",\n    ObjectType: \"blablab\",\n    Reference:  \"blbla\",\n    Ordering:   0,\n    Chunk:      \"blablba,\n    Formats:    ?????, // how does this syntax looks like??\n}\n</code></pre>\n\n<p>I first \"fill\" the root fields, but then I need to fill an array of <code>Formats</code>, but I don't know how this syntax looks like. Can someone point me in the right direction?</p>\n"}, {"tags": ["go", "graphql"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 18, "last_activity_date": 1513415274, "creation_date": 1513415274, "answer_id": 47844135, "question_id": 47843914, "link": "https://stackoverflow.com/questions/47843914/transforming-echo-context-to-context-context/47844135#47844135", "title": "Transforming echo.Context to context.Context", "body": "<p>An echo.Context can't be <em>used as</em> a context.Context, but it does <em>refer to</em> one; if <code>c</code> is the echo context then <code>c.Request().Context()</code> is the <code>context.Context</code> for the incoming request, which will be canceled if the user closes the connection, for instance.</p>\n\n<p>You can copy other useful values from the echo context to the stdlib context, if needed, by using the <code>Get</code> method on the one hand and the <code>WithValue</code> method on the other. If there are some values that you always want copied, then you can write a helper function to do so.</p>\n"}], "owner": {"reputation": 1072, "user_id": 2840647, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bbc7740efb4b280be4485f2f7c6c5742?s=128&d=identicon&r=PG&f=1", "display_name": "user2840647", "link": "https://stackoverflow.com/users/2840647/user2840647"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3222, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1580334285, "creation_date": 1513413088, "question_id": 47843914, "link": "https://stackoverflow.com/questions/47843914/transforming-echo-context-to-context-context", "title": "Transforming echo.Context to context.Context", "body": "<p>I am writing a web application, using Go as the backend.  I'm using this GraphQL library <a href=\"https://github.com/neelance/graphql-go\" rel=\"nofollow noreferrer\">(link)</a>, and the Echo web framework <a href=\"https://echo.labstack.com/\" rel=\"nofollow noreferrer\">(link)</a>.  The problem is that that the <code>graphql-go</code> library uses the <code>context</code> package in Go, while <code>Echo</code> uses its own custom context, and removed support for the standard <code>context</code> package. </p>\n\n<p>My question would be, is there a way to use context.Context as echo.Context, in the following example?</p>\n\n<code>api.go</code>\n\n<pre><code>func (api *API) Bind(group *echo.Group) {\n    group.Use(middleware.JWTWithConfig(middleware.JWTConfig{\n        SigningKey:  []byte(\"SOME_REAL_SECRET_KEY\"),\n        SigningMethod:  \"HS256\",\n    }))\n    group.GET(\"/graphql\", api.GraphQLHandler)\n    group.POST(\"/query\",  echo.WrapHandler(&amp;relay.Handler{Schema: schema}))\n}\n</code></pre>\n\n<p><code>graphql.go</code></p>\n\n<pre><code>func (r *Resolver) Viewer(ctx context.Context, arg *struct{ Token *string }) (*viewerResolver, error) {\n    token := ctx.Value(\"user\").(*jwt.Token) // oops on this line, graphql-go uses context.Context, but the echo middleware provides echo.Context\n    ...\n}\n</code></pre>\n\n<p>How would I make the echo context available to my graphql resolvers.  Thank you very much, any help is appreciated.</p>\n"}, {"tags": ["multithreading", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 2833409, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c1497f3c0233c904c38640e831d2a68?s=128&d=identicon&r=PG&f=1", "display_name": "Brian D", "link": "https://stackoverflow.com/users/2833409/brian-d"}, "edited": false, "score": 0, "creation_date": 1513439334, "post_id": 47842943, "comment_id": 82658828, "body": "Thanks for your answer. So it sounds like the reason thread-safety is not guaranteed for writing to a slice is because there&#39;s a possibility it can resize. Two indices in a slice can be updated concurrently by differing threads, just so long as it doesn&#39;t cause a resize of the slice. Is that right?"}], "tags": [], "owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "is_accepted": true, "score": 1, "last_activity_date": 1513403381, "creation_date": 1513403381, "answer_id": 47842943, "question_id": 47842345, "link": "https://stackoverflow.com/questions/47842345/thread-safety-of-a-2d-slice-where-each-thread-gets-its-own-index-in-first-dimens/47842943#47842943", "title": "Thread safety of a 2d slice where each thread gets its own index in first dimension", "body": "<p>Provided that your number of goroutines is constant and each goroutine is only changing its \"own\" data, then your original approach is thread-safe.</p>\n\n<blockquote>\n  <p>My first instinct was to think this was ok, but if two go-routines simultaneously need to append to their respective lists, this means I am concurrently writing to the first dimension slice.</p>\n</blockquote>\n\n<p>You may be concurrently writing to that slice but you're updating different indices in the backing array and provided you don't need to grow that slice, the backing array won't move.</p>\n"}], "owner": {"reputation": 73, "user_id": 2833409, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2c1497f3c0233c904c38640e831d2a68?s=128&d=identicon&r=PG&f=1", "display_name": "Brian D", "link": "https://stackoverflow.com/users/2833409/brian-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 47842943, "answer_count": 1, "score": 2, "last_activity_date": 1513403381, "creation_date": 1513396124, "question_id": 47842345, "link": "https://stackoverflow.com/questions/47842345/thread-safety-of-a-2d-slice-where-each-thread-gets-its-own-index-in-first-dimens", "title": "Thread safety of a 2d slice where each thread gets its own index in first dimension", "body": "<p>I am trying to ultimately end up with a 2D slice where the first dimension is equal to the number of go-routines used and the second dimension is a list of structs that each go-routine is responsible for writing to. </p>\n\n<p>Type:</p>\n\n<pre><code>[][]*Node\n</code></pre>\n\n<p>Each go-routine will be given an index for the first dimension in the 2d slice and will only append to the list at it's index. </p>\n\n<p>My first instinct was to think this was ok, but if two go-routines simultaneously need to append to their respective lists, this means I am concurrently writing to the first dimension slice. </p>\n\n<p>I was thinking pointers to the second list instead of using raw lists might mitigate this concurrent write... something like:</p>\n\n<pre><code>workCollector := make([]*[]*Node, 5)\nfor i ; i &lt; 5; i++ {\n    go.Process(i)\n}\n\nfunc Process(threadNum int){\n    localList := workCollector[threadNum]\n    *localList = append(*localList, NewNode(UUID.()))\n}\n</code></pre>\n\n<p>Is this enough to allow each go-routine to append to their own list or should the append happen in a mutex? </p>\n"}, {"tags": ["unix", "go", "terminal", "command-line-arguments"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1513389997, "post_id": 47841886, "comment_id": 82648025, "body": "Having flags after non-flag arguments is generally considered a bad/confusing idea, even if lots of tools from the 1970s do it; the <code>flag</code> package <i>does</i> help (with its <code>Args</code> function) as long as you&#39;re willing to keep your non-flag arguments (i.e. the filename) at the end."}, {"owner": {"reputation": 11, "user_id": 9028424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IXHeO.png?s=128&g=1", "display_name": "renkenn", "link": "https://stackoverflow.com/users/9028424/renkenn"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1513390905, "post_id": 47841886, "comment_id": 82648153, "body": "Oh! I seem to missed that one, thank you for the help."}, {"owner": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "edited": false, "score": 0, "creation_date": 1513458915, "post_id": 47841886, "comment_id": 82664539, "body": "If you really want to achieve this then the option is to parse each of the args and determine if the arg is a flag or file, regex and os.Path() should help."}], "owner": {"reputation": 11, "user_id": 9028424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IXHeO.png?s=128&g=1", "display_name": "renkenn", "link": "https://stackoverflow.com/users/9028424/renkenn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513389571, "creation_date": 1513389571, "question_id": 47841886, "link": "https://stackoverflow.com/questions/47841886/getting-the-files-name-regardless-of-the-arguments-position-in-cli-in-golang", "title": "Getting the file&#39;s name regardless of the arguments position in CLI in golang", "body": "<p>Hello I've been trying to make my own pastebin script to get used to golang,As I was making it, I came across an issue after I tried to get rid of the -f flag that holds the file's name\nI tried to make it like any regular UNIX command, example\n<code>ls -la file</code> works the same as <code>ls file -la</code>.</p>\n\n<p>I've reading about flag package in golang, but didn't seem to find anything that can help me fix such a problem. This is my first post here, I searched for similar questions but didn't find any. Thank you</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 8, "last_activity_date": 1513387107, "creation_date": 1513387107, "answer_id": 47841713, "question_id": 47841683, "link": "https://stackoverflow.com/questions/47841683/why-cant-you-append-a-pointer-to-an-array/47841713#47841713", "title": "Why can&#39;t you append a pointer to an array?", "body": "<p>You can, it's just that you <em>are</em> appending to the slice, which means that the element you add is in <code>results[1]</code>, and <code>results[0]</code> is a <code>nil</code> pointer (the default value for a pointer).</p>\n\n<p>You could do <code>results := make([]*Circle, 0, 1)</code> to give it a capacity of 1 but a length of zero, or you could do <code>results := []*Circle{}</code> (most compact), or you could simply keep the version where you assign to <code>results[0]</code>, since it works just fine.</p>\n"}, {"comments": [{"owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "edited": false, "score": 0, "creation_date": 1602615745, "post_id": 47841743, "comment_id": 113775307, "body": "Thank you! My array syntax was incorrect. I had a pointer to an array when I wanted an array of pointers."}], "tags": [], "owner": {"reputation": 136, "user_id": 5129446, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F9GFT.jpg?s=128&g=1", "display_name": "aerth", "link": "https://stackoverflow.com/users/5129446/aerth"}, "is_accepted": false, "score": 3, "last_activity_date": 1513387524, "creation_date": 1513387524, "answer_id": 47841743, "question_id": 47841683, "link": "https://stackoverflow.com/questions/47841683/why-cant-you-append-a-pointer-to-an-array/47841743#47841743", "title": "Why can&#39;t you append a pointer to an array?", "body": "<p>You can, but you are using <code>make</code> with length 1, so the [0] index is already set (to a nil Circle...)</p>\n\n<p>Changing your <code>results[0].x</code> to <code>results[1].x</code> works, but without using <code>make</code> works as expected:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Circle struct {\n  x string\n}\n\nfunc main() {\n    circle := Circle{x: \"blah\"}\n    results := []*Circle{} // initialize empty slice of Circle pointers\n    results = append(results, &amp;circle)\n    fmt.Printf(\"Here: %s\\n\", results[0].x)\n}\n</code></pre>\n\n<p>Run in playground: <a href=\"https://play.golang.org/p/7vMOfAXvgI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7vMOfAXvgI</a></p>\n"}], "owner": {"reputation": 1584, "user_id": 1128852, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/044021edd7412657dc35f37fb60d9f39?s=128&d=identicon&r=PG", "display_name": "Shail Patel", "link": "https://stackoverflow.com/users/1128852/shail-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1375, "favorite_count": 0, "accepted_answer_id": 47841713, "answer_count": 2, "score": 2, "last_activity_date": 1513387524, "creation_date": 1513386785, "last_edit_date": 1513387035, "question_id": 47841683, "link": "https://stackoverflow.com/questions/47841683/why-cant-you-append-a-pointer-to-an-array", "title": "Why can&#39;t you append a pointer to an array?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\ntype Circle struct {\n  x string\n}\n\nfunc main() {\n    circle := Circle{x: \"blah\"}\n    results := make([]*Circle, 1)\n    results = append(results, &amp;circle)\n    fmt.Printf(\"Here: %s\\n\", results[0].x)\n}\n</code></pre>\n\n<p>If I change the line <code>results = append(results, &amp;circle)</code> to <code>results[0] = &amp;circle</code> works fine. Couldn't find any reason as to why that would be.</p>\n"}, {"tags": ["go", "concurrency", "deadlock", "channels"], "comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1513381685, "post_id": 47841172, "comment_id": 82646704, "body": "The error actually says why, but it&#39;s not immediately obvious.  While one goroutine (main) waits to send to <code>in</code>, channels it&#39;s waiting to send to <code>out</code>. When you add a buffer, the send doesn&#39;t block (because there&#39;s room in the buffer) .  Otherwise, it&#39;s a deadlock as each these is waiting for the other.  I recommend you consider whether you really need that select in channels."}, {"owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "reply_to_user": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1513382695, "post_id": 47841172, "comment_id": 82646872, "body": "@DanFarrell This is just a learning code. I try to use one channel to manipulate the flow and other to produce some data. I made this to understand how channels works and how to make asynchronous communication between two goroutines. Thanks for your answer."}], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 3, "last_activity_date": 1513381528, "creation_date": 1513381528, "answer_id": 47841220, "question_id": 47841172, "link": "https://stackoverflow.com/questions/47841172/golang-channel-is-asleep/47841220#47841220", "title": "Golang channel is asleep", "body": "<p>This is because the main goroutine is stuck writing to <code>in</code></p>\n\n<pre><code>in &lt;- true\n</code></pre>\n\n<p>and the other goroutine is stuck writing to <code>out</code></p>\n\n<pre><code>out &lt;- 1\n</code></pre>\n\n<p>If you make the write to out a <code>case</code> aswell it should work:</p>\n\n<pre><code>for {\n    select {\n    case &lt;-in:\n        fmt.Println(\"Close\")\n        close(out)\n        return\n    case out &lt;- 1:\n        fmt.Println(\"Out\")\n        break\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 47841220, "answer_count": 1, "score": 1, "last_activity_date": 1513381528, "creation_date": 1513381082, "question_id": 47841172, "link": "https://stackoverflow.com/questions/47841172/golang-channel-is-asleep", "title": "Golang channel is asleep", "body": "<p>I'm new with golang channels and could not underestimate why does program behavior changes if I specify channel buffer size</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc channels(in &lt;-chan bool, out chan int) {\n    for {\n        select {\n        case _ = &lt;-in:\n            fmt.Println(\"Close\")\n            close(out)\n            return\n        default:\n            fmt.Println(\"Out\")\n            out &lt;- 1\n            break\n        }\n    }\n}\n\nfunc main() {\n    in := make(chan bool)\n    // in := make(chan bool, 1)\n    out := make(chan int)\n\n    go channels(in, out)\n\n    i := 0\n\n    // Loop:\n    for n := range out {\n        fmt.Println(n)\n\n        i += 1\n\n        if i &gt; 10 {\n            fmt.Println(\"Send close\")\n            in &lt;- true // Here it is became asleep\n            return\n        }\n    }\n\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>Out\nOut\n1\n1\nOut\nOut\n1\n1\nOut\nOut\n1\n1\nOut\nOut\n1\n1\nOut\nOut\n1\n1\nOut\nOut\n1\nSend close\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /home/user/go-lessons/3/chan_4.go:39 +0x2c3\n\ngoroutine 19 [chan send]:\nmain.channels(0xc820072060, 0xc8200720c0)\n    /home/user/go-lessons/3/chan_4.go:16 +0x241\ncreated by main.main\n    /home/user/go-lessons/3/chan_4.go:27 +0x97\nexit status 2\n</code></pre>\n\n<p>If I replace <code>in := make(chan bool)</code> with <code>in := make(chan bool, 1)</code> It works properly. Why does it happen?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1513380282, "post_id": 47840649, "comment_id": 82646417, "body": "what are the values if not set?   if they are default (empty), then just do <code>c.DBUserName = os.Getenv(&quot;IDAASDBPW&quot;)</code>"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1513380345, "post_id": 47840649, "comment_id": 82646434, "body": "and, <code>c.HTTPPort,_ = strconv.Atoi(&quot;IDAASHTTPPORT&quot;)</code> which will leave it zero if env var missing"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1513386155, "post_id": 47840649, "comment_id": 82647412, "body": "If you want to do this in a generic way, you could add struct tags to the fields that give the environment variable name and data type. You could then write a function to populate the fields using reflection. That way, all you have to do if you ever add a new field is define the field with the appropriate tag."}, {"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1513397751, "post_id": 47840649, "comment_id": 82649030, "body": "@DavidBudworth, what you don&#39;t see is that I have defaults and check a TOML file for config first, then override if there is an environment variable that exists so I can support 12-factor in the future for a Docker or serverless deployment."}], "answers": [{"comments": [{"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "edited": false, "score": 0, "creation_date": 1513378951, "post_id": 47840888, "comment_id": 82646120, "body": "Could we go further and make this a single helper using type switch on &#39;val&#39; and type interface{}?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "edited": false, "score": 0, "creation_date": 1513379141, "post_id": 47840888, "comment_id": 82646168, "body": "You can, but I&#39;ll leave that as an exercise for you. The <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">tour</a> should have what you need."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1513378411, "creation_date": 1513378411, "answer_id": 47840888, "question_id": 47840649, "link": "https://stackoverflow.com/questions/47840649/can-this-sequence-of-ifs-be-written-more-elegantly/47840888#47840888", "title": "Can this sequence of if&#39;s be written more elegantly?", "body": "<p>You can use some helper functions:</p>\n\n<pre><code>func setIntFromEnv(val *int, envName string) {\n  if v, ok := os.LookupEnv(envName); ok {\n    *val, _ = strconv.Atoi(v)\n  }\n}\n\nfunc setStringFromEnv(val *string, envName string) {\n  if v, ok := os.LookupEnv(envName); ok {\n    *val = v\n  }\n}\n\n// From your main function.\nsetIntFromEnv(&amp;c.HTTPPort, \"IDAASHTTPPORT\")\nsetStringFromEnv(&amp;c.DBUserName, \"IDAASDBNAME\")\netc...\n</code></pre>\n\n<p>This only works if you're ok ignoring a string env var that you're trying to parse as an int. Its relative elegance is also debatable.</p>\n"}], "owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "closed_date": 1513412135, "accepted_answer_id": 47840888, "answer_count": 1, "score": 0, "last_activity_date": 1513378411, "creation_date": 1513376599, "last_edit_date": 1513377016, "question_id": 47840649, "link": "https://stackoverflow.com/questions/47840649/can-this-sequence-of-ifs-be-written-more-elegantly", "closed_reason": "Opinion-based", "title": "Can this sequence of if&#39;s be written more elegantly?", "body": "<pre><code>if v, ok := os.LookupEnv(\"IDAASHTTPPORT\"); ok {\n    c.HTTPPort, _ = strconv.Atoi(v)\n}\nif v, ok := os.LookupEnv(\"IDAASDBNAME\"); ok {\n    c.DBUserName = v\n}\nif v, ok := os.LookupEnv(\"IDAASDBPW\"); ok {\n    c.DBPasswd = v\n}\nif v, ok := os.LookupEnv(\"IDAASDBPORT\"); ok {\n    c.DBPort, _ = strconv.Atoi(v)\n}\nif v, ok := os.LookupEnv(\"IDAASDBHOST\"); ok {\n    c.DBHost = v\n}\n</code></pre>\n\n<p>'c' is the following struct</p>\n\n<pre><code>type Configuration struct {\n    HTTPPort   int\n    DBUserName string\n    DBPasswd   string\n    DBPort     int\n    DBHost     string\n}\n</code></pre>\n\n<p>I only want to update the struct field if the environment variable exists. Seems like some little cute map iterator or something like that would work, but I can't figure out a nice solution.</p>\n"}, {"tags": ["go", "fizzbuzz"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513371552, "post_id": 47839764, "comment_id": 82643532, "body": "No one can explain this without seeing the code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1513371611, "post_id": 47839764, "comment_id": 82643553, "body": "maps are unordered data structures, so their iteration order is not deterministic."}, {"owner": {"reputation": 3795, "user_id": 415404, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3a5fb4c37c49ddfa37942f81e3e2b17c?s=128&d=identicon&r=PG", "display_name": "Gus", "link": "https://stackoverflow.com/users/415404/gus"}, "edited": false, "score": 0, "creation_date": 1513374294, "post_id": 47839764, "comment_id": 82644643, "body": "Not about your question, but stylistically &quot;isMultiple(i,k)==true&quot; should be rewritten as &quot;isMultiple(i,k)&quot;"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1531042053, "post_id": 47839764, "comment_id": 89440522, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/23330781/sort-golang-map-values-by-keys\">sort golang map values by keys</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513371729, "post_id": 47839796, "comment_id": 82643613, "body": "See also <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">the spec</a>: &quot;The iteration order over maps is not specified and is not guaranteed to be the same from one iteration to the next.&quot;"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 2, "last_activity_date": 1513371598, "creation_date": 1513371598, "answer_id": 47839796, "question_id": 47839764, "link": "https://stackoverflow.com/questions/47839764/behaviour-of-order-in-the-range-over-map-in-this-golang-program/47839796#47839796", "title": "Behaviour of order in the range over map in this Golang program", "body": "<p>Go maps are unordered data structures, you should not rely on ordering of keys.</p>\n\n<p>To prevent developers from accidentally relying on small map ordering, Go randomizes small maps every time.</p>\n\n<p>Please <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">read up</a> on maps in Go.</p>\n"}], "owner": {"reputation": 31, "user_id": 9023667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d78ee16492a60ff710006e380ba8a8d7?s=128&d=identicon&r=PG&f=1", "display_name": "iOS_enthusiast", "link": "https://stackoverflow.com/users/9023667/ios-enthusiast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1195, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1513371626, "creation_date": 1513371417, "last_edit_date": 1513371626, "question_id": 47839764, "link": "https://stackoverflow.com/questions/47839764/behaviour-of-order-in-the-range-over-map-in-this-golang-program", "title": "Behaviour of order in the range over map in this Golang program", "body": "<p>I am a beginner programmer and was going through some GitHub repositories and found this simple classic <code>fizzbuzz</code> <a href=\"https://raw.githubusercontent.com/jashanj0tsingh/GoTutorials/master/FizzBuzz.go\" rel=\"nofollow noreferrer\">implementation</a> using a map. However when I run it a couple of times it prints <code>buzzfizz</code> when the <code>isMultiple</code> is <code>true</code> for both <code>3</code> and <code>5</code>. For instance, once in a while for the values <code>15</code> or <code>60</code> it may print <code>buzzfizz</code> instead of <code>fizzbuzz</code> which seems inconsistent to me and got me curious to fix it. Can someone explain why does this happen and what I am missing here? Is it merely a language behavior or the code can be improved for this consistency?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc isMultiple(i,j int)bool  {\n    return i%j==0\n}\nfunc main(){\n    fizzbuzz:=make(map[int]string)\n    fizzbuzz[3]=\"fizz\"\n    fizzbuzz[5]=\"buzz\"\n    for i:=1; i&lt;101; i++ {\n        str:=\"\"\n        for k,v:=range fizzbuzz{\n            if isMultiple(i,k)==true{str+=v}\n        }\n        fmt.Println(i,\":\",str)\n    }\n\n}\n</code></pre>\n\n<p>Edit: Decided to put the code here seeing the common convention it is better here. </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 3, "creation_date": 1513359711, "post_id": 47837149, "comment_id": 82638391, "body": "The answers are correct in that you need to ensure that your app is properly copied into the go path.  However, this assumes that you have vendored all dependencies - if not, you may may need <code>go get</code> or dep to make sure these are available.  If the objective however, is to make your binary portable, then compiling for linux outside of docker, copying the binary and then building a lightweight container from scratch may be a better approach as you will not inadvertently ship all of your source code in the app."}], "answers": [{"tags": [], "owner": {"reputation": 1094, "user_id": 7629560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eEnZy.jpg?s=128&g=1", "display_name": "samthegolden", "link": "https://stackoverflow.com/users/7629560/samthegolden"}, "is_accepted": false, "score": 0, "last_activity_date": 1513359046, "creation_date": 1513359046, "answer_id": 47837204, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/47837204#47837204", "title": "Build Docker with Go app: cannot find package", "body": "<p><code>myapp</code> needs to be in <code>/go/src/myapp</code> as suggested, or in <code>/usr/local/go/src/myapp</code>. You can add it in <code>ADD</code> section.</p>\n"}, {"tags": [], "owner": {"reputation": 569, "user_id": 5805469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7dJe9.jpg?s=128&g=1", "display_name": "Ishan Jain", "link": "https://stackoverflow.com/users/5805469/ishan-jain"}, "is_accepted": true, "score": 14, "last_activity_date": 1513359553, "creation_date": 1513359553, "answer_id": 47837312, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/47837312#47837312", "title": "Build Docker with Go app: cannot find package", "body": "<p>You are copying all the files to Image root directory, Didn't installed any dependencies, Trying to Build it and then run the binary from <code>/go/bin/app</code>. The binary doesn't exists in that directory and it's generating errors.</p>\n\n<p>I would recommend using a Dockerfile like this, </p>\n\n<pre><code>FROM golang:1.9.2 \nADD . /go/src/myapp\nWORKDIR /go/src/myapp\nRUN go get myapp\nRUN go install\nENTRYPOINT [\"/go/bin/myapp\"]\n</code></pre>\n\n<p>This'll do the following. </p>\n\n<ol>\n<li>Copy project files to <code>/go/src/myapp</code>.</li>\n<li>Set Working directory to <code>/go/src/myapp</code>.</li>\n<li>Install dependencies, I used go get but replace it with which ever dependency management tool you are using. </li>\n<li>Install/build the binary. </li>\n<li>Set entry point. </li>\n</ol>\n\n<p>You can run <code>ls</code> or any other command using <code>docker exec</code>.</p>\n\n<p>Example:</p>\n\n<pre><code>docker exec &lt;image name/hash&gt; ls\n</code></pre>\n\n<p>You can also enter the shell in the generated image to understand it well using</p>\n\n<pre><code>docker run --rm -it &lt;image hash/name&gt; /bin/sh\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7443, "user_id": 310662, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3ce57d6e4ca826a201cb5cf1e8595cdb?s=128&d=identicon&r=PG", "display_name": "holms", "link": "https://stackoverflow.com/users/310662/holms"}, "edited": false, "score": 0, "creation_date": 1583271423, "post_id": 47837474, "comment_id": 107058407, "body": "There&#39;s such thing as multi-stage builds in Docker, even atm when you&#39;ve wrote this post"}], "tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": false, "score": -2, "last_activity_date": 1513360263, "creation_date": 1513360263, "answer_id": 47837474, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/47837474#47837474", "title": "Build Docker with Go app: cannot find package", "body": "<p>If the objective is to create a container that simply runs your binary, I would take different approach.</p>\n\n<p>First build the binary for linux:</p>\n\n<pre><code>GOOS=linux CGO_ENABLED=0 go build -a -installsuffix cgo\n</code></pre>\n\n<p>Then build a lightweight docker image from scratch:</p>\n\n<pre><code>FROM scratch\nCOPY myApp \nCMD [\"/myApp\"]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 569, "user_id": 5805469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7dJe9.jpg?s=128&g=1", "display_name": "Ishan Jain", "link": "https://stackoverflow.com/users/5805469/ishan-jain"}, "edited": false, "score": 2, "creation_date": 1514107753, "post_id": 47837973, "comment_id": 82888171, "body": "This approach is nice. I never really understood multistage Docker images before. Thanks."}, {"owner": {"reputation": 69, "user_id": 2327470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77475e78a4733d1783c34e6087e3788f?s=128&d=identicon&r=PG", "display_name": "Gani VastHad", "link": "https://stackoverflow.com/users/2327470/gani-vasthad"}, "edited": false, "score": 0, "creation_date": 1571308449, "post_id": 47837973, "comment_id": 103201774, "body": "I think you don&#39;t need CMD, EXPOSE in first FROM"}, {"owner": {"reputation": 648, "user_id": 9323388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cef802072695bf44b64d63a6805c7901?s=128&d=identicon&r=PG&f=1", "display_name": "Margach Chris", "link": "https://stackoverflow.com/users/9323388/margach-chris"}, "edited": false, "score": 0, "creation_date": 1582891490, "post_id": 47837973, "comment_id": 106941974, "body": "Aka The Builder pattern <a href=\"https://www.youtube.com/watch?v=wGz_cbtCiEA&amp;t=8s\" rel=\"nofollow noreferrer\">youtube.com/watch?v=wGz_cbtCiEA&amp;t=8s</a>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 9, "last_activity_date": 1513362822, "last_edit_date": 1513362822, "creation_date": 1513362509, "answer_id": 47837973, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/47837973#47837973", "title": "Build Docker with Go app: cannot find package", "body": "<p>After experiments I've come to this way of building Golang apps.</p>\n\n<p>This way has several advantages:</p>\n\n<ul>\n<li><p>dependencies are installed on build stage  </p></li>\n<li><p>if you need you may uncomment test options</p></li>\n<li><p>build first fully-functional image about 800 MB</p></li>\n<li><p>copies your program to an fresh empty image and produces very small image about 10 MB</p></li>\n</ul>\n\n<p><strong><code>Dockerfile</code></strong>:</p>\n\n<pre><code># Two-stage build:\n#    first  FROM prepares a binary file in full environment ~780MB\n#    second FROM takes only binary file ~10MB\n\nFROM golang:1.9 AS builder\n\nRUN go version\n\nCOPY . \"/go/src/github.com/your-login/your-project\"\nWORKDIR \"/go/src/github.com/your-login/your-project\"\n\n#RUN go get -v -t  .\nRUN set -x &amp;&amp; \\\n    #go get github.com/2tvenom/go-test-teamcity &amp;&amp; \\  \n    go get github.com/golang/dep/cmd/dep &amp;&amp; \\\n    dep ensure -v\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build  -o /your-app\n\nCMD [\"/your-app\"]\n\nEXPOSE 8000\n\n\n\n#########\n# second stage to obtain a very small image\nFROM scratch\n\nCOPY --from=builder /your-app .\n\nEXPOSE 8000\n\nCMD [\"/your-app\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "is_accepted": false, "score": 5, "last_activity_date": 1540473114, "creation_date": 1540473114, "answer_id": 52990151, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/52990151#52990151", "title": "Build Docker with Go app: cannot find package", "body": "<p>For go 1.11 , you can use go module, the following is example</p>\n\n<pre><code>FROM alpine AS base\nRUN apk add --no-cache curl wget\n\nFROM golang:1.11 AS go-builder\nWORKDIR /go/app\nCOPY . /go/app\nRUN GO111MODULE=on  CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o /go/app/main /go/app/cmd/myapp/main.go\n\nFROM base\nCOPY --from=go-builder /go/app/main /main\nCMD [\"/main\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 8644846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/094ccb3fe41e1088046fed05ffb012eb?s=128&d=identicon&r=PG&f=1", "display_name": "nrm97", "link": "https://stackoverflow.com/users/8644846/nrm97"}, "is_accepted": false, "score": 3, "last_activity_date": 1563944586, "creation_date": 1563944586, "answer_id": 57175575, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package/57175575#57175575", "title": "Build Docker with Go app: cannot find package", "body": "<p>The official docs suggests the following Dockerfile: </p>\n\n<pre><code>FROM golang:1.8\n\nWORKDIR /go/src/app\nCOPY . .\n\nRUN go get -d -v ./...\nRUN go install -v ./...\n\nCMD [\"app\"]\n</code></pre>\n\n<p>Please, visit <a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/golang</a> for more info</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12797, "favorite_count": 6, "accepted_answer_id": 47837312, "answer_count": 6, "score": 15, "last_activity_date": 1563944586, "creation_date": 1513358768, "last_edit_date": 1513359388, "question_id": 47837149, "link": "https://stackoverflow.com/questions/47837149/build-docker-with-go-app-cannot-find-package", "title": "Build Docker with Go app: cannot find package", "body": "<p>I have my Dockerfile in the root of directory with <code>src/myapp</code> folder, <code>myapp</code> contains <code>myapp.go</code> with main package.</p>\n\n<p><code>Dockerfile</code> looks like following:</p>\n\n<pre><code>FROM golang:1.9.2\n\nADD . /\nRUN go build myapp;\n\nENTRYPOINT [\"/go/bin/myapp\"]\n</code></pre>\n\n<p>I get following error:</p>\n\n<pre><code>can't load package: package myapp: cannot find package \"myapp\" in any of:\n    /usr/local/go/src/myapp (from $GOROOT)\n    /go/src/myapp (from $GOPATH)\n</code></pre>\n\n<p>What am I doing wrong? Can I log <code>ls</code> command after docker has done <code>ADD</code>?</p>\n"}, {"tags": ["go", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "is_accepted": true, "score": 1, "last_activity_date": 1578667232, "last_edit_date": 1578667232, "creation_date": 1513363417, "answer_id": 47838186, "question_id": 47835244, "link": "https://stackoverflow.com/questions/47835244/how-do-i-access-a-private-github-repository-within-a-cloud-builder/47838186#47838186", "title": "How do I access a private Github repository within a cloud builder?", "body": "<p>I have no experience with cloud build but you should use ssh:// instead of https:// for cloning your git repository. Then you'll need to add an SSH key to the repo (in github its called deploy keys, either per repo or for your user account) and use the same key when cloning (in Linux its usually enough to put the private key file under ~/.ssh). I guess that solutions you may found which involve Cloud KMS do the same thing but store the private key securely.</p>\n"}], "owner": {"reputation": 329, "user_id": 2434102, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c055d9376881df4fc2945e866a8ae4cd?s=128&d=identicon&r=PG", "display_name": "Amidii", "link": "https://stackoverflow.com/users/2434102/amidii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "accepted_answer_id": 47838186, "answer_count": 1, "score": 2, "last_activity_date": 1578667232, "creation_date": 1513351337, "question_id": 47835244, "link": "https://stackoverflow.com/questions/47835244/how-do-i-access-a-private-github-repository-within-a-cloud-builder", "title": "How do I access a private Github repository within a cloud builder?", "body": "<p>I have two private repositories on Github, A and B. Both are Golang projects. Project A depends on repository B. I have linked both repositories to Google Source Code and consented with permissions.</p>\n\n<p>Cloudbuild.yaml</p>\n\n<pre><code> - name: 'gcr.io/cloud-builders/git'\n   args: ['clone', 'https://source.developers.google.com/p/$PROJECT_ID/r/B']\n</code></pre>\n\n<p>Log from container builder</p>\n\n<pre><code>Starting Step #0\nStep #0: Already have image (with digest): gcr.io/cloud-builders/git\nStep #0: Cloning into 'B'...\nFinished Step #0\n\n...\n\nStep #1: [0;33m[WARN]   [mUnable to checkout github.com/user/B\nStep #1: [0;31m[ERROR]  [mUpdate failed for github.com/user/B: Unable to get repository: Cloning into '/builder/home/.glide/cache/src/B'...\nStep #1: fatal: could not read Username for 'https://github.com': No such device or address\nStep #1: : exit status 128\n</code></pre>\n\n<p>Have anyone got glide to work with container builder and googles own source repositories? I don't want to use 'Cloud Key Management Service' to solve this issue.</p>\n\n<p>Have already tried: <a href=\"https://github.com/GoogleCloudPlatform/cloud-builders/issues/44#issuecomment-325144047\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/cloud-builders/issues/44#issuecomment-325144047</a></p>\n"}, {"tags": ["bash", "go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1513349236, "post_id": 47834646, "comment_id": 82632468, "body": "There&#39;s nothing waiting on your goroutine. You have something else going on."}, {"owner": {"reputation": 491, "user_id": 1119648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c929e5611636bce71f58cb13057933c6?s=128&d=identicon&r=PG", "display_name": "user1119648", "link": "https://stackoverflow.com/users/1119648/user1119648"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513349462, "post_id": 47834646, "comment_id": 82632617, "body": "@JimB Any more insight you could offer?  Something else is not particularly helpful, and it strikes me as odd that the webservice would wait the exact amount of time that the rebuild takes before it responds if it&#39;s not the rebuild that is somehow blocking the http response.  Old habits on checking the request body."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1513349463, "post_id": 47834646, "comment_id": 82632619, "body": "probably not related, but the docs state <code>For server requests the Request Body is always non-nil</code>, your check doesn&#39;t do what you think it does"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1513349543, "post_id": 47834646, "comment_id": 82632666, "body": "You have no logging here at all. Add some to record what the requests were, and when everything happens."}, {"owner": {"reputation": 491, "user_id": 1119648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c929e5611636bce71f58cb13057933c6?s=128&d=identicon&r=PG", "display_name": "user1119648", "link": "https://stackoverflow.com/users/1119648/user1119648"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513349774, "post_id": 47834646, "comment_id": 82632835, "body": "These are shortened versions of the actual script that runs.  The real script Fwrites a timestamped record for most everything that happens.  I&#39;ll shorten the log output, run the request again, and post that."}, {"owner": {"reputation": 491, "user_id": 1119648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c929e5611636bce71f58cb13057933c6?s=128&d=identicon&r=PG", "display_name": "user1119648", "link": "https://stackoverflow.com/users/1119648/user1119648"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513351903, "post_id": 47834646, "comment_id": 82634143, "body": "@JimB Looks like this may be related to supervisord.  When I ran it as a systemd service, everything worked as designed.  Still no Idea the exact nature of the problem."}], "owner": {"reputation": 491, "user_id": 1119648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c929e5611636bce71f58cb13057933c6?s=128&d=identicon&r=PG", "display_name": "user1119648", "link": "https://stackoverflow.com/users/1119648/user1119648"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 166, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1513351414, "creation_date": 1513349043, "last_edit_date": 1513351414, "question_id": 47834646, "link": "https://stackoverflow.com/questions/47834646/go-executable-waits-on-goroutine-to-complete-before-returning-result", "title": "Go Executable waits on goroutine to complete before returning result", "body": "<p>Can someone explain to me why the first go executable returns the http request immediately, and the second does not.</p>\n\n<p>The first, pretty obviously, listens for a post from a Github web hook.  If the hook received is a repo and a branch that we are listening for, it executes a bash script that gets the new code and rebuilds the docker containers.  This script takes about 5 minutes to execute, and it's executed perfectly every time I've run it, but the go process waits until the bash script has finished before it returns the response to the server so Github thinks that the request timed out.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"os/exec\"\n)\n\ntype Repository struct {\n    ID int `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\n//Webhook Object\ntype Webhook struct {\n    Ref     string `json:\"ref\"`\n    Repo    Repository `json:\"repository\"`\n}\n\nfunc valid(str string) bool {\n    var arr[7] string\n    arr[0] = \"Repo1\"\n    arr[1] = \"Repo2\"\n    arr[2] = \"Repo3\"\n    arr[3] = \"Repo4\"\n    arr[4] = \"Repo5\"\n    for _, a := range arr {\n        if a == str {\n            return true\n        }\n    }\n    return false\n}\n\nfunc rebuild() {\n    exec.Command(\"rebuild\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        var webhook Webhook\n        if r.Body == nil {\n                http.Error(w, \"Please send a request body\", 400)\n            return\n        }\n\n        err := json.NewDecoder(r.Body).Decode(&amp;webhook)\n        if err != nil {\n            http.Error(w, err.Error(), 400)\n            return\n        }\n        if strings.Index(webhook.Ref, \"master\") != -1 {\n            if valid(webhook.Repo.Name) {\n                fmt.Fprintf(w, \"%s\", \"success\");\n                go rebuild()\n            }\n        }\n    })\n    log.Fatal(http.ListenAndServe(\":8088\", nil))\n}\n</code></pre>\n\n<p>This second go executable runs a bash script as well. This bash script doesn't do exactly the same thing as the first, but it does run the most time consuming part of the first which is an AOT compile of an Angular application.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os/exec\"\n)\n\ntype Repository struct {\n    ID   int    `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\n//Webhook Object\ntype Webhook struct {\n    Ref  string     `json:\"ref\"`\n    Repo Repository `json:\"repository\"`\n}\n\nfunc rebuild() {\n    var buff bytes.Buffer\n    out, err := exec.Command(\"/bin/bash\", \"/Users/myuser/test.sh\").Output()\n    if err != nil {\n        buff.WriteString(\"Something went wrong: \")\n        fmt.Println(buff.String())\n        log.Fatal(err)\n    }\n    buff.Write(out)\n    fmt.Println(buff.String())\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        var webhook Webhook\n        if r.Body == nil {\n            http.Error(w, \"Please send a request body\", 400)\n            return\n        }\n\n        err := json.NewDecoder(r.Body).Decode(&amp;webhook)\n        if err != nil {\n            http.Error(w, err.Error(), 400)\n            return\n        }\n        fmt.Fprintf(w, \"%s\", \"Success\")\n        go rebuild()\n    })\n    log.Fatal(http.ListenAndServe(\":8088\", nil))\n}\n</code></pre>\n\n<p>The first when run on an EC2 instance, returns in 275 seconds.  The second when run locally, returns in ~20ms.  I can't for the life of me figure out why the first waits on the goroutine to complete before returning, but the second does not.</p>\n\n<p>Any help or insight is greatly appreciated.</p>\n\n<p>Edit:\nLogs print the Following:</p>\n\n<pre><code>Request Recieved At: 2017-12-15T15:17:30Z\nResponse sent At: 2017-12-15T15:17:30Z\nRebuild Started At: 2017-12-15T15:17:30Z\nRebuild Completed At: 2017-12-15T15:22:04Z\n</code></pre>\n"}, {"tags": ["session", "go", "method-signature"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513346825, "post_id": 47833974, "comment_id": 82630988, "body": "You set multiple values, by setting multiple values. Can you show the problem you were having when doing that? You could also just set a single value that contains all the data in one struct."}, {"owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513347022, "post_id": 47833974, "comment_id": 82631101, "body": "Again, I&#39;m not having deep down experience in context thing, as per what I have seen is, programmer returns the context with value like <code>ip</code> or <code>userkey</code>. Thing is, if I want to use sql.Tx as well as session object in context, how would I achieve that so that nested functions can extract and use that info from the context?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1513347244, "post_id": 47833974, "comment_id": 82631211, "body": "See related question <a href=\"https://stackoverflow.com/questions/40654605/design-of-context-interface/40659449#40659449\">Design of Context interface</a>; and possible duplicate <a href=\"https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs\">Golang context.WithValue: how to add several key-value pairs</a>."}, {"owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1513348717, "post_id": 47833974, "comment_id": 82632130, "body": "Thanks, @icza for sharing the links."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513366523, "post_id": 47833974, "comment_id": 82641516, "body": "I&#39;d advise caution when using value contexts. There are numerous potential problems, not least of which are the loss of type-safety and the loss of transparency: by accepting a Context parameter, a function or method exposes zero information about what its requirements actually are. There are many posts on the issues with Context, I <a href=\"https://faiface.github.io/post/context-should-go-away-go2/\" rel=\"nofollow noreferrer\">found this one to be a good summary</a>."}, {"owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513405844, "post_id": 47833974, "comment_id": 82650297, "body": "Thanks for your note @Adrian."}], "answers": [{"tags": [], "owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "is_accepted": false, "score": 0, "last_activity_date": 1513583339, "creation_date": 1513583339, "answer_id": 47864057, "question_id": 47833974, "link": "https://stackoverflow.com/questions/47833974/add-multiple-key-values-in-context-context-from-web-services-api/47864057#47864057", "title": "Add multiple key values in context.Context from web services API", "body": "<p>Finally, I decided to go with context package solution, after studying the articles from the <a href=\"https://github.com/golang/go/wiki/ExperienceReports#context\" rel=\"nofollow noreferrer\">Go context experience reports</a>. And especially I found <a href=\"https://dave.cheney.net/2017/08/20/context-isnt-for-cancellation\" rel=\"nofollow noreferrer\">Dave Cheney's article</a> helpful.</p>\n\n<p>Well, I can make my custom solution for context as <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow noreferrer\">gorilla</a> (Ah, somewhat!). But as Go already have a solution for this, I would go with context package.</p>\n\n<p>Right now, I only need session and database transaction in each method to support transaction if began and user authentication, authorization.</p>\n\n<p>It might be overhead, of having <code>context.Context</code> in each method of the application cause I don't need cancellation, deadline, timeout functionality at the moment but it could be helpful in future.</p>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 3, "last_activity_date": 1550702353, "last_edit_date": 1550702353, "creation_date": 1550701612, "answer_id": 54796215, "question_id": 47833974, "link": "https://stackoverflow.com/questions/47833974/add-multiple-key-values-in-context-context-from-web-services-api/54796215#54796215", "title": "Add multiple key values in context.Context from web services API", "body": "<p>For your second question you can group all your key/values in struct as follows:</p>\n\n<pre><code>type vars struct {\n    lock    sync.Mutex\n    db      *sql.DB\n}\n</code></pre>\n\n<p>Then you can add this struct in context:</p>\n\n<pre><code>ctx := context.WithValue(context.Background(), \"values\", vars{lock: mylock, db: mydb})\n</code></pre>\n\n<p>And you can retrieve it:</p>\n\n<pre><code>ctxVars, ok := r.Context().Value(\"values\").(vars)\nif !ok {\n    log.Println(err)\n    return err\n}\ndb := ctxVars.db\nlock := ctxVars.lock\n</code></pre>\n\n<p>I hope it helps you.</p>\n"}], "owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1746, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1550702353, "creation_date": 1513346645, "last_edit_date": 1529865831, "question_id": 47833974, "link": "https://stackoverflow.com/questions/47833974/add-multiple-key-values-in-context-context-from-web-services-api", "title": "Add multiple key values in context.Context from web services API", "body": "<p>I have a web application written in Go with multiple modules, one deals with all database related things, one deals with reports, one consists all web services, one for just business logic and data integrity validation and several others. So, I have numerous methods, functions have been covered by these modules. </p>\n\n<p>Now, the requirement is to use session in web service as well as we need to use transaction in some APIs. The first approach came to my mind is to change the signature of the existing methods to support session, transaction (*sql.Tx) (which is a painful task, but have to do in anyways!). Now, I'm afraid actually what if something will come in future that needs to be passed through all these methods and then should I have to go through this cycle again to change the method signature again? This does not seem to be a good approach.</p>\n\n<p>Later, I found that context.Context might be a good approach (well, you can suggest other approaches too, apart from this!) that for every method call, just pass context parameter at first argument place in a method call hence I've to change methods signature only one time. If I go with this approach, can anyone tell me how would I set/pass multiple keys (session, sql.Tx) in that context object? \n(AFAIK, context.Context provides <code>WithValue</code> method, but can I use it for multiple keys? How would I set a key in the nested function call, is that even possible?)</p>\n\n<p>Actually, this question has two questions: </p>\n\n<ol>\n<li>Should I consider <code>context.Context</code> for my solution? If not, give me a light on another approach.</li>\n<li>How do I set multiple keys and values in <code>context.Context</code>?</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1513344538, "post_id": 47833277, "comment_id": 82629621, "body": "What is your output, and what do you expect? Also, it seems like you know exactly the format of the message, why not parse into a defined struct?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1513346840, "post_id": 47833277, "comment_id": 82630998, "body": "Go is statically typed an interface{} is not iterable. You shouldn&#39;t use interface{}. Or you must type assert to e.g. a slice of appropriate type."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1513356583, "post_id": 47833277, "comment_id": 82636913, "body": "Unmarshalling into a <code>map[string]interface{}</code> is generally only useful when you don&#39;t know the structure of the JSON, or as a fallback technique.  If your JSON has reliable and known structure, unmarshal it into a matching struct."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1513356635, "post_id": 47833277, "comment_id": 82636951, "body": "Also, because you&#39;ll definitely run into an issue at some point, <i>don&#39;t ignore errors!</i> . <code>strconv.ParseInt()</code> returns an error for a reason, because <i>it can fail</i>."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 4, "last_activity_date": 1513363002, "last_edit_date": 1513363002, "creation_date": 1513358632, "answer_id": 47837117, "question_id": 47833277, "link": "https://stackoverflow.com/questions/47833277/golan-over-range-interface/47837117#47837117", "title": "Golan over range interface{}", "body": "<p>Since you're unmarshaling into a generic value (<code>map[string]interface{}</code>) you'll need to use a <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">type assertion</a> to convert the value referenced by the \"talk_messages\" key into a slice of generic types (<code>[]interface{}</code>) so they can be iterated using the \"range\" keyword, e.g.:</p>\n\n<pre><code>messages := talkData[\"talk_messages\"].([]interface{})\n// assert a slice type --------------^^^^^^^^^^^^^^^^\n\nfor i, message := range messages {\n    fmt.Printf(\"OK: message %d =&gt; %s\\n\", i, message)\n}\n</code></pre>\n\n<p>Even better, since you know the structure of the data ahead of time, and assuming it is consistent, you could define struct types in which to marshal that data directly and not have to worry about the <code>interface{}</code> type at all:</p>\n\n<pre><code>type TalkData struct {\n  Id           int           `json:\"talk_id\"`\n  ReceiverId   int           `json:\"receiver_id\"`\n  ReceiverName string        `json:\"receiver_name\"`\n  SenderId     int           `json:\"sender_id\"`\n  Messages     []TalkMessage `json:\"talk_messages\"`\n}\n\ntype TalkMessage struct {\n  Id       int    `json:\"message_id\"`\n  Body     string `json:\"body\"`\n  SendDate string `json:\"send_date\"`\n  SenderId int    `json:\"sender_id\"`\n  TalkId   int    `json:\"talk_id\"`\n}\n\ntalkData := &amp;TalkData{}\nerr := json.Unmarshal([]byte(data), &amp;talkData)\nif err != nil {\n  // Handle err...\n}\n\nfor i, message := range talkData.Messages {\n  // Process message...\n}\n</code></pre>\n\n<p>Also, as mentioned by commenters, you should handle errors in some way other than simply printing them otherwise the program will do unexpected things.</p>\n"}], "owner": {"reputation": 83, "user_id": 5902381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-ryQHRPr1cTA/AAAAAAAAAAI/AAAAAAAAAH0/ocl8QbWfa3k/photo.jpg?sz=128", "display_name": "Umutcan Ert&#252;rk", "link": "https://stackoverflow.com/users/5902381/umutcan-ert%c3%bcrk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1635, "favorite_count": 0, "accepted_answer_id": 47837117, "answer_count": 1, "score": -3, "last_activity_date": 1513363002, "creation_date": 1513344143, "question_id": 47833277, "link": "https://stackoverflow.com/questions/47833277/golan-over-range-interface", "title": "Golan over range interface{}", "body": "<p>I'am trying to develop simple chat application. And User talks coming from webservice like this json. And I unmarshaling this json as map[string]interface{}. My question is I am trying to get all \"talk_messages\" in for loop. But I can't.</p>\n\n<pre><code>{\n\"talk_id\": 0,\n\"receiver_id\": 1,\n\"receiver_name\":\"Jack\",\n\"sender_id\": 0,\n\"talk_messages\":[\n    {\n        \"message_id\": 0,\n        \"body\": \"Helooo\",\n        \"send_date\": \"12/3/2017 4:57:15 PM\",\n        \"sender_id\": 0,\n        \"talk_id\": 0\n    },\n    {\n        \"message_id\": 1,\n        \"body\": \"Helooo\",\n        \"send_date\": \"12/3/2017 4:58:15 PM\",\n        \"sender_id\": 1,\n        \"talk_id\": 0\n    },\n    {\n        \"message_id\": 2,\n        \"body\": \"Whatsapp\",\n        \"send_date\": \"12/3/2017 4:59:22 PM\",\n        \"sender_id\": 0,\n        \"talk_id\": 0\n    },\n    {\n        \"message_id\": 3,\n        \"body\": \"Lorem impus\",\n        \"send_date\": \"12/3/2017 5:01:15 PM\",\n        \"sender_id\": 1,\n        \"talk_id\": 0\n    }\n]\n}\n</code></pre>\n\n<p>here is my for loop. What is my problem?</p>\n\n<pre><code>var talkData map[string]interface{}\n\nif unMarshalError := json.Unmarshal([]byte(data), &amp;talkData); unMarshalError != nil {\n    fmt.Println(\"Talk initialize error :\", unMarshalError)\n}\n\nidString := fmt.Sprintf(\"%v\", talkData[\"talk_id\"])\ntalk.id, _ = strconv.ParseInt(idString, 10, 64)\n\ntalk.playerOneId = fmt.Sprintf(\"%v\", talkData[\"receiver_id\"])\ntalk.playerTwoId = fmt.Sprintf(\"%v\", talkData[\"sender_id\"])\ntalk.receiverName = fmt.Sprintf(\"%v\", talkData[\"receiver_name\"])\n\nfor _, val := range talkData[\"talk_messages\"] {\n    fmt.Println(val)\n}\nfmt.Println(talk.id, talk.playerOneId, talk.playerTwoId)\n</code></pre>\n"}, {"tags": ["dictionary", "go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9103154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37cfe4120147e1470e72e461ef2ad331?s=128&d=identicon&r=PG&f=1", "display_name": "celestia", "link": "https://stackoverflow.com/users/9103154/celestia"}, "edited": false, "score": 0, "creation_date": 1513676206, "post_id": 47831032, "comment_id": 82733457, "body": "Thanks, and sorry for the admittedly trivial question."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1513335865, "creation_date": 1513335865, "answer_id": 47831032, "question_id": 47830908, "link": "https://stackoverflow.com/questions/47830908/using-a-channel-of-maps-in-go/47831032#47831032", "title": "Using a channel of maps in go", "body": "<p>The error message tells you exactly what you're doing wrong: You're trying to assign a value of type <code>chan map[string]string</code> to a variable of type <code>map[string]string</code>:</p>\n\n<pre><code>var pipe map[string]string\npipe = make(chan map[string]string, 2)\n</code></pre>\n\n<p>Here you're creating a variable called <code>pipe</code> of type <code>map[string]string</code>, then on the second line, you're creating a channel (of type <code>chan map[string]string</code>) and trying to assign it to that variable. That doesn't work.</p>\n\n<p>You're doing the same thing in your second code example.</p>\n\n<p><code>map[string]string</code> and <code>chan map[string]string</code> are distinct types.</p>\n"}], "owner": {"reputation": 13, "user_id": 9103154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37cfe4120147e1470e72e461ef2ad331?s=128&d=identicon&r=PG&f=1", "display_name": "celestia", "link": "https://stackoverflow.com/users/9103154/celestia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2432, "favorite_count": 0, "accepted_answer_id": 47831032, "answer_count": 1, "score": -1, "last_activity_date": 1513335865, "creation_date": 1513335479, "question_id": 47830908, "link": "https://stackoverflow.com/questions/47830908/using-a-channel-of-maps-in-go", "title": "Using a channel of maps in go", "body": "<p>I'd like to pass a map through a channel in go:</p>\n\n<pre><code>func main() {\n    var pipe map[string]string\n    pipe = make(chan map[string]string, 2)\n    go connect(\"myhost\", \"100\", pipe)\n    out := &lt;-pipe\n...}\n</code></pre>\n\n<p>so that the func() passes response and error through the channel:</p>\n\n<pre><code>func connect(host string, url string, pipe chan&lt;- map[string]string) {\n    fmt.Println(\"Trying \"+url)\n    var lpipe map[string]string\n    lpipe = make(map[string]string)\n    lpipe[\"resp\"], lpipe[\"err\"] = \"aaa\",\"bbb\"\n    pipe &lt;- lpipe\n}\n</code></pre>\n\n<p>The compiler rejects both </p>\n\n<pre><code>    pipe = make(chan map[string]string, 2)\n:cannot use make(chan map[string]string, 2) (type chan map[string]string) as type map[string]string in assignment\n</code></pre>\n\n<p>and</p>\n\n<pre><code>    pipe = make(chan map, 2)\n:unexpected comma, expecting [\n</code></pre>\n\n<p>What am I doing wrong? The whole thing is for being parallelized into goroutines. </p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513394623, "post_id": 47839241, "comment_id": 82648638, "body": "The reason I create this type is for embedded, in this way,I can keep the original data as root and attach extra data/field and non global method"}, {"owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513394902, "post_id": 47839241, "comment_id": 82648680, "body": "BTW,the error is not about the missing method,but some internal unexpected error"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513397278, "post_id": 47839241, "comment_id": 82648965, "body": "@wener if you check my code after replacing {{.Ok}} everything goes well and you do not get any internal error. your bus error occurred because of invalid physical error and I think it&#39;s related to find the Ok method. please check my edited answer."}, {"owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513520099, "post_id": 47839241, "comment_id": 82676034, "body": "Yes, <code>{{.MyFace.Ok}}</code> works, but how can I make the original code works ?"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513520811, "post_id": 47839241, "comment_id": 82676245, "body": "@wener I think with which I see in the documentation you cannot do it in the current version of go."}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513521320, "post_id": 47839241, "comment_id": 82676385, "body": "@wener I working on it, but I think you can do it starting from go 1.5 by <a href=\"https://golang.org/pkg/reflect/#MakeFunc\" rel=\"nofollow noreferrer\">reflect.MakeFunc</a>. If I can do it I attach my new code in the answer."}, {"owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513521471, "post_id": 47839241, "comment_id": 82676414, "body": "Thanks, I thought MakeFunc can only make standalone method , can not attach to struct."}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1513523204, "post_id": 47839241, "comment_id": 82676915, "body": "@wener You are right. I do my best but I cannot find any solution for creating methods."}], "tags": [], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "is_accepted": false, "score": 0, "last_activity_date": 1513397130, "last_edit_date": 1513397130, "creation_date": 1513368634, "answer_id": 47839241, "question_id": 47830784, "link": "https://stackoverflow.com/questions/47830784/unexpected-fault-address-when-using-reflect-created-value-for-template/47839241#47839241", "title": "unexpected fault address when using reflect created value for template", "body": "<p>you can pass <code>reflect.Value</code> directly into <code>text/template</code> and <code>html/template</code> execute method. If you change your code and pass them directly and use <code>{.MyFace.Ok}</code> everything works fine. I attach my code:</p>\n\n<pre><code>package hello\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"html/template\"\n    \"reflect\"\n    \"testing\"\n)\n\nfunc TestData(t *testing.T) {\n    tpl, err := template.New(\"ok\").Parse(\"{{.MyFace.Ok}}\")\n    if err != nil {\n        panic(err)\n    }\n    buf := bytes.NewBuffer(nil)\n    myTyp := reflect.StructOf([]reflect.StructField{\n        {Name: \"MyFace\", Type: reflect.TypeOf((*MyFace)(nil)).Elem(), Index: []int{0}, Anonymous: true},\n    })\n    fmt.Println(myTyp)\n    myVal := reflect.New(myTyp)\n    myVal.Elem().Field(0).Set(reflect.New(reflect.TypeOf(testFace{})).Elem())\n    err = tpl.Execute(buf, myVal.Elem()) // unexpected fault address\n    //err = tpl.Execute(buf, &amp;testDat{MyFace: MyFace(&amp;testFace{})}) // works as expected\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(buf.String())\n}\n\ntype testData struct {\n    MyFace\n}\ntype testFace struct {\n    i int\n}\n\nfunc (testFace) Ok() string {\n    return \"All right\"\n}\n\ntype MyFace interface {\n    Ok() string\n}\n</code></pre>\n\n<p>but as you can test with use <code>myVal.Elem().Interface()</code> in above code all of your problems because go cannot find Ok method on your passed interface.</p>\n\n<p>As you can see in <code>reflect.StructOf</code> documentation StructOf currently does not generate wrapper methods for embedded fields. This limitation may be lifted in a future version.</p>\n"}], "owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 524, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1513397130, "creation_date": 1513335093, "question_id": 47830784, "link": "https://stackoverflow.com/questions/47830784/unexpected-fault-address-when-using-reflect-created-value-for-template", "title": "unexpected fault address when using reflect created value for template", "body": "<p>I want to minimic type <code>testData</code> by reflect, but got <code>unexpected fault address</code></p>\n\n<pre><code>func TestData(t *testing.T) {\n    tpl, err := template.New(\"ok\").Parse(\"{{.Ok}}\")\n    if err != nil {\n        panic(err)\n    }\n    buf := bytes.NewBuffer(nil)\n    myTyp := reflect.StructOf([]reflect.StructField{\n        {Name: \"MyFace\", Type: reflect.TypeOf((*MyFace)(nil)).Elem(), Index: []int{0}, Anonymous: true},\n    })\n    myVal := reflect.New(myTyp).Elem()\n    myVal.Field(0).Set(reflect.ValueOf(MyFace(&amp;testFace{})))\n    err = tpl.Execute(buf, myVal.Interface()) // unexpected fault address\n    //err = tpl.Execute(buf, &amp;testDat{MyFace: MyFace(&amp;testFace{})}) // works as expected\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(buf.String())\n}\n\ntype testData struct {\n    MyFace\n}\ntype testFace struct {\n}\n\nfunc (testFace) Ok() string {\n    return \"All right\"\n}\n\ntype MyFace interface {\n    Ok() string\n}\n</code></pre>\n\n<p><strong>ERROR</strong></p>\n\n<pre><code>unexpected fault address 0xc4200e83a0\n[signal SIGBUS: bus error code=0x2 addr=0xc4200e83a0 pc=0xc4200e83a0]\n\ngoroutine 5 [running]:\nruntime.throw(0x13728ac, 0x5)\n    /usr/local/Cellar/go/1.9.1/libexec/src/runtime/panic.go:605 +0x95 fp=0xc420058fe8 sp=0xc420058fc8 pc=0x102d235\nruntime.sigpanic()\n    /usr/local/Cellar/go/1.9.1/libexec/src/runtime/signal_unix.go:364 +0x29d fp=0xc420059038 sp=0xc420058fe8 pc=0x1043c2d\nruntime.call32(0xc42007f260, 0xc42000e0a8, 0xc4200e8560, 0x800000018)\n    /usr/local/Cellar/go/1.9.1/libexec/src/runtime/asm_amd64.s:509 +0x3b fp=0xc420059068 sp=0xc420059038 pc=0x105a51b\nreflect.Value.call(0xc42009ca00, 0xc420048e10, 0x293, 0x1372569, 0x4, 0x155f1b8, 0x0, 0x0, 0x13711a0, 0x1, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/reflect/value.go:434 +0x906 fp=0xc420059340 sp=0xc420059068 pc=0x10b1c76\nreflect.Value.Call(0xc42009ca00, 0xc420048e10, 0x293, 0x155f1b8, 0x0, 0x0, 0x150f5c0, 0xc420064300, 0xc420064300)\n    /usr/local/Cellar/go/1.9.1/libexec/src/reflect/value.go:302 +0xa4 fp=0xc4200593a8 sp=0xc420059340 pc=0x10b1254\ntext/template.(*state).evalCall(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0xc42009ca00, 0xc420048e10, 0x293, 0x150b800, 0xc42007eff0, 0x137307e, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:670 +0x580 fp=0xc4200595e0 sp=0xc4200593a8 pc=0x12b3480\ntext/template.(*state).evalField(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0x137307e, 0x2, 0x150b800, 0xc42007eff0, 0xc420048d00, 0x1, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:560 +0xd38 fp=0xc420059940 sp=0xc4200595e0 pc=0x12b2d98\ntext/template.(*state).evalFieldChain(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0xc42009ca00, 0xc420048e10, 0x99, 0x150b800, 0xc42007eff0, 0xc420048cf0, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:528 +0x22a fp=0xc4200599f8 sp=0xc420059940 pc=0x12b1d2a\ntext/template.(*state).evalFieldNode(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0xc42007eff0, 0xc420048d00, 0x1, 0x1, 0x0, 0x0, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:492 +0x118 fp=0xc420059ab0 sp=0xc4200599f8 pc=0x12b1478\ntext/template.(*state).evalCommand(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0xc42007efc0, 0x0, 0x0, 0x0, 0x348a0, 0x12fa0e0, ...)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:430 +0x676 fp=0xc420059b60 sp=0xc420059ab0 pc=0x12b0e26\ntext/template.(*state).evalPipeline(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0xc420088280, 0xc42007f1d0, 0x30, 0x28)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:408 +0x115 fp=0xc420059c58 sp=0xc420059b60 pc=0x12b0315\ntext/template.(*state).walk(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0x150b620, 0xc42007f020)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:234 +0x4af fp=0xc420059cd8 sp=0xc420059c58 pc=0x12af01f\ntext/template.(*state).walk(0xc420059dd0, 0xc42009ca00, 0xc420048e10, 0x99, 0x150b920, 0xc42007ef90)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:242 +0x11d fp=0xc420059d58 sp=0xc420059cd8 pc=0x12aec8d\ntext/template.(*Template).execute(0xc4200107c0, 0x1505a00, 0xc4200fe620, 0xc42009ca00, 0xc420048e10, 0x0, 0x0)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:197 +0x1f9 fp=0xc420059e28 sp=0xc420059d58 pc=0x12ae6c9\ntext/template.(*Template).Execute(0xc4200107c0, 0x1505a00, 0xc4200fe620, 0xc42009ca00, 0xc420048e10, 0x16, 0x194)\n    /usr/local/Cellar/go/1.9.1/libexec/src/text/template/exec.go:180 +0x53 fp=0xc420059e70 sp=0xc420059e28 pc=0x12ae4a3\nwenerme/tests/wcwork.TestData(0xc4201020f0)\n    /Users/wener/go/src/wenerme/tests/wcwork/types_test.go:241 +0x31f fp=0xc420059fa8 sp=0xc420059e70 pc=0x12c459f\ntesting.tRunner(0xc4201020f0, 0x1387c28)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:746 +0xd0 fp=0xc420059fd0 sp=0xc420059fa8 pc=0x10efc60\nruntime.goexit()\n    /usr/local/Cellar/go/1.9.1/libexec/src/runtime/asm_amd64.s:2337 +0x1 fp=0xc420059fd8 sp=0xc420059fd0 pc=0x105cd41\ncreated by testing.(*T).Run\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:789 +0x2de\n\ngoroutine 1 [chan receive]:\ntesting.(*T).Run(0xc420102000, 0x13732b1, 0x8, 0x1387c28, 0x107ab01)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:790 +0x2fc\ntesting.runTests.func1(0xc420102000)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:1004 +0x64\ntesting.tRunner(0xc420102000, 0xc420057de0)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:746 +0xd0\ntesting.runTests(0xc4200e8320, 0x153b700, 0x5, 0x5, 0xc42009c820)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:1002 +0x2d8\ntesting.(*M).Run(0xc420057f18, 0xc420057f70)\n    /usr/local/Cellar/go/1.9.1/libexec/src/testing/testing.go:921 +0x111\nmain.main()\n</code></pre>\n\n<p>What's wrong with with reflect ?</p>\n"}, {"tags": ["windows", "go", "runtime-error", "non-english"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 8, "creation_date": 1513323193, "post_id": 47827581, "comment_id": 82617648, "body": "1. Translate it yourself (offline or via a translation service). 2. Contact the original author of library (if the message is from such a lib). 3. Change OS language if this stems from your os. So basically nothing. Sorry."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513332668, "post_id": 47827581, "comment_id": 82622675, "body": "What is generating the error?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1513333519, "post_id": 47827581, "comment_id": 82623218, "body": "You need to give a bit more detail here - What is the program? what are the arguments given to it? Are you compiling it or an end user?"}, {"owner": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "edited": false, "score": 0, "creation_date": 1513426545, "post_id": 47827581, "comment_id": 82655141, "body": "The program is not important, because I want to have ALL error messages in English. This is a run-time error, and I need the EXACT English error to successfully search it to found the cause. I emphasize that my need is not to have translated this message, but have the &#39;standard&#39; English error in order to search for a solution."}], "answers": [{"comments": [{"owner": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "edited": false, "score": 0, "creation_date": 1513426867, "post_id": 47830284, "comment_id": 82655229, "body": "I don&#39;t need help with this specific error. The program of this example doesn&#39;t have more than a dozen lines. It&#39;ll help to know from where the error comes, but I couldn&#39;t find it."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "edited": false, "score": 0, "creation_date": 1513448782, "post_id": 47830284, "comment_id": 82661813, "body": "Give more detail to get an answer"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1513333448, "creation_date": 1513333448, "answer_id": 47830284, "question_id": 47827581, "link": "https://stackoverflow.com/questions/47827581/how-to-get-error-messages-in-english-in-golang/47830284#47830284", "title": "How to get error messages in English in golang?", "body": "<p>The error message means <em>An invalid argument was provided</em>, it is partly in english, so probably just the last bit was added by the program. What is the program and how are you calling it? It's possible the message comes from the OS, the program or libraries used by the program, but most likely it comes from the program concerned. </p>\n\n<p>Assuming you compiled the program, search for that string in your source code, <em>including libraries</em>, and change it to your desired string, then recompile. </p>\n"}, {"comments": [{"owner": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "edited": false, "score": 0, "creation_date": 1513427014, "post_id": 47831347, "comment_id": 82655269, "body": "In Linux is as easy as you comment, but not in Windows. I&#39;ve a W7, with no chances to change. If I use a cygwin console and running the program with LANG=C doesn&#39;t work."}, {"owner": {"reputation": 152, "user_id": 8656476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/945b1c30e3fef71ac52c1748e94a8555?s=128&d=identicon&r=PG", "display_name": "Quirinux", "link": "https://stackoverflow.com/users/8656476/quirinux"}, "reply_to_user": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "edited": false, "score": 0, "creation_date": 1514897651, "post_id": 47831347, "comment_id": 83095228, "body": "Cool, it looks like there are some work around using the kernel32.dll where, <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd374051(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a>, but I&#39;m not sure it this is the bet approach, I would create an account just to run this service setting the properly language and locale things, like number, date and time format, or if it was just for a dev env using WSL is another good choice"}], "tags": [], "owner": {"reputation": 152, "user_id": 8656476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/945b1c30e3fef71ac52c1748e94a8555?s=128&d=identicon&r=PG", "display_name": "Quirinux", "link": "https://stackoverflow.com/users/8656476/quirinux"}, "is_accepted": false, "score": 1, "last_activity_date": 1513356843, "last_edit_date": 1513356843, "creation_date": 1513336927, "answer_id": 47831347, "question_id": 47827581, "link": "https://stackoverflow.com/questions/47827581/how-to-get-error-messages-in-english-in-golang/47831347#47831347", "title": "How to get error messages in English in golang?", "body": "<p>I'm assuming you're running your server in a linux box, which might be set to spanish language.  Supposing you'd like to keep like this, a good way to get rid of that is using something like this when you run the server:</p>\n\n<pre><code>bash$&gt; LANG=en_IN ./your_fancy_server\n</code></pre>\n\n<p>Note that it impacts in all language set, like number, date and time formats.  More about that and how to isolate each of them <a href=\"https://www.cyberciti.biz/faq/how-to-set-locales-i18n-on-a-linux-unix/\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Another option is using something closer to golang style, like <a href=\"https://github.com/nicksnyder/go-i18n\" rel=\"nofollow noreferrer\">go-i18n</a>, and parse all the error messages.</p>\n\n<p>My personal note here (it's just my personal opinion instead of a universal truth), but if I were you I would set my server to English language and do the properly treatments inside the software, and no, English is not my first language. </p>\n\n<p>Last but not least, if you're on Windows, sorry, it won't help you.  Next time please give as much details as possible, the more the better.</p>\n"}], "owner": {"reputation": 700, "user_id": 506615, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/458ff0353aad337578d0f54947991ae4?s=128&d=identicon&r=PG", "display_name": "juanmah", "link": "https://stackoverflow.com/users/506615/juanmah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "closed_date": 1513816091, "answer_count": 2, "score": -4, "last_activity_date": 1513427065, "creation_date": 1513322591, "last_edit_date": 1513427065, "question_id": 47827581, "link": "https://stackoverflow.com/questions/47827581/how-to-get-error-messages-in-english-in-golang", "closed_reason": "Needs more focus", "title": "How to get error messages in English in golang?", "body": "<p>When I run a program in go, in a W7 in Spanish, I get error messages in the SO language.</p>\n\n<p>To provide an example:</p>\n\n<pre><code>2017/12/15 08:11:28 listen tcp :8080: socket: Se ha proporcionado un argumento no v\u00e1lido.\n</code></pre>\n\n<p>What can I do to get messages like this in English?</p>\n\n<p>I emphasize that my need is not to have translated this specific message, but have the 'standard' English error in order to search for a solution.</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1513329539, "post_id": 47827043, "comment_id": 82620741, "body": "can you attach collection structure and yaml file example?"}], "answers": [{"tags": [], "owner": {"reputation": 908, "user_id": 3649496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59c95010d46812ccabe7eea947a090ab?s=128&d=identicon&r=PG&f=1", "display_name": "infiniteLearner", "link": "https://stackoverflow.com/users/3649496/infinitelearner"}, "is_accepted": false, "score": 0, "last_activity_date": 1610438874, "last_edit_date": 1610438874, "creation_date": 1596106637, "answer_id": 63171689, "question_id": 47827043, "link": "https://stackoverflow.com/questions/47827043/dynamically-unmarshaling-yaml-in-golang/63171689#63171689", "title": "Dynamically Unmarshaling yaml in golang", "body": "<p>I found answer to this question on reddit , to help future readers I am providing content below with link to the post where I found it.</p>\n<blockquote>\n<p>The solution, I believe, is to simply pass <code>t</code>, not <code>&amp;t</code> to Unmarshal.</p>\n<p>Rationale: You need to pass a pointer to a struct which can take the\nintended data as a dynamic value in the interface{} to Unmarshal. From\npickT, you return new(Collection), which is such a pointer. But then,\nyou first store it in another interface type (Migration) and then take\nthe pointer of that. Meaning, yaml will a) see that it gets passed a\npointer and b) try to store the value in the pointee. But the pointee\nis of interface type (and that interface value will then contain the\nactual struct, but yaml doesn't do this additional redirection).</p>\n<p>If you instead pass t (which has interface type) it will first be\nconverted to interface{} and then passed on - so the argument will\ndirectly contain a *Collection, as intended.</p>\n<p>The difference here is, that if you convert/assign one interface type\nto another, it won't get re-wrapped, but the dynamic value in one\nvalue will just be transferred to another. But if you store a\nnon-interface type (like a pointer to an interface), it will get\nre-wrapped.</p>\n<p>It's not easily explained, I'm afraid. You can see the effect here\ntoo: <a href=\"https://play.golang.org/p/ia181c_Pwp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ia181c_Pwp</a> (note, that Printf also\ntakes an interface{})</p>\n</blockquote>\n<p><a href=\"https://www.reddit.com/r/golang/comments/7k0kpv/please_help_with_dynamically_unmarshaling_yaml_in/\" rel=\"nofollow noreferrer\">https://www.reddit.com/r/golang/comments/7k0kpv/please_help_with_dynamically_unmarshaling_yaml_in/</a></p>\n"}], "owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1330, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1610438874, "creation_date": 1513319813, "last_edit_date": 1513353475, "question_id": 47827043, "link": "https://stackoverflow.com/questions/47827043/dynamically-unmarshaling-yaml-in-golang", "title": "Dynamically Unmarshaling yaml in golang", "body": "<p>Edit: Adding problem context</p>\n\n<p>I'm making a migration tool for the ArangoDB database. Don't know what that is? Checkout <a href=\"https://www.arangodb.com\" rel=\"nofollow noreferrer\">https://www.arangodb.com</a>. Now like most migration tools, mine needs to create Collections, which are logically equivalent to SQL Tables. It needs to create or remove indexes, collections, graphs, and other DB entities as well as execute arbitrary AQL (SQL like algebra for ArangoDB).</p>\n\n<p>To support this the user creates a series of migration files, each saying what to do with that step. So step 1 might say \"Create Collection Users\" and step 67 might say \"Delete Collection Users -- since we renamed it\". I want to use YAML because I was explicitly asked by the ArangoDB team why I didn't. Golang seems like a better choice than my existing Java implementation due to the binary distribution not requiring Java.</p>\n\n<p>All that said, I have several different types of structs stored in different yaml files. I can tell which struct is in which file by reading the first line of the yaml. I want to be as DRY as possible with reading the file. </p>\n\n<p>I tried to have a factory method that creates the proper struct to from the file in this code. We can assume that all instances of pickT will return a valid implementation of the Migration interface.</p>\n\n<pre><code>func pickT(contents []byte) (Migration, error) {\n    s := string(contents)\n    switch {\n    case collection.MatchString(s):\n        return new(Collection), nil\n    default:\n        return nil, errors.New(\"Can't determine YAML type\")\n    }\n}\n\nfunc toStruct(childPath string) Migration {\n    contents := open(childPath)\n\n    t, err := pickT(contents)\n    if err != nil {\n        log.Fatal(err)\n    }\n    //c := Collection{}\n    err = yaml.UnmarshalStrict(contents, &amp;t)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return t\n}\n</code></pre>\n\n<p>This code does not work. Yaml kicks out the error below.</p>\n\n<pre><code>--- FAIL: TestLoadFromPath (0.00s)\npanic: reflect.Set: value of type map[interface {}]interface {} is not assignable to type main.Migration [recovered]\n    panic: reflect.Set: value of type map[interface {}]interface {} is not assignable to type main.Migration [recovered]\n    panic: reflect.Set: value of type map[interface {}]interface {} is not assignable to type main.Migration\n\ngoroutine 5 [running]:\ntesting.tRunner.func1(0xc4201060f0)\n    /usr/local/go/src/testing/testing.go:711 +0x2d2\npanic(0x68ade0, 0xc420010cf0)\n    /usr/local/go/src/runtime/panic.go:491 +0x283\ngopkg.in/yaml%2ev2.handleErr(0xc420057b18)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/yaml.go:164 +0x9f\npanic(0x68ade0, 0xc420010cf0)\n    /usr/local/go/src/runtime/panic.go:491 +0x283\nreflect.Value.assignTo(0x69e740, 0xc42007d230, 0x15, 0x6f30e4, 0xb, 0x6a45a0, 0xc420010cd0, 0x69e740, 0xc42007d230, 0x15)\n    /usr/local/go/src/reflect/value.go:2192 +0x3a6\nreflect.Value.Set(0x6a45a0, 0xc420010cd0, 0x194, 0x69e740, 0xc42007d230, 0x15)\n    /usr/local/go/src/reflect/value.go:1357 +0xa4\ngopkg.in/yaml%2ev2.(*decoder).mapping(0xc420060900, 0xc4200644e0, 0x6a45a0, 0xc420010cd0, 0x194, 0x6a45a0)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/decode.go:522 +0x8e2\ngopkg.in/yaml%2ev2.(*decoder).unmarshal(0xc420060900, 0xc4200644e0, 0x6a45a0, 0xc420010cd0, 0x194, 0xc4200644e0)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/decode.go:292 +0x136\ngopkg.in/yaml%2ev2.(*decoder).document(0xc420060900, 0xc420064480, 0x6a45a0, 0xc420010cd0, 0x194, 0xc4200608c0)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/decode.go:304 +0x80\ngopkg.in/yaml%2ev2.(*decoder).unmarshal(0xc420060900, 0xc420064480, 0x6a45a0, 0xc420010cd0, 0x194, 0x194)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/decode.go:280 +0x1d2\ngopkg.in/yaml%2ev2.unmarshal(0xc42010c000, 0x3b, 0x23b, 0x67c4a0, 0xc420010cd0, 0x1, 0x0, 0x0)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/yaml.go:101 +0x289\ngopkg.in/yaml%2ev2.UnmarshalStrict(0xc42010c000, 0x3b, 0x23b, 0x67c4a0, 0xc420010cd0, 0x0, 0x0)\n    /home/jdavenpo/go/src/gopkg.in/yaml.v2/yaml.go:87 +0x58\ngithub.com/deusdat/arangomigo.toStruct(0xc420014360, 0x26, 0x0, 0x0)\n    /home/jdavenpo/go/src/github.com/deusdat/arangomigo/migrations.go:102 +0x295\ngithub.com/deusdat/arangomigo.loadFrom(0x6f8059, 0x1a, 0x0, 0x0, 0x0)\n    /home/jdavenpo/go/src/github.com/deusdat/arangomigo/migrations.go:67 +0x4d6\ngithub.com/deusdat/arangomigo.TestLoadFromPath(0xc4201060f0)\n    /home/jdavenpo/go/src/github.com/deusdat/arangomigo/migrations_test.go:11 +0x48\ntesting.tRunner(0xc4201060f0, 0x705950)\n    /usr/local/go/src/testing/testing.go:746 +0xd0\ncreated by testing.(*T).Run\n    /usr/local/go/src/testing/testing.go:789 +0x2de\n</code></pre>\n\n<p>To the best of my understanding, Go type erases the interface, at least functionally. Is there any way to dynamically pick the type and then have Yaml convert it out? I know that I can do this manually by repeating the same logic over and over in different functions like the one below, but this seems...terrible. </p>\n\n<pre><code>func fromCollectionYaml(content string) Migration {\n    c := Collection{}\n    err := yaml.Unmarshal(content, &amp;c)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return c\n}\n</code></pre>\n\n<p>Edit: Adds the Collection struct and Yaml</p>\n\n<pre><code>type: collection\nAction: create\nName: Users\nJournalsize: 10\n\ntype Collection struct {\n    Name           string\n    Action         Action\n    ShardKeys      []string\n    JournalSize    int\n    NumberOfShards int\n    WaitForSync    bool\n    AllowUserKeys  bool\n    Volatile       bool\n    Compactable    bool\n}\n\nfunc (this Collection) migrate(action Action, db *arangolite.Database) error {\n    return nil\n}\n</code></pre>\n\n<p>In the near future I need to add structs for Indexes. Graphs and other ArangoDB related features. Each Yaml file needs to go into a struct that produces and migration, which is just a instance of an interfaces with the one function currently shown along with the struct.</p>\n"}, {"tags": ["select", "go", "concurrency"], "comments": [{"owner": {"reputation": 13, "user_id": 9101984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9a146155c36f4c07a0b56a235805dfd?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Fern&#225;ndez", "link": "https://stackoverflow.com/users/9101984/luis-fern%c3%a1ndez"}, "edited": false, "score": 0, "creation_date": 1513317923, "post_id": 47826568, "comment_id": 82615587, "body": "Well, I have found out that removing the close() functions entirely make the program behave as I was expecting, still a very interesting behavior from such function."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1513329721, "post_id": 47826568, "comment_id": 82620837, "body": "I suggest you bookmark <a href=\"https://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow noreferrer\">Channel Axioms by Dave Cheney</a>. It helped my out a lot when I was learning this stuff."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9101984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9a146155c36f4c07a0b56a235805dfd?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Fern&#225;ndez", "link": "https://stackoverflow.com/users/9101984/luis-fern%c3%a1ndez"}, "edited": false, "score": 0, "creation_date": 1513318355, "post_id": 47826682, "comment_id": 82615729, "body": "Nice, I didn&#39;t know that there was a second value other than the sent value itself when retrieving from a channel indicating whether such channel is open or not. Thanks!"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1513357276, "post_id": 47826682, "comment_id": 82637246, "body": "Note that the second value doesn&#39;t indicate whether the channel is closed, it indicates whether the (first) value is a zero value because the channel is closed.  If you have a buffered channel, that boolean will still be false even if the channel is closed if there&#39;s still data in the channel&#39;s buffed.  Example: <a href=\"https://play.golang.org/p/T6unYxQtZE\" rel=\"nofollow noreferrer\">play.golang.org/p/T6unYxQtZE</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1513359809, "last_edit_date": 1513359809, "creation_date": 1513317884, "answer_id": 47826682, "question_id": 47826568, "link": "https://stackoverflow.com/questions/47826568/what-is-the-correct-use-of-select-statement-in-go/47826682#47826682", "title": "What is the correct use of select statement in Go?", "body": "<p>The program is printing 0 because receive on a closed channel returns the zero value. Here's one way to accomplish your goal.  </p>\n\n<p>First, eliminate the <code>q</code> channel. Closing the <code>o</code> and <code>e</code> channels is sufficient to indicate that the sender is done.</p>\n\n<pre><code>func send(e, o chan&lt;- int, q chan&lt;- bool) {\n    for i := 0; i &lt; 100; i++ {\n        if i%2 == 0 {\n            e &lt;- i\n        } else {\n            o &lt;- i\n        }\n    }\n    close(e)\n    close(o)\n}\n</code></pre>\n\n<p>When receiving values, use the two value receive to detect when the zero value is returned because the channel is closed. Set the channel to nil when the channel is closed.  Receive on a nil channel does not yield a value. Loop until both channels are nil.</p>\n\n<pre><code>func receive(e, o &lt;-chan int, q &lt;-chan bool) {\n\n    for e != nil &amp;&amp; o != nil {\n        select {\n        case v, ok := &lt;-e:\n            if !ok {\n                e = nil\n                continue\n            }\n            fmt.Println(\"From even channel:\", v)\n        case v, ok := &lt;-o:\n            if !ok {\n                o = nil\n                continue\n            }\n            fmt.Println(\"From odd channel:\", v)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/EFbDz2DJ7l\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 13, "user_id": 9101984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9a146155c36f4c07a0b56a235805dfd?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Fern&#225;ndez", "link": "https://stackoverflow.com/users/9101984/luis-fern%c3%a1ndez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 47826682, "answer_count": 1, "score": 1, "last_activity_date": 1513359809, "creation_date": 1513317321, "question_id": 47826568, "link": "https://stackoverflow.com/questions/47826568/what-is-the-correct-use-of-select-statement-in-go", "title": "What is the correct use of select statement in Go?", "body": "<p>Good Day everyone</p>\n\n<p>I have been learning the fundaments of go and how to use its channel-based concurrency paradigm.</p>\n\n<p>However, while playing with some code I wrote focusing on the select statement I found a strange behavior:</p>\n\n<pre><code>func main() {\n    even := make(chan int)\n    odd := make(chan int)\n    quit := make(chan bool)\n\n    //send\n    go send(even, odd, quit)\n\n    //receive\n    receive(even, odd, quit)\n    fmt.Println(\"Exiting\")\n}\n\nfunc send(e, o chan&lt;- int, q chan&lt;- bool) {\n    for i := 0; i &lt; 100; i++ {\n        if i%2 == 0 {\n            e &lt;- i\n        } else {\n            o &lt;- i\n        }\n    }\n    close(e)\n    close(o)\n    q &lt;- true\n    close(q)\n}\n\nfunc receive(e, o &lt;-chan int, q &lt;-chan bool) {\n    for cont, i := true, 0; cont; i++ {\n        fmt.Println(\"value of i\", i, cont)\n        select {\n        case v := &lt;-e:\n            fmt.Println(\"From even channel:\", v)\n        case v := &lt;-o:\n            fmt.Println(\"from odd channel:\", v)\n        case v := &lt;-q:\n            fmt.Println(\"Got exit message\", v)\n            // return // have also tried this instead\n            cont = false\n        }\n    }\n}\n</code></pre>\n\n<p>when I run this simple program sometimes the i accumulator ends up with more than a 100 being printed to the console, and instead of finishing up with a \"from odd channel: 99\", the for loop continues on outputting one or more zeroes from even/odd channels randomly, as if the quit channel's message was being somewhat being delayed onto its case and instead the odd/even channels were sending more integers thus quitting the for loop not exactly after the odd/even channels have been closed.</p>\n\n<pre><code>value of i 97 true\nfrom odd channel: 97\nvalue of i 98 true\nFrom even channel: 98\nvalue of i 99 true\nfrom odd channel: 99\nvalue of i 100 true\nFrom even channel: 0\nvalue of i 101 true\nFrom even channel: 0\nvalue of i 102 true\nfrom odd channel: 0\nvalue of i 103 true\nFrom even channel: 0\nvalue of i 104 true\nGot exit message true\nExiting\n</code></pre>\n\n<p>I have tried to search for the correct use of the case statement but I haven\u00b4t been able to find the problem with my code.</p>\n\n<p>It seems like the same behavior can be reproduced on the go playground: <a href=\"https://play.golang.org/p/-CjnTZJJiU\" rel=\"nofollow noreferrer\">my code</a></p>\n\n<p>thanks for your attention put on my question.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513332767, "post_id": 47826491, "comment_id": 82622736, "body": "What line numbers correspond to your included code?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1513345930, "post_id": 47826491, "comment_id": 82630444, "body": "That code can&#39;t produce that error unless your <code>if err != nil {         fmt.Println(err)     }</code> printed and then you tried to use <code>s</code>"}, {"owner": {"reputation": 1, "user_id": 8328960, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iZ3YgOfgcvU/AAAAAAAAAAI/AAAAAAAAAL0/TVByTqOaMUQ/photo.jpg?sz=128", "display_name": "Shivam Suri", "link": "https://stackoverflow.com/users/8328960/shivam-suri"}, "edited": false, "score": 0, "creation_date": 1513567632, "post_id": 47826491, "comment_id": 82688482, "body": "The line 150 refers to result, err1:= reader.ReadBytes(&#39;\\x0a&#39;), that&#39;s where the error is generated.  So the function ReadBytes expects input, but somehow even before I give an input, the function is executed and it gives that error, the &#39;x\\0a&#39; is there so that it waits until I give an input and press enter"}], "owner": {"reputation": 1, "user_id": 8328960, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iZ3YgOfgcvU/AAAAAAAAAAI/AAAAAAAAAL0/TVByTqOaMUQ/photo.jpg?sz=128", "display_name": "Shivam Suri", "link": "https://stackoverflow.com/users/8328960/shivam-suri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 347, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513319190, "creation_date": 1513316790, "last_edit_date": 1513319190, "question_id": 47826491, "link": "https://stackoverflow.com/questions/47826491/getting-an-input-from-serial-port", "title": "Getting an input from serial port", "body": "<p>I am trying to write a program to read from an RFID card reader, I have configured the device to be a character input and end the input with enter. I am using GoLang. Here's the part of the code where I read the input:</p>\n\n<pre><code>//Using www.github.com/tarm/goserial and bufio\n\nfunc getInput(input chan string) {\n    c := &amp;serial.Config{Name: \"/dev/input/event5\", Baud: 9600}\n    s, err := serial.OpenPort(c)\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    for {\n        reader:= bufio.NewReader(s)\n        result, err1:= reader.ReadBytes('\\x0a')\n        if err1!=nil {\n            panic(err1)\n        }\n        input&lt;-string(result)\n    }\n    s.Close()\n}\n</code></pre>\n\n<p>However, as soon as it executes the function reader.ReadBytes, and sees there isn't an input, gives me this error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x93e432]\n\ngoroutine 53 [running]:\n\nvendor/github.com/tarm/serial.(*Port).Read(0x0, 0xc420292000, 0x1000,      \n0x1000, 0x18, 0xc4201b4d00, 0xc4201793f0) \n    vendor/github.com/tarm/serial/serial_linux.go:135 +0x22\nbufio.(*Reader).fill(0xc420036f18)\n    /usr/local/go/src/bufio/bufio.go:97 +0x117\nbufio.(*Reader).ReadSlice(0xc420036f18, 0xc42029200a, 0x7fac0a47fab0, \n0x1, 0x101000000000000, 0x0, 0x1000)\n    /usr/local/go/src/bufio/bufio.go:338 +0xbb\nbufio.(*Reader).ReadBytes(0xc420036f18, 0x100a, 0x1000, 0xc420292000, \n0x1000, 0x1000, 0x0)\n    /usr/local/go/src/bufio/bufio.go:416 +0x66\ngetInput(0xc4201e8c00)\n    /home/shivam/go/src/main.go:150 +0x172\ncreated by main.go.ReadCard\n    /home/shivam/go/src/main.go:164 +0x72\n\nexit status 2\n</code></pre>\n\n<p>What can I do so that it waits for an input and sends it when it receives a '\\x0a' byte (Return)?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "concurrency", "producer-consumer", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1513333022, "post_id": 47826429, "comment_id": 82622916, "body": "Sounds like you need to use a larger buffer"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1513333977, "post_id": 47826429, "comment_id": 82623526, "body": "<code>go func() { channel &lt;- url }()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "edited": false, "score": 0, "creation_date": 1513381436, "post_id": 47835335, "comment_id": 82646653, "body": "So if you have an indefinite number of urls in the crawl space, would I just set an arbitrarily high buffer for the channel or is #3 my only option?"}, {"owner": {"reputation": 16, "user_id": 7222659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7406aa00e758a8c3258c06f19293e3?s=128&d=identicon&r=PG&f=1", "display_name": "Daan Willems", "link": "https://stackoverflow.com/users/7222659/daan-willems"}, "reply_to_user": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "edited": false, "score": 0, "creation_date": 1513434618, "post_id": 47835335, "comment_id": 82657357, "body": "You could just use a large buffer, but this feels rather hacky. #3 Seems preferable to that. Alternatively you could forego the entire channel queue approach and write the urls you find to a database (Something like redis maybe?). Each worker could then query the database for uncompleted url&#39;s. This has the added benefit of not losing all your progress when the applications closes. Another option would be to pass around a mutex slice, This seems pretty complicated though."}], "tags": [], "owner": {"reputation": 16, "user_id": 7222659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7406aa00e758a8c3258c06f19293e3?s=128&d=identicon&r=PG&f=1", "display_name": "Daan Willems", "link": "https://stackoverflow.com/users/7222659/daan-willems"}, "is_accepted": true, "score": 0, "last_activity_date": 1513358614, "last_edit_date": 1513358614, "creation_date": 1513351673, "answer_id": 47835335, "question_id": 47826429, "link": "https://stackoverflow.com/questions/47826429/how-do-i-add-an-object-to-a-channel-from-a-goroutine-that-is-receiving-data-from/47835335#47835335", "title": "How do I add an object to a channel from a goroutine that is receiving data from that channel?", "body": "<p>Write operations to channels are blocking when the channel is not buffered.</p>\n\n<p>To create a buffered channel:</p>\n\n<pre><code>urlChan := make(chan string, len(allUrls))\n</code></pre>\n\n<p>When this channel is full however, write operations will block again. </p>\n\n<p>Alternatively you could use a switch. When the write 'fails' it will immediately fall through to default</p>\n\n<pre><code>select {\ncase urlChan &lt;- url:\n    fmt.Println(\"received message\")\ndefault:\n    fmt.Println(\"no activity\")\n}\n</code></pre>\n\n<p>To have a timeout on writing to the channel do the following</p>\n\n<pre><code>select {\ncase urlChan &lt;- url:\n    fmt.Println(\"received message\")\ncase &lt;-time.After(5 * time.Second):\n    fmt.Println(\"timed out\")\n}\n</code></pre>\n\n<p>Or finally put the write event in a separate go channel</p>\n\n<pre><code>func write() {\n    urlChan &lt;- url\n}\n\ngo write()\n</code></pre>\n"}], "owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 47835335, "answer_count": 1, "score": 2, "last_activity_date": 1513358614, "creation_date": 1513316406, "question_id": 47826429, "link": "https://stackoverflow.com/questions/47826429/how-do-i-add-an-object-to-a-channel-from-a-goroutine-that-is-receiving-data-from", "title": "How do I add an object to a channel from a goroutine that is receiving data from that channel?", "body": "<p>Basically, I am trying to write a concurrent sitemap crawler using goroutines. One sitemap can contain links to multiple sitemaps which can contain links to other sitemaps etc. </p>\n\n<p>Right now, this is my design:</p>\n\n<pre><code>worker:\n     - receives url from channel\n     - processesUrl(url)\nprocessUrl:\n     for each link in lookup(url):\n         - if link is sitemap:\n                channel &lt;- url\n           else:\n               print(url)\nmain:\n    - create 10 workers\n    - chanel &lt;- root url\n</code></pre>\n\n<p>the problem is that the worker won't accept a new url from the channel until processUrl() is finished and processUrl won't finish until a worker accepts a new url from the channel if it is adding a url to the channel. What concurrent design can I use to add the url to a task queue without a channel and without busy-waiting or without waiting for <code>channel &lt;- url</code>?</p>\n\n<p>Here is the actual code if it helps:</p>\n\n<pre><code>func (c *SitemapCrawler) worker() {\n    for {\n        select {\n        case url := &lt;-urlChan:\n            fmt.Println(url)\n            c.crawlSitemap(url)\n        }\n    }\n}\nfunc crawlUrl(url string) {\n    defer crawlWg.Done()\n    crawler := NewCrawler(url)\n    for i := 0; i &lt; MaxCrawlRate*20; i++ {\n        go crawler.worker()\n    }\n    crawler.getSitemaps()\n    pretty.Println(crawler.sitemaps)\n    crawler.crawlSitemaps()\n}\nfunc (c SitemapCrawler) crawlSitemap(url string) {\n    c.limiter.Take()\n    resp, err := MakeRequest(url)\n    if err != nil || resp.StatusCode != 200 {\n        crawlWg.Done()\n        return\n    }\n    var resp_txt []byte\n    if strings.Contains(resp.Header.Get(\"Content-Type\"), \"html\") {\n        crawlWg.Done()\n        return\n    } else if strings.Contains(url, \".gz\") || resp.Header.Get(\"Content-Encoding\") == \"gzip\" {\n        reader, err := gzip.NewReader(resp.Body)\n        if err != nil {\n            crawlWg.Done()\n            panic(err)\n        } else {\n            resp_txt, err = ioutil.ReadAll(reader)\n            if err != nil {\n                crawlWg.Done()\n                panic(err)\n            }\n        }\n        reader.Close()\n    } else {\n        resp_txt, err = ioutil.ReadAll(resp.Body)\n        if err != nil {\n            //panic(err)\n            crawlWg.Done()\n            return\n        }\n    }\n    io.Copy(ioutil.Discard, resp.Body)\n    resp.Body.Close()\n\n    d, err := libxml2.ParseString(string(resp_txt))\n    if err != nil {\n        crawlWg.Done()\n        return\n    }\n    results, err := d.Find(\"//*[contains(local-name(), 'loc')]\")\n    if err != nil {\n        crawlWg.Done()\n        return\n    }\n    locs := results.NodeList()\n    printLock.Lock()\n    for i := 0; i &lt; len(locs); i++ {\n        newUrl := locs[i].TextContent()\n        if strings.Contains(newUrl, \".xml\") {\n            crawlWg.Add(1)\n            //go c.crawlSitemap(newUrl)\n            urlChan &lt;- newUrl\n        } else {\n            fmt.Println(newUrl)\n        }\n    }\n    printLock.Unlock()\n\n    crawlWg.Done()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513348999, "post_id": 47825555, "comment_id": 82632295, "body": "This is explained <a href=\"https://tour.golang.org/moretypes/13\" rel=\"nofollow noreferrer\">in the tour</a>, <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">in the spec</a>, and <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">on the blog</a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1513310008, "creation_date": 1513310008, "answer_id": 47825577, "question_id": 47825555, "link": "https://stackoverflow.com/questions/47825555/what-is-the-difference-between-makestring-and-string/47825577#47825577", "title": "what is the difference between make([]string) and []string{}", "body": "<p>The expression <code>make([]string,10)</code> returns a slice with length and capacity of 10.  The expression <code>[]string{}</code> returns a slice with length and capacity of 0.</p>\n\n<p><a href=\"https://play.golang.org/p/mfwL4xFUgU\" rel=\"noreferrer\">Check it out on the playground</a>.</p>\n"}], "owner": {"reputation": 63, "user_id": 7802045, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b405dbec103e4b4c1fa5567c8bb682ef?s=128&d=identicon&r=PG&f=1", "display_name": "xjk", "link": "https://stackoverflow.com/users/7802045/xjk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1513350222, "creation_date": 1513309806, "last_edit_date": 1513333621, "question_id": 47825555, "link": "https://stackoverflow.com/questions/47825555/what-is-the-difference-between-makestring-and-string", "title": "what is the difference between make([]string) and []string{}", "body": "<p>I  make  global declaration of a value.  </p>\n\n<pre><code>var {\n     b = make([]string,10)  //way 1\n     a = []string{}         //way 2\n}\n</code></pre>\n\n<p>Both ways work. Can someone make detailed explanation of the difference between them?</p>\n"}, {"tags": ["c++", "go", "tcp", "socket.io", "libevent"], "comments": [{"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 1, "creation_date": 1513324513, "post_id": 47825438, "comment_id": 82618185, "body": "This is probably better suited on code review. Some thoughts: you are using way more channels than needed, and you missed a check on the socket type assertion"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513334262, "post_id": 47825438, "comment_id": 82623724, "body": "im useless to this (i can only suggest to add a sleep....), but interested. Do you mind posting on the ml <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!forum/golang-nuts</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513345835, "post_id": 47825438, "comment_id": 82630384, "body": "Most of the time being spent in syscall for io is what you would expect. You&#39;re making a lot of garbage, perhaps the GC is taking up the extra time. Note that total CPU usage would be expected to be higher in the Go program, because the Go program is probably just doing more, but you should be able to get throughput fairly close."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513349523, "post_id": 47825438, "comment_id": 82632654, "body": "The <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">Go toolchain includes a strong profiler</a>."}, {"owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "reply_to_user": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1513566735, "post_id": 47825438, "comment_id": 82688252, "body": "@PasserBy yes, I created a channel for every socket connection, I did this to improve the socket connection concurrency, and this demo is just for testing golang socket performance, in this case I didn&#39;t do the socket type assertion. Do you think too many channels will case the high cpu usage?"}, {"owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1513566785, "post_id": 47825438, "comment_id": 82688266, "body": "@mh-cbon ah, that&#39;s a good idea, I will post this one later."}, {"owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513567590, "post_id": 47825438, "comment_id": 82688473, "body": "@JimB This is what I confused, most of the time cost on the syscall, but the C++ program will also call so many syscall (maybe), what cause the big difference? The GC maybe a problem, do you have any idea to reduce the GC frequency?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513604663, "post_id": 47825438, "comment_id": 82704616, "body": "@E.SHEN, the garbage collector runs after a certain amount of allocations when there&#39;s garbage to collect. You&#39;re allocating a new 1kb buffer for every read."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1515575409, "post_id": 47825438, "comment_id": 83347237, "body": "Aren&#39;t you just benchmarking the benchmark tool? If the benchmark tool was any good I don&#39;t see why the server shouldn&#39;t eat all 24 CPUs rather than just 8. The fact that you only have 800% CPU usage means that redis-benchmark can&#39;t keep up sending requests fast enough to saturate all your CPUs. And the fact that the C++ server only eats 200% means that either it&#39;s not multi-threaded or it&#39;s way too fast for the benchmark tool. A good server should eat all available CPUs, if it doesn&#39;t that means that there is some resource contention going on or it&#39;s badly written."}, {"owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1515659672, "post_id": 47825438, "comment_id": 83386315, "body": "@Art thanks for your reply, you are right at some points. And yes, this golang tcp server can eat all 24 CPUs, but the benchmark tool has its   own limitation, he can only post 15W+ request per second. both C++ server and golang server are too strong for the benchmark. My question is when C++ server and golang server handle the same number of requst, why does the golang server cost much more CPU resurce than a C++ server?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1515660929, "post_id": 47825438, "comment_id": 83386971, "body": "@E.SHEN Well, you said that the C++ server is written with libevent, generally that is used for things that aren&#39;t multithreaded so it surprises me that it uses more than one cpu to be honest. Also, what does &quot;15W+&quot; exactly mean?"}, {"owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1515662792, "post_id": 47825438, "comment_id": 83388074, "body": "@Art After the server read the message from client, I handled some logic in the other thread and send back a message to the client. In this case the usage is more than one cpu. And the &quot;15W+&quot; means &quot;150,000+&quot;, my bad :)"}], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 4132245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WrKgr.jpg?s=128&g=1", "display_name": "Gnukos", "link": "https://stackoverflow.com/users/4132245/gnukos"}, "is_accepted": false, "score": 0, "last_activity_date": 1519923569, "creation_date": 1519923569, "answer_id": 49054942, "question_id": 47825438, "link": "https://stackoverflow.com/questions/47825438/how-can-i-reduce-cpu-usage-in-a-golang-tcp-server/49054942#49054942", "title": "how can I reduce cpu usage in a golang tcp server?", "body": "<p>I don't think parallelise the read and write with channel will provide you better performance in this case. You should try to do less memory allocation and less syscall (The write function may do a lot of syscalls)</p>\n\n<p>Can you try this version?</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    listen, err := net.Listen(\"tcp\", \"0.0.0.0:17379\")\n    if err != nil {\n        fmt.Errorf(err.Error())\n    }\n    acceptClient(listen)\n}\n\nfunc acceptClient(listen net.Listener) {\n    for {\n        sock, err := listen.Accept()\n        if err != nil {\n            fmt.Errorf(err.Error())\n        }\n        tcp := sock.(*net.TCPConn)\n        tcp.SetNoDelay(true)\n        go handleConn(tcp) // less go routine creation but no concurrent read/write on the same conn\n    }\n}\n\nvar respPattern = []byte(\"+OK\\r\\n\")\n\n// just one goroutine per conn\nfunc handleConn(sock *net.TCPConn) {\n    count := 0\n    buf := make([]byte, 4098) // Do not create a new buffer each time &amp; increase the buff size\n    defer sock.Close()\n\n    for {\n        n, err := sock.Read(buf)\n        if err != nil {\n            return\n        }\n        count += n\n        x := count / 58\n        count = count % 58\n        resp := bytes.Repeat(respPattern, x) // can be optimize\n        _, writeError := sock.Write(resp) // do less syscall\n        if writeError != nil {\n            return\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 7194090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e168a9ff3e052375544021f3cd80209?s=128&d=identicon&r=PG&f=1", "display_name": "E.SHEN", "link": "https://stackoverflow.com/users/7194090/e-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1698, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1519923569, "creation_date": 1513308918, "last_edit_date": 1513317848, "question_id": 47825438, "link": "https://stackoverflow.com/questions/47825438/how-can-i-reduce-cpu-usage-in-a-golang-tcp-server", "title": "how can I reduce cpu usage in a golang tcp server?", "body": "<p>I try to implement a golang tcp server, and I found the concurrency is satisfied for me, but the CPU usage is too high(concurrency is 15W+/s, but the CPU usage is about 800% in a 24 cores linux machine). At the same time, a C++ tcp server is only about 200% usage with a similar concurrency(with libevent).</p>\n\n<p>The following code is the demo of golang:</p>\n\n<pre><code>func main() {\n    listen, err := net.Listen(\"tcp\", \"0.0.0.0:17379\")\n    if err != nil {\n        fmt.Errorf(err.Error())\n    }\n    go acceptClient(listen)\n    var channel2 = make(chan bool)\n    &lt;-channel2\n}\n\nfunc acceptClient(listen net.Listener) {\n    for {\n        sock, err := listen.Accept()\n        if err != nil {\n            fmt.Errorf(err.Error())\n        }\n        tcp := sock.(*net.TCPConn)\n        tcp.SetNoDelay(true)\n        var channel = make(chan bool, 10)\n        go read(channel, sock.(*net.TCPConn))\n        go write(channel, sock.(*net.TCPConn))\n    }\n}\n\nfunc read(channel chan bool, sock *net.TCPConn) {\n    count := 0\n    for {\n        var buf = make([]byte, 1024)\n        n, err := sock.Read(buf)\n        if err != nil {\n            close(channel)\n            sock.CloseRead()\n            return\n        }\n        count += n\n        x := count / 58\n        count = count % 58\n        for i := 0; i &lt; x; i++ {\n            channel &lt;- true\n        }\n   }\n}\n\nfunc write(channel chan bool, sock *net.TCPConn) {\n    buf := []byte(\"+OK\\r\\n\")\n    defer func() {\n        sock.CloseWrite()\n        recover()\n    }()\n    for {\n        _, ok := &lt;-channel\n        if !ok {\n            return\n        }\n        _, writeError := sock.Write(buf)\n        if writeError != nil {\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>And I test this tcp server by the redis-benchmark with multi-clients:</p>\n\n<pre><code>redis-benchmark -h 10.100.45.2  -p 17379 -n 1000 -q script load \"redis.call('set','aaa','aaa')\"\n</code></pre>\n\n<p>I also analyzed my golang code by the pprof, it is said CPU cost a lot of time on syscall:\n<a href=\"https://i.stack.imgur.com/P1S1n.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1513307228, "post_id": 47824826, "comment_id": 82612928, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33936081/golang-method-with-pointer-receiver\">Golang method with pointer receiver</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1513358205, "post_id": 47824826, "comment_id": 82637691, "body": "Also a good read on the subject: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">blog.golang.org/laws-of-reflection</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1513310128, "creation_date": 1513310128, "answer_id": 47825590, "question_id": 47824826, "link": "https://stackoverflow.com/questions/47824826/calling-pointer-receiver-method-with-non-pointer-value/47825590#47825590", "title": "Calling pointer receiver method with non pointer value", "body": "<p>The second call doesn't work because the type <code>person</code> doesn't implement the <code>human</code> interface (only <code>*person</code> does). The \"magic\" that allows you to call a method with a pointer receiver on a non-pointer value and vice versa only applies to those specific cases. When assigning a value to an interface variable or field or passing it as a parameter that expects an interface, the type of the value must implement the interface.</p>\n\n<p>If you were to call <code>p.speak()</code>, the compiler would automatically change that to <code>(&amp;p).speak()</code>. A similar conversion happens in the other direction if you have a method with a non-pointer receiver and you call it on a pointer.</p>\n"}], "owner": {"reputation": 583, "user_id": 630623, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8b3423cf69d98436422deb42022c9b54?s=128&d=identicon&r=PG", "display_name": "Harsh Vardhan", "link": "https://stackoverflow.com/users/630623/harsh-vardhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1441, "favorite_count": 1, "accepted_answer_id": 47825590, "answer_count": 1, "score": 1, "last_activity_date": 1513311493, "creation_date": 1513303616, "last_edit_date": 1513311493, "question_id": 47824826, "link": "https://stackoverflow.com/questions/47824826/calling-pointer-receiver-method-with-non-pointer-value", "title": "Calling pointer receiver method with non pointer value", "body": "<p>Please see the code below. I know it as a fact that a non pointer receiver can accept pointer and non-pointers values but a pointer receiver can only accept a pointer value. That being said, I fail to understand how the last call works and the second-last doesn't. (<a href=\"https://play.golang.org/p/kq4-A3_lN7\" rel=\"nofollow noreferrer\">Run Here</a>)</p>\n\n<p>The issue is that I am able to call a Pointer Receiver method from non pointer method. That is not explained in the <a href=\"https://stackoverflow.com/questions/33936081/golang-method-with-pointer-receiver\">other similar question</a>. That answer explains only about the pointer calling pointer receiver method. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype person struct {\n    name string\n}\n\ntype human interface {\n    speak() string\n}\n\nfunc (p *person) speak() string {\n    return \"Speak() called by \" + p.name\n}\n\nfunc saySomething(h human) {\n    fmt.Println(\"area\", h.speak())\n}\n\nfunc main() {\n    p := person{\"harsh\"}\n    //works\n    saySomething(&amp;p)\n\n    //doesn't work\n    //saySomething(p)\n\n    //works\n    p.speak()\n}\n</code></pre>\n"}]