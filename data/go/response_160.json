[{"tags": ["security", "session", "go", "gorilla"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1517450689, "post_id": 48552240, "comment_id": 84104894, "body": "Yes, don\u2019t use securecookie directly (it\u2019s a building block). sessions uses it automatically, and all sessions are thus authenticated (signed) by default."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2855262"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1517584772, "post_id": 48552240, "comment_id": 84168241, "body": "Cheers elithrar its clicked now, I just did not see that in the documentation for Gorilla, thanks again."}], "owner": {"user_type": "does_not_exist", "display_name": "user2855262"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517436396, "creation_date": 1517436396, "question_id": 48552240, "link": "https://stackoverflow.com/questions/48552240/how-secure-a-user-id-with-golang-gorilla-toolkit-to-be-used-with-respect-to-sess", "title": "How secure a user id with Golang Gorilla toolkit to be used with respect to sessions and secure cookies", "body": "<p>I have started to look at Gorilla Toolkit for Golang but I am having some difficulty in understanding of to use sessions or securecookies? I want to produce a secure user id which I can move between server and client so I initially thought I would use sessions but I cant see how to plug securecookie into it, without securecookie the sessions just perform base64 encoding?</p>\n\n<p>I am sure I have missed something but to be honest I have done a lot of Googling but the examples I have seen are typically showing how to use sessions or securecookie but not sessions which are secure? Or do I just use cookies and forget sessions?</p>\n\n<p>Again sorry if I have missed something simple but I would just appreciate a point in the right direction on which of the toolkit parts are to be used together a simple example would also be very appreciated.</p>\n\n<p>Many thanks in advance for your time.</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1517433957, "post_id": 48551651, "comment_id": 84099571, "body": "Can you show the code you&#39;re trying to accomplish this with so far?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517460953, "post_id": 48551651, "comment_id": 84107278, "body": "Maybe another os call for <code>tail -n1</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1517448656, "post_id": 48553130, "comment_id": 84104459, "body": "The question says: &quot;a great deal of data, at the end of the data it gives a total.&quot; Splitting a great deal of data into lines is unnecessary and inefficient."}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "edited": false, "score": 0, "creation_date": 1517492739, "post_id": 48553130, "comment_id": 84124189, "body": "I gave this a go and it seems as though &quot;matches&quot; is nothing, I presume I probably have to modify the regex string, as my test server spits out &quot;0 Total&quot; at all times.  Edit:Just noticed the end output has 1 leading new line and 2 new lines after it, not sure if this would be causing a lack of a match."}, {"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "edited": false, "score": 0, "creation_date": 1517493473, "post_id": 48553130, "comment_id": 84124724, "body": "If there&#39;s more content after &quot;n Total&quot; you may want to change 20 to a higher number."}, {"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "edited": false, "score": 0, "creation_date": 1517493492, "post_id": 48553130, "comment_id": 84124739, "body": "Try fmt.Println(string(b.Bytes()[b.Len()-100:])) and see what the output is. Does it include your total value?"}, {"owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "edited": false, "score": 0, "creation_date": 1517499118, "post_id": 48553130, "comment_id": 84128683, "body": "if I tailor it down to -11 it does (anything over 11 with my test case is out of bounds due to the very very low amount of output my test server gives).  Which is why I don&#39;t understand why the regex doesn&#39;t match, even tested it on a regex tester and its found."}, {"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "edited": false, "score": 0, "creation_date": 1517555869, "post_id": 48553130, "comment_id": 84151329, "body": "I&#39;ve modified the code so that you won&#39;t get an out of bounds error due to very low output. I&#39;ve also replaced the test string with an actual os command and it&#39;s working fine for me."}], "tags": [], "owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "is_accepted": false, "score": 0, "last_activity_date": 1517555635, "last_edit_date": 1517555635, "creation_date": 1517441308, "answer_id": 48553130, "question_id": 48551651, "link": "https://stackoverflow.com/questions/48551651/isolating-string-output/48553130#48553130", "title": "Isolating String Output", "body": "<p>You can split the string by <code>\\n</code> and get the last line.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    output := `\nSome os output\nSome more os output\nAgain some os output\n1001 Total`\n\n    // If you're getting the string from the bytes.Buffer do this:\n    // output := myBytesBuffer.String()\n\n    outputSplit := strings.Split(output, \"\\n\") // Break into lines\n\n    // Get last line from the end.\n    // -1 assumes the numbers in the last line. Change it if its not.\n    lastLine := outputSplit[len(outputSplit)-1]\n\n    lastLine = strings.Replace(lastLine, \" Total\", \"\", -1) // Remove text\n\n    number, _ := strconv.Atoi(lastLine) // Convert from text to number\n\n    fmt.Println(number)\n}\n</code></pre>\n\n<p>peterSO points out that for big output the above may be slow.</p>\n\n<p>Here's another way that uses a compiled regexp expression to match against a small subset of bytes.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"os/exec\"\n    \"regexp\"\n    \"strconv\"\n)\n\nfunc main() {\n    // Create regular expression. You only create this once.\n    // Would be regexpNumber := regexp.MustCompile(`(\\d+) Total`) for you\n    regexpNumber := regexp.MustCompile(`(\\d+) bits physical`)\n\n    // Whatever your os command is\n    command := exec.Command(\"cat\", \"/proc/cpuinfo\")\n    output, _ := command.Output()\n\n    // Your bytes.Buffer\n    var b bytes.Buffer\n    b.Write(output)\n\n    // Get end of bytes slice\n    var end []byte\n    if b.Len()-200 &gt; 0 {\n        end = b.Bytes()[b.Len()-200:]\n    } else {\n        end = b.Bytes()\n    }\n\n    // Get matches. matches[1] contains your number\n    matches := regexpNumber.FindSubmatch(end)\n\n    // Convert bytes to int\n    number, _ := strconv.Atoi(string(matches[1])) // Convert from text to number\n    fmt.Println(number)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1517505796, "creation_date": 1517505796, "answer_id": 48568438, "question_id": 48551651, "link": "https://stackoverflow.com/questions/48551651/isolating-string-output/48568438#48568438", "title": "Isolating String Output", "body": "<p>You can use a bufio.Scanner to read the command's output line-wise. Then just remember the last line and parse it once the command has finished.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    r, w := io.Pipe()\n\n    cmd := exec.Command(\"fortune\")\n    cmd.Stdout = w\n    go func() {\n            cmd.Run()\n            r.Close()\n            w.Close()\n    }()\n\n    sc := bufio.NewScanner(r)\n    var lastLine string\n    for sc.Scan() {\n            line := sc.Text()\n            fmt.Println(\"debug:\", line)\n\n            if strings.TrimSpace(line) != \"\" {\n                    lastLine = line\n            }\n    }\n\n    fmt.Println(lastLine)\n}\n</code></pre>\n\n<p>Sample output:</p>\n\n<pre><code>debug: \"Get back to your stations!\"\ndebug: \"We're beaming down to the planet, sir.\"\ndebug: -- Kirk and Mr. Leslie, \"This Side of Paradise\",\ndebug: stardate 3417.3\nstardate 3417.3\n</code></pre>\n\n<p>Parsing lastLine is left as an excercise for the reader.</p>\n"}], "owner": {"reputation": 95, "user_id": 8697436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da8d3cf70e4890086f8f57ea38ea81b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dangle", "link": "https://stackoverflow.com/users/8697436/dangle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1517555635, "creation_date": 1517433714, "question_id": 48551651, "link": "https://stackoverflow.com/questions/48551651/isolating-string-output", "title": "Isolating String Output", "body": "<p>I currently have a script that performs an os command, that returns a great deal of data, at the end of the data it gives a total such that:</p>\n\n<p>N Total.</p>\n\n<p>N can be any number from 0 upward.</p>\n\n<p>I want to perform this command, and take N then put it into a value.  I have the command running and I'm storing it in a bytes.Buffer, however I'm unsure how to scrape this so that I only get the number.  The \"N Total.\" string is always at the end of the output.  Any help would be appreciated as I've seen various different methods but they all seem quite convoluted.</p>\n"}, {"tags": ["go", "input", "tcp", "infinite-loop"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517431141, "post_id": 48551025, "comment_id": 84098157, "body": "What is <code>a.Run()</code>, why is it deferred, and is it blocking?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517431368, "post_id": 48551025, "comment_id": 84098281, "body": "I don&#39;t think a <code>select</code> will solve your problem, it sounds like you need concurrency, i.e. goroutines."}, {"owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "edited": false, "score": 0, "creation_date": 1517431412, "post_id": 48551025, "comment_id": 84098302, "body": "Sorry, instead of Run it should be Listen. Also, it is deferred because Start  performs some other read/write operations which should be finished before Listen is started. And yes, Listen is blocking."}, {"owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517431464, "post_id": 48551025, "comment_id": 84098325, "body": "@Adrian More explanation or an example would be very helpful!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517431881, "post_id": 48551025, "comment_id": 84098518, "body": "@Ziva: well if <code>Listen</code> is blocking, that means <code>Start</code> is blocking, which means you can&#39;t execute any of the input code. (while not incorrect, it is also strange to unnecessarily defer part of program logic like that)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1517432001, "post_id": 48551025, "comment_id": 84098578, "body": "&quot;how to use concurrency&quot; is probably too broad for SO and also incredibly well-covered by the Go tour, Go documentation, and many resources around the internet."}, {"owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517432514, "post_id": 48551025, "comment_id": 84098831, "body": "@Adrian I&#39;ve read about go concurrency so I know what it is, but I don&#39;t know how to use it in such particular case. Maybe it is enough for my case to just have a start function running Listen and UserReacted as two separate go routines?"}], "owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517431325, "creation_date": 1517430993, "last_edit_date": 1517431325, "question_id": 48551025, "link": "https://stackoverflow.com/questions/48551025/go-allow-for-keyboard-input-while-tcp-listener-is-running", "title": "Go: allow for keyboard input while tcp listener is running", "body": "<p>I'm writing an application which should both <strong>listen for incoming TCP</strong> connections, but also <strong>send TCP packets</strong> when requested. </p>\n\n<p>I have a simple <code>Listen</code> function, which accepts the incoming connections</p>\n\n<pre><code>func (a *App) Listen() {\n    for {\n        conn, err := a.listener.Accept()\n\n        if err != nil {\n            // log error\n        } else {\n            go ProcessConn(conn)\n        }\n    }\n}\n</code></pre>\n\n<p>I also have a Send function which performs the dialing in order to send a TCP packet</p>\n\n<pre><code>func (a *App) Send(message []byte, host string, port string) error {\n\n    conn, err := net.Dial(\"tcp\", host+\":\"+port)\n\n    if err != nil {\n        return err\n    } else {\n        defer conn.Close()\n    }\n\n    _, err = conn.Write(message)\n    return err\n}\n</code></pre>\n\n<p>Now, when I start my app using the Start function it runs an infinite loop (for the listening for incoming connections), so from the perspective of the terminal the program 'freezes' and does not react to any keyboard operations (expect the CTRL-C).</p>\n\n<pre><code>func (a *App) Start() error {\n\n    defer a.Listen()\n\n    // perform some unrelated operations\n\n    return nil\n}\n</code></pre>\n\n<p>However, I would like to improve my app, in such a way, that it can take users (keyboard) input in order to notify my app that it should send a message (I want the users to be able to give the parameters: message and address of the destination.) I was reading about select statement here: <a href=\"https://gobyexample.com/select\" rel=\"nofollow noreferrer\">https://gobyexample.com/select</a>. and wanted to use it for my app. </p>\n\n<p>This is what I wrote based on the example from the go website:</p>\n\n<pre><code>func UserReacted(c2 chan string){\n    for {\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Print(\"Enter text: \")\n        text, _ := reader.ReadString('\\n')\n        c2 &lt;- text\n    }\n}\n\nfunc main() {\n\n    a := NewApp()\n    a.Start()\n\n    c1 := make(chan string)\n    c2 := make(chan string)\n\n    go func() {\n        UserReacted(c2)\n    }()\n\n\n    for {\n        select {\n        case msg2 := &lt;-c2:\n            a.Send() // with some parameters added later\n        default:\n        }\n    }\n    &lt;-finish\n}\n</code></pre>\n\n<p>I understand how the example from the go website works, but I don't know how to use select when one of the function, in my example the Listen function, is not returning any value. I will be very grateful for any advice or example how to do it properly. </p>\n"}, {"tags": ["go", "memory", "methods", "struct", "copy"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517426954, "post_id": 48549995, "comment_id": 84095971, "body": "you mean <code>copy()</code>? You have a single slice, just need to copy it."}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517427262, "post_id": 48549995, "comment_id": 84096162, "body": "It&#39;s not a slice, it&#39;s a struct. Forgot to include the BuildMatrix function, but basically it creates a Matrix with the given rows."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517427268, "post_id": 48549995, "comment_id": 84096167, "body": "<code>BuildMatrix</code> is not shown in the code, but assuming it returns a pointer, then <code>matA</code> and <code>matB</code> are both pointers to the same object. It&#39;s not so much that the changes are &quot;mirrored&quot; as that they&#39;re two references to the exact same object."}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517427468, "post_id": 48549995, "comment_id": 84096275, "body": "Edited the code to include the header of the function. <code>BuildMatrix</code> does not return a pointer. In fact, <code>matA</code> and <code>matB</code> are in different memory locations."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517428113, "post_id": 48549995, "comment_id": 84096604, "body": "@mariohm1311: <code>Matrix.mat</code> is a slice, and you need to copy that slice."}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517429322, "post_id": 48549995, "comment_id": 84097217, "body": "That&#39;s not the solution apparently, just tested it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517430941, "post_id": 48549995, "comment_id": 84098049, "body": "@mariohm1311: what isn&#39;t the solution? The values are changing in both because it&#39;s the same backing array for the slice. If copying the slice still doesn&#39;t work, you need to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> showing the problem."}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517432200, "post_id": 48549995, "comment_id": 84098670, "body": "Sorry about that, you&#39;re right."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517428547, "post_id": 48550286, "comment_id": 84096818, "body": "Oh, gotcha. Coming from a high-level language, these things keep getting me... Is there any way to avoid having to manually copy every time?"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "reply_to_user": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517428753, "post_id": 48550286, "comment_id": 84096939, "body": "Not that I&#39;m aware of"}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517429090, "post_id": 48550286, "comment_id": 84097094, "body": "Just tested it, it is not solving the problem. The problem is laying somewhere related to this, but it&#39;s not a matter of copying the slices."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1517443207, "last_edit_date": 1592644375, "creation_date": 1517428028, "answer_id": 48550286, "question_id": 48549995, "link": "https://stackoverflow.com/questions/48549995/methods-application-on-copy-of-struct-is-mirrored-in-original-struct/48550286#48550286", "title": "Method&#39;s application on copy of struct is mirrored in original struct", "body": "<p><code>matA.mat</code> and <code>matB.mat</code> both point to the same location.</p>\n<blockquote>\n<p>A slice is a descriptor of an array segment. It consists of a pointer to the array, the length of the segment, and its capacity (the maximum length of the segment).</p>\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n</blockquote>\n<p>When you copy the struct, the copied struct contains a copy of the pointer (which points to the same array segment).</p>\n<p>See <a href=\"https://play.golang.org/p/KUWq-dnGMRl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KUWq-dnGMRl</a></p>\n<p>You need to do</p>\n<pre><code>matB.mat = make([]float64, len(matA.mat))\ncopy(matB.mat, matA.mat)\n</code></pre>\n<p><a href=\"https://play.golang.org/p/ZlmFT8toj6A\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZlmFT8toj6A</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 1, "closed_date": 1517432023, "answer_count": 1, "score": -2, "last_activity_date": 1517443207, "creation_date": 1517426859, "last_edit_date": 1517429462, "question_id": 48549995, "link": "https://stackoverflow.com/questions/48549995/methods-application-on-copy-of-struct-is-mirrored-in-original-struct", "closed_reason": "Duplicate", "title": "Method&#39;s application on copy of struct is mirrored in original struct", "body": "<p>I have been playing around with methods in Go by building a small linear algebra library, but I have run into a problem with the following piece of code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Matrix struct {\n    mat    []float64\n    nR, nC int\n}\n\nfunc (m Matrix) String() string { ... }\n\n// EmptyMatrix initializes a nR*nC matrix to 0\nfunc EmptyMatrix(nR, nC int) Matrix { ... }\n\n// BuildMatrix creates a matrix build by its rows, and returns a Matrix\nfunc BuildMatrix(rows ...[]float64) Matrix { ... }\n\n// Set sets the value of mat[i,j] to val\nfunc (m *Matrix) Set(i, j int, val float64) {\n    if (i &lt; m.nR) &amp;&amp; (j &lt; m.nC) {\n        m.mat[i*m.nC+j] = val\n    } else {\n        panic(fmt.Sprintf(\"Index (%d,%d) out of range (0:%d,0:%d)\",\n                          i, j, m.nR, m.nC))\n    }\n}\n\nfunc main() {\n    matA := matrix.BuildMatrix([]float64{2, 3}, []float64{4, -5})\n    matB := matA\n    fmt.Println(matA)\n    matB.Set(1,1,2)\n    fmt.Println(matA)\n    fmt.Printf(\"%p\\n%p\\n\",&amp;matA,&amp;matB)\n}\n</code></pre>\n\n<p>When ran, this is the output:</p>\n\n<pre><code>[ [ 2.00 3.00 ]\n  [ 4.00 -5.00 ] ]\n[ [ 2.00 3.00 ]\n  [ 4.00 2.00 ] ]\n0xc04207c060\n0xc04207c090\n</code></pre>\n\n<p>If I change a value in <code>matB</code>, the change is mirrored in <code>matA</code>, which is not what I want. In Python I would have made a deep copy of <code>matA</code> to start with, but I haven't found any standard Go implementation of Python's <code>copy.deepcopy()</code>function. How should I go about solving it?</p>\n\n<p>TESTED SOLUTIONS:</p>\n\n<ol>\n<li><code>Matrix.mat</code> is indeed a slice, and I should be copying with <code>copy(matB.mat, matA.mat</code>. However, this is not the only problem, since it's still doing the same thing.</li>\n</ol>\n"}, {"tags": ["list", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517426894, "post_id": 48549979, "comment_id": 84095937, "body": "Yes, you need to loop -- <code>l2 in l1</code> is just hiding the loops from you."}, {"owner": {"reputation": 20930, "user_id": 6881240, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dc1e27d7e9a3de2ca8e257cb7c72ff4a?s=128&d=identicon&r=PG&f=1", "display_name": "kabanus", "link": "https://stackoverflow.com/users/6881240/kabanus"}, "edited": false, "score": 2, "creation_date": 1517427028, "post_id": 48549979, "comment_id": 84096012, "body": "How do define <code>in</code>? same order? order doesn&#39;t matter?"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1517427159, "post_id": 48549979, "comment_id": 84096104, "body": "Order doesn&#39;t matter in this case"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 1, "creation_date": 1517427284, "post_id": 48549979, "comment_id": 84096171, "body": "If order does not matter then it is a problem of set containing another set."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517428452, "post_id": 48549979, "comment_id": 84096774, "body": "If order doesn&#39;t matter, it&#39;s not the same as Python&#39;s <code>in</code>, because <code>[&#39;a&#39;, &#39;c&#39;] in [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code> is <code>False</code>"}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1517461506, "post_id": 48549979, "comment_id": 84107449, "body": "Can you provide some examples or Python code that clarifies your question? What if <code>l1 = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> and <code>2 = [&quot;a&quot;,&quot;a&quot;,&quot;c&quot;]</code> does is l1 still contain in l2?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1517463796, "post_id": 48549979, "comment_id": 84108166, "body": "I haven&#39;t looked but isn&#39;t there some stuff with reflect and unsafe that would just let you look at the slice pointer and see if it&#39;s off the same array? I mean, when I read the question title here, that&#39;s what I think of, although the rest of the question seems to be set intersection."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1518120777, "post_id": 48549979, "comment_id": 84386450, "body": "@ZanLynx: you don&#39;t need unsafe, you get the array address via <code>&amp;a[0]</code>."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518142991, "post_id": 48549979, "comment_id": 84394358, "body": "@JimB: That won&#39;t tell you if it is pointing into the same backing array if someone made a slice with a new start index."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1518143330, "post_id": 48549979, "comment_id": 84394444, "body": "@ZanLynx, it\u2019s the same address that\u2019s stored in the slice header. You can check if the address is between the start address and last address if you want to know if they have overlapping arrays (which may or may not be more clear using the unsafe package, I\u2019d type it out both ways to see)"}], "answers": [{"tags": [], "owner": {"reputation": 20930, "user_id": 6881240, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dc1e27d7e9a3de2ca8e257cb7c72ff4a?s=128&d=identicon&r=PG&f=1", "display_name": "kabanus", "link": "https://stackoverflow.com/users/6881240/kabanus"}, "is_accepted": true, "score": 3, "last_activity_date": 1517427571, "creation_date": 1517427571, "answer_id": 48550168, "question_id": 48549979, "link": "https://stackoverflow.com/questions/48549979/how-to-check-if-a-slice-is-inside-a-slice-in-go/48550168#48550168", "title": "How to check if a slice is inside a slice in GO?", "body": "<p>Following from <a href=\"https://stackoverflow.com/questions/48549979/how-to-check-if-a-slice-is-inside-a-slice-in-go?noredirect=1#comment84096020_48549979\">How to check if a slice is inside a slice in GO?</a>, @Mostafa posted the following for checking if an element is in a slice:</p>\n\n<pre><code>func contains(s []string, e string) bool {\n   for _, a := range s {\n        if a == e {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>Now it's a matter of checking element by element:</p>\n\n<pre><code>func subslice (s1 []string, s2 []string) bool {\n    if len(s1) &gt; len(s2) { return false }\n    for _, e := range s1 {\n        if ! contains(s2,e) {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>Of course, this ignores duplicates, so there's room for improvement.</p>\n"}, {"comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1517492779, "post_id": 48555999, "comment_id": 84124217, "body": "Please add time and memory complexity of your algorithm for comparison."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1517463338, "creation_date": 1517463338, "answer_id": 48555999, "question_id": 48549979, "link": "https://stackoverflow.com/questions/48549979/how-to-check-if-a-slice-is-inside-a-slice-in-go/48555999#48555999", "title": "How to check if a slice is inside a slice in GO?", "body": "<p>@Kabanus's answer is of O(mn) time complexity. Despite being slow in large scale, it only requires elemenent of both set to be <code>==</code> comparable, which is almost any cases.</p>\n\n<p>But if your data is hashable, and preferably hashable by default (i.e. can be used as key of a <code>map</code>), using an auxiliary map is a much more efficient way:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Universe map[string]bool\n\nfunc NewUniverse(s []string) Universe {\n    u:=make(Universe)\n    for _,i:=range s {\n        u[i]=true\n    }\n    return u\n}\n\nfunc (u Universe) CountainSet(s []string) bool {\n    for _,i:=range s {\n        if !u[i] {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Println(NewUniverse([]string{\"a\",\"b\",\"c\"}).CountainSet([]string{\"a\",\"c\"}))\n}\n</code></pre>\n\n<p>Dealing with duplicate is very trivial: change map[string]bool to map[string]int and compare element count.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pdM4DO3UO2e\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pdM4DO3UO2e</a></p>\n"}, {"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 1, "last_activity_date": 1517546419, "last_edit_date": 1517546419, "creation_date": 1517502878, "answer_id": 48567556, "question_id": 48549979, "link": "https://stackoverflow.com/questions/48549979/how-to-check-if-a-slice-is-inside-a-slice-in-go/48567556#48567556", "title": "How to check if a slice is inside a slice in GO?", "body": "<p>It appears that you are looking for set issubset:</p>\n\n<p>In Python it would look like this:</p>\n\n<pre><code>In [1]: l1 = [\"a\", \"b\", \"c\"]\n\nIn [2]: l2 = [\"a\", \"c\"]\n\nIn [3]: set(l2).issubset(l1)\nOut[3]: True\n</code></pre>\n\n<p>The most similar version of this in go uses <a href=\"https://github.com/deckarep/golang-set\" rel=\"nofollow noreferrer\">golang-set</a> and looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/deckarep/golang-set\"\n)\n\nfunc sliceToSet(mySlice []string) mapset.Set {\n    mySet := mapset.NewSet()\n    for _, ele := range mySlice {\n        mySet.Add(ele)\n    }   \n    return mySet\n}\n\nfunc main() {\n\n    l1 := []string{\"a\", \"b\", \"c\"}\n    l2 := []string{\"a\", \"c\"}\n\n    s1 := sliceToSet(l1)\n    s2 := sliceToSet(l2)\n\n    result := s2.IsSubset(s1)\n\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>The time complexity of above approach is linear time. The time complexity of issubset itself is O(n), where n is length of a set we are checking if subset, in this case <code>s2</code>. There is also conversion from slice to set that is also linear time.</p>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1512, "favorite_count": 0, "accepted_answer_id": 48550168, "answer_count": 3, "score": 2, "last_activity_date": 1517546419, "creation_date": 1517426791, "question_id": 48549979, "link": "https://stackoverflow.com/questions/48549979/how-to-check-if-a-slice-is-inside-a-slice-in-go", "title": "How to check if a slice is inside a slice in GO?", "body": "<p>I  have the following code:</p>\n\n<pre><code>func main(){\n    l1 := []string{\"a\", \"b\", \"c\"}\n    l2 := []string {\"a\", \"c\"}\n    //l2 in l1?\n}\n</code></pre>\n\n<p>I can check this using loops and flags but Is there a simple way to check if l2 is inside l1 like python command \"l2 in l1\"?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 919, "user_id": 1043674, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/0090f1f22a03e38ca61dc955e1d0a346?s=128&d=identicon&r=PG", "display_name": "Jon Chan", "link": "https://stackoverflow.com/users/1043674/jon-chan"}, "is_accepted": false, "score": 0, "last_activity_date": 1517604845, "creation_date": 1517604845, "answer_id": 48590735, "question_id": 48549855, "link": "https://stackoverflow.com/questions/48549855/how-to-construct-subquery-in-the-form-of-select-from-subquery-order-by-col/48590735#48590735", "title": "How to construct subquery in the form of SELECT * FROM (&lt;subquery&gt;) ORDER BY column;?", "body": "<p>If you want to write raw SQL (including one that has a SQL subquery) that will be executed and the results added to an object using gorm, you can use the <code>.Raw()</code> and <code>.Scan()</code> methods:</p>\n\n<pre><code>query := `\n    SELECT sub.*\n    FROM (&lt;subquery&gt;) sub\n    ORDER BY sub.column;`\ndb.Raw(query).Scan(&amp;result)\n</code></pre>\n\n<p>You pass a pointer reference to an object to <code>.Scan()</code> that is structured like the resulting rows, very similarly to how you would use <code>.First()</code>. <code>.Raw()</code> can also have data added to the query using <code>?</code> in the query and adding the values as comma separated inputs to the function:</p>\n\n<pre><code>query := `\n    SELECT sub.*\n    FROM (&lt;subquery&gt;) sub\n    WHERE\n        sub.column1 = ?\n        AND sub.column2 = ?\n    ORDER BY sub.column;`\ndb.Raw(query, val1, val2).Scan(&amp;result)\n</code></pre>\n\n<p>For more information on how to use the SQL builder, <code>.Raw()</code>, and <code>.Scan()</code> take a look at the examples in the documentation: <a href=\"http://gorm.io/advanced.html#sql-builder\" rel=\"nofollow noreferrer\">http://gorm.io/advanced.html#sql-builder</a></p>\n"}], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 777, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517604845, "creation_date": 1517426321, "question_id": 48549855, "link": "https://stackoverflow.com/questions/48549855/how-to-construct-subquery-in-the-form-of-select-from-subquery-order-by-col", "title": "How to construct subquery in the form of SELECT * FROM (&lt;subquery&gt;) ORDER BY column;?", "body": "<p>I am using gorm to interact with a postgres database. I'm trying to ORDER BY a query that uses DISTINCT ON and <a href=\"https://stackoverflow.com/questions/9795660/postgresql-distinct-on-with-different-order-by\">this question</a> documents how it's not that easy to do that. So I need to end up with a query in the form of</p>\n\n<pre><code> SELECT * FROM (&lt;subquery&gt;) ORDER BY column;\n</code></pre>\n\n<p>At first glance it looks like I need to use <code>db.QueryExpr()</code> to turn the query I have into an expression and build another query around it. However it doesn't seem gorm has an easy way to directly specify the FROM clause. I tried using <code>db.Model(expr)</code> or <code>db.Table(fmt.Sprint(expr))</code> but Model seems to be completely ignored and <code>fmt.Sprint(expr)</code> doesn't return exactly what I thought. Expressions contain a few private variables. If I could turn the original query into a completely parsed string then I could use <code>db.Table(query)</code> but I'm not sure if I can generate the query as a string without running it.</p>\n\n<p>If I have a fully built gorm query, how can I wrap it in another query to do the ORDER BY I'm trying to do?</p>\n"}, {"tags": ["go", "deadlock"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517422888, "post_id": 48548928, "comment_id": 84093816, "body": "No, that is not computable in general. I&#39;m not aware of any static analysis tools to detect this very specific case you&#39;ve shown. It would be extremely unlikely to have a send on a channel and no receives on that channel anywhere in the program."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517424011, "post_id": 48548928, "comment_id": 84094426, "body": "I&#39;m pretty sure this is a special case of the <a href=\"https://en.wikipedia.org/wiki/Halting_problem\" rel=\"nofollow noreferrer\">Halting Problem</a>. Which is to say, there is no programmatic way to detect or predict a deadlock."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517424049, "post_id": 48548928, "comment_id": 84094446, "body": "Elaborating on the situation a bit: How would you distinguish between a deadlock, and waiting for user input, or some other I/O operation? From the goroutine&#39;s perspective, there&#39;s no difference, as far as I can tell."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1517422925, "creation_date": 1517422925, "answer_id": 48548983, "question_id": 48548928, "link": "https://stackoverflow.com/questions/48548928/detect-deadlock-between-a-group-of-goroutines/48548983#48548983", "title": "Detect deadlock between a group of goroutines", "body": "<p><a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">pprof</a> allows you to get a full goroutine stack dump at runtime, which will show you what goroutines are blocked and why. This isn't exactly what you describe, but it's enough information to see when a partial deadlock occurs. It also includes a dedicated block profiler for monitoring blocked goroutines.</p>\n"}], "owner": {"reputation": 1237, "user_id": 3998718, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/61af86922698a8cd422f77ae2343d2a5?s=128&d=identicon&r=PG&f=1", "display_name": "kptlronyttcna", "link": "https://stackoverflow.com/users/3998718/kptlronyttcna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 982, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1517422925, "creation_date": 1517422720, "question_id": 48548928, "link": "https://stackoverflow.com/questions/48548928/detect-deadlock-between-a-group-of-goroutines", "title": "Detect deadlock between a group of goroutines", "body": "<p>Golang can detect deadlocks when all goroutines are stuck. But is it possible to detect if a group of goroutines are stuck? For example in the following code goroutine 1 and 2 will be in a deadlock but the program continues working because the main goroutine is not stuck. My question is how can I detect that goroutine 1 and 2 as a group are in a deadlock because all members of the group are stuck?</p>\n\n<pre><code>func main() {\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n\n    // goroutine 1\n    go func() {\n        ch1 &lt;- 12\n        ch2 &lt;- 13 // oh oh, wrong channel. deadlock between goroutine 1 and 2\n    }()\n\n    // goroutine 2\n    go func() {\n        println(&lt;-ch1)\n        println(&lt;-ch1)\n    }()\n\n    for {\n        // i'm busy\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "nested-sets"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1517421819, "post_id": 48548620, "comment_id": 84093199, "body": "Please show what you tried. Also, the desired structure based on the field values isn&#39;t clear, what are <code>Left</code>, <code>Right</code>, and <code>Level</code> and how are they used to build the tree?"}, {"owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517422041, "post_id": 48548620, "comment_id": 84093358, "body": "I&#39;ve tried re-implementing this, in go: <a href=\"https://stackoverflow.com/questions/16999530/how-do-i-format-nested-set-model-data-into-an-array\" title=\"how do i format nested set model data into an array\">stackoverflow.com/questions/16999530/&hellip;</a>  Left, Right and Level come from a database (not mine) and are the normal nested set values."}, {"owner": {"reputation": 3547, "user_id": 546750, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5e663c9fc0ebe46af81b8a49d5e2aa91?s=128&d=identicon&r=PG", "display_name": "ahmy", "link": "https://stackoverflow.com/users/546750/ahmy"}, "edited": false, "score": 0, "creation_date": 1517428608, "post_id": 48548620, "comment_id": 84096863, "body": "The link that you&#39;ve provided already contains a recursive solution, you just need to translate that in go. And like Marc mention, it&#39;s easier to help if you showed us what you tried."}, {"owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "edited": false, "score": 0, "creation_date": 1517475854, "post_id": 48548620, "comment_id": 84113368, "body": "I&#39;ve tried to tidy up my example, and given an idea of what i&#39;m trying here: <a href=\"https://play.golang.org/p/oKWo21lu__7\" rel=\"nofollow noreferrer\">play.golang.org/p/oKWo21lu__7</a>  The problem here is it never gets past the first nested level, and i&#39;m unsure why. The data is sorted in level order from the database."}], "answers": [{"tags": [], "owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "is_accepted": false, "score": 0, "last_activity_date": 1517479435, "creation_date": 1517479435, "answer_id": 48560001, "question_id": 48548620, "link": "https://stackoverflow.com/questions/48548620/flat-nested-set-to-nested-structs-in-go/48560001#48560001", "title": "Flat nested set to nested structs in Go", "body": "<p>As it turns out, I needed to use pointers to hold the child entries. The following setup works:</p>\n\n<pre><code>type TreeEntry struct {\n    Id       int64        `db:\"elementId\" json:\"id\"`\n    Slug     string       `db:\"slug\" json:\"slug\"`\n    Title    string       `db:\"title\" json:\"title\"`\n    Left     int          `db:\"lft\" json:\"-\"`\n    Right    int          `db:\"rgt\" json:\"-\"`\n    Level    int          `db:\"level\" json:\"-\"`\n    Children []*TreeEntry `json:\"children\"`\n}\n\nfunc (t *TreeEntry) AddNestedChild(newEntry TreeEntry) {\n    // If this child is one level below the current node, just add it here for now\n    if newEntry.Level == t.Level+1 {\n        t.Children = append(t.Children, &amp;newEntry)\n    } else {\n        // Loop through the children and see if it fits anywhere\n        for _, child := range t.Children {\n            if newEntry.Left &gt; child.Left &amp;&amp; newEntry.Right &lt; child.Right {\n                child.AddNestedChild(newEntry)\n                break\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 608, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1517479435, "creation_date": 1517421594, "last_edit_date": 1517476620, "question_id": 48548620, "link": "https://stackoverflow.com/questions/48548620/flat-nested-set-to-nested-structs-in-go", "title": "Flat nested set to nested structs in Go", "body": "<p>Maybe its just late in the day and this is making my brain melt. </p>\n\n<p>I'm trying to convert a flat list of nested sets into a multi-dimensional nested array.</p>\n\n<p>I have a bunch of structured CMS entries as follows:</p>\n\n<pre><code>entries := []TreeEntry{\n        {\n            Slug:  \"about-us\",\n            Title: \"About us\",\n            Left:  2,\n            Right: 11,\n            Level: 1,\n        },\n        {\n            Slug:  \"more-about-us\",\n            Title: \"More about us\",\n            Left:  3,\n            Right: 6,\n            Level: 2,\n        },\n        {\n            Slug:  \"even-more-about-us\",\n            Title: \"Even more about us\",\n            Left:  4,\n            Right: 5,\n            Level: 3,\n        },\n        {\n            Slug:  \"contact-us\",\n            Title: \"Contact us\",\n            Left:  2,\n            Right: 7,\n            Level: 1,\n        },\n    }\n</code></pre>\n\n<p>And I want to unflatten them as follows:</p>\n\n<pre><code>entries := []TreeEntry{\n        {\n            Slug:  \"about-us\",\n            Title: \"About us\",\n            Left:  2,\n            Right: 11,\n            Level: 1,\n            Children: []TreeEntry{\n                {\n                    Slug:  \"more-about-us\",\n                    Title: \"More about us\",\n                    Left:  3,\n                    Right: 6,\n                    Level: 2,\n                    Children: []TreeEntry{\n                        {\n                            Slug:  \"even-more-about-us\",\n                            Title: \"Even more about us\",\n                            Left:  4,\n                            Right: 5,\n                            Level: 3,\n                        },\n                    },\n                },\n            },\n        },\n        {\n            Slug:  \"contact-us\",\n            Title: \"Contact us\",\n            Left:  2,\n            Right: 7,\n            Level: 1,\n        },\n    }\n</code></pre>\n\n<p>The aim here is ultimately to return a menu structure with the slugs contact'ed together as appropriate, but some reason, I just cannot get my head around achieving this in Go.</p>\n\n<p>Can anybody point me in the correct direction?</p>\n\n<p>Edit: Added non-working example of what I've attempted:</p>\n\n<p><a href=\"https://play.golang.org/p/oKWo21lu__7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oKWo21lu__7</a></p>\n\n<p>The results never add below the first level.</p>\n\n<p>Thanks,\nJ</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 1654, "user_id": 3128177, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8edafe4e6093864c46e71839232b06df?s=128&d=identicon&r=PG", "display_name": "nmiculinic", "link": "https://stackoverflow.com/users/3128177/nmiculinic"}, "reply_to_user": {"reputation": 14890, "user_id": 196106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f52d53d58164becbc50b547eb83ffb1a?s=128&d=identicon&r=PG", "display_name": "Ragnis", "link": "https://stackoverflow.com/users/196106/ragnis"}, "edited": false, "score": 2, "creation_date": 1517425955, "post_id": 48547447, "comment_id": 84095466, "body": "Yes I asked the question, and than found the solution couple hours later"}], "tags": [], "owner": {"reputation": 1654, "user_id": 3128177, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8edafe4e6093864c46e71839232b06df?s=128&d=identicon&r=PG", "display_name": "nmiculinic", "link": "https://stackoverflow.com/users/3128177/nmiculinic"}, "is_accepted": false, "score": 6, "last_activity_date": 1517417700, "creation_date": 1517417700, "answer_id": 48547447, "question_id": 48547280, "link": "https://stackoverflow.com/questions/48547280/how-to-get-slice-of-concrete-type-not-pointers-in-go-protobuff/48547447#48547447", "title": "How to get slice of concrete type (not pointers) in go protobuff", "body": "<p>I needed to use: [(gogoproto.nullable) = false]\nas in:</p>\n\n<pre><code>repeated PutRequest l = 3 [(gogoproto.nullable) = false];\n</code></pre>\n\n<p>And got:</p>\n\n<pre><code>    L     []PutRequest `protobuf:\"bytes,3,rep,name=l\" json:\"l\"`\n</code></pre>\n"}], "owner": {"reputation": 1654, "user_id": 3128177, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8edafe4e6093864c46e71839232b06df?s=128&d=identicon&r=PG", "display_name": "nmiculinic", "link": "https://stackoverflow.com/users/3128177/nmiculinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 671, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1517419947, "creation_date": 1517417286, "last_edit_date": 1517419947, "question_id": 48547280, "link": "https://stackoverflow.com/questions/48547280/how-to-get-slice-of-concrete-type-not-pointers-in-go-protobuff", "title": "How to get slice of concrete type (not pointers) in go protobuff", "body": "<p>For protofile:</p>\n\n<pre><code>syntax = \"proto3\";\npackage messagepb;\n\nimport \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\n\noption (gogoproto.marshaler_all) = true;\noption (gogoproto.sizer_all) = true;\noption (gogoproto.unmarshaler_all) = true;\noption (gogoproto.goproto_getters_all) = false;\n\nservice KV {\n  // Put puts the given key into the store.\n  // A put request increases the revision of the store,\n  // and generates one event in the event history.\n  rpc Put(PutRequest) returns (PutResponse) {}\n}\n\nmessage PutRequest {\n  bytes key = 1;\n  bytes value = 2;\n}\n\nmessage ResponseHeader {\n  repeated PutRequest l = 3;\n}\n</code></pre>\n\n<p>I get the following proto struct:</p>\n\n<pre><code>type ResponseHeader struct {\n    L     []*PutRequest `protobuf:\"bytes,3,rep,name=l\" json:\"l,omitempty\"`\n}\n</code></pre>\n\n<p>But how do I get following protostruct:</p>\n\n<pre><code>type ResponseHeader struct {\n    L     []PutRequest `protobuf:\"bytes,3,rep,name=l\" json:\"l,omitempty\"`\n}\n</code></pre>\n\n<p>That is I want having data locality (and thus slices of contig data, not pointers to spread out stuff)</p>\n"}, {"tags": ["go", "aws-codebuild"], "comments": [{"owner": {"reputation": 22932, "user_id": 793454, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/d2f7eec19f8c465b7515e234f8110899?s=128&d=identicon&r=PG", "display_name": "Homan", "link": "https://stackoverflow.com/users/793454/homan"}, "edited": false, "score": 0, "creation_date": 1520406527, "post_id": 48544843, "comment_id": 85296805, "body": "I have the same problem.  I&#39;m using AWS code pipeline to build a Go application but it seems that AWS Codebuilds that use Code Pipeline as a source lose their credentials for connecting to github.  Were you able to find a work around?"}], "owner": {"reputation": 232, "user_id": 3256535, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/OVXQ3.jpg?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/3256535/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 465, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1517409815, "creation_date": 1517409815, "question_id": 48544843, "link": "https://stackoverflow.com/questions/48544843/aws-codebuild-unable-to-go-get-a-package", "title": "AWS CodeBuild Unable to &quot;go get&quot; a package", "body": "<p>I have an AWS CodeBuild job, defined with the following buildspec file (apologies if indentation isn't reproduced correctly):</p>\n\n<pre><code>version: 0.2\nenv:\n  variables:\n      PACKAGE: \"github.com/user/package\" \nphases:\n  install: \n      commands:\n          - mkdir -p ${GOPATH}/src/${PACKAGE}\n          - cp -a ${CODEBUILD_SRC_DIR}/.  ${GOPATH}/src/${PACKAGE}\n          - cd ${GOPATH}/src/${PACKAGE} &amp;&amp; go get ./...\nbuild:\n     commands:\n          - cd ${GOPATH}/src/${PACKAGE} &amp;&amp; go build -o ${CODEBUILD_SRC_DIR}/application\npost_build:\n    commands:\n      - aws cloudformation package --template-file template.yml --output-template-file serverless.yml --s3-bucket some-bucket\nartifacts:\n  files:\n    - serverless.yml\n</code></pre>\n\n<p>This fails in the install phase.</p>\n\n<p>The go application I'm trying to build has several sub-packages and external dependencies.  When running \"go get ./...\" I'm getting </p>\n\n<pre><code>cannot find package github.com/user/package/sub-package in any of:\n/usr/local/go/src/github.com/user/package/sub-package(from $GOROOT) /go/src/github.com/user/package/sub-package(from $GOPATH) /codebuild/output/src708017258/src/github.com/user/package/sub-package\n</code></pre>\n\n<p>When \"debugging\" (by putting in some echos and listing the contents of the newley created folders) it <em>appears</em> that everything is in the right place and everything should just work.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1517408975, "post_id": 48544535, "comment_id": 84084310, "body": "Maybe we can see the struct you are using to unmarshal(?) json?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517409064, "post_id": 48544535, "comment_id": 84084374, "body": "Unmarshal to <code>map[string]interface{}</code> and bind the struct manually would solve both problem."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1517413298, "post_id": 48544535, "comment_id": 84087547, "body": "@vahdet Sorry, but I can&#39;t understand why that would help to solve the problems."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517413342, "post_id": 48544535, "comment_id": 84087581, "body": "@leafbebop Thanks, but that would but I would end up with even more boilerplate code."}, {"owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "edited": false, "score": 0, "creation_date": 1517416093, "post_id": 48544535, "comment_id": 84089519, "body": "Are you maybe looking for <code>omitempty</code>? <a href=\"https://stackoverflow.com/questions/24216510/empty-or-not-required-struct-fields-in-golang\" title=\"empty or not required struct fields in golang\">stackoverflow.com/questions/24216510/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "edited": false, "score": 0, "creation_date": 1517416727, "post_id": 48544535, "comment_id": 84089989, "body": "@JackGore No, is the question not clear?"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1517420225, "creation_date": 1517420225, "answer_id": 48548240, "question_id": 48544535, "link": "https://stackoverflow.com/questions/48544535/strict-json-parsing-in-go/48548240#48548240", "title": "Strict JSON parsing in Go", "body": "<p>You may look at what there is available to implement\nso-called \"<a href=\"https://en.wikipedia.org/wiki/JSON#JSON_Schema\" rel=\"nofollow noreferrer\">JSON schema</a> validation\".</p>\n\n<p>You may start with <a href=\"https://godoc.org/?q=json+schema\" rel=\"nofollow noreferrer\">this search</a>\nwhich yields <a href=\"https://godoc.org/github.com/juju/gojsonschema\" rel=\"nofollow noreferrer\"><code>github.com/juju/gojsonschema</code></a> among others;\nwhile I have no idea about its quality, it's used as part of\nUbuntu's Juju cloud orchestration solution so I'd expect it\nto be battle tested. Still, caveat emptor.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 356, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1517420225, "creation_date": 1517408832, "question_id": 48544535, "link": "https://stackoverflow.com/questions/48544535/strict-json-parsing-in-go", "title": "Strict JSON parsing in Go", "body": "<p>The <code>encoding/json</code> exposes a forgiving parser. Every not present property is simply set to its default value. Is there a better way to make a field required than using bulky <code>switch</code> statments and check every field for its default value? Another problem is that not all default types are <code>nil</code>. Is there another way to distinguish between than a not set field and e.g. 0 other than using pointers to be able to check against <code>nil</code>?</p>\n"}, {"tags": ["for-loop", "go", "concurrency", "range", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 2144, "user_id": 1143357, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8aebc0e3ebfeb4bebe9d20140d373a27?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1143357/chris"}, "edited": false, "score": 0, "creation_date": 1517478124, "post_id": 48544134, "comment_id": 84114683, "body": "Thanks for the explanation and tips!"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1517411049, "last_edit_date": 1517411049, "creation_date": 1517407682, "answer_id": 48544134, "question_id": 48544050, "link": "https://stackoverflow.com/questions/48544050/why-do-i-need-to-do-an-additional-for-loop-over-the-results-of-my-go-routine-cha/48544134#48544134", "title": "Why do I need to do an additional for loop over the results of my go routine/channel to display all results?", "body": "<p>The <code>&lt;-channel</code> operator consumes a single element from a channel. If you want to keep reading until the channel is closed, you need to range over it.</p>\n\n<p>However, you need to range over the channel itself, not <code>db.Feeds</code>:</p>\n\n<pre><code>for newFeed := range rss {\n    fmt.Println(newFeed.Channel.Title, newFeed.Channel.Description)\n}\n</code></pre>\n\n<p>Technically, repeating the read <code>newFeed := &lt;-rss</code> multiple times is what is really working.</p>\n\n<p>Currently, this only works because you have the same number of feeds as you have elements written to <code>rss</code>. If instead the number of elements did not match, you would either exit before reading all elements, or wait for more when there are no more coming.</p>\n\n<p>You'll also want some type of coordination to make sure you close the <code>rss</code> channel when all <code>getFeeds</code> functions are done.</p>\n\n<p>I strongly recommend you take the Go tour, especially the <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">concurrency section</a></p>\n"}], "owner": {"reputation": 2144, "user_id": 1143357, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8aebc0e3ebfeb4bebe9d20140d373a27?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1143357/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48544134, "answer_count": 1, "score": 0, "last_activity_date": 1517411049, "creation_date": 1517407458, "question_id": 48544050, "link": "https://stackoverflow.com/questions/48544050/why-do-i-need-to-do-an-additional-for-loop-over-the-results-of-my-go-routine-cha", "title": "Why do I need to do an additional for loop over the results of my go routine/channel to display all results?", "body": "<p>A quick explanation of the code:</p>\n\n<ul>\n<li>I'm ranging over <code>db.Feeds()</code> which is a list of RSS feed urls.</li>\n<li>I'm getting the feeds in the <code>getFeeds()</code> function via a goroutine</li>\n<li>The output of <code>getFeeds()</code> is returned into the rss channel</li>\n<li><p>I then print the RSS information</p>\n\n<pre><code>func main() {\n    rss := make(chan feed)\n\n    for _, url := range db.Feeds() {\n        go getFeeds(url, rss)\n    }\n\n    for range db.Feeds() {\n        newFeed := &lt;-rss\n        fmt.Println(newFeed.Channel.Title, newFeed.Channel.Description)\n    }\n}\n</code></pre></li>\n</ul>\n\n<p>My question is as follows: When I directly print the newFeed variable it doesn't display all results from the rss channel, only the first one.</p>\n\n<p>I seem to have to range over <code>db.Feeds()</code> (the list of RSS feed urls) and print the channel results from the for loop containing the go <code>getFeeds()</code> for it to display all the results.</p>\n\n<p>Why is this the case? I would have though for each loop of the range, it would return into the rss channel and print the results without having to range over <code>db.Feeds()</code> a second time?</p>\n\n<p>Any clarification greatly helped, I'm new to Go! Loving it, but not got my head around some aspects of the language yet.</p>\n"}, {"tags": ["go", "cross-platform", "header-files", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517404894, "post_id": 48543104, "comment_id": 84081366, "body": "AFAIK, MSVC is not supported."}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517405703, "post_id": 48543104, "comment_id": 84081927, "body": "@JimB I&#39;ve managed to compile this with MinGW after some editing, but now I have a bunch of linking errors trying to link DLL compiled with MinGW from MSVC."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517415487, "post_id": 48543104, "comment_id": 84089076, "body": "Sorry, I&#39;m not familiar with MSVC at all. I think since it&#39;s not a supported target, you may need to create an appropriate header yourself."}], "owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517416174, "creation_date": 1517404485, "last_edit_date": 1517416174, "question_id": 48543104, "link": "https://stackoverflow.com/questions/48543104/is-it-possible-to-make-cgo-generate-cross-platform-headers", "title": "Is it possible to make CGO generate cross-platform headers?", "body": "<p>This is the prologue of the header CGO generated:</p>\n\n<pre><code>#ifndef GO_CGO_PROLOGUE_H\n#define GO_CGO_PROLOGUE_H\n\ntypedef signed char GoInt8;\ntypedef unsigned char GoUint8;\ntypedef short GoInt16;\ntypedef unsigned short GoUint16;\ntypedef int GoInt32;\ntypedef unsigned int GoUint32;\ntypedef long long GoInt64;\ntypedef unsigned long long GoUint64;\ntypedef GoInt64 GoInt;\ntypedef GoUint64 GoUint;\ntypedef __SIZE_TYPE__ GoUintptr;\ntypedef float GoFloat32;\ntypedef double GoFloat64;\ntypedef float _Complex GoComplex64;\ntypedef double _Complex GoComplex128;\n</code></pre>\n\n<p>Now, trying to compile with MSVC, which has no clue as to what <code>__SIZE_TYPE__</code> is or <code>_Complex</code> is not going to fly.  I could probably come up with an extra header that covers these discrepancies, but I don't know what else does CGO header generator has up its sleeve.</p>\n"}, {"tags": ["docker", "go", "docker-compose", "nsq", "go-nsq"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517384991, "post_id": 48536963, "comment_id": 84068981, "body": "<code>consumer.ConnectToNSQLookupd</code> returns an error, can you provide it?"}, {"owner": {"reputation": 7525, "user_id": 1805902, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0W7rW.png?s=128&g=1", "display_name": "pangpang", "link": "https://stackoverflow.com/users/1805902/pangpang"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517388095, "post_id": 48536963, "comment_id": 84070615, "body": "@leafbebop I print the go-nsq error msg, please look my update"}, {"owner": {"reputation": 7525, "user_id": 1805902, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0W7rW.png?s=128&g=1", "display_name": "pangpang", "link": "https://stackoverflow.com/users/1805902/pangpang"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517388412, "post_id": 48536963, "comment_id": 84070790, "body": "I found the solution, should set -broadcast-address=127.0.0.1 for nsqd"}], "answers": [{"tags": [], "owner": {"reputation": 7525, "user_id": 1805902, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0W7rW.png?s=128&g=1", "display_name": "pangpang", "link": "https://stackoverflow.com/users/1805902/pangpang"}, "is_accepted": true, "score": 6, "last_activity_date": 1517389631, "creation_date": 1517389631, "answer_id": 48538306, "question_id": 48536963, "link": "https://stackoverflow.com/questions/48536963/nsq-cannot-consume-message-by-connecting-to-nsqlookupd/48538306#48538306", "title": "nsq cannot consume message by connecting to nsqlookupd", "body": "<p>I output the go-nsq log, then find the root cause, should add <code>-broadcast-address=127.0.0.1</code> for nsqd command, if not\uff0cnsqd will register its hostname to nsqlookupd, it cannot be resolved by client.</p>\n"}], "owner": {"reputation": 7525, "user_id": 1805902, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/0W7rW.png?s=128&g=1", "display_name": "pangpang", "link": "https://stackoverflow.com/users/1805902/pangpang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1755, "favorite_count": 0, "accepted_answer_id": 48538306, "answer_count": 1, "score": 1, "last_activity_date": 1545117803, "creation_date": 1517384598, "last_edit_date": 1517388051, "question_id": 48536963, "link": "https://stackoverflow.com/questions/48536963/nsq-cannot-consume-message-by-connecting-to-nsqlookupd", "title": "nsq cannot consume message by connecting to nsqlookupd", "body": "<p>I tried to use docker-compose to run nsq, the <code>docker-compose.yml</code> as below:</p>\n\n<pre><code>version: '3'\nservices:\n  nsqlookupd:\n    image: nsqio/nsq\n    command: /nsqlookupd\n    ports:\n      - \"4160:4160\"\n      - \"4161:4161\"\n  nsqd:\n    image: nsqio/nsq\n    command: /nsqd --lookupd-tcp-address=nsqlookupd:4160\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4150:4150\"\n      - \"4151:4151\"\n  nsqadmin:\n    image: nsqio/nsq\n    command: /nsqadmin --lookupd-http-address=nsqlookupd:4161\n    depends_on:\n      - nsqlookupd\n    ports:\n      - \"4171:4171\"\n</code></pre>\n\n<p>I am using the nsq client <a href=\"https://github.com/nsqio/go-nsq\" rel=\"nofollow noreferrer\">go-nsq</a> to produce and consume messages, the messages can be consumed by connecting to nsqd directly, but cannot be consumed by connecting to nsqlookupd:</p>\n\n<pre><code>consumer.ConnectToNSQD(\"127.0.0.1:4150\")  # success (output the consumed messages)\n\nconsumer.ConnectToNSQLookupd(\"127.0.0.1:4161\")   # failed\n\n2018/01/31 16:39:12 ERR    1 [test/liu] (967fcc2c88ae:4150) error connecting to nsqd - dial tcp: i/o timeout\n</code></pre>\n\n<p>I can connect to nsqlookup instance:</p>\n\n<pre><code>\u279c  test_nsq curl http://127.0.0.1:4161/ping\nOK%\n\u279c  test_nsq curl http://127.0.0.1:4161/nodes\n{\"producers\":[{\"remote_address\":\"172.22.0.3:59988\",\"hostname\":\"967fcc2c88ae\",\"broadcast_address\":\"967fcc2c88ae\",\"tcp_port\":4150,\"http_port\":4151,\"version\":\"1.0.0-compat\",\"tombstones\":[false],\"topics\":[\"test\"]}]}%\n</code></pre>\n\n<p>the source code link:</p>\n\n<p><a href=\"https://gist.github.com/liuzxc/1baf85cff7db8dee8c26b8707fc48799\" rel=\"nofollow noreferrer\">https://gist.github.com/liuzxc/1baf85cff7db8dee8c26b8707fc48799</a></p>\n\n<p>Env:</p>\n\n<pre><code>OS: Mac EI Capitan 10.11.6\ngo version: 1.9.2\nnsq: 1.0.0-compat(latest)\n</code></pre>\n\n<p>Any idea for this? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517380937, "post_id": 48535986, "comment_id": 84067126, "body": "This answer is correct. Also <code>fmt.Printf(...)</code> should be used to get formatted output. Code: <a href=\"https://play.golang.org/p/bMZk1EbBWJK\" rel=\"nofollow noreferrer\">play.golang.org/p/bMZk1EbBWJK</a>"}], "tags": [], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "is_accepted": false, "score": 1, "last_activity_date": 1517381024, "last_edit_date": 1517381024, "creation_date": 1517380851, "answer_id": 48535986, "question_id": 48535838, "link": "https://stackoverflow.com/questions/48535838/reviced-channel-error-on-main-func-but-no-error-in-if-reviced-progrenn-in-gorout/48535986#48535986", "title": "reviced channel error on main func but no error in if reviced progrenn in goroutine", "body": "<pre><code>func sender(ch chan string) {\n    ch&lt;-\"chenl\"\n    ch&lt;-\"zhangs\"\n    ch&lt;-\"lisi\"\n    close(ch)\n}\n</code></pre>\n\n<p>The problem is that you don't close your channel when you are done producing more values and the <code>for</code> loop never end.</p>\n\n<p>You should range over the channel and the loop will end when the channel is closed. </p>\n\n<pre><code>for result := range ch {\n    fmt.Printf(\"print result %s\\n\",result)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 2213922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dca21f391b99f9dd8c304667969cc02?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/2213922/tim"}, "edited": false, "score": 0, "creation_date": 1517385217, "post_id": 48536005, "comment_id": 84069094, "body": "thankyou,I got it.but I think the main goroutine was blocked on the fourth received,because this time there was no data in channel."}], "tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": true, "score": 3, "last_activity_date": 1517395041, "last_edit_date": 1517395041, "creation_date": 1517380920, "answer_id": 48536005, "question_id": 48535838, "link": "https://stackoverflow.com/questions/48535838/reviced-channel-error-on-main-func-but-no-error-in-if-reviced-progrenn-in-gorout/48536005#48536005", "title": "reviced channel error on main func but no error in if reviced progrenn in goroutine", "body": "<p>In the first example you have two goroutines: <code>main</code> and <code>go sender(ch)</code>. </p>\n\n<p>The <code>main</code> is blocked after the third reading from channel and there is deadlock: <code>main</code> is blocked, <code>go sender(ch)</code> is finished.</p>\n\n<p>In the second example you have three goroutines <code>main</code>, <code>go sender(ch)</code> and <code>go geter(ch)</code>. <code>Sender</code> and <code>getter</code> are working with channel while <code>main</code> is sleeping (without deadlocking). And when <code>time.Sleep</code> finishes, the <code>main</code> returns, and in Go, return from <code>main</code> ends the program, regardless of any other goroutines are running or not.</p>\n"}], "owner": {"reputation": 139, "user_id": 2213922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dca21f391b99f9dd8c304667969cc02?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/2213922/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 48536005, "answer_count": 2, "score": -3, "last_activity_date": 1517395041, "creation_date": 1517380268, "question_id": 48535838, "link": "https://stackoverflow.com/questions/48535838/reviced-channel-error-on-main-func-but-no-error-in-if-reviced-progrenn-in-gorout", "title": "reviced channel error on main func but no error in if reviced progrenn in goroutine", "body": "<p>I send the data into channel by a goroutine.when I want to recievd it in main func,there is deadlock orrced at the last recievd of the channel,</p>\n\n<pre><code>package main\nimport (\n    \"time\"\n    \"fmt\"\n)\n\nfunc sender(ch chan string) {\n    ch&lt;-\"chenl\"\n    ch&lt;-\"zhangs\"\n    ch&lt;-\"lisi\"\n}\n\nfunc geter(ch chan string){\n    for{\n        var result string\n        result = &lt;- ch\n        fmt.Println(\"print result %s\",result)\n    }\n}\n\n\nfunc main() {\n    ch :=make(chan  string)\n    //var result string\n    go sender(ch)\n    for{\n        var result string\n        result = &lt;- ch\n        fmt.Println(\"print result %s\",result)\n    }\n    time.Sleep(10*time.Second)\n}\n</code></pre>\n\n<p>the output:</p>\n\n<pre><code>print result %s chenl\nprint result %s zhangs\nprint result %s lisi\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n</code></pre>\n\n<p>but,if i replace the recived progress in a goroutine too,there is no error orrced.can someone help me,whe does this happed?</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n)\n\nfunc sender(ch chan string) {\n    ch&lt;-\"chenl\"\n    ch&lt;-\"zhangs\"\n    ch&lt;-\"lisi\"\n}\n\nfunc geter(ch chan string){\n    for{\n        var result string\n        result = &lt;- ch\n        fmt.Println(\"print result %s\",result)\n    }\n}\n\nfunc main() {\n    ch :=make(chan  string)\n    go sender(ch)\n    go geter(ch)\n    time.Sleep(10*time.Second)\n}\n</code></pre>\n\n<p>the output:</p>\n\n<pre><code>print result %s chenl\nprint result %s zhangs\nprint result %s lisi\n</code></pre>\n"}, {"tags": ["json", "sqlite", "go", "sqlite-json1", "go-sqlite3"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1517380326, "post_id": 48534992, "comment_id": 84066889, "body": "Are you married to that database schema? SQLite doesn&#39;t have <a href=\"https://www.sqlite.org/datatype3.html\" rel=\"nofollow noreferrer\">any native support for JSON</a> so anything you do will be a mess of kludges. You&#39;d probably have an easier time using a separate <code>animal_sounds</code> table then collecting everything together with JOINs and a bit of Go to build the <code>Animal</code> structs they way you want them. BTW, that column that you&#39;re creating as <code>json</code> is actually just text."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1517380649, "post_id": 48534992, "comment_id": 84067022, "body": "Yeah, didn&#39;t make the table, unfortunately.  :/  Kinda gross."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1517383166, "post_id": 48534992, "comment_id": 84068138, "body": "I think private field like <code>id int</code> in struct can&#39;t be pick up by golang json encoder."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517384352, "post_id": 48534992, "comment_id": 84068678, "body": "If you really want to store JSON documents, you should use a document store such as MongoDB, CouchDB, or similar. Don&#39;t try to force a round peg into a square hole, when round holes exist, too."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 3, "creation_date": 1517449629, "post_id": 48534992, "comment_id": 84104659, "body": "sqlite has supported json fields for years.  Mongo isn&#39;t the only game in document storage town.  Also, if you go to the sql message boards, they&#39;d instead be saying the same problem should be /even less/ json, in that the sounds field just should have been a join to another table.  ;) There are a lot of ways to skin a cat."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1615189196, "last_edit_date": 1615189196, "creation_date": 1517384789, "answer_id": 48537020, "question_id": 48534992, "link": "https://stackoverflow.com/questions/48534992/json-fields-from-sqlite3/48537020#48537020", "title": "JSON fields from sqlite3", "body": "<p>Your question brings up several topics.  But the easiest answer to all of them is probably:</p>\n<p><strong>Don't use a relational database.</strong></p>\n<p>You seem to want to fetch objects/documents, so using a storage mechanism that natively supports this will prevent the need for kludges everywhere. MongoDB, CouchDB, or some other NoSQL solution is probably the right fit for your desires.</p>\n<p>But having said that, there are answers to your specific questions. Put together, they arguably make for something complex and ugly, though.</p>\n<ol>\n<li>Your <code>sounds</code> type.</li>\n</ol>\n<p>Create a custom type, which implements the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">sql.Scanner</a> interface, and unmarshals the JSON value for you:</p>\n<pre><code>    type Sounds []string\n\n    func (s *Sounds) Scan(src interface{}) error {\n        switch t := src.(type) {\n        case []byte:\n            return json.Unmarshal(t, &amp;s)\n        default:\n            return errors.New(&quot;Invalid type&quot;)\n        }\n    }\n</code></pre>\n<ol start=\"2\">\n<li>Scanning into a struct</li>\n</ol>\n<p>Use <a href=\"https://godoc.org/github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">sqlx</a> for this. It allows you to scan your entire row into a struct much more easily than the standard library. It can use the <code>db</code> tag to match rows to the struct field.</p>\n<ol start=\"2\">\n<li>A single struct for DB and JSON</li>\n</ol>\n<p>You can have multiple tags in your struct:</p>\n<pre><code>    type Animal struct {\n        id int                   `db:&quot;id&quot; json:&quot;id&quot;`\n        name sql.NullString      `db:&quot;name&quot; json:&quot;name&quot;`\n        sounds []uint8           `db:&quot;sounds&quot; json:&quot;sounds&quot;`\n    }\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3619, "favorite_count": 0, "accepted_answer_id": 48537020, "answer_count": 1, "score": 2, "last_activity_date": 1615189196, "creation_date": 1517376194, "last_edit_date": 1615188996, "question_id": 48534992, "link": "https://stackoverflow.com/questions/48534992/json-fields-from-sqlite3", "title": "JSON fields from sqlite3", "body": "<p>I have a json field in a sqlite3 collection.  My schema looks like:</p>\n\n<pre><code>CREATE Table Animals(\n  id int,\n  sounds json,\n  name string\n)\n</code></pre>\n\n<p>I understand the go-sqlite interface <a href=\"https://godoc.org/github.com/mattn/go-sqlite3#hdr-Supported_Types\" rel=\"nofollow noreferrer\">does not support the json datatype explicitly</a>.  However, my json is quite simple, as all fields are json arrays, eg;</p>\n\n<pre><code>[\"bark\", \"woof\", \"growl\"]\n[\"meow\", \"hiss\", \"growl\"]\n</code></pre>\n\n<p>So a full record might be:</p>\n\n<pre><code>id   sounds                      name\n1    [\"bark\", \"woof\", \"growl\"]   Fido\n2    [\"meow\", \"hiss\", \"growl\"]   Rufus\n</code></pre>\n\n<p>Using the package:</p>\n\n<pre><code>_ \"github.com/mattn/go-sqlite3\"\n</code></pre>\n\n<p>I am able to extract my json field with</p>\n\n<pre><code>var id sql.NullInt64\nvar name sql.NullString\nvar sounds []uint8\n\nerr := db.QueryRow(\"SELECT id,name,sounds FROM Animals WHERE id = ?;\", 1).Scan(&amp;id, &amp;name, &amp;sounds)\n\nfmt.Println(strconv.Itoa(id) + \"|\" + name + \"|\" + strings.Join(sounds, \"+\"))\n\n// does print correctly:\n1|Fido|bark+wood+growl\n</code></pre>\n\n<p>That is, it seems the sqlite3 json gets stored in a unicode string(?) as a series of...bytes?...that I can convert to string with the String module.  I'm additionally interested in the \"+\" join operation so I can make a query+string+looking+thing out of this for another application downstream.</p>\n\n<p>However, I'd really like to bundle this all up in JSON, and take advantage of JSON unmarshalling/parsing rather than my ad hoc custom prints.  When I try:</p>\n\n<pre><code>type Animal struct {\n    id int                   `json:\"id\"`\n    name sql.NullString      `json:\"name\"`\n    sounds []uint8           `json:\"sounds\"`\n}\n\nvar a Animal\n\nerr := db.QueryRow(\"SELECT id,name,sounds FROM Animals WHERE id = ?;\", 1).Scan(&amp;a.id, &amp;a.name, &amp;a.sounds\n)\n</code></pre>\n\n<p>It prints a bona fide array of integers.  How can I embed the strings.Join(sounds []uint8) declaration + function transformation combo in my json-enabled type definition?</p>\n\n<p>Additionally, it's not clear to me how to use the []uint8 string in the event the json is a nulled [] or true NULL and further make it robust against these.  </p>\n\n<p>Some refs:</p>\n\n<ul>\n<li><a href=\"http://go-database-sql.org/nulls.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/nulls.html</a></li>\n<li><a href=\"https://stackoverflow.com/a/28013076/1052117\">https://stackoverflow.com/a/28013076/1052117</a></li>\n<li><a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a></li>\n</ul>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517376390, "post_id": 48534928, "comment_id": 84065385, "body": "Can you give an example of how you run the program in the command line?"}, {"owner": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517376549, "post_id": 48534928, "comment_id": 84065436, "body": "@Mark - I am using this command to run the program  <code>.&#47;s3_list_objects bucket-logs</code>"}, {"owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1517377749, "post_id": 48534928, "comment_id": 84065884, "body": "1000 entries is the usual limitation of AWS&#39; api&#39;s. You ought to use chaining keys to get the rest of the data. Also, the keys on S3 are always listed in lexicographic order, if you need a different sort order, you must sort them on your side."}, {"owner": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "reply_to_user": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1517378112, "post_id": 48534928, "comment_id": 84066028, "body": "@oakad - Thanks for the info, helpful. Let me try your suggestion."}], "answers": [{"comments": [{"owner": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "edited": false, "score": 0, "creation_date": 1517378555, "post_id": 48535453, "comment_id": 84066181, "body": "Yes I have already read this. I am trying the same but still facing issues."}, {"owner": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "edited": false, "score": 0, "creation_date": 1517547788, "post_id": 48535453, "comment_id": 84148471, "body": "I finally able to resolve my issue. TY for your answer."}, {"owner": {"reputation": 36, "user_id": 9191532, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ucZxOV-YgOc/AAAAAAAAAAI/AAAAAAAAABc/E2mOuGGq124/photo.jpg?sz=128", "display_name": "Faaiq Sheikh", "link": "https://stackoverflow.com/users/9191532/faaiq-sheikh"}, "reply_to_user": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "edited": false, "score": 0, "creation_date": 1517636188, "post_id": 48535453, "comment_id": 84185723, "body": "@elegant-user happy to help"}], "tags": [], "owner": {"reputation": 36, "user_id": 9191532, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ucZxOV-YgOc/AAAAAAAAAAI/AAAAAAAAABc/E2mOuGGq124/photo.jpg?sz=128", "display_name": "Faaiq Sheikh", "link": "https://stackoverflow.com/users/9191532/faaiq-sheikh"}, "is_accepted": true, "score": 2, "last_activity_date": 1517378457, "creation_date": 1517378457, "answer_id": 48535453, "question_id": 48534928, "link": "https://stackoverflow.com/questions/48534928/listobjects-always-returns-list-of-1000-object-can-we-list-objects-sorted-by-da/48535453#48535453", "title": "ListObjects always returns list of 1000 object. Can we list objects sorted by date?", "body": "<p>You will need to add <code>prefix</code> in <code>ListObjectsInput</code>. Check out this <code>https://stackoverflow.com/a/43737253/1225070</code> </p>\n\n<pre><code>params := &amp;s3.ListObjectsInput { \n    Bucket: aws.String(\"bucket\"), \n    Prefix: aws.String(\"root/subfolder\"), \n} \n</code></pre>\n\n<p>Hope this will help you.</p>\n"}], "owner": {"reputation": 2931, "user_id": 1225070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pH3RG.jpg?s=128&g=1", "display_name": "elegant-user", "link": "https://stackoverflow.com/users/1225070/elegant-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1540, "favorite_count": 1, "accepted_answer_id": 48535453, "answer_count": 1, "score": 1, "last_activity_date": 1517378457, "creation_date": 1517375877, "last_edit_date": 1517376495, "question_id": 48534928, "link": "https://stackoverflow.com/questions/48534928/listobjects-always-returns-list-of-1000-object-can-we-list-objects-sorted-by-da", "title": "ListObjects always returns list of 1000 object. Can we list objects sorted by date?", "body": "<p>I am using <code>aws-doc-sdk-examples/go/example_code/s3</code> example code to list out objects in my s3 bucket.</p>\n\n<p>Following two folders are created by default in bucket:</p>\n\n<pre><code>bucket-logs/AWSLogs/accountxxx/CloudTrail-Digest/\nbucket-logs/AWSLogs/accountxxx/CloudTrail/\n</code></pre>\n\n<p>Both folders have sub folders like</p>\n\n<pre><code>/us-region-1/[year]/[month]/[day]/\n</code></pre>\n\n<p>I am using below GoLang code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    if len(os.Args) != 2 {\n        exitErrorf(\"Bucket name required\\nUsage: %s bucket_name\",\n            os.Args[0])\n    }\n\n    bucket := os.Args[1]\n\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-1\")},\n    )\n\n    svc := s3.New(sess)\n\n    resp, err := svc.ListObjects(&amp;s3.ListObjectsInput{Bucket: aws.String(bucket), })\n    if err != nil {\n        exitErrorf(\"Unable to list items in bucket %q, %v\", bucket, err)\n    }\n\n    for _, item := range resp.Contents {\n        fmt.Println(\"Name:         \", *item.Key)\n        fmt.Println(\"Last modified:\", *item.LastModified)\n        fmt.Println(\"Size:         \", *item.Size)\n        fmt.Println(\"Storage class:\", *item.StorageClass)\n        fmt.Println(\"\")\n    }\n\n    fmt.Println(\"Found\", len(resp.Contents), \"items in bucket\", bucket)\n    fmt.Println(\"\")\n}\n\nfunc exitErrorf(msg string, args ...interface{}) {\n    fmt.Fprintf(os.Stderr, msg+\"\\n\", args...)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>The above code always returning 1000 object from <code>bucket-logs/AWSLogs/accountxxx/CloudTrail-Digest/</code> Whereas I want to list objects from <code>bucket-logs/AWSLogs/accountxxx/CloudTrail/</code> folder. </p>\n\n<p>Can we do this. Can we filter list object sorted by year/month/date?</p>\n\n<p>Any help ?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I am running the Go programm using the below cli command</p>\n\n<pre><code>./s3_list_objects bucket-logs\n</code></pre>\n"}, {"tags": ["go", "scanf"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517360587, "post_id": 48532839, "comment_id": 84061422, "body": "change <code>fmt.Scanf(&quot;f&quot;,%i)</code> to <code>fmt.Scanf(&quot;%d&quot;, &amp;i)</code>"}, {"owner": {"reputation": 3, "user_id": 9291899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5774be2e45bfd6750d75985c17ac07b1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Choi", "link": "https://stackoverflow.com/users/9291899/michael-choi"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517363824, "post_id": 48532839, "comment_id": 84062214, "body": "Thank you Mark, that also worked!"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9291899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5774be2e45bfd6750d75985c17ac07b1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Choi", "link": "https://stackoverflow.com/users/9291899/michael-choi"}, "edited": false, "score": 0, "creation_date": 1517361699, "post_id": 48532909, "comment_id": 84061694, "body": "Thank you for your answer! I am still trying to understand this part.  _, err := fmt.Scanf(&quot;%d&quot;, &amp;i) \tif err != nil { \t\tfmt.Printf(&quot;%v\\n&quot;, err) \t\t// maybe a good time to exit \t}  Why does it have to be printed before plug it into &#39;if function&#39;?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 3, "user_id": 9291899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5774be2e45bfd6750d75985c17ac07b1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Choi", "link": "https://stackoverflow.com/users/9291899/michael-choi"}, "edited": false, "score": 0, "creation_date": 1517361750, "post_id": 48532909, "comment_id": 84061708, "body": "Replace <code>&quot;%d&quot;</code> with <code>&quot;f&quot;</code> like you had before and try running it again to see what that does."}, {"owner": {"reputation": 3, "user_id": 9291899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5774be2e45bfd6750d75985c17ac07b1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Choi", "link": "https://stackoverflow.com/users/9291899/michael-choi"}, "edited": false, "score": 0, "creation_date": 1517362087, "post_id": 48532909, "comment_id": 84061781, "body": "&quot;bad verb for %f for integer&quot; is a message, I&#39;m slowly getting there! Thank you"}, {"owner": {"reputation": 581, "user_id": 3550735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c846e896692faeefb33db83af736fc6e?s=128&d=identicon&r=PG&f=1", "display_name": "Nima", "link": "https://stackoverflow.com/users/3550735/nima"}, "edited": false, "score": 2, "creation_date": 1588892322, "post_id": 48532909, "comment_id": 109083883, "body": "<code>if i % 2</code> is readable but expensive in massive calculation, just do <code>if i &amp; 1 == 1</code> is more efficient to check odd integer number ..."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 0, "last_activity_date": 1517360957, "last_edit_date": 1517360957, "creation_date": 1517360631, "answer_id": 48532909, "question_id": 48532839, "link": "https://stackoverflow.com/questions/48532839/golang-printing-even-and-odd-by-scanf/48532909#48532909", "title": "golang printing even and odd by Scanf", "body": "<p><code>fmt.Scanf</code> (<a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow noreferrer\">docs</a>) takes a format string as the first argument.  You are providing <code>\"f\"</code> which is invalid.  If you read and reacted to the error returned then you would see the error \"input does not match format\".  This is a working example doing what I believe you originally intended:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"Enter a number: \")\n    var i int32\n    _, err := fmt.Scanf(\"%d\", &amp;i)\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        // maybe a good time to exit\n    }\n    if i%2 == 0 {\n        fmt.Print(\"even\")\n    } else {\n        fmt.Println(\"odd\")\n    }\n}\n</code></pre>\n\n<p>The reason you were always getting \"even\" is because <code>i</code> was always equal to 0, and zero is even.</p>\n"}], "owner": {"reputation": 3, "user_id": 9291899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5774be2e45bfd6750d75985c17ac07b1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Choi", "link": "https://stackoverflow.com/users/9291899/michael-choi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 1, "accepted_answer_id": 48532909, "answer_count": 1, "score": 0, "last_activity_date": 1517360957, "creation_date": 1517360002, "question_id": 48532839, "link": "https://stackoverflow.com/questions/48532839/golang-printing-even-and-odd-by-scanf", "title": "golang printing even and odd by Scanf", "body": "<pre><code>package main \nimport \"fmt\"\nfunc main(){\n  fmt.Println(\"Enter a number: \")\n  var i int32\n  fmt.Scanf(\"f\",%i)\n  output := i*1\n  if output%2 == 0{\n    fmt.Print(\"even\")\n}else {\n  fmt.Println(\"odd\")\n}\n}\n</code></pre>\n\n<p>This is my current code. I am trying to print even and odd number based on using the Scanf but this only print out 'Even'.</p>\n"}, {"tags": ["sockets", "go", "epoll"], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1517360806, "post_id": 48532853, "comment_id": 84061471, "body": "Thanks, I added Content-Length to http headers, it works !"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1517360145, "creation_date": 1517360145, "answer_id": 48532853, "question_id": 48532814, "link": "https://stackoverflow.com/questions/48532814/golang-epoll-must-close-socket-after-sending-message/48532853#48532853", "title": "golang epoll must close socket after sending message?", "body": "<p>There's a typo on the status line. Use</p>\n\n<pre><code>content = append(content, []byte(\"HTTP/1.1 200 OK\\r\\n\")...)\n</code></pre>\n\n<p>The server should do one of the following to terminate the request body:</p>\n\n<ul>\n<li>Specify the Content-Length header with the length of the body.</li>\n<li>Write a chunked response with a terminating chunk.</li>\n<li>Specify <code>Connection: close</code> header and close connection after writing response.</li>\n</ul>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 48532853, "answer_count": 1, "score": 1, "last_activity_date": 1517360145, "creation_date": 1517359770, "question_id": 48532814, "link": "https://stackoverflow.com/questions/48532814/golang-epoll-must-close-socket-after-sending-message", "title": "golang epoll must close socket after sending message?", "body": "<pre><code>go func() {\n    for req := range respChan {\n        content := make([]byte, 0, 1024*32)\n        content = append(content, []byte(\"HTTP1.1 200 OK\\r\\n\")...)\n        for k, v := range req.Response.Headers {\n            content = append(content, []byte(fmt.Sprintf(\"%s:%s\\r\\n\", k, v))...)\n        }\n        content = append(content, []byte(\"\\r\\n\")...)\n        content = append(content, req.Response.Content...)\n        fmt.Println(string(content[:]))\n        _, err := syscall.Write(int(req.Fd), content)\n        handleEpollError(err)\n    }\n}()\n</code></pre>\n\n<p>I try to implement a http server by linux epoll, eventhing is ok but browser always keep waiting after server finish sending by socket until I interrupt the process. Should I send some terminate characters or do other terminate operation? Above is only the code writing http response by socket.</p>\n"}, {"tags": ["http", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1517359756, "post_id": 48532298, "comment_id": 84061221, "body": "Is the post request reaching your app (do you see it in the logs)? Or the infra catches it before?"}, {"owner": {"reputation": 1741, "user_id": 199115, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/8f58784cc61f726d7bd784ad75425aa9?s=128&d=identicon&r=PG", "display_name": "henry", "link": "https://stackoverflow.com/users/199115/henry"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1517373699, "post_id": 48532298, "comment_id": 84064523, "body": "I do not believe it is making it to the app. I don&#39;t see it in the logs. Which is why I&#39;m assuming this is an App Engine thing. Especially since running their server local this doesn&#39;t happen."}], "answers": [{"tags": [], "owner": {"reputation": 27763, "user_id": 550618, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dbbc19034f22896982dd7acee33ab26?s=128&d=identicon&r=PG", "display_name": "regilero", "link": "https://stackoverflow.com/users/550618/regilero"}, "is_accepted": true, "score": 1, "last_activity_date": 1517818465, "last_edit_date": 1517818465, "creation_date": 1517483802, "answer_id": 48561435, "question_id": 48532298, "link": "https://stackoverflow.com/questions/48532298/is-it-possible-to-accept-a-post-w-no-content-length-in-gae/48561435#48561435", "title": "Is it possible to accept a post w/ no content length in GAE?", "body": "<p>Per the <a href=\"https://tools.ietf.org/html/rfc7230#section-3.3.3\" rel=\"nofollow noreferrer\">RCF 7230 - 3.3.3</a> only responses could contain a body without a <code>Content-Length</code> or <code>Transfer-Encoding: chunked</code>.</p>\n\n<p>Without such information, for a request, then message can:</p>\n\n<ul>\n<li>be treated as a message with body size zero</li>\n<li>or be rejected with 411 error.</li>\n</ul>\n\n<p>So, yes, as you said, the clients are clearly wrong on the protocol side. And you cannot do anything about that, the message is rejected before reaching your application, even if you had one way of allowing these bad message in GAE servers, any other proxy or load balancer set between these bad clients and GAE servers could also reject the messages.</p>\n"}], "owner": {"reputation": 1741, "user_id": 199115, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/8f58784cc61f726d7bd784ad75425aa9?s=128&d=identicon&r=PG", "display_name": "henry", "link": "https://stackoverflow.com/users/199115/henry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 48561435, "answer_count": 1, "score": 1, "last_activity_date": 1517818465, "creation_date": 1517356147, "last_edit_date": 1517356646, "question_id": 48532298, "link": "https://stackoverflow.com/questions/48532298/is-it-possible-to-accept-a-post-w-no-content-length-in-gae", "title": "Is it possible to accept a post w/ no content length in GAE?", "body": "<p>I am moving a small service, written in GO, to Google App Engine. That service receives some posts from a few buggy embedded devices that have a valid post body but don't submit a Content Length header. There is no body and Apache didn't care about this but Google App Engine returns a 411 error (as it should). I didn't catch this in development because the local server is totally fine w/o the content length header.</p>\n\n<p>I'm wondering, is there a way to catch that error in my application or is that beyond my control?</p>\n\n<p>Thank you for your time,</p>\n"}, {"tags": ["go", "gopath"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1517351931, "post_id": 48531096, "comment_id": 84058913, "body": "See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> for the basics on code organization and workspaces.  It sounds like you want multiple workspaces."}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1517384565, "post_id": 48531096, "comment_id": 84068776, "body": "I have one question...Can you install two PhosoShop of exactly same version in same Windows? Can you install two Visual Studio 2015 in same Windows? Now answer to your quesion...Output of <code>go build</code> is a single binary. Place it where ever you want and just execute it as you would execute a nomal program"}, {"owner": {"reputation": 7883, "user_id": 1072187, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/6a15142de5577986384774484ff25fe6?s=128&d=identicon&r=PG", "display_name": "John Little", "link": "https://stackoverflow.com/users/1072187/john-little"}, "reply_to_user": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 1, "creation_date": 1517480654, "post_id": 48531096, "comment_id": 84116282, "body": "@NidhinDavid interesting analogy, but coming from a java background we are used to having any number of versions of any library without issue.  Trying to get to grips with how go works.  We actually do need multiple version of our libraries, the production and dev versions.  Constantly switching them is not an option, so just trying to find best way to work."}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1517504126, "post_id": 48531096, "comment_id": 84132052, "body": "Go is a huge fan of backward compatability. If your library is then there must be no problem for anyone to upgrade..hence no need for version. If not backward compatable then Go recommends a new repository - <a href=\"http://zduck.com/2014/go-and-package-versioning/\" rel=\"nofollow noreferrer\">zduck.com/2014/go-and-package-versioning</a>    BTW I &#39;am no Go expert..just saying what I heard, thats all."}, {"owner": {"reputation": 2584, "user_id": 1444756, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/OCT29.jpg?s=128&g=1", "display_name": "ash", "link": "https://stackoverflow.com/users/1444756/ash"}, "reply_to_user": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1545083289, "post_id": 48531096, "comment_id": 94495686, "body": "@NidhinDavid You\u2019re mistaking development with executables, especially when projects are huge or you work on multiple projects owned by separate companies intermixing their source is not an appropriate answer.  I used Goland and IDE which allows you to set a workspace level <code>GOPATH</code>, but this obviously isn\u2019t necessarily the answer to this question."}], "answers": [{"comments": [{"owner": {"reputation": 7883, "user_id": 1072187, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/6a15142de5577986384774484ff25fe6?s=128&d=identicon&r=PG", "display_name": "John Little", "link": "https://stackoverflow.com/users/1072187/john-little"}, "edited": false, "score": 0, "creation_date": 1517354987, "post_id": 48531886, "comment_id": 84059914, "body": "Unfortunately, direnv is only linux, it doesnt support windows."}, {"owner": {"reputation": 41, "user_id": 2176636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aeb63ad11124b95967dc548a280873fe?s=128&d=identicon&r=PG", "display_name": "nulldog", "link": "https://stackoverflow.com/users/2176636/nulldog"}, "reply_to_user": {"reputation": 7883, "user_id": 1072187, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/6a15142de5577986384774484ff25fe6?s=128&d=identicon&r=PG", "display_name": "John Little", "link": "https://stackoverflow.com/users/1072187/john-little"}, "edited": false, "score": 0, "creation_date": 1517358182, "post_id": 48531886, "comment_id": 84060813, "body": "It has binaries for many OS. Watch out on the github project page for released. There are some prebuilt windows binaries."}], "tags": [], "owner": {"reputation": 41, "user_id": 2176636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aeb63ad11124b95967dc548a280873fe?s=128&d=identicon&r=PG", "display_name": "nulldog", "link": "https://stackoverflow.com/users/2176636/nulldog"}, "is_accepted": false, "score": 2, "last_activity_date": 1517353191, "creation_date": 1517353191, "answer_id": 48531886, "question_id": 48531096, "link": "https://stackoverflow.com/questions/48531096/how-to-manage-gopath-for-multiple-project-directories/48531886#48531886", "title": "how to manage GOPATH for multiple project directories", "body": "<p>Your example \"which hello.exe\" should be used honestly makes not much sense. Two tools with the same name?\nEven if both are, let's say, an <strong>api</strong>, your devops will be happier with more meaningful names.</p>\n\n<p>The bin folder is used for 3rd party tools you install, you so not have to install your project binaries. Except they are tools, but then the name should be meaningful again.</p>\n\n<p>You can get more information about the project structure here: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n\n<p>Since go 1.8 supports a vendor folder below project folders, it is possible to break the original structure. (imho vendors were not maintainable before 1.8, yes that was crazy)</p>\n\n<p>You might want to use a tool like <em>direnv</em>, which would support your desire to change GOPATH per project.\n<a href=\"https://github.com/direnv/direnv\" rel=\"nofollow noreferrer\">https://github.com/direnv/direnv</a></p>\n\n<p>It also has some built in function for adding the current path to the GOPATH.\n<a href=\"https://github.com/direnv/direnv/blob/master/stdlib.sh#L355:1\" rel=\"nofollow noreferrer\">https://github.com/direnv/direnv/blob/master/stdlib.sh#L355:1</a></p>\n\n<p>For example GoLang also supports handling multiple GOPATHs and per project GOPATHs. So direnv should also work properly.</p>\n\n<p>In my company we have one go folder right next to our other projects.\nUnder  go/src are our projects. No problem so far, since vendors are in the projects' vendor folders and committed.</p>\n\n<p>The so far best dependency manager I would recommend for go is:\n<a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">https://github.com/golang/dep</a></p>\n\n<p>I hope that input helps.</p>\n"}, {"tags": [], "owner": {"reputation": 10841, "user_id": 460417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a381152cd980d15f58e0016c996ab254?s=128&d=identicon&r=PG", "display_name": "Tommaso Barbugli", "link": "https://stackoverflow.com/users/460417/tommaso-barbugli"}, "is_accepted": false, "score": 5, "last_activity_date": 1603967359, "last_edit_date": 1603967359, "creation_date": 1518104270, "answer_id": 48689262, "question_id": 48531096, "link": "https://stackoverflow.com/questions/48531096/how-to-manage-gopath-for-multiple-project-directories/48689262#48689262", "title": "how to manage GOPATH for multiple project directories", "body": "<p><strong>UPDATE</strong>: When I posted this Go did not have modules support and we built and used a tool called <code>vg</code>. These days the recommended way to go is to use go modules.</p>\n<p>I use <a href=\"https://github.com/GetStream/vg\" rel=\"nofollow noreferrer\">vg</a> for that, it takes care of keeping separate GOPATH paths per project and it switches automatically when you <code>cd</code> a project.</p>\n"}, {"tags": [], "owner": {"reputation": 898, "user_id": 1450036, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/apHNG.jpg?s=128&g=1", "display_name": "LZR", "link": "https://stackoverflow.com/users/1450036/lzr"}, "is_accepted": false, "score": 1, "last_activity_date": 1597454707, "creation_date": 1597454707, "answer_id": 63421744, "question_id": 48531096, "link": "https://stackoverflow.com/questions/48531096/how-to-manage-gopath-for-multiple-project-directories/63421744#63421744", "title": "how to manage GOPATH for multiple project directories", "body": "<p>With Go 1.11 Go Modules were introduced. You can use Go Modules to have Go projects outside the GOPATH directory.</p>\n<p><a href=\"https://medium.com/mindorks/create-projects-independent-of-gopath-using-go-modules-802260cdfb51\" rel=\"nofollow noreferrer\">Here</a> is an example of how to configure a project using GoModules.</p>\n"}], "owner": {"reputation": 7883, "user_id": 1072187, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/6a15142de5577986384774484ff25fe6?s=128&d=identicon&r=PG", "display_name": "John Little", "link": "https://stackoverflow.com/users/1072187/john-little"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4391, "favorite_count": 2, "answer_count": 3, "score": 6, "last_activity_date": 1603967359, "creation_date": 1517348990, "last_edit_date": 1517349531, "question_id": 48531096, "link": "https://stackoverflow.com/questions/48531096/how-to-manage-gopath-for-multiple-project-directories", "title": "how to manage GOPATH for multiple project directories", "body": "<p>coming from a java and grails background, (and having written millions of lines of C 30 years ago), I cant see how go can be usable with a fixed gopath on windows.</p>\n\n<p>installing go creates this structure </p>\n\n<pre><code>c:\\users\\me\\go\\scr\n              \\pkg\n              \\bin\n</code></pre>\n\n<p>As you will want to have many go projects it seems they have to be mixed together in the same src/kpg/bin dirs, polluting each other.  e.g.</p>\n\n<pre><code>/src/project1/hello.go\n    /project2/hello.go\n/pkg/xx\n/bin/hello.exe\n</code></pre>\n\n<p>Which hello.go will hello.exe run?</p>\n\n<p>Unless I am missing something fundamental, this seems crazy - all completely separate projects are expected to share the same package and bin dirs.  It means you dont know which versions of which packages, and which exe files belong to which project, and there is presumably plenty of scope for conflicts.    I would have expected a /src, /pkg and /bin for each separate go app (like java or grails or even C), and go path is completely redundant, it can be relative to the current project root (like in grails).</p>\n\n<p>To make matters works, for work, we have to use a different directry, e.g.</p>\n\n<pre><code>d:\\work\\project3\n       \\project4\n       \\package5\n           \\go_utility6\n           \\go_utility7\n</code></pre>\n\n<p>So now we have a total of 6 separate directories where go progams live.  It is not feasible to change the path every time you switch to working on a different project. I guess the other option is to add the 6 paths to the GOPATH.  Presumably, all 7 go projects write to the same pkg and bin dir, which is going to be a disaster.  </p>\n\n<p>Is there a tenable solution to this situation (on windows at least)?</p>\n\n<p>If we need to add a PATH to GOPATH for every project, what should the file structure be under each project?</p>\n\n<p>E.g. uner xxx\\go_utility6, which is a stand alone command line go app, what should the structure be?  does there need to be a src dir in there somewhere?  does this dir need gopath to point to it?  does it need its own pkg, or should it use the c:\\users\\me\\pkg dir?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1517348397, "post_id": 48530604, "comment_id": 84057326, "body": "&quot;Shouldn&#39;t parallelizing make things faster?&quot; <i>Maybe.</i> Concurrency is not a silver bullet, and the impact of concurrency depends a great deal on the operating environment (hardware, OS, etc) and the code being executed."}], "answers": [{"comments": [{"owner": {"reputation": 1174, "user_id": 4476026, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/523f14f26d314485343633ad026f3bbb?s=128&d=identicon&r=PG&f=1", "display_name": "kmad1729", "link": "https://stackoverflow.com/users/4476026/kmad1729"}, "edited": false, "score": 0, "creation_date": 1517351863, "post_id": 48530780, "comment_id": 84058883, "body": "I don&#39;t think Python code will introduces a bottleneck. It essentially translates to <code>time</code> command on unix, nothing more nothing less."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 1174, "user_id": 4476026, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/523f14f26d314485343633ad026f3bbb?s=128&d=identicon&r=PG&f=1", "display_name": "kmad1729", "link": "https://stackoverflow.com/users/4476026/kmad1729"}, "edited": false, "score": 0, "creation_date": 1517501954, "post_id": 48530780, "comment_id": 84130638, "body": "But you can&#39;t actually prove that.  Python is interpreted, it&#39;s natively slower than Go, and using the <code>time</code> command in Unix is FAR less precise than the direct OS API calls that the go runtime uses during benchmarks."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 2, "last_activity_date": 1517347572, "creation_date": 1517347572, "answer_id": 48530780, "question_id": 48530604, "link": "https://stackoverflow.com/questions/48530604/goroutine-blocking-and-non-blocking-usage/48530780#48530780", "title": "goroutine blocking and non-blocking usage", "body": "<p>So, several problems here.  Firstly, your channels aren't buffered in the concurrent example, which means the receives still may have to wait a bit on each other.  Second, <em>concurrent</em> doesn't mean <em>parallel</em>.  Are you sure these are actually running in parallel and not simply being scheduled on the same OS thread?</p>\n\n<p>That said, your main problem here is that your Python code is using <code>go run</code> for each iteration, which means the vast majority of your recorded \"run time\" is actually the <em>compilation</em> of your code (<code>go run</code> compiles and then runs the specified file, and it specifically by design does not cache any of that).  If you want to test run time, use <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">Go's benchmark system</a>, not your own cobbled-together version.  You'll get far more accurate results.  For example,  beyond the compilation bottleneck, there's also no way to identify how much of a bottleneck the Python code itself is introducing.</p>\n\n<p>Oh, and you should get out of the habit of using reference arguments to functions as a way to \"return\" values.  Go supports multiple returns, so the C style of modifying arguments in-place is generally considered an anti-pattern unless there's a really compelling reason to do it.</p>\n"}], "owner": {"reputation": 1174, "user_id": 4476026, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/523f14f26d314485343633ad026f3bbb?s=128&d=identicon&r=PG&f=1", "display_name": "kmad1729", "link": "https://stackoverflow.com/users/4476026/kmad1729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 48530780, "answer_count": 1, "score": 0, "last_activity_date": 1517347572, "creation_date": 1517346804, "question_id": 48530604, "link": "https://stackoverflow.com/questions/48530604/goroutine-blocking-and-non-blocking-usage", "title": "goroutine blocking and non-blocking usage", "body": "<p>I am trying to understand how go-routines work. Here is some code:</p>\n\n<pre><code>//parallelSum.go\nfunc sum(a []int, c chan&lt;- int, func_id string) {\n    sum := 0\n    for _, n := range a {\n        sum += n\n    }\n    log.Printf(\"func_id %v is DONE!\", func_id)\n    c &lt;- sum\n}   \nfunc main() {\n    ELEM_COUNT := 10000000\n    test_arr := make([]int, ELEM_COUNT)\n    for i := 0; i &lt; ELEM_COUNT; i++ {\n        test_arr[i] = i * 2 \n    }\n    c1 := make(chan int)\n    c2 := make(chan int)\n    go sum(test_arr[:len(test_arr)/2], c1, \"1\")\n    go sum(test_arr[len(test_arr)/2:], c2, \"2\")\n    x := &lt;-c1\n    y := &lt;-c2\n\n    //x, y := &lt;-c, &lt;-c\n    log.Printf(\"x= %v, y = %v, sum = %v\", x, y, x+y)\n}   \n</code></pre>\n\n<p>The above program runs fine and returns the output. I have an iterative version of the same program:</p>\n\n<pre><code>//iterSum.go\nfunc sumIter(a []int, c *int, func_id string) {\n    sum := 0\n    log.Printf(\"entered the func %s\", func_id)\n    for _, n := range a { \n        sum += n\n    }   \n    log.Printf(\"func_id %v is DONE!\", func_id)\n    *c = sum \n}\nfunc main() {\n    */\n    ELEM_COUNT := 10000000\n    test_arr := make([]int, ELEM_COUNT)\n    for i := 0; i &lt; ELEM_COUNT; i++ {\n        test_arr[i] = i * 2\n    }\n    var (\n        i1 int\n        i2 int\n    )   \n    sumIter(test_arr[:len(test_arr)/2], &amp;i1, \"1\")\n    sumIter(test_arr[len(test_arr)/2:], &amp;i2, \"2\")\n    x := i1\n    y := i2\n\n    log.Printf(\"x= %v, y = %v, sum = %v\", x, y, x+y)\n} \n</code></pre>\n\n<p>I ran the program 20 times and averaged the run time for each program. I see the average almost equal? Shouldn't parallelizing make things faster? What am I doing wrong?</p>\n\n<p>Here is the python program to run it 20 times:</p>\n\n<pre><code>iterCmd = 'go run iterSum.go'\nparallelCmd = 'go run parallelSum.go'\n\nrunCount = 20\n\n\ndef analyzeCmd(cmd, runCount):\n    runData = []\n    print(\"running cmd (%s) for (%s) times\" % (cmd, runCount))\n    for i in range(runCount):\n    \u2506   start_time = time.time()\n    \u2506   cmd_out = subprocess.check_call(shlex.split(cmd))\n        run_time = time.time() - start_time\n    \u2506   curr_data = {'iteration': i, 'run_time' : run_time}\n    \u2506   runData.append(curr_data)\n\n    return runData\n\niterOut = analyzeCmd(iterCmd, runCount)\nparallelOut = analyzeCmd(parallelCmd, runCount)\n\nprint(\"iter cmd data --&gt;\")\nprint(iterOut)\n\nwith open('iterResults.json', 'w') as f:\n    json.dump(iterOut, f)\n\nprint(\"parallel cmd data --&gt;\")\nprint(parallelOut)\n\nwith open('parallelResults.json', 'w') as f:\n    json.dump(parallelOut, f)\n\navg = lambda results: sum(i['run_time'] for i in results) / len(results)\nprint(\"average time for iterSum = %3.2f\" % (avg(iterOut)))\nprint(\"average time for parallelSum = %3.2f\" % (avg(parallelOut)))\n</code></pre>\n\n<p>Here is output of 1 run:</p>\n\n<pre><code>average time for iterSum = 0.27\naverage time for parallelSum = 0.29\n</code></pre>\n"}, {"tags": ["go", "telegram", "telegram-bot"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517340180, "post_id": 48528427, "comment_id": 84053221, "body": "I don&#39;t understand what you&#39;re doing, but it probably doesn&#39;t need reflection.  Please create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> demonstrating the issue."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517342536, "post_id": 48528427, "comment_id": 84054533, "body": "<code>update.Message.Text</code> is a string, and Go is statically typed, so you don&#39;t need to reflect on it to know if it&#39;s a string."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517342997, "post_id": 48528427, "comment_id": 84054741, "body": "@JimB if user send emoji, bot get string like this &quot;\\ud83d\\udc93&quot;, it&#39;s a emoji code, so I need to prevent user to send emoji"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1517343899, "post_id": 48528427, "comment_id": 84055148, "body": "Emoji&#39;s are just unicode characters, which are perfectly valid strings. What about the other unicode blocks? Do you want to filter anything outside of ascii characters? Do you want to filter everything outside the Basic Multilingual Plane? Do you want to specifically filter just emoji characters, like <a href=\"https://stackoverflow.com/a/46065932/32880\">stackoverflow.com/a/46065932/32880</a>?"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "is_accepted": true, "score": 0, "last_activity_date": 1519474179, "creation_date": 1519474179, "answer_id": 48962702, "question_id": 48528427, "link": "https://stackoverflow.com/questions/48528427/check-what-user-send-emoji-to-telegram-bot/48962702#48962702", "title": "Check what user send emoji to telegram bot", "body": "<p>So I don't find answer and left this if statement:</p>\n\n<pre><code>if reflect.TypeOf(update.Message.Text).Kind() == reflect.String &amp;&amp; update.Message.Text != \"\"\n</code></pre>\n\n<p>He check if message from user is text not a audio, video, sticker but emoji is text so thay pass it.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "accepted_answer_id": 48962702, "answer_count": 1, "score": 0, "last_activity_date": 1519474179, "creation_date": 1517337794, "last_edit_date": 1517514193, "question_id": 48528427, "link": "https://stackoverflow.com/questions/48528427/check-what-user-send-emoji-to-telegram-bot", "title": "Check what user send emoji to telegram bot", "body": "<p>I need to check what user send a word, not a audio, video, sticker or emoji, so I try to create if statement but I don't know how to check if user send emoji to bot.</p>\n\n<pre><code>if reflect.TypeOf(update.Message.Text).Kind() == reflect.String &amp;&amp; update.Message.Text != \"\" //Check if message from user is not emoji {    \n    msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"It's a Text\")    \n    bot.Send(msg)\n} else {\n    msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"It's a not Text\")    \n    bot.Send(msg)\n}\n</code></pre>\n\n<p><strong>Full code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"reflect\"\n    \"runtime\"\n    \"strings\"    \n    \"github.com/Syfaro/telegram-bot-api\"\n)\n\nfunc telegramBot() {    \n    //Create bot\n    bot, err := tgbotapi.NewBotAPI(\"TOKEN\")\n    if err != nil {\n        log.Panic(err)\n    }    \n    //Check if bot autorized\n    bot.Debug = true\n    log.Printf(\"Autorized on account %s\", bot.Self.UserName)\n\n    //Set update timeout\n    u := tgbotapi.NewUpdate(0)\n    u.Timeout = 60\n\n    //Get updates from bot\n    updates, err := bot.GetUpdatesChan(u)\n\n    for update := range updates {\n        if update.Message == nil {\n            continue\n        }    \n        if reflect.TypeOf(update.Message.Text).Kind() == reflect.String &amp;&amp; update.Message.Text != \"\" {              \n                //Create search url\n                url := update.Message.Text\n                request := \"https://en.wikipedia.org/w/api.php?action=opensearch&amp;search=\" + url + \"&amp;limit=1&amp;origin=*&amp;format=json\"   \n            //Check from who was arrived message and send to him answer from wikipedia\n            msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"Message to user\")    \n            //Send message\n            bot.Send(msg)\n        } else {\n            msg := tgbotapi.NewMessage(update.Message.Chat.ID, \"It's not a Text\")    \n            //Send message\n            bot.Send(msg)\n        }\n    }\n}\n\nfunc main() {    \n    //Set maximum cpu cores to use\n    num := runtime.NumCPU()\n    runtime.GOMAXPROCS(num)    \n    //Call Bot\n    telegramBot()\n}\n</code></pre>\n\n<p>So I need to response user only if he send bot string with word, not an audio, video, sticker or emoji.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 326733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb43682ce82a371b9a2b3a39ae985056?s=128&d=identicon&r=PG", "display_name": "maicalal", "link": "https://stackoverflow.com/users/326733/maicalal"}, "edited": false, "score": 0, "creation_date": 1517337161, "post_id": 48527788, "comment_id": 84051451, "body": "Thanks @Kaedys for the quick response. Will accept this as answer. Sync channel is a clean fix :)..."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 3, "last_activity_date": 1517335387, "creation_date": 1517335387, "answer_id": 48527788, "question_id": 48527601, "link": "https://stackoverflow.com/questions/48527601/in-a-goroutines-with-select-case-and-default-once-channel-closed-default-shoul/48527788#48527788", "title": "In a Goroutines with select case and default, once channel closed, default should not get executed", "body": "<p>Calls to fmt.Printf involve a syscall.  Syscalls automatically cause that goroutine to be rescheduled, as it has to wait on the OS to finish that syscall.  That means it's very possible for some of those goroutines to run the select statement and select the default case, but <em>not</em> print to console yet.</p>\n\n<p><strong>Edit:</strong> Also, if you're running this on a system with more than one thread, the go runtime by default will run several go routines <em>in parallel</em> (matching the number of OS threads), meaning some of those goroutines could be executing at the same time as the channel close and reach the select statement before the channel close occurs in the main goroutine.</p>\n\n<p>If you add in a sync channel to ensure that the channel close operation occurs <em>before</em> the <code>select</code> happens in any of the goroutines, it works as expected:</p>\n\n<p><a href=\"https://play.golang.org/p/XtUYaihKgRT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XtUYaihKgRT</a></p>\n\n<pre><code>func testClosedChannelBehavior() {\n    const n = 50\n    finish := make(chan bool)\n    proceed := make(chan struct{})\n    var done sync.WaitGroup\n    for i := 0; i &lt; n; i++ {\n        done.Add(1)\n        go func(x int) {\n            &lt;-proceed\n            select {\n            case &lt;-time.After(1 * time.Hour):\n            case &lt;-finish:\n                fmt.Printf(\"received finish %d\\n\", x)\n            default:\n                fmt.Printf(\"I didnt wait %d\\n\", x)\n            }\n            done.Done()\n        }(i)\n    }\n    t0 := time.Now()\n    close(finish)\n    fmt.Println(\"finish closed\")\n    close(proceed)\n    done.Wait()\n    fmt.Printf(\"Waited %v for %d goroutines to stop\\n\", time.Since(t0), n)\n}\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 326733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb43682ce82a371b9a2b3a39ae985056?s=128&d=identicon&r=PG", "display_name": "maicalal", "link": "https://stackoverflow.com/users/326733/maicalal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 48527788, "answer_count": 1, "score": 0, "last_activity_date": 1517335596, "creation_date": 1517334720, "question_id": 48527601, "link": "https://stackoverflow.com/questions/48527601/in-a-goroutines-with-select-case-and-default-once-channel-closed-default-shoul", "title": "In a Goroutines with select case and default, once channel closed, default should not get executed", "body": "<p>I am trying to understand the behaviour of closed channel in a select block with default case, but got confused with this following output.\nHere am invoking 50 goroutines and closing the finish channel.</p>\n\n<pre><code>func testClosedChannelBehavior() {\n    const n = 50\n    finish := make(chan bool)\n    var done sync.WaitGroup\n    for i := 0; i &lt; n; i++ {\n        done.Add(1)\n        go func(x int) {\n            select {\n            case &lt;-time.After(1 * time.Hour):\n            case &lt;-finish:\n                fmt.Printf(\"received finish %d\\n\", x)\n            default:\n            fmt.Printf(\"I didnt wait %d\\n\", x)\n            }\n            done.Done()\n        }(i)\n    }\n    t0 := time.Now()\n    close(finish) \n    fmt.Println(\"finish closed\")\n    done.Wait() \n    fmt.Printf(\"Waited %v for %d goroutines to stop\\n\",     time.Since(t0), n)\n}\n</code></pre>\n\n<p>I expected once any goroutine prints \"received finish\", default case should not get executed by any other goroutines i.e. \"I didnt wait\" should not get printed.\nBut the output is not consistent. At times it behaves as expected, but on running multiple times, I could see unexpected output as below:\n<code>=====output======\nI didnt wait 0\nreceived finish 7\nfinish closed\nreceived finish 13\nreceived finish 10\nreceived finish 32\nreceived finish 5\nreceived finish 14\nreceived finish 33\nreceived finish 42\nreceived finish 11\nreceived finish 4\nreceived finish 23\nreceived finish 44\nreceived finish 49\nreceived finish 15\nreceived finish 24\nreceived finish 31\nreceived finish 16\nreceived finish 40\nreceived finish 41\nreceived finish 6\nreceived finish 26\nI didnt wait 1\nreceived finish 19\nreceived finish 8\nreceived finish 43\nreceived finish 29\nreceived finish 20\nreceived finish 46\nreceived finish 12\nreceived finish 36\nreceived finish 47\nreceived finish 37\nreceived finish 35\nreceived finish 30\nreceived finish 39\nreceived finish 22\nreceived finish 28\nI didnt wait 2\nreceived finish 17\nreceived finish 45\nI didnt wait 9\nreceived finish 48\nreceived finish 34\nI didnt wait 3\nreceived finish 25\nreceived finish 38\nreceived finish 27\nreceived finish 18\nreceived finish 21\nWaited 394.999\u00b5s for 50 goroutines to stop</code></p>\n\n<p>I was going through <a href=\"https://dave.cheney.net/2013/04/30/curious-channels\" rel=\"nofollow noreferrer\">this link</a> expecting close(finish) would signal others, those still waiting,  to behave alike.</p>\n"}, {"tags": ["objective-c", "c", "go"], "comments": [{"owner": {"reputation": 62027, "user_id": 603977, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/myasv.jpg?s=128&g=1", "display_name": "jscs", "link": "https://stackoverflow.com/users/603977/jscs"}, "edited": false, "score": 0, "creation_date": 1517334779, "post_id": 48527333, "comment_id": 84050180, "body": "Not sure I understand which direction you&#39;re trying to interoperate in, but anything that you can do in C, you can do in ObjC. (The reverse is not true, however.)"}], "answers": [{"tags": [], "owner": {"reputation": 159, "user_id": 4576602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d9d8788530f91e20d1b56602f947c172?s=128&d=identicon&r=PG&f=1", "display_name": "Unsacrificed", "link": "https://stackoverflow.com/users/4576602/unsacrificed"}, "is_accepted": true, "score": 0, "last_activity_date": 1520773929, "creation_date": 1520773929, "answer_id": 49220351, "question_id": 48527333, "link": "https://stackoverflow.com/questions/48527333/cgo-godefs-and-objective-c/49220351#49220351", "title": "cgo godefs and Objective-C", "body": "<p>Finally I found a solution. It is possible to do what I want. The only thing I missed: <code>godefs</code> ignores <code>#cgo CFLAGS: -x objective-c</code> line. Solution - pass required CFLAGS to <code>go</code> binary as arguments (<code>-- -x objective-c</code>).\nWorking example:</p>\n\n<pre><code>// +build ignore\n\npackage tmp\n\n//go:generate go tool cgo -godefs -- -x objective-c cgodefs.go\n\n//#import &lt;Cocoa/Cocoa.h&gt;\nimport \"C\"\n\ntype CGPoint C.CGPoint\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>// Created by cgo -godefs - DO NOT EDIT\n// cgo -godefs -- -x objective-c cgodefs.go\n\npackage tmp\n\ntype CGPoint struct {\n    X   float64\n    Y   float64\n}\n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 4576602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d9d8788530f91e20d1b56602f947c172?s=128&d=identicon&r=PG&f=1", "display_name": "Unsacrificed", "link": "https://stackoverflow.com/users/4576602/unsacrificed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 1, "accepted_answer_id": 49220351, "answer_count": 1, "score": 0, "last_activity_date": 1520773929, "creation_date": 1517333651, "last_edit_date": 1517335191, "question_id": 48527333, "link": "https://stackoverflow.com/questions/48527333/cgo-godefs-and-objective-c", "title": "cgo godefs and Objective-C", "body": "<p>I write a program on GoLang with inclusion Objective-C code (call some OSX API) via <code>C</code> GoLang's package and I need to pass variable of type <code>T</code> from Go code to Objective-C code and vice versa. <code>T</code> is structure (or other type). So I need to create compatible (in terms of memory layout) type/variable in GoLang and pass it to Objective-C via <code>unsafe.Pointer</code> casting. For generic C code I use <code>godefs</code> in such cases, but I unable to use <code>godefs</code> for Objective-C. If I try <code>go tool cgo -godefs cgodefs.go</code></p>\n\n<pre><code>// This is \"cgodefs.go\" file\npackage tmp\n\n/*\n#cgo CFLAGS: -x objective-c\n#cgo LDFLAGS: -framework Cocoa\n#import &lt;Cocoa/Cocoa.h&gt;\n*/\nimport \"C\"\n\ntype CGPoint C.CGPoint\n</code></pre>\n\n<p>I receive tons of errors:</p>\n\n<pre><code>In file included from /Users/unsacrificed/go/src/gui/cgodefs.go:10:\nIn file included from /System/Library/Frameworks/Cocoa.framework/Headers/Cocoa.h:12:\nIn file included from /System/Library/Frameworks/Foundation.framework/Headers/Foundation.h:8:\n/System/Library/Frameworks/Foundation.framework/Headers/NSObjCRuntime.h:503:1: error: expected identifier or '('\n@class NSString, Protocol;\n^\n/System/Library/Frameworks/Foundation.framework/Headers/NSObjCRuntime.h:505:9: error: unknown type name 'NSString'\ntypedef NSString * NSExceptionName NS_EXTENSIBLE_STRING_ENUM;\n        ^\n/System/Library/Frameworks/Foundation.framework/Headers/NSObjCRuntime.h:506:9: error: unknown type name 'NSString'\ntypedef NSString * NSRunLoopMode NS_EXTENSIBLE_STRING_ENUM;\n... (100000+ lines of errors)\n</code></pre>\n\n<p>Interested thing is that I can compile and run GoLang apps with Objective-C via <code>C</code> GoLang's package.</p>\n\n<p>I <a href=\"https://github.com/golang/go/issues/23615\" rel=\"nofollow noreferrer\">report</a> to GoLang but he says that </p>\n\n<blockquote>\n  <p>The cgo tool works with C, not Objective-C.</p>\n</blockquote>\n\n<p>Is there any way to get GoLang equivalent (memory compatible) type for Objective-C type? </p>\n"}, {"tags": ["go", "escaping", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 1, "creation_date": 1517333269, "post_id": 48527166, "comment_id": 84049364, "body": "Oh god it was that simple... that&#39;s what i get for relying too much on auto-importers! Thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1517333027, "creation_date": 1517333027, "answer_id": 48527166, "question_id": 48527115, "link": "https://stackoverflow.com/questions/48527115/template-unnecessarily-escaping-to-lt-but-not/48527166#48527166", "title": "Template unnecessarily escaping `&lt;` to `&amp;lt;` but not `&gt;`", "body": "<p><a href=\"https://golang.org/pkg/html/template/\" rel=\"noreferrer\"><code>html/template</code></a> provides automatic, context-sensitive escaping safe against code injection:</p>\n\n<blockquote>\n  <p>HTML templates treat data values as plain text which should be encoded so they can be safely embedded in an HTML document. The escaping is contextual, so actions can appear within JavaScript, CSS, and URI contexts.</p>\n</blockquote>\n\n<p><code>html/template</code> is only to generate HTML output:</p>\n\n<blockquote>\n  <p>It provides the same interface as package text/template and should be used instead of text/template <strong>whenever the output is HTML</strong>.</p>\n</blockquote>\n\n<p>If the output is not HTML, use <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\"><code>text/template</code></a> instead which does not escape data.</p>\n"}], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3429, "favorite_count": 1, "accepted_answer_id": 48527166, "answer_count": 1, "score": 5, "last_activity_date": 1517333054, "creation_date": 1517332829, "question_id": 48527115, "link": "https://stackoverflow.com/questions/48527115/template-unnecessarily-escaping-to-lt-but-not", "title": "Template unnecessarily escaping `&lt;` to `&amp;lt;` but not `&gt;`", "body": "<p>I work on a dev tool that uses templates for generating files such as readmes and licenses.</p>\n\n<p>Everything works fine apart from one instance of a <code>&lt;</code> character gets turned into a <code>&amp;lt;</code> - the corresponding <code>&gt;</code> character works fine and appears as expected in the output.</p>\n\n<p>Template file: <a href=\"https://raw.githubusercontent.com/Southclaws/pawn-package-template/master/README.md\" rel=\"noreferrer\">https://raw.githubusercontent.com/Southclaws/pawn-package-template/master/README.md</a> the the lines of interest are:</p>\n\n<pre><code>```pawn\n#include &lt;{{.Repo}}&gt;\n```\n</code></pre>\n\n<p>Where <code>Repo</code> gets inserted with the expected result being</p>\n\n<pre><code>#include &lt;sometext&gt;\n</code></pre>\n\n<p>But what actually comes out is:</p>\n\n<pre><code>#include &amp;lt;sometext&gt;\n</code></pre>\n\n<p>I can't figure out why this is happening from the docs. It seems like a bug to be honest because if it's looking for things to escape, surely it would turn <code>&gt;</code> into <code>&amp;gt;</code> as well, right?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1517329603, "post_id": 48526138, "comment_id": 84047199, "body": "Start by making your fields exported (starting with an uppercase)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517329694, "post_id": 48526138, "comment_id": 84047255, "body": "Please show the code you&#39;ve tried and explain the problem you&#39;re having with it."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1517329699, "post_id": 48526138, "comment_id": 84047256, "body": "done already in actual, haven&#39;t updated here. It only decoded the Symbol, not the slice"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517329871, "post_id": 48526138, "comment_id": 84047355, "body": "Works for me if I export all your fields and use <code>json.Unmarshal(jsonBytes, &amp;instanceOfrequestBody)</code>"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1517330073, "post_id": 48526138, "comment_id": 84047473, "body": "how do I get the jsonBytes from request body?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517330116, "post_id": 48526138, "comment_id": 84047500, "body": "@JohnStephen.19 why are you using a <code>for</code> loop to decode the request body?"}], "answers": [{"comments": [{"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1517331209, "post_id": 48526413, "comment_id": 84048186, "body": "Result for me in console is { ZVZZT.O [ ] }"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1517331245, "post_id": 48526413, "comment_id": 84048210, "body": "Please show the rest of your code, I listed a few thing that could go wrong. You should probably print the body before unmarshal too."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1517330426, "creation_date": 1517330426, "answer_id": 48526413, "question_id": 48526138, "link": "https://stackoverflow.com/questions/48526138/how-to-decode-unmarshal-request-body-into-golang-structs-and-struct-slices/48526413#48526413", "title": "How to decode/unmarshal Request Body into Golang structs and struct slices?", "body": "<p>I'm confused about a few things you're doing:</p>\n\n<ul>\n<li>using a for when you're decoding a <code>request.Body</code></li>\n<li>expecting more than one element</li>\n<li>not just appending <code>b</code> directly</li>\n</ul>\n\n<p>Dropping the loop and using either <code>json.Unmarshal</code> or <code>json.NewDecoder</code> works fine. I could keep the for loop, and it would still work. You should show the rest of your code, you have a problem elsewhere, either:</p>\n\n<ul>\n<li>the request body is empty or already read and closed</li>\n<li>you're returning the parsed objects in a strange way</li>\n<li>something else?</li>\n</ul>\n\n<p>Here's working code (without the for loop), showing both possibilities:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"strings\"\n)\n\nvar j = `\n{\n    \"symbol\": \"ZVZZT.O\",\n    \"params\": [{\n        \"forward\": 0,\n        \"period\": 3,\n        \"ref\": \"high\",\n        \"indicator\": \"sma\",\n        \"freq\": \"day\"\n    }, {\n        \"forward\": 1,\n        \"period\": 8,\n        \"ref\": \"close\",\n        \"indicator\": \"ema\",\n        \"freq\": \"week\"\n    }]\n}`\n\ntype Iteration4RequestBody struct {\n    Symbol string             `json:\"symbol\"`\n    Params []Iteration4Params `json:\"params\"`\n}\n\ntype Iteration4Params struct {\n    Forward   int    `json:\"forward\"`\n    Period    int    `json:\"period\"`\n    Ref       string `json:\"ref\"`\n    Indicator string `json:\"indicator\"`\n    Freq      string `json:\"freq\"`\n}\n\nfunc main() {\n    // Using json.Unmarshal\n    var it Iteration4RequestBody\n    err := json.Unmarshal([]byte(j), &amp;it)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(it)\n\n    // Using a json.Decoder\n    var it2 Iteration4RequestBody\n    dec := json.NewDecoder(strings.NewReader(j))\n    if err := dec.Decode(&amp;it2); err != nil &amp;&amp; err != io.EOF {\n        panic(err)\n    }\n    fmt.Println(it2)\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>{ZVZZT.O [{0 3 high sma day} {1 8 close ema week}]}\n{ZVZZT.O [{0 3 high sma day} {1 8 close ema week}]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "is_accepted": false, "score": 1, "last_activity_date": 1517331301, "creation_date": 1517331301, "answer_id": 48526660, "question_id": 48526138, "link": "https://stackoverflow.com/questions/48526138/how-to-decode-unmarshal-request-body-into-golang-structs-and-struct-slices/48526660#48526660", "title": "How to decode/unmarshal Request Body into Golang structs and struct slices?", "body": "<p>If you want to use a json.Decoder you can loop testing if there are more elements:</p>\n\n<pre><code>for dec.More() {\n  var b Iteration4RequestBody\n  if err := dec.Decode(&amp;b); err != nil {\n     log.Fatal(err)\n  } else {\n    log.Println(b)\n  }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-dgg9kfjdp8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-dgg9kfjdp8</a></p>\n"}], "owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3484, "favorite_count": 0, "accepted_answer_id": 48526413, "answer_count": 2, "score": -1, "last_activity_date": 1517380487, "creation_date": 1517329581, "last_edit_date": 1517380487, "question_id": 48526138, "link": "https://stackoverflow.com/questions/48526138/how-to-decode-unmarshal-request-body-into-golang-structs-and-struct-slices", "title": "How to decode/unmarshal Request Body into Golang structs and struct slices?", "body": "<p>How do I properly unmarshal this in Golang?</p>\n\n<pre><code>{\n    \"symbol\": \"ZVZZT.O\",\n    \"params\": [{\n        \"forward\": 0,\n        \"period\": 3,\n        \"ref\": \"high\",\n        \"indicator\": \"sma\",\n        \"freq\": \"day\"\n    }, {\n        \"forward\": 1,\n        \"period\": 8,\n        \"ref\": \"close\",\n        \"indicator\": \"ema\",\n        \"freq\": \"week\"\n    }]\n}\n</code></pre>\n\n<p>into these structs</p>\n\n<pre><code>type Iteration4RequestBody struct {\n    Symbol string             `json:\"symbol\"`\n    Params []Iteration4Params `json:\"params\"`\n}\n\ntype Iteration4Params struct {\n    Forward   int    `json:\"forward\"`\n    Period    int    `json:\"period\"`\n    Ref       string `json:\"ref\"`\n    Indicator string `json:\"indicator\"`\n    Freq      string `json:\"freq\"`\n}\n</code></pre>\n\n<p>I need to be able to use []Iteration4Params, but right now, this is empty when I decode it</p>\n\n<p>EDIT 2 (NEW CODE I USED)</p>\n\n<pre><code>body, err := ioutil.ReadAll(r.Body)\nif err != nil {\n    panic(err)\n}\nvar t Iteration4RequestBody\nerr = json.Unmarshal(body, &amp;t)\nif err != nil {\n    panic(err)\n}\nfmt.Println(t)\n</code></pre>\n\n<p>Result is {ZVZZT.O []}</p>\n\n<p>Edit 3:\nWorks now. Can't remember the last thing I did before it worked though. Never mind. Thanks for all your answers by the way. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517328477, "post_id": 48525725, "comment_id": 84046455, "body": "Why are you using <code>os.Stdout.Write()</code>?  <code>fmt.Print</code> forwards directly to it."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517328681, "post_id": 48525760, "comment_id": 84046596, "body": "The json field tag is not necessary unless you need a different field name in the struct vs. the JSON."}], "tags": [], "owner": {"reputation": 2951, "user_id": 2736817, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/38f596a60d51c899ee86eaec38ec8efe?s=128&d=identicon&r=PG&f=1", "display_name": "tom10271", "link": "https://stackoverflow.com/users/2736817/tom10271"}, "is_accepted": true, "score": 9, "last_activity_date": 1551760446, "last_edit_date": 1551760446, "creation_date": 1517328324, "answer_id": 48525760, "question_id": 48525725, "link": "https://stackoverflow.com/questions/48525725/how-to-marshal-anonymous-struct/48525760#48525760", "title": "How to marshal anonymous struct?", "body": "<p><a href=\"https://play.golang.org/p/XNAKovWGhxk\" rel=\"noreferrer\">https://play.golang.org/p/XNAKovWGhxk</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    jsonString, err := json.Marshal(\n        struct{\n            Id int `json:\"theKeyYouWantToUse\"`\n        } {\n            123\n        },\n    )\n\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    os.Stdout.Write(jsonString)\n}\n</code></pre>\n\n<p>You are not exporting id attribute, change it to Id</p>\n"}, {"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 5, "last_activity_date": 1517329197, "last_edit_date": 1517329197, "creation_date": 1517328387, "answer_id": 48525779, "question_id": 48525725, "link": "https://stackoverflow.com/questions/48525725/how-to-marshal-anonymous-struct/48525779#48525779", "title": "How to marshal anonymous struct?", "body": "<p>If you use following struct, Marshal method will ignore <code>id</code> as it is not exported.</p>\n\n<pre><code>struct{id int}{123}\n</code></pre>\n\n<p>You need to export them to keep them in conversion process.</p>\n\n<blockquote>\n  <p>In Go, a name is exported if it begins with a capital letter</p>\n</blockquote>\n\n<pre><code>js, _ := json.Marshal(struct{Id int}{123})\nos.Stdout.Write(js)\n// {\"Id\":123}\n</code></pre>\n"}], "owner": {"reputation": 3339, "user_id": 1654940, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/88c65dba018958bb6462c0530016ec3b?s=128&d=identicon&r=PG", "display_name": "Marcin Doliwa", "link": "https://stackoverflow.com/users/1654940/marcin-doliwa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4368, "favorite_count": 0, "closed_date": 1517328802, "accepted_answer_id": 48525760, "answer_count": 2, "score": 5, "last_activity_date": 1559103871, "creation_date": 1517328209, "last_edit_date": 1559103871, "question_id": 48525725, "link": "https://stackoverflow.com/questions/48525725/how-to-marshal-anonymous-struct", "closed_reason": "Duplicate", "title": "How to marshal anonymous struct?", "body": "<p>Why do I get <code>{}</code> when trying to marshal an anonymous struct?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    js, err := json.Marshal(struct{id int}{123})\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(js)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lEqJ1uj1ezS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lEqJ1uj1ezS</a></p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517325125, "post_id": 48524388, "comment_id": 84044075, "body": "How about split the <code>div-block</code> into open and end tag? Like <code>{{ template &quot;div-begin&quot; . }} something {{template &quot;div-end&quot; . }}</code>?"}, {"owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517325528, "post_id": 48524388, "comment_id": 84044346, "body": "This is a good point, thank you. However, question is still open in case there can be more variants"}], "answers": [{"tags": [], "owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "is_accepted": false, "score": 0, "last_activity_date": 1517335553, "creation_date": 1517335553, "answer_id": 48527838, "question_id": 48524388, "link": "https://stackoverflow.com/questions/48524388/go-template-nested-templated/48527838#48527838", "title": "go template - nested templated", "body": "<p>You can use nested template in go template.</p>\n\n<pre><code>divBlock := `&lt;div&gt;Hello div\n                {{block \"header\" .}} {{.}} {{end}}\n             &lt;/div&gt;`\nheader := `&lt;header&gt;Hello Header&lt;/header&gt;`\n\ndivTempl, err := template.New(\"master\").Parse(divBlock)\nif err != nil {\n    log.Fatal(err)\n}\nif err := divTempl.Execute(os.Stdout, header); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Go-playground link: <a href=\"https://play.golang.org/p/K36l3bn5753\" rel=\"nofollow noreferrer\">https://play.golang.org/p/K36l3bn5753</a></p>\n\n<p>Or</p>\n\n<p>You can use if statement. Check whether there is some template, then append, otherwise empty.</p>\n\n<pre><code>const (\n    divBlock = `&lt;div style=\"display:block\"&gt;\n                 .....\n            {{if \"injectedTmpl\"}}{{.}}{{end}}\n           &lt;/div&gt;`\n)   \ninjectedTmpl := `&lt;header&gt;Hello Header&lt;/header&gt;`\n\ndivTmpl, err := template.New(\"div\").Parse(divBlock)\nif err != nil {\n    log.Fatal(err)\n}\nif err := divTmpl.Execute(os.Stdout, injectedTmpl); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Go-playground link: <a href=\"https://play.golang.org/p/pZaqXtCHHAL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pZaqXtCHHAL</a></p>\n"}, {"tags": [], "owner": {"reputation": 57, "user_id": 12811196, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCyWpwb0x3iebCMSEmeycADs3b25xQj8rby1WgpDA=k-s128", "display_name": "Sai Vamsi", "link": "https://stackoverflow.com/users/12811196/sai-vamsi"}, "is_accepted": false, "score": 0, "last_activity_date": 1581920362, "creation_date": 1581920362, "answer_id": 60256863, "question_id": 48524388, "link": "https://stackoverflow.com/questions/48524388/go-template-nested-templated/60256863#60256863", "title": "go template - nested templated", "body": "<p>define another template outside, and use it inside div-block template </p>\n"}], "owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1581920362, "creation_date": 1517324194, "last_edit_date": 1517350727, "question_id": 48524388, "link": "https://stackoverflow.com/questions/48524388/go-template-nested-templated", "title": "go template - nested templated", "body": "<p>I have several go templates. The below examples are oversimplified, but it states my idea correctly. For example, I have </p>\n\n<pre><code>{{ define \"div-block\" }}\n   &lt;div style=\"display:block\"&gt;\n         .....\n   &lt;/div&gt;\n{{ end }}\n</code></pre>\n\n<p>Now I want to transfer any other template inside <code>div-block</code> when using it, so that I could put anything inside div. E.g:</p>\n\n<pre><code>{{ template \"div-block\" . }}\n    {{ template \"header\" }}\n{{ end }}\n\n{{ template \"div-block\" . }}\n    &lt;ul&gt;\n       &lt;li&gt;1&lt;/li&gt;\n    &lt;/ul&gt;\n{{ end }}\n</code></pre>\n\n<p>Where \"header\" is some other template.</p>\n\n<p>Which is the the right way to do this with go template? Is it possible to do it with custom function? Is it possible to make custom <code>actions</code> in go template? (actions can have <code>end</code>  statement and therefore the body, while functions are not)</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517324191, "post_id": 48524298, "comment_id": 84043447, "body": "You can&#39;t. Go uses static types. You <i>could</i> use a map instead, if being dynamic is a requirement."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1517326222, "post_id": 48524298, "comment_id": 84044857, "body": "you can&#39;t use structure if you want dynamic types to be created. All you can do is use interface to assign values to dynamic keys created inside interface"}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 9226947, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GneVo.jpg?s=128&g=1", "display_name": "glinton", "link": "https://stackoverflow.com/users/9226947/glinton"}, "edited": false, "score": 0, "creation_date": 1517332955, "post_id": 48527084, "comment_id": 84049181, "body": "Another way you could go is to enhance your original <code>Application</code> struct to include a <code>Version string</code> element. Though the end result would be slightly different: <code>&quot;Applications&quot;:{{&quot;App&quot;:&quot;App1&quot;, &quot;Version&quot;:&quot;Version1&quot;},{&quot;App&quot;:&quot;App2&quot;, &quot;Version&quot;:&quot;Version2&quot;}}</code>"}], "tags": [], "owner": {"reputation": 27, "user_id": 9226947, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GneVo.jpg?s=128&g=1", "display_name": "glinton", "link": "https://stackoverflow.com/users/9226947/glinton"}, "is_accepted": false, "score": 0, "last_activity_date": 1517332694, "creation_date": 1517332694, "answer_id": 48527084, "question_id": 48524298, "link": "https://stackoverflow.com/questions/48524298/go-nested-struct/48527084#48527084", "title": "Go nested struct", "body": "<p>As mentioned, using a <code>map</code> for <code>Final</code>'s <code>Applications</code> is likely what you are after.</p>\n\n<pre><code>type Final struct {\n    Name         string `json:\"Name\"`\n    Applications map[string]string\n}\n</code></pre>\n\n<p>Then you can assign it as in your attempts:</p>\n\n<pre><code>final := Final{\n    Name: \"Test\",\n    Applications: GetApps(),\n}\n</code></pre>\n\n<p>Make sure <code>GetApps()</code> returns a <code>map[string]string</code> and you will have your dynamic keys when json marshalling.</p>\n\n<p>See <a href=\"https://play.golang.org/p/FLMVrZEbal6\" rel=\"nofollow noreferrer\">an example here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 0, "last_activity_date": 1517377879, "creation_date": 1517377879, "answer_id": 48535317, "question_id": 48524298, "link": "https://stackoverflow.com/questions/48524298/go-nested-struct/48535317#48535317", "title": "Go nested struct", "body": "<p>I don't see why you would need anything to be dynamic. This refactor seems to cover your case:</p>\n\n<pre><code>  type Application {\n          Name string\n          Detail string\n  }\n\n  type Final struct {\n          Name string\n          Applications []Application\n  }\n\n  func GetApps() []Application {\n          // ... Get a slice of Applications\n          return []Application{}\n  }\n\n  func main() {\n          final := Final{\n                  Name: \"Test\",\n                   Applications: []Application{}\n          }\n\n          for _, app := range GetApps() {\n                   final.Applications = append(final.Applications, app)\n          }\n\n          // final is ready\n  }\n</code></pre>\n\n<p>Type <code>Application</code> could also be a <code>map[string]string</code> like other have mentioned or a struct it doesn't matter because the type is known at compile time and there is no need for dynamic type here.</p>\n"}], "owner": {"reputation": 1, "user_id": 6866359, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-e0QDsGEhuFA/AAAAAAAAAAI/AAAAAAAAAOU/g2BY7zhB5RE/photo.jpg?sz=128", "display_name": "sneha nair", "link": "https://stackoverflow.com/users/6866359/sneha-nair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1517377879, "creation_date": 1517323916, "last_edit_date": 1517328096, "question_id": 48524298, "link": "https://stackoverflow.com/questions/48524298/go-nested-struct", "title": "Go nested struct", "body": "<p>How do I create a Go struct something like this,</p>\n\n<pre><code>{Name:Test { App1:Version1 App2:Version2}} \n</code></pre>\n\n<p>using Go where <code>App1/2</code> and <code>Version1/2</code> is dynamic.</p>\n\n<p>I have tried the follwing,</p>\n\n<pre><code>type Final struct {\n        App string `json:\"Name\"`\n        Applications [] Application\n}\ntype final []Final\ntype Application struct {\n         App string `json:`\n}\n\nfinal := Final {\n        Name:\"Test\",\n        Applications: []Application{\n                {GetApps()},\n        },\n        }\n</code></pre>\n\n<p>where GetApps will return a list of App details, instead I would like to have a key value pair where key would be the Appname and value would be its details. I just need a syntax, kindly help</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517322857, "post_id": 48523811, "comment_id": 84042425, "body": "You&#39;re trying to access (set, get, doesn&#39;t matter) an unexported field from another package. The compiler won&#39;t let you do it, even if you&#39;re trying to use a composite literal to initialize it."}, {"owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517322984, "post_id": 48523811, "comment_id": 84042525, "body": "@Marc - ok but im trying to initate object why its not working , I require it..."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517323133, "post_id": 48523811, "comment_id": 84042642, "body": "Because this is the same as saying <code>run.MyRunner{path:&quot;a&#47;b&#47;c&quot;}</code>, you&#39;re still accessing the unexported field from another package. If you want your object initialized, you can have a helper in the same package:  <code>func NewRunner(p string) *Runner { return &amp;Runner{path: p} }</code>, or just export the field."}, {"owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517323747, "post_id": 48523811, "comment_id": 84043102, "body": "@Marc - thanks a lot, which way is prefered?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517323785, "post_id": 48523811, "comment_id": 84043129, "body": "It ultimately depends on whether this field is supposed to be used from outside the package or not. If you don&#39;t care, make it exported."}, {"owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517323924, "post_id": 48523811, "comment_id": 84043234, "body": "@marc, thanks a lot, I will use your suggestion , btw how should I initiate your suggestion <code>func NewRunner(p string) *Runner { return &amp;Runner{path: p} }</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "edited": false, "score": 0, "creation_date": 1517323501, "post_id": 48524005, "comment_id": 84042920, "body": "ok thanks 1+ since I need to use it as constructor field it should be \u201cpublic\u201d , am I right? or should I use accesor methods ?"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 2, "last_activity_date": 1517323886, "last_edit_date": 1517323886, "creation_date": 1517323179, "answer_id": 48524005, "question_id": 48523811, "link": "https://stackoverflow.com/questions/48523811/access-struct-property-in-go/48524005#48524005", "title": "Access struct property in Go", "body": "<p>In Go every field starting with lower case letter is considered private and is accessible only within its package.  Simply change the name to <code>Path</code>.</p>\n\n<pre><code>type MyRunner struct {\n    Path string\n}\n</code></pre>\n\n<p>This rule applies to other identifiers in Go: type names, function names. See <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported identifiers</a> on documenation.</p>\n\n<p>If you don't want to make the field public. Write a funciton that will act as a constructor.</p>\n\n<pre><code>type MyRunner struct {\n    path string\n}\n\nfunc NewMyRunner(path string) *MyRunner {\n    return &amp;MyRunner{path}\n}\n</code></pre>\n\n<p>Example from standard library <a href=\"https://golang.org/pkg/container/list/#New\" rel=\"nofollow noreferrer\">container.list.New</a></p>\n"}], "owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "closed_date": 1517323380, "accepted_answer_id": 48524005, "answer_count": 1, "score": 0, "last_activity_date": 1517359503, "creation_date": 1517322608, "last_edit_date": 1517359503, "question_id": 48523811, "link": "https://stackoverflow.com/questions/48523811/access-struct-property-in-go", "closed_reason": "Duplicate", "title": "Access struct property in Go", "body": "<p>Now I\u2019ve struct which implements this interface like following</p>\n\n<pre><code>type MyRunner struct {\n    path string\n}\n\nfunc (r MyRunner) soSomthing(newPath string) error {\n    run(path)\n    return nil\n}\n</code></pre>\n\n<p>Now I want to create the object and I got error \nimplicit assignment of unexported field 'path' in MyRunner literal</p>\n\n<p>This is how I do it</p>\n\n<pre><code>&amp;run.MyRunnter{\u201da/b/c/\u201c}\n</code></pre>\n\n<p>is there a way to do it without the New keyword in Go ?</p>\n"}, {"tags": ["java", "arrays", "go"], "comments": [{"owner": {"reputation": 50669, "user_id": 1711796, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6pRI7.png?s=128&g=1", "display_name": "Bernhard Barker", "link": "https://stackoverflow.com/users/1711796/bernhard-barker"}, "edited": false, "score": 3, "creation_date": 1517316725, "post_id": 48521909, "comment_id": 84038348, "body": "You might want to explain what the method does, as the question currently (unnecessarily) requires both Go and Java knowledge to answer, which reduces the likelihood of getting an answer as well as the future value of the question."}, {"owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "edited": false, "score": 0, "creation_date": 1517316801, "post_id": 48521909, "comment_id": 84038401, "body": "<a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#copy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1517317222, "last_edit_date": 1517317222, "creation_date": 1517316869, "answer_id": 48521981, "question_id": 48521909, "link": "https://stackoverflow.com/questions/48521909/whats-the-equivalent-of-java-arrays-copyofrange-in-go/48521981#48521981", "title": "Whats the equivalent of Java Arrays.copyOfRange in Go?", "body": "<p>A simple one-liner would be (index check omitted):</p>\n\n<pre><code>func copyOfRange(src []byte, from, to int) []byte {\n    return append([]byte(nil), src[from:to]...)\n}\n</code></pre>\n\n<p>A simple <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">slice expression</a> \"almost\" does the job, but since Java's <code>Arrays.copyOfRange()</code> returns a copy independent from the source, we need to copy the slicing result to a new slice (because the result of slicing will share the backing array).</p>\n\n<p>We can do that by allocating one with <a href=\"https://golang.org/pkg/builtin/#make\" rel=\"nofollow noreferrer\"><code>make()</code></a>, and use the builtin <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"nofollow noreferrer\"><code>copy()</code></a>, or simply use <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> to append it to an empty or <code>nil</code> slice, which will take care of the allocation and copying.</p>\n\n<p>Example using the above function:</p>\n\n<pre><code>src := []byte{0, 1, 2, 3, 4, 5}\ndst := copyOfRange(src, 2, 4)\nfmt.Println(dst)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/nXgYWaAFB_D\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[2 3]\n</code></pre>\n\n<p>For completeness, this is how it would look like with <code>make()</code> and <code>copy()</code>:</p>\n\n<pre><code>func copyOfRange2(src []byte, from, to int) []byte {\n    src = src[from:to]\n    dst := make([]byte, len(src))\n    copy(dst, src)\n    return dst\n}\n</code></pre>\n\n<p>One thing to note here: the builtin <code>append()</code> allocates more space than needed, thinking of future growth. So if you don't plan to \"grow\" the returned slice, <code>copyOfRange2()</code> is a better option.</p>\n\n<p>See this comparison:</p>\n\n<pre><code>dst := copyOfRange(src, 2, 4)\nfmt.Println(dst, cap(dst))\n\ndst = copyOfRange2(src, 2, 4)\nfmt.Println(dst, cap(dst))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/OI_TsGDzuo4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[2 3] 8\n[2 3] 2\n</code></pre>\n\n<p>As you can see, <code>append()</code> (inside <code>copyOfRange()</code>) allocated a backing array with a size of <code>8</code>, while in our <code>copyOfRange2()</code> we explicitly allocated a slice (and backing array) of size <code>2</code>.</p>\n"}], "owner": {"reputation": 570, "user_id": 4404241, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5a71195400e2efad87b71c0d5df1e450?s=128&d=identicon&r=PG&f=1", "display_name": "Alvin Reyes", "link": "https://stackoverflow.com/users/4404241/alvin-reyes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517317222, "creation_date": 1517316569, "question_id": 48521909, "link": "https://stackoverflow.com/questions/48521909/whats-the-equivalent-of-java-arrays-copyofrange-in-go", "title": "Whats the equivalent of Java Arrays.copyOfRange in Go?", "body": "<p>I'm working on the creating a Java library that deals with management of Arrays. Is there an equivalent of Arrays.copyOfRange in Go?</p>\n"}, {"tags": ["go", "go-micro"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517312434, "post_id": 48520523, "comment_id": 84035615, "body": "What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517313820, "post_id": 48520523, "comment_id": 84036541, "body": "I want to have a consistent docker image with <i>micro</i>, each time I build it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517313887, "post_id": 48520523, "comment_id": 84036579, "body": "Okay, but what have you tried? And what problems did you encounter?"}, {"owner": {"reputation": 131, "user_id": 1079248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0197d25b2b46594be7f6b50838fe7c88?s=128&d=identicon&r=PG", "display_name": "ealves", "link": "https://stackoverflow.com/users/1079248/ealves"}, "edited": false, "score": 1, "creation_date": 1517315950, "post_id": 48520523, "comment_id": 84037848, "body": "In our first approach to lock the vendors we have used dep as well but the main set back was its speed. It took ages to build download everything. We have since then switched to Glide and it has been working in production quite reliably. You just have to take the time to define in your glide.yaml each vendor and the version you want to lock."}, {"owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517378403, "post_id": 48520523, "comment_id": 84066126, "body": "@Flimzy I described in my question the way I&#39;m trying to build docker image with <i>micro</i>. I just what to confirm or refuse does it a correct way to build docker image with frozen <i>micro</i> version with dependencies or not."}, {"owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "reply_to_user": {"reputation": 131, "user_id": 1079248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0197d25b2b46594be7f6b50838fe7c88?s=128&d=identicon&r=PG", "display_name": "ealves", "link": "https://stackoverflow.com/users/1079248/ealves"}, "edited": false, "score": 0, "creation_date": 1517378646, "post_id": 48520523, "comment_id": 84066219, "body": "@ealves thank you for what you shared your experience with dep and glide"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517383856, "post_id": 48520523, "comment_id": 84068435, "body": "Your question skips the entire &quot;build docker image&quot; step, which is the essential one for answering your question. In particular, your Dockerfile is essential to answer your question."}, {"owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517471525, "post_id": 48520523, "comment_id": 84111231, "body": "@Flimzy hm, I don&#39;t see how it can help but OK I build docker image using a docker file like that <a href=\"https://github.com/micro/micro/blob/master/Dockerfile\" rel=\"nofollow noreferrer\">github.com/micro/micro/blob/master/Dockerfile</a>."}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 1079248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0197d25b2b46594be7f6b50838fe7c88?s=128&d=identicon&r=PG", "display_name": "ealves", "link": "https://stackoverflow.com/users/1079248/ealves"}, "is_accepted": false, "score": 1, "last_activity_date": 1517318837, "creation_date": 1517318837, "answer_id": 48522600, "question_id": 48520523, "link": "https://stackoverflow.com/questions/48520523/how-to-freeze-micro-version-with-dependencies/48522600#48522600", "title": "How to freeze micro version with dependencies?", "body": "<p>An example of a Dockerfile can be:</p>\n\n<pre><code>FROM golang:1.9-alpine3.6 as builder\n\n# Install package manager\nRUN apk add --no-cache --virtual .go-dependencies git curl \\\n  &amp;&amp; curl https://glide.sh/get | sh\n\n# Copy files from context\nWORKDIR /go/src/github.com/foo/bar\nCOPY . .\n\n# Install project dependencies, test and build\nRUN glide install \\\n  &amp;&amp; go test ./... \\\n  &amp;&amp; CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags '-w' -i -o ./entry ./main.go ./plugins.go\n\n# Build final image with binary\nFROM alpine:3.6\nRUN apk add --update ca-certificates &amp;&amp; \\\n    rm -rf /var/cache/apk/* /tmp/*\nWORKDIR /\nCOPY --from=builder /go/src/github.com/foo/bar/entry .\nENTRYPOINT [ \"/entry\" ]\n</code></pre>\n\n<p>And the glide.yaml would look like this:</p>\n\n<pre><code>package: .\nimport:\n- package: github.com/micro/go-micro\n  version: ^0.3.0\n  subpackages:\n  - client\n  - server\n- package: github.com/micro/go-plugins\n  version: ^0.6.1\n  subpackages:\n  - wrapper/trace/opentracing\n  - broker/nats\n  - transport/nats\n- package: github.com/opentracing/opentracing-go\n  version: ^1\n- package: github.com/openzipkin/zipkin-go-opentracing\n  version: ^0.3\ntestImport:\n- package: github.com/golang/mock\n  subpackages:\n  - gomock\n- package: github.com/smartystreets/goconvey\n  subpackages:\n  - convey\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "is_accepted": true, "score": 0, "last_activity_date": 1517892308, "creation_date": 1517892308, "answer_id": 48635638, "question_id": 48520523, "link": "https://stackoverflow.com/questions/48520523/how-to-freeze-micro-version-with-dependencies/48635638#48635638", "title": "How to freeze micro version with dependencies?", "body": "<p>In my case, <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> looks great and fast enough, moreover, it's official dependency manager in go so I think it's a right choice.</p>\n"}], "owner": {"reputation": 667, "user_id": 6167230, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-XiyGDlqsGf8/AAAAAAAAAAI/AAAAAAAABCU/CLNQSdR-PwU/photo.jpg?sz=128", "display_name": "Pavel Prischepa", "link": "https://stackoverflow.com/users/6167230/pavel-prischepa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 48635638, "answer_count": 2, "score": -2, "last_activity_date": 1517892308, "creation_date": 1517312316, "question_id": 48520523, "link": "https://stackoverflow.com/questions/48520523/how-to-freeze-micro-version-with-dependencies", "title": "How to freeze micro version with dependencies?", "body": "<p>I want to build a docker image with a fixed version of <em>micro</em> and go dependencies. I plan to do it with <code>dep</code>:</p>\n\n<pre><code>git checkout git@github.com:micro/micro.git\ndep ensure\ngit add Gopkg.toml\ngit add Gopkg.lock\n\n# Build micro\nCGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags '-w' -i -o micro ./main.go \n\n# Build docker image\n...\n</code></pre>\n\n<p>So, my question is does it the best solution to build consistent <em>micro</em> docker image?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517308646, "post_id": 48519081, "comment_id": 84033237, "body": "Have you tried anything?"}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309142, "post_id": 48519374, "comment_id": 84033580, "body": "Didn&#39;t the op asks fn to be a method of the same type?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309240, "post_id": 48519374, "comment_id": 84033645, "body": "You can do that just the same IIRC, I&#39;ll revise my answer a bit"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517309355, "post_id": 48519374, "comment_id": 84033716, "body": "OP asks for methods with receiver"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1517309449, "post_id": 48519374, "comment_id": 84033787, "body": "@aerokite This works because Method Expressions (methods with receivers) are actually just syntactic sugar for a function like sample <code>func(*A, int, string)</code> (for <code>(*A).fn(int, string)</code>)."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517309567, "post_id": 48519374, "comment_id": 84033880, "body": "@KavehShahbazian With interface and composition in mind, not quite."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309596, "post_id": 48519374, "comment_id": 84033904, "body": "@leafbebop See my revised answer. You can extract a method by name and then call it."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517309597, "post_id": 48519374, "comment_id": 84033905, "body": "I was overthinking it and doing the wrong thing by trying to actually work with the pointer in the reflect package. It was unnecessary because it doesn&#39;t matter when using <code>reflect.ValueOf(...)</code>."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1517309643, "post_id": 48519374, "comment_id": 84033929, "body": "@Not_a_Golfer Your answer is perfect and exact."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309683, "post_id": 48519374, "comment_id": 84033954, "body": "@leafbebop That works only if you know the name of the method."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309686, "post_id": 48519374, "comment_id": 84033956, "body": "And this time it is using a string. I am not saying this is not good or anything, but somehow not to the exact question."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517309721, "post_id": 48519374, "comment_id": 84033975, "body": "@KavehShahbazian What works only if I know the name of method?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309788, "post_id": 48519374, "comment_id": 84034024, "body": "@leafbebop I do not know exactly. But the answer (the first part) was what I asked and it works perfectly."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517309825, "post_id": 48519374, "comment_id": 84034047, "body": "And I do not ask you to know exactly. Are you sure you are replying to the right person?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1517309950, "post_id": 48519374, "comment_id": 84034127, "body": "Seems like OP got the question a bit wrong and I got the answer a bit wrong but it was the same wrong? :)"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517310644, "post_id": 48519374, "comment_id": 84034531, "body": "@leafbebop I do not get the <i>wrong</i> part! :) If the name was known at the time of coding, it would be possible to just use a dummy interface. If the method name was known as a string, it would be possible to find method by name (as described in the second part). Otherwise the first part is the answer."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517310820, "post_id": 48519374, "comment_id": 84034639, "body": "@KavehShahbazian the first part requires you to change the code of the orignal type: remove a method and it would break and hinder <b>other</b> part of code which accept it as a non-empty interface or use it embedded."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517311105, "post_id": 48519374, "comment_id": 84034796, "body": "@leafbebop The question is how to call <code>func someFunc(v interface{}, fn interface{})</code> where <i>all we know</i> is v is a pointer to struct and <code>fn</code> is a method of <code>v</code>; is there other way to do so other than reflection in Go?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517311267, "post_id": 48519374, "comment_id": 84034892, "body": "@KavehShahbazian No, there is not, and I said nothing about <b>not using it with reflection</b>, did I? What I oppose, is consindering change <code>func (foo *Foo) f() to </code>func f(foo *Foo)` trivial. Methods is not just a syntax sugar. Am I clear?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517311380, "post_id": 48519374, "comment_id": 84034969, "body": "@leafbebop This is working on my machine the way described in the answer! So it might be a syntactic sugar in this one case! ;)"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517311477, "post_id": 48519374, "comment_id": 84035022, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/164176/discussion-between-kaveh-shahbazian-and-leaf-bebop\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 0, "last_activity_date": 1517309567, "last_edit_date": 1517309567, "creation_date": 1517308768, "answer_id": 48519374, "question_id": 48519081, "link": "https://stackoverflow.com/questions/48519081/call-method-expression-with-pointer-to-struct-as-receiver/48519374#48519374", "title": "Call Method Expression with Pointer to Struct as Receiver", "body": "<p>It's possible to do with <code>reflect.Value.Call()</code>, however it's pretty cumbersome, especially if you need to do something with the return value. But here's a basic example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo struct {\n    Bar string\n}\n\nfunc concrete(foo *Foo) {\n    fmt.Printf(\"Foo: %#v\\n\", foo)\n}\n\nfunc someFunc(v interface{}, fn interface{}) {\n\n    f := reflect.ValueOf(fn)\n    arg := reflect.ValueOf(v)\n\n    f.Call([]reflect.Value{arg})\n}\n\nfunc main() {\n    foo := Foo{\"Bar\"}\n    someFunc(&amp;foo, concrete)\n\n}\n\n// Output: Foo: &amp;main.Foo{Bar:\"Bar\"}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ED6QdvENxti\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ED6QdvENxti</a></p>\n\n<p>If you want to call a method of a struct by name, we need to revise it just a bit:</p>\n\n<pre><code>type Foo struct {\n    Bar string\n}\n\nfunc (f *Foo) Concrete() {\n    fmt.Printf(\"Foo: %#v\\n\", f)\n}\n\nfunc callByName(v interface{}, fn string) {\n    arg := reflect.ValueOf(v)\n    f := arg.MethodByName(fn)\n    f.Call([]reflect.Value{})\n}\n\nfunc main() {\n    foo := Foo{\"Bar\"}\n    callByName(&amp;foo, \"Concrete\")\n\n}\n</code></pre>\n\n<p>Notice that in this case the method value is already bound to the struct instance, so we don't need to pass it anything as an argument.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517467549, "post_id": 48519963, "comment_id": 84109448, "body": "I am more than happy to delete the answer if anyone can show a different approach."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": -3, "last_activity_date": 1517318043, "last_edit_date": 1517318043, "creation_date": 1517310623, "answer_id": 48519963, "question_id": 48519081, "link": "https://stackoverflow.com/questions/48519081/call-method-expression-with-pointer-to-struct-as-receiver/48519963#48519963", "title": "Call Method Expression with Pointer to Struct as Receiver", "body": "<p>So to the challenge of using reflect to call a method without knowing name and being a method of the same type, as op (orignally) addressed, I have come up with a very, very ugly and unsafe way.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"runtime\"\n    \"strings\"\n)\n\nfunc getFName(v reflect.Value) string {\n    return runtime.FuncForPC(v.Pointer()).Name()\n}\n\nfunc callMethod(a,fn interface{}) {\n    fname:=getFName(reflect.ValueOf(fn))\n    parts:=strings.Split(fname,\".\")\n    name:=strings.TrimSuffix(parts[len(parts)-1],\"-fm\")\n\n    reflect.ValueOf(a).MethodByName(name).Call(nil)\n}\nfunc (s *a) Tst() {\n    fmt.Println(s)\n}\n\ntype a struct { p string }\n\nfunc main() {\n\n    x,y:=a{\"Good\"},a{\"Bad\"}\n\n    callMethod(&amp;x,y.Tst)\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/QgrGhI5DC3p\" rel=\"nofollow noreferrer\">https://play.golang.org/p/QgrGhI5DC3p</a></p>\n\n<p>I would like to know a better way that does not rely on how <code>runtime.FuncForPc</code> formats methods (which is not version-safe), but this is the best I have. Please do tell me any ideas to improve it.</p>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 48519374, "answer_count": 2, "score": 1, "last_activity_date": 1517318043, "creation_date": 1517307839, "question_id": 48519081, "link": "https://stackoverflow.com/questions/48519081/call-method-expression-with-pointer-to-struct-as-receiver", "title": "Call Method Expression with Pointer to Struct as Receiver", "body": "<p>There is <code>func someFunc(v interface{}, fn interface{})</code> where <code>v</code> is a pointer to struct (say <code>*A</code>) and fn is a method expression (say <code>(*A).method()</code>). How to call <code>fn</code> with <code>v</code> as parameter (using <code>reflect</code>)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 2, "creation_date": 1517311250, "post_id": 48518820, "comment_id": 84034880, "body": "This guideline is very useful (and many official Go tools follow it) <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">github.com/golang-standards/project-layout</a>"}, {"owner": {"reputation": 85, "user_id": 4042645, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/oRKTx.jpg?s=128&g=1", "display_name": "awagner", "link": "https://stackoverflow.com/users/4042645/awagner"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517326934, "post_id": 48518820, "comment_id": 84045375, "body": "Thanks. I know the guideline and in fact, this is (some of) what made me move the source for my executable to cmd/. Only I end up with no main package in the project&#39;s root and a simple <code>go build</code>/<code>go install</code> from the project&#39;s root will not do anything. But as far as I understand it now, based on @dev.bmax&#39;s answer, actually that is nothing to be afraid of. I will probably script building the cmd/myapp/main.go and then moving it to some other place where it is more easily accessible. (And where it more easily finds the relevant config file.)"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517379736, "post_id": 48518820, "comment_id": 84066668, "body": "You are right. And the structure is used mostly for multi command (set of) tools. But it has useful semantics like if another package tries to import from <code>internal</code> packages of this project, it will produce a compilation error."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 4042645, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/oRKTx.jpg?s=128&g=1", "display_name": "awagner", "link": "https://stackoverflow.com/users/4042645/awagner"}, "edited": false, "score": 1, "creation_date": 1517353464, "post_id": 48519785, "comment_id": 84059428, "body": "So having no &quot;main&quot; package in the project&#39;s root directory is not a problem and building with <code>go build cmd&#47;myapp</code> (or install) is not so uncommon or even absurd. I think I will still copy the binary to some other place (manually or with a kind of build script), but that&#39;s no problem actually. Also, reading more I found out that the project as a whole is perfectly go-gettable - when you <code>go get gitlab.tld&#47;username&#47;myapp&#47;...</code> <b>with the three dots at the end</b>. So my worries about organizing it all wrong after all are somewhat attenuated. Thanks for pointing me in the right direction."}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 3, "last_activity_date": 1517309992, "creation_date": 1517309992, "answer_id": 48519785, "question_id": 48518820, "link": "https://stackoverflow.com/questions/48518820/is-it-ok-to-put-the-one-main-package-in-a-cmd-myapp-subdirectory/48519785#48519785", "title": "Is it ok to put the one main package in a cmd/myapp subdirectory?", "body": "<p>When you run <code>go build</code> or <code>go install</code> the command expects a list of packages to process. If no import paths are given, the action applies to the package in the current directory. </p>\n\n<p>So if there is no <code>package main</code> in your root directory, no executable will be produced.</p>\n\n<p>The command doesn't look in subdirectories. You may have multiple commands in your <code>cmd</code> directory. In this case it won't know which one to build. And building all of them every time is wasteful.</p>\n"}], "owner": {"reputation": 85, "user_id": 4042645, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/oRKTx.jpg?s=128&g=1", "display_name": "awagner", "link": "https://stackoverflow.com/users/4042645/awagner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1168, "favorite_count": 4, "accepted_answer_id": 48519785, "answer_count": 1, "score": 5, "last_activity_date": 1517310621, "creation_date": 1517307104, "question_id": 48518820, "link": "https://stackoverflow.com/questions/48518820/is-it-ok-to-put-the-one-main-package-in-a-cmd-myapp-subdirectory", "title": "Is it ok to put the one main package in a cmd/myapp subdirectory?", "body": "<p>this is my first Go project and I have had a hard time grasping the different documents on code organization (e.g. I found it somewhat hard to tell which ones have been superceded, or apply to deprecated vendoring tools/approaches). I finally settled on Ben Johnson's <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"noreferrer\">Standard Package Layout</a>, with a very slim root package (in the root directory of my project) and most code in internal/pkg/...</p>\n\n<p>However, I've added a cmd/myapp dir and put my main.go file for the executable program in there, since I understood that to be a common pattern.</p>\n\n<p>So now I have:</p>\n\n<pre><code>myapp\n|\n+- myapp.go   // \"package myapp\", with only type and interface declarations and no imports\n|\n+- cmd\n|   |\n|   +- main.go // \"package main\", with import gitlab.tld/username/myapp, gitlab.tld/username/myapp/internal/pkg/routing etc.\n|\n+- internal\n    |\n    +- pkg\n        |\n        +- routing\n        |    |\n        |    +- routing.go // \"package routing\"\n        |\n        +- sql \n        |\n        +- etc.\n</code></pre>\n\n<p>Now, when I go to cmd/myapp and call <code>go build</code>, it builds fine and leaves an executable that does what it's supposed to do right there. But when I call <code>go build -v</code> from the project's main directory, no executable is produced. In fact, only myapp.go seems to be processed which contains only type definitions. (And of course, <code>go install</code> does not produce a binary either. <code>go get -v gitlab.tld/username/myapp</code> also does not seem to do anything.)</p>\n\n<p>So I have the suspicion that this is not how it is meant after all, but I am not even so sure about that. Is there a problem with the project layout, or did I get the usage of go tooling wrong?</p>\n\n<p>Thanks for any help you might provide to this go newbie,</p>\n\n<p>Andreas</p>\n"}, {"tags": ["go", "locale"], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 3894, "user_id": 279355, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87dd83e44550f39bea6f712af8d3aef3?s=128&d=identicon&r=PG", "display_name": "grundic", "link": "https://stackoverflow.com/users/279355/grundic"}, "edited": false, "score": 1, "creation_date": 1517307516, "post_id": 48518712, "comment_id": 84032432, "body": "The dude abides"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 5, "last_activity_date": 1517307203, "last_edit_date": 1517307203, "creation_date": 1517306746, "answer_id": 48518712, "question_id": 48518540, "link": "https://stackoverflow.com/questions/48518540/how-to-get-valid-ietf-language-tag-from-a-string/48518712#48518712", "title": "How to get valid IETF language tag from a string", "body": "<p>There's a package in the external packages repository of Go (maintained by the Go project but not part of the standard library), that handles parsing and validation of language tags.</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/text/language\" rel=\"noreferrer\">https://godoc.org/golang.org/x/text/language</a></p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"golang.org/x/text/language\"\n)\n\nfunc main() {\n   tag := language.Make(\"en_us\")\n   fmt.Println(tag)\n}\n// Output: en-US\n</code></pre>\n\n<p>Note that <code>language.Make()</code> omits the error in case of an invalid tag. You should use <code>language.Parse()</code> which returns an error in practice.</p>\n"}], "owner": {"reputation": 3894, "user_id": 279355, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87dd83e44550f39bea6f712af8d3aef3?s=128&d=identicon&r=PG", "display_name": "grundic", "link": "https://stackoverflow.com/users/279355/grundic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 48518712, "answer_count": 1, "score": 1, "last_activity_date": 1517307203, "creation_date": 1517306177, "question_id": 48518540, "link": "https://stackoverflow.com/questions/48518540/how-to-get-valid-ietf-language-tag-from-a-string", "title": "How to get valid IETF language tag from a string", "body": "<p>I would like to convert locale tag to IETF standard.\nIETF language tag asserts <code>en-US</code> as a correct tag for American English.\nIn may case, it's possible that I would get <code>en_US</code> as an input.</p>\n\n<p>Currently I'm using this method:</p>\n\n<pre><code>func toLanguageTag(l string) string {\n    return strings.Replace(l, \"_\", \"-\", -1)\n}\n</code></pre>\n\n<p>For example, I know that Java has <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/Locale.html#toLanguageTag()\" rel=\"nofollow noreferrer\"><code>toLanguageTag</code></a> method. Should I continue use this approach, or there is more preferable way to do what I want?</p>\n"}, {"tags": ["go", "concurrency", "deadlock"], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517333354, "post_id": 48517817, "comment_id": 84049425, "body": "Incidentally, recommended practice is for the <i>sending</i> routine to close the channel anyway, and in such a case, the waitgroup is completely unnecessary, since closing the channel indicates that the <code>rec_readdir</code> routine has returned and no more values will be sent."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1517304057, "creation_date": 1517304057, "answer_id": 48517817, "question_id": 48517771, "link": "https://stackoverflow.com/questions/48517771/deadlock-on-closing-chan/48517817#48517817", "title": "Deadlock on closing chan", "body": "<p><code>for slink := range links</code> will continue looping until the channel is closed.  So you obviously can't close <em>after</em> that loop. When you do, you get a deadlock, as you have observed.</p>\n"}], "owner": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 48517817, "answer_count": 1, "score": 0, "last_activity_date": 1517304057, "creation_date": 1517303889, "last_edit_date": 1517303977, "question_id": 48517771, "link": "https://stackoverflow.com/questions/48517771/deadlock-on-closing-chan", "title": "Deadlock on closing chan", "body": "<p>I would like to understand why this case deadlock and why it's not in the other case.</p>\n\n<p>If I close the channel inside the goroutine, it works fine, but if I close it after the <code>WaitGroup.Wait()</code> it cause a deadlock.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"sync\"\n)\n\nvar (\n    wg    = sync.WaitGroup{}\n    links = make(chan string)\n)\n\nfunc rec_readdir(depth int, path string) {\n    files, _ := ioutil.ReadDir(path)\n    for _, f := range files {\n        if symlink, err := os.Readlink(path + \"/\" + f.Name()); err == nil {\n            links &lt;- path + \"/\" + symlink\n        }\n        rec_readdir(depth+1, path+\"/\"+f.Name())\n    }\n    if depth == 0 {\n        wg.Done()\n        // close(links) // if close here ok\n    }\n}\n\nfunc main() {\n    wg.Add(1)\n    go rec_readdir(0, \".\")\n\n    for slink := range links {\n        fmt.Println(slink)\n    }\n    wg.Wait()\n    close(links) // if close here deadlock\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Ntl_zsV5nwO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ntl_zsV5nwO</a></p>\n"}, {"tags": ["linux", "docker", "go", "continuous-integration", "bitbucket"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517303231, "post_id": 48517473, "comment_id": 84029607, "body": "It looks like a bad install of Go. You should check that the step that installs go succeeded. Maybe try a fresh install."}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517303350, "post_id": 48517473, "comment_id": 84029676, "body": "@Marc CI use default docker image with Golang 1.9, what could be wrong there?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517303473, "post_id": 48517473, "comment_id": 84029760, "body": "It depends. If it installs it by extracting the tarball, it could have failed in the middle, this wouldn&#39;t be the first time. Have you actually checked the install? What happens if you ssh into the machine and try to build something? What happens if you grab a fresh tarball and try to use that?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1517305629, "post_id": 48517473, "comment_id": 84031219, "body": "It appears that for some reason your installation doesn&#39;t want to compile the assembler files that are in the syscall package. All the &quot;missing function body&quot; refer to functions implemented in assembler"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1517316590, "post_id": 48517473, "comment_id": 84038254, "body": "You need to get the repo manually. Run <code>go get -u golang.org&#47;x&#47;sys</code> or clone the repository from <a href=\"https://github.com/golang/sys\" rel=\"nofollow noreferrer\">https://github.com/golang/sys</a> then copy it manually to vendor directory <code>bitbucket.org&#47;xxx&#47;dbcore&#47;vendor&#47;golang.org&#47;x&#47;sys&#47;</code>"}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "edited": false, "score": 0, "creation_date": 1517320683, "post_id": 48517473, "comment_id": 84040945, "body": "well, nothing helps"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517322770, "post_id": 48517473, "comment_id": 84042354, "body": "Have you checked the vendored package to see if the assembler files exist?"}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517325348, "post_id": 48517473, "comment_id": 84044204, "body": "@JimB Thanks! I&#39;ve checked repo and noticed *.s had been ignored in .gitignore and that&#39;s why I had the error. Now everything OK."}], "answers": [{"tags": [], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "is_accepted": true, "score": 2, "last_activity_date": 1517325537, "creation_date": 1517325537, "answer_id": 48524804, "question_id": 48517473, "link": "https://stackoverflow.com/questions/48517473/issue-with-golang-org-x-sys-unix-missing-function-body/48524804#48524804", "title": "Issue with golang.org/x/sys/unix missing function body", "body": "<p>Golang <code>dep</code> command copy many files to the vendor folder which I wanted to skip with .gitignore rules, so <em>.s files had been also skipped for vendor/golang.org/x/sys/</em> dep.</p>\n\n<p>Issue disappear after I exclude *.s files from .gitignore.</p>\n"}], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 0, "accepted_answer_id": 48524804, "answer_count": 1, "score": 1, "last_activity_date": 1517325537, "creation_date": 1517302899, "last_edit_date": 1517303740, "question_id": 48517473, "link": "https://stackoverflow.com/questions/48517473/issue-with-golang-org-x-sys-unix-missing-function-body", "title": "Issue with golang.org/x/sys/unix missing function body", "body": "<p>bitbucket-pipelines.yml:</p>\n\n<pre><code>image: golang:1.9\n\npipelines:\n  default:\n    - step:\n        script: # Modify the commands below to build your repository.\n          - PACKAGE_PATH=\"${GOPATH}/src/bitbucket.org/${BITBUCKET_REPO_OWNER}/${BITBUCKET_REPO_SLUG}\"\n          - mkdir -pv \"${PACKAGE_PATH}\"\n          - tar -cO --exclude-vcs --exclude=bitbucket-pipelines.yml . | tar -xv -C \"${PACKAGE_PATH}\"\n          - cd \"${PACKAGE_PATH}\"\n          - go version\n          - uname -a\n          - make build_linux\n          - go test -v ./...`enter code here`\n</code></pre>\n\n<p>I try to build Golang app on Bitbucket CI but got the error with golang.org/x/sys/unix:</p>\n\n<pre><code>make build_linux\nCGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build --tags \"json1\" -ldflags \"-s -X main.version=0.63\" -a -installsuffix cgo -o dbcore_linux ./cmd/dbcore/dbcore.go\n# bitbucket.org/xxx/dbcore/vendor/golang.org/x/sys/unix\nvendor/golang.org/x/sys/unix/syscall_linux.go:20:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_linux.go:24:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_linux_amd64_gc.go:13:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_unix_gc.go:12:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_unix_gc.go:13:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_unix_gc.go:14:6: missing function body\nvendor/golang.org/x/sys/unix/syscall_unix_gc.go:15:6: missing function body\nmake: *** [build_linux] Error 2\nMakefile:7: recipe for target 'build_linux' failed\n</code></pre>\n\n<p>Dockerfile:\n<a href=\"https://github.com/docker-library/golang/blob/2f2f3b620d61f533484f24a568c2ca46e4fda91c/1.9/stretch/Dockerfile\" rel=\"nofollow noreferrer\">https://github.com/docker-library/golang/blob/2f2f3b620d61f533484f24a568c2ca46e4fda91c/1.9/stretch/Dockerfile</a></p>\n\n<p>I haven't issue on the local machine with MacOS. Only CI. How could I resolve that issue?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["http", "go", "networking"], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 8495751, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gLl3O0o0uJ0/AAAAAAAAAAI/AAAAAAAAAAw/0n2sQZzaW1Q/photo.jpg?sz=128", "display_name": "Sa Oh", "link": "https://stackoverflow.com/users/8495751/sa-oh"}, "edited": false, "score": 0, "creation_date": 1517361119, "post_id": 48523194, "comment_id": 84061570, "body": "Thanks! By the way, <code>i.stack.imgur.com</code> is also <code>https</code>. Why does the domain work without <code>TLSClientConfig</code>? I&#39;ve investigated SSL/TLS certificate info with <a href=\"https://cryptoreport.websecurity.symantec.com/checker/\" rel=\"nofollow noreferrer\">cryptoreport.websecurity.symantec.com/checker</a> , but I couldn&#39;t find anything doubtful with <code>precious.jp</code>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 135, "user_id": 8495751, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gLl3O0o0uJ0/AAAAAAAAAAI/AAAAAAAAAAw/0n2sQZzaW1Q/photo.jpg?sz=128", "display_name": "Sa Oh", "link": "https://stackoverflow.com/users/8495751/sa-oh"}, "edited": false, "score": 0, "creation_date": 1517361788, "post_id": 48523194, "comment_id": 84061716, "body": "I&#39;m not sure what was the cause, but when inspecting the request (using <code>curl -v &lt;IMG_URL&gt;</code>), the <code>content-length</code> header was not set in the response from <code>precious.jp</code>. BTW, is the solution in the answer works for your case? I&#39;ve tested it in my machine, and it was working."}, {"owner": {"reputation": 135, "user_id": 8495751, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gLl3O0o0uJ0/AAAAAAAAAAI/AAAAAAAAAAw/0n2sQZzaW1Q/photo.jpg?sz=128", "display_name": "Sa Oh", "link": "https://stackoverflow.com/users/8495751/sa-oh"}, "edited": false, "score": 0, "creation_date": 1517398213, "post_id": 48523194, "comment_id": 84077285, "body": "Yeah, it works on my end as well. Thanks! I&#39;m still wondering if <code>InsecureSkipVerify: true</code> is a good idea or not in this scenario though. By the way, I can see <code>Content-Length</code> of <code>precious.jp</code> actually."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 3, "last_activity_date": 1517320642, "creation_date": 1517320642, "answer_id": 48523194, "question_id": 48517410, "link": "https://stackoverflow.com/questions/48517410/why-do-i-get-net-http-request-canceled-while-waiting-for-connection-when-i-tr/48523194#48523194", "title": "Why do I get &quot;net/http: request canceled while waiting for connection&quot; when I try to fetch some images with &quot;net/http&quot;", "body": "<p>Since you're using <code>https</code>, you need to create <code>http.Client</code> with custom <em>transport</em> and configure <code>TLS</code> (see <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">http.Transport</a>), e.g.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    //---------------------- Modification ----------------------\n    //Configure TLS, etc.\n    tr := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n    }\n    client := &amp;http.Client{\n        Transport: tr,\n        Timeout:   3 * time.Second,\n    }\n    //---------------------- End of Modification ----------------\n\n    // var imageUrl = \"https://i.stack.imgur.com/tKsDb.png\"  // It works well\n    var imageUrl = \"https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg\" // It fails\n\n    req, _ := http.NewRequest(\"GET\", imageUrl, nil)\n    req.Header.Add(\"User-Agent\", \"My Test\")\n\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Println(err.Error()) // Fails here\n        return\n    }\n    defer resp.Body.Close()\n\n    if resp.StatusCode != http.StatusOK {\n        fmt.Printf(\"Failure: %d\\n\", resp.StatusCode)\n    } else {\n        fmt.Printf(\"Success: %d\\n\", resp.StatusCode)\n    }\n\n    fmt.Println(\"Done\")\n}\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 8495751, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gLl3O0o0uJ0/AAAAAAAAAAI/AAAAAAAAAAw/0n2sQZzaW1Q/photo.jpg?sz=128", "display_name": "Sa Oh", "link": "https://stackoverflow.com/users/8495751/sa-oh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14737, "favorite_count": 2, "answer_count": 1, "score": 6, "last_activity_date": 1554462105, "creation_date": 1517302654, "last_edit_date": 1517303011, "question_id": 48517410, "link": "https://stackoverflow.com/questions/48517410/why-do-i-get-net-http-request-canceled-while-waiting-for-connection-when-i-tr", "title": "Why do I get &quot;net/http: request canceled while waiting for connection&quot; when I try to fetch some images with &quot;net/http&quot;", "body": "<p>I'm writing a web crawler in Go language to collect images on the Internet. My crawler works most of the time, but it sometimes fails to fetch images somehow.</p>\n\n<p>Here's my snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    var client http.Client\n    var resp *http.Response\n\n    // var imageUrl = \"https://i.stack.imgur.com/tKsDb.png\"  // It works well\n    var imageUrl = \"https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg\"  // It fails\n\n    req, _ := http.NewRequest(\"GET\", imageUrl, nil)\n    req.Header.Add(\"User-Agent\", \"My Test\")\n\n    client.Timeout = 3 * time.Second\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Println(err.Error())  // Fails here\n        return\n    }\n    defer resp.Body.Close()\n\n    if resp.StatusCode != http.StatusOK {\n        fmt.Printf(\"Failure: %d\\n\", resp.StatusCode)\n    } else {\n        fmt.Printf(\"Success: %d\\n\", resp.StatusCode)\n    }\n\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>My snippet above works for most of the URLs (e.g. \"<a href=\"https://i.stack.imgur.com/tKsDb.png\" rel=\"noreferrer\">https://i.stack.imgur.com/tKsDb.png</a>\"), but it doesn't work if it tries to fetch URLs such as  \"<a href=\"https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg\" rel=\"noreferrer\">https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg</a>\". Error message given by calling <code>err.Error()</code> is:</p>\n\n<blockquote>\n  <p>Get\n  <a href=\"https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg\" rel=\"noreferrer\">https://precious.jp/mwimgs/b/1/-/img_b1ec6cf54ff3a4260fb77d3d3de918a5275780.jpg</a>:\n  net/http: request canceled (Client.Timeout exceeded while awaiting\n  headers)\"</p>\n</blockquote>\n\n<p>My Go version is \"go1.9.3 darwin/amd64\", and I can get the image with my Google Chrome and also with <code>curl</code> command, so I don't think I'm blocked by my IP address. Besides that, I've changed the User-Agent to be like real browser but still not luck.</p>\n\n<p>What's wrong with my code? Or is the administrator of <code>precious.jp</code> doing some magic to block my access?</p>\n"}, {"tags": ["go", "fsm", "ragel"], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "is_accepted": true, "score": 1, "last_activity_date": 1517343940, "last_edit_date": 1517343940, "creation_date": 1517339888, "answer_id": 48528966, "question_id": 48517257, "link": "https://stackoverflow.com/questions/48517257/what-is-the-correct-way-to-use-a-stack-with-a-scanner-block-in-ragel/48528966#48528966", "title": "What is the correct way to use a stack with a scanner block in Ragel?", "body": "<p>It looks like this is an issue relating to Ragel's generated code in v 6.10. Using the HEAD of ragel-6 branch fixes the issue. Thanks to Adrian Thurston for being super responsive/helpful via Twitter. :)</p>\n\n<p>Reformatting the code from this;</p>\n\n<p><a href=\"https://i.stack.imgur.com/QKPqG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QKPqG.png\" alt=\"compilation error\"></a></p>\n\n<p>To this fixes the error;</p>\n\n<p><a href=\"https://i.stack.imgur.com/UEBLa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UEBLa.png\" alt=\"compiles\"></a></p>\n"}], "owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 48528966, "answer_count": 1, "score": 1, "last_activity_date": 1517343940, "creation_date": 1517302033, "last_edit_date": 1517334298, "question_id": 48517257, "link": "https://stackoverflow.com/questions/48517257/what-is-the-correct-way-to-use-a-stack-with-a-scanner-block-in-ragel", "title": "What is the correct way to use a stack with a scanner block in Ragel?", "body": "<p>I'm using Ragel 6.10 with Go. I'm sure it's likely an issue with my code but I'm getting some weird errors when I try to use a stack with a scanner block. I'm trying to setup bracket matching and my code looks roughly like this;</p>\n\n<pre><code>ObjectValues := |*\n # other stuff\n '}' =&gt; { fret; };\n *|\n\nmain := ('{' @{fcall ObjectValues;})*;\n</code></pre>\n\n<p>Looking at page 46 in the guide it looks like this should be possible. When I run Ragel <code>ragel -G2 -Z main.rl</code>. I get the following error when I try to compile (it only happens for -G2 FSM generation);</p>\n\n<pre><code>graphql_collections.rl:47[/Users/nathanfisher/workspace/go/src/github.com/nfisher/gir/graphql_collections.go:325:2]: syntax error: unexpected goto at end of statement\ngraphql_collections.go:60[/Users/nathanfisher/workspace/go/src/github.com/nfisher/gir/graphql_collections.go:60:1]: label _again defined and not used\n</code></pre>\n\n<p>Commenting out the fret line removes the error and warns postpop and prepush are unreachable.</p>\n\n<p>The full code is here;</p>\n\n<p><a href=\"https://github.com/nfisher/gir/blob/broken/graphql_collections.rl#L47\" rel=\"nofollow noreferrer\">https://github.com/nfisher/gir/blob/broken/graphql_collections.rl#L47</a></p>\n\n<p>A working minimal test-case is here;</p>\n\n<p><a href=\"https://gist.github.com/nfisher/649ca816f82bb3ccd7164331ac2324ac\" rel=\"nofollow noreferrer\">https://gist.github.com/nfisher/649ca816f82bb3ccd7164331ac2324ac</a></p>\n\n<p>Error for test-case;</p>\n\n<pre><code>main.rl:13[/Users/nathanfisher/workspace/go/src/github.com/nfisher/gir/command/runner/main.go:119:2]: syntax error: unexpected goto at end of statement\nmain.go:59[/Users/nathanfisher/workspace/go/src/github.com/nfisher/gir/command/runner/main.go:59:1]: label _again defined and not used\n</code></pre>\n"}, {"tags": ["exception", "go", "runtime-error", "panic"], "answers": [{"tags": [], "owner": {"reputation": 39, "user_id": 7468293, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nda-oEO6Ib4/AAAAAAAAAAI/AAAAAAAAAp8/UzaCeh9XAwI/photo.jpg?sz=128", "display_name": "\u041a\u0438\u0440\u0438\u043b\u043b \u0421\u0435\u043c\u0435\u043d\u0447\u0435\u043d\u043a\u043e", "link": "https://stackoverflow.com/users/7468293/%d0%9a%d0%b8%d1%80%d0%b8%d0%bb%d0%bb-%d0%a1%d0%b5%d0%bc%d0%b5%d0%bd%d1%87%d0%b5%d0%bd%d0%ba%d0%be"}, "is_accepted": false, "score": 3, "last_activity_date": 1517288873, "creation_date": 1517288873, "answer_id": 48514234, "question_id": 48513864, "link": "https://stackoverflow.com/questions/48513864/how-to-avoid-affecting-other-code-when-panic-error-or-something-else-in-golang/48514234#48514234", "title": "How to avoid affecting other code when panic error or something else in golang", "body": "<p>With panics, you can use <a href=\"https://golang.org/ref/spec#Handling_panics\" rel=\"nofollow noreferrer\">recover</a> like this</p>\n\n<pre><code>func recoverExample() {\n    defer func() {\n        if panicMessage := recover(); panicMessage != nil {\n            fmt.Printf(\"Panic '%v' captured\", panicMessage)\n        }\n    }()\n    panic(\"Oh no!\")\n}\n</code></pre>\n\n<p>With output:</p>\n\n<pre><code>Panic 'Oh no!' captured\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1517306791, "last_edit_date": 1517306791, "creation_date": 1517306398, "answer_id": 48518608, "question_id": 48513864, "link": "https://stackoverflow.com/questions/48513864/how-to-avoid-affecting-other-code-when-panic-error-or-something-else-in-golang/48518608#48518608", "title": "How to avoid affecting other code when panic error or something else in golang", "body": "<p>User recover function at the top of your function in which you have the chances of getting error. Don't use <code>panic</code> as it will stop the execution of your code. Use below code snippet. Also It will print the log which will let you know in which function the exception occurred.</p>\n\n<pre><code>defer func() {\n    if r := recover(); r != nil {\n        log.Println(\"Recovered in custom function\", r)\n    }\n}()\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 9278524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f36f78e9daac59f4b1003a292e55d814?s=128&d=identicon&r=PG&f=1", "display_name": "sohruin", "link": "https://stackoverflow.com/users/9278524/sohruin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1517306791, "creation_date": 1517286141, "last_edit_date": 1517299935, "question_id": 48513864, "link": "https://stackoverflow.com/questions/48513864/how-to-avoid-affecting-other-code-when-panic-error-or-something-else-in-golang", "title": "How to avoid affecting other code when panic error or something else in golang", "body": "<p>I am writing a monitor program that will merge into company's system. When the program running, seldom panicked some error since a variety of problem such as a few other's server doesn't obtain the rule of http, network error or anything else.I fix most of them but <strong>I am still afraid of influence on the master program by possibly potential errors.</strong></p>\n\n<p>From company's aspect, the stability of master program is most important, secondly, monitoring's result, the stability of monitoring is low-priority.</p>\n\n<p>Is there have a method can isolate error? For example,\"try...except Exception...\" in python to ignore error(Admittedly, Not recommended)How to avoid effect  other code when panic error or something else in golang</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1517282009, "post_id": 48513048, "comment_id": 84021371, "body": "is the output JSON?"}, {"owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1517282217, "post_id": 48513048, "comment_id": 84021417, "body": "What&#39;s wrong with <code>encoding&#47;json.Marshal</code>?"}, {"owner": {"reputation": 19, "user_id": 9286650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a1cc657c077b574d41dd38f9ec6ae?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/9286650/priyanka"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1517287313, "post_id": 48513048, "comment_id": 84022596, "body": "yes the output is json @zola"}, {"owner": {"reputation": 19, "user_id": 9286650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a1cc657c077b574d41dd38f9ec6ae?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/9286650/priyanka"}, "edited": false, "score": 0, "creation_date": 1517287337, "post_id": 48513048, "comment_id": 84022599, "body": "yes oakad. I have to do marshal..."}, {"owner": {"reputation": 19, "user_id": 9286650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a1cc657c077b574d41dd38f9ec6ae?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/9286650/priyanka"}, "edited": false, "score": 0, "creation_date": 1517287362, "post_id": 48513048, "comment_id": 84022607, "body": "stuck on how to proceed woth for _, range.."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1517295218, "post_id": 48513048, "comment_id": 84025316, "body": "The expected output is not valid JSON."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517297803, "post_id": 48513048, "comment_id": 84026599, "body": "There&#39;s no reason to loop. Just use <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">json.Marshal</a>. The docs have examples that do exactly what you want."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517301234, "post_id": 48513048, "comment_id": 84028544, "body": "You haven&#39;t included any code with a for loop. How can we help you?"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1517323219, "creation_date": 1517323219, "answer_id": 48524015, "question_id": 48513048, "link": "https://stackoverflow.com/questions/48513048/how-to-loop-on-nested-structure-in-golang/48524015#48524015", "title": "How to loop on nested structure in golang?", "body": "<p>You're almost there but note that there are some syntax errors in your JSON example. The structs are almost there too, ultimately, you just need to build an instance of PrefCategory with the expected values and <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">marshal it to JSON</a>:</p>\n\n<pre><code>type PrefCategory struct {\n  PrefcatID            string            `json:\"PrefcatID\"`\n  PrefName             string            `json:\"prefname\"`\n  Temp_PrefSubcategory []PrefSubcategory `json:\"prefSubcategory\"`\n}\n\ntype PrefSubcategory struct {\n  PrefcatID  string `json:\"PrefcatID\"`\n  SubcatId   string `json:\"subcatid\"`\n  SubCatName string `json:\"subcatname\"`\n}\n\nfunc main() {\n  pref := PrefCategory{\n    \"PREF_001\",\n    \"PREF_name\",\n    []PrefSubcategory{\n      {\"SUB_PREF_001\", \"PREF_001\", \"Subcategory Name 1\"},\n      {\"SUB_PREF_002\", \"PREF_001\", \"Subcategory Name 2\"},\n    },\n  }\n\n  jsonbytes, err := json.MarshalIndent(&amp;pref, \"\", \"  \")\n  if err != nil {\n    panic(err)\n  }\n  fmt.Println(string(jsonbytes))\n  /*\n  {\n    \"PrefcatID\": \"PREF_001\",\n    \"prefname\": \"PREF_name\",\n    \"prefSubcategory\": [\n      {\n        \"PrefcatID\": \"SUB_PREF_001\",\n        \"subcatid\": \"PREF_001\",\n        \"subcatname\": \"Subcategory Name 1\"\n      },\n      {\n        \"PrefcatID\": \"SUB_PREF_002\",\n        \"subcatid\": \"PREF_001\",\n        \"subcatname\": \"Subcategory Name 2\"\n      }\n    ]\n  }\n  */\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 9286650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f75a1cc657c077b574d41dd38f9ec6ae?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/9286650/priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 482, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1517323219, "creation_date": 1517279878, "question_id": 48513048, "link": "https://stackoverflow.com/questions/48513048/how-to-loop-on-nested-structure-in-golang", "title": "How to loop on nested structure in golang?", "body": "<p>I have a nested struct and I want to loop over this struct. Please help me how to loop over the struct to get the output in this format. I have mentioned the struct which I am using.</p>\n\n<p>Expected Output:</p>\n\n<pre><code>    {  \n    \"PrefcatID\":\"PREF_001\"\n    \"prefname: :\"PREF_name\"\n    \"PrefSubcategory\":\n        {\n        \"subcatid\":\"SUB_PREF_001\",\n        \"PrefcatID\":\"PREF_001\",\n        \"subcatname\":\"Sub Category Name 1\"\n     },\n     {  \n        \"subcatid\":\"SUB_PREF_002\",\n        \"PrefcatID\":\"PREF_001\",\n        \"subcatname\":\"Sub Category Name 2\"\n     }\n     }\n</code></pre>\n\n<p>Struct in Go:</p>\n\n<pre><code>    type PrefCategory struct {\n    PrefcatID           string `json:\"PrefcatID\"`\n    PrefName            string `json:\"prefname\"`\n    Temp_PrefSubcategory []PrefSubcategory `json:\"prefSubcategory \"`\n    }\n\n    type PrefSubcategory struct {\n    PrefcatID        string `json:\"PrefcatID\"`\n    SubcatId         string `json:\"subcatid\"`\n    SubCatName       string `json:\"subcatname\"`\n     }\n</code></pre>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "edited": false, "score": 0, "creation_date": 1517268068, "post_id": 48511173, "comment_id": 84018047, "body": "If it were me, I would use <code>merge_trees</code> instead of <code>merge</code>.  This will give you the resultant merge tree, just like a normal merge.  I would then commit it with the appropriate parents.  (Sorry, I don&#39;t have any example code, I&#39;m not a gopher.)"}, {"owner": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "reply_to_user": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "edited": false, "score": 0, "creation_date": 1517268350, "post_id": 48511173, "comment_id": 84018142, "body": "@EdwardThomson, can you elaborate on the difference? The documentation is just the autogenerated stuff, there&#39;s no examples or explanations, I just have to infer meaning from variable names :("}, {"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "edited": false, "score": 0, "creation_date": 1517269656, "post_id": 48511173, "comment_id": 84018512, "body": "<code>merge</code> will set up a merge in the working directory, including setting up a file called <code>MERGE_HEAD</code> that shows the parents of the merge.  It&#39;s the equivalent of <code>git merge --no-commit</code>.  When you do a commit, it will read that information and create a proper merge commit.  <code>merge_trees</code> does not touch the working directory at all.  It just gives you an <code>index</code> that represents the merge result.  You can then write that tree (<code>git_index_write_tree</code>) and create a commit that points to that tree."}, {"owner": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "reply_to_user": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "edited": false, "score": 0, "creation_date": 1517270510, "post_id": 48511173, "comment_id": 84018742, "body": "@EdwardThomson So is that similar to doing git merge feature, then git reset master, then git add --all and git commit? It would grab all of the files changed but not all of the commits essentially. How can we preserve commit messages though?"}], "owner": {"reputation": 1585, "user_id": 5025679, "user_type": "registered", "accept_rate": 7, "profile_image": "https://graph.facebook.com/10102218283349199/picture?type=large", "display_name": "Bobby Battista", "link": "https://stackoverflow.com/users/5025679/bobby-battista"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517265391, "creation_date": 1517265391, "question_id": 48511173, "link": "https://stackoverflow.com/questions/48511173/how-to-squash-merge-using-git2go", "title": "How to squash merge using git2go?", "body": "<p>I'd like to perform \"git merge --squash\" with git2go, such that I get one commit for the merge. That commit message could be all of the other commit messages listed together, but it would only be one commit.</p>\n\n<p>So far, I'm thinking I could rebase the branch to itself, squashing commits, and then merge? Or I could try to do the merge, then try to do a soft git reset, then make a new commit with all the new changes - In this case I'd lose all of the commit messages though. Or I could just give up and use the command line via golang. </p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["http", "go", "cookies", "cors"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517254248, "post_id": 48508578, "comment_id": 84011991, "body": "You should only allow trusted origins."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 2, "creation_date": 1517266317, "post_id": 48508578, "comment_id": 84017474, "body": "1) Create a list of allowed origins, 2) check the <code>r.Header.Get(&quot;Origin&quot;)</code> value to see if it\u2019s an allowed origin in the list, 2a) If <code>r.Header.Get(&quot;Origin&quot;)</code> isn\u2019t an allowed origin, do nothing (don\u2019t send the Access-Control-Allow-Origin header back at all, 2b) if <code>r.Header.Get(&quot;Origin&quot;)</code> is an allowed origin in  your list, then do <code>w.Header().Set(&quot;Access-Control-Allow-Origin&quot;, r.Header.Get(&quot;Origin&quot;))</code>"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 298, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517253994, "creation_date": 1517253994, "question_id": 48508578, "link": "https://stackoverflow.com/questions/48508578/recommended-way-of-allowing-all-origin-in-golang-when-withcredential-is-true", "title": "Recommended way of allowing all origin in golang when withCredential is true?", "body": "<p>Sending cookies cross domain requires <code>withCredential</code> setting to <code>true</code> which means <code>access-control-allow-origin</code> cannot be wild card.</p>\n\n<p>But there is an easy way around this.</p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Origin\", r.Header.Get(\"Origin\"))\n</code></pre>\n\n<p>This will effectively allow all origin, but is this the recommended way of doing this?</p>\n\n<p>It seems like there is a reason for not allowing all origins</p>\n\n<p><a href=\"https://stackoverflow.com/questions/19743396/cors-cannot-use-wildcard-in-access-control-allow-origin-when-credentials-flag-i\">CORS: Cannot use wildcard in Access-Control-Allow-Origin when credentials flag is true</a>'</p>\n\n<p>What is the general recommended way of allowing all origin when <code>withCredential</code> is true?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517249212, "post_id": 48507314, "comment_id": 84009291, "body": "Are you sure it&#39;s a &quot;panic&quot;, and not a runtime fatal error?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517251307, "post_id": 48507314, "comment_id": 84010396, "body": "Ya, you&#39;re right, it prints as a fatal error, just has the same stack trace format as a panic.  Any way to catch such a fatal error?  I mean, I realize that that fatal error definitely means we can&#39;t continue <i>anything</i> in the cgo code, since it&#39;s in an undefined state, but I&#39;d at least like to be able to do some cleanup/alerting in the go code instead of just gracelessly crashing.  Having to build in a heartbeat check or something just seems like so much kludge for something like this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1517252117, "post_id": 48507314, "comment_id": 84010868, "body": "nope, fatal error is the program crashing asap. The cgo code is running in the same address space, so technically the Go memory space could also be in just as bad a state. In order to catch it you&#39;re going to have to run it in another process."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1517252703, "post_id": 48507314, "comment_id": 84011190, "body": "&#171;It seems like extremely poor design to have no way at all catch and handle these fatal errors.&#187;\u2014how do you normally catch <code>SIGSEGV</code> signals in your normal C code (not wrapped with Go runtime)?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517255693, "post_id": 48507314, "comment_id": 84012733, "body": "I&#39;ve not coded in C in years, so no idea, tbh.  One of the big reasons I like Go is that it doesn&#39;t really have a concept of uncatchable fatal errors.  If it&#39;s just flat not catchable, I think I may have to either see if I can&#39;t debug the cgo code (ugh), or find/write an alternative driver."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517258124, "post_id": 48507314, "comment_id": 84013967, "body": "@Kaedys: except that Go does have a concept of uncatchable fatal errors, which you&#39;ve just seen. Segfaults or memory corruption (through the incorrect use of unsafe or race conditions), OOM, concurrent writes to maps, etc. can all end up as a fatal error. Go&#39;s inherent memory safety just makes it harder to get there than for example, C."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517260883, "post_id": 48507314, "comment_id": 84015295, "body": "Ya, I guess.  I just hate having such a significant crash vulnerability in production code, and the alternatives are...annoying.  Thanks for the help."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1517301440, "post_id": 48507314, "comment_id": 84028679, "body": "May I invite you to raise your question on <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">the Go mailing list</a>? While this SO tag is monitored by a fair number of professionals it is not read by the Go devs. I&#39;d also note that if/when you decide to post there please include in it the Go version and the OS you&#39;re using\u2014this might be crucial for properly dealing with the problem."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1519477623, "post_id": 48507314, "comment_id": 84932146, "body": "On the off chance that you haven&#39;t yet tried <a href=\"https://golang.org/pkg/os/signal/#Notify\" rel=\"nofollow noreferrer\">os.signal.Notify</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1519752655, "post_id": 48507314, "comment_id": 85033976, "body": "Is that even capable of catching a SIGSEGV?  I&#39;ve honestly never tried."}, {"owner": {"reputation": 2860, "user_id": 5397, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e1d626dc8d86cfc672022946ee03be83?s=128&d=identicon&r=PG", "display_name": "Martin Del Vecchio", "link": "https://stackoverflow.com/users/5397/martin-del-vecchio"}, "edited": false, "score": 1, "creation_date": 1571925220, "post_id": 48507314, "comment_id": 103407302, "body": "@Kaedys no, signal.Notify() is not capable of catching a SIGSEGV caused by program execution.  It can catch a SIGSEGV sent by the linux &quot;kill&quot; command, but that&#39;s of no use."}], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 798, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1517251431, "creation_date": 1517248783, "last_edit_date": 1517251431, "question_id": 48507314, "link": "https://stackoverflow.com/questions/48507314/any-method-to-catch-a-fatal-error-triggered-within-cgo-code", "title": "Any method to catch a fatal error triggered within cgo code?", "body": "<p>Our applications are using the <a href=\"https://github.com/alexbrainman/odbc\" rel=\"nofollow noreferrer\">odbc</a> driver to access an Impala database.  We've discovered that in certain difficult-to-replicate situations, the driver will trigger a segfault within its cgo code, which manifests as a fatal error once it propagates back up through the driver and to our code.  Since we want some cleanup and alerting to happen in these situations, I implemented a deferred panic catcher, hoping this might catch them.</p>\n\n<p>However, it isn't working.  The fatal error continues straight past the deferred function containing the <code>recover()</code> call (so apparently it's not a panic, despite the print output looking similar), though it does catch <em>other</em> panics. <a href=\"https://github.com/golang/go/issues/3774\" rel=\"nofollow noreferrer\">A github issue</a> suggests that cgo signals cannot be caught, and that applications should gracelessly and immediately crash if one occurs.  This is an unacceptable crash case for our production applications, so I'm wondering if that's changed in the last 6 years, or if anyone knows of another way of running some cleanup code in the event of a cgo signal.  It seems like extremely poor design to have no way at all catch and handle these fatal errors.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517247858, "post_id": 48506800, "comment_id": 84008536, "body": "You are looking for slices."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517248384, "post_id": 48506800, "comment_id": 84008857, "body": "@Peter like? can you give example?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517248755, "post_id": 48506800, "comment_id": 84009062, "body": "<a href=\"https://play.golang.org/p/t-iuGVaRsNM\" rel=\"nofollow noreferrer\">play.golang.org/p/t-iuGVaRsNM</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517248970, "post_id": 48506800, "comment_id": 84009177, "body": "@Peter thanks, it&#39;s that what I searched"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517306048, "post_id": 48507979, "comment_id": 84031495, "body": "When parsing JSON from a reader (such as http.Response.Body) it is much simpler to use a *json.Decoder. I have edited the code sample."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "is_accepted": false, "score": 0, "last_activity_date": 1517305970, "last_edit_date": 1517305970, "creation_date": 1517251481, "answer_id": 48507979, "question_id": 48506800, "link": "https://stackoverflow.com/questions/48506800/parsing-json-in-golang-with-answer-with-array-without-keys/48507979#48507979", "title": "Parsing JSON in Golang with answer with array without keys", "body": "<p>Thanks <strong>@Peter</strong> for answer and code <strong>example:</strong> <a href=\"https://play.golang.org/p/t-iuGVaRsNM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/t-iuGVaRsNM</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    //Ask user to enter search parameter\n    fmt.Printf(\"Search something: \")\n    var s string\n    fmt.Scanf(\"%s\", &amp;s)\n\n    //Create search url\n    url := s\n    request := \"https://en.wikipedia.org/w/api.php?action=opensearch&amp;search=\" + url + \"&amp;limit=5&amp;origin=*&amp;format=json\"\n\n    //Sending request\n    response, err := http.Get(request)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer response.Body.Close()\n\n    //Unmarshal and store to responsedata interface    \n    var responsedata []interface{}\n    if err := json.NewDecoder(response.Body).Decode(&amp;responsedata); err != nil {\n        log.Fatal(err)\n    }\n\n    //Loop through the responsedata and output\n    for _, x := range responsedata {\n        switch value := x.(type) {\n        case string:\n            fmt.Println(value)\n        case []interface{}:\n            for _, v := range value {\n                fmt.Println(v.(string))\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 0, "last_activity_date": 1517322592, "last_edit_date": 1517322592, "creation_date": 1517276275, "answer_id": 48512604, "question_id": 48506800, "link": "https://stackoverflow.com/questions/48506800/parsing-json-in-golang-with-answer-with-array-without-keys/48512604#48512604", "title": "Parsing JSON in Golang with answer with array without keys", "body": "<p>You could define a custom type which <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">implements <code>json.Unmarshaler</code></a> by mapping the parsed array values into a struct such as below:</p>\n\n<pre><code>type SearchResults struct {\n  Query   string\n  Results []Result\n}\n\ntype Result struct {\n  Name, Description, URL string\n}\n\nfunc (sr *SearchResults) UnmarshalJSON(bs []byte) error {\n  array := []interface{}{}\n  err := json.Unmarshal(bs, &amp;array)\n  if err != nil {\n    return err\n  }\n  sr.Query = array[0].(string)\n  for i := range array[1].([]interface{}) {\n    sr.Results = append(sr.Results, Result{\n      array[1].([]interface{})[i].(string),\n      array[2].([]interface{})[i].(string),\n      array[3].([]interface{})[i].(string),\n    })\n  }\n  return nil\n}\n\nfunc main() {\n  sr := &amp;SearchResults{}\n  err := json.Unmarshal([]byte(jsonstr), sr)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Printf(\"OK: query=%q\\n\", sr.Query)\n  for i, result := range sr.Results {\n    fmt.Printf(\"OK: result[%d]=%#v\\n\", i, result)\n  }\n}\n\n// OK: query=\"bee\"\n// OK: result[0]=main.Result{Name:\"Bee\", Description:\"Bees are flying insects closely related to wasps and ants, known for their role in pollination and, in the case of the best-known bee species, the European honey bee, for producing honey and beeswax.\", URL:\"https://en.wikipedia.org/wiki/Bee\"}\n// OK: result[1]=main.Result{Name:\"Beer\", Description:\"Beer is one of the oldest and most widely consumed alcoholic drinks in the world, and the third most popular drink overall after water and tea.\", URL:\"https://en.wikipedia.org/wiki/Beer\"}\n// OK: result[2]=main.Result{Name:\"Bee Gees\", Description:\"The Bee Gees were a pop music group formed in 1958. Their lineup consisted of brothers Barry, Robin, and Maurice Gibb.\", URL:\"https://en.wikipedia.org/wiki/Bee_Gees\"}\n// OK: result[3]=main.Result{Name:\"Beef\", Description:\"Beef is the culinary name for meat from cattle, particularly skeletal muscle. Humans have been eating beef since prehistoric times.\", URL:\"https://en.wikipedia.org/wiki/Beef\"}\n// OK: result[4]=main.Result{Name:\"Beetle\", Description:\"Beetles are a group of insects that form the order Coleoptera, in the superorder Endopterygota. Their front pair of wings is hardened into wing-cases, elytra, distinguishing them from most other insects.\", URL:\"https://en.wikipedia.org/wiki/Beetle\"}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9285026"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "closed_date": 1517283760, "accepted_answer_id": 48512604, "answer_count": 2, "score": 0, "last_activity_date": 1517322592, "creation_date": 1517246902, "question_id": 48506800, "link": "https://stackoverflow.com/questions/48506800/parsing-json-in-golang-with-answer-with-array-without-keys", "closed_reason": "Needs details or clarity", "title": "Parsing JSON in Golang with answer with array without keys", "body": "<p>How to handle json if the response comes with an array of data (in JS it was decided by fetching the necessary data on the index), I saw that I wrote that through Unmarshal into the structure, but I can not save the array in the structure so that I can then take the indices from the keys because there are no keys on which you can create a structure.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    url := \"My request\"\n    request := \"https://en.wikipedia.org/w/api.php?action=opensearch&amp;search=\" + url + \"&amp;limit=5&amp;origin=*&amp;format=json\"\n    response, err := http.Get(request)\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n    }\n\n}\n</code></pre>\n\n<p>Here's what comes in answer</p>\n\n<pre><code>[\"bee\",[\"Bee\",\"Beer\",\"Bee Gees\",\"Beef\",\"Beetle\"],[\"Bees are flying insects closely related to wasps and ants, known for their role in pollination and, in the case of the best-known bee species, the European honey bee, for producing honey and beeswax.\",\"Beer is one of the oldest and most widely consumed alcoholic drinks in the world, and the third most popular drink overall after water and tea.\",\"The Bee Gees were a pop music group formed in 1958. Their lineup consisted of brothers Barry, Robin, and Maurice Gibb.\",\"Beef is the culinary name for meat from cattle, particularly skeletal muscle. Humans have been eating beef since prehistoric times.\",\"Beetles are a group of insects that form the order Coleoptera, in the superorder Endopterygota. Their front pair of wings is hardened into wing-cases, elytra, distinguishing them from most other insects.\"],[\"https://en.wikipedia.org/wiki/Bee\",\"https://en.wikipedia.org/wiki/Beer\",\"https://en.wikipedia.org/wiki/Bee_Gees\",\"https://en.wikipedia.org/wiki/Beef\",\"https://en.wikipedia.org/wiki/Beetle\"]]\n</code></pre>\n"}, {"tags": ["go", "ubuntu-16.04", "atom-editor"], "comments": [{"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1517245581, "post_id": 48506366, "comment_id": 84007169, "body": "I&#39;ve pretty much the exact same version numbers and config, just on macOS and this seems to work fine for me. Maybe Ubuntu related?"}, {"owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "reply_to_user": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1517246345, "post_id": 48506366, "comment_id": 84007616, "body": "And this works fine for you?"}, {"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1517251342, "post_id": 48506366, "comment_id": 84010420, "body": "Yes, as I mentioned above, I don&#39;t experience any issues (on macOS)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1517302969, "post_id": 48506366, "comment_id": 84029464, "body": "I also have Ubuntu 16.04, and it works fine for me. What version of Go do you have? Is your <code>GOPATH</code> set properly? What is your <code>$GOPATH</code>? What is the output of <code>which goimports</code>?"}, {"owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "edited": false, "score": 0, "creation_date": 1517327907, "post_id": 48506366, "comment_id": 84046061, "body": "So I believe it works now. I believe it is cause from using <code>direnv</code> to change my gopath dynamically. So I just made sure to update the packages within atom when I&#39;m in a different directory."}], "owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517245234, "creation_date": 1517245234, "question_id": 48506366, "link": "https://stackoverflow.com/questions/48506366/go-plus-atom-package-doesnt-run-goimports", "title": "go-plus atom package doesn&#39;t run goimports", "body": "<p>This is my current version of </p>\n\n<pre><code>Atom    : 1.23.3\nElectron: 1.6.15\nChrome  : 56.0.2924.87\nNode    : 7.4.0\n</code></pre>\n\n<p>go-plus package is at</p>\n\n<pre><code>go-plus 5.8.1\n</code></pre>\n\n<p>I'm not quite sure how to about getting this to work or figuring out the issue</p>\n\n<p>format box is check to run formattool on save and the formattool is set to  goimports</p>\n\n<p>goimports work in my command line, so I suspect this is an issues with the package</p>\n\n<p>I'm also using ubuntu 16.04, with kernel v 4.10. the newer updates doesn't detect any wifi devices </p>\n"}, {"tags": ["go", "web-scraping", "automation"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517243979, "post_id": 48505809, "comment_id": 84006075, "body": "<code>ActionFunc</code> describes an action, it doesn&#39;t run it. You need to call <code>.Do(context, executor)</code> on your internal actions. You should also check for errors returned by <code>Do</code> and return that. You can see how the existing actions build up from other actions. For example, the <a href=\"https://github.com/chromedp/chromedp/blob/master/nav.go#L12\" rel=\"nofollow noreferrer\">Navigate</a> action."}, {"owner": {"reputation": 794, "user_id": 1312791, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c9dc2d2585c375a9049748fd0b1b26e6?s=128&d=identicon&r=PG", "display_name": "telex-wap", "link": "https://stackoverflow.com/users/1312791/telex-wap"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517306735, "post_id": 48505809, "comment_id": 84031965, "body": "Thanks, I was actually missing the <code>Do</code>, as you say. I added them and now the actions are running fine. Feel free to add an answer if you want, and I will accept it."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1517332641, "creation_date": 1517332641, "answer_id": 48527071, "question_id": 48505809, "link": "https://stackoverflow.com/questions/48505809/chromedp-don%c2%b4t-perform-actions-inside-a-loop-in-actionfunc/48527071#48527071", "title": "Chromedp don&#180;t perform actions inside a loop in ActionFunc", "body": "<p><code>chromedp.ActionFunc</code> is used to build a custom action. The function you give it will be executed during the <code>Run</code> phase.</p>\n\n<p>This means that your function needs to actually run the actions you are using inside. This is done by calling the <code>.Do</code> method on the action and passing it a <code>context.Context</code> and <code>cdp.Executor</code>.</p>\n\n<p>As for errors, the function should return any error encountered while running. When calling <code>.Do</code> on your embedded actions, check the error and return it if non-nil.</p>\n\n<p>Your code should look like:</p>\n\n<pre><code>func risk(slice []string) chromedp.Tasks {\n\n    return chromedp.Tasks{\n        // ... other actions ...\n        chromedp.ActionFunc(func(c context.Context, e cdp.Executor) error {\n            for _, element := range slice[2:] {\n                fmt.Println(element)\n                err := chromedp.SendKeys(\"#query_box\", element, chromedp.ByID).Do(c, e)\n                if err != nil {\n                  return err\n                }\n                err = chromedp.Click(\"#searchButton\", chromedp.ByID).Do(c, e)\n                if err != nil {\n                  return err\n                }\n            }\n            return nil\n        }),\n    }\n}\n</code></pre>\n\n<p><strong>disclaimer</strong>: I haven't tested this code, so there may be issues, but this should give you the general idea of defining vs executing an action, and properly returning errors.</p>\n"}], "owner": {"reputation": 794, "user_id": 1312791, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c9dc2d2585c375a9049748fd0b1b26e6?s=128&d=identicon&r=PG", "display_name": "telex-wap", "link": "https://stackoverflow.com/users/1312791/telex-wap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1285, "favorite_count": 0, "accepted_answer_id": 48527071, "answer_count": 1, "score": 0, "last_activity_date": 1517332641, "creation_date": 1517243261, "question_id": 48505809, "link": "https://stackoverflow.com/questions/48505809/chromedp-don%c2%b4t-perform-actions-inside-a-loop-in-actionfunc", "title": "Chromedp don&#180;t perform actions inside a loop in ActionFunc", "body": "<p>I have a slice containing a list of terms, and I want to search for each term in a certain search engine page, so I am doing this: </p>\n\n<pre><code>func risk(slice []string) chromedp.Tasks {\n\n    return chromedp.Tasks{\n        chromedp.Navigate(\"https://testpage\"),\n        chromedp.WaitVisible(\"#query_box\", chromedp.ByID),\n        chromedp.ActionFunc(func(context.Context, cdp.Executor) error {\n            for _, element := range slice[2:] {\n                fmt.Println(element)\n                chromedp.SendKeys(\"#query_box\", element, chromedp.ByID)\n                chromedp.Click(\"#searchButton\", chromedp.ByID),\n            }\n            return nil\n        }),\n    }\n} \n</code></pre>\n\n<p>When calling this inside <code>main</code> as </p>\n\n<pre><code>err = c.Run(ctxt, risk(items))\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>Everything works until the <code>ActionFunc</code>. Whatever action I can add before the function (take screenshot, etc...) work without issues. </p>\n\n<p>However, the actions inside <code>ActionFunc</code> don't get performed. </p>\n\n<p>Is the reason the <code>return nil</code>? I wanted to return the set of tasks like I am doing outside the loop, but I couldn't find about how to do that inside a loop in the <code>ActionFunc</code>, since the return would always be the latest item rather than the full set... Returning <code>nil</code> was the only way to get the function to at least get started. </p>\n\n<p>What is the correct way to perform this sort of loop operations inside a set of <code>chromedp.Tasks</code>?</p>\n"}, {"tags": ["go", "jenkins", "jenkins-pipeline", "gopath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517238143, "post_id": 48503604, "comment_id": 84002078, "body": "You need to put the code in your GOPATH. Unless your repo contains the complete GOPATH structure (which is not recommended), jenkins isn&#39;t going to create GOPATH for you."}, {"owner": {"reputation": 1353, "user_id": 3250984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e361b04391eca1bb10b4113dee776479?s=128&d=identicon&r=PG", "display_name": "bordeltabernacle", "link": "https://stackoverflow.com/users/3250984/bordeltabernacle"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517239683, "post_id": 48503604, "comment_id": 84003131, "body": "Yeah, I understand that, the problem is that I don&#39;t know what to set my GOPATH to. I&#39;ve tried a number of different paths, and none of them work."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517240075, "post_id": 48503604, "comment_id": 84003398, "body": "You can set GOPATH to whatever you want, but nothing will work until you put packages correctly in GOPATH. I don&#39;t see anything here attempting to place the packages at their full import path relative to GOPATH."}, {"owner": {"reputation": 1353, "user_id": 3250984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e361b04391eca1bb10b4113dee776479?s=128&d=identicon&r=PG", "display_name": "bordeltabernacle", "link": "https://stackoverflow.com/users/3250984/bordeltabernacle"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517240948, "post_id": 48503604, "comment_id": 84004031, "body": "Jenkins just fetches the packages to the workspace, and I need to then manually move them? So, I have to <code>mv</code> the repo fetched by git from where Jenkins fetches it to, to wherever I set the <code>GOPATH</code>? ie. <code>cd .. &amp;&amp; mv my_repo $GOPATH&#47;src</code>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517246442, "post_id": 48503604, "comment_id": 84007670, "body": "It&#39;s really simple.  Wherever you have your <code>$GOPATH</code> set, your repo and <i>all</i> of its dependencies have to be located within <code>$GOPATH&#47;src</code> (or have to be vendored within your repo).  Whether that means moving them to the Jenkins folder, or symlinking them (I <i>think</i> that works), or vendoring them (probably the best solution), that&#39;s your call."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517246577, "post_id": 48503604, "comment_id": 84007740, "body": "Oh, also note that the <code>$GOPATH</code> var can be a colon-seperated list just like the <code>$PATH</code> var (ex. <code>GOPATH=&quot;my&#47;repo&#47;path:my&#47;normal&#47;gopath&quot;</code>).  So you can add <i>both</i> the jenkins workspace and the normal <code>$GOPATH</code> into the var, and the go tool will check both, in order, using the first version it finds."}], "answers": [{"comments": [{"owner": {"reputation": 1353, "user_id": 3250984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e361b04391eca1bb10b4113dee776479?s=128&d=identicon&r=PG", "display_name": "bordeltabernacle", "link": "https://stackoverflow.com/users/3250984/bordeltabernacle"}, "edited": false, "score": 0, "creation_date": 1517478198, "post_id": 48507213, "comment_id": 84114726, "body": "This was the solution, adding a ` sh &#39;ln -sf ${WORKSPACE} ${GOPATH}/src/my_repo&#39;` line did the trick. Many thanks!"}, {"owner": {"reputation": 290, "user_id": 1005797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QLYSU.png?s=128&g=1", "display_name": "gregdferrell", "link": "https://stackoverflow.com/users/1005797/gregdferrell"}, "edited": false, "score": 0, "creation_date": 1530242636, "post_id": 48507213, "comment_id": 89175651, "body": "Got mine working too. I was not understanding sym link properly."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1517248429, "creation_date": 1517248429, "answer_id": 48507213, "question_id": 48503604, "link": "https://stackoverflow.com/questions/48503604/gopath-in-declarative-jenkinsfile/48507213#48507213", "title": "GOPATH in declarative Jenkinsfile", "body": "<p>You have to make <code>$GOPATH/src/my_repo/my_db</code> exist. The value of $GOPATH is not really important as far as Go is concerned. <code>$GOPATH/src/my_repo/my_db</code> may be a symlink. We create that symlink as part of the test script in our CI system.</p>\n\n<p>I'm not very familiar with Jenkins, but I'm going to assume that $WORKSPACE is where the code is checked out (e.g. $WORKSPACE/.git exists). In that case, see if you can execute the following script before running any go command:</p>\n\n<pre><code>mkdir -p $GOPATH/src/my_repo\nln -s $WORKSPACE $GOPATH/src/my_repo/my_db\n</code></pre>\n\n<p>Again, the important thing is that <code>$GOPATH/src/my_repo/my_db</code> exists. How you make this happen is up to you.</p>\n"}], "owner": {"reputation": 1353, "user_id": 3250984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e361b04391eca1bb10b4113dee776479?s=128&d=identicon&r=PG", "display_name": "bordeltabernacle", "link": "https://stackoverflow.com/users/3250984/bordeltabernacle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3142, "favorite_count": 1, "accepted_answer_id": 48507213, "answer_count": 1, "score": 2, "last_activity_date": 1517248429, "creation_date": 1517236251, "last_edit_date": 1517239771, "question_id": 48503604, "link": "https://stackoverflow.com/questions/48503604/gopath-in-declarative-jenkinsfile", "title": "GOPATH in declarative Jenkinsfile", "body": "<p>I'm setting up a Jenkins multibranch pipeline for our Go mono repo at work. How do I set the <code>GOPATH</code> so the go tool can find where Jenkins has fetched the repo?</p>\n\n<p>I've tried setting it with the <code>environment</code> syntax, like so:</p>\n\n<pre><code>pipeline {\n    agent {\n        docker {\n            image 'golang:1.9.2'\n        }\n    }\n\n    triggers {\n        gitlab(triggerOnPush: true, triggerOnMergeRequest: true, branchFilterType: 'All')\n    }\n\n    post {\n        failure {\n            updateGitlabCommitStatus name: 'jenkins-build', state: 'failed'\n        }\n        success {\n            updateGitlabCommitStatus name: 'jenkins-build', state: 'success'\n        }\n    }\n\n    environment {\n        GOPATH = \"${pwd}\"\n    }\n\n    stages {\n        stage('Build') {\n            steps {\n                updateGitlabCommitStatus name: 'jenkins-build', state: 'pending'\n                echo 'Linting...'\n                sh 'go version'\n                sh 'go get -u -v github.com/golang/lint/golint'\n                sh 'golint -set_exit_status ./...'\n                echo 'Building...'\n                sh '''\n                cd my_app\n                go build\n                '''\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The <code>golint</code> command works fine as it's within the right directory, but the go build command can't find any of the other dependencies that are within the root directory. For instance running <code>go build</code> in <code>my_repo/my_app</code> it won't find any of the dependencies in <code>my_repo</code>, say <code>my_repo/my_dep</code>.</p>\n\n<p>I also tried setting <code>GOPATH</code> within the build stage:</p>\n\n<pre><code>stage('Build') {\n            steps {\n                updateGitlabCommitStatus name: 'jenkins-build', state: 'pending'\n                echo 'Building...'\n                sh '''\n                GOPATH=$(pwd)\n                cd fpweb\n                go build\n                '''\n            }\n        }\n</code></pre>\n\n<p>But the same happens. </p>\n\n<pre><code>my_app.go:19:2: cannot find package \"my_repo/my_db\" in any of:\n    /usr/local/go/src/my_repo/my_db (from $GOROOT)\n    /data/jenkins_slave/workspace/my_repo-pipeline_master-JHGTBESY3LSHGFEUYYM2777JIAFVR4R7E4Y2YPZA2MI4XW6BBTQQ/src/my_repo/my_db (from $GOPATH)\n</code></pre>\n\n<p><strong>EDIT</strong>: What should I set my <code>GOPATH</code> to?</p>\n\n<p><strong>UPDATE</strong>: when I set the <code>GOPATH</code> to the <code>WORKSPACE</code>:</p>\n\n<pre><code>environment {\n        GOPATH = \"$WORKSPACE\"\n    }\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>[my_repo-pipeline_master-JHGTBESY3LSHGFEUYYM2777JIAFVR4R7E4Y2YPZA2MI4XW6BBTQQ] Running shell script\n+ pwd\n+ // GOPATH=/data/jenkins_slave/workspace/my_repo-pipeline_master-JHGTBESY3LSHGFEUYYM2777JIAFVR4R7E4Y2YPZA2MI4XW6BBTQQ\n/data/jenkins_slave/workspace/my_repo-pipeline_master-JHGTBESY3LSHGFEUYYM2777JIAFVR4R7E4Y2YPZA2MI4XW6BBTQQ@tmp/durable-18853a9e/script.sh: 3: /data/jenkins_slave/workspace/my_repo-pipeline_master-JHGTBESY3LSHGFEUYYM2777JIAFVR4R7E4Y2YPZA2MI4XW6BBTQQ@tmp/durable-18853a9e/script.sh: //: Permission denied\n</code></pre>\n"}, {"tags": ["debugging", "go", "memory-leaks"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1517227475, "post_id": 48499573, "comment_id": 83994895, "body": "<code>pprof</code> can diff heap profiles and show you objects or space allocated. This should be enough to tell you which objects hold the memory. From there, it shouldn&#39;t be too difficult to know what actually holds references (just audit your code). Also, make sure it&#39;s being held, otherwise it could be a case of memory being GCed, but not released to the OS. Other than that, no way to do it though you could create a wrapper around the object with an explicit <code>TakeOwnership(&quot;new owner&quot;)</code> method."}, {"owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517230099, "post_id": 48499573, "comment_id": 83996481, "body": "thanks @Marc! I did took advantage of the <code>-base</code> flag. but it&#39;s still difficult to pin the exact place. &quot;but not released to the OS&quot; how do I check that? And how does that knowledge help me exactly? Process still going to crash eventually. TakeOwnership smells like Rust :)"}, {"owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517230200, "post_id": 48499573, "comment_id": 83996550, "body": "Also, I&#39;ve added one more point about memory deallocated when I do <code>object = nil</code>."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517230480, "post_id": 48499573, "comment_id": 83996769, "body": "Ok, then it definitely sounds like references still being held. <code>TakeOwnership</code> is if you have a type only your code uses, then you can annotate what is using it, it&#39;s purely a debugging thing. It won&#39;t work if you need to pass it to other libraries. We can&#39;t really help you though, you haven&#39;t even shown what is still being held. If is a buffer, a large object, a channel? In general, it sounds like something is not calling <code>close()</code>, gut that&#39;s just a wild guess on my part."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1517234890, "post_id": 48499573, "comment_id": 83999803, "body": "@melekes: It&#39;s vary hard to leak memory in Go without also leaking goroutines. If the number of goroutines isn&#39;t increasing, then the next place to look is that NewTicker call referenced in the linked issue. Have you verified how many tickers are created and that <code>Stop</code> is called on all the unused ones? (there&#39;s a lot of tickers created by that code in general, discarding them without stopping them is a surefire way to leak memory). Short of that, you haven&#39;t really provided any specific data to look at here, or a way to replicate the issue."}, {"owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517238205, "post_id": 48499573, "comment_id": 84002125, "body": "Ok. I think I found who&#39;s holding a reference to the object. This was a test-case. In production however, the number of go-routines was indeed increasing. Thanks @JimB for your help! Should I close this question?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517238410, "post_id": 48499573, "comment_id": 84002251, "body": "@melekes: as I suspected ;) My first response to a memory leak is always to look at a stack trace. I would go ahead and close it, since there&#39;s no content here to help anyone else."}, {"owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "edited": false, "score": 2, "creation_date": 1522838012, "post_id": 48499573, "comment_id": 86305482, "body": "voted for closing. for anybody who&#39;s interested, here is the article with tips and whole story <a href=\"https://blog.cosmos.network/debugging-the-memory-leak-in-tendermint-210186711420\" rel=\"nofollow noreferrer\">blog.cosmos.network/&hellip;</a>"}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1536098850, "post_id": 48499573, "comment_id": 91300060, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41542775/how-to-visualize-heapdump\">How to visualize heapdump?</a>"}, {"owner": {"reputation": 131, "user_id": 5560268, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156172418395543/picture?type=large", "display_name": "Loren Osborn", "link": "https://stackoverflow.com/users/5560268/loren-osborn"}, "edited": false, "score": 0, "creation_date": 1539568245, "post_id": 48499573, "comment_id": 92535554, "body": "This reminded me of a talk I saw on YouTube not to long ago. GoRoutines (and the GC system) are scheduled cooperatively. If your code doesn\u2019t do any io, you may be stuck busily computing in a goroutine without allowing go to run GC. Doing the equivalent of a sleep(0) periodically should help if it it a starvation issue."}], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "edited": false, "score": 1, "creation_date": 1583234244, "post_id": 54416209, "comment_id": 107039779, "body": "@melekes Indeed it&#39;s not (on github). It might be a comment about how the code isn&#39;t part of your question, which is what is expected of a question here. Being a bit acquainted with the tendermint code, I do understand it&#39;s kind of a tricky thing to post a minimal code sample to explain the extent of the problem without posting a couple of thousand lines though.."}], "tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": -1, "last_activity_date": 1549475054, "last_edit_date": 1549475054, "creation_date": 1548748370, "answer_id": 54416209, "question_id": 48499573, "link": "https://stackoverflow.com/questions/48499573/is-there-a-way-to-know-who-holds-a-reference-to-an-object-in-go/54416209#54416209", "title": "Is there a way to know who holds a reference to an object in Go?", "body": "<p>Your code is 404 not found.</p>\n\n<p>When you put object = nil. this did not be cleared immediately however when some goroutine still holds it , the object will keep still even if gc runs.</p>\n\n<p>You ask who hold the reference, goroutine who uses this val without put it to nil or the goroutine uses it in a loop will both keep the reference.</p>\n\n<p>The gc() will never marked a referred reference to black, then it will never be clear</p>\n"}, {"comments": [{"owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "edited": false, "score": 0, "creation_date": 1585720167, "post_id": 60713019, "comment_id": 107857483, "body": "I think you might be mixing vagrant with vargrind?"}], "tags": [], "owner": {"reputation": 43, "user_id": 11996903, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bSGCrD_25Ko/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcwzv8EI_GSE4DugE-lRWAqLz8nNw/photo.jpg?sz=128", "display_name": "John Scharber", "link": "https://stackoverflow.com/users/11996903/john-scharber"}, "is_accepted": false, "score": 1, "last_activity_date": 1586029443, "last_edit_date": 1586029443, "creation_date": 1584391641, "answer_id": 60713019, "question_id": 48499573, "link": "https://stackoverflow.com/questions/48499573/is-there-a-way-to-know-who-holds-a-reference-to-an-object-in-go/60713019#60713019", "title": "Is there a way to know who holds a reference to an object in Go?", "body": "<p>I can suggest two tools.</p>\n\n<p>Use <a href=\"https://docs.google.com/document/d/1_Y9xCEMj5S-7rv2ooHpZNH15JgRT5iM742gJkw5LtmQ/edit\" rel=\"nofollow noreferrer\">Go Guru</a>, to see who pointsto or referrers to a pointer.  It is integrated with the <a href=\"https://github.com/fatih/vim-go\" rel=\"nofollow noreferrer\">vim-go</a> plugin I use, I did a post on that <a href=\"https://www.pavedroad.io/part-3-vim-go-plugin/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p><a href=\"https://www.cossacklabs.com/blog/investigating-go-memory-leaks.html\" rel=\"nofollow noreferrer\">Valgrind</a> is a tool for C/C++ but found an article about using it with Go.</p>\n"}], "owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2158, "favorite_count": 6, "answer_count": 2, "score": 27, "last_activity_date": 1586029443, "creation_date": 1517223367, "last_edit_date": 1548750164, "question_id": 48499573, "link": "https://stackoverflow.com/questions/48499573/is-there-a-way-to-know-who-holds-a-reference-to-an-object-in-go", "title": "Is there a way to know who holds a reference to an object in Go?", "body": "<p>I am currently trying to debug a nasty memory leak in <a href=\"https://github.com/tendermint/tendermint/pull/1173\" rel=\"noreferrer\">our Go code</a>.</p>\n\n<p>What I know:</p>\n\n<ul>\n<li>where memory is going (<code>pprof</code> with <code>-base</code> flag)</li>\n<li>why new memory is being allocated (\"reconnect\" feature in our code)</li>\n<li>number of goroutines is not growing (<code>runtime.NumGoroutine()</code>)</li>\n<li>if I do <code>object = nil</code>, memory will be garbage collected (good! but now I have data races with other go-routines that are using this object)</li>\n</ul>\n\n<p>What I don't know:</p>\n\n<ul>\n<li>why new memory is not being garbage collected. for that I need to know who holds a reference(s) to an object.</li>\n</ul>\n\n<p>Thank you for your time and any advice!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 2, "creation_date": 1517222157, "post_id": 48499130, "comment_id": 83991709, "body": "What did you try? What doesn&#39;t work for you?"}, {"owner": {"reputation": 147, "user_id": 9214956, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-S3WMeb0HFlM/AAAAAAAAAAI/AAAAAAAAAEM/8_HgPsdfRqA/photo.jpg?sz=128", "display_name": "Ashish Kafle", "link": "https://stackoverflow.com/users/9214956/ashish-kafle"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1517222655, "post_id": 48499130, "comment_id": 83992024, "body": "I want to reorganize json response format.Since i am new in go i was not able to reformat and sadly I was not able to found in internet ."}], "answers": [{"tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": true, "score": 4, "last_activity_date": 1517223019, "creation_date": 1517223019, "answer_id": 48499447, "question_id": 48499130, "link": "https://stackoverflow.com/questions/48499130/how-to-set-custom-json-response-structure-in-go/48499447#48499447", "title": "how to set custom json response structure in Go", "body": "<p>In order to change structure of your response, you need to provide the structure that you want to achieve with type.</p>\n\n<p>You can define <code>Response</code> struct type which will consist of <code>data</code> and <code>status</code> fields:</p>\n\n<pre><code>type Response struct {\n    Status string `json:\"status\"`\n    Data []Person `json:\"data\"`\n}\n\nvar people []Person\npeople = append(people, Person{Id: \"1\", Firstname: \"John\", Lastname: \"Doe\", Address: Address{City: \"City X\", State: \"State X\"}})\npeople = append(people, Person{Id: \"2\", Firstname: \"Koko\", Lastname: \"Doe\", Address: Address{City: \"City Z\", State: \"State Y\"}})\npeople = append(people, Person{Id: \"3\", Firstname: \"Francis\", Lastname: \"Sunday\"})\nw.Header().Set(\"Content-Type\", \"application/json\")\n\nresp := Response{Status: \"200\", Data: people}\njson.NewEncoder(w).Encode(resp)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 147, "user_id": 9214956, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-S3WMeb0HFlM/AAAAAAAAAAI/AAAAAAAAAEM/8_HgPsdfRqA/photo.jpg?sz=128", "display_name": "Ashish Kafle", "link": "https://stackoverflow.com/users/9214956/ashish-kafle"}, "edited": false, "score": 0, "creation_date": 1517224749, "post_id": 48499594, "comment_id": 83993322, "body": "This is also another  best solution for my problem."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1517223414, "creation_date": 1517223414, "answer_id": 48499594, "question_id": 48499130, "link": "https://stackoverflow.com/questions/48499130/how-to-set-custom-json-response-structure-in-go/48499594#48499594", "title": "how to set custom json response structure in Go", "body": "<p>you just need to pass response and request object to the function you are using <code>w.Header().Set(\"Content-Type\", \"application/json\")</code>. Either you can append to the struct or you can initialize it with multiple values in an array.</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\n\n//  Data struct\ntype Data struct {\n    status string\n    data   []Person\n}\n\n// Person struct\ntype Person struct {\n    Id        string\n    Firstname string\n    Lastname  string\n    Address   Address\n}\n\n// Address struct\ntype Address struct {\n    City  string\n    State string\n}\n\nfunc main() {\n    people := Data{\n        status: \"200\",\n        data: []Person{\n            {Id: \"1\", Firstname: \"John\", Lastname: \"Doe\", Address: Address{City: \"City X\", State: \"State X\"}},\n            {Id: \"2\", Firstname: \"Koko\", Lastname: \"Doe\", Address: Address{City: \"City Z\", State: \"State Y\"}},\n            {Id: \"3\", Firstname: \"Francis\", Lastname: \"Sunday\", Address: Address{City: \"City Z\", State: \"State Y\"}},\n        },\n    }\n    json.NewEncoder(w).Encode(people)\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 9214956, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-S3WMeb0HFlM/AAAAAAAAAAI/AAAAAAAAAEM/8_HgPsdfRqA/photo.jpg?sz=128", "display_name": "Ashish Kafle", "link": "https://stackoverflow.com/users/9214956/ashish-kafle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 48499447, "answer_count": 2, "score": 2, "last_activity_date": 1517223414, "creation_date": 1517221889, "last_edit_date": 1517222485, "question_id": 48499130, "link": "https://stackoverflow.com/questions/48499130/how-to-set-custom-json-response-structure-in-go", "title": "how to set custom json response structure in Go", "body": "<p>I am importing <em>\"encoding/json\"</em> package to print output in <em>json</em>.I was able to get the json format but i want to modify the response structure.\nHere is the sample code </p>\n\n<pre><code>var people []Person\npeople = append(people, Person{Id: \"1\", Firstname: \"John\", Lastname: \"Doe\", Address: Address{City: \"City X\", State: \"State X\"}})\npeople = append(people, Person{Id: \"2\", Firstname: \"Koko\", Lastname: \"Doe\", Address: Address{City: \"City Z\", State: \"State Y\"}})\npeople = append(people, Person{Id: \"3\", Firstname: \"Francis\", Lastname: \"Sunday\"})\nw.Header().Set(\"Content-Type\", \"application/json\")\njson.NewEncoder(w).Encode(people)\n</code></pre>\n\n<p>which outputs the following response</p>\n\n<pre><code>[\n{\n    \"id\": \"1\",\n    \"firstname\": \"John\",\n    \"lastname\": \"Doe\",\n    \"address\": {\n        \"city\": \"City X\",\n        \"state\": \"State X\"\n    }\n},\n{\n    \"id\": \"2\",\n    \"firstname\": \"Koko\",\n    \"lastname\": \"Doe\",\n    \"address\": {\n        \"city\": \"City Z\",\n        \"state\": \"State Y\"\n    }\n},\n{\n    \"id\": \"3\",\n    \"firstname\": \"Francis\",\n    \"lastname\": \"Sunday\",\n    \"address\": {\n        \"city\": \"\",\n        \"state\": \"\"\n    }\n}\n]\n</code></pre>\n\n<p>But i want to response into the following format</p>\n\n<pre><code>{\n\"status\": \"200\",\n\"data\": [\n    {\n        \"id\": \"1\",\n        \"firstname\": \"John\",\n        \"lastname\": \"Doe\",\n        \"address\": {\n            \"city\": \"City X\",\n            \"state\": \"State X\"\n        }\n    },\n    {\n        \"id\": \"2\",\n        \"firstname\": \"Koko\",\n        \"lastname\": \"Doe\",\n        \"address\": {\n            \"city\": \"City Z\",\n            \"state\": \"State Y\"\n        }\n    },\n    {\n        \"id\": \"3\",\n        \"firstname\": \"Francis\",\n        \"lastname\": \"Sunday\",\n        \"address\": {\n            \"city\": \"\",\n            \"state\": \"\"\n        }\n    }\n        ]\n}\n</code></pre>\n\n<p>How can I modify the response format ? I am beginner in Go. Thanks for your help.  </p>\n"}, {"tags": ["go", "io", "stdout", "child-process", "spawn"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517226016, "post_id": 48498505, "comment_id": 83994060, "body": "<code>bufio</code> does not have target specific code.  Have you tried to tee the output using <code>io.MultiWriter</code> to detect if it is blocked from cmd. I have a wild guess that is your external program behaves differently on Linux, instead of your go code."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1517232002, "post_id": 48498505, "comment_id": 83997743, "body": "Just a wild guess - could it be related to the way newlines need to be differently treated. Could you write a small program which just gives scanner the exact same input currently being given to it and run it both on Windows and Linux to see what happens."}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517232153, "post_id": 48498505, "comment_id": 83997849, "body": "@leafbebop I didn&#39;t think of that, I&#39;ll investigate. The child process appears the same on linux in terms of output though, i.e.: the output is streamed to the console normally through stdout."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1517232296, "post_id": 48498505, "comment_id": 83997946, "body": "@Ravi It is very unlikely, according to the document of <code>bufio.ScanLines</code>. But yes, some more controlled test would help. There is still too much mist here."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1517282089, "post_id": 48498505, "comment_id": 84021393, "body": "For testing purpose, if you replace current implementation with <code>cmd.Stdout = os.Stdout</code>, does it work correctly/as expected on Linux?"}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 0, "creation_date": 1517333446, "post_id": 48498505, "comment_id": 84049473, "body": "I&#39;ve just tested this and yes, it outputs as expected with <code>cmd.Stdout = os.Stdout</code>, it seems to be just binding it to io.Pipe() writer that screws it up."}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 0, "creation_date": 1517335209, "post_id": 48498505, "comment_id": 84050398, "body": "I&#39;ve now even tried reading byte-by-byte with <code>.Read(buf)</code> and it still blocks indefinitely... piping to stdout currently seems like the only fix but that circumvents the entire point of my project..."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1519010491, "post_id": 48498505, "comment_id": 84721632, "body": "See <a href=\"https://stackoverflow.com/questions/7876660/how-to-turn-off-buffering-of-stdout-in-c\" title=\"how to turn off buffering of stdout in c\">stackoverflow.com/questions/7876660/&hellip;</a>"}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1519067757, "post_id": 48498505, "comment_id": 84749326, "body": "@CeriseLim&#243;n this didn&#39;t apply to this case because that&#39;s targeting the child application&#39;s output - which I don&#39;t have access to. The chosen answer was correct."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1519070183, "post_id": 48498505, "comment_id": 84750399, "body": "The issue is with buffering in the child application.  The <code>stdbuf</code> command uses a preload hack to call <code>setvbuf()</code> in the child application.  The answers to the question I linked show how to solve the problem when you can change the child application:  call <code>setvbuf()</code>, call <code>fflush()</code>, etc."}], "answers": [{"tags": [], "owner": {"reputation": 509, "user_id": 7931378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c9fa152e41628efa68299f8a4fb7b53?s=128&d=identicon&r=PG&f=1", "display_name": "Y_Less", "link": "https://stackoverflow.com/users/7931378/y-less"}, "is_accepted": true, "score": 2, "last_activity_date": 1518699720, "creation_date": 1518699720, "answer_id": 48807957, "question_id": 48498505, "link": "https://stackoverflow.com/questions/48498505/scanner-scan-blocking-until-exit-on-linux-but-not-windows/48807957#48807957", "title": "scanner.Scan() blocking until exit on Linux but not Windows", "body": "<p>By default, Linux buffers output when not in interactive mode (i.e. not in a terminal), so the output is only flushed when the buffer is full (e.g. every 4096 bytes, but this is implmentation defined); when the program explicitly calls <code>flush</code> (which is apparently not happening here); or when the process ends (as you are seeing).</p>\n\n<p>You can change this default behaviour by adjusting the buffer size.  For example, by launching a program via <code>stdbuf</code>:</p>\n\n<pre><code>stdbuf -oO /root/.samp/runtime/0.3.7/samp03svr\n</code></pre>\n\n<p><code>-o</code> for <code>stdout</code> (also <code>-e</code> and <code>-i</code>), <code>O</code> for \"Off\" (also <code>L</code> for \"line buffered\" or a size for an explicit buffer size).</p>\n\n<p>Alternatively there is an <code>unbuffer</code> command or the <code>script</code> command:</p>\n\n<p><a href=\"https://unix.stackexchange.com/questions/25372/turn-off-buffering-in-pipe/61833#61833\">https://unix.stackexchange.com/questions/25372/turn-off-buffering-in-pipe/61833#61833</a></p>\n"}, {"tags": [], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "is_accepted": false, "score": 2, "last_activity_date": 1519067900, "creation_date": 1519067900, "answer_id": 48872807, "question_id": 48498505, "link": "https://stackoverflow.com/questions/48498505/scanner-scan-blocking-until-exit-on-linux-but-not-windows/48872807#48872807", "title": "scanner.Scan() blocking until exit on Linux but not Windows", "body": "<p>Going on from the answer from Y_Less, the general solution was to use a pseudo-terminal. I wanted to avoid using stdbuf or unbuffer as that would require depending on external commands being present.</p>\n\n<p>So my end solution for this was <a href=\"https://github.com/kr/pty\" rel=\"nofollow noreferrer\">https://github.com/kr/pty</a> which is a Go implementation of a pseudo-terminal.</p>\n\n<p>Just thought I'd self-answer to help any other Go users finding this question via search.</p>\n"}], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 1, "accepted_answer_id": 48807957, "answer_count": 2, "score": 3, "last_activity_date": 1519067900, "creation_date": 1517219807, "last_edit_date": 1518692872, "question_id": 48498505, "link": "https://stackoverflow.com/questions/48498505/scanner-scan-blocking-until-exit-on-linux-but-not-windows", "title": "scanner.Scan() blocking until exit on Linux but not Windows", "body": "<p>I'm working on a devtool and one of the features of this tool involves spawning a child process and reading the stdout stream of that process. I need to read each line of output into memory in order to process it in some way (one of the future features of the tool will involve processing logs and sending them to external locations such as log managers and dashboards etc) so that's why I don't simply do <code>cmd.Stdout = os.Stdout</code>)</p>\n\n<p>It works fine, and has done for a while, but only on Windows apparently. I got a rather confusing <a href=\"https://github.com/Southclaws/sampctl/issues/100\" rel=\"nofollow noreferrer\">bug report</a> recently where a user reported the output isn't \"real time\" and upon testing on Linux, I found that it's true and the output is only dumped to the console when the process exits.</p>\n\n<p>Here is the code that scans reader, works as expected on Windows but not on Linux or in a Linux container on Windows/MacOS (tested both)</p>\n\n<p><a href=\"https://github.com/Southclaws/sampctl/blob/f639c941dd8f9ca7c7c819a152909044ad63be08/runtime/run.go#L133-L137\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/sampctl/blob/f639c941dd8f9ca7c7c819a152909044ad63be08/runtime/run.go#L133-L137</a></p>\n\n<p>And if you poke around the code you'll find where the reader is created with io.Pipe() and bound to the cmd's Stdout/Stderr outputs.</p>\n\n<p>That line 134 is where the program just blocks until the <code>cmd</code> in the goroutine below stops running, on line 161.</p>\n\n<p>I'm assuming this is related to buffers and flushing but I don't know enough about Go's internals to really pinpoint the problem. What exactly is different about <code>scanner.Scan()</code> on Windows and Linux? Why does it block on one platform but not on another? Is it related to threads/goroutines being scheduled differently? (both test machines have multiple cores, even the Docker container had 4 vCPUs)</p>\n\n<p>Here's the issue for reference: <a href=\"https://github.com/Southclaws/sampctl/issues/100\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/sampctl/issues/100</a></p>\n\n<p>I'm really stumped on this one, would love some help figuring it out!</p>\n\n<p>Edit:</p>\n\n<p>So I messed around some more, still no solution. I attempted to use a Python script and got the same result, stdout works fine when directed to a tty but when it's read by a process it just hangs:</p>\n\n<pre><code>from subprocess import Popen, PIPE\nfrom time import sleep\n\np = Popen(\n    ['/root/.samp/runtime/0.3.7/samp03svr'],\n    stdin=PIPE,\n    stdout=PIPE,\n    stderr=PIPE,\n    shell=False,\n    cwd=\"/root/.samp/runtime/0.3.7/\")\n\nwhile True:\n    print \"attempting to read a line\"\n    output = p.stdout.read()\n    print \"read a line\"\n    if not output:\n        print '[No more data]'\n        break\n    print output\n</code></pre>\n\n<p><code>attempting to read a line</code> is where it hangs.</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "answers": [{"comments": [{"owner": {"reputation": 7476, "user_id": 1582304, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4adb0a12197208cd64a247a6f5431cf9?s=128&d=identicon&r=PG", "display_name": "zono", "link": "https://stackoverflow.com/users/1582304/zono"}, "edited": false, "score": 0, "creation_date": 1517221393, "post_id": 48498921, "comment_id": 83991196, "body": "Thank you! I&#39;ll try it without the volumes as you mentioned."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 7476, "user_id": 1582304, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4adb0a12197208cd64a247a6f5431cf9?s=128&d=identicon&r=PG", "display_name": "zono", "link": "https://stackoverflow.com/users/1582304/zono"}, "edited": false, "score": 0, "creation_date": 1517222247, "post_id": 48498921, "comment_id": 83991776, "body": "Let me know if it wokrs"}, {"owner": {"reputation": 7476, "user_id": 1582304, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4adb0a12197208cd64a247a6f5431cf9?s=128&d=identicon&r=PG", "display_name": "zono", "link": "https://stackoverflow.com/users/1582304/zono"}, "edited": false, "score": 1, "creation_date": 1517222445, "post_id": 48498921, "comment_id": 83991887, "body": "You are completely right! That process was overwriting. I&#39;m preparing to post the result. give me 5 min."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 7476, "user_id": 1582304, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4adb0a12197208cd64a247a6f5431cf9?s=128&d=identicon&r=PG", "display_name": "zono", "link": "https://stackoverflow.com/users/1582304/zono"}, "edited": false, "score": 1, "creation_date": 1517222525, "post_id": 48498921, "comment_id": 83991936, "body": "Don&#39;t forget to hit necessary button :)"}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 8, "last_activity_date": 1517221996, "last_edit_date": 1517221996, "creation_date": 1517221126, "answer_id": 48498921, "question_id": 48498120, "link": "https://stackoverflow.com/questions/48498120/go-get-in-dockerfile-i-got-cannot-find-package-error/48498921#48498921", "title": "go get in Dockerfile. I got cannot find package error", "body": "<p>I have tried to recreate your problem.</p>\n\n<pre><code>FROM golang:latest\n\nRUN apt-get update\nRUN apt-get upgrade -y\n\nENV GOBIN /go/bin\n\nRUN go get github.com/go-sql-driver/mysql\n</code></pre>\n\n<p>You have provided this Dockerfile. I have build it</p>\n\n<pre><code>$ docker build -t test .\n</code></pre>\n\n<p>Now I exec into this image to run your <code>go build</code> command.</p>\n\n<pre><code>$ docker run -it test bash\n</code></pre>\n\n<p>Then I have created <code>main.go</code>, you provided, in <code>/go/src</code> directory.</p>\n\n<p>And finally, I have built successfully without any error</p>\n\n<pre><code>$ go build -i -o /go/bin/explorer-cli src/main.go\n</code></pre>\n\n<p>And I think I have found your problem. I have never used <code>docker-compose</code>. But you will understand.</p>\n\n<p><strong>Problem</strong> is here:</p>\n\n<pre><code>  app:\n    build: .\n    tty: true\n    image: explorer-cli:latest\n    container_name: explorer-cli\n    volumes:\n      - ./src:/go/src  &lt;-- problem is here\n    external_links:\n      - database\n</code></pre>\n\n<p>You are mounting <code>./src</code> into <code>/go/src</code> directory in your docker. This process is overwriting directory <code>/go/src</code> in your docker with your local <code>./src</code>. And this is removing data you got from <code>go get github.com/go-sql-driver/mysql</code></p>\n\n<p>Do you understand?</p>\n\n<p>But when you are running <code>go get github.com/go-sql-driver/mysql</code>, its now getting data again.</p>\n\n<p><strong>Solution (01):</strong></p>\n\n<p>Mount your local volume into somewhere else.</p>\n\n<pre><code>volumes:\n  - ./src:/tmp/src\n</code></pre>\n\n<p>And modify your Dockerfile to move this <code>main.go</code> to <code>/go/src</code></p>\n\n<p><strong>Solution (02):</strong></p>\n\n<p>Copy <code>main.go</code> into your docker. Add this line in Dockerfile</p>\n\n<pre><code>COPY ./src/main.go /go/src\n</code></pre>\n"}], "owner": {"reputation": 7476, "user_id": 1582304, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4adb0a12197208cd64a247a6f5431cf9?s=128&d=identicon&r=PG", "display_name": "zono", "link": "https://stackoverflow.com/users/1582304/zono"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7067, "favorite_count": 2, "accepted_answer_id": 48498921, "answer_count": 1, "score": 3, "last_activity_date": 1517222915, "creation_date": 1517218422, "last_edit_date": 1517222915, "question_id": 48498120, "link": "https://stackoverflow.com/questions/48498120/go-get-in-dockerfile-i-got-cannot-find-package-error", "title": "go get in Dockerfile. I got cannot find package error", "body": "<p>I added <code>RUN go get</code> to install packages during \"docker-compose\". However, the following <code>cannot find package</code> error was occurred when I run <code>go build</code>. I found that the packages are saved in <code>/go/pkg/linux_amd64/</code>.</p>\n\n<p><strong>run docker-compose and go build</strong></p>\n\n<pre><code>$ docker-compose up -d\n$ docker exec -it explorer-cli /bin/bash\n# pwd\n/go\n# ls     \nbin  pkg  src\n# echo $GOPATH\n/go\n# ls /go/pkg/linux_amd64/github.com/\ngo-sql-driver\n# go build -i -o /go/bin/explorer-cli src/main.go \nsrc/main.go:6:2: cannot find package \"github.com/go-sql-driver/mysql\" in any of:\n    /usr/local/go/src/github.com/go-sql-driver/mysql (from $GOROOT)\n    /go/src/github.com/go-sql-driver/mysql (from $GOPATH)\n\n(it worked if I run \"go get\" manually)\n# go get github.com/go-sql-driver/mysql\n# ls src/\ngithub.com  main.go\n# go build -i -o /go/bin/explorer-cli src/main.go\n</code></pre>\n\n<p><strong>docker-compose.yml</strong></p>\n\n<pre><code>version: '3.4'\n\nservices:\n  mysql:\n    image: mysql:latest\n    container_name: database\n    volumes:\n      - ./docker/:/etc/mysql/conf.d\n      - ./docker/:/docker-entrypoint-initdb.d\n    environment:\n      - MYSQL_RANDOM_ROOT_PASSWORD=true\n      - MYSQL_DATABASE=explorer\n      - MYSQL_USER=admin\n      - MYSQL_PASSWORD=12dlql*41\n  app:\n    build: .\n    tty: true\n    image: explorer-cli:latest\n    container_name: explorer-cli\n    volumes:\n      - ./src:/go/src\n    external_links:\n      - database\n</code></pre>\n\n<p><strong>Dockerfile</strong></p>\n\n<pre><code>FROM golang:latest\n\nRUN apt-get update\nRUN apt-get upgrade -y\n\nENV GOBIN /go/bin\n\nRUN go get github.com/go-sql-driver/mysql\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    db, err := sql.Open(\"mysql\", \"admin:12dlql*41@(database:3306)/explorer\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<hr>\n\n<p>Update 1</p>\n\n<p>I noticed big differences between the following directories.</p>\n\n<pre><code># ls /go/pkg/linux_amd64/github.com/go-sql-driver/\nmysql.a\n\n# ls /go/src/github.com/go-sql-driver/mysql/\nAUTHORS                 connection_go18_test.go packets.go\nCHANGELOG.md            connection_test.go      packets_test.go\nCONTRIBUTING.md         const.go                result.go\nLICENSE                 driver.go               rows.go\nREADME.md               driver_go18_test.go     statement.go\nappengine.go            driver_test.go          statement_test.go\nbenchmark_go18_test.go  dsn.go                  transaction.go\nbenchmark_test.go       dsn_test.go             utils.go\nbuffer.go               errors.go               utils_go17.go\ncollations.go           errors_test.go          utils_go18.go\nconnection.go           fields.go               utils_go18_test.go\nconnection_go18.go      infile.go               utils_test.go\n</code></pre>\n\n<hr>\n\n<p>Update 2</p>\n\n<p>As @aerokite said, the \"volumes\" was overwriting the downloaded packages. I changed like the followings and it worked.</p>\n\n<p><strong>Dockerfile</strong></p>\n\n<pre><code>version: '3.4'\n\nFROM golang:latest\n\nRUN apt-get update\nRUN apt-get upgrade -y\n\nENV GOBIN /go/bin\n\nRUN go get github.com/go-sql-driver/mysql\n\nRUN mkdir /go/src/explorer-cli\n</code></pre>\n\n<p><strong>docker-compose</strong></p>\n\n<pre><code>services:\n  mysql:\n    image: mysql:latest\n    container_name: database\n    volumes:\n      - ./docker/:/etc/mysql/conf.d\n      - ./docker/:/docker-entrypoint-initdb.d\n    environment:\n      - MYSQL_RANDOM_ROOT_PASSWORD=true\n      - MYSQL_DATABASE=explorer\n      - MYSQL_USER=admin\n      - MYSQL_PASSWORD=12dlql*41\n  app:\n    build: .\n    tty: true\n    image: explorer-cli:latest\n    container_name: explorer-cli\n    volumes:\n      - ./src/explorer-cli:/go/src/explorer-cli\n    external_links:\n      - database\n</code></pre>\n\n<p><strong>go build</strong></p>\n\n<pre><code>go build -i -o /go/bin/explorer-cli src/explorer-cli/main.go\n</code></pre>\n"}, {"tags": ["ssl", "go", "https"], "answers": [{"comments": [{"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1517221296, "post_id": 48498233, "comment_id": 83991133, "body": "That&#39;s great, thaks. So I found out it supports:<code>TLS_RSA_WITH_AES_256_CBC_SHA TLS_RSA_WITH_3DES_EDE_CBC_SHA TLS_RSA_WITH_AES_128_CBC_SHA TLS_RSA_WITH_RC4_128_SHA</code>. Adding thede to the <code>CipherSuites</code> didn&#39;t help. I must create an <code>RSA</code> key/cert?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 1, "creation_date": 1517221659, "post_id": 48498233, "comment_id": 83991382, "body": "You do need a server certificate and key. These are usually with RSA for compatibility. If this is for a public-facing server, the easiest way is to use Let&#39;s Encrypt."}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1517222038, "post_id": 48498233, "comment_id": 83991633, "body": "I&#39;ve created the key using <code>openssl</code> (just copied the commands from <a href=\"https://gist.github.com/denji/12b3a568f092ab951456\" rel=\"nofollow noreferrer\">this</a> site). But just now I&#39;ve finally understood that the second command (<code>openssl ecparam -genkey -name secp384r1 -out server.key</code>) created <code>ECDSA</code> key, and not a <code>RSA</code> key. So I&#39;ve created a new <code>RSA</code> key now it&#39;s all happily running thank you!"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1517229757, "post_id": 48498233, "comment_id": 83996255, "body": "@microo8: those cipher suites look like SSL, elliptic curve diffie-hellman is more of a TLS thing. You definitely shouldn&#39;t be using SSL, and not even TLS 1.0."}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1517296253, "post_id": 48498233, "comment_id": 84025758, "body": "In <code>SupportedVersions</code> is that it supports TLS1.0 so I think it is ok"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1517228307, "last_edit_date": 1592644375, "creation_date": 1517218821, "answer_id": 48498233, "question_id": 48498038, "link": "https://stackoverflow.com/questions/48498038/ssl-version-and-cipher-suites-of-the-client/48498233#48498233", "title": "ssl version and cipher suites of the client", "body": "<p>There seems to be two questions here, so let's do this in two parts:</p>\n<h3>Finding the client's TLS version and supported cipher suites:</h3>\n<p>To do this, you need to set the <code>GetConfigForClient</code> field of the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> object.</p>\n<p>This field takes a method with signature:</p>\n<pre><code>func(*ClientHelloInfo) (*Config, error)\n</code></pre>\n<p>It is called on receipt of a <code>Client Hello</code> message with a <a href=\"https://golang.org/pkg/crypto/tls/#ClientHelloInfo\" rel=\"nofollow noreferrer\">ClientHelloInfo</a> struct. This struct contains the following fields of interest to you:</p>\n<pre><code>    // CipherSuites lists the CipherSuites supported by the client (e.g.\n    // TLS_RSA_WITH_RC4_128_SHA).\n    CipherSuites []uint16\n\n    // SupportedVersions lists the TLS versions supported by the client.\n    // For TLS versions less than 1.3, this is extrapolated from the max\n    // version advertised by the client, so values other than the greatest\n    // might be rejected if used.\n    SupportedVersions []uint16\n</code></pre>\n<p>Please read the comments around <code>GetConfigForClient</code> and <code>ClientHelloInfo</code> for exactly how <code>GetConfigForClient</code> should behave, and for field details.</p>\n<h3>Specifying server-supported version and cipher suites:</h3>\n<p>This is also done through the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> object using the following fields:</p>\n<pre><code>    // CipherSuites is a list of supported cipher suites. If CipherSuites\n    // is nil, TLS uses a list of suites supported by the implementation.\n    CipherSuites []uint16\n\n    // MinVersion contains the minimum SSL/TLS version that is acceptable.\n    // If zero, then TLS 1.0 is taken as the minimum.\n    MinVersion uint16\n\n    // MaxVersion contains the maximum SSL/TLS version that is acceptable.\n    // If zero, then the maximum version supported by this package is used,\n    // which is currently TLS 1.2.\n    MaxVersion uint16\n</code></pre>\n<p>For example, you could set your tls.Config with the following fields:</p>\n<pre><code>    CipherSuites: []uint16{\n        tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,\n        tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n        tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,\n        etc...\n        tls.TLS_RSA_WITH_AES_256_CBC_SHA,\n    },\n\n    MinVersion: tls.VersionTLS12,\n</code></pre>\n<p>The full list of supported cipher suites is in the <a href=\"https://golang.org/pkg/crypto/tls/#pkg-constants\" rel=\"nofollow noreferrer\">tls docs</a>.</p>\n"}], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2534, "favorite_count": 1, "accepted_answer_id": 48498233, "answer_count": 1, "score": 1, "last_activity_date": 1517228307, "creation_date": 1517218179, "last_edit_date": 1517221069, "question_id": 48498038, "link": "https://stackoverflow.com/questions/48498038/ssl-version-and-cipher-suites-of-the-client", "title": "ssl version and cipher suites of the client", "body": "<p>I'm working on a soap server, that will serve some old embedded computers with an legacy soap protocol.</p>\n\n<p>I write it in <em>go</em> and so far used just plain <code>http</code>, but in production it must use <code>ssl</code> encryption. So I've just created a key and a cert (from <a href=\"https://gist.github.com/denji/12b3a568f092ab951456\" rel=\"nofollow noreferrer\">this site</a>) and used the <code>http.ListenAndServeTLS</code> function.</p>\n\n<p>But now the computers cannot connect and the server is just printing a handshake error:</p>\n\n<p><code>server.go:2848: http: TLS handshake error from [::1]:38790: tls: no cipher suite supported by both client and server\n</code></p>\n\n<p>In the docs, for the computers, isn't the supported ssl version or the ciphers. So I wanted to know, how to find out the client's ssl version, and also the available cipher suites that the client supports.</p>\n\n<p>And then how can I configure the golang http server so it will support the selected ciphers.</p>\n"}, {"tags": ["python", "go", "memory-management", "cython"], "answers": [{"comments": [{"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1517230282, "post_id": 48499056, "comment_id": 83996608, "body": "Oh, that&#39;s great. I&#39;ll need to read the references first though.  First link is a 404."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1517234310, "post_id": 48499056, "comment_id": 83999365, "body": "Morty is correct, I concur with them. The correct link to the 1st resource is <a href=\"https://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">this</a>. Please also read <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">this</a> and\u2014the most important one\u2014<a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">this</a>\u2014esp. its &quot;Go references to C&quot; and &quot;Passing pointers&quot; parts. For truly hard-core details, you may find reading through <a href=\"https://github.com/golang/go/issues/12416\" rel=\"nofollow noreferrer\">this</a> to be enlightening."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1517234544, "post_id": 48499056, "comment_id": 83999537, "body": "One more comment: when using <code>CString</code> from Go, the memory will be allocated using <code>C.malloc</code> of the <code>libc</code> linked with the resulting Go code. Hence when combining this code with &quot;plain&quot; C code or C code which is an extension to Python (or whatever), two things are presupposed: 1) when that C code is compiled it will be linked with the same <code>libc</code>\u2014to have the same implementation of <code>malloc</code> and <code>free</code>, and 2) your C extention must have a way to call unadorned <code>free</code> on that memory passed from the Go side (as opposed to some function from some CPython memory management code, if any)."}, {"owner": {"reputation": 4536, "user_id": 4165324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d50177f8e05b2c515b26455ba250ce?s=128&d=identicon&r=PG&f=1", "display_name": "danny", "link": "https://stackoverflow.com/users/4165324/danny"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1517330191, "post_id": 48499056, "comment_id": 84047548, "body": "@kostix makes a couple very important points about the same <code>free</code> and <code>malloc</code> used by Go and the extension. A few more details on that, python&#39;s own allocators are called <code>Py_Malloc</code> and <code>Py_Free</code> respectively so as not to be confused with the <code>libc</code> versions. In Cython code, use <code>from libc.stdlib cimport free, malloc</code> for the same functions Go is using via libc."}, {"owner": {"reputation": 4536, "user_id": 4165324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d50177f8e05b2c515b26455ba250ce?s=128&d=identicon&r=PG&f=1", "display_name": "danny", "link": "https://stackoverflow.com/users/4165324/danny"}, "edited": false, "score": 1, "creation_date": 1517330460, "post_id": 48499056, "comment_id": 84047717, "body": "Another approach to simplify this would be to convert the C string to a Python string in Cython. Since the C string was created via Go, its length is known, to make converting to a Python string faster. After it is made into a python object the C string can be de-allocated immediately as it has been copied and the Python string left up to Python to GC, since you&#39;ll need to return Python string from the Python function in any case."}], "tags": [], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "is_accepted": true, "score": 4, "last_activity_date": 1517329264, "last_edit_date": 1517329264, "creation_date": 1517221637, "answer_id": 48499056, "question_id": 48497879, "link": "https://stackoverflow.com/questions/48497879/foreign-function-who-deallocates-memory/48499056#48499056", "title": "Foreign function: who deallocates memory?", "body": "<p>I don't think you should return a <code>GoString</code> to C. Since the memory of <code>GoString</code> is managed by the go runtime and will be garbage collected. It's unreliable in C land to use this string. What you should do is return a <code>CString</code> by calling <code>cs := C.CString(s)</code>. Memory allocations made by C code are not known to Go's memory manager. So I think its up to you to mange which side to free the <code>CString</code>, <a href=\"https://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/bBylU8kE5uk\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 48499056, "answer_count": 1, "score": 3, "last_activity_date": 1517329264, "creation_date": 1517217584, "last_edit_date": 1517220364, "question_id": 48497879, "link": "https://stackoverflow.com/questions/48497879/foreign-function-who-deallocates-memory", "title": "Foreign function: who deallocates memory?", "body": "<p>I'm calling a Go function from Python.  Go function returns a string, specifically, a <code>GoString</code> with the string itself being allocated on Go's side.</p>\n\n<h1>Question</h1>\n\n<p>Who's responsible for deallocation of this memory?</p>\n\n<hr>\n\n<p>A very simplified example follows.</p>\n\n<p>Go side:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Create(optsEncoded string) (res string, serr string) {\n    opts := map[string]interface{}{}\n    if err := json.Unmarshal([]byte(optsEncoded), &amp;opts); err != nil {\n        return \"\", errWithStack(err)\n    }\n    options := translateCreateOptions(opts)\n\n    result := ...\n\n    payload, err := json.Marshal(result)\n    if err != nil {\n        return \"\", errWithStack(err)\n    }\n    return string(payload), \"\"\n}\n</code></pre>\n\n<p>Cython bindings:\n</p>\n\n<pre><code>cpdef object py_create(object items, bytes options):\n    cdef GoString opts = ...\n    cdef bytes message\n\n    cdef Create_return result = Create(opts)\n\n    if result.r0.n == 0:\n        message = result.r1.p\n        raise Exception(\"Something happened\")\n    message = result.r0.p\n    # Do I need to deallocate result.r0 and result.r1?\n    return message.decode(\"utf-8\")\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517209912, "post_id": 48495860, "comment_id": 83985118, "body": "You can&#39;t do this in a easy way. You need to handle this using additional <code>struct</code>"}, {"owner": {"reputation": 21, "user_id": 8750420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7039a8a707c77af15d1652a9fcb20125?s=128&d=identicon&r=PG&f=1", "display_name": "mike.liubo", "link": "https://stackoverflow.com/users/8750420/mike-liubo"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517210538, "post_id": 48495860, "comment_id": 83985343, "body": "yes, I can use additional struct, but it would change the interface. PB do not support &#39;repeat&#39;  in map value in current realization?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517210844, "post_id": 48495860, "comment_id": 83985486, "body": "No, It doesn&#39;t  support &#39;repeat&#39;  in map value."}], "owner": {"reputation": 21, "user_id": 8750420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7039a8a707c77af15d1652a9fcb20125?s=128&d=identicon&r=PG&f=1", "display_name": "mike.liubo", "link": "https://stackoverflow.com/users/8750420/mike-liubo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 422, "favorite_count": 1, "closed_date": 1517210262, "answer_count": 0, "score": 2, "last_activity_date": 1517209494, "creation_date": 1517208730, "last_edit_date": 1517209104, "question_id": 48495860, "link": "https://stackoverflow.com/questions/48495860/how-write-protobuf-file-in-golang-like-this-mapstringstring", "closed_reason": "Duplicate", "title": "how write protobuf file in golang like this map[string][]string", "body": "<p>I have a struct like this in golang:</p>\n\n<pre><code>type Request struct {\n      Mark     string              \n      RemoteIp string              \n      Url      string              \n      Header   map[string][]string \n      Body     []byte              \n}\n</code></pre>\n\n<p>how to convert map[string][]string structure to protobuf message\uff1f I've try out this, but wrong</p>\n\n<pre><code>map&lt;string,   repeated string&gt; Header = 4;\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "sleep", "google-app-engine-go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517231574, "post_id": 48495550, "comment_id": 83997446, "body": "Are you in the standard or flexible environment? And how is this triggered, is it when you perform a request on the server? Be aware that the <a href=\"https://cloud.google.com/appengine/docs/the-appengine-environments\" rel=\"nofollow noreferrer\">standard environment</a> has a 60s timeout on requests."}, {"owner": {"reputation": 31, "user_id": 8461883, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d8fd3a86b4c84dd64a2029033f3cdb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Gurjit Singh", "link": "https://stackoverflow.com/users/8461883/gurjit-singh"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517240733, "post_id": 48495550, "comment_id": 84003847, "body": "@Marc Thanks for the reply, I am in the standard environment yes it is triggered when you perform request on the server, I have read about flexible environment do you think flexible environment is more suitable for such kind of use case"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517240831, "post_id": 48495550, "comment_id": 84003934, "body": "The docs clearly state your requests will timeout after 1 minute, so if you want a 3 minute sleep within your request (which is just odd), you need to use the flexible environment."}, {"owner": {"reputation": 31, "user_id": 8461883, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d8fd3a86b4c84dd64a2029033f3cdb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Gurjit Singh", "link": "https://stackoverflow.com/users/8461883/gurjit-singh"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517243983, "post_id": 48495550, "comment_id": 84006082, "body": "Thanks @Marc I know 3 minutes sleep is odd but it is required"}], "owner": {"reputation": 31, "user_id": 8461883, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d8fd3a86b4c84dd64a2029033f3cdb4f?s=128&d=identicon&r=PG&f=1", "display_name": "Gurjit Singh", "link": "https://stackoverflow.com/users/8461883/gurjit-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517210833, "creation_date": 1517207419, "last_edit_date": 1517210833, "question_id": 48495550, "link": "https://stackoverflow.com/questions/48495550/how-to-time-sleep-for-some-time-in-app-engine", "title": "How to time.sleep() for some time in App Engine?", "body": "<p>I want call to two GET requests from my App in App Engine. I want to sleep for few minutes after calling the first request and then call the second request. If I add time.sleep() in the code I am able to deploy code but if I hit the URL of the App it gives me -><br/> \n<strong>Error: Server Error</strong> <br>\n<strong>The server encountered an error and could not complete your request.</strong><br>\n<strong>Please try again in 30 seconds.</strong></p>\n\n<p>health-policy.go</p>\n\n<pre><code>isHealthy, err = h.CampaignService.Run(ctx)\nreturn err\nif isHealthy {\n        startTime = time.Now().Format(time.RFC3339)\n        //The line below causes 500 error\n        time.Sleep(3 * time.Minute)\n        isHealthy, err = h.ReportService.GenerateReport(ctx, startTime)\n    }\n</code></pre>\n\n<p>campaign-run-service.go</p>\n\n<pre><code>req, err = http.NewRequest(\"GET\", \"URL1\", nil)\nclient := urlfetch.Client(ctx)\nres, err = client.Do(req)\nif err == nil &amp;&amp; res.StatusCode == http.StatusOK {\n    return true, err\n}\nfmt.Println(\"Error in Run Service -&gt;\", err)\nreturn false, err\n</code></pre>\n\n<p>generate-report-service.go</p>\n\n<pre><code>req, err = http.NewRequest(\"GET\", \"URL2\", nil)\nclient := urlfetch.Client(ctx)\nres, err = client.Do(req)\nif err == nil &amp;&amp; res.StatusCode == http.StatusOK &amp;&amp; res.ContentLength &gt; 400 {\n    return true, err\n}\nreturn false, err\n</code></pre>\n\n<p>I am new to App Engine, also using sleep in app engine code a good idea if not than what is the alternative?</p>\n"}, {"tags": ["r", "go"], "answers": [{"tags": [], "owner": {"reputation": 1096, "user_id": 9120475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/736833caa7bfade9db577ed78d721e26?s=128&d=identicon&r=PG&f=1", "display_name": "LachlanO", "link": "https://stackoverflow.com/users/9120475/lachlano"}, "is_accepted": false, "score": 0, "last_activity_date": 1517202798, "last_edit_date": 1517202798, "creation_date": 1517202495, "answer_id": 48494731, "question_id": 48494395, "link": "https://stackoverflow.com/questions/48494395/how-to-get-maximum-high-or-minimum-low-for-each-week-in-a-daily-timeseries-data/48494731#48494731", "title": "How to get maximum high or minimum low for each week in a daily timeseries data then make it a weekly timeseries?", "body": "<p>I'd start by generating a column which specifies which week it is.</p>\n\n<p>You could use the <code>lubridate</code> package to do this, that would require converting your dates into <code>Date</code> types. It has a function called <code>week</code> which returns the number of full 7 day periods that have passed since Jan 1st + 1. However I don't know if this data goes over several years or not. Plus I think there's a simpler way to do this.</p>\n\n<p>The example I'll give below will simply do it by creating a column which just repeats an integer 7 times up to the length of your data frame.</p>\n\n<p>Pretend your data frame is called <code>ohlcData</code>.</p>\n\n<pre><code># Create a sequence 7 at a time all the way up to the end of the data frame\n# I limit the sequence to the length nrow(ohlcData) so the rounding error\n# doesn't make the vectors uneven lengths\nohlcData$Week &lt;- rep(seq(1, ceiling(nrow(ohlcData)/7), each = 7)[1:nrow(ohlcData)]\n</code></pre>\n\n<p>With that created we can then go ahead and use the <code>plyr</code> package, which has a really useful function called <code>ddply</code>. This function applies a function to columns of data grouped by another column of data. In this case we will apply the <code>max</code> and <code>min</code> functions to your data based on its grouping by our new column <code>Week</code>.</p>\n\n<pre><code>library(plyr)\n\nweekMax &lt;- ddply(ohlcData[,c(\"Week\", \"High\")], \"Week\", numcolwise(max))\nweekMin &lt;- ddply(ohlcData[,c(\"Week\", \"Low\")], \"Week\", numcolwise(min))\n</code></pre>\n\n<p>That will then give you the min and max of each week. The dataframe returned for both weekMax and weekMin will have 2 columns, Week and the value. Combine these however you see fit. Perhaps <code>weekExtreme &lt;- cbind(weekMax, weekMin[,2])</code>. If you want to be able to marry up date ranges to the week numbers it will just be every 7th date starting with whatever your first date was.</p>\n"}], "owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517202798, "creation_date": 1517200041, "question_id": 48494395, "link": "https://stackoverflow.com/questions/48494395/how-to-get-maximum-high-or-minimum-low-for-each-week-in-a-daily-timeseries-data", "title": "How to get maximum high or minimum low for each week in a daily timeseries data then make it a weekly timeseries?", "body": "<p>I have an ohlc daily data for US stocks. I would like to derive a weekly timeseries from it and compute SMA and EMA. To be able to do that though, requirement is to create the weekly timeseries from the maximum high per week, and another weekly timeseries from the minimum low per week. After that I, would then compute their sma and ema then assign to every days of the week (one period forward). So, first problem first, how do I get the weekly from the daily using R (any package), or better if you can show me an algo for it, any language but preferred is Golang? Anyway, I can rewrite it in golang if needed.</p>\n\n<pre><code>   Date           High     Low     Week(High)   Week(Low)   WkSMAHigh 2DP     WkSMALow 2DP \n                                                         (one period forward)   \nDec 24 Fri         6        3           8            3            5.5              1.5       \nDec 23 Thu         7        5                                     5.5              1.5\nDec 22 Wed         8        5                                     5.5              1.5\nDec 21 Tue         4        4                                     5.5              1.5\nAssume Holiday (Dec 20)\nDec 17 Fri         4        3           6            2           None\nDec 16 Thu         4        3\nDec 15 Wed         5        2\nDec 14 Tue         6        4\nDec 13 Mon         6        4\nDec 10 Fri         5        1           5            1           None\nDec 9 Thu          4        3\nDec 8 Wed          3        2\nAssume Holiday (Dec 6 &amp; 7)\n</code></pre>\n"}, {"tags": ["mongodb", "go", "aggregation-framework"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1517190581, "post_id": 48492358, "comment_id": 83979877, "body": "As stated in documentation/comment in the question: <i>&quot;A node ... is a single point in space defined by its latitude, longitude and node id&quot;</i>. When looking at your code (without further digging it more deeper), I noticed that you pass <code>[lon, lat]</code> to <code>&quot;$centerSphere&quot;</code>. Is that correct?"}, {"owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1517191014, "post_id": 48492358, "comment_id": 83979960, "body": "@putu Yup, that is correct, and my checks after the query will alert me if the query did not return something or no valid values where returned. I also triple checked and the nodes are unmarshalled with their ID set correctly (I mean, <code>OSMNode.ID</code> has an expected value). Thus, either my query for the Pipeline is wrong or I&#39;m not constructing it correctly."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 1, "creation_date": 1517452606, "post_id": 48492358, "comment_id": 84105381, "body": "Could you provide example documents from both collections ? Also, include an example document that would be returned by your query."}, {"owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1517455484, "post_id": 48492358, "comment_id": 84105955, "body": "@WanBachtiar I have updated my question"}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1517468471, "creation_date": 1517468471, "answer_id": 48557032, "question_id": 48492358, "link": "https://stackoverflow.com/questions/48492358/mgo-with-aggregation-filtering-with-another-query-and-field-alteration/48557032#48557032", "title": "mgo with aggregation, filtering with another query and field alteration", "body": "<p>This is because there is a typo in your aggregation pipeline. The operator is called <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/\" rel=\"nofollow noreferrer\">$addFields</a> not <code>$addField</code> (missing an <code>s</code>). </p>\n\n<p>The method invocation of <code>w.Pipe()</code> should throw an error something along the lines of <code>Unrecognized pipeline stage name: '$addField'</code>. However, your code is not checking the <code>err</code> variable that is returned by <code>Pipe()</code>. Since you're only checking variable <code>ways</code> which would be nil due to the error, your method returns <code>(nil, \"Ways not found within %0.2f km/radius (%f mil/radius)\")</code>; thus masking the pipeline error. </p>\n\n<p>I would suggest to check the content check <code>err</code> first: </p>\n\n<pre><code>err = w.Pipe(pipe).All(&amp;ways)\nif err != nil {\n  //handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 48557032, "answer_count": 1, "score": 0, "last_activity_date": 1517468471, "creation_date": 1517180926, "last_edit_date": 1517455460, "question_id": 48492358, "link": "https://stackoverflow.com/questions/48492358/mgo-with-aggregation-filtering-with-another-query-and-field-alteration", "title": "mgo with aggregation, filtering with another query and field alteration", "body": "<p>I'm working with OpenStreeMap data dump into a MongoDB instance, the following collections exists <code>nodes</code>, <code>ways</code> and <code>relations</code>.</p>\n\n<p>I'm querying all nodes within a radius from a given geospatial point, and to know how these nodes relate I'm working with the <code>ways</code> collection trying to retrieve all ways that contain any node from my previous geospatial query.</p>\n\n<p>Then, I'm trying to include the geospatial coordinates in the <code>way</code> document (it already have a <code>loc.coordinates</code> field which is empty for some reason) using the node IDs it contains in the field <code>loc.nodes</code>. Along with the help provided in <a href=\"https://stackoverflow.com/a/48484610/2020214\">this answer</a> I have come to the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    mgo \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\n// GeoJSON Holds data of geospatial points\ntype GeoJSON struct {\n    Type        string    `json:\"-\"`\n    Coordinates []float64 `json:\"coordinates\"`\n}\n\ntype waynodes struct {\n    Type        string\n    Coordinates []float64\n    Nodes       []int\n}\n\n// OSMNode Represet a single point in space.\n// https://wiki.openstreetmap.org/wiki/Node\n//\n// A node is one of the core elements in the OpenStreetMap data model. It\n// consists of a single point in space defined by its latitude, longitude and\n// node id.  A third, optional dimension (altitude) can also be included:\n// key:ele (abrev. for \"elevation\"). A node can also be defined as part of a\n// particular layer=* or level=*, where distinct features pass over or under\n// one another; say, at a bridge.  Nodes can be used to define standalone point\n// features, but are more often used to define the shape or \"path\" of a way.\ntype OSMNode struct {\n    ID       int                    `bson:\"_id\"`\n    Location GeoJSON                `bson:\"loc\"`\n    Tags     map[string]interface{} `bson:\"tags,omitempty\"`\n}\n\n// OSMWay Represent an ordered list of nodes\n// https://wiki.openstreetmap.org/wiki/Way\n//\n// A way is an ordered list of nodes which normally also has at least one tag\n// or is included within a Relation. A way can have between 2 and 2,000 nodes,\n// although it's possible that faulty ways with zero or a single node exist. A\n// way can be open or closed. A closed way is one whose last node on the way is\n// also the first on that way. A closed way may be interpreted either as a\n// closed polyline, or an area, or both.\n//\n// The nodes defining the geometry of the way are enumerated in the correct\n// order, and indicated only by reference using their unique identifier. These\n// nodes must have been already defined separately with their coordinates.\ntype OSMWay struct {\n    ID       int      `bson:\"_id\"`\n    Location waynodes `bson:\"loc\"`\n    Tags     map[string]interface{}\n}\n\n// km2miles convert a distance in kilometers to miles and then return the\n// radius of such distance.\nfunc km2miles(dist float64) float64 {\n    r := dist * 0.621371\n    // https://en.wikipedia.org/wiki/Earth_radius#Fixed_radius\n    return r / 3963.2\n}\n\n// nodes2list return a string list of node IDs from a list of OSMNode objects\nfunc nodes2list(l []OSMNode) []int {\n    var list []int\n    for _, v := range l {\n        list = append(list, v.ID)\n    }\n    return list\n}\n\n// GetGeoWithinPos Return all points in a given point of Earth within the\n// radius of `dist`.\nfunc (db *DB) GetGeoWithinPos(long, lat, dist float64) ([]OSMWay, error) {\n    // Look at `nodes` document in our `osm` database\n    c := db.m.DB(\"osm\").C(\"nodes\")\n    // Query all nodes within a range from a spatial point: It should be\n    // equivalent to:\n    //     db.nodes.find(\n    //         {loc:\n    //          {$geoWithin:\n    //           {$centerSphere: [[-83.4995983, 10.1033002], 0.186411 / 3963.2]\n    //           }\n    //          }\n    //         }, {\"_id\": 1});\n    var nodesresult []OSMNode\n    err := c.Find(bson.M{\n        \"loc\": bson.M{\n            \"$geoWithin\": bson.M{\n                \"$centerSphere\": []interface{}{\n                    []interface{}{long, lat}, km2miles(dist),\n                },\n            },\n        },\n    }).Select(bson.M{\"_id\": 1}).All(&amp;nodesresult)\n\n    if err != nil {\n        return nil, err\n    } else if nodesresult == nil {\n        return nil, fmt.Errorf(\"Nodes not found on %f lat, %f long in a radius of %f km\", lat, long, dist)\n    } else if nodesresult[0].ID == 0 {\n        return nil, fmt.Errorf(\"Nodes incorrectly unmarshall: %#v\", nodesresult[0:3])\n    }\n\n    // Prepare a pipeline\n    pipe := []bson.M{\n        {\n            // Match only ways that contains the ID of the nodes\n            // from the query on `qsn`\n            \"$match\": bson.M{\n                \"loc.nodes\": bson.M{\n                    \"$in\": nodes2list(nodesresult), // Return []int\n                },\n            },\n        },\n        {\n            // Now look for the nodes at `nodes` collection present\n            // at `loc.nodes` field...\n            \"$lookup\": bson.M{\n                \"from\":         \"nodes\",\n                \"localField\":   \"loc.nodes\",\n                \"foreignField\": \"_id\",\n                \"as\":           \"loc.coordinates\",\n            },\n        },\n        {\n            // ...and set the field `loc.coordinates` with the\n            // coordinates of all nodes.\n            \"$addField\": bson.M{\n                \"loc.coordinates\": bson.M{\n                    \"$reduce\": bson.M{\n                        \"input\":        \"$loc.coordinates.loc.coordinates\",\n                        \"initialValue\": []float64{},\n                        \"in\":           bson.M{\"$concatArrays\": []string{\"$$this\", \"$$value\"}},\n                    },\n                },\n            },\n        },\n    }\n    // Query ways collection\n    w := db.m.DB(\"osm\").C(\"ways\")\n    var ways []OSMWay\n    // Execute the pipeline \ud83e\udd1e\n    err = w.Pipe(pipe).All(&amp;ways)\n    if ways == nil {\n        return nil, fmt.Errorf(\"Ways not found within %0.2f km/radius (%f mil/radius)\", dist, km2miles(dist))\n    }\n    return ways, err\n}\n</code></pre>\n\n<p>But the pipeline at the end returns nothing.</p>\n\n<pre><code>$ go test\n--- FAIL: TestFetchData (1.80s)\n        db_test.go:16: from -83.4995983long, 10.1033002lat: Ways not found within 1.00 km/radius (0.000157 mil/radius)\n</code></pre>\n\n<p><strong>I would like to know what I'm doing wrong here and why mgo cannot do what I'm looking to do.</strong></p>\n\n<p>For sake of completeness here is the test definition:</p>\n\n<pre><code>func TestFetchData(t *testing.T) {\n    db, err := NewDBConn(\"\", \"\", \"localhost\", 27017)\n    if err != nil {\n        t.Fatalf(\"Could not establish connection with MongoDB: %s\", err)\n    }\n    // Get data from some location in my hometown\n    _, err := db.GetGeoWithinPos(-83.4995983, 10.1033002, 1.0)\n    if err != nil {\n        t.Fatalf(\"from -83.4995983long, 10.1033002lat: %s\", err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<h2>Example documents</h2>\n\n<p>This is an example document from the <code>ways</code> collection:</p>\n\n<pre><code>{\n   \"_id\":492464922,\n   \"tags\":{\n      \"maxspeed\":\"20\",\n      \"surface\":\"asphalt\",\n      \"highway\":\"residential\",\n      \"oneway\":\"yes\",\n      \"name\":\"Avenida 1\"\n   },\n   \"loc\":{\n      \"type\":\"Polygon\",\n      \"coordinates\":[\n\n      ],\n      \"nodes\":[\n         445848963,\n         4844871065,\n         432568566\n      ]\n   }\n}\n</code></pre>\n\n<p>This would be an example document from the <code>nodes</code> collection:</p>\n\n<pre><code>{\n   \"_id\":445848963,\n   \"loc\":{\n      \"type\":\"Point\",\n      \"coordinates\":[\n         -83.5047254,\n         10.0984515\n      ]\n   }\n}\n</code></pre>\n\n<p>And this would be the example output that I'm looking to return with query I'm trying to pass to the pipeline:</p>\n\n<pre><code>{\n   \"_id\":492464922,\n   \"tags\":{\n      \"maxspeed\":\"20\",\n      \"surface\":\"asphalt\",\n      \"highway\":\"residential\",\n      \"oneway\":\"yes\",\n      \"name\":\"Avenida 1\"\n   },\n   \"loc\":{\n      \"type\":\"Polygon\",\n      \"coordinates\":[\n         -83.5047254,\n         10.0984515,\n         -83.5052237,\n         10.0987132,\n         -83.5056339,\n         10.0989286\n      ],\n      \"nodes\":[\n         445848963,\n         4844871065,\n         432568566\n      ]\n   }\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "daemon", "varnish"], "comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1517178974, "post_id": 48491944, "comment_id": 83977321, "body": "You have <b>ExecStart=</b> written twice?"}, {"owner": {"reputation": 25, "user_id": 4396452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1567628221/picture?type=large", "display_name": "Jo&#227;o Bosco", "link": "https://stackoverflow.com/users/4396452/jo%c3%a3o-bosco"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1517179065, "post_id": 48491944, "comment_id": 83977344, "body": "yes,  I did it the way the varnish documentation shows"}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1517185796, "post_id": 48491944, "comment_id": 83978866, "body": "Stack Overflow is a site for programming and development questions. This question appears to be off-topic because it is not about programming or development. See <a href=\"http://stackoverflow.com/help/on-topic\">What topics can I ask about here</a> in the Help Center. Perhaps <a href=\"http://superuser.com/\">Super User</a> or <a href=\"http://unix.stackexchange.com/\">Unix &amp; Linux Stack Exchange</a> would be a better place to ask."}, {"owner": {"reputation": 25, "user_id": 4396452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1567628221/picture?type=large", "display_name": "Jo&#227;o Bosco", "link": "https://stackoverflow.com/users/4396452/jo%c3%a3o-bosco"}, "edited": false, "score": 0, "creation_date": 1517186394, "post_id": 48491944, "comment_id": 83978984, "body": "Ok, Thanks for your help"}, {"owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "edited": false, "score": 0, "creation_date": 1517195794, "post_id": 48491944, "comment_id": 83980947, "body": "I&#39;m not sure I understand how golang is involved with this problem... The stuff you&#39;ve posted is systemd configuration. Please clarify how Go is involved, or otherwise superuser.com might be a better place to ask this."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517198804, "post_id": 48491944, "comment_id": 83981547, "body": "See <a href=\"https://ma.ttias.be/running-varnish-4-x-on-systemd/\" rel=\"nofollow noreferrer\">https://ma.ttias.be/running-varnish-4-x-on-systemd/</a>"}], "owner": {"reputation": 25, "user_id": 4396452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1567628221/picture?type=large", "display_name": "Jo&#227;o Bosco", "link": "https://stackoverflow.com/users/4396452/jo%c3%a3o-bosco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 283, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517185753, "creation_date": 1517177835, "last_edit_date": 1517185753, "question_id": 48491944, "link": "https://stackoverflow.com/questions/48491944/managing-a-linux-daemon-with-golang", "title": "Managing a linux daemon with golang", "body": "<p>I need to manage the varnish service through an application in Golang, more specifically I need to have the application change the port, ip, storage method and etc.\nAt first I started by following the official varnish documentation (<a href=\"https://varnish-cache.org/docs/trunk/tutorial/putting_varnish_on_port_80.html\" rel=\"nofollow noreferrer\">https://varnish-cache.org/docs/trunk/tutorial/putting_varnish_on_port_80.html</a>), so I did with that the application created the following file in the path:\n/etc/systemd/system/varnish.service.d/customexec.conf</p>\n\n<blockquote>\n<pre><code>[Service] \nExecStart= \nExecStart=/usr/sbin/varnishd -a :6081 -T\nlocalhost:6082 -f /etc/varnish/default.vcl -S /etc/varnish/secret\n</code></pre>\n</blockquote>\n\n<p>There was no error, however, the service does not start\nIn the service status it displays the following message:</p>\n\n<pre><code>\u25cf varnish.service - Varnish HTTP accelerator    Loaded: loaded\n(/lib/systemd/system/varnish.service; enabled; vendor preset: enabled)\nDrop-In: /etc/systemd/system/varnish.service.d\n           \u2514\u2500customexec.conf    Active: inactive (dead) since Dom 2018-01-28 15:10:46 -03; 3h 56min ago\n     Docs: https://www.varnish-cache.org/docs/4.1/\n           man:varnishd   Process: 970 ExecStart=/usr/sbin/varnishd -a :6081 -T localhost:6082 -f /etc/varnish/default.vcl -S\n/etc/varnish/secret (code=exited, status=0/SUCCESS)  Main PID: 970\n(code=exited, status=0/SUCCESS)\n</code></pre>\n\n<p>Is there another way to manage a service across an application?</p>\n\n<p>Thank you all</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1517199829, "post_id": 48491676, "comment_id": 83981804, "body": "Does <a href=\"https://golang.org/cmd/cgo/#hdr-C_references_to_Go\" rel=\"nofollow noreferrer\">C reference to Go</a> help?"}, {"owner": {"reputation": 3540, "user_id": 131051, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1b41d7397afdd0a922953945f1111e55?s=128&d=identicon&r=PG", "display_name": "GSP", "link": "https://stackoverflow.com/users/131051/gsp"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517233955, "post_id": 48491676, "comment_id": 83999119, "body": "@Mark it does and that&#39;s the direction I&#39;ve been going. The problem is that the Go func must have the same method signature that the callback expects. (So no <code>const char *</code>). Last night I managed to work around that with a wrapper so the C func calls the exported Go func, but I still can&#39;t think how to get information &quot;out&quot; to the <code>DoCStuff</code> context (maybe channels?)"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517276253, "post_id": 48491676, "comment_id": 84020110, "body": "To get the information &quot;out&quot;, you could create a GoString in c, and pass that to your exported Go function, see <a href=\"https://stackoverflow.com/questions/44475923/making-a-go-string-in-c-with-cgo\">example</a>. You&#39;d need to be able to control the lifetime and access to the log pointer though. If not, you could allocate your own buffer, strcpy the log to it, then pass the buffer pointer to Go function. Remember to free the buffer afterwards. See <a href=\"https://stackoverflow.com/a/39708992/3915\">answer</a>."}], "owner": {"reputation": 3540, "user_id": 131051, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1b41d7397afdd0a922953945f1111e55?s=128&d=identicon&r=PG", "display_name": "GSP", "link": "https://stackoverflow.com/users/131051/gsp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1517175990, "creation_date": 1517175990, "question_id": 48491676, "link": "https://stackoverflow.com/questions/48491676/how-to-get-a-value-to-go-code-from-a-c-callback-function", "title": "How to get a value to Go code from a C callback function", "body": "<p>I'm trying to incorporate a C library into my Go application. The interface to the C library uses a callback to handle logging. It ends up looking something like this:</p>\n\n<pre><code>/*\n#include \"clibrary/header.h\"\n\nvoid log_callback(const char * log)\n{\n  /* I'd like to get this log value to use in my Go code */\n  fprintf(stderr, \"Log is: %s\\n\", log);\n}\n\n/* Using this wrapper method so the callback can be added to\n   the function call since it seems from my reading that \n   access to a C pointer to a function is difficult in CGO. \n*/    \nint do_c_stuff_wrapper(Context * context)\n{\n\n  return do_c_stuff(context, log_callback)\n}\n\n*/\nimport \"C\"\n\nimport \"fmt\"\n\nfunc DoCStuff() {\n\n  c_context := C.init_context()\n  ret := C.do_c_stuff_wrapper(c_context) \n  fmt.Printf(\"The return value is %v\\n\", ret)\n\n}\n</code></pre>\n\n<p>I'd like to get the log value from the callback \"back\" to the Go code so I can work with it and I'm drawing a blank on how to do that.</p>\n"}, {"tags": ["debugging", "go"], "answers": [{"tags": [], "owner": {"reputation": 8826, "user_id": 10245, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a2909c1103b9ceba6c8933c85dc4f803?s=128&d=identicon&r=PG", "display_name": "Tim Abell", "link": "https://stackoverflow.com/users/10245/tim-abell"}, "is_accepted": false, "score": 13, "last_activity_date": 1517174104, "creation_date": 1517174104, "answer_id": 48491393, "question_id": 48491392, "link": "https://stackoverflow.com/questions/48491392/how-do-you-ignore-the-string-method-when-printing-a-golang-struct/48491393#48491393", "title": "How do you ignore the String() method when printing a golang struct?", "body": "<p>Use the <code>%#v</code> format</p>\n\n<pre><code>fmt.Printf(\"%#v\", bar)\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>main.Foo{Jekyl:\"good\", Hyde:\"evil\"}\n</code></pre>\n\n<p>ref <a href=\"https://stackoverflow.com/a/26116578/10245\">https://stackoverflow.com/a/26116578/10245</a></p>\n\n<p><a href=\"https://play.golang.org/p/YWIf6zGU-En\" rel=\"noreferrer\">https://play.golang.org/p/YWIf6zGU-En</a></p>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1566286536, "last_edit_date": 1566286536, "creation_date": 1517207021, "answer_id": 48495480, "question_id": 48491392, "link": "https://stackoverflow.com/questions/48491392/how-do-you-ignore-the-string-method-when-printing-a-golang-struct/48495480#48495480", "title": "How do you ignore the String() method when printing a golang struct?", "body": "<p>Another way to print full key value pair for any object is like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Foo struct {\n    Jekyl string\n    Hyde  string\n}\n\nfunc main() {\n    bar := Foo{Jekyl: \"good\", Hyde: \"evil\"}\n    b, err := json.Marshal(bar)\n    if err != nil {\n        fmt.Println(\"error marshaling object\")\n        return\n    }\n    fmt.Println(\"bar data : \", string(b))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code> bar data :  {\"Jekyl\":\"good\",\"Hyde\":\"evil\"}\n</code></pre>\n\n<p>Go playground ref: <a href=\"https://play.golang.org/p/VJZNmpC_wNJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VJZNmpC_wNJ</a></p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1517223015, "creation_date": 1517223015, "answer_id": 48499445, "question_id": 48491392, "link": "https://stackoverflow.com/questions/48491392/how-do-you-ignore-the-string-method-when-printing-a-golang-struct/48499445#48499445", "title": "How do you ignore the String() method when printing a golang struct?", "body": "<p>While your answer is correct, it's a common practice to use another type to strip off all methods of a struct and use other ones (this is used usually in marshalling/unmarshalling).</p>\n\n<p>If a type is defined as <code>type stripped Foo</code> then the method <code>Foo.String()</code> will no longer be used.</p>\n\n<p>Code: <a href=\"https://play.golang.org/p/Ba2VvLAm92a\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ba2VvLAm92a</a></p>\n\n<p>Output: <code>{Jekyl:good Hyde:evil}</code></p>\n"}], "owner": {"reputation": 8826, "user_id": 10245, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a2909c1103b9ceba6c8933c85dc4f803?s=128&d=identicon&r=PG", "display_name": "Tim Abell", "link": "https://stackoverflow.com/users/10245/tim-abell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1356, "favorite_count": 1, "answer_count": 3, "score": 9, "last_activity_date": 1566286536, "creation_date": 1517174104, "question_id": 48491392, "link": "https://stackoverflow.com/questions/48491392/how-do-you-ignore-the-string-method-when-printing-a-golang-struct", "title": "How do you ignore the String() method when printing a golang struct?", "body": "<p>I have a golang struct, and have created a <code>String()</code> method for use in the program's normal operation. I now want to see the whole contents of the struct. I tried the usual <code>%+v</code> format but it seems to use the <code>String()</code> method instead of showing me all the fields. How can I output the raw structure data?</p>\n\n<p>Example: <a href=\"https://play.golang.org/p/SxTVOtwVV-9\" rel=\"noreferrer\">https://play.golang.org/p/SxTVOtwVV-9</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {\n    Jekyl string\n    Hyde  string\n}\n\nfunc (foo Foo) String() string {\n    return foo.Jekyl // how I want it to show in the rest of the program\n}\n\nfunc main() {\n    bar := Foo{Jekyl: \"good\", Hyde: \"evil\"}\n    fmt.Printf(\"%+v\", bar) // debugging to see what's going on, can't see the evil side\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<pre><code>good\n</code></pre>\n\n<p>But I want to see what you get without the String() method implemented</p>\n\n<pre><code>{Jekyl:good Hyde:evil}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517163610, "post_id": 48489703, "comment_id": 83972476, "body": "answers to this question will tend to be almost entirely based on opinions. This one doesn&#39;t depend on opinion. It depends on purpose. To one who vote to close"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517164164, "post_id": 48489703, "comment_id": 83972650, "body": "In your second approach, <code>pow.block</code> seems like an unexported field. Is it on purpose?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1517166680, "post_id": 48489703, "comment_id": 83973438, "body": "If a method is called run I would not expect return values (exept of an error)."}, {"owner": {"reputation": 43, "user_id": 9225674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c350e6253a553f8062980801ebd5e82?s=128&d=identicon&r=PG&f=1", "display_name": "Guobao", "link": "https://stackoverflow.com/users/9225674/guobao"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517177782, "post_id": 48489703, "comment_id": 83976993, "body": "@leafbebop In fact, the block is wrapped inside the pow as <b>pow.block</b> and then it will be completed after the <b>Run</b> of <b>ProofOfWork</b>. And then the block will be returned after the function <b>Run</b>."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9225674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c350e6253a553f8062980801ebd5e82?s=128&d=identicon&r=PG&f=1", "display_name": "Guobao", "link": "https://stackoverflow.com/users/9225674/guobao"}, "edited": false, "score": 0, "creation_date": 1517178077, "post_id": 48491182, "comment_id": 83977077, "body": "Thanks for the proposal. But I think the method <b>Run</b> is a behavior of <b>ProofOfWork</b>. Because it will not always return the same variables regarding to the different <b>ProofOfWork</b>."}], "tags": [], "owner": {"reputation": 1260, "user_id": 695459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8766f0303f842207f52c2789896a7214?s=128&d=identicon&r=PG", "display_name": "mikijov", "link": "https://stackoverflow.com/users/695459/mikijov"}, "is_accepted": false, "score": 0, "last_activity_date": 1517172817, "creation_date": 1517172817, "answer_id": 48491182, "question_id": 48489703, "link": "https://stackoverflow.com/questions/48489703/when-should-i-return-value-instead-of-modifying-receiver-pointer/48491182#48491182", "title": "when should I return value instead of modifying receiver pointer?", "body": "<p>Both options you show might be useful sometimes. May I propose another possibility. In Go we should use functions much more often then in other languages. A plain function might be exactly what you are looking for:</p>\n\n<pre><code>// Run performs a proof-of-work\nfunc Run(pow *ProofOfWork) (int, []byte) {\n    var hashInt big.Int\n    var hash [32]byte\n    nonce := 0\n\n    fmt.Printf(\"Mining the block containing \\\"%s\\\"\\n\", pow.block.Data)\n    for nonce &lt; maxNonce {\n        data := pow.prepareData(nonce)\n\n        hash = sha256.Sum256(data)\n        fmt.Printf(\"\\r%x\", hash)\n        hashInt.SetBytes(hash[:])\n\n        if hashInt.Cmp(pow.target) == -1 {\n            break\n        } else {\n            nonce++\n        }\n    }\n    fmt.Print(\"\\n\\n\")\n\n    return nonce, hash[:]\n}\n</code></pre>\n\n<p>I would probably make ProofOfWork an interface, and abstract Run that way.</p>\n"}], "owner": {"reputation": 43, "user_id": 9225674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c350e6253a553f8062980801ebd5e82?s=128&d=identicon&r=PG&f=1", "display_name": "Guobao", "link": "https://stackoverflow.com/users/9225674/guobao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1517172817, "creation_date": 1517162997, "last_edit_date": 1517163700, "question_id": 48489703, "link": "https://stackoverflow.com/questions/48489703/when-should-i-return-value-instead-of-modifying-receiver-pointer", "title": "when should I return value instead of modifying receiver pointer?", "body": "<p>I have a method for the struct <strong>ProofOfWork</strong> which should modify the struct members <strong>Nonce</strong> and <strong>Hash</strong>. So I wonder whether it should modify these two members of the given instance inside the method <strong>Run</strong> or should make these two variables as a return.</p>\n\n<p>So here is the method <strong>Run</strong> with return variables:</p>\n\n<pre><code>// Run performs a proof-of-work\nfunc (pow *ProofOfWork) Run() (int, []byte) {\n    var hashInt big.Int\n    var hash [32]byte\n    nonce := 0\n\n    fmt.Printf(\"Mining the block containing \\\"%s\\\"\\n\", pow.block.Data)\n    for nonce &lt; maxNonce {\n        data := pow.prepareData(nonce)\n\n        hash = sha256.Sum256(data)\n        fmt.Printf(\"\\r%x\", hash)\n        hashInt.SetBytes(hash[:])\n\n        if hashInt.Cmp(pow.target) == -1 {\n            break\n        } else {\n            nonce++\n        }\n    }\n    fmt.Print(\"\\n\\n\")\n\n    return nonce, hash[:]\n}\n</code></pre>\n\n<p>Then the version without any return variables:</p>\n\n<pre><code>func (pow *ProofOfWork) Run() {\n    var hashInt big.Int\n    var hash [32]byte // the type of hash value is defined by result of the sha256 function\n    nonce := 0\n\n    for nonce &lt; MaxNonce {\n        data := pow.prepareData(nonce)\n        hash := sha256.Sum256(data)\n        hashInt.SetBytes(hash[:])\n        if hashInt.Cmp(pow.target) == -1 {\n            // the nonce found\n            break\n        } else {\n            nonce++\n        }\n    }\n    pow.block.Hash = hash[:]\n    pow.block.Nonce = nonce\n}\n</code></pre>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1517154500, "post_id": 48487911, "comment_id": 83969197, "body": "<code>reflect.Value.MapIndex</code> does not return a value of type <code>interface{}</code> but of type <code>reflect.Value</code> therefore the type assertion won&#39;t compile. <code>reflect.Value</code> has a method called <code>Interface</code> that returns it&#39;s underlying value as <code>interface{}</code>, on it you can do type assertion. Or you can use <code>reflect.Value</code>&#39;s <code>Kind</code> method to figure out the underlying type of the interface and go from there."}, {"owner": {"reputation": 185, "user_id": 6621080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c3c53281187afde2fc9765d1a0ded6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Mokeev", "link": "https://stackoverflow.com/users/6621080/alex-mokeev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517155430, "post_id": 48487911, "comment_id": 83969523, "body": "@mkopriva Updated the question with the results"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517155716, "post_id": 48487911, "comment_id": 83969619, "body": "It would be helpful to show some sample yaml as well."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1517155768, "post_id": 48487911, "comment_id": 83969637, "body": "<a href=\"https://play.golang.org/p/tcig_e8o0bk\" rel=\"nofollow noreferrer\">play.golang.org/p/tcig_e8o0bk</a> FYI you cannot type assert <code>[]interface{}</code> to <code>[]T</code>, you need to loop over each of the <code>interface{}</code> items and assert them individually. Also note the example code is not guarding against possible panics due to invalid type assertions, you should use the &quot;comma ok&quot; idiom to avoid those."}, {"owner": {"reputation": 185, "user_id": 6621080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c3c53281187afde2fc9765d1a0ded6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Mokeev", "link": "https://stackoverflow.com/users/6621080/alex-mokeev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517155886, "post_id": 48487911, "comment_id": 83969676, "body": "@mkopriva in that case go says: <code>invalid type assertion: url.(string) (non-interface type int on left)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517155959, "post_id": 48487911, "comment_id": 83969702, "body": "it means <code>url</code> is not interface so you cannot do type assertion on that value as already mentioned in my first comment, it also tells you what the actual type is (int) so if you want to store that as a string somewhere you should use the <code>strconv</code> package to do that."}, {"owner": {"reputation": 185, "user_id": 6621080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c3c53281187afde2fc9765d1a0ded6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Mokeev", "link": "https://stackoverflow.com/users/6621080/alex-mokeev"}, "edited": false, "score": 0, "creation_date": 1517156063, "post_id": 48487911, "comment_id": 83969726, "body": "oh noo. Everything was so much easier. I was doing iteration wrong: range return two values: index and value itself. I was only catching first one and of course there was an error casting it to string"}], "answers": [{"tags": [], "owner": {"reputation": 185, "user_id": 6621080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c3c53281187afde2fc9765d1a0ded6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Mokeev", "link": "https://stackoverflow.com/users/6621080/alex-mokeev"}, "is_accepted": true, "score": 4, "last_activity_date": 1570352598, "last_edit_date": 1570352598, "creation_date": 1517156433, "answer_id": 48488490, "question_id": 48487911, "link": "https://stackoverflow.com/questions/48487911/interface-to-string/48488490#48488490", "title": "interface{} to []string", "body": "<p>Thanks to @mkopriva and the snippet from the sandbox. The reason of integer appearing during iterating over <code>v.MapIndex(host).Interface().([] interface{})</code> is that range returns two values: index and corresponding to that index value. I was only catching the first one. It is why I wasn't able to cast it to string.</p>\n\n<p>Working loop:</p>\n\n<pre><code>for _, url := range v.MapIndex(host).Interface().([] interface{}) {\n    fmt.Println(url.(string))\n    domain.Urls = append(domain.Urls,url.(string) )\n}\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 6621080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50c3c53281187afde2fc9765d1a0ded6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Mokeev", "link": "https://stackoverflow.com/users/6621080/alex-mokeev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4768, "favorite_count": 0, "accepted_answer_id": 48488490, "answer_count": 1, "score": 4, "last_activity_date": 1570352598, "creation_date": 1517152976, "last_edit_date": 1517221503, "question_id": 48487911, "link": "https://stackoverflow.com/questions/48487911/interface-to-string", "title": "interface{} to []string", "body": "<p>I'm trying to parse some YAML file into go struct, but the file itself can not be treated as ordinary go structure: some of values may be either string or map[string][]string.</p>\n\n<p>What I have tried is to do custom unmarshal func:</p>\n\n<pre><code>func (domain *Domain) UnmarshalYAML(unmarshal func(interface{}) error) error {\n    fmt.Println(\"Parsing domain\")\n\n    var hostUrl interface{}\n    unmarshal(&amp;hostUrl)\n    fmt.Println(reflect.TypeOf(hostUrl))\n\n    switch hostUrl.(type) {\n    case string:\n        domain.Host = hostUrl.(string)\n    case map[interface {}]interface {}:\n        fmt.Println(\"got map\")\n        v := reflect.ValueOf(hostUrl)\n        fmt.Println(v.MapKeys()[0])\n        for _, host := range v.MapKeys() {\n            domain.Host = host.Interface().(string)\n\n            fmt.Println(v.MapIndex(host)) \n            //HERE I NEED TO DO SMTH LIKE THIS:\n            //domain.Urls = v.MapIndex(host).([]string)\n\n        }\n    default:\n        return errors.New(\"invalid config file, cant parse domains\")\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>My domain structure looks like this:</p>\n\n<pre><code>type Domain struct {\n    Host        string\n    Urls        []string\n}\n</code></pre>\n\n<p>But this code causes an error:</p>\n\n<pre><code>invalid type assertion: v.MapIndex(host).([]string) (non-interface type reflect.Value on left) \n</code></pre>\n\n<p>So my question may sound like \"how to convert {}interface to []string?\" or it may become more complex: \"How to parse YAML file into go struct if some key can be either simple string or map[string][]string?\"</p>\n\n<p>UPDATE:\nResponding to @mkopriva:</p>\n\n<pre><code>fmt.Println(v.MapIndex(host))\nfor url := range v.MapIndex(host).Interface().([] interface{}) {\n        fmt.Println(url)\n}\n</code></pre>\n\n<p>Didnt help me, as now it just prints some integers (0), but there should be a string. Converting it to an array of strings throws another error:</p>\n\n<pre><code>panic: interface conversion: interface {} is []interface {}, not []string\n</code></pre>\n"}, {"tags": ["go", "copy", "slice"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1517149885, "creation_date": 1517149885, "answer_id": 48487434, "question_id": 48487062, "link": "https://stackoverflow.com/questions/48487062/how-to-understand-the-following-code-about-golang-slice/48487434#48487434", "title": "how to understand the following code about golang slice?", "body": "<p>In Go, slice is a pointer type to maintain information about underlying array, so change of the underlying array would cause changes of the slice value, which sometimes might be surprising.</p>\n\n<p>The second part of the puzzle is that <code>append</code> modifies the underlying array if the <code>cap</code> of the <code>slice</code> is sufficient. Document:</p>\n\n<blockquote>\n  <p>The append built-in function appends elements to the end of a slice.\n  If it has sufficient capacity, the destination is resliced to\n  accommodate the new elements. If it does not, a new underlying array\n  will be allocated. Append returns the updated slice. It is therefore\n  necessary to store the result of append, often in the variable holding\n  the slice itself.</p>\n</blockquote>\n\n<p>So in you failed attempt, <code>tempList = append(tempList, nums[i])</code> will possibly change value of previously stored slices in <code>result</code>.</p>\n\n<p>On the other hand, the second approach creates a new slice with new underlying array and copy to it explictly, so the error is avoided. The first approach is more subtle, as it use  a <strong>full slice expressions</strong>: <code>tempList[:len(tempList)-1:len(tempList)-1]</code>. The code limits the new slice's <code>cap</code> so <code>append</code> would have to allocate a new underlying array each time instead of using the orignal one.</p>\n\n<p>More about full slice expressions(spec):</p>\n\n<blockquote>\n  <p>For an array, pointer to array, or slice a (but not a string), the primary expression</p>\n</blockquote>\n\n<pre><code>a[low : high : max]\n</code></pre>\n\n<blockquote>\n  <p>constructs a slice of the same type, and with the same length and elements as the simple slice expression a[low : high]. Additionally, it controls the resulting slice's capacity by setting it to max - low. Only the first index may be omitted; it defaults to 0. After slicing the array a</p>\n</blockquote>\n\n<pre><code>a := [5]int{1, 2, 3, 4, 5}\nt := a[1:3:5]\n</code></pre>\n\n<blockquote>\n  <p>the slice t has type []int, length 2, capacity 4, and elements</p>\n</blockquote>\n\n<pre><code>t[0] == 2\nt[1] == 3\n</code></pre>\n"}], "owner": {"reputation": 726, "user_id": 2148710, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/SUfsw.jpg?s=128&g=1", "display_name": "jack-nie", "link": "https://stackoverflow.com/users/2148710/jack-nie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 48487434, "answer_count": 1, "score": 0, "last_activity_date": 1517149885, "creation_date": 1517147438, "question_id": 48487062, "link": "https://stackoverflow.com/questions/48487062/how-to-understand-the-following-code-about-golang-slice", "title": "how to understand the following code about golang slice?", "body": "<p>Recently I found some code that I can't understand, below is my code:</p>\n\n<pre><code>func subsetsWithDup(nums []int) [][]int {\n    if len(nums) == 0 {\n        return [][]int{[]int{}}\n    }\n    sort.Ints(nums)\n    result := [][]int{}\n    backtracking(nums, &amp;result, []int{}, 0)\n    return result\n}\n\nfunc backtracking(nums []int, result *[][]int, tempList []int, start int) {\n    *result = append(*result, tempList)\n    for i := start; i &lt; len(nums); i++ {\n        if i &gt; start &amp;&amp; nums[i] == nums[i-1] {\n            continue\n        }\n        tempList = append(tempList, nums[i])\n        backtracking(nums, result, tempList, i+1)\n        tempList = tempList[:len(tempList)-1:len(tempList)-1]\n    }\n}\n</code></pre>\n\n<p>and another approach:</p>\n\n<pre><code>func subsetsWithDup(nums []int) [][]int {\n    sort.Ints(nums)\n    return subsets(nums, []int{}, [][]int{})\n}\n\nfunc subsets(nums []int, result []int, results [][]int) [][]int {    \n    newR := make([]int, len(result))\n    copy(newR, result)\n    results = append(results, newR)\n\n    if len(nums) == 0 {return results}\n\n    for i := 0; i &lt; len(nums); i++ {\n        if i &gt; 0 &amp;&amp; nums[i] == nums[i - 1] {continue}\n        result = append(result, nums[i])\n        results = subsets(nums[i + 1:], result, results)\n        result = result[:len(result) - 1]\n    }\n\n    return results\n}\n</code></pre>\n\n<p>In the first approach, I use the following code :</p>\n\n<pre><code>tempList = tempList[:len(tempList)-1:len(tempList)-1]\n</code></pre>\n\n<p>it works, but if I change it to:</p>\n\n<pre><code>tempList = tempList[:len(tempList)-1]\n</code></pre>\n\n<p>it dose not work.In the second approach which use copy function also works. I want to know what happens behind the code, any help is appreciated, thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517142290, "post_id": 48486219, "comment_id": 83965297, "body": "What error did you capture?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517142702, "post_id": 48486219, "comment_id": 83965418, "body": "Can you try <code>select{ }</code> instead of infinite loop?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517142819, "post_id": 48486219, "comment_id": 83965457, "body": "I don&#39;t see any problem. Working fine for me. Somethings else is responsible. Can you run this code <a href=\"https://play.golang.org/p/IMCGpxoO0UH\" rel=\"nofollow noreferrer\">play.golang.org/p/IMCGpxoO0UH</a> ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517144201, "post_id": 48486219, "comment_id": 83965891, "body": "A busy loop is always a mistake. Eventually it\u2019s going to block the scheduler"}, {"owner": {"reputation": 11, "user_id": 9279340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1719e8f4ec5df816d5649d2c09a015c?s=128&d=identicon&r=PG&f=1", "display_name": "andocmdo", "link": "https://stackoverflow.com/users/9279340/andocmdo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517155103, "post_id": 48486219, "comment_id": 83969401, "body": "Thank you @JimB. It works now by removing the busy loop. Using select{} instead there is no error. I have started reading up on the Go scheduler more."}, {"owner": {"reputation": 11, "user_id": 9279340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1719e8f4ec5df816d5649d2c09a015c?s=128&d=identicon&r=PG&f=1", "display_name": "andocmdo", "link": "https://stackoverflow.com/users/9279340/andocmdo"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517155167, "post_id": 48486219, "comment_id": 83969421, "body": "@aerokite Yes, select{} works. I&#39;ve just learned it is wrong to call an empty busy loop in Go, so that was my issue. Appreciate the help."}], "owner": {"reputation": 11, "user_id": 9279340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1719e8f4ec5df816d5649d2c09a015c?s=128&d=identicon&r=PG&f=1", "display_name": "andocmdo", "link": "https://stackoverflow.com/users/9279340/andocmdo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "closed_date": 1517144494, "answer_count": 0, "score": 0, "last_activity_date": 1517148961, "creation_date": 1517141578, "question_id": 48486219, "link": "https://stackoverflow.com/questions/48486219/executing-multiple-commands-while-in-a-goroutine-fails-after-some-number-of-iter", "closed_reason": "Duplicate", "title": "Executing multiple commands while in a Goroutine fails after some number of iterations?", "body": "<p>I have some long running goroutines that exec shell commands. This fails after an arbitrary number of commands have been run (288 times on my Linux box for this example, and 400 for my Mac). If I run the exact same code outside a goroutine, it continues as expected without stopping or errors. I've tried debugging by setting breakpoints, but to no avail. Any help would be greatly appreciated.</p>\n\n<p>Does not work:</p>\n\n<pre><code>func main() {\n    go doAlot()\n    for {\n    }\n}\n\nfunc doAlot() {\n    i := 0\n    for {\n        time.Sleep(time.Millisecond * 100)\n        cmd := exec.Command(\"echo\", \"hello\")\n        var stdout, stderr bytes.Buffer\n        cmd.Stdout = &amp;stdout\n        cmd.Stderr = &amp;stderr\n        err := cmd.Run()\n        if err != nil {\n            log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n        }\n        outStr, errStr := string(stdout.Bytes()), string(stderr.Bytes())\n        fmt.Printf(\"%d \\nout: %serr: %s\\n\", i, outStr, errStr)\n        i++\n    }\n}\n</code></pre>\n\n<p>Works:</p>\n\n<pre><code>func main() {\n    i := 0\n    for {\n        time.Sleep(time.Millisecond * 100)\n        cmd := exec.Command(\"echo\", \"hello\")\n        var stdout, stderr bytes.Buffer\n        cmd.Stdout = &amp;stdout\n        cmd.Stderr = &amp;stderr\n        err := cmd.Run()\n        if err != nil {\n            log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n        }\n        outStr, errStr := string(stdout.Bytes()), string(stderr.Bytes())\n        fmt.Printf(\"%d\\nout: %serr: %s\\n\", i, outStr, errStr)\n        i++\n    }\n}\n</code></pre>\n\n<p>My only (uneducated/wild) guess, is that it relates to garbage collection and buffers, but somehow connected specifically to running inside a goroutine.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517140775, "post_id": 48486059, "comment_id": 83964815, "body": "I&#39;m not sure what you&#39;re asking. Are you trying to install a program you&#39;ve written? Or are you trying to install a library dependency that your program needs?"}, {"owner": {"reputation": 1982, "user_id": 1041282, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d3f79892438a80372f016d63c8fac39f?s=128&d=identicon&r=PG", "display_name": "uzilan", "link": "https://stackoverflow.com/users/1041282/uzilan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517140918, "post_id": 48486059, "comment_id": 83964859, "body": "A library I&#39;m writing"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517140972, "post_id": 48486059, "comment_id": 83964871, "body": "That doesn&#39;t really provide any clarity. You don&#39;t typically &quot;install libraries&quot; in Go, as Go is statically linked."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1517141055, "post_id": 48486059, "comment_id": 83964896, "body": "Run <code>go get .&#47;...</code> before running the build command."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1517141102, "post_id": 48486059, "comment_id": 83964912, "body": "@AlexEfimov: <code>go install</code> is not normally used or needed for libraries."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1517141203, "post_id": 48486059, "comment_id": 83964945, "body": "I meant <code>get</code>, sorry about that."}, {"owner": {"reputation": 1982, "user_id": 1041282, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d3f79892438a80372f016d63c8fac39f?s=128&d=identicon&r=PG", "display_name": "uzilan", "link": "https://stackoverflow.com/users/1041282/uzilan"}, "edited": false, "score": 0, "creation_date": 1517141299, "post_id": 48486059, "comment_id": 83964971, "body": "Ok thanks. I&#39;m just following the tutorial and since they used it there I thought one would install libraries frequently. Thanks for clearing that up!"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1517141454, "post_id": 48486059, "comment_id": 83965003, "body": "I don&#39;t understand, are you asking about the Go programming language? Or GoLand, the IDE from JetBrains dedicated for Go <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">jetbrains.com/go</a> ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517141470, "post_id": 48486059, "comment_id": 83965009, "body": "That depends on what you mean by &quot;install libraries&quot;.  If you mean, fetch third-party library dependencies, yes, that&#39;s common.  <code>go get</code> does that. Goland may provide some interface for the same, I have no idea.  If you mean something with <code>go install</code>, no--that is used for installing the output of a program you&#39;ve written. Dynamically linked languages have an equivalent for libraries--installing the shared library object files, DLLs, etc. Go has no such step, typically."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517141531, "post_id": 48486059, "comment_id": 83965033, "body": "It&#39;s starting to sound like you&#39;ve written a library, and now want to use it in other projects. If that is the case, there is nothing special going on here. You just install that dependency the same way you install any other dependency. And if Goland has a shortcut for installing deps, it should work in this case, too."}, {"owner": {"reputation": 1982, "user_id": 1041282, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d3f79892438a80372f016d63c8fac39f?s=128&d=identicon&r=PG", "display_name": "uzilan", "link": "https://stackoverflow.com/users/1041282/uzilan"}, "edited": false, "score": 0, "creation_date": 1517141950, "post_id": 48486059, "comment_id": 83965178, "body": "Ok, sorry if I wasn&#39;t clear. Yes, I&#39;m writing my own library and am using the install command to make it available to other programs. Now, since I thought this would be a common thing to do, I expected that Jetbrains own Go IDE Goland to have a simple way to allow me to do that, rather that using the command line. Thats why I was asking if Goland has a simple way to install libraries, by which I ment my own. Hope this is clear enough?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1517144695, "post_id": 48486059, "comment_id": 83966053, "body": "Yes, it&#39;s clear enough now. I&#39;ve added a complete response that covers both third-party libraries as well as libraries present on your system."}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 9, "last_activity_date": 1517143940, "last_edit_date": 1517143940, "creation_date": 1517143579, "answer_id": 48486502, "question_id": 48486059, "link": "https://stackoverflow.com/questions/48486059/shortcut-to-install-libraries-in-goland/48486502#48486502", "title": "Shortcut to install libraries in Goland", "body": "<p>There are two ways to import Go packages using GoLand:</p>\n\n<ol>\n<li>copy-paste the code that needs the package into the IDE and then on the import declaration use Show Intention to see the list of actions available and choose the first one, <code>go get -t &lt;package-name&gt;/...</code></li>\n<li>copy the URL of the Github repository into your clipboard, switch to the IDE and use the pop-up to run <code>go get</code> on the package. The pop-up disappears after a few seconds.</li>\n</ol>\n\n<p>I've attached the image which shows these options. <a href=\"https://i.stack.imgur.com/CE95J.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/CE95J.png\" alt=\"import packages in GoLand\"></a></p>\n\n<p>This will download libraries in the correct GOPATH directory and run <code>go install</code> as part of the <code>go get</code> action.</p>\n\n<p>As for installing the libraries that you are developing in GOPATH/pkg, there is no need for that, as soon as you run any configuration from the IDE, be it an application or a test that depend on those libraries, the IDE will install those libraries as well.</p>\n"}], "owner": {"reputation": 1982, "user_id": 1041282, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d3f79892438a80372f016d63c8fac39f?s=128&d=identicon&r=PG", "display_name": "uzilan", "link": "https://stackoverflow.com/users/1041282/uzilan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4235, "favorite_count": 0, "accepted_answer_id": 48486502, "answer_count": 1, "score": 4, "last_activity_date": 1517143940, "creation_date": 1517140414, "question_id": 48486059, "link": "https://stackoverflow.com/questions/48486059/shortcut-to-install-libraries-in-goland", "title": "Shortcut to install libraries in Goland", "body": "<p>I'm following the instructions in <a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Library</a> and trying to use Goland. I'm surprised though that I can't find a fast way to install the library I'm writing. According to the tutorial, you should use <code>install</code> to install your code in the pkg or bin folders, yet I can't find a way to do this in Goland other than writing it in the console. \nWhat am I missing?  </p>\n"}, {"tags": ["json", "mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1517140389, "post_id": 48485973, "comment_id": 83964690, "body": "Can you confirm you have data in details field?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517141035, "post_id": 48485973, "comment_id": 83964888, "body": "Also ask question with actual code segment what you have used in your program. <code>fmt.Println(&quot;Name:&quot;, result.name)</code> This should not print name."}, {"owner": {"reputation": 464, "user_id": 2159370, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/719a95c0aa48840deaf75741324a3289?s=128&d=identicon&r=PG", "display_name": "developernaren", "link": "https://stackoverflow.com/users/2159370/developernaren"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517147309, "post_id": 48485973, "comment_id": 83966881, "body": "@aerokite yes I can confirm details has value and result.Name does print name"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1517155630, "post_id": 48485973, "comment_id": 83969593, "body": "What is the result if you change the type of <code>Details</code> from <code>string</code> to <code>interface{}</code>? Or, try change it to <code>bson.M</code>?"}, {"owner": {"reputation": 464, "user_id": 2159370, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/719a95c0aa48840deaf75741324a3289?s=128&d=identicon&r=PG", "display_name": "developernaren", "link": "https://stackoverflow.com/users/2159370/developernaren"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1517156238, "post_id": 48485973, "comment_id": 83969780, "body": "@putu and it seems to be working. I get data with either and gives something like  map[hobbies:running]. I need to turn this to JSON. Thanks for the help. I am new to go, and seems hard."}, {"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1517157566, "post_id": 48485973, "comment_id": 83970166, "body": "It seems like your <code>Details</code> is not a <code>string</code> instead a json object, which you will have to map to a appropriate <code>struct</code>. Can you show sample data for <code>Details</code> field from mongo?"}, {"owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "edited": false, "score": 0, "creation_date": 1517218290, "post_id": 48485973, "comment_id": 83989213, "body": "@developernaren  i guess  the data Details is storing is not type of string . Could you share the sample data for Details .So that will get the clear picture"}], "answers": [{"tags": [], "owner": {"reputation": 464, "user_id": 2159370, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/719a95c0aa48840deaf75741324a3289?s=128&d=identicon&r=PG", "display_name": "developernaren", "link": "https://stackoverflow.com/users/2159370/developernaren"}, "is_accepted": true, "score": 4, "last_activity_date": 1517158704, "creation_date": 1517158704, "answer_id": 48488906, "question_id": 48485973, "link": "https://stackoverflow.com/questions/48485973/fetch-plain-json-from-mongo-in-go/48488906#48488906", "title": "Fetch plain json from mongo in go", "body": "<p>I am very new to go. This seems very basic now. The value of key <code>details</code> was <code>JSON</code></p>\n\n<p>The fix was that I changed the type of details to <code>bson.M</code></p>\n\n<p>from</p>\n\n<pre><code>type Person struct {\n    Name string\n    Id string\n    Details string\n}\n</code></pre>\n\n<p>to</p>\n\n<pre><code>type Person struct {\n    Name string\n    Id string\n    Details bson.M\n}\n</code></pre>\n\n<p>now I can access the details like</p>\n\n<pre><code>res, err := json.Marshal(result.Details)\n\nfmt.Println(string(res))\n</code></pre>\n\n<p>Thanks @putu for pointing me to the right direction.</p>\n"}], "owner": {"reputation": 464, "user_id": 2159370, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/719a95c0aa48840deaf75741324a3289?s=128&d=identicon&r=PG", "display_name": "developernaren", "link": "https://stackoverflow.com/users/2159370/developernaren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1624, "favorite_count": 0, "accepted_answer_id": 48488906, "answer_count": 1, "score": 1, "last_activity_date": 1517158704, "creation_date": 1517139919, "last_edit_date": 1517156394, "question_id": 48485973, "link": "https://stackoverflow.com/questions/48485973/fetch-plain-json-from-mongo-in-go", "title": "Fetch plain json from mongo in go", "body": "<p>I am trying to fetch some data from <code>mongo</code> in <code>go</code> and using <code>gopkg.in/mgo.v2</code>. I have a nested data in mongo.</p>\n\n<p><em>Note: This is an old database I cannot change structure for and just want to query the data.</em></p>\n\n<p>I have a database with fields <code>id</code>, <code>name</code> and <code>details</code>. and I have to get details based on <code>id</code>\nMy code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype Person struct {\n    Name string\n    Id string\n    Details string\n}\n\n\nfunc main() {\n\n    session, err := mgo.Dial(\"mongodb://localhost:27017/naren\")\n\n    c := session.DB(\"naren\").C(\"people\")\n\n    result := Person{}\n    err = c.Find(bson.M{\"id\": \"12345\"}).One(&amp;result)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Details:\", result.Details)\n    fmt.Println(\"Name:\", result.Name)\n    fmt.Println(\"Id:\", result.Id)\n}\n</code></pre>\n\n<p><code>Id</code> and <code>Name</code> are printing fine but <code>result.Details</code> prints an empty string even when there is data. I just want to print json as string or am happy with a json data.</p>\n\n<p>I have also tried</p>\n\n<pre><code>...\ntype Person struct { \n    ...\n    Details string `json:\"details\"`\n}\n</code></pre>\n\n<p>But still get empty string. \nThanks in advance.</p>\n"}, {"tags": ["go", "aws-sdk", "amazon-sqs", "aws-sdk-go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517129355, "post_id": 48484633, "comment_id": 83961889, "body": "We really can&#39;t tell what the problem is. Please show some code. But in general, it&#39;ll be something like <code>func(s *sqs.SQS)</code> (you&#39;re missing the package)"}, {"owner": {"reputation": 412, "user_id": 2828388, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001000415798/picture?type=large", "display_name": "lostintranslation", "link": "https://stackoverflow.com/users/2828388/lostintranslation"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517129601, "post_id": 48484633, "comment_id": 83961948, "body": "Yes. I missed the package. It should be func(s *sqs.SQS). Thanks for the quick response. A newbie in go here."}], "owner": {"reputation": 412, "user_id": 2828388, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001000415798/picture?type=large", "display_name": "lostintranslation", "link": "https://stackoverflow.com/users/2828388/lostintranslation"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517129797, "creation_date": 1517129260, "last_edit_date": 1517129797, "question_id": 48484633, "link": "https://stackoverflow.com/questions/48484633/how-to-pass-sqs-new-to-a-function-in-go", "title": "How to pass SQS.new() to a function in Go?", "body": "<p>I have created a new sqs client using Go SDK for SQS </p>\n\n<pre><code>    svc := sqs.New(sess)\n</code></pre>\n\n<p>Now what will be the signature of the function which accepts this svc as a parameter ?</p>\n\n<p>I tried <code>func(svc *SQS)</code> and <code>func(svc SQS)</code> , but its not working.</p>\n\n<p>In the documentation its mentioned that <code>SQS.new(session)</code> returns a <code>*SQS</code> type.\nWhat should be the type of svc then ?</p>\n"}, {"tags": ["pointers", "go", "nested", "panic"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517127028, "post_id": 48483913, "comment_id": 83961440, "body": "Are these pointers&#39; underlying type very distinct? Do you really need 10 different types?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517131371, "post_id": 48483913, "comment_id": 83962324, "body": "Yes. They are different with different purpose. And i need all of them. No other way"}], "answers": [{"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 0, "last_activity_date": 1517123198, "creation_date": 1517123198, "answer_id": 48484018, "question_id": 48483913, "link": "https://stackoverflow.com/questions/48483913/how-to-check-value-in-nested-pointer/48484018#48484018", "title": "How to check value in nested pointer", "body": "<p>I can use panic recovery method. This will solve my problem. But this seems hacky to me.</p>\n\n<pre><code>func printValue(o *outter) (string, bool) {\n    defer func() (string, bool) {\n        if r := recover(); r != nil {\n            return \"\", false\n        }\n        return \"\", false\n    }()\n    return o.value.value.value, true\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517124379, "post_id": 48484044, "comment_id": 83960954, "body": "@aerokite Check the addition about the example methods. Each method requires a single <code>nil</code> check regardless of the complexity of the data structure."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517125641, "post_id": 48484044, "comment_id": 83961171, "body": "Seems like there is no easy way. Need redundant code for this checking purpose."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517125793, "post_id": 48484044, "comment_id": 83961209, "body": "@aerokite You have to check for <code>nil</code> for each pointer at least <i>once</i>, <i>somewhere</i>. <i>That</i> you cannot omit. All you have to decide is where to put this check. My examples contain <code>nil</code> pointer checks for each pointer only once. So there is no redundancy in that."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517126067, "post_id": 48484044, "comment_id": 83961283, "body": "I did the same thing in my question, right? Logically"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517126348, "post_id": 48484044, "comment_id": 83961327, "body": "Thank you @icza for your valuable time. Its helps"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1517126984, "last_edit_date": 1517126984, "creation_date": 1517123521, "answer_id": 48484044, "question_id": 48483913, "link": "https://stackoverflow.com/questions/48483913/how-to-check-value-in-nested-pointer/48484044#48484044", "title": "How to check value in nested pointer", "body": "<p>Panic and recover is for exceptional cases. Checking if a pointer is <code>nil</code> is usually not, so you should stay away from it. Checking if a pointer is <code>nil</code> using an <code>if</code> statement is much cleaner than to introduce a deferred function with <code>recover()</code>. Especially as this <code>recover()</code> will stop all other kinds of panic, even those that would result from other reasons than trying to dereference a <code>nil</code> pointer. (Using <code>defer</code> and <code>recover()</code> is also slower than a simple <code>nil</code> check using <code>if</code>.)</p>\n\n<p>If the data is always required to be a non-<code>nil</code> value, you should consider not using a pointer for it. And if the data is always required to be non-<code>nil</code> but for some reason you are required to use a pointer, then this may be a valid case to let your code panic if any of the pointers are still <code>nil</code>.</p>\n\n<p>If it may be <code>nil</code>, then you have to check the <code>nil</code> case and handle it appropriately. You have to be explicit about this, Go doesn't help you omit this check.</p>\n\n<p>To avoid having to check <code>nil</code> in every place, a utility function or method is reasonable. Note that methods can be called even if the receiver is <code>nil</code> which may be useful in such cases.</p>\n\n<p>For example you may attach the following methods:</p>\n\n<pre><code>func (i *inner1) Get() (string, bool) {\n    if i == nil {\n        return \"\", false\n    }\n    return i.value, true\n}\n\nfunc (i *inner2) Get() (string, bool) {\n    if i == nil {\n        return \"\", false\n    }\n    return i.value.Get()\n}\n\nfunc (o *outter) Get() (string, bool) {\n    if o == nil {\n        return \"\", false\n    }\n    return o.value.Get()\n}\n</code></pre>\n\n<p>Note that each <code>Get()</code> method requires to check a single pointer, doesn't matter how complex the data structure is.</p>\n\n<p>Testing it:</p>\n\n<pre><code>o := &amp;outter{\n    value: &amp;inner2{\n        value: &amp;inner1{\n            value: \"I need this data\",\n        },\n    },\n}\nfmt.Println(o.Get())\n\no.value.value = nil\nfmt.Println(o.Get())\n\no.value = nil\nfmt.Println(o.Get())\n\no = nil\nfmt.Println(o.Get())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/WBPluYw0eZY\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>I need this data true\n false\n false\n false\n</code></pre>\n\n<p>The above solution <em>hides</em> the internals of <code>outter</code> which is useful for those using <code>outter</code> (doesn't need updating the clients if internals of <code>outter</code> change, just the <code>outter.Get()</code> method).</p>\n\n<p>A similar approach would be to add methods that only return the field of the receiver struct:</p>\n\n<pre><code>func (i *inner1) Value() (string, bool) {\n    if i == nil {\n        return \"\", false\n    }\n    return i.value, true\n}\n\nfunc (i *inner2) Inner1() *inner1 {\n    if i == nil {\n        return nil\n    }\n    return i.value\n}\n\nfunc (o *outter) Inner2() *inner2 {\n    if o == nil {\n        return nil\n    }\n    return o.value\n}\n</code></pre>\n\n<p>This approach requires clients to know internals of <code>outter</code>, but similarly it does not require any <code>nil</code> checks when using it:</p>\n\n<pre><code>o := &amp;outter{\n    value: &amp;inner2{\n        value: &amp;inner1{\n            value: \"I need this data\",\n        },\n    },\n}\nfmt.Println(o.Inner2().Inner1().Value())\n\no.value.value = nil\nfmt.Println(o.Inner2().Inner1().Value())\n\no.value = nil\nfmt.Println(o.Inner2().Inner1().Value())\n\no = nil\nfmt.Println(o.Inner2().Inner1().Value())\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/zRwKt_8wFOp\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1517124075, "post_id": 48484089, "comment_id": 83960891, "body": "You are right. But if nested length is 10, I need lots of checking. I was looking for alternative."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 0, "last_activity_date": 1517123961, "creation_date": 1517123961, "answer_id": 48484089, "question_id": 48483913, "link": "https://stackoverflow.com/questions/48483913/how-to-check-value-in-nested-pointer/48484089#48484089", "title": "How to check value in nested pointer", "body": "<p>There is no easy way. You may go recover way but it's not idiomatic IMO and you should check that you don't catch other unrelated errors.</p>\n\n<p>I prefer a single <code>if</code> instead of multiple. I don't think of the code below ugly or verbose.</p>\n\n<pre><code>func printValue(o *outter) (string, bool) {\n    if o.value != nil and o.value.value != nil and o.value.value.value != nil {\n        return *o.value.value.value, true\n    }\n    return \"\", false\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 528, "user_id": 7141579, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8odB_WZ-v9A/AAAAAAAAAAI/AAAAAAACU5A/QsIqouaGdgM/photo.jpg?sz=128", "display_name": "Jose Boretto Blengino", "link": "https://stackoverflow.com/users/7141579/jose-boretto-blengino"}, "is_accepted": false, "score": 0, "last_activity_date": 1602174877, "last_edit_date": 1602174877, "creation_date": 1602119074, "answer_id": 64254378, "question_id": 48483913, "link": "https://stackoverflow.com/questions/48483913/how-to-check-value-in-nested-pointer/64254378#64254378", "title": "How to check value in nested pointer", "body": "<p>Using reflection</p>\n<pre><code>func getFieldByName(v interface{}, fields string, sep string) interface{} {\n    r := reflect.ValueOf(v)\n    s := strings.Split(fields, sep)\n    for _, field := range s {\n        r = reflect.Indirect(r)\n        if r.IsValid() {\n            r = reflect.Indirect(r).FieldByName(field)\n        } else {\n            return nil\n        }\n    }\n    if r.IsValid() {\n        return r.Interface()\n    }\n    return nil\n}\n</code></pre>\n<p>Using Panic Recovery</p>\n<pre><code>type safeGetFn func() interface{}\n\nfunc safeGet(f safeGetFn, d interface{}) (ret interface{}) {\n    defer func() interface{} {\n        if r := recover(); r != nil {\n            ret = d\n        }\n        return ret\n    }()\n    return f()\n}\n</code></pre>\n<p>Example Reflection: <a href=\"https://play.golang.org/p/m0_zQqJm7MY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/m0_zQqJm7MY</a></p>\n<p>Example Panic Recovery: <a href=\"https://play.golang.org/p/PNPPBXCvHxJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PNPPBXCvHxJ</a></p>\n"}], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1451, "favorite_count": 1, "accepted_answer_id": 48484044, "answer_count": 4, "score": 4, "last_activity_date": 1602174877, "creation_date": 1517122245, "last_edit_date": 1517123254, "question_id": 48483913, "link": "https://stackoverflow.com/questions/48483913/how-to-check-value-in-nested-pointer", "title": "How to check value in nested pointer", "body": "<p>How can I check nested pointer easily?</p>\n\n<pre><code>type inner1 struct {\n    value string\n}\n\ntype inner2 struct {\n    value *inner1\n}\n\ntype outter struct {\n    value *inner2\n}\n</code></pre>\n\n<p>I have data like this:</p>\n\n<pre><code>o := &amp;outter{\n    value: &amp;inner2{\n        value: &amp;inner1{\n            value: \"I need this data\",\n        },\n    },\n} \n</code></pre>\n\n<p>If I want to get data from this, I need to check for nil pointer. </p>\n\n<pre><code>func printValue(o *outter) (string, bool) {\n    if o.value != nil {\n        v1 := o.value\n        if v1.value != nil {\n            v2 := v1.value\n            return v2.value, true\n        }\n    }\n    return \"\", false\n}\n</code></pre>\n\n<p>Yea, I can do this. But in my real scenario, this nested pointer part is much longer. I will prefer another way.</p>\n\n<p>I have checked this answer, <a href=\"https://stackoverflow.com/q/28215031/1924666\">Test for nil values in golang nested stucts</a>. But I need alternative. </p>\n\n<p>How can I accomplish this. Any efficient and better option?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3530281, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vYomO.jpg?s=128&g=1", "display_name": "twkonefal", "link": "https://stackoverflow.com/users/3530281/twkonefal"}, "edited": false, "score": 0, "creation_date": 1517295690, "post_id": 48483545, "comment_id": 84025515, "body": "Thank you for the answer, Andrew. This is working really nicely."}], "tags": [], "owner": {"reputation": 319196, "user_id": 34211, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/gfFlI.jpg?s=128&g=1", "display_name": "Andrew Hare", "link": "https://stackoverflow.com/users/34211/andrew-hare"}, "is_accepted": true, "score": 3, "last_activity_date": 1517120203, "last_edit_date": 1517120203, "creation_date": 1517118243, "answer_id": 48483545, "question_id": 48483528, "link": "https://stackoverflow.com/questions/48483528/go-http-listener-with-data-update-every-seconds/48483545#48483545", "title": "Go http listener with data update every seconds", "body": "<p>There are a few things you need to do:</p>\n\n<ol>\n<li>Create a background service that polls for the data. This service can run as a goroutine that periodically checks for new data.</li>\n<li>Create a channel that the background service uses to send new data to a centralized place to store the values. The background service should write data to this channel whenever it finds something new. Another option would be to protect the centralized data store with a mutex. Depending on the way the data is written and read, one option will be a better choice.</li>\n<li>Create a HTTP handler that returns the current contents of the centralized data store.</li>\n</ol>\n\n<p>Here is a simplified example showing how to use a goroutine and a <code>sync.RWMutext</code> to accomplish what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nvar (\n    timeSumsMu sync.RWMutex\n    timeSums   int64\n)\n\nfunc main() {\n    // Start the goroutine that will sum the current time\n    // once per second.\n    go runDataLoop()\n    // Create a handler that will read-lock the mutext and\n    // write the summed time to the client\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        timeSumsMu.RLock()\n        defer timeSumsMu.RUnlock()\n        fmt.Fprint(w, timeSums)\n    })\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc runDataLoop() {\n    for {\n        // Within an infinite loop, lock the mutex and\n        // increment our value, then sleep for 1 second until\n        // the next time we need to get a value.\n        timeSumsMu.Lock()\n        timeSums += time.Now().Unix()\n        timeSumsMu.Unlock()\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3530281, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vYomO.jpg?s=128&g=1", "display_name": "twkonefal", "link": "https://stackoverflow.com/users/3530281/twkonefal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 1, "accepted_answer_id": 48483545, "answer_count": 1, "score": 1, "last_activity_date": 1517156427, "creation_date": 1517118024, "last_edit_date": 1517156427, "question_id": 48483528, "link": "https://stackoverflow.com/questions/48483528/go-http-listener-with-data-update-every-seconds", "title": "Go http listener with data update every seconds", "body": "<p>I'm trying to build a little website in Go containing a report based on data collected from a web service. It uses an API to query the service for data. The service can only be queried once every few seconds.</p>\n\n<p>However, I have to query it a number of times to get the complete report data. Right now I just hammer the API to update my whole data structure each time the http handler (http.HandleFunc) is called. Of course, this is bad because it triggers lots of queries to the external API that are throttled. So, my report comes up very, very, very, slowly.</p>\n\n<p>What I want to do instead is to have a function to updateReportData in a non-blocking way and store that data in some variable that the http.HandleFunc() can just ingest without calling the external API.</p>\n\n<p>But, I'm very new to Go (and things like closures, semaphores, concurrency, etc) and so I'm not really sure how to build this. Should I be using channels? Should I use timers? How can I get the updateReportData to not block the http.HandleFunc, but still run on a fixed interval?</p>\n\n<p>To sum up, I want to have a background routine update a data structure on a fixed interval and I want to be able to use http.HandleFunc to serve whatever data is in the data structure any time i make an http request to the program. I just have no idea how to start. Any advice would be appreciated.</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 31023, "user_id": 306719, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8b5f2224482b0bc3648353d36a0c8814?s=128&d=identicon&r=PG", "display_name": "hguser", "link": "https://stackoverflow.com/users/306719/hguser"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517115221, "post_id": 48482930, "comment_id": 83959452, "body": "Sorry, I didn&#39;t find that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517140413, "post_id": 48482930, "comment_id": 83964703, "body": "Don&#39;t ignore errors."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517140726, "post_id": 48482930, "comment_id": 83964793, "body": "I think research doesn&#39;t help always. Sometimes you can&#39;t find answer if you don&#39;t know correct question. I also think who has <code>10.6k</code> reputation, didn&#39;t come here for upvote."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 4, "last_activity_date": 1517112754, "creation_date": 1517112754, "answer_id": 48483083, "question_id": 48482930, "link": "https://stackoverflow.com/questions/48482930/pointer-in-golang/48483083#48483083", "title": "Pointer in golang", "body": "<p>Two things are happening:</p>\n\n<ol>\n<li>You didn't read the documentation.</li>\n<li>You didn't check <code>json.Unmarshal</code>'s return value to check for errors.</li>\n</ol>\n\n<p>From the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">fine manual</a>:</p>\n\n<blockquote>\n<pre><code>func Unmarshal(data []byte, v interface{}) error\n</code></pre>\n  \n  <p>Unmarshal parses the JSON-encoded data and stores the result in the value pointed to by v. If v is nil or not a pointer, Unmarshal returns an InvalidUnmarshalError.</p>\n</blockquote>\n\n<p><code>Unmarshal</code> takes an <code>interface{}</code> because it can unmarshal into all sorts of things (slices, maps, structs, ...) as noted in the documentation.</p>\n"}], "owner": {"reputation": 31023, "user_id": 306719, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8b5f2224482b0bc3648353d36a0c8814?s=128&d=identicon&r=PG", "display_name": "hguser", "link": "https://stackoverflow.com/users/306719/hguser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1517143559, "accepted_answer_id": 48483083, "answer_count": 1, "score": -3, "last_activity_date": 1517149533, "creation_date": 1517110575, "last_edit_date": 1517149533, "question_id": 48482930, "link": "https://stackoverflow.com/questions/48482930/pointer-in-golang", "closed_reason": "Duplicate", "title": "Pointer in golang", "body": "<p>I am using golang to parse a json string:</p>\n\n<pre><code>str:=\"{...}\"\nvar f interface{}\njson.Unmarshal([]byte(str), f)\n\nfmt.Println(f)\n</code></pre>\n\n<p>While I got <code>nil</code> in the console.</p>\n\n<p>When I change the code to :</p>\n\n<p><code>json.Unmarshal([]byte(str), &amp;f)</code></p>\n\n<p>It will print the json string.</p>\n\n<p>What's going on? </p>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 407, "user_id": 1410677, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0424d8b7d39d49ab4d5ddbeb13daa0cf?s=128&d=identicon&r=PG", "display_name": "cvoigt", "link": "https://stackoverflow.com/users/1410677/cvoigt"}, "edited": false, "score": 0, "creation_date": 1517137615, "post_id": 48482000, "comment_id": 83963970, "body": "This helped a lot, thanks! It was clear that the error is in the generation of the md5. This explains it very well. Thanks!"}], "tags": [], "owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "is_accepted": true, "score": 9, "last_activity_date": 1517099486, "creation_date": 1517099486, "answer_id": 48482000, "question_id": 48481109, "link": "https://stackoverflow.com/questions/48481109/aws-s3-pre-signed-url-with-enforced-content-md5/48482000#48482000", "title": "AWS S3 pre-signed URL with enforced content-md5", "body": "<p>Because of the way base64 encoding works, the base64 representation of an md5 will always be exactly 24 characters long and the last 2 characters will always be <code>==</code>.  As you see, yours is about twice as long as it should be.</p>\n\n<p>An actual md5 digest/hash is only 16 bytes (128 bits) long, and is a non-printable binary blob.  </p>\n\n<p>The <code>md5sum</code> utility and similar tools return the digest in a hex-encoded, printable format, which is 32 bytes long, consisting of only the characters 0-9 and a-f... it's the same value, but it's already been passed through hex-encoding, so that isn't the representation that you need to start with, if you want to base64-encode the md5 as required in the <code>Content-MD5</code> header.</p>\n\n<p><code>openssl dgst -md5 -binary {filename}</code> will generate the binary representation of the md5 of the file, or you can use a pipe to actually generate the final base-64 representation with <code>openssl dgst -md5 -binary {filename} | base64</code>.</p>\n\n<p>Note that this has nothing to do with ssl of course, but I used the <code>openssl dgst</code> tool for this example because it's probably something you already happen to have on your system, as well as the <code>base64</code> conversion tool, which is probably already there, too.</p>\n"}], "owner": {"reputation": 407, "user_id": 1410677, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0424d8b7d39d49ab4d5ddbeb13daa0cf?s=128&d=identicon&r=PG", "display_name": "cvoigt", "link": "https://stackoverflow.com/users/1410677/cvoigt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2818, "favorite_count": 2, "accepted_answer_id": 48482000, "answer_count": 1, "score": 4, "last_activity_date": 1517099486, "creation_date": 1517091451, "question_id": 48481109, "link": "https://stackoverflow.com/questions/48481109/aws-s3-pre-signed-url-with-enforced-content-md5", "title": "AWS S3 pre-signed URL with enforced content-md5", "body": "<p>I'm trying to use S3\u00b4s pre-signed URLs with an enforced Content-MD5. Therefore I'm basically trying to follow the example of their <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-presigned-urls.html\" rel=\"nofollow noreferrer\">Docs</a>. Obviously I'm doing something wrong.</p>\n\n<p>Here is the checksum of the file I try to upload:</p>\n\n<pre><code>\u279c md5 testfile.txt\nMD5 (testfile.txt) = ce0a4a83c88c2e7562968f03076ae62f\n</code></pre>\n\n<p>Here is the code:</p>\n\n<pre><code>func main() {\n\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"eu-central-1\")},\n    )\n\n    svc := s3.New(sess)\n\n    resp, _ := svc.PutObjectRequest(&amp;s3.PutObjectInput{\n        Bucket: aws.String(\"bucket\"),\n        Key:    aws.String(\"testfile.txt\"),\n    })\n\n    md5 := \"ce0a4a83c88c2e7562968f03076ae62f\" // hard coded &amp; pasted from \"$ md5 testfile.txt\"\n    md5s := base64.StdEncoding.EncodeToString([]byte(md5))\n\n    resp.HTTPRequest.Header.Set(\"Content-MD5\", md5s)\n\n    url, err := resp.Presign(15 * time.Minute)\n    if err != nil {\n        fmt.Println(\"error presigning request\", err)\n        return\n    }\n\n    fmt.Printf(\"curl -XPUT -H \\\"Content-MD5: %s\\\" %s --upload-file %s\\n\\n\", md5s, url, \"testfile.txt\")\n}\n</code></pre>\n\n<p>Which <em>should</em> give me a ready-to-use curl command like: <code>curl -XPUT -H \"Content-MD5: Y2UwYTRhODNjODhjMmU3NTYyOTY4ZjAzMDc2YWU2MmY=\" https://bucket.s3.eu-central-1.amazonaws.com/testfile.txt&lt;super-long-url&gt; --upload-file testfile.txt</code></p>\n\n<p>Unfortunately the request always fails with this message:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Error&gt;&lt;Code&gt;InvalidDigest&lt;/Code&gt;&lt;Message&gt;The Content-MD5 you specified was invalid.&lt;/Message&gt;&lt;Content-MD5&gt;Y2UwYTRhODNjODhjMmU3NTYyOTY4ZjAzMDc2YWU2MmY=&lt;/Content-MD5&gt;&lt;RequestId&gt;24F73D8948824799&lt;/RequestId&gt;&lt;HostId&gt;uKgSjxi03P4EvBk+Yo/EzxqWT0AI6AN3FPB2bKKAtgVjp8t4q2Ku+Tvui108vIQgcwgfvQdwmrk=&lt;/HostId&gt;&lt;/Error&gt;\n</code></pre>\n\n<p>As I was a bit unsure whether I should request with the base64 of the MD5 I tried it with the normal MD5 as well which responses with</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Error&gt;&lt;Code&gt;SignatureDoesNotMatch&lt;/Code&gt;&lt;Message&gt;The request signature we calculated does not match the signature you provided. Check your key and signing method.&lt;/Message&gt;&lt;AWSAccessKeyId&gt;&lt;accesskeyid&gt;&lt;/AWSAccessKeyId&gt;&lt;StringToSign&gt;AWS4-HMAC-SHA256\n20180127T215418Z\n20180127/eu-central-1/s3/aws4_request\ne9580e510332d2fe8811209a8952e849022a56b93a02eca037fa43a10dec680f&lt;/StringToSign&gt;&lt;SignatureProvided&gt;&lt;signature&gt;&lt;/SignatureProvided&gt;&lt;StringToSignBytes&gt;41 57 53 34 2d 48 4d 41 43 2d 53 48 41 32 35 36 0a 32 30 31 38 30 31 32 37 54 32 31 35 34 31 38 5a 0a 32 30 31 38 30 [...]\n&lt;/StringToSignBytes&gt;&lt;CanonicalRequest&gt;PUT\n/testfile.txt\nX-Amz-Algorithm=AWS4-HMAC-SHA256&amp;amp;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;amp;X-Amz-Credential=&lt;accesskeyid&gt;%2F20180127%2Feu-central-1%2Fs3%2Faws4_request&amp;amp;X-Amz-Date=20180127T215418Z&amp;amp;X-Amz-Expires=900&amp;amp;X-Amz-SignedHeaders=content-md5%3Bhost\ncontent-md5:ce0a4a83c88c2e7562968f03076ae62f\nhost:bucket.s3.eu-central-1.amazonaws.com\n\ncontent-md5;host\nUNSIGNED-PAYLOAD&lt;/CanonicalRequest&gt;&lt;CanonicalRequestBytes&gt;50 55 54 0a 2f 74 65 73 74 66 69 6c 65 2e 74 78 74 0a 58 2d 41 6d 7a 2d 41 6c 67 6f 72 69 74 68 6d 3d 41 57 53 34 2d 48 4d 41 43 [...]\n] 44&lt;/CanonicalRequestBytes&gt;&lt;RequestId&gt;D92C97EE37BE602A&lt;/RequestId&gt;&lt;HostId&gt;VatR9cidZlUgq+Ngd5vkZ+wHNiumsCPhx/TvZnwImAkj/STZ0eXazVrwGPRdketBbICd91VLG9E=&lt;/HostId&gt;&lt;/Error&gt;\n</code></pre>\n\n<p>An upload works as soon as I remove the header setting<code>resp.HTTPRequest.Header.Set(\"Content-MD5\", md5s)</code> and request with <code>curl -XPUT https://bucket.s3.eu-central-1.amazonaws.com/testfile.txt&lt;super-long-url&gt; --upload-file testfile.txt</code>.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["inheritance", "go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517088059, "post_id": 48480612, "comment_id": 83954239, "body": "First, there is no inheritance in Go, which probably is part of the confusion. The only reason to declare <code>newF</code> is to remove the methods. If you don&#39;t want to create a new method set for <code>newF</code>, don&#39;t use a new type."}, {"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517088164, "post_id": 48480612, "comment_id": 83954274, "body": "Maybe inheritance is not the word, but derived structs do implement the interfaces their parent&#39;s implement. Why doesn&#39;t that happen with other types?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517088395, "post_id": 48480612, "comment_id": 83954331, "body": "Nothing ever &quot;inherits&quot; methods. Your struct has an embedded <code>Float64</code> field, and the methods are automatically delegated to the <code>Float64</code> implementation. See <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">embedding</a> in Effective Go and in the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">language spec</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "edited": false, "score": 0, "creation_date": 1517089851, "post_id": 48480812, "comment_id": 83954710, "body": "Thanks! That explains a lot. Wish there was a way to use embeddings in non-Struct types."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 3, "last_activity_date": 1517106180, "last_edit_date": 1517106180, "creation_date": 1517088953, "answer_id": 48480812, "question_id": 48480612, "link": "https://stackoverflow.com/questions/48480612/interface-inheritance-in-non-struct-types/48480812#48480812", "title": "Interface inheritance in non-Struct types", "body": "<p>First, there is no inheritance in the Go , at all. There are several article across the web to discussing the design decision of Go discarding many feature of <code>oop</code> but that is really beyond this answer.</p>\n\n<p>Into your case. It is very clear that <code>Float64</code> implements <code>CommonMath</code>. It has the method sets that <code>CommonMath</code> requires so it fits into the interface.</p>\n\n<p>However, when you declare another type, <code>type newF Float64</code>, the new type does not copy the method sets, only the data structure. This is specified in the <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>A type definition creates a new, distinct type with the same underlying type and operations as the given type, and binds an identifier to it. </p>\n  \n  <p>The new type is called a defined type. It is different from any other type, including the type it is created from. </p>\n  \n  <p>A defined type may have methods associated with it. It does not inherit any methods bound to the given type, but the method set of an interface type or of elements of a composite type remains unchanged:</p>\n</blockquote>\n\n<pre><code>// A Mutex is a data type with two methods, Lock and Unlock.\ntype Mutex struct         { /* Mutex fields */ }\nfunc (m *Mutex) Lock()    { /* Lock implementation */ }\nfunc (m *Mutex) Unlock()  { /* Unlock implementation */ }\n\n// NewMutex has the same composition as Mutex but its method set is empty.\ntype NewMutex Mutex\n// The method set of the base type of PtrMutex remains unchanged,\n// but the method set of PtrMutex is empty.\ntype PtrMutex *Mutex\n\n// The method set of *PrintableMutex contains the methods\n// Lock and Unlock bound to its embedded field Mutex.\ntype PrintableMutex struct {\n    Mutex\n}\n\n// MyBlock is an interface type that has the same method set as Block.\ntype MyBlock Block\n</code></pre>\n\n<p>And next come to <code>type NewF struct { Float64 }</code>. On a first look, this looks very much to inheritance but once again there is no such thing in Go. It is called <strong>embedding</strong> or <strong>composition</strong>. Again, the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is called an embedded field. An embedded field must be specified as a type name T or as a pointer to a non-interface type name *T, and T itself may not be a pointer type. The unqualified type name acts as the field name. </p>\n  \n  <p>A field or method f of an embedded field in a struct x is called promoted if x.f is a legal selector that denotes that field or method f.</p>\n  \n  <p>Promoted fields act like ordinary fields of a struct except that they cannot be used as field names in composite literals of the struct.</p>\n  \n  <p>Given a struct type S and a type named T, promoted methods are included in the method set of the struct as follows:</p>\n  \n  <ul>\n  <li><p>If S contains an embedded field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S also includes promoted methods with receiver *T.</p></li>\n  <li><p>If S contains an embedded field *T, the method sets of S and *S both include promoted methods with receiver T or *T.</p></li>\n  </ul>\n</blockquote>\n\n<p>So, the trick here is <strong>promotion</strong>. The method of <code>Float64</code> gets promoted to <code>NewF</code>. Again it may looks like inheritance in some way, but it is distinct. Please note that the promoted method still belongs to the embedded type, and the receiver will always be the orignal one. The following code print 4.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {}\n\ntype B struct {A}\n\nfunc (A) P() int {\n    return 4\n}\n\nfunc (B) P() int {\n    return 5\n}\n\nfunc (a A) S() {\n    fmt.Println(a.P())\n}\n\nfunc main() {\n    B{}.S()\n}\n</code></pre>\n\n<p>playground: <a href=\"https://play.golang.org/p/BuBL69LqeY6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BuBL69LqeY6</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8440246, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QAyamtZtyB0/AAAAAAAAAAI/AAAAAAAAACQ/O35ZCOGYDu4/photo.jpg?sz=128", "display_name": "mariohm1311", "link": "https://stackoverflow.com/users/8440246/mariohm1311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 453, "favorite_count": 1, "accepted_answer_id": 48480812, "answer_count": 1, "score": 0, "last_activity_date": 1517106180, "creation_date": 1517087499, "last_edit_date": 1517088300, "question_id": 48480612, "link": "https://stackoverflow.com/questions/48480612/interface-inheritance-in-non-struct-types", "title": "Interface inheritance in non-Struct types", "body": "<p>I'm currently learning interfaces in Go, but I've gotten stuck with this piece of code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\n// CommonMath is a common interface for math types\ntype CommonMath interface {\n    Abs() float64\n}\n\n// Float64 is a custom float64 type\ntype Float64 float64\n\n// Abs returns the modulus of objects implementing CommonMath\nfunc (f Float64) Abs() float64 {\n    if f &lt; 0 {\n        return -float64(f)\n    }\n    return float64(f)\n}\n\n// AbsSquared returns the square of objects implementing CommonMath\nfunc AbsSquared(num CommonMath) float64 {\n    return num.Abs() * num.Abs()\n}\n\nfunc main() {\n    var f Float64\n    f = -5\n\n    type newF Float64\n    var newFloat newF\n    newFloat = 10.5\n\n    fmt.Println(f)\n    fmt.Println(f.Abs())\n    fmt.Println(AbsSquared(newFloat))\n}\n</code></pre>\n\n<p>As it turns out, it doesn't compile because <code>newFloat</code> does not implement the interface <code>CommonMath</code>. Being of type <code>newF</code>, which is a custom Float64 type that implements the interface, I don't know what's going on. To make things weirder, I substituted the declaration of newF and newFloat for the following, which implements the same but as a struct:</p>\n\n<pre><code>type newF struct {\n    Float64\n}\nnewFloat := newF{10.5}\n</code></pre>\n\n<p>Suddenly, the code builds perfectly fine. Does this mean that only structs can implement parent types' interfaces, and therefore declaring the type <code>newF</code> directly as <code>Float64</code> is not allowed?</p>\n"}, {"tags": ["unit-testing", "go", "test-coverage"], "comments": [{"owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 2, "creation_date": 1517091331, "post_id": 48479501, "comment_id": 83955154, "body": "Out of curiosity, why are your mocks consumed outside of tests?"}, {"owner": {"reputation": 3317, "user_id": 3368262, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/46241f9045a40bec251e7226913d443f?s=128&d=identicon&r=PG", "display_name": "Rahul Garg", "link": "https://stackoverflow.com/users/3368262/rahul-garg"}, "reply_to_user": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 0, "creation_date": 1517122993, "post_id": 48479501, "comment_id": 83960682, "body": "We are following DDD and in DDD usually, domain expose its repository interface and this interface implemented by repository later. Similar for services, which consumed by handler layer."}, {"owner": {"reputation": 3317, "user_id": 3368262, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/46241f9045a40bec251e7226913d443f?s=128&d=identicon&r=PG", "display_name": "Rahul Garg", "link": "https://stackoverflow.com/users/3368262/rahul-garg"}, "reply_to_user": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 0, "creation_date": 1517125802, "post_id": 48479501, "comment_id": 83961210, "body": "Mocks consumed by test code itself but outside of that package (Golang specific)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517140867, "post_id": 48479501, "comment_id": 83964842, "body": "Shared mocks should live in a separate package. Then only your other <code>*_test.go</code> files need to depend on them."}], "answers": [{"tags": [], "owner": {"reputation": 319196, "user_id": 34211, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/gfFlI.jpg?s=128&g=1", "display_name": "Andrew Hare", "link": "https://stackoverflow.com/users/34211/andrew-hare"}, "is_accepted": false, "score": 2, "last_activity_date": 1517120511, "creation_date": 1517120511, "answer_id": 48483755, "question_id": 48479501, "link": "https://stackoverflow.com/questions/48479501/mock-code-reducing-code-coverage/48483755#48483755", "title": "Mock code reducing code coverage", "body": "<p>The best thing in this case would be to move the mocks to their own dedicated package which would have no test coverage. This would remove their impact on code that you actually want coverage data on.</p>\n"}, {"tags": [], "owner": {"reputation": 3317, "user_id": 3368262, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/46241f9045a40bec251e7226913d443f?s=128&d=identicon&r=PG", "display_name": "Rahul Garg", "link": "https://stackoverflow.com/users/3368262/rahul-garg"}, "is_accepted": false, "score": 0, "last_activity_date": 1540570182, "creation_date": 1540570182, "answer_id": 53012604, "question_id": 48479501, "link": "https://stackoverflow.com/questions/48479501/mock-code-reducing-code-coverage/53012604#53012604", "title": "Mock code reducing code coverage", "body": "<p>That's how we solved it.</p>\n\n<ol>\n<li>Put interface in the consumer folders. If service is injected in the handler, then the handler will have the interface definition of service. This is because GoLang philosophy suggests that interface is to consume functionality rather than expose it.</li>\n<li><p>Used mockery to generate mocks.</p></li>\n<li><p>Generate mocks in a separate _mock folder.</p></li>\n</ol>\n"}], "owner": {"reputation": 3317, "user_id": 3368262, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/46241f9045a40bec251e7226913d443f?s=128&d=identicon&r=PG", "display_name": "Rahul Garg", "link": "https://stackoverflow.com/users/3368262/rahul-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1540570182, "creation_date": 1517080005, "question_id": 48479501, "link": "https://stackoverflow.com/questions/48479501/mock-code-reducing-code-coverage", "title": "Mock code reducing code coverage", "body": "<p>I am working with Golang and using <a href=\"https://github.com/littledot/mockhiato\" rel=\"nofollow noreferrer\">mockhiato</a> to generate mocks for all interfaces. This tool generates mocked implementation in mocks.go file within the same package. I can't rename mocks.go to mocks_test.go as this mock file is consumed by other packages.</p>\n\n<p>The problem is that these mocks files are counted by go coverage tool and thus reducing my code coverage percentage for the package. </p>\n\n<p>I am looking a good workaround so that my code coverage will not show bad numbers. </p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1517078776, "post_id": 48479264, "comment_id": 83951586, "body": "You could start by trying to use a slice instead of an array.  Just add <code>[:]</code> to the Go uuid.  For instance, <code>db.Insert(&quot;blah...&quot;, myUUID[:])</code>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1517078927, "post_id": 48479264, "comment_id": 83951632, "body": "You may also want to try a string formatted uuid as well.  Since every uuid library I have used implement the Stringer interface, I would try <code>myUUID.String()</code> as well if the slice doesn&#39;t work."}, {"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1517079164, "post_id": 48479264, "comment_id": 83951702, "body": "@sberry converting to <code>slice</code> produced a different error: <code>pq: invalid byte sequence for encoding &quot;UTF8&quot;: 0x83</code>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1517079400, "post_id": 48479264, "comment_id": 83951758, "body": "Assuming this is the right project, this may be helpful: <a href=\"https://github.com/go-pg/pg/issues/483\" rel=\"nofollow noreferrer\">github.com/go-pg/pg/issues/483</a>"}, {"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1517079691, "post_id": 48479264, "comment_id": 83951849, "body": "Oops. so I was using go.uuid BUT I defined the uuid in my models as <code>[16]byte</code> since that was the type in the docs, changing it to the uuid.UUID data type solved the problem without any conversions. Sorry."}], "answers": [{"tags": [], "owner": {"reputation": 449, "user_id": 1914351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d268c84819e83e2f62b5f9db34cebfb?s=128&d=identicon&r=PG", "display_name": "Jeff Collier", "link": "https://stackoverflow.com/users/1914351/jeff-collier"}, "is_accepted": true, "score": 2, "last_activity_date": 1544901664, "creation_date": 1544901664, "answer_id": 53796490, "question_id": 48479264, "link": "https://stackoverflow.com/questions/48479264/convert-client-uuid-to-sql-uuid/53796490#53796490", "title": "Convert client UUID to SQL UUID", "body": "<p>Thanks to the link from @sberry, I found success. Here are snippets of the code for your benefit (with a PostgreSQL 9.5 database):</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"net/http\"\n\n    \"github.com/google/uuid\"\n)\n\ntype Thing struct {\n    ID     uuid.UUID `json:\"-\" sql:\",type:uuid\"`\n    Name   string    `json:\"name\"`\n}\n\n// For a database table created as such:\n// CREATE TABLE things ( \n// id UUID PRIMARY KEY DEFAULT gen_random_uuid(), \n// name TEXT DEFAULT ''::text\n// )\n\nfunc selectThingssSQL() ([]Thing, error) {\n    things := make([]Thing, 0)\n\n    rows, err := db.Query(\"SELECT id, name FROM things\")\n    if err != nil {\n        return nil, err\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        t := &amp;Thing{}\n        if err := rows.Scan(&amp;t.ID, &amp;t.Name); err != nil {\n            return nil, err\n        }\n        things = append(things, *t)\n    }\n\n    return things, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1408, "favorite_count": 1, "accepted_answer_id": 53796490, "answer_count": 1, "score": 2, "last_activity_date": 1544901664, "creation_date": 1517078614, "question_id": 48479264, "link": "https://stackoverflow.com/questions/48479264/convert-client-uuid-to-sql-uuid", "title": "Convert client UUID to SQL UUID", "body": "<p>I'm using <code>go</code> and the package <code>uuid</code> to generate a uuid of type <code>[16]byte</code>. However when I try to insert that uuid into my <code>postgres</code> column of type <code>uuid</code> I get the error <code>converting argument $1 type: unsupported type [16]uint8, a array</code>. So apparently I should convert the uuid on the client before I insert it into the db. How should I do that? What type should I convert it to?</p>\n\n<p>In short: What <code>go</code> data type will work with <code>uuid</code> in <code>postgres</code>?</p>\n"}, {"tags": ["rest", "api", "go", "digital-ocean", "slack-api"], "comments": [{"owner": {"reputation": 3859, "user_id": 1007877, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KVGNK.png?s=128&g=1", "display_name": "vimdude", "link": "https://stackoverflow.com/users/1007877/vimdude"}, "edited": false, "score": 0, "creation_date": 1517077927, "post_id": 48479093, "comment_id": 83951295, "body": "try <a href=\"http://supervisord.org\" rel=\"nofollow noreferrer\">supervisord.org</a>. We used it with Go and works well. The better way is to use docker."}], "answers": [{"comments": [{"owner": {"reputation": 6660, "user_id": 1347435, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/EC7Qo.png?s=128&g=1", "display_name": "SoldierCorp", "link": "https://stackoverflow.com/users/1347435/soldiercorp"}, "edited": false, "score": 0, "creation_date": 1517099895, "post_id": 48479807, "comment_id": 83957093, "body": "Thank you @James, I&#39;m going to take a look at your project, very useful!"}, {"owner": {"reputation": 6660, "user_id": 1347435, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/EC7Qo.png?s=128&g=1", "display_name": "SoldierCorp", "link": "https://stackoverflow.com/users/1347435/soldiercorp"}, "edited": false, "score": 0, "creation_date": 1517167674, "post_id": 48479807, "comment_id": 83973794, "body": "I&#39;m going to mark your answer as accepted because you were the first but the answer of @Muhammad it&#39;s also perfect for what I am doing :) Thank you guys!"}], "tags": [], "owner": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "is_accepted": true, "score": 1, "last_activity_date": 1517082000, "creation_date": 1517082000, "answer_id": 48479807, "question_id": 48479093, "link": "https://stackoverflow.com/questions/48479093/deploy-and-run-a-go-api-server-on-ubuntu-centos/48479807#48479807", "title": "Deploy and run a Go API server on Ubuntu/Centos", "body": "<p>I think most people use <a href=\"http://supervisord.org/\" rel=\"nofollow noreferrer\">Supervisor</a> for this purpose, including me.</p>\n\n<p>To make it very easy for you, just take a look at <a href=\"https://github.com/Zamiell/isaac-racing-server#install-as-a-service-optional\" rel=\"nofollow noreferrer\">my Golang project, isaac-racing-server</a> and use it as a template for yours by replacing <code>isaac-racing-server</code> with the name of your app. (The Supervisor files are in <a href=\"https://github.com/Zamiell/isaac-racing-server/tree/master/install/supervisord\" rel=\"nofollow noreferrer\">a subdirectory</a>.)</p>\n"}, {"comments": [{"owner": {"reputation": 6660, "user_id": 1347435, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/EC7Qo.png?s=128&g=1", "display_name": "SoldierCorp", "link": "https://stackoverflow.com/users/1347435/soldiercorp"}, "edited": false, "score": 0, "creation_date": 1517275182, "post_id": 48505683, "comment_id": 84019889, "body": "That&#39;s also clever and I am going to try it out, thanks1"}], "tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": false, "score": 3, "last_activity_date": 1517242827, "creation_date": 1517242827, "answer_id": 48505683, "question_id": 48479093, "link": "https://stackoverflow.com/questions/48479093/deploy-and-run-a-go-api-server-on-ubuntu-centos/48505683#48505683", "title": "Deploy and run a Go API server on Ubuntu/Centos", "body": "<p>You can use <code>pm2</code> if you want. When you build a go project it creates a binary executable, lets say <code>backend-server</code>, which you can run from terminal and will start the app like this:</p>\n\n<pre><code>$ ./backend-server\n</code></pre>\n\n<p>If it's not executable or has permission denied issue, add the executable permission to it.</p>\n\n<pre><code>$ chmod +x backend-server\n</code></pre>\n\n<p>You binary should be ready to run. I like to do it with a json config file (<code>process.json</code>) so that I can pass extra env variables as well and don't have to type a lot in terminal.\nMy <code>process.json</code> looks something like this:</p>\n\n<pre><code>{\n  \"apps\" : [{\n    \"name\"        : \"backend-app\",\n    \"script\"      : \"./backend-server\",\n    \"env\": {\n      \"DB_USER\": \"db_user\",\n      \"PORT\": 8080\n    }\n  }]\n}\n</code></pre>\n\n<p>Finally you can start the app using pm2 like this:</p>\n\n<pre><code>$ pm2 start process.json\n</code></pre>\n\n<p>More details about json config can be found in <a href=\"http://pm2.keymetrics.io/docs/usage/application-declaration/\" rel=\"nofollow noreferrer\">official doc</a></p>\n"}], "owner": {"reputation": 6660, "user_id": 1347435, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/EC7Qo.png?s=128&g=1", "display_name": "SoldierCorp", "link": "https://stackoverflow.com/users/1347435/soldiercorp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1449, "favorite_count": 2, "accepted_answer_id": 48479807, "answer_count": 2, "score": 2, "last_activity_date": 1517242827, "creation_date": 1517077620, "last_edit_date": 1517186323, "question_id": 48479093, "link": "https://stackoverflow.com/questions/48479093/deploy-and-run-a-go-api-server-on-ubuntu-centos", "title": "Deploy and run a Go API server on Ubuntu/Centos", "body": "<p>I just finished my first backend with Go using Iris framework but now I need to put it on production so I can use it in the Slack app I built.</p>\n\n<p>In order to test the code locally I only run my file with <code>go run main.go</code> and <code>ngrok</code> to test with the Slack API, it's working and it's finished.</p>\n\n<p>I have a droplet with Ubuntu 16.04.3 and other one with Centos 7... I was searching for something like <code>pm2</code> for go, running the server and using nginx to point that port but I read that with Go it's different and I have to use something like this <a href=\"https://fabianlee.org/2017/05/21/golang-running-a-go-binary-as-a-systemd-service-on-ubuntu-16-04/\" rel=\"nofollow noreferrer\">https://fabianlee.org/2017/05/21/golang-running-a-go-binary-as-a-systemd-service-on-ubuntu-16-04/</a></p>\n\n<p>But that's a very long configuration for a simple server and my questions are:</p>\n\n<ul>\n<li>Is this the usual way to config the APIs with Go?</li>\n<li>Apart of DigitalOcean, do you recommend to use a different service to run my API?</li>\n</ul>\n\n<p>This is really my first time with Go and I just want to learn more, I am a backend developer with Laravel and NodeJS.</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517067319, "post_id": 48477253, "comment_id": 83947849, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41931082/inserting-html-to-golang-template\">Inserting HTML to golang template</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1517067142, "creation_date": 1517067142, "answer_id": 48477336, "question_id": 48477253, "link": "https://stackoverflow.com/questions/48477253/populate-many-html-elements-inside-a-div-with-golang-templates/48477336#48477336", "title": "Populate many Html elements inside a div with golang templates?", "body": "<p>To prevent escaping, declare the field as type <a href=\"https://godoc.org/html/template#HTML\" rel=\"nofollow noreferrer\">template.HTML</a>:</p>\n\n<pre><code>type FooBar struct {\n    TextTop    template.HTML\n}\n</code></pre>\n\n<p>See the linked documentation for information about the security risks of using template.HTML.</p>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517067142, "creation_date": 1517066665, "question_id": 48477253, "link": "https://stackoverflow.com/questions/48477253/populate-many-html-elements-inside-a-div-with-golang-templates", "title": "Populate many Html elements inside a div with golang templates?", "body": "<p>I receive from my frontend a json with a string containing 1 or more HTML elements for example:</p>\n\n<p><code>\"textTop\" : \"&lt;b&gt;bold&lt;/b&gt;&lt;div&gt;&lt;i&gt;italic&lt;/i&gt;...\"</code></p>\n\n<p>I want to use this string to create Html elements inside a div, but I'm not really sure if I can do this with golang templates.</p>\n\n<pre><code>type FooBar struct {\n    TextTop    string\n}\n</code></pre>\n\n<p>So I'm currently storing the TextTop in a string, and then displaying it in html with:</p>\n\n<pre><code>        &lt;div&gt;\n            {{.TextTop}}\n        &lt;/div&gt;\n</code></pre>\n\n<p>But of course this produces the following result in the browser. just a div containing the <strong>string</strong>, I'm passing.: \n<a href=\"https://i.stack.imgur.com/jjvz6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jjvz6.png\" alt=\"enter image description here\"></a></p>\n\n<p>So should I use a different type for <code>TextTop</code> inside <code>Foobar struct</code> instead of type string, which one? or can I use a golang function that reads all html elements from a string and renders them in the html as part of the DOM and not just a string?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1517066935, "creation_date": 1517066935, "answer_id": 48477298, "question_id": 48477248, "link": "https://stackoverflow.com/questions/48477248/generate-temp-folder-in-project-structure/48477298#48477298", "title": "Generate temp folder in project structure", "body": "<p>Use the standard temporary directory of the operating system for manipulation. You can get it by calling function <a href=\"https://golang.org/pkg/os/#TempDir\" rel=\"nofollow noreferrer\"><code>os.TempDir()</code></a>. Put the final results in the current directory, you can get it by calling <a href=\"https://golang.org/pkg/os/#Getwd\" rel=\"nofollow noreferrer\"><code>os.Getwd()</code></a>.</p>\n"}], "owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 1, "accepted_answer_id": 48477298, "answer_count": 1, "score": 1, "last_activity_date": 1517156509, "creation_date": 1517066621, "last_edit_date": 1517156509, "question_id": 48477248, "link": "https://stackoverflow.com/questions/48477248/generate-temp-folder-in-project-structure", "title": "Generate temp folder in project structure", "body": "<p>I\u2019ve a Go program which user should get it via <code>go get</code> command.\nmy program is command line program,\nNow my program should generate temp folder  to do some manipulation on data and when it finish generate zip with the artificats on the same folder that the user is running the cmd program,\nmy question is where its better to <strong>generate the temp folder</strong>? </p>\n\n<pre><code>go\n-src\n\u2014-userapp\n</code></pre>\n\n<p>if the user open terminal in the the user app and run some command I need to create (at the end some zip with artefacts) </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1517066913, "post_id": 48477094, "comment_id": 83947712, "body": "Use a pool of goroutines to issue the requests instead of one goroutine per request.  See <a href=\"https://stackoverflow.com/questions/31527948/too-many-open-files-when-making-http-requests\" title=\"too many open files when making http requests\">stackoverflow.com/questions/31527948/&hellip;</a> and others for info on how."}], "answers": [{"comments": [{"owner": {"reputation": 2779, "user_id": 957130, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05be4f754d3836ad621740c90ee10bfb?s=128&d=identicon&r=PG", "display_name": "Marcin Pietraszek", "link": "https://stackoverflow.com/users/957130/marcin-pietraszek"}, "edited": false, "score": 0, "creation_date": 1517066084, "post_id": 48477146, "comment_id": 83947478, "body": "I&#39;ve run both <code>ulimit -f X</code> and <code>ulimit X</code> ;). Thanks, for clarification. Maybe you could also review the script, to earn that accepted answer? ;)"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 2779, "user_id": 957130, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05be4f754d3836ad621740c90ee10bfb?s=128&d=identicon&r=PG", "display_name": "Marcin Pietraszek", "link": "https://stackoverflow.com/users/957130/marcin-pietraszek"}, "edited": false, "score": 0, "creation_date": 1517066423, "post_id": 48477146, "comment_id": 83947576, "body": "There are 1750 items in the geek list, so you&#39;re launching 1750 goroutines each performing an http get each using a tcp socket. And all of those are being launched almost at the same time (probably faster than the first <code>get</code> returns anyway). The default file descriptor limit is 1024. You should rate limit your downloads."}, {"owner": {"reputation": 2779, "user_id": 957130, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05be4f754d3836ad621740c90ee10bfb?s=128&d=identicon&r=PG", "display_name": "Marcin Pietraszek", "link": "https://stackoverflow.com/users/957130/marcin-pietraszek"}, "edited": false, "score": 0, "creation_date": 1517066529, "post_id": 48477146, "comment_id": 83947603, "body": "Is there any convinient way to throtle the running gorutines? Let&#39;s assume that I&#39;d like to start 1kk of them and have always at most 1k running."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1517067382, "last_edit_date": 1517067382, "creation_date": 1517065879, "answer_id": 48477146, "question_id": 48477094, "link": "https://stackoverflow.com/questions/48477094/error-during-go-build-run-execution/48477146#48477146", "title": "Error during go build/run execution", "body": "<p>You ran <code>ulimit 2048</code> which changed the maximum file size.</p>\n\n<p>From <code>man bash(1)</code>, <code>ulimit</code> section:</p>\n\n<blockquote>\n  <p>If no option is given, then -f is assumed.</p>\n</blockquote>\n\n<p>This means that you now set the maximum file size to <code>2048</code> bytes, that's probably not enough for.... anything.</p>\n\n<p>I'm guessing you meant to change the limit for number of open file descriptors. For this, you want to run:</p>\n\n<pre><code>ulimit -n 2048\n</code></pre>\n\n<p>As for the original error (before changing the maximum file size), you're launching 1700 goroutines, each performing a http get. Each creates a connection, using a tcp socket. These are covered by the open file descriptor limit.</p>\n\n<p>Instead, you should be limiting the number of concurrent downloads. This can be done with a simple <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">worker pool</a> pattern.</p>\n"}], "owner": {"reputation": 2779, "user_id": 957130, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05be4f754d3836ad621740c90ee10bfb?s=128&d=identicon&r=PG", "display_name": "Marcin Pietraszek", "link": "https://stackoverflow.com/users/957130/marcin-pietraszek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 48477146, "answer_count": 1, "score": 0, "last_activity_date": 1517067382, "creation_date": 1517065507, "question_id": 48477094, "link": "https://stackoverflow.com/questions/48477094/error-during-go-build-run-execution", "title": "Error during go build/run execution", "body": "<p>I've created a simple go script: <a href=\"https://gist.github.com/kbl/86ed3b2112eb80522949f0ce574a04e3\" rel=\"nofollow noreferrer\">https://gist.github.com/kbl/86ed3b2112eb80522949f0ce574a04e3</a></p>\n\n<p>It's fetching some xml from the internet and then starts X goroutines. The X depends on file content. In my case it was 1700 goroutines.</p>\n\n<p>My first execution finished with:</p>\n\n<pre><code>$ go run mathandel1.go \n2018/01/27 14:19:37 Get https://www.boardgamegeek.com/xmlapi/boardgame/162152?pricehistory=1&amp;stats=1: dial tcp 72.233.16.130:443: socket: too many open files\n2018/01/27 14:19:37 Get https://www.boardgamegeek.com/xmlapi/boardgame/148517?pricehistory=1&amp;stats=1: dial tcp 72.233.16.130:443: socket: too many open files\nexit status 1\n</code></pre>\n\n<p>I've tried to increase <code>ulimit</code> to 2048.</p>\n\n<p>Now I'm getting different error, script is the same thou:</p>\n\n<pre><code>$ go build mathandel1.go \n# command-line-arguments\n/usr/local/go/pkg/tool/linux_amd64/link: flushing $WORK/command-line-arguments/_obj/exe/a.out: write $WORK/command-line-arguments/_obj/exe/a.out: file too large\n</code></pre>\n\n<p>What is causing that error? How can I fix that?</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517063686, "post_id": 48476789, "comment_id": 83946753, "body": "But, in both cases, I am assigning <code>*data</code> type. Right?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517063827, "post_id": 48476789, "comment_id": 83946810, "body": "You definitely are. Give me a minute, I&#39;ll try and rephrase my answer better."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517064824, "post_id": 48476789, "comment_id": 83947097, "body": "I would say this is about taking address to composite literals."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517064975, "post_id": 48476789, "comment_id": 83947148, "body": "It doesn&#39;t matter if we&#39;re assigning <code>&amp;data{1}</code> or some random variable of type <code>*data</code>. The important part is that assignments don&#39;t change the variable&#39;s address, they change the value. So really, it&#39;s about pointer vs value."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517065132, "post_id": 48476789, "comment_id": 83947198, "body": "Thanks for your explanation."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517065238, "post_id": 48476789, "comment_id": 83947229, "body": "Yes you are right. I was messing things with experience of c and Python. Go is more consistent and plain."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 5, "last_activity_date": 1517069105, "last_edit_date": 1517069105, "creation_date": 1517063373, "answer_id": 48476789, "question_id": 48476733, "link": "https://stackoverflow.com/questions/48476733/what-is-the-difference-between-this-usage-of-pointer-a-a-a-and-b-b-b/48476789#48476789", "title": "What is the difference between this usage of pointer (a:=&amp;A; a) and (b:=B; &amp;b)", "body": "<p>This is all about use and <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assignment</a> of values vs pointers.</p>\n\n<p>In both cases, <code>m[something]</code> holds an address to a <code>data</code>.\nHowever, the important distinction is what <code>d1</code> and <code>d2</code> are.</p>\n\n<h3>d1 is of type <code>*data</code>:</h3>\n\n<p>The <strong>value</strong> of <code>d1</code> is a pointer. When we assign <code>&amp;data{...}</code> to <code>d1</code>, this changes the value of <code>d1</code> to be a pointer to the new struct.</p>\n\n<p>Since you are assigning, or changing the <strong>value</strong> of <code>d1</code>, the map still holds the old value.</p>\n\n<pre><code>d1 := &amp;data{1}\nfmt.Printf(\"d1    value: %p\\n\", d1)\n// d1    value: 0x10410020\n\nd1 = &amp;data{2}\nfmt.Printf(\"d1    value: %p\\n\", d1)\n// d1    value: 0x10410024\n</code></pre>\n\n<p>As you can see: the address in memory that <code>d1</code> is pointing to has changed. You are storing the value <code>0x10410020</code> in the map, so even if you change <code>p1</code> to point to another address, the pointer inside the map still points to the original location.</p>\n\n<p>The pointers look like:</p>\n\n<pre><code>m[\"d1\"] -----&gt; data{1}\n\nd1      -----&gt; data{2}\n</code></pre>\n\n<h3>d2 is of type <code>data</code>:</h3>\n\n<p>In the case of <code>d2</code>, you are storing the <strong>address</strong> of the variable <code>d2</code>. On assignment, we change the value of <code>d2</code>, but its address does not change.</p>\n\n<pre><code>d2 := data{1}\nfmt.Printf(\"d2    address: %p\\n\", &amp;d2)\n// d2    address: 0x10410028\n\nd2 = data{2}\nfmt.Printf(\"d2    address: %p\\n\", &amp;d2)\n// d2    address: 0x10410028\n</code></pre>\n\n<p>Since this address <code>0x10410028</code> is what you are storing in the map, it is pointing to the value of <code>d2</code> which changes on assignment.</p>\n\n<p>The pointers in this look like (they're both pointers to the same area of memory. Sorry, it's hard to draw arrows in ascii):</p>\n\n<pre><code>m[\"d2\"] -----\\\n             data{2}\nd2      -----/\n</code></pre>\n"}], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48476789, "answer_count": 1, "score": 1, "last_activity_date": 1517069105, "creation_date": 1517063020, "question_id": 48476733, "link": "https://stackoverflow.com/questions/48476733/what-is-the-difference-between-this-usage-of-pointer-a-a-a-and-b-b-b", "title": "What is the difference between this usage of pointer (a:=&amp;A; a) and (b:=B; &amp;b)", "body": "<p>Can't understand following behavior. Difference of <code>d1 := &amp;data{1}; d1</code> and <code>d2 := data{1}; &amp;d1</code>. Both are pointer, right? But they behave differently. Whats happening here </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype data struct {\n    value int\n}\n\nfunc main() {\n    m := make(map[string]*data)\n    d1 := &amp;data{1}\n    m[\"d1\"] = d1 // Here putting &amp;{1}\n    d1 = &amp;data{2}\n    fmt.Println(m[\"d1\"])\n    // &amp;{1}\n\n    d2 := data{1}\n    m[\"d2\"] = &amp;d2 // Here putting &amp;{1}\n    d2 = data{2}\n    fmt.Println(m[\"d2\"])\n    // &amp;{2}\n}\n</code></pre>\n\n<p>What is actually happening here?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517054190, "post_id": 48475511, "comment_id": 83944288, "body": "<code>GithubReporter</code> does not implement <code>Reporter</code>. The expected method is <code>ChangeStatus(string) error</code> whereas <code>GithubReporter</code> has <code>ChangeStatus() error</code>"}, {"owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517054472, "post_id": 48475511, "comment_id": 83944354, "body": "@Marc Right, I missed that when copying the example. Corrected version still returns same error message."}, {"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1517054757, "post_id": 48475511, "comment_id": 83944424, "body": "<code>func (repo *GithubRepository) GetReporter(sha string) Reporter {  return &amp;GithubReporter{} }</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517054821, "post_id": 48475511, "comment_id": 83944439, "body": "The method signatures also don&#39;t match in for <code>GetReporter</code>. As the error message tells you, it needs to return a <code>Reporter</code>."}, {"owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "reply_to_user": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1517054990, "post_id": 48475511, "comment_id": 83944478, "body": "@har07 @Marc Yes, I could do <code>func (repo *GithubRepository) GetReporter(sha string) Reporter { return GithubReporter{} }</code>, but then the second package would need to import <code>Reporter</code>. I am trying to have package 1 and 2 independent of each other."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517055187, "post_id": 48475511, "comment_id": 83944528, "body": "Can you use comment? Which struct/methods belongs to which package"}, {"owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517055613, "post_id": 48475511, "comment_id": 83944636, "body": "@aerokite added above."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517057467, "post_id": 48475511, "comment_id": 83945136, "body": "I am trying to have package 1 and 2 independent of each other. This is not possible in this case. @mxinden"}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517055233, "post_id": 48475644, "comment_id": 83944540, "body": "Yes, but then package #2 would need to import <code>Reporter</code> from package #1. But I am trying to have package 1 and 2 independent of each other.  I will add that to the question above."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517055564, "post_id": 48475644, "comment_id": 83944625, "body": "@mxinden, is it?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517056097, "post_id": 48475644, "comment_id": 83944775, "body": "@mxinden, can you understand now?"}, {"owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517056286, "post_id": 48475644, "comment_id": 83944839, "body": "Would you mind adjusting your example to the above mentioned three packages?  In your example package B imports <code>Reporter</code> from package A, which I am trying to not do. I am doing that, so that package A is not coupled to package B, or the other way around. Only the third package combines the two."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517056948, "post_id": 48475644, "comment_id": 83945010, "body": "No. You can&#39;t do this in this organization."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517057215, "post_id": 48475644, "comment_id": 83945074, "body": "You need to return Reporter. In this case, you need to import package A."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "edited": false, "score": 0, "creation_date": 1517057341, "post_id": 48475644, "comment_id": 83945103, "body": "You can use another package."}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 0, "last_activity_date": 1517060284, "last_edit_date": 1517060284, "creation_date": 1517055006, "answer_id": 48475644, "question_id": 48475511, "link": "https://stackoverflow.com/questions/48475511/nested-interfaces-x-does-not-implement-y-wrong-type-for-z-method/48475644#48475644", "title": "Nested interfaces: X does not implement Y (Wrong type for Z method)", "body": "<p>Use <code>GithubRepository</code> and <code>GithubReporter</code> as value receiver as you have not create variable as pointer. And return interface in method <code>GetReporter</code></p>\n\n<pre><code>func (repo GithubRepository) GetReporter(sha string) Reporter {\n return GithubReporter{}\n}\n\nfunc (reporter GithubReporter) ChangeStatus(status string) error {\n  // Change the status\n  return nil\n}\n</code></pre>\n\n<p>Hope this will help.</p>\n\n<p>See in action: <a href=\"https://play.golang.org/p/Gugm3LetqHU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Gugm3LetqHU</a></p>\n\n<p>If you have interface in different package, these is no need to do special things, just point to that interface with package.</p>\n\n<p>In package A</p>\n\n<pre><code>package A\n\ntype Repository interface {\n    GetReporter(string) Reporter\n}\n\ntype Reporter interface {\n    ChangeStatus(string) error\n}\n\nfunc Execute(r Repository) {\n    r.GetReporter(\"report:r\").ChangeStatus(\"status:s\")\n}\n</code></pre>\n\n<p>In package B</p>\n\n<pre><code>package B\n\nimport (\n    \"fmt\"\n    \"test/A\"\n)\n\ntype GithubRepository struct {\n}\n\ntype GithubReporter struct {\n}\n\nfunc (repo GithubRepository) GetReporter(sha string) A.Reporter {\n    fmt.Println(sha)\n    return GithubReporter{}\n}\n\nfunc (reporter GithubReporter) ChangeStatus(status string) error {\n    // Change the status\n    fmt.Printf(status)\n    return nil\n}\n</code></pre>\n\n<p>May be you can try <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#import-dot\" rel=\"nofollow noreferrer\">Import Dot</a></p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517059224, "post_id": 48476194, "comment_id": 83945569, "body": "Auctually with earlier go versions, it can still be done, but much, much uglier."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517059901, "post_id": 48476194, "comment_id": 83945742, "body": "What about <code>Import Dot</code>?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517060026, "post_id": 48476194, "comment_id": 83945782, "body": "@aerokite In which package are you trying to import what as dot? Anyway, I would advice strongly against doing so since neither does it break dependency, nor does it provide anything for good."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517060060, "post_id": 48476194, "comment_id": 83945790, "body": "See my answer. Edited"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517060151, "post_id": 48476194, "comment_id": 83945808, "body": "@aerokite So what&#39;s wrong with the orignal import? It is much more readable."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1517059040, "creation_date": 1517059040, "answer_id": 48476194, "question_id": 48475511, "link": "https://stackoverflow.com/questions/48475511/nested-interfaces-x-does-not-implement-y-wrong-type-for-z-method/48476194#48476194", "title": "Nested interfaces: X does not implement Y (Wrong type for Z method)", "body": "<p>It was impossible to make two package independent in such a case. However, with go1.9 and its type alias, this can be done.</p>\n\n<p>First, as go proverbs say, <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">A little copy is better than a little dependency</a>. You should copy the part of definition of <code>Reporter</code> to package B, and change the signature according to it: <code>func (repo GithubRepository) GetReporter(sha string) Reporter</code>.</p>\n\n<p>Yet the compiler won't understand that the two interface is the samething. But with the help of <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">type alias</a>, it can be worked around. Change both definition <code>type Reporter interface {...}</code> to <code>type Reporter = interface {...}</code>. And it will compile now.</p>\n"}], "owner": {"reputation": 127, "user_id": 4011134, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/bFTz5.png?s=128&g=1", "display_name": "mxinden", "link": "https://stackoverflow.com/users/4011134/mxinden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 0, "accepted_answer_id": 48476194, "answer_count": 2, "score": 0, "last_activity_date": 1517060284, "creation_date": 1517053970, "last_edit_date": 1517057734, "question_id": 48475511, "link": "https://stackoverflow.com/questions/48475511/nested-interfaces-x-does-not-implement-y-wrong-type-for-z-method", "title": "Nested interfaces: X does not implement Y (Wrong type for Z method)", "body": "<p>In one package I have an interface <code>Repository</code> that has a method <code>GetReporter</code> that returns an interface <code>Reporter</code>. This is used by a function <code>Execute</code> that takes a <code>Repository</code> and gets its <code>Reporter</code> via the <code>GetReporter</code> function.</p>\n\n<p>In another package I have a struct <code>GithubRepository</code> that has a method <code>GetReporter</code> that returns a <code>GithubReporter</code>.</p>\n\n<p>In a third package I want to call the <code>Execute</code> function out of package #1 with a <code>GithubRepository</code> instance.</p>\n\n<p>I am trying to have package 1 and 2 independent of each other, without one importing something from the other. The 3rd package should combine the first two.</p>\n\n<p>Golang returns:</p>\n\n<pre><code>cannot use githubRepository (type GithubRepository) as type Repository in argument to Execute:\n    GithubRepository does not implement Repository (wrong type for GetReporter method)\n        have GetReporter(string) GithubReporter\n        want GetReporter(string) Reporter\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\n// Package #1\n\ntype Repository interface {\n  GetReporter(string) Reporter\n}\n\ntype Reporter interface {\n  ChangeStatus(string) error\n}\n\nfunc Execute(r Repository) {\n  // Do something with the repository\n}\n\n// Package #2\n\ntype GithubRepository struct {\n}\n\ntype GithubReporter struct {\n}\n\nfunc (repo *GithubRepository) GetReporter(sha string) GithubReporter {\n return GithubReporter{}\n}\n\nfunc (reporter *GithubReporter) ChangeStatus(status string) error {\n  // Change the status\n  return nil\n}\n\n// Package #3\n\nfunc main() {\n  githubRepository := GithubRepository{}\n  Execute(githubRepository)\n}\n</code></pre>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/ph0sZnyAC5I\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ph0sZnyAC5I</a></p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 11, "user_id": 9261336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eacc30670774e91750042c59cf6115c4?s=128&d=identicon&r=PG&f=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/9261336/mat"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517082942, "post_id": 48475211, "comment_id": 83952825, "body": "Ok, I&#39;ve fixed my example, should be much better now to show my problem (which was fixed)"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9261336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eacc30670774e91750042c59cf6115c4?s=128&d=identicon&r=PG&f=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/9261336/mat"}, "edited": false, "score": 0, "creation_date": 1517054422, "post_id": 48475280, "comment_id": 83944337, "body": "Thank you! An interface! To be honest I tried it in the beginning but I thought it will be too complicated later to maintain, but it&#39;s so easy :/ Ok, lesson learned."}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 0, "last_activity_date": 1517329134, "last_edit_date": 1517329134, "creation_date": 1517052238, "answer_id": 48475280, "question_id": 48475211, "link": "https://stackoverflow.com/questions/48475211/cant-interate-over-struct-with-methods/48475280#48475280", "title": "Can&#39;t interate over struct with methods?", "body": "<p>First of all, what you have done has created a new array with field <code>fielda</code> and <code>fieldb</code>. Its has nothing to do with your structure <code>A</code> and <code>B</code>. So basically you can't call method <code>someMethod()</code>.</p>\n\n<pre><code>structPool = []struct {\n    fielda string\n    fieldb string\n}{}\n</code></pre>\n\n<p>You need to implement interface to operate on these struct.</p>\n\n<p>Define a interface like</p>\n\n<pre><code>type Common interface {\n    someMethod() string\n}\n</code></pre>\n\n<p>And your structure <code>A</code> and <code>B</code> both has implemented this interface. </p>\n\n<p>Now make array of this interface with your data of <code>A</code> and <code>B</code>.</p>\n\n<pre><code>structPool := []Common{\n        A{\"x\", \"y\"},\n        B{\"x\", \"y\"},\n}\n</code></pre>\n\n<p>Iterate over this array <code>structObj.someMethod()</code></p>\n\n<p>Hope this will help.</p>\n\n<p>See in action if necessary: <kbd><a href=\"https://play.golang.org/p/Z19GjIC6VHJ\" rel=\"nofollow noreferrer\">playground</a></kbd> </p>\n\n<p>Another example: <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">https://gobyexample.com/interfaces</a></p>\n\n<p>Other reference: <a href=\"http://www.golangbootcamp.com/book/interfaces\" rel=\"nofollow noreferrer\">http://www.golangbootcamp.com/book/interfaces</a></p>\n"}], "owner": {"reputation": 11, "user_id": 9261336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eacc30670774e91750042c59cf6115c4?s=128&d=identicon&r=PG&f=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/9261336/mat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1517329134, "creation_date": 1517051807, "last_edit_date": 1517082820, "question_id": 48475211, "link": "https://stackoverflow.com/questions/48475211/cant-interate-over-struct-with-methods", "title": "Can&#39;t interate over struct with methods?", "body": "<p>My problem is, I have the specified app:</p>\n\n<pre><code>myapp\n     |- app/main.go\n     |- data/a.go\n     |- data/b.go\n</code></pre>\n\n<p>In a.go I have struct with methods</p>\n\n<pre><code>package data \n\ntype A struct {\n    Field_a string\n    Field_b string\n}\n\nfunc (a A) SomeMethod() string {\n    return \"somemethod A\"\n}\n</code></pre>\n\n<p>In b.go similar:</p>\n\n<pre><code>package data\n\ntype B struct {\n    Field_a string\n    Field_b string\n}\n\nfunc (b B) SomeMethod() string {\n    return \"somemethod B\"\n}\n</code></pre>\n\n<p>Now I'm refering in main.go in such manner:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"myapp/data\"\n)\n\nfunc main() {\n    a := data.A{\"x\",\"y\"} // it works\n    b := data.B{\"x\",\"y\"} // works as well\n    c := data.A{\"x\",\"y\"}.SomeMethod() // works\n    d := data.B{\"x\",\"y\"}.SomeMethod() // works too\n    fmt.Printf(\"a: %T\\n\",a)\n    fmt.Printf(\"b: %T\\n\",b)\n    fmt.Printf(\"c: %T\\n\",c)\n    fmt.Printf(\"d: %T\\n\",d)\n}\n</code></pre>\n\n<p>But the problem which I have is that I want to iterate over these structs from package data and I've tried the following approach:</p>\n\n<pre><code>structPool := []struct{\n   fielda string\n   fieldb string\n}{\n   data.A{\"x\",\"y\"}, // data.A{\"x\",\"y\"}.SometMethod() is valid at this point\n   data.B{\"x\",\"y\"}, // data.B{\"x\",\"y\"}.SometMethod() is valid at this point\n}\n\nfor _, structObj := range structPool {\n    // can't use here structObj.SomeMethod() - why?\n} \n</code></pre>\n\n<p>And I also tried to inititialize this slice <code>structPool</code> like this:\n<code>[]interface{}</code> or <code>[]struct{}</code> etc but still compiler does not see methods from these packages inside <code>for</code> loop. :(</p>\n\n<p>I will be highly appreciated for any clues. \nThank in advance</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 715, "user_id": 9172232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65ed8ca4bd2c3adec049105413913bd4?s=128&d=identicon&r=PG&f=1", "display_name": "the4thamigo_uk", "link": "https://stackoverflow.com/users/9172232/the4thamigo-uk"}, "edited": false, "score": 0, "creation_date": 1517059690, "post_id": 48472500, "comment_id": 83945690, "body": "Could this help <a href=\"https://stackoverflow.com/questions/16747021/how-do-you-statically-link-a-c-library-in-go-using-cgo\" title=\"how do you statically link a c library in go using cgo\">stackoverflow.com/questions/16747021/&hellip;</a>"}, {"owner": {"reputation": 1915, "user_id": 1902896, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0839a5f542caa87bf9283ea25997006a?s=128&d=identicon&r=PG", "display_name": "wheeler", "link": "https://stackoverflow.com/users/1902896/wheeler"}, "reply_to_user": {"reputation": 715, "user_id": 9172232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65ed8ca4bd2c3adec049105413913bd4?s=128&d=identicon&r=PG&f=1", "display_name": "the4thamigo_uk", "link": "https://stackoverflow.com/users/9172232/the4thamigo-uk"}, "edited": false, "score": 0, "creation_date": 1517078632, "post_id": 48472500, "comment_id": 83951526, "body": "@the4thamigo_uk Hmm, that was interesting, but their suggestion to turn off CGO won&#39;t work in my case, since I am cross-compiling. See my question for an update, I think I might have found out why it wasn&#39;t compiling, but I&#39;m not exactly sure."}], "owner": {"reputation": 1915, "user_id": 1902896, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0839a5f542caa87bf9283ea25997006a?s=128&d=identicon&r=PG", "display_name": "wheeler", "link": "https://stackoverflow.com/users/1902896/wheeler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2034, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1517078572, "creation_date": 1517026063, "last_edit_date": 1517078572, "question_id": 48472500, "link": "https://stackoverflow.com/questions/48472500/cgo-linking-error-undefined-reference-to-memoryfreelibrary", "title": "CGO linking error: undefined reference to `MemoryFreeLibrary&#39;", "body": "<p>I am trying to wrap around a C library with Go. The library is built with CMake and produces a static library file. I added the <code>#cgo</code> stuff at the beginning of the <code>.go</code> file with the proper <code>CFLAGS</code> and <code>LDFLAGS</code>, however, I keep getting <code>undefined reference</code> errors when running <code>go build memorymodule.go</code>. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -IMemoryModule\n#cgo LDFLAGS: MemoryModule/build/MemoryModule.a\n#include \"MemoryModule/MemoryModule.h\"\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"unsafe\"\n)\n\nconst SIZE int = 1024\n\nfunc end(msg string) {\n    fmt.Println(msg)\n    os.Exit(1)\n}\n\nfunc check(err error, msg string) {\n    if err != nil {\n        end(msg)\n    }\n}\n\nfunc main() {\n\n    bin, err := ioutil.ReadFile(os.Args[0])\n    check(err, \"error reading file\")\n\n    // Convert the args passed to this program into a C array of C strings\n    var cArgs []*C.char\n    for _, goString := range os.Args {\n        cArgs = append(cArgs, C.CString(goString))\n    }\n\n    // Load the reconstructed binary from memory\n    handle := C.MemoryLoadLibraryEx(\n        unsafe.Pointer(&amp;bin[0]),                // void *data\n        (C.size_t)(len(bin)),                   // size_t\n        (*[0]byte)(C.MemoryDefaultAlloc),          // Alloc func ptr\n        (*[0]byte)(C.MemoryDefaultFree),           // Free func ptr\n        (*[0]byte)(C.MemoryDefaultLoadLibrary),    // loadLibrary func ptr\n        (*[0]byte)(C.MemoryDefaultGetProcAddress), // getProcAddress func ptr\n        (*[0]byte)(C.MemoryDefaultFreeLibrary),    // freeLibrary func ptr\n        unsafe.Pointer(&amp;cArgs[0]),                 // void *userdata\n    )\n\n    // Execute binary\n    C.MemoryCallEntryPoint(handle)\n\n    // Cleanup\n    C.MemoryFreeLibrary(handle)\n\n}\n</code></pre>\n\n<p>Here is the results from the <code>go build ...</code> with <code>-x</code> to help with debugging:</p>\n\n<pre><code>cd /home/wlaw/go-memory-module\ni686-w64-mingw32-gcc -I . -m32 -mthreads -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -o $WORK/command-line-arguments/_obj/_cgo_.o $WORK/command-line-arguments/_obj/_cgo_main.o $WORK/command-line-arguments/_obj/_cgo_export.o $WORK/command-line-arguments/_obj/memorymodule.cgo2.o -g -O2 MemoryModule/build/MemoryModule.a\n# command-line-arguments\n/tmp/go-build590803163/command-line-arguments/_obj/_cgo_main.o:_cgo_main.c:(.data+0x0): undefined reference to `MemoryDefaultLoadLibrary'\n/tmp/go-build590803163/command-line-arguments/_obj/_cgo_main.o:_cgo_main.c:(.data+0x4): undefined reference to `MemoryDefaultGetProcAddress'\n/tmp/go-build590803163/command-line-arguments/_obj/_cgo_main.o:_cgo_main.c:(.data+0x8): undefined reference to `MemoryDefaultFreeLibrary'\n/tmp/go-build590803163/command-line-arguments/_obj/_cgo_main.o:_cgo_main.c:(.data+0xc): undefined reference to `MemoryDefaultFree'\n/tmp/go-build590803163/command-line-arguments/_obj/_cgo_main.o:_cgo_main.c:(.data+0x10): undefined reference to `MemoryDefaultAlloc'\n/tmp/go-build590803163/command-line-arguments/_obj/memorymodule.cgo2.o: In function `cgo_50ced23471ff_Cfunc_MemoryCallEntryPoint':\n/tmp/go-build/command-line-arguments/_obj/cgo-gcc-prolog:40: undefined reference to `MemoryCallEntryPoint'\n/tmp/go-build590803163/command-line-arguments/_obj/memorymodule.cgo2.o: In function `cgo_50ced23471ff_Cfunc_MemoryLoadLibraryEx':\n/tmp/go-build/command-line-arguments/_obj/cgo-gcc-prolog:76: undefined reference to `MemoryLoadLibraryEx'\n/tmp/go-build590803163/command-line-arguments/_obj/memorymodule.cgo2.o: In function `cgo_50ced23471ff_Cfunc_MemoryFreeLibrary':\n/tmp/go-build/command-line-arguments/_obj/cgo-gcc-prolog:54: undefined reference to `MemoryFreeLibrary'\ncollect2: error: ld returned 1 exit status\nMakefile:9: recipe for target 'all' failed\nmake: *** [all] Error 2\n</code></pre>\n\n<p>Whats interesting is if I compile the MemoryModule dependency using make instead of CMake (by editing my Makefile) such that it produces an object file instead of a static library file, and modify my source code to link with that instead, I get no problems:</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -IMemoryModule\n#cgo LDFLAGS: MemoryModule/MemoryModule.o\n#include \"MemoryModule/MemoryModule.h\"\n*/\nimport \"C\"\n...\n</code></pre>\n\n<p>My Makefile for reference:</p>\n\n<pre><code>ifneq (\"$(shell which i686-w64-mingw32-gcc)\",\"\")\ncompiler = i686-w64-mingw32-gcc\nelse\ncompiler = i586-mingw32msvc-gcc\nendif\n\n# Build the dependencies first (subdirs), then move onto the meat and potatoes.\nall: MemoryModule\n    CC=$(compiler) CGO_ENABLED=1 GOOS=windows GOARCH=386 go build -x memorymodule.go\n\n# Dependency build. \nSUBDIRS = MemoryModule\nsubdirs: $(SUBDIRS)\n$(SUBDIRS):\n    $(MAKE) -C $@\n# Override default subdir build behavior (make) with cmake. \nMemoryModule:\n    [ \"`ls -A MemoryModule`\" ] || git submodule update --init\n    # $(MAKE) -C $@\n    cmake -HMemoryModule -BMemoryModule/build\n    cmake --build MemoryModule/build --target MemoryModule\n\n# Clean targed. \nCLEANDIRS = $(SUBDIRS:%=clean-%)\nclean: $(CLEANDIRS)\n    rm -f memorymodule.exe\n$(CLEANDIRS): \n    $(MAKE) -C $(@:clean-%=%) clean\n\ntest:\n    $(MAKE) -C tests test\n\n.PHONY: subdirs $(INSTALLDIRS) $(SUBDIRS) clean test\n</code></pre>\n\n<p>Any help would be appreciated!</p>\n\n<p>Git project here: <a href=\"https://github.com/wheelerlaw/go-memory-module\" rel=\"nofollow noreferrer\">https://github.com/wheelerlaw/go-memory-module</a></p>\n\n<p><strong>Update:</strong></p>\n\n<p>Okay, so I stumbled across <a href=\"https://stackoverflow.com/questions/36915134/go-golang-cross-compile-from-mac-to-windows-fatal-error-windows-h-file-not-f\">this</a> SO question. So if I change my <code>go build</code> command to:</p>\n\n<pre><code>GOOS=\"windows\" GOARCH=\"amd64\" CGO_ENABLED=\"1\" CC=\"x86_64-w64-mingw32-gcc\" go build -x\n</code></pre>\n\n<p>from:</p>\n\n<pre><code>GOOS=\"windows\" GOARCH=\"386\" CGO_ENABLED=\"1\" CC=\"i686-w64-mingw32-gcc\" go build -x\n</code></pre>\n\n<p>... it works. So it looks like an incompatibility between the different archs. I'm going to download a 32 bit version of Go to see if that helps. </p>\n\n<p>But what I don't understand is that the program compiles just fine even with the mis-matched archs when I compile C library into an object instead of a static library. Any ideas?</p>\n"}, {"tags": ["javascript", "go", "cookies"], "answers": [{"comments": [{"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1517250765, "post_id": 48471958, "comment_id": 84010100, "body": "So the no origin error is now gone, but the <code>println</code> for <code>r.Cookies</code> returns a empty array. I am not exactly sure why does it do that. Since I expect that if the domain name and path name matches, the cookies should be auto attached."}, {"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1517250794, "post_id": 48471958, "comment_id": 84010120, "body": "Here is my request <code>&amp;{GET &#47;test_receive_cookie HTTP&#47;1.1 1 1 map[Accept:[*&#47;*] Accept-Encoding:[gzip, deflate, br] Accept-Language:[en-US,en;q=0.9] Here is my request. User-Agent:[Mozilla&#47;5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;63.0.3239.132 Safari&#47;537.36] Connection:[keep-alive] Pragma:[no-cache] Cache-Control:[no-cache] Origin:[null]] {} &lt;nil&gt; 0 [] false localhost:8012 map[] map[] &lt;nil&gt; map[] [::1]:61817 &#47;test_receive_cookie &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc420014600}</code>"}], "tags": [], "owner": {"reputation": 2992, "user_id": 5269570, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/c8WUz.png?s=128&g=1", "display_name": "Sam Denty", "link": "https://stackoverflow.com/users/5269570/sam-denty"}, "is_accepted": true, "score": 4, "last_activity_date": 1517019345, "creation_date": 1517019345, "answer_id": 48471958, "question_id": 48471627, "link": "https://stackoverflow.com/questions/48471627/golang-no-access-control-allow-origin-header-is-present-on-the-requested-resou/48471958#48471958", "title": "Golang No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;null&#39; is therefore not allowed access", "body": "<p>You need your Go server to send the <code>Access-Control-Allow-Origin</code> headers, the client can't provide them (see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\" rel=\"nofollow noreferrer\">CORS</a>).</p>\n\n<p>If you update your server to add this header, the client will stop throwing an error.</p>\n\n<h2>Example</h2>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\nw.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n</code></pre>\n\n<h3>Reference:</h3>\n\n<p><a href=\"https://stackoverflow.com/questions/39507065/enable-cors-in-golang\">Enable CORS in Golang</a></p>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7967, "favorite_count": 1, "accepted_answer_id": 48471958, "answer_count": 1, "score": 3, "last_activity_date": 1613841989, "creation_date": 1517015430, "question_id": 48471627, "link": "https://stackoverflow.com/questions/48471627/golang-no-access-control-allow-origin-header-is-present-on-the-requested-resou", "title": "Golang No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;null&#39; is therefore not allowed access", "body": "<p>I am trying to test if I am in domain A, can domain A client send domain B cookie to domain B.</p>\n\n<p>Here is my golang code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    \"time\"\n    \"encoding/json\"\n)\n\nfunc setCookie(w http.ResponseWriter, r *http.Request) {\n    expiration := time.Now().Add(365 * 24 * time.Hour)\n    cookie := http.Cookie{Path: \"/test_receive_cookie\", Name: \"test_cors\", Value: \"test_cors\", Expires: expiration}\n    http.SetCookie(w, &amp;cookie)\n    fmt.Fprintf(w, \"Success\")\n}\n\nfunc receiveCookie(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(r.Cookies())\n\n    data := make(map[string]interface{})\n    for _, cookie := range r.Cookies() {\n        data[cookie.Name] = cookie.Value\n    }\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(data)\n}\n\nfunc main() {\n    http.HandleFunc(\"/set_cookie\", setCookie)\n    http.HandleFunc(\"/test_receive_cookie\", receiveCookie)\n    err := http.ListenAndServe(\":8012\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>I first hit <code>http://localhost:8012/set_cookie</code> , then I open a html file containing a javascript using this <a href=\"https://github.com/naugtur/xhr\" rel=\"nofollow noreferrer\">library</a></p>\n\n<pre><code>        this._xhr.get(\n            \"http://localhost:8012/test_receive_cookie\", \n            { headers: { \"Access-Control-Allow-Origin\": \"*\" }},\n            function(err, resp) {\n                console.log(resp);\n                console.log(err);\n            });\n</code></pre>\n\n<p>The following happened</p>\n\n<ol>\n<li>Browser returns</li>\n</ol>\n\n<p><code>Failed to load http://localhost:8012/test_receive_cookie: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access.</code></p>\n\n<ol start=\"2\">\n<li><p>My server print <code>[]</code> from <code>fmt.Println(r.Cookies())</code></p></li>\n<li><p>If I hit <code>http://localhost:8012/test_receive_cookie</code> I can see the cookie I set gets print out on browser, but when I open a html that calls the endpoint the server will have empty cookie</p></li>\n</ol>\n\n<p>My questions is how can I pass the cookie back to <code>http://localhost:8012/test_receive_cookie</code> using client code?</p>\n\n<p>Am I missing some configuration code?</p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 4391725, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5973ef6eb84598f93cf8e6f3af9dc82f?s=128&d=identicon&r=PG&f=1", "display_name": "jmvbxx", "link": "https://stackoverflow.com/users/4391725/jmvbxx"}, "edited": false, "score": 0, "creation_date": 1526171966, "post_id": 48472934, "comment_id": 87639841, "body": "This is great answer for bind mounts, which does answer the original question. But what to about a normal volume such as <code>-v data:&#47;var&#47;www&#47;html</code>?"}, {"owner": {"reputation": 436, "user_id": 6727740, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lKIM5ESjTc8/AAAAAAAAAAI/AAAAAAAAABE/8SQ8wvNVzAQ/photo.jpg?sz=128", "display_name": "Tom Mertz", "link": "https://stackoverflow.com/users/6727740/tom-mertz"}, "edited": false, "score": 3, "creation_date": 1527723024, "post_id": 48472934, "comment_id": 88239109, "body": "I was able to mount a docker volume in by creating it first with <code>VolumeCreate</code> and then using the name of my volume in the mount array like @aerokite suggests: <code>myMount := mount.Mount{Type: volume.TypeVolume Source: myVolume.Name Target: &quot;&#47;var&#47;lib&#47;postgresql&#47;data&quot;}</code>"}, {"owner": {"reputation": 319, "user_id": 5629940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zwa3H.jpg?s=128&g=1", "display_name": "Eysi", "link": "https://stackoverflow.com/users/5629940/eysi"}, "reply_to_user": {"reputation": 436, "user_id": 6727740, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lKIM5ESjTc8/AAAAAAAAAAI/AAAAAAAAABE/8SQ8wvNVzAQ/photo.jpg?sz=128", "display_name": "Tom Mertz", "link": "https://stackoverflow.com/users/6727740/tom-mertz"}, "edited": false, "score": 0, "creation_date": 1540373949, "post_id": 48472934, "comment_id": 92837801, "body": "@TomMertz, saved my day. Note that it should be <code>Type: mount.TypeVolume</code> and not <code>Type: volume.TypeVolume</code>."}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 21, "last_activity_date": 1517031810, "last_edit_date": 1517031810, "creation_date": 1517031241, "answer_id": 48472934, "question_id": 48470194, "link": "https://stackoverflow.com/questions/48470194/defining-a-mount-point-for-volumes-in-golang-docker-sdk/48472934#48472934", "title": "Defining a mount point for volumes in GoLang Docker SDK", "body": "<p>If you want to use bind mounts, you need to provide your mount information in <strong>HostConfig</strong>.</p>\n\n<pre><code>res, err := client.ContainerCreate(\n    ctx,\n    &amp;container.Config{\n        Image: \"nginx\",\n        Cmd:   []string{\"ls\", \"/\"},\n    },\n    &amp;container.HostConfig{\n        Mounts: []mount.Mount{\n            {\n                Type:   mount.TypeBind,\n                Source: \"/localPath\",\n                Target: \"/pathInDocker\",\n            },\n        },\n    },\n    nil,\n    \"\",\n)\n</code></pre>\n\n<p>And if you want to use volume, 1st you need to create a volume with mount path, then you need to use this volume name as Source. </p>\n"}], "owner": {"reputation": 186, "user_id": 469864, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d00a72c0fd9086c3eb9eff2dbdddf066?s=128&d=identicon&r=PG", "display_name": "Dragonman117", "link": "https://stackoverflow.com/users/469864/dragonman117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4380, "favorite_count": 0, "accepted_answer_id": 48472934, "answer_count": 1, "score": 7, "last_activity_date": 1517031810, "creation_date": 1517004016, "last_edit_date": 1517027930, "question_id": 48470194, "link": "https://stackoverflow.com/questions/48470194/defining-a-mount-point-for-volumes-in-golang-docker-sdk", "title": "Defining a mount point for volumes in GoLang Docker SDK", "body": "<p>I am currently trying to create a Docker container using the official GoLang Docker SDK and am trying to mount a volume from my localhost to the docker container. </p>\n\n<pre><code>vol := map[string]struct{}{\"/pathInDocker\":{}}\n\n// This was prepared using example at:\n//https://docs.docker.com/develop/sdk/examples/#run-a-container\nres, err := cli.ContainerCreate(ctx, &amp;container.Config{\n    Image: testImageName,\n    Volumes: vol,\n    Cmd: []string{\"ls\", \"/\"},\n}, nil, nil, \"\")\n</code></pre>\n\n<p>This works at creating the container and adding the \"/pathInDocker\" to the docker container, however, I cannot figure out how to add the mount point for the localhost.</p>\n\n<p>I have tried the following possible values for the vol variable</p>\n\n<pre><code>vol := map[string]struct{}{\"localPath:/pathInDocker\":{}}\nvol := map[string]struct{}{\"\\\"localPath\\\":\\\"/pathInDocker\\\"\":{}}\n</code></pre>\n\n<p>And for each of these the resulting docker container attempts to mount the map key as the folder in docker with not mount point for localhost.</p>\n\n<p>I've dug through the docs and the only line I can seem to find talking about how to configure volumes at all is this one:</p>\n\n<pre><code>Volumes         map[string]struct{} // List of volumes (mounts) used for the container\n</code></pre>\n\n<p>So my question is how to configure this so it mounts a local folder to the volume?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113, "user_id": 3187712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tndIB.jpg?s=128&g=1", "display_name": "jcmturner", "link": "https://stackoverflow.com/users/3187712/jcmturner"}, "edited": false, "score": 0, "creation_date": 1516999812, "post_id": 48469272, "comment_id": 83932371, "body": "Just to add the behaviour is the same with int64 to uint64 and int to uint"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517051012, "post_id": 48469272, "comment_id": 83943543, "body": "The most technically correct reason is because Go doesn&#39;t support type casting at all.  The real question you mean to ask is probably &quot;Why can&#39;t I convert an int32 to a uint32?&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1517023036, "post_id": 48469327, "comment_id": 83938365, "body": "However just to add you can cast it if your value is a positive number, see <a href=\"https://play.golang.org/p/ZlUYXCWYx0r\" rel=\"nofollow noreferrer\">play.golang.org/p/ZlUYXCWYx0r</a> - as long as it can be represented accurately that&#39;s fine."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1517023249, "last_edit_date": 1517023249, "creation_date": 1516999842, "answer_id": 48469327, "question_id": 48469272, "link": "https://stackoverflow.com/questions/48469272/whats-the-reason-int32-const-cannot-be-cast-to-uint32-when-variables-can/48469327#48469327", "title": "What&#39;s the reason int32 const cannot be cast to uint32 when variables can?", "body": "<p>The expression <code>uint32(ci)</code> is a constant expression. The <a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">spec says this about constant expressions</a>:</p>\n\n<blockquote>\n  <p>The values of typed constants must always be accurately representable as values of the constant type.</p>\n</blockquote>\n\n<p>A <code>uint32</code> cannot accurately represent the negative value <code>ci</code>, therefore this expression results in a compilation error.</p>\n\n<p>Positive values in range are supported. For example, <code>uint32(-ci)</code> compiles with no error.</p>\n\n<p>The expressions <code>uint32(vi)</code> and  <code>uint32(vc)</code> are <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversions</a>.  Conversions betweeen numeric types are allowed, even when there's loss of accuracy.</p>\n"}], "owner": {"reputation": 113, "user_id": 3187712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tndIB.jpg?s=128&g=1", "display_name": "jcmturner", "link": "https://stackoverflow.com/users/3187712/jcmturner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "closed_date": 1517038909, "accepted_answer_id": 48469327, "answer_count": 1, "score": 2, "last_activity_date": 1517050980, "creation_date": 1516999539, "last_edit_date": 1517050980, "question_id": 48469272, "link": "https://stackoverflow.com/questions/48469272/whats-the-reason-int32-const-cannot-be-cast-to-uint32-when-variables-can", "closed_reason": "Duplicate", "title": "What&#39;s the reason int32 const cannot be cast to uint32 when variables can?", "body": "<p>I've found that you can cast a variable int32 to uint32 but you cannot cast a const int32 to uint32.</p>\n\n<p>See here: <a href=\"https://play.golang.org/p/tDm6B6g5P6u\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tDm6B6g5P6u</a></p>\n\n<p>If line 14 is commented out it works.</p>\n\n<p>Does anyone have an explanation for this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "cookies"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 4, "creation_date": 1516997776, "post_id": 48468811, "comment_id": 83931513, "body": "You should write headers (cookies included) before writing to body."}], "answers": [{"comments": [{"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 1, "creation_date": 1517001763, "post_id": 48468934, "comment_id": 83933230, "body": "ah, I didn&#39;t realize that <code>Fprintf</code> actually send the data, I thought it just write to it and implicit send after the function ends"}], "tags": [], "owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "is_accepted": true, "score": 3, "last_activity_date": 1516997821, "creation_date": 1516997821, "answer_id": 48468934, "question_id": 48468811, "link": "https://stackoverflow.com/questions/48468811/cannot-see-cookie-in-chrome-inspect-application-cookie-after-setting-cookie-in-g/48468934#48468934", "title": "Cannot see cookie in chrome inspect application cookie after setting cookie in golang server", "body": "<pre><code>func sayhelloName(w http.ResponseWriter, r *http.Request) {\n\n   expiration := time.Now().Add(365 * 24 * time.Hour)\n   cookie := http.Cookie{Name: \"username\", Value: \"astaxie\", Expires: expiration}\n   http.SetCookie(w, &amp;cookie)\n   cookie = http.Cookie{Name: \"username2\", Value: \"astaxie\", Expires: expiration}\n   http.SetCookie(w, &amp;cookie)\n   fmt.Fprintf(w, \"Hello name!\") // send data to client side\n}\n</code></pre>\n\n<p>you should send data to client only after setting the cookie</p>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 48468934, "answer_count": 1, "score": 2, "last_activity_date": 1517001801, "creation_date": 1516997310, "last_edit_date": 1517001801, "question_id": 48468811, "link": "https://stackoverflow.com/questions/48468811/cannot-see-cookie-in-chrome-inspect-application-cookie-after-setting-cookie-in-g", "title": "Cannot see cookie in chrome inspect application cookie after setting cookie in golang server", "body": "<p>Here is a simplify version of my golang server.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    \"time\"\n)\n\nfunc sayhelloName(w http.ResponseWriter, r *http.Request) {\n\n    fmt.Fprintf(w, \"Hello name!\") // send data to client side\n    expiration := time.Now().Add(365 * 24 * time.Hour)\n    cookie := http.Cookie{Name: \"username\", Value: \"myusernmae\", Expires: expiration}\n    http.SetCookie(w, &amp;cookie)\n    cookie = http.Cookie{Name: \"username2\", Value: \"myusernmae\", Expires: expiration}\n    http.SetCookie(w, &amp;cookie)\n\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayhelloName) // set router\n    err := http.ListenAndServe(\":9090\", nil) // set listen port\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>I am trying to set a cookie to the client. But after hitting <code>http://localhost:9090/</code> I don't see the cookie <code>name: username</code> I set.</p>\n\n<p>Am I doing the cookie setting correct?</p>\n"}, {"tags": ["session", "go", "networking", "ssh", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516996500, "post_id": 48468318, "comment_id": 83930861, "body": "What do you mean <code>--More--</code> isn&#39;t printed. How does the user know to input something? As an aside, does this device not have some method to script commands, or at least turn off interactive input?"}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516996858, "post_id": 48468318, "comment_id": 83931061, "body": "@JimB The <code>--More--</code> prompt is not found in the <code>Stdout</code> and is not printed to the screen. Once you press enter or space enough times to view the entire output of a command, the prompt is just gone."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516997769, "post_id": 48468318, "comment_id": 83931507, "body": "@JimB I added a gif of the prompt."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1517004747, "post_id": 48468318, "comment_id": 83934473, "body": "The program probably directs its output through the command <code>more</code>. Does it really wait for input when you are not running the program on the consol?"}, {"owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "edited": false, "score": 0, "creation_date": 1519176574, "post_id": 48468318, "comment_id": 84799364, "body": "You should be able to hack the TTY settings in the <a href=\"https://sourcegraph.com/-/godoc/refs?def=Session%2FRequestPty&amp;pkg=golang.org%2Fx%2Fcrypto%2Fssh&amp;repo=golang.org%2Fx%2Fcrypto\" rel=\"nofollow noreferrer\">RequestPty</a> method to turn off ECHO (#1) and request a bigger terminal size to prevent the need for entering <code>q</code> (#2). That being said, SNMP is probably better suited for what you need to do, give it another look."}], "answers": [{"tags": [], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "is_accepted": true, "score": 0, "last_activity_date": 1521140458, "creation_date": 1521140458, "answer_id": 49307333, "question_id": 48468318, "link": "https://stackoverflow.com/questions/48468318/golang-filtering-stdout-of-active-ssh-session/49307333#49307333", "title": "Golang - Filtering Stdout of Active SSH Session", "body": "<p>I fixed this problem by sending the command <code>terminal length 0</code> just after connecting to the switch, before sending the rest of the commands. This disabled the <code>\u2014More\u2014</code> prompt by setting the switch\u2019s terminal height to 0, allowing the whole output of a command to be displayed. </p>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 985, "favorite_count": 2, "accepted_answer_id": 49307333, "answer_count": 1, "score": 4, "last_activity_date": 1521140458, "creation_date": 1516995166, "last_edit_date": 1516997750, "question_id": 48468318, "link": "https://stackoverflow.com/questions/48468318/golang-filtering-stdout-of-active-ssh-session", "title": "Golang - Filtering Stdout of Active SSH Session", "body": "<p>I'm writing an SSH client in Go that connects to a switch and runs a list of configuration commands. So far, I am able to successfully connect to a switch, run the desired commands, and print the output of the session. The problem comes when the switch is expecting a <code>\\n</code>, space, or \"q\" to be entered when a command's output is too long. For example:</p>\n\n<pre><code>switch#show int status\n\nPort      Name               Status       Vlan       Duplex  Speed Type\nGi1/0/1                      notconnect   100          auto   auto 10/100/1000BaseTX\nGi1/0/2                      connected    915        a-full  a-100 10/100/1000BaseTX\nGi1/0/3                      notconnect   100          auto   auto 10/100/1000BaseTX\nGi1/0/4                      notconnect   100          auto   auto 10/100/1000BaseTX\nGi1/0/5                      notconnect   230          auto   auto 10/100/1000BaseTX\n...\nPo1       sw-sww-100-sww-0-0 connected    trunk      a-full    10G\n --More-- # Program hangs here; expecting a new line, space, or 'q'\n</code></pre>\n\n<p>The <code>--More--</code> prompt is not actually printed to the screen, so simply checking if the current line of <code>Stdout</code> contains <code>--More--</code> and sending a <code>\\n</code>, space, or \"q\" does not work.</p>\n\n<p><a href=\"https://i.stack.imgur.com/APuLa.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/APuLa.gif\" alt=\"Gif of &lt;code&gt;--More--&lt;/code&gt; prompt disappearing.\"></a></p>\n\n<p>In addition to fixing this problem, I'd like to filter <code>Stdout</code> of the session so that the only thing printed is the output of each command. In other words, I don't want the switch's prompt to be printed to the terminal. </p>\n\n<p>To sum up:</p>\n\n<ol>\n<li>How to capture and print <em>only</em> the output of each command?</li>\n<li>How to send a new line, space, or letter \"q\" when prompted?</li>\n</ol>\n\n<p>Any help is appreciated. Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"golang.org/x/crypto/ssh\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"time\"\n)\n\ntype Device struct {\n    Config  *ssh.ClientConfig\n    Client  *ssh.Client\n    Session *ssh.Session\n    Stdin   io.WriteCloser\n    Stdout  io.Reader\n    Stderr  io.Reader\n}\n\nfunc (d *Device) Connect() error {\n    client, err := ssh.Dial(\"tcp\", os.Args[1]+\":22\", d.Config)\n    if err != nil {\n        return err\n    }\n    session, err := client.NewSession()\n    if err != nil {\n        return err\n    }\n    sshIn, err := session.StdinPipe()\n    if err != nil {\n        return err\n    }\n    sshOut, err := session.StdoutPipe()\n    if err != nil {\n        return err\n    }\n    sshErr, err := session.StderrPipe()\n    if err != nil {\n        return err\n    }\n    d.Client = client\n    d.Session = session\n    d.Stdin = sshIn\n    d.Stdout = sshOut\n    d.Stderr = sshErr\n    return nil\n}\n\nfunc (d *Device) SendCommand(cmd string) error {\n    if _, err := io.WriteString(d.Stdin, cmd+\"\\r\\n\"); err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc (d *Device) SendConfigSet(cmds []string) error {\n    for _, cmd := range cmds {\n        if _, err := io.WriteString(d.Stdin, cmd+\"\\r\\n\"); err != nil {\n            return err\n        }\n        time.Sleep(time.Second)\n    }\n    return nil\n}\n\nfunc (d *Device) PrintOutput() {\n    r := bufio.NewReader(d.Stdout)\n    for {\n        text, err := r.ReadString('\\n')\n        fmt.Printf(\"%s\", text)\n        if err == io.EOF {\n            break\n        }\n    }\n}\n\nfunc (d *Device) PrintErr() {\n    r := bufio.NewReader(d.Stderr)\n    for {\n        text, err := r.ReadString('\\n')\n        fmt.Printf(\"%s\", text)\n        if err == io.EOF {\n            break\n        }\n    }\n}\n\nfunc main() {\n    sshConf := ssh.Config{}\n    sshConf.Ciphers = append(sshConf.Ciphers, \"aes128-cbc\", \"3des-cbc\", \"blowfish-cbc\", \"arcfour\")\n    config := &amp;ssh.ClientConfig{\n        Config: sshConf,\n        User:   \"mwalto7\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"Lion$Tiger$Bear$\"),\n        },\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n        Timeout:         time.Second * 5,\n    }\n\n    sw := &amp;Device{Config: config}\n\n    fmt.Println(\"Connecting to \", os.Args[1])\n    if err := sw.Connect(); err != nil {\n        log.Fatal(err)\n    }\n    defer sw.Client.Close()\n    defer sw.Session.Close()\n    defer sw.Stdin.Close()\n\n    if err := sw.Session.Shell(); err != nil {\n        log.Fatal(err)\n    }\n\n    commands := []string{\"show int status\", \"exit\"}\n    if err := sw.SendConfigSet(commands); err != nil {\n        log.Fatal(err)\n    }\n\n    sw.Session.Wait()\n\n    sw.PrintOutput()\n    sw.PrintErr()\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1516995201, "post_id": 48468247, "comment_id": 83930247, "body": "Please include the relevant code in your question body instead of linking to it."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516995378, "post_id": 48468247, "comment_id": 83930333, "body": "@Adrian done! I added all the string due that I want to be sure that it&#39;s not the cause of the problem. Thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516995520, "post_id": 48468247, "comment_id": 83930401, "body": "The text isn&#39;t the same as in the regex101 link, so the match doesn&#39;t exist in the Go example. You&#39;re also using pcre there rather than Go. You also probably need a multi-line flag."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516996024, "post_id": 48468247, "comment_id": 83930638, "body": "@JimB my bad, I updated the content in regex101"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516996146, "post_id": 48468247, "comment_id": 83930694, "body": "@SrednyMCasanova: again the text isn&#39;t identical, so the match doesn&#39;t work."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516996739, "post_id": 48468247, "comment_id": 83930998, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37274282/regex-with-replace-in-golang\">Regex with replace in Golang</a>"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516998657, "post_id": 48468247, "comment_id": 83931914, "body": "@aerokite that is not the same. In the other post the problem with regex is that is replacing other texts that should not, and that is not my case"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516998758, "post_id": 48468247, "comment_id": 83931953, "body": "@SrednyMCasanova, did you check my answer?"}], "answers": [{"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 10, "last_activity_date": 1516998864, "last_edit_date": 1516998864, "creation_date": 1516995804, "answer_id": 48468476, "question_id": 48468247, "link": "https://stackoverflow.com/questions/48468247/replace-text-in-go-using-regex/48468476#48468476", "title": "Replace text in Go using regex", "body": "<p>Hope this will help you</p>\n\n<pre><code>func main() {\n    var re = regexp.MustCompile(Myregex)\n    s := re.ReplaceAllString(originalString, \"replaced\")\n    fmt.Println(s)\n}\n\nvar Myregex = `//==start==\\n.*\\n//==end==`\n</code></pre>\n\n<p>See in action: <a href=\"https://play.golang.org/p/GITAdHOOQOg\" rel=\"noreferrer\">https://play.golang.org/p/GITAdHOOQOg</a></p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7369, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1587973561, "creation_date": 1516994859, "last_edit_date": 1587973561, "question_id": 48468247, "link": "https://stackoverflow.com/questions/48468247/replace-text-in-go-using-regex", "title": "Replace text in Go using regex", "body": "<p>I am working in Go, I have a text file in which I want to replace a text based on a regex, but it's not working as expected even when I already tested the regex <a href=\"https://regex101.com/r/sx0zks/3\" rel=\"nofollow noreferrer\">here</a> and it says that there's a match.</p>\n\n<p>I made the basic example in play ground and I am getting the same result. I have 3 text files with the same label (<code>//==start== and //==end==</code>), it works for the first one, but no for the second and third. What can be avoiding the regex to replace correctly the text?</p>\n\n<p><a href=\"https://play.golang.org/p/nZdHg5IfZ89\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nZdHg5IfZ89</a></p>\n\n<p>This is the code that I used, I pasted all the string because I want to be sure that it's not the one affecting me</p>\n\n<pre><code>package main\n\nfunc main() {\n\n    var re = regexp.MustCompile(Myregex)\n    s := re.ReplaceAllLiteralString(originalString,\"replaced\")\n    fmt.Println(s)\n\n}\n\nvar Myregex = `\\/\\/==start==\\n(.+\\n)*\\/\\/==end==`\n\nvar originalString = `// @Author: someone\n// @Date:   2018-01-23T16:46:09-04:00\n// @Email:  dddddddd@gmail.com\n// @Filename: _material.themes.scss\n// @Last modified by:   Someone\n// @Last modified time: 2018-01-23T18:40:39-04:00\n\n@include angular-material-theme($theme);\n\n.app-dark {\n    @include angular-material-theme($dark-theme);\n}\n\n.app-pink {\n    @include angular-material-theme($pink-theme);\n}\n\n//==start==\n//==end==`\n</code></pre>\n"}, {"tags": ["go", "multidimensional-array"], "answers": [{"comments": [{"owner": {"reputation": 753, "user_id": 6256476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GDB8n.jpg?s=128&g=1", "display_name": "Pradam", "link": "https://stackoverflow.com/users/6256476/pradam"}, "edited": false, "score": 0, "creation_date": 1516990248, "post_id": 48467091, "comment_id": 83927724, "body": "so there is no way to declare a multi-dimensional array of different datatype without using interface..? Why like this..?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 753, "user_id": 6256476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GDB8n.jpg?s=128&g=1", "display_name": "Pradam", "link": "https://stackoverflow.com/users/6256476/pradam"}, "edited": false, "score": 0, "creation_date": 1516990369, "post_id": 48467091, "comment_id": 83927790, "body": "There&#39;s almost never a way to do mixed-type multi-dimensional arrays without using something more generic (eg: a <code>void *</code> in C) that can represent anything. python doesn&#39;t have them either as tuples are not arrays, so you really have a list of tuples, not a multi-dimensional array."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 9, "last_activity_date": 1516992194, "last_edit_date": 1592644375, "creation_date": 1516989910, "answer_id": 48467091, "question_id": 48467025, "link": "https://stackoverflow.com/questions/48467025/how-to-declare-multidimensional-array-of-two-different-datatypes/48467091#48467091", "title": "How to declare multidimensional array of two different datatypes", "body": "<p>There are two possible solutions here: actual multidimensional arrays of mixed data types (what you seem to be asking for) and arrays of structs (what you probably want).</p>\n<h3>Multidimensional arrays of mixed data-types using interfaces</h3>\n<p>If you really want to do multi-dimensional arrays of mixed types, you need to use interfaces:</p>\n<pre><code>interfaceArray := [2][2]interface{}{{1,&quot;dog&quot;},{2,&quot;cat&quot;}}\nfmt.Println(interfaceArray)\n</code></pre>\n<p>Outputs:</p>\n<blockquote>\n<p>[[1 dog] [2 cat]]</p>\n</blockquote>\n<p>Interfaces must be handled with care as they can be... anything. This means that there is no enforcement that the first argument is an int and the second is a string. I can just as easily add <code>{&quot;lion&quot;, 3}</code> and the compiler will be happy, but your program will crash if it doesn't check the type first.</p>\n<p>You can do <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"noreferrer\">type conversions and assertions</a> on interfaces to ensure the correct data types.</p>\n<h3>Arrays of structured data</h3>\n<p>Putting python tuples in a list does not make it a multi-dimensional array. The closest equivalent in Go would be an array of structs.</p>\n<pre><code>type animal struct {\n  id int\n  name string\n}\n\nanimalList := [2]animal{{1, &quot;cat&quot;}, {2, &quot;dog&quot;}}\nfmt.Println(animalList)\n</code></pre>\n<p>Outputs:</p>\n<blockquote>\n<p>[{1 cat} {2 dog}]</p>\n</blockquote>\n<p>In this case, the types are clearly defined, and I cannot store <code>{&quot;lion&quot;, 3}</code> in the array.</p>\n<p><strong>final note</strong>: <code>[size]type</code> defines an array. <code>[]type</code> defines a slice. I'm using arrays here as this is what you mention in your question, but slices would be just as (or probably more) appropriate.</p>\n"}, {"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 7, "last_activity_date": 1516990796, "creation_date": 1516990796, "answer_id": 48467287, "question_id": 48467025, "link": "https://stackoverflow.com/questions/48467025/how-to-declare-multidimensional-array-of-two-different-datatypes/48467287#48467287", "title": "How to declare multidimensional array of two different datatypes", "body": "<p>You can't create multi dimensional array with two different type. Better to use structure. Hope this will work for your purpose.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Data struct {\n    i int\n    s string\n}\n\nfunc main() {\n    data := []Data{\n        {435347,\"cat\"},\n        {435347,\"feline\"},\n        {435347,\"lion\"},\n    }\n\n    fmt.Println(data)\n}\n</code></pre>\n"}], "owner": {"reputation": 753, "user_id": 6256476, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GDB8n.jpg?s=128&g=1", "display_name": "Pradam", "link": "https://stackoverflow.com/users/6256476/pradam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3559, "favorite_count": 0, "accepted_answer_id": 48467091, "answer_count": 2, "score": 8, "last_activity_date": 1593884704, "creation_date": 1516989670, "last_edit_date": 1593884704, "question_id": 48467025, "link": "https://stackoverflow.com/questions/48467025/how-to-declare-multidimensional-array-of-two-different-datatypes", "title": "How to declare multidimensional array of two different datatypes", "body": "<p>I have List of Tuple in python as you see below:</p>\n<pre><code>data  = [\n    (435347,'cat'),  \n    (435347,'feline'),\n    (435347,'lion'),\n    (6765756,'dog'),\n    (6765756,'hound'),\n    (6765756,'puppy'),\n    (435347,'kitten'),\n    (987977,'frog')\n    ]\n</code></pre>\n<p>how can i convert data into GO equivalent, I have googled it but everywhere they have specified with the same data-type of multidimensional array like this,</p>\n<pre><code>int_list := [4][2]int{{1, 0}, {2, 0}, {3, 0}, {4, 0}}\n\nstring_list := make([][]string, 0)\n\na := [1][2]string{{&quot;lion&quot;,&quot;dog&quot;}}\n</code></pre>\n<p>help me out..!</p>\n<p>Updated:</p>\n<p>for Mixed-type Collections of Array:</p>\n<pre><code>array := []interface{}{1, &quot;dog&quot;, &quot;lion&quot;, 12, 45.09, true, false}\n</code></pre>\n"}, {"tags": ["jquery", "go", "cors", "google-cloud-endpoints", "mux"], "answers": [{"tags": [], "owner": {"reputation": 954, "user_id": 9188803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CESgG.png?s=128&g=1", "display_name": "Rodrigo C.", "link": "https://stackoverflow.com/users/9188803/rodrigo-c"}, "is_accepted": false, "score": -1, "last_activity_date": 1518104939, "creation_date": 1518104939, "answer_id": 48689487, "question_id": 48466261, "link": "https://stackoverflow.com/questions/48466261/gorilla-mux-google-cloud-endpoints-cors-issues/48689487#48689487", "title": "Gorilla Mux Google Cloud Endpoints CORS Issues", "body": "<p>You are getting a 403 error, which means your preflight request lacks the proper authentication to pass the access control check.</p>\n\n<p>In this case, the CORS configuration of the resource the requests are headed to should include an <code>Access-Control-Allow-Origin</code> header. This header should contain all the HTTP origins that are allowed to access the resource.</p>\n\n<p>Just in case, you should add one or more <code>Access-Control-Request-Header</code> headers, whose values must match the <code>ResponseHeader</code> values in the CORS configuration. All the headers in the <code>Access-Control-Request-Header</code> should be present in the <code>Access-Control-Allow-Origin</code> header in the CORS configuration so the request can be authorized.</p>\n\n<p>You can find more information about proper authentication <a href=\"https://cloud.google.com/storage/docs/configuring-cors#Troubleshooting%20CORS-Related-Problems\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 9271512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2aabea8050ed0f289eeb8e98d172fc5?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Thomas", "link": "https://stackoverflow.com/users/9271512/alex-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1518104939, "creation_date": 1516986731, "last_edit_date": 1517582295, "question_id": 48466261, "link": "https://stackoverflow.com/questions/48466261/gorilla-mux-google-cloud-endpoints-cors-issues", "title": "Gorilla Mux Google Cloud Endpoints CORS Issues", "body": "<p>I'm trying to build an API using gorilla mux and google cloud endpoints but am having trouble getting it to allow cross origin requests. I'm using the following code in my web application to send the requests:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>$.ajax(\"https://my.api/echo\", {\n    method: \"POST\",\n    headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + localStorage.id_token\n    },\n    data: JSON.stringify({\n        \"message\": this.query\n    })\n}).done(function(response) {\n    console.log(response);\n});\n</code></pre>\n\n<p>and am getting the following errors in my browser's console:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>OPTIONS https://my.api/echo 403 ()\n\nFailed to load https://my.api/echo: Response to preflight request\ndoesn't pass access control check: No 'Access-Control-Allow-Origin'\nheader is present on the requested resource. Origin \n'http://127.0.0.1:8081' is therefore not allowed access. The response\nhad HTTP status code 403.\n</code></pre>\n\n<p>The code for endpoint is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/echo\", echoHandler).Methods(\"POST\", \"OPTIONS\")\n    headers := handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\"})\n    origins := handlers.AllowedOrigins([]string{\"*\"})\n    methods := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n    http.Handle(\"/\", r)\n\n    port := 10080\n    if portStr := os.Getenv(\"PORT\"); portStr != \"\" {\n        port, _ = strconv.Atoi(portStr)\n    }\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%d\", port), handlers.CORS(headers, origins, methods)(r)))\n}\n\nfunc echoHandler(w http.ResponseWriter, r *http.Request) {\n    // echoHandler reads a JSON object from the body, and writes it back out.\n    var msg interface{}\n    if err := json.NewDecoder(r.Body).Decode(&amp;msg); err != nil {\n        if _, ok := err.(*json.SyntaxError); ok {\n            errorf(w, http.StatusBadRequest, \"Body was not valid JSON: %v\", err)\n            return\n        }\n        errorf(w, http.StatusInternalServerError, \"Could not get body: %v\", err)\n        return\n    }\n\n    b, err := json.Marshal(msg)\n    if err != nil {\n        errorf(w, http.StatusInternalServerError, \"Could not marshal JSON: %v\", err)\n        return\n    }\n    w.Write(b)\n}\n</code></pre>\n\n<p>My app.yaml is:\n</p>\n\n<pre><code># [START swagger]\nswagger: \"2.0\"\ninfo:\n  description: \"My API\"\n  title: \"My API\"\n  version: \"1.0.0\"\nhost: \"my.api\"\nx-google-endpoints:\n  - name: \"my.api\"\n    target: \"X.X.X.X\"\n    allowCors: \"true\"\n# [END swagger]\nbasePath: \"/\"\nconsumes:\n- \"application/json\"\nproduces:\n- \"application/json\"\nschemes:\n- \"https\"\npaths:\n  \"/echo\":\n    post:\n      description: \"Echo back a given message.\"\n      operationId: \"echo\"\n      produces:\n      - \"application/json\"\n      responses:\n        200:\n          description: \"Echo\"\n          schema:\n            $ref: \"#/definitions/echoMessage\"\n      parameters:\n      - description: \"Message to echo\"\n        in: body\n        name: message\n        required: true\n        schema:\n          $ref: \"#/definitions/echoMessage\"   \ndefinitions:\n  echoMessage:\n    properties:\n      message:\n        type: \"string\"\n  searchMessage:\n    properties:\n      message:\n        type: \"string\"\n</code></pre>\n"}, {"tags": ["parsing", "dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 0, "creation_date": 1579693101, "post_id": 48465690, "comment_id": 105849324, "body": "But what if the value contains &quot;=&quot; as well?"}, {"owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "reply_to_user": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 0, "creation_date": 1591082555, "post_id": 48465690, "comment_id": 109913029, "body": "@ND003 then you would require a tokenizer. Take an example from how the Go team reads a tag from a struct field in <code>reflect.StructTag.Lookup</code>."}], "tags": [], "owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "is_accepted": true, "score": 4, "last_activity_date": 1516984790, "creation_date": 1516984790, "answer_id": 48465690, "question_id": 48465575, "link": "https://stackoverflow.com/questions/48465575/easy-way-to-split-string-into-map-in-go/48465690#48465690", "title": "Easy way to split string into map in go", "body": "<p>You will need to use a couple of calls to <code>strings.Split()</code>:</p>\n\n<pre><code>s := \"k1=v1; k2=v2; k3=v3\"\n\nentries := strings.Split(s, \"; \")\n\nm := make(map[string]string)\nfor _, e := range entries {\n    parts := strings.Split(e, \"=\")\n    m[parts[0]] = parts[1]\n}\n\nfmt.Println(m)\n</code></pre>\n\n<p>The first call will separate the different entries in the supplied string while the second will split the key/values apart. A working example can be found <a href=\"https://play.golang.org/p/fPS7Fv2J5TB\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3775, "favorite_count": 0, "accepted_answer_id": 48465690, "answer_count": 1, "score": -4, "last_activity_date": 1516984790, "creation_date": 1516984391, "question_id": 48465575, "link": "https://stackoverflow.com/questions/48465575/easy-way-to-split-string-into-map-in-go", "title": "Easy way to split string into map in go", "body": "<p>I have such string:</p>\n\n<pre><code>\"k1=v1; k2=v2; k3=v3\"\n</code></pre>\n\n<p>Is there any simple way to make a <code>map[string]string</code> from it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1516982919, "post_id": 48465080, "comment_id": 83923582, "body": "<code>go test</code> requires packages, not go files, and to filter what tests you want to run, use <code>-run X</code>, where <code>X</code> is a regexp that will be matched against test names. Run <code>go help test</code> for more details; and <a href=\"https://golang.org/cmd/go/#hdr-Test_packages\" rel=\"nofollow noreferrer\">Go tool: Test packages</a>; and <a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow noreferrer\">Go tool: Description of testing flags</a>."}, {"owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1516983128, "post_id": 48465080, "comment_id": 83923700, "body": "I don&#39;t understand. Is there a simple way to run that one test  by itself. My regex should match the test output by -check.list"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1516983288, "post_id": 48465080, "comment_id": 83923798, "body": "To run that test alone, go to its folder, and type: <code>go test -run TestNew</code>. If you have other tests whose name contas the <code>TestNew</code> substring, then run <code>go test -run ^TestNew$</code>."}, {"owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1516983909, "post_id": 48465080, "comment_id": 83924180, "body": "That is how I thought it would work but it&#39;s not     go test --run ^TestNew$     testing: warning: no tests to run     PASS         go test -check.vv --run TestNew     testing: warning: no tests to run     PASS"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1516984509, "post_id": 48465080, "comment_id": 83924569, "body": "Just one dash: <code>-run</code>, and make sure you&#39;re in the package&#39;s folder, else you have to pass the package name too."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516984531, "post_id": 48465080, "comment_id": 83924586, "body": "Then there is no test called <code>TestNew</code> in your current package. What is <code>--check.list</code>? You can list all tests with <code>go test -list .</code>"}, {"owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "edited": false, "score": 0, "creation_date": 1516995831, "post_id": 48465080, "comment_id": 83930555, "body": "go test -list . only outputs Test. go test -run Test runs all tests"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517007904, "post_id": 48465080, "comment_id": 83935478, "body": "@AC. then you only have a test called <code>Test</code>, and that is running all the others. Again, what is <code>--check.list</code> from? Presumably you&#39;re using some sort of test suite package, and that has flags to filter what tests to run."}, {"owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "edited": false, "score": 0, "creation_date": 1517327399, "post_id": 48465080, "comment_id": 84045712, "body": "Sorry, this is someone else&#39;s code that got thrown at me. I see they imported . &quot;gopkg.in/check.v1&quot;; I need to look into whether this is somehow causing me issues"}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "edited": false, "score": 0, "creation_date": 1517420950, "post_id": 48465437, "comment_id": 84092707, "body": "The code base is using &quot;gopkg.in/check.v1&quot; and to run a specific test one needs to use -check.f REGEX where REGEX is the regex for the name of the suite.test"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "edited": false, "score": 2, "creation_date": 1517421059, "post_id": 48465437, "comment_id": 84092765, "body": "You can answer your own question, if you have more appropriate answer. @AC. Then it will help everyone"}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 20, "last_activity_date": 1516983910, "creation_date": 1516983910, "answer_id": 48465437, "question_id": 48465080, "link": "https://stackoverflow.com/questions/48465080/how-do-i-run-specific-golang-test-using-go-test-run/48465437#48465437", "title": "How do I run specific golang test using go test -run", "body": "<p>If you want to run a specific test, you may run as bellow</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestA(t *testing.T) {\n    assert.True(t, true)\n}\n\nfunc TestB(t *testing.T) {\n    assert.True(t, false)\n}\n</code></pre>\n\n<p>Run Test:</p>\n\n<pre><code>$ go test -run B\n--- FAIL: TestB (0.00s)\n        Error Trace:    a_test.go:13\n        Error:          Should be true\nFAIL\nexit status 1\nFAIL    test    0.004s\n$ go test -run A\nPASS\nok      test    0.003s\nshahriar@Kite ~/g/s/test&gt; \n</code></pre>\n\n<p><code>-run</code> flag</p>\n\n<pre><code>-run regexp\n        Run only those tests and examples matching the regular expression.\n        For tests the regular expression is split into smaller ones by\n        top-level '/', where each must match the corresponding part of a\n        test's identifier.\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 193539, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d2d22153d8fdaf387f0e5ca3b4e25f63?s=128&d=identicon&r=PG", "display_name": "AC.", "link": "https://stackoverflow.com/users/193539/ac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10529, "favorite_count": 2, "accepted_answer_id": 48465437, "answer_count": 1, "score": 15, "last_activity_date": 1516983910, "creation_date": 1516982750, "question_id": 48465080, "link": "https://stackoverflow.com/questions/48465080/how-do-i-run-specific-golang-test-using-go-test-run", "title": "How do I run specific golang test using go test -run", "body": "<p>What am I doing wrong here? I just want to run this one ConnectionPoolTest.TestNew and what ever I try, I get back 'no test to run'</p>\n\n<pre><code>:go test  --check.list *.go |grep Connectio\nConnectionPoolTest.TestNew\n:go test  --run ConnectionPoolTest *.go\nok      command-line-arguments  0.005s [no tests to run]\n:go test  --run ConnectionPoolTest.TestNew *.go\nok      command-line-arguments  0.005s [no tests to run]\n</code></pre>\n"}, {"tags": ["function", "go", "append", "return-value", "slice"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1516981040, "creation_date": 1516981040, "answer_id": 48464579, "question_id": 48464521, "link": "https://stackoverflow.com/questions/48464521/function-with-slice-parameter-will-not-modify-original-capacity/48464579#48464579", "title": "function with slice parameter will not modify original capacity", "body": "<p><code>editSli</code> doesn't work because you're changing the capacity of the local copy of the slice and not returning it. Basically, your function must return the new slice for the <em>exact same reason</em> that <code>append</code> must return the updated slice; because if it has to increase capacity, it may have to use a new underlying array, and therefor any old reference to the slice will be invalid.</p>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 7, "last_activity_date": 1516981064, "creation_date": 1516981064, "answer_id": 48464585, "question_id": 48464521, "link": "https://stackoverflow.com/questions/48464521/function-with-slice-parameter-will-not-modify-original-capacity/48464585#48464585", "title": "function with slice parameter will not modify original capacity", "body": "<p>You're fundamentally misunderstanding what a slice is.  A slice is a structure with 3 fields: a pointer to the underlying array, the length of the data, and the capacity of the underlying array (relative to the pointer).  When you pass a slice into a function, you're making a <em>copy</em> of that structure.  It still <em>references</em> the underlying array, so changes that you make to the actual <em>data</em> will be reflected outside the scope of the function, but changes to the slice header itself (including the length of the data) won't, because it's a <em>copy</em>.  If you need to modify the slice, rather than the underlying data, and have it reflected outside the function, <em>pass in a pointer to the slice!</em></p>\n\n<p>Recommended reading: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n"}], "owner": {"reputation": 21, "user_id": 2478760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af45200280d0273123605999ac5ba4d3?s=128&d=identicon&r=PG&f=1", "display_name": "bob", "link": "https://stackoverflow.com/users/2478760/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2010, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1581766670, "creation_date": 1516980853, "last_edit_date": 1581766670, "question_id": 48464521, "link": "https://stackoverflow.com/questions/48464521/function-with-slice-parameter-will-not-modify-original-capacity", "title": "function with slice parameter will not modify original capacity", "body": "<p>Why in go editing slice inside functions don't apply length update?</p>\n\n<blockquote>\n  <p>Fast response: because a slice is only a reference to the original array</p>\n</blockquote>\n\n<p>As you can see in the following example, I have a slice that will be modified in the values by external function but the append operation is totally ignored until you return the value from the function and re-assign this to the original slice.</p>\n\n<blockquote>\n  <p>Working to improve the examples, I've added function that pass by reference and make modification operations to increase comfort about the solutions</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n)\nvar sli = make([]int,8)\n\nfunc main() {\n\n    fmt.Println(\"START STATUS_____\")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n\n    editSli(sli)\n    fmt.Println(\"EDIT RESULT STATUS_____\")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n\n\n    sli = updateSli(sli)\n    fmt.Println(\"UPDATE RESULT STATUS_____\")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n\n    sli = append(sli, 15, 16, 17)\n    fmt.Println(\"DIRECT APPEND RESULT STATUS_____\")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n\n    sli[13] = 99\n    fmt.Println(\"DIRECT ASSIGNMENT OF LAST ELEMENT (13\u00b0) STATUS_____\")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n\n    updateSliPointer(&amp;sli)\n    fmt.Println(\"\\n*** Finally, passing the slice as a pointer will modify the sctructure: \")\n    fmt.Println(\"slice\",sli)\n    fmt.Println(\"   cap:\", cap(sli))\n    fmt.Println(\"   len:\", len(sli))\n}\n\nfunc editSli(sliOrigin []int) {\n    sliOrigin[7] = 11\n    sliOrigin = append(sliOrigin, 33, 34, 35) //don't work\n    fmt.Println(\"\\ninside the edit Slice function the sli is =\", sliOrigin)\n    fmt.Println(\"and the direct assignment of the last element (7\u00b0) ar right working.\")\n    fmt.Println(\"However, the slice append will not be applied to the original slice because this is an internal copy\")\n}\n\nfunc updateSli(sliOrigin []int) []int{\n    sliOrigin = append(sliOrigin, 12, 13, 14) //it works!\n    fmt.Println(\"\\ninside the update Slice function the sli is = \", sliOrigin)\n    fmt.Println(\"and this append will be applied to the original one becouse of the return value of this function is a new slice\")\n    return sliOrigin\n}\n\nfunc updateSliPointer(sliOrigin *[]int) {\n    //don't work *sliOrigin[7] = 11\n    *sliOrigin = append(*sliOrigin, 100, 101, 102)\n    fmt.Println(\"\\ninside the UPDATE Slice POINTER function we have a sli pointer and we can modify directly the structures appending elements =\", sliOrigin)\n    fmt.Println(\"\\nbut to access the values and modify it we have to create a local instance\")\n    var x = *sliOrigin\n    x[4] = 9\n}\n</code></pre>\n\n<p>Running this will produce:</p>\n\n<pre><code>START STATUS_____\nslice [0 0 0 0 0 0 0 0]\n    cap: 8\n    len: 8\n\ninside the edit Slice function the sli is = [0 0 0 0 0 0 0 11 33 34 35]\nand the direct assignment of the last element (7\u00b0) ar right working.\n\nHowever, the slice append will not be applied to the original slice because this is an internal copy\nEDIT RESULT STATUS_____\n    slice [0 0 0 0 0 0 0 11]\n    cap: 8\n    len: 8\n\ninside the update Slice function the sli is =  [0 0 0 0 0 0 0 11 12 13 14]\nand this append will be applied to the original one becouse of the return value of this function is a         new slice\nUPDATE RESULT STATUS_____\n    slice [0 0 0 0 0 0 0 11 12 13 14]\n    cap: 16\n    len: 11\nDIRECT APPEND RESULT STATUS_____\n    slice [0 0 0 0 0 0 0 11 12 13 14 15 16 17]\n    cap: 16\n    len: 14\nDIRECT ASSIGNMENT OF LAST ELEMENT (13\u00b0) STATUS_____\n    slice [0 0 0 0 0 0 0 11 12 13 14 15 16 99]\n    cap: 16\n    len: 14\n\ninside the UPDATE Slice POINTER function we have a sli pointer and we can modify directly the         structures appending elements = &amp;[0 0 0 0 0 0 0 11 12 13 14 15 16 99 100 101 102]\n\nbut to access the values and modify it we have to create a local instance\n\n*** Finally, passing the slice as a pointer will modify the sctructure: \n    slice [0 0 0 0 9 0 0 11 12 13 14 15 16 99 100 101 102]\n    cap: 32\n    len: 17\n</code></pre>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516968326, "post_id": 48460922, "comment_id": 83914844, "body": "You can make a wrap timer that emit a value to the channel immediately."}, {"owner": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516970581, "post_id": 48460922, "comment_id": 83915956, "body": "It&#39;s an interesting idea that is worth to try, thank you"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1516978118, "post_id": 48460922, "comment_id": 83920409, "body": "See also <a href=\"https://github.com/golang/go/issues/17601\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/17601</a>"}], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "edited": false, "score": 0, "creation_date": 1516970195, "post_id": 48461134, "comment_id": 83915753, "body": "I prefer to use the time package&#39;s method if it exists. But your answer is simple and effective\uff0cthx :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516977352, "post_id": 48461134, "comment_id": 83919878, "body": "This leaks the first timeChan Ticker, you should call Stop if it&#39;s not going to be used. Also if you&#39;re going to use this method, why wait a whole millisecond, just start with a duration of 1."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "edited": false, "score": 1, "creation_date": 1516978803, "post_id": 48461134, "comment_id": 83920903, "body": "@bernieyum, I knew your expectation. But there is no built-in method to trigger this without wating."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516979106, "post_id": 48461134, "comment_id": 83921091, "body": "@JimB, Thank you. You are right. I have edited to start with 1. What do you mean by leak? Can you provide me a reference. Thank you"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1516979388, "post_id": 48461134, "comment_id": 83921280, "body": "If the ticker is running, it can&#39;t be garbage collected. From the <a href=\"https://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\"><code>time.Ticker</code> documentation</a>: <code>Stop the ticker to release associated resources</code>. One ticker left running indefinitely isn&#39;t much, but we should provide correct examples when possible."}, {"owner": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "edited": false, "score": 0, "creation_date": 1517043610, "post_id": 48461134, "comment_id": 83941900, "body": "@aerokite ok, I will seek to another way.Thank you"}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 3, "last_activity_date": 1516982938, "last_edit_date": 1516982938, "creation_date": 1516968616, "answer_id": 48461134, "question_id": 48460922, "link": "https://stackoverflow.com/questions/48460922/how-to-execute-ticker-immediately-when-function-start-to-run-in-golang/48461134#48461134", "title": "how to execute ticker immediately when function start to run in golang", "body": "<p>Set your Ticker for <code>weekly</code> at first <code>time.Millisecond</code>. Then change it, when 1st time it is done.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    var a = 0\n\n    ticker := time.NewTicker(1)\n    timeChan := ticker.C\n    tickChan := time.NewTicker(time.Millisecond * 500).C\n\n    for {\n        select {\n        case &lt;-timeChan:\n            fmt.Println(\"weekly updated\")\n            if a == 0 {\n                ticker.Stop()\n                timeChan = time.NewTicker(time.Second * 2).C\n            }\n            a = 1\n        case &lt;-tickChan:\n            if a == 1 {\n                fmt.Println(\"daily check\")\n            } else {\n                fmt.Println(\"Not update\uff1f\")\n            }\n        default:\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>weekly updated\ndaily check\ndaily check\ndaily check\ndaily check\nweekly updated\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "edited": false, "score": 0, "creation_date": 1517043486, "post_id": 48464288, "comment_id": 83941883, "body": "This answer like I said that &#39;i can just print &quot;weekly updated&quot; firstly one time&#39;. It&#39;s a feasible way to the demo, but I can&#39;t do that. Because my code will integrate into the team&#39;s project, I would like to seek a way which doesn&#39;t influence others code.Anyway, appreciate your answer."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1516983743, "last_edit_date": 1516983743, "creation_date": 1516980063, "answer_id": 48464288, "question_id": 48460922, "link": "https://stackoverflow.com/questions/48460922/how-to-execute-ticker-immediately-when-function-start-to-run-in-golang/48464288#48464288", "title": "how to execute ticker immediately when function start to run in golang", "body": "<p>Just put the work in a function and call it.</p>\n\n<pre><code>var a int\ntimeChan := time.NewTicker(time.Second * 2).C\ntickChan := time.NewTicker(time.Millisecond * 500).C\nf := func() {\n    fmt.Println(\"weekly updated\")\n    a = 1\n}\nf()\nfor {\n    select {\n    case &lt;-timeChan:\n        f()\n    case &lt;-tickChan:\n        if a == 1 {\n            fmt.Println(\"daily check\")\n        } else {\n            fmt.Println(\"Not update\uff1f\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 352, "user_id": 6399638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b42f7db8b942eb921ffa62930ef1979?s=128&d=identicon&r=PG&f=1", "display_name": "Yang MingHui", "link": "https://stackoverflow.com/users/6399638/yang-minghui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1999, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1516983743, "creation_date": 1516967830, "question_id": 48460922, "link": "https://stackoverflow.com/questions/48460922/how-to-execute-ticker-immediately-when-function-start-to-run-in-golang", "title": "how to execute ticker immediately when function start to run in golang", "body": "<p>I would hope to execute the \"weekly updated\" before \"daily check\" as follows. \nThat means \"time.Time\" should put \"timeChan\" immediately rather than do it after waiting for over two seconds when the main function Start running.</p>\n\n<p>And the result should be like this</p>\n\n<pre><code>weekly updated\ndaily check\ndaily check\ndaily check\ndaily check\nweekly updated\ndaily check\ndaily check\ndaily check\ndaily check\n...\n</code></pre>\n\n<p>Of course\uff0ci can just print \"weekly updated\" firstly one time, but there is have an elegant method?</p>\n\n<p>The code is as follows</p>\n\n<pre><code>package main\n\nimport \"time\"\nimport \"fmt\"\n\nfunc main() {\n    var a int\n    timeChan := time.NewTicker(time.Second * 2).C\n\n    tickChan := time.NewTicker(time.Millisecond * 500).C\n\n    for {\n        select {\n        case &lt;-timeChan:\n            fmt.Println(\"weekly updated\")\n            a = 1\n        case &lt;-tickChan:\n            if a == 1 {\n                fmt.Println(\"daily check\")\n            } else {\n                fmt.Println(\"Not update\uff1f\")\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The result is as follows </p>\n\n<pre><code>Not update\uff1f\nNot update\uff1f\nNot update\uff1f\nweekly updated\ndaily check\ndaily check\ndaily check\ndaily check\nweekly updated\ndaily check\ndaily check\ndaily check\ndaily check\n...\n</code></pre>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1516971076, "post_id": 48460761, "comment_id": 83916196, "body": "You don&#39;t have any type aliases in your question."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516978531, "post_id": 48460761, "comment_id": 83920705, "body": "A type alias is <code>type A = B</code> not <code>type A B</code>."}, {"owner": {"reputation": 493, "user_id": 1577037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Cwrw4.png?s=128&g=1", "display_name": "Izaan", "link": "https://stackoverflow.com/users/1577037/izaan"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516980129, "post_id": 48460761, "comment_id": 83921822, "body": "@leaf What do I call <code>type A B</code> then? I wanted to use <code>typedef</code> but seems like that term is not used in Go parlance."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516980304, "post_id": 48460761, "comment_id": 83921939, "body": "It is called type definations. You can read the golang spec."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1516973695, "last_edit_date": 1592644375, "creation_date": 1516967443, "answer_id": 48460825, "question_id": 48460761, "link": "https://stackoverflow.com/questions/48460761/why-is-it-illegal-to-assign-pointer-to-pointer-for-type-definitions-involving-po/48460825#48460825", "title": "Why is it illegal to assign pointer to pointer for type definitions involving pointers?", "body": "<p>This is all &quot;governed&quot; by <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">Spec: Assignability</a>. Assigning to <code>test_3</code> is covered by this:</p>\n<blockquote>\n<p>A value <code>x</code> is assignable to a <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">variable</a> of type <code>T</code> (&quot;<code>x</code> is assignable to <code>T</code>&quot;) in any of these cases:</p>\n<ul>\n<li><p>[...]</p>\n</li>\n<li><p><code>x</code>'s type <code>V</code> and <code>T</code> have identical <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">underlying types</a> and at least one of <code>V</code> or <code>T</code> is not a <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">defined</a> type.</p>\n</li>\n</ul>\n</blockquote>\n<p>And none of the assignability rules cover <code>test_4</code>, so it's not allowed.</p>\n<p>The <em>underlying type</em> is detailed in <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">Spec: Types:</a></p>\n<blockquote>\n<p>Each type <code>T</code> has an <em>underlying type</em>: If <code>T</code> is one of the predeclared boolean, numeric, or string types, or a type literal, the corresponding underlying type is <code>T</code> itself. Otherwise, <code>T</code>'s underlying type is the underlying type of the type to which <code>T</code> refers in its <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">type declaration</a>.</p>\n</blockquote>\n<p>In case of <code>test_3</code>:</p>\n<pre><code>var test_3 VertexPointer = &amp;v\n</code></pre>\n<p>Type of <code>test_3</code> is <code>VertexPointer</code> (explicitly specified), type of <code>&amp;v</code> is <code>*Vertex</code>. Underlying type for both are <code>*Vertex</code>, and type of <code>&amp;v</code> (which is <code>*Vertex</code>) is an unnamed type, so the assignment is OK. <code>Vertex</code> is a named type, but derived types such as <code>*Vertex</code> or <code>[]Vertex</code> are unnamed types.</p>\n<p>In case of <code>test_4</code>:</p>\n<pre><code>var test_4 *VertexPointer = &amp;v_ptr\n</code></pre>\n<p>Type of <code>test_4</code> is <code>*VertexPointer</code>, type of <code>&amp;v_ptr</code> is <code>**Vertex</code> because type of <code>v_ptr</code> is <code>*Vertex</code>, not <code>VertexPointer</code>. Underlying type of <code>test_4</code> is <code>*VertexPoitner</code>, underlying type of <code>&amp;v_ptr</code> is <code>**Vertex</code>. The underlying types do not match. So there is no assignability rule that applies, so this assignment is <strong>not</strong> OK.</p>\n<p>See similar question: <a href=\"https://stackoverflow.com/questions/41501596/custom-type-passed-to-function-as-a-parameter/41501756#41501756\">Custom type passed to function as a parameter</a></p>\n"}], "owner": {"reputation": 493, "user_id": 1577037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Cwrw4.png?s=128&g=1", "display_name": "Izaan", "link": "https://stackoverflow.com/users/1577037/izaan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 48460825, "answer_count": 1, "score": 3, "last_activity_date": 1516980619, "creation_date": 1516967182, "last_edit_date": 1516980619, "question_id": 48460761, "link": "https://stackoverflow.com/questions/48460761/why-is-it-illegal-to-assign-pointer-to-pointer-for-type-definitions-involving-po", "title": "Why is it illegal to assign pointer to pointer for type definitions involving pointers?", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\ntype Vertex struct {\n    X, Y float64\n}\n\ntype VertexPointer *Vertex\n\nfunc main() {\n    v := Vertex{3, 4}\n    v_ptr := &amp;v\n\n    var test_1 *Vertex = &amp;v\n    var test_2 **Vertex = &amp;v_ptr\n\n    var test_3 VertexPointer = &amp;v\n    var test_4 *VertexPointer = &amp;v_ptr\n}\n</code></pre>\n\n<p>When I try and run it (I'm using Go 1.6.2) I get the following error:</p>\n\n<pre><code># command-line-arguments\n./pointers.go:17: cannot use &amp;v_ptr (type **Vertex) as type *VertexPointer in assignment\n</code></pre>\n\n<p>I'm confused why the assignment involving <code>test_3</code>works but not <code>test_4</code>. Based on what I've been reading, my understanding is that either both assignments should work or neither of them should work. Isn't the described behaviour a bit inconsistent?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516966799, "post_id": 48460450, "comment_id": 83914043, "body": "Do you have column named <code>Id</code> &amp; <code>Token</code>?"}, {"owner": {"reputation": 3298, "user_id": 8928024, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/75f4b1f5d87975964979ce2718af1ae9?s=128&d=identicon&r=PG&f=1", "display_name": "ZF007", "link": "https://stackoverflow.com/users/8928024/zf007"}, "edited": false, "score": 0, "creation_date": 1516966858, "post_id": 48460450, "comment_id": 83914070, "body": "have you tried something yourself to solve it... please post of the many tries or describe a few to show effort."}, {"owner": {"reputation": 2238, "user_id": 3427079, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/uSYvV.jpg?s=128&g=1", "display_name": "G_V", "link": "https://stackoverflow.com/users/3427079/g-v"}, "edited": false, "score": 0, "creation_date": 1516967129, "post_id": 48460450, "comment_id": 83914200, "body": "Why don&#39;t you want to create a separate table for your separate data structure? Why not put Google ID and token directly in the Client struct then, instead of creating a separate entity which you don&#39;t want? Don&#39;t normalize things that you don&#39;t want normalized?"}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516967695, "post_id": 48460450, "comment_id": 83914516, "body": "@aerokite Yes, in nested field <code>google</code> which represent himself a separate structure"}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 2238, "user_id": 3427079, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/uSYvV.jpg?s=128&g=1", "display_name": "G_V", "link": "https://stackoverflow.com/users/3427079/g-v"}, "edited": false, "score": 0, "creation_date": 1516968043, "post_id": 48460450, "comment_id": 83914694, "body": "@G_V I just want to use all possibility of PostresSQL. I created separate entity, because this structure used not only in this table. And my decision - it is not denormalization. Merely I&#39;m using new ways, that get the same result, but more gracefully"}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 3298, "user_id": 8928024, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/75f4b1f5d87975964979ce2718af1ae9?s=128&d=identicon&r=PG&f=1", "display_name": "ZF007", "link": "https://stackoverflow.com/users/8928024/zf007"}, "edited": false, "score": 0, "creation_date": 1516968258, "post_id": 48460450, "comment_id": 83914807, "body": "@ZF007 Right now I found one solution - implement Scanner to <code>GoogleAccount</code>. But value in the input method is []uint8. I&#39;ve tried to make object from byte, but it was without result"}, {"owner": {"reputation": 3298, "user_id": 8928024, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/75f4b1f5d87975964979ce2718af1ae9?s=128&d=identicon&r=PG&f=1", "display_name": "ZF007", "link": "https://stackoverflow.com/users/8928024/zf007"}, "edited": false, "score": 0, "creation_date": 1516969097, "post_id": 48460450, "comment_id": 83915226, "body": "@KirillZyusko... add the info from your trail not in comment but ad it to the question itself. Its useful information that is now overlooked by others. Good to see effort ;-) (I did triage review your question.. not an expert on your topic... so I look at grammer, formatting and makes the content sense in general)."}, {"owner": {"reputation": 2238, "user_id": 3427079, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/uSYvV.jpg?s=128&g=1", "display_name": "G_V", "link": "https://stackoverflow.com/users/3427079/g-v"}, "edited": false, "score": 0, "creation_date": 1516973959, "post_id": 48460450, "comment_id": 83917708, "body": "@KirillZyusko - How is it more graceful? Why can&#39;t you get GoogleAccount fields directly from the Client to which it is tied? If you need a separate table for the data but don&#39;t make one, how is that not denormalization? What does graceful mean in this context? New ways?You can&#39;t use a term to explain the definition of a term and expect us to know what you&#39;re thinking. It really helps to write out what you want, what you&#39;ve tried, what you don&#39;t want and why."}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 2238, "user_id": 3427079, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/uSYvV.jpg?s=128&g=1", "display_name": "G_V", "link": "https://stackoverflow.com/users/3427079/g-v"}, "edited": false, "score": 0, "creation_date": 1516976338, "post_id": 48460450, "comment_id": 83919176, "body": "@G_V Yeah, of course I can separate this data in client table and don&#39;t create new type of data. But here is small example, that described a problem with reading object from database to nested object in structure. Big difference between separate field in table or make it as object type I don&#39;t see (in the performance angle). Separate table - I want use this field not only in this table, the same it will be use in company table. If create separate table I need to keep pairs id_client and id_company, and one from this always will be null. At addition - performance of 2 query in db will be always"}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 2238, "user_id": 3427079, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/uSYvV.jpg?s=128&g=1", "display_name": "G_V", "link": "https://stackoverflow.com/users/3427079/g-v"}, "edited": false, "score": 0, "creation_date": 1516977191, "post_id": 48460450, "comment_id": 83919754, "body": "@G_V more costly, than one query with directly data in table. It&#39;s obviously. From point of view traditional SQL database this way looks like &quot;undesired&quot; (made new data type). But I repeat himself again - I just want to try new way. And if Postgres it allow, why i shouldn&#39;t to try it? In this example I just wanna to logically group data. Personally for me structure of <code>client.google.id</code> looks more suitable, than <code>client.google_id</code>. It&#39;s a matter of habit. And finally: separate fields in db it&#39;s normalization (in my case), but grouped the same data in one field (just object) - denormalization?"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516984171, "post_id": 48460450, "comment_id": 83924347, "body": "<a href=\"https://play.golang.org/p/q2DFAqyyrkP\" rel=\"nofollow noreferrer\">play.golang.org/p/q2DFAqyyrkP</a> . Will it work?"}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516989023, "post_id": 48460450, "comment_id": 83927044, "body": "@aerokite It will work, if table contain field <code>Id</code> and <code>Token</code> as usually fields of table. But I have an object type. The task is not to simplify the presentation of data in the table. I need to make the correct mapping of the object from postgres to the entity."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "edited": false, "score": 0, "creation_date": 1517828359, "post_id": 48590997, "comment_id": 84238436, "body": "Thanks, it works when GoogleAccount is table. But in my case GoogleAccount is ObjectType in Posgres  <code>CREATE TYPE GOOGLE_ACCOUNT AS (   id    NUMERIC,   token TEXT );</code>  And I would like to not separate this type in other table."}, {"owner": {"reputation": 172, "user_id": 7338886, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/shaF0.jpg?s=128&g=1", "display_name": "Hasibul Hasn", "link": "https://stackoverflow.com/users/7338886/hasibul-hasn"}, "reply_to_user": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "edited": false, "score": 0, "creation_date": 1526230556, "post_id": 48590997, "comment_id": 87652774, "body": "@Kirill I had the same situation, however I used nested JSON. but I have no idea how to use custom types in postgresql with gorm!"}], "tags": [], "owner": {"reputation": 919, "user_id": 1043674, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/0090f1f22a03e38ca61dc955e1d0a346?s=128&d=identicon&r=PG", "display_name": "Jon Chan", "link": "https://stackoverflow.com/users/1043674/jon-chan"}, "is_accepted": false, "score": 7, "last_activity_date": 1517606296, "creation_date": 1517606296, "answer_id": 48590997, "question_id": 48460450, "link": "https://stackoverflow.com/questions/48460450/get-nested-object-in-structure-in-gorm/48590997#48590997", "title": "Get nested object in structure in gorm", "body": "<p>It looks like you'll want to do two things with what you have: (1) update the model so you have the right relationship binding, and (2) use the <code>.Preload()</code> method if you're trying to get it to associate the data on read.</p>\n\n<p><strong>Model Changes</strong></p>\n\n<p>Gorm automatically infers relationships based on the name of the attributes in your struct and the name of the referenced struct. The problem is that <code>Google</code> attribute of type <code>GoogleAccount</code> isn't associating because gorm is looking for a <code>type Google struct</code>.</p>\n\n<p>You're also missing a foreign key on <code>GoogleAccount</code>. How would the ORM know which <code>GoogleAccount</code> to associate with which <code>Client</code>? You should add a <code>ClientId</code> to your <code>GoogleAccount</code> struct definition.</p>\n\n<p>Also, I would change the primary keys you're using to type <code>uint</code> since that's what gorm defaults to (unless you have a good reason not to use it)</p>\n\n<p>If I were you, I would change my struct definitions to the following:</p>\n\n<pre><code>type Client struct {\n     IdClient       uint            `gorm:\"primary_key\"`\n     Name           string\n     PhotoUrl       string\n     ApprovalNumber uint16\n     Phone          string\n     Password       string\n     HoursOfNotice  int8\n     GoogleAccount  GoogleAccount    // Change this to `GoogleAccount`, the same name of your struct\n}\n\ntype GoogleAccount struct {\n     Id             uint\n     ClientId       uint             // Foreign key\n     Token          string\n}\n</code></pre>\n\n<p>For more information on this, take a look at the associations documentation here: <a href=\"http://gorm.io/associations.html#has-one\" rel=\"noreferrer\">http://gorm.io/associations.html#has-one</a></p>\n\n<p><strong>Preloading associations</strong></p>\n\n<p>Now that you actually have them properly related, you can <code>.Preload()</code> get the nested object you want:</p>\n\n<pre><code>db.Preload(\"GoogleAccount\").First(&amp;user)\n</code></pre>\n\n<p>Using <code>.Preload()</code> will populate the <code>user.GoogleAccount</code> attribute with the correctly associated <code>GoogleAccount</code> based on the <code>ClientId</code>.</p>\n\n<p>For more information on this, take a look at the preloading documentation: <a href=\"http://gorm.io/crud.html#preloading-eager-loading\" rel=\"noreferrer\">http://gorm.io/crud.html#preloading-eager-loading</a></p>\n"}, {"comments": [{"owner": {"reputation": 1369, "user_id": 2730233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GDPoY.jpg?s=128&g=1", "display_name": "Lucio Mollinedo", "link": "https://stackoverflow.com/users/2730233/lucio-mollinedo"}, "edited": false, "score": 0, "creation_date": 1575654608, "post_id": 50366795, "comment_id": 104651797, "body": "Next time, don&#39;t just put a link to your repo. Add the actual code here as well. Your link is broken."}, {"owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "reply_to_user": {"reputation": 1369, "user_id": 2730233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GDPoY.jpg?s=128&g=1", "display_name": "Lucio Mollinedo", "link": "https://stackoverflow.com/users/2730233/lucio-mollinedo"}, "edited": false, "score": 0, "creation_date": 1575656678, "post_id": 50366795, "comment_id": 104652531, "body": "@LucioMollinedo thank you for your comment. I added code snippet."}], "tags": [], "owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "is_accepted": true, "score": 1, "last_activity_date": 1575656628, "last_edit_date": 1575656628, "creation_date": 1526462062, "answer_id": 50366795, "question_id": 48460450, "link": "https://stackoverflow.com/questions/48460450/get-nested-object-in-structure-in-gorm/50366795#50366795", "title": "Get nested object in structure in gorm", "body": "<p>Right now I found one solution - implement <strong>Scanner</strong> to <code>GoogleAccount</code>. At input of the <code>Scan</code> method I got <code>[]uint8</code>, that I cast to string and parse in the end. This string (that keeping in db) look like <code>(x,x)</code> - where <code>x</code> - is value. Of course, it is not correct way to achieve my goal. But I couldn't found other solution.</p>\n\n<p>I <strong>highly recommended</strong> use classical binding by relationship or simple keeping these fields in table as simplest value (not as object). </p>\n\n<p>But if you would like to experiment with nested object in table, you can look at my realization, maybe it would be useful for you:</p>\n\n<pre><code>type Client struct {\n    // many others fields\n    Google          GoogleAccount   `json:\"google\"`\n}\n\ntype GoogleAccount struct {\n    Id      uint64      `json:\"id\"`\n    Token   string      `json:\"token\"`\n}\n\nfunc (google GoogleAccount) Value() (driver.Value, error) {\n    return \"(\" + strconv.FormatUint(google.Id, 10) + \",\" + google.Token + \")\", nil\n}\n\nfunc (google *GoogleAccount) Scan(value interface{}) error {\n    values := utils.GetValuesFromObject(value)\n    google.Id, _ = strconv.ParseUint(values[0], 10, 64)\n    google.Token = values[1]\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 9272042, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXRAn.jpg?s=128&g=1", "display_name": "Kirill Zyusko", "link": "https://stackoverflow.com/users/9272042/kirill-zyusko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7034, "favorite_count": 0, "accepted_answer_id": 50366795, "answer_count": 2, "score": 5, "last_activity_date": 1575656628, "creation_date": 1516966070, "last_edit_date": 1517828569, "question_id": 48460450, "link": "https://stackoverflow.com/questions/48460450/get-nested-object-in-structure-in-gorm", "title": "Get nested object in structure in gorm", "body": "<p>I have a two structure:</p>\n\n<pre><code>type GoogleAccount struct {\n     Id     uint64\n     Token  string\n}\n</code></pre>\n\n<p>It represent my custom PostgreSQL object type (i created myself):</p>\n\n<pre><code>CREATE TYPE GOOGLE_ACCOUNT AS\n(\n  id    NUMERIC,\n  token TEXT\n);\n</code></pre>\n\n<p>And next structure is table in DB:</p>\n\n<pre><code>type Client struct {\n     IdClient       uint64          `gorm:\"primary_key\"`\n     Name           string\n     PhotoUrl       string\n     ApprovalNumber uint16\n     Phone          string\n     Password       string\n     HoursOfNotice  int8\n     Google         GoogleAccount\n}\n</code></pre>\n\n<p>And my custom object nested in type Client and named as <code>google</code>. I've tried to read data by the next way: </p>\n\n<pre><code>var users model.Client\ndb.First(&amp;users)\n</code></pre>\n\n<p>But unfortunately I can't read field <code>google</code> (have a default value). I don't want to create separate table with google_account, or make this structure as separated fields in client table or packed it as json (created separate entity, because this structure used not only in this table and I'm searching new ways, that get the same result, but more gracefully). The task <strong>is not to simplify the presentation of data in the table</strong>. I need to make the <strong>correct mapping</strong> of the object from postgres to the entity.</p>\n\n<p>Right now I found one solution - implement Scanner to GoogleAccount. But value in the input method is []uint8. As I can suppose, []uint8 can cast to string, and after that I can parse this string. This string (that keep in db) look like <code>(x,x)</code> - where x - is value. Is the right way, to parse string and set value to object? Or is way to get this result by ORM?</p>\n\n<p>Is the possible way, to read this data as nested structure object? </p>\n"}, {"tags": ["oop", "pointers", "go", "reference"], "comments": [{"owner": {"reputation": 534, "user_id": 827715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11474de354dc6452e2cdbd076c453b1c?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Ved", "link": "https://stackoverflow.com/users/827715/harish-ved"}, "reply_to_user": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 1, "creation_date": 1516966902, "post_id": 48460362, "comment_id": 83914087, "body": "@halfer updated"}], "answers": [{"comments": [{"owner": {"reputation": 534, "user_id": 827715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11474de354dc6452e2cdbd076c453b1c?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Ved", "link": "https://stackoverflow.com/users/827715/harish-ved"}, "edited": false, "score": 0, "creation_date": 1516966624, "post_id": 48460430, "comment_id": 83913954, "body": "Awesome @aerokite.. Thanks for this!"}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 1, "last_activity_date": 1516966657, "last_edit_date": 1516966657, "creation_date": 1516965995, "answer_id": 48460430, "question_id": 48460362, "link": "https://stackoverflow.com/questions/48460362/need-help-understanding-mapstringtype-behaviour-in-go/48460430#48460430", "title": "Need help understanding `map[String]type` behaviour in Go", "body": "<p>Two way you can do this.</p>\n\n<p>One, You need to use pointer in as Map value. So that when you are appending in your local variable, you are changing through reference.</p>\n\n<pre><code>type Activity struct {\n    yearContributions map[string]*weekContributions\n}\n\ntype dayContributions struct {\n    Date         time.Time\n    Contribution int\n}\n\ntype weekContributions struct {\n    Notation string\n    AllDays  []*dayContributions\n}\n</code></pre>\n\n<p>Two, When you are doing following</p>\n\n<pre><code>currentWeekContribution := currentActivity.yearContributions[stringWeekday]\n</code></pre>\n\n<p>You are assigning a local variable. And you are appending to it. Now, you need to reassign that local variable. Like</p>\n\n<pre><code>currentWeekContribution := currentActivity.yearContributions[stringWeekday]\ncurrentWeekContribution.addContribution(dayContributions{Date: d, Contribution: 1})\ncurrentActivity.yearContributions[stringWeekday]= currentWeekContribution\n</code></pre>\n"}], "owner": {"reputation": 534, "user_id": 827715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11474de354dc6452e2cdbd076c453b1c?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Ved", "link": "https://stackoverflow.com/users/827715/harish-ved"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 48460430, "answer_count": 1, "score": 0, "last_activity_date": 1516966753, "creation_date": 1516965726, "last_edit_date": 1516966753, "question_id": 48460362, "link": "https://stackoverflow.com/questions/48460362/need-help-understanding-mapstringtype-behaviour-in-go", "title": "Need help understanding `map[String]type` behaviour in Go", "body": "<p>Please have a look at this code:</p>\n\n<pre><code>package activity\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n)\n\ntype Activity struct {\n    yearContributions map[string]weekContributions\n}\n\ntype dayContributions struct {\n    Date         time.Time\n    Contribution int\n}\n\ntype weekContributions struct {\n    Notation string\n    AllDays  []dayContributions\n}\n\nfunc (currentWeekContribution *weekContributions) addContribution(additionalDayContribution dayContributions) {\n    currentWeekContribution.AllDays = append(currentWeekContribution.AllDays, additionalDayContribution)\n}\n\nfunc (currentActivity *Activity) restore() {\n    currentActivity.yearContributions = map[string]weekContributions{\n        \"Sunday\":    weekContributions{Notation: \"S\", AllDays: make([]dayContributions, 0)},\n        \"Monday\":    weekContributions{Notation: \"M\", AllDays: make([]dayContributions, 0)},\n        \"Tuesday\":   weekContributions{Notation: \"T\", AllDays: make([]dayContributions, 0)},\n        \"Wednesday\": weekContributions{Notation: \"W\", AllDays: make([]dayContributions, 0)},\n        \"Thursday\":  weekContributions{Notation: \"T\", AllDays: make([]dayContributions, 0)},\n        \"Friday\":    weekContributions{Notation: \"F\", AllDays: make([]dayContributions, 0)},\n        \"Saturday\":  weekContributions{Notation: \"S\", AllDays: make([]dayContributions, 0)},\n    }\n}\n\nfunc (currentActivity *Activity) Recalibrate() {\n    currentActivity.restore()\n\n    endDate := time.Now().UTC()\n    startDate := endDate.AddDate(-1, 0, 0)\n\n    for d := startDate; endDate.After(d); d = d.AddDate(0, 0, 1) {\n        stringWeekday := d.Weekday().String()\n        currentWeekContribution := currentActivity.yearContributions[stringWeekday]\n        currentWeekContribution.addContribution(dayContributions{Date: d, Contribution: 1})\n        fmt.Println(currentWeekContribution) // prints : {T [{2017-01-26 09:39:45.711238257 +0000 UTC 1}]}\n    }\n    fmt.Println(currentActivity.yearContributions) // prints : map[Tuesday:{T []} Wednesday:{W []} Thursday:{T []} Friday:{F []} Saturday:{S []} Sunday:{S []} Monday:{M []}]\n}\n\nfunc (singleDayContribution dayContributions) ReadableDate() string {\n    singleDate := singleDayContribution.Date\n    return singleDate.Month().String() + \" \" + strconv.Itoa(singleDate.Day()) + \", \" + strconv.Itoa(singleDate.Year())\n}\n\nfunc (currentActivity Activity) GetContributionsForYear() map[string]weekContributions {\n    return currentActivity.yearContributions\n}\n</code></pre>\n\n<p>I am trying to append new <code>dayContributions</code> to the array <code>weekContributions.AllDays</code>.\n<code>currentWeekContribution.AllDays = append(currentWeekContribution.AllDays, additionalDayContribution)</code> is the part <code>appends</code> to the <code>AllDays</code> property of the current type <code>weekContributions</code>.</p>\n\n<p>The print statement prints the <code>weekContributions</code> array with a single member in the array. But the following print function says that all map values i.e. <code>weekContributions</code> objects have empty arrays as <code>AllDays</code> property.</p>\n\n<p>My aim - To append <code>dayContribution</code> objects to values in map <code>activity.yearContributions</code></p>\n\n<p>I think -</p>\n\n<ol>\n<li>The append function is working as intended as it appends 1 member on each iteration</li>\n<li>Somehow, the <code>currentWeekContribution.addContribution</code> line [Line 48] is only appending to the local variable <code>currentWeekContribution</code> and doesn't update the corresponding value in <code>currentActivity.yearContributions</code> map</li>\n</ol>\n\n<p>I am very new to <code>golang</code> and I think I am not following <code>the go way</code> / this would have worked in <code>java</code> or <code>ruby</code>\nI don't know what this behaviour is called, so can't google search anything relevant.</p>\n"}, {"tags": ["string", "pointers", "for-loop", "go", "memory"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1516963773, "post_id": 48459846, "comment_id": 83912562, "body": "What&#39;s the question? The first version doesn&#39;t work because there is only one loop variable (reused in each iteration), and you append the same address in each iteration. See examples <a href=\"https://stackoverflow.com/questions/44715882/why-do-these-two-for-loop-variations-give-me-different-behavior/44716068#44716068\">one</a> and <a href=\"https://stackoverflow.com/questions/44044245/golang-register-multiple-routes-using-range-for-loop-slices-map/44045012#44045012\">two</a>."}, {"owner": {"reputation": 3516, "user_id": 119333, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/or6j6.jpg?s=128&g=1", "display_name": "Martin Magakian", "link": "https://stackoverflow.com/users/119333/martin-magakian"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1516964006, "post_id": 48459846, "comment_id": 83912663, "body": "@icza updated with question"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 2, "last_activity_date": 1516979835, "last_edit_date": 1516979835, "creation_date": 1516964101, "answer_id": 48459961, "question_id": 48459846, "link": "https://stackoverflow.com/questions/48459846/convert-slice-of-string-to-slice-of-pointer-to-string/48459961#48459961", "title": "Convert slice of string to slice of pointer to string", "body": "<p>The iteration values in a <code>for .. range</code> clause are assigned for each iteration.</p>\n\n<p>The <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">spec</a> clearly states:</p>\n\n<blockquote>\n  <p>The iteration values are assigned to the respective iteration\n  variables as in an assignment statement.</p>\n</blockquote>\n\n<p>This is the equivalent of doing:</p>\n\n<pre><code>var v string\nv = string1\nvalues[0] = &amp;v\nv = string2\nvalues[1] = &amp;v\netc...\n</code></pre>\n\n<p>The variable <code>v</code> still lives in the same area of memory, it's just that the contents change. So the address of <code>v</code> never changes.</p>\n"}, {"comments": [{"owner": {"reputation": 3516, "user_id": 119333, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/or6j6.jpg?s=128&g=1", "display_name": "Martin Magakian", "link": "https://stackoverflow.com/users/119333/martin-magakian"}, "edited": false, "score": 0, "creation_date": 1516964774, "post_id": 48459980, "comment_id": 83913055, "body": "Thanks for the tips about copying the value in a temporary variable"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1517124600, "last_edit_date": 1517124600, "creation_date": 1516964180, "answer_id": 48459980, "question_id": 48459846, "link": "https://stackoverflow.com/questions/48459846/convert-slice-of-string-to-slice-of-pointer-to-string/48459980#48459980", "title": "Convert slice of string to slice of pointer to string", "body": "<p>The first version doesn't work as there is only one loop variable <code>v</code>, which has <strong>the same address in each iteration</strong>. The loop variable is assigned in each iteration, which changes its value but not its address, and you append this same address in each iteration.</p>\n\n<p>A possible solution is what you proposed: to append the address of the proper slice element of the original slice:</p>\n\n<pre><code>for i := range values1 {\n    values2 = append(values2, &amp;values1[i])\n}\n</code></pre>\n\n<p>This works, but note that <code>values2</code> contains addresses pointing to the backing array of <code>values1</code>, so the backing array of <code>values1</code> will be kept in memory (will not get garbage collected) until both <code>values1</code> and <code>values2</code> variables are unreachable. Also note that modifying elements of <code>values1</code> will effect <code>values2</code> indirectly, because elements of <code>values2</code> point to elements of <code>values1</code>.</p>\n\n<p>Another solution is to create temporary local variables and append the addresses of those:</p>\n\n<pre><code>for _, v := range values1 {\n    v2 := v\n    values2 = append(values2, &amp;v2)\n}\n</code></pre>\n\n<p>By doing this, your <code>values2</code> slice will not keep <code>values1</code> from getting garbage collected, also modifying values in <code>values1</code> will not be reflected in <code>values2</code>, they will be independent.</p>\n\n<p>See related questions about the loop variable:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/44715882/why-do-these-two-for-loop-variations-give-me-different-behavior/44716068#44716068\">Why do these two for loop variations give me different behavior?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/44044245/golang-register-multiple-routes-using-range-for-loop-slices-map/44045012#44045012\">Golang: Register multiple routes using range for loop slices/map</a></p>\n"}], "owner": {"reputation": 3516, "user_id": 119333, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/or6j6.jpg?s=128&g=1", "display_name": "Martin Magakian", "link": "https://stackoverflow.com/users/119333/martin-magakian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1634, "favorite_count": 1, "accepted_answer_id": 48459980, "answer_count": 2, "score": 3, "last_activity_date": 1517124600, "creation_date": 1516963645, "last_edit_date": 1516965633, "question_id": 48459846, "link": "https://stackoverflow.com/questions/48459846/convert-slice-of-string-to-slice-of-pointer-to-string", "title": "Convert slice of string to slice of pointer to string", "body": "<p>I want to convert a slice of string into slice of pointer to string</p>\n\n<pre><code>values1 := []string{\"a\", \"b\", \"c\"}\nvar values2 []*string\nfor _, v := range values1 {\n    fmt.Printf(\"%p | %T\\n\", v, v)\n    values2 = append(values2, &amp;v)\n}\nfmt.Println(values2)\n</code></pre>\n\n<blockquote>\n  <p>%!p(string=a) => string <br/>\n  %!p(string=b) => string <br/>\n  %!p(string=c) => string <br/>\n  [0xc42000e1d0 0xc42000e1d0 0xc42000e1d0]</p>\n</blockquote>\n\n<p>From my understanding, <br />\nMy variable <code>v</code> seems to be a string, not a pointer to string. <br />\nTherefore <code>v</code> should be copied from <code>values1</code> when iterating.</p>\n\n<p>Obviously I'm incorrect as <code>v</code> still have the same address <code>0xc42000e1d0</code>. <br />\nHow can <code>v</code> value change if it's not a pointer?</p>\n\n<p><b>For a quick solution use:</b></p>\n\n<pre><code>values1 := []string{\"a\", \"b\", \"c\"}\nvar values2 []*string\nfor i, _ := range values1 {\n    values2 = append(values2, &amp;values1[i])\n}\n</code></pre>\n"}]