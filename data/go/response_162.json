[{"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1518652906, "post_id": 48798135, "comment_id": 84598960, "body": "Most of the code can be replaced with a call to <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#StringMap\" rel=\"nofollow noreferrer\">redis.StringMap</a>."}], "answers": [{"tags": [], "owner": {"reputation": 768, "user_id": 1038386, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOhSk.jpg?s=128&g=1", "display_name": "Meehow", "link": "https://stackoverflow.com/users/1038386/meehow"}, "is_accepted": true, "score": 1, "last_activity_date": 1518652744, "creation_date": 1518652744, "answer_id": 48798172, "question_id": 48798135, "link": "https://stackoverflow.com/questions/48798135/add-item-to-map-inside-of-struct-in-golang/48798172#48798172", "title": "Add item to map inside of struct in Golang", "body": "<pre><code>pages.Items = append(pages.Items, item)\n</code></pre>\n"}], "owner": {"reputation": 390, "user_id": 171453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/417db5f20ac305bd66085f13b9f9e78c?s=128&d=identicon&r=PG", "display_name": "Mitja Felicijan", "link": "https://stackoverflow.com/users/171453/mitja-felicijan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1957, "favorite_count": 0, "accepted_answer_id": 48798172, "answer_count": 1, "score": 1, "last_activity_date": 1518653305, "creation_date": 1518652502, "last_edit_date": 1518653305, "question_id": 48798135, "link": "https://stackoverflow.com/questions/48798135/add-item-to-map-inside-of-struct-in-golang", "title": "Add item to map inside of struct in Golang", "body": "<p>I have such struct defined.</p>\n\n<pre><code>type Pages struct {\n  Items []map[string]string\n}\n</code></pre>\n\n<p>In a for loop I am creating items with <code>var item = make(map[string]string)</code>.</p>\n\n<p>Complete code</p>\n\n<pre><code>pages := Pages{}\nfor _, partitionKey := range keys {\n    fields, err := redis.Strings(conn.Do(\"hgetall\", partitionKey))\n    if err == nil {\n        var item = make(map[string]string)\n        item[\"id\"] = strings.Replace(partitionKey, \"pages:\", \"\", -1)\n        for i := 0; i &lt; len(fields); i += 2 {\n            key, _ := redis.String(fields[i], nil)\n            value, _ := redis.String(fields[i+1], nil)\n            item[key] = value\n        }\n        fmt.Println(\"\\n\", item)\n        // this does not work\n        //append(pages.Items, item)\n    }\n}\n\nfmt.Println(pages)\n</code></pre>\n\n<p>How do I add newly created item to Items array in Pages struct?</p>\n\n<p><strong>Solution based on answers below.</strong></p>\n\n<pre><code>type Pages struct {\n    Items []map[string]string `json:\"items\"`\n}\n\npages := Pages{}\nfor _, partitionKey := range keys {\n    item, err := redis.StringMap(conn.Do(\"hgetall\", partitionKey))\n    if err == nil {\n        item[\"id\"] = strings.Replace(partitionKey, \"pages:\", \"\", -1)\n        pages.Items = append(pages.Items, item)\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "iteration", "decode"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1518649486, "post_id": 48797682, "comment_id": 84597942, "body": "What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518649885, "post_id": 48797682, "comment_id": 84598102, "body": "Indexing isn&#39;t necessary for what you&#39;re trying, so your problem with <code>map</code> doesn&#39;t make sense. Include your code. Also, this question comes up about 2x per week. There are countless other answers on SO. What did your research reveal?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1518650151, "post_id": 48797682, "comment_id": 84598191, "body": "See <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/json-and-go</a>. Possible duplicate of <a href=\"https://stackoverflow.com/questions/29366038/looping-iterate-over-the-second-level-nested-json-in-go-lang#answer-29382205\" title=\"looping iterate over the second level nested json in go lang%23answer 29382205\">stackoverflow.com/questions/29366038/&hellip;</a> where there is no pre-defined structure."}, {"owner": {"reputation": 11, "user_id": 9360182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2ca573b75c92e9b4378e46ce8e46e2?s=128&d=identicon&r=PG&f=1", "display_name": "dcn", "link": "https://stackoverflow.com/users/9360182/dcn"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1518650683, "post_id": 48797682, "comment_id": 84598350, "body": "@CeriseLim&#243;n So I can iterate using a range and then parse its data. That&#39;s what I wanted to know. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9360182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2ca573b75c92e9b4378e46ce8e46e2?s=128&d=identicon&r=PG&f=1", "display_name": "dcn", "link": "https://stackoverflow.com/users/9360182/dcn"}, "edited": false, "score": 0, "creation_date": 1518771660, "post_id": 48798351, "comment_id": 84649780, "body": "Thanks! A nice recursive JSON parser in a single function :)"}, {"owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "reply_to_user": {"reputation": 11, "user_id": 9360182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2ca573b75c92e9b4378e46ce8e46e2?s=128&d=identicon&r=PG&f=1", "display_name": "dcn", "link": "https://stackoverflow.com/users/9360182/dcn"}, "edited": false, "score": 0, "creation_date": 1518772052, "post_id": 48798351, "comment_id": 84649955, "body": "It&#39;s not parsing technically, just iterating through the generic data structures that the golang json parser creates for us. (Which is what you asked for I think)"}, {"owner": {"reputation": 11, "user_id": 9360182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2ca573b75c92e9b4378e46ce8e46e2?s=128&d=identicon&r=PG&f=1", "display_name": "dcn", "link": "https://stackoverflow.com/users/9360182/dcn"}, "edited": false, "score": 0, "creation_date": 1518777889, "post_id": 48798351, "comment_id": 84653565, "body": "Yeah, whether it just prints it or writes to a file is not really too important, my question was how to do it without a predefined struct and you showed me exactly that. My account is still too newb for upvotes so you&#39;ll have to wait a little, sorry!"}], "tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1518654418, "last_edit_date": 1518654418, "creation_date": 1518654089, "answer_id": 48798351, "question_id": 48797682, "link": "https://stackoverflow.com/questions/48797682/iterate-through-json-response-when-the-struct-is-not-known/48798351#48798351", "title": "Iterate through JSON response when the struct is not known", "body": "<blockquote>\n  <p>How can I (without knowing the struct) iterate through each property and print both its property name and value?</p>\n</blockquote>\n\n<p>Here is a basic function that recurses through the parsed json data structure and prints the keys/values. It's not optimized and probably doesn't address all edge cases (like arrays in arrays), but you get the idea. <a href=\"https://play.golang.org/p/UbQkIiWnkDw\" rel=\"nofollow noreferrer\">Playground</a>.</p>\n\n<p>Given an object like <code>{\"someNumerical\":42.42,\"stringsInAnArray\":[\"a\",\"b\"]}</code> the output is something like the following:</p>\n\n<pre><code>object {\nkey: someNumerical value: 42.42\nkey: stringsInAnArray value: array [\nvalue: a\nvalue: b\n]\nvalue: [a b]\n}\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>func RecurseJsonMap(dat map[string]interface{}) {\n    fmt.Println(\"object {\")   \n    for key, value := range dat {\n        fmt.Print(\"key: \" + key + \" \")        \n    // print array properties\n    arr, ok := value.([]interface{})\n    if ok {\n        fmt.Println(\"value: array [\") \n        for _, arrVal := range arr {\n            // recurse subobjects in the array\n            subobj, ok := arrVal.(map[string]interface{})\n            if ok {\n                RecurseJsonMap(subobj)\n            } else {            \n                // print other values\n                fmt.Printf(\"value: %+v\\n\", arrVal)        \n            }   \n        }\n        fmt.Println(\"]\")    \n    }\n\n    // recurse subobjects\n    subobj, ok := value.(map[string]interface{})\n    if ok {\n        RecurseJsonMap(subobj)\n    } else {            \n            // print other values\n            fmt.Printf(\"value: %+v\\n\" ,value)        \n        } \n    }\n    fmt.Println(\"}\")   \n}\n\nfunc main() {\n    // some random json object in a string\n    byt := []byte(`{\"someNumerical\":42.42,\"stringsInAnArray\":[\"a\",\"b\"]}`)\n\n    // we are parsing it in a generic fashion\n    var dat map[string]interface{}\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n    RecurseJsonMap(dat)\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9360182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2ca573b75c92e9b4378e46ce8e46e2?s=128&d=identicon&r=PG&f=1", "display_name": "dcn", "link": "https://stackoverflow.com/users/9360182/dcn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1518654418, "creation_date": 1518649374, "last_edit_date": 1518650832, "question_id": 48797682, "link": "https://stackoverflow.com/questions/48797682/iterate-through-json-response-when-the-struct-is-not-known", "title": "Iterate through JSON response when the struct is not known", "body": "<p>I have a http server and I would like to handle JSON responses to overwrite a JSON file, and I want to be able to parse any amount of data and structure.</p>\n\n<p>So my JSON data could look like this:</p>\n\n<pre><code>{\n  \"property1\": \"value\",\n  \"properties\": {\n    \"property1\": 1,\n    \"property2\": \"value\"\n  }\n}\n</code></pre>\n\n<p>Or it can look like this:</p>\n\n<pre><code>{\"property\": \"value\"}\n</code></pre>\n\n<p>I would like to iterate through each property, and if it already exists in the JSON file, overwrite it's value, otherwise append it to the JSON file.</p>\n\n<p>I have tried using <code>map</code> but it doesn't seem to support indexing. I can search for specific properties by using <code>map[\"property\"]</code> but the idea is that I don't know any of the JSON data yet.</p>\n\n<p><strong>How can I (without knowing the struct) iterate through each property and print both its property name and value?</strong></p>\n"}, {"tags": ["arrays", "go", "go-interface"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1518643267, "post_id": 48796413, "comment_id": 84595313, "body": "What have you tried? What problem did you encounter?"}], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1518685097, "creation_date": 1518685097, "answer_id": 48803313, "question_id": 48796413, "link": "https://stackoverflow.com/questions/48796413/split-array-of-objects-with-some-group-of-keys/48803313#48803313", "title": "Split array of objects with some group of keys", "body": "<p>There is one minor issue with your struct: The properties have to be exported so that values can be unmarshalled into a struct. In addition you have to tag the properties.</p>\n\n<p>If you want to split an instance of <code>myType</code> according to its values in <code>Key3</code>, you have to do it manually.</p>\n\n<p>Below is working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar bytes = []byte(`{\"key1\": \"val1\", \"key2\": \"val2\", \"key3\": [{\"k1\": \"v1\"}, {\"k2\": \"v2\"}]}`)\n\ntype myType struct {\n    Key1 string        `json:\"key1\"`\n    Key2 string        `json:\"key2\"`\n    Key3 []interface{} `json:\"key3\"`\n}\n\nfunc (mt myType) Split() []myType {\n    res := make([]myType, len(mt.Key3))\n\n    for i, k3 := range mt.Key3 {\n        res[i] = myType{Key1: mt.Key1, Key2: mt.Key2, Key3: []interface{}{k3}}\n    }\n\n    return res\n}\n\nfunc main() {\n    t := &amp;myType{}\n    err := json.Unmarshal(bytes, t)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", t.Split())\n}\n</code></pre>\n"}], "owner": {"reputation": 559, "user_id": 1364965, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7132085b7f3def420c4c8eec8242f06f?s=128&d=identicon&r=PG", "display_name": "u_peerless", "link": "https://stackoverflow.com/users/1364965/u-peerless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1518685097, "creation_date": 1518643204, "last_edit_date": 1518643244, "question_id": 48796413, "link": "https://stackoverflow.com/questions/48796413/split-array-of-objects-with-some-group-of-keys", "title": "Split array of objects with some group of keys", "body": "<p>I have an example of json as below:</p>\n\n<p><code>{\"key1\": \"val1\", \"key2\": \"val2\", \"key3\": [{\"k1\": v1\"}, {\"k2\": \"v2\"}]}</code></p>\n\n<p>Now I need to split it into two objects:</p>\n\n<p><code>{\"key1\": \"val1\", \"key2\": \"val2\", \"key3\": {\"k1\": v1\"}}</code> and \n<code>{\"key1\": \"val1\", \"key2\": \"val2\", \"key3\": {\"k2\": v2\"}}</code></p>\n\n<p>Basically I want to split the key3 elements keeping all other keys same in the new structure.</p>\n\n<p>My structure is as below:</p>\n\n<pre><code>type myType struct {\n    key1 string\n    key2 string\n    key3 []interface{}\n}\n</code></pre>\n\n<p>Please let me know how I can achieve that.</p>\n\n<p>With regards,\n-M-</p>\n"}, {"tags": ["xml", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518639902, "post_id": 48795458, "comment_id": 84593563, "body": "Turning structs into XML is marshalling. Turning XML into structs is unmarshalling."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518640314, "post_id": 48795458, "comment_id": 84593805, "body": "You note that you don&#39;t know if the given approach works - have you tried it? If so, what issues did you have with it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518640446, "post_id": 48795458, "comment_id": 84593886, "body": "<a href=\"https://play.golang.org/p/SlAtGDTXnU4\" rel=\"nofollow noreferrer\">play.golang.org/p/SlAtGDTXnU4</a> I fail to see how trying it out from the small sample you provided takes more time than writing up a question on SO."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518640489, "post_id": 48795458, "comment_id": 84593906, "body": "@Adrian I actually have a ton of attributes in each struct and if this method won&#39;t work I don&#39;t want to take the time to write them all. So I am trying to understand the correct approach to this before wasting time going down a path that is a dead end. If I can unmarshal them and ignore fields (by not including them, not by using <code>xml:&quot;-&quot;</code> tag), then I can definitely test but I don&#39;t know if that works or not. Can&#39;t find good reference explaining xml in one place including tags, these type of relationships, etc. --&gt; everything I find covers json more thoroughly."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518640541, "post_id": 48795458, "comment_id": 84593934, "body": "They work very similarly. If you unmarshal XML into a struct, and the XML has elements/attributes that aren&#39;t found in the struct, they&#39;re ignored."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518640576, "post_id": 48795458, "comment_id": 84593948, "body": "@Adrian well that makes life much easier!"}], "answers": [{"comments": [{"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1518640713, "post_id": 48795736, "comment_id": 84594035, "body": "Where I&#39;m still lost is the shared fields like ID and Text (there are actually a lot of shared fields in my real data set). This approach means I just duplicate them under each struct. Is that the best way?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1518640755, "post_id": 48795736, "comment_id": 84594047, "body": "You can duplicate them, or you can put the shared fields into their own struct and embed it in each of the other structs."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1518644458, "post_id": 48795736, "comment_id": 84595839, "body": "If I ignore attributes, will it still unmarshal ok? In other words, I will have all the fields but skip some attributes."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1518644513, "post_id": 48795736, "comment_id": 84595865, "body": "Ignore them how?"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1518644532, "post_id": 48795736, "comment_id": 84595873, "body": "Not add them to my struct"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 1, "creation_date": 1518644573, "post_id": 48795736, "comment_id": 84595891, "body": "Yes. If the XML has elements/attributes not found in the struct, they just won&#39;t be unmarshalled."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1518640461, "creation_date": 1518640461, "answer_id": 48795736, "question_id": 48795458, "link": "https://stackoverflow.com/questions/48795458/unmarshal-xml-with-variable-child-types/48795736#48795736", "title": "Unmarshal XML with variable child types", "body": "<p>One possible approach would be something like this:</p>\n\n<pre><code>type Messages struct {\n    XMLName xml.Name `xml:\"smses\"`\n    Count   string   `xml:\"count,attr\"`\n    MMS     []MMS    `xml:\"mms\"`\n    SMS     []SMS    `xml:\"sms\"`\n}\n</code></pre>\n\n<p>This will unmarshal all child <code>mms</code> elements into <code>MMS</code> and all child <code>sms</code> elements into <code>SMS</code>. You can then iterate these for further processing as necessary, e.g. embedding them into <code>Message</code> objects and putting those into a combined slice. This will lose the original XML source order, however.</p>\n"}], "owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 48795736, "answer_count": 1, "score": 1, "last_activity_date": 1518640461, "creation_date": 1518639255, "last_edit_date": 1518639953, "question_id": 48795458, "link": "https://stackoverflow.com/questions/48795458/unmarshal-xml-with-variable-child-types", "title": "Unmarshal XML with variable child types", "body": "<p>I have XML that looks like this:</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8' standalone='yes' ?&gt;\n&lt;smses count=\"500\"&gt;\n  &lt;sms id=\"1\" text=\"hi\" sms_specific_field=\"blah\" /&gt;\n  &lt;sms id=\"2\" text=\"what's up?\" sms_specific_field=\"blah\" /&gt;\n  &lt;mms id=\"3\" text=\"null\" text_only=\"0\"&gt;\n    &lt;parts&gt;\n      &lt;part seq=\"-1\" content=\"image/jpeg\" text=\"null\" data=\"base64_data_here==\" /&gt;\n      &lt;part seq=\"0\" content=\"text/plain\" text=\"Check it out!\" /&gt;\n    &lt;/parts&gt;\n  &lt;/mms&gt;\n  &lt;sms id=\"4\" text=\"what's up?\" sms_specific_field=\"blah\" /&gt;\n&lt;/smses&gt;\n</code></pre>\n\n<p>The <code>sms</code> and <code>mms</code> children of <code>smses</code> can occur in any order. I'd like to unmarshal this data into native Go structs. I thought I could use a slice of interfaces for those like:</p>\n\n<pre><code>Messages []interface{} `xml:\",any\"`  // not sure if this is correct\n</code></pre>\n\n<p>But then how do I get that into marshaled structs for each type?</p>\n\n<p>I was thinking of approaching it like so but not sure if this works to cover both and don't want to spend all the time writing this for structs that will have a ton more attributes if this whole approach won't work anyways:</p>\n\n<pre><code>type Messages struct {\n    XMLName       xml.Name   `xml:\"smses\"`\n    Count         string     `xml:\"count,attr\"`\n    MessageList   []Message  `xml:\",any\"` // &lt;-- will this work?\n}\n\ntype Message struct {\n    SMS           SMS        `xml:\"sms\"`\n    MMS           MMS        `xml:\"mms\"`\n    ID            string     `xml\"id,attr\"`\n    Text          string     `xml:\"text,attr\"`\n}\n\ntype SMS struct {\n    XMLName       xml.Name   `xml:\"sms\"`\n    SMSSpecField  string     `xml:\"sms_specific_field,attr\"`\n}\n\ntype MMS struct {\n    XMLName       xml.Name   `xml:\"mms\"`\n    TextOnly      string     `xml:\"text_only,attr\"`\n    Parts         []Part     `xml:\"parts\"`\n}\n\n... And so on - but I don't know if this approach works / makes sense\n</code></pre>\n\n<p>How do I design my structs in order to unmarshal this XML including attributes and child items?</p>\n"}, {"tags": ["go", "go-interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518639154, "post_id": 48795043, "comment_id": 84593191, "body": "@p-ray <i>&quot;Shouldn&#39;t it be able to call its <b>own</b> method Tick()?&quot;</i> It should be able and it also is able. The error is not from <i>it</i> not being able to call <code>Tick</code> but from the <i>&quot;user&quot;</i> of <code>clocker</code> not being able to call <code>Tick</code>."}, {"owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518736612, "post_id": 48795043, "comment_id": 84639634, "body": "@mkopriva As mentioned in the accepted answer, I think it needs to be converted to implementing struct."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518736942, "post_id": 48795043, "comment_id": 84639732, "body": "What I meant by my comment is that <code>FakeTicker</code> can call its <i>own</i> <code>Tick</code> method, for example from inside of its <i>own</i> <code>Click</code> method. <code>func (f FakeTicker) Click() string { f.Tick(); return f.val }</code>. I&#39;m just being a little pedantic here, feel free to ignore me."}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 4, "last_activity_date": 1518637900, "last_edit_date": 1518637900, "creation_date": 1518637829, "answer_id": 48795109, "question_id": 48795043, "link": "https://stackoverflow.com/questions/48795043/how-to-access-type-methods-that-are-not-defined-in-interface/48795109#48795109", "title": "How to access type methods that are not defined in interface?", "body": "<p>You would need to convert the interface{} to FakeTicker</p>\n\n<pre><code>package main\n\ntype Ticker interface {\n    Click() string\n}\n\ntype FakeTicker struct {\n    val string\n}\n\nfunc (f FakeTicker) Click() string {\n    return f.val\n}\n\nfunc (f FakeTicker) Tick() int { return 1 }\n\nfunc main() {\n    var clocker Ticker\n    clocker = FakeTicker{\"Val\"}\n    fakeTicker := clocker.(FakeTicker)\n    fakeTicker.Tick()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 1, "last_activity_date": 1518647054, "last_edit_date": 1518647054, "creation_date": 1518638051, "answer_id": 48795164, "question_id": 48795043, "link": "https://stackoverflow.com/questions/48795043/how-to-access-type-methods-that-are-not-defined-in-interface/48795164#48795164", "title": "How to access type methods that are not defined in interface?", "body": "<blockquote>\n  <p>I understand that the interface only has method Click() but since FakeWriter is implementing the interface, Shouldn't it be able to call its own method Tick()?</p>\n</blockquote>\n\n<p>Since your <code>clocker</code> variable is defined as the <code>Ticker</code> interface, you only have the methods defined on that interface. If you would like to access the <code>Tick</code> method, you will have to change to the <code>FakeTicker</code> type.</p>\n\n<p>In this case, you can use type assertion.</p>\n\n<pre><code>func main() {   \n    var clocker Ticker    \n    clocker = FakeTicker{\"Val\"}\n    clocker.Click()\n    fake := clocker.(FakeTicker)\n    fake.Tick()    \n}\n</code></pre>\n\n<p>You should note that the type assertion will cause a panic when the assertion fails if you don't use the version with two return types (<code>fake, ok := clocker.(FakeTicker)</code>).</p>\n"}], "owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1212, "favorite_count": 0, "accepted_answer_id": 48795164, "answer_count": 2, "score": 1, "last_activity_date": 1518647054, "creation_date": 1518637506, "question_id": 48795043, "link": "https://stackoverflow.com/questions/48795043/how-to-access-type-methods-that-are-not-defined-in-interface", "title": "How to access type methods that are not defined in interface?", "body": "<p>I have interface that requires its implementor to have Click method.\nHowever, the type FakeTicker that implements this interface also implements Tick method in addition to Click method. </p>\n\n<pre><code>package main\n\n\n\ntype Ticker interface{  \n  Click() string \n}\n\ntype FakeTicker struct{ \n   val string }\n\nfunc (f FakeTicker) Click() string {    \n   return f.val \n}\n\nfunc (f FakeTicker) Tick() int {    return 1 }\n\nfunc main() {   \n  var clocker Ticker    \n  clocker = FakeTicker{\"Val\"}   \n  clocker.Tick()    \n}\n</code></pre>\n\n<p>Here I get the following error \"clocker.Tick undefined (type Ticker has no field or method Tick)\"</p>\n\n<p>I understand that the interface only has method Click() but since FakeWriter is implementing the interface, \nShouldn't it be able to call its own method Tick()?</p>\n"}, {"tags": ["go", "structure"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1518635405, "post_id": 48794529, "comment_id": 84591264, "body": "Check 4 lines above."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518638318, "post_id": 48794529, "comment_id": 84592810, "body": "<code>person</code> != <code>Person</code>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1518635638, "creation_date": 1518635638, "answer_id": 48794597, "question_id": 48794529, "link": "https://stackoverflow.com/questions/48794529/location-of-type-declarations/48794597#48794597", "title": "Location of type declarations", "body": "<p>You're missing the package reference, it should be:</p>\n\n<pre><code>t := dir.Person{\"girlie\", 12}\n//   ^^^^ missing this part\n</code></pre>\n\n<p>Assuming that the line <code>var s dir.Person</code> works, which I'm guessing it does based on the question, which means that your quoted contents of \"st.go\" are not accurate, because the package name is different, and the struct and its fields are not exported.</p>\n"}], "owner": {"reputation": 55, "user_id": 9301799, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/eb051a881076864cefa0edcb05fd5b14?s=128&d=identicon&r=PG", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/9301799/heretolearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1518638302, "creation_date": 1518635321, "last_edit_date": 1518638302, "question_id": 48794529, "link": "https://stackoverflow.com/questions/48794529/location-of-type-declarations", "title": "Location of type declarations", "body": "<p>I am curious if this type of declaration for structs</p>\n\n<pre><code> t := Person{\"girlie\", 12} \n</code></pre>\n\n<p>only works if its type is declared in the same file.<br>\nBelow are my files. </p>\n\n<p><strong>file st.go, type def structure inside to be used in main func</strong></p>\n\n<pre><code> package structs\n\n type person struct {\n     age int\n     name int\n }\n</code></pre>\n\n<p><strong>file practice.go, main function:</strong></p>\n\n<pre><code> package main\n\n import( \n       \"fmt\"\n       \"structs/dir\"\n   )    \n\n   func main() {\n\n        var s dir.Person\n        s.Name = \"She\"\n        s.Age = 12\n\n &gt;&gt;     t := Person{\"girlie\", 12}\n\n\n\n        fmt.Println(s.Name)\n        fmt.Println(t.Name)\n   } \n</code></pre>\n\n<p>As you can see an error occurs where instance t is declared.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518638504, "post_id": 48794280, "comment_id": 84592900, "body": "All type conversions in Go don&#39;t alter the original."}], "answers": [{"tags": [], "owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "is_accepted": true, "score": 3, "last_activity_date": 1518634684, "creation_date": 1518634684, "answer_id": 48794357, "question_id": 48794280, "link": "https://stackoverflow.com/questions/48794280/convert-float-to-string-without-altering-the-float/48794357#48794357", "title": "convert float to string without altering the float", "body": "<p>I think you are just using the wrong format specifier:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    fmt.Println(strconv.FormatFloat(-3.6739403974420544e-15, 'e', -1, 64))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>-3.6739403974420544e-15\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/strconv/#FormatFloat\" rel=\"nofollow noreferrer\">docs</a> show the other formats as well.</p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 2, "last_activity_date": 1518634712, "creation_date": 1518634712, "answer_id": 48794361, "question_id": 48794280, "link": "https://stackoverflow.com/questions/48794280/convert-float-to-string-without-altering-the-float/48794361#48794361", "title": "convert float to string without altering the float", "body": "<p>This should do it</p>\n\n<pre><code>f := -3.6739403974420544e-15\nfmt.Println(fmt.Sprint(f))\n</code></pre>\n"}], "owner": {"reputation": 35121, "user_id": 577455, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/2f5b02182d3fa5ca4afeb39c32f09953?s=128&d=identicon&r=PG", "display_name": "Leahcim", "link": "https://stackoverflow.com/users/577455/leahcim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 1, "accepted_answer_id": 48794357, "answer_count": 2, "score": 0, "last_activity_date": 1518634712, "creation_date": 1518634407, "question_id": 48794280, "link": "https://stackoverflow.com/questions/48794280/convert-float-to-string-without-altering-the-float", "title": "convert float to string without altering the float", "body": "<p>I am converting a float to a string like this in Golang</p>\n\n<pre><code>a := strconv.FormatFloat(-3.6739403974420544e-15, 'f', -1, 64)\n</code></pre>\n\n<p>It's giving me this as output</p>\n\n<pre><code>-0.0000000000000036739403974420544\n</code></pre>\n\n<p>However, I would rather have this as output</p>\n\n<pre><code>   \"-3.673940397442059e-15\"\n</code></pre>\n\n<p>In the title to this question, I said \"without altering\" the float.  By \"altering\" I am referring to the addition of the 0s in place of the e-15. is there a way to do it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 1, "creation_date": 1518635858, "post_id": 48794203, "comment_id": 84591527, "body": "There&#39;s a lot to go through here. I would suggest you make a small <b>git repo</b> or <b><a href=\"https://repl.it/languages/go\" rel=\"nofollow noreferrer\">Repl</a></b> with necessary code &amp; file so that people can debug your situation more easily."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1518636314, "post_id": 48794203, "comment_id": 84591736, "body": "I think you need to have a call to WriteAt instead of Write as then you can set where you want to write to in the file (i.e. start at an offset 0 and keep track of the offset)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518636482, "post_id": 48794203, "comment_id": 84591824, "body": "I don&#39;t see any calls to Seek or WriteAt, so you&#39;re always writing at the current offset. It would be easier to figure out what you want if you created a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1518653370, "post_id": 48794203, "comment_id": 84599088, "body": "Agree with above comments about creating a repo with an example, but in giving the code a quick skim, it appears that it may be appending because there is no call to Seek(0, 0) to reset the file pointer to the beginning of the file after doing all the reads, and before calling file.WriteString(). See <a href=\"https://golang.org/pkg/os/#File.Seek\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#File.Seek</a>."}], "answers": [{"tags": [], "owner": {"reputation": 768, "user_id": 1038386, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOhSk.jpg?s=128&g=1", "display_name": "Meehow", "link": "https://stackoverflow.com/users/1038386/meehow"}, "is_accepted": false, "score": 1, "last_activity_date": 1518654556, "creation_date": 1518654556, "answer_id": 48798421, "question_id": 48794203, "link": "https://stackoverflow.com/questions/48794203/file-appending-and-not-overwriting-in-app/48798421#48798421", "title": "File appending and not overwriting in app", "body": "<p>It appends data because the cursor is at the end of the file when you finish reading. You can use <code>Seek()</code> to move the cursor, or just open it in reading more (<code>os.Open()</code>) and then overwrite (<code>os.Create()</code>) when you are done with reading.</p>\n"}], "owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518654556, "creation_date": 1518634071, "question_id": 48794203, "link": "https://stackoverflow.com/questions/48794203/file-appending-and-not-overwriting-in-app", "title": "File appending and not overwriting in app", "body": "<p>I have a short GO app that I built to modify config files and had expected them to overwrite, but instead they are appending and I'm not sure why. I've tried <code>os.Truncate()</code> prior to my <code>file.Sync()</code> but end up with a malformed file. I've also attempted to write to a tmpfile, but end up with index errors and feel this is not worth the attempt. I expect the file to open, read in, modify and overwrite the existing content. It also looks as though the file is not completing to write? Maybe the buffer? What am I doing wrong?</p>\n\n<p>App</p>\n\n<pre><code>package main\n\nimport (\n  \"strings\"\n  \"bufio\"\n  \"fmt\"\n  \"regexp\"\n  \"flag\"\n  \"os\"\n  \"io\"\n  \"bytes\"\n)\n\nvar (\n  filename  string\n)\n\nfunc isCommentOrBlank(line string) bool {\n  return strings.HasPrefix(line, \"#\") || \"\" == strings.TrimSpace(line)\n}\n\nfunc fileExists(filename string) bool {\n  if _, err := os.Stat(filename); err == nil {\n    return true\n  }\n  return false\n}\n\nfunc limitLength(s string, length int) string {\n  if len(s) &lt; length {\n    return s\n  }\n  return s[:length]\n}\n\nfunc padWithSpace(str, pad string, length int) string {\n    for {\n        str += pad\n        if len(str) &gt; length {\n            return str[0:length]\n        }\n    }\n}\n\nfunc ingest(filename string) (err error) {\n  file, err := os.OpenFile(filename, os.O_RDWR, 0644)\n  defer file.Close()\n\n  if err != nil {\n    return err\n  }\n\n  reader := bufio.NewReader(file) // Start reading from the file with a reader.\n\n  for {\n    var buffer bytes.Buffer\n    var l []byte\n    var isPrefix bool\n\n    for {\n      l, isPrefix, err = reader.ReadLine()\n      buffer.Write(l)\n      if !isPrefix {\n        break\n      }\n    }\n\n    if err == io.EOF || err != nil {\n      break\n    }\n\n    line    := buffer.String()\n    pattern := regexp.MustCompile(`^#([^=]+)=(.+)$`)\n    matches := pattern.FindAllStringSubmatch(line, -1) // matches is [][]string\n\n    for _, string := range matches {\n      n := strings.Replace(strings.TrimSpace(string[1]), \"#\", \"\", -1)\n      v := strings.TrimSpace(string[2])\n      e := strings.ToLower(strings.Replace(n, \".\", \"/\", -1))\n\n      // newline creation for if block\n      nl := \"{{if exists \\\"/\" + e + \"\\\" -}}\\n\"\n      nl += padWithSpace(n, \" \", 80) + \"= {{getv \\\"/\" + e + \"\\\" \\\"\" + v + \"\\\"}}\\n\"\n      nl += \"{{end -}}\\n\"\n      file.WriteString(nl)\n    }\n\n    // dont proccess comments\n    if (isCommentOrBlank(line)) {\n      if (!strings.Contains(line, \"=\")) {\n        file.WriteString(line + \"\\n\")\n      }\n    } else {\n      a := strings.Split(line, \"=\")\n      n := strings.TrimSpace(a[0])\n      v := strings.TrimSpace(a[1])\n      e := strings.ToLower(strings.Replace(n, \".\", \"/\", -1))\n      file.WriteString(padWithSpace(n, \" \", 80) + \"= {{getv \\\"/\" + e + \"\\\" \\\"\" + v + \"\\\"}}\\n\")\n    }\n  }\n\n  file.Sync()\n\n  if err != io.EOF {\n    fmt.Printf(\" &gt; Failed!: %v\\n\", err)\n  }\n  return\n}\n\nfunc main() {\n  flag.StringVar(&amp;filename, \"f\", \"filename\", \"The file location to be parsed\")\n  flag.Parse()\n\n  if !fileExists(filename) {\n    fmt.Println(\" &gt; File does not exist\\n\")\n  }\n\n  ingest(filename)\n}\n</code></pre>\n\n<p>Config to rewrite</p>\n\n<pre><code># The file contains the properties for Chaos Monkey.\n# see documentation at:\n# https://github.com/Netflix/SimianArmy/wiki/Configuration\n\n# let chaos run\nsimianarmy.chaos.enabled = true\n\n# don't allow chaos to kill (ie dryrun mode)\nsimianarmy.chaos.leashed = true\n\n# set to \"false\" for Opt-In behavior, \"true\" for Opt-Out behavior\nsimianarmy.chaos.ASG.enabled = false\n\n# uncomment this line to use tunable aggression\n#simianarmy.client.chaos.class = com.netflix.simianarmy.tunable.TunablyAggressiveChaosMonkey\n\n# default probability for all ASGs\nsimianarmy.chaos.ASG.probability = 1.0\n\n# increase or decrease the termination limit\nsimianarmy.chaos.ASG.maxTerminationsPerDay = 1.0\n\n# Strategies\nsimianarmy.chaos.shutdowninstance.enabled = true\nsimianarmy.chaos.blockallnetworktraffic.enabled = false\nsimianarmy.chaos.burncpu.enabled = false\nsimianarmy.chaos.killprocesses.enabled = false\nsimianarmy.chaos.nullroute.enabled = false\nsimianarmy.chaos.failapi.enabled = false\nsimianarmy.chaos.faildns.enabled = false\nsimianarmy.chaos.faildynamodb.enabled = false\nsimianarmy.chaos.fails3.enabled = false\nsimianarmy.chaos.networkcorruption.enabled = false\nsimianarmy.chaos.networklatency.enabled = false\nsimianarmy.chaos.networkloss.enabled = false\n\n# Force-detaching EBS volumes may cause data loss\nsimianarmy.chaos.detachvolumes.enabled = false\n\n# FillDisk fills the root disk.\n# NOTE: This may incur charges for an EBS root volume.  See burnmoney option.\nsimianarmy.chaos.burnio.enabled = false\n# BurnIO causes disk activity on the root disk.\n# NOTE: This may incur charges for an EBS root volume. See burnmoney option.\nsimianarmy.chaos.filldisk.enabled = false\n\n# Where we know the chaos strategy will incur charges, we won't run it unless burnmoney is true.\nsimianarmy.chaos.burnmoney = false\n\n\n# enable a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.enabled = true\n# simianarmy.chaos.ASG.&lt;asgName&gt;.probability = 1.0\n\n# increase or decrease the termination limit for a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.maxTerminationsPerDay = 1.0\n\n# Enroll in mandatory terminations.  If a group has not had a\n# termination within the windowInDays range then it will terminate\n# one instance in the group with a 0.5 probability (at some point in\n# the next 2 days an instance should be terminated), then\n# do nothing again for windowInDays.  This forces \"enabled\" groups\n# that have a probability of 0.0 to have terminations periodically.\nsimianarmy.chaos.mandatoryTermination.enabled = false\nsimianarmy.chaos.mandatoryTermination.windowInDays = 32\nsimianarmy.chaos.mandatoryTermination.defaultProbability = 0.5\n\n# Enable notification for Chaos termination for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.notification.enabled = true\n\n# Set the destination email the termination notification sent to for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.ownerEmail = foo@bar.com\n\n# Set the source email that sends the termination notification\n# simianarmy.chaos.notification.sourceEmail = foo@bar.com\n\n# Enable notification for Chaos termination for all instance groups\n#simianarmy.chaos.notification.global.enabled = true\n\n# Set the destination email the termination notification is sent to for all instance groups\n#simianarmy.chaos.notification.global.receiverEmail = foo@bar.com\n\n# Set a prefix applied to the subject of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.subject.prefix = SubjectPrefix\n\n# Set a suffix applied to the subject of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n#simianarmy.chaos.notification.subject.suffix =  \\ SubjectSuffix\n\n# Set a prefix applied to the body of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.body.prefix = BodyPrefix\n\n# Set a suffix applied to the body of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n#simianarmy.chaos.notification.body.suffix =  \\ BodySuffix\n\n# Enable the email subject to be the same as the body, to include terminated instance and group information\n#simianarmy.chaos.notification.subject.isBody = true\n#set the tag filter on the ASGs to terminate only instances from the ASG with the this tag key and value\n#simianarmy.chaos.ASGtag.key = chaos_monkey\n#simianarmy.chaos.ASGtag.value = true\n</code></pre>\n\n<p>Actual Output</p>\n\n<pre><code># The file contains the properties for Chaos Monkey.\n# see documentation at:\n# https://github.com/Netflix/SimianArmy/wiki/Configuration\n\n# let chaos run\nsimianarmy.chaos.enabled = true\n\n# don't allow chaos to kill (ie dryrun mode)\nsimianarmy.chaos.leashed = true\n\n# set to \"false\" for Opt-In behavior, \"true\" for Opt-Out behavior\nsimianarmy.chaos.ASG.enabled = false\n\n# uncomment this line to use tunable aggression\n#simianarmy.client.chaos.class = com.netflix.simianarmy.tunable.TunablyAggressiveChaosMonkey\n\n# default probability for all ASGs\nsimianarmy.chaos.ASG.probability = 1.0\n\n# increase or decrease the termination limit\nsimianarmy.chaos.ASG.maxTerminationsPerDay = 1.0\n\n# Strategies\nsimianarmy.chaos.shutdowninstance.enabled = true\nsimianarmy.chaos.blockallnetworktraffic.enabled = false\nsimianarmy.chaos.burncpu.enabled = false\nsimianarmy.chaos.killprocesses.enabled = false\nsimianarmy.chaos.nullroute.enabled = false\nsimianarmy.chaos.failapi.enabled = false\nsimianarmy.chaos.faildns.enabled = false\nsimianarmy.chaos.faildynamodb.enabled = false\nsimianarmy.chaos.fails3.enabled = false\nsimianarmy.chaos.networkcorruption.enabled = false\nsimianarmy.chaos.networklatency.enabled = false\nsimianarmy.chaos.networkloss.enabled = false\n\n# Force-detaching EBS volumes may cause data loss\nsimianarmy.chaos.detachvolumes.enabled = false\n\n# FillDisk fills the root disk.\n# NOTE: This may incur charges for an EBS root volume.  See burnmoney option.\nsimianarmy.chaos.burnio.enabled = false\n# BurnIO causes disk activity on the root disk.\n# NOTE: This may incur charges for an EBS root volume. See burnmoney option.\nsimianarmy.chaos.filldisk.enabled = false\n\n# Where we know the chaos strategy will incur charges, we won't run it unless burnmoney is true.\nsimianarmy.chaos.burnmoney = false\n\n\n# enable a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.enabled = true\n# simianarmy.chaos.ASG.&lt;asgName&gt;.probability = 1.0\n\n# increase or decrease the termination limit for a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.maxTerminationsPerDay = 1.0\n\n# Enroll in mandatory terminations.  If a group has not had a\n# termination within the windowInDays range then it will terminate\n# one instance in the group with a 0.5 probability (at some point in\n# the next 2 days an instance should be terminated), then\n# do nothing again for windowInDays.  This forces \"enabled\" groups\n# that have a probability of 0.0 to have terminations periodically.\nsimianarmy.chaos.mandatoryTermination.enabled = false\nsimianarmy.chaos.mandatoryTermination.windowInDays = 32\nsimianarmy.chaos.mandatoryTermination.defaultProbability = 0.5\n\n# Enable notification for Chaos termination for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.notification.enabled = true\n\n# Set the destination email the termination notification sent to for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.ownerEmail = foo@bar.com\n\n# Set the source email that sends the termination notification\n# simianarmy.chaos.notification.sourceEmail = foo@bar.com\n\n# Enable notification for Chaos termination for all instance groups\n#simianarmy.chaos.notification.global.enabled = true\n\n# Set the destination email the termination notification is sent to for all instance groups\n#simianarmy.chaos.notification.global.receiverEmail = foo@bar.com\n\n# Set a prefix applied to the subject of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.subject.prefix = SubjectPrefix\n\n# Set a suffix applied to the subject of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n#simianarmy.chaos.notification.subject.suffix =  \\ SubjectSuffix\n\n# Set a prefix applied to the body of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.body.prefix = BodyPrefix\n\n# Set a suffix applied to the body of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separa# The file contains the properties for Chaos Monkey.\n# see documentation at:\n# https://github.com/Netflix/SimianArmy/wiki/Configuration\n\n# let chaos run\nsimianarmy.chaos.enabled                                                        = {{getv \"/simianarmy/chaos/enabled\" \"true\"}}\n\n# don't allow chaos to kill (ie dryrun mode)\nsimianarmy.chaos.leashed                                                        = {{getv \"/simianarmy/chaos/leashed\" \"true\"}}\n\n# set to \"false\" for Opt-In behavior, \"true\" for Opt-Out behavior\nsimianarmy.chaos.ASG.enabled                                                    = {{getv \"/simianarmy/chaos/asg/enabled\" \"false\"}}\n\n# uncomment this line to use tunable aggression\n{{if exists \"/simianarmy/client/chaos/class\" -}}\nsimianarmy.client.chaos.class                                                   = {{getv \"/simianarmy/client/chaos/class\" \"com.netflix.simianarmy.tunable.TunablyAggressiveChaosMonkey\"}}\n{{end -}}\n\n# default probability for all ASGs\nsimianarmy.chaos.ASG.probability                                                = {{getv \"/simianarmy/chaos/asg/probability\" \"1.0\"}}\n\n# increase or decrease the termination limit\nsimianarmy.chaos.ASG.maxTerminationsPerDay                                      = {{getv \"/simianarmy/chaos/asg/maxterminationsperday\" \"1.0\"}}\n\n# Strategies\nsimianarmy.chaos.shutdowninstance.enabled                                       = {{getv \"/simianarmy/chaos/shutdowninstance/enabled\" \"true\"}}\nsimianarmy.chaos.blockallnetworktraffic.enabled                                 = {{getv \"/simianarmy/chaos/blockallnetworktraffic/enabled\" \"false\"}}\nsimianarmy.chaos.burncpu.enabled                                                = {{getv \"/simianarmy/chaos/burncpu/enabled\" \"false\"}}\nsimianarmy.chaos.killprocesses.enabled                                          = {{getv \"/simianarmy/chaos/killprocesses/enabled\" \"false\"}}\nsimianarmy.chaos.nullroute.enabled                                              = {{getv \"/simianarmy/chaos/nullroute/enabled\" \"false\"}}\nsimianarmy.chaos.failapi.enabled                                                = {{getv \"/simianarmy/chaos/failapi/enabled\" \"false\"}}\nsimianarmy.chaos.faildns.enabled                                                = {{getv \"/simianarmy/chaos/faildns/enabled\" \"false\"}}\nsimianarmy.chaos.faildynamodb.enabled                                           = {{getv \"/simianarmy/chaos/faildynamodb/enabled\" \"false\"}}\nsimianarmy.chaos.fails3.enabled                                                 = {{getv \"/simianarmy/chaos/fails3/enabled\" \"false\"}}\nsimianarmy.chaos.networkcorruption.enabled                                      = {{getv \"/simianarmy/chaos/networkcorruption/enabled\" \"false\"}}\nsimianarmy.chaos.networklatency.enabled                                         = {{getv \"/simianarmy/chaos/networklatency/enabled\" \"false\"}}\nsimianarmy.chaos.networkloss.enabled                                            = {{getv \"/simianarmy/chaos/networkloss/enabled\" \"false\"}}\n\n# Force-detaching EBS volumes may cause data loss\nsimianarmy.chaos.detachvolumes.enabled                                          = {{getv \"/simianarmy/chaos/detachvolumes/enabled\" \"false\"}}\n\n# FillDisk fills the root disk.\n# NOTE: This may incur charges for an EBS root volume.  See burnmoney option.\nsimianarmy.chaos.burnio.enabled                                                 = {{getv \"/simianarmy/chaos/burnio/enabled\" \"false\"}}\n# BurnIO causes disk activity on the root disk.\n# NOTE: This may incur charges for an EBS root volume. See burnmoney option.\nsimianarmy.chaos.filldisk.enabled                                               = {{getv \"/simianarmy/chaos/filldisk/enabled\" \"false\"}}\n\n# Where we know the chaos strategy will incur charges, we won't run it unless burnmoney is true.\nsimianarmy.chaos.burnmoney                                                      = {{getv \"/simianarmy/chaos/burnmoney\" \"false\"}}\n\n\n# enable a specific ASG\n{{if exists \"/simianarmy/chaos/asg/&lt;asgname&gt;/enabled\" -}}\nsimianarmy.chaos.ASG.&lt;asgName&gt;.enabled                                          = {{getv \"/simianarmy/chaos/asg/&lt;asgname&gt;/enabled\" \"true\"}}\n{{end -}}\n{{if exists \"/simianarmy/chaos/asg/&lt;asgname&gt;/probability\" -}}\nsimianarmy.chaos.ASG.&lt;asgName&gt;.probability                                      = {{getv \"/simianarmy/chaos/asg/&lt;asgname&gt;/probability\" \"1.0\"}}\n{{end -}}\n\n# increase or decrease the termination limit for a specific ASG\n{{if exists \"/simianarmy/chaos/asg/&lt;asgname&gt;/maxterminationsperday\" -}}\nsimianarmy.chaos.ASG.&lt;asgName&gt;.maxTerminationsPerDay                            = {{getv \"/simianarmy/chaos/asg/&lt;asgname&gt;/maxterminationsperday\" \"1.0\"}}\n{{end -}}\n\n# Enroll in mandatory terminations.  If a group has not had a\n# termination within the windowInDays range then it will terminate\n# one instance in the group with a 0.5 probability (at some point in\n# the next 2 days an instance should be terminated), then\n# do nothing again for windowInDays.  This forces \"enabled\" groups\n# that have a probability of 0.0 to have terminations periodically.\nsimianarmy.chaos.mandatoryTermination.enabled                                   = {{getv \"/simianarmy/chaos/mandatorytermination/enabled\" \"false\"}}\nsimianarmy.chaos.mandatoryTermination.windowInDays                              = {{getv \"/simianarmy/chaos/mandatorytermination/windowindays\" \"32\"}}\nsimianarmy.chaos.mandatoryTermination.defaultProbability                        = {{getv \"/simianarmy/chaos/mandatorytermination/defaultprobability\" \"0.5\"}}\n\n# Enable notification for Chaos termination for a specific instance group\n{{if exists \"/simianarmy/chaos/&lt;grouptype&gt;/&lt;groupname&gt;/notification/enabled\" -}}\nsimianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.notification.enabled                   = {{getv \"/simianarmy/chaos/&lt;grouptype&gt;/&lt;groupname&gt;/notification/enabled\" \"true\"}}\n{{end -}}\n\n# Set the destination email the termination notification sent to for a specific instance group\n{{if exists \"/simianarmy/chaos/&lt;grouptype&gt;/&lt;groupname&gt;/owneremail\" -}}\nsimianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.ownerEmail                             = {{getv \"/simianarmy/chaos/&lt;grouptype&gt;/&lt;groupname&gt;/owneremail\" \"foo@bar.com\"}}\n{{end -}}\n\n# Set the source email that sends the termination notification\n{{if exists \"/simianarmy/chaos/notification/sourceemail\" -}}\nsimianarmy.chaos.notification.sourceEmail                                       = {{getv \"/simianarmy/chaos/notification/sourceemail\" \"foo@bar.com\"}}\n{{end -}}\n\n# Enable notification for Chaos termination for all instance groups\n{{if exists \"/simianarmy/chaos/notification/global/enabled\" -}}\nsimianarmy.chaos.notification.global.enabled                                    = {{getv \"/simianarmy/chaos/notification/global/enabled\" \"true\"}}\n{{end -}}\n\n# Set the destination email the termination notification is sent to for all instance groups\n{{if exists \"/simianarmy/chaos/notification/global/receiveremail\" -}}\nsimianarmy.chaos.notification.global.receiverEmail                              = {{getv \"/simianarmy/chaos/notification/global/receiveremail\" \"foo@bar.com\"}}\n{{end -}}\n\n# Set a prefix applied to the subject of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n{{if exists \"/simianarmy/chaos/notification/subject/prefix\" -}}\nsimianarmy.chaos.notification.subject.prefix                                    = {{getv \"/simianarmy/chaos/notification/subject/prefix\" \"SubjectPrefix\"}}\n{{end -}}\n\n# Set a suffix applied to the subject of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n{{if exists \"/simianarmy/chaos/notification/subject/suffix\" -}}\nsimianarmy.chaos.notification.subject.suffix                                    = {{getv \"/simianarmy/chaos/notification/subject/suffix\" \"\\ SubjectSuffix\"}}\n{{end -}}\n\n# Set a prefix applied to the body of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n{{if exists \"/simianarmy/chaos/notification/body/prefix\" -}}\nsimianarmy.chaos.notification.body.prefix                                       = {{getv \"/simianarmy/chaos/notification/body/prefix\" \"BodyPrefix\"}}\n{{end -}}\n\n# Set a suffix applied to the body of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separa\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518633666, "post_id": 48794087, "comment_id": 84590327, "body": "Query the object back out after you upsert it."}, {"owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518634094, "post_id": 48794087, "comment_id": 84590555, "body": "But where&#39;s the ID to query it back?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518634390, "post_id": 48794087, "comment_id": 84590723, "body": "In your object. This is clearly an update of an existing object based on your quoted output, which means you already have the ID."}, {"owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518634637, "post_id": 48794087, "comment_id": 84590851, "body": "Nope, I&#39;m trying to insert for the first. Based on the documentation I&#39;ve found so far, the <code>Insert</code> does not provide the ID either, so it was suggested to the Upsert method instead"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518635858, "post_id": 48794087, "comment_id": 84591528, "body": "The upsert result implies you&#39;re updating an existing document."}, {"owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "edited": false, "score": 0, "creation_date": 1518659941, "post_id": 48794087, "comment_id": 84600737, "body": "Consider providing the code for the struct as well. Does your struct have the <code>bson:&quot;_id&quot;</code>tag?"}, {"owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 0, "creation_date": 1518678555, "post_id": 48794087, "comment_id": 84605828, "body": "I have tried using the Insert also, but I&#39;ve run into the same problem where I couldn&#39;t get the ID of the document afterwards. After searching it was suggested to Upsert instead. I have added the struct and no, there&#39;s no ID tag."}], "answers": [{"comments": [{"owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 0, "creation_date": 1518692306, "post_id": 48803000, "comment_id": 84613826, "body": "Thank you for your detailed response. I&#39;m still struggling to get it to work. I&#39;m trying to use Insert as you suggest, but the document is created without a proper ID (ISBN) and I still don&#39;t get the document back after its creation. Would you be able to provide an example based on the code I&#39;ve provided?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 1, "creation_date": 1518695556, "post_id": 48803000, "comment_id": 84615867, "body": "@WagnerMatosUK If you don&#39;t have the ISBN when saving the book, then you must use a generated ID as the document ID. See the last section of my answer. You set the ID prior to saving, and if the insertion succeeds, the ID will be exactly what you set prior to calling <code>Insert()</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 1, "creation_date": 1518698107, "post_id": 48803000, "comment_id": 84617578, "body": "@WagnerMatosUK Added example how you can handle if ISBN is not always known."}, {"owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 0, "creation_date": 1518703027, "post_id": 48803000, "comment_id": 84621032, "body": "I&#39;m getting <code>cannot use bson.NewObjectId() (type bson.ObjectId) as type string in assignment</code> when trying to use <code>book.ID = bson.NewObjectId()</code>. Any idea why?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "edited": false, "score": 1, "creation_date": 1518703085, "post_id": 48803000, "comment_id": 84621083, "body": "@WagnerMatosUK Because if you check my example, <code>Book.ID</code> is of type <code>bson.ObjectId</code> not <code>string</code>. Fix your code."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1518697661, "last_edit_date": 1518697661, "creation_date": 1518683908, "answer_id": 48803000, "question_id": 48794087, "link": "https://stackoverflow.com/questions/48794087/how-to-insert-a-document-with-mgo-and-get-the-value-returned/48803000#48803000", "title": "How to insert a document with mgo and get the value returned", "body": "<p>Let's clear the concepts first. In MongoDB, each document must have an <code>_id</code> property which acts as its unique document identifier inside a collection. Either you provide the value of this <code>_id</code> or it is assigned automatically by MongoDB.</p>\n\n<p>So it would be ideal (or it's strongly recommended) for your model types to include a field for the <code>_id</code> document identifier. Since we're talking about books here, books already have a unique identifier called ISBN, which you may opt to use as the value of the <code>_id</code> field.</p>\n\n<p>The mapping between MongoDB fields and Go struct fields must be specified using the <code>bson</code> tag (not <code>json</code>). So you should provide <code>bson</code> tag values along with <code>json</code> tags.</p>\n\n<p>So change your model to:</p>\n\n<pre><code>type Book struct {\n  ISBN    string   `json:\"isbn\" bson:\"_id\"`\n  Title   string   `json:\"title\" bson:\"title\"`\n  Authors []string `json:\"authors\" bson:\"authors\"`\n  Price   string   `json:\"price\" bson:\"price\"`\n}\n</code></pre>\n\n<p>If you want to insert a new document (a new book), you should always use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Insert\" rel=\"nofollow noreferrer\"><code>Collection.Insert()</code></a>.</p>\n\n<p>And what will be the ID of the newly inserted document? The field you set to the <code>Book.ISBN</code> field as we declared it to be the document ID with the <code>bson:\"_id\"</code> tag.</p>\n\n<p>You should only use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Upsert\" rel=\"nofollow noreferrer\"><code>Collection.Upsert()</code></a> if you are not sure whether the document already exists, but either way you want it to be the document you have at hand. <code>Collection.Upsert()</code> will try to find a document to update, and if one is found, that will be updated. If no document is found, then an insert operation will be performed. The first parameter is the selector to find the document to be updated. Since you passed <code>nil</code>, that means any document may qualify, so one will be selected \"randomly\". So if you already have books saved, any may get selected and get overwritten. This is certainly not want you want.</p>\n\n<p>Since now the ISBN is the ID, you should specify a selector that filters by ISBN, like this:</p>\n\n<pre><code>info, err := c.Upsert(bson.M{\"_id\": book.ISBN}, book)\n</code></pre>\n\n<p>Or since we're filtering by ID, use the more convenient <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.UpsertId\" rel=\"nofollow noreferrer\"><code>Collection.UpsertId()</code></a>:</p>\n\n<pre><code>info, err := c.UpsertId(book.ISBN, book)\n</code></pre>\n\n<p>If you want to update an existing document, for that you may use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Update\" rel=\"nofollow noreferrer\"><code>Collection.Update()</code></a>. This is similar to <code>Collection.Upsert()</code>, but the difference is that if no documents match the selector, an insert will not be performed. Updating a document matched by ID can also be done with the more convenient <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.UpdateId\" rel=\"nofollow noreferrer\"><code>Collection.UpdateId()</code></a> (which is analogue to <code>Collection.UpsertId()</code>).</p>\n\n<p>For other documents which do not have a unique identifier naturally (like books having ISBN), you may use generated IDs. The <code>mgo</code> library provides the <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#NewObjectId\" rel=\"nofollow noreferrer\"><code>bson.NewObjectId()</code></a> function for such purpose, which returns you a value of type <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#ObjectId\" rel=\"nofollow noreferrer\"><code>bson.ObjectId</code></a>. When saving new documents with <code>Collection.Insert()</code>, you can acquire a new unique ID with <code>bson.NewObjectId()</code> and assign it to the struct field that is mapped to the MongoDB <code>_id</code> property. If the insert succeeds, you can be sure the document's ID is what you just set before calling <code>Collection.Insert()</code>. This ID generation is designed to work even in a distributed environment, so it will generate unique IDs even if 2 of your nodes attempt to generate an ID at the same time.</p>\n\n<p>So for example if you don't have the ISBN for a book when saving it, then you must have a separate, designated ID field in your <code>Book</code> type, for example:</p>\n\n<pre><code>type Book struct {\n  ID      bson.ObjectId `bson:\"_id\"`\n  ISBN    string        `json:\"isbn\" bson:\"isbn\"`\n  Title   string        `json:\"title\" bson:\"title\"`\n  Authors []string      `json:\"authors\" bson:\"authors\"`\n  Price   string        `json:\"price\" bson:\"price\"`\n}\n</code></pre>\n\n<p>And when saving a new book:</p>\n\n<pre><code>var book Book\n// Fill what you have about the book\nbook.ID = bson.NewObjectId()\n\nc := session.DB(\"store\").C(\"books\")\nerr = c.Insert(book)\n// check error\n// If no error, you can refer to this document via book.ID\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 4444602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XE6G8ZRSEOw/AAAAAAAAAAI/AAAAAAAAABM/simREUpudgA/photo.jpg?sz=128", "display_name": "Tsony Tsonev", "link": "https://stackoverflow.com/users/4444602/tsony-tsonev"}, "is_accepted": false, "score": 0, "last_activity_date": 1548250418, "last_edit_date": 1548250418, "creation_date": 1547038346, "answer_id": 54110598, "question_id": 48794087, "link": "https://stackoverflow.com/questions/48794087/how-to-insert-a-document-with-mgo-and-get-the-value-returned/54110598#54110598", "title": "How to insert a document with mgo and get the value returned", "body": "<p>Banged my head for a while on this.</p>\n\n<pre><code>info, err := c.Upsert(nil, book)\n</code></pre>\n\n<p>The <code>nil</code> selector for the upsert will match everything so if your collection is empty the selector won't match and all will be fine, the info object will contain the ObjectId in the UpsertedId field, but on every following upsert with nil selector the collection will have records and the nil selector for the upsert will match, therefore it won't return you the UpsertedId and you will be updating the first matched record.</p>\n\n<p><strong>You could use never matching selector</strong> for the upsert (which was my solution), but note that this way you will only insert and get the inserted ObjectId and never update a record.</p>\n\n<p>You can checkout the following test:</p>\n\n<pre><code>func TestFoo(t *testing.T) {\n    foo := struct {\n        Bar string `bson:\"bar\"`\n    }{\n        Bar: \"barrr\",\n    }\n\n    session, _ := mgo.DialWithInfo(&amp;mgo.DialInfo{\n        Addrs: []string{\"127.0.0.1:27017\"},\n    })\n\n    coll := session.DB(\"foo\").C(\"bar\")\n    coll.DropCollection()\n\n    info, _ := coll.Upsert(nil, foo) // will insert\n    count, _ := coll.Count()\n    fmt.Printf(\"%+v, collecton records:%v\\n\", info, count) // &amp;{Updated:0 Removed:0 Matched:0 UpsertedId:ObjectIdHex(\"5c35e8ee1f5b80c932b44afb\")}, collection records:1\n\n    info, _ = coll.Upsert(bson.M{}, foo) // will update\n    count, _ = coll.Count()\n    fmt.Printf(\"%+v, collecton records:%v\\n\", info, count) // &amp;{Updated:1 Removed:0 Matched:1 UpsertedId:&lt;nil&gt;}, collection records:1\n\n    info, _ = coll.Upsert(bson.M{\"nonsense\": -1}, foo) // will insert duplicate record (due to the selector that will never match anything)\n    count, _ = coll.Count()\n    fmt.Printf(\"%+v, collecton records:%v\\n\", info, count) // &amp;{Updated:0 Removed:0 Matched:0 UpsertedId:ObjectIdHex(\"5c35ea2a1f5b80c932b44b1d\")}, collection records:2\n\n    foo.Bar = \"baz\"\n    info, _ = coll.Upsert(nil, foo) // will update the first matched (since the selector matches everything)\n    count, _ = coll.Count()\n    fmt.Printf(\"%+v, collecton records:%v\\n\", info, count)\n\n    // after the test the collection will have the following records\n    //&gt; use foo\n    //&gt; db.bar.find()\n    //{ \"_id\" : ObjectId(\"5c35ebf41f5b80c932b44b81\"), \"bar\" : \"baz\" } // the first matched on the last update with nil selector\n    //{ \"_id\" : ObjectId(\"5c35ebf41f5b80c932b44b86\"), \"bar\" : \"barrr\" } // the duplicated record with the selector that never matches anything\n\n}\n</code></pre>\n\n<p><strong>EDIT:</strong> Note that you should have an index on the never matching field, or your insert query will take too long if you have many records, because the upsert on not indexed filed will scan all the documents in the collection.</p>\n"}], "owner": {"reputation": 3821, "user_id": 1000514, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/bd33755d13025ff0394a92993f23257e?s=128&d=identicon&r=PG", "display_name": "WagnerMatosUK", "link": "https://stackoverflow.com/users/1000514/wagnermatosuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3939, "favorite_count": 0, "accepted_answer_id": 48803000, "answer_count": 2, "score": 3, "last_activity_date": 1548250418, "creation_date": 1518633544, "last_edit_date": 1518678475, "question_id": 48794087, "link": "https://stackoverflow.com/questions/48794087/how-to-insert-a-document-with-mgo-and-get-the-value-returned", "title": "How to insert a document with mgo and get the value returned", "body": "<p>For the record, I'm learning Go. I'm trying to use and the mgo package and I'd like to insert a new document and return this newly created document to user (I'm trying to write a basic API). I've wrote the following code:</p>\n\n<p><strong>EDIT: Here's the struct for the model:</strong></p>\n\n<pre><code>type Book struct {\n  ISBN    string   `json:\"isbn\"`\n  Title   string   `json:\"title\"`\n  Authors []string `json:\"authors\"`\n  Price   string   `json:\"price\"`\n}\n\nsession := s.Copy()\ndefer session.Close()\n\nvar book Book\ndecoder := json.NewDecoder(r.Body)\nerr := decoder.Decode(&amp;book)\nif err != nil {\n    ErrorWithJSON(w, \"Incorrect body\", http.StatusBadRequest)\n    return\n}\n\nc := session.DB(\"store\").C(\"books\")\n\ninfo, err := c.Upsert(nil, book)\n\nif err != nil {\n    ErrorWithJSON(w, \"Database error\", http.StatusInternalServerError)\nlog.Println(\"Failed insert book: \", err)\n    return\n}\n\nrespBody, err := json.MarshalIndent(info, \"\", \"  \")\nif err != nil {\n    log.Fatal(err)\n}\n\nResponseWithJSON(w, respBody, http.StatusOK)\n</code></pre>\n\n<p>Please note that Book is a struct I have created earlier. The above code does work but what it returns is the upsert result like so:</p>\n\n<pre><code>{\n    \"Updated\": 1,\n    \"Removed\": 0,\n    \"Matched\": 1,\n    \"UpsertedId\": null\n}\n</code></pre>\n\n<p>Which is not the recently created object. How can I get the the recently created object to return as a response (please note that ideally I'd like the confirmation that the document was successfully inserted. I have seen other questions where the ID is generated beforehand but for what I've seen it doesn't confirm that the document was created was it?)</p>\n"}, {"tags": ["go", "struct", "type-conversion"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518638656, "post_id": 48793889, "comment_id": 84592973, "body": "What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518645439, "post_id": 48793889, "comment_id": 84596268, "body": "See also <a href=\"https://stackoverflow.com/questions/48697961/unmarshal-2-different-structs-in-a-slice\" title=\"unmarshal 2 different structs in a slice\">stackoverflow.com/questions/48697961/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 0, "last_activity_date": 1518633041, "creation_date": 1518633041, "answer_id": 48793965, "question_id": 48793889, "link": "https://stackoverflow.com/questions/48793889/unmarshalling-array-into-struct/48793965#48793965", "title": "Unmarshalling array into struct", "body": "<p>This would work</p>\n\n<pre><code>package main\n\ntype CatalogBank struct {\n   Icon []interface{} `json:\"icon\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7503, "user_id": 1059273, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f49fd78553be0a74aef8736864937b5d?s=128&d=identicon&r=PG", "display_name": "cjds", "link": "https://stackoverflow.com/users/1059273/cjds"}, "is_accepted": false, "score": 0, "last_activity_date": 1518641505, "last_edit_date": 1518641505, "creation_date": 1518640619, "answer_id": 48795770, "question_id": 48793889, "link": "https://stackoverflow.com/questions/48793889/unmarshalling-array-into-struct/48795770#48795770", "title": "Unmarshalling array into struct", "body": "<p>This is a little tricky in Golang because of the non-strict type in the JSON. If that is definitely the format you are going to receive the data in, you should unmarshal to an <code>Interface{}</code> and then parse the interface into a struct that you can use in your Golang</p>\n\n<p>Direct Unmarshalling cannot be done, as the type of each field is not known</p>\n\n<pre><code>type Icon struct{\n    ImageLink string\n    ImageLink48 string\n    // ...\n}\n\ntype CatalogBank struct {\n    Advice      string `json:\"advice\"`\n    IconRaw     []interface{} `json:\"icon\"`\n    Icon        []Icon\n    //...\n}\n\nfunc UnmarshalIcon(c &amp;CatalogBank, i interface{}):\n    // first convert it to the top level list\n    newIcon := Icon{}\n    listOfIcons := i.([]interface{})\n    for _, i := range listOfIcons:\n        switch iT := i.(type) {\n           case string:\n                newIcon.ImageLink = iT\n           case map[string]interface{}:\n              for smallIconsKey, smallIconLink := range iT {\n                  if smallIconsKey == \"48x48\"{\n                         newIcon.ImageLink48 = smallIconLink.(string)\n                  }\n                  // and so on\n        }\n\n\nvar c CatalogBank{}\n_ := json.Unmarshal([]byte(your_json), &amp;c)\nfor _, i := range c.IconRaw:\n   UnmarshalIcon(&amp;c, i)\n</code></pre>\n\n<p>Caveat Emptor: I haven't checked above implementation but it should be something like this</p>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1518662995, "last_edit_date": 1518662995, "creation_date": 1518660855, "answer_id": 48799106, "question_id": 48793889, "link": "https://stackoverflow.com/questions/48793889/unmarshalling-array-into-struct/48799106#48799106", "title": "Unmarshalling array into struct", "body": "<p>You can not use  []struct {} for icon, change it to []interface{} instead, or if you want operate on type safe type look at the second solution with cusom unmarshaler</p>\n\n<p>Solution 1\n<code></p>\n\n<pre><code>    package main\n\n    import (\n        \"encoding/json\"\n        \"fmt\"\n        \"log\"\n    )\n\n    type CatalogBank struct {\n        Advice   string `json:\"advice\"`\n        BankCode string `json:\"bank_code\"`\n        BankName string `json:\"bank_name\"`\n        BIC      string `json:\"bic\"`\n        Credentials []struct {\n            Label  string `json:\"label\"`\n            Masked bool   `json:\"masked\"`\n        } `json:\"credentials\"`\n        Icon []interface{} `json:\"icon\"`\n        Language []byte `json:\"language\"`\n    }\n\n    func main() {\n\n        data := `\n    {\n    \"Advice\":\"abc\",\n    \"icon\": [\n            \"https://api.figo.me/assets/images/accounts/postbank.png\",\n            {\n              \"48x48\": \"https://api.figo.me/assets/images/accounts/postbank_48.png\",\n              \"60x60\": \"https://api.figo.me/assets/images/accounts/postbank_60.png\",\n              \"72x72\": \"https://api.figo.me/assets/images/accounts/postbank_72.png\",\n              \"84x84\": \"https://api.figo.me/assets/images/accounts/postbank_84.png\",\n              \"96x96\": \"https://api.figo.me/assets/images/accounts/postbank_96.png\",\n              \"120x120\": \"https://api.figo.me/assets/images/accounts/postbank_120.png\",\n              \"144x144\": \"https://api.figo.me/assets/images/accounts/postbank_144.png\",\n              \"192x192\": \"https://api.figo.me/assets/images/accounts/postbank_192.png\",\n              \"256x256\": \"https://api.figo.me/assets/images/accounts/postbank_256.png\"\n            }\n          ]\n    }\n    `\n\n        bank := &amp;CatalogBank{}\n\n        err := json.Unmarshal([]byte(data), bank)\n        if err != nil {\n            log.Fatal(err)\n        }\n        for _, icon := range bank.Icon {\n            fmt.Printf(\" %v\\n \", icon)\n        }\n\n    }\n</code></pre>\n\n<p></code></p>\n\n<p>Solution 2:</p>\n\n<p><code></p>\n\n<pre><code>    package main\n\n    import (\n        \"encoding/json\"\n        \"fmt\"\n        \"log\"\n    )\n\n    type Icons struct {\n        URL    string\n        BySize map[string]string\n    }\n\n\n\n    type CatalogBank struct {\n        Advice   string `json:\"advice\"`\n        BankCode string `json:\"bank_code\"`\n        BankName string `json:\"bank_name\"`\n        BIC      string `json:\"bic\"`\n        Credentials []struct {\n            Label  string `json:\"label\"`\n            Masked bool   `json:\"masked\"`\n        } `json:\"credentials\"`\n        Icon     *Icons `json:\"-,\"`\n        Language []byte `json:\"language\"`\n    }\n\n    func (p *CatalogBank) Unmarshal(data []byte) error {\n\n\n        type Transient struct {\n            *CatalogBank\n            Icon []interface{} `json:\"icon\"`\n        }\n\n        var transient = &amp;Transient{CatalogBank:p}\n        err := json.Unmarshal([]byte(data), transient)\n        if err != nil {\n            return err\n        }\n        p.Icon = &amp;Icons{\n            BySize: make(map[string]string),\n        }\n\n        if len(transient.Icon) &gt; 0 {\n            if url, ok := transient.Icon[0].(string); ok {\n                p.Icon.URL = url\n            }\n            if aMap, ok := transient.Icon[1].(map[string]interface{}); ok {\n                for k, v := range aMap {\n                    p.Icon.BySize[k] = v.(string)\n                }\n            }\n        }\n        return nil\n    }\n\n    func main() {\n\n        data := `\n            {\n            \"Advice\":\"abc\",\n            \"icon\": [\n                    \"https://api.figo.me/assets/images/accounts/postbank.png\",\n                    {\n                      \"48x48\": \"https://api.figo.me/assets/images/accounts/postbank_48.png\",\n                      \"60x60\": \"https://api.figo.me/assets/images/accounts/postbank_60.png\",\n                      \"72x72\": \"https://api.figo.me/assets/images/accounts/postbank_72.png\",\n                      \"84x84\": \"https://api.figo.me/assets/images/accounts/postbank_84.png\",\n                      \"96x96\": \"https://api.figo.me/assets/images/accounts/postbank_96.png\",\n                      \"120x120\": \"https://api.figo.me/assets/images/accounts/postbank_120.png\",\n                      \"144x144\": \"https://api.figo.me/assets/images/accounts/postbank_144.png\",\n                      \"192x192\": \"https://api.figo.me/assets/images/accounts/postbank_192.png\",\n                      \"256x256\": \"https://api.figo.me/assets/images/accounts/postbank_256.png\"\n                    }\n                  ]\n            }\n            `\n\n        bank := &amp;CatalogBank{}\n        err := bank.Unmarshal([]byte(data))\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"advice: %v\\n\", bank.Advice)\n\n        fmt.Printf(\"icon: %v\\n\", bank.Icon.URL)\n        for size, icon := range bank.Icon.BySize {\n            fmt.Printf(\"%v =&gt;  %v\\n \",size, icon)\n        }\n    }\n</code></pre>\n\n<p></code></p>\n"}, {"comments": [{"owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "edited": false, "score": 0, "creation_date": 1518664519, "post_id": 48799375, "comment_id": 84601735, "body": "If you encounter an error &#39;&#39;invalid character &#39;:&#39; after top-level value&quot; I can refer this link for solving issue. <a href=\"https://stackoverflow.com/questions/25187718/invalid-character-x00-after-top-level-value\" title=\"invalid character x00 after top level value\">stackoverflow.com/questions/25187718/&hellip;</a>"}], "tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1518663586, "creation_date": 1518663586, "answer_id": 48799375, "question_id": 48793889, "link": "https://stackoverflow.com/questions/48793889/unmarshalling-array-into-struct/48799375#48799375", "title": "Unmarshalling array into struct", "body": "<p>You can define your <strong>icon</strong> like this:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nvar testIcon = []byte(`{\"icon\":[\n                        \"https://api.figo.me/assets/images/accounts/postbank.png\",\n                        {\n                            \"48x48\":\"https://api.figo.me/assets/images/accounts/postbank_48.png\"\n                        }]\n                    }`)\n\nfunc main() {\n\n    icon := make(map[string][]interface{})\n    err := json.Unmarshal(testIcon, &amp;icon)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(icon)\n    // map[icon:[https://api.figo.me/assets/images/accounts/postbank.png map[48x48:https://api.figo.me/assets/images/accounts/postbank_48.png]]]\n\n}\n</code></pre>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 48793965, "answer_count": 4, "score": -1, "last_activity_date": 1518663586, "creation_date": 1518632724, "last_edit_date": 1518638645, "question_id": 48793889, "link": "https://stackoverflow.com/questions/48793889/unmarshalling-array-into-struct", "title": "Unmarshalling array into struct", "body": "<p>I'm trying to figure out how I can (using gin) create a struct from an api call</p>\n\n<pre><code>\"icon\": [\n        \"https://api.figo.me/assets/images/accounts/postbank.png\",\n        {\n          \"48x48\": \"https://api.figo.me/assets/images/accounts/postbank_48.png\",\n          \"60x60\": \"https://api.figo.me/assets/images/accounts/postbank_60.png\",\n          \"72x72\": \"https://api.figo.me/assets/images/accounts/postbank_72.png\",\n          \"84x84\": \"https://api.figo.me/assets/images/accounts/postbank_84.png\",\n          \"96x96\": \"https://api.figo.me/assets/images/accounts/postbank_96.png\",\n          \"120x120\": \"https://api.figo.me/assets/images/accounts/postbank_120.png\",\n          \"144x144\": \"https://api.figo.me/assets/images/accounts/postbank_144.png\",\n          \"192x192\": \"https://api.figo.me/assets/images/accounts/postbank_192.png\",\n          \"256x256\": \"https://api.figo.me/assets/images/accounts/postbank_256.png\"\n        }\n      ],\n</code></pre>\n\n<p>into </p>\n\n<pre><code>type CatalogBank struct {\n        Advice      string `json:\"advice\"`\n        BankCode    string `json:\"bank_code\"`\n        BankName    string `json:\"bank_name\"`\n        BIC         string `json:\"bic\"`\n        Credentials []struct {\n            Label  string `json:\"label\"`\n            Masked bool   `json:\"masked\"`\n        } `json:\"credentials\"`\n        Icon     []struct {\n\n        } `json:\"icon\"`\n        Language []byte `json:\"language\"`\n    }\n</code></pre>\n\n<p>The icon part is just an extract from, but I always get an unmarshall error for this part. How would I have to definde the 'Icon' part in the struct?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518630573, "post_id": 48793302, "comment_id": 84588751, "body": "Why not just try it and see?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1518630592, "post_id": 48793302, "comment_id": 84588766, "body": "Have you tried trying?"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518630635, "post_id": 48793302, "comment_id": 84588785, "body": "try that in your editor"}, {"owner": {"reputation": 19, "user_id": 9361403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Qn8OnC8Aywc/AAAAAAAAAAI/AAAAAAAAAAA/4bkx6bAmPbY/photo.jpg?sz=128", "display_name": "Harry Harpham", "link": "https://stackoverflow.com/users/9361403/harry-harpham"}, "edited": false, "score": 0, "creation_date": 1518630852, "post_id": 48793302, "comment_id": 84588886, "body": "Lol yes I have tried the different permutations I could think of.  Am I missing something obvious?  The following do not work <code>tag:&quot;a&quot;, &quot;b&quot;</code> <code>tag:&quot;a&quot; &quot;b&quot;</code> <code>tag:&quot;a&quot;` `tag:&quot;b&quot;</code> <code>tag:&quot;a&quot;`, `tag:&quot;b&quot;</code>"}, {"owner": {"reputation": 2086, "user_id": 514445, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/03d72e725cef7a53196260a3fbef59ea?s=128&d=identicon&r=PG&f=1", "display_name": "Nigel Alderton", "link": "https://stackoverflow.com/users/514445/nigel-alderton"}, "edited": false, "score": 0, "creation_date": 1518633620, "post_id": 48793302, "comment_id": 84590312, "body": "Hello Harry welcome to Stackoverflow. When you say &quot;the following do not work&quot;, please can you say what you were expecting and what you actually saw."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 9361403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Qn8OnC8Aywc/AAAAAAAAAAI/AAAAAAAAAAA/4bkx6bAmPbY/photo.jpg?sz=128", "display_name": "Harry Harpham", "link": "https://stackoverflow.com/users/9361403/harry-harpham"}, "edited": false, "score": 0, "creation_date": 1518631505, "post_id": 48793374, "comment_id": 84589227, "body": "Got it. Thank you so much. I definitely should have thought to check the spec and I think I remember reading that now."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1518631619, "last_edit_date": 1518631619, "creation_date": 1518630671, "answer_id": 48793374, "question_id": 48793302, "link": "https://stackoverflow.com/questions/48793302/struct-tags-for-comma-separated-fields-in-golang/48793374#48793374", "title": "Struct Tags for Comma-Separated Fields in Golang", "body": "<p>You can obviously specify a tag value for <code>MyType.A</code> and <code>MyType.B</code>, but you can't specify <em>different</em> tag values for those 2 fields (unless you list them in 2 separate field declarations).</p>\n\n<p>Quoting from <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Spec: Struct types:</a></p>\n\n<blockquote>\n  <p>A field declaration may be followed by an optional string literal <em>tag</em>, which becomes an attribute for <strong>all the fields</strong> in the corresponding field declaration.</p>\n</blockquote>\n\n<p>A field declaration may only contain a single, optional tag:</p>\n\n<blockquote>\n<pre><code>StructType    = \"struct\" \"{\" { FieldDecl \";\" } \"}\" .\nFieldDecl     = (IdentifierList Type | EmbeddedField) [ Tag ] .\nEmbeddedField = [ \"*\" ] TypeName .\nTag           = string_lit .\n</code></pre>\n</blockquote>\n\n<p>See this example:</p>\n\n<pre><code>type MyType struct {\n    A, B string `mytag:\"AB\"`\n}\n\nm := MyType{\"a\", \"b\"}\nt := reflect.TypeOf(m)\n\nfor _, fieldName := range []string{\"A\", \"B\"} {\n    field, found := t.FieldByName(fieldName)\n    if !found {\n        continue\n    }\n    fmt.Printf(\"\\nField: MyType.%s\\n\", fieldName)\n    fmt.Printf(\"\\tWhole tag value : %q\\n\", field.Tag)\n    fmt.Printf(\"\\tValue of 'mytag': %q\\n\", field.Tag.Get(\"mytag\"))\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ZiaMRA-Xksv\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Field: MyType.A\n    Whole tag value : \"mytag:\\\"AB\\\"\"\n    Value of 'mytag': \"AB\"\n\nField: MyType.B\n    Whole tag value : \"mytag:\\\"AB\\\"\"\n    Value of 'mytag': \"AB\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9874, "user_id": 1636314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/656293120862f84aa3319979ca1bdb8c?s=128&d=identicon&r=PG", "display_name": "publysher", "link": "https://stackoverflow.com/users/1636314/publysher"}, "is_accepted": false, "score": 3, "last_activity_date": 1518630715, "creation_date": 1518630715, "answer_id": 48793384, "question_id": 48793302, "link": "https://stackoverflow.com/questions/48793302/struct-tags-for-comma-separated-fields-in-golang/48793384#48793384", "title": "Struct Tags for Comma-Separated Fields in Golang", "body": "<p>Yes you can, but you can't tag the individual fields. From the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Language Reference</a>: </p>\n\n<blockquote>\n  <p>A field declaration may be followed by an optional string literal tag, which becomes an attribute for all the fields in the corresponding field declaration</p>\n</blockquote>\n\n<p>So you can say</p>\n\n<pre><code>type MyType struct {\n  A, B string `my_tag`\n}\n</code></pre>\n\n<p>but this will end up with both <code>A</code> and <code>B</code> being tagged with <code>my_tag</code>. For must common use cases (JSON, Protobuf, ...) this is not what you want.</p>\n"}], "owner": {"reputation": 19, "user_id": 9361403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Qn8OnC8Aywc/AAAAAAAAAAI/AAAAAAAAAAA/4bkx6bAmPbY/photo.jpg?sz=128", "display_name": "Harry Harpham", "link": "https://stackoverflow.com/users/9361403/harry-harpham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 1, "accepted_answer_id": 48793374, "answer_count": 2, "score": -3, "last_activity_date": 1518638692, "creation_date": 1518630393, "last_edit_date": 1518638692, "question_id": 48793302, "link": "https://stackoverflow.com/questions/48793302/struct-tags-for-comma-separated-fields-in-golang", "title": "Struct Tags for Comma-Separated Fields in Golang", "body": "<p>Say I have a struct like:</p>\n\n<pre><code>type MyType struct {\n    A, B string\n}\n</code></pre>\n\n<p>Can I put tags on these fields?  Obviously I could just put each field on its own line.  I'm just curious if it's possible to tag the fields in the original format.</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518628385, "post_id": 48792733, "comment_id": 84587666, "body": "It&#39;s definitely not valid XML, <code>&lt;field&gt;</code> is not terminated and just plain invalid. Don&#39;t try to parse it as xml."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518628489, "post_id": 48792733, "comment_id": 84587725, "body": "sorry corrected xml sample, field field is terminated (typo) - but i think still invalid as data and node inside node"}, {"owner": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1518629136, "post_id": 48792733, "comment_id": 84588050, "body": "Looks valid, it&#39;s just that order is not a direct sibling of field but of a text node."}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1518632117, "post_id": 48793143, "comment_id": 84589541, "body": "I was just poking around with chardata - yip this works - thanks for thorough answer"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1518632199, "last_edit_date": 1518632199, "creation_date": 1518629780, "answer_id": 48793143, "question_id": 48792733, "link": "https://stackoverflow.com/questions/48792733/unmarshal-xml-node-containing-data-and-child/48793143#48793143", "title": "Unmarshal xml node containing data and child", "body": "<p>A single XML element can only be mapped to a single struct field, and your model tries to map <code>&lt;field&gt;</code> to 2 struct fields, so it's not allowed.</p>\n\n<p>The character data of <code>&lt;field&gt;</code> and the child element <code>&lt;order&gt;</code> are at the same \"level\", they are siblings, so they must be in the same struct. But they are different types of nodes: to get the character data, use the <code>xml:\",chardata\"</code> struct tag, and to get the value of the <code>&lt;order&gt;</code> child element, use the <code>xml:\"order\"</code> struct tag.</p>\n\n<p>So use the following Go model:</p>\n\n<pre><code>type Field struct {\n    Value string `xml:\",chardata\"`\n    Order string `xml:\"order\"`\n}\n\ntype Sort struct {\n    Field Field `xml:\"field\"`\n}\n\ntype Report struct {\n    Sort Sort `xml:\"sort\"`\n}\n</code></pre>\n\n<p>Parsing your input XML into this model:</p>\n\n<pre><code>func main() {\n    var r Report\n    err := xml.Unmarshal([]byte(src), &amp;r)\n    fmt.Printf(\"%+v %v\", r, err)\n}\n\nconst src = `&lt;report&gt;\n    &lt;sort&gt;\n        &lt;field&gt;type&lt;order&gt;ascending&lt;/order&gt;&lt;/field&gt;\n    &lt;/sort&gt;\n&lt;/report&gt;`\n</code></pre>\n\n<p>Output is (try it on the <a href=\"https://play.golang.org/p/zbkYrYb67t4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{Sort:{Field:{Value:type Order:ascending}}} &lt;nil&gt;\n</code></pre>\n\n<p>Since <code>Sort</code> only contains a single <code>Field</code> field, we can simplify the model to this:</p>\n\n<pre><code>type Field struct {\n    Value string `xml:\",chardata\"`\n    Order string `xml:\"order\"`\n}\n\ntype Report struct {\n    SortField Field `xml:\"sort&gt;field\"`\n}\n</code></pre>\n\n<p>And it works the same way, gives a similar output (try this one on the <a href=\"https://play.golang.org/p/wKvFmIr0IPi\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{SortField:{Value:type Order:ascending}} &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 48793143, "answer_count": 1, "score": 1, "last_activity_date": 1518632199, "creation_date": 1518628291, "last_edit_date": 1518628461, "question_id": 48792733, "link": "https://stackoverflow.com/questions/48792733/unmarshal-xml-node-containing-data-and-child", "title": "Unmarshal xml node containing data and child", "body": "<p>Im not sure this is valid xml, unfortunately its what I'm having to deal with - looking for suggestions on how to accomplish.</p>\n\n<p>my xml looks like this:</p>\n\n<pre><code>&lt;report&gt;\n    &lt;sort&gt;\n        &lt;field&gt;type&lt;order&gt;ascending&lt;/order&gt;&lt;/field&gt;\n    &lt;/sort&gt;\n&lt;/report&gt;\n</code></pre>\n\n<p>I am attempting to unmarshall into the following structs:</p>\n\n<pre><code>type Sort struct {\n    Field string `xml:\"field\"`\n    Order string `xml:\"field&gt;order\"`\n}\n\ntype Report struct {\n    Sort Sort       `xml:\"sort\"`\n}\n</code></pre>\n\n<p>unfortunately this is throwing the error:</p>\n\n<blockquote>\n  <p>Unmarshalling error: v7.Sort field \"Field\" with tag \"field\" conflicts\n  with field \"Order\" with tag \"field>order\"</p>\n</blockquote>\n\n<p>Is there a built in way of achieving this or am I looking at some custom unmarshalling</p>\n\n<p>UPDATE:\nAt least according to this answer it appears this should be valid if slightly ugly xml: <a href=\"https://stackoverflow.com/questions/12130228/can-a-xml-element-contain-text-and-child-elements-at-the-same-time\">Can a XML element contain text and child elements at the same time?</a></p>\n"}, {"tags": ["go", "swagger-ui"], "answers": [{"tags": [], "owner": {"reputation": 10662, "user_id": 153049, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f8d7c4a4899736c59ec1e40c7021d477?s=128&d=identicon&r=PG", "display_name": "Potherca", "link": "https://stackoverflow.com/users/153049/potherca"}, "is_accepted": true, "score": 3, "last_activity_date": 1519315716, "creation_date": 1519315716, "answer_id": 48932060, "question_id": 48792295, "link": "https://stackoverflow.com/questions/48792295/how-to-integrate-swagger-ui-with-golang-and-goa/48932060#48932060", "title": "How to integrate swagger ui with golang and goa", "body": "<h2>TL;DR</h2>\n\n<p>The <a href=\"https://github.com/goadesign/examples/tree/HEAD/files\" rel=\"nofollow noreferrer\">files example</a> shows how to build an API that serves static assets, which can be adapted to including Swager-UI.</p>\n\n<p>In order to follow the example:</p>\n\n<ol>\n<li>Get the dependencies</li>\n<li>Add <code>Resource</code>s to the <code>design.go</code> file</li>\n<li>Mount controllers in the <code>main.go</code></li>\n<li>Download and edit Swagger-UI</li>\n<li>Run the generators</li>\n</ol>\n\n<p>After this you should have a working REST-API including the Swagger-UI</p>\n\n<h2>Details</h2>\n\n<p><sup>(Please replace <code>example.com/your-package/</code> with the path to your package).</sup></p>\n\n<h3>1. Get the dependencies</h3>\n\n<p>In order to serve files, the example uses: </p>\n\n<ul>\n<li><p><a href=\"https://github.com/a-urth/go-bindata/\" rel=\"nofollow noreferrer\"><code>go-bindata</code> </a><br>\n<sup>Small utility which generates Go code from any file. Useful for embedding binary data in a Go program.</sup></p></li>\n<li><p><a href=\"https://github.com/elazarl/go-bindata-assetfs/\" rel=\"nofollow noreferrer\"><code>go-bindata-assetfs</code></a><br>\n<sup>Serves embedded files from <code>go-bindata</code> with <code>net/http</code>.</sup></p></li>\n</ul>\n\n<p>Get these using:</p>\n\n<pre><code>go get github.com/a-urth/go-bindata/...\ngo get github.com/elazarl/go-bindata-assetfs/...\n</code></pre>\n\n<h3>2. Add Resources to the <code>design.go</code> file:</h3>\n\n<pre><code>    var _ = Resource(\"schema\", func() {\n        Files(\"/schema/*filepath\", \"public/schema/\")\n    })\n\n    var _ = Resource(\"swagger\", func() {\n        Files(\"/swagger/*filepath\", \"public/swagger/\")\n    })\n</code></pre>\n\n<h3>3. Mount controllers in the <code>main.go</code></h3>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"example.com/your-package/app\"\n    \"example.com/your-package/public/swagger\"\n\n    \"github.com/elazarl/go-bindata-assetfs\"\n    \"github.com/goadesign/goa\"\n    \"github.com/goadesign/goa/middleware\"\n)\n\nfunc main() {\n    // ...\n\n    // Mount \"schema\" controller\n    c1 := NewSchemaController(service)\n    app.MountSchemaController(service, c1)\n    // Mount \"swagger\" controller\n    c2 := NewSwaggerController(service)\n    // You can override FileSystem of the controller.\n    // For example using github.com/elazarl/go-bindata-assetfs is like below.\n    c2.FileSystem = func(dir string) http.FileSystem {\n        return &amp;assetfs.AssetFS{\n            Asset:     swagger.Asset,\n            AssetDir:  swagger.AssetDir,\n            AssetInfo: swagger.AssetInfo,\n            Prefix:    dir,\n        }\n    }\n    app.MountSwaggerController(service, c2)\n\n    // ...\n}\n</code></pre>\n\n<h3>4. Download Swagger-UI</h3>\n\n<p>Use <a href=\"https://stackoverflow.com/questions/7106012/download-a-single-folder-or-directory-from-a-github-repo\">your favorite method</a> to download the <a href=\"https://github.com/swagger-api/swagger-ui/tree/master/dist\" rel=\"nofollow noreferrer\"><code>dist</code> folder</a> of Swagger UI.\nPlace all the files in the <code>example.com/your-package/public/swagger</code> folder.</p>\n\n<p>In the <code>example.com/your-package/public/swagger/index.html</code> file:</p>\n\n<ul>\n<li>Search for <code>http://petstore.swagger.io/v2/swagger.json</code></li>\n<li>Replace it with <code>./swagger.json</code>.<br>\n<sup>That way the generated <code>swagger.json</code> will be used instead of the Petstore example.</sup></li>\n</ul>\n\n<h3>5. Run the generators</h3>\n\n<pre><code>go generate goagen -d example.com/your-package/design app\ngo generate goagen -d example.com/your-package/design main\ngo generate goagen -d example.com/your-package/design swagger -o public\ngo generate goagen -d example.com/your-package/design schema -o public\ngo generate go-bindata -ignore 'bindata.go' -pkg swagger -o public/swagger/bindata.go ./public/swagger/...\n</code></pre>\n\n<p>This will create the controllers, swagger, schema and static content.</p>\n\n<h3>Done</h3>\n\n<p>You should now have a fully functional Swagger UI.</p>\n"}, {"tags": [], "owner": {"reputation": 408, "user_id": 2234099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/678915aaa580bada8ed32e01000274c2?s=128&d=identicon&r=PG", "display_name": "gngchrs", "link": "https://stackoverflow.com/users/2234099/gngchrs"}, "is_accepted": false, "score": 0, "last_activity_date": 1617379678, "creation_date": 1617379678, "answer_id": 66922084, "question_id": 48792295, "link": "https://stackoverflow.com/questions/48792295/how-to-integrate-swagger-ui-with-golang-and-goa/66922084#66922084", "title": "How to integrate swagger ui with golang and goa", "body": "<p>I was running this recently and also wondered how to get the swagger ui up. Once you've generated the <code>openapi3.json</code> files, you can use this docker-compose config to bring up the swagger ui. You can replace the mounted volume and the SWAGGER_JSON variable according to where the files are. Swagger ui should run okay in http://localhost:8080.</p>\n<p>Note: You might need to enable CORS in goa to execute the requests.</p>\n<pre><code>swagger:\n  image: swaggerapi/swagger-ui\n  ports:\n    - '8080:8080'\n  environment:\n    SWAGGER_JSON: '/openapi3.json'\n  volumes:\n    - ./gen/http/openapi3.json:/openapi3.json\n</code></pre>\n"}], "owner": {"reputation": 263, "user_id": 2624447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95d9daf3d90f052f0f09f3e0624fb68c?s=128&d=identicon&r=PG", "display_name": "learnercys", "link": "https://stackoverflow.com/users/2624447/learnercys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2797, "favorite_count": 1, "accepted_answer_id": 48932060, "answer_count": 2, "score": 2, "last_activity_date": 1617379678, "creation_date": 1518626951, "last_edit_date": 1518640444, "question_id": 48792295, "link": "https://stackoverflow.com/questions/48792295/how-to-integrate-swagger-ui-with-golang-and-goa", "title": "How to integrate swagger ui with golang and goa", "body": "<p>I have been building my first RESTful service with go and goa, so basically I started doing <a href=\"https://goa.design/learn/guide/\" rel=\"nofollow noreferrer\">this</a> and at the end, goa generate two swagger files, <code>swagger.yaml</code> and <code>swagger.json</code>. The thing is that I've been looking for a way to add the swagger ui to, let's say, the index. But I haven't been able to find an example for that.</p>\n\n<p>I also look in the <a href=\"https://github.com/goadesign/examples\" rel=\"nofollow noreferrer\">examples</a> and in the <a href=\"https://goa.design/design/swagger/\" rel=\"nofollow noreferrer\">design - swagger</a> section but the only suggestion that they gave me is to use the <a href=\"http://swagger.goa.design/\" rel=\"nofollow noreferrer\">goa swagger design</a> generator, but I don't know if there's a way to perform this action without the need of accessing a public host?</p>\n"}, {"tags": ["go", "concurrency", "channels"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1518626054, "post_id": 48791949, "comment_id": 84586143, "body": "You have a tight loop there which will use as much CPU as it can. Getting the length of a channel requires locking the channel, so it&#39;s constantly locking and unlocking it as fast as it can. You&#39;re also checking if it&#39;s <code>&gt;=</code> the buffer size which implies you think it&#39;s somehow possible for its length to exceed its maximum size, which is impossible by definition."}, {"owner": {"reputation": 3638, "user_id": 2884309, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/T1Mo3.jpg?s=128&g=1", "display_name": "Ivan Aracki", "link": "https://stackoverflow.com/users/2884309/ivan-aracki"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518626687, "post_id": 48791949, "comment_id": 84586552, "body": "@Adrian but the question is: Why does printing the length of channel solving the issue?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518626737, "post_id": 48791949, "comment_id": 84586591, "body": "Hard to say, you don&#39;t show that code."}, {"owner": {"reputation": 31, "user_id": 9360632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hf1ft.jpg?s=128&g=1", "display_name": "David Komljenovic", "link": "https://stackoverflow.com/users/9360632/david-komljenovic"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518627220, "post_id": 48791949, "comment_id": 84586971, "body": "@Adrian There&#39;s a <code>fmt.Println(len(choke))</code> right above <code>if len(choke) &gt;= 150000</code>. If you uncomment it, the program will run perfectly and won&#39;t block. Wouldn&#39;t locking and unlocking the channel with the print only hog the CPU more, and block the program even earlier."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1519347038, "post_id": 48791949, "comment_id": 84886101, "body": "here&#39;s an idiomatic solution to determine if the channel is full without choking goroutines: <a href=\"https://stackoverflow.com/questions/48939522/checking-channel-length-becomes-unresponsive-in-for-lenc/48939532#48939532\" title=\"checking channel length becomes unresponsive in for lenc\">stackoverflow.com/questions/48939522/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9360632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hf1ft.jpg?s=128&g=1", "display_name": "David Komljenovic", "link": "https://stackoverflow.com/users/9360632/david-komljenovic"}, "edited": false, "score": 0, "creation_date": 1518627172, "post_id": 48792290, "comment_id": 84586935, "body": "But adding a <code>time.Sleep(1 * time.Millisecond)</code> instead of the print statement will also make the goroutine execute, and that isn&#39;t an I/O operation."}, {"owner": {"reputation": 151, "user_id": 4114655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/486113e993cbe167fec1a277dfacb447?s=128&d=identicon&r=PG", "display_name": "Tim H.", "link": "https://stackoverflow.com/users/4114655/tim-h"}, "reply_to_user": {"reputation": 31, "user_id": 9360632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hf1ft.jpg?s=128&g=1", "display_name": "David Komljenovic", "link": "https://stackoverflow.com/users/9360632/david-komljenovic"}, "edited": false, "score": 0, "creation_date": 1518627248, "post_id": 48792290, "comment_id": 84586988, "body": "I edited my comment around the same time you replied. I meant to say &quot;blocking&quot;, where the reason it&#39;s blocking in this case is because the Print statement is I/O."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 31, "user_id": 9360632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hf1ft.jpg?s=128&g=1", "display_name": "David Komljenovic", "link": "https://stackoverflow.com/users/9360632/david-komljenovic"}, "edited": false, "score": 0, "creation_date": 1518627253, "post_id": 48792290, "comment_id": 84586993, "body": "@DavidKomljenovic No, it&#39;s not an I/O operation, it&#39;s a blocking operation, which also allows the Go runtime to schedule other goroutines."}], "tags": [], "owner": {"reputation": 151, "user_id": 4114655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/486113e993cbe167fec1a277dfacb447?s=128&d=identicon&r=PG", "display_name": "Tim H.", "link": "https://stackoverflow.com/users/4114655/tim-h"}, "is_accepted": true, "score": 5, "last_activity_date": 1518628080, "last_edit_date": 1518628080, "creation_date": 1518626944, "answer_id": 48792290, "question_id": 48791949, "link": "https://stackoverflow.com/questions/48791949/getting-len-of-large-buffered-channel-blocks-for-loop/48792290#48792290", "title": "Getting len of large buffered channel blocks for loop", "body": "<p>This is happening because your goroutine is never executing. The \"for\" loop you have outside of the goroutine is a tight loop without any blocking operations, which means it's getting all of the scheduler time. The goroutine you create is therefore never being scheduled to execute.</p>\n\n<p>It works when you have the print statement, because that's a blocking operation (I/O) that causes the Go scheduler to switch to the goroutine you've created.</p>\n"}], "owner": {"reputation": 31, "user_id": 9360632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hf1ft.jpg?s=128&g=1", "display_name": "David Komljenovic", "link": "https://stackoverflow.com/users/9360632/david-komljenovic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 1, "accepted_answer_id": 48792290, "answer_count": 1, "score": 2, "last_activity_date": 1518628080, "creation_date": 1518625845, "last_edit_date": 1518626273, "question_id": 48791949, "link": "https://stackoverflow.com/questions/48791949/getting-len-of-large-buffered-channel-blocks-for-loop", "title": "Getting len of large buffered channel blocks for loop", "body": "<p>I've encountered a strange behaviour. I was playing around with buffered channels, and when using large buffers the whole program execution would block. In the following code snippet: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    choke := make(chan string, 150000)\n\n    go func() {\n        for i := 0; i &lt; 10000000; i++ {\n            choke &lt;- string(i)\n            fmt.Println(\"i=\", i)\n        }\n    }()\n\n    for {\n        //fmt.Println(len(choke))\n        if len(choke) &gt;= 150000 {\n            fmt.Println(\"Full\")\n        }\n    }\n}\n</code></pre>\n\n<p>My program blocks at ~96000 iterations and never  reaches the \"Full\" print, unless I print out <code>len(choke)</code> before evaluating it. This is probably due to the delay provided by <code>fmt.Println</code>, as the issue can also be \"fixed\" by adding a small <code>time.Sleep</code>.</p>\n\n<p>Could someone explain the reason for this behaviour?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 395, "user_id": 636599, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/30eb9d8543d9f120fd762c6f53420ac7?s=128&d=identicon&r=PG", "display_name": "JSP", "link": "https://stackoverflow.com/users/636599/jsp"}, "edited": false, "score": 0, "creation_date": 1518919348, "post_id": 48814960, "comment_id": 84699505, "body": "Thanks @ttomalak!  That does work as well as the methods in the updated question.  If you get a chance can you clarify if I&#39;m understanding the result correctly and indicate which method is most idiomatic?"}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 0, "last_activity_date": 1518723259, "creation_date": 1518723259, "answer_id": 48814960, "question_id": 48791193, "link": "https://stackoverflow.com/questions/48791193/how-do-i-allow-the-skip-method-for-buffalo-gobuffalo-middleware-when-im-pas/48814960#48814960", "title": "How do I allow the skip() method for Buffalo (gobuffalo) middleware when I&#39;m passing the middleware config?", "body": "<p>You need to staisfy required <code>func</code> but your require additional parameters which can't be passed. You probably can change how you approach this by making your <code>myConfig</code> as reciever of <code>myMiddlewareFunc</code>, by this I mean: </p>\n\n<pre><code>type myConfig struct {\n    value string\n}\n\nfunc (config *myConfig) myMiddlewareFunc() buffalo.MiddlewareFunc {\n    return func(next buffalo.Handler) buffalo.Handler {\n        return func(c buffalo.Context) error {\n            c.Logger().Info(\"Test \", config.value)\n\n            return next(c)\n        }\n    }\n}\n\n\nfunc App() *buffalo.App {\n    if app == nil {\n        app = buffalo.New(buffalo.Options{\n            Env:         ENV,\n            SessionName: \"_myapp_session\",\n        })\n        // Automatically redirect to SSL\n        app.Use(ssl.ForceSSL(secure.Options{\n            SSLRedirect:     ENV == \"production\",\n            SSLProxyHeaders: map[string]string{\"X-Forwarded-Proto\": \"https\"},\n        }))\n\n        if ENV == \"development\" {\n            app.Use(middleware.ParameterLogger)\n        }\n\n        // Protect against CSRF attacks. https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)\n        // Remove to disable this.\n        app.Use(csrf.New)\n\n        // Wraps each request in a transaction.\n        //  c.Value(\"tx\").(*pop.PopTransaction)\n        // Remove to disable this.\n        app.Use(middleware.PopTransaction(models.DB))\n\n        // Setup and use translations:\n        var err error\n        if T, err = i18n.New(packr.NewBox(\"../locales\"), \"en-US\"); err != nil {\n            app.Stop(err)\n        }\n        app.Use(T.Middleware())\n\n        c := &amp;myConfig{\n            value: \"test value\",\n        }\n        app.Use(c.myMiddlewareFunc())\n        app.Middleware.Skip(c.myMiddlewareFunc(), TestHandler)\n\n\n        app.GET(\"/\", HomeHandler)\n        app.GET(\"/test\", TestHandler)\n\n        app.ServeFiles(\"/assets\", assetsBox)\n    }\n\n    return app\n}\n</code></pre>\n"}], "owner": {"reputation": 395, "user_id": 636599, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/30eb9d8543d9f120fd762c6f53420ac7?s=128&d=identicon&r=PG", "display_name": "JSP", "link": "https://stackoverflow.com/users/636599/jsp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 48814960, "answer_count": 1, "score": 0, "last_activity_date": 1518919194, "creation_date": 1518623528, "last_edit_date": 1518919194, "question_id": 48791193, "link": "https://stackoverflow.com/questions/48791193/how-do-i-allow-the-skip-method-for-buffalo-gobuffalo-middleware-when-im-pas", "title": "How do I allow the skip() method for Buffalo (gobuffalo) middleware when I&#39;m passing the middleware config?", "body": "<p>I'm trying to create a custom Buffalo (gobuffalo) middleware that accepts config which is working.  The issue is I lose the ability to skip the middleware function with this error:</p>\n\n<p>actions/app.go:63:22: cannot use myMiddlewareFunc (type func(myConfig) buffalo.MiddlewareFunc) as type buffalo.MiddlewareFunc in argument to app.Middleware.Skip</p>\n\n<p>The code I've got thus far is:</p>\n\n<pre><code>package actions\n\nimport (\n    \"github.com/gobuffalo/buffalo\"\n    \"github.com/gobuffalo/buffalo/middleware\"\n    \"github.com/gobuffalo/envy\"\n\n    \"github.com/gobuffalo/buffalo/middleware/csrf\"\n    \"github.com/gobuffalo/buffalo/middleware/i18n\"\n    \"github.com/gobuffalo/packr\"\n)\n\n// ENV is used to help switch settings based on where the\n// application is being run. Default is \"development\".\nvar ENV = envy.Get(\"GO_ENV\", \"development\")\nvar app *buffalo.App\nvar T *i18n.Translator\n\ntype myConfig struct {\n    value string\n}\n\n// App is where all routes and middleware for buffalo\n// should be defined. This is the nerve center of your\n// application.\nfunc App() *buffalo.App {\n    if app == nil {\n        app = buffalo.New(buffalo.Options{\n            Env:         ENV,\n            SessionName: \"_myapp_session\",\n        })\n        // Automatically redirect to SSL\n        app.Use(ssl.ForceSSL(secure.Options{\n            SSLRedirect:     ENV == \"production\",\n            SSLProxyHeaders: map[string]string{\"X-Forwarded-Proto\": \"https\"},\n        }))\n\n        if ENV == \"development\" {\n            app.Use(middleware.ParameterLogger)\n        }\n\n        // Protect against CSRF attacks. https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)\n        // Remove to disable this.\n        app.Use(csrf.New)\n\n        // Wraps each request in a transaction.\n        //  c.Value(\"tx\").(*pop.PopTransaction)\n        // Remove to disable this.\n        app.Use(middleware.PopTransaction(models.DB))\n\n        // Setup and use translations:\n        var err error\n        if T, err = i18n.New(packr.NewBox(\"../locales\"), \"en-US\"); err != nil {\n            app.Stop(err)\n        }\n        app.Use(T.Middleware())\n        app.Use(myMiddlewareFunc(myConfig{\n            value: \"test value\",\n        }))\n        app.Middleware.Skip(myMiddlewareFunc, TestHandler)\n        app.GET(\"/\", HomeHandler)\n        app.GET(\"/test\", TestHandler)\n\n        app.ServeFiles(\"/assets\", assetsBox)\n    }\n\n    return app\n}\n\n// TestHandler is a test handler\nfunc TestHandler(c buffalo.Context) error {\n    return c.Render(200, r.String(\"Test1234\"))\n}\n\nfunc myMiddlewareFunc(config myConfig) buffalo.MiddlewareFunc {\n    return func(next buffalo.Handler) buffalo.Handler {\n        return func(c buffalo.Context) error {\n            c.Logger().Info(\"Test \", config.value)\n\n            return next(c)\n        }\n    }\n}\n</code></pre>\n\n<p>So @ttomalak's method of creating a method with a receiver worked as well as the two methods below:</p>\n\n<pre><code>    mw := myMiddlewareFunc(myConfig{\n        value: \"test value\",\n    })\n    app.Use(mw)\n    app.Middleware.Skip(mw, TestHandler)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>    config := myConfig{\n        value: \"test value\",\n    }\n    app.Use(myMiddlewareFunc(config))\n    app.Middleware.Skip(myMiddlewareFunc(config), TestHandler)\n</code></pre>\n\n<p>All ways <strong>require</strong> calling the middleware method.  The method shown here can't be used:</p>\n\n<p><code>a.Middleware.Skip(Authorization, HomeHandler, ...)</code></p>\n\n<p><a href=\"https://github.com/gobuffalo/buffalo/blob/master/middleware.go#L77\" rel=\"nofollow noreferrer\">https://github.com/gobuffalo/buffalo/blob/master/middleware.go#L77</a></p>\n\n<p>I'm new to go but my sense of it is that the methods aren't conforming to the MiddlewareFunc interface so calling them and getting the return type buffalo.MiddlewareFunc is what's allowing it to work.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518622063, "post_id": 48790663, "comment_id": 84583368, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41015114/types-of-go-struct-methods-that-satisfy-an-interface/41016448#41016448\">Types of Go struct methods that satisfy an interface</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1518622272, "post_id": 48790663, "comment_id": 84583491, "body": "What good would a copy being addressable do, besides add more cognitive overhead to the language? Addressability is already taken care of by pointer values."}, {"owner": {"reputation": 175, "user_id": 9326964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2121be8b02cc0ee56a78dd6168d4710?s=128&d=identicon&r=PG&f=1", "display_name": "Lemurata", "link": "https://stackoverflow.com/users/9326964/lemurata"}, "edited": false, "score": 0, "creation_date": 1518624811, "post_id": 48790663, "comment_id": 84585223, "body": "Well, it would allow satisfying interface by pointer receivers..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1518624909, "post_id": 48790663, "comment_id": 84585307, "body": "@Lemurata Yes, and if the pointer method would require to modify the receiver, any modification it would do would be lost, and you would scratch your head twice as hard why it doesn&#39;t work."}, {"owner": {"reputation": 175, "user_id": 9326964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2121be8b02cc0ee56a78dd6168d4710?s=128&d=identicon&r=PG&f=1", "display_name": "Lemurata", "link": "https://stackoverflow.com/users/9326964/lemurata"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518625579, "post_id": 48790663, "comment_id": 84585786, "body": "@icza I would like to allow pointer receiver to modify the original structure not a copy. I don&#39;t understand why its impossible."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518625902, "post_id": 48790663, "comment_id": 84586043, "body": "@Lemurata Because the value in the interface wrapper is already a copy, a detached version from the original, it doesn&#39;t store the address of the original. So a pointer receiver could only get the address of the copy and not that of the original."}, {"owner": {"reputation": 175, "user_id": 9326964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2121be8b02cc0ee56a78dd6168d4710?s=128&d=identicon&r=PG&f=1", "display_name": "Lemurata", "link": "https://stackoverflow.com/users/9326964/lemurata"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518626811, "post_id": 48790663, "comment_id": 84586656, "body": "@icza sounds good... so the true question is: why (by design) is the value in the interface wrapper a copy, not for example pointer to the original value?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518626893, "post_id": 48790663, "comment_id": 84586724, "body": "@Lemurata Because everything in Go is passed by value. This is for consistency."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518628330, "post_id": 48790663, "comment_id": 84587648, "body": "@Lemurata You can also read something about this in this answer: <a href=\"https://stackoverflow.com/questions/36077566/how-can-a-slice-contain-itself/36078970#36078970\">How can a slice contain itself?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "edited": false, "score": 0, "creation_date": 1519141775, "post_id": 48874650, "comment_id": 84783263, "body": "Here&#39;s some code in the playground illustrating this: <a href=\"https://play.golang.org/p/eeaYzqZsmOs\" rel=\"nofollow noreferrer\">play.golang.org/p/eeaYzqZsmOs</a>"}, {"owner": {"reputation": 175, "user_id": 9326964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2121be8b02cc0ee56a78dd6168d4710?s=128&d=identicon&r=PG&f=1", "display_name": "Lemurata", "link": "https://stackoverflow.com/users/9326964/lemurata"}, "edited": false, "score": 2, "creation_date": 1519664694, "post_id": 48874650, "comment_id": 84992271, "body": "Thanks for explaining instead of stating &quot;you should ask another question&quot;, like the others do."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 1, "creation_date": 1567434534, "post_id": 48874650, "comment_id": 101953493, "body": "You don&#39;t have to make your reasoning for non-addressability of interface values. Go doesn&#39;t let it because it&#39;s an implementation detail and that&#39;s why Go spec disallows it. So different Go compilers (and versions) are free to choose whatever semantics they want for interface values. Interfaces were not always two-word structures."}, {"owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "edited": false, "score": 2, "creation_date": 1567521405, "post_id": 48874650, "comment_id": 101982953, "body": "&quot;it&#39;s an implementation detail&quot; with serious consequences as noted in my post"}], "tags": [], "owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "is_accepted": true, "score": 27, "last_activity_date": 1519349620, "last_edit_date": 1519349620, "creation_date": 1519076698, "answer_id": 48874650, "question_id": 48790663, "link": "https://stackoverflow.com/questions/48790663/why-value-stored-in-an-interface-is-not-addressable-in-golang/48874650#48874650", "title": "Why value stored in an interface is not addressable in Golang", "body": "<p>Why isn't a non-pointer value stored in an interface addressable? This is an excellent question, and the answer explains why an interface containing a non-pointer value can't be the receiver for a method with a pointer receiver, leading to the dreaded error:</p>\n\n<pre><code>&lt;type&gt; does not implement &lt;interface&gt; (&lt;name&gt; method has pointer receiver)\n</code></pre>\n\n<p><strong>tl;dr</strong></p>\n\n<p>A non-pointer value stored in an interface isn't addressable to maintain type integrity. For example, a pointer to <strong><em>A</em></strong>, which points to a value of type <strong><em>A</em></strong> in an interface, would be invalidated when a value of a different type <strong><em>B</em></strong> is subsequently stored in the interface.  </p>\n\n<p>Because a non-pointer value stored in an interface isn't addressable, the compiler can't pass its address to a method with a pointer receiver.</p>\n\n<p><strong>Long answer</strong></p>\n\n<p>The answers I've seen online don't make much sense.  For instance, <a href=\"https://npf.io/2014/05/intro-to-go-interfaces/\" rel=\"noreferrer\">this article</a> says:</p>\n\n<blockquote>\n  <p>The reason is that the value in an interface is in a hidden memory\n  location, and so the compiler can\u2019t automatically get a pointer to\n  that memory for you (in Go parlance, this is known as being \u201cnot\n  addressable\u201d).</p>\n</blockquote>\n\n<p>It's true that the value stored in an interface is not addressable, but as far as I can see it's not because its stored in \"a hidden memory location\".  </p>\n\n<p>Another common answer is:</p>\n\n<blockquote>\n  <p>When an interface value is created, the value that is wrapped in the interface is copied. It is therefore not possible to take its address, and even if you did, using a pointer to the interface value would have unexpected effects (ie. unable to alter the original copied value).  </p>\n</blockquote>\n\n<p>This makes no sense, since a pointer to a value copied into an interface would be no different than a pointer to a value copied into a concrete type; in both cases you can't alter the original copied value through the pointer to the copy.  </p>\n\n<p>So why isn't a value stored in an interface addressable?  The answer lies in the follow-on implications if it <em>were</em> addressable.</p>\n\n<p>Let's say you have an interface, <strong><em>I</em></strong>, and two types, <strong><em>A</em></strong> and <strong><em>B</em></strong>, which satisfy that interface:</p>\n\n<pre><code>type I interface{}\ntype A int\ntype B string\n</code></pre>\n\n<p>Create an <strong><em>A</em></strong> and store it in an <strong><em>I</em></strong>:</p>\n\n<pre><code>func main() {\n    var a A = 5\n    var i I = a\n    fmt.Printf(\"i is of type %T\\n\", i)\n</code></pre>\n\n<p>Let's pretend we could take the address of a value stored in an interface:</p>\n\n<pre><code>    var aPtr *A\n    aPtr = &amp;(i.(A)) // not allowed, but if it were...\n</code></pre>\n\n<p>Now create a <strong><em>B</em></strong> and store it in <strong><em>i</em></strong>:</p>\n\n<pre><code>    var b B = \"hello\"\n    i = b\n    fmt.Printf(\"i is of type %T, aPtr is of type %T\\n\", i, aPtr)\n}\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>i is of type main.A\ni is of type main.B, aPtr is of type *main.A\n</code></pre>\n\n<p>After putting a <strong><em>B</em></strong> into <strong><em>i</em></strong>, what is <strong><em>aPtr</em></strong> pointing to?  <strong><em>aPtr</em></strong> was declared as pointing to an <strong><em>A</em></strong>, but <strong><em>t</em></strong> now contains a <strong><em>B</em></strong>, and <strong><em>aPtr</em></strong> is no longer a valid pointer to <strong><em>A</em></strong>.</p>\n\n<p>This, however is permitted:</p>\n\n<pre><code>    var aPtr *A\n    var a2 A = i.(A)\n    aPtr = &amp;a2\n</code></pre>\n\n<p>Because the second line makes a copy of the value in <strong><em>i.(A)</em></strong>, and <strong><em>aPtr</em></strong> does not point to <strong><em>i.(A)</em></strong>.</p>\n\n<p>So, why can't an interface containing a non-pointer value be the receiver for a method with a pointer receiver? Because a non-pointer value stored in an interface isn't addressable, so the compiler can't pass its address to a method with a pointer receiver.</p>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 9211367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c123b80ebb6f3d2a58fdf13f6299f718?s=128&d=identicon&r=PG&f=1", "display_name": "Dudeskeeroo", "link": "https://stackoverflow.com/users/9211367/dudeskeeroo"}, "is_accepted": false, "score": 0, "last_activity_date": 1519100144, "creation_date": 1519100144, "answer_id": 48877761, "question_id": 48790663, "link": "https://stackoverflow.com/questions/48790663/why-value-stored-in-an-interface-is-not-addressable-in-golang/48877761#48877761", "title": "Why value stored in an interface is not addressable in Golang", "body": "<p>An interface in Go is the definition of methods that a type must provide if it is to be used as a type of the interface.</p>\n\n<p>The code that uses an interface isn't concerned with how the implementing type does this under the covers, it just cares that the interface methods are satisfied.</p>\n\n<p>As an example, lets suppose I have a simple logger interface that my code uses:</p>\n\n<pre><code>type Logger interface {\n    Printf(format string, args ...interface{})\n    Errorf(format string, args ...interface{})\n}\n</code></pre>\n\n<p>I can use this interface all through my code. I'll need to supply an implementation of <code>Logger</code> where it's required. There may be several implementations. I may have a <code>FileLogger</code> that writes to a file. Should my code be able to access, for example, the <code>File</code> property in the <code>FileLogger</code>?</p>\n\n<p>I may have a <code>ConsoleLogger</code> and a <code>SockerLogger</code> and a <code>LogglyLogger</code> all of which satisfy the interface. But it makes no sense in any of these to even have a <code>File</code> property. If my code that uses <code>Logger</code> interface was interested in the underlying <code>File</code>, what would it do when using these other <code>Logger</code> implementations?</p>\n\n<p>If you need to access the underlying data in an interface implementation, you are probably using interfaces incorrectly.</p>\n\n<p>A way around this is perhaps using Getter/Setters on the interface? If you really need access to a value from the underlying structure, make that part of the interface. In the example above a <code>GetFile()</code> won't make much sense but perhaps there are other situations where all implementations of an interface share a common attribute e.g. <code>GetLen()</code> and <code>SetLen()</code>?</p>\n"}, {"comments": [{"owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "edited": false, "score": 1, "creation_date": 1519141086, "post_id": 48881575, "comment_id": 84782794, "body": "This question (&quot;Why value stored in an interface is not addressable in Golang&quot;) is interesting because of an inconsistency in how Go handles pointer method receivers.  If such a method is called with a non-pointer concrete value, Go will pass the receiver a pointer to the value, but not in the case where the value is stored in an interface.  There can be no pointer to a reified value in an interface, because that could compromise type safety."}], "tags": [], "owner": {"reputation": 104, "user_id": 9384701, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vTWibx0fC3o/AAAAAAAAAAI/AAAAAAAAFX4/busRlfuEfAU/photo.jpg?sz=128", "display_name": "Axel Wagner", "link": "https://stackoverflow.com/users/9384701/axel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1519118159, "creation_date": 1519118159, "answer_id": 48881575, "question_id": 48790663, "link": "https://stackoverflow.com/questions/48790663/why-value-stored-in-an-interface-is-not-addressable-in-golang/48881575#48881575", "title": "Why value stored in an interface is not addressable in Golang", "body": "<p>I think the answer is \"because Go does not have references\". If you call <code>Foo(x)</code> you know <code>x</code> won't be modified; if you call <code>Foo(&amp;x)</code>, you expect that it might. If what you request would be possible (in particular, if you want the <em>value itself</em> to be addressed, not the copy made in the interface), then that would break down:</p>\n\n<pre><code>func Bar() {\n    b := 42\n    Foo(b)\n    fmt.Println(b)\n}\n\nfunc Foo(v interface{}) {\n    // Making up syntax now\n    p = takeAddressAs(v).(*int)\n    *p = 23\n}\n</code></pre>\n\n<p>Note, that it <em>is</em> possible (from a technical perspective) to <a href=\"https://play.golang.org/p/FrMtB0szvoD\" rel=\"nofollow noreferrer\">address</a> the copy stored in an interface and it definitely would be possible to build a language in which it would be allowed to modify the original value too (like you seem to want): This is basically how Python works. You could just make <code>v = x</code> be syntactic sugar for <code>v = &amp;x</code> when <code>v</code> is of interface type. But that would add reference values to Go, which it <em>intentionally</em> lacks.</p>\n\n<p>I think the root cause of the confusion here is that Go has syntactic sugar to call <code>b.Foo()</code>, even if <code>Foo</code> has a pointer receiver (as long as <code>b</code> is addressable). It's reasonable to be confused that you can call <code>b.Write()</code> but you can't do <code>fmt.Fprintln(b, 42)</code>. Arguably, Go should just not have that sugar and instead require you to explicitly do <code>(&amp;b).Write</code> or just make it a pointer to begin with (using, e.g. <code>b := new(bytes.Buffer)</code> instead of <code>var b bytes.Buffer</code>). But the answer to that is a) it's terribly convenient and b) it didn't seem <em>that</em> unexpected, that <code>b.Foo()</code> might modify <code>b</code>.</p>\n\n<p><strong>tl;dr</strong> is: a) Go does not have references, b) there is no technical reason it couldn't have them (contrary to the other answers' claims) but c) Go decided not to want them.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13869940, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dN_uFTytInA/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucnP7O7WD9GekvePWI7eWdkrX8aJOA/photo.jpg?sz=128", "display_name": "shouhai fu", "link": "https://stackoverflow.com/users/13869940/shouhai-fu"}, "is_accepted": false, "score": 0, "last_activity_date": 1593944019, "creation_date": 1593944019, "answer_id": 62739382, "question_id": 48790663, "link": "https://stackoverflow.com/questions/48790663/why-value-stored-in-an-interface-is-not-addressable-in-golang/62739382#62739382", "title": "Why value stored in an interface is not addressable in Golang", "body": "<p>Helpful info in go doc:https://golang.org/doc/faq#different_method_sets</p>\n<blockquote>\n<p>Even in cases where the compiler could take the address of a value to\npass to the method, if the method modifies the value the changes will\nbe lost in the caller. As an example, if the Write method of\nbytes.Buffer used a value receiver rather than a pointer, this code:</p>\n</blockquote>\n<pre><code>var buf bytes.Buffer\nio.Copy(buf, os.Stdin)\n</code></pre>\n<p>would copy standard input into a copy of buf, not into buf itself. This is almost never the desired behavior.</p>\n"}], "owner": {"reputation": 175, "user_id": 9326964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2121be8b02cc0ee56a78dd6168d4710?s=128&d=identicon&r=PG&f=1", "display_name": "Lemurata", "link": "https://stackoverflow.com/users/9326964/lemurata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3988, "favorite_count": 7, "accepted_answer_id": 48874650, "answer_count": 4, "score": 8, "last_activity_date": 1593944019, "creation_date": 1518621909, "last_edit_date": 1518622684, "question_id": 48790663, "link": "https://stackoverflow.com/questions/48790663/why-value-stored-in-an-interface-is-not-addressable-in-golang", "title": "Why value stored in an interface is not addressable in Golang", "body": "<p>Citing the golang wiki (<a href=\"https://github.com/golang/go/wiki/MethodSets#interfaces\" rel=\"noreferrer\">https://github.com/golang/go/wiki/MethodSets#interfaces</a>):</p>\n\n<p>\"The concrete value stored in an interface is not addressable, in the same way, that a map element is not addressable.\"</p>\n\n<p>The question of map values not being addressable is explained here:\n<a href=\"https://stackoverflow.com/questions/38168329/why-are-map-values-not-addressable\">Why are map values not addressable?</a></p>\n\n<p>However, it is not clear regarding the interface. Why are they not addressable? Is this because of some hard design assumption? </p>\n"}, {"tags": ["pointers", "go", "unsafe-pointers"], "comments": [{"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 4, "creation_date": 1518615697, "post_id": 48788522, "comment_id": 84578851, "body": "There are no guarantees from the language specification about what pointer values are and even if they&#39;ll ever stay the same during the execution of a program (so that compacting garbage collection isn&#39;t made impossible). Because of that it is a very bad idea to use pointers as anything other than something that points to a value. Does it have to be a slice? Since ordering on pointers is meaningless anyway the only thing you achieve is uniqueness, can&#39;t you use maps instead?"}, {"owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1518616479, "post_id": 48788522, "comment_id": 84579434, "body": "Thanks @Art. I tried using maps, but they are way slower than slices in this context."}], "answers": [{"comments": [{"owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "edited": false, "score": 0, "creation_date": 1518619646, "post_id": 48788960, "comment_id": 84581685, "body": "Thank you, I&#39;ll have to try that, I didn&#39;t know <code>make</code> could accept a second parameter for maps."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1518622504, "last_edit_date": 1518622504, "creation_date": 1518616632, "answer_id": 48788960, "question_id": 48788522, "link": "https://stackoverflow.com/questions/48788522/what-is-the-most-efficient-and-portable-way-to-define-an-order-on-pointers/48788960#48788960", "title": "What is the most efficient and portable way to define an order on pointers?", "body": "<p>As said by others, don't do this. Performance can't be that critical to resort to pointer arithmetic in Go.</p>\n\n<p>Pointers are comparable, <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators:</a></p>\n\n<blockquote>\n  <p>Pointer values are comparable. Two pointer values are equal if they point to the same variable or if both have value nil. Pointers to distinct <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">zero-size</a> variables may or may not be equal.</p>\n</blockquote>\n\n<p>Just use a map with the pointers as keys. Simple as that. Yes, indexing maps is slower than indexing slices, but then again, if you'd want to keep your slice sorted and you wanted to perform binary searches in that, then the performance gap decreases, as the (hash) map implementation provides you <code>O(1)</code> lookup while binary search is only <code>O(log n)</code>. In case of big data set, the map might even be faster than searching in the slice.</p>\n\n<p>If you anticipate a big number of pointers in the map, then pre-allocate a big one with <a href=\"https://golang.org/pkg/builtin/#make\" rel=\"nofollow noreferrer\"><code>make()</code></a> passing an estimated upper size, and until your map exceeds this size, no reallocation will occur.</p>\n\n<pre><code>m := make(map[*mytype]struct{}, 1&lt;&lt;20) // Allocate map for 1 million entries\n</code></pre>\n"}], "owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 48788960, "answer_count": 1, "score": 1, "last_activity_date": 1560510622, "creation_date": 1518615290, "last_edit_date": 1560510622, "question_id": 48788522, "link": "https://stackoverflow.com/questions/48788522/what-is-the-most-efficient-and-portable-way-to-define-an-order-on-pointers", "title": "What is the most efficient and portable way to define an order on pointers?", "body": "<p>I have a slice that contains pointers to values. In a performance-critical part of my program, I'm adding or removing values from this slice. For the moment, inserting a value is just an <code>append</code> (<code>O(1)</code> complexity), and removal consists in searching the slice for the corresponding pointer value, from 0 to n-1, until the pointer is found (<code>O(n)</code>). To improve performance, I'd like to sort values in the slice, so that searching can be done using dichotomy (so <code>O(log(n)</code>).</p>\n\n<p>But how can I compare pointer values? Pointer arithmetic is forbidden in go, so AFAIK to compare pointer values <code>p1</code> and <code>p2</code> I have to use the <code>unsafe</code> package and do something like</p>\n\n<pre><code>uintptr(unsafe.Pointer(p1)) &lt; uintptr(unsafe.Pointer(p2))\n</code></pre>\n\n<p>Now, I'm not comfortable using <code>unsafe</code>, at least because of its name. So, is that method correct? Is it portable? Are there potential pitfalls? Is there a better way to define an order on pointer values? I know I could use maps, but maps are slow as hell.</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518614173, "post_id": 48787668, "comment_id": 84577859, "body": "You&#39;ve read the docs, and explained the differences. What is your question, exactly?"}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 0, "creation_date": 1518670778, "post_id": 48787890, "comment_id": 84603104, "body": "Thanks. I kind of get it. But when I replaced <code>NewRecord</code> to <code>Create``&#47;&#47;Photos</code> section, error occurred. <code>Duplicate entry for primary key</code>. Maybe <code>NewRecord</code> don&#39;t have <code>error object</code> so I can&#39;t handling error when transaction."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 0, "creation_date": 1518681828, "post_id": 48787890, "comment_id": 84607425, "body": "<code>NewRecord</code> returns true or false, no error. But in your example, you&#39;re ignoring the return value.  It makes sense that replacing <code>NewRecord</code> with <code>Create</code> would cause an error--because then you try to create the record twice."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1518613276, "creation_date": 1518613276, "answer_id": 48787890, "question_id": 48787668, "link": "https://stackoverflow.com/questions/48787668/what-is-different-between-create-and-newrecord/48787890#48787890", "title": "What is different between Create and NewRecord?", "body": "<p>As you pointed out, <code>Create</code> creates a new row by issuing an <code>INSERT</code>.</p>\n\n<p><code>NewRecord</code> doesn't affect the database at all, it just returns <code>true</code> if the current value's primary key is unset, meaning it's a new record. This means calling <code>NewRecord</code> in void context, as you have done, is meaningless, since you're ignoring the return value.</p>\n"}], "owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2622, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549365403, "creation_date": 1518612556, "last_edit_date": 1549365403, "question_id": 48787668, "link": "https://stackoverflow.com/questions/48787668/what-is-different-between-create-and-newrecord", "title": "What is different between Create and NewRecord?", "body": "<p>According to the document and gorm repo's issue,<br>\n<code>db.Create</code> is insert record.<br>\n<code>db.NewRecord</code> is only check if current value has primary key or not. So do not insert record.</p>\n\n<p>I wrote below this code.<br>\nBut I could insert record with <code>db.Create</code> and <code>db.NewRecord</code>.</p>\n\n<p>What's different between this two methods?</p>\n\n<pre><code>for _, v := range oneday.Onedays {\n    if err := tx.Create(&amp;v).Error; err != nil {\n        tx.Rollback()\n        return model.ResOnedays{}, err\n    }\n\n    // Photos\n    for i, pv := range v.Photos {\n        res := tx.NewRecord(&amp;pv)\n    }\n\n    // Tags\n    for _, tv := range v.Tags {\n        tx.NewRecord(&amp;tv)\n    }\n}\n</code></pre>\n"}, {"tags": ["http", "go", "shutdown", "panic"], "comments": [{"owner": {"reputation": 13, "user_id": 9358283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/286a9f2ac6aa0afaf604b3c340eda1b9?s=128&d=identicon&r=PG&f=1", "display_name": "bhat", "link": "https://stackoverflow.com/users/9358283/bhat"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1518586840, "post_id": 48780295, "comment_id": 84562217, "body": "Thanks for the reminder, I have added the output."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9358283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/286a9f2ac6aa0afaf604b3c340eda1b9?s=128&d=identicon&r=PG&f=1", "display_name": "bhat", "link": "https://stackoverflow.com/users/9358283/bhat"}, "edited": false, "score": 1, "creation_date": 1518587425, "post_id": 48780415, "comment_id": 84562394, "body": "Thanks! I thought it was a channel-related problem, but your answer indeed fixes this!"}], "tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 5, "last_activity_date": 1518587132, "creation_date": 1518587132, "answer_id": 48780415, "question_id": 48780295, "link": "https://stackoverflow.com/questions/48780295/http-server-shutdown-randomly-panic/48780415#48780415", "title": "HTTP Server Shutdown Randomly Panic", "body": "<p>It's panicking because you are sending a nil context while shutting down the server.</p>\n\n<pre><code>for {\n    if srv.closeIdleConns() {\n        return lnerr\n    }\n    select {\n    case &lt;-ctx.Done():\n        return ctx.Err()\n    case &lt;-ticker.C:\n    }\n}\n</code></pre>\n\n<p>This is the snippet from <code>http.Server.Shutdown</code>. Since context is nil and function expects you to send a non-nil context, its panicking.\nYou can fix it by sending <code>context.Background()</code></p>\n\n<pre><code>c.signalServer.Shutdown(context.Background())\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9358283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/286a9f2ac6aa0afaf604b3c340eda1b9?s=128&d=identicon&r=PG&f=1", "display_name": "bhat", "link": "https://stackoverflow.com/users/9358283/bhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 898, "favorite_count": 0, "accepted_answer_id": 48780415, "answer_count": 1, "score": 1, "last_activity_date": 1518596960, "creation_date": 1518586426, "last_edit_date": 1518596960, "question_id": 48780295, "link": "https://stackoverflow.com/questions/48780295/http-server-shutdown-randomly-panic", "title": "HTTP Server Shutdown Randomly Panic", "body": "<p>I am writing a package containing a controller that can start an HTTP server and a watchdog to stop the server when a specific HTTP request is given. However, the program will <strong>randomly</strong> crash because of nil pointer when the watchdog attempts to shutdown the HTTP server. It will crash about twice in 3 attempts. I have simplified the code below. If the code works as normal, it should shutdown the HTTP server after the first request. However, it will properly shutdown only once in three attempts. The other two attempts will end up in nil pointer panic.</p>\n\n<pre><code>// Controller is the controller of signal package.\n// It controls the signal sub http server and make responses\n// when a specific signal is given.\n// It has two concurrent threads, one being the sub http server goroutine,\n// the other being the WatchDog thread for rapid responses and timeout implementation.\ntype Controller struct {\n    signal       chan int\n    signalServer http.Server // The sub http server used.\n}\n\n// Start starts signal server and watchdog goroutine.\nfunc (c *Controller) Start() {\n    go c.signalServer.ListenAndServe()\n    c.watchDog()\n}\n\n// Stop stops only the signal server.\n// Watchdog need not and cannot stop as it can only be stopped from inside.\n// Anyway, watchdog invokes Stop().\nfunc (c *Controller) Stop() {\n    log.Println(\"Stopping Signal server.\")\n    c.signalServer.Shutdown(nil)\n}\n\n// cSignalHandler gets a http handler that can access signal controller.\nfunc (c *Controller) cSignalHandler() func(w http.ResponseWriter, r *http.Request) {\n    // This is the actual handler.\n    // This implementation can perform tasks without blocking this thread.\n    // This handler will send 1 to channel for watchdog to handle.\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Stopped\"))\n        c.signal &lt;- 1\n    }\n}\n\n// watchDog monitors signal through signal controller's signal channel.\n// It performs responses to the signal instead of http server.\n// It will shutdown http server when receives value from channel.\nfunc (c *Controller) watchDog() {\n\n    &lt;-c.signal // Signal received.\n    c.Stop() // Stop signal sub http server when watchDog exits.\n\n    return\n}\n\nfunc main() {\n    con := new(Controller)\n\n    con.signal = make(chan int, 1)\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/signal/\", con.cSignalHandler())\n    con.signalServer = http.Server{\n        Addr:    \":\" + strconv.Itoa(8888),\n        Handler: mux,\n    }\n    con.Start()\n}\n</code></pre>\n\n<p>Also, switching the signalServer field to *http.Server will not help, adding defer to c.Stop() also have no effect. Even switching the signalServer field to *http.Server and check its nil will not help. That means,</p>\n\n<pre><code>type Controller struct {\n    signal       chan int\n    signalServer *http.Server // The sub http server used.\n}\n\nfunc (c *Controller) Stop() {\n    log.Println(\"Stopping Signal server.\")\n    if c.signalServer != nil {\n        c.signalServer.Shutdown(nil)\n    }\n}\n</code></pre>\n\n<p>And changes related code in main() will still randomly crash.</p>\n\n<p>I have no idea what is going on here. I am using golang-1.9 on a 4.13.0-32-generic GNU/Linux machine.</p>\n\n<p>The output stacktrace is below:</p>\n\n<pre><code>2018/02/14 13:37:50 Stopping Signal server.\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x5eab91]\n\ngoroutine 1 [running]:\nnet/http.(*Server).Shutdown(0xc420084ea8, 0x0, 0x0, 0x0, 0x0)\n        /usr/lib/go-1.9/src/net/http/server.go:2506 +0x1b1\nmain.(*Controller).Stop(0xc420084ea0)\n        /home/bhat/Dev/Projects/Go/signal/controller.go:31 +0x91\nmain.(*Controller).watchDog(0xc420084ea0)\n        /home/bhat/Dev/Projects/Go/signal/controller.go:59 +0x45\nmain.(*Controller).Start(0xc420084ea0)\n        /home/bhat/Dev/Projects/Go/signal/controller.go:23 +0x53\nmain.main()\n        /home/bhat/Dev/Projects/Go/signal/main.go:18 +0x1a9\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "buffer", "file-manipulation"], "answers": [{"comments": [{"owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "edited": false, "score": 0, "creation_date": 1518582929, "post_id": 48779654, "comment_id": 84561092, "body": "Still not writing to file though, so scratching my head about that guy as well"}, {"owner": {"reputation": 654, "user_id": 2329794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1595faba70351b69bab5fc337c486d8?s=128&d=identicon&r=PG", "display_name": "Josh McMillan", "link": "https://stackoverflow.com/users/2329794/josh-mcmillan"}, "reply_to_user": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "edited": false, "score": 1, "creation_date": 1518583256, "post_id": 48779654, "comment_id": 84561176, "body": "@ehime I&#39;d start by capturing the <code>error</code> that is returned by <code>file.Sync()</code> and seeing if there&#39;s anything there. That said, it feels like maybe the implementation here is slightly over-engineered \u2013 would it be possible to just mutate a string and then use <code>ioutil.WriteFile</code> to spit out the config, rather than using a buffer?"}, {"owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "edited": false, "score": 0, "creation_date": 1518584072, "post_id": 48779654, "comment_id": 84561387, "body": "Most likely but this is also literally the first app i&#39;ve written in GO ;)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "edited": false, "score": 0, "creation_date": 1518601329, "post_id": 48779654, "comment_id": 84569284, "body": "@ehime I fail to see what file you&#39;re trying to <i>write</i> \u2014 you&#39;re only reading one."}, {"owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518630835, "post_id": 48779654, "comment_id": 84588876, "body": "@kostix I&#39;m trying to write back to the same file im reading from"}, {"owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518632227, "post_id": 48779654, "comment_id": 84589602, "body": "@kostix I got it figured out it was <code>file.WriteTo</code> not <code>buffers.WriteTo</code>"}], "tags": [], "owner": {"reputation": 654, "user_id": 2329794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1595faba70351b69bab5fc337c486d8?s=128&d=identicon&r=PG", "display_name": "Josh McMillan", "link": "https://stackoverflow.com/users/2329794/josh-mcmillan"}, "is_accepted": true, "score": 3, "last_activity_date": 1518582313, "creation_date": 1518582313, "answer_id": 48779654, "question_id": 48779632, "link": "https://stackoverflow.com/questions/48779632/index-out-of-range-while-attempting-to-write-to-file/48779654#48779654", "title": "index out of range while attempting to write to file", "body": "<p>The problem seems to be coming from these two lines inside your <code>ingest</code> function:</p>\n\n<pre><code>n := strings.TrimSpace(a[1])\nv := strings.TrimSpace(a[2])\n</code></pre>\n\n<p>Should that maybe be <code>a[0]</code> and <code>a[1]</code>? </p>\n"}], "owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 48779654, "answer_count": 1, "score": -2, "last_activity_date": 1518597015, "creation_date": 1518582145, "last_edit_date": 1518597015, "question_id": 48779632, "link": "https://stackoverflow.com/questions/48779632/index-out-of-range-while-attempting-to-write-to-file", "title": "index out of range while attempting to write to file", "body": "<p>I believe the issue is that the buffer isn't getting flushed but am not certain, p</p>\n\n<p>Error</p>\n\n<pre><code>bash-4.4$ ./golang-updateprops -f chaosmonkey.config\npanic: runtime error: index out of range\n\ngoroutine 1 [running]:\nmain.ingest(0x7ffeefbff700, 0x12, 0x0, 0x0)\n    #/golang-updateprops/update_properties.go:98 +0xa9d\nmain.main()\n    #/golang-updateprops/update_properties.go:121 +0xb6\n</code></pre>\n\n<p>Code</p>\n\n<pre><code>package main\n\nimport (\n  \"strings\"\n  \"bufio\"\n  \"fmt\"\n  \"regexp\"\n  \"flag\"\n  \"os\"\n  \"io\"\n  \"bytes\"\n)\n\nvar (\n  filename  string\n)\n\nfunc isCommentOrBlank(line string) bool {\n  return strings.HasPrefix(line, \"#\") || \"\" == strings.TrimSpace(line)\n}\n\nfunc fileExists(filename string) bool {\n  if _, err := os.Stat(filename); err == nil {\n    return true\n  }\n  return false\n}\n\nfunc limitLength(s string, length int) string {\n  if len(s) &lt; length {\n    return s\n  }\n  return s[:length]\n}\n\nfunc padWithSpace(str, pad string, length int) string {\n    for {\n        str += pad\n        if len(str) &gt; length {\n            return str[0:length]\n        }\n    }\n}\n\nfunc ingest(filename string) (err error) {\n  file, err := os.OpenFile(filename, os.O_RDWR, 0666)\n  defer file.Close()\n\n  if err != nil {\n    return err\n  }\n\n  reader := bufio.NewReader(file) // Start reading from the file with a reader.\n\n  for {\n    var buffer bytes.Buffer\n    var l []byte\n    var isPrefix bool\n\n    for {\n      l, isPrefix, err = reader.ReadLine()\n      buffer.Write(l)\n\n      if !isPrefix { // If we've reached the end of the line or we're at the EOF, break\n        break\n      }\n    }\n\n    if err == io.EOF || err != nil {\n      break\n    }\n\n    line    := buffer.String()\n    pattern := regexp.MustCompile(`^#([^=]+)=(.+)$`)\n    matches := pattern.FindAllStringSubmatch(line, -1) // matches is [][]string\n\n    for _, string := range matches {\n      n := strings.TrimSpace(string[1])\n      v := strings.TrimSpace(string[2])\n      e := strings.ToLower(strings.Replace(n, \".\", \"/\", -1))\n\n      // newline creation for if block\n      nl := \"{{if exists \\\"/\" + e + \"\\\" -}}\\n\"\n      nl += padWithSpace(n, \" \", 80) + \" = {{getv \\\"\" + e + \"\\\" \\\"\" + v + \"\\\"}}\\n\"\n      nl += \"{{end -}}\\n\"\n\n      buffer.WriteString(nl)\n      file.Sync()\n    }\n\n    // dont proccess comments\n    if (isCommentOrBlank(line)) {\n      buffer.WriteString(line)\n      file.Sync()\n    } else {\n      a := strings.Split(line, \"=\")\n      n := strings.TrimSpace(a[1])\n      v := strings.TrimSpace(a[2])\n      e := strings.ToLower(strings.Replace(n, \".\", \"/\", -1))\n\n      nl := padWithSpace(n, \" \", 80) + \" = {{getv \\\"\" + e + \"\\\" \\\"\" + v + \"\\\"}}\\n\"\n      buffer.WriteString(nl)\n      file.Sync()\n    }\n  }\n\n  if err != io.EOF {\n    fmt.Printf(\" &gt; Failed!: %v\\n\", err)\n  }\n  return\n}\n\nfunc main() {\n  flag.StringVar(&amp;filename, \"f\", \"filename\", \"The file location to be parsed\")\n  flag.Parse()\n\n  if !fileExists(filename) {\n    fmt.Println(\" &gt; File does not exist\\n\")\n  }\n\n  ingest(filename)\n}\n</code></pre>\n\n<p>Config being parsed</p>\n\n<pre><code># The file contains the properties for Chaos Monkey.\n# see documentation at:\n# https://github.com/Netflix/SimianArmy/wiki/Configuration\n\n# let chaos run\nsimianarmy.chaos.enabled = true\n\n# don't allow chaos to kill (ie dryrun mode)\nsimianarmy.chaos.leashed = true\n\n# set to \"false\" for Opt-In behavior, \"true\" for Opt-Out behavior\nsimianarmy.chaos.ASG.enabled = false\n\n# uncomment this line to use tunable aggression\n#simianarmy.client.chaos.class = com.netflix.simianarmy.tunable.TunablyAggressiveChaosMonkey\n\n# default probability for all ASGs\nsimianarmy.chaos.ASG.probability = 1.0\n\n# increase or decrease the termination limit\nsimianarmy.chaos.ASG.maxTerminationsPerDay = 1.0\n\n# Strategies\nsimianarmy.chaos.shutdowninstance.enabled = true\nsimianarmy.chaos.blockallnetworktraffic.enabled = false\nsimianarmy.chaos.burncpu.enabled = false\nsimianarmy.chaos.killprocesses.enabled = false\nsimianarmy.chaos.nullroute.enabled = false\nsimianarmy.chaos.failapi.enabled = false\nsimianarmy.chaos.faildns.enabled = false\nsimianarmy.chaos.faildynamodb.enabled = false\nsimianarmy.chaos.fails3.enabled = false\nsimianarmy.chaos.networkcorruption.enabled = false\nsimianarmy.chaos.networklatency.enabled = false\nsimianarmy.chaos.networkloss.enabled = false\n\n# Force-detaching EBS volumes may cause data loss\nsimianarmy.chaos.detachvolumes.enabled = false\n\n# FillDisk fills the root disk.\n# NOTE: This may incur charges for an EBS root volume.  See burnmoney option.\nsimianarmy.chaos.burnio.enabled = false\n# BurnIO causes disk activity on the root disk.\n# NOTE: This may incur charges for an EBS root volume. See burnmoney option.\nsimianarmy.chaos.filldisk.enabled = false\n\n# Where we know the chaos strategy will incur charges, we won't run it unless burnmoney is true.\nsimianarmy.chaos.burnmoney = false\n\n\n# enable a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.enabled = true\n# simianarmy.chaos.ASG.&lt;asgName&gt;.probability = 1.0\n\n# increase or decrease the termination limit for a specific ASG\n# simianarmy.chaos.ASG.&lt;asgName&gt;.maxTerminationsPerDay = 1.0\n\n# Enroll in mandatory terminations.  If a group has not had a\n# termination within the windowInDays range then it will terminate\n# one instance in the group with a 0.5 probability (at some point in\n# the next 2 days an instance should be terminated), then\n# do nothing again for windowInDays.  This forces \"enabled\" groups\n# that have a probability of 0.0 to have terminations periodically.\nsimianarmy.chaos.mandatoryTermination.enabled = false\nsimianarmy.chaos.mandatoryTermination.windowInDays = 32\nsimianarmy.chaos.mandatoryTermination.defaultProbability = 0.5\n\n# Enable notification for Chaos termination for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.notification.enabled = true\n\n# Set the destination email the termination notification sent to for a specific instance group\n# simianarmy.chaos.&lt;groupType&gt;.&lt;groupName&gt;.ownerEmail = foo@bar.com\n\n# Set the source email that sends the termination notification\n# simianarmy.chaos.notification.sourceEmail = foo@bar.com\n\n# Enable notification for Chaos termination for all instance groups\n#simianarmy.chaos.notification.global.enabled = true\n\n# Set the destination email the termination notification is sent to for all instance groups\n#simianarmy.chaos.notification.global.receiverEmail = foo@bar.com\n\n# Set a prefix applied to the subject of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.subject.prefix = SubjectPrefix\n\n# Set a suffix applied to the subject of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n#simianarmy.chaos.notification.subject.suffix =  \\ SubjectSuffix\n\n# Set a prefix applied to the body of all termination notifications\n# Probably want to include a trailing space to separate from start of default text\n#simianarmy.chaos.notification.body.prefix = BodyPrefix\n\n# Set a suffix applied to the body of all termination notifications\n# Probably want to include an escaped space \" \\ \" to separate from end of default text\n#simianarmy.chaos.notification.body.suffix =  \\ BodySuffix\n\n# Enable the email subject to be the same as the body, to include terminated instance and group information\n#simianarmy.chaos.notification.subject.isBody = true\n#set the tag filter on the ASGs to terminate only instances from the ASG with the this tag key and value\n#simianarmy.chaos.ASGtag.key = chaos_monkey\n#simianarmy.chaos.ASGtag.value = true\n</code></pre>\n"}, {"tags": ["go", "docker-compose", "grpc"], "comments": [{"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1518591841, "post_id": 48779121, "comment_id": 84564144, "body": "Why are you listening to userip from server? <code>lis, err := net.Listen(&quot;tcp&quot;, &quot;userserver:3001&quot;)</code> Server should be registered to it&#39;s own ip and/or port. <a href=\"https://golang.org/pkg/net/#pkg-overview\" rel=\"nofollow noreferrer\">More info net pkg</a>"}, {"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1518591909, "post_id": 48779121, "comment_id": 84564175, "body": "And when you dial it should be <code>apiserver:port</code>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "reply_to_user": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1518592924, "post_id": 48779121, "comment_id": 84564638, "body": "the client is <code>apiserver</code> and the <code>userserver</code> is gRPC server, the reason why client is called <code>apiserver</code> is because it also works as http proxy. So the  <code>apiserver</code> container tries to dial <code>userserver </code> container"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518593602, "post_id": 48779121, "comment_id": 84564969, "body": "<code>WithInsecure</code> disables transport security."}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518593662, "post_id": 48779121, "comment_id": 84564999, "body": "Ye but I think I need it right ? I am not using any certs, just want to make it work atm"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518595625, "post_id": 48779121, "comment_id": 84565908, "body": "When it says it disables transport security, it really means it: no TLS, no TLS handshake, etc.... it&#39;s just plaintext. If you want to skip cert verification, you need to pass a <code>tls.Config</code> object with <code>InsecureSkipVerify</code>. Your server is expecting a <code>ClientHello</code> message and getting some random request."}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518595865, "post_id": 48779121, "comment_id": 84566021, "body": "and can I make server to not expect hello message ? I mean how to I make server work with client <code>WithInsecure</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518595967, "post_id": 48779121, "comment_id": 84566079, "body": "Then you need to make the server insecure as well. But your whole question is about using TLS, so just pass a tls config to the client."}], "answers": [{"comments": [{"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518599049, "post_id": 48782903, "comment_id": 84567713, "body": "but I do not want to use any certificates, or is it impossible with tls ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518599542, "post_id": 48782903, "comment_id": 84568067, "body": "You can fill in the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> fields as you like. Eg: <code>InsecureSkipVerify</code> to disable all certificate checks."}, {"owner": {"reputation": 63, "user_id": 6130472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHDzp.jpg?s=128&g=1", "display_name": "Sah4ez", "link": "https://stackoverflow.com/users/6130472/sah4ez"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518599858, "post_id": 48782903, "comment_id": 84568296, "body": "@Marc right. You can use like this <code>creds := credentials.NewTLS(&amp;tls.Config{ ClientAuth:   tls.InsecureSkipVerify})</code>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518602663, "post_id": 48782903, "comment_id": 84570138, "body": "i&#39;ve set <code>creds := credentials.NewTLS(&amp;tls.Config{InsecureSkipVerify: true}) grpcServer := grpc.NewServer(grpc.Creds(creds))</code> on server and <code>creds := credentials.NewTLS(&amp;tls.Config{InsecureSkipVerify: true}) conn, err := grpc.Dial(&quot;userserver:3001&quot;, grpc.WithTransportCredentials(creds))</code> But still same error"}, {"owner": {"reputation": 63, "user_id": 6130472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHDzp.jpg?s=128&g=1", "display_name": "Sah4ez", "link": "https://stackoverflow.com/users/6130472/sah4ez"}, "edited": false, "score": 0, "creation_date": 1518603047, "post_id": 48782903, "comment_id": 84570367, "body": "For client, need use too <code>credntials.TLS{}</code> and in <code>tls.Config</code> need set <code>ServerName: yourName</code>. You can see in <a href=\"https://bbengfort.github.io/programmer/2017/03/03/secure-grpc.html\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518603404, "post_id": 48782903, "comment_id": 84570608, "body": "for client or server ? because for client it doesn&#39;t seem to change anything"}, {"owner": {"reputation": 63, "user_id": 6130472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHDzp.jpg?s=128&g=1", "display_name": "Sah4ez", "link": "https://stackoverflow.com/users/6130472/sah4ez"}, "edited": false, "score": 0, "creation_date": 1518603476, "post_id": 48782903, "comment_id": 84570657, "body": "And for client and for server."}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1518603672, "post_id": 48782903, "comment_id": 84570777, "body": "so for client i pass server host as ServerName and for server the client host ?"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518604511, "post_id": 48782903, "comment_id": 84571366, "body": "@Sah4ez @Marc could you guys as well explain please why it this simplest example <a href=\"https://medium.com/pantomath/how-we-use-grpc-to-build-a-client-server-system-in-go-dd20045fa1c2\" rel=\"nofollow noreferrer\">here</a> setup using <code>WithInsecure</code> works and in my case it does not ?"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 1, "creation_date": 1518604713, "post_id": 48782903, "comment_id": 84571506, "body": "but it doesn&#39;t :( in this case i do not think the tls config or WithInsecure is a problem, there has to be something with my docker-compose setup"}], "tags": [], "owner": {"reputation": 63, "user_id": 6130472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHDzp.jpg?s=128&g=1", "display_name": "Sah4ez", "link": "https://stackoverflow.com/users/6130472/sah4ez"}, "is_accepted": true, "score": 0, "last_activity_date": 1518597849, "creation_date": 1518597849, "answer_id": 48782903, "question_id": 48779121, "link": "https://stackoverflow.com/questions/48779121/how-to-set-up-docker-compose-containers-for-grpc-tls-connection/48782903#48782903", "title": "How to set up docker-compose containers for gRPC TLS connection?", "body": "<p>You are missing <code>grpc.Creads(...)</code></p>\n\n<p>We are use this code:</p>\n\n<pre><code>package main\n\nimport(\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"crypto/x509/pkix\"\n    \"io/ioutil\"\n\n    \"google.golang.org/grpc\"\n    \"google.golang.org/grpc/credentials\"\n    \"mysource.com/packages/grpcserver\"\n)\n\nfunc main(){\n    cert := \"/path/to/cert.crt\"\n    key := \"/path/to/cert.key\"\n    caCrt := \"/path/to/my.ca\"\n\n    certificate, err := tls.LoadX509KeyPair(cert, key)\n    if err != nil {\n        return\n    }   \n    certPool := x509.NewCertPool()\n\n    ca, err := ioutil.ReadFile(caCrt)\n    if err != nil {\n        return\n    }\n\n    if ok := certPool.AppendCertsFromPEM(ca); !ok {\n        return\n    }\n    creds := credentials.NewTLS(&amp;tls.Config{\n        ClientAuth:   tls.RequireAndVerifyClientCert,\n        Certificates: []tls.Certificate{certificate},\n        ClientCAs:    certPool,\n        MinVersion:   tls.VersionTLS12,\n    })\n\n    grpcServer := grpc.NewServer(grpc.Creds(creds))\n    server := grpcserver.NewGrpcServer()\n    grpcserver.RegisterGrpcServer(grpcServer, server)\n\n    lis, err := net.Listen(\"tcp\", \"0.0.0.0:11311\")      \n    log.Fatal(grpcServer.Serve(lis))\n}\n</code></pre>\n"}], "owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1543, "favorite_count": 1, "accepted_answer_id": 48782903, "answer_count": 1, "score": 2, "last_activity_date": 1518600387, "creation_date": 1518578510, "last_edit_date": 1518600387, "question_id": 48779121, "link": "https://stackoverflow.com/questions/48779121/how-to-set-up-docker-compose-containers-for-grpc-tls-connection", "title": "How to set up docker-compose containers for gRPC TLS connection?", "body": "<p>I have a <strong>gRPC</strong> client and a server as two docker containers declared with docker-compose.</p>\n\n<pre><code>version: '3.3'\nservices:\n  apiserver:\n    image: golang:latest\n    container_name: apiserver\n    expose:\n      - \"3000\"\n    ports:\n      - \"3000:3000\"\n    command: go run cmd/apiserver/main.go\n\n  userserver:\n    image: golang:latest\n    container_name: userserver\n    expose:\n      - \"3001\"\n    ports:\n      - \"3001:3001\"\n    command: go run cmd/userserver/main.go\n</code></pre>\n\n<p>I omitted some things like volumes etc as I think they are not related to the issue.</p>\n\n<p>When a client tries to dial server I get an error <code>TLS handshake error from 172.22.0.1:34824: tls: oversized record received with length 21536</code></p>\n\n<p>server (<strong>userserver</strong>):</p>\n\n<pre><code>lis, err := net.Listen(\"tcp\", \"userserver:3001\")\nif err != nil {\n    logger.Critical(ctx, \"failed to listen: %v\", err)\n}\n\ngrpcServer := grpc.NewServer()\nuserServer := userserver.New()\npb.RegisterDomainServer(grpcServer, userServer)\nrpcErr := grpcServer.Serve(lis)\n\nif rpcErr != nil {\n    logger.Critical(ctx, \"failed to serve: %v\", rpcErr)\n}\n</code></pre>\n\n<p>client (<strong>apiserver</strong>):</p>\n\n<pre><code>conn, err := grpc.Dial(\"userserver:3001\", grpc.WithInsecure())\nif err != nil {\n    return err\n}\ndefer conn.Close()\n\nclient := pb.NewDomainClient(conn)\n_, err = client.Dispatch(ctx, &amp;pb.Command{\n    Name:    command,\n    Payload: payload,\n})\n</code></pre>\n\n<h2>Info</h2>\n\n<p>the client is <code>apiserver</code> and the <code>userserver</code> is gRPC server, the reason why client is called <code>apiserver</code> is because it also works as http proxy. So the  <code>apiserver</code> container tries to dial <code>userserver</code> container</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 221545, "user_id": 535871, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/nhcvo.jpg?s=128&g=1", "display_name": "Ted Hopp", "link": "https://stackoverflow.com/users/535871/ted-hopp"}, "edited": false, "score": 0, "creation_date": 1518568531, "post_id": 48777882, "comment_id": 84557458, "body": "So the whole thing would be valid JSON if the top-level spaces (outside quoted strings) were replaced by commas and the whole thing surrounded by square brackets?"}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1518569156, "post_id": 48777882, "comment_id": 84557638, "body": "I don&#39;t know if this is an academic or personal exercise but a <a href=\"https://golang.org/pkg/encoding/json/#Valid\" rel=\"nofollow noreferrer\">Valid</a> function exists already."}, {"owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "reply_to_user": {"reputation": 221545, "user_id": 535871, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/nhcvo.jpg?s=128&g=1", "display_name": "Ted Hopp", "link": "https://stackoverflow.com/users/535871/ted-hopp"}, "edited": false, "score": 0, "creation_date": 1518569910, "post_id": 48777882, "comment_id": 84557845, "body": "Yes @TedHopp. I also wish the input json strings are separated by comma &gt;.&lt;, then it won&#39;t be such a hard problem to me.."}, {"owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1518570124, "post_id": 48777882, "comment_id": 84557905, "body": "Thanks @squiguy, Vaild won&#39;t help, because input is not json, but multiple json concatenated with spaces/newlines."}, {"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1518572526, "post_id": 48777882, "comment_id": 84558469, "body": "It seems like there&#39;s a big issue with your premise: <code>&quot;test&quot; 123</code> is not valid JSON. Given that, you can ignore anything that doesn&#39;t start with a <code>{</code> and go to a matching <code>}</code>"}, {"owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1518573738, "post_id": 48777882, "comment_id": 84558767, "body": "Hi @Verran, I know <code>&quot;test&quot; 123</code> is not valid JSON, but I treat it as my valid input because it is <b>in form of multiple json string separated by spaces/newline</b>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1518585456, "post_id": 48777882, "comment_id": 84561787, "body": "Have you tried encoding/json.Decoder on your stream repeatedly? Becuase I think the whole purpose of Decoder is to work its way through such streams of JSON elements."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1518606717, "post_id": 48777882, "comment_id": 84572815, "body": "@vancexu: If you are accepting both &quot;valid JSON&quot; and &quot;not valid JSON&quot; then you&#39;re going to have to be <i>much</i> clearer about your requirements before we can come up with a solution."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518598981, "post_id": 48781823, "comment_id": 84567679, "body": "It will be more efficient to decode to a <code>struct{}</code>--this will still validate the JSON input, but won&#39;t allocate any memory."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518607604, "post_id": 48781823, "comment_id": 84573401, "body": "@Flimzy, but fail if the JSON document isn&#39;t an object. However, json.RawMessage is probably still much better than interface{}. I&#39;ll update the answer."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1518609419, "post_id": 48781823, "comment_id": 84574631, "body": "Indeed, json.RawMessage is a good compromise between functionality of struct{} and performance of interface{}. Although ideal would still be not to allocate any memory at all. A custom type with a no-op Unmarshal method could accomplish this. But probably iterating through the tokens is even better."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1518607641, "last_edit_date": 1518607641, "creation_date": 1518593465, "answer_id": 48781823, "question_id": 48777882, "link": "https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format/48781823#48781823", "title": "Check if strings are JSON format", "body": "<p>As Volker mentioned in the comments, use a *json.Decoder to decode all json documents in your input successively:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    input := `\"test\" 123 {\"Name\": \"mike\"}`\n    dec := json.NewDecoder(strings.NewReader(input))\n\n    for {\n            var x json.RawMessage\n            switch err := dec.Decode(&amp;x); err {\n            case nil:\n                    // not done yet\n            case io.EOF:\n                    return // success\n            default:\n                    log.Fatal(err)\n            }\n    }\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/1OKOii9mRHn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1OKOii9mRHn</a></p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518603551, "post_id": 48783449, "comment_id": 84570710, "body": "The first option has some drawbacks, e.g. it can only unmarshal JSON objects (and fails to unmarshal valid values like <code>123</code> or <code>&quot;abc&quot;</code> or JSON objects), so to make it work, <code>interface{}</code> is needed to handle all cases. The second option does not have that restriction, good idea with getting only the tokens."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518604546, "post_id": 48783449, "comment_id": 84571390, "body": "@icza: Good observation."}, {"owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "edited": false, "score": 0, "creation_date": 1518656715, "post_id": 48783449, "comment_id": 84599988, "body": "Thanks @Flimzy, option 2 using Token helped me solve my problem gracefully. I tested it against 150KB input string, blazing fast less than sec."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1518605537, "last_edit_date": 1518605537, "creation_date": 1518599848, "answer_id": 48783449, "question_id": 48777882, "link": "https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format/48783449#48783449", "title": "Check if strings are JSON format", "body": "<p>There are two options.  The simplest, from a coding standpoint, is going to be just to decode the JSON string normally. You can make this most efficient by decoding to an empty struct:</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\n\nfunc main() {\n    input := []byte(`{\"a\":\"b\", \"c\": 123}`)\n    var x struct{}\n    if err := json.Unmarshal(input, &amp;x); err != nil {\n        panic(err)\n    }\n\n    input = []byte(`{\"a\":\"b\", \"c\": 123}xxx`) // This one fails\n    if err := json.Unmarshal(input, &amp;x); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/VheJf-cd-yD\" rel=\"nofollow noreferrer\">playground link</a>)</p>\n\n<p>This method has a few potential drawbacks:</p>\n\n<ul>\n<li>It only works with a single JSON object. That is, a list of objects (as requested in the question) will fail, without additional logic.</li>\n<li>As pointed out by @icza in comments, it only works with JSON objects, so bare arrays, numbers, or strings will fail. To accomodate these types, <code>interface{}</code> must be used, which introduces the potential for some serious performance penalties.</li>\n<li>The throw-away <code>x</code> value must still be allocated, and at least one reflection call is likely under the sheets, which may introduce a noticeable performance penalty for some workloads.</li>\n</ul>\n\n<p>Given these limitations, my recommendation is to use the second option: loop through the entire JSON input, ignoring the actual contents. This is made simple with the standard library <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\">json.Decoder</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"io\"\n)\n\nfunc main() {\n        input := []byte(`{\"a\":\"b\", \"c\": 123}`)\n        dec := json.NewDecoder(bytes.NewReader(input))\n        for {\n            _, err := dec.Token()\n            if err == io.EOF {\n                break // End of input, valid JSON\n            }\n            if err != nil {\n                panic(err) // Invalid input\n            }\n        }\n\n        input = []byte(`{\"a\":\"b\", \"c\": 123}xxx`) // This input fails\n        dec = json.NewDecoder(bytes.NewReader(input))\n        for {\n            _, err := dec.Token()\n            if err == io.EOF {\n                break // End of input, valid JSON\n            }\n            if err != nil {\n                panic(err) // Invalid input\n            }\n        }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/QHYK3aCEImk\" rel=\"nofollow noreferrer\">playground link</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 2246, "user_id": 274937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d848784d081501a5cba4a2fa7856e965?s=128&d=identicon&r=PG", "display_name": "valyala", "link": "https://stackoverflow.com/users/274937/valyala"}, "is_accepted": false, "score": 0, "last_activity_date": 1528647848, "creation_date": 1528647848, "answer_id": 50785730, "question_id": 48777882, "link": "https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format/50785730#50785730", "title": "Check if strings are JSON format", "body": "<p>Try <a href=\"https://godoc.org/github.com/valyala/fastjson#Scanner\" rel=\"nofollow noreferrer\">fastjson.Scanner</a>:</p>\n\n<pre><code>s := `\"test\" 123 {\"Name\": \"mike\"}`\n\nvar sc fastjson.Scanner\nsc.Init(s)\n\n// Iterate over a stream of json objects\nfor sc.Next() {}\nif sc.Error() != nil {\n    fmt.Println(\"ok\")\n} else {\n    fmt.Println(\"false\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1847, "favorite_count": 1, "accepted_answer_id": 48783449, "answer_count": 3, "score": 2, "last_activity_date": 1528647848, "creation_date": 1518568078, "last_edit_date": 1518656363, "question_id": 48777882, "link": "https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format", "title": "Check if strings are JSON format", "body": "<p>How to check if a given string is in form of multiple json string separated by spaces/newline?</p>\n\n<p>For example,<br>\ngiven: <code>\"test\" 123 {\"Name\": \"mike\"}</code> (3 json concatenated with space)<br>\nreturn: <code>true</code>, since each of item (<code>\"test\"</code> <code>123</code> and <code>{\"Name\": \"mike\"}</code>) is a valid json.</p>\n\n<p>In Go, I can write a O(N^2) function like:</p>\n\n<pre><code>// check given string is json or multiple json concatenated with space/newline\nfunc validateJSON(str string) error {\n    // only one json string\n    if isJSON(str) {\n        return nil\n    }\n    // multiple json string concatenate with spaces\n    str = strings.TrimSpace(str)\n    arr := []rune(str)\n    start := 0\n    end := 0\n    for start &lt; len(str) {\n        for end &lt; len(str) &amp;&amp; !unicode.IsSpace(arr[end]) {\n            end++\n        }\n        substr := str[start:end]\n        if isJSON(substr) {\n            for end &lt; len(str) &amp;&amp; unicode.IsSpace(arr[end]) {\n                end++\n            }\n            start = end\n        } else {\n            if end == len(str) {\n                return errors.New(\"error when parsing input: \" + substr)\n            }\n            for end &lt; len(str) &amp;&amp; unicode.IsSpace(arr[end]) {\n                end++\n            }\n        }\n    }\n    return nil\n}\n\nfunc isJSON(str string) bool {\n    var js json.RawMessage\n    return json.Unmarshal([]byte(str), &amp;js) == nil\n}\n</code></pre>\n\n<p>But this won't work for large input.  </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 1, "creation_date": 1518565986, "post_id": 48777392, "comment_id": 84556762, "body": "I would complain to the API creator that that should be an array of 20 objects. Not 40 numbered key value pairs."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1518573365, "post_id": 48777392, "comment_id": 84558683, "body": "@cricket_007 Could be an ancient API from the before-times when there were problems with top level arrays in JSON. Still a pretty nasty structure though."}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1518576286, "post_id": 48777392, "comment_id": 84559372, "body": "@mu It could still put a key with an array value, but all json parsers I have used can deal with top level arrays"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 3, "last_activity_date": 1518565634, "creation_date": 1518565634, "answer_id": 48777509, "question_id": 48777392, "link": "https://stackoverflow.com/questions/48777392/unmartialing-a-json-object-with-a-variable-number-of-similar-fields/48777509#48777509", "title": "Unmartialing a JSON object with a variable number of similar fields", "body": "<p>The simplest thing you could do would be to unmarshal into a <code>map[string]string</code> and use it as is, but here is a neater thing you can do: define</p>\n\n<pre><code>type Artist struct {\n    Name string\n    URI string // could be *uri.URL instead\n}\n\ntype Foo struct {\n    Artists []Artist\n}\n</code></pre>\n\n<p>And then write a <code>func (f *Foo) UnmarshalJSON(data []byte) error {</code> which unmarshals into a <code>map[string]string</code>, and then checks each pair of keys in turn. If it finds them, it appends to <code>f.Artists</code>, and if it doesn't, it stops.</p>\n"}], "owner": {"reputation": 6967, "user_id": 1967601, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d9746cae380a9bd857e8cc534527fc?s=128&d=identicon&r=PG", "display_name": "James Scholes", "link": "https://stackoverflow.com/users/1967601/james-scholes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518565634, "creation_date": 1518564714, "question_id": 48777392, "link": "https://stackoverflow.com/questions/48777392/unmartialing-a-json-object-with-a-variable-number-of-similar-fields", "title": "Unmartialing a JSON object with a variable number of similar fields", "body": "<p>I'm dealing with an API which can spit out JSON like this:</p>\n\n<pre><code>{\n    \"artist_name\": \"Wilhelm Stenhammar\",\n    \"artist_name:1\": \"Helsingborg Symphony Orchestra\",\n    \"artist_name:10\": \"NDR Radiophilharmonie\",\n    \"artist_name:11\": \"Malm\\u00f6 Opera Orchestra\",\n    \"artist_name:12\": \"Radio Filharmonisch Orkest Holland\",\n    \"artist_name:13\": \"Symphony Orchestra Of Norrlands Opera\",\n    \"artist_name:14\": \"Pilsen Philharmonic Orchestra\",\n    \"artist_name:15\": \"Latvian National Symphony\",\n    \"artist_name:16\": \"SWR Radiofunkorchester, Kaiserslauten\",\n    \"artist_name:17\": \"Orquesta Sinf\\u00f3nica de San Luis Potos\\u00ed\",\n    \"artist_name:2\": \"Arvo Volmer\",\n    \"artist_name:3\": \"V\\u00e4ster\\u00e5s Symphony Orchestra\",\n    \"artist_name:4\": \"G\\u00e4vle Symphony Orchestra\",\n    \"artist_name:5\": \"Royal Danish Orchestra\",\n    \"artist_name:6\": \"Stuttgart Philharmonic Orchestra\",\n    \"artist_name:7\": \"Turku Philharmonic Orchestra\",\n    \"artist_name:8\": \"Gothenburg Opera Orchestra\",\n    \"artist_name:9\": \"Moscow Symphony Orchestra\",\n    \"artist_uri\": \"spotify:artist:6gfRaesyLupPd0gDQaLwJV\",\n    \"artist_uri:1\": \"spotify:artist:0K2m2TlgHkcp32NAZV6Omw\",\n    \"artist_uri:10\": \"spotify:artist:6i9KFEJuHq78nMsQxeB1vR\",\n    \"artist_uri:11\": \"spotify:artist:2bgesrziKLjYqObZ1i6KpO\",\n    \"artist_uri:12\": \"spotify:artist:4TlqQbYkCmCDsrlkI2a09s\",\n    \"artist_uri:13\": \"spotify:artist:1sKkv2iobrvnJtPtLJABf4\",\n    \"artist_uri:14\": \"spotify:artist:5DEoOcExTp3y8yRzBVG1Bw\",\n    \"artist_uri:15\": \"spotify:artist:4WP9O07oZuFjNpaoo8ktCf\",\n    \"artist_uri:16\": \"spotify:artist:0AgZxnsoQq8uKYQEDQnO9N\",\n    \"artist_uri:17\": \"spotify:artist:5qXInUZHHgmah0TPvUuq4l\",\n    \"artist_uri:2\": \"spotify:artist:5zZjojCwIPWfzXOtSKTa0W\",\n    \"artist_uri:3\": \"spotify:artist:4OYpD0LcwEZb5BdhyeJ7zT\",\n    \"artist_uri:4\": \"spotify:artist:2DMF5PvArh8PhpR1YRDBgv\",\n    \"artist_uri:5\": \"spotify:artist:3JZPA9VxDLixJfKDNbmlbT\",\n    \"artist_uri:6\": \"spotify:artist:2G3SGwAd7uOTVm1y4IijBg\",\n    \"artist_uri:7\": \"spotify:artist:2yJX6ev7Io4KagCeNdXFBB\",\n    \"artist_uri:8\": \"spotify:artist:6fqElxCA09nHlqdkzY1sN9\",\n    \"artist_uri:9\": \"spotify:artist:0udLXDzunp4xQRWhMNQPci\",   }\n}\n</code></pre>\n\n<p>The object has multiple artist names and a URI for each one.  In some cases there may be more or less artists than in the example here, including the most common case of there only being 1.</p>\n\n<pre><code>{\n    \"artist_name\": \"Wilhelm Stenhammar\",\n    \"artist_uri\": \"spotify:artist:6gfRaesyLupPd0gDQaLwJV\",\n}\n</code></pre>\n\n<p>What would be the best way to unmartial this object to capture all possible numbers of artist names and URIs?  In the end I'd like to have an array of Artist objects with a Name and URI field, and the unmartialed array should reflect the order of the artists in the JSON.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518561249, "post_id": 48776674, "comment_id": 84555308, "body": "you mean <code>e := int(new(big.Int).SetBytes(e_data).Int64())</code>? You could encoding/binary, but then you have to pad the slice yourself."}, {"owner": {"reputation": 51, "user_id": 6224272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qM2Rq.jpg?s=128&g=1", "display_name": "Oleksiy Ivanenko", "link": "https://stackoverflow.com/users/6224272/oleksiy-ivanenko"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518562012, "post_id": 48776674, "comment_id": 84555548, "body": "@JimB Yes, that&#39;s exactly what I meant. But that solution still looks too complex for such a simple use case. May be I&#39;ve spent to little time using Go and just not used to it yet."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518566134, "post_id": 48776674, "comment_id": 84556805, "body": "Normally you would probably use <code>encoding&#47;binary</code>, but since your data is only 3 bytes you have to pad it out yourself, which doesn&#39;t look any cleaner -- <code>int(binary.BigEndian.Uint32(append(make([]byte, 4-len(eData)), eData...)))</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518577158, "post_id": 48776674, "comment_id": 84559555, "body": "Also, don\u2019t forget that the RFC suggests only 65537, so you could probably just map the base64 value directly to the exponent. (In reality there are only a few other exponents in use, but they are rarely encountered.)"}], "answers": [{"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1616350691, "creation_date": 1616350691, "answer_id": 66735930, "question_id": 48776674, "link": "https://stackoverflow.com/questions/48776674/convert-base64-string-to-int-for-cryptographic-use-in-go/66735930#66735930", "title": "Convert base64 string to int for cryptographic use in Go", "body": "<p>This seems to do it:</p>\n<pre><code>package main\n\nimport (\n   &quot;encoding/base64&quot;\n   &quot;encoding/binary&quot;\n   &quot;log&quot;\n)\n\nfunc decode(s string) (uint32, error) {\n   a, e := base64.StdEncoding.DecodeString(s)\n   if e != nil {\n      return 0, e\n   }\n   return binary.LittleEndian.Uint32(append(a, 0)), nil\n}\n\nfunc main() {\n   n, e := decode(&quot;AQAB&quot;)\n   if e != nil {\n      log.Fatal(e)\n   }\n   println(n == 65537)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/encoding/binary\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/binary</a></p>\n"}], "owner": {"reputation": 51, "user_id": 6224272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qM2Rq.jpg?s=128&g=1", "display_name": "Oleksiy Ivanenko", "link": "https://stackoverflow.com/users/6224272/oleksiy-ivanenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1467, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1616350691, "creation_date": 1518560595, "last_edit_date": 1518591269, "question_id": 48776674, "link": "https://stackoverflow.com/questions/48776674/convert-base64-string-to-int-for-cryptographic-use-in-go", "title": "Convert base64 string to int for cryptographic use in Go", "body": "<p>I'm trying to do some simple cryptography using golang.</p>\n\n<p>I have an RSA public key in form of base64 encoded modulo and exponent.\nI want to use that values to instantiate <a href=\"https://golang.org/pkg/crypto/rsa/#PublicKey\" rel=\"noreferrer\">rsa.PublicKey struct</a>.</p>\n\n<p>Converting modulo base64 string to big.Int looks pretty straightforward for me.</p>\n\n<p>Unexpectedly, I had a lot of trouble trying to convert base64 string to simple int (the exponent part of RSA key).</p>\n\n<p>The best thing I've came up with:</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/base64\"\n        \"fmt\"\n        \"math/big\"\n)\n\nfunc main() {\n        e_data, _ := base64.RawURLEncoding.DecodeString(\"AQAB\")\n\n        e_big := new(big.Int)\n        e_big.SetBytes(e_data)\n        e := int(e_big.Int64())\n\n        // Finally I have an int here to use it in rsa.PublicKey struct\n        fmt.Println(e)\n}\n</code></pre>\n\n<p>Is there any better, more simple way to convert base64 string to int?</p>\n"}, {"tags": ["go", "travis-ci", "dependency-management"], "answers": [{"comments": [{"owner": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "edited": false, "score": 0, "creation_date": 1519094689, "post_id": 48776855, "comment_id": 84758238, "body": "Yep, it was a git problem. Doing a <code>rm</code> on the dependency directories solved the problem!"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 2, "last_activity_date": 1518566518, "last_edit_date": 1518566518, "creation_date": 1518561539, "answer_id": 48776855, "question_id": 48776627, "link": "https://stackoverflow.com/questions/48776627/go-get-t-travis-ci-and-installing-all-go-dependencies/48776855#48776855", "title": "&quot;go get -t ./...&quot;, Travis CI, and installing all go dependencies", "body": "<blockquote>\n  <p>How do I get all the dependencies to install at once?</p>\n</blockquote>\n\n<p>That's what <code>go get</code> does... it looks like something might be misconfigured or corrupted in your case.  You could start by trying some things.</p>\n\n<ul>\n<li><p><code>go get</code> installs into the first path in the $GOPATH environment variable.  Confirm that it is set to what you want (usually a path ending in a directory named <code>go</code>; subdirs <code>src</code>, <code>pkg</code>, etc. will be created).</p></li>\n<li><p>If you're going to use <code>./...</code>, make sure you're calling <code>go get</code> from the right directory.</p></li>\n<li><p>Check to make sure the git root is in the right place</p></li>\n<li><p>try using a non-wildcard name/path/address for the package you want to get, instead of <code>./...</code></p></li>\n<li><p>try calling <code>go get</code> without the <code>-t</code> flag</p></li>\n</ul>\n\n<p>If none of that works, you may be able to solve the problem by deleting the directory (home/travis/build/path/to/package) and trying again -- make sure you aren't deleting any code you worked on, or the git repository/files, unless it's backed up somewhere.</p>\n\n<p>According to <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"nofollow noreferrer\">Go tools documentation</a>, you should only need to call </p>\n\n<pre><code>go get [packages]\n</code></pre>\n\n<p>to install the named packages along with their dependencies:</p>\n\n<blockquote>\n  <p>Get downloads the packages named by the import paths, along with their dependencies. It then installs the named packages, like 'go install'.</p>\n</blockquote>\n\n<p>The <code>...</code> ellipsis is a wildcard that can expand to match any string.  See section on <a href=\"https://golang.org/cmd/go/#hdr-Description_of_package_lists\" rel=\"nofollow noreferrer\">Description of Package Lists</a>:</p>\n\n<blockquote>\n  <p>An import path is a pattern if it includes one or more \"...\" wildcards, each of which can match any string, including the empty string and strings containing slashes. Such a pattern expands to all package directories found in the GOPATH trees with names matching the patterns. </p>\n</blockquote>\n\n<p>The <code>./</code> means \"here\": so make sure you're running from the right directory if you're going to use <code>./...</code></p>\n\n<p>The <code>-t</code> flag is for downloading the packages required to build the tests:</p>\n\n<blockquote>\n  <p>The -t flag instructs get to also download the packages required to build the tests for the specified packages.</p>\n</blockquote>\n\n<p>The error you're seeing is related to git.  Sometimes the cause is unknown, but it can often be fixed by deleting the directory and starting again (see, e.g., <a href=\"https://github.com/golang/lint/issues/213\" rel=\"nofollow noreferrer\">\"Error to install golint\"</a> or <a href=\"https://stackoverflow.com/a/28690350/1964690\">\"Correct way to get package\"</a>)</p>\n\n<p>(You might also find <a href=\"https://robots.thoughtbot.com/configure-travis-ci-for-go\" rel=\"nofollow noreferrer\">this blog post on configuring travis-ci for Go</a> helpful.)</p>\n"}], "owner": {"reputation": 656, "user_id": 5721702, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WDGk4.png?s=128&g=1", "display_name": "Huy-Anh Hoang", "link": "https://stackoverflow.com/users/5721702/huy-anh-hoang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 933, "favorite_count": 0, "accepted_answer_id": 48776855, "answer_count": 1, "score": 1, "last_activity_date": 1518566518, "creation_date": 1518560358, "question_id": 48776627, "link": "https://stackoverflow.com/questions/48776627/go-get-t-travis-ci-and-installing-all-go-dependencies", "title": "&quot;go get -t ./...&quot;, Travis CI, and installing all go dependencies", "body": "<p>In the documentation here: <a href=\"https://docs.travis-ci.com/user/languages/go#Dependency-Management\" rel=\"nofollow noreferrer\">https://docs.travis-ci.com/user/languages/go#Dependency-Management</a></p>\n\n<p>This is the install dependencies step:</p>\n\n<blockquote>\n  <p>if go version is greater than or equal to 1.2</p>\n</blockquote>\n\n<pre><code>go get -t ./...\n</code></pre>\n\n<p>My project looks like this:</p>\n\n<pre><code>root\n---- src\n  ---- github.com\n  ---- myProject\n---- pkg\n</code></pre>\n\n<p>the <code>GOPATH</code> is set to <code>root</code></p>\n\n<p>but I am getting this error:</p>\n\n<pre><code>package github.com/aws/aws-lambda-go/lambda: home/travis/build/path/to/package exists but home/travis/build/path/to/package.git does not - stale checkout?\n</code></pre>\n\n<p>How do I get all the dependencies to install at once like an <code>npm install</code> in nodejs?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1518555356, "post_id": 48775370, "comment_id": 84552647, "body": "Everything you need to know to start is in <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>. If you want help with this question, you first need to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518555763, "post_id": 48775370, "comment_id": 84552847, "body": "Without seeing the code in question no one will be able to offer much help."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518558416, "post_id": 48775370, "comment_id": 84554149, "body": "<code>hello_test.go</code> isn&#39;t even in your GOPATH, so it can&#39;t be in the same package as hello.go (which you haven&#39;t shown the location of)"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1518559205, "post_id": 48775370, "comment_id": 84554541, "body": "The reason your IDE is failing to run it is that it&#39;s calling <code>go test</code> specifically and only on your test file itself.  It needs to call it on all of the files in that package.  That&#39;s why your command line version works (though it reports a failure because you have inaccurate assertions.  You call <code>hello1()</code> with -3 and 0, both of which <i>should</i> return <code>no value</code>, but you&#39;re asserting that they will return <code>Hello, world</code>, which is only the case if you pass a positive integer to <code>hello1</code>), but your IDE version doesn&#39;t.  Also, as pointed out, your project is not in your GOPATH."}, {"owner": {"reputation": 41, "user_id": 9351640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THZPN.jpg?s=128&g=1", "display_name": "Matt Hin", "link": "https://stackoverflow.com/users/9351640/matt-hin"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518627362, "post_id": 48775370, "comment_id": 84587063, "body": "@Kaedys, thank you for your answer,  would you mind to tell me how you tell the project is not in GOPATH?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518711538, "post_id": 48775370, "comment_id": 84626946, "body": "Your GOPATH is listed as <code>GOPATH=&#47;Users&#47;&lt;here is my user name&gt;&#47;go</code>.  Your project is sourced from <code>&#47;Users&#47;minghan&#47;awesomeProject&#47;</code>, which is not in the same directory tree.  It&#39;s possible that you&#39;ve not properly set up your GOPATH in your IDE, and therefore it&#39;s using either a default GOPATH or a different one from your environment variable, but in either case, the GOPATH your IDE is using does not contain your project files."}], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": false, "score": 2, "last_activity_date": 1519052303, "creation_date": 1519052303, "answer_id": 48868785, "question_id": 48775370, "link": "https://stackoverflow.com/questions/48775370/golang-testing-same-package-undefined-func/48868785#48868785", "title": "Golang testing, same package, undefined func", "body": "<p>For writing go it is really important to have the correct folder structure, so that you won't have headaches later on. You need your gopath like this:</p>\n\n<pre><code>bin/\n    hello                          # command executable\n    outyet                         # command executable\npkg/\n    linux_amd64/\n        github.com/golang/example/\n           stringutil.a           # package object\nsrc/\n    github.com/golang/example/\n        .git/                      # Git repository metadata\n        hello/\n            hello.go               # command source\n        outyet/\n            main.go                # command source\n            main_test.go           # test source\n        stringutil/\n            reverse.go             # package source\n            reverse_test.go        # test source\n        golang.org/x/image/\n           .git/                      # Git repository metadata\n            bmp/\n                reader.go              # package source\n                writer.go              # package source\n   ... (many more repositories and packages omitted) ...\n</code></pre>\n\n<p>( taken from <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Workspaces</a> ) </p>\n\n<p>The gopath is by default \"$HOME/go\" or the equivalents on other Operating Systems ( home_directory/go )</p>\n\n<p>So you would end up with your project under something like: <code>$HOME/go/src/github.com/matthin/awesomeproject</code> </p>\n\n<p>And put all your files into it.</p>\n\n<p>Then to run the test you could execute <code>go test github.com/matthin/awesomeproject</code>  or you can run the test by specifying each file in that directory, like in your case: </p>\n\n<p><code>go test main.go main_test.go</code></p>\n\n<p>Then the go test runner knows that it needs to evaluate both files and the function will be found. </p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5761434, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LIPKBXYePIY/AAAAAAAAAAI/AAAAAAAAAFI/MKsQEoGdf34/photo.jpg?sz=128", "display_name": "\u866b\u5b50\u6a31\u6843", "link": "https://stackoverflow.com/users/5761434/%e8%99%ab%e5%ad%90%e6%a8%b1%e6%a1%83"}, "is_accepted": false, "score": 1, "last_activity_date": 1583219239, "creation_date": 1583219239, "answer_id": 60501786, "question_id": 48775370, "link": "https://stackoverflow.com/questions/48775370/golang-testing-same-package-undefined-func/60501786#60501786", "title": "Golang testing, same package, undefined func", "body": "<p>try <code>go test *.go -v</code> ,it is ok for me .</p>\n\n<pre><code>czyt@MiniManjaro \ue0b0 ~/go/src/TestProject/casestatement \ue0b0 go test *.go -v                                                                                           \ue0b2 \u2714 \ue0b2 2080 \ue0b2 15:03:17\n=== RUN   TestCaseStatement\n    TestCaseStatement: casestatement_test.go:9: 11\n    TestCaseStatement: casestatement_test.go:11: ===================\n    TestCaseStatement: casestatement_test.go:12:  num 1 2\n    TestCaseStatement: casestatement_test.go:14: ===================\n    TestCaseStatement: casestatement_test.go:15:  num 1 2\n--- PASS: TestCaseStatement (0.00s)\nPASS\nok      command-line-arguments  0.002s\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 9351640, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THZPN.jpg?s=128&g=1", "display_name": "Matt Hin", "link": "https://stackoverflow.com/users/9351640/matt-hin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5233, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1583219239, "creation_date": 1518554870, "last_edit_date": 1518628032, "question_id": 48775370, "link": "https://stackoverflow.com/questions/48775370/golang-testing-same-package-undefined-func", "title": "Golang testing, same package, undefined func", "body": "<p>I am pretty new to go, and trying to write up a test file for go. When I run the test, I have two questions:\n1. I have to run \"go test -cover , then I can see this:</p>\n\n<pre><code>#command-line-arguments\n./client_test.go:59: undefined: Init\nFAIL    command-line-arguments [build failed]\n</code></pre>\n\n<p>My question is why I can't just run: go test (If I do this, I see this:</p>\n\n<pre><code>exit status 1\nFAIL    command-line-arguments  0.008s\n</code></pre>\n\n<ol start=\"2\">\n<li>My second question is there are two files in the package(one package in a big project), a file1, and a test.go file for that file1. Why I can't access the func in file1 in test.go (undefined). I am sure the test file is in correct format and the function is exported. </li>\n</ol>\n\n<p>I have been checking online for solutions for days. Any thoughts would be helpful. \nI am sorry that I can't show the code and I really appreciate your help.</p>\n\n<p>Thank you</p>\n\n<p>Edit2:\nThanks, guys, I am thinking about the env variables, (I am setting them up). I really appreciate your comments. </p>\n\n<p>Edit1: \nThanks for your reply, and I did try a small piece of code to see if the go test works ok:\n(I am sorry that I can't the project I am working on)\nhello.go:</p>\n\n<pre><code>package main\n\nfunc hello1(i int) string {\n    if i &gt; 0 {\n        return \"Hello, world\"\n    }\n    return \"no value\"\n\n}\n</code></pre>\n\n<p>hello_test.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n    \"fmt\"\n)\nfunc TestHello(t *testing.T)  {\n    var s string\n    var s2 string\n    var s3 string\n    s = hello1(3)\n    if s != \"Hello, world\" {\n        t.Error(\"Expected: Hello, world, got\", s)\n    }\n    s2 = hello1(-3)\n    if s2 != \"Hello, world\" {\n        t.Error(\"Expected: Hello, world, got\", s2)\n    }\n    s3 = hello1(0)\n    if s3 != \"Hello, world\" {\n        t.Error(\"Expected: Hello, world, got\", s3)\n    }\n}\n</code></pre>\n\n<p>When I use the IDE to run these files, I see: </p>\n\n<pre><code>GOROOT=/usr/local/Cellar/go/1.9.3/libexec #gosetup\nGOPATH=/Users/&lt;here is my user name&gt;/go #gosetup\n/usr/local/Cellar/go/1.9.3/libexec/bin/go test -c -i -o /private/var/folders/cx/0mvyxrxj5755jc68mqvtywth0000gn/T/___TestHello_in_hello_test_go /Users/minghan/awesomeProject/hello_test.go #gosetup\n# command-line-arguments\n./hello_test.go:13:6: undefined: hello1\n./hello_test.go:17:7: undefined: hello1\n./hello_test.go:21:7: undefined: hello1\n\nCompilation finished with exit code 2 \n</code></pre>\n\n<p>When I run in command line: go test -cover:</p>\n\n<pre><code>--- FAIL: TestHello (0.00s)\n    hello_test.go:19: Expected: Hello, world, got no value\n    hello_test.go:23: Expected: Hello, world, got no value\nFAIL\ncoverage: 100.0% of statements\nexit status 1\nFAIL    _/Users/minghan/awesomeProject  0.007s\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518549882, "post_id": 48773904, "comment_id": 84549827, "body": "AFAIK templates don&#39;t know about their name, so you&#39;ll just have to pass the class value as you would any other template data values."}], "answers": [{"tags": [], "owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "is_accepted": true, "score": 0, "last_activity_date": 1520514191, "creation_date": 1520514191, "answer_id": 49173784, "question_id": 48773904, "link": "https://stackoverflow.com/questions/48773904/inserting-template-name-as-class/49173784#49173784", "title": "Inserting template name as class", "body": "<p>Here's a working solution, taking mkopriva's advice:</p>\n\n<p>When executing a template, pass some custom parameter with dummy data. Here, I just create a \"PageHome\" parameter to pass to the template, and value is a simple \"1\", but it could be any value:</p>\n\n<pre><code>tmplHome.ExecuteTemplate(w, \"base\", map[string]interface{}{\"PageHome\": \"1\", \"Data\": events, \"UserFirstName\": &amp;u.FirstName, \"UserProfilePic\": &amp;u.ProfilePic})\n</code></pre>\n\n<p>Then, inside the template itself, a simple if statement to check if the parameter exists, and do something accordingly:</p>\n\n<pre><code>{{ if .PageHome }}\n    &lt;body class=\"PageHome\"&gt;\n{{ else }}\n    &lt;body&gt;\n{{ end }}\n</code></pre>\n\n<p>All my other template executions don't pass a \"PageHome\" parameter at all, so the if statement never passes as true for them.</p>\n\n<p>There's probably a more advanced solution using a functions via a template function map, and having a consistent \"PageType\":\"something\" parameter in all template executions, but in the end you still have to define a parameter per template execution and still have to build up if statements in your templates anyways.</p>\n"}], "owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 49173784, "answer_count": 1, "score": 0, "last_activity_date": 1520514191, "creation_date": 1518548818, "last_edit_date": 1518600611, "question_id": 48773904, "link": "https://stackoverflow.com/questions/48773904/inserting-template-name-as-class", "title": "Inserting template name as class", "body": "<p>When creating a Go template, you can give it a name, like in this example, \"my_home_template\":</p>\n\n<pre><code>var tmplHome = template.Must(template.New(\"my_home_template\").Funcs(funcMap).ParseFiles(\"templates/base.tmpl\", \"templates/content_home.tmpl\"))\n</code></pre>\n\n<p>How can I get that template name and use it inside the actual template file?</p>\n\n<p>Ultimately I just want to define a convenient css class, like so:</p>\n\n<pre><code>&lt;body class=\"my_home_template\"&gt;\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 6, "creation_date": 1518541447, "post_id": 48771909, "comment_id": 84545188, "body": "Define a struct. If you parse to interface{} you literally say &quot;I don&#39;t care about the type&quot;."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1518541972, "post_id": 48771909, "comment_id": 84545544, "body": "Your terminology of &quot;minimum type&quot; and &quot;maximum type&quot; is confusing. Types aren&#39;t comparable... I really have no idea what that means."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1518542210, "post_id": 48771909, "comment_id": 84545688, "body": "JSON is based on JavaScript, and in JavaScript all numbers are float64, so  unless you specify a type, numbers will be decoded into float64."}, {"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518604558, "post_id": 48771909, "comment_id": 84571397, "body": "I understand what are saying, so let&#39;s start with something simpler. I want to <code>Json.Unmarshel()</code> each value float64 type to int without specifying specific key names. Is that even possible. Check out @maerics answer and my comment on it, he&#39;s getting closer to what I&#39;m trying to do. Obviously I can write a method to do it for me after the <code>Unmarsheling</code>, I&#39;m looking for a way to avoid additional conversion methods. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518604079, "post_id": 48775256, "comment_id": 84571066, "body": "Thanks, but as I mentioned in the assumptions my Json file is huge and dynamic. I can&#39;t specify 100 keys that will change by name every few weeks. I&#39;m trying to figure out how to write something similar to your answer, without specifying a specific key like <code>my_int</code> and <code>my_string</code>. Any idea? - is there a way to specify this Json struct conversion by value types and not by key name?"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 4, "last_activity_date": 1518554383, "creation_date": 1518554383, "answer_id": 48775256, "question_id": 48771909, "link": "https://stackoverflow.com/questions/48771909/unmarshal-json-to-minimum-type/48775256#48775256", "title": "Unmarshal JSON to minimum type", "body": "<p>Since you are unmarshaling into a map of <code>interface{}</code>, the following section of the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">golang <code>json.Unmarshal</code> documentation</a> pertains:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:<br>\n  ...<br>\n  float64, for JSON numbers<br>\n  string, for JSON strings<br>\n  ...</p>\n</blockquote>\n\n<p>As such, to unmarshal your sample data into your desired types you should define a struct type which contains the desired field/type mappings, for example:</p>\n\n<pre><code>type MyType struct {\n    MyInt    int     `json:\"my_int\"`\n    MyString *string `json:\"my_string\"`\n}\n\nfoo := MyType{}\njsonstr := `{\"my_int\": 3, \"my_string\": null}`\n\nerr := json.Unmarshal([]byte(jsonstr), &amp;foo)\nif err != nil {\n    panic(err)\n}\n// foo =&gt; main.MyType{MyInt:3, MyString:(*string)(nil)}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518627710, "post_id": 48789860, "comment_id": 84587286, "body": "This is a good answer and it&#39;s very similar to my own implementation - I&#39;m using struct and switch cases that does this check for me. A great solution would be to show how to do this with a  Json decoder with a single pass, but without declaring the map keys - that&#39;s something I didn&#39;t manage to do. Thanks for the effort, well deserved an upvote. BTW, I added a clarification to my question based on your feedback.."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 1, "last_activity_date": 1518638507, "last_edit_date": 1518638507, "creation_date": 1518619381, "answer_id": 48789860, "question_id": 48771909, "link": "https://stackoverflow.com/questions/48771909/unmarshal-json-to-minimum-type/48789860#48789860", "title": "Unmarshal JSON to minimum type", "body": "<p>Since you cannot describe your data in a struct then your options are to:</p>\n\n<ol>\n<li><p>Use a <a href=\"https://blog.golang.org/json-and-go#TOC_7.\" rel=\"nofollow noreferrer\"><code>json.Decoder</code></a> to convert the values to your desired types as they are parsed.</p></li>\n<li><p>Parse the document into a generic interface and post-process the value types.</p></li>\n</ol>\n\n<p>Option #1 is the most flexible and can likely be implemented to be more performant than the other option since parsing and transformation could be performed in a single pass of the data.</p>\n\n<p>Option #2 might be simpler but will require two passes over the data. Here is an example of what the post-processing step might look like:</p>\n\n<pre><code>func TransformValueTypes(o map[string]interface{}) {\n  for k, v := range o {\n    // Convert nil values to *string type.\n    if v == interface{}(nil) {\n      o[k] = (*string)(nil)\n    }\n    // Convert numbers to int32 if possible\n    if x, isnumber := v.(float64); isnumber {\n      if math.Floor(x) == x {\n        if x &gt;= math.MinInt32 &amp;&amp; x &lt;= math.MaxInt32 {\n          o[k] = int32(x)\n        }\n        // Possibly check for other integer sizes here?\n      }\n      // Possibly check if float32 is possible here?\n    }\n    // Check for maps and slices here...\n  }\n}\n</code></pre>\n\n<p>So if you call <code>TransformValueTypes(data)</code> then your types will look like:</p>\n\n<pre><code>// my_int     -&gt; 3     (int32)\n// my_string  -&gt; &lt;nil&gt; (*string)\n// my_string2 -&gt; \"foo\" (string)\n// my_float   -&gt; 1.23  (float64)\n</code></pre>\n\n<p>Of course, your transform function could also apply type transformation logic based on the key name.</p>\n\n<p>Importantly, note that if your document might have additional structure not mentioned in your question (such as nested objects or arrays) then your transform function will need to account for them by more value type checking, recursive calls, and iteration.</p>\n"}], "owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 1, "accepted_answer_id": 48789860, "answer_count": 2, "score": -8, "last_activity_date": 1518638507, "creation_date": 1518541137, "last_edit_date": 1518631965, "question_id": 48771909, "link": "https://stackoverflow.com/questions/48771909/unmarshal-json-to-minimum-type", "title": "Unmarshal JSON to minimum type", "body": "<p>I have a Json string that I want to unmarshal.\nThis is working:</p>\n\n<pre><code>jsonString := []byte(`{\"my_int\": 3, \"my_string\": null}`)\nvar data map[string]interface{}\nerr := json.Unmarshal(jsonString, &amp;data)\nif err != nil {\n    fmt.Println(err)\n}\n//avroJson := make(map[string]interface{})\nfor k, v := range data {\n    fmt.Printf(\"%v, %T\\n\", k, v)\n}\n</code></pre>\n\n<p>My issue is: the value of <code>my_int</code> which is <strong>3 is returned as float64</strong>.</p>\n\n<p>My question is: how to parse a json string with the \"minimum type\" so that <code>3</code> will return <code>int32</code> and not the maximum type <code>3</code> => <code>float64</code>?</p>\n\n<p>Assumption: my Json is huge and only have primitive types and I want a minimum value that is really float64 to continue to show <code>float64</code>.</p>\n\n<p>Clarification:\nA \"minimum type\" means that if <code>3</code> can be considered both <code>int32</code> and <code>float64</code> the \"minimum type\" will be <code>int32</code>, which is the exact type you'll get when running this:\n<code>reflect.TypeOf(3).string()</code></p>\n"}, {"tags": ["go", "slack-api", "goroutine", "data-race"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1518534341, "post_id": 48769644, "comment_id": 84540505, "body": "Try using <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdoutPipe\" rel=\"nofollow noreferrer\">cmd.StdoutPipe</a> (and same for stderr) rather than reading from a buffer at the same time it&#39;s being written to."}, {"owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "edited": false, "score": 0, "creation_date": 1518535239, "post_id": 48769644, "comment_id": 84541116, "body": "I don&#39;t know if we have the full context necessary to solve the problem, but I would say <code>select</code> is your friend."}, {"owner": {"reputation": 787, "user_id": 6726990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/25b10afe9155203945628b1dfbfb2b70?s=128&d=identicon&r=PG&f=1", "display_name": "Blooze", "link": "https://stackoverflow.com/users/6726990/blooze"}, "reply_to_user": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "edited": false, "score": 0, "creation_date": 1518540692, "post_id": 48769644, "comment_id": 84544654, "body": "@threeve - I think everything should be available to see the issue, the bot is decoupled from the commands so this package only pulls in a few things to communicate back."}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 4336585, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PIrUxm4BD-4/AAAAAAAAAAI/AAAAAAAAALc/affxVlztquE/photo.jpg?sz=128", "display_name": "rabhis", "link": "https://stackoverflow.com/users/4336585/rabhis"}, "is_accepted": false, "score": 0, "last_activity_date": 1518542631, "creation_date": 1518542631, "answer_id": 48772348, "question_id": 48769644, "link": "https://stackoverflow.com/questions/48769644/handling-multiple-data-races-with-slack-bot/48772348#48772348", "title": "Handling multiple data races with slack bot", "body": "<p>The first goroutine, starting with <code>cmd.Wait()</code>, is writing to the buffer <code>b</code> while the other goroutine, starting with <code>line, _ := b.ReadString('\\n')</code> is reading from it. That's why datarace happens. Modify the code in such a way that the result of execution is read only after completion of execution.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 567512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b4319173ff1a5fb56ea2cfbd6781414?s=128&d=identicon&r=PG", "display_name": "reedobrien", "link": "https://stackoverflow.com/users/567512/reedobrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1518583327, "creation_date": 1518583327, "answer_id": 48779787, "question_id": 48769644, "link": "https://stackoverflow.com/questions/48769644/handling-multiple-data-races-with-slack-bot/48779787#48779787", "title": "Handling multiple data races with slack bot", "body": "<p>rabhis is correct, you could embed the buffer with a mutex something like:</p>\n\n<p><a href=\"https://gist.github.com/arkan/5924e155dbb4254b64614069ba0afd81\" rel=\"nofollow noreferrer\">https://gist.github.com/arkan/5924e155dbb4254b64614069ba0afd81</a></p>\n\n<pre><code>package safebuffer\n\nimport (\n    \"bytes\"\n    \"sync\"\n)\n\n// Buffer is a goroutine safe bytes.Buffer\ntype Buffer struct {\n    buffer bytes.Buffer\n    mutex  sync.Mutex\n}\n\n// Write appends the contents of p to the buffer, growing the buffer as needed. It returns\n// the number of bytes written.\nfunc (s *Buffer) Write(p []byte) (n int, err error) {\n    s.mutex.Lock()\n    defer s.mutex.Unlock()\n    return s.buffer.Write(p)\n}\n\n// String returns the contents of the unread portion of the buffer\n// as a string.  If the Buffer is a nil pointer, it returns \"&lt;nil&gt;\".\nfunc (s *Buffer) String() string {\n    s.mutex.Lock()\n    defer s.mutex.Unlock()\n    return s.buffer.String()\n}\n</code></pre>\n"}], "owner": {"reputation": 787, "user_id": 6726990, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/25b10afe9155203945628b1dfbfb2b70?s=128&d=identicon&r=PG&f=1", "display_name": "Blooze", "link": "https://stackoverflow.com/users/6726990/blooze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1518583327, "creation_date": 1518533875, "last_edit_date": 1518540938, "question_id": 48769644, "link": "https://stackoverflow.com/questions/48769644/handling-multiple-data-races-with-slack-bot", "title": "Handling multiple data races with slack bot", "body": "<p>I'm working on a slack bot as my first golang project and while the functionality of this specific bot command works great, it can randomly panic and throw an error. </p>\n\n<p>I was able to determine that I have data races going on, specifically with my two go routines. However I am having difficulty determining how to patch them, or whether doing a mutex lock is a proper way to handle shared variables. </p>\n\n<p>I'm trying to figure out if the issue is my <strong><em>result</em></strong> variable, which is split into channels that are each handled by the go routine, or if it is my buffer variable used by the os.exec package to run a command that both stdout and stderr modify.</p>\n\n<p>Here is the code, and data race examples below.</p>\n\n<pre><code>package reboot\n\nimport (\n\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os/exec\"\n    \"regexp\"\n)\n\n// to handle json keys\ntype rebootObject struct {\n    Name    string\n    Command string\n}\n\nvar (\n    fileNotFound = \"config file not found\"\n    cmdNotFound  = \"Error finding command argument\"\n)\n\n// *bot.Cmd is the first arg to be passed to the bot\n// bot.CmdResultV3 wants message from go routine and done = true\nfunc Reboot(command *bot.Cmd) (result bot.CmdResultV3, err error) {\n    result = bot.CmdResultV3{Message: make(chan string), Done: make(chan bool, 1)}\n\n    // load json config file with names/commands\n    filePath := \"./plugins/reboot/config.json\"\n    file, err1 := ioutil.ReadFile(filePath)\n    if err1 != nil {\n        bot.Reply(command.Channel, fileNotFound, command.User)\n    }\n\n    var scriptParse []rebootObject\n    //userinput := \"box4535345346\" // faking user input\n    userinput := command.Args[0] // real one\n    err2 := json.Unmarshal(file, &amp;scriptParse)\n    if err2 != nil {\n        fmt.Println(\"error:\", err2)\n        bot.Reply(command.Channel, fileNotFound, command.User)\n    }\n    //strip numbers off input to match json key\n    reg, err := regexp.Compile(\"[^a-zA-Z]+\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    // loop through json file to find the match of user input to json name key\n    cmdFound := false\n    for k := range scriptParse {\n        newinput := reg.ReplaceAllString(userinput, \"\")\n        // keep running for loop until names do match\n        if scriptParse[k].Name != newinput {\n            continue\n        }\n        cmdFound = true\n\n        cmd := exec.Command(\"/bin/bash\", \"-c\", scriptParse[k].Command)\n        var b bytes.Buffer\n        cmd.Stdout = &amp;b\n        cmd.Stderr = &amp;b\n        err = cmd.Start()\n        if err != nil {\n            return\n        }\n        done := false\n        go func() {\n            cmd.Wait()\n            done = true\n            result.Done &lt;- true\n        }()\n        go func() {\n            for {\n                line, _ := b.ReadString('\\n')\n                if line != \"\" {\n                    result.Message &lt;- line\n                }\n                if done {\n                    close(result.Message)\n                    break\n                }\n\n            }\n        }()\n    }\n    if cmdFound == false {\n        result.Done &lt;- true\n        bot.Reply(command.Channel, cmdNotFound, command.User)\n    }\n    return result, nil\n}\n</code></pre>\n\n<p>Data races:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c420582558 by goroutine 37:\n  bytes.(*Buffer).readSlice()\n      /usr/local/go/src/bytes/buffer.go:421 +0x48\n  bytes.(*Buffer).ReadString()\n      /usr/local/go/src/bytes/buffer.go:440 +0x45\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:79 +0x41\n\nPrevious write at 0x00c420582558 by goroutine 35:\n  bytes.(*Buffer).ReadFrom()\n      /usr/local/go/src/bytes/buffer.go:92 +0x608\n  io.copyBuffer()\n      /usr/local/go/src/io/io.go:386 +0x348\n  io.Copy()\n      /usr/local/go/src/io/io.go:362 +0x7e\n  os/exec.(*Cmd).writerDescriptor.func1()\n      /usr/local/go/src/os/exec/exec.go:264 +0x68\n  os/exec.(*Cmd).Start.func1()\n      /usr/local/go/src/os/exec/exec.go:380 +0x34\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 35 (running) created at:\n  os/exec.(*Cmd).Start()\n      /usr/local/go/src/os/exec/exec.go:379 +0xa6b\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:67 +0x7c8\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c420582540 by goroutine 37:\n  bytes.(*Buffer).readSlice()\n      /usr/local/go/src/bytes/buffer.go:421 +0x62\n  bytes.(*Buffer).ReadString()\n      /usr/local/go/src/bytes/buffer.go:440 +0x45\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:79 +0x41\n\nPrevious write at 0x00c420582540 by goroutine 35:\n  bytes.(*Buffer).ReadFrom()\n      /usr/local/go/src/bytes/buffer.go:91 +0x5d0\n  io.copyBuffer()\n      /usr/local/go/src/io/io.go:386 +0x348\n  io.Copy()\n      /usr/local/go/src/io/io.go:362 +0x7e\n  os/exec.(*Cmd).writerDescriptor.func1()\n      /usr/local/go/src/os/exec/exec.go:264 +0x68\n  os/exec.(*Cmd).Start.func1()\n      /usr/local/go/src/os/exec/exec.go:380 +0x34\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 35 (running) created at:\n  os/exec.(*Cmd).Start()\n      /usr/local/go/src/os/exec/exec.go:379 +0xa6b\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:67 +0x7c8\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n==================\nWARNING: DATA RACE\nWrite at 0x00c420582560 by goroutine 37:\n  bytes.(*Buffer).readSlice()\n      /usr/local/go/src/bytes/buffer.go:429 +0x186\n  bytes.(*Buffer).ReadString()\n      /usr/local/go/src/bytes/buffer.go:440 +0x45\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:79 +0x41\n\nPrevious write at 0x00c420582560 by goroutine 35:\n  bytes.(*Buffer).ReadFrom()\n      /usr/local/go/src/bytes/buffer.go:191 +0x5f\n  io.copyBuffer()\n      /usr/local/go/src/io/io.go:386 +0x348\n  io.Copy()\n      /usr/local/go/src/io/io.go:362 +0x7e\n  os/exec.(*Cmd).writerDescriptor.func1()\n      /usr/local/go/src/os/exec/exec.go:264 +0x68\n  os/exec.(*Cmd).Start.func1()\n      /usr/local/go/src/os/exec/exec.go:380 +0x34\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 35 (running) created at:\n  os/exec.(*Cmd).Start()\n      /usr/local/go/src/os/exec/exec.go:379 +0xa6b\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:67 +0x7c8\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c42014cc00 by goroutine 37:\n  runtime.slicebytetostring()\n      /usr/local/go/src/runtime/string.go:72 +0x0\n  bytes.(*Buffer).ReadString()\n      /usr/local/go/src/bytes/buffer.go:441 +0x84\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:79 +0x41\n\nPrevious write at 0x00c42014cc00 by goroutine 35:\n  internal/race.WriteRange()\n      /usr/local/go/src/internal/race/race.go:49 +0x42\n  syscall.Read()\n      /usr/local/go/src/syscall/syscall_unix.go:165 +0x9a\n  internal/poll.(*FD).Read()\n      /usr/local/go/src/internal/poll/fd_unix.go:122 +0x1a0\n  os.(*File).read()\n      /usr/local/go/src/os/file_unix.go:216 +0x70\n  os.(*File).Read()\n      /usr/local/go/src/os/file.go:103 +0x8e\n  bytes.(*Buffer).ReadFrom()\n      /usr/local/go/src/bytes/buffer.go:209 +0x1dd\n  io.copyBuffer()\n      /usr/local/go/src/io/io.go:386 +0x348\n  io.Copy()\n      /usr/local/go/src/io/io.go:362 +0x7e\n  os/exec.(*Cmd).writerDescriptor.func1()\n      /usr/local/go/src/os/exec/exec.go:264 +0x68\n  os/exec.(*Cmd).Start.func1()\n      /usr/local/go/src/os/exec/exec.go:380 +0x34\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 35 (running) created at:\n  os/exec.(*Cmd).Start()\n      /usr/local/go/src/os/exec/exec.go:379 +0xa6b\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:67 +0x7c8\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c4202d2600 by goroutine 37:\n  runtime.slicebytetostring()\n      /usr/local/go/src/runtime/string.go:72 +0x0\n  bytes.(*Buffer).ReadString()\n      /usr/local/go/src/bytes/buffer.go:441 +0x84\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:79 +0x41\n\nPrevious write at 0x00c4202d2600 by goroutine 35:\n  runtime.slicecopy()\n      /usr/local/go/src/runtime/slice.go:160 +0x0\n  bytes.(*Buffer).ReadFrom()\n      /usr/local/go/src/bytes/buffer.go:205 +0x4b2\n  io.copyBuffer()\n      /usr/local/go/src/io/io.go:386 +0x348\n  io.Copy()\n      /usr/local/go/src/io/io.go:362 +0x7e\n  os/exec.(*Cmd).writerDescriptor.func1()\n      /usr/local/go/src/os/exec/exec.go:264 +0x68\n  os/exec.(*Cmd).Start.func1()\n      /usr/local/go/src/os/exec/exec.go:380 +0x34\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 35 (running) created at:\n  os/exec.(*Cmd).Start()\n      /usr/local/go/src/os/exec/exec.go:379 +0xa6b\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:67 +0x7c8\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n==================\nWARNING: DATA RACE\nWrite at 0x00c4202008c8 by goroutine 36:\n  github.com/owner/gobot/plugins/reboot.Reboot.func1()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:74 +0x4d\n\nPrevious read at 0x00c4202008c8 by goroutine 37:\n  github.com/owner/gobot/plugins/reboot.Reboot.func2()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:83 +0x61\n\nGoroutine 36 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:72 +0x846\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n\nGoroutine 37 (running) created at:\n  github.com/owner/gobot/plugins/reboot.Reboot()\n      /Users/macowner/go/src/github.com/owner/gobot/plugins/reboot/reboot.go:77 +0x885\n  github.com/owner/gobot/bot.(*Bot).handleCmd()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/cmd.go:240 +0x13b\n  github.com/owner/gobot/bot.(*Bot).MessageReceived()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/bot.go:101 +0x5a8\n  github.com/owner/gobot/bot.Run()\n      /Users/macowner/go/src/github.com/owner/gobot/bot/reply.go:142 +0xdb3\n  main.main()\n      /Users/macowner/go/src/github.com/owner/gobot/main.go:46 +0x9b0\n==================\n</code></pre>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1518533069, "post_id": 48769364, "comment_id": 84539569, "body": "Do <code>A</code> and <code>B</code> share an interface? How is this different than sorting values in general?"}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518533262, "post_id": 48769364, "comment_id": 84539699, "body": "@JimB Maybe he is asking something generic to sort different structs that have a common field"}, {"owner": {"reputation": 453, "user_id": 207782, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9f945d1ee3840f61ce59634351622af7?s=128&d=identicon&r=PG", "display_name": "guillaume06", "link": "https://stackoverflow.com/users/207782/guillaume06"}, "reply_to_user": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1518533478, "post_id": 48769364, "comment_id": 84539838, "body": "@NidhinDavid Yes that the point"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 3, "creation_date": 1518533479, "post_id": 48769364, "comment_id": 84539840, "body": "@guillaume06 how are A and B stored in your slice? what does the slice look like?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518533570, "post_id": 48769364, "comment_id": 84539906, "body": "@guillaume06: do you want &quot;generic&quot;, meaning you want to use reflection to find <code>CreatedAt</code> on any type? What prevents you from you just asserting type <code>A</code> or <code>B</code>?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1518533746, "post_id": 48769364, "comment_id": 84540025, "body": "the &quot;best&quot; solution is arguable. What have you tried?"}, {"owner": {"reputation": 453, "user_id": 207782, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9f945d1ee3840f61ce59634351622af7?s=128&d=identicon&r=PG", "display_name": "guillaume06", "link": "https://stackoverflow.com/users/207782/guillaume06"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518533749, "post_id": 48769364, "comment_id": 84540029, "body": "@jimB Yes... just curious to know what could be the most elegant solution"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518533825, "post_id": 48769364, "comment_id": 84540084, "body": "@guillaume06: the usual solution is to just type switch or assert the the types you have. Using reflection is never &quot;elegant&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1518534023, "post_id": 48769364, "comment_id": 84540239, "body": "Probably the smoothest would be to define an interface with a method that returns the <code>CreatedAt</code> date, and make your slice a slice of that interface so you can sort on the method return value."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1518559668, "post_id": 48769800, "comment_id": 84554695, "body": "As an alternative, you could put the CreatedAt field in another structure and embed that in each of your types.  That would allow you to define GetCreated once and have the implementation (and field definition) shared across your structures, instead of duplicating it on each type."}], "tags": [], "owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "is_accepted": true, "score": 1, "last_activity_date": 1518534290, "creation_date": 1518534290, "answer_id": 48769800, "question_id": 48769364, "link": "https://stackoverflow.com/questions/48769364/best-solution-to-sort-different-structs-that-have-a-common-field/48769800#48769800", "title": "Best solution to sort different structs that have a common field", "body": "<p>The only way that you can have a slice containing both of these types anyway is that the slice contains some interface that is implemented by both types (including <code>interface{}</code>).</p>\n\n<p>You will probably want to use the <code>sort</code> package and implement <code>sort.Interface</code> on your slice.  The solution gets a little verbose, but makes good sense:</p>\n\n<pre><code>type Creation interface {\n    GetCreated() time.Time\n}\n\ntype A struct {\n    Name      string\n    CreatedAt time.Time\n}\n\nfunc (a *A) GetCreated() time.Time {\n    return a.CreatedAt\n}\n\nfunc (a *A) String() string {\n    return a.Name\n}\n\ntype B struct {\n    Title     string\n    CreatedAt time.Time\n}\n\nfunc (b *B) GetCreated() time.Time {\n    return b.CreatedAt\n}\n\nfunc (b *B) String() string {\n    return b.Title\n}\n\ntype AorB []Creation\n\nfunc (x AorB) Len() int {\n    return len(x)\n}\n\nfunc (x AorB) Less(i, j int) bool {\n    // to change the sort order, use After instead of Before\n    return x[i].GetCreated().Before(x[j].GetCreated())\n}\n\nfunc (x AorB) Swap(i, j int) {\n    x[i], x[j] = x[j], x[i]\n}\n\nfunc main() {\n    a := &amp;A{\"A\", time.Now()}\n    time.Sleep(1 * time.Second)\n    b := &amp;B{\"B\", time.Now()}\n    aOrB := AorB{b, a}\n\n    fmt.Println(aOrB)\n    // [B A]\n\n    sort.Stable(aOrB)\n\n    fmt.Println(aOrB)\n    // [A B]\n}\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 207782, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/9f945d1ee3840f61ce59634351622af7?s=128&d=identicon&r=PG", "display_name": "guillaume06", "link": "https://stackoverflow.com/users/207782/guillaume06"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 48769800, "answer_count": 1, "score": -4, "last_activity_date": 1553619402, "creation_date": 1518532957, "last_edit_date": 1553619402, "question_id": 48769364, "link": "https://stackoverflow.com/questions/48769364/best-solution-to-sort-different-structs-that-have-a-common-field", "title": "Best solution to sort different structs that have a common field", "body": "<p>I have struct types like</p>\n\n<pre><code>type A struct {\n    Name string\n    CreatedAt time.Time\n    ...\n}\n\ntype B struct {\n    Title string\n    CreatedAt time.Time\n    ...\n}\n\ntype C struct {\n    Message string\n    CreatedAt time.Time\n    ...\n} \n</code></pre>\n\n<p>And a generic slice</p>\n\n<pre><code>var result []interface{}\n</code></pre>\n\n<p>containing A, B and C elements (and more to come in the future)</p>\n\n<p>I want to sort that slice by 'CreatedAt'.</p>\n\n<p>What is the best solution ? I want to avoid checking types or casting... </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 16, "last_activity_date": 1518532174, "creation_date": 1518532174, "answer_id": 48769120, "question_id": 48769062, "link": "https://stackoverflow.com/questions/48769062/whats-difference-between-select-and-for-in-golang/48769120#48769120", "title": "What&#39;s difference between select{} and for{} in golang?", "body": "<p><code>for{}</code> uses 100% CPU because it continuously executes the loop iteration.</p>\n\n<p><code>select{}</code> uses nearly 0% CPU because it causes the goroutine to block, which means the scheduler puts it to sleep, and it will never be woken.</p>\n"}], "owner": {"reputation": 2745, "user_id": 7159205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6582280ec3cc9a9d0edfa0291748a823?s=128&d=identicon&r=PG&f=1", "display_name": "g10guang", "link": "https://stackoverflow.com/users/7159205/g10guang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2271, "favorite_count": 3, "accepted_answer_id": 48769120, "answer_count": 1, "score": 6, "last_activity_date": 1518532174, "creation_date": 1518532008, "question_id": 48769062, "link": "https://stackoverflow.com/questions/48769062/whats-difference-between-select-and-for-in-golang", "title": "What&#39;s difference between select{} and for{} in golang?", "body": "<p>I find a similar question: <a href=\"https://stackoverflow.com/questions/18661602/what-does-an-empty-select-do\">What does an empty select do?</a></p>\n\n<p><code>for{}</code> will cover 100% cpu usage.</p>\n\n<p><code>select{}</code> ask the channel case can read or write or not. But no case in the select. <code>select{}</code> will use 0% cpu usage? Or just like the <code>for{}</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1518530374, "post_id": 48768429, "comment_id": 84537620, "body": "The vendor folder is not managed by the <code>go</code> tool. You do it manually (not recommended), or by using external tools like <code>dep</code>, <code>govendor</code>, <code>glide</code>, etc."}], "answers": [{"comments": [{"owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1518545831, "post_id": 48769723, "comment_id": 84547768, "body": "your install cmd is to install the dep sources not the exec. wouldn&#39;t it be better to have it install the executable ?"}, {"owner": {"reputation": 317, "user_id": 9039469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iidm4.jpg?s=128&g=1", "display_name": "Zac Romero", "link": "https://stackoverflow.com/users/9039469/zac-romero"}, "reply_to_user": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1518608891, "post_id": 48769723, "comment_id": 84574267, "body": "Actually the convenient thing about the go get tool is that it will get the source and the executable. (It will actually but the executable in your $GOPATH/bin folder so you can run it from there). If you are using osX you can also install dep using brew if you want with: brew install dep."}], "tags": [], "owner": {"reputation": 317, "user_id": 9039469, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iidm4.jpg?s=128&g=1", "display_name": "Zac Romero", "link": "https://stackoverflow.com/users/9039469/zac-romero"}, "is_accepted": true, "score": 3, "last_activity_date": 1550238251, "last_edit_date": 1550238251, "creation_date": 1518534078, "answer_id": 48769723, "question_id": 48768429, "link": "https://stackoverflow.com/questions/48768429/how-to-import-a-third-party-library-to-a-specific-folder/48769723#48769723", "title": "How to import a third party library to a specific folder", "body": "<h2>Update (2019)</h2>\n\n<p>The Go environment is slowly starting to move away from tools like dep and towards the native Go tooling around modules. While explaining models is outside the scope of this answer, you can look into modules from the following places:</p>\n\n<p><a href=\"https://blog.golang.org/modules2019\" rel=\"nofollow noreferrer\">https://blog.golang.org/modules2019</a>\n<a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a></p>\n\n<h2>tldr</h2>\n\n<p>Install dep: <code>go get -u github.com/golang/dep/cmd/dep</code></p>\n\n<p>In your project run: <code>dep init</code></p>\n\n<h1>answer</h1>\n\n<p>The easiest way to solve this problem in my opinion is using the dep dependency management tool. This tool is very widely in use and is very easy to use. Here is a typical workflow:</p>\n\n<p>First you should install the <code>dep</code> program.</p>\n\n<pre><code>go get -u github.com/golang/dep/cmd/dep\n</code></pre>\n\n<p>Now you have access to the dep command. Full documentation can be found here: <a href=\"https://golang.github.io/dep/\" rel=\"nofollow noreferrer\">https://golang.github.io/dep/</a></p>\n\n<p>This is how you get 3rd party libraries into your vendor directory. In the example below we will use the url router github.com/gorilla/mux.</p>\n\n<p>First, in you code import the libraries like normal.</p>\n\n<pre><code>package main\n\nimport \"github.com/gorilla/mux\"\n\nfunc main {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/products\", ProductsHandler)\n    r.HandleFunc(\"/articles\", ArticlesHandler)\n    http.Handle(\"/\", r)\n}\n</code></pre>\n\n<p>Now all we have to do to get it sed up is run the <code>dep init</code> command. This will look for all of your imports and create a vendor directory for you with all of your needed dependencies. <strong>Note that dep automatically analyzes your imports.</strong></p>\n\n<h2>Dep in depth</h2>\n\n<p>Once you have initialized dep you can start work on your project as normal. When you add a new library you can run the <code>dep ensure</code> command to get the newly added 3rd party libraries in the vendor directory.</p>\n\n<p>In addition, dep gives you the capability to lock down on particular versions of 3rd party libraries. <code>dep init</code> initializes your project with two files: Gopkg.toml and Gopkg.lock. The Gopkg.toml file contains assertions about which dependencies will be at what version. For example, if you wantted the gorilla mux library to stay at version v1.4.0, you could add the following line to your Gopkg.toml:</p>\n\n<pre><code>[[constraint]]\nname = \"github.com/gorilla/mux\"\nversion = \"=v1.4.0\"\n</code></pre>\n\n<p>Dep also has functionality to upgrade dependencies, remove unused dependencies from vendor, and much more. Look at the documentation for more details. <a href=\"https://golang.github.io/dep/\" rel=\"nofollow noreferrer\">https://golang.github.io/dep/</a></p>\n"}], "owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1562, "favorite_count": 0, "accepted_answer_id": 48769723, "answer_count": 1, "score": 1, "last_activity_date": 1550238251, "creation_date": 1518529972, "last_edit_date": 1518530515, "question_id": 48768429, "link": "https://stackoverflow.com/questions/48768429/how-to-import-a-third-party-library-to-a-specific-folder", "title": "How to import a third party library to a specific folder", "body": "<p>Being very new to Go, I'm trying to import a third party library into a vendor folder. I follow the instructions given by the <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">Go docs</a>, but didn't find anything about third party libraries. </p>\n"}, {"tags": ["amazon-web-services", "go", "kubernetes"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518530890, "post_id": 48767701, "comment_id": 84537978, "body": "You have to supply the code for us to possibly diagnose issues with the code. You are likely constrained by some resource[s] (CPU, IO, FDs etc.), but there&#39;s no data here to begin to guess."}, {"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1518531320, "post_id": 48767701, "comment_id": 84538280, "body": "Can you also clarify what you mean by &#39;in my local env, where I run Docker compose&#39;? Do you mean your dev and prod environment are totally different?"}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518532575, "post_id": 48767701, "comment_id": 84539206, "body": "Thanks for your comments. @JimB, what code are you looking for? The Goland is simply the <code>net&#47;http</code> package writing a header. Kubernetes-wise, what configuration are you looking for?  @MichaelHausenblas My system consists of microservices written in Golang, built into Docker containers. Locally, I orchestrate them with Docker Compose, in production, I use Kubernetes to run them. Did that answer your question?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518532868, "post_id": 48767701, "comment_id": 84539424, "body": "@HelgeTalvikS&#246;derstr&#246;m: you have a StackOverflow question tagged as Go, so I assume this has to do with Go code. If the responses aren&#39;t coming from a Go program you are building, there&#39;s not much here we can do. If the responses are coming from a Go program, it&#39;s not likely the simple http endpoint that&#39;s at fault, but the system interaction as a whole. You need to start debugging by breaking the system down into discrete parts, to figure out what might be causing the responses to hang."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 1, "creation_date": 1518534971, "post_id": 48767701, "comment_id": 84540957, "body": "It might be helpful to describe the concurrency model the app uses- are HTTP requests dispatched to go routines or are they handled inline? Are liveness and readiness handled similarly to other requests, or is there a separate listener and service loop for them? And when you look at CPU and RAM utilization of your pods under load- are they hitting limits or is there capacity?"}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1518536049, "post_id": 48767701, "comment_id": 84541635, "body": "Thanks Jonah, good input! It seems I am hitting limits, so I have increased them. Most likely, this was the issue. Regarding the go code, the liveness and readiness probes are handled inline through a regular <code>log.Fatal(http.ListenAndServe(port, nil))</code> with a <code>GET</code>-handler function simply running <code>w.WriteHeader(http.StatusNoContent)</code>."}, {"owner": {"reputation": 6574, "user_id": 398797, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c487d66f87237612bd069f25f49af8a?s=128&d=identicon&r=PG", "display_name": "evgenyl", "link": "https://stackoverflow.com/users/398797/evgenyl"}, "edited": false, "score": 0, "creation_date": 1518626274, "post_id": 48767701, "comment_id": 84586274, "body": "If adding resources will not help, I&#39;ll start from investigation of &quot;does probes are able to reach server code?&quot;"}], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518532866, "creation_date": 1518527706, "last_edit_date": 1518532866, "question_id": 48767701, "link": "https://stackoverflow.com/questions/48767701/kubernetes-liveness-probes-stop-responding", "title": "Kubernetes liveness probes stop responding", "body": "<p>I'm using <code>kube-aws</code> to set up a production Kubernetes cluster on AWS. Now I'm running into an issue I am unable to recreate in my dev environment.</p>\n\n<p>When a pod is running heavy computation, which in my case happens in bursts, the liveness and readiness probes stop responding. In my local environment, where I run docker compose, they work as expected.</p>\n\n<p>The probes use simple HTTP 204 No Content output using native Go functionality.</p>\n\n<p>Has anyone seen this before?</p>\n\n<p><strong>EDIT:</strong><br>\nI'd be happy to provide more information, but I am uncertain what I should provide as there is a tremendous amount of configuration and code involved. Primarily, I'm looking for help to troubleshoot and where to look to try to locate the actual issue.</p>\n"}, {"tags": ["pointers", "go", "literals"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 4, "last_activity_date": 1518528327, "creation_date": 1518528327, "answer_id": 48767885, "question_id": 48767698, "link": "https://stackoverflow.com/questions/48767698/golang-shortcut-syntax-for-slice-literal-of-pointers-to-structs/48767885#48767885", "title": "golang shortcut syntax for slice literal of pointers to structs", "body": "<p>You can skip the type in <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literals</a>.</p>\n\n<blockquote>\n  <p>Within a composite literal of array, slice, or map type T, elements or map keys that are themselves composite literals may elide the respective literal type if it is identical to the element or key type of T. Similarly, elements or keys that are addresses of composite literals may elide the &amp;T when the element or key type is *T. </p>\n</blockquote>\n"}], "owner": {"reputation": 55, "user_id": 7424605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c7ddece741a8ad2161fe4e95bd74ce?s=128&d=identicon&r=PG", "display_name": "ysz", "link": "https://stackoverflow.com/users/7424605/ysz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 1, "accepted_answer_id": 48767885, "answer_count": 1, "score": 4, "last_activity_date": 1580715824, "creation_date": 1518527698, "last_edit_date": 1580715824, "question_id": 48767698, "link": "https://stackoverflow.com/questions/48767698/golang-shortcut-syntax-for-slice-literal-of-pointers-to-structs", "title": "golang shortcut syntax for slice literal of pointers to structs", "body": "<p>Given</p>\n\n<pre><code>type foo struct {\n    id int\n}\n</code></pre>\n\n<p>the two look equivalent</p>\n\n<pre><code>var foos = []*foo{\n    {1},\n    {2},\n    {3}}\n\nvar foos = []*foo{\n    &amp;foo{1},\n    &amp;foo{2},\n    &amp;foo{3}}\n</code></pre>\n\n<p>Why is that? Can't find mentioning of it in TGPL though.  </p>\n\n<p><a href=\"https://play.golang.org/p/JXxZaybbWnV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JXxZaybbWnV</a></p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1518524776, "post_id": 48766260, "comment_id": 84533797, "body": "Did you try vendoring the dependency?"}, {"owner": {"reputation": 37028, "user_id": 59198, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6448b40e7037dd0fda767f2370c31809?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/59198/chris"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518561127, "post_id": 48766260, "comment_id": 84555239, "body": "@mkopriva No, but thanks for the tip! If that works, please put as an answer so i can vote and mark as success, so you get the &quot;points&quot; :)"}, {"owner": {"reputation": 37028, "user_id": 59198, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6448b40e7037dd0fda767f2370c31809?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/59198/chris"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518596506, "post_id": 48766260, "comment_id": 84566329, "body": "Vendoring doesn&#39;t seem to work well with the dev app server. However, this workaround seems to do the trick for dev mode:      <code>cd ~&#47;google-cloud-sdk&#47;platform&#47;google_appengine&#47;goroot-1.8&#47;src</code>     <code>ln -s ~&#47;go&#47;src&#47;github.com github.com</code>  That way any libraries from github.com that are installed with a vanilla <code>go get foolibrary</code> seem to work."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518596830, "post_id": 48766260, "comment_id": 84566485, "body": "So you&#39;re saying that adding a <code>&#47;vendor</code> folder to your project&#39;s root and putting the dependencies there doesn&#39;t work? Genuinely curious as I am not a GAE user myself... The error message you have in your question, is it the full message? Did the message change after adding the vendor folder?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518597127, "post_id": 48766260, "comment_id": 84566630, "body": "I&#39;m asking because the go tool will ouput a slightly different error if the vendor folder is present as opposed to when it&#39;s not. It adds a line that indicates that it was looking for the dependency in the vendor folder first and then in the GOPATH... see this example: <a href=\"https://imgur.com/a/K4ZVW\" rel=\"nofollow noreferrer\">imgur.com/a/K4ZVW</a>"}, {"owner": {"reputation": 37028, "user_id": 59198, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6448b40e7037dd0fda767f2370c31809?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/59198/chris"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518642356, "post_id": 48766260, "comment_id": 84594812, "body": "@mkopriva Yes, adding the dependencies into a /vendor folder does not work unfortunately. GAE is quite odd."}], "answers": [{"tags": [], "owner": {"reputation": 178, "user_id": 9251155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebbe7dc961f55320df67468f038c5961?s=128&d=identicon&r=PG&f=1", "display_name": "Miller G.", "link": "https://stackoverflow.com/users/9251155/miller-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1519380283, "last_edit_date": 1519380283, "creation_date": 1519211932, "answer_id": 48904534, "question_id": 48766260, "link": "https://stackoverflow.com/questions/48766260/how-do-i-use-third-party-go-libraries-with-google-app-engines-development-serve/48904534#48904534", "title": "How do i use third party Go libraries with google app engine&#39;s development server?", "body": "<p>Got the same error while testing the import \"github.com/stripe/stripe-go\" and fixed it by following the steps <a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-go-libraries\" rel=\"nofollow noreferrer\">here</a> \"EDIT\": </p>\n\n<pre><code>export GOPATH=/home/user/go_project\n</code></pre>\n\n<p>And a sample.go file in the example app's directory contains the following import statement:</p>\n\n<pre><code>import (\n  ...\n  \"github.com/stripe/stripe-go\"\n  \"appengine\"\n  \"appengine/datastore\"\n)\n</code></pre>\n\n<p>Then the gcloud tool will look for the \"stripe/stripe-go\" package in the following location when you run or deploy the app:</p>\n\n<pre><code>/home/user/go_project/src/stripe/stripe-go\n</code></pre>\n\n<p>Once the above is done, the devserver should look at the proper path after you've run \"go get github.com/my_repo/packagename\". hope it helps</p>\n"}], "owner": {"reputation": 37028, "user_id": 59198, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6448b40e7037dd0fda767f2370c31809?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/59198/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519380283, "creation_date": 1518522852, "last_edit_date": 1518524124, "question_id": 48766260, "link": "https://stackoverflow.com/questions/48766260/how-do-i-use-third-party-go-libraries-with-google-app-engines-development-serve", "title": "How do i use third party Go libraries with google app engine&#39;s development server?", "body": "<p>In one of my .go files I have:</p>\n\n<pre><code>import (\n  ...\n  \"github.com/stripe/stripe-go\"\n  \"appengine\"\n  \"appengine/datastore\"\n)\n</code></pre>\n\n<p>But when i run <code>dev_appserver.py app.yaml</code> I get the following error:</p>\n\n<pre><code>Can't find package \"github.com/stripe/stripe-go\" in $GOPATH\n</code></pre>\n\n<p>I've tried running <code>go get github.com/stripe/stripe-go</code> which I can see successfully installs to <code>~/go/src/github.com/stripe/stripe-go</code> but the GAE dev server doesn't seem to look at that path for some reason.</p>\n\n<p><code>gcloud app deploy</code> works just fine, for what it's worth.</p>\n"}, {"tags": ["json", "go", "avro"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518521380, "post_id": 48765744, "comment_id": 84531771, "body": "What&#39;s not working? Other than the fact that this does not even compile?"}, {"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518523956, "post_id": 48765744, "comment_id": 84533267, "body": "@marc Yes I know, I&#39;m new to golang. I&#39;m trying to validate that the Json string is valid according to the provided schema. Any idea how to do that or which lib to use with go and how? It&#39;s very easy via Java and Python, but I couldn&#39;t find a way to do this validation in golang. I&#39;ll fix the method to represent a psudo code that I want to implement."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518524033, "post_id": 48765744, "comment_id": 84533316, "body": "There nothing in the [docs]((<a href=\"https://godoc.org/github.com/linkedin/goavro\" rel=\"nofollow noreferrer\">godoc.org/github.com/linkedin/goavro</a>) about validating, it either parses or it does not. Use <a href=\"https://godoc.org/github.com/linkedin/goavro#Codec.NativeFromTextual\" rel=\"nofollow noreferrer\">codec.NativeFromTextual</a> to parse a json string."}, {"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518524368, "post_id": 48765744, "comment_id": 84533510, "body": "@marc I tried that method and couldn&#39;t work with it. If the jsonString parses or return err upon failure it&#39;s excellent. This means that <code>err == nil</code> is a successful parsing. Does it work for you based on my inputs."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518524686, "post_id": 48765744, "comment_id": 84533734, "body": "Your schema is invalid json, so you can&#39;t even build a codec."}, {"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518525382, "post_id": 48765744, "comment_id": 84534188, "body": "@marc I tried this too: <code>jsonString := &quot;{\\&quot;my_int\\&quot;: 3, \\&quot;my_string2\\&quot;: \\&quot;foo\\&quot;}&quot;</code> If something is broken on my end, I&#39;ll appreciate a code snippet that changes my inputs. BTW, I can&#39;t used struct since I have 80 unique fields and they are changing frequently. Many thanks in advance.."}], "answers": [{"comments": [{"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518526348, "post_id": 48767192, "comment_id": 84534780, "body": "you are the puppet master! Is there a way to pass a regular Json string like the one I&#39;ve mentioned in my question or to use a built-in converter that does that for me?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518529517, "post_id": 48767192, "comment_id": 84536990, "body": "No idea, you&#39;ll have to search around."}, {"owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "edited": false, "score": 0, "creation_date": 1518530059, "post_id": 48767192, "comment_id": 84537402, "body": "Many thanks, I&#39;ll write my own parser and if it&#39;s good enough I&#39;ll share it here."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 1, "last_activity_date": 1518526020, "creation_date": 1518526020, "answer_id": 48767192, "question_id": 48765744, "link": "https://stackoverflow.com/questions/48765744/validating-json-file-with-avro-schema/48767192#48767192", "title": "Validating Json file with Avro Schema", "body": "<p>Your schema json is invalid, it's missing the terminating <code>}</code>, so <code>goavro.NewCodec</code> returns an error.</p>\n\n<p>Then your json string definitely doesn't match the schema, the json values must be a <code>{type: value}</code>.</p>\n\n<p>You can use the following corrected schema and example string to validate it.</p>\n\n<pre><code>func main() {\n  avroSchema := `\n{ \n   \"type\":\"record\",\n   \"name\":\"raw\",\n   \"namespace\":\"events\",\n   \"fields\":[\n      {\n         \"name\":\"my_int\",\n         \"type\":[\n            \"null\",\n            \"int\"\n         ],\n         \"default\":null\n      },\n      {\n         \"name\":\"my_string\",\n         \"type\":[\n            \"null\",\n            \"string\"\n         ],\n         \"default\":null\n      },\n      {\n         \"name\":\"my_string2\",\n         \"type\":\"null\"\n      }\n   ]\n}`\n  codec, err := goavro.NewCodec(avroSchema)\n  if err != nil {\n    log.Fatalf(\"Codec error: %v\", err)\n  }\n\n  jsonString := `{\"my_int\": {\"int\":3}, \"my_string\": {\"string\":\"foo\"}, \"my_string2\": null}`\n\n  decoded, _, err := codec.NativeFromTextual([]byte(jsonString))\n  if err != nil { \n    log.Fatalf(\"NativeFromTextual error: %v\", err)\n  } \n  log.Println(\"Decoded:\", decoded)\n} \n</code></pre>\n\n<p>This prints:</p>\n\n<blockquote>\n  <p>Decoded: map[my_int:map[int:3] my_string:map[string:foo]\n  my_string2:]</p>\n</blockquote>\n"}], "owner": {"reputation": 867, "user_id": 2656748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbbbe53faa127eb821f85de0a54d8f7?s=128&d=identicon&r=PG", "display_name": "Oran", "link": "https://stackoverflow.com/users/2656748/oran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518618349, "creation_date": 1518521206, "last_edit_date": 1518618349, "question_id": 48765744, "link": "https://stackoverflow.com/questions/48765744/validating-json-file-with-avro-schema", "title": "Validating Json file with Avro Schema", "body": "<p>I'm trying to check if a Json string matches an Avro schema. I don't care about doing serialization of the data, just getting a bool result of <code>isValidJson=true/false</code>.\nI'll go with every <strong>golang</strong> library.\nI've tried to write something with this <a href=\"https://github.com/linkedin/goavro\" rel=\"nofollow noreferrer\">goavro</a> lib, but it didn't work for me, maybe because I'm new to go like.</p>\n\n<p>Desired pseudo code:</p>\n\n<pre><code>func main() {\n    avroSchema := \n    `{\"type\":\"record\",\"name\":\"raw\",\"namespace\":\"events\",\"fields\":[{\"name\":\"my_int\",\"type\":[\"null\",\"int\"],\"default\":null},{\"name\":\"my_string\",\"type\":[\"null\",\"string\"],\"default\":\"null\"},{\"name\":\"my_string2\",\"type\":null}]}`\n    jsonString := `{\"my_int\": 3, \"my_string\": \"foo\", \"my_string2\": null}`\n    ok ;= isValidJson(jsonString, avroSchema)\n}\n</code></pre>\n\n<p>Any idea how to implement the <code>isValidJson(..)</code> method?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3903, "user_id": 1434070, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/7uABI.jpg?s=128&g=1", "display_name": "fips", "link": "https://stackoverflow.com/users/1434070/fips"}, "edited": false, "score": 2, "creation_date": 1518520309, "post_id": 48764572, "comment_id": 84531126, "body": "It seems to not be possible at this point. <code>Deprecated</code> field of path operations in <code>gen_swagger</code> are <a href=\"https://github.com/goadesign/goa/blob/563a70bfd6948d71bcf09bc105aee5ec745c0409/goagen/gen_swagger/swagger.go#L949\" rel=\"nofollow noreferrer\">hardcoded to false</a>."}, {"owner": {"reputation": 1619, "user_id": 2470533, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/aYLwA.jpg?s=128&g=1", "display_name": "Ilya Buziuk", "link": "https://stackoverflow.com/users/2470533/ilya-buziuk"}, "reply_to_user": {"reputation": 3903, "user_id": 1434070, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/7uABI.jpg?s=128&g=1", "display_name": "fips", "link": "https://stackoverflow.com/users/1434070/fips"}, "edited": false, "score": 0, "creation_date": 1518520736, "post_id": 48764572, "comment_id": 84531373, "body": "@fips thanks for your response. But is there any go / goa lang facility to warn that code is deprecated even not taking swagger into account. The best I can come up with is just adding &quot;Deprecated&quot; to action name / description + adding &quot;Deprecated: &quot; to the doc comment"}, {"owner": {"reputation": 3903, "user_id": 1434070, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/7uABI.jpg?s=128&g=1", "display_name": "fips", "link": "https://stackoverflow.com/users/1434070/fips"}, "edited": false, "score": 2, "creation_date": 1518521006, "post_id": 48764572, "comment_id": 84531555, "body": "Yes, from the <a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"nofollow noreferrer\">golang blog</a> &quot;To signal that an identifier should not be used, add a paragraph to its doc comment that begins with &quot;Deprecated:&quot; followed by some information about the deprecation&quot;. Here&#39;s an <a href=\"https://golang.org/src/net/http/transport.go#L107\" rel=\"nofollow noreferrer\">example</a>."}, {"owner": {"reputation": 1619, "user_id": 2470533, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/aYLwA.jpg?s=128&g=1", "display_name": "Ilya Buziuk", "link": "https://stackoverflow.com/users/2470533/ilya-buziuk"}, "reply_to_user": {"reputation": 3903, "user_id": 1434070, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/7uABI.jpg?s=128&g=1", "display_name": "fips", "link": "https://stackoverflow.com/users/1434070/fips"}, "edited": false, "score": 1, "creation_date": 1518521072, "post_id": 48764572, "comment_id": 84531590, "body": "@flips sounds good, thanks for clarifications"}], "answers": [{"tags": [], "owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "is_accepted": true, "score": 1, "last_activity_date": 1535081473, "creation_date": 1535081473, "answer_id": 51997061, "question_id": 48764572, "link": "https://stackoverflow.com/questions/48764572/how-to-correctly-deprecate-api-endpoint-in-go-goa-framework/51997061#51997061", "title": "How to correctly deprecate API endpoint in go / goa framework?", "body": "<pre><code>// Deprecated: Use strings.HasPrefix instead.\n</code></pre>\n\n<p>will work.</p>\n\n<p><a href=\"https://i.stack.imgur.com/tWR0v.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tWR0v.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 1619, "user_id": 2470533, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/aYLwA.jpg?s=128&g=1", "display_name": "Ilya Buziuk", "link": "https://stackoverflow.com/users/2470533/ilya-buziuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 1, "accepted_answer_id": 51997061, "answer_count": 1, "score": 2, "last_activity_date": 1535081473, "creation_date": 1518517809, "last_edit_date": 1518519321, "question_id": 48764572, "link": "https://stackoverflow.com/questions/48764572/how-to-correctly-deprecate-api-endpoint-in-go-goa-framework", "title": "How to correctly deprecate API endpoint in go / goa framework?", "body": "<p>What is the correct way of deprecating endpoint in go / goa framework e.g.:    </p>\n\n<pre><code>a.Action(\"foo\", func() {\n    a.Routing(\n        a.PATCH(\"/foo\"),\n    )\n    a.Description(\"Test endpoint\")\n    a.Response(d.OK, func() {\n        a.Media(someTestMediaType)\n    })\n    a.Response(d.Accepted, func() {\n        a.Media(someTestMediaType)\n    })\n    a.Response(d.BadRequest, JSONAPIErrors)\n    a.Response(d.InternalServerError, JSONAPIErrors)\n})\n</code></pre>\n\n<p>In java / spring world I would just put <code>@Deprecated</code> annotation on controller method and if swagger is in place it would also mark it is deprecated so that this would be reflected both in code &amp; UI: </p>\n\n<p><a href=\"https://i.stack.imgur.com/uwO5e.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uwO5e.png\" alt=\"enter image description here\"></a></p>\n\n<p>Wondering what is go / goa equivalent for this ?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 220, "user_id": 1897184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DFHEx.jpg?s=128&g=1", "display_name": "vmathieu", "link": "https://stackoverflow.com/users/1897184/vmathieu"}, "edited": false, "score": 0, "creation_date": 1518517788, "post_id": 48764099, "comment_id": 84529601, "body": "I want to close the first rendering, because the user <code>POST</code> will affect the content of the rendering. So wait to start the second is useless, i want to replace the first start by the second."}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 2, "last_activity_date": 1518516355, "creation_date": 1518516355, "answer_id": 48764099, "question_id": 48763833, "link": "https://stackoverflow.com/questions/48763833/cancel-currently-running-function-goroutine/48764099#48764099", "title": "Cancel currently running function/goroutine", "body": "<p>I suppose your rendering function is calling into a library, so you don't have control over the code where the bulk of the time is spent. If you do have such control, just pass a channel into the goroutine, periodically check if the channel is closed, and just <code>return</code> from the goroutine if that happens.</p>\n\n<p>But actually I would recommend a different, and simpler, solution: keep track (in a <code>map</code>) of the file names (or hashes) of the files that are currently being processed, and check that map before launching a second one.</p>\n"}, {"tags": [], "owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "is_accepted": true, "score": 3, "last_activity_date": 1518524145, "last_edit_date": 1518524145, "creation_date": 1518516989, "answer_id": 48764290, "question_id": 48763833, "link": "https://stackoverflow.com/questions/48763833/cancel-currently-running-function-goroutine/48764290#48764290", "title": "Cancel currently running function/goroutine", "body": "<p>No; whatever function you've scheduled to run as a goroutine needs to either return or call <code>runtime.Goexit</code>.</p>\n\n<p>If you're looking for a way to build cancellation into your worker, Go provides a primitive to handle that, which is already part of any HTTP request - contexts. Check out these articles from the Go blog:</p>\n\n<p><a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">Concurrency Patterns: Context</a></p>\n\n<p><a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">Pipelines and cancellation</a></p>\n"}], "owner": {"reputation": 220, "user_id": 1897184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DFHEx.jpg?s=128&g=1", "display_name": "vmathieu", "link": "https://stackoverflow.com/users/1897184/vmathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 0, "accepted_answer_id": 48764290, "answer_count": 2, "score": 0, "last_activity_date": 1518524145, "creation_date": 1518515461, "last_edit_date": 1518517110, "question_id": 48763833, "link": "https://stackoverflow.com/questions/48763833/cancel-currently-running-function-goroutine", "title": "Cancel currently running function/goroutine", "body": "<p>I'm using <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">gin-gonic</a> as HTTP handler. I want to prerender some graphical resources after my users make <code>POST</code> request. For this, I put a middleware that assign a function (with a timer inside) to a <code>map[string]func()</code> and call this function directly after assignation.</p>\n\n<p>The problem is, when the user make two subsequent request, the function is called twice. </p>\n\n<p>Is there any way to clear function ref and/or his currently running call like a <code>clearInterval</code> or <code>clearTimeout</code> in Javascript ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1518513214, "post_id": 48762979, "comment_id": 84526630, "body": "You cannot. See <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a> for explanation and solution."}, {"owner": {"reputation": 21, "user_id": 9353912, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9mfeFMTnrE/AAAAAAAAAAI/AAAAAAAAAEA/EcxySDnP8gI/photo.jpg?sz=128", "display_name": "Time2k", "link": "https://stackoverflow.com/users/9353912/time2k"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1518514185, "post_id": 48762979, "comment_id": 84527313, "body": "thanks for reply ! @Volker"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518515668, "post_id": 48762979, "comment_id": 84528274, "body": "fist of all as you can see clearly you are passing slice of interface in your code. You should be passing interface and the get the underlying type which can be a slice. So In <code>sum1</code> you are actually passing int type parameters which can not be wrapped using slice of interface."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9353912, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9mfeFMTnrE/AAAAAAAAAAI/AAAAAAAAAEA/EcxySDnP8gI/photo.jpg?sz=128", "display_name": "Time2k", "link": "https://stackoverflow.com/users/9353912/time2k"}, "edited": false, "score": 0, "creation_date": 1518574777, "post_id": 48763845, "comment_id": 84559023, "body": "in my opinion\uff0cdefine a function which argument are &quot;x...interface{}&quot; , you can pass any type, string, int and so on.  but in &quot;function type&quot; which exactly and definitely define a type you can not.  i find the answer on <a href=\"https://golang.org/doc/faq#How_do_I_get_dynamic_dispatch_of_methods\" rel=\"nofollow noreferrer\">golang.org/doc/faq#How_do_I_get_dynamic_dispatch_of_methods</a>"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "reply_to_user": {"reputation": 21, "user_id": 9353912, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9mfeFMTnrE/AAAAAAAAAAI/AAAAAAAAAEA/EcxySDnP8gI/photo.jpg?sz=128", "display_name": "Time2k", "link": "https://stackoverflow.com/users/9353912/time2k"}, "edited": false, "score": 0, "creation_date": 1518598487, "post_id": 48763845, "comment_id": 84567357, "body": "An interface does not need to have a type, but type gens is a func with arguments given as an interface and the func returns an int, the reason sum1 does not work is because the arguments are passed to to sum 1 as an interface but sum1 wants to get 3 int values"}], "tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 2, "last_activity_date": 1518515502, "creation_date": 1518515502, "answer_id": 48763845, "question_id": 48762979, "link": "https://stackoverflow.com/questions/48762979/function-type-parameter-match-in-golang/48763845#48763845", "title": "function type parameter match in golang", "body": "<pre><code>type gens func(args...interface{}) int\n</code></pre>\n\n<p>You make type gens which is a function that has arguments in the interface format.</p>\n\n<p>sum1 does not accept an interface as input so it gives you the error</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 9353912, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9mfeFMTnrE/AAAAAAAAAAI/AAAAAAAAAEA/EcxySDnP8gI/photo.jpg?sz=128", "display_name": "Time2k", "link": "https://stackoverflow.com/users/9353912/time2k"}, "is_accepted": false, "score": 0, "last_activity_date": 1518579345, "last_edit_date": 1518579345, "creation_date": 1518575719, "answer_id": 48778800, "question_id": 48762979, "link": "https://stackoverflow.com/questions/48762979/function-type-parameter-match-in-golang/48778800#48778800", "title": "function type parameter match in golang", "body": "<pre><code>package main\n\ntype gens func(args...interface{}) int\n\nfunc sum1(a...int) int {\n    ret := 0\n    for _,v := range a {\n        ret = ret + v\n    }\n    return ret\n}\n\nfunc sum2(a...interface{}) int {\n    ret := 0\n    for _,v := range a {\n        if _,ok := v.(int);ok {\n            ret = ret + v.(int)\n        }\n    }\n    return ret\n}\n\nfunc main() {\n    var a gens\n    println(sum2(1,'2',3))\n    //a = sum1\n    a = sum2\n    println(a(1,2,3))\n}\n</code></pre>\n\n<p>i change code like this.  just better way to show how i think and study, excuse my pool english T_T</p>\n\n<p>in sum2 func, arguments accept actually slice of interface,\nyou can pass any type string, int and so on, see above, i pass 1,'2',3\uff0c it's ok now.</p>\n\n<p>but in \"function type\" which exactly and definitely define a type can not.\ni can't run a = sum1 \ncompiler say \" cannot use sum1 (type func(...int) int) as type gens in assignment\"</p>\n\n<p>in golang data struct, interface{} defined different from other, i think define a type will check more strict!\ni find the answer on <a href=\"http://golang.org/doc/faq#How_do_I_get_dynamic_dispatch_of_methods\" rel=\"nofollow noreferrer\">http://golang.org/doc/faq#How_do_I_get_dynamic_dispatch_of_methods</a></p>\n"}, {"tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": false, "score": 1, "last_activity_date": 1519050444, "creation_date": 1519050444, "answer_id": 48868265, "question_id": 48762979, "link": "https://stackoverflow.com/questions/48762979/function-type-parameter-match-in-golang/48868265#48868265", "title": "function type parameter match in golang", "body": "<p>Your functions <code>sum1</code> and <code>sum2</code> have different signatures and so sum1 cannot be assigned to type <code>gens</code></p>\n\n<p>Whenever possible you should avoid to use the <code>interface{}</code> datatype, as it requires runtime type conversions when you are working with it. (of course there are valid reasons to still do that, like unmarshaling etc ) </p>\n\n<p>You can read more about the empty interface here: <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow noreferrer\">http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go</a></p>\n\n<p>You could implement a type switch in sum2 to handle different primitive types and then add them: </p>\n\n<pre><code>func sum2(a...interface{}) int {\n    ret := 0\n    for _,v := range a {\n        switch d := v.(type) {\n            case int, int32, int16:\n                ret += int(d)\n            case float64,float32:\n               ret += float(d)\n        }\n        if _,ok := v.(int);ok {\n            ret = ret + v.(int)\n        }\n    }\n    return ret\n}\n</code></pre>\n\n<p>Or you could define an interface yourself which you then accept in the function like this </p>\n\n<pre><code>type Integer interface{\n    Int() int\n}\n\nfunc sum(i... Integer) {\n    result := 0\n    for _, v := range i {\n        result += v.Int()\n    }\n} \n\ntype myfloat float64\nfunc (m myfloat) Int() int {\n    return int(m)\n}\n</code></pre>\n\n<p>As for your use-case the last way would be recommended. Give each task a behavior like \"run()\" and then the scheduler knows what to do with it. </p>\n"}], "owner": {"reputation": 21, "user_id": 9353912, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9mfeFMTnrE/AAAAAAAAAAI/AAAAAAAAAEA/EcxySDnP8gI/photo.jpg?sz=128", "display_name": "Time2k", "link": "https://stackoverflow.com/users/9353912/time2k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1519050444, "creation_date": 1518512712, "question_id": 48762979, "link": "https://stackoverflow.com/questions/48762979/function-type-parameter-match-in-golang", "title": "function type parameter match in golang", "body": "<pre><code>package main\n\ntype gens func(args...interface{}) int\n\nfunc sum1(a int,b int,c int) int {\n    return a+b+c\n}\n\nfunc sum2(a...interface{}) int {\n    ret := 0\n    for _,v := range a {\n        ret = ret + v.(int)\n    }\n    return ret\n}\n\nfunc main() {\n    var a gens\n    //a = sum1\n    a = sum2\n    println(a(1,2,3))\n}\n</code></pre>\n\n<p>consider above code, sum2 can work but sum1 doesn't.</p>\n\n<p>compiler said \"cannot use sum1 (type func(int, int, int) int) as type gens in assignment\"</p>\n\n<p>The reason why i ask because i want to write a goroutine scheduler that accpet variable-params functions, How can i do but rewrite lots of other func params to \"args...interface{}\" </p>\n\n<p>thx!</p>\n"}, {"tags": ["ios", "go", "swift3", "rsa", "public-key-encryption"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518505804, "post_id": 48761010, "comment_id": 84522844, "body": "Can you show the code that generates the base64 key?"}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518506279, "post_id": 48761010, "comment_id": 84523040, "body": "I retrieve it from my models with Binary Data data type actually <code>publicKeyBase64 := base64.StdEncoding.EncodeToString(publicKey.Data)</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518506528, "post_id": 48761010, "comment_id": 84523153, "body": "What is <code>Data</code>? That&#39;s not a field of a <code>rsa.PublicKey</code>."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518506635, "post_id": 48761010, "comment_id": 84523203, "body": "it&#39;s from my struct \t<code>PublicKey \tbson.Binary</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518506734, "post_id": 48761010, "comment_id": 84523239, "body": "Ok, that still doesn&#39;t help. Where does it originally come from? Is it the <code>block.Bytes</code> from a pem block? If not, you&#39;re probably storing the wrong thing, or trying to decode it the wrong way. RIght now, we just know it&#39;s base64."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518506928, "post_id": 48761010, "comment_id": 84523332, "body": "oh, no, i don&#39;t use pem string, it originally comes from my device (iOS), i encoded public Key generated from my device with Base64 and save it in my mongoDB as a Binary Data, and as you can see the Base64 value is exactly the same as <code>publicKeyBase64</code>, i test it in my Rails Console to convert it to rsa_public_key and it succeeded"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518507425, "post_id": 48761010, "comment_id": 84523566, "body": "Then please show the code you use in Rails. We still don&#39;t know what this data actually represents. It may not be base64-encoded ASN.1 data."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518508900, "post_id": 48761010, "comment_id": 84524271, "body": "The ruby code you added just writes the key. You said you managed to construct a working public key from the data. Please show that code."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518509052, "post_id": 48761010, "comment_id": 84524351, "body": "you mean my code in iOS app?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518509106, "post_id": 48761010, "comment_id": 84524381, "body": "So far, you have not shown that the base64 data is actually a public key. You need to show the code that uses it as such, not just encoding and storing. Until then, we can assume it&#39;s just random data."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518510008, "post_id": 48761010, "comment_id": 84524815, "body": "ok, i have added my code for generate a public key in iOS app"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518510933, "post_id": 48761010, "comment_id": 84525306, "body": "Not sure why ruby is happy, but your ASN.1 is barebones. You need to first convert it to PEM for anyone outside iOS to be able to read it properly: <a href=\"https://digitalleaves.com/blog/2015/10/sharing-public-keys-between-ios-and-the-rest-of-the-world/\" rel=\"nofollow noreferrer\">digitalleaves.com/blog/2015/10/&hellip;</a>. Or to the ASN.1 parsing yourself and extract the values yourself."}], "answers": [{"comments": [{"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518515193, "post_id": 48763222, "comment_id": 84527972, "body": "I use another Base64 encoded from my friend (comes from android, but don&#39;t know yet what library he&#39;s using right now) and it works fine with current code <code>&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDkx9h4KXOoW+2Kb06pLz7&zwnj;&#8203;vo3GN3iGqWk8sS2SxvRS&zwnj;&#8203;M+&#47;S6bmhrt2Mw+StSSzQ&zwnj;&#8203;Sn4YMhF1rEU7fED1buI8&zwnj;&#8203;5bx8QpFwdAu1MzB1uWVX&zwnj;&#8203;So&#47;koM3voAzghQTiCvoJ&zwnj;&#8203;igxgIHtKdr2e03D9vWYQ&zwnj;&#8203;Pxh862yFIstzItCgksli&zwnj;&#8203;SwLXD5++IKQIDAQAB&quot;</code>"}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518515251, "post_id": 48763222, "comment_id": 84528015, "body": "I think it is better to change my iOS code to send valid public Key with Base64 encoded format"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518515869, "post_id": 48763222, "comment_id": 84528384, "body": "Your friend&#39;s key includes the algorithm: <code>echo ... | base64 -d | dumpasn1 -</code> shows <code>.... OBJECT IDENTIFIER rsaEncryption ...</code>. Yours did not, just integers."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518516097, "post_id": 48763222, "comment_id": 84528525, "body": "And I agree, if you can change the iOS code, that will be much more durable. Other libraries/tools will have the same problem as Go. It&#39;s also good if you want to allow EC keys."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518518192, "post_id": 48763222, "comment_id": 84529863, "body": "i think, i prefer to fix the <code>AsymmetricCryptoManager.getPublicKeyData()</code> in <code>AsymmetricCryptoManager.swift</code>  to add the algorithm information, but i&#39;m still confused how to add it. I have change the default of <code>kAsymmetricCryptoManagerKeySize</code> value to 1024 from 2048 (because i just need 1024)"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518518533, "post_id": 48763222, "comment_id": 84530083, "body": "You should be able to just call <code>CryptoExportImportManager().exportPublicKeyToDER(AsymmetricC&zwnj;&#8203;ryptoManager.sharedI&zwnj;&#8203;nstance.getPublicKey&zwnj;&#8203;Data(), kSecAttrKeyTypeRSA, 1024)</code>. The size needs to match the key, but 1024 or 2048 is up to you."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518518997, "post_id": 48763222, "comment_id": 84530394, "body": "ohh, so i need to have both AsymmetricCryptoManager library for generate public key and CryptoExportImportManager to export the public key to my backend"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518519044, "post_id": 48763222, "comment_id": 84530419, "body": "That&#39;s correct, you still get the key the same way, <code>CryptoExportImportManager</code> just converts it to something more standard. I&#39;ve added a link to the example from that library, it shows you how to use both."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518523472, "post_id": 48763222, "comment_id": 84532963, "body": "alright, how about the private key? should i add the algorithm information in private key at AsymmetricCryptoManager.swift ? Because when i try to decode my encrypted message from my public key, it got failed, it almost finish and after i can decrypt my message, it is done"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518524160, "post_id": 48763222, "comment_id": 84533385, "body": "If you&#39;re only decrypting, you shouldn&#39;t need to send the private key. Not sure how to export this one if you do though. Also, make sure you decrypt with the same parameters, mainly the padding. <code>SecPadding.PKCS1</code> in this case."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518524300, "post_id": 48763222, "comment_id": 84533474, "body": "hmm, i don&#39;t need to export the private key, i just need to decrypt it in my iOS app (encrypted_message sent from Go). Right now it is failed to decrypt, and i suspicious i should modify something for decrypting it"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518524711, "post_id": 48763222, "comment_id": 84533753, "body": "This is technically a separate question. But the main thing is the padding."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518583639, "post_id": 48763222, "comment_id": 84561275, "body": "for encryption in Go, i use <code>rsa.EncryptPKCS1v15(rand.Reader, publicKey, message)</code>  and in iOS i use just <code>PKCS1</code>, is it different?"}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518588105, "post_id": 48763222, "comment_id": 84562622, "body": "I have made a new question: <a href=\"https://stackoverflow.com/questions/48780248/can-i-decrypt-my-encrypted-message-from-my-go-using-encryptpkcs1v15-in-ios\" title=\"can i decrypt my encrypted message from my go using encryptpkcs1v15 in ios\">stackoverflow.com/questions/48780248/&hellip;</a>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518595344, "post_id": 48763222, "comment_id": 84565790, "body": "Not sure, <code>PKCS1</code> refers to the whole family, though I would assume it would use 1.5. Still, for plaintext encryption, it&#39;s recommended to use <a href=\"https://golang.org/pkg/crypto/rsa/#EncryptOAEP\" rel=\"nofollow noreferrer\">EncryptOAEP</a>. Even then, encrypting messages with RSA is iffy, you should be generating a session key and encrypting that, then using the session key to encrypt your plaintext. RSA is meant more for session establishment than actual data encryption."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518596226, "post_id": 48763222, "comment_id": 84566208, "body": "when i try to encrypt from rails, it works fine when i try to decode encryption_message in iOS with PKCS1 padding, so the problem occurs when Go encrypt it with PKCS1v15"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518599096, "post_id": 48763222, "comment_id": 84567748, "body": "Fair enough, it could be different versions of PKCS#1, they don&#39;t specify what they&#39;re using. Still, the point stands: you probably want OAEP."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1518519091, "last_edit_date": 1518519091, "creation_date": 1518513453, "answer_id": 48763222, "question_id": 48761010, "link": "https://stackoverflow.com/questions/48761010/could-not-parse-base64-der-encoded-asn-1-public-key-from-ios-in-golang/48763222#48763222", "title": "Could not parse base64 DER-encoded ASN.1 public key from iOS in Golang", "body": "<p>We can dump the ASN.1 contents to see what they look like:</p>\n\n<pre><code>$ echo \"MIGJAoGBAJJYXgBem1scLKPEjwKrW8+ci3B/YNN3aY2DJ3lc5e2wNc0SmFikDpow1TdYcKl2wdrXX7sMRsyjTk15IECMezyHzaJGQ9TinnkQixJ+YnlNdLC04TNWOg13plyahIXBforYAjYl2wVIA8Yma2bEQFhmAFkEX1A/Q1dIKy6EfQ+xAgMBAAE=\" | \\\n    base64 -d | \\\n    dumpasn1 -\n  0 137: SEQUENCE {\n  3 129:   INTEGER\n       :     00 92 58 5E 00 5E 9B 5B 1C 2C A3 C4 8F 02 AB 5B\n       :     CF 9C 8B 70 7F 60 D3 77 69 8D 83 27 79 5C E5 ED\n       :     B0 35 CD 12 98 58 A4 0E 9A 30 D5 37 58 70 A9 76\n       :     C1 DA D7 5F BB 0C 46 CC A3 4E 4D 79 20 40 8C 7B\n       :     3C 87 CD A2 46 43 D4 E2 9E 79 10 8B 12 7E 62 79\n       :     4D 74 B0 B4 E1 33 56 3A 0D 77 A6 5C 9A 84 85 C1\n       :     7E 8A D8 02 36 25 DB 05 48 03 C6 26 6B 66 C4 40\n       :     58 66 00 59 04 5F 50 3F 43 57 48 2B 2E 84 7D 0F\n       :     B1\n135   3:   INTEGER 65537\n       :   }\n\n0 warnings, 0 errors.\n</code></pre>\n\n<p>A well-formatted ASN.1 public key should include the algorithm as well. We should have a line similar to:</p>\n\n<pre><code>  5   9:     OBJECT IDENTIFIER rsaEncryption (1 2 840 113549 1 1 1)\n</code></pre>\n\n<p>The <code>AsymmetricCryptoManager.getPublicKeyData()</code> returns a very barebones  <code>ASN.1</code> key, without any algorithm information. This makes Go very unhappy as it has no way of knowing what kind of key it is. See <a href=\"https://digitalleaves.com/blog/2015/10/sharing-public-keys-between-ios-and-the-rest-of-the-world/\" rel=\"nofollow noreferrer\">more about correctly exporting the key here</a>.</p>\n\n<p><strong>If you can change the iOS code</strong>, you should instead use <a href=\"https://github.com/DigitalLeaves/CryptoExportImportManager\" rel=\"nofollow noreferrer\">CryptoExportImportManager</a> and use one of <code>exportPublicKeyToPEM</code> or <code>exportPublicKeyToDER</code>. These take the output of <code>getPublicKeyData</code> and generate output usable by other tools. You can find an example of how to use them in the <a href=\"https://github.com/DigitalLeaves/CryptoExportImportManager/blob/master/CryptoLoadExternalCertificate/ExportViewController.swift#L44\" rel=\"nofollow noreferrer\">CryptoExportImportManager example</a>.</p>\n\n<p><strong>If you cannot change the key export code</strong>, you can instead parse it directly in Go. This assumes that you know for sure that it is a RSA public key:</p>\n\n<pre><code>func main() {\n    publicKeyBase64 := \"MIGJAoGBAJJYXgBem1scLKPEjwKrW8+ci3B/YNN3aY2DJ3lc5e2wNc0SmFikDpow1TdYcKl2wdrXX7sMRsyjTk15IECMezyHzaJGQ9TinnkQixJ+YnlNdLC04TNWOg13plyahIXBforYAjYl2wVIA8Yma2bEQFhmAFkEX1A/Q1dIKy6EfQ+xAgMBAAE=\"\n\n    // Base64 decode.\n    publicKeyBinary, err := base64.StdEncoding.DecodeString(publicKeyBase64)\n    if err != nil {\n        panic(err)\n    }\n\n    // rsa.PublicKey is a big.Int (N: modulus) and an integer (E: exponent).\n    var pubKey rsa.PublicKey\n    if rest, err := asn1.Unmarshal(publicKeyBinary, &amp;pubKey); err != nil {\n        panic(err)\n    } else if len(rest) != 0 {\n        panic(\"rest is not nil\")\n    }\n\n    fmt.Printf(\"key: %+v\\n\", pubKey)\n}\n</code></pre>\n\n<p>This prints out:</p>\n\n<blockquote>\n  <p>key:\n  {N:+102767083290202280873554060983826675083148443795791447833515664566475334389364583758312108980110921996262487865832851258326049062353432991986398760705560379825908169063986770245967781444794847106351934016144540466696422397564949226710181429429140226472206572796987719088983654589217713611861345869296293449649\n  E:65537}</p>\n</blockquote>\n\n<p>You can now use your public key in package rsa functions.</p>\n"}], "owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1503, "favorite_count": 1, "accepted_answer_id": 48763222, "answer_count": 1, "score": 1, "last_activity_date": 1518519091, "creation_date": 1518504606, "last_edit_date": 1518518252, "question_id": 48761010, "link": "https://stackoverflow.com/questions/48761010/could-not-parse-base64-der-encoded-asn-1-public-key-from-ios-in-golang", "title": "Could not parse base64 DER-encoded ASN.1 public key from iOS in Golang", "body": "<p>i have a projects in Golang with RSA enryption, so now, i have a Base64 public key format which used for encrypt a message,</p>\n\n<p>i used this code:</p>\n\n<pre><code>publicKeyBase64 = \"MIGJAoGBAJJYXgBem1scLKPEjwKrW8+ci3B/YNN3aY2DJ3lc5e2wNc0SmFikDpow1TdYcKl2wdrXX7sMRsyjTk15IECMezyHzaJGQ9TinnkQixJ+YnlNdLC04TNWOg13plyahIXBforYAjYl2wVIA8Yma2bEQFhmAFkEX1A/Q1dIKy6EfQ+xAgMBAAE=\"\npublicKeyBinary, err := base64.StdEncoding.DecodeString(publicKeyBase64)\n\npublicKeyInterface, err := x509.ParsePKIXPublicKey(publicKeyBinary)\n    if err != nil {\n    fmt.Println(\"Could not parse DER encoded public key (encryption key)\")\n    return \"\",\"\",err\n}\n\npublicKey, isRSAPublicKey := publicKeyInterface.(*rsa.PublicKey)\nif !isRSAPublicKey {\n    fmt.Println(\"Public key parsed is not an RSA public key\")\n    return \"\",\"\",err\n}\n\nencryptedMessage, err := rsa.EncryptPKCS1v15(rand.Reader, publicKey, \"message\")\n</code></pre>\n\n<p>When i run this code, i got this error: </p>\n\n<pre><code>Could not parse DER encoded public key (encryption key)\n\nasn1: structure error: tags don't match (16 vs {class:0 tag:2 length:129 isCompound:false}) {optional:false explicit:false application:false defaultValue:&lt;nil&gt; tag:&lt;nil&gt; stringType:0 timeType:0 set:false omitEmpty:false} AlgorithmIdentifier @3\n</code></pre>\n\n<p>The error points to publicKeyInterface, it failed to parse from Base64 decoded format to public Key, What's the problem with my code ?</p>\n\n<p>=======updated=====</p>\n\n<p>my publicKeyBase64 is retrieved from my models with Binary Data type</p>\n\n<p>When i store it in my mongoDB from my Rails API, i receive public_key params as Base64 format, but i decode it to binary and then i stored it with this code </p>\n\n<pre><code>def create\n  params = device_params      \n  public_key = Base64.decode64 device_params[:public_key]\n  #device_params[:public_key] value is \"MIGJAoGBAJJYXgBem1scLKPEjwKrW8+ci3B/YNN3aY2DJ3lc5e2wNc0SmFikDpow1TdYcKl2wdrXX7sMRsyjTk15IECMezyHzaJGQ9TinnkQixJ+YnlNdLC04TNWOg13plyahIXBforYAjYl2wVIA8Yma2bEQFhmAFkEX1A/Q1dIKy6EfQ+xAgMBAAE=\"\n  params[:public_key] = BSON::Binary.new(public_key, :generic)\n  device = Device.find_or_create_by(id: device_params[:id])\n\n  render_success device.update_attributes(params), device\nend\n</code></pre>\n\n<p>When i use rails code to convert my Base64 public key string using this code, it succeeded:</p>\n\n<pre><code>rsa_public_key = OpenSSL::PKey::RSA.new(Base64.decode64(public_key))\n</code></pre>\n\n<p>in my iOS app, i use <a href=\"https://github.com/DigitalLeaves/AsymmetricCrypto\" rel=\"nofollow noreferrer\">https://github.com/DigitalLeaves/AsymmetricCrypto</a> \nto generate a public Key using this code:</p>\n\n<pre><code>AsymmetricCryptoManager.sharedInstance.createSecureKeyPair({ (success, error) -&gt; Void in\n   if success {\n    print(\"RSA-1024 keypair successfully generated.\")\n    let publicKey = AsymmetricCryptoManager.sharedInstance.getPublicKeyData()?.base64EncodedString()\n\n    let url = ENV.BASE_URL + \"devices\"\n    let headers = [\"Authentication-Token\": CurrentUser.getCurrentUser().token] as! HTTPHeaders\n    let params = [\"device[user_id]\": CurrentUser.getCurrentUser().id!, \"device[id]\": instanceID,\"device[token]\": fcmToken, \"device[os]\": \"ios\", \"device[public_key]\": publicKey!]\n\n    Alamofire.request(url, method: .post, parameters: params, encoding: URLEncoding.default, headers: headers)\n} else { print(\"An error happened while generating a keypair: \\(error)\") }\n})\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "is_accepted": true, "score": 3, "last_activity_date": 1518496075, "creation_date": 1518496075, "answer_id": 48759456, "question_id": 48758622, "link": "https://stackoverflow.com/questions/48758622/serving-static-files-in-secondary-routes-route-secondary-route-golang/48759456#48759456", "title": "Serving static files in secondary routes (&quot;/route/secondary/route&quot;) Golang", "body": "<p>This isn't an issue with the handler, it is an issue with your HTML link.</p>\n\n<p><code>&lt;link rel=\"stylesheet\" href=\"static/leaflet/leaflet.css\" /&gt;</code> is relative to the current URL.</p>\n\n<p>That is to say, <code>static/leaflet/leaflet.css</code> will be appended to the current URL - when you are on your homepage this isn't an issue as it translates to <code>/static/leaflet/leaflet.css</code> but when you are on your clients page it turns into <code>/clients/static/leaflet/leaflet.css</code>.</p>\n\n<p>The simple fix is just to add a leading <code>/</code> to your <code>href</code>:</p>\n\n<p><code>&lt;link rel=\"stylesheet\" href=\"/static/leaflet/leaflet.css\" /&gt;</code></p>\n\n<p>This makes the URL absolute and it will be unaffected by visiting other pages of your website.</p>\n"}], "owner": {"reputation": 3, "user_id": 9352710, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Yw23EtYYysg/AAAAAAAAAAI/AAAAAAAACh0/2kiVsv1dhME/photo.jpg?sz=128", "display_name": "Geraldo Figueiredo", "link": "https://stackoverflow.com/users/9352710/geraldo-figueiredo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 48759456, "answer_count": 1, "score": -1, "last_activity_date": 1518496075, "creation_date": 1518489428, "last_edit_date": 1518496002, "question_id": 48758622, "link": "https://stackoverflow.com/questions/48758622/serving-static-files-in-secondary-routes-route-secondary-route-golang", "title": "Serving static files in secondary routes (&quot;/route/secondary/route&quot;) Golang", "body": "<p>In my root handle (\"/\") or clients handle (\"/clients\") the static files are correctly avaliable, and looking the network tab on chrome, i see the server request like this:</p>\n\n<pre><code>localhost:8080/static/file.example\n</code></pre>\n\n<p>But if i'm on the secondary handle (\"/Clients/route\"), don't work correctly, i see this:</p>\n\n<pre><code>localhost:8080/clients/static/file.example\n</code></pre>\n\n<p>The StripPrefix don't remove the \"client\" from the request.</p>\n\n<pre><code>func main() {\nhttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/static\"))))\n\nhttp.HandleFunc(\"/\", index)\nhttp.HandleFunc(\"/clients\", controllers.MostrarClientes)\nhttp.HandleFunc(\"/clientes/route\", controllers.MainIndex)\n\nhttp.ListenAndServe(\":8080\", nil)\n</code></pre>\n\n<p>-</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"static/leaflet/leaflet.css\" /&gt;\n</code></pre>\n\n<p>-</p>\n\n<p>File tree:</p>\n\n<p><a href=\"https://i.stack.imgur.com/uohCx.png\" rel=\"nofollow noreferrer\">tree</a></p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518560243, "post_id": 48758102, "comment_id": 84554908, "body": "For the record, single-case select statements are never useful.  Just receive off the channel directly, it&#39;s mechanically identical to a select that only has a single case (and no default).  Also, the documentation for time.Tick annotates that it is a convenience wrapper for time.NewTicker, and the documentation for time.Ticker annotates that it will drop ticks to make up for slow receivers.  So if your processor is slow, the ticker will skip ticks until your consumer loop is ready to receive the ticks again.  <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Ticker</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1518497597, "last_edit_date": 1518497597, "creation_date": 1518486275, "answer_id": 48758271, "question_id": 48758102, "link": "https://stackoverflow.com/questions/48758102/golang-channel-behaviour-with-for-loops/48758271#48758271", "title": "golang channel behaviour with for loops", "body": "<p>select will only invoke next time.Tick if previous case corresponding code was completed,<br>\nyou can still have some lever by specifying size of channel i.e channel := make(chan bool,10)</p>\n\n<p>See below:  </p>\n\n<pre><code>func main() {\n\n    channel := make(chan bool, 10)\n    go func() {\n        tick := time.Tick(time.Duration(1) * time.Second)\n        for {\n            select {\n            case &lt;-tick:\n                fmt.Printf(\"Producer: TICK %v\\n\", time.Now())\n                channel &lt;- true\n                }\n        }\n    }()\n\n    for {\n        select {\n        case canProcess := &lt;-channel:\n            time.Sleep(3*  time.Second)\n            fmt.Printf(\"Consumer: Completed : %v\\n\")\n            fmt.Printf(\"%v\\n\", canProcess)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 512, "user_id": 7620262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MIcIL.png?s=128&g=1", "display_name": "Adel Helal", "link": "https://stackoverflow.com/users/7620262/adel-helal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 661, "favorite_count": 0, "accepted_answer_id": 48758271, "answer_count": 1, "score": 0, "last_activity_date": 1518497597, "creation_date": 1518484621, "question_id": 48758102, "link": "https://stackoverflow.com/questions/48758102/golang-channel-behaviour-with-for-loops", "title": "golang channel behaviour with for loops", "body": "<p>I'm curious about the behaviour of channels and how they work in relation to loops. Suppose I have the following code:</p>\n\n<p><strong>Consumer</strong></p>\n\n<pre><code>tick := time.Tick(time.Duration(2) * time.Second)\nfor {\n    select {\n    case &lt;-tick:\n        p.channel &lt;-true\n    }\n}\n</code></pre>\n\n<p>And I have a goroutine that has the following:</p>\n\n<p><strong>Processor</strong></p>\n\n<pre><code>for {\n    select {\n    case canProcess := &lt;-p.channel:\n        // synchronous process that takes longer than 2 seconds\n    case &lt;-p.stop:\n        return\n    }\n}\n</code></pre>\n\n<p>What happens when the <strong>Consumer</strong> pushes to the channel faster than the <strong>Processor</strong> can complete its synchronous process?</p>\n\n<p>Do they pile up waiting for the <strong>Processor</strong> to complete or do they skip a \"beat\" as such?</p>\n\n<p>If they pile up, is there potential for memory leaking?</p>\n\n<p>I know I can put the synchronous process in a goroutine instead, but this is really to understand how channels behave. (i.e. my example has a 2-second tick, but it doesn't have to).</p>\n"}, {"tags": ["go", "gob"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1518483249, "creation_date": 1518483249, "answer_id": 48757940, "question_id": 48757909, "link": "https://stackoverflow.com/questions/48757909/gob-not-decoding-as-expected/48757940#48757940", "title": "gob not decoding as expected", "body": "<p><a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Export</a> the field names by capitalizing the first letter.</p>\n\n<pre><code>type REntry struct {\n      Key         string\n      Value       []string\n }\n</code></pre>\n\n<p>The gob package and other similar packages ignore unexported fields.</p>\n"}], "owner": {"reputation": 83, "user_id": 447851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbd87ce753362ae3beb27dea68fb7824?s=128&d=identicon&r=PG", "display_name": "user447851", "link": "https://stackoverflow.com/users/447851/user447851"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "closed_date": 1518483394, "accepted_answer_id": 48757940, "answer_count": 1, "score": -2, "last_activity_date": 1518483249, "creation_date": 1518483039, "question_id": 48757909, "link": "https://stackoverflow.com/questions/48757909/gob-not-decoding-as-expected", "closed_reason": "Duplicate", "title": "gob not decoding as expected", "body": "<p>Here is my playground where I am trying to serialize a list of structures and read back from the file.</p>\n\n<p><a href=\"https://play.golang.org/p/8x0uciOd1Sq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8x0uciOd1Sq</a></p>\n\n<p>I was expecting the object to be decoded successfully. What am I doing wrong?</p>\n"}, {"tags": ["http", "go", "transport", "roundtrip"], "comments": [{"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1518488192, "post_id": 48757894, "comment_id": 84517936, "body": "Can you provide the code of <code>SuperAgent</code> struct?"}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1518489163, "post_id": 48757894, "comment_id": 84518158, "body": "@Anuruddha have added this to the question now."}], "answers": [{"comments": [{"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518490888, "post_id": 48758651, "comment_id": 84518460, "body": "Doing this seems to break all reference to to SuperAgent.Transport. As I understand it, <code>http.Transport</code> is an implementation of <code>http.RoundTripper</code>, that we should be able to swap out. So perhaps it isn&#39;t really possible to do this without a huge rewrite of the package? As you&#39;d have to provide a way to edit things like the proxy on the roundtripper?"}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 0, "last_activity_date": 1518489614, "creation_date": 1518489614, "answer_id": 48758651, "question_id": 48757894, "link": "https://stackoverflow.com/questions/48757894/adding-custom-transport-to-a-third-party-package/48758651#48758651", "title": "Adding custom transport to a third party package", "body": "<p>Error you are seeing says the issue.</p>\n\n<blockquote>\n  <p>cannot use newRateLimitTransport(limit, http.DefaultTransport) (type\n  http.RoundTripper) as type *http.Transport in assignment: need type\n  assertion</p>\n</blockquote>\n\n<p><code>SuperAgent.Transport</code> type is <code>*http.Transport</code> But you are trying to assign <code>http.RoundTripper</code> to that field</p>\n\n<p>To fix this you could change the SuperaAgent</p>\n\n<pre><code>type SuperAgent{\n...\nTransport  http.RoundTripper\n...\n}\n</code></pre>\n"}], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 927, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518489614, "creation_date": 1518482925, "last_edit_date": 1518489151, "question_id": 48757894, "link": "https://stackoverflow.com/questions/48757894/adding-custom-transport-to-a-third-party-package", "title": "Adding custom transport to a third party package", "body": "<p>I have been using <a href=\"https://github.com/parnurzeal/gorequest\" rel=\"nofollow noreferrer\">GoRequest</a> as a package in my Go application.</p>\n\n<p>I use it as it helps make all the API calls I need to make a lot cleaner - one thing that it is lacking, that I am able to do with a regular <code>http.Client</code> is implement outbound rate limiting on the <code>Transport</code>.</p>\n\n<p>For example, in one of my applications I use this - </p>\n\n<pre><code>type rateLimitTransport struct {\n    limiter *rate.Limiter\n    xport   http.RoundTripper\n}\n\nvar _ http.RoundTripper = &amp;rateLimitTransport{}\n\nfunc newRateLimitTransport(r float64, xport http.RoundTripper) http.RoundTripper {\n    return &amp;rateLimitTransport{\n        limiter: rate.NewLimiter(rate.Limit(r), 1),\n        xport:   xport,\n    }\n}\n\nfunc (t *rateLimitTransport) RoundTrip(r *http.Request) (*http.Response, error) {\n    t.limiter.Wait(r.Context())\n    return t.xport.RoundTrip(r)\n}\n\nvar myClient = http.Client{\n    // Use a rate-limiting transport which falls back to the default\n    Transport: newRateLimitTransport(1, http.DefaultTransport),\n}\n</code></pre>\n\n<p>This allows my to create a client, that is rate limited to 1 request per second; 60 requests per minute.</p>\n\n<p>I have forked the GoRequest package and am trying to add a new method to it called <code>SetRateLimit()</code> which should take the rate per second as an argument and use this to implement a rate limited transport.</p>\n\n<p>My attempt so far looks like this:</p>\n\n<pre><code>import (\n    //...current imports\n    \"golang.org/x/time/rate\"\n)\n//... Rest of the package\ntype rateLimitTransport struct {\n    limiter *rate.Limiter\n    xport   http.RoundTripper\n}\n\nvar _ http.RoundTripper = &amp;rateLimitTransport{}\n\nfunc newRateLimitTransport(r float64, xport http.RoundTripper) http.RoundTripper {\n    return &amp;rateLimitTransport{\n        limiter: rate.NewLimiter(rate.Limit(r), 1),\n        xport:   xport,\n    }\n}\n\nfunc (t *rateLimitTransport) RoundTrip(r *http.Request) (*http.Response, error) {\n    t.limiter.Wait(r.Context())\n    return t.xport.RoundTrip(r)\n}\n\nfunc (s *SuperAgent) SetRateLimit(limit float64) *SuperAgent {\n\n    s.Transport = newRateLimitTransport(limit, http.DefaultTransport)\n    return s\n}\n</code></pre>\n\n<p>However I get an error when trying to build this:</p>\n\n<blockquote>\n  <p>cannot use newRateLimitTransport(limit, http.DefaultTransport) (type http.RoundTripper) as type *http.Transport in assignment: need type assertion</p>\n</blockquote>\n\n<p>I've been looking at this for hours, and I don't quite understand how this works for a regular <code>http.Client</code> but doesn't work for this package.</p>\n\n<p><strong>Can someone please help me resolve the issue above and add rate limiting to this package?</strong></p>\n\n<p><strong>Update - SuperRequest struct</strong></p>\n\n<pre><code>// A SuperAgent is a object storing all request data for client.\ntype SuperAgent struct {\n    Url               string\n    Method            string\n    Header            http.Header\n    TargetType        string\n    ForceType         string\n    Data              map[string]interface{}\n    SliceData         []interface{}\n    FormData          url.Values\n    QueryData         url.Values\n    FileData          []File\n    BounceToRawString bool\n    RawString         string\n    Client            *http.Client\n    Transport         *http.Transport\n    Cookies           []*http.Cookie\n    Errors            []error\n    BasicAuth         struct{ Username, Password string }\n    Debug             bool\n    CurlCommand       bool\n    logger            Logger\n    Retryable         struct {\n        RetryableStatus []int\n        RetryerTime     time.Duration\n        RetryerCount    int\n        Attempt         int\n        Enable          bool\n    }\n    //If true prevents clearing Superagent data and makes it possible to reuse it for the next requests\n    DoNotClearSuperAgent bool\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 2430, "user_id": 1762493, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pEEmF.jpg?s=128&g=1", "display_name": "Mikeumus", "link": "https://stackoverflow.com/users/1762493/mikeumus"}, "edited": false, "score": 0, "creation_date": 1518494262, "post_id": 48757718, "comment_id": 84519153, "body": "Code is now working, just needed the right type <code>type testCasesStruct []struct</code>"}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 4114655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/486113e993cbe167fec1a277dfacb447?s=128&d=identicon&r=PG", "display_name": "Tim H.", "link": "https://stackoverflow.com/users/4114655/tim-h"}, "is_accepted": true, "score": 1, "last_activity_date": 1518482755, "creation_date": 1518482755, "answer_id": 48757861, "question_id": 48757718, "link": "https://stackoverflow.com/questions/48757718/go-table-driven-test-helper-function/48757861#48757861", "title": "Go - Table Driven Test Helper Function", "body": "<p>I think helper methods for table-driven tests aren't common because the \"table\" type will probably change between each test. This is because the table includes the inputs and expected outputs, and those changing result in a different type.</p>\n\n<p>The error you're getting is because you're trying to use one type where a different one is expected. You might be able to coerce <code>curPairInputTestCases</code> to a <code>testCasesStructArray</code>, but as soon as you make some changes to the struct type they will be incompatible.</p>\n\n<p>Small nitpick: <code>[]testCasesStruct</code> is a slice and not an array.</p>\n"}], "owner": {"reputation": 2430, "user_id": 1762493, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pEEmF.jpg?s=128&g=1", "display_name": "Mikeumus", "link": "https://stackoverflow.com/users/1762493/mikeumus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 48757861, "answer_count": 1, "score": 1, "last_activity_date": 1518494198, "creation_date": 1518481451, "last_edit_date": 1518494198, "question_id": 48757718, "link": "https://stackoverflow.com/questions/48757718/go-table-driven-test-helper-function", "title": "Go - Table Driven Test Helper Function", "body": "<p>I've found so many good examples of the table driven test, but it seems no ones written about the next step of creating a helper test method to pass in the functions you want to test. So that this part of the code doesn't have to repeat for every function you want to test:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestFib(t *testing.T) {\n  for _, tt := range fibTests {\n    actual := Fib(tt.n)\n    if actual != tt.expected {\n      t.Errorf(\"Fib(%d): expected %d, actual %d\", tt.n, tt.expected, actual)\n    }\n  }\n}\n// from: https://medium.com/@matryer/5-simple-tips-and-tricks-for-writing-unit-tests-in-golang-619653f90742\n</code></pre>\n\n<hr>\n\n<p><strong>* UPDATED</strong> I have this code, now working (<a href=\"https://gist.github.com/mikeumus/a97da2d65bfa4f5b92e13177f6a88922\" rel=\"nofollow noreferrer\">https://gist.github.com/mikeumus/a97da2d65bfa4f5b92e13177f6a88922</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type testCasesStruct []struct {\n    n        string\n    expected bool\n}\ntype valUserInType func(string) bool\n\nvar curPairInputTestCases = []struct {\nn        string\nexpected bool\n}{\n    {\"1/d\", false},\n    // continued test cases...\n}\n\nfunc TestGoPolSuite(t *testing.T) {\n    methodTester(t, validateCurPairInput, curPairInputTestCases)\n}\n\nfunc methodTester(t *testing.T, testingMethod valUserInType, testCases testCasesStruct) {\n    t.Helper()\n    for _, tt := range testCases {\n        actual := testingMethod(tt.n)\n        if actual != tt.expected {\n            t.Errorf(\"\\n%v(%v)\\n expected: %v\\n actual: %v\\n\", testingMethod, tt.n, tt.expected, actual)\n        }\n    }\n}\n</code></pre>\n\n<p><strike> But I was having trouble with the types or pointer or something for passing in a struct of test cases and the function to test in the table driven test loop. I'm getting this error in the code:</p>\n\n<p><code>cannot use curPairInputTestCases (type []struct { n string; expected bool }) as type testCasesStructArray in argument to methodTester\n</code>\n</strike> </p>\n\n<p>This was the closest I've found written about a go test helper function but it doesn't pass in a testcases struct or a function to test against: <a href=\"https://routley.io/tech/2017/11/05/intermediate-go-testing.html\" rel=\"nofollow noreferrer\">https://routley.io/tech/2017/11/05/intermediate-go-testing.html</a></p>\n\n<p><strong>Go TDD!</strong></p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1518499981, "post_id": 48756785, "comment_id": 84520621, "body": "Thanks for the insights! <code>[1&lt;&lt;30]</code> is used because the compiler rejects variable array bounds! So devs just pick a ridiculously large number!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1518533265, "post_id": 48756785, "comment_id": 84539700, "body": "@SomeNoobStudent: it&#39;s really just setting an upper bound for size. <code>1&lt;&lt;30</code> is often used in examples, because it&#39;s valid for both 32 and 64 bit systems, and it looks nicer than <code>1&lt;&lt;31-1</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 11, "last_activity_date": 1611843769, "last_edit_date": 1611843769, "creation_date": 1518475500, "answer_id": 48756785, "question_id": 48756732, "link": "https://stackoverflow.com/questions/48756732/what-does-1-30c-yourtype-do-exactly-in-cgo/48756785#48756785", "title": "What does (*[1 &lt;&lt; 30]C.YourType) do exactly in CGo?", "body": "<p><code>*[1 &lt;&lt; 30]C.YourType</code> doesn't do anything itself, it's a type. Specifically, it's a pointer to an array of size <code>1 &lt;&lt; 30</code>, of <code>C.YourType</code> values. The size is arbitrary, and only represents an upper bound that needs to be valid on the host system.</p>\n<p>What you're doing in the third expression is a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a>.\nThis converts the <code>unsafe.Pointer</code> to a <code>*[1 &lt;&lt; 30]C.YourType</code>.</p>\n<p>Then, you're taking that converted array value, and turning it into a slice with a <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">full slice expression</a> (Array values don't need to be dereferenced for a slice expression, so there is no need to prefix the value with a <code>*</code>, even though it is a pointer).</p>\n<p>You could expand this out a bit like so:</p>\n<pre><code>// unsafe.Pointer to the C array\nunsafePtr := unsafe.Pointer(theCArray)\n\n// convert unsafePtr to a pointer of the type *[1 &lt;&lt; 30]C.YourType\narrayPtr := (*[1 &lt;&lt; 30]C.YourType)(unsafePtr)\n\n// slice the array into a Go slice, with the same backing array\n// as theCArray, making sure to specify the capacity as well as\n// the length.\nslice := arrayPtr[:length:length]\n</code></pre>\n"}], "owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 3, "accepted_answer_id": 48756785, "answer_count": 1, "score": 5, "last_activity_date": 1611843769, "creation_date": 1518475272, "question_id": 48756732, "link": "https://stackoverflow.com/questions/48756732/what-does-1-30c-yourtype-do-exactly-in-cgo", "title": "What does (*[1 &lt;&lt; 30]C.YourType) do exactly in CGo?", "body": "<p>In the <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"noreferrer\">Golang wiki</a>, under \"Turning C arrays into Go slices\", there is a block of code that demonstrates how to create a Go slice backed by a C array.</p>\n\n<pre><code>import \"C\"\nimport \"unsafe\"\n...\n        var theCArray *C.YourType = C.getTheArray()\n        length := C.getTheArrayLength()\n        slice := (*[1 &lt;&lt; 30]C.YourType)(unsafe.Pointer(theCArray))[:length:length]\n</code></pre>\n\n<p>Can anyone explain exactly what <code>(*[1 &lt;&lt; 30]C.YourType)</code> does? How does it turn an <code>unsafe.Pointer</code> into a Go slice?</p>\n"}, {"tags": ["go", "aws-sdk"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518464564, "post_id": 48754277, "comment_id": 84509291, "body": "If an import vendors dependencies, you also need to correctly vendor your dependencies."}, {"owner": {"reputation": 1814, "user_id": 4224424, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JryrwR0jfpA/AAAAAAAAAAI/AAAAAAAAAM0/iCQTbP_aHt4/photo.jpg?sz=128", "display_name": "Pavan Ravipati", "link": "https://stackoverflow.com/users/4224424/pavan-ravipati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518470659, "post_id": 48754277, "comment_id": 84512451, "body": "@JimB apologies but I&#39;m a Go newbie...how would I go about doing that? I tried adding <code>state&#47;</code> to my <code>vendor&#47;</code> folder but that didn&#39;t seem to make a difference."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518470943, "post_id": 48754277, "comment_id": 84512590, "body": "One normally uses dependency management tools like <code>dep</code>, <code>govendor</code>, <code>glide</code>, etc (the selection and use of which is off topic). If this is just for local experimentation, everything <i>might</i> run off the current versions if you remove the <code>vendor&#47;</code> folder entirely."}, {"owner": {"reputation": 1814, "user_id": 4224424, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JryrwR0jfpA/AAAAAAAAAAI/AAAAAAAAAM0/iCQTbP_aHt4/photo.jpg?sz=128", "display_name": "Pavan Ravipati", "link": "https://stackoverflow.com/users/4224424/pavan-ravipati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518484013, "post_id": 48754277, "comment_id": 84517034, "body": "@JimB hmmm removing <code>vendor&#47;</code> didn&#39;t quite do it"}, {"owner": {"reputation": 1814, "user_id": 4224424, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JryrwR0jfpA/AAAAAAAAAAI/AAAAAAAAAM0/iCQTbP_aHt4/photo.jpg?sz=128", "display_name": "Pavan Ravipati", "link": "https://stackoverflow.com/users/4224424/pavan-ravipati"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518486202, "post_id": 48754277, "comment_id": 84517518, "body": "ended up following this guide to setting up a go dev environment: <a href=\"https://skife.org/golang/2013/03/24/go_dev_env.html\" rel=\"nofollow noreferrer\">skife.org/golang/2013/03/24/go_dev_env.html</a>, which is doing the trick!"}], "owner": {"reputation": 1814, "user_id": 4224424, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JryrwR0jfpA/AAAAAAAAAAI/AAAAAAAAAM0/iCQTbP_aHt4/photo.jpg?sz=128", "display_name": "Pavan Ravipati", "link": "https://stackoverflow.com/users/4224424/pavan-ravipati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518464465, "creation_date": 1518464465, "question_id": 48754277, "link": "https://stackoverflow.com/questions/48754277/go-dependency-typerror-when-building-locally-with-go-get", "title": "go dependency typerror when building locally with `go get`", "body": "<p>Here's a simplified version of my file structure</p>\n\n<pre><code>\u251c\u2500\u2500 honeyelb\n|   \u2514\u2500\u2500 main.go\n\u251c\u2500\u2500 state\n|   \u2514\u2500\u2500 state.go\n\u2514\u2500\u2500 vendor\n    \u2514\u2500\u2500 ...\n</code></pre>\n\n<p>Both <code>honeyelb/main.go</code> and <code>state/main.go</code> are importing the same <code>aws-sdk-go</code> dependency as follows:</p>\n\n<pre><code>import (\n    ...\n    \"github.com/aws/aws-sdk-go/aws/session\"\n)\n</code></pre>\n\n<p>Additionally, <code>honeyelb/main.go</code> imports <code>state/state.go</code> as a dependency as follows:</p>\n\n<pre><code>import (\n  ...\n  \"github.com/honeycombio/honeyaws/state\"\n)\n</code></pre>\n\n<p>When I use <code>go get github.com/honeycombio/honeyaws/cmd/honeyelb</code> the tool installs fine, and there's no complaints about dependencies.</p>\n\n<p>The problem is when I try to <code>go build honeyelb/main.go</code> locally; I can see that <code>honeyelb/main.go</code> and <code>state/state.go</code> are pulling the <code>aws/session</code> dependency from different locations:</p>\n\n<blockquote>\n  <p>cmd/honeyelb2/main.go:99:41: cannot use sess (type\n  *\"github.com/aws/aws-sdk-go/aws/session\".Session) as type *\"github.com/honeycombio/honeyaws/vendor/github.com/aws/aws-sdk-go/aws/session\".Session\n  in argument to state.NewDynamoDBStater</p>\n</blockquote>\n\n<p>How do I get them to both build from the dependencies in <code>vendor/</code>?</p>\n"}, {"tags": ["python", "django", "excel", "go", "uwsgi"], "answers": [{"comments": [{"owner": {"reputation": 17319, "user_id": 3124746, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/0ihpR.jpg?s=128&g=1", "display_name": "vishes_shell", "link": "https://stackoverflow.com/users/3124746/vishes-shell"}, "edited": false, "score": 0, "creation_date": 1518465939, "post_id": 48754446, "comment_id": 84510050, "body": "Thanks for the reply. I don&#39;t want to separate this library from main application. I don&#39;t want to create another process for this small Go library to be listened by nginx and handling authentication and stuff."}, {"owner": {"reputation": 426, "user_id": 1182721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20f3f1dc553f33f198493f9061a0ac97?s=128&d=identicon&r=PG", "display_name": "Lu.nemec", "link": "https://stackoverflow.com/users/1182721/lu-nemec"}, "reply_to_user": {"reputation": 17319, "user_id": 3124746, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/0ihpR.jpg?s=128&g=1", "display_name": "vishes_shell", "link": "https://stackoverflow.com/users/3124746/vishes-shell"}, "edited": false, "score": 0, "creation_date": 1518505815, "post_id": 48754446, "comment_id": 84522849, "body": "Well, in that case, try to run the Go library in its own uWSGI process, but one set to have only 1 worker. I&#39;m not sure how Go&#39;s runtime would work with uWSGI worker management. Also it should not use worker threads but processes, since Go handles its own threads."}], "tags": [], "owner": {"reputation": 426, "user_id": 1182721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20f3f1dc553f33f198493f9061a0ac97?s=128&d=identicon&r=PG", "display_name": "Lu.nemec", "link": "https://stackoverflow.com/users/1182721/lu-nemec"}, "is_accepted": false, "score": 1, "last_activity_date": 1518465076, "creation_date": 1518465076, "answer_id": 48754446, "question_id": 48753818, "link": "https://stackoverflow.com/questions/48753818/uwsgi-builded-go-so-not-working/48754446#48754446", "title": "uWSGI + builded Go .so not working", "body": "<p>Firstly, are you absolutely positive you need to call Go as a library from uWSGI process?</p>\n\n<p>uWSGI are usually for interpreted languages such as PHP, Python, Ruby and others. It bootstraps the interpreter and manages the master/worker processes to handle requests. It seems strange to be using it on Go library.</p>\n\n<p>You mentioned having nginx as your webserver, why not just use your Go program as the http server (which it does great) and call it from nginx directly using it's URL:</p>\n\n<pre><code>location /name/ {\n    proxy_pass http://127.0.0.1/go_url/;\n}\n</code></pre>\n\n<p><a href=\"https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass\" rel=\"nofollow noreferrer\">See nginx docs.</a></p>\n\n<p>If you really want to use Go as a python imported library via a .so module, you have to be aware Go has its own runtime, thread management and may not work well with uWSGI which handles threads/processes in a different way. In this case I'm unable to help you, since I never actually tried this.</p>\n\n<p>If you could clarify your question with what are you actually tring to do, we might me able to answer more helpfully.</p>\n"}, {"tags": [], "owner": {"reputation": 17319, "user_id": 3124746, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/0ihpR.jpg?s=128&g=1", "display_name": "vishes_shell", "link": "https://stackoverflow.com/users/3124746/vishes-shell"}, "is_accepted": true, "score": 0, "last_activity_date": 1519245668, "creation_date": 1519245668, "answer_id": 48915060, "question_id": 48753818, "link": "https://stackoverflow.com/questions/48753818/uwsgi-builded-go-so-not-working/48915060#48915060", "title": "uWSGI + builded Go .so not working", "body": "<h2>Attempts and thoughts</h2>\n\n<p>I tried to avoid separation of shared library from my python code, since it requires support of at least one more process, and i would have to rewrite some of the library to create new api.</p>\n\n<p>As <a href=\"https://stackoverflow.com/a/48754446/3124746\">@Lu.nemec</a> kindly noted that: </p>\n\n<blockquote>\n  <p>Go has its own runtime, thread management and may not work well with uWSGI which handles threads/processes in a different way</p>\n</blockquote>\n\n<p>Since uWSGI is the problem i started seaching for a solution there. One of the hopes was installing <a href=\"http://uwsgi-docs.readthedocs.io/en/latest/GCCGO.html\" rel=\"nofollow noreferrer\">GCCGO uWSGI plugin</a> somehow solve that problem. But even it's hard to install on old OSes, because it lacks of pre-builded plugins and manual build haven't gone very well, it haven't helped, nothing changes, it still freezes.</p>\n\n<p>And then i thought that i wan't to disable coroutines and that type of stuff that differs from uWSGI and one of the changes that i am able to do is to set <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\"><code>GOMAXPROCS</code></a></p>\n\n<blockquote>\n  <p><code>GOMAXPROCS</code> sets the maximum number of CPUs that can be executing simultaneously and returns the previous setting. If n &lt; 1, it does not change the current setting. The number of logical CPUs on the local machine can be queried with NumCPU. This call will go away when the scheduler improves.</p>\n</blockquote>\n\n<p>And it worked like a charm!!!</p>\n\n<h2>The solution</h2>\n\n<pre><code>import (\n    ...\n    \"runtime\"\n)\n...\n//export yourFunc\nfunc yourFunc(yourArgs argType) {\n    runtime.GOMAXPROCS(1)\n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17319, "user_id": 3124746, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/0ihpR.jpg?s=128&g=1", "display_name": "vishes_shell", "link": "https://stackoverflow.com/users/3124746/vishes-shell"}, "is_accepted": false, "score": 0, "last_activity_date": 1520159644, "creation_date": 1520159644, "answer_id": 49094421, "question_id": 48753818, "link": "https://stackoverflow.com/questions/48753818/uwsgi-builded-go-so-not-working/49094421#49094421", "title": "uWSGI + builded Go .so not working", "body": "<p>My <a href=\"https://stackoverflow.com/a/48915060/3124746\">previous answer</a> works in some cases. HOWEVER, when i tried to run the same project on another server with same OS, same Python, same uWSGI (version, plugins, config files), same requirements, same .so file, it freezed the save way as i described in answer.</p>\n\n<p>I personally didn't want to run this as separate process and bind it to socket/port and create API for communicating with shared library. </p>\n\n<h2>The solution:</h2>\n\n<p>Required only separate process. Run with <code>celery</code>.</p>\n\n<h2>Some caveats:</h2>\n\n<p>1.You cannot run task with <code>task.apply()</code> since it would be run in main application, not in <code>celery</code>:</p>\n\n<pre><code>result = task.apply_async()\nwhile result.ready():\n    time.wait(5)\n</code></pre>\n\n<p>2.You neeed to run <code>celery</code> with <a href=\"http://docs.celeryproject.org/en/latest/internals/reference/celery.concurrency.solo.html\" rel=\"nofollow noreferrer\"><code>solo</code></a> execution pool</p>\n\n<pre><code>celery -A app worker -P solo\n</code></pre>\n"}], "owner": {"reputation": 17319, "user_id": 3124746, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/0ihpR.jpg?s=128&g=1", "display_name": "vishes_shell", "link": "https://stackoverflow.com/users/3124746/vishes-shell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 48915060, "answer_count": 3, "score": 0, "last_activity_date": 1520159644, "creation_date": 1518462752, "last_edit_date": 1518466125, "question_id": 48753818, "link": "https://stackoverflow.com/questions/48753818/uwsgi-builded-go-so-not-working", "title": "uWSGI + builded Go .so not working", "body": "<p><strong>Problem</strong>: .so(shared object) as library in python works well when <code>python</code> calls it and fails in uWSGI-running python(Django) application.</p>\n\n<p><strong>More info</strong>: I've build Go module with <code>go build -buildmode=c-shared -o output.so input.go</code> to call it in Python with</p>\n\n<pre><code>from ctypes import cdll\n\nlib = cdll.LoadLibrary('path_to_library/output.so')\n</code></pre>\n\n<p>When django project is served via uWSGI the request handler that calling <em>Go library</em> freezes, causing future 504 in Nginx. After getting in \"so called freeze\", uWSGI is locked there and only restarting helps to enliven app. No logs AT ALL! It just freezes.</p>\n\n<p><strong>Everything works correctly when i run in python interpreter</strong> on the same machine.</p>\n\n<p><em>My thoughts</em>: i've tried to debug this and put a lot of log messages in library, but it won't give much info because everything is fine with library(because it works in interpreter). Library loads correctly, because some log messages that i've putted in library. I think it some sort of uWSGI limitation. I don't think putting uwsgi.ini file is somehow helpful.</p>\n\n<h3>Additional info:</h3>\n\n<ul>\n<li><p><em>Go dependencies</em>:</p>\n\n<ul>\n<li><code>fmt</code></li>\n<li><a href=\"https://github.com/360EntSecGroup-Skylar/excelize\" rel=\"nofollow noreferrer\"><code>github.com/360EntSecGroup-Skylar/excelize</code></a></li>\n<li><code>log</code></li>\n<li><code>encoding/json</code></li>\n</ul></li>\n<li><p>OS: CentOS 6.9</p></li>\n<li><p>Python: Python 3.6.2</p></li>\n<li><p>uWSGI: 2.0.15</p></li>\n</ul>\n\n<p>What limitations can be in uWSGI in that type of shared object work and if there a way to overcome them?</p>\n"}, {"tags": ["go", "struct", "compiler-optimization"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1518460503, "post_id": 48753195, "comment_id": 84507065, "body": "That&#39;s not an &quot;optimization&quot;, it&#39;s padding and alignment. See <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Size_and_alignment_guarantees</a>"}, {"owner": {"reputation": 329, "user_id": 8053307, "user_type": "registered", "profile_image": "https://graph.facebook.com/306305043125716/picture?type=large", "display_name": "dfek", "link": "https://stackoverflow.com/users/8053307/dfek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518461226, "post_id": 48753195, "comment_id": 84507469, "body": "By saying optimization, I&#39;m talking about rearranging the fields order."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1518461284, "post_id": 48753195, "comment_id": 84507509, "body": "You can&#39;t rearrange the fields of a struct, because it&#39;s no longer the same struct. A struct implies a certain memory layout."}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 1, "creation_date": 1518487115, "post_id": 48753195, "comment_id": 84517718, "body": "&quot;Isn&#39;t something that the compiler can detect and optimize? (rearrange the fields order)&quot;, I don&#39;t think Go compiler can do this at this point, but it something a compiler can do. Rust compiler can do it: <a href=\"https://blog.rust-lang.org/2017/06/08/Rust-1.18.html\" rel=\"nofollow noreferrer\">blog.rust-lang.org/2017/06/08/Rust-1.18.html</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1518514952, "post_id": 48753195, "comment_id": 84527800, "body": "@Akavall, \u2026that is, unless you actually do not want it to rearrange stuff\u2014say, to communicating with non-Go code. Which leads us to the wonderful world of pragmas etc which are unlikely to be implemented in Go, I reckon."}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1518463867, "post_id": 48753237, "comment_id": 84508974, "body": "Maybe replace the second row of printfs with <code>fmt.Printf(&quot;%d %d %d\\n&quot;, unsafe.Offsetof(a.x), unsafe.Offsetof(a.y), unsafe.Offsetof(a.z))</code> ?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518515015, "post_id": 48753237, "comment_id": 84527843, "body": "I&#39;d also recommend to the OP to read <a href=\"https://dave.cheney.net/2015/10/09/padding-is-hard\" rel=\"nofollow noreferrer\">this</a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 9, "last_activity_date": 1518466014, "last_edit_date": 1518466014, "creation_date": 1518460506, "answer_id": 48753237, "question_id": 48753195, "link": "https://stackoverflow.com/questions/48753195/why-these-two-structs-have-different-size-in-the-memory/48753237#48753237", "title": "Why these two structs have different size in the memory?", "body": "<p>Padding due to alignment.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"noreferrer\">Size and alignment guarantees</a></p>\n  \n  <p>For the numeric types, the following sizes are guaranteed:</p>\n\n<pre><code>type                                 size in bytes\n\nbyte, uint8, int8                     1\nuint16, int16                         2\nuint32, int32, float32                4\nuint64, int64, float64, complex64     8\ncomplex128                           16\n</code></pre>\n  \n  <p>The following minimal alignment properties are guaranteed:</p>\n  \n  <ul>\n  <li><p>For a variable x of any type: unsafe.Alignof(x) is at least 1.</p></li>\n  <li><p>For a variable x of struct type: unsafe.Alignof(x) is the largest of all the values unsafe.Alignof(x.f) for each field f of x, but at least\n  1.</p></li>\n  <li>For a variable x of array type: unsafe.Alignof(x) is the same as the alignment of a variable of the array's element type.</li>\n  </ul>\n  \n  <p>A struct or array type has size zero if it contains no fields (or\n  elements, respectively) that have a size greater than zero. Two\n  distinct zero-size variables may have the same address in memory.</p>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype A struct {\n    x int8\n    y int16\n    z bool\n}\n\ntype B struct {\n    x int8\n    y bool\n    z int16\n}\n\nfunc main() {\n    var a A\n    fmt.Println(\"A:\")\n    fmt.Println(\"Size:   \", unsafe.Sizeof(a))\n    fmt.Printf(\"Address: %p %p %p\\n\", &amp;a.x, &amp;a.y, &amp;a.z)\n    fmt.Printf(\"Offset:  %d %d %d\\n\", unsafe.Offsetof(a.x), unsafe.Offsetof(a.y), unsafe.Offsetof(a.z))\n    fmt.Println()\n    var b B\n    fmt.Println(\"B:\")\n    fmt.Println(\"Size:   \", unsafe.Sizeof(b))\n    fmt.Printf(\"Address: %p %p %p\\n\", &amp;b.x, &amp;b.y, &amp;b.z)\n    fmt.Printf(\"Offset:  %d %d %d\\n\", unsafe.Offsetof(b.x), unsafe.Offsetof(b.y), unsafe.Offsetof(b.z))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/_8yDMungDg0\" rel=\"noreferrer\">https://play.golang.org/p/_8yDMungDg0</a></p>\n\n<p>Output:</p>\n\n<pre><code>A:\nSize:    6\nAddress: 0x10410020 0x10410022 0x10410024\nOffset:  0 2 4\n\nB:\nSize:    4\nAddress: 0x10410040 0x10410041 0x10410042\nOffset:  0 1 2\n</code></pre>\n\n<hr>\n\n<p>You may be matching an external <code>struct</code>, perhaps in another language. It's up to you to tell the compiler what you want. The compiler doesn't guess.</p>\n"}], "owner": {"reputation": 329, "user_id": 8053307, "user_type": "registered", "profile_image": "https://graph.facebook.com/306305043125716/picture?type=large", "display_name": "dfek", "link": "https://stackoverflow.com/users/8053307/dfek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 1, "accepted_answer_id": 48753237, "answer_count": 1, "score": 5, "last_activity_date": 1518500365, "creation_date": 1518460365, "last_edit_date": 1518500365, "question_id": 48753195, "link": "https://stackoverflow.com/questions/48753195/why-these-two-structs-have-different-size-in-the-memory", "title": "Why these two structs have different size in the memory?", "body": "<p>Suppose I have these two structs:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype A struct {\n    int8\n    int16\n    bool\n}\n\ntype B struct {\n    int8\n    bool\n    int16\n}\n\nfunc main() {\n    fmt.Println(unsafe.Sizeof(A{}), unsafe.Sizeof(B{})) // 6 4\n}\n</code></pre>\n\n<p>Size of <code>A</code> is 6 bytes. however, the size of <code>B</code> is 4 bytes.<br>\nI assume that it's related to their layout in the memory, but I'm not sure I understand why it's behave like this.<br>\nIsn't something that the compiler can detect and optimize? (rearrange the fields order)</p>\n\n<p><a href=\"https://play.golang.org/p/204xci7QlXS\" rel=\"nofollow noreferrer\">Link to the code</a></p>\n"}, {"tags": ["go", "specifications", "openapi"], "comments": [{"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 1, "creation_date": 1518469401, "post_id": 48752908, "comment_id": 84511897, "body": "I have not used this library but the _test code, e.g. <a href=\"https://github.com/go-openapi/validate/blob/master/example_validator_test.go\" rel=\"nofollow noreferrer\">github.com/go-openapi/validate/blob/master/&hellip;</a>  is written at a higher level of abstraction than the above and looks worth modeling. Re: guidelines- these are here: <a href=\"https://github.com/go-openapi/validate/blob/master/.github/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">github.com/go-openapi/validate/blob/master/.github/&hellip;</a>. These have more to do with submitting PRs than asking questions. Looks like they have a slack at: <a href=\"https://github.com/go-openapi/validate/blob/master/.github/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">github.com/go-openapi/validate/blob/master/.github/&hellip;</a>, which might be a more fluid forum for asking questions."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1518527314, "post_id": 48752908, "comment_id": 84535424, "body": "Thanks Il take a look."}, {"owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "edited": false, "score": 0, "creation_date": 1518605165, "post_id": 48752908, "comment_id": 84571815, "body": "@MatiasBarrios Do you have any <code>swagger.json</code> file or this kind of any file?"}], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1518698298, "post_id": 48804996, "comment_id": 84617718, "body": "Thanks Ill give it a try."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1520873458, "post_id": 48804996, "comment_id": 85484574, "body": "I got my schema from here : <a href=\"https://github.com/OAI/OpenAPI-Specification/blob/master/schemas/v2.0/schema.json\" rel=\"nofollow noreferrer\">github.com/OAI/OpenAPI-Specification/blob/master/schemas/v2.&zwnj;&#8203;0/&hellip;</a> But when I try to use it on your sample code, I get : Failed to expand spec panic: runtime error: invalid memory address or nil pointer dereference. What would that be? @hypnoglow"}], "tags": [], "owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "is_accepted": true, "score": 13, "last_activity_date": 1518690598, "creation_date": 1518690598, "answer_id": 48804996, "question_id": 48752908, "link": "https://stackoverflow.com/questions/48752908/openapi-spec-validation-in-golang/48804996#48804996", "title": "OpenAPI spec validation in Golang", "body": "<p>I use <a href=\"https://github.com/go-openapi\" rel=\"noreferrer\">https://github.com/go-openapi</a> quite a lot and find that packages very useful to work with OpenAPI spec, validations and other related stuff.</p>\n\n<h2>Validate the spec itself</h2>\n\n<p>Take a look at the following code:</p>\n\n<pre><code>document, err = loads.Spec(fpath)\nif err != nil {\n    return nil, errors.Wrap(err, \"Failed to load spec\")\n}\n\ndocument, err = document.Expanded(&amp;spec.ExpandOptions{RelativeBase: fpath})\nif err != nil {\n    return nil, errors.Wrap(err, \"Failed to expand spec\")\n}\n\nif err := validate.Spec(document, strfmt.Default); err != nil {\n    return nil, errors.Wrap(err, \"Spec is invalid\")\n}\n</code></pre>\n\n<p>First of all, it loads spec. Then it expands all references (<code>$ref</code>-s) in that spec. After that it validates the spec itself.</p>\n\n<h2>Validate by spec</h2>\n\n<p>So the spec itself is correct. Now we want to validate, for example, a request body by that spec.</p>\n\n<pre><code>// sch here is the schema object that can be extracted from\n// the spec that you created above.\n\n// data is just an interface{} that represents your data\n// structure that you need to validate. data is a struct\n// you decoded a json body into like json.Unmarshal(b, &amp;data)\n\nerr := validate.AgainstSchema(sch, data, strfmt.Default)\nve, ok := err.(*errors.CompositeError)\n\n// now you can extract errors from ve.Errors\n</code></pre>\n\n<p>I've build <a href=\"https://github.com/hypnoglow/oas2/blob/master/validate/validate.go#L14\" rel=\"noreferrer\">some wrappers</a> around it for easy request validations, for example:</p>\n\n<pre><code>// op here is the OpenAPI operation object that can also be extracted\n// from the spec loaded above.\nif errs := validate.Body(op.Parameters, body); len(errs) &gt; 0 {\n    // work with errs\n}\n</code></pre>\n\n<hr>\n\n<p><em>Disclaimer: Some links above lead to the repository <a href=\"https://github.com/hypnoglow/oas2\" rel=\"noreferrer\">oas2</a> where I am an author and a maintainer. That repository is build on top of <a href=\"https://github.com/go-openapi\" rel=\"noreferrer\">go-openapi</a> where I am not the author.</em></p>\n"}, {"tags": [], "owner": {"reputation": 5117, "user_id": 337735, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5a4803c2f31a4f0e53705287430a6e3d?s=128&d=identicon&r=PG", "display_name": "Cody A. Ray", "link": "https://stackoverflow.com/users/337735/cody-a-ray"}, "is_accepted": false, "score": 1, "last_activity_date": 1585781541, "creation_date": 1585781541, "answer_id": 60981557, "question_id": 48752908, "link": "https://stackoverflow.com/questions/48752908/openapi-spec-validation-in-golang/60981557#60981557", "title": "OpenAPI spec validation in Golang", "body": "<p>I've found that <a href=\"https://github.com/getkin/kin-openapi\" rel=\"nofollow noreferrer\">kin-openapi</a> provided the closest thing to the level of abstraction I was looking for. That is, I just want validate my http request and response against the spec, without breaking it into parts (query params, path params, body, etc). Its not <em>quite</em> to this level of abstraction, but I have an open PR. Not sure if it'll be accepted, but its a good starting point for your own adventures, nonetheless!</p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4144, "favorite_count": 4, "accepted_answer_id": 48804996, "answer_count": 2, "score": 8, "last_activity_date": 1590398316, "creation_date": 1518459255, "last_edit_date": 1564976719, "question_id": 48752908, "link": "https://stackoverflow.com/questions/48752908/openapi-spec-validation-in-golang", "title": "OpenAPI spec validation in Golang", "body": "<p>I want to validate an openapi spec in a similar fashion as its done here : <a href=\"http://bigstickcarpet.com/swagger-parser/www/index.html\" rel=\"noreferrer\">http://bigstickcarpet.com/swagger-parser/www/index.html</a> but the difference is that Ill use GO to code the tool and its only a CLI.</p>\n\n<p>I am trying to use this :</p>\n\n<p><a href=\"https://github.com/go-openapi/validate\" rel=\"noreferrer\">https://github.com/go-openapi/validate</a></p>\n\n<p>But the main problem is that the documentation is almost non existent. I came here looking for help of someone that might previously used this library and can give me a MINIMAL example of sending a file containing a spec like such and having this library to throw all the errors or warnings in a similar fashion to the online Swagger validator.</p>\n\n<p>I already can read a file and do some manual validation of the fields on it but of course thats not what I need to do and its just a sample.</p>\n\n<p>Additionally, as a secondary question, I want to post this same question on their GitHub repo but I get this : </p>\n\n<p><a href=\"https://i.stack.imgur.com/Sk8wQ.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Sk8wQ.png\" alt=\"enter image description here\"></a></p>\n\n<p>and I have no idea how to \"review\" these guidelines so I can post my question.</p>\n\n<h3>What I have :</h3>\n\n<pre><code>func validate_spec(spec string) []validator_error {\n    // RULES HERE. Now I am hardcoding since this is just a dummy app. On the real app we will need to use goapenapi plus a schema validator\n    var errors []validator_error\n    name_regex, _ := regexp.Compile(\"^[a-zA-Z]+[ ][a-zA-Z]+\")\n\n    // Validate _.name field\n        if ( ! gjson.Get(spec, \"name\").Exists() ) {\n            n := validator_error{Path: \"_.name\", Message: \"Does not exist!\"}\n            errors = append(errors,n)\n        }\n\n        if gjson.Get(spec, \"name\").Exists() {\n            if _, ok := gjson.Get(spec, \"name\").Value().(string); !ok {\n                n := validator_error{Path: \"_.name\", Message: \"should be a string\"}\n                errors = append(errors,n)\n            }\n            if ( ! name_regex.MatchString(gjson.Get(spec, \"name\").String() ) ) {\n                n := validator_error{Path: \"_.name\", Message: \"should match \" + name_regex.String()}\n                errors = append(errors,n)\n            }\n        }\n    // ***************************\n\n    // Validate _.age field\n        if ( ! gjson.Get(spec, \"age\").Exists() ) {\n            n := validator_error{Path: \"_.age\", Message: \"Does not exist!\"}\n            errors = append(errors,n)\n        }\n        if gjson.Get(spec, \"age\").Exists() {\n            if _, ok := gjson.Get(spec, \"age\").Value().(float64); !ok {\n                n := validator_error{Path: \"_.age\", Message: \"should be an int\"}\n                errors = append(errors,n)\n            }\n\n        }\n    // ***************************\n    return errors\n}\n</code></pre>\n\n<h3>What I need :</h3>\n\n<pre><code>func validate_spec(spec string) []validator_error {\n        // Something like this is what I am looking for. On the above example I am just hard-coding some dummy rules. I need to use the library here to get the validity of the spec being passed.\n        return goopenapi.validate(spec )\n    }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1518454052, "post_id": 48751284, "comment_id": 84503356, "body": "Btw should I keep the if statement ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1518454863, "post_id": 48751284, "comment_id": 84503908, "body": "No need since it&#39;s not being used. That said, I recommend you take the time to understand what this code does if you want to make it do something different."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1518453461, "creation_date": 1518453461, "answer_id": 48751284, "question_id": 48751091, "link": "https://stackoverflow.com/questions/48751091/zip-content-inside-folder-without-the-root-folder/48751284#48751284", "title": "Zip content inside folder without the root folder", "body": "<p>Assuming you are calling your function as follows:</p>\n\n<pre><code>Zipit(\"dir1/\", \"dir1.zip\") \n</code></pre>\n\n<p>All you need to do is remove the <code>baseDir</code> that is being added to the filename inside the archive.</p>\n\n<p>You currently have the following code:</p>\n\n<pre><code>if baseDir != \"\" {\n        header.Name = filepath.Join(baseDir, strings.TrimPrefix(path, source))\n}\n</code></pre>\n\n<p><code>baseDir</code> here is <code>dir1</code>.</p>\n\n<p>Simply omit the <code>baseDir</code> (but to keep trimming the prefix):</p>\n\n<pre><code>header.Name = strings.TrimPrefix(path, source)\n</code></pre>\n\n<p>This is very similar to <a href=\"https://stackoverflow.com/questions/48732412/unzip-artifacts-with-different-name\">Unzip artifacts with different name</a> where all you need to do is modify <code>header.Name</code> as you see fit. It sounds like you need to examine the various <code>filepath</code> functions to see how they can help you.</p>\n"}], "owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 1, "accepted_answer_id": 48751284, "answer_count": 1, "score": 0, "last_activity_date": 1518460059, "creation_date": 1518452877, "last_edit_date": 1518460059, "question_id": 48751091, "link": "https://stackoverflow.com/questions/48751091/zip-content-inside-folder-without-the-root-folder", "title": "Zip content inside folder without the root folder", "body": "<p>I want to zip some directory inside content into zip file</p>\n\n<p>e.g. assume i\u2019ve this directory structure</p>\n\n<pre><code>dir1\n  file1.html\n  file2.go\n</code></pre>\n\n<p>Now I want to zip it to <code>dir1.zip</code> which is working</p>\n\n<p>when I extract it I got the same structure...\nI want to zip the <strong>content inside</strong> that when I unzip it I get the files inside  without the `dir1' folder as root after extracting it</p>\n\n<pre><code>file1.html\nfile2.go\n</code></pre>\n\n<p>I try to play with the path\u2019s with this code and it doesn\u2019t work,\nAny idea what I miss here ?</p>\n\n<p>i've tryied </p>\n\n<pre><code>func Zipit(source, target string) error {\n    zipfile, err := os.Create(target)\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(source)\n    if err != nil {\n        return nil\n    }\n\n    var baseDir string\n    if info.IsDir() {\n        baseDir = filepath.Base(source)\n    }\n\n    filepath.Walk(source, func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(baseDir, strings.TrimPrefix(path, source))\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n        } else {\n            header.Method = zip.Deflate\n        }\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n\n\n\ndir.Zipit(\"path/dir1\" +\"/\", \"test\"+\".zip\")\n</code></pre>\n\n<p>Or maybe there is simpler way in GO to achieve this?</p>\n"}, {"tags": ["python", "go", "pickle"], "comments": [{"owner": {"reputation": 18344, "user_id": 119326, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b29825e83c1da695da0e22b4198a0105?s=128&d=identicon&r=PG", "display_name": "Cfreak", "link": "https://stackoverflow.com/users/119326/cfreak"}, "edited": false, "score": 1, "creation_date": 1518452910, "post_id": 48751071, "comment_id": 84502584, "body": "Pickle is a Python thing. I recommend using <code>json</code> instead which could then  be opened in any language."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1518452947, "post_id": 48751071, "comment_id": 84502603, "body": "The &quot;right&quot; answer is to stop using <code>pickle</code> to store the objects, and use a standard interchange format that both Python and Go support. I realize this doesn&#39;t help, though, if you already have a large amount of <code>pickle</code>d data that you need to access from Go. In that case, I would recommend writing a simple Python utility that reserializes the data first."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1518453184, "post_id": 48751071, "comment_id": 84502756, "body": "In general, it may be impossible to depickle in Go, because <code>pickle</code> is designed to serialize Python <i>objects</i>, not just data. How, for example, would you depickle a Python class in Go, with all of the Python-specific semantics that may entail?"}, {"owner": {"reputation": 3947, "user_id": 7443104, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599eeedbaf5a966b46ef5b5784741b8c?s=128&d=identicon&r=PG", "display_name": "Patwie", "link": "https://stackoverflow.com/users/7443104/patwie"}, "edited": false, "score": 0, "creation_date": 1518469710, "post_id": 48751071, "comment_id": 84512055, "body": "flatbuffers, protobuf or my favorite format msgpack do the job much better than pickle. Of course these do not help, if a pickle file <i>is</i> given."}], "answers": [{"tags": [], "owner": {"reputation": 48100, "user_id": 645551, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/3231cd5016283f6ea5963ab1dfa6e27a?s=128&d=identicon&r=PG", "display_name": "freakish", "link": "https://stackoverflow.com/users/645551/freakish"}, "is_accepted": false, "score": 4, "last_activity_date": 1518467010, "last_edit_date": 1518467010, "creation_date": 1518453113, "answer_id": 48751159, "question_id": 48751071, "link": "https://stackoverflow.com/questions/48751071/how-to-unpickle-a-python-object-in-golang/48751159#48751159", "title": "How to unpickle a python object in Golang", "body": "<p>Pickle is Python specific format. AFAIK there are no pickle-parsers outside of Python. You can try to write one for Go but you will most likely only waste lots of time and mental health. On the other hand that would be an interesting project, indeed.</p>\n\n<p>Anyway, instead of pickling use any language independent format, i.e. xml, json, google's protobuf or even a custom one, whatever suits your needs. Always pick tool for a job, never other way around.</p>\n"}, {"tags": [], "owner": {"reputation": 3947, "user_id": 7443104, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/599eeedbaf5a966b46ef5b5784741b8c?s=128&d=identicon&r=PG", "display_name": "Patwie", "link": "https://stackoverflow.com/users/7443104/patwie"}, "is_accepted": false, "score": 1, "last_activity_date": 1518470494, "creation_date": 1518470494, "answer_id": 48755702, "question_id": 48751071, "link": "https://stackoverflow.com/questions/48751071/how-to-unpickle-a-python-object-in-golang/48755702#48755702", "title": "How to unpickle a python object in Golang", "body": "<blockquote>\n  <p>Is there a way that this can be achieved?</p>\n</blockquote>\n\n<p>Depends on your understanding of <code>this</code>. There are a lot of better options than Pickle -- even in pure Python environments. If you understand <em>this</em> as exchanging data between golang and Python, you should consider the following example:</p>\n\n<p>You can serialize <em>everything</em> in Python, like</p>\n\n<p></p>\n\n<pre><code>import msgpack\nimport msgpack_numpy as m\nm.patch()\nimport numpy as np\n\ndata = {'string': 'Hello World',\n        'number': 42,\n        'matrix': np.random.randn(2, 3)}\n\nwith open('data.msgp', 'wb') as f:\n    f.write(msgpack.packb(data, use_bin_type=True))\n</code></pre>\n\n<p>Reading it is pretty simple</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// go get -u github.com/vmihailenco/msgpack\n\npackage main\n\nimport (\n    \"fmt\"\n    \"github.com/vmihailenco/msgpack\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n\n    buf, err := ioutil.ReadFile(\"data.msgp\")\n    if err != nil {\n        panic(err)\n    }\n\n    var out map[string]interface{}\n    err = msgpack.Unmarshal(buf, &amp;out)\n    if err != nil {\n        panic(err)\n    }\n\n    for k, v := range out {\n        fmt.Printf(\"key[%v] value[%v]\\n\", k, v)\n    }\n}\n</code></pre>\n\n<p>This gives you</p>\n\n<pre><code>key[matrix] value[map[data:[145 106 174 12 61 187 235 63 128 225 138 214 167 154 231 191 156 205 144 51 50 116 244 191 251 147 235 33 187 149 251 63 207 56 134 174 206 146 220 63 7 23 246 148 34 235 226 63] type:[60 102 56] \n            kind:[] nd:true shape:[2 3]]]\nkey[string] value[[72 101 108 108 111 32 87 111 114 108 100]]\nkey[number] value[42]\n</code></pre>\n\n<p>All is left is converting the byte sequences into the object you would like to have.</p>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 9456786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f04b80a588e3d707a0138782230649?s=128&d=identicon&r=PG", "display_name": "kirr", "link": "https://stackoverflow.com/users/9456786/kirr"}, "is_accepted": false, "score": 1, "last_activity_date": 1544552482, "last_edit_date": 1544552482, "creation_date": 1544197997, "answer_id": 53672882, "question_id": 48751071, "link": "https://stackoverflow.com/questions/48751071/how-to-unpickle-a-python-object-in-golang/53672882#53672882", "title": "How to unpickle a python object in Golang", "body": "<p><a href=\"https://godoc.org/github.com/kisielk/og-rek\" rel=\"nofollow noreferrer\">og\u00f3rek</a> (<a href=\"https://github.com/kisielk/og-rek\" rel=\"nofollow noreferrer\">2</a>) is Go library for decoding/encoding Python pickles.</p>\n\n<p>A pickle saved to the file can be loaded in Go as follows:</p>\n\n<pre><code>f, err := os.Open(\"Pickled_files/sample.p\")\n\nd := og\u00f3rek.NewDecoder(f)\nobj, err := d.Decode()\n</code></pre>\n"}], "owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1609, "favorite_count": 2, "answer_count": 3, "score": 0, "last_activity_date": 1544552482, "creation_date": 1518452796, "question_id": 48751071, "link": "https://stackoverflow.com/questions/48751071/how-to-unpickle-a-python-object-in-golang", "title": "How to unpickle a python object in Golang", "body": "<p>I have a python program wherein I am using Pickle to store the object using the following:</p>\n\n<pre><code>pickle.dump(sample, open( \"Pickled_files/sample.p\", \"wb\" )) \n</code></pre>\n\n<p>I can extract and unpickle this object in Python using the following:  </p>\n\n<pre><code>sample_extracted= pickle.load(open( \"Pickled_files/sample.p\", \"rb\" ))\n</code></pre>\n\n<p>However, I need to extract this object in a Golang application. Thus I need to know a way by which objects pickled using Python are extracted in Golang. </p>\n\n<p>Is there a way that this can be achieved? And if yes, I would really appreciate if someone can point me to a sample reference or example.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518452159, "post_id": 48750763, "comment_id": 84502101, "body": "You have a busy loop. There&#39;s never a reason to have a busy loop in your code."}, {"owner": {"reputation": 21, "user_id": 4894537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1w1DV.png?s=128&g=1", "display_name": "Mann King", "link": "https://stackoverflow.com/users/4894537/mann-king"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518490852, "post_id": 48750763, "comment_id": 84518453, "body": "@JimB Thank you for answering me. I have  set the maximum number of CPUs that can be executing simultaneously, the busy loop and the other goroutine should be execute simultaneously in theory. But the goroutine is not be scheduled after running for some time."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518491896, "post_id": 48750763, "comment_id": 84518652, "body": "goroutines need to be interruptable by the runtime. A busy loop with no preemption points can\u2019t be preemted, and therefore can eventually block the process. This isn\u2019t really an issue in practice, because an empty busy is a programming error, and there\u2019s no reason to have one in your code."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518457774, "post_id": 48750848, "comment_id": 84505659, "body": "Or use an empty <code>select {}</code> statement to block indefinitely."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518458004, "post_id": 48750848, "comment_id": 84505783, "body": "True, but waiting on a signal would still be preferable to an empty <code>select</code>."}, {"owner": {"reputation": 21, "user_id": 4894537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1w1DV.png?s=128&g=1", "display_name": "Mann King", "link": "https://stackoverflow.com/users/4894537/mann-king"}, "edited": false, "score": 0, "creation_date": 1518491161, "post_id": 48750848, "comment_id": 84518503, "body": "@Adrian Thank you for answering me. I also think it is a scheduler bug, but I&#39;m nor sure. And thank you for your other suggestions, it helps me."}, {"owner": {"reputation": 21, "user_id": 4894537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1w1DV.png?s=128&g=1", "display_name": "Mann King", "link": "https://stackoverflow.com/users/4894537/mann-king"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518491322, "post_id": 48750848, "comment_id": 84518538, "body": "@Peter Thank you for your another approach."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1518452175, "creation_date": 1518452175, "answer_id": 48750848, "question_id": 48750763, "link": "https://stackoverflow.com/questions/48750763/goroutine-is-not-be-scheduled-again/48750848#48750848", "title": "goroutine is not be scheduled again", "body": "<p>The dead loop will use a ton of CPU and possibly cause scheduler issues. If you want to block a goroutine, it's much more efficient to read from a channel that's never written:</p>\n\n<pre><code>ch := make(chan struct{})\n&lt;-ch\n</code></pre>\n\n<p>Or better still, set up a channel to wait for a signal to close the application:</p>\n\n<pre><code>stop := make(chan os.Signal, 1)\nsignal.Notify(stop, os.Interrupt)\n&lt;-stop\n</code></pre>\n\n<p>Also there should be no need to set <code>GOMAXPROCS</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 4894537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1w1DV.png?s=128&g=1", "display_name": "Mann King", "link": "https://stackoverflow.com/users/4894537/mann-king"}, "edited": false, "score": 1, "creation_date": 1518521854, "post_id": 48764962, "comment_id": 84532027, "body": "Oh, a wonderful answer!!! Thank you very very much! I get it from your answer. ^_^"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 2, "last_activity_date": 1519225871, "last_edit_date": 1519225871, "creation_date": 1518518838, "answer_id": 48764962, "question_id": 48750763, "link": "https://stackoverflow.com/questions/48750763/goroutine-is-not-be-scheduled-again/48764962#48764962", "title": "goroutine is not be scheduled again", "body": "<p>Goroutines are scheduled by Go runtime, therefore there are some limitations in comparison to the processes scheduling done by an operating system. An operating system can preempt processes by using timed interrupts, Go runtime cannot preempt goroutines.</p>\n\n<p>Go runtime schedules another goroutine when goroutine</p>\n\n<ul>\n<li>makes channel operation (this includes select statement, even empty)</li>\n<li>make system call</li>\n<li>explicitly calls runtime.Gosched</li>\n</ul>\n\n<p>Setting GOMAXPROCS does not help much. Take a look at following program. It will use all processors and will stay in tight busy loops.</p>\n\n<pre><code>func runForever() {\n   for {\n   }\n}\n\nfunc main() {\n    for i := 0; i &lt; runtime.GOMAXPROCS(-1); i++ {\n        go runForever()\n    }\n    time.Sleep(time.Second)\n}\n</code></pre>\n\n<p>There are few ways of fixing your program:</p>\n\n<pre><code>go func() {\n    for i:= 1; true; i++ {\n        fmt.Println(i)\n    }\n}()\n\nfor {\n    runtime.Gosched()\n}\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>go func() {\n    for i:= 1; true; i++ {\n        fmt.Println(i)\n    }\n}()\n\nselect {\n}\n</code></pre>\n\n<p>The <a href=\"https://github.com/golang/go/issues/10958\" rel=\"nofollow noreferrer\">work on improving the case of tight loops</a> is ongoing. </p>\n"}], "owner": {"reputation": 21, "user_id": 4894537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1w1DV.png?s=128&g=1", "display_name": "Mann King", "link": "https://stackoverflow.com/users/4894537/mann-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 48764962, "answer_count": 2, "score": 1, "last_activity_date": 1519225871, "creation_date": 1518451931, "last_edit_date": 1518521986, "question_id": 48750763, "link": "https://stackoverflow.com/questions/48750763/goroutine-is-not-be-scheduled-again", "title": "goroutine is not be scheduled again", "body": "<p>I'm learning golang. I have a goroutine to print variable <code>i</code> and after it I write a deadloop. But when var <code>i</code> up to <code>491519(or some other value)</code>, there is no output on the terminal. It looks like the goroutine which print var <code>i</code> is no longer be scheduled, the CPU execute the deadloop all the way after output <code>491519</code>. Who can tell me the reason?<br>\nthanks.</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n        go func() {\n                i := 1\n                for {\n                        fmt.Println(i)\n                        i = i + 1\n                }\n        }()\n        runtime.GOMAXPROCS(4)\n        for {\n        }\n}\n</code></pre>\n\n<p>I'd like to add that:<br>\nWhen I add <code>fmt.Println(\"ABC\")</code> in the last deadloop, the alternation of <code>ABC</code> or <code>i</code> output on the terminal forever.</p>\n\n<p>my go version: <code>go version go1.9.1 darwin/amd64</code></p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518445318, "post_id": 48746543, "comment_id": 84497154, "body": "The line in your test where you have <code>hf := http.HandlerFunc(getUserDetailsHandler)</code> is causing the panic, that should be clear from the stack trace that you didn&#39;t include. Now the reason it panics is because the signature of your <code>getUserDetailsHandler</code> function is different from the signare of the <code>http.HandlerFunc</code> function type. So basically you have two non-identical types and you&#39;re attempting to convert one to the other, which is impossible, therfore you get panic."}, {"owner": {"reputation": 33, "user_id": 9169015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2d3254fb0f3abd40a4b9e203f45e792?s=128&d=identicon&r=PG&f=1", "display_name": "saket", "link": "https://stackoverflow.com/users/9169015/saket"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518446657, "post_id": 48746543, "comment_id": 84498057, "body": "How could i solve this problem could you please write some code to call handler from test case. Thank you."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518446853, "post_id": 48746543, "comment_id": 84498168, "body": "<a href=\"https://play.golang.org/p/5klOkOMO3LA\" rel=\"nofollow noreferrer\">play.golang.org/p/5klOkOMO3LA</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518447105, "post_id": 48746543, "comment_id": 84498345, "body": "actually you should be able to just do this <a href=\"https://play.golang.org/p/_cFR3vyjkPr\" rel=\"nofollow noreferrer\">play.golang.org/p/_cFR3vyjkPr</a> if the function <code>store.NewWpUserInformationStore(db)</code> already returns something that uses the <code>mockStore</code> instance. But as you can see from the code samples, to avoid the panic you just wrap you handler in a function the same way you do in your code snippet at the top of your question."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1540838916, "last_edit_date": 1540838916, "creation_date": 1518518356, "answer_id": 48764772, "question_id": 48746543, "link": "https://stackoverflow.com/questions/48746543/mocking-functions-for-handler-unit-test/48764772#48764772", "title": "Mocking functions for handler unit test", "body": "<p>Use a middleware handler for generating the function. Pass a handler in your main function which will call your middleware returning <code>http.handler</code>. That way you can pass db object to your main data and which will call the middle ware returning handler.</p>\n\n<pre><code>func getUserDetailsHandler(w http.ResponseWriter, r *http.Request, db *sql.DB) http.HandlerFunc{\n\n    return func(w http.ResponseWriter, r *http.Request) {\n\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n\n        //Create UserDetailsView instance\n        var userview UserDetailsView\n\n        //Get varibale from mux\n        vars := mux.Vars(r)\n\n        //UserID  fetches userId from vars\n        userID := vars[\"userID\"]\n\n        //Get user Information by wpUsersID\n        wuis := store.NewWpUserInformationStore(db)\n        userInformation, _:= wuis.GetByID(uID)\n\n\n        json.NewEncoder(w).Encode(userview); \n\n        //Print result\n        w.WriteHeader(http.StatusOK)\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9169015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2d3254fb0f3abd40a4b9e203f45e792?s=128&d=identicon&r=PG&f=1", "display_name": "saket", "link": "https://stackoverflow.com/users/9169015/saket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 0, "accepted_answer_id": 48764772, "answer_count": 1, "score": 1, "last_activity_date": 1540838916, "creation_date": 1518438585, "last_edit_date": 1518438938, "question_id": 48746543, "link": "https://stackoverflow.com/questions/48746543/mocking-functions-for-handler-unit-test", "title": "Mocking functions for handler unit test", "body": "<p>I am stuck over testing with mocking, Here is my route for handler:</p>\n\n<pre><code>r.Handle(\"/users/{userID}\", negroni.New(\n        negroni.HandlerFunc(validateTokenMiddleware),\n        negroni.Wrap(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            getUserDetailsHandler(w, r, db)\n        })),\n    )).Methods(\"GET\")\n</code></pre>\n\n<p>And here is my handler:</p>\n\n<pre><code>func getUserDetailsHandler(w http.ResponseWriter, r *http.Request, db *sql.DB) {\n\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n\n    //Create UserDetailsView instance\n    var userview UserDetailsView\n\n    //Get varibale from mux\n    vars := mux.Vars(r)\n\n    //UserID  fetches userId from vars\n    userID := vars[\"userID\"]\n\n    //Get user Information by wpUsersID\n    wuis := store.NewWpUserInformationStore(db)\n    userInformation, _:= wuis.GetByID(uID)\n\n\n        json.NewEncoder(w).Encode(userview); \n\n        //Print result\n        w.WriteHeader(http.StatusOK)\n}\n</code></pre>\n\n<p>And i mock the function which is in store package named as <code>GetByID</code> which is looks like this :</p>\n\n<pre><code>type wpUserInfoMockStore struct {\n    mock.Mock\n}\n\nfunc (m *wpUserInfoMockStore) GetByID(user *WpUserInformation) error {\n    rets := m.Called(user)\n    return rets.Error(0)\n}\n\n//InitMockStore store\nfunc InitMockStore() *wpUserInfoMockStore {\n    s := new(wpUserInfoMockStore)\n    //store = s\n    return s\n}\n</code></pre>\n\n<p>And i write test case for handler but i got an error <code>cannot convert getUserDetailsHandler (type func(http.ResponseWriter, *http.Request, *sql.DB)) to type http.HandlerFunc</code> but i can not find why is it happened, here i'm using reference for this <code>https://github.com/sohamkamani/blog_example__go_web_db</code> and here is my test case code:</p>\n\n<pre><code>func TestGetUserDetailsTes(t *testing.T) {\n\n    // Initialize the mock store\n    mockStore := store.InitMockStore()\n\n    mockStore.On(\"GetByID\").Return([]*store.WpUserInformation{{\n        21,\n        sql.NullString{String: \"john\"},\n        sql.NullString{String: \"Sorensen\"},\n        0}}, nil).Once()\n\n    req, err := http.NewRequest(\"GET\", \"\", nil)\n\n    //if requests gives error\n    if err != nil {\n        panic(err.Error())\n    }\n\n    //parameters for generateTestUserJWT are set\n    testUser.ID = \"22\"\n    testUser.UserName = \"johns\"\n    testUser.Depot = \"NYC\"\n\n    //JWT generated\n    refToken, err := generateTestJWT(testUser, false)\n\n    //handling error while generating token\n    if err != nil {\n        panic(err.Error())\n    }\n\n    //token returned is concatenated with Bearer string\n    newToken = \"Bearer \" + refToken\n\n    //request authorization header is set\n    req.Header.Set(\"Authorization\", newToken)\n    req.Header.Set(\"Latitude\", \"123.12\")\n    req.Header.Set(\"Longitude\", \"456.45\")\n\n    //response is set\n    w := httptest.NewRecorder()\n\n    hf := http.HandlerFunc(getUserDetailsHandler)\n\n    hf.ServeHTTP(w, req)\n\n    //if response code is not statusOK then test fails\n    if w.Code != http.StatusOK {\n        t.Errorf(\"/users/{userID} GET request failed, got: %d, want: %d.\", w.Code, http.StatusOK)\n    }\n}\n</code></pre>\n\n<p>As you see i test handler without url like <code>req, err := http.NewRequest(\"GET\", \"\", nil)</code> but when i used link inside then i can not able to use mock functions, here what am i missing/fault please help me out. \nThank you.</p>\n"}, {"tags": ["csv", "go", "service", "microservices"], "answers": [{"tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": true, "score": 3, "last_activity_date": 1518430265, "last_edit_date": 1518430265, "creation_date": 1518429859, "answer_id": 48743777, "question_id": 48743105, "link": "https://stackoverflow.com/questions/48743105/parse-csv-file-from-api-request-in-go-kit-golang/48743777#48743777", "title": "Parse CSV file from API request in go-kit golang", "body": "<p>Here is a basic function that can do the parsing from a POST request. The result is a two-dimensional array of strings, the first dimension being the rows and the second dimension being the values in a row. It uses the golang's own \"encoding/csv\" package. Go playground example available <a href=\"https://play.golang.org/p/xJnXyKdwuxa\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>func ReadCSVFromHttpRequest(req *http.Request) ([][]string, error) {\n    // parse POST body as csv\n    reader := csv.NewReader(req.Body)\n    var results [][]string\n    for {\n        // read one row from csv\n        record, err := reader.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            return nil, err\n        }\n\n        // add record to result set\n        results = append(results, record)\n    }\n    return results, nil\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5002391"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2513, "favorite_count": 1, "accepted_answer_id": 48743777, "answer_count": 1, "score": 2, "last_activity_date": 1518430265, "creation_date": 1518427646, "question_id": 48743105, "link": "https://stackoverflow.com/questions/48743105/parse-csv-file-from-api-request-in-go-kit-golang", "title": "Parse CSV file from API request in go-kit golang", "body": "<p>I am trying to build a service that takes user input of file from <code>POST</code> request and then iterates the CSV and passes it into my database. I am having problem to pass the file and read it. Below are my codes.</p>\n\n<p><strong>Endpoint.go</strong></p>\n\n<pre><code>  type CSVRequest struct {\n    File  io.Reader\n\n}\n\n\nfunc MakeCSVEndpoint(svc Service) endpoint.Endpoint {\n    return func(ctx context.Context, request interface{}) (interface{}, error) {\n        req := request.(CSVRequest)\n\n        data, err := svc.ReadCSV(req.File)\n\n        if err != nil {\n            return GetErrorResponse{err}, nil\n        }\n\n        return CreateProductResponse{data}, nil\n    }\n}\n</code></pre>\n\n<p><strong>transport.go</strong></p>\n\n<pre><code>    func decodeCreateProductsCSV(_ context.Context, r *http.Request) (interface{}, error) {\n    file, _, err := r.FormFile(\"file\")\n\n    return CSVRequest{File: file}, nil\n}\n</code></pre>\n\n<p>so how can I pass the csv file to the service.go and then read and iterate the csv file and get the values of the csv file.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1518421030, "post_id": 48741255, "comment_id": 84482480, "body": "How is the (UU)ID field defined in database (ie it&#39;s data type)?"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "edited": false, "score": 0, "creation_date": 1518422364, "post_id": 48741515, "comment_id": 84483144, "body": "That\u2019s what I ended up doing as a quick fix - Reading it into a [16]byte and converting it to uuid.UUID. Is that the cleanest way to do it, bar patching the DB library (pgx)?"}], "tags": [], "owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "is_accepted": true, "score": 0, "last_activity_date": 1518421074, "creation_date": 1518421074, "answer_id": 48741515, "question_id": 48741255, "link": "https://stackoverflow.com/questions/48741255/coercing-a-db-value-into-specific-type-using-scan/48741515#48741515", "title": "Coercing a db value into specific type using Scan", "body": "<p>The errors says that you are trying to Scan a struct pointer to the UUID pointer. The struct is defined <a href=\"https://github.com/jackc/pgx/blob/master/pgtype/uuid.go#L11\" rel=\"nofollow noreferrer\">here</a>. So basically you should use this struct and Scan it into that and then convert the byte array in the struct to whatever UUID type you are using.</p>\n"}], "owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 48741515, "answer_count": 1, "score": 0, "last_activity_date": 1518421074, "creation_date": 1518419883, "question_id": 48741255, "link": "https://stackoverflow.com/questions/48741255/coercing-a-db-value-into-specific-type-using-scan", "title": "Coercing a db value into specific type using Scan", "body": "<p>I'm trying to read a UUID retrieved from Postgres, using github.com/jackc/pgx, into a variable of type uuid.UUID (From the github.com/google/uuid package).</p>\n\n<p>An example code could be:</p>\n\n<pre><code>var dbId = uuid.UUID \nerr = db.Pool.QueryRow(\"SELECT id FROM users WHERE objectname = $1;\", objectUUID.String()).Scan(&amp;dbId)\n  if err != nil {\n    log.Printf(\"Failed to fetch from database: %v\", err)\n    return\n  }\n</code></pre>\n\n<p>The quickfix is to store the dbId in a temporary variable and then later convert said temporary variable into the correct type, but I have a feeling that there is a better, or more idiomatic, way to do it.</p>\n\n<p>The error I'm getting is:</p>\n\n<pre><code>2018/02/12 07:09:18 handlers.go:187: Failed to fetch from database: can't scan into dest[1]: cannot assign &amp;{[127 122 68 237 130 120 65 78 159 189 9 188 27 48 117 88] 2} into *uuid.UUID\n</code></pre>\n"}, {"tags": ["pointers", "opengl", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1518403786, "last_edit_date": 1518403786, "creation_date": 1518403449, "answer_id": 48738854, "question_id": 48738818, "link": "https://stackoverflow.com/questions/48738818/converting-slice-into-array-pointer/48738854#48738854", "title": "Converting slice into array pointer", "body": "<p>Write:</p>\n\n<pre><code>var buffers [2]uint32\ngl.GenBuffers(int32(len(buffers)), &amp;buffers[0])\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var buffers [2]uint32\n    fmt.Printf(\"%d %p\\n\", int32(len(buffers)), &amp;buffers[0])\n    fmt.Printf(\"%T %T\\n\", int32(len(buffers)), &amp;buffers[0])\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/J-tKynWv5P1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J-tKynWv5P1</a></p>\n\n<p>Output:</p>\n\n<pre><code>2 0x10410020\nint32 *uint32\n</code></pre>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 48738854, "answer_count": 1, "score": 1, "last_activity_date": 1518419685, "creation_date": 1518403046, "last_edit_date": 1518419685, "question_id": 48738818, "link": "https://stackoverflow.com/questions/48738818/converting-slice-into-array-pointer", "title": "Converting slice into array pointer", "body": "<p>I have this bit of code,</p>\n\n<pre><code>var buffers [2]uint32\ngl.GenBuffers(2, /* What here! */)\n</code></pre>\n\n<p><em>gl.GenBuffers()</em> asks for a int32 and a *uint32. In C, you'd pass an static array or a pointer to it and all would be good, but in Golang, a slice doesn't work...</p>\n\n<p>Two ways I can think of are allocating a dynamic array, or converting the slice into a pointer array,</p>\n\n<p>Bad thing is that I don't know how to do either...\nI tried new, but it doesn't really work like malloc...\nI'm stumped and any help would be greatly appeciated!</p>\n"}, {"tags": ["json", "http", "post", "go", "payload"], "comments": [{"owner": {"reputation": 139, "user_id": 6066517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/234cc85052fc4db3ecc36283ae09b4f3?s=128&d=identicon&r=PG&f=1", "display_name": "Zahid Sumon", "link": "https://stackoverflow.com/users/6066517/zahid-sumon"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1518409371, "post_id": 48737742, "comment_id": 84478658, "body": "I have tried the following:   payload := []byte(<code>{ \t&quot;abc&quot;:xyz, \t&quot;test&quot;:&quot;test&quot;, \t}</code>) jsonPayload, _ := json.Marshal(payload) request, err := http.NewRequest(&quot;POST&quot;, url, bytes.NewBuffer(jsonPayload))  This actually works but static payload. All I want to make it dynamic."}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 10, "last_activity_date": 1518394715, "creation_date": 1518394715, "answer_id": 48737903, "question_id": 48737742, "link": "https://stackoverflow.com/questions/48737742/create-a-json-payload-in-go-lang-post-request/48737903#48737903", "title": "Create a json payload in Go Lang POST request?", "body": "<p>Use <a href=\"https://golang.org/pkg/encoding/json/#example_Marshal\" rel=\"noreferrer\"><code>Marshal</code> in the <code>encoding/json</code> package</a> of Go's standard library to encode your data as JSON.</p>\n\n<p>Signature:</p>\n\n<pre><code>func Marshal(v interface{}) ([]byte, error)\n</code></pre>\n\n<p>Example from package docs, where input data happens to be a struct type with int, string, and string slice field types:</p>\n\n<pre><code>type ColorGroup struct {\n    ID     int\n    Name   string\n    Colors []string\n}\ngroup := ColorGroup{\n    ID:     1,\n    Name:   \"Reds\",\n    Colors: []string{\"Crimson\", \"Red\", \"Ruby\", \"Maroon\"},\n}\nb, err := json.Marshal(group)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2886, "user_id": 2081835, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/4741683a91497af9910946e555ebfe0e?s=128&d=identicon&r=PG", "display_name": "TheHerk", "link": "https://stackoverflow.com/users/2081835/theherk"}, "edited": false, "score": 0, "creation_date": 1547509007, "post_id": 48740385, "comment_id": 95209532, "body": "This is not incorrect, but you should never suppress the error in the Marshal method."}], "tags": [], "owner": {"reputation": 542, "user_id": 5822368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q75QC.jpg?s=128&g=1", "display_name": "Vikram Jakhar", "link": "https://stackoverflow.com/users/5822368/vikram-jakhar"}, "is_accepted": false, "score": 7, "last_activity_date": 1518415333, "creation_date": 1518415333, "answer_id": 48740385, "question_id": 48737742, "link": "https://stackoverflow.com/questions/48737742/create-a-json-payload-in-go-lang-post-request/48740385#48740385", "title": "Create a json payload in Go Lang POST request?", "body": "<p>You can also use map for dynamically changing json payload. Below is the example code to do this.</p>\n\n<pre><code>payload := map[string]interface{}{\"id\":1, \"name\":\"zahid\"}\nbyts, _ := json.Marshal(payload)\nfmt.Println(string(byts)) // {\"id\":1,\"name\":\"zahid\"}\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 6066517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/234cc85052fc4db3ecc36283ae09b4f3?s=128&d=identicon&r=PG&f=1", "display_name": "Zahid Sumon", "link": "https://stackoverflow.com/users/6066517/zahid-sumon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12355, "favorite_count": 2, "accepted_answer_id": 48737903, "answer_count": 2, "score": 4, "last_activity_date": 1518415333, "creation_date": 1518393269, "last_edit_date": 1518407275, "question_id": 48737742, "link": "https://stackoverflow.com/questions/48737742/create-a-json-payload-in-go-lang-post-request", "title": "Create a json payload in Go Lang POST request?", "body": "<pre><code>request, err := http.NewRequest(\"POST\", url,bytes.NewBuffer(**myJsonPayload**))\n</code></pre>\n\n<p>I am new in Go and trying to make post request with dynamic '<strong>myJsonPayload</strong>', which will be changing for different request.</p>\n"}, {"tags": ["select", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 9, "creation_date": 1518386132, "post_id": 48736760, "comment_id": 84473280, "body": "You&#39;re shadowing <code>ret</code>. Use <code>case ret = &lt;-ch</code> instead."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1518388695, "post_id": 48736760, "comment_id": 84473998, "body": "Relevant: <a href=\"https://golang.org/cmd/vet/#hdr-Shadowed_variables\" rel=\"nofollow noreferrer\">golang.org/cmd/vet/#hdr-Shadowed_variables</a>"}, {"owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "edited": false, "score": 1, "creation_date": 1518406879, "post_id": 48736760, "comment_id": 84478096, "body": "don&#39;t reassgin <code>ret</code>. use <code>case ret = &lt;-ch:</code> instead of <code>case ret := &lt;-ch:</code>"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1518429525, "post_id": 48736760, "comment_id": 84487197, "body": "Why people are downvoting a valid question? Bad mood? Feeling of elitism?"}], "owner": {"reputation": 27, "user_id": 9306845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaef1424c064d44459ebca799aa38dc5?s=128&d=identicon&r=PG&f=1", "display_name": "Parker Jun", "link": "https://stackoverflow.com/users/9306845/parker-jun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518410331, "creation_date": 1518385285, "last_edit_date": 1518410331, "question_id": 48736760, "link": "https://stackoverflow.com/questions/48736760/how-to-pass-output-from-select-to-outside-of-select-at-global-scope", "title": "How to pass output from select to outside of select at global scope?", "body": "<p>I cannot pass string variable outside of a <code>select</code> statement.</p>\n\n<p>Case (simplified):</p>\n\n<p>I have a synchronous script which uses <code>select</code> with two options</p>\n\n<ol>\n<li><code>timeout</code> (3 seconds)</li>\n<li><code>default</code> which is using channel to change value of a string.</li>\n</ol>\n\n<p>When we check result of a string inside the <code>select</code> - it shows correctly.</p>\n\n<p>But once we leave the <code>select</code> statement, variable is reverted to the value it was before.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    timeout := time.After(3 * time.Second)\n    pollInt := time.Second\n\n    var ret string = \"EMPTY\"\n\nOuterLoop:\n    for {\n        select {\n        case &lt;-timeout:\n            log.Printf(\"[select][timeout] select timeout, break select and for loops\")\n            break OuterLoop\n\n        default:\n            log.Printf(\"[select][default] Processing our actions\")\n\n            ch := make(chan string, 1)\n\n            go func(ch chan string) {\n                var res string = \"NOT EMPTY\"\n                ch &lt;- res\n            }(ch)\n\n            select {\n            case ret := &lt;-ch:\n                log.Printf(\"channel has a result\")\n                log.Printf(\"showing content of string AT THE SELECT: %v\", ret)\n            case &lt;-time.After(1 * time.Second):\n                log.Printf(\"timeout\")\n\n            }\n\n        }\n        log.Printf(\"[for] Sleep for a second..\")\n        time.Sleep(pollInt)\n    }\n\n    log.Printf(\"Starting to do some important actions.. (regardless was previous actions success or timeout)\")\n    /* ... */\n\n    log.Printf(\"showing content of string: %v\", ret)\n\n    if ret == \"NOT EMPTY\" {\n        log.Printf(\"SCRIPT FINISHED CORRECTLY\")\n    } else {\n        log.Printf(\"SCRIPT FAILED\")\n    }\n\n}\n</code></pre>\n\n<p>Result of script run:</p>\n\n<pre><code>2009/11/10 23:00:00 [select][default] Processing our actions\n2009/11/10 23:00:00 channel has a result\n2009/11/10 23:00:00 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:00 [for] Sleep for a second..\n2009/11/10 23:00:01 [select][default] Processing our actions\n2009/11/10 23:00:01 channel has a result\n2009/11/10 23:00:01 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:01 [for] Sleep for a second..\n2009/11/10 23:00:02 [select][default] Processing our actions\n2009/11/10 23:00:02 channel has a result\n2009/11/10 23:00:02 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:02 [for] Sleep for a second..\n2009/11/10 23:00:03 [select][timeout] select timeout, break select and for loops\n2009/11/10 23:00:03 Starting to do some important actions.. (regardless was previous actions success or timeout)\n2009/11/10 23:00:03 showing content of string: EMPTY\n2009/11/10 23:00:03 SCRIPT FAILED\n</code></pre>\n\n<p>But I'd expect:</p>\n\n<pre><code>2009/11/10 23:00:00 [select][default] Processing our actions\n2009/11/10 23:00:00 channel has a result\n2009/11/10 23:00:00 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:00 [for] Sleep for a second..\n2009/11/10 23:00:01 [select][default] Processing our actions\n2009/11/10 23:00:01 channel has a result\n2009/11/10 23:00:01 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:01 [for] Sleep for a second..\n2009/11/10 23:00:02 [select][default] Processing our actions\n2009/11/10 23:00:02 channel has a result\n2009/11/10 23:00:02 showing content of string AT THE SELECT: NOT EMPTY\n2009/11/10 23:00:02 [for] Sleep for a second..\n2009/11/10 23:00:03 [select][timeout] select timeout, break select and for loops\n2009/11/10 23:00:03 Starting to do some important actions.. (regardless was previous actions success or timeout)\n2009/11/10 23:00:03 showing content of string: NOT EMPTY\n2009/11/10 23:00:03 SCRIPT FINISHED CORRECTLY\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/uPKZtQQkm7p\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uPKZtQQkm7p</a></p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "struct", "marshalling", "urlencode"], "comments": [{"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1521476133, "post_id": 48735329, "comment_id": 85735977, "body": "Which Format You are using for Encoded Type <code>raw- json(application&#47;json)  or www-formurlencoded</code>"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 8514922, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1c11c913243593534f968372114af90?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Ranjan", "link": "https://stackoverflow.com/users/8514922/rakesh-ranjan"}, "edited": false, "score": 0, "creation_date": 1518379507, "post_id": 48735562, "comment_id": 84471089, "body": "Thanks for this. I am new to Golang don&#39;t have time to submit PR and wait for it to get approved. Modifying server is not really possible. I am looking into another package <a href=\"https://godoc.org/github.com/google/go-querystring/query\" rel=\"nofollow noreferrer\">link</a> which has an example for marshalling nested struct in the format I want, but I can&#39;t really figure how to use it. Can you help with an example usage for this new library?"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 71, "user_id": 8514922, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1c11c913243593534f968372114af90?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Ranjan", "link": "https://stackoverflow.com/users/8514922/rakesh-ranjan"}, "edited": false, "score": 0, "creation_date": 1518380131, "post_id": 48735562, "comment_id": 84471306, "body": "@RakeshRanjan Read what you can about it, try to understand it, try using it, and if you get stuck then post a new, specific, stackoverflow-appropriate question on the part you got stuck on."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 71, "user_id": 8514922, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1c11c913243593534f968372114af90?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Ranjan", "link": "https://stackoverflow.com/users/8514922/rakesh-ranjan"}, "edited": false, "score": 1, "creation_date": 1518430279, "post_id": 48735562, "comment_id": 84487670, "body": "@Rakesh, perhaps it&#39;s easiest to just build an net/url.Values instance yourself. Looks like you only have a handful of fields anyway."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1518378675, "last_edit_date": 1518378675, "creation_date": 1518377511, "answer_id": 48735562, "question_id": 48735329, "link": "https://stackoverflow.com/questions/48735329/golang-form-encode-nested-struct/48735562#48735562", "title": "Golang form encode nested struct", "body": "<p>The <code>ajg/form</code> package isn't designed to easily do that.  <code>form.go</code> in package <code>form</code> defines constant <code>defaultDelimiter</code> to be the period/dot (<code>.</code>) rune.  That's then used in <code>encode.go</code> and <code>decode.go</code> in the same package, set as a field value in the <code>Encoder</code> struct, and then passed in as an argument in calls to methods in <code>node.go</code>.</p>\n\n<p>You can easily override the default delimiter with a different character, specified as rune <code>r</code> here:</p>\n\n<pre><code>encoder := form.NewEncoder(buf)\nencoder.DelimitWith(r)\n</code></pre>\n\n<p>Will change the delimiter from dot to whatever you specify as rune <code>r</code>.</p>\n\n<p>Going beyond that would require overriding several methods, probably by creating intermediary types with the original types embedded in them, and then defining overriding functions where needed.  For example, line 27 in <code>node.go</code>:</p>\n\n<pre><code>y.merge(d, e, p+escape(d, e, k)+string(d), vs)\n</code></pre>\n\n<p>Would have to be changed so it doesn't just concatenate the delimiter, <code>d</code>, but rather surrounds with braces (or parens, or quotes, or whatever you set it to use, as it would be best if that were configurable).</p>\n\n<p>You can get a good idea of which areas of the code need to be changed by looking at this diff from when <code>ajg</code> added support for custom delimiters and escapes: <a href=\"https://github.com/ajg/form/commit/66a87187c6cd884319abb7b97b623e9bb30e075b\" rel=\"nofollow noreferrer\">https://github.com/ajg/form/commit/66a87187c6cd884319abb7b97b623e9bb30e075b</a></p>\n\n<p>If you don't want to take on all those new types and method overrides, you could write your own code to convert the <code>ajg/form</code> package output to the format you need, or look into configuring/updating your server to recognize a single-character-delimited format.</p>\n\n<p>If a server-side fix isn't easily available, then even better would be to fork/clone the <code>ajg/form</code> repository, add optional left + right enclosing delimiter support, and submit a pull request after you get it working.</p>\n"}], "owner": {"reputation": 71, "user_id": 8514922, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b1c11c913243593534f968372114af90?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Ranjan", "link": "https://stackoverflow.com/users/8514922/rakesh-ranjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 725, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518378675, "creation_date": 1518376133, "question_id": 48735329, "link": "https://stackoverflow.com/questions/48735329/golang-form-encode-nested-struct", "title": "Golang form encode nested struct", "body": "<p>I am using <code>ajg/form</code> package to marshal my nested struct to url encoded data.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"bytes\"\n    \"github.com/ajg/form\"\n)\ntype Subject struct {\n    SubjectTag      string `form:\"tag,omitempty\"`\n    SubjectName    string `form:\"name,omitempty\"`\n}\ntype Student struct {\n    Name          string `form:\"stud_name,omitempty\"`\n    SubjectList   []Subject `form:\"subjects,omitempty\"`\n}\nfunc main() {\n    student := Student{\n        Name: \"newStudent\",\n        SubjectList: []Subject{\n            {SubjectTag:  \"mathstag\", SubjectName: \"maths\"},\n            {SubjectTag:  \"englishtag\", SubjectName: \"english\"},\n        },\n    }\n    runParse(student)\n}\nfunc runParse(i interface{}) {\n    buf := new(bytes.Buffer)\n    form.NewEncoder(buf).Encode(i)\n    body := buf.String()\n    fmt.Printf(\"Body: %#v\\n\", body) \n    // Prints Body: \"subjects.0.name=maths&amp;subjects.0.tag=mathstag&amp;subjects.1.name=english&amp;subjects.1.tag=englishtag&amp;stud_name=newStudent\"\n    //After this I create an HTTP request client, and send a POST request with this body to a server.\n}\n</code></pre>\n\n<p>Problem is my server doesn't understand dot delimited POST body, but it does understand the body in this format - <code>\"subjects[0][name]=maths&amp;subjects[0][tag]=mathstag&amp;subjects[1][name]=english&amp;subjects[1][tag]=englishtag&amp;stud_name=newStudent\"</code>, which I have tested with Postman. How can I create a body like this using above struct? Is there any other package I can use?</p>\n"}, {"tags": ["go", "text-files", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 317, "user_id": 3893444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2f955bc2d01bc8ed99917c4ba9d4afe?s=128&d=identicon&r=PG", "display_name": "ptdecker", "link": "https://stackoverflow.com/users/3893444/ptdecker"}, "edited": false, "score": 0, "creation_date": 1518447077, "post_id": 48735325, "comment_id": 84498322, "body": "Thank you, Andy.  This was exactly the problem.  Thank you for the help and education."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1518376565, "last_edit_date": 1518376565, "creation_date": 1518376124, "answer_id": 48735325, "question_id": 48735153, "link": "https://stackoverflow.com/questions/48735153/receiving-an-empty-map-with-no-errors-when-trying-to-unmarshal-a-string-read-fro/48735325#48735325", "title": "Receiving an empty map with no errors when trying to unmarshal a string read from a file (Answer: unmarshal into the data structure itself)", "body": "<p>I think you want to unmarshal into <code>tl.list</code> instead of <code>tl</code>:</p>\n\n<pre><code>err = json.Unmarshal(data[:count], &amp;tl.list)\n</code></pre>\n\n<p><code>tl</code> has no exported fields, so <code>Unmarshal</code> into <code>tl</code> won't do anything. <code>tl.list</code> (i.e., type <code>TestMap</code>) matches your data.</p>\n"}], "owner": {"reputation": 317, "user_id": 3893444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d2f955bc2d01bc8ed99917c4ba9d4afe?s=128&d=identicon&r=PG", "display_name": "ptdecker", "link": "https://stackoverflow.com/users/3893444/ptdecker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 48735325, "answer_count": 1, "score": 0, "last_activity_date": 1518447285, "creation_date": 1518375123, "last_edit_date": 1518447285, "question_id": 48735153, "link": "https://stackoverflow.com/questions/48735153/receiving-an-empty-map-with-no-errors-when-trying-to-unmarshal-a-string-read-fro", "title": "Receiving an empty map with no errors when trying to unmarshal a string read from a file (Answer: unmarshal into the data structure itself)", "body": "<p>I have a file, 'test.txt', containing the following data.  This file was created from the same structures from the code below using marshaling.</p>\n\n<pre><code>{\"VLETXGJM\":{\"attrib1\":\"test1\",\"attrib2\":\"test2\"}}\n</code></pre>\n\n<p>I am trying to read it back from the file and unmarshal it into a map using the same structures.  I can successfully read the data from the file.  I receive no errors when I try to unmarshal it into the map.  However, my map is empty.</p>\n\n<p>The mutex is used to protect the map since my real implementation (this is an extracted test) needs to use a protected map for concurrency.  I have tried this same code removing the sync library and received the same negative result.</p>\n\n<p>The test code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"sync\"\n    \"os\"\n)\n\ntype TestObject struct {\n    Attrib1 string `json:\"attrib1\"`\n    Attrib2 string `json:\"attrib2\"`\n}\n\ntype TestMap map[string]TestObject\n\ntype TestList struct {\n    sync.RWMutex\n    list TestMap\n}\n\nfunc main() {\n\n    tl := TestList{ list: make(TestMap) }\n\n    // Read the list back out of the file\n\n    fi, err := os.Open(\"test.txt\")\n\n    if os.IsNotExist(err) {\n        fmt.Println(\"data file does not exist\")\n        panic(nil)\n    }\n\n    if err != nil {\n        panic(err)\n    }\n\n    defer func() {\n        if err := fi.Close(); err != nil {\n            panic(err)\n        }\n    }()\n\n    data := make([]byte, 1024 * 1024)\n    count, err := fi.Read(data)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"read from file: \\\"%s\\\"\\n\",data[:count])\n\n    tl.Lock()\n    err = json.Unmarshal(data[:count], &amp;tl)\n    if err != nil {\n        panic(err)\n    }\n    tl.Unlock()\n\n    // List it out\n    tl.Lock()\n    if len(tl.list) == 0 {\n        fmt.Println(\"Empty list\")\n    } else {\n        for key, _ := range tl.list {\n            fmt.Printf(\"%s: %s\\n\", tl.list[key].Attrib1, tl.list[key].Attrib2)\n        }\n    }\n    tl.Unlock()\n}\n</code></pre>\n\n<p>The output of the run is:</p>\n\n<pre><code>read from file: \"{\"VLETXGJM\":{\"attrib1\":\"test1\",\"attrib2\":\"test2\"}}\"\nEmpty list\n</code></pre>\n\n<p>Thank you for your help.  I have searched for similar issues and not yet found an exact duplicate of this scenario.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "edited": false, "score": 0, "creation_date": 1518372255, "post_id": 48734636, "comment_id": 84468491, "body": "Oh i actually see the issue that i didn&#39;t loop at all which is kind of a simple mistake. How does this range queue work here? Since the channel will be filled &quot;step by step&quot; ?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "edited": false, "score": 0, "creation_date": 1518372302, "post_id": 48734636, "comment_id": 84468505, "body": "If the channel is not closed, this would block forever on an empty channel.  That is why it is important that you close the channel like you do."}, {"owner": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "edited": false, "score": 0, "creation_date": 1518372482, "post_id": 48734636, "comment_id": 84468570, "body": "thank you very much that does explain it. Didn&#39;t know that a range on a channel will be simelar to a while &quot;wait till its closed&quot;. The missing loop is obvious too."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1518371991, "creation_date": 1518371991, "answer_id": 48734636, "question_id": 48734453, "link": "https://stackoverflow.com/questions/48734453/using-a-channel-for-dispatching-tasks-to-go-routine/48734636#48734636", "title": "Using a channel for dispatching tasks to go routine", "body": "<p>You are very close.  The problem you have is you are launching 4 goroutines which all do 1 piece of work, then return.  Try this instead</p>\n\n<pre><code>for i := 0; i &lt; 4; i++ {\n    go func(queue chan string) {\n        for file := range queue {\n            exec.Command(\"some command\", file).Run()\n        }\n    }(queue)\n}\n</code></pre>\n\n<p>Once queue is closed these will return.</p>\n"}], "owner": {"reputation": 6096, "user_id": 1804251, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/XVhq3.jpg?s=128&g=1", "display_name": "BennX", "link": "https://stackoverflow.com/users/1804251/bennx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 48734636, "answer_count": 1, "score": 0, "last_activity_date": 1518371991, "creation_date": 1518370931, "question_id": 48734453, "link": "https://stackoverflow.com/questions/48734453/using-a-channel-for-dispatching-tasks-to-go-routine", "title": "Using a channel for dispatching tasks to go routine", "body": "<p>I am writing a program to render diagrams. Todo so I'm searching for all files and want to dispatch them async to go routines to process them in parallel. But I think I misunderstood the concept of channels. </p>\n\n<pre><code>files := umlFiles(\"uml\") // list of strings\n\nqueue := make(chan string)\nfor i := 0; i &lt; 4; i++ {\n    go func(queue chan string) {\n        file, ok := &lt;-queue\n        if !ok {\n            return\n        }\n\n        exec.Command(\"some command\", file).Run()\n    }(queue)\n}\nfor _, f := range files {\n    queue &lt;- f\n}\nclose(queue)\n</code></pre>\n\n<p>This will run in a deadlock after it is done with the first 4 files but never continues with the rest of the files. </p>\n\n<p>Can i use a channel to dispatch tasks to running go routines and stop them when all of the tasks are done? If so what is wrong with the code above?</p>\n\n<p>Used to get here:<br>\n<a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how-to-stop-a-goroutine</a><br>\n<a href=\"https://stackoverflow.com/questions/33035745/go-routine-deadlock-with-single-channel\">go-routine-deadlock-with-single-channel</a></p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518370326, "post_id": 48734250, "comment_id": 84467847, "body": "first of all your getting pointer to user struct so u need to pass the address to to u struct like this in <code>&amp;u</code> in your function of insert"}, {"owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518373982, "post_id": 48734250, "comment_id": 84469144, "body": "I&#39;m passing in a pointer to a user, CreateUser(u *User), so isn&#39;t the u that gets passing into c.Insert(u)  already the address of the object?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518375993, "post_id": 48734250, "comment_id": 84469853, "body": "where is <code>dao *UserDAO</code> defined in your code"}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "edited": false, "score": 0, "creation_date": 1518374234, "post_id": 48734376, "comment_id": 84469226, "body": "I figured an Object Id would be created on insertion but was not sure, thanks for clarifying. I created the &quot;poll&quot; db and the &quot;user&quot; collection. I then ran my Postman request to create the user and did a db.user.find() in the mongo shell. There was no output though so I dont think the insert worked."}, {"owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "edited": false, "score": 0, "creation_date": 1518380611, "post_id": 48734376, "comment_id": 84471448, "body": "I updated the code in the original question to include my UserDAO struct. <code>dao.session</code> is of type <code>*User</code> so that should be ok. The link I posted is essentially what my code is trying to do."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "edited": false, "score": 0, "creation_date": 1518380664, "post_id": 48734376, "comment_id": 84471468, "body": "I have tried yor code but it panics every time I assign session to your dao struct session variable in this line <code>dao.session = GetMongoSession()</code>. you can try above code it is working fine. I have tested it completely"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1518377607, "last_edit_date": 1518377607, "creation_date": 1518370483, "answer_id": 48734376, "question_id": 48734250, "link": "https://stackoverflow.com/questions/48734250/mgo-insert-command-not-creating-db-or-inserting-document/48734376#48734376", "title": "Mgo insert command not creating db or inserting document", "body": "<p>Try below code and first of all I check is my user struct contains data coming from postman and then there is one error also  when you are assigning the session <code>*mgo.Session</code> to non-pointer <code>dao.session</code> variable. So I have changed many a things and it is working fine creating both database with <code>poll</code> name and creating a user collection with new document also I have removed ObjectId from User struct. Check it out</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"gopkg.in/mgo.v2\"\n    \"log\"\n    // \"gopkg.in/mgo.v2/bson\"\n)\n\nvar (\n    mgoSession     *mgo.Session\n)\n\ntype UserDAO struct{\n    session   *mgo.Session\n}\n\ntype User struct {\n    Username string `json:\"username\"`\n    Password string  `json:\"password\"`\n    Email string `json:\"email\"`\n}\n\nfunc GetMongoSession() *mgo.Session {\n    if mgoSession == nil {\n        var err error\n        mgoSession, err = mgo.Dial(\"localhost\")\n        mgoSession.SetMode(mgo.Monotonic, true)\n\n        if err != nil {\n            log.Fatal(\"Failed to start the Mongo session.\")\n        }\n    }\n    return mgoSession.Clone()\n}\n\nfunc (dao *UserDAO) CreateUser(u *User) (*User, error) {\n    //return errors.New(\"Not implemented\")\n\n    // Get \"users\" collection\n\n    session := GetMongoSession()\n    // log.Println(session)\n\n    c := session.DB(\"poll\").C(\"user\")\n\n    defer session.Close()\n\n    //u.Id = bson.NewObjectId()\n    err :=  c.Insert(u)\n\n    if err != nil { \n        return nil, err\n    }\n\n    return u, nil\n}\n\nfunc main(){\n    // this data will come from postman in your case\n    jsonStr := []byte(`{\n            \"username\":\"uname\",\n            \"password\":\"pass\",\n            \"email\":\"test@mail.com\"\n        }\n    `)\n\n    var user User\n    err  := json.Unmarshal(jsonStr, &amp;user)\n    if err != nil{\n        log.Println(err)\n    }\n\n    var dao *UserDAO\n\n    dao.CreateUser(&amp;user)\n}\n</code></pre>\n\n<p>My collection output is:-</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5a80993f32fcc2489f995aaf\"),\n    \"username\" : \"uname\",\n    \"password\" : \"pass\",\n    \"email\" : \"test@mail.com\"\n}\n</code></pre>\n\n<p>you don't need to create a Object id for new document it will be created itself when inserting a new document. Also If you wants top just create a collection using golang and then insert data you can create it explicitly. Go through this function <a href=\"https://godoc.org/labix.org/v2/mgo#Collection.Create\" rel=\"nofollow noreferrer\">create collection</a></p>\n"}, {"comments": [{"owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "edited": false, "score": 0, "creation_date": 1518379688, "post_id": 48735368, "comment_id": 84471147, "body": "Sorry about the vagueness, I was trying not to make the post too long which might make things more complicated. What I&#39;m doing in my code is implementing the architecture found here: <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1</a>&zwnj;&#8203;. The difference in mine would be instead of using the sql driver, I would use mgo. In the postgres.go file, I would use session *mgo.Session instesad of DB *sql.DB."}, {"owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "edited": false, "score": 0, "creation_date": 1520654557, "post_id": 48735368, "comment_id": 85415647, "body": "This ended up working for me after removing the DB I had created through the mongo shell and rerunning my code."}], "tags": [], "owner": {"reputation": 7927, "user_id": 5214807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aq31b.jpg?s=128&g=1", "display_name": "Saleem", "link": "https://stackoverflow.com/users/5214807/saleem"}, "is_accepted": false, "score": 2, "last_activity_date": 1518376362, "creation_date": 1518376362, "answer_id": 48735368, "question_id": 48734250, "link": "https://stackoverflow.com/questions/48734250/mgo-insert-command-not-creating-db-or-inserting-document/48735368#48735368", "title": "Mgo insert command not creating db or inserting document", "body": "<p>Since, I don't have full context of your application so can't diagnose what exactly issue is with your code. But I came up with close example, which is working as expected.</p>\n\n<p>Please see code below.</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/mgo.v2\"\n    \"log\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype User struct {\n    Id       bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n    Username string        `json:\"username\"`\n    Password string        `json:\"password\"`\n    Email    string        `json:\"email\"`\n}\n\nfunc GetMongoSession() *mgo.Session {\n\n    mgoSession, err := mgo.Dial(\"localhost\")\n    mgoSession.SetMode(mgo.Monotonic, true)\n\n    if err != nil {\n        log.Fatal(\"Failed to start the Mongo session.\")\n    }\n\n    return mgoSession.Clone()\n}\n\nfunc CreateUser(u *User) (*User, error) {\n\n    session := GetMongoSession()\n\n    c := session.DB(\"poll\").C(\"user\")\n    defer session.Close()\n\n    err := c.Insert(u)\n\n    if err != nil {\n        return nil, err\n    }\n\n    return u, nil\n}\n\nfunc main() {\n\n    var user = User{\n        Email:    \"abc@somewhere.come\",\n        Password: \"My-secret\",\n        Username: \"YouGuess\",\n    }\n\n    _, e := CreateUser(&amp;user)\n    if e != nil {\n        panic(e)\n    }\n\n    log.Println(\"Done...\")\n}\n</code></pre>\n\n<p>once you execute it, you should see a document in MongoDB provided that you successfully establish connection with proper credentials.</p>\n\n<p>I can see following document in my collection:</p>\n\n<pre><code>{\n    \"_id\": ObjectId(\"5a80941de0a0f75123aeb435\"),\n    \"username\": \"YouGuess\",\n    \"password\": \"My-secret\",\n    \"email\": \"abc@somewhere.come\"\n}\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 9220093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f2c077ee5197f02c587d608d7c5799?s=128&d=identicon&r=PG&f=1", "display_name": "Sogun", "link": "https://stackoverflow.com/users/9220093/sogun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 730, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1518380068, "creation_date": 1518369794, "last_edit_date": 1518380068, "question_id": 48734250, "link": "https://stackoverflow.com/questions/48734250/mgo-insert-command-not-creating-db-or-inserting-document", "title": "Mgo insert command not creating db or inserting document", "body": "<p>My goal is to implement this <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">code</a>. Except instead of using sql I want to use mongoDB. I think there is an issue with how I handle my sessions.</p>\n\n<p>I'm trying to use mgo to insert some user data into MongoDB via a Rest API. Whenever I open the mongo shell and run the <code>show dbs</code> command, the <code>poll</code> DB is not displayed. I'm using Postman to test the Rest API. Any ideas what am I might be doing wrong in the insertion process? I tried creating the collection first in the mongo shell and then running the <code>CreateUser</code> function but I still didnt see the <code>poll</code> DB get created.</p>\n\n<p><strong>User</strong></p>\n\n<pre><code>type User struct {\n    Id bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n    Username string `json:\"username\"`\n    Password string  `json:\"password\"`\n    Email string `json:\"email\"`\n}\n</code></pre>\n\n<p><strong>UserDAO</strong></p>\n\n<pre><code>type UserDAO struct {\n    session *mgo.Session\n}\n</code></pre>\n\n<p><strong>Creating a session</strong></p>\n\n<pre><code>func GetMongoSession() *mgo.Session {\n    if mgoSession == nil {\n        var err error\n        mgoSession, err = mgo.Dial(\"localhost\")\n        mgoSession.SetMode(mgo.Monotonic, true)\n\n        if err != nil {\n            log.Fatal(\"Failed to start the Mongo session.\")\n        }\n    }\n    return mgoSession.Clone()\n}\n</code></pre>\n\n<p>I pass a User struct into the <code>CreateUser</code> function that I create using Postman:</p>\n\n<pre><code>{\n    \"username\":\"uname\",\n    \"password\":\"pass\",\n    \"email\":\"test@mail.com\"\n}\n</code></pre>\n\n<p>Then I just respond with the same struct and receive this output:</p>\n\n<pre><code>{\n    \"id\": \"\",\n    \"username\": \"uname\",\n    \"password\": \"pass\",\n    \"email\": \"test@mail.com\"\n}\n</code></pre>\n\n<p><strong>Creating a user</strong></p>\n\n<pre><code>func (dao *UserDAO) CreateUser(u *User) (*User, error) {\n    //return errors.New(\"Not implemented\")\n\n    // Get \"users\" collection\n\n    dao.session = GetMongoSession()\n\n    c := dao.session.DB(\"poll\").C(\"user\")\n\n    defer dao.session.Close()\n\n    //u.Id = bson.NewObjectId()\n    err :=  c.Insert(u)\n\n    if err != nil { \n        return nil, err\n    }\n\n    return u, nil\n}\n</code></pre>\n\n<p><strong>Http handler function</strong></p>\n\n<pre><code>func (h *Handler) CreateUserReq(w http.ResponseWriter, r *http.Request) {\n\n    // create new user using information from the Request object\n    var user User\n    decoder := json.NewDecoder(r.Body)\n\n    if err := decoder.Decode(&amp;user); err != nil {\n        panic(err)\n    }\n\n    defer r.Body.Close()\n\n    // Create new User\n    u, err := h.UserService.CreateUser(&amp;user)\n    if err != nil {\n        panic(err)\n    }\n    json.NewEncoder(w).Encode(*u)\n}\n</code></pre>\n\n<p><strong>Output of show dbs</strong></p>\n\n<pre><code>&gt; show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\n</code></pre>\n"}, {"tags": ["go", "struct", "type-conversion"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518433734, "post_id": 48733169, "comment_id": 84489832, "body": "How did you solve this?"}, {"owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518436895, "post_id": 48733169, "comment_id": 84491736, "body": "@aerokite - with your suggestion :)"}], "answers": [{"tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": false, "score": 2, "last_activity_date": 1518369831, "creation_date": 1518369831, "answer_id": 48734258, "question_id": 48733169, "link": "https://stackoverflow.com/questions/48733169/remove-property-from-yaml-file/48734258#48734258", "title": "Remove property from yaml file", "body": "<p>You just need to add this:</p>\n\n<pre><code>type Mod struct {\n    Name       string     `yaml:\"name\"`\n    Type       string     `yaml:\"type,omitempty\"` // note the omitempty\n    Parameters Parameters `yaml:\"parameters,omitempty\"`\n    Build      Parameters `yaml:\"build,omitempty\"`\n}\n</code></pre>\n\n<p>Now if you do this (inside loop if you like):</p>\n\n<pre><code>obj.Mod[0].Type = \"\" // set to nil value of string\nbyt, _ := yaml.Marshal(obj)\n</code></pre>\n\n<p>And write the <code>byt</code> to file, the type will be removed. </p>\n\n<p>The point is any struct field that has a <code>omitempty</code> tag, when marshalling with <code>yaml.Marshal</code> it will <strong>omit</strong> (remove) the field if it is <strong>empty</strong> (aka has <code>nil</code> value).</p>\n\n<p>More info in <a href=\"https://godoc.org/gopkg.in/yaml.v2#Marshal\" rel=\"nofollow noreferrer\">official documentation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 1, "last_activity_date": 1518370290, "last_edit_date": 1518370290, "creation_date": 1518369922, "answer_id": 48734273, "question_id": 48733169, "link": "https://stackoverflow.com/questions/48733169/remove-property-from-yaml-file/48734273#48734273", "title": "Remove property from yaml file", "body": "<p>If you want to omit <code>type</code> from your whole YAML, you can Marshal your data into an object where <code>type</code> is not more exists</p>\n\n<pre><code>type OBJ struct {\n    Id  string `yaml:\"ID\"`\n    Mod []*Mod `yaml:\"mod,omitempty\"`\n}\n\ntype Mod struct {\n    Name        string\n    //Type      string `yaml:\"type\"`\n    Parameters  Parameters `yaml:\"parameters,omitempty\"`\n    Build       Parameters `yaml:\"build,omitempty\"`\n}\n</code></pre>\n\n<p><code>type</code> will be removed, if you Marshal your data into this object.</p>\n\n<p><strong>Another solution</strong> if you do not want to use multiple object.</p>\n\n<p>Use <code>omitempty</code> in Type. So when value of Type is <code>\"\"</code>, it will be ignored</p>\n\n<pre><code>type Mod struct {\n    Name       string\n    Type       string `yaml:\"type,omitempty\"`\n    Parameters  Parameters `yaml:\"parameters,omitempty\"`\n    Build       Parameters `yaml:\"build,omitempty\"`\n}\n</code></pre>\n\n<p>And do this</p>\n\n<pre><code>for i, _ := range obj.Mod {\n    obj.Mod[i].Type = \"\"\n}\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 9260772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/793dfcddc656d1f5ff4b20170b6ec0a4?s=128&d=identicon&r=PG&f=1", "display_name": "tj holwik", "link": "https://stackoverflow.com/users/9260772/tj-holwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1127, "favorite_count": 1, "accepted_answer_id": 48734273, "answer_count": 2, "score": 0, "last_activity_date": 1518418043, "creation_date": 1518363286, "last_edit_date": 1518418043, "question_id": 48733169, "link": "https://stackoverflow.com/questions/48733169/remove-property-from-yaml-file", "title": "Remove property from yaml file", "body": "<p>I need to read yaml file and change some properties value and write it back to the FS.</p>\n\n<p>The file content is like this</p>\n\n<pre><code>ID: mytest\nmod:\n- name: user\n  type: dev\n  parameters:\n    size: 256M\n  build:\n    builder: mybuild\n\n\ntype OBJ struct {\n    Id            string      `yaml:\"ID\"`\n    Mod           []*Mod   `yaml:\"mod,omitempty\"`\n}\n\n\ntype Mod struct {\n    Name       string\n    Type       string\n    Parameters       Parameters `yaml:\"parameters,omitempty\"`\n    Build            Parameters `yaml:\"build,omitempty\"`\n\n}\n</code></pre>\n\n<p>I need to omit the <code>type</code> property from the output</p>\n\n<pre><code>ID: mytest\nmod:\n- name: user\n  parameters:\n    size: 256M\n  build:\n    builder: mybuild\n</code></pre>\n\n<p>The problem is that, I can read it, I can change the property value but can not delete the key (which is <code>type</code>)</p>\n\n<p>The code I use </p>\n\n<pre><code>yamlFile, err := ioutil.ReadFile(\"test.yaml\")\n\n//Here I parse the file to the model I\u2019ve which is working fine\nerr := yaml.Unmarshal([]byte(yamlFile), &amp;obj)\nif err != nil {\n    log.Printf(\"Yaml file is not valid, Error: \" + err.Error())\n    os.Exit(-1)\n}\n</code></pre>\n\n<p>Now I was able to loop on the properties like </p>\n\n<pre><code>obj := models.OBJ{}\n\n\nfor i, element := range obj.Mod {\n\n//Here I was able to change property data\n\nmta.Mod[i].Name = \"test123\"\n</code></pre>\n\n<p>But not sure how I can omit the whole property of <code>type</code> when writing back to the FS.</p>\n\n<p>I use this OS: \n<a href=\"https://github.com/go-yaml/yaml/tree/v2\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml/tree/v2</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518358780, "post_id": 48732412, "comment_id": 84464034, "body": "You can change <code>header.Name</code> to be whatever you want, this is the name of the file inside the archive. This is set to the filename in <code>zip.FileInfoHeader(info)</code>."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518359118, "post_id": 48732412, "comment_id": 84464148, "body": "@Marc - can you please write where it should be ? is it like this \t\t<code>name := info.Name(&quot;test&quot;)  \t\theader, err := zip.FileInfoHeader(name)</code> ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518359283, "post_id": 48732412, "comment_id": 84464188, "body": "You want to keep <code>FileInfoHeader</code> as it also sets other fields (timestamp, size, etc..). But parts of your code already change <code>header.Name</code>. You just need to replace <code>folder2</code> in the path with <code>folder1</code>. Or even easier: change <code>baseDir</code> to <code>folder1</code> before <code>filepath.Walk</code>"}], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1518361875, "post_id": 48732742, "comment_id": 84464941, "body": "Thanks marc , one last thing is that sometime I need to use the <code>zipit</code> method with 2 paramters and sometimes with 3 like you did, how would you do it ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1518362342, "post_id": 48732742, "comment_id": 84465068, "body": "You wouldn&#39;t, Go does not allow multiple function signatures. You can either the proposal above which keeps the old behavior is <code>newBaseName</code> is empty, or you can create a helper function."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1518452917, "post_id": 48732742, "comment_id": 84502590, "body": "please see if you can help <a href=\"https://stackoverflow.com/questions/48751091/go-zip-content-inside-folder-without-the-root-folder\" title=\"go zip content inside folder without the root folder\">stackoverflow.com/questions/48751091/&hellip;</a>"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1518361058, "last_edit_date": 1518361058, "creation_date": 1518360575, "answer_id": 48732742, "question_id": 48732412, "link": "https://stackoverflow.com/questions/48732412/unzip-artifacts-with-different-name/48732742#48732742", "title": "Unzip artifacts with different name", "body": "<p>Names of files and directories in zip archives come from the <a href=\"https://golang.org/pkg/archive/zip/#FileHeader\" rel=\"nofollow noreferrer\">zip.FileHeader</a>.</p>\n\n<p>Your code already initializes the header from the <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow noreferrer\">os.FileInfo</a>. This is important as it populates metadata such as timestamps and uncompressed size.</p>\n\n<p>Furthermore, your code seems to be doing the following:</p>\n\n<p>If invoked with:</p>\n\n<pre><code>Zipit(\"/path/to/folder2/\", \"/path/to/folder1.zip\")\n</code></pre>\n\n<p>Before traversing the directory tree, it computes the base directory:</p>\n\n<pre><code>baseDir = filepath.Base(source)\n// baseDir is \"folder2\"\n</code></pre>\n\n<p>Then for each file, the path inside the archive is set to:</p>\n\n<pre><code>header.Name = filepath.Join(baseDir, strings.TrimPrefix(path, source))\n</code></pre>\n\n<p>This turns a filename such as <code>/path/to/folder2/otherdir/myfile</code> into <code>folder2/otherdir/myfile</code>.</p>\n\n<p>If you want to change the directory name stored inside the archive, you just need to change <code>baseDir</code> to the desired name.</p>\n\n<p>I would recommend the following solution:</p>\n\n<p>Change the function signature to:</p>\n\n<pre><code>func Zipit(source, target, newBaseName string) error {\n</code></pre>\n\n<p>Change the basedir to:</p>\n\n<pre><code>if newBaseName != \"\" {\n    baseDir = newBaseName\nelse if info.IsDir() {\n    baseDir = filepath.Base(source)\n}\n</code></pre>\n\n<p>Then call your function with:</p>\n\n<pre><code>Zipit(\"/path/to/folder2/\", \"/path/to/folder1.zip\", \"folder1\")\n</code></pre>\n\n<p>This should result in an archive that extracts into <code>folder1/</code>.</p>\n"}], "owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 1, "accepted_answer_id": 48732742, "answer_count": 1, "score": 0, "last_activity_date": 1518363594, "creation_date": 1518358423, "last_edit_date": 1518363594, "question_id": 48732412, "link": "https://stackoverflow.com/questions/48732412/unzip-artifacts-with-different-name", "title": "Unzip artifacts with different name", "body": "<p>I have a program in which I need to copy the folder contents (from <code>folder1</code>) to a new folder (<code>folder2</code>) in the same dir level (path).\nSince I cannot give the same name I use tmpFolder name (for <code>folder2</code>).\nWhen I finish to do all the logic I need zip the copied folder \nand I give the zip the name <code>folder1.zip</code>\nThe problem is that when I extract the <code>folder1.zip</code>\nI see <code>folder2</code>.</p>\n\n<p>I want it to be <code>folder1</code> after the zip.</p>\n\n<p>Is there some trick I can use to do it? </p>\n\n<p>In addition, I know that I can copy to folder2 in different level (path) but I want to avoid it if possible since\nthe copy can be very expensive when working on big folder contents.</p>\n\n<p>I use this code to zip the folder:</p>\n\n<pre><code>func Zipit(source, target string) error {\n    zipfile, err := os.Create(target)\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(source)\n    if err != nil {\n        return nil\n    }\n\n    var baseDir string\n    if info.IsDir() {\n        baseDir = filepath.Base(source)\n    }\n\n    filepath.Walk(source, func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(baseDir, strings.TrimPrefix(path, source))\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n        } else {\n            header.Method = zip.Deflate\n        }\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n</code></pre>\n"}, {"tags": ["node.js", "go", "error-handling", "exec", "testcafe"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1518349055, "post_id": 48731051, "comment_id": 84461150, "body": "Arguments are separate elements in the slice. So you should have <code>&quot;--reporter&quot;,  &quot;json&quot;</code>, and maybe the same with <code>chromium...</code> unless you really want a quoted string."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518350624, "post_id": 48731051, "comment_id": 84461587, "body": "And as mentioned in the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Output\" rel=\"nofollow noreferrer\">Cmd.Output docs</a>, you should check the <code>ExitError.Stderr</code>. I&#39;m guessing that will tell you something about unknown or invalid arguments."}, {"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1518352396, "post_id": 48731051, "comment_id": 84462107, "body": "What does your actual command prints in terminal?"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518365220, "post_id": 48731051, "comment_id": 84466003, "body": "Why do you apply <code>string</code> twice in <code>string(string(out[:]))</code>?"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518365439, "post_id": 48731051, "comment_id": 84466075, "body": "How do you write the command on the terminal?"}, {"owner": {"reputation": 57, "user_id": 6740671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb07085e06fec43ed830c6518c90c976?s=128&d=identicon&r=PG", "display_name": "Bastian Bringenberg", "link": "https://stackoverflow.com/users/6740671/bastian-bringenberg"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518366217, "post_id": 48731051, "comment_id": 84466312, "body": "@Marc this is exactly what the Problem was. I needed to TypeCast this ExitError.Stderr which is not good documentated...  The missing Line was:      message += string(err.(*exec.ExitError).Stderr[:])  I also separeted reporter and json, but needed to have this quoted string as one arguments.  Thanks also to md2perpe, this was just some kind of tryout, is cleaned up in the code now!"}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 6740671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb07085e06fec43ed830c6518c90c976?s=128&d=identicon&r=PG", "display_name": "Bastian Bringenberg", "link": "https://stackoverflow.com/users/6740671/bastian-bringenberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1518366411, "creation_date": 1518366411, "answer_id": 48733671, "question_id": 48731051, "link": "https://stackoverflow.com/questions/48731051/exec-nodejs-and-get-output-on-error/48733671#48733671", "title": "Exec nodejs and get output on error", "body": "<p>As mentioned above if you ever need to access Stderr from an Command Exit in Golang use:</p>\n\n<pre><code>message += string(err.(*exec.ExitError).Stderr[:])\n</code></pre>\n\n<p>In my case the nodejs tool gave an exit code based on the amounts of problems. Solved this it runs perfectly now =).</p>\n"}, {"tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": false, "score": 1, "last_activity_date": 1518434973, "creation_date": 1518434973, "answer_id": 48745441, "question_id": 48731051, "link": "https://stackoverflow.com/questions/48731051/exec-nodejs-and-get-output-on-error/48745441#48745441", "title": "Exec nodejs and get output on error", "body": "<p>I made a function that I use to do shell command execution: \n<a href=\"https://gist.github.com/leninhasda/8f2b5cdc22677a8f2bdf2e896eb0b561\" rel=\"nofollow noreferrer\">https://gist.github.com/leninhasda/8f2b5cdc22677a8f2bdf2e896eb0b561</a></p>\n\n<pre><code>stdOut, stdErr, err := ShellExec(\"echo\", \"hello\", \"world\")\nif err != nil {\n    // error executing command\n}\n\nif stdErr != \"\" {\n    // shell command returned error message\n}\n\nif stdOut != \"\" {\n    // shell command returned output message\n    // hello world\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 6740671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb07085e06fec43ed830c6518c90c976?s=128&d=identicon&r=PG", "display_name": "Bastian Bringenberg", "link": "https://stackoverflow.com/users/6740671/bastian-bringenberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1518434973, "creation_date": 1518348856, "last_edit_date": 1518363571, "question_id": 48731051, "link": "https://stackoverflow.com/questions/48731051/exec-nodejs-and-get-output-on-error", "title": "Exec nodejs and get output on error", "body": "<p>I am trying to fire a command via exec in my go binary to get JSON output of the other script. The other script is a nodejs task checking for html problems.\nIf I fire the nodeJS task on cli everything works fine and I get JSON output, but if I fire the command inside of go I only get:</p>\n\n<blockquote>\n  <p>exit status 1</p>\n</blockquote>\n\n<p>I am not total sure if the problem is a nodejs or a go problem, but even if nodejs founds HTML Problems I want to be able to analyze the JSON Response in my go script.</p>\n\n<p>Here is my source code:</p>\n\n<pre><code>out, err := exec.Command(\"/usr/bin/testcafe\", \"'chromium:headless --no-sandbox'\", \"--reporter json\", \"/data/checks.js\").Output()\nstatus := http.StatusOK\nmessage := \"\"\nif err != nil {\n    status = http.StatusNotImplemented\n    message = err.Error() + string(string(out[:]))\n    fmt.Println(message)\n}\n</code></pre>\n"}, {"tags": ["csv", "go", "google-sheets-api"], "answers": [{"tags": [], "owner": {"reputation": 794, "user_id": 1312791, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c9dc2d2585c375a9049748fd0b1b26e6?s=128&d=identicon&r=PG", "display_name": "telex-wap", "link": "https://stackoverflow.com/users/1312791/telex-wap"}, "is_accepted": true, "score": 0, "last_activity_date": 1518349835, "creation_date": 1518349835, "answer_id": 48731172, "question_id": 48730779, "link": "https://stackoverflow.com/questions/48730779/convert-csv-contents-to-go-interface-to-upload-them-to-a-google-sheet/48731172#48731172", "title": "Convert CSV contents to Go interface to upload them to a Google Sheet", "body": "<p>I just found out what my problem was, when appending, I was doing this: </p>\n\n<pre><code>all = append(all, []interface{}{value})\n</code></pre>\n\n<p>And I should have done this</p>\n\n<pre><code>all = append(all, []interface{}{value[0], value[1]})\n</code></pre>\n\n<p>This is, because <code>value</code> can be indexed, since every item inside of it corresponds to a cell, so my CSV specifically had two cells. Passing just <code>value</code> was the wrong format for this. </p>\n"}], "owner": {"reputation": 794, "user_id": 1312791, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c9dc2d2585c375a9049748fd0b1b26e6?s=128&d=identicon&r=PG", "display_name": "telex-wap", "link": "https://stackoverflow.com/users/1312791/telex-wap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 48731172, "answer_count": 1, "score": 0, "last_activity_date": 1518349835, "creation_date": 1518346829, "question_id": 48730779, "link": "https://stackoverflow.com/questions/48730779/convert-csv-contents-to-go-interface-to-upload-them-to-a-google-sheet", "title": "Convert CSV contents to Go interface to upload them to a Google Sheet", "body": "<p>I am trying to send the contents of a CSV file to a Google Sheet, via their very ill-documented API for Go. </p>\n\n<p>The <code>BatchUpdate</code> takes an <code>interface</code>, so this would work: </p>\n\n<pre><code>values := [][]interface{}{{\"one cell\", \"another cell\"}, {\"one cell in new row\", \"another cell in new row\"}}\n</code></pre>\n\n<p>The problem comes when I want to send the contents from a CSV. I have done this: </p>\n\n<pre><code>func prepare(filename string) [][]interface{} {\n\n    file, _ := os.Open(filename)\n\n    defer file.Close()\n\n    reader := csv.NewReader(file)\n    record, err := reader.ReadAll()\n    if err != nil {\n        fmt.Println(\"Error\", err)\n    }\n\n    all := [][]interface{}{}\n\n    for _, value := range record {\n        all = append(all, []interface{}{value})\n    }\n\n    return all\n}\n</code></pre>\n\n<p>And I believe this should give me the <code>interface</code> ready to be inserted in the sheet. However, when I do this later on:</p>\n\n<pre><code>rb := &amp;sheets.BatchUpdateValuesRequest{\n        ValueInputOption: \"USER_ENTERED\",\n    }\n    rb.Data = append(rb.Data, &amp;sheets.ValueRange{\n        Range:  rangeData,\n        Values: values, // This is the interface that I returned earlier on\n    })\n    _, err = sheetsService.Spreadsheets.Values.BatchUpdate(spreadsheetId, rb).Context(ctx).Do() \n</code></pre>\n\n<p>it gives me a <code>googleapi: Error 400: Invalid data[0]: Invalid values[0][0]</code></p>\n\n<p>So I understand that I am trying to pass the CSV fields in an incorrect format. I know that when I do this in <code>Python</code>, I need to pass it as tuples for the data to be accepted. What's the correct way to pass the data here in <code>Go</code>?</p>\n"}, {"tags": ["go", "cryptography", "rsa"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "edited": false, "score": 0, "creation_date": 1518344965, "post_id": 48730432, "comment_id": 84460033, "body": "Thanks for clarifying, great answer."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 7, "last_activity_date": 1518344969, "last_edit_date": 1518344969, "creation_date": 1518344193, "answer_id": 48730432, "question_id": 48730344, "link": "https://stackoverflow.com/questions/48730344/golang-signing-a-struct-using-rsa/48730432#48730432", "title": "Golang signing a struct using rsa", "body": "<p>Two things here:</p>\n\n<ul>\n<li>only small messages can be signed, which is why it's usually a hash. <code>rsa.SignPKCS1v15</code> expects a message length matching the hash algorithm's output (256 bits, or 32 bytes for sha-256)</li>\n<li>don't use the <code>%v</code> representation of your struct, serialize it instead</li>\n</ul>\n\n<p>The first is <a href=\"https://golang.org/pkg/crypto/rsa/#SignPKCS1v15\" rel=\"noreferrer\">spelled out in the rsa docs</a>. Given a message, you can sign it using the following:</p>\n\n<pre><code>message := []byte(\"message to be signed\")\nhashed := sha256.Sum256(message)\n\nsignature, err := rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.SHA256, hashed[:])\nif err != nil {\n    panic(err)}\n}\n</code></pre>\n\n<p>The second point is more about making your code more robust. You don't want a change in <code>%v</code> logic or addition of non-exported fields to cause issues. You may also want to check the signature from a language other than Go.</p>\n\n<p>Thus, you should first marshal your struct. You already have json tags on it, so it's fairly easy:</p>\n\n<pre><code>message, err := json.Marshal(txnObj)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Message is the byte slice passed to <code>sha256.Sum256</code> above.</p>\n\n<p>When verifying the signature, you'll need to make sure to zero out the <code>Signature</code> field of your struct, marshal it, hash it, and call <code>rsa.VerifyPKCS1v15</code>.</p>\n"}], "owner": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3645, "favorite_count": 3, "accepted_answer_id": 48730432, "answer_count": 1, "score": 3, "last_activity_date": 1518345530, "creation_date": 1518343486, "last_edit_date": 1518345530, "question_id": 48730344, "link": "https://stackoverflow.com/questions/48730344/golang-signing-a-struct-using-rsa", "title": "Golang signing a struct using rsa", "body": "<p>I have a struct <code>Transaction</code> with the following fields, </p>\n\n<pre><code>type Transaction struct {\n    Sender    string `json:\"sender\"`\n    Receiver  string `json:\"receiver\"`\n    Signature string `json:\"signature\"`\n    Amount    int64  `json:\"amount\"`\n}\n</code></pre>\n\n<p>I also have a function <code>GetPrivateKey()</code> which returns a <code>*rsa.PrivateKey</code></p>\n\n<pre><code>func GetPrivateKey() (*rsa.PrivateKey, error) {\n    key, err := ioutil.ReadFile(\"/Users/xxx/.ssh/id_rsa\")\n    if err != nil {\n        return nil, err\n    }\n\n    block, _ := pem.Decode(key)\n    der, err := x509.ParsePKCS1PrivateKey(block.Bytes)\n    if err != nil {\n       return nil, err\n    }\n    return der, err\n }\n</code></pre>\n\n<p>My plan here is to sign the contents of the struct <code>transaction</code> using a private key already in the system and then store it as a string in the field <code>signature</code> in the struct, For this, I have a function <code>SignPayload()</code></p>\n\n<pre><code>func SignPayload(txnObj *Transaction) error {\n    privateKey, err := GetPrivateKey()\n    if err != nil {\n        panic(err)\n    }\n    bodyHash, err := rsa.SignPKCS1v15(rand.Reader, privateKey, \n                     crypto.SHA256, []byte(fmt.Sprintf(\"%v\", *txnObj)))\n    if err != nil {\n        panic(err)\n    }\n    txnObj.Signature = string(bodyHash)\n    log.Println(txnObj.Signature)\n    return err\n}\n</code></pre>\n\n<p>Unfortunately, this is not working,<code>rsa.SignPKCS1v15()</code> throws an error saying:</p>\n\n<blockquote>\n  <p>crypto/rsa: input must be hashed message</p>\n</blockquote>\n\n<p>The end goal here is to use this signature to verify the authenticity of the struct by comparing it with the public key present in the field <code>sender</code>.\nI'm an absolute newbie in cryptography, What am I doing wrong here? and more importantly, How can I do this?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518332974, "post_id": 48729167, "comment_id": 84457302, "body": "Did you see the wiki article on rate limiting yet? <a href=\"https://github.com/golang/go/wiki/RateLimiting\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/RateLimiting</a>"}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518333098, "post_id": 48729167, "comment_id": 84457325, "body": "I haven&#39;t - although it looks promising. I&#39;ll take a shot at implementing it now."}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518333542, "post_id": 48729167, "comment_id": 84457408, "body": "@Peter how would you wrap it around the for loop of the colours so that you get the colours being sent in order?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518335833, "post_id": 48729167, "comment_id": 84457877, "body": "Regardless of what you&#39;re using to rate-limit, you shouldn&#39;t loop over colors. Instead, when you&#39;re about to send a request, lookup which color you need to send this time."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518339081, "post_id": 48729167, "comment_id": 84458593, "body": "This is an XY problem. A better approach is a different rate-limiting method."}], "answers": [{"tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 0, "last_activity_date": 1518338959, "creation_date": 1518338959, "answer_id": 48729834, "question_id": 48729167, "link": "https://stackoverflow.com/questions/48729167/pause-the-execution-of-for-loop/48729834#48729834", "title": "Pause the execution of for loop", "body": "<p>Try changing to</p>\n\n<pre><code>func makeTheLightsBlinkTheRainbow(request *gorequest.SuperAgent) {\n    colours := [7]string{\"red\", \"orange\", \"yellow\", \"green\", \"blue\", \"purple\", \"pink\"}\n\n    i := 0\n    for {\n\n        if rateLimit &gt; 0 {\n\n            response, _, _ := request.Post(\"http://example.com/blink\").\n                Send(fmt.Sprintf(`{\"color\":\"%v\"}`, colours[i])).\n                End()\n\n            i = (i+1) % 7\n            rateLimit--\n\n        } else {\n            time.Sleep(1 * time.Second)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518342673, "post_id": 48729892, "comment_id": 84459465, "body": "This looks pretty cool - how would I limit this to 20 requests per minute. I&#39;m having a little trouble seeing how you change it from x requests per second."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518362799, "post_id": 48729892, "comment_id": 84465222, "body": "<code>newRateLimitTransport(0.33, http.DefaultTransport)</code> would limit to 0.33 requests per second = 20 per minute."}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518388618, "post_id": 48729892, "comment_id": 84473983, "body": "OK, that makes sense. I&#39;ve implemented this but am getting an error when trying to run it: <code>undefined: rate in rate.Limiter</code> which stems from the <code>rateLimitTransport</code> struct. Any ideas how to resolve that?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518419613, "post_id": 48729892, "comment_id": 84481739, "body": "@James: Import the <code>rate</code> package. Beyond that, post a question with your complete code."}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1518431138, "post_id": 48729892, "comment_id": 84488242, "body": "Ah - that would be it! I got this working and I quite like it! I really like that the limit exists on the client itself. Thanks for sharing this solution."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1518339527, "creation_date": 1518339527, "answer_id": 48729892, "question_id": 48729167, "link": "https://stackoverflow.com/questions/48729167/pause-the-execution-of-for-loop/48729892#48729892", "title": "Pause the execution of for loop", "body": "<p>My suggestion: Take an entirely different approach to rate limiting.</p>\n\n<p>I would put it in the HTTP transport, since that's logically where such a limit ought to exist, and then you needn't mangle your application code at all.  Something like:</p>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"golang.org/x/time/rate\"\n)\n\ntype rateLimitTransport struct {\n    limiter *rate.Limiter\n    xport   http.RoundTripper\n}\n\nvar _ http.RoundTripper = &amp;rateLimitTransport{}\n\nfunc newRateLimitTransport(r float64, xport http.RoundTripper) http.RoundTripper {\n    return &amp;rateLimitTransport{\n        limiter: rate.NewLimiter(rate.Limit(r), 1),\n        xport:   xport,\n    }\n}\n\nfunc (t *rateLimitTransport) RoundTrip(r *http.Request) (*http.Response, error) {\n    t.limiter.Wait(r.Context())\n    return t.xport.RoundTrip(r)\n}\n</code></pre>\n\n<p>This uses the <code>golang.org/x/time/rate</code> package to implement the rate limiting.  <code>newRateLimitTransport()</code> creates a new rate-limiting transport, where <code>r</code> is the maximum number of requests to allow per second.</p>\n\n<p>To take advantage of this, use an instance of the rate-limited transport in the HTTP client for your backend API:</p>\n\n<pre><code>// set this in `init()` for example\nmyClient := http.&amp;Client{\n    // Use a rate-limiting transport which falls back to the default\n    Transport: newRateLimitTransport(60, http.DefaultTransport)\n}\n\n// Then later use `myClient` instead of the default, when making API\n// requests:\nreq, err := http.NewRequest(http.MethodPost, url, body)\nif err != nil {\n    return err\n}\nmyClient.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 48729892, "answer_count": 2, "score": 0, "last_activity_date": 1518339527, "creation_date": 1518332472, "last_edit_date": 1518332849, "question_id": 48729167, "link": "https://stackoverflow.com/questions/48729167/pause-the-execution-of-for-loop", "title": "Pause the execution of for loop", "body": "<p>I have an API that I am POSTing a small JSON object too.</p>\n\n<p>This runs as an infinite loop, looping over 7 colours (the rainbow) and send these inside the aforementioned JSON object.</p>\n\n<p>The API I am connecting to has a rate limit on it of 40 requests per minute.</p>\n\n<p>I don't want to hit the rate limit and so I have devised a method to avoid this;</p>\n\n<ul>\n<li>I have a global variable that stores the number of requests I am allowed to make</li>\n<li>I have a function that holds a ticker set to run every 60 seconds and top up the global variable that stores my requests</li>\n<li>I then have a never ending for loop that runs and checks the number of requests that are still allowed to be made, if it is greater than 0 then we make our next request, if is not then we just sleep for a second and try again</li>\n</ul>\n\n<p>It looks a little something like this:</p>\n\n<pre><code>var rateLimit int\n\nfunc main() {\n\n    request := gorequest.New().SetDebug(false)\n\n    // Set the initial request bucket to 40\n    rateLimit = 40\n\n    go topUpLimiter()\n\n    for {\n        makeTheLightsBlinkTheRainbow(request)\n    }\n}\n\nfunc topUpLimiter() {\n    for range time.Tick(60 * time.Second) {\n        rateLimit += 40\n    }\n}\n\nfunc makeTheLightsBlinkTheRainbow(request *gorequest.SuperAgent) {\n    colours := [7]string{\"red\", \"orange\", \"yellow\", \"green\", \"blue\", \"purple\", \"pink\"}\n\n    for _, colour := range colours {\n\n        if rateLimit &gt; 0 {\n\n            response, _, _ := request.Post(\"http://example.com/blink\").\n                Send(fmt.Sprintf(`{\"color\":\"%v\"}`, colour)).\n                End()\n\n            rateLimit--\n\n        } else {\n            time.Sleep(1 * time.Second)\n        }\n    }\n}\n</code></pre>\n\n<p>This works and I don't ever hit the rate limit, but once I run out of requests, the loop continues to run and will only starts making requests again when the <code>rateLimit</code> variable is topped up.</p>\n\n<p>I am making an IoT light blink the colours of the rainbow and the result is the colours get out of order once the <code>rateLimit</code> variable runs out and is then later topped up due to the fact that the for loop just keeps running.</p>\n\n<p>I'd like to pause/block the for loop while I wait for the <code>rateLimit</code> variable to replenish so that the colours don't get out of order.</p>\n\n<p>How would I implement something like that? From my searches it seems like it may be possible with channels, but I'm not too sure how to do it like that.</p>\n\n<p>This is an example of what ends up happening: <a href=\"https://play.golang.org/p/r6OG4kK9vCP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/r6OG4kK9vCP</a>\nOnce it has finished running, you will notice the colours printed out get out of order about halfway through.</p>\n"}, {"tags": ["go", "escaping", "go-iris"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5007044, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-u8Cq2C7tYvM/AAAAAAAAAAI/AAAAAAAAAAA/uRVC1ehpAD4/photo.jpg?sz=128", "display_name": "mehdi sahebi", "link": "https://stackoverflow.com/users/5007044/mehdi-sahebi"}, "edited": false, "score": 0, "creation_date": 1518400297, "post_id": 48736636, "comment_id": 84476691, "body": "Thanks @mu, I use text/html and want to disable Auto-escaping, I check use custom function definition for this purpose"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 0, "last_activity_date": 1518384378, "creation_date": 1518384378, "answer_id": 48736636, "question_id": 48728991, "link": "https://stackoverflow.com/questions/48728991/how-to-disable-autoescaping-in-iris/48736636#48736636", "title": "How to disable AutoEscaping in IRIS", "body": "<p>How you would get raw HTML through the template and into the output would depend on which template engine you're using with Iris. <a href=\"https://docs.iris-go.com/view.html\" rel=\"nofollow noreferrer\">Iris supports five template engines out-of-the-box</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>The standard html, its template parser is the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template/</a></li>\n  <li>Django, its template parser is the <a href=\"https://github.com/flosch/pongo2\" rel=\"nofollow noreferrer\">github.com/flosch/pongo2</a></li>\n  <li>Pug(Jade), its template parser is the <a href=\"https://github.com/Joker/jade\" rel=\"nofollow noreferrer\">github.com/Joker/jade</a></li>\n  <li>Handlebars, its template parser is the <a href=\"https://github.com/aymerick/raymond\" rel=\"nofollow noreferrer\">github.com/aymerick/raymond</a></li>\n  <li>Amber, its template parser is the <a href=\"https://github.com/eknkc/amber\" rel=\"nofollow noreferrer\">github.com/eknkc/amber</a></li>\n  </ul>\n</blockquote>\n\n<p>If you're using the standard <code>html/template</code> package then you'd mark the string as \"safe HTML\" using the <code>template.HTML</code> type:</p>\n\n<pre><code>ctx.ViewData(\"rows\", template.HTML(rows[0]))\n</code></pre>\n\n<p>or add your own filter which just does a <code>return template.HTML(s)</code> and use that inside the template.</p>\n\n<p>If you were using Handlebars then you'd use <a href=\"https://github.com/aymerick/raymond#html-escaping\" rel=\"nofollow noreferrer\"><code>{{{...}}}</code> in the template or <code>raymond.SafeString</code> in a helper</a>:</p>\n\n<pre><code>{{{yourHTML}}}\n</code></pre>\n\n<p>If you're using one of the other template engines then you'd use whatever mechanism they offer for getting raw HTML through the template.</p>\n\n<p>All of this assumes, of course, that you're scrubbing and sanitizing the HTML before it gets into the database or before it gets from the database to the template.</p>\n"}], "owner": {"reputation": 13, "user_id": 5007044, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-u8Cq2C7tYvM/AAAAAAAAAAI/AAAAAAAAAAA/uRVC1ehpAD4/photo.jpg?sz=128", "display_name": "mehdi sahebi", "link": "https://stackoverflow.com/users/5007044/mehdi-sahebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 48736636, "answer_count": 1, "score": 1, "last_activity_date": 1518384378, "creation_date": 1518330817, "last_edit_date": 1518340200, "question_id": 48728991, "link": "https://stackoverflow.com/questions/48728991/how-to-disable-autoescaping-in-iris", "title": "How to disable AutoEscaping in IRIS", "body": "<p>I insert HTML tags into database table:</p>\n\n<pre><code>&lt;table&gt;\n&lt;tr&gt;\n   &lt;td&gt;1&lt;/td&gt;\n   &lt;td&gt;2&lt;/td&gt;\n   &lt;td&gt;3&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>And send retrieved data into View </p>\n\n<pre><code>func MyEvent(ctx iris.Context){\n        rows := ...\n        ctx.ViewData(\"rows\", rows[0])\n        ctx.View(\"template.html\")\n}\n</code></pre>\n\n<p>How could I disable auto escaping just in this event?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "answers": [{"comments": [{"owner": {"reputation": 908, "user_id": 5618126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe250e74add86bd1f29f48095ab66451?s=128&d=identicon&r=PG&f=1", "display_name": "metadata", "link": "https://stackoverflow.com/users/5618126/metadata"}, "edited": false, "score": 0, "creation_date": 1576170963, "post_id": 48739086, "comment_id": 104821584, "body": "Hello Jim, Thanks for this answer. It&#39;s still helpful. I have a question that Is there any alternative available now to get the data using TxnID in <code>fabric-sdk-go</code>?  For example, I have stored <code>A</code> in the ledger and got <code>TxnHash B</code> and now I want to query the ledger using <code>TxnHash B</code> to fetch the stored data. I came across <code>ledger.QueryTransaction()</code> but it requires a good parsing logic in order to get the details from it."}], "tags": [], "owner": {"reputation": 996, "user_id": 5156646, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d51f0ac02939a9cf8d85df751e01d21c?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Green", "link": "https://stackoverflow.com/users/5156646/jim-green"}, "is_accepted": true, "score": 7, "last_activity_date": 1518405503, "creation_date": 1518405503, "answer_id": 48739086, "question_id": 48728806, "link": "https://stackoverflow.com/questions/48728806/hyperledger-fabric-get-block-info-fabric-go-sdk/48739086#48739086", "title": "HyperLedger Fabric Get Block Info - Fabric Go SDK", "body": "<p>In general, the sdk will provide the basic method such you said GetBlockInfo,I have search for the GoLang SDK, it can not be found. While Java sdk provide this such method <a href=\"https://github.com/hyperledger/fabric-sdk-java/tree/master/src/test/java/org/hyperledger/fabric/sdkintegration\" rel=\"noreferrer\">reference this java test</a> . </p>\n\n<p>Another way to use these method(you must know a little fabric source code), in fact these method are included in the system chaincode, you could invoke the system chancode just like you invoke the normal chaincode. </p>\n\n<p>A example is following:\n<a href=\"https://github.com/hyperledger/fabric-sdk-go/blob/master/test/integration/e2e/end_to_end.go\" rel=\"noreferrer\">from the go sdk test</a> ,you could see this,</p>\n\n<pre><code>response, err := chClient.Query(chclient.Request{ChaincodeID: ccID, Fcn: \"invoke\", Args: integration.ExampleCCQueryArgs()})\n</code></pre>\n\n<p>just change the params</p>\n\n<pre><code>response, err := chClient.Query(chclient.Request{ChaincodeID: \"qscc\", Fcn: \"invoke\", Args: integration.ExampleCCQueryArgs(\"GetChainInfo\")})\n</code></pre>\n\n<p>qscc is a system chancode,you could download the <a href=\"https://github.com/hyperledger/fabric\" rel=\"noreferrer\">fabric source code</a>,and from <a href=\"https://github.com/hyperledger/fabric/blob/release/core/scc/qscc/query.go\" rel=\"noreferrer\">qscc file</a>,you could see(it provide many invoke service):</p>\n\n<pre><code>GetChainInfo       string = \"GetChainInfo\"\nGetBlockByNumber   string = \"GetBlockByNumber\"\nGetBlockByHash     string = \"GetBlockByHash\"\nGetTransactionByID string = \"GetTransactionByID\"\nGetBlockByTxID     string = \"GetBlockByTxID\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3230267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34ae24f410520ce5c6b93e39d3adbed4?s=128&d=identicon&r=PG&f=1", "display_name": "Troy Ronda", "link": "https://stackoverflow.com/users/3230267/troy-ronda"}, "is_accepted": false, "score": -2, "last_activity_date": 1553174725, "last_edit_date": 1553174725, "creation_date": 1522075960, "answer_id": 49494419, "question_id": 48728806, "link": "https://stackoverflow.com/questions/48728806/hyperledger-fabric-get-block-info-fabric-go-sdk/49494419#49494419", "title": "HyperLedger Fabric Get Block Info - Fabric Go SDK", "body": "<p>The Go SDK now includes methods for querying block information. These methods are contained within the <a href=\"https://godoc.org/github.com/hyperledger/fabric-sdk-go/pkg/client/ledger\" rel=\"nofollow noreferrer\">ledger client package</a>.</p>\n\n<p>You can see an example in the <a href=\"https://github.com/hyperledger/fabric-sdk-go/blob/master/test/integration/pkg/client/ledger/ledger_queries_test.go\" rel=\"nofollow noreferrer\" title=\"updated\">ledger client integration test</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 9578636, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PXy9E.jpg?s=128&g=1", "display_name": "Chernilin", "link": "https://stackoverflow.com/users/9578636/chernilin"}, "is_accepted": false, "score": 1, "last_activity_date": 1535472310, "creation_date": 1535472310, "answer_id": 52062109, "question_id": 48728806, "link": "https://stackoverflow.com/questions/48728806/hyperledger-fabric-get-block-info-fabric-go-sdk/52062109#52062109", "title": "HyperLedger Fabric Get Block Info - Fabric Go SDK", "body": "<p>Go sdk(fabric-sdk-go/pkg/client/ledger) provides several methods for getting information about blockchain. For example:</p>\n\n<pre><code>...\nclient, err := ledger.New(channelContext)\nblock, err := client.QueryBlockByHash(blockHash)\nblock, err = client.QueryBlock(blockNumber)\n</code></pre>\n"}], "owner": {"reputation": 223, "user_id": 2386882, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MDXl1.jpg?s=128&g=1", "display_name": "Tittu Vaghese", "link": "https://stackoverflow.com/users/2386882/tittu-vaghese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4436, "favorite_count": 1, "accepted_answer_id": 48739086, "answer_count": 3, "score": 5, "last_activity_date": 1553174725, "creation_date": 1518328932, "last_edit_date": 1518329497, "question_id": 48728806, "link": "https://stackoverflow.com/questions/48728806/hyperledger-fabric-get-block-info-fabric-go-sdk", "title": "HyperLedger Fabric Get Block Info - Fabric Go SDK", "body": "<p>I used to set up a Fabric network and deployed a fabric network and basic application using a Fabric and Fabric GoLang SDK. I'm able to do the query and write to the chain.\nIs there any way to retrieve the Block Info? Like block height and current hash?</p>\n\n<pre><code>+ I'm unable to find out a documentation for GoLang Fabric SDK.\n</code></pre>\n\n<p>I followed following code and tutorial,</p>\n\n<p><a href=\"https://chainhero.io/2017/07/tutorial-build-blockchain-app/\" rel=\"noreferrer\">Fabric Basic App - Tutorial</a>\n<a href=\"https://chainhero.io/2017/07/tutorial-build-blockchain-app/\" rel=\"noreferrer\">https://chainhero.io/2017/07/tutorial-build-blockchain-app/</a></p>\n\n<p><a href=\"https://github.com/chainHero/heroes-service/\" rel=\"noreferrer\">Fabric Basic App using GoLang SDK - Code</a>\n<a href=\"https://github.com/chainHero/heroes-service/\" rel=\"noreferrer\">https://github.com/chainHero/heroes-service/</a></p>\n\n<p><a href=\"https://github.com/hyperledger/fabric-sdk-go\" rel=\"noreferrer\">GoLang SDK - Official SDK</a>\n<a href=\"https://github.com/hyperledger/fabric-sdk-go\" rel=\"noreferrer\">https://github.com/hyperledger/fabric-sdk-go</a></p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1518320570, "post_id": 48727958, "comment_id": 84455083, "body": "You&#39;re asking about <code>map[string][]interface{}</code> but in your code it&#39;s <code>map[string][]*entities.Email</code>"}, {"owner": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1518459650, "post_id": 48727958, "comment_id": 84506621, "body": "I assume that entities.Email is interface{} type, right?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1518462049, "post_id": 48727958, "comment_id": 84507933, "body": "Not right: maps in go are not covariant."}], "answers": [{"comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1518321966, "post_id": 48728155, "comment_id": 84455321, "body": "<code>Emails []Email json:&quot;unknown.0&quot;</code> It can be <code>unknown.1</code> too i guess"}, {"owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518322199, "post_id": 48728155, "comment_id": 84455361, "body": "In that case, you can use the dynamic method, unmarshalling to a <code>map[string]interface{}</code> and using type casts (first example above). However, be careful that you check for errors: <code>val, ok := something.(newType)</code>"}], "tags": [], "owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "is_accepted": false, "score": 2, "last_activity_date": 1518321888, "creation_date": 1518321888, "answer_id": 48728155, "question_id": 48727958, "link": "https://stackoverflow.com/questions/48727958/is-go-able-to-unmarshal-to-mapstringinterface/48728155#48728155", "title": "Is Go able to unmarshal to map[string][]interface{}?", "body": "<p>The Go <code>encoding/json</code> package will only unmarshal dynamically to a <code>map[string]interface{}</code>. From there, you will need to use type assertions and casting to pull out the values you want, like so:</p>\n\n<pre><code>func main() {\n    jsonStr := `{\"isSchemaConforming\":true,\"schemaVersion\":0,\"unknown.0\":[{\"email_address\":\"test1@uber.com\"},{\"email_address\":\"test2@uber.com\"}]}`\n\n    dynamic := make(map[string]interface{})\n    json.Unmarshal([]byte(jsonStr), &amp;dynamic)\n\n    firstEmail := dynamic[\"unknown.0\"].([]interface{})[0].(map[string]interface{})[\"email_address\"]\n\n    fmt.Println(firstEmail)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/VEUEIwj3CIC\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VEUEIwj3CIC</a>)</p>\n\n<p>Each time, Go's <code>.(&lt;type&gt;)</code> operator is used to assert and cast the dynamic value to a specific type. This particular code will panic if anything happens to be the wrong type at runtime, like if the contents of <code>unknown.0</code> aren't an array of JSON objects.</p>\n\n<p>The more idiomatic (and robust) way to do this in Go is to annotate a couple structs with <code>json:\"\"</code> tags and have <code>encoding/json</code> unmarshal into them. This avoids all the nasty brittle <code>.([]interface{})</code> type casting:</p>\n\n<pre><code>type Email struct {\n    Email string `json:\"email_address\"`\n}\n\ntype EmailsList struct {\n    IsSchemaConforming bool `json:\"isSchemaConforming\"`\n    SchemaVersion      int  `json:\"schemaVersion\"`\n    Emails []Email `json:\"unknown.0\"`\n}\n\nfunc main() {\n    jsonStr := `{\"isSchemaConforming\":true,\"schemaVersion\":0,\"unknown.0\":[{\"email_address\":\"test1@uber.com\"},{\"email_address\":\"test2@uber.com\"}]}`\n\n    emails := EmailsList{}\n    json.Unmarshal([]byte(jsonStr), &amp;emails)\n\n    fmt.Printf(\"%+v\\n\", emails)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/iS6e0_87P2J\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iS6e0_87P2J</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "edited": false, "score": 0, "creation_date": 1518475106, "post_id": 48731045, "comment_id": 84514539, "body": "Thanks for the help. &quot;unknown.0&quot; would change, it could be any other string. How does deal with that situation?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "edited": false, "score": 0, "creation_date": 1518512255, "post_id": 48731045, "comment_id": 84526071, "body": "what are the options replacing <code>unknown.0</code>. Also please post your actual json format so that we can get the root parameter name to export the vale"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1518353925, "last_edit_date": 1518353925, "creation_date": 1518348800, "answer_id": 48731045, "question_id": 48727958, "link": "https://stackoverflow.com/questions/48727958/is-go-able-to-unmarshal-to-mapstringinterface/48731045#48731045", "title": "Is Go able to unmarshal to map[string][]interface{}?", "body": "<p>A better approach will be to use struct for main schema and then use an slice of email struct for fetching the data for email entities get the values from the same according to requirements. Please find the solution below :-</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Data struct{\n    IsSchemaConforming bool `json:\"isSchemaConforming\"`\n    SchemaVersion float64 `json:\"schemaVersion\"`\n    EmailEntity []Email `json:\"unknown.0\"`\n}\n\n// Email struct\ntype Email struct{\n    EmailAddress string `json:\"email_address\"`\n} \n\nfunc main() {\n    jsonStr := `{\"isSchemaConforming\":true,\"schemaVersion\":0,\"unknown.0\":[{\"email_address\":\"test1@uber.com\"},{\"email_address\":\"test2@uber.com\"}]}`\n\n    var dynamic Data\n    json.Unmarshal([]byte(jsonStr), &amp;dynamic)\n    fmt.Printf(\"%#v\", dynamic)\n}\n</code></pre>\n"}], "owner": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8268, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1518353925, "creation_date": 1518319275, "last_edit_date": 1518338373, "question_id": 48727958, "link": "https://stackoverflow.com/questions/48727958/is-go-able-to-unmarshal-to-mapstringinterface", "title": "Is Go able to unmarshal to map[string][]interface{}?", "body": "<p>Currently, I try to parse JSON to map[string][]interface{}, but unmarshalling returns an error. According to (<a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/</a>), to unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n\n<ul>\n<li>bool, for JSON booleans</li>\n<li>float64, for JSON numbers</li>\n<li>string, for JSON strings\n-[]interface{}, for JSON arrays</li>\n<li>map[string]interface{}, for JSON objects</li>\n<li>nil for JSON null</li>\n</ul>\n\n<p>I wonder if golang is able to unmarshal map[string][]interface{}. The following is code snippet. I am new to Golang, thanks for help in advance.</p>\n\n<pre><code>// emailsStr looks like \"{\"isSchemaConforming\":true,\"schemaVersion\":0,\"unknown.0\":[{\"email_address\":\"test1@uber.com\"},{\"email_address\":\"test2@uber.com\"}]}\"\n\nemailsRaw := make(map[string][]*entities.Email)\nerr := json.Unmarshal([]byte(emailsStr), &amp;emailsRaw)\n</code></pre>\n\n<p>Error message: </p>\n\n<blockquote>\n  <p>&amp;json.UnmarshalTypeError{Value:\"number\", Type:(*reflect.rtype)(0x151c7a0), Offset:44, Struct:\"\", Field:\"\"}</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3351, "user_id": 6633434, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Z3AKA.png?s=128&g=1", "display_name": "Sumit Agarwal", "link": "https://stackoverflow.com/users/6633434/sumit-agarwal"}, "edited": false, "score": 0, "creation_date": 1518295703, "post_id": 48725323, "comment_id": 84449774, "body": "How about if the date is &quot;2-JAN-06&quot;, do note the month is in all caps"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 3351, "user_id": 6633434, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Z3AKA.png?s=128&g=1", "display_name": "Sumit Agarwal", "link": "https://stackoverflow.com/users/6633434/sumit-agarwal"}, "edited": false, "score": 0, "creation_date": 1518296642, "post_id": 48725323, "comment_id": 84450062, "body": "It works too, the matching is case insensitive, I&#39;ve updated the answer. Note that the layout string is still <code>Jan</code>"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1518302745, "last_edit_date": 1518302745, "creation_date": 1518294975, "answer_id": 48725323, "question_id": 48725291, "link": "https://stackoverflow.com/questions/48725291/convert-oracle-time-string-to-time-time-golang/48725323#48725323", "title": "Convert oracle time string to time.Time golang", "body": "<p>As described in <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">the docs</a>, the <code>layout</code> time in <code>time.Parse</code> needs to represent the following year/month/day/etc...: <code>Mon Jan 2 15:04:05 -0700 MST 2006</code></p>\n\n<p>However, you are using <code>Jan 22 2006</code>.</p>\n\n<p>If you change your code to the following, it works:</p>\n\n<pre><code>func main() {\n    test, err := time.Parse(\"2-Jan-2006\", \"26-MAR-2018\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(test)\n    // Prints: 2018-03-26 00:00:00 +0000 UTC\n}\n</code></pre>\n\n<p><strong>Note</strong>: the month (<code>Jan</code>) in the layout is case sensitive, but the month (<code>MAR</code>) in the string to be parsed is case insensitive.</p>\n"}], "owner": {"reputation": 3351, "user_id": 6633434, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Z3AKA.png?s=128&g=1", "display_name": "Sumit Agarwal", "link": "https://stackoverflow.com/users/6633434/sumit-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 0, "accepted_answer_id": 48725323, "answer_count": 1, "score": -1, "last_activity_date": 1562915567, "creation_date": 1518294809, "question_id": 48725291, "link": "https://stackoverflow.com/questions/48725291/convert-oracle-time-string-to-time-time-golang", "title": "Convert oracle time string to time.Time golang", "body": "<p>I am new to golang and trying to convert string date received from oracle DB into time.Time in golang.</p>\n\n<p>Here is the plaground link: <a href=\"https://play.golang.org/p/z3OyC4-DTFA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/z3OyC4-DTFA</a></p>\n\n<pre><code>timeTest, err := time.Parse(\"22-JAN-06\", \"26-JAN-17\")\nif err != nil {\n    fmt.Printf(\"\\n\\npaymentDateAfter: %v\\n\\n\", timeTest)\n} else {\n    fmt.Printf(\"\\n\\npaymentDateErr: %v\\n\\n\", err)\n}\n</code></pre>\n\n<p>Can anybody help me understand the issue. I tried searching it and found many answers in stack overflow, but none of them for this format.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["recursion", "go"], "comments": [{"owner": {"reputation": 43029, "user_id": 7505395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4t4nq.jpg?s=128&g=1", "display_name": "Patrick Artner", "link": "https://stackoverflow.com/users/7505395/patrick-artner"}, "edited": false, "score": 0, "creation_date": 1518294856, "post_id": 48725258, "comment_id": 84449511, "body": "dont recurse for fibo. use something along this line : <a href=\"https://stackoverflow.com/a/3954407/7505395\">stackoverflow.com/a/3954407/7505395</a>  - no recursion just remembers the last 2 fibs w/o excessive use of stack-space"}, {"owner": {"reputation": 384, "user_id": 8965773, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1gPh1.jpg?s=128&g=1", "display_name": "nexla", "link": "https://stackoverflow.com/users/8965773/nexla"}, "reply_to_user": {"reputation": 43029, "user_id": 7505395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4t4nq.jpg?s=128&g=1", "display_name": "Patrick Artner", "link": "https://stackoverflow.com/users/7505395/patrick-artner"}, "edited": false, "score": 0, "creation_date": 1518294975, "post_id": 48725258, "comment_id": 84449543, "body": "Yeah I know that, but I am just curious how come Go compiles it so fast"}, {"owner": {"reputation": 5513, "user_id": 2718801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d4b144cdafa73e1d470362ed8d7c3a9?s=128&d=identicon&r=PG", "display_name": "jhpratt", "link": "https://stackoverflow.com/users/2718801/jhpratt"}, "edited": false, "score": 5, "creation_date": 1518295422, "post_id": 48725258, "comment_id": 84449666, "body": "@nexla Are you wondering about how it <i>compiles</i> fast or how it <i>runs</i> fast? Those are two completely different things."}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 1, "last_activity_date": 1518311159, "last_edit_date": 1518311159, "creation_date": 1518297751, "answer_id": 48725692, "question_id": 48725258, "link": "https://stackoverflow.com/questions/48725258/how-come-go-calculates-fibonacci-recursion-so-fast/48725692#48725692", "title": "How come Go calculates fibonacci recursion so fast?", "body": "<p>Its compiler isn't as smart or mature as C's (at least not yet), but Go is still closer to C in its time performance than Python (space performance is a separate thing, and not what you asked about).  Just being a compiled language instead of an interpreted language gives it a major leg up in time performance over Python (and it is still faster than PyPy in general, but not as much faster).</p>\n\n<p>Why compiled languages generally offer greater time performance than interpreted languages has been thoroughly covered elsewhere.  You can research this question on stackoverflow and elsewhere on the internet.  For example, here's the TL;DR in <a href=\"https://stackoverflow.com/a/1694407/1964690\">one stackoverflow answer</a> to that question:</p>\n\n<blockquote>\n  <p>Native programs run using instructions written for the processor they run on.</p>\n</blockquote>\n\n<p>And here's the TL;DR in <a href=\"https://stackoverflow.com/a/1830215/1964690\">another answer</a>:</p>\n\n<blockquote>\n  <p>Interpreted languages are slower because their method, object and global variable space model is dynamic</p>\n</blockquote>\n\n<p>You can also find plenty of benchmark case studies and results comparing implementations in different languages if you look for them.</p>\n\n<p>Performance improvements to the Go compiler and Go toolchain are also frequently made, which you can read about in the release notes (and elsewhere) such as <a href=\"https://golang.org/doc/go1.8#compiler\" rel=\"nofollow noreferrer\">this excerpt about version 1.8</a>:</p>\n\n<blockquote>\n  <p>The new back end, based on static single assignment form (SSA), generates more compact, more efficient code and provides a better platform for optimizations such as bounds check elimination. The new back end reduces the CPU time required by our benchmark programs by 20-30% on 32-bit ARM systems.</p>\n</blockquote>\n"}], "owner": {"reputation": 384, "user_id": 8965773, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/1gPh1.jpg?s=128&g=1", "display_name": "nexla", "link": "https://stackoverflow.com/users/8965773/nexla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 48725692, "answer_count": 1, "score": -3, "last_activity_date": 1518311159, "creation_date": 1518294552, "last_edit_date": 1518295005, "question_id": 48725258, "link": "https://stackoverflow.com/questions/48725258/how-come-go-calculates-fibonacci-recursion-so-fast", "title": "How come Go calculates fibonacci recursion so fast?", "body": "<p>This is not a correct version of it, I am just playing around Go but I was shocked how fast Go calculated the 42nd(43 actually) number in Fibonacci sequence.</p>\n\n<p>Can someone please explain how come it calculates it this fast? I tried comparing it to python(I know its slow compared to other languages) but python took > 1 minute and I had to break the recursion.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc fib(a uint) uint {\n    if a &lt;= 1 {\n        return 1\n    }\n    return fib(a-1) + fib(a-2)\n}\n\nfunc main() {\n    fmt.Println(fib(42))\n}\n\n\n[ `go run Hello.go` | done: 2.316821835s ]\n433494437\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore", "datastore"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 3827660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7367fbe9fb75e4119c23353191b5838?s=128&d=identicon&r=PG&f=1", "display_name": "Clyde McQueen", "link": "https://stackoverflow.com/users/3827660/clyde-mcqueen"}, "edited": false, "score": 0, "creation_date": 1518370141, "post_id": 48728338, "comment_id": 84467785, "body": "Thanks! Is there a way to get dev_appserver.py to recognize the datastore emulator? Ideally I&#39;d like to get my cli tools &amp; my web app to use the same datastore in localhost for testing."}, {"owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "reply_to_user": {"reputation": 61, "user_id": 3827660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7367fbe9fb75e4119c23353191b5838?s=128&d=identicon&r=PG&f=1", "display_name": "Clyde McQueen", "link": "https://stackoverflow.com/users/3827660/clyde-mcqueen"}, "edited": false, "score": 0, "creation_date": 1518376942, "post_id": 48728338, "comment_id": 84470209, "body": "There might be a way to connect to the standalone Datastore emulator from your App Engine app directly, ignoring <code>dev_appserver.py</code>. Try seeing what environment variables are exposed to the app defined in <code>app.yaml</code>, and see if you can change those to point to the standalone Datastore."}], "tags": [], "owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "is_accepted": false, "score": 0, "last_activity_date": 1518324053, "creation_date": 1518324053, "answer_id": 48728338, "question_id": 48724779, "link": "https://stackoverflow.com/questions/48724779/can-i-build-a-golang-command-line-tool-that-talks-to-a-localhost-appengine-datas/48728338#48728338", "title": "Can I build a golang command-line tool that talks to a localhost appengine datastore?", "body": "<p>You could always use the standalone Datastore emulator.</p>\n\n<p>Install it:</p>\n\n<pre><code>gcloud components install cloud-datastore-emulator\n</code></pre>\n\n<p>Start the emulator (do this in a background shell, the command runs in the foreground): </p>\n\n<pre><code>gcloud beta emulators datastore start\n</code></pre>\n\n<p>And then setup the environment for your application by running:</p>\n\n<pre><code>$(gcloud beta emulators datastore env-init)\n</code></pre>\n\n<p>Then run your app, and it should pick up and connect to the Datastore emulator automatically.</p>\n"}], "owner": {"reputation": 61, "user_id": 3827660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7367fbe9fb75e4119c23353191b5838?s=128&d=identicon&r=PG&f=1", "display_name": "Clyde McQueen", "link": "https://stackoverflow.com/users/3827660/clyde-mcqueen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1518324053, "creation_date": 1518291258, "last_edit_date": 1518299122, "question_id": 48724779, "link": "https://stackoverflow.com/questions/48724779/can-i-build-a-golang-command-line-tool-that-talks-to-a-localhost-appengine-datas", "title": "Can I build a golang command-line tool that talks to a localhost appengine datastore?", "body": "<p>I have a standard appengine + datastore app (not flex) built in golang using these APIs:</p>\n\n<pre><code>google.golang.org/appengine\ngoogle.golang.org/appengine/datastore\n</code></pre>\n\n<p>I'm trying to write a command-line tool in golang to do various batch things with the datastore, such as migrating data, running consistency checks and so forth. The cli tool uses this API:</p>\n\n<pre><code>cloud.google.com/go/datastore\n</code></pre>\n\n<p>I can get the cli tool to talk to my hosted appengine datastore, but I can't figure out how to get it to talk to the localhost dev_appserver.py datastore. The 1st call to datastore <code>datastoreClient.GetAll(ctx, q, nil)</code> always hangs.</p>\n\n<p>I read some of the API code, and it looks like I need to set <code>DATASTORE_EMULATOR_HOST</code> to point to <code>http://localhost:some_port</code>, but I can't get this to work w/ any of the 3 servers that are started up by dev_appserver.py (ports 8000, 8080, 53536).</p>\n\n<p>Am I on the right track? I've read a lot of posts &amp; help, but they're either too old, or talk about appengine flex and so forth.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518288852, "post_id": 48724212, "comment_id": 84447663, "body": "I can&#39;t reproduce this problem. Can you try <code>--workdir=&quot;&#47;go&#47;src&#47;goapp&quot; </code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518291548, "post_id": 48724212, "comment_id": 84448540, "body": "You\u2019re not passing arguments to a shell, don\u2019t add unessecary quotes."}, {"owner": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518468875, "post_id": 48724212, "comment_id": 84511626, "body": "@JimB Ironically, the final solution that made this script work involved adding more quotes... only in the go script instead of the command haha"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518448249, "post_id": 48725819, "comment_id": 84499185, "body": "Doing this turns the error into <code>docker: Error response from daemon: OCI runtime create failed: container_linux.go:296: starting container process caused &quot;exec: \\&quot;go build -v\\&quot;: executable file not found in $PATH&quot;: unknown</code>"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518464372, "post_id": 48725819, "comment_id": 84509203, "body": "@JaimeWissner If you haven&#39;t done this already: right before <code>cmd.Run()</code>, try calling fmt.Printf(&quot;%v\\n&quot;, cmd.Args)` and make sure every arg looks looks right and there are no escapes or quotes that shouldn&#39;t be there"}, {"owner": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518467576, "post_id": 48725819, "comment_id": 84510937, "body": "Printed it, and the command looks perfect. No escapes or quotes, and if I copy and run the command, it runs fine."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518468282, "post_id": 48725819, "comment_id": 84511306, "body": "@JaimeWissner Did you make any other changes besides removing the single quotes? Could you give an example of how you&#39;re calling the Go script on the command line? If there&#39;s much new info/code, you could either call this question done on the quotes and start a new one, or update your question with the new info."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518468611, "post_id": 48725819, "comment_id": 84511475, "body": "@JaimeWissner The error you reported comes out of <code>runc</code>: <a href=\"https://github.com/opencontainers/runc/blob/master/libcontainer/container_linux.go\" rel=\"nofollow noreferrer\">github.com/opencontainers/runc/blob/master/libcontainer/&hellip;</a> , but I doubt that really helps you -- probably still a quote/escape/parse issue somewhere"}, {"owner": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518469011, "post_id": 48725819, "comment_id": 84511710, "body": "Actually, I just found the answer to that part of it. The trick was taking the error literally. I told it run &quot;go build -v&quot;, and it, indeed, tried to run &quot;go build -v&quot;. When it couldn&#39;t find a binary called &quot;go build -v&quot;, it shot out that error. Changing my command to be &quot;go&quot;, &quot;build&quot;, &quot;-v&quot; made it work."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "edited": false, "score": 0, "creation_date": 1518476105, "post_id": 48725819, "comment_id": 84514886, "body": "@JaimeWissner glad you got it working - I&#39;ll update my answer with that note, or you can put it in an update/edit/solution section of your question"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 2, "last_activity_date": 1518476199, "last_edit_date": 1518476199, "creation_date": 1518298623, "answer_id": 48725819, "question_id": 48724212, "link": "https://stackoverflow.com/questions/48724212/docker-run-w-giving-unexpected-error-when-run-from-go-script/48725819#48725819", "title": "docker run -w giving unexpected error when run from go script", "body": "<p>Remove the quoted quotes.  As stated in <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">the exec package's documentation</a>, Go's standard lib os/exec package does not invoke the shell to execute a Cmd:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells. The package behaves more like C's \"exec\" family of functions.</p>\n</blockquote>\n\n<p>Unless you're calling the shell in your command, there's no shell being invoked to process and remove those quotes.  </p>\n\n<p>For example, this:</p>\n\n<pre><code>\"-v='%s'\"\n</code></pre>\n\n<p>Should be this:</p>\n\n<pre><code>\"-v=%s\"\n</code></pre>\n\n<hr>\n\n<p>Update from comments: OP also found and fixed a second issue:</p>\n\n<pre><code>\"go build -v\"\n</code></pre>\n\n<p>needed to be split up into separate arguments:</p>\n\n<pre><code>\"go\", \"build\", \"-v\"\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 2733819, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/615268366/picture?type=large", "display_name": "Jaime Wissner", "link": "https://stackoverflow.com/users/2733819/jaime-wissner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 48725819, "answer_count": 1, "score": 0, "last_activity_date": 1518476199, "creation_date": 1518287565, "last_edit_date": 1518289103, "question_id": 48724212, "link": "https://stackoverflow.com/questions/48724212/docker-run-w-giving-unexpected-error-when-run-from-go-script", "title": "docker run -w giving unexpected error when run from go script", "body": "<p>I'm writing a very simple script that just formats a build command via docker for go apps. It formats the command like this:</p>\n\n<pre><code>docker run --rm -v c:/Users/me/go/src/goapp:/go/src/goapp -w /go/src/goapp -e GOOS=os -e GOARCH=arch image go build -v -o outputname\n</code></pre>\n\n<p>When running this, however I get the following:</p>\n\n<blockquote>\n  <p>docker: Error response from daemon: the working directory ' /go/src/goapp' is invalid, it needs to be an absolute path</p>\n</blockquote>\n\n<p>I tried reformatting it like this:</p>\n\n<pre><code>docker run --rm -v=\"c:/Users/me/go/src/goapp:/go/src/goapp\" -w=\"/go/src/goapp\" -e=\"GOOS=os\" -e\"GOARCH=arch\" image go build -v -o outputname\n</code></pre>\n\n<p>and get the same error, only the \"invalid\" working directory is <code>\"/go/src/goapp\"</code></p>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"runtime\"\n    \"strings\"\n)\n\nfunc constructCmd(volumeMap, workingDir, goos, goarch, output, image string) []string {\n    finalCmd := append([]string{\"run\", \"--rm\"},\n        fmt.Sprintf(\"-v='%s'\", volumeMap),\n        fmt.Sprintf(\"-w='%s'\", workingDir),\n        fmt.Sprintf(\"-e='%s'\", goos),\n        fmt.Sprintf(\"-e='%s'\", goarch),\n    )\n\n    finalCmd = append(finalCmd, image, \"go build -v\")\n\n    if output != \"\" {\n        finalCmd = append(finalCmd, fmt.Sprintf(\"-o %s\", output))\n    }\n\n    return finalCmd\n}\n\nfunc main() {\n    // Parse flags\n    osPtr := flag.String(\"os\", \"windows\", \"Target distribution\")\n    archPtr := flag.String(\"arch\", \"amd64\", \"Target distribution\")\n    outputPtr := flag.String(\"out\", \"\", \"Output file name\")\n    flag.Parse()\n\n    fmt.Printf(\"Building for %s/%s:\\n\", *osPtr, *archPtr)\n\n    goos := \"GOOS=\" + *osPtr\n    goarch := \"GOARCH=\" + *archPtr\n\n    pwd, _ := os.Getwd()\n    if runtime.GOOS == \"windows\" {\n        pwd = strings.Replace(pwd, \"C\", \"c\", 1)\n        pwd = strings.Replace(pwd, \"\\\\\", \"/\", -1)\n    }\n    workingDir := pwd[strings.Index(pwd, \"/go\"):]\n    volumeMap := fmt.Sprintf(\"%s:%s\", pwd, workingDir)\n\n    var image string\n    if len(flag.Args()) == 0 {\n        image = \"golang\"\n    } else {\n        image = flag.Args()[0]\n    }\n\n    execCmd := constructCmd(volumeMap, workingDir, goos, goarch, *outputPtr, image)\n\n    cmd := exec.Command(\"docker\", execCmd...)\n    cmdOutput := &amp;bytes.Buffer{}\n    cmd.Stdout = cmdOutput\n    cmd.Stderr = cmdOutput\n    err := cmd.Run()\n    if err != nil {\n        os.Stderr.WriteString(err.Error())\n    }\n    fmt.Print(string(cmdOutput.Bytes()))\n}\n</code></pre>\n\n<p>To note, if I run this command directly, it works no problem. No error. So this isn't a docker problem, it's a go problem. What could cause this error?</p>\n"}, {"tags": ["go", "lock-free"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518285491, "post_id": 48723822, "comment_id": 84446496, "body": "You should include the race detector output."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518286346, "post_id": 48723822, "comment_id": 84446761, "body": "Your goroutines will be stepping all over each other between the <code>LoadUint32</code> and the <code>CompareAndSwapUint32</code>, so yes, this is very very racy. You should really just have a mutex, just because you&#39;re reading and writing a value atomically does not mean that you&#39;re preventing anyone else from reading and writing them."}, {"owner": {"reputation": 43, "user_id": 3504767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411f32fe096ac485cf0fdfbfa8fddb?s=128&d=identicon&r=PG&f=1", "display_name": "Hennessy", "link": "https://stackoverflow.com/users/3504767/hennessy"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518286665, "post_id": 48723822, "comment_id": 84446862, "body": "If goroutine step each other they collide on CAS, and CAS reads a new value of &amp;c.write and if it not the same as when reading, then simply read it again in cycle... It exactly mean that you can&#39;t write because of &quot;write index&quot; that you push father on array."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1518340461, "last_edit_date": 1518340461, "creation_date": 1518292796, "answer_id": 48725013, "question_id": 48723822, "link": "https://stackoverflow.com/questions/48723822/golang-lock-free-array-with-swap/48725013#48725013", "title": "Golang lock-free array with swap", "body": "<p>I can change your code to check the just-written <code>c.writer</code>:</p>\n\n<pre><code>if atomic.CompareAndSwapUint32(&amp;c.writer, writer, (writer+1)&amp;1) {\n  newWriter := atomic.LoadUint32(&amp;c.writer)\n  if newWriter != (writer+1)&amp;1 {\n    panic(fmt.Errorf(\"wrote %d, but writer is %d\", (writer+1)&amp;1, newWriter))\n  }\n  //c.config[writer] = new\n  atomic.StoreUint32(&amp;c.reader, writer)\n  return\n}\n</code></pre>\n\n<p>Manually setting <code>GOMAXPROCS</code> (and the number of goroutines) to just 3, I get the following after running it just a few times:</p>\n\n<pre><code>$ go run main.go  \npanic: wrote 1, but writer is 0\n\ngoroutine 6 [running]:\nmain.(*checkConfigVersions).set(0xc42000a060, 0x1, 0xc4200367a0)\n    main.go:36 +0x16d\nmain.main.func1(0xc42000a060, 0xc420018110, 0x1)\n    main.go:58 +0x63\ncreated by main.main\n    main.go:56 +0xd6\nexit status 2\n</code></pre>\n\n<p>The main reason is that <code>GOMAXPROCS</code> sets the number of OS threads to use. These are not controlled by Go (Go just schedules goroutines onto OS threads). Instead, the OS gets to schedule OS threads however it wants.</p>\n\n<p>This means that one of the goroutines will <code>CAS(1, 1, 0)</code>, then be suspended by the OS. During that time, another goroutine will go through and <code>CAS(0, 0, 1)</code>. This allows the third goroutine to perform <code>CAS(1, 1, 0)</code> and continues at the same time as the original goroutine is scheduled for execution again. Bam! Both of them are trying to write to the same <code>config[writer]</code>.</p>\n\n<p>Atomicity is great when you want to avoid a mutex, but should not be used to perform synchronization in this type of case.</p>\n\n<p>I'm not quite sure what your original scenario is, but I'm fairly confident going with a mutex will save you a lot of pain.</p>\n"}], "owner": {"reputation": 43, "user_id": 3504767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411f32fe096ac485cf0fdfbfa8fddb?s=128&d=identicon&r=PG&f=1", "display_name": "Hennessy", "link": "https://stackoverflow.com/users/3504767/hennessy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 818, "favorite_count": 0, "accepted_answer_id": 48725013, "answer_count": 1, "score": 3, "last_activity_date": 1518340461, "creation_date": 1518285205, "last_edit_date": 1518285885, "question_id": 48723822, "link": "https://stackoverflow.com/questions/48723822/golang-lock-free-array-with-swap", "title": "Golang lock-free array with swap", "body": "<p>I have a two slot array that need to swap between slots when producer set it and always return a valid slot to consumer. As for side of atomic operation logic I can't imagine situation when two goroutine write to the same array slot, but race detector think otherwise. Does anyone can explain me, where is the bug? </p>\n\n<pre><code>type checkConfig struct {\n    timeout   time.Time\n}\n\ntype checkConfigVersions struct {\n    config [2]*checkConfig\n    reader uint32\n    writer uint32\n}\n\nfunc (c *checkConfigVersions) get() *checkConfig {\n    return c.config[atomic.LoadUint32(&amp;c.reader)]\n}\n\nfunc (c *checkConfigVersions) set(new *checkConfig) {\n    for {\n        reader := atomic.LoadUint32(&amp;c.reader)\n        writer := atomic.LoadUint32(&amp;c.writer)\n        switch diff := reader ^ writer; {\n        case diff == 0:\n            runtime.Gosched()\n        case diff == 1:\n            if atomic.CompareAndSwapUint32(&amp;c.writer, writer, (writer+1)&amp;1) {\n                c.config[writer] = new\n                atomic.StoreUint32(&amp;c.reader, writer)\n                return\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Data race happened on <code>c.config[writer] = new</code>, but for my point of view it's not possible.</p>\n\n<pre><code>fun main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n\n    var wg sync.WaitGroup\n\n    ccv := &amp;checkConfigVersions{reader: 0, writer: 1}\n\n    for i := 0; i &lt; runtime.NumCPU(); i++ {\n        wg.Add(100)\n        go func(i int) {\n            for j := 0; j &lt; 100; j++ {\n                ccv.set(&amp;checkConfig{})\n                wg.Done()\n            }\n        }(i)\n    }\n\n    wg.Wait()\n    fmt.Println(ccv.get())\n}\n</code></pre>\n\n<p>Data race detector output:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nWrite at 0x00c42009a020 by goroutine 12:\n  main.(*checkConfigVersions).set()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:118 +0xd9\n  main.main.func1()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:42 +0x60\n\nPrevious write at 0x00c42009a020 by goroutine 11:\n  main.(*checkConfigVersions).set()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:118 +0xd9\n  main.main.func1()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:42 +0x60\n\nGoroutine 12 (running) created at:\n  main.main()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:40 +0x159\n\nGoroutine 11 (running) created at:\n  main.main()\n      /Users/apple/Documents/Cyber/Go/proxy/main.go:40 +0x159\n==================\n</code></pre>\n\n<p>And if you try to read it with <code>ccv.read()</code>, you catch the another race but between <em>read</em> and <em>write</em> on the same array slot...</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518282966, "post_id": 48723412, "comment_id": 84445640, "body": "-22 isn\u2019t a valid rune"}, {"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518283128, "post_id": 48723412, "comment_id": 84445705, "body": "Hi @JimB if I use int8 I get to same result. The point is how to store negative values on a string a get it back."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518283557, "post_id": 48723412, "comment_id": 84445858, "body": "Bytes are signed in java so when you print an individual byte you can get something in the range <code>[-128, 127]</code>. Go wants uint8, which is <code>234</code> in your case."}, {"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518284180, "post_id": 48723412, "comment_id": 84446093, "body": "Hi @Marc I read in on godocs <a href=\"https://golang.org/pkg/builtin/#rune\" rel=\"nofollow noreferrer\">link</a> that runes are int32 so the range is ok. I don&#39;t understand why I get a diferent values. If in the sample code we change rune to int32 the result will be the same"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518285255, "post_id": 48723412, "comment_id": 84446428, "body": "ok, the range is fine but you&#39;re still giving it a negative number when you&#39;re trying to say character value <code>234</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518285359, "post_id": 48723412, "comment_id": 84446452, "body": "It\u2019s not that -22 isn\u2019t a valid int32 value, it\u2019s that it\u2019s not a valid Unicode character."}], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "edited": false, "score": 0, "creation_date": 1518365186, "post_id": 48725578, "comment_id": 84465990, "body": "Hi @peterSO thanks for your answer. I&#39;ll refactor the libray using int8 arrays instead string."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "edited": false, "score": 0, "creation_date": 1518366175, "post_id": 48725578, "comment_id": 84466302, "body": "@Andr&#233;Andrade: Java Strings are encoded as UTF-16 (uint16). &quot;A String represents a string in the UTF-16 format.&quot; <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/String.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/7/docs/api/java/lang/String.html</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1518302900, "last_edit_date": 1518302900, "creation_date": 1518296851, "answer_id": 48725578, "question_id": 48723412, "link": "https://stackoverflow.com/questions/48723412/conversion-from-runes-int8-array-to-string-and-vice-versa/48725578#48725578", "title": "Conversion from runes / int8 array to string and vice versa", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Conversions</a></p>\n  \n  <p>Conversions to and from a string type</p>\n  \n  <p>Converting a signed or unsigned integer value to a string type yields\n  a string containing the UTF-8 representation of the integer. Values\n  outside the range of valid Unicode code points are converted to\n  \"\\uFFFD\".</p>\n  \n  <p>Converting a slice of runes to a string type yields a string that is\n  the concatenation of the individual rune values converted to strings.</p>\n</blockquote>\n\n<hr>\n\n<p>Type <code>byte</code> in Go is an alias for type <code>uint8</code>.</p>\n\n<p>Type <code>rune</code>, a Unicode code point (24-bit unsigned integer), is an alias for <code>int32</code>.</p>\n\n<p>Go encodes Unicode code points (<code>rune</code>s) as UTF-8 encoded <code>string</code>s.</p>\n\n<p>For your example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode\"\n)\n\nfunc main() {\n\n    // Unicode code points are 24-bit unsigned integers\n    runes := make([]rune, 3)\n    runes[0] = 97\n    runes[1] = -22 // invalid Unicode code point\n    runes[2] = 99\n    fmt.Println(runes)\n\n    // Encode Unicode code points as UTF-8\n    // Invalid code points converted to Unicode replacement character (U+FFFD)\n    s := string(runes)\n    fmt.Println(s)\n\n    // Decode UTF-8 as Unicode code points\n    for _, r := range s {\n        fmt.Println(r, string(r), r == unicode.ReplacementChar)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/AZUBd2iZp1F\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AZUBd2iZp1F</a></p>\n\n<p>Output:</p>\n\n<pre><code>[97 -22 99]\na\ufffdc\n97 a false\n65533 \ufffd true\n99 c false\n</code></pre>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n\n<p><a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">The Go Blog: Strings, bytes, runes and characters in Go</a></p>\n\n<p><a href=\"http://unicode.org/\" rel=\"nofollow noreferrer\">The Unicode Consortium</a></p>\n"}], "owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1283, "favorite_count": 1, "accepted_answer_id": 48725578, "answer_count": 1, "score": 3, "last_activity_date": 1518340930, "creation_date": 1518282796, "last_edit_date": 1518340930, "question_id": 48723412, "link": "https://stackoverflow.com/questions/48723412/conversion-from-runes-int8-array-to-string-and-vice-versa", "title": "Conversion from runes / int8 array to string and vice versa", "body": "<p>I'm porting a library from Java to Go. This library passes all parameters and returns as strings, and I must maintain this way due subsequent steps. I noticed when I cast a rune/int8 array to string and I convert back to rune/int8 array I get different values. I believe that is caused by Unicode characters. Is there a way to get the same values?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {  \n\n    runes := make([]rune,3)\n    runes[0] = 97\n    runes[1] = -22\n    runes[2] = 99\n\n    s := string(runes)\n\n    fmt.Println(runes)  \n    for _,r := range(s) {\n        fmt.Println(r)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[97 -22 99]\n97\n65533\n99\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518290465, "post_id": 48720325, "comment_id": 84448211, "body": "@Flimzy - I&#39;m not sure if you&#39;ve overlooked the example or I&#39;m not understanding, but the example has each method requiring the result from the previous one so they can&#39;t execute in parallel."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518453057, "post_id": 48720325, "comment_id": 84502677, "body": "If you want steps executed sequentially, don&#39;t use concurrency. Concurrent is the opposite of sequential."}, {"owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518602596, "post_id": 48720325, "comment_id": 84570087, "body": "@Adrian - yes I know; that wasn&#39;t my question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518611455, "post_id": 48720325, "comment_id": 84576042, "body": "If you know that, then you know the answer to your question as well."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 6, "last_activity_date": 1518302838, "last_edit_date": 1518302838, "creation_date": 1518262867, "answer_id": 48720360, "question_id": 48720325, "link": "https://stackoverflow.com/questions/48720325/use-of-goroutines-when-steps-are-sequential/48720360#48720360", "title": "Use of goroutines when steps are sequential", "body": "<p>There's nothing standard that would say yes or no to this question.</p>\n\n<p>Although you can do it correctly this way, it is much simpler to stick to plain sequential execution.</p>\n\n<p>Three reasons come to mind:</p>\n\n<ul>\n<li><strong>this is still sequential</strong>: you're waiting for every single goroutine sequentially, so this buys you nothing. Performance probably doesn't change much if it's only doing an http request, both cases will spend most of their time waiting for the response.</li>\n<li><strong>error handling</strong> is much simpler if you just get <code>result, err := invoke; if err != nil ....</code> rather than having to pass both results and errors through channels</li>\n<li><strong>over-generalization</strong> is a more apt word than \"future proofing\". If you need to call your <code>invoke</code> methods asynchronously in the future, then change your code in the future. It will be just as easy then to add asynchronous wrappers around your functions.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 1213174, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5QTy2.jpg?s=128&g=1", "display_name": "Igor Khristenko", "link": "https://stackoverflow.com/users/1213174/igor-khristenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1518269242, "creation_date": 1518269242, "answer_id": 48721304, "question_id": 48720325, "link": "https://stackoverflow.com/questions/48720325/use-of-goroutines-when-steps-are-sequential/48721304#48721304", "title": "Use of goroutines when steps are sequential", "body": "<p>You could use a channel like buf, or use []string (slice of strings urls). You don't get any benefit from gorutines, if you need only sequential execution, because we couldn't control goroutine when it's start. </p>\n\n<p>But we can ask then don't wait <code>runtime.Gosched()</code></p>\n\n<p>From documentation:\nGosched yields the processor, allowing other goroutines to run. It does not suspend the current goroutine, so execution resumes automatically.</p>\n\n<p>Example of sequential execution:</p>\n\n<pre><code>package main\n\nfunc main() {\n    urls := []string{\n        \"https://google.com\",\n        \"https://yahoo.com\",\n        \"https://youtube.com\",\n    }\n    buf := make([][]byte, 0, len(urls))\n    for _, v := range urls {\n        buf = append(buf, sendRequest(v))\n    }\n}\n\nfunc sendRequest(url string) []byte {\n    //send\n    return []byte(\"\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 149, "user_id": 9315361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2986379ea47d8e73acfcba86c9059b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrik Iselind", "link": "https://stackoverflow.com/users/9315361/patrik-iselind"}, "is_accepted": false, "score": -1, "last_activity_date": 1518281376, "creation_date": 1518281376, "answer_id": 48723164, "question_id": 48720325, "link": "https://stackoverflow.com/questions/48720325/use-of-goroutines-when-steps-are-sequential/48723164#48723164", "title": "Use of goroutines when steps are sequential", "body": "<p>For the solution as such, I see no gain by solving your problem the way you are in the real world. That doesn't mean there isn't gain in your solution. If you're after practice for example synchronising go routines, then you have a plethora of possibilities experimenting and learning.</p>\n\n<p>So to me this is far from a clear no, but no clear yes either. I would refrain from saying maybe, it depends on what exactly your after. Are you after actually solving a problem or learning?</p>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1518502197, "creation_date": 1518502197, "answer_id": 48760476, "question_id": 48720325, "link": "https://stackoverflow.com/questions/48720325/use-of-goroutines-when-steps-are-sequential/48760476#48760476", "title": "Use of goroutines when steps are sequential", "body": "<p>I am a little bit late to the party but I think I still have something to share.</p>\n\n<p>Before answering the question, I would like to dive a little into the Go Proverb, <em>Concurrency is not parellism</em>. It is a very common misunderstanding of goroutine and Go's language feature that when people thinking of goroutine, they thinks about the ability of being parell.</p>\n\n<p>But as Rob Pike pointed out in many Go Talks, what Go and goroutine auctually provides, is concurency. <strong>Concurency is a model of better interepting the real world, a way and a structure of code, of how code interact</strong>.</p>\n\n<p>So back to the question. Should goroutine be used when steps are sequential? It depends on the design. If your code compose of individual parts that talks to each other very naturally, or if some of your code preserve a state and frequently <code>return</code> just does not make sense, or if your code fits in any other concurency design, it is perfectly fine to use goroutine and channel and <code>select</code> statement. Rob Pike, again, gives a Go Talk on a lexer used by now Go's <code>text/template</code> where the lexer uses a goroutine but the parser, obviously, only use the lexer sequentially. He stated that by using goroutine and channel, at cost of a little performance, a better API is acheived.</p>\n\n<p>But on the other hand, in your example and probably what you are thinking about (codes that may require future parellism), I agree with @Marc. Stick for blocking call, at least for now.</p>\n"}], "owner": {"reputation": 4281, "user_id": 260574, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/ooHys.png?s=128&g=1", "display_name": "n00b", "link": "https://stackoverflow.com/users/260574/n00b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 0, "accepted_answer_id": 48720360, "answer_count": 4, "score": 0, "last_activity_date": 1518502197, "creation_date": 1518262598, "question_id": 48720325, "link": "https://stackoverflow.com/questions/48720325/use-of-goroutines-when-steps-are-sequential", "title": "Use of goroutines when steps are sequential", "body": "<p>I feel like the answer to my question is no but asking for certainty as I've only started playing around with Go for a few days. Should we encapsulate IO bound tasks (like http requests) into goroutines even if it was to be used in a sequential use case?</p>\n\n<p>Here's my naive example. Say I have a method that makes 3 http requests but need to be executed sequentially. Is there any benefit in creating the <code>invoke</code> methods as goroutines? I understand the example below would actually take a performance hit.</p>\n\n<pre><code>func myMethod() {\n   chan1 := make(chan int)\n   chan2 := make(chan int)\n   chan3 := make(chan int)\n\n   go invoke1(chan1)\n\n   res1 := &lt;-chan1\n   invoke2(res1, chan2)\n\n   res2 := &lt;-chan2\n   invoke3(res2, chan3)\n\n   // Do something with &lt;-chan3\n}\n</code></pre>\n\n<p>One possible reason that comes to mind is to future proof the <code>invoke</code> methods for when they're called in a concurrent context later on when other develops start re-using the method. Any other reasons?</p>\n"}, {"tags": ["mongodb", "pointers", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518256807, "post_id": 48719457, "comment_id": 84437867, "body": "You&#39;re using a value receiver which means the methods on it cannot modify the object. You need to use a pointer receiver instead: <code>func (d *Database) NewSession() error</code>. Please see the duplicate question for more details."}, {"owner": {"reputation": 1, "user_id": 6519307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff58d98d3d7a19b89e2ef9a79960de7b?s=128&d=identicon&r=PG&f=1", "display_name": "Nada3", "link": "https://stackoverflow.com/users/6519307/nada3"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518256939, "post_id": 48719457, "comment_id": 84437906, "body": "Thanks a lot for your answer I juste saw that.sorry for making you waste your time :("}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518258130, "post_id": 48719457, "comment_id": 84438241, "body": "Aside: use the net/url package to build URLs."}], "owner": {"reputation": 1, "user_id": 6519307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff58d98d3d7a19b89e2ef9a79960de7b?s=128&d=identicon&r=PG&f=1", "display_name": "Nada3", "link": "https://stackoverflow.com/users/6519307/nada3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "closed_date": 1518256952, "answer_count": 0, "score": 0, "last_activity_date": 1518256627, "creation_date": 1518256627, "question_id": 48719457, "link": "https://stackoverflow.com/questions/48719457/pointer-get-destroyed-after-struct-function-end", "closed_reason": "Duplicate", "title": "Pointer get destroyed after struct function end", "body": "<p>I am Golang beginner so sorry If my question is stupid :|\nI created a class to access simply Database (MongoDB)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package network\n\nimport (\n    \"bytes\"\n    \"gopkg.in/mgo.v2\"\n)\n\ntype DatabaseConfig struct {\n    Host        string  `yaml:mongo_db_host`\n    Port        string  `yaml:mongo_db_port`\n    Name        string  `yaml:mongo_db_name`\n    Username    string  `yaml:mongo_db_user`\n    Password    string  `yaml:mongo_db_pass`\n}\n\ntype Database struct {\n    Session     *mgo.Session\n    Config      DatabaseConfig\n    IsOpen      bool\n}\n\nfunc (d Database) NewSession() error {\n    url := bytes.Buffer{}\n    url.WriteString(\"mongodb://\")\n\n    if d.Config.Username != \"\" &amp;&amp; d.Config.Password != \"\" {\n        url.WriteString(d.Config.Username)\n        url.WriteString(\":\")\n        url.WriteString(d.Config.Password)\n        url.WriteString(\"@\")\n    }\n    if d.Config.Host != \"\" {\n        url.WriteString(d.Config.Host)\n    }\n    if d.Config.Port != \"\" {\n        url.WriteString(\":\")\n        url.WriteString(d.Config.Port)\n    }\n    if d.Config.Name != \"\" {\n        url.WriteString(\"/\")\n        url.WriteString(d.Config.Name)\n    }\n\n    var err error\n    d.Session, err = mgo.Dial(url.String())\n    if err == nil {\n        d.IsOpen = true\n    }\n\n    return err\n}\n\nfunc (d Database) GetSession() *mgo.Session {\n    return d.Session\n}\n\nfunc (d Database) CloseSession() {\n    d.Session.Close()\n    d.IsOpen = false\n}\n\nfunc (d Database) GetConfig() DatabaseConfig {\n    return d.Config\n}\n\nfunc (d Database) SetConfig(config DatabaseConfig) {\n    d.Config = config   \n}\n</code></pre>\n\n<p>I create a new db like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db_config := network.DatabaseConfig{\n    Host: \"localhost\",\n    Port: \"27017\",\n    Name: \"meuporg\",\n}\ndb := network.Database{}\ndb.SetConfig(db_config)\n\nerr = db.NewSession()\nlog.Fatal(db.GetSession())\n\nglbContainer.DB = db\n</code></pre>\n\n<p>And each time it builds and returns me \"nil\", I tried to log db.Session inside the function and this returns me the correct structure.</p>\n\n<p>I think I am doing something wrong with pointers but I don't see what.\nCan you help me understanding what is going wrong ?\nThanks :)</p>\n"}, {"tags": ["go", "cookies", "timestamp"], "comments": [{"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 0, "creation_date": 1518228087, "post_id": 48716283, "comment_id": 84432283, "body": "Please include <code>firstCookie</code> and <code>secondCookie</code>&#39;s definitions and any related code. You probably forgot to set the expires attribute (it&#39;s optional as without one it is called a <i>session cookie</i> where it is deleted when the browser is closed)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9340948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ddca41b821b262ff17110f4735e317?s=128&d=identicon&r=PG&f=1", "display_name": "zottelchin", "link": "https://stackoverflow.com/users/9340948/zottelchin"}, "edited": false, "score": 0, "creation_date": 1518255500, "post_id": 48719182, "comment_id": 84437504, "body": "Thank you for the explanation :)"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 0, "last_activity_date": 1518254560, "creation_date": 1518254560, "answer_id": 48719182, "question_id": 48716283, "link": "https://stackoverflow.com/questions/48716283/golang-cookies-has-empty-timestamp/48719182#48719182", "title": "Golang cookies has empty timestamp", "body": "<p>Cookies come in two flavors: The once you receive in a <code>Set-Cookie</code> header and the ones you send in a <code>Cookie</code> header. Only <code>Set-Cookie</code> header cookies have expiration times and various fields while <code>Cookie</code> header type cookies are plain name,value tuples. and that's what a cookiejar returns because that's what included in the Cookie header.</p>\n\n<p>The default cookie jar implementation of the stdlib does not provide a mechanism to extract all cookies or fields other than name and value. If you need that information use any other open source cookie jar implementation.</p>\n\n<p>(Note that the whole purpose of the stdlib cookie jar implementation is to transparently handle cookies, even through redirections. It is not a solution to collect information about incomming Set-Cookie header and the various values sent in them.)</p>\n"}], "owner": {"reputation": 11, "user_id": 9340948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ddca41b821b262ff17110f4735e317?s=128&d=identicon&r=PG&f=1", "display_name": "zottelchin", "link": "https://stackoverflow.com/users/9340948/zottelchin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 48719182, "answer_count": 1, "score": 0, "last_activity_date": 1518254560, "creation_date": 1518225465, "last_edit_date": 1518252134, "question_id": 48716283, "link": "https://stackoverflow.com/questions/48716283/golang-cookies-has-empty-timestamp", "title": "Golang cookies has empty timestamp", "body": "<p>I'm wirting a go programm that needs to login to a website to get some data. The login process is done, but now i have the problem that i don't get access to the protected page with the cookie i got from the login form. After examing them and comparing to the ones my browser gets, i noticed that my program gets cookies with \"empty\" timestamps. Can someone point out, how i get the cookie with a correct timestamp? That would be fantastic. </p>\n\n<p>This is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"html\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/http/cookiejar\"\n    \"net/url\"\n    \"regexp\"\n    \"strings\"\n    \"time\"\n)\n\nvar CookieJar *cookiejar.Jar\nvar httpClient *http.Client\n\nfunc dbgPrintCurCookies(CurCookies []*http.Cookie) {\n    var cookieNum int = len(CurCookies)\n    log.Printf(\"cookieNum=%d\", cookieNum)\n    for i := 0; i &lt; cookieNum; i++ {\n        var curCk *http.Cookie = CurCookies[i]\n        //log.Printf(\"curCk.Raw=%s\", curCk.Raw)\n        log.Printf(\"Cookie [%d]\", i)\n        log.Printf(\"Name\\t=%s\", curCk.Name)\n        log.Printf(\"Value\\t=%s\", curCk.Value)\n        log.Printf(\"Path\\t=%s\", curCk.Path)\n        log.Printf(\"Domain\\t=%s\", curCk.Domain)\n        log.Printf(\"Expires\\t=%s\", curCk.Expires)\n        log.Printf(\"RawExpires=%s\", curCk.RawExpires)\n        log.Printf(\"MaxAge\\t=%d\", curCk.MaxAge)\n        log.Printf(\"Secure\\t=%t\", curCk.Secure)\n        log.Printf(\"HttpOnly=%t\", curCk.HttpOnly)\n        log.Printf(\"Raw\\t=%s\", curCk.Raw)\n        log.Printf(\"Unparsed=%s\", curCk.Unparsed)\n    }\n}\n\nfunc main() {\n    CookieJar, _ = cookiejar.New(nil)\n\n    httpClient := &amp;http.Client{\n        Jar:     CookieJar,\n        Timeout: 10 * time.Second,\n        CheckRedirect: func(req *http.Request, via []*http.Request) error {\n            return http.ErrUseLastResponse\n        }}\n\n    LSFRedirURL := \"\"\n    pw := \"\n    us := \"\"\n    LoginURL := \"login website ?j_password=\" + pw + \"&amp;j_username=\" + us\n    GetFinalCookieURL := \"\"\n\n\n\n    //get first cookie\n    nextURL := LSFRedirURL\n    for i := 0; i &lt; 10; i++ {\n        resp, _ := httpClient.Get(nextURL)\n        // fmt.Println(\"StatusCode:\", resp.StatusCode)\n        // fmt.Println(resp.Request.URL)\n        if resp.StatusCode == 200 {\n            // fmt.Println(\"Done!\")\n            break\n        } else {\n            nextURL = resp.Header.Get(\"Location\")\n        }\n    }\n\n    //safe first cookie\n    url1, _ := url.Parse(\"first cookie website\")\n    firstCookie := CookieJar.Cookies(url1)[0]\n    fmt.Println(\"First Cookie :\\\\)\")\n\n    //getting second cookie and params\n    // var cam []string\n    var resp *http.Response\n    nextURL = LoginURL\n    for i := 0; i &lt; 10; i++ {\n        resp, _ = httpClient.Post(nextURL, \"\", nil)\n        // fmt.Println(\"StatusCode:\", resp.StatusCode)\n        // fmt.Println(resp.Request.URL)\n        // cam = append(cam, nextURL)\n        if resp.StatusCode == 200 {\n            fmt.Println(\"Done!\")\n            break\n        } else {\n            nextURL = resp.Header.Get(\"Location\")\n        }\n    }\n\n    //second cookie\n    url2, _ := url.Parse(\"website second cookie is from\")\n    secondCookie := CookieJar.Cookies(url2)[0]\n    fmt.Println(\"Second Cookie :\\\\)\")\n\n    //params\n    defer resp.Body.Close()\n    c, _ := ioutil.ReadAll(resp.Body)\n    data := html.UnescapeString(string(c))\n    //fmt.Println(data)\n    getvalue := regexp.MustCompile(\"value=\\\".*\\\"\")\n    values := getvalue.FindAllStringSubmatch(data, -1)\n    values[0][0] = strings.TrimSuffix(values[0][0], \"\\\"\")\n    values[0][0] = strings.TrimPrefix(values[0][0], \"value=\\\"\")\n    values[1][0] = strings.TrimSuffix(values[1][0], \"\\\"\")\n    values[1][0] = strings.TrimPrefix(values[1][0], \"value=\\\"\")\n\n    v := url.Values{\n        \"SAMLResponse\": {values[1][0]},\n        \"RelayState\":   {values[0][0]},\n    }\n\n    body := strings.NewReader(v.Encode())\n\n    fmt.Println(\"Values :\\\\)\")\n\n    //adding values and cookies to request\n    req, _ := http.NewRequest(\"POST\", GetFinalCookieURL, body)\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    req.AddCookie(firstCookie)\n    req.AddCookie(secondCookie)\n    resp, _ = httpClient.Do(req)\n\n    //we got the real cookie\n    url3, _ := url.Parse(\"website i get the cookies for\")\n    dbgPrintCurCookies(CookieJar.Cookies(url3))\n    finalCookie := CookieJar.Cookies(url3)[0]\n    finalCookie2 := CookieJar.Cookies(url3)[1]\n\n\n\n    fmt.Println(\"StatusCode:\", resp.StatusCode)\n    fmt.Println(resp.Request.URL)\n    nextURL = resp.Header.Get(\"Location\")\n    fmt.Println(nextURL)\n\n    nextURL = \"website i need the cookies for\"\n\n    req, _ = http.NewRequest(\"GET\", nextURL, nil)\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    req.AddCookie(finalCookie)\n    req.AddCookie(finalCookie2)\n    resp, _ = httpClient.Do(req)\n    url3, _ = url.Parse(\"final cookie website\")\n    dbgPrintCurCookies(CookieJar.Cookies(url3))\n    fmt.Println(resp.StatusCode)\n    fmt.Println(resp.Request.URL)\n\n    defer resp.Body.Close()\n    data3, _ := ioutil.ReadAll(resp.Body)\n    fmt.Println(string(data3))\n\n}\n</code></pre>\n\n<p>And this is an example of what the cookie i get looks like:</p>\n\n<pre><code>2018/02/10 01:55:48 cookieNum=2\n2018/02/10 01:55:48 Cookie [0]\n2018/02/10 01:55:48 Name    =JSESSIONID\n2018/02/10 01:55:48 Value   =86E2C361905167A1F64FC45C400649F2.stupo1\n2018/02/10 01:55:48 Path    =\n2018/02/10 01:55:48 Domain  =\n2018/02/10 01:55:48 Expires =0001-01-01 00:00:00 +0000 UTC\n2018/02/10 01:55:48 RawExpires=\n2018/02/10 01:55:48 MaxAge  =0\n2018/02/10 01:55:48 Secure  =false\n2018/02/10 01:55:48 HttpOnly=false\n2018/02/10 01:55:48 Raw =\n2018/02/10 01:55:48 Unparsed=[]\n</code></pre>\n\n<p>Edit: Added the complete code. And this is the cookie in the Browser:\n<a href=\"https://i.stack.imgur.com/HA4yR.png\" rel=\"nofollow noreferrer\">Cookie in Browser</a></p>\n"}, {"tags": ["json", "go", "decode"], "comments": [{"owner": {"reputation": 3202, "user_id": 3358074, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vnKYD.png?s=128&g=1", "display_name": "dmitryro", "link": "https://stackoverflow.com/users/3358074/dmitryro"}, "edited": false, "score": 0, "creation_date": 1518224881, "post_id": 48716132, "comment_id": 84431712, "body": "See an example how to unmarshal json into go struct <a href=\"http://eagain.net/articles/go-json-array-to-struct/\" rel=\"nofollow noreferrer\">eagain.net/articles/go-json-array-to-struct</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518247862, "post_id": 48716447, "comment_id": 84435722, "body": "why you have used pointer receiver in the <code>UnmarshalJSON</code> function"}], "tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1518227574, "last_edit_date": 1518227574, "creation_date": 1518227244, "answer_id": 48716447, "question_id": 48716132, "link": "https://stackoverflow.com/questions/48716132/golang-json-decode-with-field-name/48716447#48716447", "title": "golang json decode with field name", "body": "<p>You have to use custom JSON marshalling</p>\n\n<pre>\npackage main\n\n    import (\n        \"encoding/json\"\n        \"log\"\n        \"fmt\"\n    )\n\n    type Person struct {\n        Name string `json:??,string`\n        Age  int    `json:Age, int`\n    }\n\n    type People map[string]*Person\n\n    func (p *People) UnmarshalJSON(data []byte) error {\n        var transient = make(map[string]*Person)\n        err := json.Unmarshal(data, &transient)\n        if err != nil {\n            return err\n        }\n        for k, v := range transient {\n            v.Name = k\n            (*p)[k] = v\n        }\n        return nil\n    }\n\n    func main() {\n\n        jsonInput := `\n        {\n            \"Jon\": {\n        \"Age\": 15\n        },\n            \"Mary\": {\n        \"Age\": 17\n        }\n        }\n    `\n\n        var people People = make(map[string]*Person)\n\n        err := people.UnmarshalJSON([]byte(jsonInput))\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        for _, person := range people {\n            fmt.Printf(\"%v -> %v\\n\", person.Name, person.Age)\n        }\n    }\n\n</pre>\n"}], "owner": {"reputation": 7330, "user_id": 857130, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/14587548e8d7d57ea1557af4583715b2?s=128&d=identicon&r=PG", "display_name": "perigee", "link": "https://stackoverflow.com/users/857130/perigee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1168, "favorite_count": 1, "accepted_answer_id": 48716447, "answer_count": 1, "score": 1, "last_activity_date": 1518227574, "creation_date": 1518223928, "question_id": 48716132, "link": "https://stackoverflow.com/questions/48716132/golang-json-decode-with-field-name", "title": "golang json decode with field name", "body": "<p>For following JSON</p>\n\n<pre><code>{\n    \"Jon\": {\n       \"Age\": 15\n    },\n    \"Mary\": {\n       \"Age\": 17\n    } \n}\n</code></pre>\n\n<p>how can i map it into golang struct, normally, the structure will be</p>\n\n<pre><code>type Person struct {\n    Name string `json:??,string`\n    Age int `json:Age, int`\n}\n</code></pre>\n\n<p>as the json field name is the attribute of struct, thank you in advance.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518223698, "post_id": 48716094, "comment_id": 84431468, "body": "The usual culprit is a log.Fatal call in a test"}, {"owner": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518223905, "post_id": 48716094, "comment_id": 84431516, "body": "@JimB i don\u2019t have any panics in this test package"}, {"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 0, "creation_date": 1518228416, "post_id": 48716094, "comment_id": 84432339, "body": "Can you add a log statement in the <code>shutdown()</code> function to see if it actually reaches that code? If not, I&#39;m guessing that there are test cases that we don&#39;t have that are preventing the program from running. Start commenting all of the test cases out and adding them back in one at a time until you find the culprit. If you still need help, try posting just that test case (or simplify it until you have the most simple version of your test that still does not delete the database)."}], "answers": [{"comments": [{"owner": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "edited": false, "score": 0, "creation_date": 1518247079, "post_id": 48716867, "comment_id": 84435529, "body": "Mgo creates a main Session object tied to the mongos. Session is the object used to select one of the many databases that exist on the server, not the other way around. Also defer statements are guaranteed to run just before the function exits. Even if this particular statement is not run the only problem would be a dangling session copy."}], "tags": [], "owner": {"reputation": 1714, "user_id": 992898, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b2e22ad8e9c7c782976df0acf69d3362?s=128&d=identicon&r=PG", "display_name": "ardhitama", "link": "https://stackoverflow.com/users/992898/ardhitama"}, "is_accepted": false, "score": 1, "last_activity_date": 1551794077, "last_edit_date": 1551794077, "creation_date": 1518232655, "answer_id": 48716867, "question_id": 48716094, "link": "https://stackoverflow.com/questions/48716094/teardown-function-after-testmain-m-run-is-never-called/48716867#48716867", "title": "Teardown function after TestMain m.Run() is never called", "body": "<p>You are stating <code>defer session.Close()</code> in <code>setup()</code></p>\n\n<p>Hence <code>session := db.GetSession().Copy()</code> in <code>shutdown()</code> will get a new session without any DB selected.</p>\n\n<p>Make <code>setup()</code> returns <code>*mgo.Session</code> and state <code>defer session.Close()</code> in <code>TestMain()</code></p>\n"}], "owner": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551794077, "creation_date": 1518223503, "last_edit_date": 1518246866, "question_id": 48716094, "link": "https://stackoverflow.com/questions/48716094/teardown-function-after-testmain-m-run-is-never-called", "title": "Teardown function after TestMain m.Run() is never called", "body": "<p>I have the following testing code where I am testing some endpoints and database (mongoDB) features. I am using mgo package and I have some abstractions to get a new session copy each time I access the database.</p>\n\n<pre><code>package resolvers_test\n\nimport (\n    //various imports here\n)\n\nfunc setup() {\n    log.Println(\"ENTER SETUP\\n\")\n    customerIndex := mgo.Index{\n        Key:        []string{\"email\"},\n        Unique:     true,\n        Background: true,\n        Sparse:     true,\n    }\n\n    session := db.GetSession().Copy()\n    defer session.Close()\n    customerCollection := session.DB(\"testDB\").C(\"customerCollection\")\n\n    customerCollection.EnsureIndex(customerIndex)\n    log.Println(\"EXIT SETUP\")\n\n}\n\nfunc shutdown() {\n    log.Println(\"ENTER SHUTDOWN\\n\")\n    session := db.GetSession().Copy()\n    defer session.Close()\n    session.DB(\"testDB\").DropDatabase()\n    log.Println(\"EXIT SHUTDOWN\\n\")\n}\n\nfunc TestMain(m *testing.M) {\n    setup()\n    code := m.Run()\n    shutdown()\n    os.Exit(code)\n}\n</code></pre>\n\n<p>In the <code>shutdown()</code> function I have placed a piece of code that supposedly should delete the test database, however while <code>setup()</code> function is called (I know that because it creates the Index) the <code>shutdown()</code> function is never called. Any ideas?</p>\n\n<p>EDIT: I added log statements when entering end exiting setup() and shutdown() and the console log. The functions are both reachable. The log is the following:</p>\n\n<pre><code>2018/02/10 09:09:54 ENTER SETUP\n\n2018/02/10 09:09:55 EXIT SETUP\n=== RUN   TestCreateCustomer\n--- PASS: TestCreateCustomer (0.14s)\n        a_customerProfile_test.go:108: Create Customer successful\n=== RUN   TestCustomerProfile\n--- PASS: TestCustomerProfile (0.27s)\n        a_customerProfile_test.go:152: Customer Profile Test Successful\nPASS\n2018/02/10 09:09:55 ENTER SHUTDOWN\n\n2018/02/10 09:09:55 EXIT SHUTDOWN\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 1, "creation_date": 1518224069, "post_id": 48716090, "comment_id": 84431560, "body": "In general, you&#39;re looking for &quot;mocking&quot; APIs."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 1, "creation_date": 1518224554, "post_id": 48716090, "comment_id": 84431649, "body": "Don&#39;t add your code in a comment; it&#39;s unreadable. Please edit your question and include it properly formatted."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518266611, "post_id": 48716090, "comment_id": 84440559, "body": "Don&#39;t do that. Your code under test must work 100% the same under test as in production. Otherwise, you&#39;re doing an invalid test. If you have a function that exits during production, but not during test, then your code is not organized properly. Move the exit out of the code being tested, so that the tested code works identically in both test and prod environments."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1524796188, "post_id": 48716090, "comment_id": 87125186, "body": "@Flimzy  how do mean do not do that?  &quot;Must&quot; is very strong word, explain invalid, it is your opinion?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1524834609, "post_id": 48716090, "comment_id": 87142801, "body": "@AdrianWitas: If you want to test that a function works in production, you must (there is no other word) test it under the same meaningful conditions."}], "answers": [{"comments": [{"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1518224498, "post_id": 48716134, "comment_id": 84431635, "body": "Can you provide more details? If that link dies, this answer is effectively useless."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 1, "creation_date": 1518224671, "post_id": 48716134, "comment_id": 84431668, "body": "@JonathonReinhart done, but note that link points to another Stack Overflow question: it won&#39;t die/rot."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1518231522, "post_id": 48716134, "comment_id": 84432865, "body": "@VonC Okay. Why not vote to close this as a duplicate, then?"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1518279269, "post_id": 48716134, "comment_id": 84444398, "body": "Various problem may be solved in a various way, the post asks specifically about unit test identification mode, so there is no duplication there, however  mocking OsExit might be one easier way to address it ,This solution has been applicable to other problems, thus post submitted."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1518224646, "last_edit_date": 1518224646, "creation_date": 1518223937, "answer_id": 48716134, "question_id": 48716090, "link": "https://stackoverflow.com/questions/48716090/unit-test-mode-identification-in-golang/48716134#48716134", "title": "Unit test mode identification in golang", "body": "<p>You will find various ways to unit test method with os.Exit() in \"<a href=\"https://stackoverflow.com/q/40615641/6309\">Testing <code>os.Exit</code> scenarios in Go with coverage information (coveralls.io/Goveralls)</a>\".  </p>\n\n<p>It uses a function which is:</p>\n\n<ul>\n<li><p><code>os.Exit()</code> when you are not testing</p>\n\n<pre><code>var osExit = os.Exit\n</code></pre></li>\n<li><p>and \"yourOsExit\" when you are testing.</p>\n\n<pre><code>func TestCrasher(t *testing.T) {\n    // Save current function and restore at the end:\n    oldOsExit := osExit\n    defer func() { osExit = oldOsExit }()\n    osExit = myExit\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 2, "accepted_answer_id": 48716134, "answer_count": 1, "score": -1, "last_activity_date": 1518224646, "creation_date": 1518223473, "question_id": 48716090, "link": "https://stackoverflow.com/questions/48716090/unit-test-mode-identification-in-golang", "title": "Unit test mode identification in golang", "body": "<p>I am building unit testing of the application that uses os.Exit(1), once os.Exit(1) executes remaining test file are skipped with go test, \nI am thinking about suppressing os.Exit during the unit test execution only. I wonder how I can determine that app has been bootstrap from go test runner?</p>\n"}, {"tags": ["user-interface", "go", "command-line-interface"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 2514217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DJY45.png?s=128&g=1", "display_name": "Paco", "link": "https://stackoverflow.com/users/2514217/paco"}, "edited": false, "score": 0, "creation_date": 1518219678, "post_id": 48715502, "comment_id": 84430536, "body": "Thanks @patrick-artner, but the structure of the <code>form.GetFormItem(0)</code> object is what&#39;s not clear. How do print <i>only</i> the <code>Name</code> value of that object?"}, {"owner": {"reputation": 43029, "user_id": 7505395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4t4nq.jpg?s=128&g=1", "display_name": "Patrick Artner", "link": "https://stackoverflow.com/users/7505395/patrick-artner"}, "reply_to_user": {"reputation": 71, "user_id": 2514217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DJY45.png?s=128&g=1", "display_name": "Paco", "link": "https://stackoverflow.com/users/2514217/paco"}, "edited": false, "score": 0, "creation_date": 1518220648, "post_id": 48715502, "comment_id": 84430805, "body": "<a href=\"https://github.com/rivo/tview/blob/master/inputfield.go\" rel=\"nofollow noreferrer\">github.com/rivo/tview/blob/master/inputfield.go</a> - <code>GetText()</code> seems to be what you need then. You might need to cast the return of <code>GetFormIndex(0)</code> to <code>InputField(form.GetFormIndex(0))</code> as it returns the Interfacetype &#39;type FormItem interface&#39; (defined in top of form.go)"}, {"owner": {"reputation": 71, "user_id": 2514217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DJY45.png?s=128&g=1", "display_name": "Paco", "link": "https://stackoverflow.com/users/2514217/paco"}, "edited": false, "score": 1, "creation_date": 1518236136, "post_id": 48715502, "comment_id": 84433546, "body": "Yeah, <code>fmt.Printf(&quot;%s\\n&quot;, form.GetFormItem(0).(*tview.InputField).GetText() )</code> does the trick. Thanks, Patrick!"}], "tags": [], "owner": {"reputation": 43029, "user_id": 7505395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4t4nq.jpg?s=128&g=1", "display_name": "Patrick Artner", "link": "https://stackoverflow.com/users/7505395/patrick-artner"}, "is_accepted": false, "score": 1, "last_activity_date": 1518218899, "last_edit_date": 1518218899, "creation_date": 1518218343, "answer_id": 48715502, "question_id": 48715418, "link": "https://stackoverflow.com/questions/48715418/getting-the-actual-form-values-when-using-tivo-tview-golang-library/48715502#48715502", "title": "Getting the actual Form values when using tivo/tview GoLang library", "body": "<p>The form has only two items, one inputfield, one button.</p>\n\n<p>the part </p>\n\n<pre><code>app.SetRoot(form, true).SetFocus(form).Run() \n</code></pre>\n\n<p>runs the form. Klicking the button continues the execution afterwards by stopping the app-window.</p>\n\n<p>The inputfield <code>'Name'</code> is put into the form first. It is accessed by <code>form.GetFormItem(0)</code> (by it's index). </p>\n\n<p>See <a href=\"https://github.com/rivo/tview/blob/master/form.go\" rel=\"nofollow noreferrer\">https://github.com/rivo/tview/blob/master/form.go</a>  row 244ff</p>\n\n<blockquote>\n<pre><code>// GetFormItem returns the form element at the given position, starting with  \n// index 0. Elements are referenced in the order they were added. Buttons are  \n// not included.  \nfunc (f *Form) GetFormItem(index int) FormItem {\n  return f.items[index]\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 71, "user_id": 2514217, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DJY45.png?s=128&g=1", "display_name": "Paco", "link": "https://stackoverflow.com/users/2514217/paco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 550, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1518277533, "creation_date": 1518217727, "last_edit_date": 1518277533, "question_id": 48715418, "link": "https://stackoverflow.com/questions/48715418/getting-the-actual-form-values-when-using-tivo-tview-golang-library", "title": "Getting the actual Form values when using tivo/tview GoLang library", "body": "<p>It's not at all obvious to me how to get the value the user inputs for the Name input field, in below simple snippet.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/rivo/tview\"\n)\n\nfunc main() {\n\n    app := tview.NewApplication()\n    form := tview.NewForm()\n    form.SetTitle(\" My Form \")\n    form.AddInputField(\"Name\", \"\", 20, nil, nil)\n    form.AddButton(\"OK\", func() { app.Stop() })\n    if err := app.SetRoot(form, true).SetFocus(form).Run(); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%s\\n\", form.GetFormItem(0))\n}\n</code></pre>\n"}, {"tags": ["html", "css", "go", "webpack", "asset-pipeline"], "comments": [{"owner": {"reputation": 13306, "user_id": 162698, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HnjBG.png?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/162698/rob"}, "edited": false, "score": 0, "creation_date": 1518231023, "post_id": 48714653, "comment_id": 84432788, "body": "The <code>&lt;link&gt;</code> tag does not use or need a closing slash and never has."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6865916, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208877787515466/picture?type=large", "display_name": "Justin Chao", "link": "https://stackoverflow.com/users/6865916/justin-chao"}, "edited": false, "score": 1, "creation_date": 1518294810, "post_id": 48716737, "comment_id": 84449491, "body": "Thanks for the help! I took a closer look at how Buffalo uses asset helpers and tagging, and that solved my issue. :)"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 1, "last_activity_date": 1518232137, "last_edit_date": 1518232137, "creation_date": 1518230820, "answer_id": 48716737, "question_id": 48714653, "link": "https://stackoverflow.com/questions/48714653/css-file-is-not-being-applied/48716737#48716737", "title": "CSS file is not being applied", "body": "<p>That means your server is not responding to requests for this css file with the appropriate MIME type.  You can demonstrate that by requesting the CSS file and viewing the raw response (in your browser's developer tools, or via cURL, for example).  What you want to see is:</p>\n\n<pre><code>text/css\n</code></pre>\n\n<p>But, given the error, what you will see is <code>text/plain</code></p>\n\n<p>According to <a href=\"https://gobuffalo.io/docs/assets#c-s-s\" rel=\"nofollow noreferrer\">Buffalo documentation</a>:</p>\n\n<blockquote>\n  <p>By default the asset pipeline is configured to use .scss files, with /assets/css/application.scss as the main entry point. This, of course, can be changed.</p>\n</blockquote>\n\n<p>I suggest you adopt the default scheme and <a href=\"http://sass-lang.com/\" rel=\"nofollow noreferrer\">use SCSS</a>, and use <a href=\"https://gobuffalo.io/docs/assets#asset-helpers\" rel=\"nofollow noreferrer\">the Buffalo asset helper</a>:</p>\n\n<blockquote>\n  <p>stylesheetTag - This helper will generate a  style tag for the requested CSS file. Example: <code>&lt;%= stylesheetTag(\"application.css\") %&gt;</code> would return something like <code>&lt;link href=\"/assets/application.bd76587ded82386f388f.css\" media=\"screen\" rel=\"stylesheet\" /&gt;</code></p>\n</blockquote>\n\n<p>but if you don't wish to do that you could look into alternative configurations for serving CSS files with Buffalo, or into getting around Buffalo and serving CSS files without it.</p>\n"}], "owner": {"reputation": 113, "user_id": 6865916, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208877787515466/picture?type=large", "display_name": "Justin Chao", "link": "https://stackoverflow.com/users/6865916/justin-chao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 0, "accepted_answer_id": 48716737, "answer_count": 1, "score": 1, "last_activity_date": 1518232137, "creation_date": 1518213310, "last_edit_date": 1518231065, "question_id": 48714653, "link": "https://stackoverflow.com/questions/48714653/css-file-is-not-being-applied", "title": "CSS file is not being applied", "body": "<p>I'm trying to build a web-app using <a href=\"https://gobuffalo.io/\" rel=\"nofollow noreferrer\">Buffalo</a>\nbut I'm having a difficult time figuring out why my site.css file is not being applied.</p>\n\n<p>The error that I am getting on Chrome is:</p>\n\n<p><code>Refused to apply style from 'http://localhost:3000/assets/css/site.css' because its MIME type ('text/plain') is not a supported stylesheet MIME type, and strict MIME checking is enabled.</code></p>\n\n<p>I've tried looking through the <a href=\"https://gobuffalo.io/docs/assets\" rel=\"nofollow noreferrer\">docs</a> for how Buffalo manages assets, and it says:</p>\n\n<blockquote>\n  <p>Any assets placed in the /assets folder will be copied to the \"distribution\" automatically, and can be found at /assets/path/to/asset.</p>\n</blockquote>\n\n<p>My code where I link the stylesheet looks like this:</p>\n\n<p><code>&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/css/site.css\" /&gt;</code></p>\n\n<p>Any ideas as to what else I could be missing?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "go-html-template"], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 2130922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ac51d388c5372658b6ff54b968e713?s=128&d=identicon&r=PG", "display_name": "Nathan V", "link": "https://stackoverflow.com/users/2130922/nathan-v"}, "edited": false, "score": 0, "creation_date": 1518214440, "post_id": 48714734, "comment_id": 84428910, "body": "Yeah, I saw the part about the escaping at the top.  I wasn&#39;t sure how the &quot;marking&quot; part worked; how does using <code>template.HTML(&quot;str&quot;)</code> return a &quot;marked&quot; string?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 375, "user_id": 2130922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ac51d388c5372658b6ff54b968e713?s=128&d=identicon&r=PG", "display_name": "Nathan V", "link": "https://stackoverflow.com/users/2130922/nathan-v"}, "edited": false, "score": 0, "creation_date": 1518215322, "post_id": 48714734, "comment_id": 84429165, "body": "If you look at the <a href=\"https://golang.org/pkg/html/template/#HTML\" rel=\"nofollow noreferrer\">definition for <code>template. HTML</code></a>, it&#39;s just a type based on <code>string</code>. By coercing a string to that type, you&#39;re telling the package it doesn&#39;t need to escape it."}, {"owner": {"reputation": 375, "user_id": 2130922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ac51d388c5372658b6ff54b968e713?s=128&d=identicon&r=PG", "display_name": "Nathan V", "link": "https://stackoverflow.com/users/2130922/nathan-v"}, "edited": false, "score": 0, "creation_date": 1518215562, "post_id": 48714734, "comment_id": 84429260, "body": "Rad. Thanks. Still learning go and coming from mostly duck-typed languages I think I misunderstood how Types worked in this sense. That&#39;s pretty cool."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1518213624, "last_edit_date": 1592644375, "creation_date": 1518213624, "answer_id": 48714734, "question_id": 48714438, "link": "https://stackoverflow.com/questions/48714438/with-echo-and-html-template-how-can-i-pass-html-to-the-template/48714734#48714734", "title": "With Echo and html/template how can I pass HTML to the template?", "body": "<p>This is covered <a href=\"https://golang.org/pkg/html/template/#hdr-Typed_Strings\" rel=\"nofollow noreferrer\">in the <code>html/template</code> package summary</a>:</p>\n<blockquote>\n<p>By default, this package assumes that all pipelines produce a plain text string. It adds escaping pipeline stages necessary to correctly and safely embed that plain text string in the appropriate context.</p>\n<p>When a data value is not plain text, you can make sure it is not over-escaped by marking it with its type.</p>\n</blockquote>\n<p>For example:</p>\n<pre><code>return c.Render(http.StatusOK, &quot;home&quot;, template.HTML(&quot;&lt;p&gt;HTML Test&lt;/p&gt;&quot;))\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 2130922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ac51d388c5372658b6ff54b968e713?s=128&d=identicon&r=PG", "display_name": "Nathan V", "link": "https://stackoverflow.com/users/2130922/nathan-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3023, "favorite_count": 0, "accepted_answer_id": 48714734, "answer_count": 1, "score": 1, "last_activity_date": 1518213624, "creation_date": 1518212159, "question_id": 48714438, "link": "https://stackoverflow.com/questions/48714438/with-echo-and-html-template-how-can-i-pass-html-to-the-template", "title": "With Echo and html/template how can I pass HTML to the template?", "body": "<p>I'm using <a href=\"https://echo.labstack.com\" rel=\"nofollow noreferrer\">Echo</a> to build my first small Go web service and I went with the example they provide for using <code>html/template</code> for HTML page templates to simplify page management.</p>\n\n<p>On one of the pages I'm collecting data from a backend API and wanted to display it in a table. I'm generating the HTML and then passing it into the template. Unfortunately <code>html/template</code> is encoding it as safe text rather than letting the HTML pass through.</p>\n\n<p>I can see in the <code>html/template</code> docs how you could tell it the HTML is safe there but I'm not sure how to do that same thing inside Echo.</p>\n\n<p>How do I make it so that HTML passed through <code>Render</code> is accepted as HTML instead of encoded?</p>\n\n<p>Simplified versions of the go files and template:</p>\n\n<p><code>server.go</code></p>\n\n<pre><code>package main\n\nimport (\n  \"io\"\n  \"html/template\"\n\n  \"github.com/labstack/echo\"\n  \"github.com/labstack/echo/middleware\"\n  \"github.com/labstack/gommon/log\"\n)\n\ntype Template struct {\n  templates *template.Template\n}\nfunc (t *Template) Render(w io.Writer, name string, data interface{}, c echo.Context) error {\n    return t.templates.ExecuteTemplate(w, name, data)\n}\n\nfunc main() {\n  t := &amp;Template{\n    templates: template.Must(template.ParseGlob(\"views/*.html\")),\n  }\n\n  e := echo.New()\n  e.Logger.SetLevel(log.INFO)\n  e.Use(middleware.Logger())\n\n  e.Renderer = t\n\n  e.GET(\"/\", homePage)\n\n  // HTTP server\n  e.Logger.Fatal(e.Start(\":1323\"))\n}\n</code></pre>\n\n<p><code>pages.go</code></p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/labstack/echo\"\n)\n\nfunc homePage(c echo.Context) error {\n  return c.Render(http.StatusOK, \"home\", \"&lt;p&gt;HTML Test&lt;/p&gt;\")\n}\n</code></pre>\n\n<p><code>views/home.html</code></p>\n\n<pre><code>{{define \"home\"}}\n{{template \"head\"}}\n{{template \"navbar\"}}\n\n{{.}}\n\n{{template \"foot\"}}\n{{end}}\n</code></pre>\n"}, {"tags": ["go", "aws-lambda"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518200223, "post_id": 48711787, "comment_id": 84422666, "body": "It depends on so many things. Which implementation of bcrypt? (golang.org/x/crypto/bcrypt?) What cost are you using? What instance type? Have you tried profiling to make sure it&#39;s bcrypt spending all this time?"}, {"owner": {"reputation": 485, "user_id": 2581581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a5d1c6220ee478d17c185be087d4b2ba?s=128&d=identicon&r=PG", "display_name": "Lockless", "link": "https://stackoverflow.com/users/2581581/lockless"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518200429, "post_id": 48711787, "comment_id": 84422758, "body": "I am using golang.org/x/crypto/bcrypt.  What would you recommend as the minimum cost to use for safety?  Looks like the census is a minimum of 4.  Currently using 10."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518201014, "post_id": 48711787, "comment_id": 84423050, "body": "10 is the default cost. Try running the bcrypt benchmark on your instance (you still haven&#39;t told us which type you&#39;re using). For reference, I&#39;m getting about 20 ops/s (both hashing and hashing+verification with default cost of 10) on a m3.large. Allocation statistics show 5KB per op. Did you profile your code? I seriously doubt this is bcrypt."}, {"owner": {"reputation": 485, "user_id": 2581581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a5d1c6220ee478d17c185be087d4b2ba?s=128&d=identicon&r=PG", "display_name": "Lockless", "link": "https://stackoverflow.com/users/2581581/lockless"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518204865, "post_id": 48711787, "comment_id": 84424891, "body": "I&#39;m not using an elastic compute (ec2) this is a lambda processing function.  Server less architecture.  I&#39;m not sure on the number of CPU&#39;s allocated to lambda processing but I have a view into the available memory.  There is 128mb allocated to my function as a default.  Since bcrypt is memory intensive it just takes a long time to process.  I&#39;m going to start testing cost functions with different memory allocations and see if I can get processing under one second."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518205861, "post_id": 48711787, "comment_id": 84425297, "body": "oops, I missed the lambda part. Maybe try with higher memory allocations and benchmark a few runs, running just the auth endpoints with higher ram might be reasonable. If it&#39;s that bad though, I would consider ditching lambda."}, {"owner": {"reputation": 11693, "user_id": 1252647, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/7cXay.jpg?s=128&g=1", "display_name": "Noel Llevares", "link": "https://stackoverflow.com/users/1252647/noel-llevares"}, "edited": false, "score": 0, "creation_date": 1518367913, "post_id": 48711787, "comment_id": 84466925, "body": "Lambda is so cheap. Use 1536MB and see if the performance is good enough."}], "owner": {"reputation": 485, "user_id": 2581581, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a5d1c6220ee478d17c185be087d4b2ba?s=128&d=identicon&r=PG", "display_name": "Lockless", "link": "https://stackoverflow.com/users/2581581/lockless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 490, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518199868, "creation_date": 1518199868, "question_id": 48711787, "link": "https://stackoverflow.com/questions/48711787/issue-with-timeouts-using-bcrypt-on-aws-lambda", "title": "Issue with timeouts using bcrypt on AWS lambda", "body": "<p>I'm making a web app using AWS lambda.  Everything is working great and my cold start requests are under 200ms.  Go has absolutely blazing speed.  But there is an issue with user registration and auth.</p>\n\n<p>Computing a bcrypt hash takes 19 seconds with 128 mb of reserved memory.  Increasing the memory does take the request time down but increases the cost per transaction.</p>\n\n<p>For only two of my calls needing the increased space this seems pretty wasteful.  I'm considering making a separate endpoint for just auth.  They share a DB so would not matter to much.</p>\n\n<p>Is there a better way?\nDifferent auth scheme?\nDifferent infrastructure?</p>\n"}, {"tags": ["json", "go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9339736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65a1951a125d568823c8dd92009d6945?s=128&d=identicon&r=PG&f=1", "display_name": "Sarat Chandra", "link": "https://stackoverflow.com/users/9339736/sarat-chandra"}, "edited": false, "score": 0, "creation_date": 1518200763, "post_id": 48711735, "comment_id": 84422932, "body": "unmarshalling into a interface is a valid use case, where you dont know what kind of struct you get. Probably one can make a struct from the map[string]interface{} and further use the value of the map, type interface to further identify the inner nested structs and so on.."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 21, "user_id": 9339736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65a1951a125d568823c8dd92009d6945?s=128&d=identicon&r=PG&f=1", "display_name": "Sarat Chandra", "link": "https://stackoverflow.com/users/9339736/sarat-chandra"}, "edited": false, "score": 0, "creation_date": 1518202308, "post_id": 48711735, "comment_id": 84423657, "body": "Yes, that&#39;s true... I&#39;m not sure I understand how it relates to the answer?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1518199673, "last_edit_date": 1592644375, "creation_date": 1518199673, "answer_id": 48711735, "question_id": 48711705, "link": "https://stackoverflow.com/questions/48711705/unmarshalling-array-of-bytes-to-an-interface-and-type-cast-that-interface-into-s/48711735#48711735", "title": "Unmarshalling array of bytes to an interface and type cast that interface into struct doesn&#39;t work?", "body": "<p>When you unmarshall JSON into <code>interface{}</code>, <em>it has no way to know what type you want it to use</em>, so it defaults to <code>map[string]interface{}</code> <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">as indicated in the documentation</a>:</p>\n<blockquote>\n<p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n<p>...</p>\n<p><code>map[string]interface{}, for JSON objects</code></p>\n</blockquote>\n<p>If you want to unmarshal to a specific type, pass an instance of that type to Unmarshal:</p>\n<pre><code>var result sample \nerr = json.Unmarshal(data,&amp;result)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1518231983, "creation_date": 1518231983, "answer_id": 48716824, "question_id": 48711705, "link": "https://stackoverflow.com/questions/48711705/unmarshalling-array-of-bytes-to-an-interface-and-type-cast-that-interface-into-s/48716824#48716824", "title": "Unmarshalling array of bytes to an interface and type cast that interface into struct doesn&#39;t work?", "body": "<p>You can not unmarshal to nil interface, however, if interface has a pointer to undelying structure it will work see below your updated code:</p>\n\n<pre>\n\n    package main\n\n    import (\n        \"encoding/json\"\n        \"fmt\"\n        \"github.com/viant/toolbox\"\n        \"log\"\n    )\n\n    type sample struct {\n        Ping string  `json:\"ping\"`\n        Pong sample1 `json:\"long\"`\n    }\n    type sample1 struct {\n        Play string `json:\"plong\"`\n    }\n\n    func main() {\n\n        var ans sample\n        var result interface{} = &sample{}\n        ans.Ping = \"asda\"\n        var ans1 sample1\n        ans1.Play = \"asasd\"\n        ans.Pong = ans1\n        fmt.Println(ans)\n\n\n\n        converter := toolbox.NewColumnConverter(toolbox.DefaultDateLayout)\n        var aMap = make(map[string]interface{})\n        converter.AssignConverted(&aMap, ans)\n\n\n\n        data, err := json.Marshal(ans)\n        fmt.Println(err)\n        fmt.Println(string(data), err)\n\n\n\n        err = json.Unmarshal(data,&result)\n        fmt.Println(result)\n        if err!= nil{\n            log.Fatal(err)\n        }\n\n        fmt.Println(result.(*sample))\n        fmt.Println(result)\n\n    }\n\n\n</pre>\n"}], "owner": {"reputation": 21, "user_id": 9339736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65a1951a125d568823c8dd92009d6945?s=128&d=identicon&r=PG&f=1", "display_name": "Sarat Chandra", "link": "https://stackoverflow.com/users/9339736/sarat-chandra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4123, "favorite_count": 0, "accepted_answer_id": 48711735, "answer_count": 2, "score": 0, "last_activity_date": 1518231983, "creation_date": 1518199536, "last_edit_date": 1518220875, "question_id": 48711705, "link": "https://stackoverflow.com/questions/48711705/unmarshalling-array-of-bytes-to-an-interface-and-type-cast-that-interface-into-s", "title": "Unmarshalling array of bytes to an interface and type cast that interface into struct doesn&#39;t work?", "body": "<p>I have been coding in golang for a while now. I have come across something I thought would work perfectly fine. </p>\n\n<p>When I JSON Marshal a nested struct in golang I get the array of bytes, when I UnMarshal the same into an interface and convert the interface into the respective nested struct, it gives me a panic stating interface conversion: interface is map[string]interface but not the nested struct.</p>\n\n<p>Please go through the link below.</p>\n\n<p><a href=\"https://play.golang.org/p/apdR4TKjee-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/apdR4TKjee-</a></p>\n\n<p>Can someone explain to me what is that I am missing?</p>\n"}, {"tags": ["go", "ldap"], "answers": [{"tags": [], "owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "is_accepted": true, "score": 0, "last_activity_date": 1518782131, "creation_date": 1518782131, "answer_id": 48826254, "question_id": 48711410, "link": "https://stackoverflow.com/questions/48711410/i-want-to-check-password-for-given-objectguid/48826254#48826254", "title": "I want to check password for given objectGUID", "body": "<p>As far as I know object GUID must be passed to LDAP filters in a different format called Octet String.</p>\n\n<p>The format is simply a mangling of the hexadecimal values contained in the object Guid split as bytes (remember that a byte contains two hex digits).</p>\n\n<p>Example : <code>\"b0ae470c-16bc-4019-b455-8c96ec515f55\"</code> -> <code>\"\\0c\\47\\ae\\b0\\bc\\16\\19\\40\\b4\\55\\8c\\96\\ec\\51\\5f\\55\"</code></p>\n\n<p>I've created a simple golang function in the <a href=\"https://play.golang.org/p/4DOQRETijo8\" rel=\"nofollow noreferrer\">Go Playground</a> for you to play with.</p>\n\n<p>Hope this resolves your issue.</p>\n"}], "owner": {"reputation": 23, "user_id": 9339683, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--fHYJgbjzw8/AAAAAAAAAAI/AAAAAAAAAcA/6cAaugyMkvQ/photo.jpg?sz=128", "display_name": "Fatih Soydan", "link": "https://stackoverflow.com/users/9339683/fatih-soydan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 48826254, "answer_count": 1, "score": 2, "last_activity_date": 1518782131, "creation_date": 1518198328, "last_edit_date": 1518204916, "question_id": 48711410, "link": "https://stackoverflow.com/questions/48711410/i-want-to-check-password-for-given-objectguid", "title": "I want to check password for given objectGUID", "body": "<p>I want to write a function that searchs a ldap user with objectGuid in GoLang.<br>\nI am using ldap as \"gopkg.in/ldap.v2\" for connecting ldap host.</p>\n\n<pre><code>l,_ :=ldap.Dial(\"tcp\", fmt.Sprintf(\"%s:%d\", host, 389))\ndefer l.Close()\nl.Bind(adminuser, adminpass);\nsearchRequest := ldap.NewSearchRequest(\n    \"dc=\"+strings.Join(strings.Split(domain,\".\"),\",dc=\"),\n    ldap.ScopeWholeSubtree, ldap.NeverDerefAliases, 0, \n    0,false,\n    \"(&amp;(objectclass=person)(objectGUID=???SpecialFormat???))\",\n    []string{\"dn\"},\n    nil,\n)\nsr, err := l.Search(searchRequest);\nif err!=nil {\n    log.Printf(\"Error %s\",err);\n}\n\n       userdn := sr.Entries[0].DN; // I need UserDN for checking\n\n       err=l.Bind(userdn, string(pass)) //checking password\n</code></pre>\n\n<p>My Code is like this.<br>\nI want to search a person that have a GUID like \"445a1532-08aa-4a10-8a9c-d7f10f574afe\".<br>\nBut i guess, \"The ldapsearch request\" wants a different format for objectGUID.<br>\nHow can i convert my GUIDString to needed format.</p>\n"}, {"tags": ["database", "postgresql", "go"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1518194734, "post_id": 48710353, "comment_id": 84419773, "body": "Why aren&#39;t you printing the <i>actual</i> error message.  You&#39;re currently just <i>assuming</i> that an error means the table couldn&#39;t be found, when it could be a number of things.  For example, if nothing is <i>in</i> the table, you&#39;ll get back a sql.ErrNoRows."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518194802, "post_id": 48710353, "comment_id": 84419812, "body": "Good call. Edited. Actual error is <code>pq: relation &quot;users&quot; does not exist</code>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518195061, "post_id": 48710353, "comment_id": 84419972, "body": "Hmm, I&#39;m at a loss.  It&#39;s <i>likely</i> something in how your database is set up or how you&#39;re connecting to it (your actual connection code isn&#39;t included), but I&#39;m not sure."}, {"owner": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 1, "creation_date": 1518195087, "post_id": 48710353, "comment_id": 84419988, "body": "My advise - ALWAYS use full table name with schema name. Otherwise you cannot be sure in which schema is table really created. If you create table directly in psql or other PG gui it will place table into first schema listed in &quot;search_path&quot;. But by my experiences GO libraries do not care about &quot;search_path&quot; variable - this is most probably the reason for this error."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1518195125, "post_id": 48710353, "comment_id": 84420010, "body": "Can you give me an example of the full table name with schema name?  Like inside of the query?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518195969, "post_id": 48710353, "comment_id": 84420496, "body": "@user3162553 <code>public.users</code> instead of just <code>users</code> is what JosMac suggests, I guess."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1518196063, "post_id": 48710353, "comment_id": 84420568, "body": "Ah same error with: <code>r, err := c.Database.Exec(&quot;SELECT * FROM public.users;&quot;)</code>.  Only have this problem with this go sql driver.  I&#39;ve never had it with connecting in another language - node or ruby.  Weird."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518196210, "post_id": 48710353, "comment_id": 84420637, "body": "@user3162553 Are you certain that your <code>Database</code> instance is connected to <code>five_three_one_development</code>?"}, {"owner": {"reputation": 729, "user_id": 3674262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b7c78a7b3b60134a607e6d9d998551?s=128&d=identicon&r=PG&f=1", "display_name": "sindhu_sp", "link": "https://stackoverflow.com/users/3674262/sindhu-sp"}, "edited": false, "score": 0, "creation_date": 1518196512, "post_id": 48710353, "comment_id": 84420809, "body": "Are you specifying the port in your database connection code?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1518196515, "post_id": 48710353, "comment_id": 84420810, "body": "@user3162553 <code>var name string</code>; <code>Database.QueryRow(&quot;SELECT current_database()&quot;).Scan(&amp;name)</code>; <code>fmt.Println(name)</code> do you get <code>five_three_one_development</code>?"}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 729, "user_id": 3674262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b7c78a7b3b60134a607e6d9d998551?s=128&d=identicon&r=PG&f=1", "display_name": "sindhu_sp", "link": "https://stackoverflow.com/users/3674262/sindhu-sp"}, "edited": false, "score": 0, "creation_date": 1518199081, "post_id": 48710353, "comment_id": 84422123, "body": "@sindhu_sp I am not specifying my port because it is using the default postgres port."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518199127, "post_id": 48710353, "comment_id": 84422152, "body": "@mkopriva I will try that - that sounds like a good idea."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518242657, "post_id": 48710353, "comment_id": 84434645, "body": "@mkopriva well damn - it is a different database!  It&#39;s connecting to my username as a database so &#39;myname&#39;."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1518243071, "post_id": 48710353, "comment_id": 84434722, "body": "Sadly, I still have no idea why.  Is this really the best tool for this?  Seems like building a string isn&#39;t the best way to do that."}], "answers": [{"comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1518292773, "post_id": 48717849, "comment_id": 84448898, "body": "Why are you setting those environment variables? <code>pq</code> doesn&#39;t say that it pays attention to them, it just says it uses the same environment variables as the standard <code>libpq</code> and the <a href=\"https://www.postgresql.org/docs/current/static/libpq-envars.html\" rel=\"nofollow noreferrer\"><code>libpq</code> docs</a> don&#39;t mention them either. Or are you setting those and then trying to build a connection string yourself?"}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1518293295, "post_id": 48717849, "comment_id": 84449052, "body": "Trying to build the connection string myself.  Database connection will be different depending upon the platform."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1518294771, "post_id": 48717849, "comment_id": 84449477, "body": "And what code were you using to build the connection string and what connection string was it really building?"}], "tags": [], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "is_accepted": false, "score": 0, "last_activity_date": 1518243221, "creation_date": 1518243221, "answer_id": 48717849, "question_id": 48710353, "link": "https://stackoverflow.com/questions/48710353/postgres-driver-doesnt-find-table-in-go/48717849#48717849", "title": "Postgres driver doesn&#39;t find table in go", "body": "<p>Golang sql driver isn't clear about the order it expects.  Ditch it. Save the whole connection string into a DATABASE URL variable and use that. Annoying but it seems to have solved the problem.</p>\n\n<p>Pass this as a connection string: <code>postgres://myname:password@localhost:5432/five_three_one_development?sslmode=disable</code> and forget trying to build it up.</p>\n"}], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 617, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518243221, "creation_date": 1518194422, "last_edit_date": 1518195289, "question_id": 48710353, "link": "https://stackoverflow.com/questions/48710353/postgres-driver-doesnt-find-table-in-go", "title": "Postgres driver doesn&#39;t find table in go", "body": "<p>Really strange yet very common error. Relation \"users\" does not exist. I know what you are saying - that's been asked before!  And it has, but work with me because I'm doing a bunch of checks and it still doesn't go through.</p>\n\n<p>First, this is the migration:</p>\n\n<pre><code>CREATE TABLE users (\n    id                  serial PRIMARY KEY,\n    obfuscated_id       VARCHAR(128) NOT NULL UNIQUE,\n    email               VARCHAR(128) NOT NULL UNIQUE,\n    encrypted_password  VARCHAR(128) NOT NULL,\n    created_at          TIMESTAMP,\n    updated_at          TIMESTAMP,\n    active              BOOLEAN DEFAULT TRUE\n);\n</code></pre>\n\n<p>And this is the command I'm using to run that migration:</p>\n\n<p><code>migrate -path ./migrations -database postgres://myname:password@localhost:5432/five_three_one_development?sslmode=disable up</code></p>\n\n<p>I've manually tested that the db exists:</p>\n\n<p>psql</p>\n\n<pre><code>\\c five_three_one_development\n\\dt \n Schema |       Name        | Type  |  Owner\n--------+-------------------+-------+----------\n public | schema_migrations | table | myname\n public | users             | table | myname\n</code></pre>\n\n<p>I've manually altered the password on the table using <code>/password</code> and set it to password.</p>\n\n<p>Here are the environment variables:</p>\n\n<pre><code>DB_NAME=five_three_one_development\nDB_PASS=password\nDB_USER=myname\n</code></pre>\n\n<p>And when I log those variables I get the same values back:</p>\n\n<pre><code>fmt.Printf(\"NAME:\" + os.Getenv(\"DB_NAME\"))\nfmt.Printf(\"USER:\" + os.Getenv(\"DB_USER\"))\nfmt.Printf(\"DB_PASS:\" + os.Getenv(\"DB_PASS\"))\n</code></pre>\n\n<p>I also perform an environment test at the top of my development server to check that the db is reachable.</p>\n\n<pre><code>func (c *ApplicationContext) PerformEnvChecks() {\n    err := c.Database.Ping()\n    if err != nil {\n        log.Fatalf(\"Database environment check failed: %s\", err)\n    }\n\n    r, err := c.Database.Exec(\"SELECT * FROM users\")\n    if err != nil {\n        log.Fatal(err) // --&gt; pq: relation \"users\" does not exist\n    }\n\n    fmt.Printf(\"Tables: %v\", r)\n}\n</code></pre>\n\n<p>And then it fails on the <code>c.Database.Exec(\"SELECT * FROM users\")</code> line which means that it's connected to the right database but it cannot find the table.  </p>\n\n<p>Out of ideas on this one - thoughts?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Feature request idea for postgresql folks: <code>\\connection_string</code> -> returns the postgresql connection string given the current user inside of the database connected to.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1518188535, "post_id": 48708498, "comment_id": 84415949, "body": "Use <code>map[string]interface{}</code>"}, {"owner": {"reputation": 53, "user_id": 7026738, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-STmShyO0LPs/AAAAAAAAAAI/AAAAAAAAAFk/VYSZiZio5Ag/photo.jpg?sz=128", "display_name": "Vikas", "link": "https://stackoverflow.com/users/7026738/vikas"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1518189228, "post_id": 48708498, "comment_id": 84416376, "body": "I have tried but not able to do this"}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1518190835, "post_id": 48709112, "comment_id": 84417418, "body": "I don&#39;t think the first type can convert each other. Can you provide a playground link?"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1518192733, "post_id": 48709112, "comment_id": 84418548, "body": "This does <a href=\"https://play.golang.org/p/aC7uus_8tga\" rel=\"nofollow noreferrer\">not compile</a>: <code>cannot convert a (type Active) to type Inactive</code>. I think you&#39;re confusing structs and interfaces?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1518194111, "post_id": 48709112, "comment_id": 84419406, "body": "Crap, sorry, you&#39;re right, they have to have the same field names.  Updated answer, <i>does</i> compile now: <a href=\"https://play.golang.org/p/CeyNHo9KVrf\" rel=\"nofollow noreferrer\">play.golang.org/p/CeyNHo9KVrf</a>"}, {"owner": {"reputation": 53, "user_id": 7026738, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-STmShyO0LPs/AAAAAAAAAAI/AAAAAAAAAFk/VYSZiZio5Ag/photo.jpg?sz=128", "display_name": "Vikas", "link": "https://stackoverflow.com/users/7026738/vikas"}, "edited": false, "score": 0, "creation_date": 1518245841, "post_id": 48709112, "comment_id": 84435264, "body": "Thanks @Kaedys for ur help.I have fixed all my issues."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": -2, "last_activity_date": 1518194089, "last_edit_date": 1518194089, "creation_date": 1518190205, "answer_id": 48709112, "question_id": 48708498, "link": "https://stackoverflow.com/questions/48708498/how-change-the-active-field-to-inactive-keeping-the-value-of-the-field-intact-us/48709112#48709112", "title": "How change the active field to inactive keeping the value of the field intact using golang?", "body": "<p>Golang allows direct conversion between structures that are identical in types, even if they differ in field tags.  That is, you can convert directly between:</p>\n\n<pre><code>type Active struct {\n    Active   string `json:\"active\"`\n    ByteSize string `json:\"bytesize\"`\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>type Inactive struct {\n    Active string `json:\"inactive\"`\n    ByteSize string `json:\"bytesize\"`\n}\n</code></pre>\n\n<p>Using the following:</p>\n\n<pre><code>var a Active\n// decode JSON into a\nvar b Inactive = Inactive(a) // direct conversion allowed\n</code></pre>\n\n<p><em>However</em>, your input JSON won't easily support this.  Your input JSON is listing the <code>image</code> field as a <em>list</em>, despite the various entries in the list not actually being identical in type or fields.  The only real option in that case is to parse it as a nested set of <code>map[string]interface{}</code>:</p>\n\n<p><a href=\"https://play.golang.org/p/4NgiKLlHg8c\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4NgiKLlHg8c</a></p>\n\n<pre><code>parsed := make(map[string]interface{})\nif err := json.Unmarshal([]byte(input), &amp;parsed); err != nil {\n    panic(err)\n}\n\nimg, ok := parsed[\"image\"]\nif ok {\n    if imglist, ok := img.([]interface{}); ok {\n        for i, mi := range imglist {\n            if m, ok := mi.(map[string]interface{}); ok {\n                for k, v := range m {\n                    if k == \"active\" {\n                        m[\"inactive\"] = v\n                        delete(m, \"active\")\n                        imglist[i] = m\n                    }\n                }\n            }\n        }\n    }\n}\n\nb, err := json.Marshal(img)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Note that I've removed a lot of sanity checks from this code to make it shorter and more readable.  Using nested interface maps for handling JSONs is inherently messy.  If you <em>can</em> change how the input JSON is formatted, you'll have a <em>lot</em> better luck, and more easily maintainable code, by doing so.</p>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1518193498, "creation_date": 1518193498, "answer_id": 48710091, "question_id": 48708498, "link": "https://stackoverflow.com/questions/48708498/how-change-the-active-field-to-inactive-keeping-the-value-of-the-field-intact-us/48710091#48710091", "title": "How change the active field to inactive keeping the value of the field intact using golang?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    var x S\n\n    json.Unmarshal(data,&amp;x)\n    for _,img:=range x.Image {\n        Deactive(img)\n    }\n\n\n    b,_:=json.Marshal(x)\n    fmt.Println(string(b))\n}\n\ntype S struct {\n    Image []map[string]interface{} `json:\"image\"`\n}\n\nfunc Deactive(x map[string]interface{}) {\n    if v,ok := x[\"active\"]; ok {\n        delete(x,\"active\")\n        x[\"inactvie\"]=v\n    }\n}\n\nvar data = []byte(` {\"image\": [\n  {\n    \"bytesize\": \"-2\",\n    \"default\": \"redlight_drdefault\"\n  },\n  {\n    \"active\": \"JV77tdMcHkChFaF2H9uoDHepPhUcrlprYEsQr-r-1lg=\",\n    \"bytesize\": \"566806\"\n  }\n]}\n`)\n</code></pre>\n\n<p>As I said, use <code>map[string]interface{}</code>. But put it as deep as possible in the nested structure for it is messy and tricky.</p>\n\n<p>The <code>Deactive</code> takes in the map and looks for an <code>active</code> key, if there is one, it will take the value, insert an <code>inactive</code> key with that value, and delete <code>actvie</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 1213174, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5QTy2.jpg?s=128&g=1", "display_name": "Igor Khristenko", "link": "https://stackoverflow.com/users/1213174/igor-khristenko"}, "is_accepted": false, "score": 1, "last_activity_date": 1518194867, "creation_date": 1518194867, "answer_id": 48710489, "question_id": 48708498, "link": "https://stackoverflow.com/questions/48708498/how-change-the-active-field-to-inactive-keeping-the-value-of-the-field-intact-us/48710489#48710489", "title": "How change the active field to inactive keeping the value of the field intact using golang?", "body": "<p>Solution with predefined structures. <a href=\"https://play.golang.org/p/Y3xpESlbbN3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y3xpESlbbN3</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype (\n    images struct {\n        Image []image `json:\"image\"`\n    }\n\n    image struct {\n        Active string `json:\"active,omitempty\"`\n        common\n    }\n\n    newImages struct {\n        Image []newImage `json:\"image\"`\n    }\n\n    newImage struct {\n        common\n        Inactive string `json:\"inactive,omitempty\"`\n    }\n\n    common struct {\n        Bytesize string `json:\"bytesize\"`\n        Default  string `json:\"default,omitempty\"`\n    }\n)\n\nvar i = []byte(`\n {\"image\": [\n  {\n    \"bytesize\": \"-2\",\n    \"default\": \"redlight_drdefault\"\n  },\n  {\n    \"active\": \"JV77tdMcHkChFaF2H9uoDHepPhUcrlprYEsQr-r-1lg=\",\n    \"bytesize\": \"566806\"\n  }\n]}\n`)\n\nfunc main() {\n\n    var images images\n    e := json.Unmarshal(i, &amp;images)\n    if e != nil {\n        panic(e)\n    }\n\n    var newImages newImages\n    for k, _ := range images.Image {\n\n        newImg := newImage{}\n        if len(images.Image[k].Active) &gt; 0 {\n            newImg.Inactive = images.Image[k].Active\n        }\n        newImg.Default = images.Image[k].Default\n        newImg.Bytesize = images.Image[k].Bytesize\n        newImages.Image = append(newImages.Image, newImg)\n\n    }\n\n    result, e := json.Marshal(newImages)\n    if e != nil {\n        panic(e)\n    }\n    fmt.Println(string(result))\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7026738, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-STmShyO0LPs/AAAAAAAAAAI/AAAAAAAAAFk/VYSZiZio5Ag/photo.jpg?sz=128", "display_name": "Vikas", "link": "https://stackoverflow.com/users/7026738/vikas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 48709112, "answer_count": 3, "score": -2, "last_activity_date": 1518202273, "creation_date": 1518188125, "last_edit_date": 1518202273, "question_id": 48708498, "link": "https://stackoverflow.com/questions/48708498/how-change-the-active-field-to-inactive-keeping-the-value-of-the-field-intact-us", "title": "How change the active field to inactive keeping the value of the field intact using golang?", "body": "<p>I have the following json structure for image:</p>\n\n<pre><code> {\"image\": [\n  {\n    \"bytesize\": \"-2\",\n    \"default\": \"redlight_drdefault\"\n  },\n  {\n    \"active\": \"JV77tdMcHkChFaF2H9uoDHepPhUcrlprYEsQr-r-1lg=\",\n    \"bytesize\": \"566806\"\n  }\n]}\n</code></pre>\n\n<p>I want to change the the field named \"active\" to \"inactive\" without changing the value stored in the field like the following:</p>\n\n<pre><code>    {\"image\": [\n  {\n    \"bytesize\": \"-2\",\n    \"default\": \"redlight_drdefault\"\n  },\n  {\n    \"inactive\": \"JV77tdMcHkChFaF2H9uoDHepPhUcrlprYEsQr-r-1lg=\",\n    \"bytesize\": \"566806\"\n  }\n]}\n</code></pre>\n\n<p>Do anyone has the solution how to do this??If u can show this on playground it will be great.</p>\n\n<p>I am having difficulty in appending new value which is:</p>\n\n<pre><code>    mapactive := map[string]string{\"active\": \"gj65vn768=\", \n    \"bytesize\":\"76878768\" }\n</code></pre>\n\n<p>How to append this to the solutions provided to me???This should be appended at the end of making all active keys inactive.</p>\n"}, {"tags": ["go", "twitter", "anaconda", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1518182535, "creation_date": 1518182535, "answer_id": 48706865, "question_id": 48706603, "link": "https://stackoverflow.com/questions/48706603/breaking-anacondas-twitter-stream-when-needed/48706865#48706865", "title": "Breaking anaconda&#39;s twitter stream when needed", "body": "<p>You are starting the gouroutine <code>go After(&amp;stop)</code> <strong>after</strong> the <code>for</code> loop, which the goroutine needs to break. That results in the loop never get broken and the gouroutine never starts.</p>\n\n<p>To fix it, simply put <code>go After(&amp;stop)</code> before the <code>for</code> loop.</p>\n"}], "owner": {"reputation": 75, "user_id": 7346862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/084ca301ad69f6ec806973b0a2f5d803?s=128&d=identicon&r=PG&f=1", "display_name": "apaillarse", "link": "https://stackoverflow.com/users/7346862/apaillarse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 48706865, "answer_count": 1, "score": 0, "last_activity_date": 1518182535, "creation_date": 1518181670, "last_edit_date": 1518182472, "question_id": 48706603, "link": "https://stackoverflow.com/questions/48706603/breaking-anacondas-twitter-stream-when-needed", "title": "Breaking anaconda&#39;s twitter stream when needed", "body": "<p>I have a bit of code that listen to twitter's live tweets containing a particular word (here \"obama\" for the example) and prints them using the anaconda package (<a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow noreferrer\">https://github.com/ChimeraCoder/anaconda</a>).</p>\n\n<p>I want to be able to shut down the stream of tweets at a given moment when I call an other function. In order to do this, I tried to have a channel called \"stop\" that whenever it receive a value, the program stops listening to the stream.</p>\n\n<p>I tried the following code to stop the stream after 10 seconds of execution :</p>\n\n<pre><code>    func main() {\n            trackingArray := []string{ \"obama\"}\n\n            anaconda.SetConsumerKey(consumerKey)\n            anaconda.SetConsumerSecret(consumerSecret)\n\n            api := anaconda.NewTwitterApi(accessToken, accessTokenSecret)\n\n            stream := api.PublicStreamFilter(url.Values{\n                        \"track\":    trackingArray,\n            })\n\n            stop := make(chan int)\n\n            for {\n                select {\n                    case v := &lt;- stream.C :\n                        tweet, ok := v.(anaconda.Tweet)\n                        if !ok {\n                            /* handle incorrect type */\n                            continue\n                        }\n\n                        fmt.Print(tweet)\n\n                    case &lt;- stop :\n                        stream.Stop()\n                        break\n\n                    }\n                }\n\n           go After(&amp;stop)\n    }\n\n    func After(stop *chan int){\n        time.Sleep(time.Second * 10)\n        *stop &lt;- 1\n    }\n</code></pre>\n\n<p>This code doesn't work at all and the stream never stops...</p>\n\n<p>My stop channel should be reusable as the goal behind this would be that it act as a on/off toggle to start/stop listening to twitter's stream.</p>\n\n<p>It may be a newbie question but I thought I had understood how channels work and I'm kinda lost here...\nThanks in advance for your time!</p>\n"}, {"tags": ["ruby-on-rails", "mongodb", "go", "binary", "bson"], "answers": [{"comments": [{"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518179098, "post_id": 48705740, "comment_id": 84409890, "body": "When i store it in my mongoDB from my Rails API, i receive public_key params as Base64 format, but i decode it to binary and then i stored it with this code         <code>BSON::Binary.new(public_key, :generic)</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518179412, "post_id": 48705740, "comment_id": 84410074, "body": "@calvinsugianto Then maybe your decoding code has some errors."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518179512, "post_id": 48705740, "comment_id": 84410141, "body": "i think my decoding doesn&#39;t have some errors, because when i retrieve my data in Rails, i get 100% exactly matched Base64 that i sent before."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518179568, "post_id": 48705740, "comment_id": 84410180, "body": "@calvinsugianto That&#39;s not very convincing. If you want help, please post more of your code. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518180622, "post_id": 48705740, "comment_id": 84410883, "body": "@calvinsugianto I&#39;m interested more in how you save these values to MongoDB using Go, not how you load them; because the public key Base64 in MongoDB already seems to be corrupt."}, {"owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518192515, "post_id": 48705740, "comment_id": 84418405, "body": "actually, i don&#39;t save it using Go, I save it from my Rails project and when i retrieve it in rails from Database, it is still fine and there isn&#39;t any corruption"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1518195373, "post_id": 48705740, "comment_id": 84420133, "body": "So we can safely assume that rails ignores the newlines, no?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "edited": false, "score": 0, "creation_date": 1518195660, "post_id": 48705740, "comment_id": 84420312, "body": "@calvinsugianto Please execute a query (filtered by <code>_id</code>) in your MongoDB console, and post the document you see there."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1518178892, "creation_date": 1518178892, "answer_id": 48705740, "question_id": 48705574, "link": "https://stackoverflow.com/questions/48705574/retrieve-bson-binary-with-completed-data/48705740#48705740", "title": "retrieve bson.Binary with completed Data", "body": "<p>Your original data contains exactly 4 newline characters <code>\\n</code>:</p>\n\n<pre><code>Axj5A9BgkKJohGh/0BAQEFAAMBjYAAMYmCAYGACqW0smeNiaIgRgXJv7dLZ0\\n\n5gTeXxiI9q6h8EdbiPDLiFsv7Jgatwxm+OpucrUBp4sZp/othrSQWnJQR5vp\\n\nCZYZnNJUdjTAYw+PyjQ2qq9YEeLHMnMzhYgaq2ata+CSsCjalkOyzLt/rDEB\\n\n5WHaCfYm0Vm+QbbEWVLltUqcjvScOyAwEAAQ\\n\n</code></pre>\n\n<p>These newline characters are not part of the Base64 encoded data, they are just to format the input.</p>\n\n<p>Problem arises likely when you try to store this as a raw string literal, because this is an interpreted string literal, the <code>\\n</code> sequences are to be discarded / removed.</p>\n\n<p>Since the backslash is an invalid symbol for \"normal\" Base64, they are removed, though the subsequent <code>n</code> is not (because <code>n</code> is valid in Base64). As a result, you get corrupted Base64 data.</p>\n\n<p>You should either completely remove the line endings and then you get a valid Base64 which you may store either as a string or binary; or store it as a general string which will preserve the line endings (which have to be dealt with during base64 decoding).</p>\n"}], "owner": {"reputation": 500, "user_id": 4511009, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/6268aff8a32d4666a7c0ed9b418f6bb4?s=128&d=identicon&r=PG&f=1", "display_name": "calvin sugianto", "link": "https://stackoverflow.com/users/4511009/calvin-sugianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518215538, "creation_date": 1518178333, "last_edit_date": 1518215538, "question_id": 48705574, "link": "https://stackoverflow.com/questions/48705574/retrieve-bson-binary-with-completed-data", "title": "retrieve bson.Binary with completed Data", "body": "<p>I'm using MongoDB for my Go and Rails projects (using same database) and i have a bson.Binary data in my document (contain Base64 encoded publicKey)</p>\n\n<pre><code>type Device struct {\n  Id            string          `json:\"id\" form:\"id\" bson:\"_id\"`\n  PublicKey     bson.Binary     `json:\"pub_key\" form:\"pub_key\" bson:\"public_key\"`\n  Token         string          `json:\"token\" form:\"token\" bson:\"token\"`\n  CreatedAt     time.Time       `json:\"created_at\" bson:\"created_at\"`\n  UpdatedAt     time.Time       `json:\"updated_at\" bson:\"updated_at\"`\n}\n</code></pre>\n\n<p>but when i retrieve it in my Go projects and the data is somehow corrupted (4 characters are missing)</p>\n\n<pre><code>device := models.Device{}\nerr = db.C(models.CollectionDevice).Find(bson.M{\"_id\": deviceId}).One(&amp;device)\n\npublicKey := device.PublicKey\npublicKeyBase64 := base64.StdEncoding.EncodeToString(publicKey.Data)\nfmt.Println(\"publicKey BinaryData: \", publicKey.Data)\n</code></pre>\n\n<p>t</p>\n\n<pre><code>\"pub_key\": {\n        \"Kind\": 0,\n        \"Data\": \"Axj5A9BgkKJohGh/0BAQEFAAMBjYAAMYmCAYGACqW0smeNiaIgRgXJv7dLZ0n5gTeXxiI9q6h8EdbiPDLiFsv7Jgatwxm+OpucrUBp4sZp/othrSQWnJQR5vpnCZYZnNJUdjTAYw+PyjQ2qq9YEeLHMnMzhYgaq2ata+CSsCjalkOyzLt/rDEBn5WHaCfYm0Vm+QbbEWVLltUqcjvScOyAwEAAQn\"\n}\n</code></pre>\n\n<p>(220 characters length in Data)</p>\n\n<p>the original Base64 encoded string is </p>\n\n<p>Axj5A9BgkKJohGh/0BAQEFAAMBjYAAMYmCAYGACqW0smeNiaIgRgXJv7dLZ0\\n5gTeXxiI9q6h8EdbiPDLiFsv7Jgatwxm+OpucrUBp4sZp/othrSQWnJQR5vp\\nCZYZnNJUdjTAYw+PyjQ2qq9YEeLHMnMzhYgaq2ata+CSsCjalkOyzLt/rDEB\\n5WHaCfYm0Vm+QbbEWVLltUqcjvScOyAwEAAQ\\n</p>\n\n<p>with 224 characters</p>\n\n<p>i use this code in my Go projects:</p>\n\n<pre><code>fmt.Println(\"publicKey: \", publicKey.Data)\n//publicKey is bson.Binary data type\n</code></pre>\n\n<p>i have tried to retrieve the data from my rails projects (same database) and it retrieve correctly</p>\n\n<pre><code>public_key.as_json[\"$binary\"]\n</code></pre>\n\n<p>the result is exactly right (224 characters) : </p>\n\n<pre><code>\"Axj5A9BgkKJohGh/0BAQEFAAMBjYAAMYmCAYGACqW0smeNiaIgRgXJv7dLZ0\\nn5gTeXxiI9q6h8EdbiPDLiFsv7Jgatwxm+OpucrUBp4sZp/othrSQWnJQR5v\\npnCZYZnNJUdjTAYw+PyjQ2qq9YEeLHMnMzhYgaq2ata+CSsCjalkOyzLt/rD\\nEBn5WHaCfYm0Vm+QbbEWVLltUqcjvScOyAwEAAQn\\n\"   \n</code></pre>\n\n<p>As you can see, there is still a \\n at the last of string. Any one know why 4 characters are missing in Go ? </p>\n\n<p>===== Additional information =====</p>\n\n<p>When i store it in my mongoDB from my Rails API, i receive public_key params as Base64 format, but i decode it to binary and then i stored it with this code </p>\n\n<pre><code>def create\n  params = device_params      \n  public_key = Base64.decode64 device_params[:public_key]\n  params[:public_key] = BSON::Binary.new(public_key, :generic)\n  device = Device.find_or_create_by(id: device_params[:id])\n\n  render_success device.update_attributes(params), device\nend\n</code></pre>\n"}, {"tags": ["go", "syntax", "channel"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 5, "creation_date": 1518177758, "post_id": 48705361, "comment_id": 84409085, "body": "&quot;Put in other words, I don&#39;t see a channel here.&quot; <code>time.After</code> returns a channel."}], "answers": [{"comments": [{"owner": {"reputation": 1028, "user_id": 7119728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YXaGr.png?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/7119728/andy"}, "edited": false, "score": 0, "creation_date": 1518177892, "post_id": 48705391, "comment_id": 84409168, "body": "Thank you, I was getting confused with the following: <code>func (t Time) After(u Time) bool</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 1028, "user_id": 7119728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YXaGr.png?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/7119728/andy"}, "edited": false, "score": 0, "creation_date": 1518178063, "post_id": 48705391, "comment_id": 84409272, "body": "Good point. I&#39;ve added a mention of the <code>Time.After</code> method for future visitors."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1518178029, "last_edit_date": 1518178029, "creation_date": 1518177778, "answer_id": 48705391, "question_id": 48705361, "link": "https://stackoverflow.com/questions/48705361/channel-receive-operator-used-with-something-which-is-not-a-channel/48705391#48705391", "title": "Channel receive operator used with something which is not a channel?", "body": "<p><a href=\"https://golang.org/pkg/time/#After\" rel=\"nofollow noreferrer\">time.After</a> returns a channel:</p>\n\n<pre><code>func After(d Duration) &lt;-chan Time\n</code></pre>\n\n<p>The <code>&lt;-time.After(...)</code> just waits until there is an element to read from the channel, which happens after the amount of time specified has elapsed. The channel value is the time after the duration.</p>\n\n<p>This function is a package function, which should not be confused with the method on <code>Time</code>:\n<code>func (t Time) After(u Time) bool</code> which just returns whether <code>t</code> is after <code>u</code>. This method would be called with: <code>if sometimevariable.After(...) {</code></p>\n"}], "owner": {"reputation": 1028, "user_id": 7119728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YXaGr.png?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/7119728/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 48705391, "answer_count": 1, "score": -2, "last_activity_date": 1518182460, "creation_date": 1518177674, "last_edit_date": 1518182460, "question_id": 48705361, "link": "https://stackoverflow.com/questions/48705361/channel-receive-operator-used-with-something-which-is-not-a-channel", "title": "Channel receive operator used with something which is not a channel?", "body": "<p>I would like to understand the meaning of this code:</p>\n\n<p><code>&lt;-</code></p>\n\n<p>in the following snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc doSomething(s string) {\n    fmt.Println(\"doing something\", s)\n}\n\nfunc startPolling() {\n    for {\n\n        // Here:\n        &lt;-time.After(2 * time.Second)\n\n        go doSomething(\"from polling\")\n    }\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello\")\n}\n\nfunc main() {\n    go startPolling()\n\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>While I understand what this code does (it prints <em>doing something from polling</em> every 2 seconds) I don't understand why <code>&lt;-</code> is being used outside of its normal context of sending to/receiving from channels.</p>\n\n<p>Put in other words, I don't see a channel here.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518176797, "post_id": 48705069, "comment_id": 84408500, "body": "Have you tried anything? The simplest solution is to <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">Unmarshal</a> it. If you want only what field, you could unmarshal into a struct that contains only that field name."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518176828, "post_id": 48705069, "comment_id": 84408520, "body": "@Marc: The simplest solution is to RTFM. No Unmarshaling is necessary (or even supported at that level)."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518176954, "post_id": 48705069, "comment_id": 84408610, "body": "That&#39;s definitely better. I saw json in the title and didn&#39;t examine the logs carefully. So yes, it&#39;s just a struct."}, {"owner": {"reputation": 349, "user_id": 5147069, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/03b0eeaca02e0154c2a8278e052a88ee?s=128&d=identicon&r=PG&f=1", "display_name": "Scholli", "link": "https://stackoverflow.com/users/5147069/scholli"}, "edited": false, "score": 0, "creation_date": 1518177235, "post_id": 48705069, "comment_id": 84408765, "body": "You have a link to RTFM? never heard this before. Working golang 2 days"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1518195566, "post_id": 48705069, "comment_id": 84420251, "body": "@Scholli RTFM stands for &quot;Read the f...ing manual&quot; and is a more or less polite hint that you should probably get a clue about the very basics first ;)"}], "answers": [{"comments": [{"owner": {"reputation": 349, "user_id": 5147069, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/03b0eeaca02e0154c2a8278e052a88ee?s=128&d=identicon&r=PG&f=1", "display_name": "Scholli", "link": "https://stackoverflow.com/users/5147069/scholli"}, "edited": false, "score": 0, "creation_date": 1518177191, "post_id": 48705129, "comment_id": 84408741, "body": "like that? <code>fmt.Println(Coin[&quot;price_usd&quot;])</code> than i get an error <code>storage&#47;redis.go:890: undefined: Coin</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1518177310, "post_id": 48705129, "comment_id": 84408807, "body": "no, like <code>coinInfo.PriceUsd</code>. <code>Coin</code> is a struct, you just access its fields. Please take the <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Go tour</a>, you seem really unfamiliar with the language."}, {"owner": {"reputation": 349, "user_id": 5147069, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/03b0eeaca02e0154c2a8278e052a88ee?s=128&d=identicon&r=PG&f=1", "display_name": "Scholli", "link": "https://stackoverflow.com/users/5147069/scholli"}, "edited": false, "score": 0, "creation_date": 1518177417, "post_id": 48705129, "comment_id": 84408875, "body": "Oh thanks a lot! That works! I am new 2 days on golang. I have a little done of the tour :)"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1518177444, "post_id": 48705129, "comment_id": 84408893, "body": "Please take the entire tour, if you don&#39;t understand how structs and fields work in Go, you&#39;re not going to get very far with the language."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1518176810, "creation_date": 1518176810, "answer_id": 48705129, "question_id": 48705069, "link": "https://stackoverflow.com/questions/48705069/golang-get-only-one-stat-from-json/48705129#48705129", "title": "golang get only one stat from json", "body": "<p>According to <a href=\"https://godoc.org/github.com/miguelmota/go-coinmarketcap#Coin\" rel=\"nofollow noreferrer\">the docs</a>, you can use the <code>PriceUsd</code> field of the <code>Coin</code> type for this.</p>\n"}], "owner": {"reputation": 349, "user_id": 5147069, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/03b0eeaca02e0154c2a8278e052a88ee?s=128&d=identicon&r=PG&f=1", "display_name": "Scholli", "link": "https://stackoverflow.com/users/5147069/scholli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 48705129, "answer_count": 1, "score": -6, "last_activity_date": 1518176810, "creation_date": 1518176625, "question_id": 48705069, "link": "https://stackoverflow.com/questions/48705069/golang-get-only-one-stat-from-json", "title": "golang get only one stat from json", "body": "<p>i tried to get one stat from web api request in json.\nThis is what called <a href=\"https://api.coinmarketcap.com/v1/ticker/ethereum/\" rel=\"nofollow noreferrer\">https://api.coinmarketcap.com/v1/ticker/ethereum/</a></p>\n\n<p>I use this github code example <code>// Get info about coin</code></p>\n\n<pre><code>coinInfo, err := coinApi.GetCoinData(\"ethereum\")\nif err != nil {\n    log.Println(err)\n} else {\n    fmt.Println(coinInfo)\n}\n</code></pre>\n\n<p>My result in log says </p>\n\n<pre><code>{ethereum Ethereum ETH 2 830.48 0.100287 3.23573e+09 8.0977392218e+10 9.7506734e+07 9.7506734e+07 0.61 -0.65 -7.36 1518176353}\n</code></pre>\n\n<p>But i want only the price_usd if you look at the api domain. Why cannot get only price?\nAlready tried <code>coinInfo['price_usd']</code> but its all not working</p>\n\n<p>Here you find the functions to run the GetCoinData \n<a href=\"https://github.com/miguelmota/go-coinmarketcap/blob/master/coinmarketcap.go\" rel=\"nofollow noreferrer\">https://github.com/miguelmota/go-coinmarketcap/blob/master/coinmarketcap.go</a></p>\n\n<p>Can someone help me to get only the price_usd from api in golang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 4, "creation_date": 1518166854, "post_id": 48702080, "comment_id": 84402506, "body": "Why do you say <i>&quot;The method ServeHTTP is attached to type hotdog, but is never ran&quot;</i> ? Did you read the documentation of the net/http package ? Do you understand the concept of <i>interface</i> ?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1518166822, "creation_date": 1518166822, "answer_id": 48702105, "question_id": 48702080, "link": "https://stackoverflow.com/questions/48702080/why-does-code-inside-unused-method-run/48702105#48702105", "title": "Why does code inside unused method run?", "body": "<p>It is run.  <code>ListenAndServe</code> calls it for every request made to your server.</p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 1, "last_activity_date": 1518187901, "last_edit_date": 1518187901, "creation_date": 1518167212, "answer_id": 48702211, "question_id": 48702080, "link": "https://stackoverflow.com/questions/48702080/why-does-code-inside-unused-method-run/48702211#48702211", "title": "Why does code inside unused method run?", "body": "<p>Since you passed <code>hotdog</code>, which implements <code>ServeHTTP</code>, as a handler, every request received will be sent to hotdog's <code>ServeHTTP</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 1, "last_activity_date": 1518167839, "creation_date": 1518167839, "answer_id": 48702391, "question_id": 48702080, "link": "https://stackoverflow.com/questions/48702080/why-does-code-inside-unused-method-run/48702391#48702391", "title": "Why does code inside unused method run?", "body": "<p>this function is run when the type hotdog is used</p>\n\n<pre><code>func (m hotdog) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Any code you want in this func\")\n}\n</code></pre>\n\n<p>in the main you create variable d with the type hotdog,</p>\n\n<p>then in the ListenAndServe and you tell your code to use variable d every time someone connects to your server and because d is of type hotdog your first function is run everytime someone connects</p>\n\n<pre><code>func main() {\n    var d hotdog\n    http.ListenAndServe(\":8080\", d)\n}\n</code></pre>\n"}], "owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 3, "score": -7, "last_activity_date": 1518187901, "creation_date": 1518166744, "question_id": 48702080, "link": "https://stackoverflow.com/questions/48702080/why-does-code-inside-unused-method-run", "title": "Why does code inside unused method run?", "body": "<p>The code below comes from Todd Mcleod's Golang web-dev course. What I fail to understand - even watching his video's over and over and googling everything about methods- is the following: <strong>The method ServeHTTP is attached to type hotdog, but is never ran. Still the code inside the method (in this case Fprintln(...) is executed.</strong> (When you run this code and go to localhost:8080, it diesplays \"Any code you want in this func\".) Could anyone explain me why this is?</p>\n\n<p>Thanks a lot! </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n     \"net/http\"\n)\n\ntype hotdog int\n\n func (m hotdog) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n     fmt.Fprintln(w, \"Any code you want in this func\")\n}\n\n func main() {\n    var d hotdog\n    http.ListenAndServe(\":8080\", d)\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "oauth-2.0", "google-signin"], "comments": [{"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1518358399, "post_id": 48701354, "comment_id": 84463930, "body": "This isn&#39;t an answer but it looks to me like you want to do what the openidconnect client libraries are doing: <a href=\"https://developers.google.com/identity/protocols/OpenIDConnect#libraries\" rel=\"nofollow noreferrer\">developers.google.com/identity/protocols/&hellip;</a>. Unfortunately it doesn&#39;t appear that there is one for Go."}], "answers": [{"comments": [{"owner": {"reputation": 1362, "user_id": 4937930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aVBTl.jpg?s=128&g=1", "display_name": "yaegashi", "link": "https://stackoverflow.com/users/4937930/yaegashi"}, "edited": false, "score": 0, "creation_date": 1518892151, "post_id": 48812199, "comment_id": 84693394, "body": "Thanks, I&#39;ve never come up with the remote API.  It could be useful for some tasks, but apparently it wouldn&#39;t suit my needs.  It provides no access to web server handlers which embody app&#39;s business logics.  I don&#39;t want to embed them into a CLI client because it requires users to keep it updated."}, {"owner": {"reputation": 954, "user_id": 9188803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CESgG.png?s=128&g=1", "display_name": "Rodrigo C.", "link": "https://stackoverflow.com/users/9188803/rodrigo-c"}, "reply_to_user": {"reputation": 1362, "user_id": 4937930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aVBTl.jpg?s=128&g=1", "display_name": "yaegashi", "link": "https://stackoverflow.com/users/4937930/yaegashi"}, "edited": false, "score": 0, "creation_date": 1519044540, "post_id": 48812199, "comment_id": 84736268, "body": "Have you tried using an <a href=\"https://cloud.google.com/iap/docs/concepts-overview\" rel=\"nofollow noreferrer\">Identity Aware Proxy</a> to secure your app? That way you can control the access to your app and ensure the authentication and authorization process only works for the proper users without relying on external sources.  Alternatively, you can also use <a href=\"https://cloud.google.com/endpoints/\" rel=\"nofollow noreferrer\">Cloud Endpoints</a> to have complete control over who can access your app by using JSON Web Tokens and API keys."}], "tags": [], "owner": {"reputation": 954, "user_id": 9188803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CESgG.png?s=128&g=1", "display_name": "Rodrigo C.", "link": "https://stackoverflow.com/users/9188803/rodrigo-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1518712876, "creation_date": 1518712876, "answer_id": 48812199, "question_id": 48701354, "link": "https://stackoverflow.com/questions/48701354/go-client-to-access-gae-login-required-apps/48812199#48812199", "title": "Go client to access GAE login required apps", "body": "<p>Given the situation you explain here, I suggest using a <a href=\"https://cloud.google.com/appengine/docs/standard/go/tools/remoteapi/\" rel=\"nofollow noreferrer\">remote API</a>. This way you can access App Engine services from your Go app.</p>\n\n<p>First you have to configure your <code>app.yaml</code> file by adding the following:</p>\n\n<pre><code>- url: /_ah/remote_api\n  script: _go_app\n</code></pre>\n\n<p>You also have to add the following import to your <code>.go</code> source file:</p>\n\n<pre><code>import _ \"google.golang.org/appengine/remote_api\"\n</code></pre>\n\n<p>When this is done, deploy your updated app to App Engine:</p>\n\n<pre><code>gcloud app deploy app.yaml\n</code></pre>\n\n<p>The website I included here includes an example on how to use the remote API. You can try it and adapt your code if this works for you.</p>\n"}], "owner": {"reputation": 1362, "user_id": 4937930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aVBTl.jpg?s=128&g=1", "display_name": "yaegashi", "link": "https://stackoverflow.com/users/4937930/yaegashi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1518712876, "creation_date": 1518164064, "last_edit_date": 1518383000, "question_id": 48701354, "link": "https://stackoverflow.com/questions/48701354/go-client-to-access-gae-login-required-apps", "title": "Go client to access GAE login required apps", "body": "<p>I wanted to authenticate myself (Google Account) using a golang client against protected apps on Google App Engine where <code>login: required</code> or <code>login: admin</code> is specified in app.yaml.</p>\n\n<p>First I wrote a simple OAuth2 offline access client but it didn't work at all - the server just redirects clients to Google Account's sign in page.  I've tried with various Google API scopes and currently no luck.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n)\n\nconst (\n    AppURL           = \"https://login-requried-app.appspot.com\"\n    AuthClientID     = \".....\"\n    AuthClientSecret = \".....\"\n    AuthRedirectURL  = \"urn:ietf:wg:oauth:2.0:oob\"\n    AuthScope        = \"https://www.googleapis.com/auth/cloud-platform\"\n)\n\nfunc main() {\n    ctx := context.Background()\n    conf := &amp;oauth2.Config{\n        ClientID:     AuthClientID,\n        ClientSecret: AuthClientSecret,\n        Endpoint:     google.Endpoint,\n        RedirectURL:  AuthRedirectURL,\n        Scopes:       []string{AuthScope},\n    }\n\n    url := conf.AuthCodeURL(\"state\", oauth2.AccessTypeOffline)\n    fmt.Printf(\"Visit the URL for the auth dialog: %v\\n\", url)\n    fmt.Printf(\"Enter authentication code: \")\n\n    var code string\n    if _, err := fmt.Scan(&amp;code); err != nil {\n        log.Fatal(err)\n    }\n    tok, err := conf.Exchange(ctx, code)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    client := conf.Client(ctx, tok)\n\n    res, err := client.Get(AppURL)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer res.Body.Close()\n\n    log.Println(res.Status)\n    io.Copy(os.Stdout, res.Body)\n}\n</code></pre>\n\n<p>I'm looking for the details of GAE's user authentication modes used in such apps to write a non web browser client.  I feel it's something different than standard OAuth2 authentication/authorization after reading App Engine Users API docs and code that is receiving user information via HTTP headers like <code>X-AppEngine-User-Email</code>. </p>\n\n<ul>\n<li><a href=\"https://cloud.google.com/appengine/docs/standard/go/users/\" rel=\"noreferrer\">Users Go API Overview</a></li>\n<li><a href=\"https://godoc.org/google.golang.org/appengine/user\" rel=\"noreferrer\">google.golang.org/appengine/user package document</a></li>\n<li><a href=\"https://github.com/golang/appengine/blob/master/user/user_vm.go#L15-L31\" rel=\"noreferrer\">user.Current() implementation</a> (it's for flex env but almost the same in standard env)</li>\n</ul>\n\n<p><strong>UPDATE:</strong> After some research it looks like the GAE frontend uses <code>SACSID</code> cookie for tracking authenticated sessions, which isn't related to the OAuth2 standard.  Indeed as stated in <a href=\"https://cloud.google.com/appengine/docs/standard/go/users/\" rel=\"noreferrer\">Users Go API document</a>:</p>\n\n<blockquote>\n  <p>Note that using OAuth to identify your users is completely orthogonal to the standard user authentication modes. For example, pages marked with login: required or login: admin will refuse to load if the user is only authenticated via OAuth.</p>\n</blockquote>\n\n<p>Is there any supported way for a CLI application to acquire <code>SACSID</code> properly authorized by user's consent?</p>\n\n<p>Related questions:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/31065058/4937930\">Access an App Engine app from command line using OAuth2?</a></li>\n<li><a href=\"https://stackoverflow.com/q/8342096/4937930\">On Google App Engine, can I relate a Google OAuth 2 Token and a SACSID token I got using Android&#39;s AccountManager?</a></li>\n</ul>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "is_accepted": false, "score": 2, "last_activity_date": 1518163359, "last_edit_date": 1518163359, "creation_date": 1518162405, "answer_id": 48700998, "question_id": 48700907, "link": "https://stackoverflow.com/questions/48700907/how-to-assign-a-value-to-the-empty-slice-after-the-declaration/48700998#48700998", "title": "How to assign a value to the empty slice after the declaration", "body": "<pre><code>// slice declaration; no memory allocation\nvar slice []int \n\n//slice initialization with length (0) and capacity (10);\n//memory allocated for 10 ints\nslice = make([]int, 0, 10)\n\n // push to the slice value - than increase length\nslice = append(slice, 1)\n\n//change the value. Index has to be lower then length of slice\nslice[0] = 2\n</code></pre>\n\n<p>Take a loot at this output - <a href=\"https://play.golang.com/p/U426b1I5zRq\" rel=\"nofollow noreferrer\">https://play.golang.com/p/U426b1I5zRq</a></p>\n\n<p>Of course, you can skip initialization with <code>make</code>, <code>append</code> will do it for you with default value of capacity (2). But for performance it is better to allocate memory only once (if you know how many elements are going to be added to the slice)</p>\n"}, {"comments": [{"owner": {"reputation": 990, "user_id": 5076451, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh5.googleusercontent.com/-eIqyils0CLA/AAAAAAAAAAI/AAAAAAAAABU/j7Ka4lpaxJo/photo.jpg?sz=128", "display_name": "Venkat Ch", "link": "https://stackoverflow.com/users/5076451/venkat-ch"}, "edited": false, "score": 0, "creation_date": 1518163484, "post_id": 48701006, "comment_id": 84400828, "body": "Thanks for guides @Marc."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 10, "last_activity_date": 1518162993, "last_edit_date": 1518162993, "creation_date": 1518162422, "answer_id": 48701006, "question_id": 48700907, "link": "https://stackoverflow.com/questions/48700907/how-to-assign-a-value-to-the-empty-slice-after-the-declaration/48701006#48701006", "title": "How to assign a value to the empty slice after the declaration", "body": "<p>Empty slices cannot just be assigned to. Your print statement shows that the slice has length and capacity of 0. Indexing at <code>[0]</code> is definitely out of bounds.</p>\n\n<p>You have (at least) three choices:</p>\n\n<ul>\n<li>Append to the slice: <code>s = append(s, 99)</code></li>\n<li>or Initialize the slice to be non-empty: <code>s := make([]int, 1)</code></li>\n<li>or Initialize your slice with the element you want: <code>s := []int{99}</code></li>\n</ul>\n\n<p>You can find tutorials on slices in the <a href=\"https://tour.golang.org/moretypes/7\" rel=\"noreferrer\">Go tour</a>, or a lot more details about <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">slice usage and internals</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 542, "user_id": 5822368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q75QC.jpg?s=128&g=1", "display_name": "Vikram Jakhar", "link": "https://stackoverflow.com/users/5822368/vikram-jakhar"}, "is_accepted": false, "score": 3, "last_activity_date": 1518162472, "creation_date": 1518162472, "answer_id": 48701015, "question_id": 48700907, "link": "https://stackoverflow.com/questions/48700907/how-to-assign-a-value-to-the-empty-slice-after-the-declaration/48701015#48701015", "title": "How to assign a value to the empty slice after the declaration", "body": "<p>You can do that by using append function.</p>\n\n<pre><code>func main() {\n    var s []int\n    s = append(s,99)\n    fmt.Println(s)  // [99]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XATvSo2OB6f\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XATvSo2OB6f</a></p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 4, "last_activity_date": 1518162750, "creation_date": 1518162750, "answer_id": 48701076, "question_id": 48700907, "link": "https://stackoverflow.com/questions/48700907/how-to-assign-a-value-to-the-empty-slice-after-the-declaration/48701076#48701076", "title": "How to assign a value to the empty slice after the declaration", "body": "<pre><code>var s []int{99}\n</code></pre>\n\n<p>The above works but if you want to assign after declaration, then you would need to create a slice using <code>make</code> function with enough length</p>\n\n<pre><code>s := make([]int, 10)\ns[0] = 10\nfmt.Println(s)\n</code></pre>\n\n<p>This will initialize slice and set the length to 10 and its elements to zero values</p>\n\n<p>Note: doing <code>s[10]</code> or any greater index will panic since the slice is initialised with length 10. If you want to dynamically increase the slice size, then use <code>append</code></p>\n"}], "owner": {"reputation": 990, "user_id": 5076451, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh5.googleusercontent.com/-eIqyils0CLA/AAAAAAAAAAI/AAAAAAAAABU/j7Ka4lpaxJo/photo.jpg?sz=128", "display_name": "Venkat Ch", "link": "https://stackoverflow.com/users/5076451/venkat-ch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3173, "favorite_count": 3, "accepted_answer_id": 48701006, "answer_count": 4, "score": 7, "last_activity_date": 1518171556, "creation_date": 1518162074, "last_edit_date": 1518171556, "question_id": 48700907, "link": "https://stackoverflow.com/questions/48700907/how-to-assign-a-value-to-the-empty-slice-after-the-declaration", "title": "How to assign a value to the empty slice after the declaration", "body": "<p>I am trying to assign a value to the empty slice as follows.</p>\n\n<pre><code>func main() {\n    var s []int\n    fmt.Println(s, len(s), cap(s))\n    s[0] = 99\n}\n</code></pre>\n\n<p>And it throws an exception,</p>\n\n<blockquote>\n  <p>panic: runtime error: index out of range</p>\n</blockquote>\n\n<p>Note: \nI know one way of doing this by initializing the value at declaration part as follows. But in the above example I am trying to assign a value after the declaration.</p>\n\n<pre><code>var s []int{99}\n</code></pre>\n\n<p>Is there a way to achieve this?</p>\n"}, {"tags": ["go", "struct", "go-interface"], "answers": [{"comments": [{"owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "edited": false, "score": 0, "creation_date": 1546250083, "post_id": 48699501, "comment_id": 94809125, "body": "It is really unobvious that even though <code>CompareTo</code> is declared on <code>node</code>, but that makes <code>Sortable</code> a pointer to <code>node</code>, not <code>node</code>. Which part of the language spec talks about this?"}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 1, "last_activity_date": 1518155391, "creation_date": 1518155391, "answer_id": 48699501, "question_id": 48699310, "link": "https://stackoverflow.com/questions/48699310/golang-struct-pointer-invokes-interface-method/48699501#48699501", "title": "Golang struct pointer invokes interface method", "body": "<p>You have to assert the <code>Sortable t</code> to a pointer node.</p>\n\n<pre><code>func (n node) CompreTo(t Sortable) int{\n    other := t.(*node)\n    if n.value == other.value {\n        return 0\n    } else if n.value &gt; other.value {\n        return 1\n    } else {\n        return -1\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 6139269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fbe5c850f29537ebc4e9aee33b7e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Junxi", "link": "https://stackoverflow.com/users/6139269/junxi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 48699501, "answer_count": 1, "score": 0, "last_activity_date": 1518173240, "creation_date": 1518154406, "last_edit_date": 1518172969, "question_id": 48699310, "link": "https://stackoverflow.com/questions/48699310/golang-struct-pointer-invokes-interface-method", "title": "Golang struct pointer invokes interface method", "body": "<p>I'm picking up Golang and I've got a problem in traversing a linked list. What I intend to do is visit all nodes of the linked list, and call an interface method from each node.</p>\n\n<p>I've defined an interface</p>\n\n<pre><code>type Sortable interface {\n    CompareTo(t Sortable) int\n}\n</code></pre>\n\n<p>I've defined a node type and a linked list</p>\n\n<pre><code>type node struct {\n    pNext *node\n    value int\n}\n\ntype LinkedList struct {\n    PHead, PNode *node\n}\n\nfunc (n node) CompreTo(t Sortable) int{\n    other := t.(node)\n    if n.value == other.value {\n        return 0\n    } else if n.value &gt; other.value {\n        return 1\n    } else {\n        return -1\n    }\n}\n</code></pre>\n\n<p>The problem occurs when I'm doing a comparison while traversing the linked list:\n......</p>\n\n<pre><code>PNode.CompareTo(PNode.pNext)\n</code></pre>\n\n<p>and I get:\npanic: interface conversion: Sortable is *node, not node</p>\n\n<p>Guess this is because PNode and PNode.pNext are pointers to the node struct, not node objects? Then how should I cast the pointer to make it right?\nI used to write in C++ so maybe my strategy goes wrong in Golang world?</p>\n\n<p>Any advice is appreciated!</p>\n"}]