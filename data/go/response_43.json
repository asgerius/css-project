[{"tags": ["go", "import", "packages"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1446688231, "post_id": 33533640, "comment_id": 54852015, "body": "FWIW you should avoid underscores in package names - <code>nessus</code> or <code>gonessus</code> would be better. See here: <a href=\"https://golang.org/doc/effective_go.html#names\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#names</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "is_accepted": false, "score": 0, "last_activity_date": 1446679735, "creation_date": 1446679735, "answer_id": 33534063, "question_id": 33533640, "link": "https://stackoverflow.com/questions/33533640/imported-golang-package-saying-undefined-not-available/33534063#33534063", "title": "Imported Golang Package Saying Undefined / Not Available", "body": "<p>It seems this is a pointers issue. The code should be:</p>\n\n<pre><code>package gonessus\n\nimport (\n    \"fmt\"\n)\n\nfunc (nessus Nessus) MakeClient(host, port, accessKey, secretKey string) *Nessus {\n    return &amp;Nessus{\n        Ip:        fmt.Sprintf(\"%s\", host),\n        Port:      fmt.Sprintf(\"%s\", port),\n        AccessKey: fmt.Sprintf(\"%s\", accessKey),\n        SecretKey: fmt.Sprintf(\"%s\", secretKey),\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1446681676, "creation_date": 1446681676, "answer_id": 33534401, "question_id": 33533640, "link": "https://stackoverflow.com/questions/33533640/imported-golang-package-saying-undefined-not-available/33534401#33534401", "title": "Imported Golang Package Saying Undefined / Not Available", "body": "<p>the problem lies here:</p>\n\n<pre><code>func (nessus *Nessus) MakeClient(host, port, accessKey, secretKey string) Nessus {\n</code></pre>\n\n<p>and here:</p>\n\n<pre><code>    nessusClient := go_nessus.MakeClient(\"localhost\", \"8834\", \"ExampleAccessKey\", \"ExampleSecretKey\")\n</code></pre>\n\n<p>in your package, you are making the function a member of type <code>Nessus</code>\nbut in main you call it as though it were a package level function</p>\n\n<p>I believe you want <code>MakeCliet</code> to be defined as:</p>\n\n<pre><code>func MakeClient(host, port, accessKey, secretKey string) Nessus {\n</code></pre>\n\n<p>which makes it a package level function.</p>\n\n<p>Also, you may want to use pointers here if you don't want to copy the struct around all the time, which would be:\n    func MakeClient(host, port, accessKey, secretKey string) *Nessus {</p>\n\n<p>and then:</p>\n\n<pre><code>return &amp;Nessus{ ...\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 33534401, "answer_count": 2, "score": 0, "last_activity_date": 1446681676, "creation_date": 1446677701, "last_edit_date": 1446678041, "question_id": 33533640, "link": "https://stackoverflow.com/questions/33533640/imported-golang-package-saying-undefined-not-available", "title": "Imported Golang Package Saying Undefined / Not Available", "body": "<p>So I want to create a library that I can use from a script / project I'm building. The library is called go_nessus, (full source code: <a href=\"http://github.com/kkirsche/go-nessus\" rel=\"nofollow\">http://github.com/kkirsche/go-nessus</a>) but I'm having an issue when importing it.</p>\n\n<p>An example of the go_nessus code:</p>\n\n<pre><code># go-nessus/client\npackage go_nessus\n\nimport (\n    \"fmt\"\n)\n\nfunc (nessus *Nessus) MakeClient(host, port, accessKey, secretKey string) Nessus {\n    return Nessus{\n        Ip:        fmt.Sprintf(\"%s\", host),\n        Port:      fmt.Sprintf(\"%s\", port),\n        AccessKey: fmt.Sprintf(\"%s\", accessKey),\n        SecretKey: fmt.Sprintf(\"%s\", secretKey),\n    }\n}\n</code></pre>\n\n<p>When attempting to use this though I get the following error:</p>\n\n<pre><code>~/g/G/s/g/k/attempt \u276f\u276f\u276f go install -race &amp;&amp; $GOPATH/bin/attempt\n# github.com/kkirsche/attempt\n./attempt.go:6: undefined: go_nessus.MakeClient\n</code></pre>\n\n<p>The test file looks like so:</p>\n\n<pre><code>package main\n\nimport \"github.com/kkirsche/go-nessus\"\n\nfunc main() {\n    nessusClient := go_nessus.MakeClient(\"localhost\", \"8834\", \"ExampleAccessKey\", \"ExampleSecretKey\")\n}\n</code></pre>\n\n<p>I sadly though can't figure out how to actually use the methods I've created without errors. Any help would be greatly appreciated in figuring out what's wrong with my import process.</p>\n\n<p>My <code>go env</code>:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"/Users/kkirsche/git/Go/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/kkirsche/git/Go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGO15VENDOREXPERIMENT=\"\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 566, "user_id": 3923799, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4563a74caf6b13d3fe6ba307ee01b10f?s=128&d=identicon&r=PG&f=1", "display_name": "Andy M", "link": "https://stackoverflow.com/users/3923799/andy-m"}, "edited": false, "score": 0, "creation_date": 1446675944, "post_id": 33533219, "comment_id": 54848099, "body": "See: <a href=\"http://stackoverflow.com/questions/11475917/strange-type-definition-syntax-in-golang-name-then-type-then-string-literal\" title=\"strange type definition syntax in golang name then type then string literal\">stackoverflow.com/questions/11475917/&hellip;</a> -- The backtick lets you do raw string literals and the strings are a &quot;tag&quot;"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1446695120, "post_id": 33533219, "comment_id": 54853713, "body": "Also see <a href=\"http://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\">What are the use(s) for tags in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1446688126, "post_id": 33533263, "comment_id": 54851981, "body": "Docs: <a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#StructTag</a> - which is called by the <code>encoding&#47;json</code> and <code>encoding&#47;xml</code> packages (amongst others)."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 5, "last_activity_date": 1446676265, "last_edit_date": 1446676265, "creation_date": 1446675950, "answer_id": 33533263, "question_id": 33533219, "link": "https://stackoverflow.com/questions/33533219/in-golang-what-does-something-mean/33533263#33533263", "title": "In golang what does `something` mean", "body": "<p>Those are called field tags. They're used by the xml encoder/decoder to map the property names to the values in the actual data. In your example they're completely necessary because the fields in XML are lower cased, in Go to have fields on a struct exported they have to be upper cased. Since the xml names diverge from the field names on your type, you have to specify what goes where for the encoding package.</p>\n\n<p>This same convention is used from almost all data transformation/encoding/storage libraries.</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 33533263, "answer_count": 1, "score": 0, "last_activity_date": 1458264008, "creation_date": 1446675760, "last_edit_date": 1458264008, "question_id": 33533219, "link": "https://stackoverflow.com/questions/33533219/in-golang-what-does-something-mean", "title": "In golang what does `something` mean", "body": "<p>I have this XML reader struct:</p>\n\n<pre><code>type Recurlyservers struct {\n    XMLName     xml.Name `xml:\"servers\"`\n    Version     string   `xml: \"version,attr\"`\n    Svs         []server `xml: \"server\"`\n    Description string   `xml:\",innerxml\"`\n}\n</code></pre>\n\n<p>What is the meaning of this <code>xml:\"servers\"</code> or <code>xml: \"version,attr\"</code>? I don't know what this `` is. I would like to search in Google but I don't know it's name. What is it? and can I use the standard struct without this? Because the XML reading is not working without this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446712765, "post_id": 33532892, "comment_id": 54860470, "body": "Any explanation for the downvote?"}], "answers": [{"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1446674721, "post_id": 33532952, "comment_id": 54847480, "body": "You can&#39;t import main"}, {"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446676046, "post_id": 33532952, "comment_id": 54848153, "body": "Would it make sense to make a &quot;structs.go&quot; file to import, containing all structs i need globally? A bit like a .h file from C?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446676227, "post_id": 33532952, "comment_id": 54848239, "body": "@thelogix I would say that&#39;s not really idiomatic. Packages in Go are organized by function. I would organizing your types based on what they do, naming the package based on what kind of functionality it enables and importing it where it&#39;s needed."}, {"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446676441, "post_id": 33532952, "comment_id": 54848333, "body": "@evanmcdonnal well the issue is that there will be many workers, performing the <i>different</i> tasks. Sorta like &quot;plugins&quot; (only not pluggable ;)). I don&#39;t want define a redundant struct in each go-file at have to maintain that over maybe 50 worker-packages."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 2, "creation_date": 1446678391, "post_id": 33532952, "comment_id": 54849112, "body": "@thelogix based on what you said the types should all be on one package imported by the 50 different worker-packages. I would just recommend against naming it &#39;structs&#39; I also wouldn&#39;t describe it as &#39;global&#39;, it&#39;s just imported everywhere. Whatever the best term for describing those types purpose to the 50 worker packages would be a good candidate for the package name."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1446678802, "post_id": 33532952, "comment_id": 54849247, "body": "I have been known to use a <code>models</code> package with lots of shared structs."}, {"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446712824, "post_id": 33532952, "comment_id": 54860497, "body": "@evanmcdonnal I like your way. Could you make it an answer so i can accept it?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1446674836, "last_edit_date": 1446674836, "creation_date": 1446674699, "answer_id": 33532952, "question_id": 33532892, "link": "https://stackoverflow.com/questions/33532892/how-to-define-a-struct-globally-and-reuse-it-packages/33532952#33532952", "title": "How to define a struct globally and reuse it packages", "body": "<p>No matter what, you will have to import the package which contains the type you'd like to use. However, the reason this isn't working for you is because your type is not exported. You need to uppercase the types name like;</p>\n\n<pre><code>type ResultEvent struct {\n    name  string\n    desc  string\n}\n</code></pre>\n\n<p>Worth checking out what exported vs unexported means but basically upper case means exported which is similar to the <code>public</code> specifier in other systems languages. Lower case means unexported which is more like <code>internal</code> or <code>private</code>.</p>\n\n<p>As pointed out in the comment and other answer you can't import main so I believe you'll have to move your types definition as well.</p>\n"}, {"comments": [{"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446676215, "post_id": 33532967, "comment_id": 54848236, "body": "Thanks. Not being able to reference main, is important i guess :).. I got lured into thinking that the structs would be global."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 1, "creation_date": 1446678772, "post_id": 33532967, "comment_id": 54849241, "body": "Nothing is global. Everything lives in a package."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 4, "last_activity_date": 1446674768, "creation_date": 1446674768, "answer_id": 33532967, "question_id": 33532892, "link": "https://stackoverflow.com/questions/33532892/how-to-define-a-struct-globally-and-reuse-it-packages/33532967#33532967", "title": "How to define a struct globally and reuse it packages", "body": "<p>Basically, anything that lives in <code>package main</code> will only ever be able to be referenced from that pacakge. If you want it to be shared between multiple packages, put it in the <code>worker</code> package and export it (Upper case the first letter), then import <code>worker</code> from main.</p>\n"}, {"comments": [{"owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "edited": false, "score": 0, "creation_date": 1446716619, "post_id": 33540388, "comment_id": 54862785, "body": "Ah. Hadn&#39;t realized i would need to export the fields also.. I think this is the answer i am looking for."}], "tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": true, "score": 1, "last_activity_date": 1446714496, "creation_date": 1446714496, "answer_id": 33540388, "question_id": 33532892, "link": "https://stackoverflow.com/questions/33532892/how-to-define-a-struct-globally-and-reuse-it-packages/33540388#33540388", "title": "How to define a struct globally and reuse it packages", "body": "<p>One possible way would be something like:</p>\n\n<pre><code>package workerlib\n\ntype ResultEvent struct {\n  Name        string  // Export the struct fields, unless you have a\n  Description string  // real good reason not to.\n}\n</code></pre>\n\n<p>Then stick the rest of the worker utility functions in that package. Unless you provide suitable methods to read the name and description from an event, simply export the fields. If you have an absolute need to make them changeable only from within the package they're defined in, you could keep them unexported, then provide a function to create a ResultEvent as well as methods to read the name and description.</p>\n"}], "owner": {"reputation": 529, "user_id": 3805398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/plQ5l.jpg?s=128&g=1", "display_name": "thelogix", "link": "https://stackoverflow.com/users/3805398/thelogix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 33540388, "answer_count": 3, "score": 0, "last_activity_date": 1446714496, "creation_date": 1446674449, "last_edit_date": 1446712942, "question_id": 33532892, "link": "https://stackoverflow.com/questions/33532892/how-to-define-a-struct-globally-and-reuse-it-packages", "title": "How to define a struct globally and reuse it packages", "body": "<p>Im very new to Go and have this \"design\" problem.</p>\n\n<p>I have a main program passing jobs through channels. Each job will end up in a function defined in separate \"worker\" packages. Jobs are structs. </p>\n\n<p>Now i want each function called, to return result as a common struct through a \"result\" channel. But the package doesnt know about the struct definition i have in main and so i cannot define it.</p>\n\n<pre><code>package main\n\ntype resultEvent struct {\n    name  string\n    desc  string\n}\n</code></pre>\n\n<p>Then in a worker package:</p>\n\n<pre><code>package worker\n\nfunc Test() {\n   result := &amp;resultEvent{name: \"test\"}\n}    \n</code></pre>\n\n<p>Of course the idea is to eventually send this result down a channel, but even this simple example wont work, because worker doesnt know about resultEvent.\nWhat would be the correct way of doing this?</p>\n\n<p><em>Update:</em></p>\n\n<p>It should be noted that there will be many worker packages, doing different things. Sorta like \"plugins\" (only not pluggable at all). \nI dont want to define a redundant struct in each go-file and then have to maintain that over maybe 50 very different worker-packages.</p>\n\n<p>Im looking for what would be the correct way to structure this, so i can reuse one struct for all worker-packages.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1488359813, "last_edit_date": 1488359813, "creation_date": 1446672861, "answer_id": 33532439, "question_id": 33532374, "link": "https://stackoverflow.com/questions/33532374/in-go-how-can-i-reuse-a-readcloser/33532439#33532439", "title": "In Go, how can I reuse a ReadCloser?", "body": "<p>You can't reset it, because you've already read from it and there's nothing left in the stream.</p>\n\n<p>What you can do is take the buffered bytes you already have, and replace the Body with a new <code>io.ReadCloser</code></p>\n\n<pre><code>contents, _ := ioutil.ReadAll(c.Req.Request.Body)\nlog.Info(\"Request: %s\", string(contents))\nc.Req.Request.Body = ioutil.NopCloser(bytes.NewReader(contents))\nproxy.ServeHTTP(c.RW(), c.Req.Request)\n</code></pre>\n"}], "owner": {"reputation": 2340, "user_id": 2250791, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e72d4f734d39c777f543025d36d4de4e?s=128&d=identicon&r=PG", "display_name": "Camden Narzt", "link": "https://stackoverflow.com/users/2250791/camden-narzt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2998, "favorite_count": 1, "accepted_answer_id": 33532439, "answer_count": 1, "score": 3, "last_activity_date": 1488359813, "creation_date": 1446672595, "question_id": 33532374, "link": "https://stackoverflow.com/questions/33532374/in-go-how-can-i-reuse-a-readcloser", "title": "In Go, how can I reuse a ReadCloser?", "body": "<p>I have a http request which I need to inspect the body of. But when I do, the request fails. I'm assuming this had to do with the Reader needing to be reset, but googling along the lines of <code>go ioutil reset ReadCloser</code> hasn't turned anything up that looks promising.</p>\n\n<p><code>c</code> is a <code>*middleware.Context</code>,\n<code>c.Req.Request</code> is a <code>http.Request</code>, and\n<code>c.Req.Request.Body</code> is an <code>io.ReadCloser</code></p>\n\n<pre><code>contents, _ := ioutil.ReadAll(c.Req.Request.Body)\nlog.Info(\"Request: %s\", string(contents))\nproxy.ServeHTTP(c.RW(), c.Req.Request)\n</code></pre>\n\n<p>Specifically the error I get is <code>http: proxy error: http: ContentLength=133 with Body length 0</code></p>\n"}, {"tags": ["arrays", "go"], "answers": [{"comments": [{"owner": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "edited": false, "score": 0, "creation_date": 1446672001, "post_id": 33532193, "comment_id": 54846046, "body": "AHA! Thank you, that seems to have done it :)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "edited": false, "score": 0, "creation_date": 1446672085, "post_id": 33532193, "comment_id": 54846099, "body": "@Nick np. Btw, the doc for this is here; <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#append</a>"}, {"owner": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "edited": false, "score": 0, "creation_date": 1446672330, "post_id": 33532193, "comment_id": 54846224, "body": "looking at it now it seems obvious but somehow I just didn&#39;t get it. Thanks everyone, You&#39;re awesome :)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1446671936, "creation_date": 1446671936, "answer_id": 33532193, "question_id": 33532118, "link": "https://stackoverflow.com/questions/33532118/go-append-byte-slices-in-a-loop/33532193#33532193", "title": "Go: Append byte slices in a loop", "body": "<p>I believe you're simply looking for; <code>content = append(content, line...)</code></p>\n"}, {"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 2, "last_activity_date": 1446671965, "creation_date": 1446671965, "answer_id": 33532201, "question_id": 33532118, "link": "https://stackoverflow.com/questions/33532118/go-append-byte-slices-in-a-loop/33532201#33532201", "title": "Go: Append byte slices in a loop", "body": "<p>See <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow\">https://golang.org/ref/spec#Appending_and_copying_slices</a></p>\n\n<p>There is probably a duplicate but until I find it...</p>\n\n<p>Your problem is solved by adding \"...\" to the end of <code>line</code> so it looks like: </p>\n\n<pre><code>content = append(content, line...)\n</code></pre>\n"}], "owner": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2909, "favorite_count": 0, "closed_date": 1446672280, "answer_count": 2, "score": 0, "last_activity_date": 1446671965, "creation_date": 1446671597, "last_edit_date": 1446671948, "question_id": 33532118, "link": "https://stackoverflow.com/questions/33532118/go-append-byte-slices-in-a-loop", "closed_reason": "Duplicate", "title": "Go: Append byte slices in a loop", "body": "<p>I'm new to Go, so I apologise if this has already been answered, I'm trying to append a byte slice in Go and I am not having any luck finding a solution. I need to split off the first line of the file, which I've done; And write the rest into a byte slice to be parsed after the fact. So far the code looks like this:</p>\n\n<pre><code>// Here we extract the first line to name our title and category\nvar title, category string\nvar content []byte\nin, err := os.Open(file)\nutils.CheckErr(err, \"could not open file: \"+file)\ndefer in.Close()\n// open file\nscanner := bufio.NewScanner(in)\nlineCount := 1\nfor scanner.Scan() {\n    if lineCount == 1 {\n        // assign title and category\n        splitString := strings.Split(scanner.Text(), \"::\")\n        title = splitString[0]\n        category = splitString[1]\n        fmt.Println(\"title: \" + title + \"category\" + category) // usage to prevent compiler whine\n    } else {\n        // push the rest into an array to be parsed as jade\n        line := scanner.Bytes()\n        content = append(content, line) // The question is what goes here?\n    }\n    lineCount++\n}\n</code></pre>\n\n<p>I've tried using append but that only gives me the error that \n    cannot use line (type []byte) as type byte in append </p>\n"}, {"tags": ["sockets", "go", "websocket"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446670028, "post_id": 33531121, "comment_id": 54844929, "body": "So if I understand correctly, your go app is translating between websockets and a raw tcp protocol? Does it need to read the content at all or just relay raw bytes?"}, {"owner": {"reputation": 71, "user_id": 4658965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265294e2d1a4427f966757f6d9b55b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4658965/tom"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446671463, "post_id": 33531121, "comment_id": 54845734, "body": "I do not translate the bit and bytes I will write translate functions to call socket command and whatever information I retrieve from the socket server will translated and relay back to websocket."}, {"owner": {"reputation": 71, "user_id": 4658965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265294e2d1a4427f966757f6d9b55b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4658965/tom"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446671566, "post_id": 33531121, "comment_id": 54845801, "body": "For managing connections, am I on the right track?"}], "owner": {"reputation": 71, "user_id": 4658965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/265294e2d1a4427f966757f6d9b55b2c?s=128&d=identicon&r=PG&f=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/4658965/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1446668070, "creation_date": 1446667939, "last_edit_date": 1446668070, "question_id": 33531121, "link": "https://stackoverflow.com/questions/33531121/client-to-web-socket-server-to-socket-client-implementation", "title": "Client to Web socket server to socket client implementation", "body": "<p>I am trying to build a application that be behave as server and client that will be written in go.\nas a big picture, \nweb/php websocket client(java script to websocket access) &lt;-> go server(websocket server &amp; socket client) &lt;-> tcp socket server</p>\n\n<p>For starting, I have implemented go to be a socket client, built protocol layer to communicate properly with my socket server and I have used some web socket library to be a websocket server. </p>\n\n<p>My question is how can I pair each connection in secure way and manage connection without hassle. </p>\n\n<p>I was thinking something like pair data structure to tack.</p>\n\n<p>in go-lang syntax</p>\n\n<pre><code>var track_connection map[wss_connection]socket_connection\n// create map data with web socket to be a key and track socket connection\n</code></pre>\n\n<p>this way i can look up the connection by web socket connection.</p>\n\n<p>I am not sure this is clear enough to be a question\nplease let me know if any clarification is needed.</p>\n"}, {"tags": ["unit-testing", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1447025565, "post_id": 33529183, "comment_id": 54976074, "body": "Are you talking about testing with <code>aetest</code> package?"}], "answers": [{"comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1447183123, "post_id": 33620593, "comment_id": 55049589, "body": "I tried but for some reason req is always nil  this is my req  r, err := inst.NewRequest(&quot;post&quot;, &quot;api/cloud/v1/user&quot;, nil)"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1447202666, "post_id": 33620593, "comment_id": 55058880, "body": "What is the value of <code>err</code>?"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1447444445, "post_id": 33620593, "comment_id": 55173353, "body": "the vaule  of err is nil"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1447447558, "post_id": 33620593, "comment_id": 55174953, "body": "and this is the value of r &amp;{post api/cloud/v1/user HTTP/1.1 1 1 map[] &lt;nil&gt; 0 [] false  map[] map[] &lt;nil&gt; map[]   &lt;nil&gt;}"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1447643093, "post_id": 33620593, "comment_id": 55225041, "body": "You said above that &quot;req is always nil&quot;, but that req is not nil. I don&#39;t really understand what problem you&#39;re having."}], "tags": [], "owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "is_accepted": true, "score": 2, "last_activity_date": 1447113619, "creation_date": 1447113619, "answer_id": 33620593, "question_id": 33529183, "link": "https://stackoverflow.com/questions/33529183/app-engine-local-unit-test-different-instances-go/33620593#33620593", "title": "App engine Local Unit test different instances [GO]", "body": "<p>Using <a href=\"https://godoc.org/google.golang.org/appengine/aetest#NewInstance\" rel=\"nofollow\"><code>aetest.NewInstance</code></a> you can make sure that all your unit tests share a single instance:</p>\n\n<pre><code>var inst aetest.Instance\n\nfunc TestMain(m *testing.M) {\n   var err error\n   inst, err = aetest.NewInstance(nil)\n   if err != nil {\n       log.Fatalf(\"aetest.NewInstance: %v\", err)\n   }\n\n   e := m.Run()\n   inst.Close()\n   os.Exit(e)\n}\n\nfunc TestMyTest(t *testing.T) {\n   req, err := inst.NewRequest(\"GET\", \"/foo/bar\", nil)\n   // etc.\n}\n</code></pre>\n"}], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 33620593, "answer_count": 1, "score": 0, "last_activity_date": 1447113619, "creation_date": 1446661143, "last_edit_date": 1446700079, "question_id": 33529183, "link": "https://stackoverflow.com/questions/33529183/app-engine-local-unit-test-different-instances-go", "title": "App engine Local Unit test different instances [GO]", "body": "<p>I have an issue with testing separate methods, each test case is running on a different instance and address.</p>\n\n<p>I'm looking for a way to set up the API address in order to preform the tests on the same API server.</p>\n\n<p>I assuming that this warning is part of the issue.</p>\n\n<pre><code>WARNING  2015-11-04 18:15:25,003 devappserver2.py:779] DEFAULT_VERSION_HOSTNAME will not be set correctly with --port=0\n</code></pre>\n\n<p>This command will set the API server but I can't do the same for test...</p>\n\n<pre><code>dev_appserver.py .  --api_port 55555\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1042, "user_id": 374924, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/08ef4cdbafc228a2a6052467e74f3c2e?s=128&d=identicon&r=PG", "display_name": "Jacek Wysocki", "link": "https://stackoverflow.com/users/374924/jacek-wysocki"}, "edited": false, "score": 0, "creation_date": 1446739123, "post_id": 33527154, "comment_id": 54877968, "body": "Thanks for comment, it resolves problem partially. I still have goroutines working in background. If I good understand it; there is no way to kill/quit every one except the first one?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 1042, "user_id": 374924, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/08ef4cdbafc228a2a6052467e74f3c2e?s=128&d=identicon&r=PG", "display_name": "Jacek Wysocki", "link": "https://stackoverflow.com/users/374924/jacek-wysocki"}, "edited": false, "score": 0, "creation_date": 1446741231, "post_id": 33527154, "comment_id": 54879432, "body": "Added some info about cancellation."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 5, "last_activity_date": 1446741210, "last_edit_date": 1446741210, "creation_date": 1446654915, "answer_id": 33527154, "question_id": 33526746, "link": "https://stackoverflow.com/questions/33526746/how-to-safely-bypass-results-from-other-goroutines-when-first-is-completed/33527154#33527154", "title": "How to safely bypass results from other goroutines when first is completed", "body": "<p>My recommendation would be to make ch a buffered channel with one space per query: <code>ch := make(chan Result, len(conns))</code>. This way each query can run to completion, and will not block on the channel write.</p>\n\n<p><code>Query</code> can read once and return the first result. When all other goroutines complete, the channel will eventually be garbage collected and everything will go away. With your unbuffered channel, you create a lot of goroutines that can never terminate.</p>\n\n<p>EDIT:\nIf you want to cancel in-flight requests, it can become significantly harder. Some operations and apis provide cancellation, and others don't. With an http request you can use <code>Cancel</code> field on the request struct. Simply provide a channel that you can close to cancel:</p>\n\n<pre><code>func (c *Conn) DoQuery(params string, cancel chan struct{}) Result {\n    //error handling omitted. It is important to handle errors properly. \n    req, _ := http.NewRequest(...)\n    req.Cancel = cancel\n    resp, _ := http.DefaultClient.Do(req)\n    //On Cancellation, the request will return an error of some kind.\n    return readData(resp)\n}\nfunc Query(conns []Conn, query string) Result {\n    ch := make(chan Result)\n    cancel := make(chan struct{})\n    for _, conn := range conns {\n        go func(c Conn) {\n            ch &lt;- c.DoQuery(query,cancel)\n        }(conn)\n    }\n\n    first := &lt;-ch\n    close(cancel)\n    return first\n}\n</code></pre>\n\n<p>This may help if there is a large request to read that you won't care about, but it may or may not actually cancel the request on the remote server. If your query is not http, but a database call or something else, you will need to look into if there is a similar cancellation mechanism you can use.</p>\n"}], "owner": {"reputation": 1042, "user_id": 374924, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/08ef4cdbafc228a2a6052467e74f3c2e?s=128&d=identicon&r=PG", "display_name": "Jacek Wysocki", "link": "https://stackoverflow.com/users/374924/jacek-wysocki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 33527154, "answer_count": 1, "score": 2, "last_activity_date": 1446741210, "creation_date": 1446653746, "question_id": 33526746, "link": "https://stackoverflow.com/questions/33526746/how-to-safely-bypass-results-from-other-goroutines-when-first-is-completed", "title": "How to safely bypass results from other goroutines when first is completed", "body": "<p>I want to ask several servers for data (e.g. multiple read replicas). \nIn this task most important is speed, so first result should be served \nand all other can be ignored. </p>\n\n<p>I have problem with idiomatic way of bypassing this data. Everything\nwith this problem is ok when it quits (all slower goroutines are not \nfinishing their work, because main process exists). But when we uncomment\nlast line (with Sleep) We can see that other goroutines are doing their work too. </p>\n\n<p>Now I'm pushing data through channel is there any way to not push them?</p>\n\n<p>What is good and safe way of dealing with this kind of problems? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"time\"\n)\n\ntype Result int\n\ntype Conn struct {\n    Id int\n}\n\nfunc (c *Conn) DoQuery(params string) Result {\n    log.Println(\"Querying start\", params, c.Id)\n    time.Sleep(time.Duration(rand.Int31n(1000)) * time.Millisecond)\n    log.Println(\"Querying end\", params, c.Id)\n\n    return Result(1000 + c.Id*c.Id)\n}\n\nfunc Query(conns []Conn, query string) Result {\n    ch := make(chan Result)\n    for _, conn := range conns {\n        go func(c Conn) {\n            ch &lt;- c.DoQuery(query)\n        }(conn)\n    }\n\n    return &lt;-ch\n}\n\nfunc main() {\n    conns := []Conn{Conn{1}, Conn{2}, Conn{3}, Conn{4}, Conn{5}}\n    result := Query(conns, \"query!\")\n    fmt.Println(result)\n    // time.Sleep(time.Minute)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446651578, "post_id": 33524863, "comment_id": 54833124, "body": "Does time.Sleep() not block and reschedule?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446651665, "post_id": 33524863, "comment_id": 54833178, "body": "I would expect forever to consume an os thread constantly, and main and show would fight over the remaining one. Not so in reality maybe?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446651981, "post_id": 33524863, "comment_id": 54833422, "body": "@captncraig: time.Sleep is a scheduling point, but Gosched is more efficient if the sleeps are too short, since it does less."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1446652180, "post_id": 33524863, "comment_id": 54833562, "body": "@captncraig: The exact details change between releases, but in go1.5 it&#39;s blocked because the GC can&#39;t stop-the-world if the runtime has no way of forcing the <code>forever</code> loop to yield. The other goroutines do get multiplexed over the remaining thread (there are a few other goroutines in the runtime you don&#39;t directly interact with too)."}, {"owner": {"reputation": 127, "user_id": 4859529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7548cde42ced53ff87af39ff8ab7991a?s=128&d=identicon&r=PG&f=1", "display_name": "QthCN", "link": "https://stackoverflow.com/users/4859529/qthcn"}, "edited": false, "score": 0, "creation_date": 1446730471, "post_id": 33524863, "comment_id": 54871497, "body": "@JimB Thanks. When I set GOGC=off I can see my program keep outputting numbers."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1529359981, "last_edit_date": 1529359981, "creation_date": 1446648669, "answer_id": 33524863, "question_id": 33524477, "link": "https://stackoverflow.com/questions/33524477/gomaxprocs-already-be-2-but-program-still-hang/33524863#33524863", "title": "GOMAXPROCS already be 2, but program still hang", "body": "<p>There's no need to ever have a busy loop that does nothing except burn CPU time. Not only does it consume an entire OS thread, but goroutines are cooperatively scheduled, and it will interfere with the runtime's goroutines. For example, on Go1.5 this will usually block the stop-the-world phase of the GC, (which you can test by setting <code>GOGC=off</code>). </p>\n\n<p>To make this program run, you could insert a scheduling point in the for loop, but it would be better to remove it altogether.</p>\n\n<pre><code>func forever() {\n    for {\n        runtime.Gosched()\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 127, "user_id": 4859529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7548cde42ced53ff87af39ff8ab7991a?s=128&d=identicon&r=PG&f=1", "display_name": "QthCN", "link": "https://stackoverflow.com/users/4859529/qthcn"}, "edited": false, "score": 0, "creation_date": 1446730580, "post_id": 33525381, "comment_id": 54871557, "body": "Thanks for your answer, but your answer is not I want. I just want to know why in this program goroutine can&#39;t work when there has 2 kernel threads."}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1446650158, "creation_date": 1446650158, "answer_id": 33525381, "question_id": 33524477, "link": "https://stackoverflow.com/questions/33524477/gomaxprocs-already-be-2-but-program-still-hang/33525381#33525381", "title": "GOMAXPROCS already be 2, but program still hang", "body": "<p>From code, it looks like you want to print the number in for loop in go routine. In this case why not use channel to indicate when go routine is completed with for loop and accordingly exit the main function. Something like this</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"runtime\"\nimport \"time\"\n\n\nfunc show(result chan bool) {\n    for number := 1; number &lt; 999999; number++ {\n        time.Sleep(1000)\n        fmt.Println(number)\n    }   \n    result &lt;- true\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(2)\n    result := make(chan bool) \n    go show(result)\n    &lt;- result\n} \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 172, "user_id": 8500146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b27e1b589265508e27895c6af9a8c70?s=128&d=identicon&r=PG&f=1", "display_name": "exudong", "link": "https://stackoverflow.com/users/8500146/exudong"}, "is_accepted": false, "score": -1, "last_activity_date": 1545569965, "creation_date": 1545569965, "answer_id": 53903801, "question_id": 33524477, "link": "https://stackoverflow.com/questions/33524477/gomaxprocs-already-be-2-but-program-still-hang/53903801#53903801", "title": "GOMAXPROCS already be 2, but program still hang", "body": "<p>It's good to use <code>runtime.Gosched()</code>. \nBut in golang, time.Duration is in Nanoseconds, so time.Sleep(1000) is nearly no sleep. mostly you consider it as milliseconds like things in Java. you can try </p>\n\n<pre><code>time.Sleep( 1000 * time.MilliSecond )\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 4859529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7548cde42ced53ff87af39ff8ab7991a?s=128&d=identicon&r=PG&f=1", "display_name": "QthCN", "link": "https://stackoverflow.com/users/4859529/qthcn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 33524863, "answer_count": 3, "score": 1, "last_activity_date": 1545569965, "creation_date": 1446647505, "question_id": 33524477, "link": "https://stackoverflow.com/questions/33524477/gomaxprocs-already-be-2-but-program-still-hang", "title": "GOMAXPROCS already be 2, but program still hang", "body": "<p>I already set runtime.GOMAXPROCS(2), but this program still hang when output some numbers. I can see high cpu used by this program(more than 100%), but I can't understand why the for loop goroutine can make my program not work.</p>\n\n<p>go version is 1.4.2 on linux/amd64, and my pc has 4 CPUs.</p>\n\n<p>here is the code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"runtime\"\nimport \"time\"\n\nfunc forever() {\n    for {\n    }   \n}\n\nfunc show() {\n    for number := 1; number &lt; 999999; number++ {\n        time.Sleep(1000)\n        fmt.Println(number)\n    }   \n}\n\nfunc main() {\n    runtime.GOMAXPROCS(2)\n    go show()\n    go forever()\n    for {\n        time.Sleep(1000)\n    }   \n} \n</code></pre>\n"}, {"tags": ["angularjs", "go"], "comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1446643742, "post_id": 33523032, "comment_id": 54827382, "body": "This might be helpful <a href=\"http://thenewstack.io/make-a-restful-json-api-go/\" rel=\"nofollow noreferrer\">thenewstack.io/make-a-restful-json-api-go</a>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1446645294, "post_id": 33523032, "comment_id": 54828420, "body": "You might be better off asking a fairly &#39;broad&#39; question like this over on  <a href=\"https://forum.golangbridge.org/\" rel=\"nofollow noreferrer\">forum.golangbridge.org</a> - the short answer is to use Go&#39;s <code>net&#47;http</code> package with routes serving JSON."}], "answers": [{"tags": [], "owner": {"reputation": 3918, "user_id": 276983, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8f3b9e4af76309929e313be54f5bc1b4?s=128&d=identicon&r=PG", "display_name": "joshua", "link": "https://stackoverflow.com/users/276983/joshua"}, "is_accepted": false, "score": 0, "last_activity_date": 1469668527, "last_edit_date": 1469668527, "creation_date": 1446718921, "answer_id": 33542044, "question_id": 33523032, "link": "https://stackoverflow.com/questions/33523032/golang-connection-to-angularjs/33542044#33542044", "title": "Golang connection to angularjs", "body": "<p>Create a http endpoint that reads json string, unmarshalls it, does some logic with it and writes a json string to the response. E.g:</p>\n\n<pre><code>func main() {\n\nhttp.HandleFunc(\"/api/\", apiHandler)\n\n    logInfo(fmt.Sprintf(\"Starting server on port %d\", serverPort))\n    err := http.ListenAndServe(fmt.Sprintf(\":%d\", serverPort), nil)\n    if err != nil {\n        logError(err)\n    }\n}\n\n\nfunc apiHandler(w http.ResponseWriter, r *http.Request) {\n\n    //ensure its a post\n    method := r.Method\n\n    if method != \"POST\" {\n        fail(w, \"Invalid http method\")\n        return\n    }\n\n    requestData, err := ioutil.ReadAll(r.Body)\n\n    if err != nil {\n        fail(w, err.Error())\n        return\n    }\n\n\n    respData, err := doBusinessLogicWithData(requestData)\n\n    if err != nil {\n        fail(w, err.Error())\n        return\n    }\n\n    respJSONBytes, err := json.Marshal(respData)\n    if err != nil {\n        fail(w, err.Error())\n        return\n    }\n    fmt.Fprintln(w, string(respJSONBytes))\n\n}\n\nfunc fail(w http.ResponseWriter, message string) {\n\n    result := &amp;struct {\n        Success bool\n        Message string\n    }{\n        Success: false,\n        Message: message,\n    }\n\n    resultJSONBytes, err := json.Marshal(result)\n    if err != nil {\n        logError(err)\n        fmt.Fprintln(w, \"Unable to generate result\")\n        return\n    }\n    fmt.Fprintln(w, string(resultJSONBytes))\n}\n</code></pre>\n"}], "owner": {"reputation": 707, "user_id": 5428494, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5075ba00acc4f6068e8923f60f514eca?s=128&d=identicon&r=PG&f=1", "display_name": "Scott", "link": "https://stackoverflow.com/users/5428494/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2204, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1469668527, "creation_date": 1446643306, "last_edit_date": 1446644092, "question_id": 33523032, "link": "https://stackoverflow.com/questions/33523032/golang-connection-to-angularjs", "title": "Golang connection to angularjs", "body": "<p>How do I connect a backend server in go lang to angularjs? I know angularjs communicates with go via <code>$http</code> or <code>$resource</code> services but what part of the go code links communicates with angular once all the data structs have been made? Would this be the encoded/marshalled json or do we create some kind of route...</p>\n\n<p>I am a newbie looking to start this project after studying angular and go but this is the part i don't understand - what is the end point from go that angulars <code>$resource</code> or <code>$http</code> service links with? </p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-pubsub"], "answers": [{"tags": [], "owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "is_accepted": false, "score": 2, "last_activity_date": 1446675532, "creation_date": 1446675532, "answer_id": 33533161, "question_id": 33521546, "link": "https://stackoverflow.com/questions/33521546/behaviour-of-pullwait-in-go-pub-sub-library/33533161#33533161", "title": "Behaviour of PullWait in Go pub sub library?", "body": "<p>It turns out the documentation is incorrect. PullWait makes a call to the underlying <a href=\"https://cloud.google.com/pubsub/reference/rest/v1/projects.subscriptions/pull\" rel=\"nofollow\">pull method</a> with returnImmediately set to false, which means it waits for <em>at least one message</em> (but not more than n messages) to be received. I have submitted a request to make the correction.</p>\n"}], "owner": {"reputation": 71, "user_id": 2445395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bae3c77b5347fc66e61efaf3cb42715?s=128&d=identicon&r=PG", "display_name": "Eddie Forson", "link": "https://stackoverflow.com/users/2445395/eddie-forson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1446675532, "creation_date": 1446639012, "last_edit_date": 1446639316, "question_id": 33521546, "link": "https://stackoverflow.com/questions/33521546/behaviour-of-pullwait-in-go-pub-sub-library", "title": "Behaviour of PullWait in Go pub sub library?", "body": "<p>I am currently experimenting with Google Cloud PubSub's <a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang/blob/master/pubsub/pubsub.go\" rel=\"nofollow\">go library</a> and consulting the documentation at the same time. </p>\n\n<p>My code tests the behaviour of the <code>PullWait</code> function which, according to the <a href=\"https://godoc.org/google.golang.org/cloud/pubsub#PullWait\" rel=\"nofollow\">documentation</a> does the following:</p>\n\n<blockquote>\n  <p>PullWait pulls messages from the subscription. If there are not enough messages left in the subscription queue, it will block until at least n number of messages arrive or timeout occurs, and n could not be larger than 100.</p>\n</blockquote>\n\n<p>However, my test shows that regardless of the value <code>n</code> specified, I always immediately receive <code>m</code> messages where m &lt;= n. Am I missing something here? </p>\n\n<p>Excerpt of code used:</p>\n\n<pre><code>msgs, err := pubsub.PullWait(subCtx, subscriptionName, 50)\nif err != nil {\n    log.Printf(\"Error when trying to pull messages from subscription: %v\", err)\n} else {\n    for _, msg := range msgs {\n        str := string(msg.Data)\n        log.Printf(\"Message [msg-id=%s]: '%v'\", msg.ID, str)\n\n        if err := pubsub.Ack(ctx, subscriptionName, msg.AckID); err != nil {\n            log.Printf(\"Unable to acknowledge message [ack-id=%s]: %v\", msg.AckID, err)\n        }\n    }\n}\n</code></pre>\n\n<p>And at the time queue contained only one message, which was returned to me rightaway:</p>\n\n<blockquote>\n  <p>2015/11/04 11:45:15 Message [msg-id=2384294654226]: 'hello world my friend'</p>\n</blockquote>\n"}, {"tags": ["winapi", "encryption", "go"], "comments": [{"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 1, "creation_date": 1446648106, "post_id": 33516053, "comment_id": 54830436, "body": "How does it not work &#39;in .rdp file&quot;? What are you using to open the <code>.rdp</code> file? What do you get instead?"}, {"owner": {"reputation": 63, "user_id": 5523481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qFRMRzDK0Mk/AAAAAAAAAAI/AAAAAAAAAA8/PpV1841zO_o/photo.jpg?sz=128", "display_name": "Fuqiang Wang", "link": "https://stackoverflow.com/users/5523481/fuqiang-wang"}, "reply_to_user": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1446778688, "post_id": 33516053, "comment_id": 54896682, "body": "sorry,I have provided more detailed information.look new  posts"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 4485502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a8e43d04085e718cd979a3055e27fe7?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4485502/eric"}, "edited": false, "score": 0, "creation_date": 1473651867, "post_id": 33562282, "comment_id": 66208196, "body": "how to do please?"}], "tags": [], "owner": {"reputation": 63, "user_id": 5523481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qFRMRzDK0Mk/AAAAAAAAAAI/AAAAAAAAAA8/PpV1841zO_o/photo.jpg?sz=128", "display_name": "Fuqiang Wang", "link": "https://stackoverflow.com/users/5523481/fuqiang-wang"}, "is_accepted": true, "score": 1, "last_activity_date": 1446797906, "creation_date": 1446797906, "answer_id": 33562282, "question_id": 33516053, "link": "https://stackoverflow.com/questions/33516053/windows-encrypted-rdp-passwords-in-golang/33562282#33562282", "title": "windows encrypted rdp passwords in golang", "body": "<p>The issue has been solved.</p>\n\n<pre><code>secret = \"MYpasswd\"\n</code></pre>\n\n<p>string  must use   <strong>UTF-16LE</strong>  encode. </p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4138368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa177b2409e345d2c24fe2e50d0a1c3a?s=128&d=identicon&r=PG&f=1", "display_name": "Choldrim", "link": "https://stackoverflow.com/users/4138368/choldrim"}, "is_accepted": false, "score": 1, "last_activity_date": 1496676403, "creation_date": 1496676403, "answer_id": 44372315, "question_id": 33516053, "link": "https://stackoverflow.com/questions/33516053/windows-encrypted-rdp-passwords-in-golang/44372315#44372315", "title": "windows encrypted rdp passwords in golang", "body": "<p>make an addition for the not-detailed answer above. According @Fuqiang's answer, just transfer the encoding of the plain string to <code>UTF-16LE</code> before encrypting, and it finally works. So it looks like this:</p>\n\n<pre><code>....\n\nfunc convertToUTF16LittleEndianBytes(s string) []byte {\n    u := utf16.Encode([]rune(s))\n    b := make([]byte, 2*len(u))\n    for index, value := range u {\n        binary.LittleEndian.PutUint16(b[index*2:], value)\n    }\n    return b\n}\n\nfunc main() {\n    const secret = \"MYpasswd\"\n    s := convertToUTF16LittleEndianBytes(secret)\n    enc, err := Encrypt(s)\n    if err != nil {\n        log.Fatalf(\"Encrypt failed: %v\", err)\n    }\n    ...\n}\n</code></pre>\n\n<p>And after decrypting, you have to decode the decrypted string from <code>utf-16le</code> before you comparing or using it, don't directly transfer the <code>utf-16le</code> char to string by <code>string(dec)</code>.</p>\n"}], "owner": {"reputation": 63, "user_id": 5523481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qFRMRzDK0Mk/AAAAAAAAAAI/AAAAAAAAAA8/PpV1841zO_o/photo.jpg?sz=128", "display_name": "Fuqiang Wang", "link": "https://stackoverflow.com/users/5523481/fuqiang-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 0, "accepted_answer_id": 33562282, "answer_count": 2, "score": 4, "last_activity_date": 1496676403, "creation_date": 1446622143, "last_edit_date": 1446778589, "question_id": 33516053, "link": "https://stackoverflow.com/questions/33516053/windows-encrypted-rdp-passwords-in-golang", "title": "windows encrypted rdp passwords in golang", "body": "<p>like <a href=\"http://play.golang.org/p/fD7mx2k4Yc\" rel=\"nofollow\">http://play.golang.org/p/fD7mx2k4Yc</a> </p>\n\n<p>window rdp password  encrypted  <a href=\"http://www.remkoweijnen.nl/blog/2007/10/18/how-rdp-passwords-are-encrypted/\" rel=\"nofollow\">http://www.remkoweijnen.nl/blog/2007/10/18/how-rdp-passwords-are-encrypted/</a></p>\n\n<pre><code>   package main\n\n    import (\n        \"fmt\"\n        \"log\"\n        \"syscall\"\n        \"unsafe\"\n    )\n\n    const (\n        CRYPTPROTECT_UI_FORBIDDEN = 0x1\n    )\n\n    var (\n        dllcrypt32  = syscall.NewLazyDLL(\"Crypt32.dll\")\n        dllkernel32 = syscall.NewLazyDLL(\"Kernel32.dll\")\n\n        procEncryptData = dllcrypt32.NewProc(\"CryptProtectData\")\n        procDecryptData = dllcrypt32.NewProc(\"CryptUnprotectData\")\n        procLocalFree   = dllkernel32.NewProc(\"LocalFree\")\n    )\n\n    type DATA_BLOB struct {\n        cbData uint32\n        pbData *byte\n    }\n\n    func NewBlob(d []byte) *DATA_BLOB {\n        if len(d) == 0 {\n            return &amp;DATA_BLOB{}\n        }\n        return &amp;DATA_BLOB{\n            pbData: &amp;d[0],\n            cbData: uint32(len(d)),\n        }\n    }\n\n    func (b *DATA_BLOB) ToByteArray() []byte {\n        d := make([]byte, b.cbData)\n        copy(d, (*[1 &lt;&lt; 30]byte)(unsafe.Pointer(b.pbData))[:])\n        return d\n    }\n\n    func Encrypt(data []byte) ([]byte, error) {\n        var outblob DATA_BLOB\n        r, _, err := procEncryptData.Call(uintptr(unsafe.Pointer(NewBlob(data))), 0, 0, 0, 0, 0, uintptr(unsafe.Pointer(&amp;outblob)))\n        if r == 0 {\n            return nil, err\n        }\n        defer procLocalFree.Call(uintptr(unsafe.Pointer(outblob.pbData)))\n        return outblob.ToByteArray(), nil\n    }\n\n    func Decrypt(data []byte) ([]byte, error) {\n        var outblob DATA_BLOB\n        r, _, err := procDecryptData.Call(uintptr(unsafe.Pointer(NewBlob(data))), 0, 0, 0, 0, 0, uintptr(unsafe.Pointer(&amp;outblob)))\n        if r == 0 {\n            return nil, err\n        }\n        defer procLocalFree.Call(uintptr(unsafe.Pointer(outblob.pbData)))\n        return outblob.ToByteArray(), nil\n    }\n\n    func main() {\n        const secret = \"MYpasswd\"\n        enc, err := Encrypt([]byte(secret))\n        if err != nil {\n            log.Fatalf(\"Encrypt failed: %v\", err)\n        }\n        dec, err := Decrypt(enc)\n        if err != nil {\n            log.Fatalf(\"Decrypt failed: %v\", err)\n        }\n        if string(dec) != secret {\n            log.Fatalf(\"decrypted secret \\\"%s\\\" does not match to \\\"%s\\\".\", dec, secret)\n        }\n        fmt.Println(fmt.Sprintf(\"%x\", enc))\n        fmt.Println(string(dec))\n    }\n</code></pre>\n\n<p><strong>out:</strong> 01000000d08c9ddf0115d1118c7a00c04fc297eb01000000de7c90fbe3c9854381f0a0ffe1d496f3000000000200000000001066000000010000200000000790b641e1a9d4bfe54d81966c4d7aaeabf19b63c36dff42668e3b256edbeed8000000000e8000000002000020000000d6385d3352d5a4b011e171ab25b30271e73a4ddc0b9f9bfb8ecd13f230362a0110000000da71663217c163d7ab77231282e7d8d64000000025fbcbb72efcdc711f3a74c38bddbf0b71538f0ffe27d133c0c5cd2434f88d55d924f598ac2f94758d66a448682ed841fb56ce8c9de38601dcce6bd42aa41fbb</p>\n\n<p>MYpasswd</p>\n\n<p><strong>create  tmp.rdp</strong> </p>\n\n<pre><code>screen mode id:i:1\n....\nwinposstr:s:0,1,153,64,953,664\nusername:s:{{username}}\ndomain:s:\npassword 51:b:01000000d08c9ddf0115d1118c7a00c04fc297eb0100000............\ndisable wallpaper:i:1\ndisable full window drag:i:1\n</code></pre>\n\n<p><strong>final\uff1a</strong>\n   mstsc.exe  tmp.rdp</p>\n\n<p><strong>But Login failed</strong></p>\n\n<p>python  \"win32crypt.CryptProtectData\"  is work.</p>\n\n<pre><code>    pwdHash = win32crypt.CryptProtectData(u\"MYpasswd\", u'pws', None, None, None, 0)\n    enc_password = binascii.hexlify(pwdHash)\n</code></pre>\n"}, {"tags": ["intellij-idea", "go", "gdb"], "comments": [{"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "edited": false, "score": 0, "creation_date": 1446619672, "post_id": 33515329, "comment_id": 54813134, "body": "IntelliJ IDEA version is 15 and Community Edition."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1446654184, "post_id": 33515329, "comment_id": 54835006, "body": "Are you using the <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin\" rel=\"nofollow noreferrer\">Go IntelliJ plugin</a> or something else?"}, {"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1446683644, "post_id": 33515329, "comment_id": 54850725, "body": "Yes, I&#39;m using that. But I can&#39;t debug on IntelliJ IDEA."}], "answers": [{"comments": [{"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "edited": false, "score": 0, "creation_date": 1446868000, "post_id": 33532585, "comment_id": 54935263, "body": "Thank you for your great help. I posted about it on some platform like <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/issues/1969\" rel=\"nofollow noreferrer\">github.com/go-lang-plugin-org/go-lang-idea-plugin/issues/196&zwnj;&#8203;9</a>  Thanks again!"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 2, "last_activity_date": 1446673392, "creation_date": 1446673392, "answer_id": 33532585, "question_id": 33515329, "link": "https://stackoverflow.com/questions/33515329/go-how-can-i-use-gdb-debug-on-intellij-idea/33532585#33532585", "title": "(Go) How can I use GDB debug on IntelliJ IDEA?", "body": "<p>As of today, no, you cannot. However the plugin comes with Delve integrated which makes the debugging experience better for Go apps (if you are on the supported platforms by delve). See the debugger link: <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow\">https://github.com/derekparker/delve</a></p>\n\n<p>Once GDB will properly support Go apps, things might change of course.</p>\n"}], "owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1557, "favorite_count": 1, "accepted_answer_id": 33532585, "answer_count": 1, "score": 1, "last_activity_date": 1446673392, "creation_date": 1446619563, "question_id": 33515329, "link": "https://stackoverflow.com/questions/33515329/go-how-can-i-use-gdb-debug-on-intellij-idea", "title": "(Go) How can I use GDB debug on IntelliJ IDEA?", "body": "<p>I'm developping golang porjects using IntelliJ IDEA 15.\nIn advance I installed GDB to debug on mac.\nThen I want to debug golang projects using GDB on IntelliJ IDEA.\nHowever, I could't find how I can do that.</p>\n\n<p>If someone know, please give me a advise.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 6043, "user_id": 5290909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a34788cb69a6f3007f88e3a36a590ca?s=128&d=identicon&r=PG", "display_name": "Mariano", "link": "https://stackoverflow.com/users/5290909/mariano"}, "edited": false, "score": 0, "creation_date": 1446618170, "post_id": 33514971, "comment_id": 54812512, "body": "How about <code>(?:^|[^@#&#47;])\\b(\\w.*)</code> ?"}, {"owner": {"reputation": 1584, "user_id": 2947203, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5c548803537f4c91d02f259afc009b?s=128&d=identicon&r=PG&f=1", "display_name": "Mayur Koshti", "link": "https://stackoverflow.com/users/2947203/mayur-koshti"}, "edited": false, "score": 0, "creation_date": 1446618513, "post_id": 33514971, "comment_id": 54812664, "body": "Can you give an example which you want as an output?"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 2, "creation_date": 1446618948, "post_id": 33514971, "comment_id": 54812819, "body": "What should it do in the case &quot;foo \\msg some stuff @name other stuff #chan blah blah&quot;?"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "reply_to_user": {"reputation": 1584, "user_id": 2947203, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5c548803537f4c91d02f259afc009b?s=128&d=identicon&r=PG&f=1", "display_name": "Mayur Koshti", "link": "https://stackoverflow.com/users/2947203/mayur-koshti"}, "edited": false, "score": 0, "creation_date": 1446619007, "post_id": 33514971, "comment_id": 54812848, "body": "@MayurKoshti the playground link shows the expected output, given various inputs."}, {"owner": {"reputation": 71156, "user_id": 1190388, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5391819cc4abe0cb43587c9ef1808dbd?s=128&d=identicon&r=PG", "display_name": "hjpotter92", "link": "https://stackoverflow.com/users/1190388/hjpotter92"}, "edited": false, "score": 0, "creation_date": 1446621578, "post_id": 33514971, "comment_id": 54813910, "body": "I&#39;ve updated my reply below to make use of string filtering instead of regex. This&#39;ll of course, only work <b>if</b> <i>you&#39;re looking to filter out all words beginning with a character from <code>[#@&#47;]</code></i>."}], "answers": [{"comments": [{"owner": {"reputation": 294955, "user_id": 20670, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/251f2449ffba9fbcc3491db6564ff4a2?s=128&d=identicon&r=PG", "display_name": "Tim Pietzcker", "link": "https://stackoverflow.com/users/20670/tim-pietzcker"}, "edited": false, "score": 0, "creation_date": 1446619551, "post_id": 33515183, "comment_id": 54813077, "body": "But that doesn&#39;t do the Right Thing(TM). The lookbehind is used to exclude matches like <code>&#47;foo</code> - the regex matches <code>foo</code>, ignoring the slash. Fortunately, it can be improved by moving the word boundary anchor one token to the right (after the character class/noncapturing group)."}, {"owner": {"reputation": 71156, "user_id": 1190388, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5391819cc4abe0cb43587c9ef1808dbd?s=128&d=identicon&r=PG", "display_name": "hjpotter92", "link": "https://stackoverflow.com/users/1190388/hjpotter92"}, "reply_to_user": {"reputation": 294955, "user_id": 20670, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/251f2449ffba9fbcc3491db6564ff4a2?s=128&d=identicon&r=PG", "display_name": "Tim Pietzcker", "link": "https://stackoverflow.com/users/20670/tim-pietzcker"}, "edited": false, "score": 0, "creation_date": 1446619898, "post_id": 33515183, "comment_id": 54813234, "body": "Looking at the Go playground sample, I think you actually want to capture words which do not start with one of <code>[#@&#47;]</code> characters. Is that correct?"}, {"owner": {"reputation": 294955, "user_id": 20670, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/251f2449ffba9fbcc3491db6564ff4a2?s=128&d=identicon&r=PG", "display_name": "Tim Pietzcker", "link": "https://stackoverflow.com/users/20670/tim-pietzcker"}, "edited": false, "score": 4, "creation_date": 1446619972, "post_id": 33515183, "comment_id": 54813260, "body": "Looks like that&#39;s what he&#39;s trying to do. At least that&#39;s what the regex with lookbehind is doing."}, {"owner": {"reputation": 71156, "user_id": 1190388, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5391819cc4abe0cb43587c9ef1808dbd?s=128&d=identicon&r=PG", "display_name": "hjpotter92", "link": "https://stackoverflow.com/users/1190388/hjpotter92"}, "reply_to_user": {"reputation": 294955, "user_id": 20670, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/251f2449ffba9fbcc3491db6564ff4a2?s=128&d=identicon&r=PG", "display_name": "Tim Pietzcker", "link": "https://stackoverflow.com/users/20670/tim-pietzcker"}, "edited": false, "score": 0, "creation_date": 1446621513, "post_id": 33515183, "comment_id": 54813886, "body": "@TimPietzcker I guess a string-filter is a better way to go in that case. I&#39;ll inform the OP about the same as well. =)"}, {"owner": {"reputation": 2301, "user_id": 893730, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uzbc0.jpg?s=128&g=1", "display_name": "Yasser1984", "link": "https://stackoverflow.com/users/893730/yasser1984"}, "edited": false, "score": 0, "creation_date": 1446621810, "post_id": 33515183, "comment_id": 54814023, "body": "Yes more like capture a sentence that does not start with a word that starts with any of [#@/]"}], "tags": [], "owner": {"reputation": 71156, "user_id": 1190388, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5391819cc4abe0cb43587c9ef1808dbd?s=128&d=identicon&r=PG", "display_name": "hjpotter92", "link": "https://stackoverflow.com/users/1190388/hjpotter92"}, "is_accepted": true, "score": 3, "last_activity_date": 1446621469, "last_edit_date": 1446621469, "creation_date": 1446618883, "answer_id": 33515183, "question_id": 33514971, "link": "https://stackoverflow.com/questions/33514971/how-to-simulate-negative-lookbehind-in-go/33515183#33515183", "title": "How to simulate negative lookbehind in Go", "body": "<p>Since in your negated lookbehind, you are only using a simple character set; you can replace it with a negated character-set:</p>\n\n<pre><code>\\b[^@#/]\\w.*\n</code></pre>\n\n<p>If the are allowed at the start of the string, then use the <code>^</code> anchor:</p>\n\n<pre><code>(?:^|[^@#\\/])\\b\\w.*\n</code></pre>\n\n<hr>\n\n<p>Based on the samples in Go playground link in your question, I think you're looking to filter out all words beginning with a character from <code>[#@/]</code>. You can use a <code>filter</code> function:</p>\n\n<pre><code>func Filter(vs []string, f func(string) bool) []string {\n    vsf := make([]string, 0)\n    for _, v := range vs {\n        if f(v) {\n            vsf = append(vsf, v)\n        }\n    }\n    return vsf\n}\n</code></pre>\n\n<p>and a <code>Process</code> function, which makes use of the filter above:</p>\n\n<pre><code>func Process(inp string) string {\n    t := strings.Split(inp, \" \")\n    t = Filter(t, func(x string) bool {\n        return strings.Index(x, \"#\") != 0 &amp;&amp;\n            strings.Index(x, \"@\") != 0 &amp;&amp;\n            strings.Index(x, \"/\") != 0\n    })\n    return strings.Join(t, \" \")\n}\n</code></pre>\n\n<p>It can be seen in action on <a href=\"http://play.golang.org/p/ntJRNxJTxo\" rel=\"nofollow\">playground</a> at <a href=\"http://play.golang.org/p/ntJRNxJTxo\" rel=\"nofollow\">http://play.golang.org/p/ntJRNxJTxo</a></p>\n"}, {"tags": [], "owner": {"reputation": 6043, "user_id": 5290909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a34788cb69a6f3007f88e3a36a590ca?s=128&d=identicon&r=PG", "display_name": "Mariano", "link": "https://stackoverflow.com/users/5290909/mariano"}, "is_accepted": false, "score": 2, "last_activity_date": 1446623394, "last_edit_date": 1446623394, "creation_date": 1446622738, "answer_id": 33516199, "question_id": 33514971, "link": "https://stackoverflow.com/questions/33514971/how-to-simulate-negative-lookbehind-in-go/33516199#33516199", "title": "How to simulate negative lookbehind in Go", "body": "<p>You can actually match the preceding character (or the beginning of line) and use a group to get the desired text in a subexpression.</p>\n\n<p><strong>Regex</strong></p>\n\n<pre><code>(?:^|[^@#/])\\b(\\w+)\n</code></pre>\n\n<ul>\n<li><code>(?:^|[^@#/])</code> Matches either <code>^</code> the beginning of line or <code>[^@#/]</code> any character except <code>@#/</code></li>\n<li><code>\\b</code> A word boundary to assert the beginning of a word</li>\n<li><code>(\\w+)</code> Generates a subexpression\n\n<ul>\n<li>and matches <code>\\w+</code> any number of word characters</li>\n</ul></li>\n</ul>\n\n<p><strong>Code</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmds := []string{\n    `/msg @nickname #channel foo bar baz`,\n    `#channel @nickname foo bar baz /foo`,\n    `foo bar baz @nickname #channel`,\n    `foo bar baz#channel`}\n\nregex := regexp.MustCompile(`(?:^|[^@#/])\\b(\\w+)`)\n\n\n// Loop all cmds\nfor _, cmd := range cmds{\n    // Find all matches and subexpressions\n    matches := regex.FindAllStringSubmatch(cmd, -1)\n\n    fmt.Printf(\"`%v` \\t==&gt;\\n\", cmd)\n\n    // Loop all matches\n    for n, match := range matches {\n        // match[1] holds the text matched by the first subexpression (1st set of parentheses)\n        fmt.Printf(\"\\t%v. `%v`\\n\", n, match[1])\n    }\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>`/msg @nickname #channel foo bar baz`   ==&gt;\n    0. `foo`\n    1. `bar`\n    2. `baz`\n`#channel @nickname foo bar baz /foo`   ==&gt;\n    0. `foo`\n    1. `bar`\n    2. `baz`\n`foo bar baz @nickname #channel`    ==&gt;\n    0. `foo`\n    1. `bar`\n    2. `baz`\n`foo bar baz#channel`   ==&gt;\n    0. `foo`\n    1. `bar`\n    2. `baz`\n</code></pre>\n\n<p><strong>Playground</strong><br>\n<a href=\"http://play.golang.org/p/AaX9Cg-7Vx\" rel=\"nofollow\">http://play.golang.org/p/AaX9Cg-7Vx</a></p>\n"}], "owner": {"reputation": 2301, "user_id": 893730, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uzbc0.jpg?s=128&g=1", "display_name": "Yasser1984", "link": "https://stackoverflow.com/users/893730/yasser1984"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6973, "favorite_count": 0, "accepted_answer_id": 33515183, "answer_count": 2, "score": 9, "last_activity_date": 1446624456, "creation_date": 1446617924, "last_edit_date": 1446624456, "question_id": 33514971, "link": "https://stackoverflow.com/questions/33514971/how-to-simulate-negative-lookbehind-in-go", "title": "How to simulate negative lookbehind in Go", "body": "<p>I'm trying to write a regex that can extract a command, here's what I've got so far using a negative lookbehind assertion:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>\\b(?&lt;![@#\\/])\\w.*\n</code></pre>\n\n<p>So with the input:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>/msg @nickname #channel foo bar baz\n/foo #channel @nickname foo bar baz \nfoo bar baz\n</code></pre>\n\n<p><code>foo bar baz</code> is extracted every time. See working example \n<a href=\"https://regex101.com/r/lF9aG7/3\" rel=\"noreferrer\">https://regex101.com/r/lF9aG7/3</a></p>\n\n<p>In Go however this doesn't compile <a href=\"http://play.golang.org/p/gkkVZgScS_\" rel=\"noreferrer\">http://play.golang.org/p/gkkVZgScS_</a></p>\n\n<p>It throws:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>panic: regexp: Compile(`\\b(?&lt;![@#\\/])\\w.*`): error parsing regexp: invalid or unsupported Perl syntax: `(?&lt;`\n</code></pre>\n\n<p>I did a bit of research and realized negative lookbehinds are not supported in the language to guarantee O(n) time.</p>\n\n<p>How can I rewrite this regex so that it does the same without negative lookbehind?</p>\n"}, {"tags": ["ssl", "go", "https", "x509certificate", "revel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1446645768, "post_id": 33512174, "comment_id": 54828758, "body": "@JiangYD: what are you talking about?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1446645988, "post_id": 33512174, "comment_id": 54828906, "body": "@vinniyo, you need to chain the intermediate cert just like you would in most other systems -- concatenate CA&#39;s intermediate cert to your own."}, {"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1446680654, "post_id": 33512174, "comment_id": 54849876, "body": "Thank you JimB. I&#39;ve appended the intermediate cert and it&#39;s working now."}, {"owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "edited": false, "score": 0, "creation_date": 1446803435, "post_id": 33512174, "comment_id": 54905853, "body": "Port 80 redirection answered in another question - <a href=\"http://stackoverflow.com/a/33563755/757102\">stackoverflow.com/a/33563755/757102</a>"}, {"owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "edited": false, "score": 0, "creation_date": 1447880859, "post_id": 33512174, "comment_id": 55347803, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/33553583/revel-doesnt-forward-to-port-443-when-ssl-enabled\">Revel doesn&#39;t forward to port 443 when SSL enabled</a>"}], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 396, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1446609401, "creation_date": 1446600378, "last_edit_date": 1446609401, "question_id": 33512174, "link": "https://stackoverflow.com/questions/33512174/go-revel-ssl-cert-intermediate-chain-certificate-and-forward-to-443", "title": "Go Revel SSL cert Intermediate/chain certificate and forward to 443", "body": "<p>I'm using Revel for a small app and added SSL. When I update the config to point to http.port = 443, requests to port 80 are rejected instead of being forwarded. Is there a way to fix this on the Revel Framework? \nAlso, I get the error \"The certificate is not trusted in all web browsers. You may need to install an Intermediate/chain certificate to link it to a trusted root certificate.\" Is there a way to install the Intermediate/chain certificate on Revel? Thank you.</p>\n\n<pre><code># The port on which to listen.\nhttp.port = 443\n\n# Whether to use SSL or not.\nhttp.ssl = true\n\n# Path to an X509 certificate file, if using SSL.\nhttp.sslcert = /root/go/src/saml/AlphaCerts/cert.crt\n\n# Path to an X509 certificate key, if using SSL.\nhttp.sslkey = /root/go/src/saml/star_home_com.key\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 3, "creation_date": 1446624433, "post_id": 33510046, "comment_id": 54815220, "body": "Incompatible browser? This works fine with Google Chrome 46."}], "answers": [{"comments": [{"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1446745219, "post_id": 33543285, "comment_id": 54882002, "body": "I tried chrome 30 on Linux and it also failed.  What platform are you on?"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1446745912, "post_id": 33543285, "comment_id": 54882417, "body": "Ubuntu 14.04, Chrome 46.0.2490.80 (64-bit)"}, {"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1446761886, "post_id": 33543285, "comment_id": 54891509, "body": "After upgrading to Chrome 46, this problem is resolved."}, {"owner": {"reputation": 561, "user_id": 465384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b87db7cb568865952699c5afa3b591d0?s=128&d=identicon&r=PG", "display_name": "pwaller", "link": "https://stackoverflow.com/users/465384/pwaller"}, "edited": false, "score": 0, "creation_date": 1462053029, "post_id": 33543285, "comment_id": 61478508, "body": "I see the problem in Chrome 50. &quot;trace_viewer_html:2993 Uncaught TypeError: Object.observe is not a function&quot;"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 561, "user_id": 465384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b87db7cb568865952699c5afa3b591d0?s=128&d=identicon&r=PG", "display_name": "pwaller", "link": "https://stackoverflow.com/users/465384/pwaller"}, "edited": false, "score": 0, "creation_date": 1462175109, "post_id": 33543285, "comment_id": 61510043, "body": "@pwaller: I see you found an explanation <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/0KdbcRwu9DE/BVB4116HAgAJ\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!msg/golang-nuts/0KdbcRwu9DE/&hellip;</a>"}, {"owner": {"reputation": 561, "user_id": 465384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b87db7cb568865952699c5afa3b591d0?s=128&d=identicon&r=PG", "display_name": "pwaller", "link": "https://stackoverflow.com/users/465384/pwaller"}, "edited": false, "score": 0, "creation_date": 1462261140, "post_id": 33543285, "comment_id": 61549915, "body": "(Also see my answer below)"}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 2, "last_activity_date": 1446722497, "creation_date": 1446722497, "answer_id": 33543285, "question_id": 33510046, "link": "https://stackoverflow.com/questions/33510046/how-do-i-view-the-details-of-a-trace-produced-by-runtime-trace/33543285#33543285", "title": "How do I view the details of a trace produced by `runtime/trace`?", "body": "<p>I can confirm @widsvc's comment: you are probably using an incompatible browser like Firefox.</p>\n\n<p>It works as expected with Chrome.</p>\n\n<p>Looking under the hood, you can see in Firefox's console this error:</p>\n\n<blockquote>\n  <p>ReferenceError: tr is not defined trace:7:9</p>\n</blockquote>\n\n<p>After a quick search, it appears this uses <a href=\"https://github.com/catapult-project/catapult/tree/master/tracing\" rel=\"nofollow\">trace-viewer</a> which is embedded in Chrome: <a href=\"https://www.chromium.org/developers/how-tos/trace-event-profiling-tool\" rel=\"nofollow\">https://www.chromium.org/developers/how-tos/trace-event-profiling-tool</a>.</p>\n\n<p>I tried using their stand-alone <code>trace2html</code> tool on the content of <a href=\"http://localhost:8080/jsontrace\" rel=\"nofollow\">http://localhost:8080/jsontrace</a>, but the output still gives me errors with Firefox (first \"document.registerElement is not a function\", and after fixing that one others keep coming)</p>\n"}, {"tags": [], "owner": {"reputation": 561, "user_id": 465384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b87db7cb568865952699c5afa3b591d0?s=128&d=identicon&r=PG", "display_name": "pwaller", "link": "https://stackoverflow.com/users/465384/pwaller"}, "is_accepted": false, "score": 2, "last_activity_date": 1462053510, "creation_date": 1462053510, "answer_id": 36960714, "question_id": 33510046, "link": "https://stackoverflow.com/questions/33510046/how-do-i-view-the-details-of-a-trace-produced-by-runtime-trace/36960714#36960714", "title": "How do I view the details of a trace produced by `runtime/trace`?", "body": "<p>In case anyone finds themselves in my shoes, it turns out the trace viewer was broken in Chrome 49, too.</p>\n\n<p>It has been fixed in a recent CL: <a href=\"https://go-review.googlesource.com/#/c/22013/\" rel=\"nofollow\">https://go-review.googlesource.com/#/c/22013/</a></p>\n"}], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1434, "favorite_count": 0, "accepted_answer_id": 33543285, "answer_count": 2, "score": 4, "last_activity_date": 1462053510, "creation_date": 1446588603, "question_id": 33510046, "link": "https://stackoverflow.com/questions/33510046/how-do-i-view-the-details-of-a-trace-produced-by-runtime-trace", "title": "How do I view the details of a trace produced by `runtime/trace`?", "body": "<p>Consider the following program, which simply spins up a few goroutines and then waits for them to finish and signal over the channel that they are done.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"runtime/trace\"\n    \"time\"\n)\n\nfunc doWork(c chan int) {\n    startTime := time.Now()\n    i := 0\n    for curTime := startTime; curTime.Sub(startTime) &lt; 2; curTime = time.Now() {\n        i++\n    }\n    c &lt;- i\n}\n\nfunc main() {\n    numGoRoutine := 10\n    traceOutFile, _ := os.OpenFile(\"/tmp/Trace.out\", os.O_WRONLY|os.O_CREATE, os.ModeExclusive|os.ModePerm)\n    trace.Start(traceOutFile)\n\n    // Start goroutines\n    termChannel := make(chan int)\n    for i := 0; i &lt; numGoRoutine; i++ {\n        go doWork(termChannel)\n    }\n\n    // Wait for completion\n    for i := 0; i &lt; numGoRoutine; i++ {\n        &lt;-termChannel\n    }\n\n    trace.Stop()\n}\n</code></pre>\n\n<p>When this program terminates, the output is a binary file called <code>/tmp/Trace.out</code>. Next, I tried to view the trace by using the trace tool as follows.</p>\n\n<pre><code>go tool trace -http=localhost:8080  ./Main /tmp/Trace.out\n</code></pre>\n\n<p>This produces launches a page with a link to <code>View Trace</code> (together with a view other links that give only aggregate data), but clicking on that link results in a blank page. When I view the source of that page, I see the following source, which seems imply that JSON is expected rather than binary.</p>\n\n<pre><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;link href=\"/trace_viewer_html\" rel=\"import\"&gt;\n        &lt;script&gt;\n            document.addEventListener(\"DOMContentLoaded\", function(event) {\n                var viewer = new tr.TraceViewer('/jsontrace');\n                document.body.appendChild(viewer);\n            });\n        &lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><strong>How can I view the event-by-event trace using Go tools?</strong></p>\n"}, {"tags": ["javascript", "node.js", "git", "go"], "answers": [{"comments": [{"owner": {"reputation": 2003, "user_id": 457586, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8fced1b618d6b8a714c598d3f8f7d9fe?s=128&d=identicon&r=PG", "display_name": "dynamitereed", "link": "https://stackoverflow.com/users/457586/dynamitereed"}, "edited": false, "score": 0, "creation_date": 1446618190, "post_id": 33511331, "comment_id": 54812528, "body": "You wouldn&#39;t happen to have a repository handy that demonstrates this, would you?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 2003, "user_id": 457586, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8fced1b618d6b8a714c598d3f8f7d9fe?s=128&d=identicon&r=PG", "display_name": "dynamitereed", "link": "https://stackoverflow.com/users/457586/dynamitereed"}, "edited": false, "score": 2, "creation_date": 1446623057, "post_id": 33511331, "comment_id": 54814592, "body": "A really simple example: <a href=\"https://github.com/bosun-monitor/bosun/tree/master/cmd/snmpTester\" rel=\"nofollow noreferrer\">github.com/bosun-monitor/bosun/tree/master/cmd/snmpTester</a>. Up the tree in that repo is the cmd/bosun package which is quite a bit more complicated."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 3, "last_activity_date": 1446594653, "creation_date": 1446594653, "answer_id": 33511331, "question_id": 33508213, "link": "https://stackoverflow.com/questions/33508213/recommended-go-project-structure-and-build-system-for-project-with-static-assets/33511331#33511331", "title": "Recommended Go project structure and build system for project with static assets that require compilation?", "body": "<p>Here's what I do:</p>\n\n<pre><code>$GOPATH/src/github.com/myname/myproject:\n-main.go //handlers and code\n-static.go //generated\n-static\n    -js\n      -foo.js\n    -html\n    -css\n    -img\n</code></pre>\n\n<p>I use <a href=\"http://github.com/mjibson/esc\" rel=\"nofollow\">github.com/mjibson/esc</a> to convert everything in <code>static</code> to a virtual filesystem in static.go. If there are additional tasks to generate css/js (I run typescript compiler), those can be run before you embed the assets.</p>\n\n<p>All of this gets wired up to <code>go generate</code> with comments:</p>\n\n<pre><code>//go:generate sass or tsc or grunt or whatever\n//go:generate esc -o static.go static\n</code></pre>\n"}], "owner": {"reputation": 2003, "user_id": 457586, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8fced1b618d6b8a714c598d3f8f7d9fe?s=128&d=identicon&r=PG", "display_name": "dynamitereed", "link": "https://stackoverflow.com/users/457586/dynamitereed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 1, "accepted_answer_id": 33511331, "answer_count": 1, "score": 1, "last_activity_date": 1446594653, "creation_date": 1446581625, "question_id": 33508213, "link": "https://stackoverflow.com/questions/33508213/recommended-go-project-structure-and-build-system-for-project-with-static-assets", "title": "Recommended Go project structure and build system for project with static assets that require compilation?", "body": "<p>I'm making a server in Go for a web app.  The app consists of Go code which will act as an http server and a websocket server for the app.  It will also include static assets to be served by the Go code, such as html/css/javascript/images/etc.  I plan to use <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow\">go-bindata</a> or equivalent to package the final static assets.  The desired form of deployment is a single binary executable with all static assets bundled in.</p>\n\n<p>However, the javascript assets are to be built and organized in such a way that they will require a compilation step before they can be packaged into Go source for inclusion into the compiled binary.  This will be accomplished with npm scripts/webpack/gulp/equivalent.</p>\n\n<p>I have read the official Go documentation about the <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">recommended project structure</a>, but it doesn't seem to address my kind of use case.</p>\n\n<p>I don't know if the frontend code and backend code should live in the same git repo or separate ones.  I don't know what build process should handle running the javascript compilation process, the go-bindata process, and the <code>go build</code> process.  Is there a recommended way to manage this type of project or perhaps some examples of similar successful projects?</p>\n"}, {"tags": ["go", "rpc", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 2585073, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3478605d2726eddbe05a158ebf4b41fc?s=128&d=identicon&r=PG", "display_name": "mudejar", "link": "https://stackoverflow.com/users/2585073/mudejar"}, "is_accepted": true, "score": 2, "last_activity_date": 1446586589, "creation_date": 1446586589, "answer_id": 33509533, "question_id": 33506221, "link": "https://stackoverflow.com/questions/33506221/how-to-fix-this-issue-with-grpc-method-handler/33509533#33509533", "title": "How to fix this issue with grpc method handler", "body": "<p>For anyone running into the same problem, what I did was simply change how I built the proto files. There is a comment on the blog page that highlights some missing steps, I followed it and did the following protoc command to generate code from the proto files:</p>\n\n<pre><code>protoc --go_out=plugins=grpc:. *.proto\n</code></pre>\n\n<p>I ran this command in the directory with my proto files and then did a go build on my main.go file, now everything is working fine.</p>\n"}, {"tags": [], "owner": {"reputation": 1764, "user_id": 1799224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d357fe7f9ac30e77f82a6b6eead54539?s=128&d=identicon&r=PG", "display_name": "Dark.Passenger", "link": "https://stackoverflow.com/users/1799224/dark-passenger"}, "is_accepted": false, "score": 9, "last_activity_date": 1457073350, "creation_date": 1457073350, "answer_id": 35789518, "question_id": 33506221, "link": "https://stackoverflow.com/questions/33506221/how-to-fix-this-issue-with-grpc-method-handler/35789518#35789518", "title": "How to fix this issue with grpc method handler", "body": "<p>Basically your protoc-gen-go doesn't match the version of grpc. So sync them both to the latest version and reinstall protoc-gen-go will resolve the issue:</p>\n\n<pre><code>go get -u github.com/golang/protobuf/\ncd github.com/golang/protobuf/\nmake\n\ngo get -u github.com/grpc/grpc-go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6937656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j8W4T.jpg?s=128&g=1", "display_name": "Georg Westner", "link": "https://stackoverflow.com/users/6937656/georg-westner"}, "is_accepted": false, "score": 0, "last_activity_date": 1516016846, "last_edit_date": 1516016846, "creation_date": 1516016530, "answer_id": 48262297, "question_id": 33506221, "link": "https://stackoverflow.com/questions/33506221/how-to-fix-this-issue-with-grpc-method-handler/48262297#48262297", "title": "How to fix this issue with grpc method handler", "body": "<p>I am having the same issue and reinstalling or the new command doesn't seem to work.</p>\n\n<p>However:   If you change </p>\n\n<pre><code>codec grpc.Codec, buf []byte\n</code></pre>\n\n<p>in the Handler Definition into: </p>\n\n<pre><code>dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor\n</code></pre>\n\n<p>and </p>\n\n<pre><code>codec.Unmarshal(buf, in) \n</code></pre>\n\n<p>into </p>\n\n<pre><code>dec(in)\n</code></pre>\n\n<p>(All in the Handler Definition in your .pb.go file)</p>\n\n<p>it seems to work.</p>\n\n<p>Changing this file is of course not optimal and every time you recompile it will override your changes, but at least there is a workaround until I figure out what I messed up.</p>\n"}], "owner": {"reputation": 167, "user_id": 2585073, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3478605d2726eddbe05a158ebf4b41fc?s=128&d=identicon&r=PG", "display_name": "mudejar", "link": "https://stackoverflow.com/users/2585073/mudejar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6424, "favorite_count": 2, "accepted_answer_id": 33509533, "answer_count": 3, "score": 3, "last_activity_date": 1516016846, "creation_date": 1446574340, "question_id": 33506221, "link": "https://stackoverflow.com/questions/33506221/how-to-fix-this-issue-with-grpc-method-handler", "title": "How to fix this issue with grpc method handler", "body": "<p>I'm new to golang and wanted to experiment with grpc code to get a better understanding of it. In order to do so I followed the example shown here:</p>\n\n<p><a href=\"https://devicharan.wordpress.com/\" rel=\"nofollow\">https://devicharan.wordpress.com/</a></p>\n\n<p>The source code is here:\n<a href=\"https://github.com/devicharan/basicwebapp\" rel=\"nofollow\">https://github.com/devicharan/basicwebapp</a></p>\n\n<p>Unfortunately, when I run this code and do a go build I get an error message with the following:</p>\n\n<pre><code># basicwebapp/proto\nproto/CatalogService.pb.go:126: cannot use _CatalogService_GetProductCatalog_Handler (type func(interface {},   context.Context, []byte) (proto.Message, error)) as type grpc.methodHandler in field value\nproto/RecommendationService.pb.go:99: cannot use _RecommendationService_GetRecommendations_Handler (type func(interface {}, context.Context, []byte) (proto.Message, error)) as type grpc.methodHandler in field value\n</code></pre>\n\n<p>I don't know what this means or what I need to change in order to begin finding a fix. Is it a problem with the code itself or with my Go configuration? Also, is there a good debugger for Go that someone can recommend?</p>\n\n<p>Here is the code for CatalogService.pb.go:</p>\n\n<pre><code>// Code generated by protoc-gen-go.\n// source: CatalogService.proto\n// DO NOT EDIT!\n\n/*\nPackage protos is a generated protocol buffer package.\n\nIt is generated from these files:\n    CatalogService.proto\n    Product.proto\n    RecommendationService.proto\n\nIt has these top-level messages:\n    Category\n    CatalogResponse\n    CatalogRequest\n*/\npackage protos\n\nimport proto \"github.com/golang/protobuf/proto\"\n\nimport (\n    context \"golang.org/x/net/context\"\n    grpc \"google.golang.org/grpc\"\n)\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ context.Context\nvar _ grpc.ClientConn\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ = proto.Marshal\n\ntype Category struct {\n    CategoryName string `protobuf:\"bytes,1,opt,name=categoryName\" json:\"categoryName,omitempty\"`\n}\n\nfunc (m *Category) Reset()         { *m = Category{} }\nfunc (m *Category) String() string { return proto.CompactTextString(m) }\nfunc (*Category) ProtoMessage()    {}\n\ntype CatalogResponse struct {\n    Products []*Product `protobuf:\"bytes,1,rep,name=products\" json:\"products,omitempty\"`\n}\n\nfunc (m *CatalogResponse) Reset()         { *m = CatalogResponse{} }\nfunc (m *CatalogResponse) String() string { return proto.CompactTextString(m) }\nfunc (*CatalogResponse) ProtoMessage()    {}\n\nfunc (m *CatalogResponse) GetProducts() []*Product {\n    if m != nil {\n        return m.Products\n    }\n    return nil\n}\n\ntype CatalogRequest struct {\n    Category *Category `protobuf:\"bytes,1,opt,name=category\" json:\"category,omitempty\"`\n}\n\nfunc (m *CatalogRequest) Reset()         { *m = CatalogRequest{} }\nfunc (m *CatalogRequest) String() string { return proto.CompactTextString(m) }\nfunc (*CatalogRequest) ProtoMessage()    {}\n\nfunc (m *CatalogRequest) GetCategory() *Category {\n    if m != nil {\n        return m.Category\n    }\n    return nil\n}\n\nfunc init() {\n}\n\n// Client API for CatalogService service\n\ntype CatalogServiceClient interface {\n    GetProductCatalog(ctx context.Context, in *CatalogRequest, opts ...grpc.CallOption) (*CatalogResponse, error)\n}\n\ntype catalogServiceClient struct {\n    cc *grpc.ClientConn\n}\n\nfunc NewCatalogServiceClient(cc *grpc.ClientConn) CatalogServiceClient {\n    return &amp;catalogServiceClient{cc}\n}\n\nfunc (c *catalogServiceClient) GetProductCatalog(ctx context.Context, in *CatalogRequest, opts ...grpc.CallOption) (*CatalogResponse, error) {\n    out := new(CatalogResponse)\n    err := grpc.Invoke(ctx, \"/protos.CatalogService/GetProductCatalog\", in, out, c.cc, opts...)\n    if err != nil {\n        return nil, err\n    }\n    return out, nil\n}\n\n// Server API for CatalogService service\n\ntype CatalogServiceServer interface {\n    GetProductCatalog(context.Context, *CatalogRequest) (*CatalogResponse, error)\n}\n\nfunc RegisterCatalogServiceServer(s *grpc.Server, srv CatalogServiceServer) {\n    s.RegisterService(&amp;_CatalogService_serviceDesc, srv)\n}\n\nfunc _CatalogService_GetProductCatalog_Handler(srv interface{}, ctx context.Context, buf []byte) (proto.Message, error) {\n    in := new(CatalogRequest)\n    if err := proto.Unmarshal(buf, in); err != nil {\n        return nil, err\n    }\n    out, err := srv.(CatalogServiceServer).GetProductCatalog(ctx, in)\n    if err != nil {\n        return nil, err\n    }\n    return out, nil\n}\n\nvar _CatalogService_serviceDesc = grpc.ServiceDesc{\n    ServiceName: \"protos.CatalogService\",\n    HandlerType: (*CatalogServiceServer)(nil),\n    Methods: []grpc.MethodDesc{\n        {\n            MethodName: \"GetProductCatalog\",\n            Handler:    _CatalogService_GetProductCatalog_Handler,\n        },\n    },\n    Streams: []grpc.StreamDesc{},\n}\n</code></pre>\n\n<p>And this is RecommendationService.pg.go</p>\n\n<pre><code>// Code generated by protoc-gen-go.\n// source: RecommendationService.proto\n// DO NOT EDIT!\n\npackage protos\n\nimport proto \"github.com/golang/protobuf/proto\"\n\nimport (\n    context \"golang.org/x/net/context\"\n    grpc \"google.golang.org/grpc\"\n)\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ context.Context\nvar _ grpc.ClientConn\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ = proto.Marshal\n\ntype RecommendationResponse struct {\n    Result []*RecommendationResponse_Recommendation `protobuf:\"bytes,1,rep,name=result\" json:\"result,omitempty\"`\n}\n\nfunc (m *RecommendationResponse) Reset()         { *m = RecommendationResponse{} }\nfunc (m *RecommendationResponse) String() string { return proto.CompactTextString(m) }\nfunc (*RecommendationResponse) ProtoMessage()    {}\n\nfunc (m *RecommendationResponse) GetResult() []*RecommendationResponse_Recommendation {\n    if m != nil {\n        return m.Result\n    }\n    return nil\n}\n\ntype RecommendationResponse_Recommendation struct {\n    Rating    int32 `protobuf:\"varint,1,opt,name=rating\" json:\"rating,omitempty\"`\n    Productid int32 `protobuf:\"varint,2,opt,name=productid\" json:\"productid,omitempty\"`\n}\n\nfunc (m *RecommendationResponse_Recommendation) Reset()         { *m = RecommendationResponse_Recommendation{} }\nfunc (m *RecommendationResponse_Recommendation) String() string { return proto.CompactTextString(m) }\nfunc (*RecommendationResponse_Recommendation) ProtoMessage()    {}\n\nfunc init() {\n}\n\n// Client API for RecommendationService service\n\ntype RecommendationServiceClient interface {\n    GetRecommendations(ctx context.Context, in *Product, opts ...grpc.CallOption) (*RecommendationResponse, error)\n}\n\ntype recommendationServiceClient struct {\n    cc *grpc.ClientConn\n}\n\nfunc NewRecommendationServiceClient(cc *grpc.ClientConn) RecommendationServiceClient {\n    return &amp;recommendationServiceClient{cc}\n}\n\nfunc (c *recommendationServiceClient) GetRecommendations(ctx context.Context, in *Product, opts ...grpc.CallOption) (*RecommendationResponse, error) {\n    out := new(RecommendationResponse)\n    err := grpc.Invoke(ctx, \"/protos.RecommendationService/GetRecommendations\", in, out, c.cc, opts...)\n    if err != nil {\n        return nil, err\n    }\n    return out, nil\n}\n\n// Server API for RecommendationService service\n\ntype RecommendationServiceServer interface {\n    GetRecommendations(context.Context, *Product) (*RecommendationResponse, error)\n}\n\nfunc RegisterRecommendationServiceServer(s *grpc.Server, srv RecommendationServiceServer) {\n    s.RegisterService(&amp;_RecommendationService_serviceDesc, srv)\n}\n\nfunc _RecommendationService_GetRecommendations_Handler(srv interface{}, ctx context.Context, buf []byte) (proto.Message, error) {\n    in := new(Product)\n    if err := proto.Unmarshal(buf, in); err != nil {\n        return nil, err\n    }\n    out, err := srv.(RecommendationServiceServer).GetRecommendations(ctx, in)\n    if err != nil {\n        return nil, err\n    }\n    return out, nil\n}\n\nvar _RecommendationService_serviceDesc = grpc.ServiceDesc{\n    ServiceName: \"protos.RecommendationService\",\n    HandlerType: (*RecommendationServiceServer)(nil),\n    Methods: []grpc.MethodDesc{\n        {\n            MethodName: \"GetRecommendations\",\n            Handler:    _RecommendationService_GetRecommendations_Handler,\n        },\n    },\n    Streams: []grpc.StreamDesc{},\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 3, "last_activity_date": 1446566147, "creation_date": 1446566147, "answer_id": 33503525, "question_id": 33503417, "link": "https://stackoverflow.com/questions/33503417/return-different-specialised-implementations-of-interfaces-from-the-same-functio/33503525#33503525", "title": "Return different specialised implementations of interfaces from the same function", "body": "<p>Your issue is that the result from <code>getDataPoint</code> is a <code>DataPoint</code>, which only has one method available: <code>Create</code>. You then try to use it as the specific struct types, which incidentally provide all of the metadata fields. </p>\n\n<p>You could have your DataPoint interface provide a <code>MetaData</code> function or something like that, or individual getters on the fields. If the <code>MetaData</code> type implements those methods they will be available from either of the specific structs when presented as the interface itself.</p>\n"}, {"comments": [{"owner": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446593221, "post_id": 33503561, "comment_id": 54805622, "body": "I&#39;ve tried this but in a different way which didn&#39;t work as my type assertion returned two values. The question is, is it possible to determine the type dynamically so that Conversion or Impression can be set in advance to a var and used instead of explicitly stating them?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446628061, "post_id": 33503561, "comment_id": 54817207, "body": "I don&#39;t quite get what you&#39;re trying to do without an example."}, {"owner": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446690942, "post_id": 33503561, "comment_id": 54852657, "body": "Is it possible, using &#39;reflect&#39; or another way, to assign the &#39;type&#39; to a variable. So that I can do something like (semicolon to show separate line):  structType := getStructType(dpc); dpc.(*structType).Meta = meta"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446708547, "post_id": 33503561, "comment_id": 54858351, "body": "@Harel There is <code>reflect.Type</code>. But if you want to just set fields in structs, you can use <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow noreferrer\"><code>reflect.(*Value).FieldByName</code></a> (see <code>setThings</code>): <a href=\"https://play.golang.org/p/2-pobvV3u5\" rel=\"nofollow noreferrer\">play.golang.org/p/2-pobvV3u5</a>. You can&#39;t really save a type and instantiate it later in reflect-less code."}, {"owner": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446727824, "post_id": 33503561, "comment_id": 54869706, "body": "Thanks! That&#39;s what I was missing."}, {"owner": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 0, "creation_date": 1446727911, "post_id": 33503561, "comment_id": 54869755, "body": "By the way, I was curious to see you type asserted each key of the struct instead of doing dpi := getDataPoint(&quot;Impression&quot;).(*Conversion) or something along those lines. Any particualr reason beyond aesthetics?  Thanks very much!"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "edited": false, "score": 1, "creation_date": 1446728829, "post_id": 33503561, "comment_id": 54870339, "body": "@Harel no reason besides lazyness :) In production code one should obviously assert only once since this operation is not free."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 7, "last_activity_date": 1446566255, "creation_date": 1446566255, "answer_id": 33503561, "question_id": 33503417, "link": "https://stackoverflow.com/questions/33503417/return-different-specialised-implementations-of-interfaces-from-the-same-functio/33503561#33503561", "title": "Return different specialised implementations of interfaces from the same function", "body": "<p>You can't access fields like that without a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assertion</a>. You can only call methods on the interface, it doesn't know anything about its implementation details. If you do need to access those fields, use a type assertion:</p>\n\n<pre><code>dpc := getDataPoint(\"Conversion\")\ndpc.(*Conversion).Meta = meta\ndpc.(*Conversion).Value = 100\ndpc.Create()\n\ndpi := getDataPoint(\"Impression\")\ndpi.(*Impression).Meta = meta\ndpi.(*Impression).Count = 42\ndpi.Create()\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Ije8hfNcWS\" rel=\"noreferrer\">https://play.golang.org/p/Ije8hfNcWS</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1280, "user_id": 4932403, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uLzID.jpg?s=128&g=1", "display_name": "KeylorSanchez", "link": "https://stackoverflow.com/users/4932403/keylorsanchez"}, "is_accepted": false, "score": 2, "last_activity_date": 1446566344, "creation_date": 1446566344, "answer_id": 33503592, "question_id": 33503417, "link": "https://stackoverflow.com/questions/33503417/return-different-specialised-implementations-of-interfaces-from-the-same-functio/33503592#33503592", "title": "Return different specialised implementations of interfaces from the same function", "body": "<p>Your function getDataPoint returns an interface, not a struct. So if you want to use its return value as a struct, you must do a type assertion first. Here is a working code : \n<a href=\"https://play.golang.org/p/5lx4BLhQBg\" rel=\"nofollow\">https://play.golang.org/p/5lx4BLhQBg</a></p>\n"}], "owner": {"reputation": 1721, "user_id": 159241, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/369622138dc13486f9747cceda3e7be1?s=128&d=identicon&r=PG", "display_name": "Harel", "link": "https://stackoverflow.com/users/159241/harel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "accepted_answer_id": 33503561, "answer_count": 3, "score": 4, "last_activity_date": 1569573637, "creation_date": 1446565824, "last_edit_date": 1569573637, "question_id": 33503417, "link": "https://stackoverflow.com/questions/33503417/return-different-specialised-implementations-of-interfaces-from-the-same-functio", "title": "Return different specialised implementations of interfaces from the same function", "body": "<p>I'm have a few data structures which are similar with some unique fields to each. They all implement the same behavioural interface (DataPoint). \nTherefore their processing can be done once while exchanging the type of each structure and operating on it via the methods defined in the interface. I wanted to have a function return me the empty data struct for each type based on some criteria. \nHowever, I can't seem to compile this as if my function returns the interface by signature but actually returns an implementation, it complains. </p>\n\n<p>Here's a simplified example and playground sample of what I mean:</p>\n\n<p><a href=\"https://play.golang.org/p/LxY55BC59D\" rel=\"nofollow\">https://play.golang.org/p/LxY55BC59D</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\ntype DataPoint interface {\n    Create() \n}\n\ntype MetaData struct {\n    UniqueId string\n    AccountId int\n    UserId int\n}\n\ntype Conversion struct {\n    Meta MetaData\n    Value int\n}\n\nfunc (c *Conversion) Create() {\n    fmt.Println(\"CREATE Conversion\")\n}\n\ntype Impression struct {\n    Meta MetaData\n    Count int\n}\n\nfunc (i *Impression) Create() {\n    fmt.Println(\"CREATE Impression\")\n} \n\nfunc getDataPoint(t string) DataPoint {\n    if t == \"Conversion\" {\n        return &amp;Conversion{}\n    } else {\n        return &amp;Impression{}\n    }\n}\n\n\n\nfunc main() {\n    meta := MetaData{\n        UniqueId: \"ID123445X\",\n        AccountId: 1,\n        UserId: 2,\n    }\n    dpc := getDataPoint(\"Conversion\")\n    dpc.Meta = meta\n    dpc.Value = 100\n    dpc.Create()\n\n    fmt.Println(dpc)\n\n    dpi :=  getDataPoint(\"Impression\")\n    dpi.Meta = meta\n    dpi.Count = 42\n    dpi.Create()\n\n    fmt.Println(dpi)\n\n}\n</code></pre>\n\n<p>The compilation produces: </p>\n\n<pre><code>prog.go:51: dpc.Meta undefined (type DataPoint has no field or method Meta)\nprog.go:52: dpc.Value undefined (type DataPoint has no field or method Value)\nprog.go:58: dpi.Meta undefined (type DataPoint has no field or method Meta)\nprog.go:59: dpi.Count undefined (type DataPoint has no field or method Count)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1446549016, "last_edit_date": 1446549016, "creation_date": 1446548589, "answer_id": 33497501, "question_id": 33497407, "link": "https://stackoverflow.com/questions/33497407/generic-way-to-test-for-initial-in-go/33497501#33497501", "title": "Generic way to test for initial in go", "body": "<p>You can use <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow\"><code>reflect.DeepEqual</code></a>:</p>\n\n<pre><code>bs := BarStruct{}\nfmt.Println(reflect.DeepEqual(bs, BarStruct{}))\n// Output:\n//   true\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/v11bkKUhXQ\" rel=\"nofollow\">http://play.golang.org/p/v11bkKUhXQ</a>.</p>\n\n<p><strong>EDIT:</strong> you can also define an <code>isZero</code> helper function like this:</p>\n\n<pre><code>func isZero(v interface{}) bool {\n    zv := reflect.Zero(reflect.TypeOf(v)).Interface()\n    return reflect.DeepEqual(v, zv)\n}\n</code></pre>\n\n<p>This should work with any type:</p>\n\n<pre><code>fmt.Println(isZero(0))\nfmt.Println(isZero(\"\"))\nfmt.Println(isZero(bs))\nfmt.Println(isZero(map[int]int(nil)))\n</code></pre>\n"}], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "closed_date": 1446549741, "accepted_answer_id": 33497501, "answer_count": 1, "score": 1, "last_activity_date": 1446549016, "creation_date": 1446548368, "question_id": 33497407, "link": "https://stackoverflow.com/questions/33497407/generic-way-to-test-for-initial-in-go", "closed_reason": "Duplicate", "title": "Generic way to test for initial in go", "body": "<p>Is there a generic way to test a variable for initial in Go?</p>\n\n<p>Given these test:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype FooStruct struct {\n    A string\n    B int\n}\n\ntype BarStruct struct {\n    A string\n    B int\n    C map[int]string\n}\n\nfunc main() {\n    // string isinital test\n    var s string\n    fmt.Println(s == \"\")\n\n    // int isinital test\n    var i int\n    fmt.Println(i == 0)\n\n    // primitive struct isinital test\n    var fp FooStruct\n    fmt.Println(fp == FooStruct{})\n\n    // complex struct isinital test\n    // fail -&gt; invalid operation: fc == BarStruct literal (struct containing map[int]string cannot be compared)\n    var fc BarStruct\n    fmt.Println(fc == BarStruct{})\n\n    // map isinital test\n    var m map[string]int\n    fmt.Println(len(m) == 0)\n\n    // map isinital test \n    // fail -&gt; invalid operation: m == map[string]int literal (map can only be compared to nil)\n    fmt.Println(m == map[string]int{})\n}\n</code></pre>\n\n<p>A: What is the proper way to test <code>BarStruct</code> for initial?</p>\n\n<p>B: Is there a generic way to test any var for is initial?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1446544546, "post_id": 33495995, "comment_id": 54775990, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28699485/remove-elements-in-slice\">Remove elements in slice</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1446545853, "post_id": 33495995, "comment_id": 54776857, "body": "The reverse loop is the default answer to this problem, as shown by @icza"}], "answers": [{"comments": [{"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 0, "creation_date": 1446624447, "post_id": 33496275, "comment_id": 54815230, "body": "Thanks a lot for your answer, @icza. You are right, my version didn&#39;t work and I didn&#39;t noticed it. I&#39;ll use yours ;)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1544629368, "last_edit_date": 1544629368, "creation_date": 1446545151, "answer_id": 33496275, "question_id": 33495995, "link": "https://stackoverflow.com/questions/33495995/remove-slice-element-within-a-for/33496275#33496275", "title": "Remove slice element within a for", "body": "<p>Your proposed solution is incorrect. The problem is that when you remove an element from a slice, all subsequent elements are <em>shifted</em>. But the loop doesn't know that you changed the underlying slice and loop variable (the index) gets incremented as usual, even though in this case it shouldn't because then you skip an element.</p>\n\n<p>And if the slice contains 2 elements which are right next to each other both of which need to be removed, the second one will not be checked and will not be removed.</p>\n\n<p>So if you remove an element, the loop variable has to be decremented manually! Let's see an example: remove words that start with <code>\"a\"</code>:</p>\n\n<pre><code>func conditionMeets(s string) bool {\n    return strings.HasPrefix(s, \"a\")\n}\n</code></pre>\n\n<p>Solution (try it with all other examples below on the <a href=\"http://play.golang.org/p/S-HNpW4fxE\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a := []string{\"abc\", \"bbc\", \"aaa\", \"aoi\", \"ccc\"}\nfor i := 0; i &lt; len(a); i++ {\n    if conditionMeets(a[i]) {\n        a = append(a[:i], a[i+1:]...)\n        i--\n    }\n}\nfmt.Println(a)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[bbc ccc]\n</code></pre>\n\n<p><strong>Or better:</strong> use a downward loop and so you don't need to manually decrement the variable, because in this case the shifted elements are in the \"already processed\" part of the slice.</p>\n\n<pre><code>a := []string{\"abc\", \"bbc\", \"aaa\", \"aoi\", \"ccc\"}\nfor i := len(a) - 1; i &gt;= 0; i-- {\n    if conditionMeets(a[i]) {\n        a = append(a[:i], a[i+1:]...)\n    }\n}\nfmt.Println(a)\n</code></pre>\n\n<p>Output is the same.</p>\n\n<h3>Alternate for many removals</h3>\n\n<p>If you have to remove \"many\" elements, this might be slow as you have to do a lot of copy (<code>append()</code> does the copy). Imagine this: you have a slice with 1000 elements; just removing the first element requires copying 999 elements to the front. Also many new slice descriptors will be created: every element removal creates <strong>2</strong> new slice descriptors (<code>a[:i]</code>, <code>a[i+1:]</code>) <strong>plus</strong> <code>a</code> has to be updated (the result of <code>append()</code>). In this case it might be more efficient to copy the non-removable elements to a new slice.</p>\n\n<p>An efficient solution:</p>\n\n<pre><code>a := []string{\"abc\", \"bbc\", \"aaa\", \"aoi\", \"ccc\"}\nb := make([]string, len(a))\ncopied := 0\nfor _, s := range(a) {\n    if !conditionMeets(s) {\n        b[copied] = s\n        copied++\n    }\n}\nb = b[:copied]\nfmt.Println(b)\n</code></pre>\n\n<p>This solution allocates a slice with the same length as the source, so no new allocations (and copying) will be performed. This solution can also use the <code>range</code> loop. And if you want the result in <code>a</code>, assign the result to <code>a</code>: <code>a = b[:copied]</code>.</p>\n\n<p>Output is the same.</p>\n\n<h3>In-place alternate for many removals (and for general purposes)</h3>\n\n<p>We can also do the removal \"in place\" with a cycle, by maintaining 2 indices and assigning (copying forward) non-removable elements in the same slice.</p>\n\n<p>One thing to keep in mind is that we should zero places of removed elements in order to remove references of unreachable values so the GC can do its work. This applies to other solutions as well, but only mentioned here.</p>\n\n<p>Example implementation:</p>\n\n<pre><code>a := []string{\"abc\", \"bbc\", \"aaa\", \"aoi\", \"ccc\"}\ncopied := 0\nfor i := 0; i &lt; len(a); i++ {\n    if !conditionMeets(a[i]) {\n        a[copied] = a[i]\n        copied++\n    }\n}\nfor i := copied; i &lt; len(a); i++ {\n    a[i] = \"\" // Zero places of removed elements (allow gc to do its job)\n}\na = a[:copied]\nfmt.Println(a)\n</code></pre>\n\n<p>Output is the same. Try all the examples on the <a href=\"http://play.golang.org/p/S-HNpW4fxE\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1834, "favorite_count": 0, "accepted_answer_id": 33496275, "answer_count": 1, "score": 5, "last_activity_date": 1544629368, "creation_date": 1446544346, "last_edit_date": 1446624504, "question_id": 33495995, "link": "https://stackoverflow.com/questions/33495995/remove-slice-element-within-a-for", "title": "Remove slice element within a for", "body": "<p>An idiomatic method to remove an element <code>i</code> from a slice <code>a</code>, preserving the order, seems to be:</p>\n\n<p><code>a = append(a[:i], a[i+1:]...)</code></p>\n\n<p>I was wondering which would be the best way to do it inside a loop. As I understand, it is not possible to use it inside a range for:</p>\n\n<pre><code>for i := range a { // BAD\n    if conditionMeets(a[i]) {\n        a = append(a[:i], a[i+1:]...)\n    }\n}\n</code></pre>\n\n<p>However it is possible to use <code>len(a)</code>. [EDIT: this doesn't work, see answers below]</p>\n\n<pre><code>for i := 0; i &lt; len(a); i++ {\n    if conditionMeets(a[i]) {\n        a = append(a[:i], a[i+1:]...)\n    }\n}\n</code></pre>\n\n<p>Is there a better or more idiomatic way than using <code>len</code> or <code>append</code>? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1446503175, "creation_date": 1446503175, "answer_id": 33488167, "question_id": 33488126, "link": "https://stackoverflow.com/questions/33488126/range-keyword-and-2d-slices-in-go/33488167#33488167", "title": "range keyword and 2d slices in Go", "body": "<p><code>row</code> isn't a reference to the value in <code>grid</code>, it's a copy of the slice value. The error is because you assign a new slice to <code>row</code>, but that value is never used.</p>\n\n<p>This is more likely what you want:</p>\n\n<p><a href=\"http://play.golang.org/p/86yHqw_JX-\" rel=\"noreferrer\">http://play.golang.org/p/86yHqw_JX-</a></p>\n\n<pre><code>grid := make([][]string, 2)\nfor i := range grid {\n    grid[i] = []string{\"foo\", \"bar\"}\n}\nfmt.Println(grid)\n</code></pre>\n"}], "owner": {"reputation": 5806, "user_id": 1420382, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b00f469c4ccbb33bba69611325c29a3e?s=128&d=identicon&r=PG", "display_name": "Reck", "link": "https://stackoverflow.com/users/1420382/reck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 33488167, "answer_count": 1, "score": 1, "last_activity_date": 1446503175, "creation_date": 1446502993, "question_id": 33488126, "link": "https://stackoverflow.com/questions/33488126/range-keyword-and-2d-slices-in-go", "title": "range keyword and 2d slices in Go", "body": "<p>I'm trying my hand at Go for the first time. For the last hour or so I've been at a loss as to why this code is not working.</p>\n\n<pre><code>grid := make([][]string, 2)\nfor _, row := range grid {\n    row = []string{\"foo\", \"bar\"}\n}\nfmt.Println(grid)\n</code></pre>\n\n<p>I expect it to print something like</p>\n\n<pre><code>[\n  [\"foo\", \"bar\"]\n  [\"foo\", \"bar\"]\n]\n</code></pre>\n\n<p>but instead it refuses to compile with the message <code>row declared and not used</code>.</p>\n\n<p>Clearly I'm missing something with regards to 2d slices and the <code>range</code> keyword. Any ideas?</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1446498439, "post_id": 33486725, "comment_id": 54758519, "body": "If a field is an interface, the decoder has no way of telling what actual type to use. I don&#39;t recall if this works, but try building a struct with initialized interface values."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446499719, "post_id": 33486725, "comment_id": 54759208, "body": "@JimB: ah yes, that makes perfect sense - the decoder couldn&#39;t possibly know which type to use.  I suppose that&#39;s the general problem I&#39;m facing. Perhaps I just need to use a decoder directly and map element names to known types."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446565768, "post_id": 33486725, "comment_id": 54790071, "body": "Also more general: Go interfaces are about behaviour (methods only, not properties), not data. So i would consider it a miss-use of go&#39;s idea of interfaces."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1446597684, "post_id": 33486725, "comment_id": 54807042, "body": "I&#39;d personally avoid this because I dislike so much obfuscation but if you really want a working <code>xml.Unmarshal</code> for your interfaces you could implement <code>Unmarshaller</code>. It would be pretty straight forward, figure out the type based on the XML elements, create a new instance of that type, unmarshal into that with the default unmarshaller, assign that to the interface field of your struct."}], "answers": [{"tags": [], "owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "is_accepted": true, "score": 3, "last_activity_date": 1446630013, "last_edit_date": 1446630013, "creation_date": 1446628676, "answer_id": 33517875, "question_id": 33486725, "link": "https://stackoverflow.com/questions/33486725/golang-xml-unmarshal-interface-types/33517875#33517875", "title": "Golang xml.Unmarshal interface types", "body": "<p>As pointed out by other comments, the decoder cannot deal with interface fields without some help. Implementing <code>xml.Unmarshaller</code> on the container will make it do what you want (full working example on the <a href=\"http://play.golang.org/p/FRzdAFrXZ1\" rel=\"nofollow\">playground</a>):</p>\n\n<pre><code>func (md *MyDoc) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    md.XMLName = start.Name\n    // grab any other attrs\n\n    // decode inner elements\n    for {\n        t, err := d.Token()\n        if err != nil {\n            return err\n        }\n        var i Item\n        switch tt := t.(type) {\n        case xml.StartElement:\n            switch tt.Name.Local {\n            case \"foo\":\n                i = new(Foo) // the decoded item will be a *Foo, not Foo!\n            case \"bar\":\n                i = new(Bar)\n                // default: ignored for brevity\n            }\n            // known child element found, decode it\n            if i != nil {\n                err = d.DecodeElement(i, &amp;tt)\n                if err != nil {\n                    return err\n                }\n                md.Items = append(md.Items, i)\n                i = nil\n            }\n        case xml.EndElement:\n            if tt == start.End() {\n                return nil\n            }\n        }\n\n    }\n    return nil\n}\n</code></pre>\n\n<p>This is just an implementation of what @evanmcdonnal suggests. All this does is instantiate the proper <code>Item</code> based on the name of the next Token, then call <code>d.DecodeElement()</code> with it (i.e. let the xml decoder do the heavy lifting).</p>\n\n<p>Note that the unmarshalled <code>Items</code> are pointers. You'll need to do some more work if you want values. This also needs to be expanded some more for proper  handling of errors or unexpected input data.</p>\n"}], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3029, "favorite_count": 4, "accepted_answer_id": 33517875, "answer_count": 1, "score": 4, "last_activity_date": 1446630013, "creation_date": 1446497643, "last_edit_date": 1446498315, "question_id": 33486725, "link": "https://stackoverflow.com/questions/33486725/golang-xml-unmarshal-interface-types", "title": "Golang xml.Unmarshal interface types", "body": "<p>Using the <code>xml</code> package in golang I'm having trouble unmarshalling a list of non-homogenous types.  Consider the following XML document whose nested elements are a list of non-homogenous types:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;mydoc&gt;\n  &lt;foo&gt;Foo&lt;/foo&gt;\n  &lt;bar&gt;Bar&lt;/bar&gt;\n  &lt;foo&gt;Another Foo&lt;/foo&gt;\n  &lt;foo&gt;Foo #3&lt;/foo&gt;\n  &lt;bar&gt;Bar 2&lt;/bar&gt;\n&lt;/mydoc&gt;\n</code></pre>\n\n<p>And the following golang code to test XML un/marshalling (also here on <a href=\"http://play.golang.org/p/aG3IglaI9w\" rel=\"nofollow\">the go playground</a>):</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport \"encoding/xml\"\nimport \"fmt\"\n\nconst sampleXml = `\n&lt;mydoc&gt;\n  &lt;foo&gt;Foo&lt;/foo&gt;\n  &lt;bar&gt;Bar&lt;/bar&gt;\n  &lt;foo&gt;Another Foo&lt;/foo&gt;\n  &lt;foo&gt;Foo #3&lt;/foo&gt;\n  &lt;bar&gt;Bar 2&lt;/bar&gt;\n&lt;/mydoc&gt;\n`\n\ntype MyDoc struct {\n  XMLName xml.Name `xml:\"mydoc\"`\n  Items   []Item\n}\n\ntype Item interface {\n  IsItem()\n}\n\ntype Foo struct {\n  XMLName xml.Name `xml:\"foo\"`\n  Name    string   `xml:\",chardata\"`\n}\n\nfunc (f Foo) IsItem() {}\n\ntype Bar struct {\n  XMLName xml.Name `xml:\"bar\"`\n  Nombre  string   `xml:\",chardata\"`\n}\n\nfunc (b Bar) IsItem() {}\n\nfunc main() {\n  doMarshal()\n  doUnmarshal()\n}\n\nfunc doMarshal() {\n  myDoc := MyDoc{\n    Items: []Item{\n      Foo{Name: \"Foo\"},\n      Bar{Nombre: \"Bar\"},\n      Foo{Name: \"Another Foo\"},\n      Foo{Name: \"Foo #3\"},\n      Bar{Nombre: \"Bar 2\"},\n    },\n  }\n  bytes, err := xml.MarshalIndent(myDoc, \"\", \"  \")\n  if err != nil {\n    panic(err)\n  }\n  // Prints an XML document just like \"sampleXml\" above.\n  println(string(bytes))\n}\n\nfunc doUnmarshal() {\n  myDoc := MyDoc{}\n  err := xml.Unmarshal([]byte(sampleXml), &amp;myDoc)\n  if err != nil {\n    panic(err)\n  }\n  // Fails to unmarshal the \"Item\" elements into their respective structs.\n  fmt.Printf(\"ERR: %#v\", myDoc)\n}\n</code></pre>\n\n<p>You'll see that <code>doMarshal()</code> produces the exact XML document I expect; however, <code>doUnmarshal()</code> fails to deserialize the \"Item\" elements into their respective structs.  I've tried a few changes but nothing seems to get them to unmarshal properly (creating storage for <code>myDoc.Items</code>, changing the type of \"Items\" to <code>[]*Item</code> [and others], fiddling with the XML tags, etc).</p>\n\n<p>Any ideas how to get <code>xml.Unmarshal(...)</code> to deserialize a list of elements of unrelated types?</p>\n"}, {"tags": ["go", "qml", "release"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446488549, "post_id": 33484300, "comment_id": 54753455, "body": "what do you mean by &#39;For &quot;Release&quot;&#39;?"}, {"owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446488832, "post_id": 33484300, "comment_id": 54753616, "body": "In C ++ is two modes:Release  And Debug.example: in qt and c++ the program is 25.0 KB for &quot;release&quot; And for debug : 850 KB ."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446489058, "post_id": 33484300, "comment_id": 54753731, "body": "It might mean something in your IDE, but that&#39;s not a C++ thing. I&#39;m not sure what you expect Go to build differently for Release, if you don&#39;t have anything specifically configured for not-Release."}, {"owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446489536, "post_id": 33484300, "comment_id": 54753987, "body": "size total program with dll : 743mb Everything that needs: libgcc_s_dw2-1.dll libstdc++-6.dll libwinpthread-1.dll Qt5Cored.dll Qt5Guid.dll Qt5Networkd.dll Qt5Qmld.dll Qt5Quickd.dll Qt5Widgetsd.dll"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1446490549, "post_id": 33484300, "comment_id": 54754493, "body": "See other discussion on this question at <a href=\"https://forum.golangbridge.org/t/create-go-file-for-release/1415\" rel=\"nofollow noreferrer\">forum.golangbridge.org/t/create-go-file-for-release/1415</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446490680, "post_id": 33484300, "comment_id": 54754562, "body": "How big is your binary? Go doesn&#39;t build any of those other artifacts, and it&#39;s up to you to provide them in some way."}, {"owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "edited": false, "score": 0, "creation_date": 1446532934, "post_id": 33484300, "comment_id": 54769976, "body": "I Ran exe file. It Warned: The program can&#39;t start because Qt5Cored.dll is missing from your computer. Try reinstalling the program to fix this problem. This program Compiled for &quot;debug&quot;"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1505391747, "post_id": 33484300, "comment_id": 79400453, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29599209/how-to-build-a-release-version-binary-in-go\">How to build a release version binary in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "edited": false, "score": 0, "creation_date": 1448166278, "post_id": 33836057, "comment_id": 55467436, "body": "I have created release file.  But It has a problem in another computer now. The go file , isn&#39;t execute in another computer now."}, {"owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "edited": false, "score": 0, "creation_date": 1448360193, "post_id": 33836057, "comment_id": 55544902, "body": "The problem was solved. I used the following programs: procmon.exe"}], "tags": [], "owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "is_accepted": false, "score": 0, "last_activity_date": 1448053602, "creation_date": 1448053602, "answer_id": 33836057, "question_id": 33484300, "link": "https://stackoverflow.com/questions/33484300/how-to-create-a-go-file-for-release/33836057#33836057", "title": "How to create a go file for \u201crelease\u201d?", "body": "<p>As explained by JimB, Dave Cheney, and others:</p>\n\n<ul>\n<li>There is no \"RELEASE\" for Golang</li>\n<li>Golang executables are large, that is <a href=\"https://golang.org/doc/faq#Why_is_my_trivial_program_such_a_large_binary\" rel=\"nofollow\">normal</a></li>\n<li>Yes, you have to provide to DLL files if you force linking shared libraries</li>\n<li>Yes, those libraries might be large.</li>\n<li>There is nothing wrong, just let go use the defaults</li>\n</ul>\n"}], "owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1504368979, "creation_date": 1446488427, "last_edit_date": 1504368979, "question_id": 33484300, "link": "https://stackoverflow.com/questions/33484300/how-to-create-a-go-file-for-release", "title": "How to create a go file for \u201crelease\u201d?", "body": "<p>I want to make a Golang File For \"Release\".</p>\n\n<p>This is my command:</p>\n\n<pre><code>go build -o testi.exe -ldflags \"-H windowsgui\"\n</code></pre>\n\n<p>What is the correct way? My code:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"os\"\n    //\"github.com/chai2010/qml\"\n    \"github.com/go-qml/qml\"\n)\nfunc main() {\n    if err := qml.Run(run); err != nil {\n        fmt.Fprintf(os.Stderr, \"error: %v\\n\", err)\n        os.Exit(1)\n    }\n}\nfunc run() error {\n    engine := qml.NewEngine()\n    engine.On(\"quit\", func() { os.Exit(0) })\n\n    component, err := engine.LoadString(\"hello.qml\", qmlHello)\n    if err != nil {\n        return err\n    }\n    window := component.CreateWindow(nil)\n    window.Show()\n    window.Wait()\n    return nil\n}\n\nconst qmlHello = `\nimport QtQuick 2.2\nimport QtQuick.Controls 1.1\nRectangle {\n    id: page\n    width: 320; height: 240\n    color: \"lightgray\"\n    Text {\n        id: helloText\n        text: \"Hello world!\"\n        y: 30\n        anchors.horizontalCenter: page.horizontalCenter\n        font.pointSize: 24; font.bold: true\n    }\n}\n`\n</code></pre>\n\n<p>I installed : go1.5.windows-386.</p>\n"}, {"tags": ["go", "gdb"], "owner": {"reputation": 435, "user_id": 4977258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/muLxr.jpg?s=128&g=1", "display_name": "Jianglong Chen", "link": "https://stackoverflow.com/users/4977258/jianglong-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 574, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1446478638, "creation_date": 1446478638, "question_id": 33481319, "link": "https://stackoverflow.com/questions/33481319/debugging-go-code-with-gdb-go-extension-invalid-data-type-for-function-to-be-c", "title": "Debugging Go Code with GDB. Go extension &quot;Invalid data type for function to be called.&quot;", "body": "<p>Using GDB with golang is an exciting thing~~\nBase on the <a href=\"https://golang.org/doc/gdb\" rel=\"nofollow\">document</a>, Go Extensions was provided. It can print the length of maps,string and slice.</p>\n\n<p>However, when I executed \"p $len(var)\", I got an error \"Invalid data type for function to be called\". I am sure that the type of var is map.</p>\n\n<p>Maybe, not many people pay attention to this problem? Or, should I ask this quesion in Go's forum?</p>\n"}, {"tags": ["sockets", "http", "go", "server"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446472224, "post_id": 33479073, "comment_id": 54742981, "body": "You need to show how you create and start your client and server."}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446472494, "post_id": 33479073, "comment_id": 54743159, "body": "The server and the clients runing inside difference goroutines, ie <code>go StartMyClientsForUrl(&quot;http:&#47;&#47;example.com&#47;&quot;)</code> and <code>go StartMyServer()</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446472893, "post_id": 33479073, "comment_id": 54743393, "body": "You need to show more than what you have, because there&#39;s nothing here preventing an http.Server from accepting requests. Try to provide a <a href=\"http://stackoverflow.com/help/mcve\">working example</a>. (not related; check you client error first. The response isn&#39;t valid if there&#39;s an error, and the Body is guaranteed to be non-nil when there&#39;s no error.)"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446473449, "post_id": 33479073, "comment_id": 54743746, "body": "<a href=\"https://play.golang.org/p/05ndaxlgiY\" rel=\"nofollow noreferrer\">It&#39;s &quot;me&quot;</a>, <a href=\"https://play.golang.org/p/-G6JS62CVX\" rel=\"nofollow noreferrer\">It&#39;s &quot;other server&quot;</a>. For other clients you can use your browser."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1446474182, "post_id": 33479073, "comment_id": 54744261, "body": "First: there is no connection between a client&#39;s Transport and the server. Second: You probably should <i>reuse</i> your client Transports instead of using a fresh one for each and every client GET request (I&#39;d guess you are just running out of FDs). Third: maybe you could reformulate your question? I&#39;m not sure I understand your question: E.g. what is waiting for what? How do you see something is &quot;waiting&quot;?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1446474254, "post_id": 33479073, "comment_id": 54744303, "body": "You&#39;re just exhausting file descriptors. You can&#39;t Dial 100,000 connections simultaneously, and once the process is out of FDs, the server can&#39;t accept any connections."}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 0, "creation_date": 1446476462, "post_id": 33479073, "comment_id": 54745797, "body": "But, i&#39;m reuse my transport. I create it only once, before any call <code>Get(url string) ([]byte, error)</code> would done. So, why i&#39;m run into FD limit?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1446478195, "post_id": 33479073, "comment_id": 54747034, "body": "You&#39;re trying to make 100,000 connections concurrently, which would take 100,000 file descriptors (not counting any used in DNS resolution, etc.)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1446515117, "post_id": 33479073, "comment_id": 54764756, "body": "Anyway, we are talking of incomplete code fragments. Please provide a <a href=\"http://stackoverflow.com/help/mcve\">minimal, complete and verifiable example</a>"}], "owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 200, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1446471948, "creation_date": 1446471948, "question_id": 33479073, "link": "https://stackoverflow.com/questions/33479073/relation-between-server-and-clients-transport-in-golang", "title": "relation between server and client&#39;s transport in golang", "body": "<p>I have both - a client and a server in <strong>a one program</strong>. With a function <code>func Get(url string) ([]byte, error)</code> i make tons of requests to <strong>other</strong> server and my server handles one per second request from <strong>other</strong> clients. The function for request is:</p>\n\n<pre><code>var transport = &amp;http.Transport{}\nfunc Get(url string) ([]byte, error) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    var client = &amp;http.Client{\n        Transport: transport,\n        Timeout:   15 * time.Second,\n    }\n\n    resp, err := client.Do(req)\n    if resp != nil &amp;&amp; resp.Body != nil {\n        defer resp.Body.Close()\n    }\n\n    if err != nil {\n        if resp != nil &amp;&amp; resp.Body != nil {\n            io.Copy(ioutil.Discard, resp.Body)\n        }\n\n        return nil, err\n    }\n\n    data, err := ioutil.ReadAll(resp.Body)\n    return data, err\n}\n</code></pre>\n\n<p>and the server is:</p>\n\n<pre><code>func homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello\")\n}\n\nhttp.HandleFunc(\"/\", homePage)\nhttp.ListenAndServe(\":9002\", nil)\n</code></pre>\n\n<p>So, the question is - why <strong>my</strong> server start waiting, while <strong>my</strong> clients send all their requests to <strong>other</strong> server, before it start handling <strong>other</strong> client's request? What do i miss? CPU is ok, memory is ok, bandwidth is ok.</p>\n"}, {"tags": ["go", "static", "gccgo"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1446467604, "post_id": 33476470, "comment_id": 54740201, "body": "Show the code of the program you&#39;re trying to compile. For a simple hello world program <code>go build -compiler gccgo -gccgoflags &quot;-static&quot; hello.go</code> works for me."}, {"owner": {"reputation": 251, "user_id": 2774002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ntpn9.gif?s=128&g=1", "display_name": "Ian Lance Taylor", "link": "https://stackoverflow.com/users/2774002/ian-lance-taylor"}, "edited": false, "score": 0, "creation_date": 1446493969, "post_id": 33476470, "comment_id": 54756235, "body": "An error like &quot;cannot find -lpthread&quot; implies that you do not have the static version of the pthread library on your system.  You need to have libpthread.a somewhere, such as /usr/lib or /usr/lib/x86_64-linux-gnu.  If you don&#39;t, you need to install it.  That may also be the problem with libgo; it depends on how you installed gccgo."}, {"owner": {"reputation": 1, "user_id": 5515514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe44507e058eb5bd521643c6d320744d?s=128&d=identicon&r=PG&f=1", "display_name": "jackme", "link": "https://stackoverflow.com/users/5515514/jackme"}, "edited": false, "score": 0, "creation_date": 1446513625, "post_id": 33476470, "comment_id": 54764384, "body": "package main    //import &quot;os&quot;// \u7528\u4e8e\u83b7\u5f97\u547d\u4ee4\u884c\u53c2\u6570os.Args  import &quot;fmt&quot;  //import &quot;strconv&quot;   func main() { \tvar a = &quot;asdf&quot;  \tconst( \tc0=iota \tc1=iota \tc2=iota \t) \tvar v_111 int  \tv_111 = 111\t \tfmt.Println(&quot;complex dsf &quot;, v_111)\t     fmt.Printf(&quot;Result: %d %d %d %s\\n&quot;, c0, c1, c2, a)  \tvar str string \tstr = &quot;hello world&quot; \tfor i :=0; i&lt; len(str); i++{ \t\tfmt.Println(i, str[i]) \t} \t//array  \tar_b :=[5] byte{1,2,3,4,15} \tfor _ , v :=range ar_b{ \t\tfmt.Println(v, &quot; &quot;) \t}\t }"}, {"owner": {"reputation": 1, "user_id": 5515514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe44507e058eb5bd521643c6d320744d?s=128&d=identicon&r=PG&f=1", "display_name": "jackme", "link": "https://stackoverflow.com/users/5515514/jackme"}, "edited": false, "score": 0, "creation_date": 1446513924, "post_id": 33476470, "comment_id": 54764455, "body": "I use -L/lib64 in build command line to set the library search path, because there are all lib files on this dir"}, {"owner": {"reputation": 1, "user_id": 5515514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe44507e058eb5bd521643c6d320744d?s=128&d=identicon&r=PG&f=1", "display_name": "jackme", "link": "https://stackoverflow.com/users/5515514/jackme"}, "edited": false, "score": 0, "creation_date": 1446514078, "post_id": 33476470, "comment_id": 54764488, "body": "ps why I set -L/lib64  because: ldd test_gccgo_yes           linux-vdso.so.1 =&gt;  (0x00007fff8e9fe000)          libgo.so.4 =&gt; /lib64/libgo.so.4 (0x00007fd4bf2f0000)         libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fd4befee000)          libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fd4bedd7000)         libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fd4bea16000)         /lib64/ld-linux-x86-64.so.2 (0x00007fd4c0023000)         libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fd4be7fa000)"}], "answers": [{"tags": [], "owner": {"reputation": 46207, "user_id": 74496, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/633fe8d1b4783bb73748a75e0e768bba?s=128&d=identicon&r=PG", "display_name": "rjh", "link": "https://stackoverflow.com/users/74496/rjh"}, "is_accepted": false, "score": 1, "last_activity_date": 1466413101, "creation_date": 1466413101, "answer_id": 37918359, "question_id": 33476470, "link": "https://stackoverflow.com/questions/33476470/how-to-build-static-program-with-gccgo/37918359#37918359", "title": "how to build static program with gccgo", "body": "<p>If you're using <code>static</code> then gccgo requires the static versions of each library i.e. <code>libc.a</code> rather than the dynamic libs <code>libc.so</code>.</p>\n\n<p>Install your distro's static packages. On CentOS 7, they are named <code>glibc-static</code> and <code>libgo-static</code>. Then you should be able to build (you won't need the <code>-L</code> flag either)</p>\n\n<p>However, you may still get some warnings and possibly errors after that. For example when building one such static application I got these errors:</p>\n\n<pre><code>/usr/lib/gcc/x86_64-redhat-linux/4.8.5/libgo.a(net.o): In function `net.lookupPort':\n(.text+0x48e2): warning: Using 'getaddrinfo' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking\n/usr/bin/ld: dynamic STT_GNU_IFUNC symbol `strcmp' with pointer equality in `/usr/lib/gcc/x86_64-redhat-linux/4.8.5/../../../../lib64/libc.a(strcmp.o)' can not be used when making an executable; recompile with -fPIE and relink with -pie\n</code></pre>\n\n<p>So more work may be required to get a working static binary. See <a href=\"https://www.akkadia.org/drepper/no_static_linking.html\" rel=\"nofollow\">https://www.akkadia.org/drepper/no_static_linking.html</a></p>\n"}], "owner": {"reputation": 1, "user_id": 5515514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe44507e058eb5bd521643c6d320744d?s=128&d=identicon&r=PG&f=1", "display_name": "jackme", "link": "https://stackoverflow.com/users/5515514/jackme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1701, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1510673011, "creation_date": 1446463414, "last_edit_date": 1446463815, "question_id": 33476470, "link": "https://stackoverflow.com/questions/33476470/how-to-build-static-program-with-gccgo", "title": "how to build static program with gccgo", "body": "<p>I has a prblem when  I use gccgo to build static programe version</p>\n\n<p>1> use go build\ngo build -compiler gccgo -gccgoflags '-static -L/lib64' test.go\nresult:</p>\n\n<pre><code>/usr/bin/ld: cannot find -lgo\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lm\n/usr/bin/ld: cannot find -lc\n</code></pre>\n\n<p>2>use gccgo build\ngccgo -o test_gccgo_yes -static -L/lib64 test.go\nresult:</p>\n\n<pre><code>/usr/bin/ld: cannot find -lgo\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lm\n/usr/bin/ld: cannot find -lc\n</code></pre>\n\n<p>3> if I don't use static to compile it \ngccgo -o test_gccgo_yes -g test.go\nresult :\nldd test_gccgo_yes \nshow test_gccgo_yes is dynamic file </p>\n\n<p>How I can build static program with gccgo?</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 4677, "user_id": 519348, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TIdre.jpg?s=128&g=1", "display_name": "TZHX", "link": "https://stackoverflow.com/users/519348/tzhx"}, "edited": false, "score": 0, "creation_date": 1446455751, "post_id": 33474153, "comment_id": 54733574, "body": "Are you trying to use redis from the go language, or do you actually mean you want to implement a system with the same functionality as redis?"}, {"owner": {"reputation": 171, "user_id": 1268264, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45cb12f0851381d0288777ce5582005c?s=128&d=identicon&r=PG", "display_name": "rahulshr", "link": "https://stackoverflow.com/users/1268264/rahulshr"}, "reply_to_user": {"reputation": 4677, "user_id": 519348, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TIdre.jpg?s=128&g=1", "display_name": "TZHX", "link": "https://stackoverflow.com/users/519348/tzhx"}, "edited": false, "score": 0, "creation_date": 1446456497, "post_id": 33474153, "comment_id": 54734022, "body": "I want to implement redis like system with above functionality"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1446459255, "post_id": 33474153, "comment_id": 54735695, "body": "If you&#39;re after creating a Redis client in Go, there are already <a href=\"https://godoc.org/?q=redis\" rel=\"nofollow noreferrer\">lots of implementations</a> with some of them being quite mature."}, {"owner": {"reputation": 171, "user_id": 1268264, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45cb12f0851381d0288777ce5582005c?s=128&d=identicon&r=PG", "display_name": "rahulshr", "link": "https://stackoverflow.com/users/1268264/rahulshr"}, "edited": false, "score": 2, "creation_date": 1446460028, "post_id": 33474153, "comment_id": 54736103, "body": "As i said I want to implement whole redis(with basic functionality) in Go not the go client for Redis. I am learning Go and planning to do some small project. I thought this could be a good start."}], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": false, "score": 5, "last_activity_date": 1446474601, "last_edit_date": 1446474601, "creation_date": 1446457634, "answer_id": 33474756, "question_id": 33474153, "link": "https://stackoverflow.com/questions/33474153/implementing-redis-in-go/33474756#33474756", "title": "Implementing redis in go", "body": "<p>If you want to implement a Go server offering some Redis features, it is quite easy. You need to decide about the goroutine model, then implement/reuse some data structures (map and skiplist), then implement the Redis protocol (which is simple enough).</p>\n\n<p>I would suggest a goroutine model with 2 goroutines per client connection, plus one goroutine to implement the Redis engine and manage the data structures. The benefit of this model is you can easily support pipelining and the atomicity property of Redis commands without any explicit locking. This model is well adapted if you want to later extend the scope by supporting blocking commands (such as the ones useful for queues).</p>\n\n<p>Now, if you also want to mimic the same exact Redis behavior, this is more complex. Especially, saving the data in background leveraging the OS copy-on-write mechanism will be difficult with Go (since forking does not work). For a memory database, foreground saving is always easy. Background saving is extremely difficult.</p>\n\n<p>You may also want to have a look at the following attempts, and simplify/enrich them to match your goals:</p>\n\n<ul>\n<li><a href=\"https://github.com/siddontang/ledisdb\" rel=\"nofollow\">https://github.com/siddontang/ledisdb</a></li>\n<li><a href=\"https://github.com/felixge/go-redis\" rel=\"nofollow\">https://github.com/felixge/go-redis</a></li>\n<li><a href=\"https://github.com/docker/go-redis-server\" rel=\"nofollow\">https://github.com/docker/go-redis-server</a></li>\n</ul>\n"}], "owner": {"reputation": 171, "user_id": 1268264, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45cb12f0851381d0288777ce5582005c?s=128&d=identicon&r=PG", "display_name": "rahulshr", "link": "https://stackoverflow.com/users/1268264/rahulshr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 840, "favorite_count": 1, "closed_date": 1446484310, "answer_count": 1, "score": 0, "last_activity_date": 1501072001, "creation_date": 1446455607, "last_edit_date": 1501072001, "question_id": 33474153, "link": "https://stackoverflow.com/questions/33474153/implementing-redis-in-go", "closed_reason": "Needs more focus", "title": "Implementing redis in go", "body": "<p>I am trying implement redis basic functionality like below in Go.</p>\n\n<ol>\n<li>GET </li>\n<li>SET</li>\n<li>ZADD  </li>\n<li>ZCARD </li>\n<li>ZCOUNT  </li>\n<li>ZRANGE </li>\n<li>SAVE</li>\n</ol>\n"}, {"tags": ["go", "automated-tests", "environment-variables"], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1446515352, "post_id": 33472012, "comment_id": 54764821, "body": "Mind to explain this a bit? ;)"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1446531061, "post_id": 33472012, "comment_id": 54769215, "body": "<a href=\"http://unix.stackexchange.com/questions/134735/environment-variables-are-not-set-when-my-function-is-called-in-a-pipeline\" title=\"environment variables are not set when my function is called in a pipeline\">unix.stackexchange.com/questions/134735/&hellip;</a>"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 8, "last_activity_date": 1446531109, "last_edit_date": 1492086987, "creation_date": 1446446325, "answer_id": 33472012, "question_id": 33471976, "link": "https://stackoverflow.com/questions/33471976/set-environment-variable-for-go-tests/33472012#33472012", "title": "Set environment variable for Go tests", "body": "<pre><code>FOO=BAR bash -c 'go list ./... | grep -v vendor | xargs -n1 go test -timeout=3s'\n</code></pre>\n\n<p>A good explanation why the original command doesn't work can be found in the answer to the question: <a href=\"https://unix.stackexchange.com/questions/134735/environment-variables-are-not-set-when-my-function-is-called-in-a-pipeline\">https://unix.stackexchange.com/questions/134735/environment-variables-are-not-set-when-my-function-is-called-in-a-pipeline</a></p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1446446448, "creation_date": 1446446448, "answer_id": 33472039, "question_id": 33471976, "link": "https://stackoverflow.com/questions/33471976/set-environment-variable-for-go-tests/33472039#33472039", "title": "Set environment variable for Go tests", "body": "<p>That's not how setting variables for pipes works. See:</p>\n\n<pre><code> FOO=BAR echo \"AAA\" | FOO=WAZ printenv | grep FOO\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "is_accepted": false, "score": 3, "last_activity_date": 1561584893, "creation_date": 1561584893, "answer_id": 56781197, "question_id": 33471976, "link": "https://stackoverflow.com/questions/33471976/set-environment-variable-for-go-tests/56781197#56781197", "title": "Set environment variable for Go tests", "body": "<p>I like to use <a href=\"https://github.com/joho/godotenv\" rel=\"nofollow noreferrer\">godotenv</a> in <a href=\"https://github.com/joho/godotenv#command-mode\" rel=\"nofollow noreferrer\">command mode</a></p>\n\n<pre><code>godotenv -f ./.env go test ./internal/... -cover\n</code></pre>\n"}], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13882, "favorite_count": 1, "accepted_answer_id": 33472012, "answer_count": 3, "score": 6, "last_activity_date": 1561584893, "creation_date": 1446446139, "last_edit_date": 1486985577, "question_id": 33471976, "link": "https://stackoverflow.com/questions/33471976/set-environment-variable-for-go-tests", "title": "Set environment variable for Go tests", "body": "<p>I am trying to run my Go tests like this, setting an environment variable:</p>\n\n<pre><code>FOO=BAR go list ./... | grep -v vendor | xargs -n1 go test -timeout=3s\n</code></pre>\n\n<p>Inside my tests I do:</p>\n\n<pre><code>log.Print(os.Getenv(\"FOO\"))\n</code></pre>\n\n<p>Which returns an empty string. Why is FOO not set?</p>\n"}, {"tags": ["audio", "go", "shoutcast"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1446445622, "post_id": 33471704, "comment_id": 54729228, "body": "Who&#39;s idea was it to deviate from the spec in such a fundamental way? It just seems like a bad idea. Have you considered forking out the net/http package and making it less strict?"}, {"owner": {"reputation": 2309, "user_id": 2648865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HfZsc.jpg?s=128&g=1", "display_name": "TBR", "link": "https://stackoverflow.com/users/2648865/tbr"}, "edited": false, "score": 4, "creation_date": 1446446344, "post_id": 33471704, "comment_id": 54729504, "body": "That&#39;s wrong. Icecast does NOT reply like that. It&#39;s a HTTP 1.0 compliant server. Shoutcast on the other hand is being retarded and not a HTTP server."}, {"owner": {"reputation": 145537, "user_id": 362536, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/da5816365344305a614343a4065a2786?s=128&d=identicon&r=PG", "display_name": "Brad", "link": "https://stackoverflow.com/users/362536/brad"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1446488787, "post_id": 33471704, "comment_id": 54753590, "body": "@captncraig 1997 was a simpler time...  Not that it excuses it."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446489473, "post_id": 33471704, "comment_id": 54753956, "body": "Is there something public that speaks this I can test against?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446497506, "post_id": 33471704, "comment_id": 54758048, "body": "If they purposely broke the HTTP response, there might be a reason. I wouldn&#39;t be surprised if there&#39;s other pieces of their protocol that diverge from HTTP."}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "reply_to_user": {"reputation": 2309, "user_id": 2648865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HfZsc.jpg?s=128&g=1", "display_name": "TBR", "link": "https://stackoverflow.com/users/2648865/tbr"}, "edited": false, "score": 0, "creation_date": 1447031844, "post_id": 33471704, "comment_id": 54977561, "body": "@TBR thanks, I&#39;d been conflating shoutcast and icecast, and have edited icecast out."}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1447031890, "post_id": 33471704, "comment_id": 54977574, "body": "@JimB I agree, I <i>should</i> implement the icecast protocol myself (along with basic auth, headers, etc), but don&#39;t have time now, so I&#39;m going with captncraig&#39;s dial solution, even though it will only work once per connection."}], "answers": [{"comments": [{"owner": {"reputation": 2309, "user_id": 2648865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HfZsc.jpg?s=128&g=1", "display_name": "TBR", "link": "https://stackoverflow.com/users/2648865/tbr"}, "edited": false, "score": 0, "creation_date": 1446622846, "post_id": 33484984, "comment_id": 54814488, "body": "I&#39;d recommend to indicate a lower HTTP protocol version. I seem to remember that Shoutcast is a variation on HTTP 0.9. So that or 1.0 might avoid problems on the client side."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 2309, "user_id": 2648865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HfZsc.jpg?s=128&g=1", "display_name": "TBR", "link": "https://stackoverflow.com/users/2648865/tbr"}, "edited": false, "score": 0, "creation_date": 1446651094, "post_id": 33484984, "comment_id": 54832714, "body": "Probably a good idea, but I doubt a 1.0 compliant response would have anything unparsable to a 1.1 client. If it is actually 1.0 compliant is another question."}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "edited": false, "score": 0, "creation_date": 1447032046, "post_id": 33484984, "comment_id": 54977624, "body": "This won&#39;t work for connection reuse, but this gets me over the line, and who am I kidding, it&#39;ll probably be in production for years before I get around to properly implementing icecast. Thank you!"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 3, "last_activity_date": 1446491387, "last_edit_date": 1446491387, "creation_date": 1446491061, "answer_id": 33484984, "question_id": 33471704, "link": "https://stackoverflow.com/questions/33471704/making-go-http-client-work-with-non-standard-http-servers/33484984#33484984", "title": "making go http client work with non-standard http servers", "body": "<p>I got this working by creating a custom Dial function that returns a wrapped connection. My wrapper intercepts the first read on the connection and replaces ICY with HTTP/1.1. Not super robust, but proves the concept:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/http\"\n)\n\ntype IcyConnWrapper struct {\n    net.Conn\n    haveReadAny bool\n}\n\nfunc (i *IcyConnWrapper) Read(b []byte) (int, error) {\n    if i.haveReadAny {\n        return i.Conn.Read(b)\n    }\n    i.haveReadAny = true\n    //bounds checking ommitted. There are a few ways this can go wrong.\n    //always check array sizes and returned n.\n    n, err := i.Conn.Read(b[:3])\n    if err != nil {\n        return n, err\n    }\n    if string(b[:3]) == \"ICY\" {\n        //write Correct http response into buffer\n        copy(b, []byte(\"HTTP/1.1\"))\n        return 8, nil\n    }\n    return n, nil\n}\n\nfunc main() {\n\n    tr := &amp;http.Transport{\n        Dial: func(network, a string) (net.Conn, error) {\n            realConn, err := net.Dial(network, a)\n            if err != nil {\n                return nil, err\n            }\n            return &amp;IcyConnWrapper{Conn: realConn}, nil\n        },\n    }\n    client := &amp;http.Client{Transport: tr}\n    http.DefaultClient = client\n    resp, err := http.Get(\"http://178.33.230.189:8100\") //random url I found on the internet\n    fmt.Println(err)\n    fmt.Println(resp.StatusCode)\n}\n</code></pre>\n"}], "owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 0, "accepted_answer_id": 33484984, "answer_count": 1, "score": 4, "last_activity_date": 1447031691, "creation_date": 1446444713, "last_edit_date": 1447031691, "question_id": 33471704, "link": "https://stackoverflow.com/questions/33471704/making-go-http-client-work-with-non-standard-http-servers", "title": "making go http client work with non-standard http servers", "body": "<p>Shoutcast servers basically speak http, with one important difference: they respond to <code>GET</code> requests with <code>ICY 200 OK</code> instead of <code>HTTP/1.1 200 OK</code>.</p>\n\n<p>Go won't have a bar of it, and correctly fails with the error <code>malformed HTTP version \"ICY\"</code>.</p>\n\n<p>However I would like to make things work and am wondering what the best approach is. My ideas so far:</p>\n\n<ol>\n<li>use a custom http.Transport.Proxy to change <code>ICY</code> to <code>HTTP/1.1</code> in-flight</li>\n<li>an out of process proxy that does the same thing</li>\n<li>overload <a href=\"https://golang.org/src/net/http/request.go?s=16539:16601#L498\" rel=\"nofollow\"><code>http.ParseHTTPVersion</code></a> (but golang doesn't have function overloading)</li>\n<li>duplicate the entire http package, just to modify <code>ParseHTTPVersion</code></li>\n</ol>\n\n<p>Number 1. seems the most attractive attractive, but I have no idea how to respect the http \"scope\" and actually modify all responses on a given http version. Is this the kind of thing <code>http.Transport.Proxy</code> can handle?</p>\n\n<p>Can anyone give me any pointers? </p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1446532458, "post_id": 33470649, "comment_id": 54769795, "body": "Not enought information. What the client do?  What your server do? A sample output."}], "answers": [{"comments": [{"owner": {"reputation": 781, "user_id": 4162248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20a90b2be1791eb0ca90f6a16fa543c4?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Petr", "link": "https://stackoverflow.com/users/4162248/greg-petr"}, "edited": false, "score": 0, "creation_date": 1446442919, "post_id": 33471069, "comment_id": 54728302, "body": "Any other ways other than using fmt.Errorf(), why cant I use the string function ?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1446449512, "post_id": 33471069, "comment_id": 54730733, "body": "Sure. Depends on what you really mean by &quot;combining&quot;. String concatenation is done using the <code>+</code> operator. Or you might store them individually in a slice, <code>append()</code>-ing values to it. <i>This</i> question suggests you should work yourself through a Go tutorial and get a book on it."}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 781, "user_id": 4162248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20a90b2be1791eb0ca90f6a16fa543c4?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Petr", "link": "https://stackoverflow.com/users/4162248/greg-petr"}, "edited": false, "score": 1, "creation_date": 1446479054, "post_id": 33471069, "comment_id": 54747632, "body": "@GregPetr Potentially another clean way to do this is to have your own <code>CombinedError</code> struct that takes a list of errors as a field and implements the <code>Error() string</code> method and do what you want, whether its concatenating strings or whatsoever."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 28, "last_activity_date": 1446443577, "last_edit_date": 1446443577, "creation_date": 1446440511, "answer_id": 33471069, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/33471069#33471069", "title": "Combine multiple error strings", "body": "<p>String functions don't work on errors because error is really an interface that implements the function Error() string.</p>\n\n<p>You can use string functions on err1.Error() and err2.Error()\nbut not on the \"err1\" reference itself.</p>\n\n<p>Some errors are structs, like the ones you get from database drivers.</p>\n\n<p>So there's no natural way to use string functions on errors since they may not actually be strings underneath.</p>\n\n<p>As for combining two errors:</p>\n\n<p>Easy, just use fmt.Errorf again.</p>\n\n<pre><code>fmt.Errorf(\"Combined error: %v %v\", err1, err2)\n</code></pre>\n\n<p>Alternatively:</p>\n\n<pre><code>errors.New(err1.Error() + err2.Error())\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 781, "user_id": 4162248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20a90b2be1791eb0ca90f6a16fa543c4?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Petr", "link": "https://stackoverflow.com/users/4162248/greg-petr"}, "edited": false, "score": 0, "creation_date": 1446615247, "post_id": 33487009, "comment_id": 54811472, "body": "thanks, your example was very useful. I will try this out and get back."}, {"owner": {"reputation": 3279, "user_id": 1493534, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WIQKD.jpg?s=128&g=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/1493534/rakesh"}, "edited": false, "score": 0, "creation_date": 1522360374, "post_id": 33487009, "comment_id": 86139461, "body": "@BenCampbell Is there a reason for the method receiver to be a pointer here?"}, {"owner": {"reputation": 2659, "user_id": 425997, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6pMR3.jpg?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/425997/david"}, "edited": false, "score": 0, "creation_date": 1524517242, "post_id": 33487009, "comment_id": 86996230, "body": "Thanks for this tip. On the off chance one might add a nil error, the Error() function should do a nil check on the collected errors. And if one accesses by just index and not index + value, need to deference cast the error array before the index access. Here&#39;s an example: <a href=\"https://play.golang.org/p/h9F5WhcQ5Bs\" rel=\"nofollow noreferrer\">play.golang.org/p/h9F5WhcQ5Bs</a>"}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "reply_to_user": {"reputation": 3279, "user_id": 1493534, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WIQKD.jpg?s=128&g=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/1493534/rakesh"}, "edited": false, "score": 0, "creation_date": 1582281362, "post_id": 33487009, "comment_id": 106731591, "body": "@Rakesh No. <code>func (c *ErrorCollector) Error() (err string)</code> should be <code>func (c ErrorCollector) Error() (err string)</code>."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": 12, "last_activity_date": 1446498744, "creation_date": 1446498744, "answer_id": 33487009, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/33487009#33487009", "title": "Combine multiple error strings", "body": "<p>To expand on what @WillC had mentioned in a comment it is possible to define your own <code>error</code> type as <code>error</code> is an interface type. Any type that implements a <code>Error() string</code> function implements the <code>error</code> interface. Therefore, you could create a <code>CollectionError</code> which aggregates errors and returns a concatenated error string. </p>\n\n<pre><code>type ErrorCollector []error\n\nfunc (c *ErrorCollector) Collect(e error) { *c = append(*c, e) }\n\nfunc (c *ErrorCollector) Error() (err string) {\n    err = \"Collected errors:\\n\"\n    for i, e := range *c {\n        err += fmt.Sprintf(\"\\tError %d: %s\\n\", i, e.Error())\n    }\n\n    return err\n}\n</code></pre>\n\n<p>This provides a collection function that appends a given <code>error</code> to a slice. Upon calling <code>Error() string</code> it iterates over the slice and creates a concatenated error string.</p>\n\n<pre><code>func main() {\n    collector := new(ErrorCollector)\n\n    for i := 0; i &lt; 10; i++ {\n         collector.Collect(errors.New(fmt.Sprintf(\"%d Error\", i)))\n    }\n\n    fmt.Println(collector)\n}\n</code></pre>\n\n<p>There is a great <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"noreferrer\">golang.org blog post</a> going over errors in more detail. A full example of the example is available on <a href=\"https://play.golang.org/p/eztQmlaleB\" rel=\"noreferrer\">The Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5621, "user_id": 3692399, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/b24bx.jpg?s=128&g=1", "display_name": "askb", "link": "https://stackoverflow.com/users/3692399/askb"}, "is_accepted": true, "score": 21, "last_activity_date": 1446614419, "creation_date": 1446614419, "answer_id": 33514248, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/33514248#33514248", "title": "Combine multiple error strings", "body": "<p>You could use the <code>strings.Join()</code> and <code>append()</code> function to acheive this slice. </p>\n\n<p><a href=\"https://play.golang.org/p/rpki9zcbzF\" rel=\"noreferrer\">example: golang playgorund</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"syscall\"\n)\n\nfunc main() {\n\n    // create a slice for the errors\n    var errstrings []string \n\n    // first error\n    err1 := fmt.Errorf(\"First error:server error\")\n    errstrings = append(errstrings, err1.Error())\n\n    // do something \n    err2 := fmt.Errorf(\"Second error:%s\", syscall.ENOPKG.Error())\n    errstrings = append(errstrings, err2.Error())\n\n    // do something else\n    err3 := fmt.Errorf(\"Third error:%s\", syscall.ENOTCONN.Error())\n    errstrings = append(errstrings, err3.Error())\n\n    // combine and print all the error\n    fmt.Println(fmt.Errorf(strings.Join(errstrings, \"\\n\")))\n\n\n}\n</code></pre>\n\n<p>This would output a single string which you can send back to the client.</p>\n\n<pre><code>First error:server1 \nSecond error:Package not installed \nThird error:Socket is not connected\n</code></pre>\n\n<p>hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 498, "user_id": 3142913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2b18cec1c2d7e7734764d369134d38?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Lawrence", "link": "https://stackoverflow.com/users/3142913/mark-lawrence"}, "is_accepted": false, "score": 7, "last_activity_date": 1504461065, "creation_date": 1504461065, "answer_id": 46026248, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/46026248#46026248", "title": "Combine multiple error strings", "body": "<p>People may be interested in <a href=\"https://github.com/hashicorp/go-multierror\" rel=\"noreferrer\">https://github.com/hashicorp/go-multierror</a> which describes itself as \"A Go (golang) package for representing a list of errors as a single error.\".</p>\n"}, {"tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": false, "score": 0, "last_activity_date": 1525880997, "creation_date": 1525880997, "answer_id": 50257423, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/50257423#50257423", "title": "Combine multiple error strings", "body": "<p>Use this function:</p>\n\n<pre><code>func JoinErrs(errs ...error) error {\n    var joinErrsR func(string, int, ...error) error\n    joinErrsR = func(soFar string, count int, errs ...error) error {\n        if len(errs) == 0 {\n            if count == 0 {\n                return nil\n            }\n            return fmt.Errorf(soFar)\n        }\n        current := errs[0]\n        next := errs[1:]\n        if current == nil {\n            return joinErrsR(soFar, count, next...)\n        }\n        count++\n        if count == 1 {\n            return joinErrsR(fmt.Sprintf(\"%s\", current), count, next...)\n        } else if count == 2 {\n            return joinErrsR(fmt.Sprintf(\"1: %s\\n2: %s\", soFar, current), count, next...)\n        }\n        return joinErrsR(fmt.Sprintf(\"%s\\n%d: %s\", soFar, count, current), count, next...)\n    }\n    return joinErrsR(\"\", 0, errs...)\n}\n</code></pre>\n\n<p>It will give you nil when all errors are nil, will give you the same error when just one non-nil error, will give you numbered list of non-nil errors when multiple non-nil errors</p>\n\n<p>Try it out here: <a href=\"https://play.golang.org/p/WttztCr-xHG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WttztCr-xHG</a></p>\n"}, {"comments": [{"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 12, "creation_date": 1582279712, "post_id": 51391082, "comment_id": 106730715, "body": "Wrapping is not for a multiple errors. It is for wrapping ONE error with more context."}], "tags": [], "owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "is_accepted": false, "score": 34, "last_activity_date": 1567606904, "last_edit_date": 1567606904, "creation_date": 1531866955, "answer_id": 51391082, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/51391082#51391082", "title": "Combine multiple error strings", "body": "<p>UPDATE for Go 1.13:</p>\n\n<p>As of <a href=\"https://blog.golang.org/go1.13\" rel=\"noreferrer\">Go version 1.13</a>, the language's <a href=\"https://golang.org/pkg/errors/\" rel=\"noreferrer\">errors package</a> now supports <a href=\"https://golang.org/doc/go1.13#error_wrapping\" rel=\"noreferrer\">error wrapping</a> directly.</p>\n\n<p>You can wrap an error by using the <code>%w</code> verb in <code>fmt.Errorf</code>:</p>\n\n<pre><code>err := errors.New(\"Original error\")\nerr = fmt.Errorf(\"%w; Second error\", err)\n</code></pre>\n\n<p>Use <a href=\"https://golang.org/pkg/errors/#Unwrap\" rel=\"noreferrer\">Unwrap</a> to remove the last error added, and return what remains: <code>previousErrors := errors.Unwrap(err)</code></p>\n\n<p><a href=\"https://play.golang.org/p/nqNrM8qOvST\" rel=\"noreferrer\">Playground Example for errors.Unwrap</a></p>\n\n<p>Two more functions, <a href=\"https://golang.org/pkg/errors/#Is\" rel=\"noreferrer\">errors.Is</a> and <a href=\"https://golang.org/pkg/errors/#As\" rel=\"noreferrer\">errors.As</a> provide ways to check for and retrieve a specific type of error.</p>\n\n<p><a href=\"https://play.golang.org/p/NL_MiNC31o6\" rel=\"noreferrer\">Playground Example for errors.As and errors.Is</a></p>\n\n<hr>\n\n<p>Dave Cheney's excellent <code>errors</code> package (<a href=\"https://github.com/pkg/errors\" rel=\"noreferrer\">https://github.com/pkg/errors</a>) include a <code>Wrap</code> function for this purpose:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/pkg/errors\"\n\nfunc main() {\n        err := errors.New(\"error\")\n        err = errors.Wrap(err, \"open failed\")\n        err = errors.Wrap(err, \"read config failed\")\n\n        fmt.Println(err) // \"read config failed: open failed: error\"\n}\n</code></pre>\n\n<p>This also allows additional functionality, such as unpacking the cause of the error:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/pkg/errors\"\n\nfunc main() {\n    err := errors.New(\"original error\")\n    err = errors.Wrap(err, \"now this\")\n\n    fmt.Println(errors.Cause(err)) // \"original error\"\n}\n</code></pre>\n\n<p>As well as the option to output a stack trace when specifying <code>fmt.Printf(\"%+v\\n\", err)</code>.</p>\n\n<p>You can find additional information about the package on his blog: <a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\" rel=\"noreferrer\">here</a> and <a href=\"https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package\" rel=\"noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "is_accepted": false, "score": 5, "last_activity_date": 1582280603, "creation_date": 1582280603, "answer_id": 60336594, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/60336594#60336594", "title": "Combine multiple error strings", "body": "<p>Uber has a <a href=\"https://pkg.go.dev/github.com/uber-go/multierr?tab=doc\" rel=\"noreferrer\">multierr</a> package for this use case:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>return multierr.Combine(err1, err2)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 14328901, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/0464c94bab52fee1160a7d6b99cbc38c?s=128&d=identicon&r=PG", "display_name": "Anita", "link": "https://stackoverflow.com/users/14328901/anita"}, "is_accepted": false, "score": 2, "last_activity_date": 1600879744, "creation_date": 1600879744, "answer_id": 64032678, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings/64032678#64032678", "title": "Combine multiple error strings", "body": "<p>This seems to work well for me (space separated errors):</p>\n<ol>\n<li>Put all your errors in a error slice/list/array, ie: var errors [] error</li>\n<li>fmt.Sprintf(&quot;%s&quot;, errors)</li>\n</ol>\n<pre><code>    var errors []error\n    errors = append(errors, fmt.Errorf(&quot;error 1&quot;))\n    errors = append(errors, fmt.Errorf(&quot;error 2&quot;))\n    errors = append(errors, fmt.Errorf(&quot;and yet another error&quot;))\n    s := fmt.Sprintf(&quot;%s&quot;, errors)\n    fmt.Println(s)\n</code></pre>\n"}], "owner": {"reputation": 781, "user_id": 4162248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/20a90b2be1791eb0ca90f6a16fa543c4?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Petr", "link": "https://stackoverflow.com/users/4162248/greg-petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35827, "favorite_count": 6, "accepted_answer_id": 33514248, "answer_count": 8, "score": 37, "last_activity_date": 1600879744, "creation_date": 1446437572, "last_edit_date": 1446442811, "question_id": 33470649, "link": "https://stackoverflow.com/questions/33470649/combine-multiple-error-strings", "title": "Combine multiple error strings", "body": "<p>I am new to golang, my application needs to return multiple errors in a loop, later requires to be combined and returned as a single error string. I am not able to use the string functions to combine the error messages. What methods can be use to combine these errors into a single error before returning ? </p>\n\n<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"strings\"\n)\n\nfunc Servreturn() (err error) {\n\n   err1 = fmt.Errorf(\"Something else occured\")\n   err2 = fmt.Errorf(\"Something else occured again\")\n\n   // concatenate both the error\n\n   return err3\n\n}\n</code></pre>\n"}, {"tags": ["rest", "go", "request"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 6, "last_activity_date": 1446440675, "last_edit_date": 1446440675, "creation_date": 1446434647, "answer_id": 33470269, "question_id": 33469917, "link": "https://stackoverflow.com/questions/33469917/passing-parameters-to-get-request/33470269#33470269", "title": "Passing parameters to GET request", "body": "<p>Looks like you need to use <a href=\"https://godoc.org/github.com/parnurzeal/gorequest#SuperAgent.Param\" rel=\"nofollow\"><code>Param</code></a> to do this.</p>\n\n<p>Also the standard library's <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow\"><code>NewRequest</code></a> returns a Request struct with a member <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow\"><code>URL</code></a> that has a function <a href=\"https://golang.org/pkg/net/url/#URL.Query\" rel=\"nofollow\"><code>Query</code></a> that you can use to <a href=\"https://golang.org/pkg/net/url/#Values.Add\" rel=\"nofollow\"><code>Add</code></a> parameters to your query before issuing the request.</p>\n"}], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2140, "favorite_count": 0, "accepted_answer_id": 33470269, "answer_count": 1, "score": 4, "last_activity_date": 1446440675, "creation_date": 1446431930, "question_id": 33469917, "link": "https://stackoverflow.com/questions/33469917/passing-parameters-to-get-request", "title": "Passing parameters to GET request", "body": "<p>I cannot seem to figure how to do this in <code>go</code>.</p>\n\n<p>I was following this tutorial:</p>\n\n<p><a href=\"https://github.com/parnurzeal/gorequest\" rel=\"nofollow noreferrer\">https://github.com/parnurzeal/gorequest</a></p>\n\n<p>and I can pass parameters using <code>Header</code>, which I think is a bad idea.</p>\n\n<p>I am basically looking for <code>go</code> version of <code>python</code></p>\n\n<pre><code>In [28]: import requests\n\nIn [29]: r = requests.get(\"http://localhost:8000/get_result\", params={\"number\": 40})\n</code></pre>\n\n<p>Following is my code for my REST API:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"strconv\"\n    \"fmt\"\n)\n\nfunc make_result(w http.ResponseWriter, r *http.Request) {\n\n    fmt.Println(r)\n\n    err := r.ParseForm()\n    if err != nil {\n        panic(err)\n    }\n\n    number_string := r.Form[\"number\"][0]\n    // number_string := r.Header[\"Number\"][0] header solution\n    number, err := strconv.Atoi(number_string)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Fprint(w, fmt.Sprint(number * 5))\n\n}\n\nfunc main() {\n    http.HandleFunc(\"/get_result\", make_result)\n    http.ListenAndServe(\"localhost:8000\", nil)\n}\n</code></pre>\n\n<p>I am trying to call it using this code:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"    \n    \"reflect\"\n    \"github.com/parnurzeal/gorequest\"\n\n)\n\nfunc main() {\n\n    resp, body, errs := gorequest.New().\n        Get(\"http://localhost:8000/get_result\").\n        Set(\"Number\", \"7\").      // Changes the Header \n        Type(\"form\").            // These two lines appear \n        Send(`{\"number\": 5}`).   // to be irrelevant \n        End()\n\n\n    fmt.Println(errs)\n    fmt.Println(resp)\n    fmt.Println(body)\n\n}\n</code></pre>\n\n<p>The above is similar to python's:</p>\n\n<pre><code>In [34]: r = requests.get(\"http://localhost:8000/get_result\", headers={\"Number\": 7})\n</code></pre>\n\n<p>When I am using the python method (using params) to call the api, I see <code>/get_result?number=7 &lt;nil&gt; &lt;nil&gt;</code> line being printed as a part of <code>request object</code>. But am don't see it in my go version, so I must be calling it wrong. What am I missing?</p>\n"}, {"tags": ["http", "go", "gzip"], "answers": [{"comments": [{"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "edited": false, "score": 0, "creation_date": 1446436649, "post_id": 33469866, "comment_id": 54726470, "body": "Thanks a lot! It worked well thanks to you!! I&#39;ve  finally solved problems!!"}, {"owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "edited": false, "score": 1, "creation_date": 1446441153, "post_id": 33469866, "comment_id": 54727799, "body": "I&#39;m beginner user on stackflow. I tried mark the question. Is that correct?"}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "edited": false, "score": 0, "creation_date": 1596065846, "post_id": 33469866, "comment_id": 111694691, "body": "I don&#39;t remember."}], "tags": [], "owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "is_accepted": true, "score": 7, "last_activity_date": 1446431513, "creation_date": 1446431513, "answer_id": 33469866, "question_id": 33469723, "link": "https://stackoverflow.com/questions/33469723/go-how-to-control-gzip-compression-when-sending-http-request/33469866#33469866", "title": "(Go) How to control gzip compression when sending http request?", "body": "<p>Try </p>\n\n<pre><code>req.Header.Set(\"Accept-Encoding\", \"identity\")\n</code></pre>\n"}], "owner": {"reputation": 967, "user_id": 5105392, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1019878568022717/picture?type=large", "display_name": "Harry", "link": "https://stackoverflow.com/users/5105392/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2076, "favorite_count": 2, "accepted_answer_id": 33469866, "answer_count": 1, "score": 6, "last_activity_date": 1446431513, "creation_date": 1446430478, "question_id": 33469723, "link": "https://stackoverflow.com/questions/33469723/go-how-to-control-gzip-compression-when-sending-http-request", "title": "(Go) How to control gzip compression when sending http request?", "body": "<p>I'd like to ask all of you how to control gzip compression when requesting HTTP Post messages. \n\"Accept-Encoding: gzip\" as Http request headers was always added to http request I sent.\nBut I don't want to use gzip compression.\nHow can I manage that?</p>\n\n<p>I've always used DisableCompression of transport type before executing http.NewRequest. \nAnd I already tried to set both of value true and false to DisableCompression.\nHowever it can't work well so far.</p>\n\n<p>My part of code sample is as below.</p>\n\n<pre><code>//gzip\ntr := &amp;http.Transport{\n    DisableCompression: true,\n}\n//client := &amp;http.Client{}\nclient := &amp;http.Client{Transport: tr}\n\nreq, err := http.NewRequest(\n    \"POST\",\n    reqUrl,\n    bytes.NewBuffer(bytesMessage),\n)\n\n//Set Http Headers\nreq.Header.Add(\"Content-Type\", \"application/json; charset=UTF-8\")\nreq.Header.Add(\"Accept\", \"*/*\")\nreq.Header.Del(\"Accept-Encoding\")\n\n//HTTP request\nresp, err := client.Do(req)\n</code></pre>\n\n<p>Go version I'm using is 1.5.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 0, "creation_date": 1512980777, "post_id": 33469177, "comment_id": 82457805, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32916619/how-to-initialize-a-list-of-objects-given-only-an-interface-sample\">How to initialize a list of objects given only an interface sample?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4007, "user_id": 996592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3261f0896f6a8cd7f09af5cc8d10c71c?s=128&d=identicon&r=PG", "display_name": "Fabian Tamp", "link": "https://stackoverflow.com/users/996592/fabian-tamp"}, "edited": false, "score": 1, "creation_date": 1446429287, "post_id": 33469572, "comment_id": 54724674, "body": "You can also just use <code>reflect.ValueOf(ret).Interface()</code> directly."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4007, "user_id": 996592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3261f0896f6a8cd7f09af5cc8d10c71c?s=128&d=identicon&r=PG", "display_name": "Fabian Tamp", "link": "https://stackoverflow.com/users/996592/fabian-tamp"}, "edited": false, "score": 0, "creation_date": 1446429983, "post_id": 33469572, "comment_id": 54724829, "body": "@FabianTamp my mistake, resisting wrong type <code>*UserInfo</code> instead of <code>UserInfo</code>, so not need direct now"}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 3, "last_activity_date": 1446429885, "last_edit_date": 1446429885, "creation_date": 1446429242, "answer_id": 33469572, "question_id": 33469177, "link": "https://stackoverflow.com/questions/33469177/new-instance-of-struct-from-the-type-at-runtime-in-go/33469572#33469572", "title": "New instance of struct from the type at runtime in GO", "body": "<p>i reviewed your code. when you new a type with reflect, you got a value in <code>Value</code> type, need to call <code>Interface()</code> to get the interface of that new generated value</p>\n\n<p>check the code\n<a href=\"http://play.golang.org/p/CHWSV8EG7D\" rel=\"nofollow\">http://play.golang.org/p/CHWSV8EG7D</a></p>\n"}, {"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": false, "score": 0, "last_activity_date": 1504009532, "creation_date": 1504009532, "answer_id": 45939113, "question_id": 33469177, "link": "https://stackoverflow.com/questions/33469177/new-instance-of-struct-from-the-type-at-runtime-in-go/45939113#45939113", "title": "New instance of struct from the type at runtime in GO", "body": "<p>On run reflect.New(sometype) result in an pointer for reflect.Value of sometype. If you use .Elem() will get direct value for reflect.Value that is empty. For this main.UserInfo{}.</p>\n\n<pre><code>//Return user defined object\nfunc (db *DBEngine) Get(key string) interface{} {\n    decoder := json.NewDecoder(bytes.NewReader(db.DB[key]));\n    fmt.Println(\"Value []byte:\", string(db.DB[key]))\n    ret := reflect.New(reflect.TypeOf(db.Template)).Elem()//&lt;--wrong\n    fmt.Println(reflect.TypeOf(db.Template), ret)\n    decoder.Decode(ret)\n    return ret.Interface()\n}\n//print\n//Hello, playground\n//Value []byte: {\"email\":\"jdoe@acme.com\",\"name\":\"John Doe\",\"_id\":\"142321\"}\n//main.UserInfo {  }\n//TypeOf(ret): main.UserInfo\n//ValueOf(ret): {  }\n//Value: {  }\n</code></pre>\n\n<p>For get *sometype value use .Interface(), so you will can to decode. See:</p>\n\n<pre><code>//Return user defined object\nfunc (db *DBEngine) Get(key string) interface{} {\n    decoder := json.NewDecoder(bytes.NewReader(db.DB[key]));\n    fmt.Println(\"Value []byte:\", string(db.DB[key]))\n    retValue := reflect.New(reflect.TypeOf(db.Template))\n    retInter := retValue.Interface()//&lt;-- \n    fmt.Println(reflect.TypeOf(db.Template), retInter)\n    decoder.Decode(retInter)\n    return retInter\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Hello, playground\nValue []byte: {\"email\":\"jdoe@acme.com\",\"name\":\"John Doe\",\"_id\":\"142321\"}\nmain.UserInfo &amp;{  }\nTypeOf(ret): *main.UserInfo\nValueOf(ret): &amp;{jdoe@acme.com John Doe 142321}\nValue: &amp;{jdoe@acme.com John Doe 142321}\n</code></pre>\n\n<p>In playground: <a href=\"https://play.golang.org/p/veTUho5D4d\" rel=\"nofollow noreferrer\">https://play.golang.org/p/veTUho5D4d</a></p>\n"}], "owner": {"reputation": 127, "user_id": 1106558, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e89b0acda3f3332c3b2def50c19994a9?s=128&d=identicon&r=PG", "display_name": "sukkad", "link": "https://stackoverflow.com/users/1106558/sukkad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3039, "favorite_count": 0, "accepted_answer_id": 33469572, "answer_count": 2, "score": 1, "last_activity_date": 1504009532, "creation_date": 1446426225, "last_edit_date": 1495541683, "question_id": 33469177, "link": "https://stackoverflow.com/questions/33469177/new-instance-of-struct-from-the-type-at-runtime-in-go", "title": "New instance of struct from the type at runtime in GO", "body": "<p>I am trying to create new instance of a struct, using it's type (reflect.TypeOf) at runtime. I have followed this thread on StackOverflow <a href=\"https://stackoverflow.com/questions/7850140/how-do-you-create-a-new-instance-of-a-struct-from-its-type-at-runtime-in-go\">How do you create a new instance of a struct from it&#39;s Type at runtime in Go?</a>. Here is my implementation (also at <a href=\"http://play.golang.org/p/BtX0d5Ytu8\" rel=\"nofollow noreferrer\">http://play.golang.org/p/BtX0d5Ytu8</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"encoding/json\"\n    \"bytes\"\n)\n\ntype UserInfo struct {\n    Email    string `json:\"email\"`\n    FullName string `json:\"name\"`\n    ID       string `json:\"_id\"`\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    db := DBEngine{}\n    db.DB = make(map[string][]byte)\n\n    db.Register(UserInfo{})\n\n    db.Put(\"142321\", UserInfo{\"jdoe@acme.com\", \"John Doe\", \"142321\"})\n    ret := db.Get(\"142321\")\n    fmt.Println(\"TypeOf(ret):\", reflect.TypeOf(ret))\n    fmt.Println(\"ValueOf(ret):\", reflect.ValueOf(ret))\n    fmt.Println(\"Value:\", ret)\n}\n\ntype DBEngine struct {\n    Template interface{}\n    DB       map[string][]byte\n}\n\nfunc (db *DBEngine) Register(v interface{}) {\n    db.Template = v\n}\n\n//Set User defined object\nfunc (db *DBEngine) Put(key string, v interface{}) {\n    res, _ := json.Marshal(v)\n    db.DB[key] = res\n}\n\n//Return user defined object\nfunc (db *DBEngine) Get(key string) interface{} {\n    decoder := json.NewDecoder(bytes.NewReader(db.DB[key]));\n    fmt.Println(\"Value []byte:\", string(db.DB[key]))\n    ret := reflect.New(reflect.TypeOf(db.Template)).Elem()\n    fmt.Println(reflect.TypeOf(db.Template), ret)\n    decoder.Decode(ret)\n    return ret.Interface()\n}\n</code></pre>\n\n<p>For some reason, I always get empty struct. I am unable to set fields or modify. Can someone suggest what is wrong?</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1446410511, "post_id": 33466952, "comment_id": 54719539, "body": "whats the exact code that failed with current_timestamp?"}, {"owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "reply_to_user": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1446410609, "post_id": 33466952, "comment_id": 54719578, "body": "Same code. Just change <code>NOW()</code> for <code>CURRENT_TIMESTAMP</code>. I get <code>pq: column &quot;\u00a0current_timestamp&quot; does not exist</code>."}, {"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 1, "creation_date": 1446410755, "post_id": 33466952, "comment_id": 54719634, "body": "Did you surround current_timestamp with double-quotes? That&#39;s the only way I can think of to get that error."}, {"owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "reply_to_user": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1446411645, "post_id": 33466952, "comment_id": 54719922, "body": "No I didn&#39;t and the queries work in <code>psql</code>."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 3, "creation_date": 1446411952, "post_id": 33466952, "comment_id": 54720031, "body": "The two spaces between <code>function</code> and <code>now()</code> in the error message are suspicious, there should only be one space. Are you certain that nothing is modifying your query before it gets to PostgreSQL? Can you get a look at the SQL that is sent to PostgreSQL rather than the SQL in your Go code? If I say <code>select &quot; f&quot;();</code> then I get two spaces (but no quotes) in the error message, if I say <code>select f();</code> then I only get one space."}, {"owner": {"reputation": 3137, "user_id": 2427560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYYFA.jpg?s=128&g=1", "display_name": "Turophile", "link": "https://stackoverflow.com/users/2427560/turophile"}, "edited": false, "score": 2, "creation_date": 1446413064, "post_id": 33466952, "comment_id": 54720366, "body": "Try swapping the code to read <code>WHERE NOW() &gt; deleted_at</code> to see what that gives as the error."}, {"owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "edited": false, "score": 0, "creation_date": 1446413546, "post_id": 33466952, "comment_id": 54720527, "body": "Swapped: <code>pq: syntax error at or near &quot;AND\u00a0NOW&quot;</code>. I&#39;m trying to find a way to see the formatted query."}, {"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 1, "creation_date": 1446413581, "post_id": 33466952, "comment_id": 54720537, "body": "Where did the <code>AND</code> come from?"}, {"owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "edited": false, "score": 0, "creation_date": 1446414001, "post_id": 33466952, "comment_id": 54720678, "body": "Oops, sorry, I was trying other queries."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446416822, "post_id": 33466952, "comment_id": 54721545, "body": "Tried. Worked for me."}], "answers": [{"tags": [], "owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "is_accepted": false, "score": 0, "last_activity_date": 1447872678, "creation_date": 1447872678, "answer_id": 33788020, "question_id": 33466952, "link": "https://stackoverflow.com/questions/33466952/now-cant-be-used-in-query-it-doesnt-exist/33788020#33788020", "title": "NOW() can&#39;t be used in query (it doesn&#39;t exist)", "body": "<p>As far as I can see there is nothing wrong with your query.  PostgreSQL can throw function not found at you also when the function actually exists but a different value type is expected.</p>\n\n<p>The function now() returns <a href=\"http://www.postgresql.org/docs/9.1/static/functions-datetime.html\" rel=\"nofollow\">timestamp with time zone</a>. If the column deleted_at is not of the same type, you might need to cast either deleted_at or the output from now(). </p>\n"}, {"comments": [{"owner": {"reputation": 6057, "user_id": 543814, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/sC2s7.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/543814/timo"}, "edited": false, "score": 0, "creation_date": 1531384410, "post_id": 35954728, "comment_id": 89578512, "body": "Experiencing the same issue (though I expect my non-breaking spaces to originate elsewhere, even though I have no idea where), I am surprised how hard to find the issue is and how few people seem to have encountered it."}], "tags": [], "owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "is_accepted": true, "score": 1, "last_activity_date": 1457765727, "creation_date": 1457765727, "answer_id": 35954728, "question_id": 33466952, "link": "https://stackoverflow.com/questions/33466952/now-cant-be-used-in-query-it-doesnt-exist/35954728#35954728", "title": "NOW() can&#39;t be used in query (it doesn&#39;t exist)", "body": "<p>My right alt key on my keyboard got stuck without me noticing. That made me insert non-breakable spaces when pressing the space bar. PostgreSQL probably interpreted the non-breakable space as a character that is part of the function's name.</p>\n\n<p>Inserting regular spaces instead solved the issue.</p>\n"}], "owner": {"reputation": 3440, "user_id": 1407735, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7c273f8bbfe205223d4f785dd5e8b830?s=128&d=identicon&r=PG", "display_name": "Marc-Fran&#231;ois", "link": "https://stackoverflow.com/users/1407735/marc-fran%c3%a7ois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 35954728, "answer_count": 2, "score": 4, "last_activity_date": 1457765727, "creation_date": 1446410410, "question_id": 33466952, "link": "https://stackoverflow.com/questions/33466952/now-cant-be-used-in-query-it-doesnt-exist", "title": "NOW() can&#39;t be used in query (it doesn&#39;t exist)", "body": "<p>In my Go code, I have this line of code:</p>\n\n<pre><code>rows, err := conn.Query(`\n    SELECT id, name, lang, deleted_at, read\n    FROM categories\n    WHERE deleted_at &lt;\u00a0NOW()\n`)\n</code></pre>\n\n<p>When I run this, I get an error from PostgreSQL:</p>\n\n<pre><code>pq: function \u00a0now() does not exist\n</code></pre>\n\n<p>(pq is the Go driver that I use)</p>\n\n<p>Using <code>CURRENT_TIMESTAMP</code> also provokes an error. It says that the column <code>current_timestamp</code> does not exist. Using <code>NOW()</code> directly in <code>psql</code> (command line) does not provoke that error and everything works fine.</p>\n\n<p>Any idea on why I can't use <code>NOW()</code> nor <code>CURRENT_TIMESTAMP</code> when sending a query from my Go app?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1446413656, "post_id": 33466375, "comment_id": 54720561, "body": "Isn&#39;t there a way to receive messages without blocking?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1446420446, "post_id": 33466375, "comment_id": 54722497, "body": "@Whiteclaws It is not possible to get data from a network connection without blocking.  You can write a read loop that sends messages to a channel where the receiver on that channel uses select to avoid blocking (see the Gorilla chat example)."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1446407069, "last_edit_date": 1446407069, "creation_date": 1446406719, "answer_id": 33466375, "question_id": 33465788, "link": "https://stackoverflow.com/questions/33465788/go-comparing-everchanging-variable-in-ws-loop/33466375#33466375", "title": "(Go) Comparing everchanging variable in ws loop", "body": "<p>The websocket read methods call the <a href=\"https://godoc.org/net#Conn.Read\" rel=\"nofollow\">network connection Read method</a> to get data from the network. Because the network connection Read method blocks, the webscocket methods also block.</p>\n\n<p>To send pings, use a ticker in the write loop <a href=\"https://github.com/gorilla/websocket/blob/527637c0f38a8035d7856bb758e56f7ee2c704a9/examples/chat/conn.go#L83-L86\" rel=\"nofollow\">as in the Gorilla chat example</a> or run a separate goroutine for pings <a href=\"https://github.com/gorilla/websocket/blob/527637c0f38a8035d7856bb758e56f7ee2c704a9/examples/command/main.go#L75-L88\" rel=\"nofollow\">as in Gorilla command example</a>.</p>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 33466375, "answer_count": 1, "score": 2, "last_activity_date": 1446407069, "creation_date": 1446403319, "last_edit_date": 1446405771, "question_id": 33465788, "link": "https://stackoverflow.com/questions/33465788/go-comparing-everchanging-variable-in-ws-loop", "title": "(Go) Comparing everchanging variable in ws loop", "body": "<p>Working on a loop that receives messages and processes them accordingly, basically a websocket echo-er with keep-alives and authentication, and I've been stuck in the keep-alive part for a little while now.</p>\n\n<p>The concept is simple, when the server starts I create a goroutine with a ticker, and I initialize a uint64 pointer, each time that ticker ticks (every 2 seconds), I increment the pointer with atomic.AddUint64(clockTicks, 1), then for each websocket connection goroutine, I check the variable every tick with a compare and atomic.LoadUint64(clockTicks), and I send a ping/pong message.</p>\n\n<p>Edit: Seems like something is blocking the for loop until a message is received, result:</p>\n\n<pre><code>i := atomic.LoadUint64(clockTicks)\n    if i != cur {\n        cur = i\n        if act != true {\n            fmt.Println(\"Quit Nao U filthy bot.\")\n            return\n        } else {\n            fmt.Println(\"Keep Going.\")\n            act = false\n        }\n    }\n</code></pre>\n\n<p>In this snippet, i := atomic.LoadUint64(clockTicks) &amp; all the if block only runs when i message is sent (Prints \"Keep Going.\" on msg), which is not what I want, I want the snippet to run every for iteration, and \"Keep Going.\" &amp; \"Quit nao ...\" to trigger everytime clockTicks is incremented</p>\n\n<p>Here's the important code parts, I'm using Go and Gorilla's Websockets library:</p>\n\n<pre><code>func Clock() {\nclockTicks = new(uint64)\n*clockTicks = 0\nclock := time.NewTicker(authIntervals).C\nfor {\n    &lt;-clock\n    atomic.AddUint64(clockTicks, 1)\n}\n}\n\nvar wsu = websocket.Upgrader{\nReadBufferSize:  1024,\nWriteBufferSize: 1024,\nCheckOrigin:     OriginHandler,\n}\n\nfunc serveWS(w http.ResponseWriter, r *http.Request) {\nif r.Method != \"GET\" {\n    http.Error(w, \"Method not allowed\", 405)\n    return\n}\n\nws, err := wsu.Upgrade(w, r, nil)\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\ndefer ws.Close()\ncur := atomic.LoadUint64(clockTicks)\nvar act, val = true, false\nfor {\n    i := atomic.LoadUint64(clockTicks)\n    if i != cur { /* Only triggers when I receive a msg */\n        cur = i\n        if act != true {\n            fmt.Println(\"Quit Nao U filthy bot.\")\n            return\n        } else {\n            fmt.Println(\"Keep Going.\")\n            act = false\n        }\n    }\n\n    mtype, p, err := ws.ReadMessage()\n    if err != nil {\n        return\n    }\n\n    ...\n\n}\n</code></pre>\n\n<p>Edit 2: Someone in IRC suggested that maybe ws.ReadMessage is blocking, but I'm not really sure (He says ioutil.ReadAll used in ws.ReadMessage implementation is blocking it, and he's pretty sure about it)</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "is_accepted": false, "score": 1, "last_activity_date": 1446399574, "creation_date": 1446399574, "answer_id": 33465126, "question_id": 33465099, "link": "https://stackoverflow.com/questions/33465099/how-to-cleanup-the-development-datastore/33465126#33465126", "title": "How to cleanup the development datastore?", "body": "<p>I don't know about Go, but in Java you can simply delete local_db.bin from <code>WEB-INF/appengine-generated</code> folder. An empty file will be created next time you run the app.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1446402587, "last_edit_date": 1446402587, "creation_date": 1446402201, "answer_id": 33465590, "question_id": 33465099, "link": "https://stackoverflow.com/questions/33465099/how-to-cleanup-the-development-datastore/33465590#33465590", "title": "How to cleanup the development datastore?", "body": "<p>Simply provide the <code>--clear_datastore</code> command line parameter when starting:</p>\n\n<pre><code>goapp serve --clear-datastore\n</code></pre>\n\n<p>Documented at: <a href=\"https://cloud.google.com/appengine/docs/go/tools/devserver#Go_Using_the_Datastore\" rel=\"nofollow\">The Go Development Server: Using the Datastore</a>.</p>\n\n<blockquote>\n  <p>To clear the local datastore for an application, use the <code>--clear_datastore=yes</code> option when you start the web server:</p>\n</blockquote>\n\n<p>Note that the documentation was \"copied\" from the Python section, you need to use it as presented above (you get an error if you try to execute <code>goapp serve --clear_datastore=yes</code>).</p>\n"}], "owner": {"reputation": 80782, "user_id": 48465, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3d575ee50a8388454791b5f8e2841ba2?s=128&d=identicon&r=PG", "display_name": "Jader Dias", "link": "https://stackoverflow.com/users/48465/jader-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 33465590, "answer_count": 2, "score": 2, "last_activity_date": 1446402587, "creation_date": 1446399431, "question_id": 33465099, "link": "https://stackoverflow.com/questions/33465099/how-to-cleanup-the-development-datastore", "title": "How to cleanup the development datastore?", "body": "<p>In Google App Engine Go SDK sometimes we can fill the local datastore with a bunch of test data. It's tiring to delete thousands of records 20 at a time using the web interface. Is there a command the erases the local datastore?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "is_accepted": true, "score": 3, "last_activity_date": 1519673334, "creation_date": 1519673334, "answer_id": 48995751, "question_id": 33461486, "link": "https://stackoverflow.com/questions/33461486/storing-sql-result-sets-in-a-nested-struct-and-omit-if-empty/48995751#48995751", "title": "Storing Sql result sets in a nested struct and omit if empty", "body": "<p>Assuming <code>gin</code> uses <code>encoding/json</code> under the covers, if you want to omit an empty <code>Profile</code>, I believe you need it to be a pointer in <code>User</code>:</p>\n\n<pre><code>type User struct {\n    ....\n    Profile *Profile `json:\",omitempty\"`\n}\n</code></pre>\n\n<p>Note the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>The \"omitempty\" option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.</p>\n</blockquote>\n\n<p>It doesn't say that the zero value of a struct will be detected.</p>\n\n<p>That will leave you with some issues scanning your data from the db.  You could declare a <code>Profile</code>, scan into it, compare to the zero profile and assign it to the <code>User</code> if it has data:</p>\n\n<pre><code>var user User\nvar profile Profile\n_ = stmt.Scan(&amp;user.Id, &amp;user.Username, &amp;user.Email, &amp;profile.Firstname, &amp;profile.Lastname)\nif profile != Profile{} {\n    user.Profile = &amp;profile\n}\n</code></pre>\n\n<p>I suspect that's not the most elegant solution, but I hope it's the right direction.</p>\n"}], "owner": {"reputation": 971, "user_id": 2202757, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/U5NGN.jpg?s=128&g=1", "display_name": "sh0umik", "link": "https://stackoverflow.com/users/2202757/sh0umik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4395, "favorite_count": 1, "accepted_answer_id": 48995751, "answer_count": 1, "score": 8, "last_activity_date": 1568880674, "creation_date": 1446375842, "last_edit_date": 1568880674, "question_id": 33461486, "link": "https://stackoverflow.com/questions/33461486/storing-sql-result-sets-in-a-nested-struct-and-omit-if-empty", "title": "Storing Sql result sets in a nested struct and omit if empty", "body": "<p>I am trying to store SQL query dataset in a struct and display in JSON. I have almost done it. Now the problem is if the result set of nested structs is empty then I would not like to display it. </p>\n\n<p>Same problem <a href=\"https://stackoverflow.com/questions/33447334/golang-json-marshal-how-to-omit-empty-nested-struct\">specified here</a> but using a pointer ends in a panic when scanning may be because I am using <code>&amp;user.Profile.Firstname</code></p>\n\n<blockquote>\n  <p>2015/11/01 16:42:16 Panic recovery -> runtime error: invalid memory address or nil pointer dereference</p>\n</blockquote>\n\n<p>If I remove the pointer then everything works fine just the empty field remains. I am confused how to achieve this.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"github.com/gin-gonic/gin\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"log\"\n)\n\ntype User struct {\n    Id       int64\n    Username string\n    Email    string\n    Profile  Profile `json:\",omitempty\"`\n}\n\ntype Profile struct {\n    Id        int64  `json:\",omitempty\"`\n    UserId    int64  `json:\",omitempty\"`\n    Firstname *string `json:\",omitempty\"`\n    Lastname  *string `json:\",omitempty\"`\n}\n\nvar DB *sql.DB\n\nfunc checkErr(err error, msg string) {\n    if err != nil {\n        log.Fatal(msg, err)\n    }\n}\n\nfunc main() {\n    DB, _ = sql.Open(\"mysql\", \"username:secrect@/database\")\n    defer DB.Close()\n\n    r := gin.Default()\n    v1 := r.Group(\"api/v1/\")\n    {\n        v1.GET(\"users\", GetUsers)\n    }\n    r.Run(\":8080\")\n}\n\n\nfunc GetUsers(c *gin.Context) {\n    stmt, err := DB.Query(\"Select users.id, username , email , firstname , lastname from users left join profiles on users.id = profiles.user_id \")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer stmt.Close()\n\n    users := []User{}\n\n    for stmt.Next() {\n        var user User\n        err := stmt.Scan(&amp;user.Id, &amp;user.Username, &amp;user.Email, &amp;user.Profile.Firstname, &amp;user.Profile.Lastname)\n        if err != nil {\n            panic(err.Error())\n        }\n\n        users = append(users, user)\n    }\n\n    c.JSON(200, &amp;users)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>{\n  \"Id\": 1,\n  \"Username\": \"test1\",\n  \"Email\": \"test1@example.com\",\n  \"Profile\": {\n    \"Firstname\": \"John\",\n    \"Lastname\": \"Doe\"\n  }\n},\n{\n  \"Id\": 2,\n  \"Username\": \"test2\",\n  \"Email\": \"test2@example.com\",\n  \"Profile\": {\n  }\n},\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 5008, "user_id": 2088822, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c96b4e7fa4e410b2df9513f79cffd0fe?s=128&d=identicon&r=PG", "display_name": "afsantos", "link": "https://stackoverflow.com/users/2088822/afsantos"}, "edited": false, "score": 0, "creation_date": 1446369989, "post_id": 33460672, "comment_id": 54707669, "body": "This question might be relevant <a href=\"http://stackoverflow.com/q/18405023\">stackoverflow.com/q/18405023</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 11, "last_activity_date": 1446369856, "creation_date": 1446369856, "answer_id": 33460757, "question_id": 33460672, "link": "https://stackoverflow.com/questions/33460672/simple-method-for-limiting-concurrency-in-go/33460757#33460757", "title": "Simple method for limiting concurrency in Go", "body": "<p>A producer-consumers pattern: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"os\"\n    \"sync\"\n\n    \"github.com/parnurzeal/gorequest\"\n)\n\nconst workersCount = 16\n\nfunc getUrlWorker(urlChan chan string) {\n    for url := range urlChan {\n        request := gorequest.New()\n        resp, body, errs := request.Get(url).End()\n        _ = resp\n        _ = body\n        _ = errs\n    }\n}\n\nfunc main() {\n    csvfile, err := os.Open(\"urls.csv\")\n    if err != nil {\n        panic(err)\n    }\n    defer csvfile.Close()\n\n    reader := csv.NewReader(csvfile)\n    reader.FieldsPerRecord = -1\n    rawCSVdata, err := reader.ReadAll()\n\n    var wg sync.WaitGroup\n    urlChan := make(chan string)\n\n    wg.Add(workersCount)\n\n    for i := 0; i &lt; workersCount; i++ {\n        go func() {\n            getUrlWorker(urlChan)\n            wg.Done()\n        }()\n    }\n\n    completed := 0\n    for _, each := range rawCSVdata {\n        urlChan &lt;- each[1]\n        completed++\n    }\n    close(urlChan)\n\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 697, "user_id": 962019, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/f2871326f312acbaa39d9d0dda4d3aa0?s=128&d=identicon&r=PG", "display_name": "ewhitt", "link": "https://stackoverflow.com/users/962019/ewhitt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1378, "favorite_count": 0, "accepted_answer_id": 33460757, "answer_count": 1, "score": 8, "last_activity_date": 1446369856, "creation_date": 1446369029, "question_id": 33460672, "link": "https://stackoverflow.com/questions/33460672/simple-method-for-limiting-concurrency-in-go", "title": "Simple method for limiting concurrency in Go", "body": "<p>I have a CSV file with ~10k URLs I need to HTTP get.  What is the simplest way to limit the concurrency of Go routines to no more than 16 at a time?</p>\n\n<pre><code>func getUrl(url string) {\n    request := gorequest.New()\n    resp, body, errs := request.Get(each[1]).End()\n    _ = resp\n    _ = body\n    _ = errs\n}\n\nfunc main() {\n\n    csvfile, err := os.Open(\"urls.csv\")\n    defer csvfile.Close()\n    reader := csv.NewReader(csvfile)\n    reader.FieldsPerRecord = -1 \n    rawCSVdata, err := reader.ReadAll()\n\n    completed := 0\n    for _, each := range rawCSVdata {\n        go getUrl(each[1])\n        completed++\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "mongodb", "go"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1446455005, "post_id": 33460559, "comment_id": 54733165, "body": "According to jsonlint the json is not valid. Should be  {     &quot;_id&quot;: ObjectId(&quot;55c&quot;),     &quot;Sport&quot;: &quot;Athletics &quot;,     &quot;Athletics&quot;: [         &quot;Men&#39;s Individual&quot;,         &quot;Women&#39;s Individual&quot;,         &quot;Mixed Relay&quot;     ] }  How do you create the json. Is it a different application that produce the documents?"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1446456789, "post_id": 33460559, "comment_id": 54734194, "body": "Not answering you question, but may help  <a href=\"http://play.golang.org/p/2REBpnTkSh\" rel=\"nofollow noreferrer\">play.golang.org/p/2REBpnTkSh</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 2, "last_activity_date": 1446371546, "creation_date": 1446371546, "answer_id": 33460949, "question_id": 33460559, "link": "https://stackoverflow.com/questions/33460559/how-to-deal-with-inconsistent-json-fields-in-documents/33460949#33460949", "title": "how to deal with inconsistent json fields in documents", "body": "<p>You can do that using <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow\"><code>json.RawMessage</code></a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    type Color struct {\n        Space string\n        Point json.RawMessage // delay parsing until we know the color space\n    }\n    type RGB struct {\n        R uint8\n        G uint8\n        B uint8\n    }\n    type YCbCr struct {\n        Y  uint8\n        Cb int8\n        Cr int8\n    }\n\n    var j = []byte(`[\n        {\"Space\": \"YCbCr\", \"Point\": {\"Y\": 255, \"Cb\": 0, \"Cr\": -10}},\n        {\"Space\": \"RGB\",   \"Point\": {\"R\": 98, \"G\": 218, \"B\": 255}}\n    ]`)\n    var colors []Color\n    err := json.Unmarshal(j, &amp;colors)\n    if err != nil {\n        log.Fatalln(\"error:\", err)\n    }\n\n    for _, c := range colors {\n        var dst interface{}\n        switch c.Space {\n        case \"RGB\":\n            dst = new(RGB)\n        case \"YCbCr\":\n            dst = new(YCbCr)\n        }\n        err := json.Unmarshal(c.Point, dst)\n        if err != nil {\n            log.Fatalln(\"error:\", err)\n        }\n        fmt.Println(c.Space, dst)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 436, "user_id": 5511980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0174993a67ce7b3ad2bcb2f12e135661?s=128&d=identicon&r=PG&f=1", "display_name": "W. Cybriwsky", "link": "https://stackoverflow.com/users/5511980/w-cybriwsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1446431786, "creation_date": 1446431786, "answer_id": 33469903, "question_id": 33460559, "link": "https://stackoverflow.com/questions/33460559/how-to-deal-with-inconsistent-json-fields-in-documents/33469903#33469903", "title": "how to deal with inconsistent json fields in documents", "body": "<p>I'd agree with the little voice telling you to go with \"Sub-Category\" instead of trying to deal with inconsistent types. Also, you should combine the 'mens' and 'womens' subcategories in Swimming similar to how you do it it in Tennis and Athletics. This will let you make better use of encoding/json's (and mgo/bson's) mapping features, but I wouldn't call it a 'backend language' problem - consistent data types should make your js (and other client code) nicer, too!</p>\n"}], "owner": {"reputation": 707, "user_id": 5428494, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5075ba00acc4f6068e8923f60f514eca?s=128&d=identicon&r=PG&f=1", "display_name": "Scott", "link": "https://stackoverflow.com/users/5428494/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1446431786, "creation_date": 1446367876, "question_id": 33460559, "link": "https://stackoverflow.com/questions/33460559/how-to-deal-with-inconsistent-json-fields-in-documents", "title": "how to deal with inconsistent json fields in documents", "body": "<p>I currently have a large JSON file which has to be stored in the backend (mongodb &amp; Go) and consumed in the front end. I was wondering whether the 3rd field of the documents should be something like \"Sub category\" instead of the sport name from the 2nd field or whether this is possible as I was thinking this maybe hard to model and deserialise in a backend language due to inconsistency? </p>\n\n<p>sample:</p>\n\n<pre><code>{\n  \"_id\" : ObjectId(\"55c\"),\n  \"Sport\" : \"Athletics \",\n  \"Athletics\" : {\n    [\"Men's Individual\", \"Women's Individual\", \"Mixed Relay\"]\n   }\n}\n\n{\n  \"_id\" : ObjectId(\"56c\"),\n  \"Sport\" : \"Tennis\",\n  \"Tennis\" : [\"Men's singles\", \"Women's singles\", \"Men's doubles\", \"Women's doubles\", \"Mixed doubles\"]\n}\n\n{\n  \"_id\" : ObjectId(\"57c\"),\n  \"Sport\" : \"Swimming\",\n  \"Swimming\" : {\n    \"Men\" : [\"4\u00d7100 m relay\", \"4\u00d7200 m freestyle relay\"],\n    \"Women\" : [\"4\u00d7100 m relay\", \"4\u00d7200 m freestyle relay\"]\n  }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 5511597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129a52a845b4ba1eadc57edf81af5813?s=128&d=identicon&r=PG&f=1", "display_name": "VM7", "link": "https://stackoverflow.com/users/5511597/vm7"}, "edited": false, "score": 1, "creation_date": 1446353262, "post_id": 33459174, "comment_id": 54704972, "body": "Ah so each iteration of the loop is a new scope.  <a href=\"http://stackoverflow.com/questions/7880658/what-is-the-scope-of-a-while-and-for-loop\" title=\"what is the scope of a while and for loop\">stackoverflow.com/questions/7880658/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": true, "score": 4, "last_activity_date": 1446351489, "creation_date": 1446351489, "answer_id": 33459174, "question_id": 33458547, "link": "https://stackoverflow.com/questions/33458547/go-variable-scope-and-shadowing/33459174#33459174", "title": "go variable scope and shadowing", "body": "<p><code>:=</code> operator creates a new variable and assigns the right hand side value to it.  </p>\n\n<p>At the first iteration of the for loop, in the step <code>x := x[i]</code>, the only <code>x</code> the right hand side sees is the <code>x</code> defined in the step <code>x := \"hello!\"</code>. As far as the right hand side sees <code>x</code> is not redeclared yet.  </p>\n\n<blockquote>\n  <p>As soon as you redeclare x in an inner block..</p>\n</blockquote>\n\n<p>It <em>is</em> not yet. Its redeclared only after <code>x := x[i]</code>. </p>\n\n<p>And at the end of the iteration the new <code>x</code>'s scope ends. It is not reused in a new iteration.</p>\n\n<p>When a new iteration happens its the same thing all over again.</p>\n"}], "owner": {"reputation": 45, "user_id": 5511597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129a52a845b4ba1eadc57edf81af5813?s=128&d=identicon&r=PG&f=1", "display_name": "VM7", "link": "https://stackoverflow.com/users/5511597/vm7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "accepted_answer_id": 33459174, "answer_count": 1, "score": 2, "last_activity_date": 1446351489, "creation_date": 1446343770, "last_edit_date": 1446345975, "question_id": 33458547, "link": "https://stackoverflow.com/questions/33458547/go-variable-scope-and-shadowing", "title": "go variable scope and shadowing", "body": "<p>This is an example from GOPL - \"The expressions x[i] and x + 'A' - 'a' each refer to a declaration of x from an outer block; we'll explain this in a moment.\"</p>\n\n<p>The explanation never comes. Why is x[i] referring to the x in the outer scope? As soon as you redeclare x in an inner block it should shadow the x in the outer block. Why does this work?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := \"hello!\"\n    for i := 0; i &lt; len(x); i++ {\n        x := x[i]\n        if x != '!' {\n            x := x + 'A' - 'a'\n            fmt.Printf(\"%c\", x)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/NQxfkTeGzA\" rel=\"nofollow\">http://play.golang.org/p/NQxfkTeGzA</a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 5, "last_activity_date": 1446359487, "creation_date": 1446359487, "answer_id": 33459826, "question_id": 33458439, "link": "https://stackoverflow.com/questions/33458439/using-sql-nullfloat64-vs-float64-in-golang/33459826#33459826", "title": "Using sql.NullFloat64 vs *float64 in Golang?", "body": "<p>From <a href=\"https://github.com/rsc\" rel=\"noreferrer\">Russ Cox</a> (biggest Go's contributor according to Github) : <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/vOTFu2SMNeA\" rel=\"noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/vOTFu2SMNeA</a></p>\n\n<blockquote>\n  <p>There's no effective difference. We thought people might want to use NullString because it is so common and perhaps expresses the intent more clearly than *string. But either will work.</p>\n</blockquote>\n\n<p>I'm thinking though that using a pointer might give the GC one more thing to track. It probably depends on the usage.</p>\n\n<p>On some very simple code, using <code>-gcflags=-m</code> to build, the escape analysis does say that <code>new(float64) escapes to heap</code> (here is the dummy code I used: <a href=\"https://play.golang.org/p/K4sQaXyQKG\" rel=\"noreferrer\">https://play.golang.org/p/K4sQaXyQKG</a>).</p>\n\n<p>Also, when debugging, printing a struct containing a <code>sql.NullSomething</code> (<code>{value:{Float64:1 Valid:true}}</code>) looks better than a struct containing a pointer (<code>{value:0xc82000a420}</code>).</p>\n\n<p>So I'd recommend the usage of the <code>sql.Null*</code> structs.</p>\n"}], "owner": {"reputation": 10776, "user_id": 749477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6845c6b2318e02258cc1dc56fe620482?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/749477/derek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1502, "favorite_count": 0, "accepted_answer_id": 33459826, "answer_count": 1, "score": 4, "last_activity_date": 1446371065, "creation_date": 1446342368, "last_edit_date": 1446343343, "question_id": 33458439, "link": "https://stackoverflow.com/questions/33458439/using-sql-nullfloat64-vs-float64-in-golang", "title": "Using sql.NullFloat64 vs *float64 in Golang?", "body": "<p>I'm using <code>gorm</code> to define my db table schema.  Noticed that <code>gorm</code> itself uses <code>time.Time</code> for <code>created_at</code> and <code>*time.Time</code> for <code>deleted_at</code>.  I'm assuming this is because <code>deleted_at</code> has cases of being <code>NULL</code>.</p>\n\n<p>I also noticed that for many Golang ORMs they use <code>sql.NullFloat64</code> for storing db values that could be a <code>float64</code> or <code>NULL</code>.  Why not just use <code>*float64</code> instead of <code>sql.NullFloat64</code>? What's the difference?</p>\n\n<pre><code>type Geo struct {\n    latitude *float64\n    longitude sql.NullFloat64\n}\n// What is the difference between latitude and longitude in this case?\n</code></pre>\n"}, {"tags": ["go", "interface", "type-switch"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 4, "last_activity_date": 1446341492, "creation_date": 1446341492, "answer_id": 33458360, "question_id": 33458247, "link": "https://stackoverflow.com/questions/33458247/how-do-i-use-type-switch-on-struct-fields-when-field-is-of-interface-type/33458360#33458360", "title": "How do I use type switch on struct fields (when field is of interface type)?", "body": "<p>Maybe this gets you where you want to go?</p>\n\n<pre><code>func main() {\n    var rr SS\n    typ := reflect.TypeOf(rr)\n    TTType := reflect.TypeOf(TT{})\n    IIType := reflect.TypeOf((*II)(nil)).Elem() // Yes, this is ugly.\n\n    for ii := 0; ii &lt; typ.NumField(); ii++ {\n        fv := typ.Field(ii)\n        ft := fv.Type\n        switch {   \n        case ft == TTType:\n            fmt.Printf(\"TT: %s\\n\", ft.Name())\n        case ft.Implements(IIType):\n            fmt.Printf(\"II: %s\\n\", ft.Name())\n        default:\n            fmt.Printf(\"??: %s %s\\n\", ft.Kind(), ft.Name())\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1150, "favorite_count": 0, "accepted_answer_id": 33458360, "answer_count": 1, "score": 4, "last_activity_date": 1446341492, "creation_date": 1446340027, "question_id": 33458247, "link": "https://stackoverflow.com/questions/33458247/how-do-i-use-type-switch-on-struct-fields-when-field-is-of-interface-type", "title": "How do I use type switch on struct fields (when field is of interface type)?", "body": "<p>See: <a href=\"http://play.golang.org/p/GDCasRwYOp\" rel=\"nofollow\">http://play.golang.org/p/GDCasRwYOp</a></p>\n\n<p>I have a need to do things based on the type of the struct fields.</p>\n\n<p>The following does not work when a field is of interface type.</p>\n\n<p>I think I get why this is not working. But is there a way to do what I want to do?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype TT struct {\n    Foo int\n}\n\ntype II interface {\n    Bar(int) (int, error)\n}\n\ntype SS struct {\n    F1 TT\n    F2 II\n}\n\nfunc main() {\n    var rr SS\n    value := reflect.ValueOf(rr)\n    for ii := 0; ii &lt; value.NumField(); ii++ {\n        fv := value.Field(ii)\n        xv := fv.Interface()\n        switch vv := xv.(type) {\n        default:\n            fmt.Printf(\"??: vv=%T,%v\\n\", vv, vv)\n        case TT:\n            fmt.Printf(\"TT: vv=%T,%v\\n\", vv, vv)\n        case II:\n            fmt.Printf(\"II: vv=%T,%v\\n\", vv, vv)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["tcp", "go", "network-programming"], "answers": [{"tags": [], "owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "is_accepted": false, "score": 2, "last_activity_date": 1446327353, "creation_date": 1446327353, "answer_id": 33456878, "question_id": 33456819, "link": "https://stackoverflow.com/questions/33456819/allow-golang-through-windows-firewall-for-testing-purposes/33456878#33456878", "title": "Allow golang through Windows firewall for testing purposes", "body": "<p>I actually just fixed this. Apparently I needed to open the UDP ports as well.</p>\n"}], "owner": {"reputation": 489, "user_id": 3780993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9ad160badab2c6f405426f4e2a281fe?s=128&d=identicon&r=PG&f=1", "display_name": "ragesalmon", "link": "https://stackoverflow.com/users/3780993/ragesalmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1273, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1446327353, "creation_date": 1446326864, "question_id": 33456819, "link": "https://stackoverflow.com/questions/33456819/allow-golang-through-windows-firewall-for-testing-purposes", "title": "Allow golang through Windows firewall for testing purposes", "body": "<p>I'm trying to test some go code that starts a simple TCP server and makes a connection using</p>\n\n<pre><code>net.Listen(\"tcp\", \"localhost:8686\")\n</code></pre>\n\n<p>I've tried creating rules in the Firewall application to allow all connections, both inbound and outbound, via TCP, but my tests still fail and I'm being prompted to allow it through the firewall each time it runs.</p>\n"}, {"tags": ["go", "negroni"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1446422505, "post_id": 33455072, "comment_id": 54722972, "body": "Yep, this is the way to go and how I&#39;ve done it for my Ember (and now React) applications. You can additionally mount a separate router/mux for your <code>&#47;api</code> routes and configure your <code>NotFoundHandler</code> there to write out a 404 with a JSON body for any <code>&#47;api&#47;&lt;xxxxx&gt;</code> routes that don&#39;t exist."}, {"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1446425376, "post_id": 33455072, "comment_id": 54723768, "body": "Be sure to new routers in this case. A <code>Router</code> returned by a <code>Subrouter()</code> function call will not call a <code>NotFoundHandler</code> added to that Subrouter."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 4, "last_activity_date": 1446315969, "creation_date": 1446315969, "answer_id": 33455072, "question_id": 33454383, "link": "https://stackoverflow.com/questions/33454383/serving-index-file-when-route-not-found-under-negroni/33455072#33455072", "title": "Serving index file when route not found under Negroni", "body": "<p>The <a href=\"https://github.com/gorilla/mux/blob/master/mux.go#L40\" rel=\"nofollow\"><code>Router</code></a> type in the mux library has a <code>NotFoundHandler</code> field of type <code>http.Handler</code>. This would allow you to handle a unmatched route as you see fit: </p>\n\n<pre><code>// NotFoundHandler overrides the default not found handler\nfunc NotFoundHandler(w http.ResponseWriter, r *http.Request) {\n    // You can use the serve file helper to respond to 404 with\n    // your request file.\n\n    http.ServeFile(w, r, \"public/index.html\")\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.NotFoundHandler = http.HandlerFunc(NotFoundHandler)\n\n    // Register other routes or setup negroni\n\n    log.Fatal(http.ListenAndServe(\":8080\", r))\n} \n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 1016973, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17ae6cdbb491ee66aa63d39d7cf5dcbe?s=128&d=identicon&r=PG", "display_name": "Kyle Goodwin", "link": "https://stackoverflow.com/users/1016973/kyle-goodwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 0, "accepted_answer_id": 33455072, "answer_count": 1, "score": 1, "last_activity_date": 1446315969, "creation_date": 1446312116, "question_id": 33454383, "link": "https://stackoverflow.com/questions/33454383/serving-index-file-when-route-not-found-under-negroni", "title": "Serving index file when route not found under Negroni", "body": "<p>I am using Golang, Negroni, and Gorilla mux for a web api server.  I have my api routes under /api and I am using Negroni to serve static files from my /public directory using urls under /.  I would like to serve my index.html file (containing a single page javascript application) not only if it is requested by name or as the index file, but also if the request would otherwise result in a 404 because it doesn't correspond to a route or a file in the /public directory.  This is so that those URLs will load the webapp which will transition to the correct route (client side javascript history/pushState) or else give a not found error if that resource doesn't exist.  Is there a way to get Negroni's static middleware or Gorilla mux to do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 11, "creation_date": 1446302186, "post_id": 33452726, "comment_id": 54692204, "body": "This is known, valid behaviour. The <code>ls</code> program uses the <code>isatty</code> C function to choose the default output format. When you use <code>io.MultiWriter</code>, <code>isatty</code>  returns 0, so the output format of <code>ls</code> is different."}, {"owner": {"reputation": 1305, "user_id": 1481508, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ac7d313ac9da713c9b9b0c77b59c0241?s=128&d=identicon&r=PG&f=1", "display_name": "boh", "link": "https://stackoverflow.com/users/1481508/boh"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1446433549, "post_id": 33452726, "comment_id": 54725713, "body": "@TimCooper is there any straightforward way to make a writer in go behave like a tty? I google a bit and find out pty but don&#39;t really know how it works."}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1446621151, "post_id": 33452726, "comment_id": 54813737, "body": "@boh: why not do things the other way around and force <code>ls</code> to use the desired output format regardless of the output capabilities? Try <code>ls -x</code>, <code>ls -C</code> or <code>ls -1</code>"}, {"owner": {"reputation": 1305, "user_id": 1481508, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ac7d313ac9da713c9b9b0c77b59c0241?s=128&d=identicon&r=PG&f=1", "display_name": "boh", "link": "https://stackoverflow.com/users/1481508/boh"}, "reply_to_user": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 1, "creation_date": 1446621207, "post_id": 33452726, "comment_id": 54813762, "body": "@wldsvc <code>ls</code> is an example of some arbitrary commands"}], "answers": [{"tags": [], "owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "is_accepted": true, "score": 3, "last_activity_date": 1447799855, "creation_date": 1447799855, "answer_id": 33768428, "question_id": 33452726, "link": "https://stackoverflow.com/questions/33452726/golang-difference-between-os-stdout-and-multiwriter/33768428#33768428", "title": "golang - difference between os.stdout and multiwriter", "body": "<p>Based on comments by @Time and @wldsvc</p>\n\n<p>The cause of the problem is that <code>isatty</code> is used by <code>ls</code> to choose the default output format, in this case the use of <code>io.MultiWriter</code> and <code>os.Stdout</code> result in different decisions based on the result of <code>isatty</code>.</p>\n\n<p>The proposed solution was to force the output format of <code>ls</code> by use of the parameters (<a href=\"http://linuxcommand.org/man_pages/ls1.html\" rel=\"nofollow\">man ls</a>):</p>\n\n<pre><code>-C  list by columns\n-x  list by lines instead of columns\n-1  list one file per line\n</code></pre>\n\n<p>(documenting answer as show quiet high on unanswered list)</p>\n"}], "owner": {"reputation": 1305, "user_id": 1481508, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ac7d313ac9da713c9b9b0c77b59c0241?s=128&d=identicon&r=PG&f=1", "display_name": "boh", "link": "https://stackoverflow.com/users/1481508/boh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1647, "favorite_count": 1, "accepted_answer_id": 33768428, "answer_count": 1, "score": 8, "last_activity_date": 1447799855, "creation_date": 1446301960, "question_id": 33452726, "link": "https://stackoverflow.com/questions/33452726/golang-difference-between-os-stdout-and-multiwriter", "title": "golang - difference between os.stdout and multiwriter", "body": "<p>I have this code to run <code>zsh</code> and log its output to an output file.</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n\n    cmd := exec.Command(\"zsh\")\n    f, _ := os.Create(\"log.txt\")\n    multiWriter := io.MultiWriter(os.Stdout, f)\n    cmd.Stdout = multiWriter\n    cmd.Stderr = os.Stderr\n    cmd.Stdin = os.Stdin\n    cmd.Run()\n}    \nfunc haltOnError(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>when the program executes, typing <code>ls</code> will output </p>\n\n<pre><code>foo\nbar\n</code></pre>\n\n<p>while if I let <code>cmd.Stdout = os.Stdout</code>, it displays correctly as </p>\n\n<pre><code>foo    bar\n</code></pre>\n\n<p>What leads to the differences between <code>os.Stdout</code> and <code>multiwriter</code>?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1446309829, "post_id": 33453345, "comment_id": 54694648, "body": "Thanks for answer but I am confused how is this propagated back to Mongo, model does not have any Save method ( like in SQLAlchemy, I worked in Python, in Go I am newbee)"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "reply_to_user": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1446312669, "post_id": 33453345, "comment_id": 54695543, "body": "It is because it is not a &quot;model&quot; in the sense of SQLAlchemy. It is just the representation of the MongoDB document in memory. In order to save the changes, you need to explicitly write the document back to MongoDB, using Collection.Update or Collection.UpdateId. Note that if you read the document, update it in memory, and save it back to MongoDB, the whole operation is not atomic."}, {"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1446313694, "post_id": 33453345, "comment_id": 54695909, "body": "I understand is not atomic but I cannot update with this validation in atomic way if my data are nested in array ( I know for fields which are not arrays, for example Score from Player ) but I am not sure if there is a way to do in atomic way with nested array with validation"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "reply_to_user": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1446453336, "post_id": 33453345, "comment_id": 54732359, "body": "I did not find a way to do it directly without changing the model (and getting rid of the array), But it can still be done in two steps (read+write) and using optimistic concurrency control (i.e. add a version number in your document that is checked at write time)."}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": false, "score": 3, "last_activity_date": 1446305663, "creation_date": 1446305663, "answer_id": 33453345, "question_id": 33451473, "link": "https://stackoverflow.com/questions/33451473/how-to-update-array-inside-go-model-for-mongo/33453345#33453345", "title": "How to update array inside Go model for Mongo", "body": "<p>If this is just about updating a data structure in memory (whether it maps a MongoDB document or not), a naive algorithm can be applied, such as:</p>\n\n<pre><code>func (p *PlayerModel) updateLevel(idx int, time int64) {\n    for i := range p.Level {\n        lm := &amp;(p.Level[i])\n        if lm.Index == idx {\n            if time &lt; lm.Time {\n                lm.Time = time\n            }\n            return\n        }\n    }\n    p.Level = append(p.Level, LevelModel{idx, time})\n}\n</code></pre>\n\n<p>See an example at: <a href=\"https://play.golang.org/p/C8SGqkgZ99\" rel=\"nofollow\">https://play.golang.org/p/C8SGqkgZ99</a></p>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1446305663, "creation_date": 1446293840, "question_id": 33451473, "link": "https://stackoverflow.com/questions/33451473/how-to-update-array-inside-go-model-for-mongo", "title": "How to update array inside Go model for Mongo", "body": "<p>I have Player  model in Go for Mongo and model Level</p>\n\n<pre><code>type LevelModel struct {\n    Index           int                 `json: \"index\" bson: \"index\"`\n    Time            int64               `json: \"time\" bson: \"time\"`\n}\n\n\ntype PlayerModel struct {\n    ID              bson.ObjectId       `json: \"_id, omitempty\" bson: \"_id, omitempty\"`\n    Score           int64               `json: \"score\" bson: \"score\"`\n    Level           []LevelModel    `json: \"level\" bson: \"level\"`\n}\n</code></pre>\n\n<p>How to update Level from PlayerModel if I have instance of PlayerModel ( player pointer ) ?\nPlayer can play new ( not yet played ) level ( then insert ) or already played ( just update if time is lower then already achieved for that level ).</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 3, "creation_date": 1446303561, "post_id": 33451037, "comment_id": 54692592, "body": "Typically you don&#39;t put your app itself in the root of your Git Repository."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1446305749, "post_id": 33451037, "comment_id": 54693263, "body": "@0x434D53 is spot on and should write an answer.  There are other benefits to keeping the app out of the root."}], "owner": {"reputation": 80782, "user_id": 48465, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/3d575ee50a8388454791b5f8e2841ba2?s=128&d=identicon&r=PG", "display_name": "Jader Dias", "link": "https://stackoverflow.com/users/48465/jader-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 208, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1446298801, "creation_date": 1446290955, "question_id": 33451037, "link": "https://stackoverflow.com/questions/33451037/how-to-make-goapp-serve-ignore-changes-in-the-git-folder", "title": "How to make `goapp serve` ignore changes in the .git folder?", "body": "<p>When running the development server for Google App Engine Go I read the following console prints:</p>\n\n<pre><code>INFO DATE module.py:427 [default] Detected file changes:\n    .git\n    .git\\logs\\HEAD\n</code></pre>\n\n<p>But that's just noise, how can I suppress that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446295742, "post_id": 33450980, "comment_id": 54690172, "body": "Ofc you use shell-commands to do that and call os.Exec."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 3, "creation_date": 1446297141, "post_id": 33450980, "comment_id": 54690596, "body": "@0x434D53: Shell commands are OS and shell dependent. Use Go package <code>os</code> OS and shell independent functions for portability. For example, I tested my Go solution on Linux and Windows."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1446297281, "post_id": 33450980, "comment_id": 54690634, "body": "Ofc they are. Was just an additional suggestion that might fit his usecase. Had a reason i did not write it as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "edited": false, "score": 0, "creation_date": 1446296959, "post_id": 33451503, "comment_id": 54690529, "body": "thanks for this, I have actually gone with something similar but using <code>ioutil.ReadDir</code> to save opening the dir. Thanks"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "edited": false, "score": 4, "creation_date": 1446415980, "post_id": 33451503, "comment_id": 54721300, "body": "@mattl: That&#39;s not good. For package <code>os</code>, &quot;<a href=\"https://golang.org/pkg/os/#File.Readdirnames\" rel=\"nofollow noreferrer\">Readdirnames</a> reads and returns a slice of names from the directory.&quot; For package <code>ioutil</code>, &quot;<a href=\"https://golang.org/pkg/io/ioutil/#ReadDir\" rel=\"nofollow noreferrer\">ReadDir</a> reads the directory named by dirname and returns a list of sorted directory entries.&quot; Switching from <code>os</code> to <code>ioutil</code>, you added an unnecessary sort of the name list: <a href=\"https://golang.org/src/io/ioutil/ioutil.go\" rel=\"nofollow noreferrer\"><code>func ReadDir</code></a>:  <code>sort.Sort(byName(list))</code>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 42, "last_activity_date": 1446296708, "last_edit_date": 1446296708, "creation_date": 1446294028, "answer_id": 33451503, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang/33451503#33451503", "title": "How to remove all contents of a directory using Golang?", "body": "<p>Write a simple <code>RemoveContents</code> function. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nfunc RemoveContents(dir string) error {\n    d, err := os.Open(dir)\n    if err != nil {\n        return err\n    }\n    defer d.Close()\n    names, err := d.Readdirnames(-1)\n    if err != nil {\n        return err\n    }\n    for _, name := range names {\n        err = os.RemoveAll(filepath.Join(dir, name))\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    dir := strings.TrimSuffix(filepath.Base(os.Args[0]), filepath.Ext(os.Args[0]))\n    dir = filepath.Join(os.TempDir(), dir)\n    dirs := filepath.Join(dir, `tmpdir`)\n    err := os.MkdirAll(dirs, 0777)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    file := filepath.Join(dir, `tmpfile`)\n    f, err := os.Create(file)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    f.Close()\n    file = filepath.Join(dirs, `tmpfile`)\n    f, err = os.Create(file)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    f.Close()\n\n    err = RemoveContents(dir)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "edited": false, "score": 0, "creation_date": 1464624599, "post_id": 37439609, "comment_id": 62550499, "body": "I&#39;m not sure, either it didn&#39;t exist when this question was raised or it does something unexpected."}, {"owner": {"reputation": 1657, "user_id": 842701, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7db418318378c754068efdbd1c121ebb?s=128&d=identicon&r=PG", "display_name": "Lomithrani", "link": "https://stackoverflow.com/users/842701/lomithrani"}, "reply_to_user": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "edited": false, "score": 0, "creation_date": 1464628715, "post_id": 37439609, "comment_id": 62552218, "body": "It most probably existed as he talked about removeall , so it might do something unexpected, but I&#39;d like to know what as I use this method pretty often"}, {"owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "edited": false, "score": 0, "creation_date": 1464712173, "post_id": 37439609, "comment_id": 62590639, "body": "@Lomithrani RemoveAll says that it exits on the first encounter of an error. Individually removing each file would allow you to remove more in a case where multiple errors would be expected. That&#39;s all I could come up with after reading the documentation."}, {"owner": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "edited": false, "score": 7, "creation_date": 1464801756, "post_id": 37439609, "comment_id": 62637367, "body": "oh hang on, I think we were trying to delete the contents of a directory but not the directory itself. As I said at the bottom of my question removeAll removes the parent directory as well. Making the directory again would work but would need to match the current permissions set on it."}, {"owner": {"reputation": 381960, "user_id": 276052, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/UcrhR.jpg?s=128&g=1", "display_name": "aioobe", "link": "https://stackoverflow.com/users/276052/aioobe"}, "edited": false, "score": 8, "creation_date": 1519978840, "post_id": 37439609, "comment_id": 85135346, "body": "This won&#39;t work if you don&#39;t have permission to remove <code>&#47;tmp</code>."}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1605777434, "post_id": 37439609, "comment_id": 114757767, "body": "Unfortunately this is not working if someone else is adding or modifying files inside that directory: <code>unlinkat &#47;tmp&#47;: directory not empty</code>"}, {"owner": {"reputation": 926, "user_id": 5341805, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5ZPCu.png?s=128&g=1", "display_name": "skaldesh", "link": "https://stackoverflow.com/users/5341805/skaldesh"}, "reply_to_user": {"reputation": 381960, "user_id": 276052, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/UcrhR.jpg?s=128&g=1", "display_name": "aioobe", "link": "https://stackoverflow.com/users/276052/aioobe"}, "edited": false, "score": 0, "creation_date": 1605792985, "post_id": 37439609, "comment_id": 114764787, "body": "You must perform a Stat first to retrieve the dirs permissions and later use those to correctly create the dir again. And as @aioobe pointed out, does not work if you have no perm on the dir itself"}, {"owner": {"reputation": 455, "user_id": 3151187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r3v0p.png?s=128&g=1", "display_name": "maxadamo", "link": "https://stackoverflow.com/users/3151187/maxadamo"}, "edited": false, "score": 0, "creation_date": 1606224952, "post_id": 37439609, "comment_id": 114893833, "body": "if we speak about /tmp/ it can be a mount point, or it can be in use by other processes"}], "tags": [], "owner": {"reputation": 1657, "user_id": 842701, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7db418318378c754068efdbd1c121ebb?s=128&d=identicon&r=PG", "display_name": "Lomithrani", "link": "https://stackoverflow.com/users/842701/lomithrani"}, "is_accepted": false, "score": 112, "last_activity_date": 1475092426, "last_edit_date": 1475092426, "creation_date": 1464185179, "answer_id": 37439609, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang/37439609#37439609", "title": "How to remove all contents of a directory using Golang?", "body": "<p>It might be a stupid answer, but why not simply do?</p>\n\n<pre><code>os.RemoveAll(\"/tmp/\")\nos.MkdirAll(\"/tmp/\",FileMode)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "edited": false, "score": 0, "creation_date": 1579640603, "post_id": 52421894, "comment_id": 105831718, "body": "No good. Pattern <code>*</code> doesn&#39;t match hidden files (names starting with a dot, like <code>.config.yaml</code> for example). OP asked to delete all teh contents of a directory."}], "tags": [], "owner": {"reputation": 128, "user_id": 1640888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b004a98592b8394a1d8d5e19a2696782?s=128&d=identicon&r=PG", "display_name": "gaal", "link": "https://stackoverflow.com/users/1640888/gaal"}, "is_accepted": false, "score": 1, "last_activity_date": 1537435964, "creation_date": 1537435964, "answer_id": 52421894, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang/52421894#52421894", "title": "How to remove all contents of a directory using Golang?", "body": "<pre><code>func RemoveContents(dir string) error {\n    files, err := filepath.Glob(filepath.Join(dir, \"*\"))\n    if err != nil {\n        return err\n    }\n    for _, file := range files {\n        err = os.RemoveAll(file)\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": false, "score": 14, "last_activity_date": 1538886358, "creation_date": 1538886358, "answer_id": 52685448, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang/52685448#52685448", "title": "How to remove all contents of a directory using Golang?", "body": "<p>Just use <code>ioutil.ReadDir</code> to get a slice of <code>os.FileInfo</code> types, <em>then</em> iterate through and remove each child item using <code>os.RemoveAll</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n    \"path\"\n)\n\nfunc main() {\n    dir, err := ioutil.ReadDir(\"/tmp\")\n    for _, d := range dir {\n        os.RemoveAll(path.Join([]string{\"tmp\", d.Name()}...))\n    }\n}\n</code></pre>\n\n<p>That way, you are removing only all the child items and <strong>not</strong> the parent <code>/tmp</code> folder itself.  </p>\n\n<p>I have used this pattern many times before (e.g. test logs, etc.).</p>\n"}, {"tags": [], "owner": {"reputation": 3119, "user_id": 124085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8055fe31a58661e58c1e293f98587f0?s=128&d=identicon&r=PG", "display_name": "jsnfwlr", "link": "https://stackoverflow.com/users/124085/jsnfwlr"}, "is_accepted": false, "score": 0, "last_activity_date": 1616107832, "creation_date": 1616107832, "answer_id": 66700227, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang/66700227#66700227", "title": "How to remove all contents of a directory using Golang?", "body": "<p>You could use <code>filepath.Glob()</code> to get a slice of the contents of the folder, then delete everything it returns. This allows you to use <code>/tmp/*</code> to indicate what you want to delete, and could also be used to delete <code>/tmp/*.go</code>, or <code>/tmp/*/*.go</code>, etc.</p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;os&quot;\n    &quot;path/filepath&quot;\n)\n\nfunc RemoveGlob(path string) (err error) {\n    contents, err := filepath.Glob(path)\n    if err != nil {\n        return\n    }\n    for _, item := range contents {\n        err = os.RemoveAll(item)\n        if err != nil {\n            return\n        }\n    }\n    return\n}    \n\nfunc main() {\n    err := RemoveGlob(&quot;/tmp/*&quot;)\n    if err != nil {\n        log.Fatalf(&quot;Error removing files: %+v&quot;, err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1752, "user_id": 691103, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea4126e753944138edbcc88a536269a5?s=128&d=identicon&r=PG", "display_name": "mattl", "link": "https://stackoverflow.com/users/691103/mattl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62762, "favorite_count": 11, "accepted_answer_id": 33451503, "answer_count": 5, "score": 72, "last_activity_date": 1616107832, "creation_date": 1446290630, "last_edit_date": 1544529750, "question_id": 33450980, "link": "https://stackoverflow.com/questions/33450980/how-to-remove-all-contents-of-a-directory-using-golang", "title": "How to remove all contents of a directory using Golang?", "body": "<p>I'm new to Go and can't seem to find a way to delete all the contents of a directory when I don't know the contents.</p>\n\n<p>I've tried:</p>\n\n<pre><code>os.RemoveAll(\"/tmp/*\")\nos.Remove(\"/tmp/*\")\n</code></pre>\n\n<p>but get <code>remove *: no such file or directory</code> or <code>invalid argument</code>.</p>\n\n<p>And of course if you do:</p>\n\n<pre><code>os.RemoveAll(\"/tmp/\")\n</code></pre>\n\n<p>it deletes the <code>tmp</code> directory as well. Which is not what I want.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 256, "user_id": 2159157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c323144a3291bbe0dfc91b4398e4d3?s=128&d=identicon&r=PG", "display_name": "Lobsterman", "link": "https://stackoverflow.com/users/2159157/lobsterman"}, "edited": false, "score": 1, "creation_date": 1569284572, "post_id": 33447334, "comment_id": 102538691, "body": "In case this isn&#39;t working for some people, the comma before omitempty in the struct tag is important. When I left it out, the field was always omitted, even if it was not-nill."}, {"owner": {"reputation": 1589, "user_id": 828551, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1ff40ca7e1f73b526815ad4e1d2e9b7f?s=128&d=identicon&r=PG", "display_name": "russellhoff", "link": "https://stackoverflow.com/users/828551/russellhoff"}, "edited": false, "score": 1, "creation_date": 1602831731, "post_id": 33447334, "comment_id": 113849519, "body": "Just in case anybody run into my issue... Don&#39;t place a space between the comma and omitempty."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 2024780, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/gbjWi.png?s=128&g=1", "display_name": "rrw", "link": "https://stackoverflow.com/users/2024780/rrw"}, "edited": false, "score": 4, "creation_date": 1523524190, "post_id": 33447629, "comment_id": 86599374, "body": "I know this is an old post. But I have a question. If using a pointer is a workaround, what&#39;s the catch?"}, {"owner": {"reputation": 3009, "user_id": 4975090, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/95acff6227d6efe0c2f5fcb265ed9639?s=128&d=identicon&r=PG&f=1", "display_name": "sdfsdf", "link": "https://stackoverflow.com/users/4975090/sdfsdf"}, "edited": false, "score": 0, "creation_date": 1578094382, "post_id": 33447629, "comment_id": 105339465, "body": "Why not always use pointers for field types that are structs?"}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 48, "last_activity_date": 1446260617, "last_edit_date": 1592644375, "creation_date": 1446260617, "answer_id": 33447629, "question_id": 33447334, "link": "https://stackoverflow.com/questions/33447334/golang-json-marshal-how-to-omit-empty-nested-struct/33447629#33447629", "title": "golang json marshal: how to omit empty nested struct", "body": "<p>From <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">the documentation</a>:</p>\n<blockquote>\n<p>Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless</p>\n<ul>\n<li>the field's tag is &quot;-&quot;, or</li>\n<li>the field is empty and its tag specifies the &quot;omitempty&quot; option.</li>\n</ul>\n<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p>\n</blockquote>\n<p>In your declaration of <code>group</code>, it's implicit that <code>group.A</code> will be the zero value of the <code>ColorGroup</code> struct type.  And notice that zero-values-of-struct-types is not mentioned in that list of things that are considered &quot;empty values&quot;.</p>\n<p>As you found, the workaround for your case is to use a pointer.  This will work if you don't specify <code>A</code> in your declaration of <code>group</code>.  If you specify it to be a pointer to a zero-struct, then it will show up again.</p>\n<p><a href=\"https://play.golang.org/p/R_JfT9G4J4\" rel=\"noreferrer\">playground link</a>:</p>\n<pre><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() {\n    type colorGroup struct {\n        ID     int `json:&quot;,omitempty&quot;`\n        Name   string\n        Colors []string\n    }\n    type total struct {\n        A *colorGroup `json:&quot;,omitempty&quot;`\n        B string     `json:&quot;,omitempty&quot;`\n    }\n\n    groupWithNilA := total{\n        B: &quot;abc&quot;,\n    }\n    b, err := json.Marshal(groupWithNilA)\n    if err != nil {\n        fmt.Println(&quot;error:&quot;, err)\n    }\n    os.Stderr.Write(b)\n\n    println()\n\n    groupWithPointerToZeroA := total{\n        A: &amp;colorGroup{},\n        B: &quot;abc&quot;,\n    }\n    b, err = json.Marshal(groupWithPointerToZeroA)\n    if err != nil {\n        fmt.Println(&quot;error:&quot;, err)\n    }\n    os.Stderr.Write(b)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1343, "user_id": 7401700, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9-qZ7XbWFKM/AAAAAAAAAAI/AAAAAAAAAM4/h8oBLmH-b9k/photo.jpg?sz=128", "display_name": "Jeshan", "link": "https://stackoverflow.com/users/7401700/jeshan"}, "edited": false, "score": 6, "creation_date": 1577459742, "post_id": 33454683, "comment_id": 105177651, "body": "at least 15 people downvoted this without explaining to us why"}, {"owner": {"reputation": 581, "user_id": 3550735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c846e896692faeefb33db83af736fc6e?s=128&d=identicon&r=PG&f=1", "display_name": "Nima", "link": "https://stackoverflow.com/users/3550735/nima"}, "reply_to_user": {"reputation": 1343, "user_id": 7401700, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9-qZ7XbWFKM/AAAAAAAAAAI/AAAAAAAAAM4/h8oBLmH-b9k/photo.jpg?sz=128", "display_name": "Jeshan", "link": "https://stackoverflow.com/users/7401700/jeshan"}, "edited": false, "score": 2, "creation_date": 1601744618, "post_id": 33454683, "comment_id": 113503461, "body": "@JeshanBabooa, 1. <code>name</code> field not exported! First letter of exported fields must be capital. 2. <code>json:&quot;-&quot;</code> is effective when the field is exported. 3. and final word: if the field is exported <code>json:&quot;-&quot;</code> will omit it at all...."}], "tags": [], "owner": {"reputation": 11, "user_id": 5510821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793cd20707f1c88af8e74ce628f60ea8?s=128&d=identicon&r=PG", "display_name": "Purnank Jain", "link": "https://stackoverflow.com/users/5510821/purnank-jain"}, "is_accepted": false, "score": -18, "last_activity_date": 1446315520, "last_edit_date": 1446315520, "creation_date": 1446313805, "answer_id": 33454683, "question_id": 33447334, "link": "https://stackoverflow.com/questions/33447334/golang-json-marshal-how-to-omit-empty-nested-struct/33454683#33454683", "title": "golang json marshal: how to omit empty nested struct", "body": "<p>Easy way</p>\n\n<pre><code>type &lt;name&gt; struct {\n&lt; varname &gt; &lt; vartype &gt; \\`json : -\\`\n}\n</code></pre>\n\n<p><strong>Example :</strong></p>\n\n<pre><code>type Boy struct {\nname string \\`json : -\\`\n}\n</code></pre>\n\n<p>this way on marshaling <code>name</code> will not get serialized.</p>\n"}], "owner": {"reputation": 3061, "user_id": 1905022, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/f743dcdd53e216313cdb74f66cbb4c3f?s=128&d=identicon&r=PG", "display_name": "Zhe Hu", "link": "https://stackoverflow.com/users/1905022/zhe-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42504, "favorite_count": 7, "answer_count": 2, "score": 50, "last_activity_date": 1596448818, "creation_date": 1446257025, "last_edit_date": 1495541392, "question_id": 33447334, "link": "https://stackoverflow.com/questions/33447334/golang-json-marshal-how-to-omit-empty-nested-struct", "title": "golang json marshal: how to omit empty nested struct", "body": "<p><a href=\"https://play.golang.org/p/sA0D6pHZnc\" rel=\"noreferrer\">go playground</a></p>\n\n<p>As shown in the code above, one can use <code>json:\",omitempty\"</code> to omit certain fields in a struct to appear in json. </p>\n\n<p>For example</p>\n\n<pre><code>type ColorGroup struct {\n    ID     int `json:\",omitempty\"`\n    Name   string\n    Colors []string\n}\ntype Total struct {\n    A ColorGroup`json:\",omitempty\"`\n    B string`json:\",omitempty\"`\n}\ngroup := Total{\n       A: ColorGroup{},\n\n}\n</code></pre>\n\n<p>In this case, <code>B</code> won't show up in <code>json.Marshal(group)</code></p>\n\n<p>However, if</p>\n\n<pre><code>group := Total{\n       B:\"abc\",\n\n}\n</code></pre>\n\n<p><code>A</code> still shows up in <code>json.Marshal(group)</code></p>\n\n<pre><code>{\"A\":{\"Name\":\"\",\"Colors\":null},\"B\":\"abc\"}\n</code></pre>\n\n<p>Question is how do we get only</p>\n\n<pre><code>{\"B\":\"abc\"}\n</code></pre>\n\n<p>EDIT:\nAfter some googling, here is a suggestion <a href=\"https://stackoverflow.com/questions/18088294/how-to-not-marshal-an-empty-struct-into-json-with-go\">use pointer</a>, in other words, turn <code>Total</code> into</p>\n\n<pre><code>type Total struct {\n    A *ColorGroup`json:\",omitempty\"`\n    B string`json:\",omitempty\"`\n}\n</code></pre>\n"}, {"tags": ["windows", "powershell", "go", "terminal", "installation"], "comments": [{"owner": {"reputation": 30007, "user_id": 3245749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xYDwR.jpg?s=128&g=1", "display_name": "TheMadTechnician", "link": "https://stackoverflow.com/users/3245749/themadtechnician"}, "edited": false, "score": 0, "creation_date": 1446247127, "post_id": 33446139, "comment_id": 54680722, "body": "try <code>[environment]::GetEnvironmentVariable(&#39;GOPATH&#39;)</code>"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1446247680, "post_id": 33446139, "comment_id": 54680839, "body": "Why the <code>linux</code> tag when your question is about Windows?"}], "answers": [{"tags": [], "owner": {"reputation": 25894, "user_id": 4304, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5MIg7.jpg?s=128&g=1", "display_name": "zdan", "link": "https://stackoverflow.com/users/4304/zdan"}, "is_accepted": false, "score": 7, "last_activity_date": 1446247304, "creation_date": 1446247304, "answer_id": 33446249, "question_id": 33446139, "link": "https://stackoverflow.com/questions/33446139/echo-command-doesnt-work-with-powershell-in-windows-10/33446249#33446249", "title": "echo command doesn&#39;t work with PowerShell in Windows 10", "body": "<p>It looks like GOPATH is an environment variable, not a variable like <code>$HOME</code>. In powershell, you can access environment variables like this:</p>\n\n<pre><code>$env:GOPATH\n</code></pre>\n"}], "owner": {"reputation": 1272, "user_id": 2529834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2bab7617427e755955e39d27b562dfe?s=128&d=identicon&r=PG", "display_name": "Hani", "link": "https://stackoverflow.com/users/2529834/hani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1536, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505428610, "creation_date": 1446246484, "last_edit_date": 1446247769, "question_id": 33446139, "link": "https://stackoverflow.com/questions/33446139/echo-command-doesnt-work-with-powershell-in-windows-10", "title": "echo command doesn&#39;t work with PowerShell in Windows 10", "body": "<p>So I'm trying to install golang in my new laptop that has Windows 10 installed in, I was trying to make sure that the working path is correct by <code>echo $GOPATH</code> but it doesn't return anything, and it only return the home path if I typed <code>echo $HOME</code></p>\n\n<p>I used <code>set GOPATH=/User/folder/path</code> to set the path, is there anything wrong I am doing? or is there any missing files or something in the new laptop?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1446246662, "post_id": 33445908, "comment_id": 54680603, "body": "Don&#39;t ignore errors."}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 228140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/NiYQf.png?s=128&g=1", "display_name": "Julian", "link": "https://stackoverflow.com/users/228140/julian"}, "edited": false, "score": 0, "creation_date": 1446248917, "post_id": 33446194, "comment_id": 54681144, "body": "Yes sorry, you&#39;re right. It was a silly sample to post since this it actually does not represent the problem I&#39;m facing though I thought it would, at first. In this case, the errors are actually helpful, yes. Thanks for the patience"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1446247113, "last_edit_date": 1446247113, "creation_date": 1446246800, "answer_id": 33446194, "question_id": 33445908, "link": "https://stackoverflow.com/questions/33445908/go-http-get-crashes-on-retrieving-high-latency-resources/33446194#33446194", "title": "Go http get crashes on retrieving high-latency resources", "body": "<p>The request is getting an error which you're just ignoring and then you get a nil pointer dereference when you attempt to access the response status in the <code>Printf</code> on the next line.</p>\n\n<p>Here is your example printing the error; <a href=\"http://play.golang.org/p/V8BCrM_Ag7\" rel=\"nofollow\">http://play.golang.org/p/V8BCrM_Ag7</a></p>\n\n<p>Every request gets this; Get <a href=\"http://mickle.com.au/wp-content/uploads/2015/03/11222.jpg\" rel=\"nofollow\">http://mickle.com.au/wp-content/uploads/2015/03/11222.jpg</a>: dial tcp: Protocol not available</p>\n\n<p>Basically, you need to assign the error to something and check it before you allow execution to continue. The common syntax would look like this;</p>\n\n<pre><code>if response, err := client.Do(req); err != nil {\n   // handles error and return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 479, "user_id": 228140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/NiYQf.png?s=128&g=1", "display_name": "Julian", "link": "https://stackoverflow.com/users/228140/julian"}, "is_accepted": false, "score": 0, "last_activity_date": 1447076289, "creation_date": 1447076289, "answer_id": 33610375, "question_id": 33445908, "link": "https://stackoverflow.com/questions/33445908/go-http-get-crashes-on-retrieving-high-latency-resources/33610375#33610375", "title": "Go http get crashes on retrieving high-latency resources", "body": "<p>The mistake that led me in the wrong direction was accessing a nil pointer which lead to a completely hanging program. The original issue was also described here: <a href=\"https://groups.google.com/d/msg/golang-nuts/9mtbzTFTz5E/Z_rrqF8ADAAJ\" rel=\"nofollow\">https://groups.google.com/d/msg/golang-nuts/9mtbzTFTz5E/Z_rrqF8ADAAJ</a></p>\n"}], "owner": {"reputation": 479, "user_id": 228140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/NiYQf.png?s=128&g=1", "display_name": "Julian", "link": "https://stackoverflow.com/users/228140/julian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 33446194, "answer_count": 2, "score": 0, "last_activity_date": 1447076289, "creation_date": 1446244897, "question_id": 33445908, "link": "https://stackoverflow.com/questions/33445908/go-http-get-crashes-on-retrieving-high-latency-resources", "title": "Go http get crashes on retrieving high-latency resources", "body": "<p>I have a panicking program which intends to illustrate the issue of retrieving high-latency resources via golang's http client.</p>\n\n<p>Does someone have a clue why this is happening?</p>\n\n<p>go version go1.5.1 linux/amd64</p>\n\n<pre><code>package main\n\nimport (\"fmt\"\n    \"net/http\"\n    \"time\"\n    \"net\")\n\nfunc main() {\n\n\n    for i:=0; i&lt;2000; i++ {\n        start := time.Now()\n\n         client := &amp;http.Client{} // this enough for the program to crash\n        /*client := &amp;http.Client{\n            Transport: &amp;http.Transport{\n                Dial: (&amp;net.Dialer{\n                    Timeout:   1 * time.Second,\n                    KeepAlive: 0,\n                }).Dial,\n                DisableKeepAlives: true,\n                DisableCompression: true,\n                MaxIdleConnsPerHost: 1,\n                ResponseHeaderTimeout: 1*time.Second,\n            },\n        }*/\n\n        req, _ := http.NewRequest(\"GET\", \"http://mickle.com.au/wp-content/uploads/2015/03/11222.jpg\", nil)\n        req.Header.Add(\"Connection\", \"close\")\n        req.Header.Add(\"Accept-Encoding\", \"none\")\n\n        response, _ := client.Do(req)\n        fmt.Printf(\"httpreq took %s. resp status: %s\\n\", time.Since(start), response.Status)\n        response.Body.Close()\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/nMnFb_x2yU\" rel=\"nofollow\">http://play.golang.org/p/nMnFb_x2yU</a></p>\n\n<pre><code>httpreq took 817.750359ms. resp status: 200 OK\nhttpreq took 798.177493ms. resp status: 200 OK\n[[... left out 33 lines...]]\nhttpreq took 795.433486ms. resp status: 200 OK\nhttpreq took 805.610082ms. resp status: 200 OK\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0x4014a6]\n\ngoroutine 1 [running]:\nmain.main()\n    /home/bongo/Downloads/a.go:32 +0x4a6\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    /usr/lib/golang/src/runtime/asm_amd64.s:1696 +0x1\n\ngoroutine 8 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac000)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 9 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac000)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 40 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac2c0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 76 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e22c0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 34 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2000)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 35 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2000)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 12 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac0b0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 13 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac0b0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 16 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac160)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 50 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac160)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 38 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e000)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 39 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e000)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 53 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac210)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 54 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac210)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 61 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2160)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 41 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac2c0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 44 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e0b0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 45 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e0b0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 59 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac370)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 60 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac370)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 22 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e20b0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 23 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e20b0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 78 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2370)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 62 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2160)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 48 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e160)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 49 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e160)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 28 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2210)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 29 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2210)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 70 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac420)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 68 [select]:\nnet/http.(*persistConn).readLoop(0xc820170000)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 69 [select]:\nnet/http.(*persistConn).writeLoop(0xc820170000)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 101 [select]:\nnet/http.(*persistConn).readLoop(0xc8201702c0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 71 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac420)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 74 [select]:\nnet/http.(*persistConn).readLoop(0xc8201700b0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 75 [select]:\nnet/http.(*persistConn).writeLoop(0xc8201700b0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 84 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e210)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 85 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e210)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 99 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac4d0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 100 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac4d0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 88 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e2c0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 89 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e2c0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 80 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e370)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 77 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e22c0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 122 [select]:\nnet/http.(*persistConn).readLoop(0xc820170160)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 79 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2370)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 116 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2420)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 117 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2420)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 120 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e24d0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 121 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e24d0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 81 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e370)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 147 [select]:\nnet/http.(*persistConn).readLoop(0xc8200e2580)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 123 [select]:\nnet/http.(*persistConn).writeLoop(0xc820170160)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 134 [select]:\nnet/http.(*persistConn).readLoop(0xc820170210)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 135 [select]:\nnet/http.(*persistConn).writeLoop(0xc820170210)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 178 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e580)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 102 [select]:\nnet/http.(*persistConn).writeLoop(0xc8201702c0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 105 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac580)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 106 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac580)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 109 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac630)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 110 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac630)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 113 [select]:\nnet/http.(*persistConn).readLoop(0xc8200ac6e0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 146 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200ac6e0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 140 [select]:\nnet/http.(*persistConn).readLoop(0xc820170370)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 141 [select]:\nnet/http.(*persistConn).writeLoop(0xc820170370)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 144 [select]:\nnet/http.(*persistConn).readLoop(0xc820170420)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 145 [select]:\nnet/http.(*persistConn).writeLoop(0xc820170420)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 94 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e420)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 95 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e420)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 162 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e4d0)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 163 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e4d0)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 179 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e580)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 126 [select]:\nnet/http.(*persistConn).readLoop(0xc82010e630)\n    /usr/lib/golang/src/net/http/transport.go:976 +0xac7\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:685 +0xc78\n\ngoroutine 148 [select]:\nnet/http.(*persistConn).writeLoop(0xc8200e2580)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\n\ngoroutine 127 [select]:\nnet/http.(*persistConn).writeLoop(0xc82010e630)\n    /usr/lib/golang/src/net/http/transport.go:1009 +0x40c\ncreated by net/http.(*Transport).dialConn\n    /usr/lib/golang/src/net/http/transport.go:686 +0xc9d\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "file-permissions", "chmod"], "answers": [{"tags": [], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "is_accepted": true, "score": 13, "last_activity_date": 1446243664, "creation_date": 1446243664, "answer_id": 33445728, "question_id": 33445727, "link": "https://stackoverflow.com/questions/33445727/how-to-control-file-access-in-windows/33445728#33445728", "title": "How to control file access in Windows?", "body": "<h3>Explanation</h3>\n\n<p>Windows does not use traditional Unix permissions. Instead, Windows controls access to files and directories through <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa374860(v=vs.85).aspx\" rel=\"noreferrer\">access control</a>. Each object has an <a href=\"https://msdn.microsoft.com/en-ca/library/windows/desktop/aa374872(v=vs.85).aspx\" rel=\"noreferrer\">ACL (Access Control List)</a><sup>*</sup> which controls access to the object.</p>\n\n<p>Each ACL is basically a list of <a href=\"https://msdn.microsoft.com/en-ca/library/windows/desktop/aa374868(v=vs.85).aspx\" rel=\"noreferrer\">ACEs (Access Control Entries)</a> which determine what access a specific trustee (user, group, etc.) is granted. For example, a file may contain an ACE granting a specific user read access (<code>GENERIC_READ</code>) to the file.</p>\n\n<p>Manipulating ACLs and ACEs is done through the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa375742(v=vs.85).aspx\" rel=\"noreferrer\">authorization functions</a> in the Windows API.</p>\n\n<p><sub><sup>* technically each object has two ACLs - a DACL and a SACL</sup></sub></p>\n\n<h3>Solution</h3>\n\n<p>Thankfully, learning all of these functions isn't necessary. I've put together <a href=\"https://github.com/hectane/go-acl\" rel=\"noreferrer\">a small Go package named \"go-acl\"</a> that does all of the heavy-lifting and exposes a function named (what else?) <code>Chmod</code>. Basic usage is as follows:</p>\n\n<pre><code>import \"github.com/hectane/go-acl\"\n\nerr := acl.Chmod(\"C:\\\\path\\\\to\\\\file.txt\", 0755)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<h3>Results</h3>\n\n<p>The <code>Chmod()</code> function creates three ACEs in the file's ACL:</p>\n\n<p><a href=\"https://i.stack.imgur.com/h6PKy.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/h6PKy.png\" alt=\"enter image description here\"></a></p>\n\n<ul>\n<li>one for the owner (<code>WinCreatorOwnerSid</code>)</li>\n<li>one for the group (<code>WinCreatorGroupSid</code>)</li>\n<li>one for everyone else (<code>WinWorldSid</code>)</li>\n</ul>\n"}], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2178, "favorite_count": 1, "accepted_answer_id": 33445728, "answer_count": 1, "score": 5, "last_activity_date": 1446243664, "creation_date": 1446243664, "question_id": 33445727, "link": "https://stackoverflow.com/questions/33445727/how-to-control-file-access-in-windows", "title": "How to control file access in Windows?", "body": "<p>Go provides <a href=\"https://golang.org/pkg/os/#Chmod\" rel=\"noreferrer\"><code>os.Chmod()</code></a> for setting file and directory permissions. For example, if I want to ensure a file is accessible only to the current user, I can do the following:</p>\n\n<pre><code>os.Chmod(\"somefile.txt\", 0600)\n</code></pre>\n\n<p>This works great on Linux but does absolutely nothing on Windows. After digging into the Go source code, I came across <a href=\"https://golang.org/src/syscall/syscall_windows.go#L520\" rel=\"noreferrer\">its implementation</a>. It seems like <code>S_IWRITE</code> is the only attribute supported.</p>\n\n<p>How do I control access to a file or directory on Windows using Go?</p>\n"}, {"tags": ["unit-testing", "go", "code-coverage"], "comments": [{"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1446249852, "post_id": 33444968, "comment_id": 54681342, "body": "Could you please edit your post to include the <code>go test</code> command with your arguments?"}, {"owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "reply_to_user": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1446253579, "post_id": 33444968, "comment_id": 54682095, "body": "ok, Done! Let me know if it helps."}], "answers": [{"comments": [{"owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "edited": false, "score": 0, "creation_date": 1446352257, "post_id": 33457070, "comment_id": 54704833, "body": "Well, it still shows the coverage info per package basis, which I am getting from my given command. Any tweaks to get a overall coverage info?"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "edited": false, "score": 0, "creation_date": 1446356888, "post_id": 33457070, "comment_id": 54705427, "body": "The very last line it outputs is this : <code>total:\t(statements)\t\t99.3%</code>, is that not what you want @Rana ?"}, {"owner": {"reputation": 108, "user_id": 2220201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50b66033dab0407a78dc7b24fa1e96fb?s=128&d=identicon&r=PG", "display_name": "nboon", "link": "https://stackoverflow.com/users/2220201/nboon"}, "edited": false, "score": 1, "creation_date": 1529231945, "post_id": 33457070, "comment_id": 88791627, "body": "I got the &quot;bad mode line&quot; too. I had to add the line <code>echo &quot;mode: count&quot; &gt; profile.cov</code> in the beginning."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1529232071, "post_id": 33457070, "comment_id": 88791658, "body": "Thanks, added to the answer"}, {"owner": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "edited": false, "score": 2, "creation_date": 1534936217, "post_id": 33457070, "comment_id": 90880830, "body": "Am I right in thinking this only produces a coverage for those files that have some tests? Also I had to add <code>-not -path &#39;.&#47;vendor&#47;*&#39;</code> to ignore vendored packages."}, {"owner": {"reputation": 1245, "user_id": 986696, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7faEG.jpg?s=128&g=1", "display_name": "Alex Jansen", "link": "https://stackoverflow.com/users/986696/alex-jansen"}, "reply_to_user": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "edited": false, "score": 2, "creation_date": 1576057056, "post_id": 33457070, "comment_id": 104771465, "body": "@danielcooperxyz is correct.  Packages which don&#39;t have tests will produce a 1-line profile containing <code>mode: count</code>.  The tail command will remove this line and append nothing to profile.cov.  This then prevents <code>go tool cover -func profile.cov</code> from accurately calculating the total coverage.  For what it&#39;s worth, <code>go test -coverprofile=profile.cov .&#47;...</code> is functionally equivalent to most of this script and suffers from the same inaccuracy."}, {"owner": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "edited": false, "score": 0, "creation_date": 1584457727, "post_id": 33457070, "comment_id": 107439244, "body": "How are the added flags in go 1.10 relevant for this?"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 1973, "user_id": 1716999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a58106c9a1013f1ca791c46579d664?s=128&d=identicon&r=PG", "display_name": "rubystallion", "link": "https://stackoverflow.com/users/1716999/rubystallion"}, "edited": false, "score": 1, "creation_date": 1584527140, "post_id": 33457070, "comment_id": 107461166, "body": "@rubystallion added an example on how to use them"}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 16, "last_activity_date": 1584526936, "last_edit_date": 1584526936, "creation_date": 1446328573, "answer_id": 33457070, "question_id": 33444968, "link": "https://stackoverflow.com/questions/33444968/how-to-get-all-packages-code-coverage-together-in-go/33457070#33457070", "title": "How to get all packages&#39; code coverage together in Go?", "body": "<p>EDIT: Things have changed since I wrote this answer. See the release notes of Go 1.10: <a href=\"https://golang.org/doc/go1.10#test\" rel=\"noreferrer\">https://golang.org/doc/go1.10#test</a> :</p>\n\n<blockquote>\n  <p>The go test -coverpkg flag now interprets its argument as a\n  comma-separated list of patterns to match against the dependencies of\n  each test, not as a list of packages to load anew. For example, go\n  test -coverpkg=all is now a meaningful way to run a test with coverage\n  enabled for the test package and all its dependencies. Also, the go\n  test -coverprofile option is now supported when running multiple\n  tests.</p>\n</blockquote>\n\n<p>You can now run</p>\n\n<pre><code>go test -v -coverpkg=./... -coverprofile=profile.cov ./...\ngo tool cover -func profile.cov\n</code></pre>\n\n<hr>\n\n<p><strong>Old answer</strong></p>\n\n<p>Here is a bash script extracted from <a href=\"https://github.com/h12w/gosweep\" rel=\"noreferrer\">https://github.com/h12w/gosweep</a> :</p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>#!/bin/bash\nset -e\n\necho 'mode: count' &gt; profile.cov\n\nfor dir in $(find . -maxdepth 10 -not -path './.git*' -not -path '*/_*' -type d);\ndo\nif ls $dir/*.go &amp;&gt; /dev/null; then\n    go test -short -covermode=count -coverprofile=$dir/profile.tmp $dir\n    if [ -f $dir/profile.tmp ]\n    then\n        cat $dir/profile.tmp | tail -n +2 &gt;&gt; profile.cov\n        rm $dir/profile.tmp\n    fi\nfi\ndone\n\ngo tool cover -func profile.cov\n</code></pre>\n"}], "owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8789, "favorite_count": 3, "answer_count": 1, "score": 20, "last_activity_date": 1603869491, "creation_date": 1446239388, "last_edit_date": 1491976279, "question_id": 33444968, "link": "https://stackoverflow.com/questions/33444968/how-to-get-all-packages-code-coverage-together-in-go", "title": "How to get all packages&#39; code coverage together in Go?", "body": "<p>I have a library consisting of several packages. When running tests, I am using '-cover' flag and its showing the coverage information for each package individually.Like follows:</p>\n\n<pre><code>--- PASS: TestSampleTestSuite (0.00s)\nPASS\ncoverage: 28.7% of statements\nok      github.com/path/to/package1 13.021s\n?       github.com/path/to/package2 [no test files]\n\n=== RUN   TestAbc\n--- PASS: TestAbc (0.43s)\nPASS\ncoverage: 27.7% of statements\n</code></pre>\n\n<p>Is there any way to get a full coverage overview easily to get good idea about coverage on the whole project?</p>\n\n<p>Update: Here is the go test command I am using</p>\n\n<pre><code>go test ./... -v -short -p 1 -cover\n</code></pre>\n"}, {"tags": ["service", "go", "syslog"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446239913, "post_id": 33444249, "comment_id": 54678381, "body": "Why do you say <code>syslog.Writer.Close()</code> is inaccessible? You explicitly create a <code>syslog.Writer</code> in the link you posted."}, {"owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446295887, "post_id": 33444249, "comment_id": 54690217, "body": "I added some info and sample code. Thanks!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446299537, "post_id": 33444249, "comment_id": 54691327, "body": "This doesn&#39;t show how you&#39;re handling cleanup. It looks like <code>logWriter</code> is <code>nil</code> when you call <code>Close()</code>."}, {"owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446301308, "post_id": 33444249, "comment_id": 54691942, "body": "ok. that&#39;s interesting. i guess the problem is exactly that. how do i get a proper reference to logWriter to call the Close() method? What would I do upon deciding to cleanup and shutdown?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446314303, "post_id": 33444249, "comment_id": 54696116, "body": "You need to show us how you&#39;re managing to <i>not</i> get a valid reference to logWriter during your cleanup. All you can do during cleanup is to make an attempt to close the connection."}, {"owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446326080, "post_id": 33444249, "comment_id": 54699778, "body": "You&#39;re right, @JimB. Done. This is basically the code with extraneous stuff removed. the main loop listens for signals on the dedicated channel and then calls .Close() on the logwriter--cuz i didn&#39;t know how to do it. I know this doesn&#39;t work. :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446385047, "post_id": 33444249, "comment_id": 54711182, "body": "Check your error from syslog.New. If there&#39;s an error, you don&#39;t have a logWriter to close. Plus, you don&#39;t actually exit on a signal."}, {"owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446391670, "post_id": 33444249, "comment_id": 54713253, "body": "Ok. You&#39;re totally correct--which I never doubted--but now I&#39;m getting the results you&#39;re saying. Contributing to the problem is that my syslogd was put into a bad state. I had to reboot my mac and now I get the proper behavior you describe. I&#39;ve updated the code above. I can run this repeatedly without leaving the stuck connections to syslog. Thank you!"}, {"owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "edited": false, "score": 0, "creation_date": 1447880948, "post_id": 33444249, "comment_id": 55347870, "body": "@n8gard Good that you managed to solve your issues. Would you be able to post an answer with the corrections, and accept it..."}], "answers": [{"tags": [], "owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "is_accepted": true, "score": 0, "last_activity_date": 1453476256, "creation_date": 1453476256, "answer_id": 34950113, "question_id": 33444249, "link": "https://stackoverflow.com/questions/33444249/why-is-gos-logger-not-closing-connections-to-syslog/34950113#34950113", "title": "Why is Go&#39;s Logger not closing connections to syslog?", "body": "<p>The problem was with the way the program was originally structured. The main() thread was exiting before the logging goroutine and thus orphaning connections. After refactoring to prevent that, the problem went away.</p>\n"}], "owner": {"reputation": 1620, "user_id": 1183758, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a2Bxf.jpg?s=128&g=1", "display_name": "n8gard", "link": "https://stackoverflow.com/users/1183758/n8gard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 0, "accepted_answer_id": 34950113, "answer_count": 1, "score": 1, "last_activity_date": 1453476256, "creation_date": 1446236249, "last_edit_date": 1446391808, "question_id": 33444249, "link": "https://stackoverflow.com/questions/33444249/why-is-gos-logger-not-closing-connections-to-syslog", "title": "Why is Go&#39;s Logger not closing connections to syslog?", "body": "<p>I\u2019m having trouble with a service i\u2019m writing. I have it logging to syslog like this: <a href=\"http://technosophos.com/2013/09/14/using-gos-built-logger-log-syslog.html\" rel=\"nofollow\">http://technosophos.com/2013/09/14/using-gos-built-logger-log-syslog.html</a></p>\n\n<p>but when i kill the service via CTRL-C something is leaving connections open to syslogd. I can\u2019t see anyway to initiate a cleanup. What am I missing</p>\n\n<p>e.g. <code>syslog.Writer.Close()</code> seems inaccessible to me but i can say the cleanup isn\u2019t happening. I\u2019m seeing connections stuck in a CLOSE_WAIT state and my syslogd starts bogging down and becoming uncooperative.</p>\n\n<p>example:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/davecgh/go-spew/spew\" // DEBUG\n    \"log\"\n    \"log/syslog\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc main() {\n    logWriter, err := syslog.New(syslog.LOG_NOTICE, \"mybrokenprog\")\n    spew.Dump(logWriter) // DEBUG\n    spew.Dump(err)       // DEBUG\n    if err == nil {\n        log.SetOutput(logWriter)\n    }\n\n    chansigs := make(chan os.Signal, 1)\n    signal.Notify(chansigs, os.Interrupt, syscall.SIGTERM, syscall.SIGKILL)\n    log.Print(\"writing to syslog. waiting for shutdown signal\")\n    for {\n        sig := &lt;-chansigs // we just wait here for a signal to shutdown\n        log.Print(\"signal received...shutting down\")\n        logWriter.Close() // but this throws the panic excerpted below\n        if sig == os.Interrupt {\n            os.Exit(0)\n        }\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>EDIT: the above code fixes the problem. see the comments. Rebooting to clear the stuck connections to syslog fixed the problem. Once they're there, they're persistent. Even OS X's instructions for retarting syslogd did not help.\nEDIT: this was the error: panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0xcb4fe]</p>\n\n<p>goroutine 1 [running]:\nlog/syslog.(*Writer).Close(0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5.1/libexec/src/log/syslog/syslog.go:177 +0x10e\nmain.main(0x3)</p>\n\n<p>I've no doubt I'm doing it wrong. Just a newb who doesn't yet see where.</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "edited": false, "score": 0, "creation_date": 1549355046, "post_id": 33443867, "comment_id": 95861930, "body": "I&#39;d like to add a comment to an old question of mine.  I was encoding and decoding  DLMS/COSEM data structures (utility industry).  I built COSEM structures only with variables defined in the spec.  Switch was used in COSEM encoder in a recursive function.  The result for core encoder, decoder with some encryption support and many fundamental data types was probably no more than 2K LOC (there are a lot of structure definitions).  It worked with real meter data.  Compare it to original implementation of 10th of thousands of lines of C#...  Unfortunately, that effort was 3 years too late."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 8, "last_activity_date": 1446234883, "creation_date": 1446234883, "answer_id": 33443926, "question_id": 33443867, "link": "https://stackoverflow.com/questions/33443867/how-to-switch-on-reflect-type/33443926#33443926", "title": "How to switch on reflect.Type?", "body": "<p>you may not need reflect if you are just trying to detect type.</p>\n\n<pre><code>switch t := myVar.(type){\n  case []uint8:\n    // t is []uint8\n  case *Foo:\n    // t is *Foo\n  default:\n    panic(\"unknown type\")\n}\n</code></pre>\n\n<p>What are you actually trying to accomplish?</p>\n"}, {"comments": [{"owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "edited": false, "score": 0, "creation_date": 1540990196, "post_id": 33443938, "comment_id": 93064069, "body": "Better to use <code>const</code>. Edit: Never mind, you have to use <code>var</code>."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 9, "last_activity_date": 1446234980, "creation_date": 1446234980, "answer_id": 33443938, "question_id": 33443867, "link": "https://stackoverflow.com/questions/33443867/how-to-switch-on-reflect-type/33443938#33443938", "title": "How to switch on reflect.Type?", "body": "<p>First question, are you sure you want to switch on reflect.Type and not use a type switch? Example:</p>\n\n<pre><code>switch x := y.(type) {\ncase []uint8:\n  // x is now a []uint8\n}\n</code></pre>\n\n<p>Assuming that will not work for your situation, my recommendation is to make those package variables. Example:</p>\n\n<pre><code>var uint8SliceType = reflect.TypeOf(([]uint8)(nil))\n\nfunc Foo() {\n    var t reflect.Type\n    switch t {\n    case uint8SliceType:\n        // handle []uint8 array type\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 13625267, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/aa8b70cd53ad170ed036e007778c61bb?s=128&d=identicon&r=PG", "display_name": "user13625267", "link": "https://stackoverflow.com/users/13625267/user13625267"}, "is_accepted": false, "score": 1, "last_activity_date": 1590595543, "last_edit_date": 1590595543, "creation_date": 1590562022, "answer_id": 62037008, "question_id": 33443867, "link": "https://stackoverflow.com/questions/33443867/how-to-switch-on-reflect-type/62037008#62037008", "title": "How to switch on reflect.Type?", "body": "<p>This might work.</p>\n\n<pre><code>switch t := reflect.TypeOf(a).String() {\n   case \"[]uint8\":\n   default:\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6364281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c696a2793d109072db7de92b5bc3317f?s=128&d=identicon&r=PG", "display_name": "Olly", "link": "https://stackoverflow.com/users/6364281/olly"}, "is_accepted": false, "score": 0, "last_activity_date": 1607896548, "last_edit_date": 1607896548, "creation_date": 1607895358, "answer_id": 65280938, "question_id": 33443867, "link": "https://stackoverflow.com/questions/33443867/how-to-switch-on-reflect-type/65280938#65280938", "title": "How to switch on reflect.Type?", "body": "<p>As others have said, it's not clear what you are trying to achieve by switching on reflect.Type However, I came across this question when probably trying to do something similar, so I will give you my solution in case it answers your question.</p>\n<p>As <a href=\"https://stackoverflow.com/a/33443926/6364281\">captncraig said</a>, a simple type switch could be done on a interface{} variable without needing to use reflect.</p>\n<pre><code>func TypeSwitch(val interface{}) {\n    switch val.(type) {\n        case int:\n            fmt.Println(&quot;int with value&quot;, val)\n        case string:\n            fmt.Println(&quot;string with value &quot;, val)\n        case []uint8:\n            fmt.Println(&quot;Slice of uint8 with value&quot;, val)\n        default:\n            fmt.Println(&quot;Unhandled&quot;, &quot;with value&quot;, val)\n    }\n}\n</code></pre>\n<p>However, going beyond this, the usefulness of reflection in the context of the original question could be in a function that accepts a struct with arbitrarily typed fields, and then uses a type switch to process the field according to its type. It is not necessary to switch directly on reflect.Type, as the type can be extracted by reflect and then a standard type switch will work. For example:</p>\n<pre><code>type test struct {\n    I int\n    S string\n    Us []uint8\n}\n\nfunc (t *test) SetIndexedField(index int, value interface{}) {\n    e := reflect.ValueOf(t).Elem()\n    p := e.Field(index)\n    v := p.Interface()\n    typeOfF := e.Field(index).Type()\n    switch v.(type) {\n        case int:\n            p.SetInt(int64(value.(int)))\n        case string:\n            p.SetString(value.(string))\n        case []uint8:\n            p.SetBytes(value.([]uint8))\n        default:\n            fmt.Println(&quot;Unsupported&quot;, typeOfF, v, value)\n    }\n}\n</code></pre>\n<p>The following examples demonstrate the use of this function:</p>\n<pre><code>var t = test{10, &quot;test string&quot;, []uint8 {1, 2, 3, 4}}\nfmt.Println(t)\n(&amp;t).SetIndexedField(0, 5)\n(&amp;t).SetIndexedField(1, &quot;new string&quot;)\n(&amp;t).SetIndexedField(2, []uint8 {8, 9})\nfmt.Println(t)\n</code></pre>\n<p>(A few points on reflection in go:</p>\n<ol>\n<li>It is necessary to export the struct fields for reflect to be able to use them, hence the capitalisation of the field names</li>\n<li>In order to modify the field values, it would be necessary to use a pointer to the struct as in this example function</li>\n<li>Elem() is used to &quot;dereference&quot; the pointer in reflect</li>\n</ol>\n<p>)</p>\n"}], "owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7468, "favorite_count": 1, "accepted_answer_id": 33443926, "answer_count": 4, "score": 6, "last_activity_date": 1607896548, "creation_date": 1446234624, "question_id": 33443867, "link": "https://stackoverflow.com/questions/33443867/how-to-switch-on-reflect-type", "title": "How to switch on reflect.Type?", "body": "<p>I have managed to do this, but it does not look efficient:</p>\n\n<pre><code>var t reflect.Type\nswitch t {\ncase reflect.TypeOf(([]uint8)(nil)):\n    // handle []uint8 array type\n}\n</code></pre>\n"}, {"tags": ["go", "command-line-interface"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1446234134, "last_edit_date": 1446234134, "creation_date": 1446233597, "answer_id": 33443604, "question_id": 33443131, "link": "https://stackoverflow.com/questions/33443131/get-flag-value-from-codegansta-cli/33443604#33443604", "title": "Get flag value from Codegansta CLI", "body": "<p>Flags defined in <code>app.Flags</code> are accessed with the <code>Context.Global*</code> methods.</p>\n\n<p>You want</p>\n\n<pre><code>return cli.Command{\n    Name:  \"listen\",\n    Usage: \"Listen to a stream\",\n    Action: func(c *cli.Context) {\n        redisUrl := c.GlobalString(\"redis\")\n        log.Printf(\"Connecting to redis: %s\\n\", redisUrl)\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 3315, "user_id": 2261909, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3e2a6a4bb5a88ce2b4805c4a3ca2e4ce?s=128&d=identicon&r=PG", "display_name": "brandonhilkert", "link": "https://stackoverflow.com/users/2261909/brandonhilkert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 33443604, "answer_count": 1, "score": 1, "last_activity_date": 1446234134, "creation_date": 1446231556, "question_id": 33443131, "link": "https://stackoverflow.com/questions/33443131/get-flag-value-from-codegansta-cli", "title": "Get flag value from Codegansta CLI", "body": "<p>I'm writing a command line app in Go and want to specify a redis endpoint as a flag. I've added the following:  </p>\n\n<pre><code>app.Flags = []cli.Flag{\n    cli.StringFlag{\n        Name:   \"redis, r\",\n        Value:  \"127.0.0.1\",\n        Usage:  \"redis host to listen to\",\n        EnvVar: \"REDIS_URL\",\n    },\n}\n</code></pre>\n\n<p>However, in my command, the flag is always blank:</p>\n\n<pre><code>return cli.Command{\n    Name:  \"listen\",\n    Usage: \"Listen to a stream\",\n    Action: func(c *cli.Context) {\n        redisUrl := c.String(\"redis\")\n        log.Printf(\"Connecting to redis: %s\\n\", redisUrl)\n    },\n}\n</code></pre>\n\n<p>Invoked with:</p>\n\n<pre><code>./mantle-monitor --redis 127.0.0.1 listen\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1446325954, "post_id": 33437453, "comment_id": 54699734, "body": "I think its a known (and ignored) bug <a href=\"https://github.com/jinzhu/gorm/issues/640\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/640</a>.  I got stuck so many times while using gorm for doing queries more than just a simple join. I now use <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">github.com/jmoiron/sqlx</a>. Edit: Just spotted your issue and +1&#39;d it."}, {"owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "reply_to_user": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1462130980, "post_id": 33437453, "comment_id": 61497501, "body": "Issue link for those curious: <a href=\"https://github.com/jinzhu/gorm/issues/707\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/707</a>"}], "owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1150, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1446212544, "creation_date": 1446212544, "question_id": 33437453, "link": "https://stackoverflow.com/questions/33437453/using-different-join-table-columns-than-defaults-with-gorm-many2many-join", "title": "Using Different Join Table Columns than Defaults with GORM many2many join", "body": "<p>I'm using gorm to manage my struct to database mappings.\nRight now, I have an existing schema that I'm trying to wrap in an api.\nThe issue is that in one of my structs, I have a <code>many2many</code> join through another table which doesn't use the default column names.</p>\n\n<h1>golang code</h1>\n\n<pre><code>type AuthUser struct {\n  ID          *int\n  Username    *string `sql:\"size:30\"`\n  FirstName   *string `sql:\"size:30\"`\n  LastName    *string `sql:\"size:30\"`\n  Email       *string `sql:\"size:75\"`\n  IsActive    *bool\n  IsStaff     *bool\n  IsSuperuser *bool\n  DateJoined  *time.Time\n  LastLogin   *time.Time\n  //ReviewsGroups ReviewsGroups `gorm:\"foreignkey:group_id;associationforeignkey:user_id;many2many:reviews_group_users\"`\n  //ReviewsGroups ReviewsGroups `gorm:\"many2many:reviews_group_users\"`\n  ReviewsGroups []ReviewsGroup `gorm:\"many2many:reviews_group_users\"`\n}\n\ntype ReviewsGroups []ReviewsGroup\n\n\nfunc (app *AppEnv) FindAuthUser(username string) (*AuthUser, error) {\n  var user AuthUser\n  //var groups []ReviewsGroup\n  //err := app.DB.Where(&amp;AuthUser{Username: &amp;username}).First(&amp;user).Related(&amp;groups).Error\n  err := app.DB.Preload(\"ReviewsGroups\").Where(&amp;AuthUser{Username: &amp;username}).First(&amp;user).Error\n  return &amp;user, err\n}\n</code></pre>\n\n<h1>join table</h1>\n\n<pre><code>rb=&gt; \\d reviews_group_users\n                          Table \"public.reviews_group_users\"\n  Column  |  Type   |                            Modifiers\n----------+---------+------------------------------------------------------------------\n id       | integer | not null default nextval('reviews_group_users_id_seq'::regclass)\n group_id | integer | not null\n user_id  | integer | not null\nIndexes:\n    \"reviews_group_users_pkey\" PRIMARY KEY, btree (id)\n    \"reviews_group_users_group_id_user_id_key\" UNIQUE CONSTRAINT, btree (group_id, user_id)\n    \"reviews_group_users_group_id\" btree (group_id)\n    \"reviews_group_users_user_id\" btree (user_id)\nForeign-key constraints:\n    \"group_id_refs_id_0f32ed01\" FOREIGN KEY (group_id) REFERENCES reviews_group(id) DEFERRABLE INITIALLY DEFERRED\n    \"reviews_group_users_user_id_fkey\" FOREIGN KEY (user_id) REFERENCES auth_user(id) DEFERRABLE INITIALLY DEFERRED\n</code></pre>\n\n<h1>resulting query output</h1>\n\n<pre><code>[2015-10-30 09:31:32]  [1.16ms]  SELECT  * FROM \"auth_user\"  WHERE (\"username\" = 'theuser') ORDER BY \"auth_user\".\"id\" ASC LIMIT 1\n[2015-10-30 09:31:32]  [1.85ms]  SELECT  * FROM \"reviews_group\" INNER JOIN reviews_group_users ON reviews_group_users.\"reviews_group_id\" = \"reviews_group\".\"id\" WHERE (auth_user_id in ('13'))\n[2015-10-30 09:31:32]  pq: column reviews_group_users.reviews_group_id does not exist\n</code></pre>\n\n<p>Any help is appreciated.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 0, "creation_date": 1497632021, "post_id": 33437843, "comment_id": 76176462, "body": "Why would using just Foo cause recursion?"}, {"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 1, "creation_date": 1497637383, "post_id": 33437843, "comment_id": 76179403, "body": "btw I used this with some good success. example here: <a href=\"https://play.golang.org/p/WLeEJIESg6\" rel=\"nofollow noreferrer\">play.golang.org/p/WLeEJIESg6</a>"}, {"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 1, "creation_date": 1497638291, "post_id": 33437843, "comment_id": 76179916, "body": "I also think this solution of leveraging the bson module is nice, especially if you already include it as a dependency: <a href=\"http://devel.io/2013/08/19/go-handling-arbitrary-json/\" rel=\"nofollow noreferrer\">devel.io/2013/08/19/go-handling-arbitrary-json</a>"}, {"owner": {"reputation": 9594, "user_id": 448734, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/94ccfc629c6862b5950de3512742bcae?s=128&d=identicon&r=PG", "display_name": "Bryan", "link": "https://stackoverflow.com/users/448734/bryan"}, "reply_to_user": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 3, "creation_date": 1571072566, "post_id": 33437843, "comment_id": 103110598, "body": "&quot;Why would using just Foo cause recursion?&quot; - @Chris  The json package checks if a type has <code>UnmarshalJSON()</code> defined, and if so it calls that implementation. So we arrive at the top of the function, then we call <code>Unmarshal()</code> on <code>f</code>, and the json package checks if <code>Foo</code> has <code>UnmarshalJSON()</code> defined, and it does, so it calls it, and so on, to infinite recursion.  The purpose of <code>_Foo</code> is to be a type that does <i>not</i> implement <code>UnmarshalJSON()</code>, to break the cycle."}], "tags": [], "owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "is_accepted": false, "score": 24, "last_activity_date": 1446213735, "creation_date": 1446213735, "answer_id": 33437843, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/33437843#33437843", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<p>It's not nice, but you could to it by implementing <code>Unmarshaler</code>:</p>\n\n<pre><code>type _Foo Foo\n\nfunc (f *Foo) UnmarshalJSON(bs []byte) (err error) {\n    foo := _Foo{}\n\n    if err = json.Unmarshal(bs, &amp;foo); err == nil {\n        *f = Foo(foo)\n    }\n\n    m := make(map[string]interface{})\n\n    if err = json.Unmarshal(bs, &amp;m); err == nil {\n        delete(m, \"a\")\n        delete(m, \"b\")\n        f.X = m\n    }\n\n    return err\n}\n</code></pre>\n\n<p>The type <code>_Foo</code> is necessary to avoid recursion while decoding.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 42, "last_activity_date": 1471854812, "last_edit_date": 1471854812, "creation_date": 1446213764, "answer_id": 33437853, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/33437853#33437853", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<h2>Unmarshal twice</h2>\n\n<p>One option is to unmarshal twice: once into a value of type <code>Foo</code> and once into a value of type <code>map[string]interface{}</code> and removing the keys <code>\"a\"</code> and <code>\"b\"</code>:</p>\n\n<pre><code>type Foo struct {\n    A int                    `json:\"a\"`\n    B int                    `json:\"b\"`\n    X map[string]interface{} `json:\"-\"` // Rest of the fields should go here.\n}\n\nfunc main() {\n    s := `{\"a\":1, \"b\":2, \"x\":1, \"y\":1}`\n    f := Foo{}\n    if err := json.Unmarshal([]byte(s), &amp;f); err != nil {\n        panic(err)\n    }\n\n    if err := json.Unmarshal([]byte(s), &amp;f.X); err != nil {\n        panic(err)\n    }\n    delete(f.X, \"a\")\n    delete(f.X, \"b\")\n\n    fmt.Printf(\"%+v\", f)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/MbGVDwBgzy\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{A:1 B:2 X:map[x:1 y:1]}\n</code></pre>\n\n<h2>Unmarshal once and manual handling</h2>\n\n<p>Another option is to unmarshal once into an <code>map[string]interface{}</code> and handle the <code>Foo.A</code> and <code>Foo.B</code> fields manually:</p>\n\n<pre><code>type Foo struct {\n    A int                    `json:\"a\"`\n    B int                    `json:\"b\"`\n    X map[string]interface{} `json:\"-\"` // Rest of the fields should go here.\n}\n\nfunc main() {\n    s := `{\"a\":1, \"b\":2, \"x\":1, \"y\":1}`\n    f := Foo{}\n    if err := json.Unmarshal([]byte(s), &amp;f.X); err != nil {\n        panic(err)\n    }\n    if n, ok := f.X[\"a\"].(float64); ok {\n        f.A = int(n)\n    }\n    if n, ok := f.X[\"b\"].(float64); ok {\n        f.B = int(n)\n    }\n    delete(f.X, \"a\")\n    delete(f.X, \"b\")\n\n    fmt.Printf(\"%+v\", f)\n}\n</code></pre>\n\n<p>Output is the same (<a href=\"http://play.golang.org/p/juAjK6ymIk\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{A:1 B:2 X:map[x:1 y:1]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "is_accepted": false, "score": 12, "last_activity_date": 1446553404, "creation_date": 1446553404, "answer_id": 33499066, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/33499066#33499066", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<h1>Almost single pass, uses <code>json.RawMessage</code></h1>\n\n<p>We can unmarshal into <code>map[string]json.RawMessage</code>, and then unmarshal each field separately.</p>\n\n<p>JSON will be tokenized twice, but that's quite cheap.</p>\n\n<p>The following helper function can be used:</p>\n\n<pre><code>func UnmarshalJsonObject(jsonStr []byte, obj interface{}, otherFields map[string]json.RawMessage) (err error) {\n    objValue := reflect.ValueOf(obj).Elem()\n    knownFields := map[string]reflect.Value{}\n    for i := 0; i != objValue.NumField(); i++ {\n        jsonName := strings.Split(objValue.Type().Field(i).Tag.Get(\"json\"), \",\")[0]\n        knownFields[jsonName] = objValue.Field(i)\n    }\n\n    err = json.Unmarshal(jsonStr, &amp;otherFields)\n    if err != nil {\n        return\n    }\n\n    for key, chunk := range otherFields {\n        if field, found := knownFields[key]; found {\n            err = json.Unmarshal(chunk, field.Addr().Interface())\n            if err != nil {\n                return\n            }\n            delete(otherFields, key)\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>Here is the complete code on Go Playground - <a href=\"http://play.golang.org/p/EtkJUzMmKt\" rel=\"noreferrer\">http://play.golang.org/p/EtkJUzMmKt</a></p>\n"}, {"tags": [], "owner": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "is_accepted": false, "score": 4, "last_activity_date": 1446555789, "creation_date": 1446555789, "answer_id": 33499861, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/33499861#33499861", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<h1>Single pass, use <code>github.com/ugorji/go/codec</code></h1>\n\n<p>When unmarshaling into a <code>map</code>, <code>encoding/json</code> empties the map, but <code>ugorji/go/codec</code> doesn't. It also attempts to fill existing values, so we can put pointers to foo.A, foo.B into foo.X:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/ugorji/go/codec\"\n)\n\ntype Foo struct {\n    A int\n    B int\n    X map[string]interface{}\n}\n\nfunc (this *Foo) UnmarshalJSON(jsonStr []byte) (err error) {\n    this.X = make(map[string]interface{})\n    this.X[\"a\"] = &amp;this.A\n    this.X[\"b\"] = &amp;this.B\n    return codec.NewDecoderBytes(jsonStr, &amp;codec.JsonHandle{}).Decode(&amp;this.X)\n}\n\nfunc main() {\n    s := `{\"a\":1, \"b\":2, \"x\":3, \"y\":[]}`\n    f := &amp;Foo{}\n    err := codec.NewDecoderBytes([]byte(s), &amp;codec.JsonHandle{}).Decode(f)\n    fmt.Printf(\"err = %v\\n\", err)\n    fmt.Printf(\"%+v\\n\", f)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 980, "user_id": 4764353, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-48IuUHI0z7w/AAAAAAAAAAI/AAAAAAAAAYw/hqtraJsvmR4/photo.jpg?sz=128", "display_name": "Nikolay Shindarov", "link": "https://stackoverflow.com/users/4764353/nikolay-shindarov"}, "edited": false, "score": 1, "creation_date": 1618266185, "post_id": 44308776, "comment_id": 118545894, "body": "It unmarshals this way, but how do you access the values after that?"}], "tags": [], "owner": {"reputation": 2421, "user_id": 445845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vrtJX.jpg?s=128&g=1", "display_name": "Ariel Monaco", "link": "https://stackoverflow.com/users/445845/ariel-monaco"}, "is_accepted": false, "score": 18, "last_activity_date": 1496695331, "last_edit_date": 1496695331, "creation_date": 1496323437, "answer_id": 44308776, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/44308776#44308776", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<p>Simplest way is to use an interface like this: </p>\n\n<pre><code>var f interface{}\ns := `{\"a\":1, \"b\":2, \"x\":1, \"y\":1}`\n\nif err := json.Unmarshal([]byte(s), &amp;f); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HV5bYV4uud\" rel=\"noreferrer\">Go Playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 460593, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/WsDHr.jpg?s=128&g=1", "display_name": "Circuit in the wall", "link": "https://stackoverflow.com/users/460593/circuit-in-the-wall"}, "is_accepted": false, "score": 5, "last_activity_date": 1528407453, "creation_date": 1528407453, "answer_id": 50750516, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/50750516#50750516", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<p>Use Hashicorp's map-to-struct decoder, which keeps track of unused fields: <a href=\"https://godoc.org/github.com/mitchellh/mapstructure#example-Decode--Metadata\" rel=\"noreferrer\">https://godoc.org/github.com/mitchellh/mapstructure#example-Decode--Metadata</a></p>\n\n<p>It's two-pass, but you don't have to use known field names anywhere.</p>\n\n<pre><code>func UnmarshalJson(input []byte, result interface{}) (map[string]interface{}, error) {\n    // unmarshal json to a map\n    foomap := make(map[string]interface{})\n    json.Unmarshal(input, &amp;foomap)\n\n    // create a mapstructure decoder\n    var md mapstructure.Metadata\n    decoder, err := mapstructure.NewDecoder(\n        &amp;mapstructure.DecoderConfig{\n            Metadata: &amp;md,\n            Result:   result,\n        })\n    if err != nil {\n        return nil, err\n    }\n\n    // decode the unmarshalled map into the given struct\n    if err := decoder.Decode(foomap); err != nil {\n        return nil, err\n    }\n\n    // copy and return unused fields\n    unused := map[string]interface{}{}\n    for _, k := range md.Unused {\n        unused[k] = foomap[k]\n    }\n    return unused, nil\n}\n\ntype Foo struct {\n    // Known fields\n    A int\n    B int\n    // Unknown fields\n    X map[string]interface{} // Rest of the fields should go here.\n}\n\nfunc main() {\n    s := []byte(`{\"a\":1, \"b\":2, \"?\":3, \"??\":4}`)\n\n    var foo Foo\n    unused, err := UnmarshalJson(s, &amp;foo)\n    if err != nil {\n        panic(err)\n    }\n\n    foo.X = unused\n    fmt.Println(foo) // prints {1 2 map[?:3 ??:4]}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 175, "user_id": 2307785, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bPHwf.jpg?s=128&g=1", "display_name": "LiamHsia", "link": "https://stackoverflow.com/users/2307785/liamhsia"}, "is_accepted": false, "score": 12, "last_activity_date": 1550488974, "creation_date": 1550488974, "answer_id": 54746165, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names/54746165#54746165", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<p>I use interface to unmarshal uncertain type json.</p>\n\n<pre><code>bytes := []byte(`{\"name\":\"Liam\",\"gender\":1, \"salary\": 1}`)\nvar p2 interface{}\njson.Unmarshal(bytes, &amp;p2)\nm := p2.(map[string]interface{})\nfmt.Println(m)\n</code></pre>\n"}], "owner": {"reputation": 10759, "user_id": 343443, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2dcf7b64ff07a02fbd78c27f50ce9631?s=128&d=identicon&r=PG", "display_name": "Abyx", "link": "https://stackoverflow.com/users/343443/abyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50511, "favorite_count": 19, "answer_count": 7, "score": 66, "last_activity_date": 1571061759, "creation_date": 1446210366, "last_edit_date": 1571061759, "question_id": 33436730, "link": "https://stackoverflow.com/questions/33436730/unmarshal-json-with-some-known-and-some-unknown-field-names", "title": "Unmarshal JSON with some known, and some unknown field names", "body": "<p>I have the following JSON</p>\n\n<pre><code>{\"a\":1, \"b\":2, \"?\":1, \"??\":1}\n</code></pre>\n\n<p>I know that it has the \"a\" and \"b\" fields, but I don't know the names of other fields. So I want to unmarshal it in the following type:</p>\n\n<pre><code>type Foo struct {\n  // Known fields\n  A int `json:\"a\"`\n  B int `json:\"b\"`\n  // Unknown fields\n  X map[string]interface{} `json:???` // Rest of the fields should go here.\n}\n</code></pre>\n\n<p>How do I do that?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1446207587, "post_id": 33435807, "comment_id": 54659688, "body": "Tag dbms used, to get better assistance  - faster."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1446208014, "post_id": 33435807, "comment_id": 54659938, "body": "That&#39;s how slices work. Maybe you could show a shorter and standalone program? In any case: You&#39;ll have to rework your solution."}, {"owner": {"reputation": 13, "user_id": 5408621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/032801532bd9d0a15530f5312ab922dd?s=128&d=identicon&r=PG&f=1", "display_name": "Venser Lin", "link": "https://stackoverflow.com/users/5408621/venser-lin"}, "edited": false, "score": 0, "creation_date": 1446209688, "post_id": 33435807, "comment_id": 54660931, "body": "In a shorter program without sql, that is ok to append the slices."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446210081, "post_id": 33435807, "comment_id": 54661171, "body": "First check for the error of Scan."}], "answers": [{"comments": [{"owner": {"reputation": 227, "user_id": 1244635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ba70d08a40356b43ef51bbfe68b6799?s=128&d=identicon&r=PG", "display_name": "Wayne", "link": "https://stackoverflow.com/users/1244635/wayne"}, "edited": false, "score": 1, "creation_date": 1446221650, "post_id": 33440262, "comment_id": 54668818, "body": "RawBytes is a byte slice that holds a reference to memory owned by the database itself. After a Scan into a RawBytes, the slice is only valid until the next call to Next, Scan, or Close."}, {"owner": {"reputation": 13, "user_id": 5408621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/032801532bd9d0a15530f5312ab922dd?s=128&d=identicon&r=PG&f=1", "display_name": "Venser Lin", "link": "https://stackoverflow.com/users/5408621/venser-lin"}, "edited": false, "score": 0, "creation_date": 1446634645, "post_id": 33440262, "comment_id": 54821433, "body": "Thanks, when I used []byte instead of Rawbytes, it is been OK."}], "tags": [], "owner": {"reputation": 227, "user_id": 1244635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ba70d08a40356b43ef51bbfe68b6799?s=128&d=identicon&r=PG", "display_name": "Wayne", "link": "https://stackoverflow.com/users/1244635/wayne"}, "is_accepted": true, "score": -1, "last_activity_date": 1446221139, "last_edit_date": 1592644375, "creation_date": 1446221139, "answer_id": 33440262, "question_id": 33435807, "link": "https://stackoverflow.com/questions/33435807/how-to-avoid-slice-reference-to-the-same-memory-block/33440262#33440262", "title": "How to avoid slice reference to the same memory block", "body": "<p>according to the document of Rows (<a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#Rows.Scan</a>):</p>\n<hr />\n<p>Scan copies the columns in the current row into the values pointed at by dest.</p>\n<p>If an argument has type *[]byte, Scan saves in that argument a copy of the corresponding data. The copy is owned by the caller and can be modified and held indefinitely. The copy can be avoided by using an argument of type *RawBytes instead; see the documentation for RawBytes for restrictions on its use.</p>\n<p>If an argument has type *interface{}, Scan copies the value provided by the underlying driver without conversion. If the value is of type []byte, a copy is made and the caller owns the result.</p>\n<hr />\n<p>in your case, you use RawBytes as argument of Scan. That might be the problem you got. Try other type as argument of Scan function.</p>\n"}], "owner": {"reputation": 13, "user_id": 5408621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/032801532bd9d0a15530f5312ab922dd?s=128&d=identicon&r=PG&f=1", "display_name": "Venser Lin", "link": "https://stackoverflow.com/users/5408621/venser-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 1, "accepted_answer_id": 33440262, "answer_count": 1, "score": 1, "last_activity_date": 1446718801, "creation_date": 1446207460, "last_edit_date": 1592644375, "question_id": 33435807, "link": "https://stackoverflow.com/questions/33435807/how-to-avoid-slice-reference-to-the-same-memory-block", "title": "How to avoid slice reference to the same memory block", "body": "<p>I met a problem when query from Database and tried to insert into a slice(contains some map[string]interface{})\nEven I already used make to create a new memory block, the slice seems always mapping to a same memory block.</p>\n<pre><code>type DBResult []map[string]interface{}\n\nfunc ResultRows(rows *sql.Rows, limit int) (DBResult, error) {\n    cols, err := rows.Columns()\n    if err != nil {\n        return nil, err\n    }\n\n    vals := make([]sql.RawBytes, len(cols))\n    scanArgs := make([]interface{}, len(vals))\n    for i := range vals {\n        scanArgs[i] = &amp;vals[i]\n    }\n\n    if limit &gt; QUERY_HARD_LIMIT {\n        limit = QUERY_HARD_LIMIT\n    }\n\n    res := make(DBResult, 0, limit)\n    for rows.Next() {\n        err = rows.Scan(scanArgs...)\n        m := make(map[string]interface{})\n\n        for i := range vals {\n            m[cols[i]] = vals[i]\n        }\n        /* Append m to res */\n        res = append(res, m)\n        /* The value of m has been changed */\n        fmt.Printf(&quot;lib: m:\\n\\n%s\\n\\n&quot;, m)\n        /* When printing res, always mapping to the same memory block */\n        fmt.Printf(&quot;lib: res:\\n\\n%s\\n\\n&quot;, res)\n    }\n\n    return res, err\n}\n</code></pre>\n<p>The following is the result, you can find the contents of res are the same</p>\n<blockquote>\n<p>m = map[comment:first_comment id:0]</p>\n<p>res = [map[id:0 comment:first_comment]]</p>\n<p>m = map[id:1 comment:first_comment]</p>\n<p>res = [map[id:1 comment:first_comment] map[id:1 comment:first_comment]]</p>\n<p>m = map[id:2 comment:first_comment]</p>\n<p>res = [map[id:2 comment:first_comment] map[id:2 comment:first_comment] map[id:2 comment:first_comment]]</p>\n</blockquote>\n<p>My expect of res = [map[id:0 comment:first_comment] map[id:1 comment:first_comment] map[id:2 comment:first_comment]]</p>\n<p>Thanks for watching</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 32, "last_activity_date": 1446196668, "creation_date": 1446196668, "answer_id": 33432435, "question_id": 33432192, "link": "https://stackoverflow.com/questions/33432192/handlefunc-being-called-twice/33432435#33432435", "title": "HandleFunc being called twice", "body": "<p>Just log the requests. You will realize that your browser also requests /favicon.ico.</p>\n\n<p>See <a href=\"https://en.wikipedia.org/wiki/Favicon\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Favicon</a> for more information.</p>\n"}, {"tags": [], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "is_accepted": false, "score": 2, "last_activity_date": 1446323959, "creation_date": 1446323959, "answer_id": 33456373, "question_id": 33432192, "link": "https://stackoverflow.com/questions/33432192/handlefunc-being-called-twice/33456373#33456373", "title": "HandleFunc being called twice", "body": "<p>As Didier says, it's your browser trying to load the favicon. You can prevent this by adding this code to the &lt;head&gt;:</p>\n\n<pre><code>&lt;link rel=\"icon\" type=\"image/png\" href=\"data:image/png;base64,iVBORw0KGgo=\"&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "is_accepted": false, "score": 10, "last_activity_date": 1567000803, "last_edit_date": 1567000803, "creation_date": 1566939745, "answer_id": 57682227, "question_id": 33432192, "link": "https://stackoverflow.com/questions/33432192/handlefunc-being-called-twice/57682227#57682227", "title": "HandleFunc being called twice", "body": "<p>If you request from a service is fine, but if you test from a browser and is not the production intention you can do this in golang code for avoid browser load the favicon:</p>\n\n<pre><code>http.HandleFunc(\"/favicon.ico\", doNothing)\n</code></pre>\n\n<p>And the function </p>\n\n<pre><code>func doNothing(w http.ResponseWriter, r *http.Request){}\n</code></pre>\n\n<p>For people voting negatives: this works, sorry for handle it with this code in an api that doesn't need favicon or whatever...</p>\n"}], "owner": {"reputation": 4210, "user_id": 395670, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6AFVw.jpg?s=128&g=1", "display_name": "Dharmit", "link": "https://stackoverflow.com/users/395670/dharmit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2934, "favorite_count": 1, "accepted_answer_id": 33432435, "answer_count": 3, "score": 9, "last_activity_date": 1567000803, "creation_date": 1446195853, "question_id": 33432192, "link": "https://stackoverflow.com/questions/33432192/handlefunc-being-called-twice", "title": "HandleFunc being called twice", "body": "<p>I am following a <a href=\"http://thenewstack.io/building-a-web-server-in-go/\" rel=\"noreferrer\">simple web server example</a> in Go.</p>\n\n<p>I inserted a <code>log</code> statement so that the resulting code looks like below:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"Hello world!\")\n    log.Println(\"hello.\")\n}\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", hello)\n    http.ListenAndServe(\":8000\", mux)\n}\n</code></pre>\n\n<p>Problem is that whenever I load port 8000 in my web browser, this function is called twice. This is an issue because I intend to increment a counter on each page visit. With this behavior, counter gets incremented twice. OTOH, if I do <code>curl localhost:8000</code>, it is called only once.</p>\n\n<p>I feel it's something really silly that I am missing here.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 4, "last_activity_date": 1446188560, "last_edit_date": 1490004260, "creation_date": 1446188560, "answer_id": 33430428, "question_id": 33430341, "link": "https://stackoverflow.com/questions/33430341/add-pause-and-resume-functionality-while-downloading/33430428#33430428", "title": "Add Pause and Resume functionality while downloading", "body": "<p>You don't really \"pause\" a download. You can only cancel it. You can do that on an <code>http.Request</code> by doing <code>close(req.Cancel)</code>.</p>\n\n<p>\"Resuming\" a download is really just making the same request again, but telling the server where to start. Usually by setting a \"Range\" header.</p>\n\n<p><a href=\"https://superuser.com/a/641957/8301\">This question</a> on superuser explains a bit better how it works usually. You will probably need to provide more details if you want us to help you further.</p>\n"}], "owner": {"reputation": 117, "user_id": 5467814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/522f564d07b0b386f7c867a7df919a72?s=128&d=identicon&r=PG&f=1", "display_name": "Nitin", "link": "https://stackoverflow.com/users/5467814/nitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1446219903, "creation_date": 1446188224, "last_edit_date": 1446219903, "question_id": 33430341, "link": "https://stackoverflow.com/questions/33430341/add-pause-and-resume-functionality-while-downloading", "title": "Add Pause and Resume functionality while downloading", "body": "<p>I am using <a href=\"https://play.golang.org/p/1LAEuOS-09\" rel=\"nofollow\">this</a> approach for downloading any file from the given URL. I want to add pause and resume functionality while downloading. I tried to use channels but was not able to succeed.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1446212473, "post_id": 33430169, "comment_id": 54662816, "body": "A connection is only &quot;active&quot; if it&#39;s being used. You maintain the connection state by using it, and you detect a closed connection by reading from it."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 4, "last_activity_date": 1446190427, "creation_date": 1446190427, "answer_id": 33430831, "question_id": 33430169, "link": "https://stackoverflow.com/questions/33430169/how-to-check-if-a-conn-is-active-without-sending-receiving-data/33430831#33430831", "title": "How to check if a Conn is active without sending/receiving data?", "body": "<p>I don't think it is possible to do without performing an operation. If it is infrequently used, when you try to read you may get an error if the client (or some proxy) closed the connection. If that happens then reconnect and retry. </p>\n\n<p>Many protocols will bake in a heartbeat mechanism to facilitate this kind of thing. Then you can read constantly (with SetDeadline if you want) and know within a heartbeat frame that something went wrong.</p>\n\n<p>For example, I use a redis client that supports connection pooling. When I retrieve an idele connection from the pool, I immediately perform a PING operation. If that succeeds, I know the connection is ready to use. If not, I get another idle one, or connect anew.</p>\n"}], "owner": {"reputation": 6987, "user_id": 816415, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6718587772b15f57b3e7923aee8420ea?s=128&d=identicon&r=PG", "display_name": "gextra", "link": "https://stackoverflow.com/users/816415/gextra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 0, "accepted_answer_id": 33430831, "answer_count": 1, "score": 2, "last_activity_date": 1446190427, "creation_date": 1446187366, "question_id": 33430169, "link": "https://stackoverflow.com/questions/33430169/how-to-check-if-a-conn-is-active-without-sending-receiving-data", "title": "How to check if a Conn is active without sending/receiving data?", "body": "<p>In Go/Golang, once a connection object (Conn) is created with the following code:</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\",\"33.33.33.33:444\")\nif err != nil {\n  // good connection\n}\n</code></pre>\n\n<p>I would like to preserve the <strong>conn</strong> value for later on verifying if the connection is active. I dont want to re-connect from time to time to check the connection as it causes various TIME_WAITs on the OS, so overall my requirements are:</p>\n\n<ul>\n<li>create a connection</li>\n<li>preserve the connection object</li>\n<li>capture if the connection drops for any reason</li>\n<li><strong>do not send or receive any data</strong></li>\n</ul>\n\n<p>Any thoughts on how to achieve this ? Is there a way to capture that the connection is discontinued without sending or receiving data or reconnecting ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1446189318, "post_id": 33430025, "comment_id": 54649452, "body": "Please show full output of <code>go env</code>"}, {"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1446189461, "post_id": 33430025, "comment_id": 54649509, "body": "@Volker added full output of <code>go env</code> above"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1446190686, "post_id": 33430025, "comment_id": 54650031, "body": "I have not had success with source files off of <code>&#47;src&#47;call&#47;foo.go</code>. I think the go tool may need an additional level of nesting."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1446191197, "post_id": 33430025, "comment_id": 54650241, "body": "Please provide a minimal example that reproduces the issue.  I just tried with two files <code>$GOPATH&#47;src&#47;foo&#47;foo.go</code> which simply declares an exported constant <code>const Foo = 8</code>, and <code>$GOPATH&#47;src&#47;foo&#47;bar&#47;bar.go</code> which imports &quot;foo&quot; and sets a variable <code>var Bar = foo.Foo</code>.  Then from the <code>bar</code> directory I ran <code>go build</code> and did not see any errors."}], "answers": [{"comments": [{"owner": {"reputation": 1226, "user_id": 1716905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf004baf04689322a8766ebc1efd5e07?s=128&d=identicon&r=PG&f=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/1716905/luke"}, "edited": false, "score": 0, "creation_date": 1565166925, "post_id": 33431249, "comment_id": 101262727, "body": "Same happened to me with some procedurally generated proto imports. This spared me from a huge headache!"}], "tags": [], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "is_accepted": true, "score": 1, "last_activity_date": 1446192313, "creation_date": 1446192313, "answer_id": 33431249, "question_id": 33430025, "link": "https://stackoverflow.com/questions/33430025/golang-compile-error-cant-find-import/33431249#33431249", "title": "golang compile error: can&#39;t find import", "body": "<p>It was kinda \"cache\" issue. After I change couple lines in <code>$GOPATH/src/call</code>, I become able to build in <code>$GOPATH/src/call/httptest</code> without that import error.</p>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4140, "favorite_count": 0, "accepted_answer_id": 33431249, "answer_count": 1, "score": -3, "last_activity_date": 1446192313, "creation_date": 1446186684, "last_edit_date": 1446189430, "question_id": 33430025, "link": "https://stackoverflow.com/questions/33430025/golang-compile-error-cant-find-import", "title": "golang compile error: can&#39;t find import", "body": "<p>I am trying to run <code>go build</code> command in a directory <code>$GOPATH/src/call/httptest</code>:</p>\n\n<pre><code>maks@myMac ~/Dropbox/golang/src/call/httptest $ go build\n# call/httptest\n./domain.go:4: can't find import: \"call\"\n</code></pre>\n\n<p>Have error <code>./domain.go:4: can't find import: \"call\"</code></p>\n\n<p>The beginning of <code>domain.go</code> file:</p>\n\n<pre><code>package httptest\n\nimport (\n    \"call\" // line 4 - error is here\n)\n</code></pre>\n\n<p>I can successfully build in <code>$GOPATH/src/call</code> directory:</p>\n\n<pre><code>maks@myMac ~/Dropbox/golang/src/call $ go build\n</code></pre>\n\n<p><strong>Why</strong> can't I import <code>call</code> in <code>$GOPATH/src/call/httptest/domain.go</code> file although <code>call</code> is  in <code>$GOPATH/src</code> directory?</p>\n\n<p>Gopath is the following:</p>\n\n<pre><code>$ echo $GOPATH\n/Users/maks/Dropbox/golang\n\n$ go version\ngo version go1.4.3 darwin/amd64\n</code></pre>\n\n<h1>Update</h1>\n\n<pre><code>$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/maks/Dropbox/golang\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"0\"\n</code></pre>\n"}, {"tags": ["go", "tags", "field"], "answers": [{"tags": [], "owner": {"reputation": 15505, "user_id": 857238, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e7efe5b6a2b92bb52c23a639b88b544c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/857238/chris"}, "is_accepted": true, "score": 10, "last_activity_date": 1446166443, "creation_date": 1446166443, "answer_id": 33427237, "question_id": 33427201, "link": "https://stackoverflow.com/questions/33427201/how-to-access-variable-tags-in-golang/33427237#33427237", "title": "How to access variable tags in golang?", "body": "<p>You would use reflection. See <a href=\"https://golang.org/pkg/reflect/#example_StructTag\">this</a> example from the go docs:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    type S struct {\n        F string `species:\"gopher\" color:\"blue\"`\n    }\n\n    s := S{}\n    st := reflect.TypeOf(s)\n    field := st.Field(0)\n    fmt.Println(field.Tag.Get(\"color\"), field.Tag.Get(\"species\"))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1256, "favorite_count": 1, "accepted_answer_id": 33427237, "answer_count": 1, "score": 1, "last_activity_date": 1446166443, "creation_date": 1446166189, "question_id": 33427201, "link": "https://stackoverflow.com/questions/33427201/how-to-access-variable-tags-in-golang", "title": "How to access variable tags in golang?", "body": "<p>I'm curious on how to access variable tags in golang. I know JSON uses them like this:</p>\n\n<pre><code>type Foo struct {\n    Bar string `json:\"-\"`\n}\n</code></pre>\n\n<p>But I can't seem to find a way to access those tags in code for my own use. How can I get those values so I can use them in code?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 3, "last_activity_date": 1446166836, "creation_date": 1446166836, "answer_id": 33427281, "question_id": 33426977, "link": "https://stackoverflow.com/questions/33426977/how-to-golang-check-a-variable-is-nil/33427281#33427281", "title": "how to golang check a variable is nil", "body": "<p>content is nil by default, don't need to assign it</p>\n\n<p>also, you are ignoring the error returned from NewRequest, don't do that.  It is telling you why it can't generate a request.</p>\n\n<p>Normal error handling would be something like:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://www.github.com\", content)\nif err != nil {\n  // log or complain... req is nil here\n} else {\n  // do something with req\n}\n</code></pre>\n\n<p>all that said if you really just want to know if req is nil, do:</p>\n\n<pre><code>if req == nil { \n // handle nil req\n} else {\n // use req\n}\n</code></pre>\n\n<p>but as mentioned before, it's much better to handle the error.  if err not nil, then you basically can't trust req to be anything valid.</p>\n"}, {"comments": [{"owner": {"reputation": 685, "user_id": 2151287, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aea53781b823a637e50add15cb9aa111?s=128&d=identicon&r=PG", "display_name": "sundq", "link": "https://stackoverflow.com/users/2151287/sundq"}, "edited": false, "score": 0, "creation_date": 1446428642, "post_id": 33427907, "comment_id": 54724492, "body": "But why <code>content == nil</code> return <code>true</code>"}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "reply_to_user": {"reputation": 685, "user_id": 2151287, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aea53781b823a637e50add15cb9aa111?s=128&d=identicon&r=PG", "display_name": "sundq", "link": "https://stackoverflow.com/users/2151287/sundq"}, "edited": false, "score": 0, "creation_date": 1446429006, "post_id": 33427907, "comment_id": 54724603, "body": "Because bytes.Reader is a struct, not an Interface. But http.NewRequest takes an io.Reader, which is an interface. You hand it over a type, but with no value -&gt; the interface is not nil."}], "tags": [], "owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "is_accepted": true, "score": 5, "last_activity_date": 1446210304, "last_edit_date": 1446210304, "creation_date": 1446173579, "answer_id": 33427907, "question_id": 33426977, "link": "https://stackoverflow.com/questions/33426977/how-to-golang-check-a-variable-is-nil/33427907#33427907", "title": "how to golang check a variable is nil", "body": "<p>A go interface consists of a type and a value. An interface is only nil if both the type and the value are nil. You provided a type but no value: Therefore <code>NewRequest</code> tried to call Read on a nil struct (the value of the interface).</p>\n"}, {"tags": [], "owner": {"reputation": 1132, "user_id": 802708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e09e053ee837abb1096ca3447b88972?s=128&d=identicon&r=PG", "display_name": "tangxinfa", "link": "https://stackoverflow.com/users/802708/tangxinfa"}, "is_accepted": false, "score": 0, "last_activity_date": 1618200490, "creation_date": 1618200490, "answer_id": 67052554, "question_id": 33426977, "link": "https://stackoverflow.com/questions/33426977/how-to-golang-check-a-variable-is-nil/67052554#67052554", "title": "how to golang check a variable is nil", "body": "<p>It is a classic trap of the golang language.</p>\n<p>To check if it is a real Nil:</p>\n<pre><code>p == nil || reflect.ValueOf(p).IsNil()\n</code></pre>\n<p>Reference:\n<a href=\"https://www.mangatmodi.com/posts/go-check-nil-interface-the-right-way/\" rel=\"nofollow noreferrer\">https://www.mangatmodi.com/posts/go-check-nil-interface-the-right-way/</a></p>\n"}], "owner": {"reputation": 685, "user_id": 2151287, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aea53781b823a637e50add15cb9aa111?s=128&d=identicon&r=PG", "display_name": "sundq", "link": "https://stackoverflow.com/users/2151287/sundq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18062, "favorite_count": 1, "accepted_answer_id": 33427907, "answer_count": 3, "score": 5, "last_activity_date": 1618200490, "creation_date": 1446164601, "last_edit_date": 1446181566, "question_id": 33426977, "link": "https://stackoverflow.com/questions/33426977/how-to-golang-check-a-variable-is-nil", "title": "how to golang check a variable is nil", "body": "<p>my code is like this, when I use <code>req, _ := http.NewRequest(\"GET\", \"http://www.github.com\", content)</code>, it will emit exception:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0xffffffff addr=0x0 pc=0xaab78]\n\ngoroutine 1 [running]:\nnet/http.NewRequest(0x34f3b8, 0x3, 0x378020, 0x15, 0xfeec4350, 0x0, 0x10738801, 0x0, 0x0, 0x107000e0)\n    /usr/local/go/src/net/http/request.go:570 +0x498\nmain.main()\n    /tmp/sandbox056954284/main.go:17 +0xe0\n</code></pre>\n\n<p>but when I use <code>req, _ := http.NewRequest(\"GET\", \"http://www.github.com\", nil)</code>, it works, why? how I set the third argument value  </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"net/http\"\n)\n\n\nfunc main() {\n    client := &amp;http.Client{}\n    var content *bytes.Reader\n    content = nil\n    req, _ := http.NewRequest(\"GET\", \"http://www.github.com\", content)\n    resp, _ := client.Do(req)\n    defer resp.Body.Close()\n}\n</code></pre>\n"}, {"tags": ["html", "css", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1446167520, "post_id": 33426830, "comment_id": 54643604, "body": "Use Go&#39;s <code>html&#47;template</code> package - see here for an example: <a href=\"https://golang.org/doc/articles/wiki/#tmp_6\" rel=\"nofollow noreferrer\">golang.org/doc/articles/wiki/#tmp_6</a>"}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "edited": false, "score": 0, "creation_date": 1446174720, "post_id": 33426830, "comment_id": 54644851, "body": "Definitely check out the html/template package. Also, if you&#39;re open to using other packages, something like <a href=\"http://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin</a> is an alternative to gorilla/mux that includes template handling. You can use gin to serve static files like css/js as well as template files like html."}], "owner": {"reputation": 105, "user_id": 4359590, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ckOk8.png?s=128&g=1", "display_name": "nolem", "link": "https://stackoverflow.com/users/4359590/nolem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 932, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1446163621, "creation_date": 1446163621, "question_id": 33426830, "link": "https://stackoverflow.com/questions/33426830/showing-html-templates-with-handler-responses-golang", "title": "Showing html templates with handler responses (Golang)", "body": "<p>I have a simple login system written in Go. Right now I have the login screen and internal page stored as constants. I would like to use .html files instead of the constants, as I cannot use CSS styling right now and I would like to style the login screen with Bootstrap.</p>\n\n<p>main.go file right now:</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"github.com/gorilla/mux\"\n        \"github.com/gorilla/securecookie\"\n        \"net/http\"\n    )\n\n    // cookie handling\n\n    var cookieHandler = securecookie.New(\n        securecookie.GenerateRandomKey(64),\n        securecookie.GenerateRandomKey(32))\n\n    func getUserName(request *http.Request) (userName string) {\n        if cookie, err := request.Cookie(\"session\"); err == nil {\n            cookieValue := make(map[string]string)\n            if err = cookieHandler.Decode(\"session\", cookie.Value, &amp;cookieValue); err == nil {\n                userName = cookieValue[\"name\"]\n            }\n        }\n        return userName\n    }\n\n    func setSession(userName string, response http.ResponseWriter) {\n        value := map[string]string{\n            \"name\": userName,\n        }\n        if encoded, err := cookieHandler.Encode(\"session\", value); err == nil {\n            cookie := &amp;http.Cookie{\n                Name:  \"session\",\n                Value: encoded,\n                Path:  \"/\",\n            }\n            http.SetCookie(response, cookie)\n        }\n    }\n\n    func clearSession(response http.ResponseWriter) {\n        cookie := &amp;http.Cookie{\n            Name:   \"session\",\n            Value:  \"\",\n            Path:   \"/\",\n            MaxAge: -1,\n        }\n        http.SetCookie(response, cookie)\n    }\n\n    // login handler\n\n    func loginHandler(response http.ResponseWriter, request *http.Request) {\n        name := request.FormValue(\"name\")\n        pass := request.FormValue(\"password\")\n        redirectTarget := \"/\"\n        if name != \"\" &amp;&amp; pass != \"\" {\n            // .. check credentials ..\n            setSession(name, response)\n            redirectTarget = \"/internal\"\n        }\n        http.Redirect(response, request, redirectTarget, 302)\n    }\n\n    // logout handler\n\n    func logoutHandler(response http.ResponseWriter, request *http.Request) {\n        clearSession(response)\n        http.Redirect(response, request, \"/\", 302)\n    }\n\n    // index page\n\n    const indexPage = `\n    &lt;h1&gt;Login&lt;/h1&gt;\n    &lt;form method=\"post\" action=\"/login\"&gt;\n        &lt;label for=\"name\"&gt;User name&lt;/label&gt;\n        &lt;input type=\"text\" id=\"name\" name=\"name\"&gt;\n        &lt;label for=\"password\"&gt;Password&lt;/label&gt;\n        &lt;input type=\"password\" id=\"password\" name=\"password\"&gt;\n        &lt;button type=\"submit\"&gt;Login&lt;/button&gt;\n    &lt;/form&gt;\n    `\n\n    func indexPageHandler(response http.ResponseWriter, request *http.Request) {\n        fmt.Fprintf(response, indexPage)\n    }\n\n    // internal page\n\n    const internalPage = `\n    &lt;h1&gt;Internal&lt;/h1&gt;\n    &lt;hr&gt;\n    &lt;small&gt;User: %s&lt;/small&gt;\n    &lt;form method=\"post\" action=\"/logout\"&gt;\n        &lt;\n\nbutton type=\"submit\"&gt;Logout&lt;/button&gt;\n&lt;/form&gt;\n`\n\nfunc internalPageHandler(response http.ResponseWriter, request *http.Request) {\n    userName := getUserName(request)\n    if userName != \"\" {\n        fmt.Fprintf(response, internalPage, userName)\n    } else {\n        http.Redirect(response, request, \"/\", 302)\n    }\n}\n\n// server main method\n\nvar router = mux.NewRouter()\n\nfunc main() {\n\n    router.HandleFunc(\"/\", indexPageHandler)\n    router.HandleFunc(\"/internal\", internalPageHandler)\n\n    router.HandleFunc(\"/login\", loginHandler).Methods(\"POST\")\n    router.HandleFunc(\"/logout\", logoutHandler).Methods(\"POST\")\n\n    http.Handle(\"/\", router)\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>How can I use indexPage.html and internalPage.html instead of the indexPage and internalPage constants?</p>\n"}, {"tags": ["go", "types", "bit"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1446156239, "post_id": 33425374, "comment_id": 54639914, "body": "You might be looking for something like this; <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/binary</a> you can store small values as a byte, not so sure about storing values that are one and a half bytes, you&#39;ll probably have to round up and put it in a 2byte buffer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446212992, "post_id": 33425374, "comment_id": 54663161, "body": "A more common pattern in most programming languages (and used throughout Go) is a bitmap to hold up to 8 values per byte: <a href=\"http://play.golang.org/p/DZj9FerK19\" rel=\"nofollow noreferrer\">play.golang.org/p/DZj9FerK19</a>"}], "answers": [{"comments": [{"owner": {"reputation": 664, "user_id": 2055586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4e555de2baf5375726fc5db8ba02506?s=128&d=identicon&r=PG", "display_name": "rigsby", "link": "https://stackoverflow.com/users/2055586/rigsby"}, "edited": false, "score": 1, "creation_date": 1446160323, "post_id": 33425724, "comment_id": 54641539, "body": "<a href=\"http://stackoverflow.com/a/4626993/2055586\"><i>basic addressable unit</i></a>, interesting, very cool thanks for the quick reply."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1446157655, "creation_date": 1446157655, "answer_id": 33425724, "question_id": 33425374, "link": "https://stackoverflow.com/questions/33425374/custom-length-bit-types-in-go/33425724#33425724", "title": "Custom length bit types in Go?", "body": "<p>No. The minimum size of a Go type in current implementations, including type <code>bool</code>, is one byte, .</p>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n"}], "owner": {"reputation": 664, "user_id": 2055586, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4e555de2baf5375726fc5db8ba02506?s=128&d=identicon&r=PG", "display_name": "rigsby", "link": "https://stackoverflow.com/users/2055586/rigsby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 1, "accepted_answer_id": 33425724, "answer_count": 1, "score": 4, "last_activity_date": 1446184993, "creation_date": 1446155992, "last_edit_date": 1446184993, "question_id": 33425374, "link": "https://stackoverflow.com/questions/33425374/custom-length-bit-types-in-go", "title": "Custom length bit types in Go?", "body": "<p>In Go is it possible to define a custom type with a number of bits other than those offered by <code>byte uint uint16</code> or any of the other built-in types?</p>\n\n<p>I'm planning on using \"just enough bits\" to represent variables and wanted a 6-bit and a 4-bit type. Perhaps a composite bool type? </p>\n\n<pre><code>type fourbit struct{\n    ones   bool\n    twos   bool\n    fours  bool\n    eights bool\n}\n</code></pre>\n\n<p>Though this sort of thing is quite messy and it would be nice to have a more general solution for n-bit types. </p>\n"}, {"tags": ["go", "orm", "beego"], "comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1446153193, "post_id": 33418735, "comment_id": 54638517, "body": "How do you do your query? You use RelatedSel?"}, {"owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446381680, "post_id": 33418735, "comment_id": 54710259, "body": "Bad code formatting in commend pleas take a look into the answer part."}], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "is_accepted": true, "score": 1, "last_activity_date": 1543907877, "last_edit_date": 1543907877, "creation_date": 1448139046, "answer_id": 33848425, "question_id": 33418735, "link": "https://stackoverflow.com/questions/33418735/beego-orm-relation-doesnt-work/33848425#33848425", "title": "Beego orm - Relation doesn&#39;t work", "body": "<pre><code>num, err := qs\n    .Limit(4)\n    .Filter(\"status\", true)\n    .RelatedSel()\n    .Exclude(\"useritem__userid\", 1)\n    .OrderBy(\"-id\")\n    .All(&amp;movies)\n</code></pre>\n\n<blockquote>\n  <p>all works fine. :) <code>.RelatedSel()</code></p>\n</blockquote>\n"}], "owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1777, "favorite_count": 0, "accepted_answer_id": 33848425, "answer_count": 1, "score": 1, "last_activity_date": 1543907877, "creation_date": 1446133391, "question_id": 33418735, "link": "https://stackoverflow.com/questions/33418735/beego-orm-relation-doesnt-work", "title": "Beego orm - Relation doesn&#39;t work", "body": "<p>in the following model:</p>\n\n<pre><code>package models\n\nimport \"github.com/astaxie/beego/orm\"\n\ntype Movie struct {\n    Id      int    `orm:\"pk; auto; column(id)\"; form: \"-\"`\n    Title   string `orm:\"unique; column(title)\"; form: \"title, text, title:`\n    Plot    string `orm:\"column(plot)\"; form: \"plot, text, plot:\"`\n    ImdbID  string `orm:\"column(imdb_id)\"; form: \"imdb_id, text, imdb_id:\"`\n    Actors  string `orm:\"column(actors)\"; form: \"actors, text, actors:\"`\n    Runtime string `orm:\"column(runtime)\"; form: \"runtime, text, runtime:\"`\n    Year    string `orm:\"column(year)\"; form: \"year, text, year:\"`\n    Genre   *Genre `orm:\"rel(fk); on_delete(do_nothing)\"`\n    Cover   string `orm:\"column(cover)\"; form: \"cover, text, cover:\"`\n    Status  int    `orm:\"column(status)\"; form: \"status, int, status:\"`\n}\n\nfunc (a *Movie) TableName() string {\n    return \"app_movie\"\n}\n\nfunc init() {\n    orm.RegisterModel(new(Movie))\n}\n</code></pre>\n\n<p>I would like to refer to: the genre model, which looks like:</p>\n\n<pre><code>package models\n\nimport \"github.com/astaxie/beego/orm\"\n\ntype Genre struct {\n    Id     int    `orm:\"pk; auto; column(id)\"; form: \"-\"`\n    Title  string `orm:\"unique; column(title)\"; form: \"title, text, title:`\n    Status int    `orm:\"column(status)\"; form: \"status, int, status:\"`\n}\n\nfunc (a *Genre) TableName() string {\n    return \"app_genre\"\n}\n\nfunc init() {\n    orm.RegisterModel(new(Genre))\n}\n</code></pre>\n\n<p>For information it goes to an sqlite db with data (DB first).</p>\n\n<p>In the controller i iterate over a list of movies and print out: movie.Genre.Title but its empty. If I watch on movie.Genre I get: {3 0}</p>\n\n<p>What to do to get to the title and the ID? Or. what am I doing wrong?</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["go", "io", "metadata", "gzip"], "comments": [{"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 2, "creation_date": 1446133327, "post_id": 33418110, "comment_id": 54626883, "body": "Is it by chance that you use a <code>tar.gz</code> file instead of a JSON file compressed with gzip?"}, {"owner": {"reputation": 4804, "user_id": 1269281, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/ENmA7.jpg?s=128&g=1", "display_name": "bachr", "link": "https://stackoverflow.com/users/1269281/bachr"}, "reply_to_user": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 0, "creation_date": 1446133582, "post_id": 33418110, "comment_id": 54627067, "body": "I compressed the json file with <code>tar -czf data.tar.gz data.json</code>, are there other ways??"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1446133747, "post_id": 33418110, "comment_id": 54627199, "body": "Yes there are other ways :-). Running <code>tar</code> and running <code>gzip</code> produces different output."}], "answers": [{"tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": true, "score": 0, "last_activity_date": 1446158096, "creation_date": 1446158096, "answer_id": 33425822, "question_id": 33418110, "link": "https://stackoverflow.com/questions/33418110/how-to-remove-the-gzip-header-metada-from-decompressed-file/33425822#33425822", "title": "How to remove the gzip header metada from decompressed file", "body": "<p>You generated your compressed file as an <em>archive</em>. The difference between compressing something and creating a compressed archive is, that an archive is a file format to contain more than one file, or complex structure (such as a file structure with folders).</p>\n\n<p><code>tar -cz &lt;input files&gt;</code> creates an <em>archive</em> and compresses that using gzip, so you can have more than one file in a compressed tar archive.</p>\n\n<p>To compress a file in a typical UNIX/Linux environment, use the <code>gzip</code> command:</p>\n\n<pre><code>$ gzip foo.json\n</code></pre>\n\n<p>This will create a file <code>foo.json.gz</code> for you. To access its contents, use <code>gunzip</code> or <code>zcat</code>:</p>\n\n<pre><code>$ zcat foo.json.gz\n&lt;contents of foo.json&gt;\n\n$ gunzip foo.json.gz\n$ cat foo.json\n</code></pre>\n"}], "owner": {"reputation": 4804, "user_id": 1269281, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/ENmA7.jpg?s=128&g=1", "display_name": "bachr", "link": "https://stackoverflow.com/users/1269281/bachr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1387, "favorite_count": 0, "accepted_answer_id": 33425822, "answer_count": 1, "score": 0, "last_activity_date": 1553338941, "creation_date": 1446131854, "last_edit_date": 1553338941, "question_id": 33418110, "link": "https://stackoverflow.com/questions/33418110/how-to-remove-the-gzip-header-metada-from-decompressed-file", "title": "How to remove the gzip header metada from decompressed file", "body": "<p>I've a gzip file that I try to decompress and save the result as follows:</p>\n\n<pre><code>bytesReader := bytes.NewReader(gzipData)\ngzipReader, err := gzip.NewReader(bytesReader)\ndefer gzipReader.Close()\nif err == nil {\n    u1 := uuid.NewV4()\n    filename := u1.String() + \".json\"\n    file, _ := os.Create(filename)\n    defer file.Close()\n    fileWriter := bufio.NewWriter(file)\n    io.Copy(fileWriter, gzipReader)\n    fileWriter.Flush()\n} else {\n    log.Println(err.Error())\n}\n</code></pre>\n\n<p>When I check the resulting <code>json</code> file, I see that it starts with some metadata as follows:</p>\n\n<pre><code>$ head -n 1 caf12e7b-e5e5-4453-ac0f-4d1d02770632.json\ndata.json000644 000765 000024 00001562330 12614372206 013272 0ustar00elsoufystaff000000 000000 {... json content ...}\n</code></pre>\n\n<p>I'm getting this header whether the original file was created with <code>gzip data.json</code> or <code>tar -czf data.tar.gz data.json</code>. How I can remove the few first bytes from beeing writing to the output file?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 10, "last_activity_date": 1446133536, "last_edit_date": 1446133536, "creation_date": 1446132204, "answer_id": 33418254, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/33418254#33418254", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<blockquote>\n  <p><a href=\"https://tour.golang.org/\" rel=\"noreferrer\">A Tour of Go</a></p>\n  \n  <p>Exercise: Stringers</p>\n  \n  <p>Make the <code>IPAddr</code> type implement <code>fmt.Stringer</code> to print the address as a\n  dotted quad.</p>\n  \n  <p>For instance, <code>IPAddr{1, 2, 3, 4}</code> should print as <code>\"1.2.3.4</code>\".</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IPAddr [4]byte\n\n// TODO: Add a \"String() string\" method to IPAddr.\n\nfunc main() {\n  addrs := map[string]IPAddr{\n      \"loopback\":  {127, 0, 0, 1},\n      \"googleDNS\": {8, 8, 8, 8},\n  }\n  for n, a := range addrs {\n      fmt.Printf(\"%v: %v\\n\", n, a)\n  }\n}\n</code></pre>\n</blockquote>\n\n<p>There is no implicit conversion of <code>[]string</code> to <code>[]interface {}</code>. See <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Conversions</a> in <a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a>. You need to provide an explicit conversion. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IPAddr [4]byte\n\n// A \"String() string\" method for IPAddr.\nfunc (a IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", a[0], a[1], a[2], a[3])\n}\n\nfunc main() {\n    addrs := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for n, a := range addrs {\n        fmt.Printf(\"%v: %v\\n\", n, a)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>loopback: 127.0.0.1\ngoogleDNS: 8.8.8.8\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "is_accepted": false, "score": 4, "last_activity_date": 1446133004, "creation_date": 1446133004, "answer_id": 33418563, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/33418563#33418563", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>From the go language specification:</p>\n\n<blockquote>\n  <p>If f is variadic with a final parameter p of type ...T, then within f the type of p is equivalent to type []T</p>\n</blockquote>\n\n<p>But in Go slices and arrays are type invariant. So an <code>[]T</code> is different from <code>[]U</code> if <code>T</code> and <code>U</code> are different types. They are not related at all, even if <code>T</code> is an structural subtype of <code>U</code>. So <code>[]string</code> is not an <code>[]interface</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3913, "user_id": 1274815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa80d65597d3e43664c762cbb715e38?s=128&d=identicon&r=PG", "display_name": "gbulmer", "link": "https://stackoverflow.com/users/1274815/gbulmer"}, "is_accepted": false, "score": -2, "last_activity_date": 1446142255, "creation_date": 1446142255, "answer_id": 33421657, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/33421657#33421657", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>Firstly, when I 'run':\npackage main</p>\n\n<p>import \"fmt\"</p>\n\n<pre><code>type IPAddr [4]byte\n\n// TODO: Add a \"String() string\" method to IPAddr.\nfunc (a IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", a...)\n}\n\nfunc main() {\n    addrs := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for n, a := range addrs {\n        fmt.Printf(\"%v: %v\\n\", n, a)\n    }\n}\n</code></pre>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>prog.go:9: cannot use a (type IPAddr) as type []interface {} in\n  argument to fmt.Sprintf</p>\n</blockquote>\n\n<p>and not</p>\n\n<blockquote>\n  <p>cannot use []string literal (type []string) as type []interface {} in\n  argument to fmt.Sprintf</p>\n</blockquote>\n\n<p>So, I think something got out of synch while copying and pasting.</p>\n\n<p><code>type IPAddr [4]byte</code> does not define a string, so the error message in the question is misleading.</p>\n\n<p>It's a <code>[4]byte</code>, a completely different type (from a Go language type perspective) from string. It isn't a <code>[]byte</code> either.</p>\n\n<p>Nor does <code>type IPAddr [4]byte</code> satisfy an interface, for instance implement String(), that fmt.Sprintf could use, because IPAddr's String() method doesn't get compiled.</p>\n\n<p>You might try to convert the <code>[4]byte</code> to a string, but that conversion, <code>string(a)</code> isn't legal. Worse, the four byte values would be treated as character codes, and not converted to a character representation of the 4 small integer values.  It is quite likely that some IPAddr byte values might be invalid UTF-8 which would be even more weird if a program tried to print it.</p>\n\n<p>As explained in other answers,<br>\n<code>return fmt.Sprintf(\"%d.%d.%d.%d\", a[0], a[1], a[2], a[3])</code><br>\nreturns a string value of IPAddr in the format you are aiming for.</p>\n\n<p>Once <code>func (a IPAddr) String() string</code> is valid, it works; <code>IPAddr</code> implements the fmt.Stringer interface.</p>\n\n<p>Then <code>%v</code> in<br>\n<code>fmt.Printf(\"%v: %v\\n\", n, a)</code><br>\n can be replaced by <code>%s</code> in<br>\n<code>fmt.Printf(\"%s: %s\\n\", n, a)</code><br>\nbecause the fmt output methods have an implementation of String(). </p>\n\n<p>I prefer <code>%s</code> to <code>%v</code> because it signals that the program is not relying on a 'default Go value representation' (i.e. for that array <code>[127 0 0 1]</code>), and that the type implements String().</p>\n"}, {"comments": [{"owner": {"reputation": 127466, "user_id": 1202025, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/FlCCd.jpg?s=128&g=1", "display_name": "\u03c1\u044f\u03c3\u0455\u03c1\u0454\u044f K", "link": "https://stackoverflow.com/users/1202025/%cf%81%d1%8f%cf%83%d1%95%cf%81%d1%94%d1%8f-k"}, "edited": false, "score": 1, "creation_date": 1466563883, "post_id": 37957558, "comment_id": 63363232, "body": "Add some explanation with answer for how this answer help OP in fixing current issue"}], "tags": [], "owner": {"reputation": 21, "user_id": 6104964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9e702611f8304ae60d8e2b87d7a9d6?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/6104964/jeremy"}, "is_accepted": false, "score": 0, "last_activity_date": 1466562636, "creation_date": 1466562636, "answer_id": 37957558, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/37957558#37957558", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>You need to implement this method for the Stringer interface.</p>\n\n<pre><code>func (ip IPAddr) String() string {\n    return fmt.Sprintf(\"%v.%v.%v.%v\", ip[0], ip[1], ip[2], ip[3])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2402, "user_id": 5983746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nq5PW.jpg?s=128&g=1", "display_name": "mathsyouth", "link": "https://stackoverflow.com/users/5983746/mathsyouth"}, "is_accepted": false, "score": 0, "last_activity_date": 1493025201, "creation_date": 1493025201, "answer_id": 43584070, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/43584070#43584070", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>The <code>range</code> should be used to iterate over the array, so the answer would be like as follows:</p>\n\n<pre><code>func (ip IPAddr) String() string {\n    out := fmt.Sprintf(\"%v\", ip[0])\n    for _, value := range ip[1:] {\n        out += fmt.Sprintf(\".%v\", value)\n    }\n    return out\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 8442126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793efc1c5243e16b831a8f69ce019726?s=128&d=identicon&r=PG&f=1", "display_name": "ynsta", "link": "https://stackoverflow.com/users/8442126/ynsta"}, "is_accepted": false, "score": 5, "last_activity_date": 1606670657, "last_edit_date": 1606670657, "creation_date": 1502315256, "answer_id": 45601133, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/45601133#45601133", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>As stated in the Go FAQ section <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">Can I convert a []T to an []interface{}</a>, there is no implicit conversion from a typed array to an <code>[]interface{}</code>:</p>\n<blockquote>\n<p>It is disallowed by the language specification because the two types\ndo not have the same representation in memory. It is necessary to copy\nthe elements individually to the destination slice</p>\n</blockquote>\n<p>The following solution works but require the creation of an intermediate slice:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func (ip IPAddr) String() string {\n    tmp := make([]interface{}, len(ip))\n    for i, val := range ip {\n        tmp[i] = val\n    }\n    return fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, tmp...)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1593605610, "post_id": 62668929, "comment_id": 110838617, "body": "Although this code might solve the problem, a good answer should explain <b>what</b> the code does and <b>how</b> it helps"}], "tags": [], "owner": {"reputation": 1609, "user_id": 1156468, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/IndED.jpg?s=128&g=1", "display_name": "joHN", "link": "https://stackoverflow.com/users/1156468/john"}, "is_accepted": false, "score": 1, "last_activity_date": 1593571944, "creation_date": 1593571944, "answer_id": 62668929, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a/62668929#62668929", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<pre><code>func (ip IPAddr) String() string {\n    var s []string;\n    for _, v := range ip {\n        s = append(s, fmt.Sprintf(&quot;%v&quot;, v))\n    }\n    return strings.Join(s, &quot;.&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 2546081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f854593bd5bb22424f2b2c705f931d3?s=128&d=identicon&r=PG", "display_name": "Jankiel", "link": "https://stackoverflow.com/users/2546081/jankiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6182, "favorite_count": 2, "accepted_answer_id": 33418254, "answer_count": 7, "score": 9, "last_activity_date": 1606670657, "creation_date": 1446131847, "last_edit_date": 1495535469, "question_id": 33418107, "link": "https://stackoverflow.com/questions/33418107/why-cant-i-do-fmt-sprintfd-d-d-d-a", "title": "Why can&#39;t I do fmt.Sprintf(&quot;%d.%d.%d.%d&quot;, a...)?", "body": "<p>I'm learning Go and I'm stuck with Go tour (exercise-stringer.go: <a href=\"https://tour.golang.org/methods/7\" rel=\"noreferrer\">https://tour.golang.org/methods/7</a>).</p>\n\n<p>Here's some code:</p>\n\n<pre><code>type IPAddr [4]byte  \n// TODO: Add a \"String() string\" method to IPAddr.\nfunc (a IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", a...)\n}\n</code></pre>\n\n<p>So I figured the inner representation of <code>IPAddr</code> is <code>[4]byte</code>, so spread operator works. But I'm getting:  </p>\n\n<pre><code>cannot use []string literal (type []string) as type []interface {} in argument to fmt.Sprintf\n</code></pre>\n\n<p>What the heck? String slice doesn't work either, what's going on here? </p>\n\n<p><strong>EDIT</strong>: Sorry, there's an error in my question - error was about type <code>IPAddr</code>, not <code>[]string</code>. I was playing with the code and I've pasted wrong output.  Anyway, thanks to <a href=\"https://stackoverflow.com/users/221700/peterso\" title=\"peterSO\">peterSO</a> and <a href=\"https://stackoverflow.com/users/437276/0x434d53\" title=\"0x434D53\">0x434D53</a> about invariance of slices in Go.</p>\n\n<p>Well, this raises another question. Why is it implemented in this way? I imagine you'd just have some <code>Iterable</code> interface, so any struct implementing it would \"just work\".</p>\n\n<p><strong>Sidenote</strong>: when I first heard about Go there was this bold statement \"compiled, but expressive\". And explicit interface implementation is great example of this, but things like explicit conversion, lack of operator overloading and so on give me \"90s Java feel\". Which is sad, because Go seems like a great language.</p>\n"}, {"tags": ["arrays", "json", "go", "tiedot"], "comments": [{"owner": {"reputation": 6235, "user_id": 622060, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=128&d=identicon&r=PG", "display_name": "Per Johansson", "link": "https://stackoverflow.com/users/622060/per-johansson"}, "edited": false, "score": 0, "creation_date": 1446131088, "post_id": 33417637, "comment_id": 54625218, "body": "It&#39;s a bit unclear what you mean with JSON array. Do you mean an array you can index, where each element is a dictionary, or do you mean a text json representation?"}], "answers": [{"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": true, "score": 2, "last_activity_date": 1446132789, "creation_date": 1446132789, "answer_id": 33418470, "question_id": 33417637, "link": "https://stackoverflow.com/questions/33417637/create-json-array-from-seperate-byte-results-in-golang/33418470#33418470", "title": "Create JSON array from seperate []byte results in GoLang", "body": "<p>If you are returning this directly to the client and your <code>docContent</code> is JSON you can just manually construct the array syntax. It does not provide any safety if <code>docContent</code> is not valid json.</p>\n\n<pre><code>a := [][]byte{}\n\ncol.ForEachDoc(func(id int, docContent []byte) (willMoveOn bool) {\n     a = append(a, docContent)\n     return true\n})\nb := bytes.Join(a, []byte(`,`))\n\n// insert '[' to the front\nb = append(b, 0)\ncopy(b[1:], b[0:])\nb[0] = byte('[')\n\n// append ']'\nb = append(b, ']')\n</code></pre>\n\n<p>You could also unmarshal, then append to a slice, then marshal the slice</p>\n\n<pre><code>s := []interface{}{}\ncol.ForEachDoc(func(id int, docContent []byte) (willMoveOn bool) {\n     var j interface{}\n     if err := json.Unmarshal(docContent, &amp;j); err != nil {\n          // handle error\n     }\n     s = append(s, j)\n     return true\n})\n\nb, err := json.Marshal(j)\n</code></pre>\n"}], "owner": {"reputation": 2144, "user_id": 1143357, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8aebc0e3ebfeb4bebe9d20140d373a27?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1143357/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 993, "favorite_count": 0, "accepted_answer_id": 33418470, "answer_count": 1, "score": 1, "last_activity_date": 1446132789, "creation_date": 1446130600, "question_id": 33417637, "link": "https://stackoverflow.com/questions/33417637/create-json-array-from-seperate-byte-results-in-golang", "title": "Create JSON array from seperate []byte results in GoLang", "body": "<p>I have a loop of results coming from a <a href=\"https://github.com/HouzuoGuo/tiedot\" rel=\"nofollow\">tiedot</a> query.</p>\n\n<p>In it's most basic form it looks like this:</p>\n\n<pre><code>col.ForEachDoc(func(id int, docContent []byte) (willMoveOn bool) {\n    return true\n    return false\n})\n</code></pre>\n\n<p>I can send these results down the pipe to the client, but only 1 at a time. Not quite what I want. </p>\n\n<p>I can also create single JSON objects, using json.Unmarshal but how do I combine them all into 1 large JSON array?</p>\n\n<p>Many thanks. New to GO!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 7, "creation_date": 1446127725, "post_id": 33416475, "comment_id": 54622667, "body": "2 nanoseconds is not enough ;)"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1446127727, "post_id": 33416475, "comment_id": 54622671, "body": "<code>time.Sleep</code> takes <code>Duration</code> as an argument, which is in nanoseconds. You&#39;re sleeping for two nanoseconds. If you want seconds, use <code>time.Sleep(2*time.Second)</code>."}, {"owner": {"reputation": 40992, "user_id": 40106, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/164ca8ba426bdb10381290b9617d3ea7?s=128&d=identicon&r=PG&f=1", "display_name": "4thSpace", "link": "https://stackoverflow.com/users/40106/4thspace"}, "edited": false, "score": 0, "creation_date": 1446127818, "post_id": 33416475, "comment_id": 54622763, "body": "Perfect!  Thanks.  One of you can post as answer."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1446128299, "creation_date": 1446128299, "answer_id": 33416725, "question_id": 33416475, "link": "https://stackoverflow.com/questions/33416475/why-doesnt-time-sleep2-work-with-go-routines/33416725#33416725", "title": "Why doesn&#39;t time.Sleep(2) work with go routines?", "body": "<p><a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow\"><code>time.Sleep</code></a> takes <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow\"><code>time.Duration</code></a> as an argument, which is in nanoseconds. If you want seconds, use <code>time.Sleep(2*time.Second)</code>:</p>\n\n<pre><code>f(\"direct\")\ngo f(\"goroutine\")\ngo func(msg string) {\n    fmt.Println(msg)\n}(\"going\")\n\ntime.Sleep(2 * time.Second)\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/lgKSyAW4RO\" rel=\"nofollow\">http://play.golang.org/p/lgKSyAW4RO</a>.</p>\n\n<p>But it's always better to use channels or tools from package <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow\"><code>sync</code></a> for synchronisation.</p>\n"}], "owner": {"reputation": 40992, "user_id": 40106, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/164ca8ba426bdb10381290b9617d3ea7?s=128&d=identicon&r=PG&f=1", "display_name": "4thSpace", "link": "https://stackoverflow.com/users/40106/4thspace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 33416725, "answer_count": 1, "score": 2, "last_activity_date": 1446128299, "creation_date": 1446127632, "question_id": 33416475, "link": "https://stackoverflow.com/questions/33416475/why-doesnt-time-sleep2-work-with-go-routines", "title": "Why doesn&#39;t time.Sleep(2) work with go routines?", "body": "<p>From the go routine example here: <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow\">https://gobyexample.com/goroutines</a>, why doesn't replacing the <code>fmt.Scanln</code> code with a <code>time.sleep(2)</code> work?</p>\n\n<p>If you replace the last three lines with <code>time.Sleep(2)</code>, the go routines don't print anything.</p>\n\n<pre><code>func main() {\n    f(\"direct\")\n    go f(\"goroutine\")\n    go func(msg string) {\n        fmt.Println(msg)\n    }(\"going\")\n\n    time.Sleep(2)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1446127973, "last_edit_date": 1446127973, "creation_date": 1446126123, "answer_id": 33415894, "question_id": 33415745, "link": "https://stackoverflow.com/questions/33415745/how-to-print-using-indexes/33415894#33415894", "title": "How to print using indexes?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\">Package fmt</a></p>\n  \n  <p>Explicit argument indexes:</p>\n  \n  <p>In Printf, Sprintf, and Fprintf, the default behavior is for each\n  formatting verb to format successive arguments passed in the call.\n  However, the notation [n] immediately before the verb indicates that\n  the nth one-indexed argument is to be formatted instead. The same\n  notation before a '*' for a width or precision selects the argument\n  index holding the value. After processing a bracketed expression [n],\n  subsequent verbs will use arguments n+1, n+2, etc. unless otherwise\n  directed.</p>\n  \n  <p>For example,</p>\n\n<pre><code>fmt.Sprintf(\"%[2]d %[1]d\\n\", 11, 22)\n</code></pre>\n  \n  <p>will yield \"22 11\"</p>\n  \n  <p><a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"nofollow\">func Fprintf</a></p>\n\n<pre><code>func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)\n</code></pre>\n  \n  <p>Fprintf formats according to a format specifier and writes to w. It\n  returns the number of bytes written and any write error encountered.</p>\n  \n  <p><a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"nofollow\">func Printf</a></p>\n\n<pre><code>func Printf(format string, a ...interface{}) (n int, err error)\n</code></pre>\n  \n  <p>Printf formats according to a format specifier and writes to standard\n  output. It returns the number of bytes written and any write error\n  encountered.</p>\n</blockquote>\n\n<p>For <code>Fprintf</code> provide an <code>io.Writer</code>or use <code>Printf</code>. Also, add format 'verbs' to your format specifier. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    a, b, c, d := 1, 2, 3, 4\n    fmt.Fprintf(os.Stdout, \"%[1]d %[2]d %[3]d %[4]d\\n\", a, b, c, d)\n    fmt.Printf(\"%[1]d %[2]d %[3]d %[4]d\\n\", a, b, c, d)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1 2 3 4\n1 2 3 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 2, "last_activity_date": 1446126342, "creation_date": 1446126342, "answer_id": 33415987, "question_id": 33415745, "link": "https://stackoverflow.com/questions/33415745/how-to-print-using-indexes/33415987#33415987", "title": "How to print using indexes?", "body": "<p>fmt.Fprintf has definition:<br>\n<code>func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)</code><br>\nSo you need to provide writer.</p>\n\n<p>For indexing you can use format like this: <code>\"%[2]d %[1]d\"</code></p>\n"}], "owner": {"reputation": 40992, "user_id": 40106, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/164ca8ba426bdb10381290b9617d3ea7?s=128&d=identicon&r=PG&f=1", "display_name": "4thSpace", "link": "https://stackoverflow.com/users/40106/4thspace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 33415894, "answer_count": 2, "score": 0, "last_activity_date": 1446127973, "creation_date": 1446125734, "question_id": 33415745, "link": "https://stackoverflow.com/questions/33415745/how-to-print-using-indexes", "title": "How to print using indexes?", "body": "<p>Is there a way to print using variable indexes?</p>\n\n<pre><code>fmt.Fprintf(\"%[1] %[2] %[3] %[4]\", a, b, c, d)\n</code></pre>\n\n<p>I get errors about </p>\n\n<blockquote>\n  <p>string does not implement io.Writer</p>\n</blockquote>\n\n<p>Using <code>fmt.Println</code> prints the variable indexes as a literal.</p>\n"}, {"tags": ["go", "dependency-management"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446123785, "post_id": 33414849, "comment_id": 54619577, "body": "If a package can be fetched with <code>go get</code>, then the URL can be determined by the import path."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1446124679, "post_id": 33414849, "comment_id": 54620229, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28166249/how-to-list-installed-go-packages\">How to list installed go packages</a>"}], "answers": [{"comments": [{"owner": {"reputation": 885, "user_id": 2195623, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/79a7b7b057ee0799763967ce98f5629d?s=128&d=identicon&r=PG", "display_name": "SpaceMonkey", "link": "https://stackoverflow.com/users/2195623/spacemonkey"}, "edited": false, "score": 0, "creation_date": 1446125300, "post_id": 33415276, "comment_id": 54620685, "body": "Thank you! But I still don&#39;t get how to resolve the source URL from the import path. Take &quot;collectd.org/api&quot; for example. The path is derivated from the source URL but the other way around is what interests me."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "reply_to_user": {"reputation": 885, "user_id": 2195623, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/79a7b7b057ee0799763967ce98f5629d?s=128&d=identicon&r=PG", "display_name": "SpaceMonkey", "link": "https://stackoverflow.com/users/2195623/spacemonkey"}, "edited": false, "score": 1, "creation_date": 1446125437, "post_id": 33415276, "comment_id": 54620790, "body": "For external packages it&#39;s the source-url. That&#39;s how go get downloads the packages"}], "tags": [], "owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "is_accepted": true, "score": 6, "last_activity_date": 1446124464, "creation_date": 1446124464, "answer_id": 33415276, "question_id": 33414849, "link": "https://stackoverflow.com/questions/33414849/list-of-dependency-urls-of-a-go-project/33415276#33415276", "title": "List of dependency URLs of a Go project", "body": "<p>For the current directory you get the imports by:\n<code>go list -f '{{join .Imports \"\\n\"}}' .</code></p>\n"}], "owner": {"reputation": 885, "user_id": 2195623, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/79a7b7b057ee0799763967ce98f5629d?s=128&d=identicon&r=PG", "display_name": "SpaceMonkey", "link": "https://stackoverflow.com/users/2195623/spacemonkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1071, "favorite_count": 0, "accepted_answer_id": 33415276, "answer_count": 1, "score": 2, "last_activity_date": 1446124464, "creation_date": 1446123245, "question_id": 33414849, "link": "https://stackoverflow.com/questions/33414849/list-of-dependency-urls-of-a-go-project", "title": "List of dependency URLs of a Go project", "body": "<p>I want to get a list of tarball URLs (or similar) of all dependencies in a Go project. I tried to achieve this with 'go list dependency' but I see no possibility to get the source URL of a dependency. How can I get the URL?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1446122250, "creation_date": 1446122250, "answer_id": 33414470, "question_id": 33414357, "link": "https://stackoverflow.com/questions/33414357/get-all-values-of-specific-xml-field/33414470#33414470", "title": "get all values of specific xml field", "body": "<p>Use a <code>Decoder</code> from <code>encoding/xml</code> and iterate over your XML with <code>func (*Decoder) Token</code>. While iterating check for <code>StartElement</code>s with the desired <code>Name</code>.</p>\n"}], "owner": {"reputation": 273, "user_id": 5250918, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a241b785773d58ae2cd8be649f9b97a?s=128&d=identicon&r=PG&f=1", "display_name": "Kaign", "link": "https://stackoverflow.com/users/5250918/kaign"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "accepted_answer_id": 33414470, "answer_count": 1, "score": 0, "last_activity_date": 1446122250, "creation_date": 1446121935, "question_id": 33414357, "link": "https://stackoverflow.com/questions/33414357/get-all-values-of-specific-xml-field", "title": "get all values of specific xml field", "body": "<p>Is there a way to get all values for specific field name in xml file? This field appears multiple times in different nested levels, and I don't know in advance where it may be in document.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1446122889, "post_id": 33413747, "comment_id": 54618955, "body": "most likely <code>Close()</code> is called twice on the same gracefulConn instance. It is hard to tell how this happens without seeing the rest of the code."}], "answers": [{"tags": [], "owner": {"reputation": 2749, "user_id": 718981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd2b5c3cd12ceaa6a42cb683d4d75b1?s=128&d=identicon&r=PG", "display_name": "simonmenke", "link": "https://stackoverflow.com/users/718981/simonmenke"}, "is_accepted": true, "score": 2, "last_activity_date": 1446123042, "creation_date": 1446123042, "answer_id": 33414780, "question_id": 33413747, "link": "https://stackoverflow.com/questions/33413747/go-graceful-shutdown-negative-waitgroup/33414780#33414780", "title": "Go graceful shutdown negative WaitGroup", "body": "<p><code>Close()</code> can be called multiple times so you definitely need to check for that in <code>func (w gracefulConn) Close() error</code>.</p>\n\n<blockquote>\n  <p>P.S. I have tried to add stopped property and a mutex to gracefullConn, so in Close it locks the mutex and checks stopped to ensure we stop it only once. However, I still received the same panic.</p>\n</blockquote>\n\n<p>Keep in mind that <code>gracefulConn</code> if passed as a value not a reference so any mutexes/flags will not work as expected. So be sure to turn <code>c = gracefulConn{Conn: c}</code> into <code>c = &amp;gracefulConn{Conn: c}</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": false, "score": 1, "last_activity_date": 1446123399, "creation_date": 1446123399, "answer_id": 33414903, "question_id": 33413747, "link": "https://stackoverflow.com/questions/33413747/go-graceful-shutdown-negative-waitgroup/33414903#33414903", "title": "Go graceful shutdown negative WaitGroup", "body": "<p>I think this is the wrong approach.</p>\n\n<p>You don't really care about whether the connection is open or not - what about persistent connections?</p>\n\n<p>What you care about is whether you are actively using those connections.  You'd be better off putting your <code>WaitGroup</code> into a custom <code>ServeMux</code> into the <code>ServeHTTP</code> method I think. You can then have the <code>WaitGroup</code> around a function call.</p>\n"}], "owner": {"reputation": 1515, "user_id": 702999, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/ced75bbca5a9f7dee31a775473742bd0?s=128&d=identicon&r=PG", "display_name": "mindmaster", "link": "https://stackoverflow.com/users/702999/mindmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 33414780, "answer_count": 2, "score": 1, "last_activity_date": 1518730117, "creation_date": 1446120263, "last_edit_date": 1518730117, "question_id": 33413747, "link": "https://stackoverflow.com/questions/33413747/go-graceful-shutdown-negative-waitgroup", "title": "Go graceful shutdown negative WaitGroup", "body": "<p>I have tried to implement a graceful shutdown of the go server, as described in this blog post <a href=\"http://grisha.org/blog/2014/06/03/graceful-restart-in-golang/\" rel=\"nofollow\">http://grisha.org/blog/2014/06/03/graceful-restart-in-golang/</a>. The main bits are the following.</p>\n\n<p>Custom listener:</p>\n\n<pre><code>var httpWg sync.WaitGroup  // initialised in the other part\n\ntype gracefulListener struct {\n    net.Listener\n    stop    chan error\n    stopped bool\n}\n\nfunc newGracefulListener(l net.Listener) (gl *gracefulListener) {\n    gl = &amp;gracefulListener{Listener: l, stop: make(chan error)}\n    go func() {\n        _ = &lt;-gl.stop\n        gl.stopped = true\n        gl.stop &lt;- gl.Listener.Close()\n    }()\n    return\n}\n\nfunc (gl *gracefulListener) Accept() (c net.Conn, err error) {\n    c, err = gl.Listener.Accept()\n    if err != nil {\n        return\n    }\n\n    c = gracefulConn{Conn: c}  // wrap using our custom connection\n\n    httpWg.Add(1)  // increase the counter\n    return\n}\n\nfunc (gl *gracefulListener) Close() error {\n    if gl.stopped {\n        return syscall.EINVAL\n    }\n    gl.stop &lt;- nil\n    return &lt;-gl.stop\n}\n\nfunc (gl *gracefulListener) File() *os.File {\n    tl := gl.Listener.(*net.TCPListener)\n    fl, _ := tl.File()\n    return fl\n}\n</code></pre>\n\n<p>Custom Conn:</p>\n\n<pre><code>type gracefulConn struct {\n    net.Conn\n}\n\nfunc (w gracefulConn) Close() error {\n    httpWg.Done()  // &lt;- panics sometimes\n    return w.Conn.Close()\n}\n</code></pre>\n\n<p>The idea is when the program receives SIGTERM, it stops serving new connections and just waits for the <code>httpWg.Wait()</code> for existing connections to finish.\nThis approach works locally, but when I deploy it, sometimes I receive a panic in the <code>gracefulConn.Close()</code> at <code>httpWg.Done()</code> line:</p>\n\n<pre><code>panic: sync: negative WaitGroup counter\n</code></pre>\n\n<p>The panic happens not when I stop the server but just during routine serving.\nHow is it possible, that there are more <code>Close()</code> calls then <code>Accept()</code> calls? Or am I missing something?</p>\n\n<p>P.S. I have tried to add <code>stopped</code> property and a mutex to <code>gracefullConn</code>, so in <code>Close</code> it locks the mutex and checks <code>stopped</code> to ensure we stop it only once. However, I still received the same panic.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1446146409, "post_id": 33413919, "comment_id": 54634967, "body": "What about the &lt;-chan specifier, what&#39;s it&#39;s overhead if the channel hasn&#39;t received anything yet (how does it compare to, for example: i = value in term of performance)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1446148352, "post_id": 33413919, "comment_id": 54636039, "body": "@Whiteclaws: Generally, a channel receive will take longer than an assignment. That may or may not be significant in the larger scheme of things. For particular cases, run a benchmark: <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">Benchmarks, Package testing</a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1446120804, "creation_date": 1446120804, "answer_id": 33413919, "question_id": 33413403, "link": "https://stackoverflow.com/questions/33413403/go-chan-overhead/33413919#33413919", "title": "Go &lt;-chan overhead", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow\">Select statements</a></p>\n  \n  <p>Execution of a \"select\" statement proceeds in several steps:</p>\n  \n  <ol>\n  <li>For all the cases in the statement, the channel operands of receive operations and the channel and right-hand-side expressions of send\n  statements are evaluated exactly once, in source order, upon entering\n  the \"select\" statement. The result is a set of channels to receive\n  from or send to, and the corresponding values to send. Any side\n  effects in that evaluation will occur irrespective of which (if any)\n  communication operation is selected to proceed. Expressions on the\n  left-hand side of a RecvStmt with a short variable declaration or\n  assignment are not yet evaluated.</li>\n  <li>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection.\n  Otherwise, if there is a default case, that case is chosen. If there\n  is no default case, the \"select\" statement blocks until at least one\n  of the communications can proceed.</li>\n  <li>Unless the selected case is the default case, the respective communication operation is executed.</li>\n  <li>If the selected case is a RecvStmt with a short variable declaration or an assignment, the left-hand side expressions are\n  evaluated and the received value (or values) are assigned.</li>\n  <li>The statement list of the selected case is executed.</li>\n  </ol>\n</blockquote>\n\n<p>Go <code>select</code> statement behavior is defined in The Go Programming Language Specification. <code>&lt;-chan</code> is evaluated once.</p>\n\n<blockquote>\n  <p>For all the cases in the statement, the channel operands of receive\n  operations and the channel and right-hand-side expressions of send\n  statements are evaluated exactly once, in source order, upon entering\n  the \"select\" statement.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1446121308, "post_id": 33414024, "comment_id": 54617866, "body": "An implementation must conform to the specification."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1446125148, "post_id": 33414024, "comment_id": 54620562, "body": "@peterSO, sure but as I read the OP&#39;s question, they did not ask about the specification but rather about how this stuff <i>actually</i> works. Hence my stab at explaining it. I&#39;ve updated my answer to mention this bit, just in case."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 2, "last_activity_date": 1446125246, "last_edit_date": 1446125246, "creation_date": 1446121060, "answer_id": 33414024, "question_id": 33413403, "link": "https://stackoverflow.com/questions/33413403/go-chan-overhead/33414024#33414024", "title": "Go &lt;-chan overhead", "body": "<p>The <em>implementation</em> of channels is not defined by the language specification (and will never be), so a particular implementation is free to do anythng it wants <em>while it conforms to the specification.</em></p>\n\n<p>On the other hand, accessing a channel behaves like accessing a mutex so I beleive internally Go arranges to use system-provided means of blocking on an appropriate resource.  Think of <code>WaitForMultipleObjects()</code> on Windows, futexes on Linux and so on.</p>\n\n<p>In other words, while the <code>for { select { case &lt;-chan: ... } }</code> construct looks like <em>busy waiting</em> on the objects in those <code>case</code> labels, in fact it is not: the compiler leverages the system's means of making the Go runtime scheduler be notified when some of those resources becomes available.</p>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1587374378, "creation_date": 1446119327, "last_edit_date": 1587374378, "question_id": 33413403, "link": "https://stackoverflow.com/questions/33413403/go-chan-overhead", "title": "Go &lt;-chan overhead", "body": "<p>I have been trying to understand channels in Go for a while now. But one thing makes me wonder. What happens exactly when you call, </p>\n\n<pre><code>for {\n  select {\n    case &lt;-chan:\n  }\n}\n</code></pre>\n\n<p>Does it check the chan every for iteration for updates? How would it compare to a normal <code>case i = int:</code>, or a <code>case atomic.LoadUint64() = uint64:</code> performance-wise?</p>\n"}, {"tags": ["go", "timer"], "answers": [{"comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1446123846, "post_id": 33414165, "comment_id": 54619613, "body": "Many thanks for your answer, but if I am right time.NewTicker returns a channel and I think I am currently using them here: <a href=\"https://gist.github.com/nbari/483c5b382c795bf290b5#file-scheduler-go-L15\" rel=\"nofollow noreferrer\">gist.github.com/nbari/&hellip;</a>, also why not use timer.Stop? what is the difference of creating another channel (quit) to stop the timer ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 1, "creation_date": 1446124019, "post_id": 33414165, "comment_id": 54619749, "body": "@nbari: from the docs for Ticker and Timer: &quot;Stop does not close the channel, to prevent a read from the channel succeeding incorrectly&quot;. Your for range loop will never exit."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1446200493, "post_id": 33414165, "comment_id": 54655367, "body": "I am a little confuse, since in the tick_test.go they use  <code>Stop()</code> and seems to be working, please check <a href=\"https://golang.org/src/time/tick_test.go\" rel=\"nofollow noreferrer\">golang.org/src/time/tick_test.go</a> lines 28-35, basically I don&#39;t understand why I need a control channel (quit) just for stoping a previous opened channel, could you please elaborate more on this, thanks in advance."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1446203445, "post_id": 33414165, "comment_id": 54657140, "body": "Hi, I after reading this answer <a href=\"http://stackoverflow.com/questions/17797754/ticker-stop-behaviour-in-golang\" title=\"ticker stop behaviour in golang\">stackoverflow.com/questions/17797754/&hellip;</a> I got it better, if changing the int on the map to a string could help to avoid the &quot;sync&quot; or why indeed the for synchronising using <code>mut.Lock&#47;Unlock</code> ?"}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1446247907, "post_id": 33414165, "comment_id": 54680879, "body": "No. Map access has to be synchronized, maps are not thread-safe."}], "tags": [], "owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "is_accepted": true, "score": 0, "last_activity_date": 1446121395, "creation_date": 1446121395, "answer_id": 33414165, "question_id": 33413105, "link": "https://stackoverflow.com/questions/33413105/start-stop-and-handler-custom-scheduler-via-http/33414165#33414165", "title": "start/stop and handler custom scheduler via http", "body": "<p>Yes, there is a better way:</p>\n\n<p>You should use channels here, and, as you suggested, some data structure to hold more schedulers.</p>\n\n<p>I came up with this, it's a most basic working example of what I'd do:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\n// a scheduler runs f on every receive on t and exits when receiving from quit is non-blocking\ntype scheduler struct {\n    t    &lt;-chan time.Time\n    quit chan struct{}\n    f    func()\n}\n\n// a schedulerPool holds multiple schedulers\ntype schedulerPool struct {\n    schedulers map[int]scheduler //I used a map here so you can use more clever keys\n    counter    int\n    mut        sync.Mutex\n}\n\nfunc newPool() *schedulerPool {\n    return &amp;schedulerPool{\n        schedulers: make(map[int]scheduler),\n    }\n}\n\n// start adds and starts a new scheduler that will execute f every interval.\n// It returns the generated ID for the scheduler, or an error.\nfunc (p *schedulerPool) start(interval time.Duration, f func()) (int, error) {\n    p.mut.Lock()\n    defer p.mut.Unlock()\n    index := p.counter\n    p.counter++\n\n    if _, ok := p.schedulers[index]; ok {\n        return 0, errors.New(\"key already in use\")\n    }\n\n    sched := scheduler{\n        t:    time.NewTicker(interval).C,\n        quit: make(chan struct{}),\n        f:    f,\n    }\n\n    p.schedulers[index] = sched\n    go func() {\n        for {\n            select {\n            case &lt;-sched.t:\n                sched.f()\n            case &lt;-sched.quit:\n                return\n            }\n        }\n    }()\n    return index, nil\n}\n\n// stop stops the scheduler with the given ID.\nfunc (p *schedulerPool) stop(index int) error {\n    p.mut.Lock()\n    defer p.mut.Unlock()\n\n    sched, ok := p.schedulers[index]\n    if !ok {\n        return errors.New(\"does not exist\")\n    }\n\n    close(sched.quit)\n    return nil\n}\n\nfunc main() {\n    // get a new pool\n    pool := newPool()\n\n    // start a scheduler\n    idx1, err := pool.start(time.Second, func() { fmt.Println(\"hello 1\") })\n    if err != nil {\n        panic(err)\n    }\n\n    // start another scheduler\n    idx2, err := pool.start(time.Second, func() { fmt.Println(\"hello 2\") })\n    if err != nil {\n        panic(err)\n    }\n\n    // wait some time\n    time.Sleep(3 * time.Second)\n\n    // stop the second scheduler\n    err = pool.stop(idx2)\n    if err != nil {\n        panic(err)\n    }\n\n    // wait some more\n    time.Sleep(3 * time.Second)\n\n    // stop the first scheduler\n    err = pool.stop(idx1)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Check it out on the <a href=\"http://play.golang.org/p/2LzZbycLfq\" rel=\"nofollow\">playground</a>.</p>\n\n<p>Note that there is no guarantee that the first scheduler will run six times in total and the second one three times.</p>\n\n<p>Also note a few other things I've done:</p>\n\n<ul>\n<li>Map access has to be synchronized</li>\n<li>Generating IDs must be synchronized</li>\n<li>You should check if the key is actually in the map</li>\n<li>Use channels to start, stop and control schedulers (for example, add a channel <code>beep</code> to have a scheduler dump something to the console (like <code>\"beep\"</code>))</li>\n<li>Define a type for the exact signature of function you want to execute, for example <code>type schedFunc func(int, int)</code></li>\n</ul>\n\n<p>Obviously, you need to wrap that stuff inside of http handlers, probably take the ID or parameters from the querystring, or some other fancy stuff. This is just for demonstration.</p>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 33414165, "answer_count": 1, "score": 0, "last_activity_date": 1446121395, "creation_date": 1446118424, "question_id": 33413105, "link": "https://stackoverflow.com/questions/33413105/start-stop-and-handler-custom-scheduler-via-http", "title": "start/stop and handler custom scheduler via http", "body": "<p>I want to create a scheduler so that it executes a task every second for example, but also would like to have and http interface to stop/start the scheduler and get more stats/info, after reading more about <a href=\"https://mmcgrana.github.io/2012/09/go-by-example-timers-and-tickers.html\" rel=\"nofollow\">timers &amp; tickers</a>, <a href=\"https://gobyexample.com/channels\" rel=\"nofollow\">channels</a> and <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow\">gorutines</a> I came out with this: </p>\n\n<p><a href=\"https://gist.github.com/nbari/483c5b382c795bf290b5\" rel=\"nofollow\">https://gist.github.com/nbari/483c5b382c795bf290b5</a> </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nvar timer *time.Ticker\n\nfunc scheduler(seconds time.Duration) *time.Ticker {\n    ticker := time.NewTicker(seconds * time.Second)\n    go func() {\n        for t := range ticker.C {\n            // do stuff\n            fmt.Println(t)\n        }\n    }()\n    return ticker\n}\n\nfunc Start(timer *time.Ticker) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        timer = scheduler(1)\n        w.Write([]byte(\"Starting scheduler\"))\n    })\n}\n\nfunc Stop(timer *time.Ticker) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        timer.Stop()\n        w.Write([]byte(\"Stoping scheduler\"))\n    })\n}\n\nfunc main() {\n    timer = scheduler(1)\n    http.Handle(\"/start\", Start(timer))\n    http.Handle(\"/stop\", Stop(timer))\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>The above code is working but I have a global \"timer\" variable, I would like to know if there is a better way to implement this and also a way for handle more than 1 scheduler, currently thinking on probably implementing kind of a container for all the scheduler but would like to have some feedbacks that could help me find clever solutions.</p>\n"}, {"tags": ["json", "mongodb", "go", "bson", "objectid"], "comments": [{"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1446116907, "post_id": 33412211, "comment_id": 54614988, "body": "Do colons work to seperate tags? I think this should be <code>json:&quot;b,omitempty&quot;</code>, and maybe the same for <code>bson</code>"}, {"owner": {"reputation": 200, "user_id": 2737505, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0773b97e5eace02780b95f23fcb8be6b?s=128&d=identicon&r=PG&f=1", "display_name": "Yoni Dabush", "link": "https://stackoverflow.com/users/2737505/yoni-dabush"}, "reply_to_user": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1446121099, "post_id": 33412211, "comment_id": 54617752, "body": "It was a typo and I fixed it."}], "answers": [{"comments": [{"owner": {"reputation": 200, "user_id": 2737505, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0773b97e5eace02780b95f23fcb8be6b?s=128&d=identicon&r=PG&f=1", "display_name": "Yoni Dabush", "link": "https://stackoverflow.com/users/2737505/yoni-dabush"}, "edited": false, "score": 0, "creation_date": 1446121173, "post_id": 33413428, "comment_id": 54617787, "body": "How is the first solution different from my question? maybe it was before I fixed the typo."}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "reply_to_user": {"reputation": 200, "user_id": 2737505, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0773b97e5eace02780b95f23fcb8be6b?s=128&d=identicon&r=PG&f=1", "display_name": "Yoni Dabush", "link": "https://stackoverflow.com/users/2737505/yoni-dabush"}, "edited": false, "score": 0, "creation_date": 1446121669, "post_id": 33413428, "comment_id": 54618126, "body": "@YoniDabush yes, I post it before you update your question."}], "tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": true, "score": 1, "last_activity_date": 1446121757, "last_edit_date": 1446121757, "creation_date": 1446119426, "answer_id": 33413428, "question_id": 33412211, "link": "https://stackoverflow.com/questions/33412211/mongo-save-document-with-empty-objectid-reference-error-invalid-objectid-in-j/33413428#33413428", "title": "Mongo save document with empty objectid reference - error: Invalid ObjectId in JSON", "body": "<p>Can you try with:  </p>\n\n<pre><code>type A struct {\n    Id bson.ObjectId  `bson:\"_id\" json:\"id\"`\n    B  *bson.ObjectId `bson:\"b,omitempty\" json:\"b,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 200, "user_id": 2737505, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0773b97e5eace02780b95f23fcb8be6b?s=128&d=identicon&r=PG&f=1", "display_name": "Yoni Dabush", "link": "https://stackoverflow.com/users/2737505/yoni-dabush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1571, "favorite_count": 0, "accepted_answer_id": 33413428, "answer_count": 1, "score": 1, "last_activity_date": 1446121757, "creation_date": 1446115887, "last_edit_date": 1446121044, "question_id": 33412211, "link": "https://stackoverflow.com/questions/33412211/mongo-save-document-with-empty-objectid-reference-error-invalid-objectid-in-j", "title": "Mongo save document with empty objectid reference - error: Invalid ObjectId in JSON", "body": "<p>I'm working on golang server, connected to mongo.</p>\n\n<p>I have a the following reference structure:</p>\n\n<pre><code>type A struct {\n    Id   bson.ObjectId    `bson:\"_id\" json:\"id\"`\n    B    bson.ObjectId    `bson:\"b,omitempty\" json:\"b,omitempty\"`\n}\n</code></pre>\n\n<p>Thing is, B is not mandatory in A, and when ever I try to save A without B i'm getting an error: </p>\n\n<pre><code>\"Invalid ObjectId in JSON: null\"\n</code></pre>\n\n<p>How can I have this reference be no mandatory?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1446095998, "post_id": 33405373, "comment_id": 54604199, "body": "Duplicate (too lazy too look up original)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446124296, "post_id": 33405373, "comment_id": 54619943, "body": "<a href=\"http://stackoverflow.com/questions/24492868/i-do-not-understand-this-syntax\" title=\"i do not understand this syntax\">stackoverflow.com/questions/24492868/&hellip;</a>, <a href=\"http://stackoverflow.com/questions/31379404/is-this-casting-in-golang\" title=\"is this casting in golang\">stackoverflow.com/questions/31379404/is-this-casting-in-gola&zwnj;&#8203;ng</a>, <a href=\"http://stackoverflow.com/questions/28946086/what-exactly-does-data-type-method-called-do\" title=\"what exactly does data type method called do\">stackoverflow.com/questions/28946086/&hellip;</a>, <a href=\"http://stackoverflow.com/questions/18340411/what-is-err-os-patherror-in-go\" title=\"what is err os patherror in go\">stackoverflow.com/questions/18340411/&hellip;</a>, <a href=\"http://stackoverflow.com/questions/10415240/what-is-this-foo-bar-baz-thing-in-go-code\" title=\"what is this foo bar baz thing in go code\">stackoverflow.com/questions/10415240/&hellip;</a> (just the first page of results)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446124398, "post_id": 33405373, "comment_id": 54620002, "body": "This one has a good answer though, so maybe we start using this as the original ;)"}, {"owner": {"reputation": 405, "user_id": 428467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725758219af73359800f9e6bc990bb24?s=128&d=identicon&r=PG", "display_name": "jtuki", "link": "https://stackoverflow.com/users/428467/jtuki"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1446131535, "post_id": 33405373, "comment_id": 54625547, "body": "@JimB wow, amazing search results... Could you pls tell me what is your search keyword? I don&#39;t find the answer through neither google or stackoverflow search. :("}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446132408, "post_id": 33405373, "comment_id": 54626159, "body": "@jtuki: If you don&#39;t know what it&#39;s called, then it&#39;s hard to find ;) . In your case I would have searched first for that construct in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">language spec</a>."}, {"owner": {"reputation": 405, "user_id": 428467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725758219af73359800f9e6bc990bb24?s=128&d=identicon&r=PG", "display_name": "jtuki", "link": "https://stackoverflow.com/users/428467/jtuki"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1446142836, "post_id": 33405373, "comment_id": 54633036, "body": "@JimB Thanks for the good advice, I search for <code>.(</code> in the spec link, then find the <code>type assertions</code> section. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1446092549, "last_edit_date": 1446092549, "creation_date": 1446091795, "answer_id": 33405811, "question_id": 33405373, "link": "https://stackoverflow.com/questions/33405373/what-does-r-flate-reader-mean-in-golangs-zlib-reader-go-file/33405811#33405811", "title": "What does &quot;r.(flate.Reader)&quot; mean in golang&#39;s zlib/reader.go file?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">Type assertions</a></p>\n  \n  <p>For an expression x of interface type and a type T, the primary\n  expression</p>\n  \n  <p><code>x.(T)</code></p>\n  \n  <p>asserts that x is not nil and that the value stored in x is of type T.\n  The notation x.(T) is called a type assertion.</p>\n  \n  <p>A type assertion used in an assignment or initialization of the\n  special form</p>\n\n<pre><code>v, ok = x.(T)\nv, ok := x.(T)\nvar v, ok = x.(T)\n</code></pre>\n  \n  <p>yields an additional untyped boolean value. The value of ok is true if\n  the assertion holds. Otherwise it is false and the value of v is the\n  zero value for type T. No run-time panic occurs in this case. C</p>\n</blockquote>\n\n<p><code>r.(flate.Reader)</code> is a type assertion. For example,</p>\n\n<pre><code>func (z *reader) Reset(r io.Reader, dict []byte) error {\n    if fr, ok := r.(flate.Reader); ok {\n        z.r = fr\n    } else {\n        z.r = bufio.NewReader(r)\n    }\n    // more code omitted ...\n}\n</code></pre>\n\n<p><code>r</code> is type <code>io.Reader</code>, an <code>interface</code>. <code>fr, ok := r.(flate.Reader)</code> checks <code>r</code> to see if it contains an <code>io.Reader</code> of type <code>flate.Reader</code>.</p>\n"}], "owner": {"reputation": 405, "user_id": 428467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/725758219af73359800f9e6bc990bb24?s=128&d=identicon&r=PG", "display_name": "jtuki", "link": "https://stackoverflow.com/users/428467/jtuki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "accepted_answer_id": 33405811, "answer_count": 1, "score": 2, "last_activity_date": 1446124350, "creation_date": 1446088573, "last_edit_date": 1446089456, "question_id": 33405373, "link": "https://stackoverflow.com/questions/33405373/what-does-r-flate-reader-mean-in-golangs-zlib-reader-go-file", "title": "What does &quot;r.(flate.Reader)&quot; mean in golang&#39;s zlib/reader.go file?", "body": "<p>I found lots of code snippets like <code>r.(flate.Reader)</code> in golang's zlib/reader.go file. What does it mean?<br>\n<a href=\"https://golang.org/src/compress/zlib/reader.go\" rel=\"nofollow\">https://golang.org/src/compress/zlib/reader.go</a></p>\n\n<pre><code>func (z *reader) Reset(r io.Reader, dict []byte) error {\n    if fr, ok := r.(flate.Reader); ok {\n        z.r = fr\n    } else {\n        z.r = bufio.NewReader(r)\n    }\n    // more code omitted ...\n}\n</code></pre>\n\n<p>P.S. source code of <code>io</code> and <code>flate</code>.<br>\nio: <a href=\"https://golang.org/src/io/io.go\" rel=\"nofollow\">https://golang.org/src/io/io.go</a><br>\nflate: <a href=\"https://golang.org/src/compress/flate/inflate.go\" rel=\"nofollow\">https://golang.org/src/compress/flate/inflate.go</a>   </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5620, "user_id": 252218, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c6b551b65980ad7d5f2577687d5eafe9?s=128&d=identicon&r=PG", "display_name": "BoppreH", "link": "https://stackoverflow.com/users/252218/boppreh"}, "edited": false, "score": 0, "creation_date": 1446088774, "post_id": 33405327, "comment_id": 54602111, "body": "I believe the entire compiler has been translated to Go (self hosting). If you are reading an old version, you might have luck finding the Go code in the newest ones."}, {"owner": {"reputation": 117, "user_id": 1260771, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac05dcdd39b4c9eb66d325c7eb24b8d3?s=128&d=identicon&r=PG", "display_name": "user1260771", "link": "https://stackoverflow.com/users/1260771/user1260771"}, "reply_to_user": {"reputation": 5620, "user_id": 252218, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c6b551b65980ad7d5f2577687d5eafe9?s=128&d=identicon&r=PG", "display_name": "BoppreH", "link": "https://stackoverflow.com/users/252218/boppreh"}, "edited": false, "score": 0, "creation_date": 1446089281, "post_id": 33405327, "comment_id": 54602255, "body": "@BoppreH I have heard that too. But there is still no implementation of <i>append</i> here: <a href=\"https://github.com/golang/go/blob/master/src/builtin/builtin.go\" rel=\"nofollow noreferrer\">link</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1446092014, "last_edit_date": 1446092014, "creation_date": 1446090132, "answer_id": 33405579, "question_id": 33405327, "link": "https://stackoverflow.com/questions/33405327/where-is-the-implementation-of-func-append-in-go/33405579#33405579", "title": "Where is the implementation of func append in Go?", "body": "<p>The Go <code>append</code> builtin function code is generated by the Go <code>gc</code> and <code>gccgo</code> compilers and uses Go package <code>runtime</code> functions (for example, <code>runtime.growslice()</code>)  in <code>go/src/runtime/slice.go</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nfunc main() {\n    b := []int{0, 1}\n    b = append(b, 2)\n}\n</code></pre>\n\n<p>Go pseudo-assembler:</p>\n\n<pre><code>$ go tool compile -S a.go\n\n\"\".main t=1 size=192 value=0 args=0x0 locals=0x68\n    0x0000 00000 (a.go:3)   TEXT    \"\".main(SB), $104-0\n    0x0000 00000 (a.go:3)   MOVQ    (TLS), CX\n    0x0009 00009 (a.go:3)   CMPQ    SP, 16(CX)\n    0x000d 00013 (a.go:3)   JLS 167\n    0x0013 00019 (a.go:3)   SUBQ    $104, SP\n    0x0017 00023 (a.go:3)   FUNCDATA    $0, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x0017 00023 (a.go:3)   FUNCDATA    $1, gclocals\u00b7790e5cc5051fc0affc980ade09e929ec(SB)\n    0x0017 00023 (a.go:4)   LEAQ    \"\".autotmp_0002+64(SP), BX\n    0x001c 00028 (a.go:4)   MOVQ    BX, CX\n    0x001f 00031 (a.go:4)   NOP\n    0x001f 00031 (a.go:4)   MOVQ    \"\".statictmp_0000(SB), BP\n    0x0026 00038 (a.go:4)   MOVQ    BP, (BX)\n    0x0029 00041 (a.go:4)   MOVQ    \"\".statictmp_0000+8(SB), BP\n    0x0030 00048 (a.go:4)   MOVQ    BP, 8(BX)\n    0x0034 00052 (a.go:4)   NOP\n    0x0034 00052 (a.go:4)   MOVQ    $2, AX\n    0x003b 00059 (a.go:4)   MOVQ    $2, DX\n    0x0042 00066 (a.go:5)   MOVQ    CX, \"\".b+80(SP)\n    0x0047 00071 (a.go:5)   MOVQ    AX, \"\".b+88(SP)\n    0x004c 00076 (a.go:5)   MOVQ    DX, \"\".b+96(SP)\n    0x0051 00081 (a.go:5)   MOVQ    AX, BX\n    0x0054 00084 (a.go:5)   INCQ    BX\n    0x0057 00087 (a.go:5)   CMPQ    BX, DX\n    0x005a 00090 (a.go:5)   JHI $1, 108\n    0x005c 00092 (a.go:5)   LEAQ    (CX)(AX*8), BX\n    0x0060 00096 (a.go:5)   MOVQ    $2, (BX)\n    0x0067 00103 (a.go:6)   ADDQ    $104, SP\n    0x006b 00107 (a.go:6)   RET\n    0x006c 00108 (a.go:5)   LEAQ    type.[]int(SB), BP\n    0x0073 00115 (a.go:5)   MOVQ    BP, (SP)\n    0x0077 00119 (a.go:5)   MOVQ    CX, 8(SP)\n    0x007c 00124 (a.go:5)   MOVQ    AX, 16(SP)\n    0x0081 00129 (a.go:5)   MOVQ    DX, 24(SP)\n    0x0086 00134 (a.go:5)   MOVQ    BX, 32(SP)\n    0x008b 00139 (a.go:5)   PCDATA  $0, $0\n    0x008b 00139 (a.go:5)   CALL    runtime.growslice(SB)\n    0x0090 00144 (a.go:5)   MOVQ    40(SP), CX\n    0x0095 00149 (a.go:5)   MOVQ    48(SP), AX\n    0x009a 00154 (a.go:5)   MOVQ    56(SP), DX\n    0x009f 00159 (a.go:5)   MOVQ    AX, BX\n    0x00a2 00162 (a.go:5)   INCQ    BX\n    0x00a5 00165 (a.go:5)   JMP 92\n    0x00a7 00167 (a.go:3)   CALL    runtime.morestack_noctxt(SB)\n    0x00ac 00172 (a.go:3)   JMP 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": true, "score": 11, "last_activity_date": 1446091884, "creation_date": 1446091884, "answer_id": 33405824, "question_id": 33405327, "link": "https://stackoverflow.com/questions/33405327/where-is-the-implementation-of-func-append-in-go/33405824#33405824", "title": "Where is the implementation of func append in Go?", "body": "<p>The code you are reading and citing is just dummy code to have consistent documentation. The built-in functions are, well, built into the language and, as such, are included in the code processing step (the compiler).</p>\n\n<p>Simplified what happens is: lexer will detect '<code>append(...)</code>' as <code>APPEND</code> token, parser will translate <code>APPEND</code>, depending on the circumstances/parameters/environment to code, code is written as assembly and assembled. The middle step - the implementation of <code>append</code> - can be found in the compiler <a href=\"https://github.com/golang/go/blob/6327e8dc69c47d6355e2623cc491f0140d2563f5/src/cmd/compile/internal/gc/cgen.go#L2748\">here</a>.</p>\n\n<p>What happens to an <code>append</code> call is best seen when looking at the assembly of an example program. Consider this:</p>\n\n<pre><code>b := []byte{'a'}\nb = append(b, 'b')\nprintln(string(b), cap(b))\n</code></pre>\n\n<p>Running it will yield the following output:</p>\n\n<pre><code>ab 2\n</code></pre>\n\n<p>The <code>append</code> call  is translated to assembly like this:</p>\n\n<pre><code>// create new slice object\nMOVQ    BX, \"\".b+120(SP)       // BX contains data addr., write to b.addr\nMOVQ    BX, CX                 // store addr. in CX\nMOVQ    AX, \"\".b+128(SP)       // AX contains len(b) == 1, write to b.len\nMOVQ    DI, \"\".b+136(SP)       // DI contains cap(b) == 1, write to b.cap\nMOVQ    AX, BX                 // BX now contains len(b)\nINCQ    BX                     // BX++\nCMPQ    BX, DI                 // compare new length (2) with cap (1)\nJHI $1, 225                    // jump to grow code if len &gt; cap\n...\nLEAQ    (CX)(AX*1), BX         // load address of newly allocated slice entry\nMOVB    $98, (BX)              // write 'b' to loaded address\n\n// grow code, call runtime.growslice(t *slicetype, old slice, cap int)\nLEAQ    type.[]uint8(SB), BP\nMOVQ    BP, (SP)               // load parameters onto stack\nMOVQ    CX, 8(SP)\nMOVQ    AX, 16(SP)\nMOVQ    SI, 24(SP)\nMOVQ    BX, 32(SP)\nPCDATA  $0, $0\nCALL    runtime.growslice(SB)  // call\nMOVQ    40(SP), DI\nMOVQ    48(SP), R8\nMOVQ    56(SP), SI\nMOVQ    R8, AX\nINCQ    R8\nMOVQ    DI, CX\nJMP 108                        // jump back, growing done\n</code></pre>\n\n<p>As you can see, no <code>CALL</code> statement to a function called <code>append</code> can be seen. This is the full implementation of the <code>append</code> call in the example code. Another call with different parameters <em>will</em> look differently (other registers, different parameters depending on the slice type, etc.).</p>\n"}, {"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 1, "last_activity_date": 1446357421, "creation_date": 1446357421, "answer_id": 33459659, "question_id": 33405327, "link": "https://stackoverflow.com/questions/33405327/where-is-the-implementation-of-func-append-in-go/33459659#33459659", "title": "Where is the implementation of func append in Go?", "body": "<p>To add to the assembly code given by the others, you can find the Go (1.5.1) code for gc there : <a href=\"https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/cmd/compile/internal/gc/walk.go#L2895\" rel=\"nofollow\">https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/cmd/compile/internal/gc/walk.go#L2895</a></p>\n\n<pre><code>// expand append(l1, l2...) to\n//   init {\n//     s := l1\n//     if n := len(l1) + len(l2) - cap(s); n &gt; 0 {\n//       s = growslice_n(s, n)\n//     }\n//     s = s[:len(l1)+len(l2)]\n//     memmove(&amp;s[len(l1)], &amp;l2[0], len(l2)*sizeof(T))\n//   }\n//   s\n//\n// l2 is allowed to be a string.\n</code></pre>\n\n<p>with <code>growslice_n</code> being defined there : <a href=\"https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/runtime/slice.go#L36\" rel=\"nofollow\">https://github.com/golang/go/blob/f2e4c8b5fb3660d793b2c545ef207153db0a34b1/src/runtime/slice.go#L36</a></p>\n\n<pre><code>// growslice_n is a variant of growslice that takes the number of new elements\n// instead of the new minimum capacity.\n// TODO(rsc): This is used by append(slice, slice...).\n// The compiler should change that code to use growslice directly (issue #11419).\nfunc growslice_n(t *slicetype, old slice, n int) slice {\n    if n &lt; 1 {\n        panic(errorString(\"growslice: invalid n\"))\n    }\n    return growslice(t, old, old.cap+n)\n}\n\n// growslice handles slice growth during append.\n// It is passed the slice type, the old slice, and the desired new minimum capacity,\n// and it returns a new slice with at least that capacity, with the old data\n// copied into it.\nfunc growslice(t *slicetype, old slice, cap int) slice {\n    if cap &lt; old.cap || t.elem.size &gt; 0 &amp;&amp; uintptr(cap) &gt; _MaxMem/uintptr(t.elem.size) {\n        panic(errorString(\"growslice: cap out of range\"))\n    }\n\n    if raceenabled {\n        callerpc := getcallerpc(unsafe.Pointer(&amp;t))\n        racereadrangepc(old.array, uintptr(old.len*int(t.elem.size)), callerpc, funcPC(growslice))\n    }\n\n    et := t.elem\n    if et.size == 0 {\n        // append should not create a slice with nil pointer but non-zero len.\n        // We assume that append doesn't need to preserve old.array in this case.\n        return slice{unsafe.Pointer(&amp;zerobase), old.len, cap}\n    }\n\n    newcap := old.cap\n    if newcap+newcap &lt; cap {\n        newcap = cap\n    } else {\n        for {\n            if old.len &lt; 1024 {\n                newcap += newcap\n            } else {\n                newcap += newcap / 4\n            }\n            if newcap &gt;= cap {\n                break\n            }\n        }\n    }\n\n    if uintptr(newcap) &gt;= _MaxMem/uintptr(et.size) {\n        panic(errorString(\"growslice: cap out of range\"))\n    }\n    lenmem := uintptr(old.len) * uintptr(et.size)\n    capmem := roundupsize(uintptr(newcap) * uintptr(et.size))\n    newcap = int(capmem / uintptr(et.size))\n    var p unsafe.Pointer\n    if et.kind&amp;kindNoPointers != 0 {\n        p = rawmem(capmem)\n        memmove(p, old.array, lenmem)\n        memclr(add(p, lenmem), capmem-lenmem)\n    } else {\n        // Note: can't use rawmem (which avoids zeroing of memory), because then GC can scan uninitialized memory.\n        p = newarray(et, uintptr(newcap))\n        if !writeBarrierEnabled {\n            memmove(p, old.array, lenmem)\n        } else {\n            for i := uintptr(0); i &lt; lenmem; i += et.size {\n                typedmemmove(et, add(p, i), add(old.array, i))\n            }\n        }\n    }\n\n    return slice{p, old.len, newcap}\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 1260771, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac05dcdd39b4c9eb66d325c7eb24b8d3?s=128&d=identicon&r=PG", "display_name": "user1260771", "link": "https://stackoverflow.com/users/1260771/user1260771"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1121, "favorite_count": 2, "accepted_answer_id": 33405824, "answer_count": 3, "score": 4, "last_activity_date": 1446357421, "creation_date": 1446088270, "last_edit_date": 1446088583, "question_id": 33405327, "link": "https://stackoverflow.com/questions/33405327/where-is-the-implementation-of-func-append-in-go", "title": "Where is the implementation of func append in Go?", "body": "<p>I'm very interested in go, and trying to read go function's implementations. I found some of these function doesn't have implementations there.</p>\n\n<p>Such as append or call:</p>\n\n<pre><code>// The append built-in function appends elements to the end of a slice. If\n// it has sufficient capacity, the destination is resliced to accommodate the\n// new elements. If it does not, a new underlying array will be allocated.\n// Append returns the updated slice. It is therefore necessary to store the\n// result of append, often in the variable holding the slice itself:\n//  slice = append(slice, elem1, elem2)\n//  slice = append(slice, anotherSlice...)\n// As a special case, it is legal to append a string to a byte slice, like this:\n//  slice = append([]byte(\"hello \"), \"world\"...)\nfunc append(slice []Type, elems ...Type) []Type\n\n// call calls fn with a copy of the n argument bytes pointed at by arg.\n// After fn returns, reflectcall copies n-retoffset result bytes\n// back into arg+retoffset before returning. If copying result bytes back,\n// the caller must pass the argument frame type as argtype, so that\n// call can execute appropriate write barriers during the copy.\nfunc call(argtype *rtype, fn, arg unsafe.Pointer, n uint32, retoffset uint32)\n</code></pre>\n\n<p>It seems not calling a C code, because using cgo needs some special comments.\nWhere is these function's implementations?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "edited": false, "score": 0, "creation_date": 1446088891, "post_id": 33405030, "comment_id": 54602149, "body": "&gt; The function will be inlined"}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "edited": false, "score": 0, "creation_date": 1446088916, "post_id": 33405030, "comment_id": 54602153, "body": "Thanks, that was a key point that was holding me back from using functions!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1446088058, "last_edit_date": 1446088058, "creation_date": 1446086257, "answer_id": 33405030, "question_id": 33404906, "link": "https://stackoverflow.com/questions/33404906/how-can-i-define-a-const-datatype/33405030#33405030", "title": "How can I define a `const *DataType`", "body": "<p>In Go, use a function. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype List struct{}\n\nfunc IsEmptyList(list *List) bool {\n    // Representation of the empty list\n    return list == (*List)(nil)\n}\n\nfunc main() {\n    fmt.Println(IsEmptyList((*List)(nil)))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>true\n</code></pre>\n\n<p>The function will be inlined.</p>\n\n<pre><code>$ go tool compile -m emptylist.go\nemptylist.go:7: can inline IsEmptyList\nemptylist.go:13: inlining call to IsEmptyList\nemptylist.go:7: IsEmptyList list does not escape\nemptylist.go:13: IsEmptyList((*List)(nil)) escapes to heap\nemptylist.go:13: main ... argument does not escape\n$ \n</code></pre>\n"}], "owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 1, "accepted_answer_id": 33405030, "answer_count": 1, "score": 0, "last_activity_date": 1446088058, "creation_date": 1446085426, "question_id": 33404906, "link": "https://stackoverflow.com/questions/33404906/how-can-i-define-a-const-datatype", "title": "How can I define a `const *DataType`", "body": "<p>I'm writing a Lisp variant in Go and want to define constants for <code>Nil</code> and <code>EmptyList</code>. These will be referenced throughout the codebase, but I want to prevent them from being accidentally re-defined.</p>\n\n<pre><code>// Representation of the empty list\nvar EmptyList = (*List)(nil)\n</code></pre>\n\n<p>I can't use a <code>const</code> here for two reasons:</p>\n\n<ol>\n<li><code>const</code> definitions cannot be <code>nil</code></li>\n<li><code>const</code> definitions cannot be pointers</li>\n</ol>\n\n<p>What options do I have to ensure <code>EmptyList</code> is always the nil pointer?</p>\n"}, {"tags": ["go", "packer"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 1, "creation_date": 1446079075, "post_id": 33403883, "comment_id": 54599531, "body": "What version of Go are you using? If you install <code>go vet</code> it should work."}, {"owner": {"reputation": 1412, "user_id": 1997707, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/86a28f715dee63c5aec328fc2374b4bd?s=128&d=identicon&r=PG", "display_name": "John Mercier", "link": "https://stackoverflow.com/users/1997707/john-mercier"}, "reply_to_user": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1446079326, "post_id": 33403883, "comment_id": 54599596, "body": "go version go1.4.2 linux/amd64. I installed go using my os package manager (gentoo)"}, {"owner": {"reputation": 1412, "user_id": 1997707, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/86a28f715dee63c5aec328fc2374b4bd?s=128&d=identicon&r=PG", "display_name": "John Mercier", "link": "https://stackoverflow.com/users/1997707/john-mercier"}, "edited": false, "score": 0, "creation_date": 1446111721, "post_id": 33403883, "comment_id": 54611575, "body": "My GOPATH is set and I am able to install other packages. This particular package is trying to install in /usr which I can&#39;t do as a normal user."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1446123480, "post_id": 33403883, "comment_id": 54619367, "body": "So did you install go vet?"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1446130937, "post_id": 33403883, "comment_id": 54625082, "body": "try running <code>go get golang.org&#47;x&#47;tools&#47;cmd&#47;vet</code> if that works <code>cd $GOPATH&#47;github.com&#47;mitchellh&#47;packer</code> and run <code>go vet</code> if that works, you should be able to run <code>make</code> with no issues."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1446153281, "last_edit_date": 1446153281, "creation_date": 1446150369, "answer_id": 33423926, "question_id": 33403883, "link": "https://stackoverflow.com/questions/33403883/building-packer-causes-permission-denied-error/33423926#33423926", "title": "Building packer causes permission denied error", "body": "<p><code>go vet</code> is special, in that it's a tool that needs to go in GOROOT. In most installations GOROOT is also user writable, but if you installed via a package manager it won't be.</p>\n\n<p>To work around this, you can do this as root to avoid changing any permissions in your GOPATH:</p>\n\n<pre><code>GOPATH=/tmp/tmpGOPATH go get golang.org/x/tools/cmd/vet\nrm -rf /tmp/tmpGOPATH\n</code></pre>\n\n<p>Since <code>vet</code> is a tool provided by the official distribution, not having it installed may be considered a bug in gentoo's <code>go</code> package. The official <code>go</code> binary distribution included the following tools:</p>\n\n<pre><code>addr2line\napi\nasm\ncgo\ncompile\ncover\ndist\ndoc\nfix\nlink\nnm\nobjdump\npack\npprof\ntour\ntrace\nvet\nyacc\n</code></pre>\n"}], "owner": {"reputation": 1412, "user_id": 1997707, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/86a28f715dee63c5aec328fc2374b4bd?s=128&d=identicon&r=PG", "display_name": "John Mercier", "link": "https://stackoverflow.com/users/1997707/john-mercier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 498, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1446153281, "creation_date": 1446077959, "question_id": 33403883, "link": "https://stackoverflow.com/questions/33403883/building-packer-causes-permission-denied-error", "title": "Building packer causes permission denied error", "body": "<p>I am trying to build <a href=\"https://github.com/mitchellh/packer#developing-packer\" rel=\"nofollow\">packer</a> and I am getting this error:</p>\n\n<pre><code>go install golang.org/x/tools/cmd/vet: open /usr/lib/go/pkg/tool/linux_amd64/vet: permission denied\nMakefile:40: recipe for target 'test' failed\nmake: *** [test] Error 1\n</code></pre>\n\n<p>Is the installer trying to access my /usr folder? Should I run this under root? How can I fix this?</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1446095503, "post_id": 33403746, "comment_id": 54604001, "body": "<code>err := xml.Unmarshal([]byte(data), &amp;Response)</code> not work?"}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "edited": false, "score": 0, "creation_date": 1446095943, "post_id": 33403746, "comment_id": 54604177, "body": "Apparently there&#39;s only supposed to be one top level element. See the approaches taken in the answers to this question: <a href=\"http://stackoverflow.com/q/27553274/22147\">stackoverflow.com/q/27553274/22147</a>"}, {"owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "reply_to_user": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "edited": false, "score": 0, "creation_date": 1446138067, "post_id": 33403746, "comment_id": 54630106, "body": "@RhythmicFistman That makes sense. Is there an east way to get the top-level element name so I can reject it if it isn&#39;t what I expect?"}], "answers": [{"tags": [], "owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "is_accepted": false, "score": 1, "last_activity_date": 1446162296, "creation_date": 1446162296, "answer_id": 33426606, "question_id": 33403746, "link": "https://stackoverflow.com/questions/33403746/golang-specify-top-level-tag-in-xml-structure/33426606#33426606", "title": "Golang specify top-level tag in xml structure", "body": "<p>Here's a lazy solution: add a new, unique top level element:</p>\n\n<pre><code>var response Response\nerr = xml.Unmarshal([]byte(\"&lt;foo&gt;\"+data+\"&lt;/foo&gt;\"), &amp;response)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2659, "user_id": 496501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f8fef23f99b7192248b37c2c584ac?s=128&d=identicon&r=PG", "display_name": "Justin Ohms", "link": "https://stackoverflow.com/users/496501/justin-ohms"}, "is_accepted": true, "score": 1, "last_activity_date": 1504812253, "creation_date": 1504812253, "answer_id": 46103720, "question_id": 33403746, "link": "https://stackoverflow.com/questions/33403746/golang-specify-top-level-tag-in-xml-structure/46103720#46103720", "title": "Golang specify top-level tag in xml structure", "body": "<p>You can do this without hacking the incoming data, you use the special <code>XMLName xml.Name</code> field to set the outside tag and then use <code>xml:\",chardata\"</code> to access it's contents.</p>\n\n<p>Here is an example:  <a href=\"https://play.golang.org/p/5onZUoa1iB\" rel=\"nofollow noreferrer\">Try it on the go playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype simpleInt struct {\n    XMLName xml.Name `xml:\"integer\"`\n    Int     int      `xml:\",chardata\"`\n}\n\ntype simpleString struct {\n    XMLName xml.Name `xml:\"stringtag\"`\n    String  string   `xml:\",chardata\"`\n}\n\ntype simpleBoolean struct {\n    XMLName xml.Name `xml:\"boolean\"`\n    Boolean bool     `xml:\",chardata\"`\n}\n\nfunc main() {\n\n    bint := []byte(\"&lt;integer&gt;1138&lt;/integer&gt;\")\n    bstring := []byte(\"&lt;stringtag&gt;Caimeo&lt;/stringtag&gt;\")\n    btrue := []byte(\"&lt;boolean&gt;true&lt;/boolean&gt;\")\n    bfalse := []byte(\"&lt;boolean&gt;false&lt;/boolean&gt;\")\n\n    i := simpleInt{}\n    xml.Unmarshal(bint, &amp;i)\n    fmt.Println(i, i.Int)\n\n    s := simpleString{}\n    xml.Unmarshal(bstring, &amp;s)\n    fmt.Println(s, s.String)\n\n    m := simpleBoolean{}\n    xml.Unmarshal(btrue, &amp;m)\n    fmt.Println(m, m.Boolean)\n\n    xml.Unmarshal(bfalse, &amp;m)\n    fmt.Println(m, m.Boolean)\n}\n</code></pre>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 993, "favorite_count": 0, "accepted_answer_id": 46103720, "answer_count": 2, "score": 2, "last_activity_date": 1504812253, "creation_date": 1446077139, "question_id": 33403746, "link": "https://stackoverflow.com/questions/33403746/golang-specify-top-level-tag-in-xml-structure", "title": "Golang specify top-level tag in xml structure", "body": "<p>So I am trying to Unmarshal or Decode some xml into a type (I am still not entirely clear on what the difference is), and I don't seem to be able to specify the outermost type (in this case <code>&lt;people&gt;</code>). When I try to specify this tag, instead of getting an error, the Marshalled value does not contain any of the content I am expecting. How do you specify the outermost tag and why doesn't the second assignment have the expected behavior?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/xml\"\nimport \"log\"\n\nvar data string = `\n&lt;people&gt;\n  &lt;person&gt;\n    &lt;id&gt;46&lt;/id&gt;\n    &lt;name&gt;John Smith&lt;/name&gt;\n  &lt;/person&gt;\n  &lt;person&gt;\n    &lt;id&gt;3007&lt;/id&gt;\n    &lt;name&gt;Joe Smith&lt;/name&gt;\n  &lt;/person&gt;\n&lt;/people&gt;\n`\n\ntype Person struct {\n    Id int `xml:\"id\"`\n    Name string `xml:\"name\"`\n}\n\ntype People struct {\n    PersonList []Person `xml:\"person\"`\n}\n\ntype Response struct {\n    PeopleItem People `xml:\"people\"`\n}\n\nfunc main() {\n    // parsing People\n    // cannot specify outermost tag &lt;people&gt;&lt;/people&gt;\n    var people People\n    err := xml.Unmarshal([]byte(data), &amp;people)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(people)\n    // prints \"{[{46 John Smith} {3007 Joe Smith}]}\"\n    // which is reasonable\n\n    // attempting to parse entire response, yields struct of struct of empty slice\n    var response Response\n    err = xml.Unmarshal([]byte(data), &amp;response)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // response is struct of struct of empty array\n    // why does this happen?\n    fmt.Println(response)\n    // why does this print \"{{[]}}\" ?\n}\n</code></pre>\n"}]