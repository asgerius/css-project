[{"tags": ["go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 3168473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63399da3f0e6188eb8bc10d12da28d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Batman Rises", "link": "https://stackoverflow.com/users/3168473/batman-rises"}, "edited": false, "score": 0, "creation_date": 1550161149, "post_id": 54692515, "comment_id": 96177047, "body": "My current use case is that a service performs similar tasks for a set of ID&#39;s and some task which takes some time to complete so the queue would take this task and process it while the service can perform other things parallely. While pubsub is mainly needed where we have publisher and subscriber here the service itself has some tasks which it needs to keep processing parallely!"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 179, "user_id": 3168473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63399da3f0e6188eb8bc10d12da28d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Batman Rises", "link": "https://stackoverflow.com/users/3168473/batman-rises"}, "edited": false, "score": 0, "creation_date": 1550164831, "post_id": 54692515, "comment_id": 96179194, "body": "@BatmanRises: is that in the same process or are the tasks processed in a separate process?"}, {"owner": {"reputation": 739, "user_id": 5488774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/HfZQZ.jpg?s=128&g=1", "display_name": "Aniruddha Sinha", "link": "https://stackoverflow.com/users/5488774/aniruddha-sinha"}, "edited": false, "score": 0, "creation_date": 1600923720, "post_id": 54692515, "comment_id": 113243428, "body": "Indeed Eli, but Cloud Pub/Sub does not allow deferred execution based on an ETA"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1550153777, "creation_date": 1550153777, "answer_id": 54692515, "question_id": 54679926, "link": "https://stackoverflow.com/questions/54679926/alternative-to-task-queue-on-google-cloud-kubernetes/54692515#54692515", "title": "Alternative to Task queue on Google Cloud Kubernetes", "body": "<p>I would think <a href=\"https://cloud.google.com/pubsub/\" rel=\"nofollow noreferrer\">Cloud Pub/Sub</a> is a great tool for message queues. It's orthogonal to how you deploy/run your services, whether with Kubernetes or something else.</p>\n\n<p>There's a lot of relevant documentation for using pubsub with Kubernetes on GCP, like <a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/connect-to-cloud-pubsub-via-service-broker\" rel=\"nofollow noreferrer\">this page</a>.</p>\n"}], "owner": {"reputation": 179, "user_id": 3168473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/63399da3f0e6188eb8bc10d12da28d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Batman Rises", "link": "https://stackoverflow.com/users/3168473/batman-rises"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 574, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1550242565, "creation_date": 1550094288, "last_edit_date": 1550242565, "question_id": 54679926, "link": "https://stackoverflow.com/questions/54679926/alternative-to-task-queue-on-google-cloud-kubernetes", "title": "Alternative to Task queue on Google Cloud Kubernetes", "body": "<p>I found out that the task queue is being primarily used for App Engine standard environment. I am migrating our existing services from App Engine to Kubernetes. What would be a good alternative for task queue? Push queue is the one which is being currently used.</p>\n\n<p>I read documentation online as well as gone through this link: <a href=\"https://groups.google.com/forum/#!topic/google-appengine/IcIjLfgnNXs\" rel=\"nofollow noreferrer\">When to use PubSub vs Task Queues</a>\nBut there is no clear answer as to whether Pub/Sub is a good alternative on Kubernetes.</p>\n\n<p>Edit:</p>\n\n<p>My current use case is that a service performs similar tasks for a set of ID's and some task which takes some time to complete so the queue would take this task and process it while the service can perform other things in parallel. While Pub/Sub is mainly needed where we have publisher and subscriber here the service itself has some tasks which it needs to keep processing in parallel!</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 2, "creation_date": 1550093708, "post_id": 54679025, "comment_id": 96148466, "body": "Did you try <code>FirstOrCreate()</code>?"}, {"owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1550166843, "post_id": 54679025, "comment_id": 96180144, "body": "@AbdullahI forgat to say that I am creating only the project and Gorm creates skills for me. there is a way gorm can do it automatically, or I need to create first the skills and then attached them to the project?"}, {"owner": {"reputation": 107, "user_id": 8885857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ayLwg.png?s=128&g=1", "display_name": "iamvinitk", "link": "https://stackoverflow.com/users/8885857/iamvinitk"}, "edited": false, "score": 0, "creation_date": 1550209786, "post_id": 54679025, "comment_id": 96192750, "body": "@NirBerko You would be required to add all the skills once during the initialization of the application. So that you can add it to the <code>Project</code>."}, {"owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "reply_to_user": {"reputation": 107, "user_id": 8885857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ayLwg.png?s=128&g=1", "display_name": "iamvinitk", "link": "https://stackoverflow.com/users/8885857/iamvinitk"}, "edited": false, "score": 0, "creation_date": 1550220272, "post_id": 54679025, "comment_id": 96196636, "body": "@iamvinitk so the only way is to add the skills before adding the project, and then relate them to the skills. so there is no way to Gorm to do this automatically with some struct options?"}], "owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1748, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1550166910, "creation_date": 1550090291, "last_edit_date": 1550166910, "question_id": 54679025, "link": "https://stackoverflow.com/questions/54679025/gorm-create-only-if-entry-does-not-exists", "title": "Gorm create only if entry does not exists", "body": "<p>I have the following structs:</p>\n\n<pre><code>type Project struct {\n    gorm.Model\n    Title       string\n    Description string\n    Skills      []Skill `gorm:\"many2many:project_skills;\"`\n}\n\ntype Skill struct {\n    gorm.Model\n    Name string\n}\n</code></pre>\n\n<p>this is how I create the project (and then Gorm creates automatically the skills):</p>\n\n<pre><code>create := rs.Db().Create(&amp;project)\n</code></pre>\n\n<p>there is a simple way through gorm to create skills only if there is no entry with the same name?, and if there is, return the existing one.\nso I will get an array of skills, the new one, and old ones.\nI hope I managed to explain myself.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1550094225, "post_id": 54678816, "comment_id": 96148702, "body": "Using your own defined <code>mux</code> gives you more flexibility. It would allow you to run multiple services inside the same application. You can&#39;t do this using global <code>mux</code>, otherwise, different server implementations will overlap and even possibly contradict when using the same pattern."}], "answers": [{"comments": [{"owner": {"reputation": 850, "user_id": 394618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mVthP.jpg?s=128&g=1", "display_name": "Thomas Zeman", "link": "https://stackoverflow.com/users/394618/thomas-zeman"}, "edited": false, "score": 0, "creation_date": 1599964090, "post_id": 54678863, "comment_id": 112937345, "body": "Wonder whether you could even consider using DefaultServeMux as a security flaw. You are hosting routes you potentially don&#39;t have full control over. Are there &#39;best practices&#39; code validators out there that would catch that?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 850, "user_id": 394618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mVthP.jpg?s=128&g=1", "display_name": "Thomas Zeman", "link": "https://stackoverflow.com/users/394618/thomas-zeman"}, "edited": false, "score": 0, "creation_date": 1600117394, "post_id": 54678863, "comment_id": 112981603, "body": "@ThomasZeman I&#39;m not sure I&#39;d consider that a security flaw; you do have control over it, in that routes are registered by compiled code. No external attacker could maliciously register a route."}, {"owner": {"reputation": 850, "user_id": 394618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mVthP.jpg?s=128&g=1", "display_name": "Thomas Zeman", "link": "https://stackoverflow.com/users/394618/thomas-zeman"}, "edited": false, "score": 0, "creation_date": 1600168750, "post_id": 54678863, "comment_id": 112996879, "body": "I agree it is a bit contrived, but pulling in arbitrary 3rd party libraries can increase the risk of running malicious code, which registers its handlers."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 850, "user_id": 394618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mVthP.jpg?s=128&g=1", "display_name": "Thomas Zeman", "link": "https://stackoverflow.com/users/394618/thomas-zeman"}, "edited": false, "score": 0, "creation_date": 1600175290, "post_id": 54678863, "comment_id": 113000001, "body": "@ThomasZeman pulling in arbitrary 3rd party libraries without vetting them is a security risk regardless of whether you&#39;re using <code>DefaultServeMux</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1550089603, "creation_date": 1550089603, "answer_id": 54678863, "question_id": 54678816, "link": "https://stackoverflow.com/questions/54678816/using-handlefunc-on-http-vs-mux/54678863#54678863", "title": "Using HandleFunc on http vs mux", "body": "<p><code>http.HandleFunc</code> et al apply your handlers to a package-global instance of the <code>ServeMux</code> held in the <code>http</code> package, which <code>http.ListenAndServe</code> then starts. You can also create your own instance as you did in the first example, which gives you some more control and makes it easier to unit test. In the end, the choice is yours; the convenience functions and package globals are probably fine for smaller projects with a limited maintenance period, but for larger or longer-lived projects I would generally recommend managing your own instances of both <code>ServeMux</code> and <code>Server</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 850, "user_id": 394618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mVthP.jpg?s=128&g=1", "display_name": "Thomas Zeman", "link": "https://stackoverflow.com/users/394618/thomas-zeman"}, "edited": false, "score": 0, "creation_date": 1599964229, "post_id": 63253648, "comment_id": 112937356, "body": "Are there any code validators out there catching such potential security flaws?"}], "tags": [], "owner": {"reputation": 99, "user_id": 6118542, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jWxxY.png?s=128&g=1", "display_name": "Marcin Kulik", "link": "https://stackoverflow.com/users/6118542/marcin-kulik"}, "is_accepted": false, "score": 1, "last_activity_date": 1596568415, "creation_date": 1596568415, "answer_id": 63253648, "question_id": 54678816, "link": "https://stackoverflow.com/questions/54678816/using-handlefunc-on-http-vs-mux/63253648#63253648", "title": "Using HandleFunc on http vs mux", "body": "<p><code>http.HandleFunc()</code> uses <code>DefaultServeMux</code> which is a global variable. Therefore any third party package can have access to <code>DefaultServeMux</code>. In a scenario in which a third party package was compromised, it could use DefaultServeMux to expose malicious handler to your web application. This is one of the reasons why it is recommended in production code to use your own servemux as shown in your first example.</p>\n"}], "owner": {"reputation": 416, "user_id": 4381225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aec91934b189d3d6738211b322cf2acb?s=128&d=identicon&r=PG&f=1", "display_name": "mycellius", "link": "https://stackoverflow.com/users/4381225/mycellius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "accepted_answer_id": 54678863, "answer_count": 2, "score": 2, "last_activity_date": 1596568415, "creation_date": 1550089397, "question_id": 54678816, "link": "https://stackoverflow.com/questions/54678816/using-handlefunc-on-http-vs-mux", "title": "Using HandleFunc on http vs mux", "body": "<p>I'm new to go and want to set up some routing, as well as <code>cors</code>. I've been seeing two styles of doing so, one that initializes a multiplexer with <code>NewServeMux</code> and then assigns handlers with <code>HandleFunc</code>, and one that uses <code>HandleFunc</code> directly on <code>http</code>. This is what I mean:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.HandleFunc(\"/api\", apiFunc)\nmux.HandleFunc(\"/\", indexFunc)\n</code></pre>\n\n<p>vs </p>\n\n<pre><code>http.HandleFunc(\"/api\", apiFunc)\nhttp.HandleFunc(\"/\", indexFunc)\nhttp.ListenAndServe(\"127.0.0.1:3001\", nil)\n</code></pre>\n\n<p>Are there any differences with these approaches? If they accomplish similar things, is one more common/pragmatic?</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550089686, "post_id": 54678803, "comment_id": 96146658, "body": "That depends on what the records are and how they&#39;re held in memory - the body of <code>makeUpdate</code> is pretty important to answer this, but generally speaking in Go your primary synchronization tools are channels and <code>sync.Mutex</code>."}, {"owner": {"reputation": 705, "user_id": 637794, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/b7cb728a98ea17d32a6b12d2affebd13?s=128&d=identicon&r=PG", "display_name": "Sammy", "link": "https://stackoverflow.com/users/637794/sammy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550089970, "post_id": 54678803, "comment_id": 96146802, "body": "@Adrian thanks for the answer. However, i don&#39;t think the body should matter. The question is really how to synchronize depending on a value each caller has"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550090021, "post_id": 54678803, "comment_id": 96146824, "body": "The body matters very much, because <code>makeUpdate</code> is what needs to be synchronized, or more specifically, access to the data that <code>makeUpdate</code> is manipulating is what needs to be synchronized."}, {"owner": {"reputation": 705, "user_id": 637794, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/b7cb728a98ea17d32a6b12d2affebd13?s=128&d=identicon&r=PG", "display_name": "Sammy", "link": "https://stackoverflow.com/users/637794/sammy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550090314, "post_id": 54678803, "comment_id": 96146952, "body": "@Adrian no, it is not the access to the data that needs to be synched, it is the code in makeUpdate(). Imagine it just calls a service somewhere and we should treat it as a blackbox"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550090603, "post_id": 54678803, "comment_id": 96147104, "body": "Perhaps you could further explain your situation, because generally speaking, access to data is the only thing that ever needs to be synchronized."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1550092511, "post_id": 54678803, "comment_id": 96147926, "body": "You may find the <a href=\"https://godoc.org/golang.org/x/sync/singleflight\" rel=\"nofollow noreferrer\">singleflight package</a> useful."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 0, "creation_date": 1550124469, "post_id": 54678803, "comment_id": 96156587, "body": "@Sammy: Are the set of IDs unlimited or a fixed number? That will determine if you have to dynamically create mutexes."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 0, "creation_date": 1550124686, "post_id": 54678803, "comment_id": 96156672, "body": "Just to clarify - I think you are saying you want to serialize &quot;updates&quot; for the same ID but allow updates for different IDs to execute in parallel. You could use a sync.Mutex for each ID but a better way may be to create a channel for each ID and a go-routine for each channel that reads the ID and executes the update."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1550261492, "creation_date": 1550261492, "answer_id": 54716396, "question_id": 54678803, "link": "https://stackoverflow.com/questions/54678803/sync-access-for-the-same-variable/54716396#54716396", "title": "Sync access for the same variable", "body": "<p>As comments suggest - you need to protect data access not functional access.</p>\n\n<p>Easiest way to achieve this, is to make a struct type with a lock - and attach the critical functional update as a method e.g.</p>\n\n<pre><code>type MyData struct {\n        l sync.Mutex\n        // add any other task related attributes here too\n}\n\n// makeUpdate *MUST* use a pointer to our struct (i.e. 'm *MyData')\n// as Mutex logic breaks if copied (so no 'm MyData')\nfunc (m *MyData) makeUpdate(id int) {\n        m.l.Lock()\n        defer m.l.Unlock()\n\n        fmt.Printf(\"better makeUpdate(%d)\\n\", id) \n\n        // do critical stuff here\n\n        // don't dilly-dally - lock is still being used - so return quickly\n}\n</code></pre>\n\n<p>Try this out in the <a href=\"https://play.golang.org/p/yPtKtOsIXvw\" rel=\"nofollow noreferrer\">playground</a>.</p>\n"}], "owner": {"reputation": 705, "user_id": 637794, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/b7cb728a98ea17d32a6b12d2affebd13?s=128&d=identicon&r=PG", "display_name": "Sammy", "link": "https://stackoverflow.com/users/637794/sammy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1550261492, "creation_date": 1550089343, "question_id": 54678803, "link": "https://stackoverflow.com/questions/54678803/sync-access-for-the-same-variable", "title": "Sync access for the same variable", "body": "<p>I want to make sure that my update function is executed only by one thread at a time for a given value. </p>\n\n<pre><code>func update1(int id){\n   ...\n   makeUpdate(id)\n   ...\n}\n\nfunc update2(int id){\n   ...\n   makeUpdate(id)\n   ...\n}\n</code></pre>\n\n<p>So, how should I write my makeUpdate() function that the myUpdate block is executed only once for a given id value? That means if update1 is updating the record with the id \"15\" and update2 with the id \"20\", the block access should not be synchronized.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 83, "user_id": 10390522, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2FBqsenZU18/AAAAAAAAAAI/AAAAAAAAABQ/z3xD03JX6mM/photo.jpg?sz=128", "display_name": "Shikuan Xu", "link": "https://stackoverflow.com/users/10390522/shikuan-xu"}, "is_accepted": false, "score": 0, "last_activity_date": 1552465410, "creation_date": 1552465410, "answer_id": 55137256, "question_id": 54678765, "link": "https://stackoverflow.com/questions/54678765/golan-gin-api-return-invalid-url-escape/55137256#55137256", "title": "golan-gin api return invalid URL escape %", "body": "<p>Don't use Postman.</p>\n\n<pre><code>curl -X POST http://localhost:8080/server-image/upload-file -F \"file=@/Users/shikuanxu/Downloads/images/course-outline.png\" -H \"Content-Type: multipart/form-data\"\n</code></pre>\n\n<p>Try again</p>\n"}], "owner": {"reputation": 51, "user_id": 11058097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/800217bc35ed593f336a6f82f1717e31?s=128&d=identicon&r=PG&f=1", "display_name": "kodiu", "link": "https://stackoverflow.com/users/11058097/kodiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 502, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552465410, "creation_date": 1550089174, "last_edit_date": 1550104833, "question_id": 54678765, "link": "https://stackoverflow.com/questions/54678765/golan-gin-api-return-invalid-url-escape", "title": "golan-gin api return invalid URL escape %", "body": "<p>I want to create an api for uploading images in my go-gin application. This is my current api code :</p>\n\n<pre><code>func (s *Service) ImageCreate(c *gin.Context) {\n    token := c.MustGet(tokenKey).(*models.Token)\n    now := time.Now()\n\n    file, err := c.FormFile(\"file\")\n    if err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": \"01&gt; \" + err.Error()})\n        return\n    }\n}\n</code></pre>\n\n<p>When I call my application from the browser it returns this error:</p>\n\n<pre><code>{\"error\":\"01\\u003e invalid URL escape \\\"%$\\\\xf4\\\"\"}\n</code></pre>\n\n<p>In postman api it's working without error. What is wrong? How I can fix it for the browser?</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1550083135, "post_id": 54677024, "comment_id": 96143618, "body": "The <code>go get</code> command may do that. What happens if you remove the build command? Is /go/bin/myapp still there?"}], "answers": [{"comments": [{"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1550152341, "post_id": 54678562, "comment_id": 96171412, "body": "why is the behavior different on my local machine? Also, is go build overwriting it?"}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1550153113, "post_id": 54678562, "comment_id": 96171868, "body": "I have confirmed that in Docker, passing -d breaks the dockerfile as expected, so this answer is correct. However it is still a mystery why go get doesn&#39;t function the same locally. Doing an ls on bin after go get locally does NOT find myapp."}, {"owner": {"reputation": 2080, "user_id": 1160992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23ddf8179aa985dcb04158c265effdc9?s=128&d=identicon&r=PG", "display_name": "codestation", "link": "https://stackoverflow.com/users/1160992/codestation"}, "reply_to_user": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1550154641, "post_id": 54678562, "comment_id": 96172850, "body": "@Tommy do you have your software on the GOPATH on your local machine? Go tools have different behaviour depending on the GOPATH. I did my test on both local and docker and go get installed the binary on GOPATH/bin."}], "tags": [], "owner": {"reputation": 2080, "user_id": 1160992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23ddf8179aa985dcb04158c265effdc9?s=128&d=identicon&r=PG", "display_name": "codestation", "link": "https://stackoverflow.com/users/1160992/codestation"}, "is_accepted": true, "score": 1, "last_activity_date": 1550088270, "creation_date": 1550088270, "answer_id": 54678562, "question_id": 54677024, "link": "https://stackoverflow.com/questions/54677024/go-build-in-docker-unexpected-binary-in-go-bin/54678562#54678562", "title": "go build in docker: unexpected binary in /go/bin", "body": "<p>The <code>go get</code> command is installing your package into /go/bin. If you dont want to install your current package then pass <code>-d</code> to stop after downloading your dependencies.</p>\n\n<blockquote>\n  <p>The -d flag instructs get to stop after downloading the packages; that is, it instructs get not to install the packages.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies</a></p>\n"}], "owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 54678562, "answer_count": 1, "score": 1, "last_activity_date": 1550088270, "creation_date": 1550082349, "question_id": 54677024, "link": "https://stackoverflow.com/questions/54677024/go-build-in-docker-unexpected-binary-in-go-bin", "title": "go build in docker: unexpected binary in /go/bin", "body": "<p>According to this post: <a href=\"https://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a></p>\n\n<p><code>go build</code> builds the binary and leaves it in the current directory, while <code>go install</code> moves the binary into <code>$GOPATH/bin</code>.</p>\n\n<p>This works on my machine like that. However, I have a Dockerfile:</p>\n\n<pre><code>FROM golang:latest\nADD . /go/src/myapp\nWORKDIR /go/src/myapp\nRUN go get .\nRUN go build \nRUN ls /go/bin # shows myapp!!\nENTRYPOINT [\"/go/bin/myapp\"] #works!!\n</code></pre>\n\n<p>There should be no difference here. The expected result was that <code>/go/bin</code> was empty and the binary <code>myapp</code> would be  <code>/go/src/myapp/myapp</code>\nInstead, I see that build is working like install, and the binary shows up in /go/bin. Why??</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1550083649, "post_id": 54676839, "comment_id": 96143856, "body": "<code>var exists bool; err := dr.db.QueryRow(statement, args...).Scan(&amp;exists); &#47;&#47; check error and then check exists</code>. Your query has a parameter placeholder <code>$3</code> however you&#39;re not passing any args to the func, that will result in an error, also the fact that you have one placeholder but its ordinal number is <code>3</code> instead of <code>1</code> is strange and probably will result in an error no matter how many args you pass in."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1550083745, "post_id": 54676839, "comment_id": 96143904, "body": "Also, never discard the <code>*sql.Rows</code> value returned from <code>Query</code> or else your app will run out of connections. This is because the rows value must be explicitly closed by the caller."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1550083590, "post_id": 54677200, "comment_id": 96143820, "body": "&quot;Every call to Scan, even the first one, must be preceded by a call to Next.&quot; <a href=\"https://golang.org/pkg/database/sql/#Rows.Next\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Rows.Next</a>. For result sets with a single row, such as this one, <a href=\"https://golang.org/pkg/database/sql/#example_DB_QueryRowContext\" rel=\"nofollow noreferrer\">QueryRow(Context) is simpler to use</a>."}, {"owner": {"reputation": 895, "user_id": 5117502, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/3af1c137fcafdd6975f358e1fb43ca4c?s=128&d=identicon&r=PG&f=1", "display_name": "Jay266", "link": "https://stackoverflow.com/users/5117502/jay266"}, "edited": false, "score": 0, "creation_date": 1550085747, "post_id": 54677200, "comment_id": 96144796, "body": "The problem I am having with the query is that it either returns t or f. So, it will always succeed. How can I use rows.scan to tell me that it is false?"}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": false, "score": 2, "last_activity_date": 1550083115, "creation_date": 1550083115, "answer_id": 54677200, "question_id": 54676839, "link": "https://stackoverflow.com/questions/54676839/how-to-db-query-and-then-check-the-result/54677200#54677200", "title": "How to DB query and then check the result", "body": "<p><code>Query()</code> does not return true or false. It returns two values: <code>*Rows</code> &amp; <code>error</code>.</p>\n\n<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error) {\n    ...\n}\n</code></pre>\n\n<p>In your case: <code>checkIfExists</code> is the error. With this error, you can already tell of the query succeeded or failed. Like you do it:</p>\n\n<pre><code>if checkIfExists != nil {\n    return checkIfExists\n}\n</code></pre>\n\n<p>If you want more information (<em>such as the rows retrieved by your query</em>), then you will need to replace the <code>_</code> with a variable. Let's call it <code>rows</code> and then you use <code>rows.Scan()</code> to copy the data in the columns to your destinations. See <code>database/sql</code> <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\">docs</a> for more information.</p>\n"}], "owner": {"reputation": 895, "user_id": 5117502, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/3af1c137fcafdd6975f358e1fb43ca4c?s=128&d=identicon&r=PG&f=1", "display_name": "Jay266", "link": "https://stackoverflow.com/users/5117502/jay266"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1550083115, "creation_date": 1550081650, "question_id": 54676839, "link": "https://stackoverflow.com/questions/54676839/how-to-db-query-and-then-check-the-result", "title": "How to DB query and then check the result", "body": "<p>I need to check if my query returns true or false. If it returns false, I want it to error out. Here is my code:</p>\n\n<pre><code>func (dr *dbrepo) checkIfUnique(datacenterstring) error {\n    statement := `select exists(select 1 from source where datacenter = $3)`\n\n    _, checkIfExists := dr.db.Query(statement)\n    if checkIfExists != nil {\n        log.Print(\"Error  is not unique\", checkIfExists)\n        return checkIfExists\n    }\n    return nil\n}\n</code></pre>\n\n<p>The problem is: I think I need to convert <code>checkIfExists</code> from a row to a bool and then see if it is true or false. But I am not sure on how to do that. Any ideas? Is there a better way to do this?</p>\n"}, {"tags": ["go", "process", "wmi", "ole"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11098585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f2992ba2334e5ff23650369e605703f?s=128&d=identicon&r=PG&f=1", "display_name": "Sopwith", "link": "https://stackoverflow.com/users/11098585/sopwith"}, "is_accepted": false, "score": 0, "last_activity_date": 1616163611, "last_edit_date": 1616163611, "creation_date": 1550788964, "answer_id": 54817403, "question_id": 54676447, "link": "https://stackoverflow.com/questions/54676447/how-get-process-owner-use-wmi-request/54817403#54817403", "title": "How get process owner use WMI request", "body": "<p>It took me a while to figure this out.</p>\n<p>The GetOwner method is expecting you to pass two string parameters. These strings will contain the results of the method call.</p>\n<pre><code>var user ole.VARIANT\nvar domain ole.VARIANT\nres, err := oleutil.CallMethod(item, &quot;GetOwner&quot;, &amp;user, &amp;domain)\nfmt.Printf(&quot;user: %v\\tdomain: %v&quot;, user.ToString(), domain.ToString())\n</code></pre>\n<p>To get the SID you do the same thing:</p>\n<pre><code> var sid ole.VARIANT\n res, err := oleutil.CallMethod(item, &quot;GetOwnerSid&quot;, &amp;sid)\n fmt.Printf(&quot;sid: %v\\n&quot;, sid.ToString())\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11057937, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Xy6eFzgXQ8w/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMk-kxupmPPARHvCceUHklp__vXYg/mo/photo.jpg?sz=128", "display_name": "Ceres", "link": "https://stackoverflow.com/users/11057937/ceres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1616163611, "creation_date": 1550080120, "last_edit_date": 1550080920, "question_id": 54676447, "link": "https://stackoverflow.com/questions/54676447/how-get-process-owner-use-wmi-request", "title": "How get process owner use WMI request", "body": "<p>I try to receive the list of processes using <strong><em>go-ole</em></strong> library:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>\n    package main\n\n    import (\n        \"fmt\"\n        \"github.com/go-ole/go-ole\"\n        \"github.com/mattn/go-ole/oleutil\"\n    )\n\n\n    func main() {\n        ole.CoInitialize(0)\n        defer ole.CoUninitialize()\n\n        unknown, _ := oleutil.CreateObject(\"WbemScripting.SWbemLocator\")\n        defer unknown.Release()\n\n        wmi, _ := unknown.QueryInterface(ole.IID_IDispatch)\n        defer wmi.Release()\n\n        serviceRaw, _ := oleutil.CallMethod(wmi, \"ConnectServer\")\n        service := serviceRaw.ToIDispatch()\n        defer service.Release()\n\n        resultRaw, _ := oleutil.CallMethod(service, \"ExecQuery\", \"SELECT * FROM Win32_Process\")\n        result := resultRaw.ToIDispatch()\n        defer result.Release()\n\n        countVar, _ := oleutil.GetProperty(result, \"Count\")\n        count := int(countVar.Val)\n\n        for i :=0; i &lt; count; i++ {\n            itemRaw, _ := oleutil.CallMethod(result, \"ItemIndex\", i)\n            item := itemRaw.ToIDispatch()\n            defer item.Release()\n\n            processName, _ := oleutil.GetProperty(item, \"Name\")\n            fmt.Println(processName.ToString())\n        }\n    }\n\n</code></pre>\n\n<p>but I cannot receive the owner of process, call method <strong><em>GetOwner</em></strong></p>\n\n<pre class=\"lang-go prettyprint-override\"><code>ownerRaw, _ := oleutil.CallMethod(item, \"GetOwner\")\nfmt.Println(ownerRaw)\n</code></pre>\n\n<p>because GetOwner return value is int32</p>\n\n<pre><code>\n    uint32 GetOwner(\n      [out] string User,\n      [out] string Domain\n    );\n\n</code></pre>\n\n<blockquote>\n  <p><em><a href=\"https://docs.microsoft.com/en-us/windows/desktop/cimwin32prov/getowner-method-in-class-win32-process\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/windows/desktop/cimwin32prov/getowner-method-in-class-win32-process</a></em></p>\n</blockquote>\n\n<p>How it is possible to receive the owner as string for each process?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1550079902, "post_id": 54676334, "comment_id": 96142027, "body": "The <a href=\"https://cloud.google.com/appengine/docs/standard/go111/runtime\" rel=\"nofollow noreferrer\">Go 1.11 Runtime Environment</a> can connect to the datastore without a request context."}, {"owner": {"reputation": 885, "user_id": 606571, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0546906539a9b70ee3f1c1d1df018f07?s=128&d=identicon&r=PG", "display_name": "UltraMaster", "link": "https://stackoverflow.com/users/606571/ultramaster"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550137298, "post_id": 54676334, "comment_id": 96162576, "body": "You are correct, thank you. using runtime <code>go111</code> I can use the <code>cloud.google.com&#47;go&#47;datastore</code> package instead of <code>google.golang.org&#47;appengine&#47;datastore</code> and then it&#39;s possible to get context by calling <code>ctx := context.Background()</code> would you like to craft an answer or should I? Thank you again @ThunderCat"}], "owner": {"reputation": 885, "user_id": 606571, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0546906539a9b70ee3f1c1d1df018f07?s=128&d=identicon&r=PG", "display_name": "UltraMaster", "link": "https://stackoverflow.com/users/606571/ultramaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550079641, "creation_date": 1550079641, "question_id": 54676334, "link": "https://stackoverflow.com/questions/54676334/google-appengine-connect-to-datastore-without-request", "title": "Google Appengine: connect to datastore without request", "body": "<p>In all tutorials on using datastore with appengine standard go environment suggest that I should obtain appengine context from the http request and use this context when manipulating the datastore. <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/api-overview\" rel=\"nofollow noreferrer\">Golang appengine datastore introduction</a></p>\n\n<p>This is unfortunate because it makes it hard for me to use dependency injection of data services into my controllers (handlers). I can't create one instance of aservice while initializing the controller, but I have to pass requests/contexts to every data related operation.</p>\n\n<pre><code>func createHandler(dbService db.DBService) http.HandleFunc\n   return func (req http.Request, resp http.Response) {\n       entity := bindEntity(req)\n       /*\n       I undertand that I can pass whole request to the dbService\n       to at least remove dependency on datastore from this handler\n       but it doesn't seem right to pass request everywhere\n       */\n       ctx := appengine.NewContext(req)\n       dbService.StoreEntity(ctx, entity)\n   }\n}  \n\n</code></pre>\n\n<p>Is there a way of getting the appengine context from somewhere else except for request? Or is there some common known design pattern how to separate the responsibility of handling request and manipulating data in app engine?</p>\n\n<pre><code>dbService := db.CreateServcie(somehowObtainedContext)\n\nfunc createHandler(dbService db.DBService) http.HandleFunc\n   return func (req http.Request, resp http.Response) {\n       entity := bindEntity(req)\n       dbService.StoreEntity(entity)\n   }\n}  \n\n</code></pre>\n\n<p>This would make the code clearer and testing easier.</p>\n"}, {"tags": ["go", "visual-studio-code", "compiler-optimization"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1550079072, "post_id": 54675417, "comment_id": 96141552, "body": "Is it possible it&#39;s jumping around because you have multiple goroutines running concurrently?"}, {"owner": {"reputation": 366, "user_id": 1024845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f099a8bd16d93067e748a601a0854a3c?s=128&d=identicon&r=PG", "display_name": "James C", "link": "https://stackoverflow.com/users/1024845/james-c"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550175226, "post_id": 54675417, "comment_id": 96183630, "body": "Good question. I should have noted that the code that I was stepping through doesn&#39;t invoke any goroutines."}], "owner": {"reputation": 366, "user_id": 1024845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f099a8bd16d93067e748a601a0854a3c?s=128&d=identicon&r=PG", "display_name": "James C", "link": "https://stackoverflow.com/users/1024845/james-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550076532, "creation_date": 1550076532, "question_id": 54675417, "link": "https://stackoverflow.com/questions/54675417/compiler-optimization-in-visual-studio-code-go-debugging", "title": "Compiler Optimization In Visual Studio Code Go Debugging", "body": "<p>When stepping through my code using VSCode debugging, I see it skip lines or jump around in such a way that suggests it is jumping through optimized code. For example, it will skip lines where I have breakpoints set, even though I expect the line to be executed. Is <code>go test</code> running with compiler optimizations enabled? If so, is there a way to disable those optimizations? Either in the the <code>go test</code> command line or with VSCode settings? I tried <code>-gcflags='-N -l'</code> in my launch.json for a test configuration but it is not recognized.</p>\n"}, {"tags": ["go", "kubernetes", "kubectl", "client-go"], "answers": [{"tags": [], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "is_accepted": false, "score": 6, "last_activity_date": 1550864256, "last_edit_date": 1550864256, "creation_date": 1550783711, "answer_id": 54816321, "question_id": 54675382, "link": "https://stackoverflow.com/questions/54675382/how-to-list-all-kubernetes-objects-with-specific-label-using-client-go/54816321#54816321", "title": "How to list all kubernetes objects with specific label using client-go", "body": "<p>You can't list \"all objects\" with one call. </p>\n\n<p>Unfortunately the way Kubernetes API is architected is via API groups, which have multiple APIs under them.</p>\n\n<p>So you need to:</p>\n\n<ol>\n<li>Query all API groups (<code>apiGroup</code>)</li>\n<li>Visit each API group to see what APIs (<code>kind</code>) it exposes.</li>\n<li>Actually query that <code>kind</code> to get all the objects (here you may actually filter the list query with the label).</li>\n</ol>\n\n<p>Fortunately, <code>kubectl api-versions</code> and <code>kubectl api-resources</code> commands do these.</p>\n\n<p>So to learn how kubectl finds all \"kinds\" of API resources, run:</p>\n\n<pre><code>kubectl api-resources -v=6\n</code></pre>\n\n<p>and you'll see kubectl making calls like:</p>\n\n<ul>\n<li><code>GET https://IP/api</code></li>\n<li><code>GET https://IP/apis</code></li>\n<li>then it visits every api group:\n\n<ul>\n<li><code>GET https://IP/apis/metrics.k8s.io/v1beta1</code></li>\n<li><code>GET https://IP/apis/storage.k8s.io/v1</code></li>\n<li>...</li>\n</ul></li>\n</ul>\n\n<p>So if you're trying to clone this behavior with client-go, you should use the same API calls, or better just write a script just shells out to <code>kubectl api-resources -o=json</code> and script around it. </p>\n"}], "owner": {"reputation": 101, "user_id": 10480220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sXjVSEHm4GM/AAAAAAAAAAI/AAAAAAAAGCE/lCm39D1Z2rM/photo.jpg?sz=128", "display_name": "Kseniia Churiumova", "link": "https://stackoverflow.com/users/10480220/kseniia-churiumova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3637, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1550864256, "creation_date": 1550076431, "last_edit_date": 1550152488, "question_id": 54675382, "link": "https://stackoverflow.com/questions/54675382/how-to-list-all-kubernetes-objects-with-specific-label-using-client-go", "title": "How to list all kubernetes objects with specific label using client-go", "body": "<p>I want to execute equivalent of</p>\n\n<p><code>kubectl get all -l app=myapp -n mynamespace</code></p>\n\n<p>or</p>\n\n<p><code>kubectl label all -l version=1.2.0,app=myapp track=stable --overwrite</code></p>\n\n<p>using client-go</p>\n\n<p>I looked at <a href=\"https://github.com/kubernetes/client-go/blob/master/dynamic\" rel=\"nofollow noreferrer\">dynamic</a> package, but it seems like it needs <code>GroupVersionResource</code>, which is different for, say, Service objects and Deployment objects. Also when I pass <code>schema.GroupVersionResource{Group: \"apps\", Version: \"v1\"}</code> it doesn't find anything, when I pass <code>schema.GroupVersionResource{Version: \"v1\"}</code> it finds only namespace object and also doesn't looks for labels, though I provided label options:</p>\n\n<pre><code>resource := schema.GroupVersionResource{Version: \"v1\"}\nlistOptions := metav1.ListOptions{LabelSelector: fmt.Sprintf(\"app=%s\", AppName), FieldSelector: \"\"}\nres, listErr := dynamicClient.Resource(resource).Namespace(\"myapps\").List(listOptions)\n</code></pre>\n\n<p>I also looked at runtime package, but didn't find anything useful. I took a look at how <code>kubectl</code> implement this, bit haven't figured it out yet, too many levels of abstractions.</p>\n"}, {"tags": ["session", "go", "ibm-cloud-infrastructure"], "answers": [{"tags": [], "owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "is_accepted": true, "score": 1, "last_activity_date": 1550158161, "last_edit_date": 1550158161, "creation_date": 1550081859, "answer_id": 54676896, "question_id": 54675353, "link": "https://stackoverflow.com/questions/54675353/softlayer-api-for-closing-a-session-in-golang/54676896#54676896", "title": "Softlayer API for closing a session in golang?", "body": "<p>The <a href=\"https://github.com/softlayer/softlayer-go/blob/master/session/session.go\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go/blob/master/session/session.go</a> \n basically configures the go-client by storing the username, apiKey, endpoint, timeout, etc., in variables, which are used every time do a request to the API.</p>\n\n<p>If you review the <a href=\"https://softlayer.github.io/reference/softlayerapi/\" rel=\"nofollow noreferrer\">SoftLayer API</a>, it doesn't have any method that will create/close a session, so if you want to simulate something similar then I think you can try by sending blank values to <code>Session.New()</code> and removing any value stored in <code>~/.softlayer</code> file</p>\n"}], "owner": {"reputation": 1042, "user_id": 1314467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d2de3d42024063a4d7dcef45ed368dc0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishmeet", "link": "https://stackoverflow.com/users/1314467/ishmeet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 54676896, "answer_count": 1, "score": 0, "last_activity_date": 1550158161, "creation_date": 1550076322, "question_id": 54675353, "link": "https://stackoverflow.com/questions/54675353/softlayer-api-for-closing-a-session-in-golang", "title": "Softlayer API for closing a session in golang?", "body": "<p>I am using the softlayer go client \n<a href=\"https://github.com/softlayer/softlayer-go\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go</a></p>\n\n<p>I am not able to close the softlayer session. How do I do that?</p>\n\n<p>I have created the softlayer session using the <code>Session.New()</code> API. \nReference:- <a href=\"https://github.com/softlayer/softlayer-go/blob/master/session/session.go\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go/blob/master/session/session.go</a></p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-debugger"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550079216, "post_id": 54674784, "comment_id": 96141629, "body": "Yes, vscode debugger UI supports the Go debugger (delve). Have you installed the Go plugin for VS Code? If so, you just use the normal debugging functions in VS Code to debug your project."}, {"owner": {"reputation": 2447, "user_id": 6315366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1308330302516639/picture?type=large", "display_name": "Alongkorn Chetasumon", "link": "https://stackoverflow.com/users/6315366/alongkorn-chetasumon"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550111894, "post_id": 54674784, "comment_id": 96153693, "body": "Thanks @Adrian for the response, and what about <code>GO111MODULE=on</code>, I try to set it on env section but it does not work?  Can you please show me the working launch.json file for go 1.11?"}], "answers": [{"tags": [], "owner": {"reputation": 2447, "user_id": 6315366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1308330302516639/picture?type=large", "display_name": "Alongkorn Chetasumon", "link": "https://stackoverflow.com/users/6315366/alongkorn-chetasumon"}, "is_accepted": true, "score": 1, "last_activity_date": 1550114732, "creation_date": 1550114732, "answer_id": 54682767, "question_id": 54674784, "link": "https://stackoverflow.com/questions/54674784/how-to-use-vscode-to-debug-go-1-11-x/54682767#54682767", "title": "how to use vscode to debug go 1.11.x", "body": "<p>I found the root cause right now. It is the source code of my team, not related to vscode or go 1.11.</p>\n\n<p>My working launch.json is here</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n\n        {\n            \"name\": \"Go debug\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${workspaceRoot}/main.go\",\n            \"env\": {\n            //   \"GO111MODULE\": \"on\"\n            },\n            \"args\": [],\n            \"showLog\": true\n        }\n    ]\n}\n</code></pre>\n"}], "owner": {"reputation": 2447, "user_id": 6315366, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1308330302516639/picture?type=large", "display_name": "Alongkorn Chetasumon", "link": "https://stackoverflow.com/users/6315366/alongkorn-chetasumon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 801, "favorite_count": 0, "accepted_answer_id": 54682767, "answer_count": 1, "score": 0, "last_activity_date": 1550114732, "creation_date": 1550074591, "question_id": 54674784, "link": "https://stackoverflow.com/questions/54674784/how-to-use-vscode-to-debug-go-1-11-x", "title": "how to use vscode to debug go 1.11.x", "body": "<p>I am new to golang, but working on go 1.11.x.</p>\n\n<p>My team use <code>go module</code>. The first time I clone the repository, I need to run <code>GO111MODULE=on go mod download</code> to download dependencies modules.</p>\n\n<p>Then I need to run <code>GO111MODULE=on go run main.go</code> to run my app.</p>\n\n<p>There is no one use vscode debugger, they prefer console log instead.</p>\n\n<p>Is there any way to debug go 1.11.x using vscode?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "module", "dependencies"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1550079397, "post_id": 54674597, "comment_id": 96141730, "body": "See here: <a href=\"https://github.com/golang/go/wiki/Modules#can-i-control-when-gomod-gets-updated-and-when-the-go-tools-use-the-network-to-satisfy-dependencies\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1584042528, "creation_date": 1584042528, "answer_id": 60660997, "question_id": 54674597, "link": "https://stackoverflow.com/questions/54674597/prevent-go-build-from-overwriting-version-in-go-mod/60660997#60660997", "title": "Prevent go build from overwriting version in go.mod", "body": "<p>The <code>go</code> command automatically resolves non-canonical <a href=\"https://semver.org\" rel=\"nofollow noreferrer\">semantic versions</a> to canonical versions or <a href=\"https://golang.org/cmd/go/#hdr-Pseudo_versions\" rel=\"nofollow noreferrer\">pseudo-versions</a>.</p>\n\n<p><code>v1.4</code> is not a canonical semantic version.</p>\n"}], "owner": {"reputation": 416, "user_id": 4032638, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "suppandi g", "link": "https://stackoverflow.com/users/4032638/suppandi-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1224, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1584042528, "creation_date": 1550074113, "question_id": 54674597, "link": "https://stackoverflow.com/questions/54674597/prevent-go-build-from-overwriting-version-in-go-mod", "title": "Prevent go build from overwriting version in go.mod", "body": "<p>I have a go module that imports project foo. foo's latest tag says v1.4</p>\n\n<p>when i do a <code>go build</code> in my project, it updates go.mod to say</p>\n\n<pre><code>module github.com/myid/mymod\n\nrequire (\n   github.com/myid/foo v1.4\n)\n</code></pre>\n\n<p>I want it to use the master branch instead of v1.4 tag...so i did a \n<code>go get github.com/myid/foo@master</code> and it downloaded the master branch in pkg and updated go.mod to say</p>\n\n<pre><code>require (\n    github.com/myid/foo v1-XXXXXXX-XXXXXXX\n)\n</code></pre>\n\n<p>I verify that the hash is the same as master</p>\n\n<p>but when i do <code>go build</code> again, it gets updated back to the latest tag.</p>\n\n<p>how do i get it to use the master branch and not switch back to v1.4?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["shell", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1550073390, "post_id": 54674215, "comment_id": 96138213, "body": "<a href=\"https://golang.org/pkg/runtime/#GOROOT\" rel=\"nofollow noreferrer\"><code>runtime.GOROOT()</code></a> does not return the value of the <code>GOROOT</code> environment variable, it returns the recorded value of <code>GOROOT</code> <b>from compile time</b>. See <a href=\"https://stackoverflow.com/questions/35669727/given-an-executable-can-i-determine-values-of-goos-and-goarch-used-to-build-it/35669816#35669816\">Given an executable can I determine values of GOOS and GOARCH used to build it?</a> So if the go app uses <code>runtime.GOROOT()</code>, you can&#39;t override that with environment variables."}, {"owner": {"reputation": 2445, "user_id": 288405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acea97b0bc1f223b24db816ab3dd8e46?s=128&d=identicon&r=PG", "display_name": "Mattie", "link": "https://stackoverflow.com/users/288405/mattie"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1550090277, "post_id": 54674215, "comment_id": 96146941, "body": "Interesting thank you!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1550138664, "post_id": 54674215, "comment_id": 96163420, "body": "Actually, this changed in <a href=\"https://golang.org/doc/go1.10#runtime\" rel=\"nofollow noreferrer\">Go 1.10</a>. <code>runtime.GOROOT()</code> returns the <code>GOROOT</code> env var if set, and if not, it returns the <code>GOROOT</code> recorded at compile time."}], "owner": {"reputation": 2445, "user_id": 288405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acea97b0bc1f223b24db816ab3dd8e46?s=128&d=identicon&r=PG", "display_name": "Mattie", "link": "https://stackoverflow.com/users/288405/mattie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 143, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1550091718, "creation_date": 1550073020, "last_edit_date": 1550091718, "question_id": 54674215, "link": "https://stackoverflow.com/questions/54674215/go-executable-somehow-determines-the-wrong-goroot", "title": "go executable somehow determines the wrong GOROOT", "body": "<p>There is a (non-Go) application that is running a Go executable as a server subprocess. That subprocess itself invokes the <code>go</code> command for certain operations.</p>\n\n<p>Application -> Go server -> <code>go</code> executable</p>\n\n<p>All of these are built on a system with Go 1.11.1 installed. And, on that system, there are no issues. However, on another machine it is failing in a way that I cannot understand. It turns out that system has Go 1.11.5 installed.</p>\n\n<p>Here is the error produced by the Go server process, running on a machine with Go 1.11.5 installed:</p>\n\n<pre><code>\"couldn\\'t exec \\'go [list -e -json -compiled -test=true -export=false -deps=true -find=false -- \n/usr/local/Cellar/go/1.11.1/libexec/src/builtin]\\': chdir \n/usr/local/Cellar/go/1.11.1/libexec/src/builtin: no such file or directory *os.PathError\"\n</code></pre>\n\n<p>I've determined that the string <code>/usr/local/Cellar/go/1.11.1/libexec</code> is in fact embedded in the Go server executable. I used <code>strings</code> to do this.</p>\n\n<p>GOROOT is not overridden on either machine.</p>\n\n<p>On my machine, <code>go env GOROOT</code> reports:</p>\n\n<pre><code>/usr/local/Cellar/go/1.11.1/libexec\n</code></pre>\n\n<p>On the target machine, <code>go env GOROOT</code> reports:</p>\n\n<pre><code>/usr/local/Cellar/go/1.11.5/libexec\n</code></pre>\n\n<p>As a test, I used the exact same environment setup to run <code>go env</code> in my host application instead of starting the server process. This also produces a GOROOT of <code>/usr/local/Cellar/go/1.11.5/libexec</code> on the target machine.</p>\n\n<p>If I <strong>do</strong> override GOROOT to be <code>/usr/local/Cellar/go/1.11.5/libexec</code> in the environment that spawns my Go server process, things work correctly on the target machine.</p>\n\n<p>So, I have a workaround of first capturing GOROOT with <code>go env</code>, and then overriding GOROOT in the server process's environment.</p>\n\n<p>My understanding is you should never be setting GOROOT, yet it appears somehow the GOROOT settings mismatch is the issue. And I'm particularly stumped because <code>go env</code> looks exactly like I think it should on both machines in all cases I can think to test.</p>\n\n<p>I still suspect this has something to do with the shell environment that is setup for running the server subprocesses.</p>\n\n<p>Does anyone have an insight into what might be wrong?</p>\n"}, {"tags": ["javascript", "user-interface", "web", "go", "webview"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550069970, "post_id": 54672969, "comment_id": 96136054, "body": "The examples appear to send JSON through  <code>external.invoke</code>: <a href=\"https://github.com/zserge/webview/blob/master/examples/todo-go/assets/app.js#L40\" rel=\"nofollow noreferrer\">github.com/zserge/webview/blob/master/examples/todo-go/asset&zwnj;&#8203;s/&hellip;</a>"}, {"owner": {"reputation": 19, "user_id": 10289856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aqjWf.jpg?s=128&g=1", "display_name": "Anton Gult", "link": "https://stackoverflow.com/users/10289856/anton-gult"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550070142, "post_id": 54672969, "comment_id": 96136165, "body": "@Adrian ah, seems I did same. But thank for point"}], "owner": {"reputation": 19, "user_id": 10289856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aqjWf.jpg?s=128&g=1", "display_name": "Anton Gult", "link": "https://stackoverflow.com/users/10289856/anton-gult"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550074641, "creation_date": 1550069327, "last_edit_date": 1550074641, "question_id": 54672969, "link": "https://stackoverflow.com/questions/54672969/how-to-catch-data-from-gui", "title": "How to catch data from gui", "body": "<p>I'm coding simple app and I use Golang for this purpose. Nowadays there's no exact way to create GUI, so I have to load one of libs - <a href=\"https://github.com/zserge/webview\" rel=\"nofollow noreferrer\">webview</a>. So as far as I understood, I can trigger actions from front-end using JS <code>external.invoke('eventName')</code>. </p>\n\n<p>Also I can push data from back- to front-end using Go </p>\n\n<p><code>simpleJS := ``console.log(\"`` + myVar + ``\")\n w.Eval(simpleJS)</code></p>\n\n<p>(there ` should not be doubled)</p>\n\n<p>So the question is how can I get data from JS. As I understand trigger have only its name, not more. As closest probable solution I decided to stringify wrap of eventName + data and parse it on Backend</p>\n"}, {"tags": ["go", "server", "port", "rdp"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550067867, "post_id": 54671963, "comment_id": 96134617, "body": "tried to change it and still can&#39;t connect, could it be the main.exe is not windows service? bcs my 8080 is apache and 3306 mysql are registered on windows service."}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550067959, "post_id": 54671963, "comment_id": 96134680, "body": "No, it;s not because &#39;it is not a service&#39;. have you checked your firewall? your networking settings etc?"}, {"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550068204, "post_id": 54671963, "comment_id": 96134848, "body": "i allowed 1195, i setted it as i set my 8080 (apache)"}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550068261, "post_id": 54671963, "comment_id": 96134886, "body": "how do you use that config in your code? can you show how you create server listener?"}, {"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550068634, "post_id": 54671963, "comment_id": 96135133, "body": "func main() { \tfileConfig := flag.String(&quot;f&quot;, &quot;e_channel.ini&quot;, &quot;config file&quot;) \tflag.Parse() \tconfig, err := config_db.LoadConfig(*fileConfig) \tif err != nil { \t\tfmt.Println(err.Error()) \t}  \tdb := config_db.Connectdb(config) \tinDB := &amp;controller.DB{DBE: db} \tr := gin.Default()  fmt.Println(&quot;Listening at Port &quot; + config.ListeningPort) \tr.Run(&quot;:&quot; + config.ListeningPort) }"}, {"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550068680, "post_id": 54671963, "comment_id": 96135164, "body": "sorry for the mess, first time using stackoverflow hehe"}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550068742, "post_id": 54671963, "comment_id": 96135202, "body": "Don&#39;t worry, everyone started some day :) Feel free to edit your question and put that code there :)"}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550069234, "post_id": 54671963, "comment_id": 96135523, "body": "r.Run(&quot;:&quot; + config.ListeningPort)  - so it seems you don&#39;t use the config.host setting at all. and I assume it will be 127.0.0.1 by default not 0.0.0.0 and that will be an issue."}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550071292, "post_id": 54671963, "comment_id": 96136964, "body": "just try r.Run(config.Host + &quot;:&quot; + config.ListeningPort)"}, {"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1550072305, "post_id": 54671963, "comment_id": 96137576, "body": "the result is Listening and Serving HTTP on 0.0.0.0 : 1195  again i tried to connect from other device, i recheck the firewall, but still none."}], "tags": [], "owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "is_accepted": false, "score": 0, "last_activity_date": 1550066315, "creation_date": 1550066315, "answer_id": 54671963, "question_id": 54671887, "link": "https://stackoverflow.com/questions/54671887/cant-run-api-from-other-device-on-windows-serverrdp-based-golang/54671963#54671963", "title": "Can&#39;t run API from other device on windows server(RDP) based GoLang", "body": "<p>Try following config:</p>\n\n<pre><code>{ \"app_name\" : \"HELLOWORLD_API\", \n  \"listening_port\" : \"1195\", \n  \"host\" : \"0.0.0.0\", \n  \"port\" : \"3306\",\n  ...\n}\n</code></pre>\n\n<p>Basically, change 127.0.0.1 to 0.0.0.0.</p>\n\n<p>To get more info on why this is the case, have a look at <a href=\"https://superuser.com/questions/949428/whats-the-difference-between-127-0-0-1-and-0-0-0-0\">https://superuser.com/questions/949428/whats-the-difference-between-127-0-0-1-and-0-0-0-0</a></p>\n\n<p>Putting simply, 0.0.0.0 meaning it will be available to connect from all networks, not only from local</p>\n"}], "owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550069686, "creation_date": 1550066105, "last_edit_date": 1550069686, "question_id": 54671887, "link": "https://stackoverflow.com/questions/54671887/cant-run-api-from-other-device-on-windows-serverrdp-based-golang", "title": "Can&#39;t run API from other device on windows server(RDP) based GoLang", "body": "<p>I have API GoLang based with port 1195, i want to run it from other device. I tried and it works on localhost to run the API with Postman. </p>\n\n<p>But when i try to access the API from other device, it didn't work a.k.a Can't connect.</p>\n\n<p>P.S:  My 8080 port is accessible for other device, but my 1195 is not accessible\nAlready allowed firewall for port 1195. Tried to change the port but still can't connect on other device</p>\n\n<p>This is my config.ini:</p>\n\n<pre><code>{\n    \"app_name\"       : \"HELLOWORLD_API\",\n    \"listening_port\" : \"1195\",\n    \"host\"           : \"127.0.0.1\",\n    \"port\"           : \"3306\",\n    \"user\"           : \"root\",\n    \"passwd\"         : \"\",\n    \"dbname\"        : \"kube71\"\n}\n</code></pre>\n\n<p>I expect after I allowed the port 1195, I can connect to the API from other device.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 4, "creation_date": 1550065147, "post_id": 54671556, "comment_id": 96132882, "body": "So, exactly in which point do you encounter a problem in your try?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1550065908, "post_id": 54671556, "comment_id": 96133388, "body": "You didn&#39;t even import fasthttp."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1550065913, "post_id": 54671556, "comment_id": 96133390, "body": "If you are new to Go the best advice might be: Just use net/http instead of something special with a very narrow focus. It will suit you better."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1550068012, "post_id": 54671556, "comment_id": 96134717, "body": "Asking for resources, such as examples, is off-topic here. If you have a specific problem, though, we can probably help with that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1550068059, "post_id": 54671556, "comment_id": 96134742, "body": "But first off: Don&#39;t use that library. If you&#39;re new to Go, first use the standard library&#39;s <code>net&#47;http</code> package, and become very comfortable with that. Only then, and only if performance is not adequate, should you even begin to consider <code>fasthttp</code>."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 3, "last_activity_date": 1550067098, "creation_date": 1550067098, "answer_id": 54672212, "question_id": 54671556, "link": "https://stackoverflow.com/questions/54671556/how-to-implement-fasthttp-framework/54672212#54672212", "title": "how to implement fasthttp framework", "body": "<p>This code seems to be working. I pasted it to a <code>.go</code> file, added:</p>\n\n<pre><code>import \"github.com/valyala/fasthttp\"\n</code></pre>\n\n<p>Then you have to install this package, either by using <code>go get github.com/valyala/fasthttp</code> or by writing a <code>go.mod</code> file if you want to use the new module support.</p>\n\n<p>Then run this file and open <code>localhost:8080</code> in a browser.</p>\n\n<hr>\n\n<p>Maybe you have a more concrete question?</p>\n\n<p>As @Volker said in a comment, for newbies it's highly recommended to stick to the standard library - <code>net/http</code> in this case; there are <em>way</em> more examples and code/tutorials you can find by googling, no need to install special packages, etc.</p>\n"}], "owner": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "protected_date": 1567512639, "answer_count": 1, "score": -4, "last_activity_date": 1567270637, "creation_date": 1550065068, "last_edit_date": 1550067987, "question_id": 54671556, "link": "https://stackoverflow.com/questions/54671556/how-to-implement-fasthttp-framework", "title": "how to implement fasthttp framework", "body": "<p>I want to start learning about the fasthttps server from this link <a href=\"https://github.com/valyala/fasthttp\" rel=\"nofollow noreferrer\">https://github.com/valyala/fasthttp</a> but I dont know that how will I implement a small piece of code in this framework. Can anybody tell me that how i will implement a small piece of code in this? example please.</p>\n\n<p>Code I tried </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyHandler struct {\n    foobar string\n}\n\nfunc main() {\n\n    // pass bound struct method to fasthttp\n    myHandler := &amp;MyHandler{\n        foobar: \"foobar\",\n    }\n    fasthttp.ListenAndServe(\":8080\", myHandler.HandleFastHTTP)\n\n    // pass plain function to fasthttp\n    fasthttp.ListenAndServe(\":8081\", fastHTTPHandler)\n}\n\n // request handler in net/http style, i.e. method bound to MyHandler struct.\n func (h *MyHandler) HandleFastHTTP(ctx *fasthttp.RequestCtx) {\n     // notice that we may access MyHandler properties here - see h.foobar.\n     fmt.Fprintf(ctx, \"Hello, world! Requested path is %q. Foobar is %q\",\n    ctx.Path(), h.foobar)\n}\n\n// request handler in fasthttp style, i.e. just plain function.\nfunc fastHTTPHandler(ctx *fasthttp.RequestCtx) {\n    fmt.Fprintf(ctx, \"Hi there! RequestURI is %q\", ctx.RequestURI())\n}\n</code></pre>\n\n<p>Can you please tell me that how I will implement this code.</p>\n"}, {"tags": ["http", "go", "tcp"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1550064527, "post_id": 54671018, "comment_id": 96132501, "body": "It is not fully clear what you are asking: your code is in golang but you are asking about some behavior of nginx. Apart from that your code explicitly only sends a single request per TCP connection (which likely even has the content-length wrong: 7 bytes text and 2 newlines is not 8) so the behavior you see is expected. I have the feeling that you currently don&#39;t really understand the mapping between accept and TCP connection and what exactly the server is supposed to do with HTTP keep-alive (keep the connection open for the next request)."}, {"owner": {"reputation": 76, "user_id": 7162360, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ace8f9bfcc6090911024a2f001aee6b9?s=128&d=identicon&r=PG&f=1", "display_name": "shanyy", "link": "https://stackoverflow.com/users/7162360/shanyy"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1550067904, "post_id": 54671018, "comment_id": 96134644, "body": "All I want to find out is why the TCP connection is closed after every http request, even though I add keep-alive header to the http response. After fix the content-length, tcp connection are reused by following http requests. I guess the chrome may close the tcp connection if the http response check failed."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 2, "creation_date": 1550068478, "post_id": 54671018, "comment_id": 96135021, "body": "@shanyy That&#39;s not so surprising. If you tell the browser your reply contains an 8 byte body, but you actually send it a few more bytes say 2 more bytes the browser will not know what to do with those 2 characters and consider it a violation of the HTTP protocol. The most sensible thing to do in such a case is to just close the connection."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550072953, "post_id": 54671018, "comment_id": 96137965, "body": "Another issue is that the header line terminators are missing the <code>\\r</code>, but Chrome probably handles that."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1550075479, "post_id": 54671018, "comment_id": 96139546, "body": "@shanyy: the HTTP keep-alive header is just telling the browser that the server would be willing to keep the connection open. Only, your server closes the connection since all was your code does is accept, read, write and finish - the last thing closes the connection. For proper keep alive you would need to accept the connection, read request, write response, read next request ...."}], "answers": [{"tags": [], "owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "is_accepted": true, "score": 3, "last_activity_date": 1550068190, "creation_date": 1550068190, "answer_id": 54672602, "question_id": 54671018, "link": "https://stackoverflow.com/questions/54671018/chrome-will-close-the-tcp-connection-if-content-length-is-wrong/54672602#54672602", "title": "Chrome will close the tcp connection if content-length is wrong?", "body": "<p>If you send the wrong content length in the header, the browser will either hang (waiting for content that will never come) or close the connection (when it sees invalid junk after the content). What else could it do?</p>\n"}], "owner": {"reputation": 76, "user_id": 7162360, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ace8f9bfcc6090911024a2f001aee6b9?s=128&d=identicon&r=PG&f=1", "display_name": "shanyy", "link": "https://stackoverflow.com/users/7162360/shanyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 54672602, "answer_count": 1, "score": -1, "last_activity_date": 1550068190, "creation_date": 1550063482, "last_edit_date": 1550067999, "question_id": 54671018, "link": "https://stackoverflow.com/questions/54671018/chrome-will-close-the-tcp-connection-if-content-length-is-wrong", "title": "Chrome will close the tcp connection if content-length is wrong?", "body": "<p>I am interested in the action of web server to http keep-alive header. So I built a simple http server based on http server. The server does nothing but response to the client with a simple html http body.</p>\n\n<p>The code of server is here:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n)\n\nfunc main() {\n    l, err := net.Listen(\"tcp\", \"localhost:9765\")\n    if err != nil {\n        fmt.Println(\"Error listening:\", err.Error())\n        os.Exit(1)\n    }\n    defer l.Close()\n    for {\n        conn, err := l.Accept()\n        fmt.Println(\"New connection...\")\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n        go handleRequest(conn)\n    }\n}\n\n// handler\nfunc handleRequest(conn net.Conn) {\n    for {\n        buf := make([]byte, 512)\n        _, err := conn.Read(buf)\n        if err != nil {\n            fmt.Println(\"Error reading:\", err.Error())\n            conn.Close()\n            break\n        }\n        fmt.Printf(\"%s\", buf)\n        str := `HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 8\nContent-Type: application/javascript\n\nalert(1)\n\n`\n        conn.Write([]byte(str))\n    }\n}\n</code></pre>\n\n<p>I added a demo html to local nginx static server:\n    \n    </p>\n\n<pre><code>&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;script type=text/javascript src=\"test.js\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/3\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/2\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/1\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/17\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/16\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/15\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/14\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/13\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/12\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/30\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/29\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/28\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/27\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/26\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/25\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/24\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/23\"&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/22&gt;&lt;/script&gt;\n    &lt;script type=text/javascript src=\"http://localhost:9765/21\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n&lt;h1&gt;loader\u6d4b\u8bd5\u9875\u9762&lt;/h1&gt;\n&lt;span&gt;hello world&lt;/span&gt;\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n\n<p>When visit the file with chrome, I found all response is normal, but tcp connection was closed after every single http request. The TCP got EOF error after sending http response.</p>\n"}, {"tags": ["pointers", "go", "casting", "temporary"], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 889742, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/9b925f6c8896aadcdd447b60ee5bb574?s=128&d=identicon&r=PG", "display_name": "Gonen I", "link": "https://stackoverflow.com/users/889742/gonen-i"}, "edited": false, "score": 1, "creation_date": 1550062582, "post_id": 54670253, "comment_id": 96131219, "body": "Thanks, that&#39;s almost exactly what I needed. I just changed it to a1 := a{3}         b1 := b{&amp;a1}. I think you should put the source in the answer rather than provide a link. Then I can accept the answer."}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 8, "last_activity_date": 1550064105, "last_edit_date": 1550064105, "creation_date": 1550061043, "answer_id": 54670253, "question_id": 54670125, "link": "https://stackoverflow.com/questions/54670125/how-to-get-pointer-to-interface-in-go/54670253#54670253", "title": "How to get pointer to interface in GO", "body": "<p>Let me know if this is what you are looking for:\n<a href=\"https://play.golang.org/p/ZGRyIqN7bPR\" rel=\"noreferrer\">https://play.golang.org/p/ZGRyIqN7bPR</a></p>\n\n<p>Full code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\ntype myinterface interface {\n  f1()\n}\n\ntype a struct {\n  val int\n}\n\ntype b struct {\n  mi myinterface\n}\n\nfunc (a) f1() {}\n\n\nfunc main() {\n  fmt.Println(\"Hello, playground\")\n\n  a1 := &amp;a{3}\n  b1 := b{a1}\n  fmt.Println(b1)\n}\n</code></pre>\n\n<p>You almost never need a pointer to an interface, since interfaces are just pointers themselves.\nSo just change the struct b to:</p>\n\n<pre><code> type b struct {\n   mi myinterface\n }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3680, "user_id": 889742, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/9b925f6c8896aadcdd447b60ee5bb574?s=128&d=identicon&r=PG", "display_name": "Gonen I", "link": "https://stackoverflow.com/users/889742/gonen-i"}, "edited": false, "score": 0, "creation_date": 1550062814, "post_id": 54670292, "comment_id": 96131375, "body": "You are correct, I did not need a pointer to an interface. I wanted to hold data through an interface, but also have it point to the original data, not create a copy.  What I didn&#39;t realize is that the address of the data is also assignable to the interface."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1550062441, "last_edit_date": 1550062441, "creation_date": 1550061187, "answer_id": 54670292, "question_id": 54670125, "link": "https://stackoverflow.com/questions/54670125/how-to-get-pointer-to-interface-in-go/54670292#54670292", "title": "How to get pointer to interface in GO", "body": "<p><code>myinterface(a1)</code> is a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>, it converts <code>a1</code> to type <code>myinteface</code>.</p>\n\n<p>Type conversion expressions are not addressable, so you cannot take the address of it. What is addressable is listed explicitly in the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Spec: Address operators:</a></p>\n\n<blockquote>\n  <p>The operand must be <em>addressable</em>, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. As an exception to the addressability requirement, <code>x</code> [in the expression of <code>&amp;x</code>] may also be a (possibly parenthesized) <a href=\"http://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>.</p>\n</blockquote>\n\n<p>This related answer lists several options how to obtain the address of such expressions: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n\n<p>For example if you use a composite literal to create a slice of type <code>[]myinterface</code> and put <code>a1</code> in it, you can take the address of its first element (which will be of type <code>*myinterface</code>):</p>\n\n<pre><code>b1 := b{&amp;[]myinterface{a1}[0]}\n</code></pre>\n\n<p>And it will work (try it on the <a href=\"https://play.golang.org/p/ExWeqrXKikU\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a1 := a{3}\nb1 := b{&amp;[]myinterface{a1}[0]}\nfmt.Println(b1)\n</code></pre>\n\n<p><strong>But know that using pointers to interfaces is very rarely needed, so is a field of type <code>*myinterface</code> really what you want in the first place?</strong></p>\n\n<p>Interface values can be <code>nil</code>, and also <code>nil</code> values (e.g. <code>nil</code> pointers) can also be wrapped in interfaces, so most likely you don't need a pointer to interface. We would have to know your \"wider\" goal to tell if this is what you really need.</p>\n"}], "owner": {"reputation": 3680, "user_id": 889742, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/9b925f6c8896aadcdd447b60ee5bb574?s=128&d=identicon&r=PG", "display_name": "Gonen I", "link": "https://stackoverflow.com/users/889742/gonen-i"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2554, "favorite_count": 0, "accepted_answer_id": 54670253, "answer_count": 2, "score": 2, "last_activity_date": 1560510507, "creation_date": 1550060588, "last_edit_date": 1560510507, "question_id": 54670125, "link": "https://stackoverflow.com/questions/54670125/how-to-get-pointer-to-interface-in-go", "title": "How to get pointer to interface in GO", "body": "<p>I would like to get rid of the variable temp in the following code:</p>\n\n<pre><code>type myinterface interface {\n    f1()\n}\n\ntype a struct {\n    val int\n}\n\ntype b struct {\n    mi *myinterface\n}\n\nfunc (a) f1() {\n\n}\n\n    func demo() {\n\n        a1 := a{3}\n        var temp myinterface = a1\n        b1 := b{&amp;temp}\n        fmt.Println(b1)\n</code></pre>\n\n<p>But if I try to write </p>\n\n<pre><code>b1 := b{&amp;myinterface(a1)}\n</code></pre>\n\n<p>I get the message</p>\n\n<blockquote>\n  <p>cannot take the address of myinterface(a1) ( undefined )</p>\n</blockquote>\n\n<p>what is the correct way to do this?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I did not a pointer to an interface, since an interface can hold a struct or a pointer to a struct, as also detailed in this question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion\">&quot;&lt;type&gt; is pointer to interface, not interface&quot; confusion</a></p>\n"}, {"tags": ["go", "report", "code-coverage"], "comments": [{"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "edited": false, "score": 0, "creation_date": 1550060514, "post_id": 54668812, "comment_id": 96130007, "body": "@downvoter: It would be really nice if you could explain what is wrong with the question. I think the need is genuine and I also did a reasonable effort to find the answer myself before asking here."}, {"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1550064926, "post_id": 54668812, "comment_id": 96132744, "body": "Also, do I understand correctly that asking about any Golang tool (e.g. <code>go fmt</code>, <code>go imports</code>, etc...) is not OK here, because it is not strictly related to programming?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1550067178, "post_id": 54668812, "comment_id": 96134168, "body": "If you have some programing related question about go vet you can ask here. But how to change the color of a GUI tool is totally not related to programming. IMHO such stuff does not belong on an stackexchange forum. You should ask on reddit or golang-nuts."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1550069389, "post_id": 54668812, "comment_id": 96135620, "body": "@Volker: <a href=\"https://stackoverflow.com/help/on-topic\">if your question generally covers...software tools commonly used by programmers; and is a practical, answerable problem that is unique to software development...then you\u2019re in the right place to ask your question!</a> I would say that description fits this question: it is about a practical, answerable problem with a development-specific tool. Questions about Git, IDEs, and other developer tools have long been accepted on SO."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550070261, "post_id": 54668812, "comment_id": 96136253, "body": "@Adrian I think the question is not practical and not answerable (except &quot;you cannot&quot;). This seems about taste."}, {"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1550071666, "post_id": 54668812, "comment_id": 96137195, "body": "@Volker: for me &quot;you cannot&quot; is also an answer (I generally write it explicitly in my questions, this time I forgot). Because if I know that &quot;you cannot&quot;, I know that I did not miss anything and do not keep looking."}, {"owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "edited": false, "score": 0, "creation_date": 1550071712, "post_id": 54668812, "comment_id": 96137223, "body": "Also, before asking the question, how would I know in advance that the answer is &quot;you cannot&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 8, "last_activity_date": 1550057478, "creation_date": 1550057478, "answer_id": 54669155, "question_id": 54668812, "link": "https://stackoverflow.com/questions/54668812/how-to-have-go-coverage-html-with-light-background/54669155#54669155", "title": "How to have Go coverage HTML with light background?", "body": "<p>Not with the built-in tool. There's nothing preventing you from piping the output through some script to change CSS colors, though, or to reference an external CSS file that sets the colors you prefer.</p>\n"}, {"tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": false, "score": 8, "last_activity_date": 1550061682, "creation_date": 1550061682, "answer_id": 54670465, "question_id": 54668812, "link": "https://stackoverflow.com/questions/54668812/how-to-have-go-coverage-html-with-light-background/54670465#54670465", "title": "How to have Go coverage HTML with light background?", "body": "<p>As mentioned by <a href=\"https://stackoverflow.com/users/13860/flimzy\">@Flimzy</a>, this is not supported with the built-in tool.</p>\n\n<p>Though, looking at the <code>coverage.html</code> file output by the <code>cover</code> tool.</p>\n\n<p>You can do something like this:</p>\n\n<pre><code>go tool cover -o coverage.html -html=coverage.out; sed -i 's/black/whitesmoke/g' coverage.html; sensible-browser coverage.html\n</code></pre>\n\n<p>which will write the output to <code>coverage.html</code> using the <code>-o</code> flag and then use  <code>sed</code> to change occurrences of black to whitesmoke. It will then use your default browser to open the file.</p>\n\n<p><strong>Note #1:</strong> Obviously, this will not work once the tool is updated not to output black color background. Though, if this changes, there is probably a lot better support for different color schemes.</p>\n\n<p><strong>Note #2:</strong> If you use heat maps <code>-covermode=count</code>, the light green might look awkward on the smokewhite color. Feel free to try different color accents though.</p>\n"}], "owner": {"reputation": 1374, "user_id": 3398271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c998619fa2ed255eec79fed92f3c2edd?s=128&d=identicon&r=PG&f=1", "display_name": "Attilio", "link": "https://stackoverflow.com/users/3398271/attilio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1550061682, "creation_date": 1550056323, "question_id": 54668812, "link": "https://stackoverflow.com/questions/54668812/how-to-have-go-coverage-html-with-light-background", "title": "How to have Go coverage HTML with light background?", "body": "<p>Consider the following command:</p>\n\n<pre><code>go tool cover -html=coverage.out\n</code></pre>\n\n<p><em>Is there a way to make the resulting HTML dark on light (rather than the default light characters on dark background)?</em></p>\n\n<p>I did not find anything about this neither in <a href=\"https://golang.org/cmd/cover/\" rel=\"noreferrer\">the documentation</a> nor in the help pages referenced therein (<code>go tool cover --help</code> and <code>go help testflag</code>)</p>\n"}, {"tags": ["go", "cookies"], "comments": [{"owner": {"reputation": 124, "user_id": 4050771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5rniJ.jpg?s=128&g=1", "display_name": "Vijay", "link": "https://stackoverflow.com/users/4050771/vijay"}, "edited": false, "score": 1, "creation_date": 1550053423, "post_id": 54667502, "comment_id": 96125796, "body": "Your browser shows that you have set cookie for the path &quot;/oauth/square&quot; not &quot;/&quot;"}, {"owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "reply_to_user": {"reputation": 124, "user_id": 4050771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5rniJ.jpg?s=128&g=1", "display_name": "Vijay", "link": "https://stackoverflow.com/users/4050771/vijay"}, "edited": false, "score": 0, "creation_date": 1550122187, "post_id": 54667502, "comment_id": 96155947, "body": "I understand that. I also double checked my code and it is whats in the snippet...I don&#39;t know if your intention was meant to be helpful or not but it wasnt."}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "is_accepted": true, "score": -1, "last_activity_date": 1550053168, "creation_date": 1550053168, "answer_id": 54667713, "question_id": 54667502, "link": "https://stackoverflow.com/questions/54667502/cookie-doesnt-persist-between-different-pages-on-same-domain/54667713#54667713", "title": "Cookie doesn&#39;t persist between different pages on same domain", "body": "<p>the solution was to set the Domain. once i did that everything worked as expected.</p>\n"}], "owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 54667713, "answer_count": 1, "score": -1, "last_activity_date": 1550054716, "creation_date": 1550052523, "last_edit_date": 1550054716, "question_id": 54667502, "link": "https://stackoverflow.com/questions/54667502/cookie-doesnt-persist-between-different-pages-on-same-domain", "title": "Cookie doesn&#39;t persist between different pages on same domain", "body": "<p>in part of my code i save a cookie like this</p>\n\n<pre><code>if encoded, err := s.Encode(USER_ID_COOKIE_NAME, value); err == nil {\n            user_id := &amp;http.Cookie{\n                Name:  USER_ID_COOKIE_NAME,\n                Value: encoded,\n                Path:  \"/\",\n                HttpOnly: true,\n            }\n            http.SetCookie(w, user_id)\n        }0\n\n</code></pre>\n\n<p>when i do, it saves a cookie but when i try to go to another path, the cookie isnt there. </p>\n\n<p>for example: once logged in, im at path \"/oauth/square\", when i then click on a link to \"/settings\" my cookie is gone. I can confirm the cookie is set while at the initial path. I've included an image of the cookie in my browser as well. How can i set the cookie so it persists anywhere while on that domain?</p>\n\n<p><a href=\"https://i.stack.imgur.com/Ru8f0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ru8f0.png\" alt=\"screenshot of cookie from browser\"></a></p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "is_accepted": true, "score": 0, "last_activity_date": 1550217656, "creation_date": 1550217656, "answer_id": 54704872, "question_id": 54666566, "link": "https://stackoverflow.com/questions/54666566/how-to-use-identical-c-types-from-different-packages/54704872#54704872", "title": "How to use identical C types from different packages?", "body": "<p>For those interested, I've figured it out.</p>\n\n<pre><code>package main\n...\ncr := cairo.Create(surf.Surface)\nptr := (*C.cairo_t)(unsafe.Pointer(reflect.ValueOf(cr.Ptr).Pointer()))\nlayout := C.pango_cairo_create_layout(ptr)\n...\n</code></pre>\n\n<p>Maybe it can be done more simply, but this works.</p>\n"}], "owner": {"reputation": 315, "user_id": 5367513, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7bc3967ca71ebcd3dbb20b5b7552a904?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Syn&#225;\u010dek", "link": "https://stackoverflow.com/users/5367513/jan-syn%c3%a1%c4%8dek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 54704872, "answer_count": 1, "score": 3, "last_activity_date": 1550217656, "creation_date": 1550049809, "question_id": 54666566, "link": "https://stackoverflow.com/questions/54666566/how-to-use-identical-c-types-from-different-packages", "title": "How to use identical C types from different packages?", "body": "<p>I'm trying to use cairo bindings (Go package), which defines a wrapper structure with a C type in it, with a C function, but can't make it work.</p>\n\n<p>The cairo package defines a Context:</p>\n\n<pre><code>package cairo\n...\ntype Context struct {\n    Ptr *C.cairo_t\n}\n...\n</code></pre>\n\n<p>Then, from the main package, I want to use its pointer:</p>\n\n<pre><code>package main\n...\ncr := cairo.Create(surf.Surface)\nlayout := C.pango_cairo_create_layout(cr.Ptr)\n...\n</code></pre>\n\n<p>The <code>C.pango_cairo_create_layout</code> accepts <code>*C.cairo_t</code>, which is what <code>cr.Ptr</code> should be. However, the go compiler doesn't agree:</p>\n\n<pre><code>./main.go:114:157: cannot use cr.Ptr (type *cairo._Ctype_struct__cairo) as type *_Ctype_struct__cairo in argument to func literal\n</code></pre>\n\n<p>As can be seen, <code>cr.Ptr</code> is of type <code>*cairo.C.cairo_t</code> and not <code>*C.cairo_t</code>, that is, the package namespace is a part of the type.</p>\n\n<p>I've found <a href=\"https://github.com/golang/go/issues/13467\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/13467</a>, which talks about a workaround using the combination of the reflect package and <code>unsafe.Pointer</code>. However, I can't make it work.</p>\n\n<p>How do I correctly \"bend\" this so it compiles <strong>and</strong> works?</p>\n"}, {"tags": ["go", "proxy", "client"], "comments": [{"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 1, "creation_date": 1550052529, "post_id": 54666511, "comment_id": 96125226, "body": "I would create multiple http clients with different proxy settings and change those clients when you are firing the requests.   The other way is to implement your own <a href=\"https://golang.org/src/net/http/client.go?h=RoundTripper#L115\" rel=\"nofollow noreferrer\">http.RoundTripper</a> but the implementation is not that simple. You might utilize default http RoundTripper for that implementation though."}, {"owner": {"reputation": 1659, "user_id": 302646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bYT9J.png?s=128&g=1", "display_name": "Makkes", "link": "https://stackoverflow.com/users/302646/makkes"}, "edited": false, "score": 3, "creation_date": 1550053171, "post_id": 54666511, "comment_id": 96125623, "body": "How did you come to the conclusion that creating a 2nd <code>http.Transport</code> would be very slow? It seems to me that this is the way to go"}, {"owner": {"reputation": 41, "user_id": 10171129, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wRnw1yeE71I/AAAAAAAAAAI/AAAAAAAAIQU/tB79GRS0BYY/photo.jpg?sz=128", "display_name": "Stefano", "link": "https://stackoverflow.com/users/10171129/stefano"}, "edited": false, "score": 0, "creation_date": 1550065223, "post_id": 54666511, "comment_id": 96132937, "body": "I feel uncomfortable to construct an object instead of changing only one of it&#39;s parameters, it is also becouse i need to perform some  thousand  of proxy change, so if there is a another solution i&#39;ll prefer to look into it"}], "owner": {"reputation": 41, "user_id": 10171129, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wRnw1yeE71I/AAAAAAAAAAI/AAAAAAAAIQU/tB79GRS0BYY/photo.jpg?sz=128", "display_name": "Stefano", "link": "https://stackoverflow.com/users/10171129/stefano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 437, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550049657, "creation_date": 1550049657, "question_id": 54666511, "link": "https://stackoverflow.com/questions/54666511/golang-change-proxy-after-a-web-request", "title": "golang change proxy after a web request", "body": "<p>I was able to make a get request with the net/http package using a specific proxy with the code below:</p>\n\n<pre><code>proxyURL, err := url.Parse(\"http://111.222.333.444:80\")\n\n    if err != nil {\n        fmt.Println(\"Bad proxy URL\", err)\n        return\n    }\n\nclient := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyURL)}}\nreq, _ := http.NewRequest(\"GET\", \"https://www.google.com\", nil)\nres, err := client.Do(req)\n    if err != nil {\n        fmt.Println(\"Error\")\n    }\nelse {\n    defer res.Body.Close()\n    respBody, _ := ioutil.ReadAll(res.Body) //read the response\n    fmt.Println(string(respBody))\n    }\n</code></pre>\n\n<p>Reading the <a href=\"https://golang.org/pkg/net/http/#ProxyURL\" rel=\"nofollow noreferrer\">docs</a> is written that </p>\n\n<blockquote>\n  <p>ProxyURL returns a proxy function (for use in a Transport) that always returns the same URL.</p>\n</blockquote>\n\n<p>But how should I make another get request after that one, in the same thread with a different proxy? am I supposed to create another Transport object with a different proxy setting? but I find this way to be very slow. What I'm looking for is to reuse the Transport and Client objects and changing only the proxy url.</p>\n\n<p>What's the best way to do it?</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1550047568, "post_id": 54665442, "comment_id": 96122088, "body": "What the output of command <code>curl -H &quot;Origin: http:&#47;&#47;localhost:8000&quot; --verbose localhost:9000</code> ? Does the header <code>Access-Control-Allow-Origin: *</code> present?"}, {"owner": {"reputation": 2343, "user_id": 4532065, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/477b5c1ec36a72979cde174ad9902d9f?s=128&d=identicon&r=PG&f=1", "display_name": "sinusGob", "link": "https://stackoverflow.com/users/4532065/sinusgob"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1550047747, "post_id": 54665442, "comment_id": 96122194, "body": "<code>Rebuilt URL to: localhost:9000&#47; *   Trying ::1... * TCP_NODELAY set * Connected to localhost (::1) port 9000 (#0) &gt; GET &#47; HTTP&#47;1.1 &gt; Host: localhost:9000 &gt; User-Agent: curl&#47;7.54.0 &gt; Accept: *&#47;* &gt; Origin: http:&#47;&#47;localhost:8000 &gt;  &lt; HTTP&#47;1.1 404 Not Found &lt; Access-Control-Allow-Origin: * &lt; Content-Type: text&#47;plain &lt; Date: Wed, 13 Feb 2019 08:48:10 GMT &lt; Content-Length: 18</code>"}, {"owner": {"reputation": 2343, "user_id": 4532065, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/477b5c1ec36a72979cde174ad9902d9f?s=128&d=identicon&r=PG&f=1", "display_name": "sinusGob", "link": "https://stackoverflow.com/users/4532065/sinusgob"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1550047769, "post_id": 54665442, "comment_id": 96122211, "body": "What is the problem?"}, {"owner": {"reputation": 2343, "user_id": 4532065, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/477b5c1ec36a72979cde174ad9902d9f?s=128&d=identicon&r=PG&f=1", "display_name": "sinusGob", "link": "https://stackoverflow.com/users/4532065/sinusgob"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1550047775, "post_id": 54665442, "comment_id": 96122215, "body": "Thanks for helping"}], "answers": [{"comments": [{"owner": {"reputation": 142, "user_id": 7744772, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Em0MK.png?s=128&g=1", "display_name": "Cozy", "link": "https://stackoverflow.com/users/7744772/cozy"}, "edited": false, "score": 0, "creation_date": 1607593473, "post_id": 54718675, "comment_id": 115323459, "body": "Wow , I can&#39;t believe I have wasted close to one hour on a trailing slash"}], "tags": [], "owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "is_accepted": false, "score": 2, "last_activity_date": 1550276733, "creation_date": 1550276733, "answer_id": 54718675, "question_id": 54665442, "link": "https://stackoverflow.com/questions/54665442/cors-doesnt-work-on-gin-and-golang-group-routes/54718675#54718675", "title": "Cors doesnt work on gin and golang group routes", "body": "<p>Ok, so I tried to replicate this and found that I was making the AJAX request wrong, probably you made the same mistake as I did:</p>\n\n<p>With a similar configuration:</p>\n\n<pre><code>func main() {\n    router := gin.Default()\n    router.Use(cors.Default())\n\n    v1 := router.Group(\"/api\")\n    {\n        v1.GET(\"/\", func(c *gin.Context) {\n            c.String(http.StatusOK, \"Hello world\")\n        })\n    }\n\n    router.Run()\n}\n</code></pre>\n\n<p>This AJAX request will throw the CORS error you're getting:</p>\n\n<pre><code>$.get('http://localhost:8080/api').then(resp =&gt; {\n  console.log(resp);\n});\n</code></pre>\n\n<p>But adding a \"/\" at the end will work:</p>\n\n<pre><code>$.get('http://localhost:8080/api/').then(resp =&gt; {\n  console.log(resp);\n});\n</code></pre>\n\n<p>So in your case, try requesting the URL: <code>http://localhost:9000/api/products/</code> (with a forward slash at the end)</p>\n\n<p>Moreover, you could also modify your routes to look like this:</p>\n\n<pre><code>v1 := router.Group(\"/api\")\n{\n    v1.GET(\"/products\", ListOfProducts)\n    v1.POST(\"/products/post\",AddProduct)\n}\n</code></pre>\n\n<p>So you can send the request without the forward slash at the end :)</p>\n"}], "owner": {"reputation": 2343, "user_id": 4532065, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/477b5c1ec36a72979cde174ad9902d9f?s=128&d=identicon&r=PG&f=1", "display_name": "sinusGob", "link": "https://stackoverflow.com/users/4532065/sinusgob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3039, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1550276733, "creation_date": 1550045896, "question_id": 54665442, "link": "https://stackoverflow.com/questions/54665442/cors-doesnt-work-on-gin-and-golang-group-routes", "title": "Cors doesnt work on gin and golang group routes", "body": "<p>I try this specific code but it keep on giving me error in </p>\n\n<blockquote>\n  <p>No 'Access-Control-Allow-Origin'</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-contrib/cors\"\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n\n    router.Use(cors.Default())\n\n    v1 := router.Group(\"/api/products\")\n    {\n        v1.GET(\"/\", ListOfProducts)\n        v1.POST(\"/post\",AddProduct)\n    }\n}\n</code></pre>\n\n<p>The error is </p>\n\n<p><a href=\"https://i.stack.imgur.com/rfU13.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rfU13.png\" alt=\"enter image description here\"></a></p>\n\n<p>My frontend is written in Vue.js and running on <code>localhost:8000</code> localhost and the server is running on <code>localhost:9000</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1550046210, "post_id": 54665363, "comment_id": 96121387, "body": "You have to export fields if you want to marshal them."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1550046251, "post_id": 54665363, "comment_id": 96121403, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11126793/json-and-dealing-with-unexported-fields\">JSON and dealing with unexported fields</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "is_accepted": true, "score": 2, "last_activity_date": 1550046235, "creation_date": 1550046235, "answer_id": 54665516, "question_id": 54665363, "link": "https://stackoverflow.com/questions/54665363/golang-rest-api-data-not-showing-in-postman/54665516#54665516", "title": "Golang Rest api data not showing in postman", "body": "<blockquote>\n  <p>You have to rename <code>name</code> to <code>Name</code></p>\n</blockquote>\n\n<p>I'm not sure what is <code>u.Respond()</code>, so I will assume it's a helper function of some framework that you are using, and I will assume <code>u.Respond()</code> is internally using json.Marshal. </p>\n\n<p>If your struct has unexported fields(fields name starting with lowercase letter, in your case <code>name</code>), <code>json.Marshal</code> cannot access those field, and the result won't have <code>name</code> field. That is why you are getting empty objects in JSON. </p>\n"}], "owner": {"reputation": 291, "user_id": 10716743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17c2cba1f960b985070a7c75c6f2c4c?s=128&d=identicon&r=PG&f=1", "display_name": "Aadil Shaikh", "link": "https://stackoverflow.com/users/10716743/aadil-shaikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "accepted_answer_id": 54665516, "answer_count": 1, "score": -2, "last_activity_date": 1550046235, "creation_date": 1550045647, "question_id": 54665363, "link": "https://stackoverflow.com/questions/54665363/golang-rest-api-data-not-showing-in-postman", "title": "Golang Rest api data not showing in postman", "body": "<p>I am facing an issue where i have made an api in Go every thing work fine but i am not getting data in postman. When i print the data in logs i am getting the data properly but it is showing blank data in postman. </p>\n\n<p>authorizeModel.go</p>\n\n<pre><code>func GetSkillList() map[string]interface{} {\n    db := GetDB()\n    var (\n        // id        int\n        skillName string\n    )\n    type SkillList struct {\n        name string\n    }\n    skillList := SkillList{}\n    skillArr := []SkillList{}\n\n    rows, err := db.Query(\"select DISTINCT(name) as name from skills where company_id IN ('2') and name != 'Skill Needed' order by name\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n    for rows.Next() {\n        err := rows.Scan(&amp;skillName)\n        if err != nil {\n            log.Fatal(err)\n        }\n        skillList.name = skillName\n        skillArr = append(skillArr, skillList)\n    }\n    response := u.Message(true, \"Skill list retrieved successfully\")\n    response[\"data\"] = skillArr\n    log.Println(skillArr)\n    response[\"authorization\"] = false\n    return response\n}\n</code></pre>\n\n<p>authController.go</p>\n\n<pre><code>var SkillTagList = func(w http.ResponseWriter, r *http.Request) {\n\n    resp := models.GetSkillList()\n    u.Respond(w, resp)\n}\n</code></pre>\n\n<p>routes.go</p>\n\n<pre><code>router.HandleFunc(\"/api/v1/authorize/skillTagList\", controllers.SkillTagList).Methods(\"POST\")\n</code></pre>\n\n<p>If you see authorizeModel.go i have printed my data in logs i am getting that data successfully in logs. But see the postman screenshot below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/RifGH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RifGH.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["windows", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1550050854, "creation_date": 1550050854, "answer_id": 54666920, "question_id": 54664751, "link": "https://stackoverflow.com/questions/54664751/how-to-get-total-size-of-a-drive-in-windows/54666920#54666920", "title": "How to get total size of a drive in Windows", "body": "<p>Your linked question+answer shows how to get the free space. The solution uses the <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-getdiskfreespaceexw\" rel=\"nofollow noreferrer\"><code>GetDiskFreeSpaceExW()</code></a> windows API function from the <code>kernel32.dll</code> to obtain it.</p>\n\n<p>The same function can be used to get total size too. Signature of the <code>GetDiskFreeSpaceExW()</code> function:</p>\n\n<pre><code>BOOL GetDiskFreeSpaceExW(\n  LPCWSTR         lpDirectoryName,\n  PULARGE_INTEGER lpFreeBytesAvailableToCaller,\n  PULARGE_INTEGER lpTotalNumberOfBytes,\n  PULARGE_INTEGER lpTotalNumberOfFreeBytes\n);\n</code></pre>\n\n<p>It has an in-parameter, the path, and it has 3 out-parameters, namely the free bytes (available to caller), the total bytes (disk size) and the total free bytes.</p>\n\n<p>So simply when you call it, provide variables (pointers) for all info you want to get out of it.</p>\n\n<p>For example:</p>\n\n<pre><code>kernelDLL := syscall.MustLoadDLL(\"kernel32.dll\")\nGetDiskFreeSpaceExW := kernelDLL.MustFindProc(\"GetDiskFreeSpaceExW\")\n\nvar free, total, avail int64\n\npath := \"c:\\\\\"\nr1, r2, lastErr := GetDiskFreeSpaceExW.Call(\n    uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(path))),\n    uintptr(unsafe.Pointer(&amp;free)),\n    uintptr(unsafe.Pointer(&amp;total)),\n    uintptr(unsafe.Pointer(&amp;avail)),\n)\n\nfmt.Println(r1, r2, lastErr)\nfmt.Println(\"Free:\", free, \"Total:\", total, \"Available:\", avail)\n</code></pre>\n\n<p>Running it, an example output:</p>\n\n<pre><code>1 0 Success.\nFree: 16795295744 Total: 145545281536 Available: 16795295744\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": false, "score": 2, "last_activity_date": 1550050931, "creation_date": 1550050931, "answer_id": 54666945, "question_id": 54664751, "link": "https://stackoverflow.com/questions/54664751/how-to-get-total-size-of-a-drive-in-windows/54666945#54666945", "title": "How to get total size of a drive in Windows", "body": "<p>In the docs for <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-getdiskfreespaceexw\" rel=\"nofollow noreferrer\">GetDiskFreeSpraceExW</a> the function is declared as:</p>\n\n<pre><code>BOOL GetDiskFreeSpaceExW(\n  LPCWSTR         lpDirectoryName,\n  PULARGE_INTEGER lpFreeBytesAvailableToCaller,\n  PULARGE_INTEGER lpTotalNumberOfBytes,\n  PULARGE_INTEGER lpTotalNumberOfFreeBytes\n);\n</code></pre>\n\n<p>So you get the total size and available size in one call:</p>\n\n<pre><code>import \"syscall\"\nimport \"os\"\n\nfunc main() {\n    wd := os.Getwd()\n\n    h := syscall.MustLoadDLL(\"kernel32.dll\")\n    c := h.MustFindProc(\"GetDiskFreeSpaceExW\")\n\n    var freeBytesAvailableToCaller int64\n    var totalNumberOfBytes int64\n    var totalNumberOfFreeBytes int64\n\n    c.Call(\n        uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(wd))),\n        uintptr(unsafe.Pointer(&amp;freeBytesAvailableToCaller)), \n        uintptr(unsafe.Pointer(&amp;totalNumberOfBytes)), \n        uintptr(unsafe.Pointer(&amp;totalNumberOfFreeBytes))\n    )\n\n    print(freeBytesAvailableToCaller, totalNumberOfBytes, totalNumberOfBytes)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 169, "user_id": 1458294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b3078dd468a1f86d1a0af7c768c1a4?s=128&d=identicon&r=PG", "display_name": "Gourgandine", "link": "https://stackoverflow.com/users/1458294/gourgandine"}, "is_accepted": false, "score": 2, "last_activity_date": 1584457092, "creation_date": 1584457092, "answer_id": 60724929, "question_id": 54664751, "link": "https://stackoverflow.com/questions/54664751/how-to-get-total-size-of-a-drive-in-windows/60724929#60724929", "title": "How to get total size of a drive in Windows", "body": "<p>Other replies are outdated since syscall is deprecated.</p>\n\n<p>You must use golang.org/x/sys/windows now (adapting icza answer):</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"golang.org/x/sys/windows\"\n\n)\n\n// print disk usage of path/disk\nfunc DiskUsage(path string) bool {\n\n    var free, total, avail uint64\n\n    path = \"c:\\\\\"\n    pathPtr, err := windows.UTF16PtrFromString(path)\n    if err != nil{\n        panic(err)\n    }\n    err = windows.GetDiskFreeSpaceEx(pathPtr, &amp;free, &amp;total, &amp;avail)\n\n\n    fmt.Println(\"Free:\", free, \"Total:\", total, \"Available:\", avail)\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 698, "favorite_count": 0, "accepted_answer_id": 54666920, "answer_count": 3, "score": 4, "last_activity_date": 1584457092, "creation_date": 1550042978, "last_edit_date": 1550051131, "question_id": 54664751, "link": "https://stackoverflow.com/questions/54664751/how-to-get-total-size-of-a-drive-in-windows", "title": "How to get total size of a drive in Windows", "body": "<p>I want to get total size of a drive in Go on windows using standard windows api call;</p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/20108520/get-amount-of-free-disk-space-using-go\">this</a> to get the free space.</p>\n\n<p>Now I want to total space size of special drive for example </p>\n\n<blockquote>\n  <p>C:\\</p>\n</blockquote>\n"}, {"tags": ["go", "authorization", "grpc"], "comments": [{"owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 5, "creation_date": 1550043201, "post_id": 54664272, "comment_id": 96119911, "body": "improve in what way?"}, {"owner": {"reputation": 2571, "user_id": 2422530, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/zlebS.jpg?s=128&g=1", "display_name": "Obi Wan - PallavJha", "link": "https://stackoverflow.com/users/2422530/obi-wan-pallavjha"}, "reply_to_user": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 0, "creation_date": 1550049411, "post_id": 54664272, "comment_id": 96123139, "body": "@JoaoHenrique Instead of a lot of if/else block can there something which is generic?"}], "answers": [{"tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": false, "score": 2, "last_activity_date": 1550101190, "creation_date": 1550101190, "answer_id": 54681125, "question_id": 54664272, "link": "https://stackoverflow.com/questions/54664272/unmarshall-request-in-grpc-interceptor/54681125#54681125", "title": "unmarshall request in gRPC interceptor", "body": "<p>When doing something like this, it's typical to add auth data to the <a href=\"https://godoc.org/google.golang.org/grpc/metadata\" rel=\"nofollow noreferrer\">metadata</a> instead of the request messages.  This way the server doesn't need to inspect all the possible request payload types.</p>\n\n<p>If you must use the request payload, it would be more idiomatic to use a type switch instead:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>switch r := req.(type) {\n  case CallRequest: // r is a CallRequest...\n  case ReceiveRequest: // r is a ReceiveRequest...\n  default:\n    return status.Errorf(codes.Unimplemented, \"unknown request type: %T\", req)\n}\n</code></pre>\n"}], "owner": {"reputation": 2571, "user_id": 2422530, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/zlebS.jpg?s=128&g=1", "display_name": "Obi Wan - PallavJha", "link": "https://stackoverflow.com/users/2422530/obi-wan-pallavjha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1550101190, "creation_date": 1550041005, "question_id": 54664272, "link": "https://stackoverflow.com/questions/54664272/unmarshall-request-in-grpc-interceptor", "title": "unmarshall request in gRPC interceptor", "body": "<p>In order to perform Authorization, some attributes from the request is to be read so that input for Authorization Server can be made</p>\n\n<p>For example, this is the interceptor. Here <code>prepareAuthZInput</code> is called to preparing the input</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func AuthInterceptor(ctx context.Context, req interface{}, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler) (interface{}, error) {\n     input := prepareAuthZInput(info.FullMethod, req)\n}\n</code></pre>\n\n<p>In this function, there's a big if-else part which checks for the actual type for the request, type casts it and then performs the input preparation.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func prepareAuthZInput(method string, req interface{}) {\n   var input Input\n   if methodName = \"/Data/Call\" {\n       callRequest, ok := req.(CallRequest)\n       if ok {\n          // prepare input from callRequest\n       }\n   } else if methodName = \"/Data/Receive\" {\n       receiveRequest, ok := req.(ReceiveRequest)\n       if ok {\n          // prepare input from receiveRequest\n       }\n\n   }\n   return input\n}\n</code></pre>\n\n<p>How can I improve this code?</p>\n"}, {"tags": ["go", "godeps", "glide-golang", "govendor"], "answers": [{"tags": [], "owner": {"reputation": 124, "user_id": 1853723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc065d3104b91babacfb418abd2c43d9?s=128&d=identicon&r=PG", "display_name": "kfoozminus", "link": "https://stackoverflow.com/users/1853723/kfoozminus"}, "is_accepted": true, "score": 2, "last_activity_date": 1550036833, "creation_date": 1550036833, "answer_id": 54663366, "question_id": 54663121, "link": "https://stackoverflow.com/questions/54663121/vendoring-problem-from-opencensus-libraries-for-golang/54663366#54663366", "title": "Vendoring problem from Opencensus Libraries for Golang", "body": "<p>Tried setting a proxy to shell</p>\n\n<pre><code>export http_proxy=http://104.248.231.49:8080/\nexport https_proxy=http://104.248.231.49:8080/\n</code></pre>\n\n<p>And then it worked.</p>\n"}], "owner": {"reputation": 124, "user_id": 1853723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc065d3104b91babacfb418abd2c43d9?s=128&d=identicon&r=PG", "display_name": "kfoozminus", "link": "https://stackoverflow.com/users/1853723/kfoozminus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 54663366, "answer_count": 1, "score": 0, "last_activity_date": 1553435449, "creation_date": 1550035575, "last_edit_date": 1553435449, "question_id": 54663121, "link": "https://stackoverflow.com/questions/54663121/vendoring-problem-from-opencensus-libraries-for-golang", "title": "Vendoring problem from Opencensus Libraries for Golang", "body": "<p>I'm having problem while vendoring my go-project. Tried with both glide and go-dep - getting same problem.</p>\n\n<p><code>$ go get -u go.opencensus.io</code> gives the following error:</p>\n\n<pre><code>package go.opencensus.io/opencensus-go: unrecognized import path \"go.opencensus.io/opencensus-go\" (https fetch: Get https://go.opencensus.io/opencensus-go?go-get=1: dial tcp &lt;some-ip&gt;: i/o timeout)\n</code></pre>\n\n<p>Github link of this package - <a href=\"https://github.com/census-instrumentation/opencensus-go\" rel=\"nofollow noreferrer\">https://github.com/census-instrumentation/opencensus-go</a></p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 871, "user_id": 2437063, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vt5Qr.jpg?s=128&g=1", "display_name": "Shirker", "link": "https://stackoverflow.com/users/2437063/shirker"}, "is_accepted": false, "score": 0, "last_activity_date": 1550039334, "last_edit_date": 1550039334, "creation_date": 1550037996, "answer_id": 54663592, "question_id": 54662699, "link": "https://stackoverflow.com/questions/54662699/golang-gorm-has-like-in-laravel-method-equivalent/54663592#54663592", "title": "Golang gorm has (like in Laravel) method equivalent?", "body": "<p>this code is seems to be working for me. Using LEFT JOIN and WHERE will filter unwanted Attractions. Although hoping to get a more elegant solution.</p>\n\n<pre><code>...\ndb.Joins(\"LEFT JOIN attractions_data ON attractions_data.attraction_id = attractions.id\").\n    Preload(\"AttractionsData\", \"lang = ? AND active = ?\", lang, 1).\n    Where(\"attractions.country_id = ?\", countryID).\n    Where(\"attractions.category_id = ?\", categoryID).\n    Where(\"attractions.active = ?\", 1).\n    Where(\"attractions_data.active = ? AND attractions_data.lang = ?\", 1,lang).\n    Find(&amp;atts) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 2, "last_activity_date": 1550038572, "creation_date": 1550038572, "answer_id": 54663734, "question_id": 54662699, "link": "https://stackoverflow.com/questions/54662699/golang-gorm-has-like-in-laravel-method-equivalent/54663734#54663734", "title": "Golang gorm has (like in Laravel) method equivalent?", "body": "<p>I would just get the ids you want first:</p>\n\n<pre><code>ids := []int{}\ndb.Model(&amp;AttractionData{}).\n   Where(\"lang = ? AND active = ?\", lang, 1).\n   Pluck(\"attraction_id\", &amp;ids)\ndb.Preload(\"AttractionsData\").\n   Where(\"id IN (?)\", ids).\n   Where(\"category_id = ?\", categoryID).\n   Where(\"active = ?\", 1).\n   Find(&amp;atts) \n</code></pre>\n"}], "owner": {"reputation": 871, "user_id": 2437063, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vt5Qr.jpg?s=128&g=1", "display_name": "Shirker", "link": "https://stackoverflow.com/users/2437063/shirker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1550043066, "creation_date": 1550033310, "last_edit_date": 1550043066, "question_id": 54662699, "link": "https://stackoverflow.com/questions/54662699/golang-gorm-has-like-in-laravel-method-equivalent", "title": "Golang gorm has (like in Laravel) method equivalent?", "body": "<p>Is there a way to tell gorm to select only those rows (Attractions), that have a hasOne relation (AttractionsData)? The same as I'd use \"::has('relativeName)\" in Laravel? The following code will return collection including Attractions with empty relation instead of skipping them </p>\n\n<pre><code>type Attractions struct {\n    ID              uint              `gorm:\"primary_key\"`\n    ...\n    Active                int       `json:\"-\"`\n    AttractionsData AttractionsData `gorm:\"foreignkey:AttractionID\"`\n}\ntype AttractionsData struct {\n\u00a0\u00a0\u00a0\u00a0ID                    uint      `gorm:\"primary_key\"`\n\u00a0\u00a0\u00a0\u00a0AttractionID          uint      `json:\"-\"`\n\u00a0\u00a0\u00a0\u00a0Lang                  string    `json:\"lang\"`\n\u00a0\u00a0\u00a0\u00a0Title                 string    `json:\"title\"`\n\u00a0\u00a0\u00a0\u00a0Active                int       `json:\"-\"`\n}\n    ...\nfunc someFunc(c *gin.Context){\n    ...\n    db := config.DBConnect()\n    defer db.Close()    \n    var atts []Attractions\n    db.Preload(\"AttractionsData\", \"lang = ? AND active = ?\", lang, 1).\n            Where(\"country_id = ?\", countryID).\n            Where(\"category_id = ?\", categoryID).\n            Where(\"active = ?\", 1).\n            Find(&amp;atts) \n    ...\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1550042985, "post_id": 54662555, "comment_id": 96119834, "body": "Please <a href=\"https://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters\" rel=\"nofollow noreferrer\">read the docs</a> to understand what these do. They are probably functionally equivalent."}], "answers": [{"tags": [], "owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "is_accepted": true, "score": 0, "last_activity_date": 1550043812, "creation_date": 1550043812, "answer_id": 54664941, "question_id": 54662555, "link": "https://stackoverflow.com/questions/54662555/two-different-forms-of-the-database-connection-string/54664941#54664941", "title": "Two different forms of the database connection string", "body": "<p>Both of them work and as far as I know there is not real difference between them.</p>\n\n<pre><code>import \"database/sql\"\n\nimport _ \"github.com/lib/pq\"\n\nconnStr := fmt.Sprintf(\"postgres://%s:%s@localhost/%s?sslmode=disable\", user, password, dbName)\ndb, err := sql.Open(\"postgres\", connStr)\n</code></pre>\n\n<p>///////////////////////////////</p>\n\n<pre><code>import \"database/sql\"\n\nimport _ \"github.com/lib/pq\"\n\nconnStr := fmt.Sprintf(\"user=%s password=%s dbname=%s sslmode=disable\", user, password, dbName)\ndb, err := sql.Open(\"postgres\", connStr)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>More info you can find here: <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq</a></p>\n"}], "owner": {"reputation": 21, "user_id": 10611720, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3xThjtAdypA/AAAAAAAAAAI/AAAAAAAAAIQ/ApSdx774Pkc/photo.jpg?sz=128", "display_name": "Muhammad Nurfilza", "link": "https://stackoverflow.com/users/10611720/muhammad-nurfilza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 54664941, "answer_count": 1, "score": -1, "last_activity_date": 1550050254, "creation_date": 1550032355, "last_edit_date": 1550050254, "question_id": 54662555, "link": "https://stackoverflow.com/questions/54662555/two-different-forms-of-the-database-connection-string", "title": "Two different forms of the database connection string", "body": "<p>I have two different codes to connect postgresql with golang \nfirst code like this </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>connStr := fmt.Sprintf(\"user=%s password=%s dbname=%s sslmode=disable\", user, password, dbName)\n</code></pre>\n\n<p>and the second one like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>connStr := fmt.Sprintf(\"postgres://%s:%s@localhost/%s?sslmode=disable\", user, password, dbName)\n</code></pre>\n\n<p>What's the difference between them? And when do I have to use the second one?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1550032557, "post_id": 54662508, "comment_id": 96116052, "body": "Please read How to Write Go Code. You do not import files but packages and probably your package is not called &quot;Models&quot;. Also: Do not use relative imports as this is a stupid idea."}, {"owner": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "edited": false, "score": 1, "creation_date": 1550033280, "post_id": 54662508, "comment_id": 96116231, "body": "Is there perhaps a duplicate that explains <b>why</b> relative imports are a bad idea?"}, {"owner": {"reputation": 87, "user_id": 9022576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11d19a53c096b368018c7226883b86b?s=128&d=identicon&r=PG&f=1", "display_name": "Arvindh", "link": "https://stackoverflow.com/users/9022576/arvindh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1550033422, "post_id": 54662508, "comment_id": 96116272, "body": "@Volker Why relative imports are stupid idea. In many website I  saw , people are saying not to use relative imports. I am just trying to port my codes form Python to Go, In python all my additional packages are imported relative path. To maintain the same structure I am trying to import packages in  relative path."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1550040121, "post_id": 54662508, "comment_id": 96118551, "body": "Relative imports do not play well along all the tooling. Using full qualified import paths is <i>dead</i> <i>simple</i> and will result in a project structure which works well. Spending 5 minutes to convert to full import paths is much less work than wasting hours fiddling with relative imports. Relative imports turned out to be a stupid idea and using them will result in needless problems. You can still maintain the same file system structure, all you need to do is use non-relative import paths. It really is  that simple. And please: Decapitalise the model name!!"}, {"owner": {"reputation": 87, "user_id": 9022576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11d19a53c096b368018c7226883b86b?s=128&d=identicon&r=PG&f=1", "display_name": "Arvindh", "link": "https://stackoverflow.com/users/9022576/arvindh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1550041024, "post_id": 54662508, "comment_id": 96118925, "body": "@Volker. Thanks. hereafter I will follow the standard ways"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1550042876, "post_id": 54662508, "comment_id": 96119776, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38517593/relative-imports-in-go\">Relative imports in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1550068061, "creation_date": 1550068061, "answer_id": 54672558, "question_id": 54662508, "link": "https://stackoverflow.com/questions/54662508/how-to-include-the-package-in-local-directory-in-to-the-main-go/54672558#54672558", "title": "How to include the package in local directory in to the main.go", "body": "<p>You can either <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">set up</a> <code>$GOPATH</code> and place your library in a path relative to <code>$GOPATH</code>, or <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">use modules</a>. </p>\n\n<p>For modules, you can do something like:</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 mylib\n    \u2514\u2500\u2500 mylib.go\n</code></pre>\n\n<p>Contents of files:</p>\n\n<pre><code>$ cat go.mod\nmodule myproject.com\n\n====\n\n$ cat main.go \npackage main\n\nimport \"myproject.com/mylib\"\n\nfunc main() {\n    mylib.Say()\n}\n\n====\n\n$ cat mylib/mylib.go \npackage mylib\n\nimport \"fmt\"\n\nfunc Say() {\n    fmt.Println(\"Hello from mylib\")\n}\n</code></pre>\n\n<p>P.S. use lowercase to <a href=\"https://golang.org/doc/effective_go.html#package-names\" rel=\"nofollow noreferrer\">name packages/modules</a></p>\n"}], "owner": {"reputation": 87, "user_id": 9022576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c11d19a53c096b368018c7226883b86b?s=128&d=identicon&r=PG&f=1", "display_name": "Arvindh", "link": "https://stackoverflow.com/users/9022576/arvindh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 726, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550068061, "creation_date": 1550032073, "last_edit_date": 1550032589, "question_id": 54662508, "link": "https://stackoverflow.com/questions/54662508/how-to-include-the-package-in-local-directory-in-to-the-main-go", "title": "How to include the package in local directory in to the main.go", "body": "<p>I am using go version go1.11.2 windows/amd64 in windows 10</p>\n\n<p>i have folder in desktop with name \"GoPro\" which has \none file - main.go\none folder - Modules</p>\n\n<p>The \"Modules\" folder contains \none file - Modules.go</p>\n\n<p>Folder Structure </p>\n\n<pre><code>Desktop\n   |-------&gt;GoPro\n               |-----&gt;main.go\n               |-----&gt;Models\n                          |----&gt;Models.go\n</code></pre>\n\n<p>main.go </p>\n\n<pre><code>// desktop/GoPro/main.go \n\npackage main\n\nimport (\n    \"./Models\"\n)\n\nfunc main() {\n    Models.Printhello()\n}\n</code></pre>\n\n<p>Models.go</p>\n\n<pre><code>// desktop/GoPro/Models\n\npackage Models\n\nimport \"fmt\"\n\nfunc Printhello() {\n    fmt.Println(\"Hello\")\n}\n</code></pre>\n\n<p>If try to run the main.go , I am getting the below error , Go recongise the package but it saying undefined.</p>\n\n<blockquote>\n  <p>go run main.go</p>\n  \n  <h1>command-line-arguments</h1>\n  \n  <p>.\\main.go:8:2: undefined: Models</p>\n</blockquote>\n\n<p>The folder is not in GOPATH. I am just trying to import the package with in sub folder of main.go </p>\n"}, {"tags": ["go", "blockchain", "p2p", "grpc"], "comments": [{"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1550032515, "post_id": 54662484, "comment_id": 96116042, "body": "Sounds like you might need a pub-sub broker, not just a p2p system."}, {"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 2, "creation_date": 1550032647, "post_id": 54662484, "comment_id": 96116072, "body": "Are you using <code>go func()</code> to spawn separate threads for each server connection? Then you would use a WaitGroup to wait for all the threads to finish."}, {"owner": {"reputation": 57, "user_id": 6690245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07d9fc4c5d0b130d8f30584562242a5?s=128&d=identicon&r=PG", "display_name": "freshPrince", "link": "https://stackoverflow.com/users/6690245/freshprince"}, "edited": false, "score": 0, "creation_date": 1550033222, "post_id": 54662484, "comment_id": 96116221, "body": "No, currently I am not using <code>go func() </code> for anything and I don&#39;t know much more about it. Can I use it? Doesn&#39;t it require more number of ports for doing it?"}, {"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 1, "creation_date": 1550034908, "post_id": 54662484, "comment_id": 96116663, "body": "I don&#39;t really know anything about GRPC so I hope my comments are not misplaced, but using <code>go func</code> with a WaitGroup would be the standard pattern in Go for this type of requirement. I don&#39;t know why you&#39;d need more ports, but as I say I don&#39;t know GPRC."}, {"owner": {"reputation": 57, "user_id": 6690245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07d9fc4c5d0b130d8f30584562242a5?s=128&d=identicon&r=PG", "display_name": "freshPrince", "link": "https://stackoverflow.com/users/6690245/freshprince"}, "edited": false, "score": 0, "creation_date": 1550035049, "post_id": 54662484, "comment_id": 96116698, "body": "I haven&#39;t implemented <code>go func()</code> but I think it will be sufficient with some work. So thank you."}], "answers": [{"tags": [], "owner": {"reputation": 218, "user_id": 6275993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PI08D.png?s=128&g=1", "display_name": "Jeyem", "link": "https://stackoverflow.com/users/6275993/jeyem"}, "is_accepted": true, "score": 1, "last_activity_date": 1550043361, "creation_date": 1550043361, "answer_id": 54664838, "question_id": 54662484, "link": "https://stackoverflow.com/questions/54662484/how-to-implement-non-blocking-client-in-grpc-go/54664838#54664838", "title": "how to implement non-blocking client in grpc go?", "body": "<p>You can use </p>\n\n<pre><code>go func(){}()\n</code></pre>\n\n<p>to do async jobs, and you can easy control async tasks with sync built-in package\nor use channels to control or sync tasks with it.</p>\n\n<p><a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/</a></p>\n\n<p><a href=\"https://gobyexample.com/channels\" rel=\"nofollow noreferrer\">https://gobyexample.com/channels</a></p>\n"}, {"tags": [], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "is_accepted": false, "score": 1, "last_activity_date": 1550146021, "last_edit_date": 1550146021, "creation_date": 1550145707, "answer_id": 54689966, "question_id": 54662484, "link": "https://stackoverflow.com/questions/54662484/how-to-implement-non-blocking-client-in-grpc-go/54689966#54689966", "title": "how to implement non-blocking client in grpc go?", "body": "<p>Just simply do the Client-streaming in gRPC\nClient send the message again and again when he send all the data </p>\n\n<pre><code> // add stream keyword when use in client side streaming\n rpc HeavyLoadData(stream P2PMessages) returns (P2PMessages);\n</code></pre>\n\n<p>And you can also use bi-directional if you want in continuity </p>\n\n<pre><code>message P2PMessages{\n    string anything = 1;\n}\n\nrpc Messages(stream P2PMessages) returns (stream P2PMessages){};\n</code></pre>\n\n<p>And If you want to do something which has to complete and then you want to send data use lock</p>\n\n<pre><code>var lock = &amp;sync.RWMutex{}\n\n// it will lock until your logic completes \nfun test(){\nlock.RLock()\ndefer lock.RUnlock()\n//do something your logic\n}\n</code></pre>\n\n<p>You can also use this if you have multiple clients make a client and want to send data when complete your logic used </p>\n\n<p>First create client map</p>\n\n<pre><code>var clients = make(map[string]string)\n\n//then use the threading in go \n go func(){\n // maintain here all your client when you want to send the data to whom\n }()\n\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 6690245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07d9fc4c5d0b130d8f30584562242a5?s=128&d=identicon&r=PG", "display_name": "freshPrince", "link": "https://stackoverflow.com/users/6690245/freshprince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1280, "favorite_count": 0, "accepted_answer_id": 54664838, "answer_count": 2, "score": 2, "last_activity_date": 1550146021, "creation_date": 1550031878, "last_edit_date": 1550032327, "question_id": 54662484, "link": "https://stackoverflow.com/questions/54662484/how-to-implement-non-blocking-client-in-grpc-go", "title": "how to implement non-blocking client in grpc go?", "body": "<p>I want to run different remote procedure on different servers without waiting for a reply from server. and as a server completes the procedure I want to have reply at the client. Can it be possible to do with grpc golang? </p>\n\n<p>I want to implement a blockchain network and I want to ask different peers to execute a transaction but I don't want to wait until one peer provides the output of execution and then I move to other peer.</p>\n\n<p>In other word I want to broadcast the execution of procedure and then have all the answers as execution is being done.</p>\n\n<p>I tried the common methods for connecting client and server but it waits for the response from the server. it will increase the time when execution needs to be done on more peers.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "edited": false, "score": 0, "creation_date": 1550032885, "post_id": 54662412, "comment_id": 96116138, "body": "yes correct  with err := db.QueryRow(&quot;SELECT SequenceID,MobilePhone,Output,WillBeSentDate, SentDate, Status, DtmUpd FROM  SMSBlast2 Where SequenceID = $3 AND MobilePhone = $85261415223 &quot;,SequenceID, MobilePhone).Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd) , but I want select SequenceID  &amp; MobilePhone in URL not in code to select SequenceID  &amp; MobilePhone"}, {"owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "reply_to_user": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "edited": false, "score": 0, "creation_date": 1550103561, "post_id": 54662412, "comment_id": 96151788, "body": "You misunderstand the syntax, I&#39;ve edited my answer. Please read it carefully."}], "tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": true, "score": 0, "last_activity_date": 1550103609, "last_edit_date": 1550103609, "creation_date": 1550031351, "answer_id": 54662412, "question_id": 54662132, "link": "https://stackoverflow.com/questions/54662132/how-to-implement-2-parameter-and-how-queryrow-to-implementing-parameter-sequenc/54662412#54662412", "title": "How to implement 2 parameter, and how QueryRow to implementing parameter SequenceID and MobilePhone", "body": "<p>Your syntax is incorrect. Try this:</p>\n\n<pre><code>err := db.QueryRow(\"SELECT SequenceID,MobilePhone,Output,WillBeSentDate, SentDate, Status, DtmUpd FROM  SMSBlast2 Where SequenceID = $1 AND MobilePhone = $2\", SequenceID, MobilePhone).Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>The query includes placeholders enumerated as <code>$1</code>, <code>$2</code>, etc. These placeholders are for the variables you include as parameters. In your comment you replaced <code>$1</code> with <code>$3</code>. That is not how it works. Leave it as <code>$1</code>, store the value in the <code>SequenceID</code> variable and pass that variable to <code>QueryRow</code>.</p>\n\n<p>Here is a simplified example to illustrate:</p>\n\n<pre><code>SequenceID := 3\nerr := db.QueryRow(\"SELECT * FROM SMSBlast2 WHERE SequenceID = $1\", SequenceID).Scan(...)\n</code></pre>\n\n<p>Now with two parameters:</p>\n\n<pre><code>SequenceID := 3\nMobilePhone := \"85261415223\"\nerr := db.QueryRow(\"SELECT * FROM SMSBlast2 WHERE SequenceID = $1 AND MobilePhone = $2\", SequenceID, MobilePhone).Scan(...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": false, "score": 0, "last_activity_date": 1550046192, "creation_date": 1550046192, "answer_id": 54665508, "question_id": 54662132, "link": "https://stackoverflow.com/questions/54662132/how-to-implement-2-parameter-and-how-queryrow-to-implementing-parameter-sequenc/54665508#54665508", "title": "How to implement 2 parameter, and how QueryRow to implementing parameter SequenceID and MobilePhone", "body": "<p>Try <code>Query()</code> instead, example <a href=\"https://github.com/gin-gonic/gin#another-example-query--post-form\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>SequenceID := context.Query(\"SequenceID\")\nMobilePhone := context.Query(\"MobilePhone\")\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 54662412, "answer_count": 2, "score": 0, "last_activity_date": 1550103609, "creation_date": 1550029158, "last_edit_date": 1550046071, "question_id": 54662132, "link": "https://stackoverflow.com/questions/54662132/how-to-implement-2-parameter-and-how-queryrow-to-implementing-parameter-sequenc", "title": "How to implement 2 parameter, and how QueryRow to implementing parameter SequenceID and MobilePhone", "body": "<p>I have a problem with implementing 2 parameters like this: <code>http://localhost:8080/SMSBlast/SequenceID?SequenceID=2&amp;MobilePhone=85261415223</code></p>\n\n<p>How to query with two columns <code>SequenceID</code> and <code>MobilePhone</code> to get <code>SequenceID=2&amp;MobilePhone=85261415223</code>, I have tried many ways but still not working </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main()  {\n    db, err :=  sql.Open(\"sqlserver\",\"sqlserver://sa:@localhost:1433?database=CONFINS&amp;connection+timeout=30\")\n    if err != nil{\n        fmt.Print(err.Error())\n    }\n\n\n    err = db.Ping()\n\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n    defer db.Close()\n\n    type SMSBlast struct {\n        SequenceID  int\n        MobilePhone string\n        Output  string\n        WillBeSentDate *time.Time\n        SentDate *time.Time\n        Status *string\n        DtmUpd *time.Time\n    }\n\n    router := gin.Default()\n\n    //Get a SMSBlast  detail\n    router.POST(\"/SMSBlast/:SequenceID\", func(context *gin.Context) {\n        var(\n            smsblast SMSBlast\n            result gin.H\n        )\n\n    SequenceID := context.Param(\"SequenceID\")\n    MobilePhone := context.Param(\"MobilePhone\")\n\n        err := db.QueryRow(\"SELECT SequenceID,MobilePhone,Output,WillBeSentDate, SentDate, Status, DtmUpd FROM  SMSBlast2 Where SequenceID = ? AND MobilePhone = ? \"+SequenceID , MobilePhone).Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n        //fmt.Println(row)\n        fmt.Println(err)\n        //err = row.Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n\n        if err != nil{\n            //if no results send null\n            result = gin.H{\n                \"result\": nil,\n                \"count\":  0,\n            }\n            }else{\n                result = gin.H{\n                    \"result\" : smsblast,\n                    \"count\" : 1,\n                }\n            }\n\n        context.JSON(http.StatusOK, result)\n    })\n\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 437, "user_id": 5053214, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--IBFtO8B2HI/AAAAAAAAAAI/AAAAAAAAADA/aIj-VRB-CS4/photo.jpg?sz=128", "display_name": "Bing Zhao", "link": "https://stackoverflow.com/users/5053214/bing-zhao"}, "edited": false, "score": 0, "creation_date": 1550030829, "post_id": 54662228, "comment_id": 96115664, "body": "Seems like Java&#39;s CountDownLatch. So goroutines works only if  the main process is running?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 437, "user_id": 5053214, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--IBFtO8B2HI/AAAAAAAAAAI/AAAAAAAAADA/aIj-VRB-CS4/photo.jpg?sz=128", "display_name": "Bing Zhao", "link": "https://stackoverflow.com/users/5053214/bing-zhao"}, "edited": false, "score": 0, "creation_date": 1550034078, "post_id": 54662228, "comment_id": 96116437, "body": "@BingZhao Edited the answer, please confirm."}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 3, "last_activity_date": 1550036897, "last_edit_date": 1550036897, "creation_date": 1550029793, "answer_id": 54662228, "question_id": 54661972, "link": "https://stackoverflow.com/questions/54661972/exercise-web-crawler-print-not-working/54662228#54662228", "title": "Exercise: Web Crawler - print not working", "body": "<p>According to the <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">spec</a></p>\n\n<blockquote>\n  <p>Program execution begins by initializing the main package and then invoking the function main. When that function invocation returns, the program exits. It does not wait for other (non-main) goroutines to complete.</p>\n</blockquote>\n\n<p>Therefore you have to explicitly wait for the other goroutine to end in <code>main()</code> function.</p>\n\n<p>One way is simply add <code>time.Sleep()</code> at the end of <code>main()</code> function until you think that the other goroutine ends (e.g. maybe 1 second in this case).</p>\n\n<p>Cleaner way is using <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a> as follows:</p>\n\n<pre><code>func Crawl(wg *sync.WaitGroup, url string, depth int, fetcher Fetcher) {\n    defer wg.Done()\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        wg.Add(1)\n        go Crawl(wg, u, depth-1, fetcher)\n    }\n    return\n}\n\nfunc main() {\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    // first call does not need to be goroutine since its subroutine is goroutine.\n    Crawl(wg, \"https://golang.org/\", 4, fetcher)\n    //time.Sleep(1000 * time.Millisecond)\n    wg.Wait()\n}\n</code></pre>\n\n<p>This code stores counter in <code>WaitGroup</code>, increment it using <code>wg.Add()</code>, decrement using <code>wg.Done()</code> and waits until it goes zero using <code>wg.Wait()</code>.</p>\n\n<p>Confirm it in go playground: <a href=\"https://play.golang.org/p/WqQBqe6iFLp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WqQBqe6iFLp</a></p>\n"}], "owner": {"reputation": 437, "user_id": 5053214, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--IBFtO8B2HI/AAAAAAAAAAI/AAAAAAAAADA/aIj-VRB-CS4/photo.jpg?sz=128", "display_name": "Bing Zhao", "link": "https://stackoverflow.com/users/5053214/bing-zhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 54662228, "answer_count": 1, "score": 0, "last_activity_date": 1550036897, "creation_date": 1550027824, "last_edit_date": 1550033012, "question_id": 54661972, "link": "https://stackoverflow.com/questions/54661972/exercise-web-crawler-print-not-working", "title": "Exercise: Web Crawler - print not working", "body": "<blockquote>\n  <p>I'm a golang newbie and currently working on <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">Exercise: Web Crawler</a>.</p>\n</blockquote>\n\n<p>I simply put the keyword 'go' before every place where func Crawl is invoked and hope it can be parallelized, but <code>fmt.Printf</code> doesn't work and prints nothing. Nothing other is changed on the original code besides this one. Would someone like to give me a hand?</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    // TODO: Fetch URLs in parallel.\n    // TODO: Don't fetch the same URL twice.\n    // This implementation doesn't do either:\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        go Crawl(u, depth-1, fetcher)\n    }\n    return\n}\n\nfunc main() {\n    go Crawl(\"https://golang.org/\", 4, fetcher)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 0, "creation_date": 1550032534, "post_id": 54661497, "comment_id": 96116047, "body": "How do I use *YourDB? I get an undefined error. I also want to include html/template."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 1, "creation_date": 1550032693, "post_id": 54661497, "comment_id": 96116087, "body": "<code>YourDB</code> means the db struct you are using. You should change it to your db struct. For example <code>sql.DB</code> from &quot;<code>database&#47;sql</code>&quot;."}, {"owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 0, "creation_date": 1550035323, "post_id": 54661497, "comment_id": 96116768, "body": "ok, I have this figured out but now I get a green comment in vscode &quot;exported func NewUserResource returns unexported type *main.usersResource, which can be annoying to use(undefined)&quot;. Is that a problem?"}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 1, "creation_date": 1550037716, "post_id": 54661497, "comment_id": 96117562, "body": "change <code>NewUserResource</code> to <code>newUserResource</code>. It will be unexported."}], "tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": true, "score": 3, "last_activity_date": 1550037739, "last_edit_date": 1550037739, "creation_date": 1550024315, "answer_id": 54661497, "question_id": 54659979, "link": "https://stackoverflow.com/questions/54659979/how-to-pass-vars-to-chi-router-in-golang/54661497#54661497", "title": "How to pass vars to chi router in Golang", "body": "<p>Usually, we do that this way.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc main() {\n\n......\n  r := chi.NewRouter()\n\n  // keep db connection alive.\n  db, err := sql.Open(\"mysql\", dBSource)\n\n  ur := NewUserResource(store, db)\n\n  r.Mount(\"/users\", ur.Routes())\n}\n\ntype usersResource struct{\n  store *mysqlstore.MySQLStore\n// and more...\n  db *YourDB\n}\n\n// new function to pass global var\nfunc newUserResource(store *mysqlstore.MySQLStore, db *YourDB) *usersResource{\n  return &amp;usersResource {\n    store: store,\n    db: db,\n  }\n}\n\nfunc (rs *usersResource) List(w http.ResponseWriter, r *http.Request) {\n    // don't use global var\n    session, err := ur.store.Get(r, \"session-data\")\n\n    ur.db.GetWhatever()\n\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "is_accepted": false, "score": 0, "last_activity_date": 1550047539, "last_edit_date": 1550047539, "creation_date": 1550044873, "answer_id": 54665182, "question_id": 54659979, "link": "https://stackoverflow.com/questions/54659979/how-to-pass-vars-to-chi-router-in-golang/54665182#54665182", "title": "How to pass vars to chi router in Golang", "body": "<p>For completeness, here is how I implemented the accepted solution. Hopefully, it may save another newbie a bunch of time.</p>\n\n<pre><code>type appResource struct {\n    tmpl  *template.Template // net/http\n    store *mysqlstore.MySQLStore\n    db    *sql.DB // database/sql\n}\n\nfunc newAppResource(store *mysqlstore.MySQLStore, db *sql.DB, tmpl *template.Template) *appResource {\n    return &amp;appResource{\n        tmpl:  tmpl,\n        store: store,\n        db:    db,\n    }\n}\n\nfunc main() {\n\n  var err error\n\n  err = godotenv.Load()\n  if err != nil {\n     log.Fatal(\"Error loading .env file\")\n  }\n\n  dbUser := os.Getenv(\"dbUser\")\n  dbName := os.Getenv(\"dbName\")\n  dbPass := os.Getenv(\"dbPass\")\n  dbHost := os.Getenv(\"dbHost\")\n  dbPort := os.Getenv(\"dbPort\")\n\n  dBSource := fmt.Sprintf(\"%s:%s@tcp(%s:%s)/%s?charset=utf8\", dbUser, dbPass, dbHost, dbPort, dbName)\n\n  db, err := sql.Open(\"mysql\", dBSource)\n  if err != nil {\n     log.Fatal(err)\n  }\n\n  sessionKey := os.Getenv(\"sessionKey\")\n\n  endpoint := fmt.Sprintf(\"%s:%s@tcp(%s:%s)/%s?parseTime=true&amp;loc=Local\", dbUser, dbPass, dbHost, dbPort, dbName)\n  tableName := \"sessions\"\n  path := \"/\"\n  maxAge := 3600\n  codecs := []byte(sessionKey)\n\n  store, err := mysqlstore.NewMySQLStore(endpoint, tableName, path, maxAge, codecs)\n  if err != nil {\n    log.Println(\"SESSIONS STORE error\")\n    log.Fatal(err)\n  }\n\n  r := chi.NewRouter()\n\n  r.Get(\"/\", rs.adminIndex)\n\n  r.Mount(\"/users\", rs.userRoutes())\n\n  httpPort := os.Getenv(\"httpPort\")\n\n  http.ListenAndServe(httpPort, r)\n}\n\nfunc (rs *appResource) adminIndex(w http.ResponseWriter, r *http.Request) {\n    session, err := rs.store.Get(r, \"admin-data\")\n    if err != nil {\n        log.Fatal(err)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    var flash map[string]interface{}\n\n    if flashes := session.Flashes(); len(flashes) &gt; 0 {\n        v := map[string]interface{}{\n            \"FlashedMessages\": session.Flashes(),\n        }\n        flash = v\n    }\n\n    if err := rs.tmpl.ExecuteTemplate(w, \"admin-index\", flash); err != nil {\n        log.Println(err.Error())\n        http.Error(w, http.StatusText(500), 500)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "accepted_answer_id": 54661497, "answer_count": 2, "score": 1, "last_activity_date": 1550047539, "creation_date": 1550012562, "last_edit_date": 1550014941, "question_id": 54659979, "link": "https://stackoverflow.com/questions/54659979/how-to-pass-vars-to-chi-router-in-golang", "title": "How to pass vars to chi router in Golang", "body": "<p>I'm writing a web app using chi router and have global vars for the database connection string and gorilla sessions mysqlstore. I want to pass these to the chi mount function instead of using global vars but can't figure out how to do it.</p>\n\n<p>Here is my code, redacted for brevity.</p>\n\n<pre><code>var dBSource string\n\nvar store *mysqlstore.MySQLStore\n\nfunc main() {\n\n  var err error\n\n  dBSource = fmt.Sprintf(\"%s:%s@tcp(%s:%s)/%s?charset=utf8\", dbUser, dbPass, dbHost, dbPort, dbName)\n\n  store, err = mysqlstore.NewMySQLStore(endpoint, tableName, path, maxAge, codecs)\n\n  defer store.Close()\n\n  r := chi.NewRouter()\n\n  r.Mount(\"/users\", usersResource{}.Routes())\n}\n\ntype usersResource struct{}\n\nfunc (rs usersResource) Routes() chi.Router {\n    r := chi.NewRouter()\n\n    r.Get(\"/\", rs.List)\n\n    return r\n}\n\nfunc (rs usersResource) List(w http.ResponseWriter, r *http.Request) {\n\n    session, err := store.Get(r, \"session-data\")\n\n    db, err := sql.Open(\"mysql\", dBSource)\n}\n</code></pre>\n"}, {"tags": ["go", "jenkins"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1550009806, "post_id": 54659363, "comment_id": 96110500, "body": "Can you paste the error you get? That would make it easier for us to help debug."}, {"owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "reply_to_user": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 1, "creation_date": 1550010055, "post_id": 54659363, "comment_id": 96110589, "body": "@robbrit i edited with the error, freelancers is the namespace of course"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1550010251, "post_id": 54659363, "comment_id": 96110657, "body": "Using Jenkins to do this end-to-end is kind of a strange workflow. You might consider using Jenkins to manage your AWS instances (so AWS does the standing up), or using Jenkins to manage your Heroku app (so Heroku does the standing up) or etc. (Though I should say that this is certainly possible!)"}, {"owner": {"reputation": 7522, "user_id": 3957754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lN343.png?s=128&g=1", "display_name": "JRichardsz", "link": "https://stackoverflow.com/users/3957754/jrichardsz"}, "edited": false, "score": 0, "creation_date": 1550018164, "post_id": 54659363, "comment_id": 96112811, "body": "Is your go-app running at least in localhost without Jenkins ? Also where are you running this : go run server.go : Ec2 with Jenkins or EC2 with go  ?"}, {"owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "reply_to_user": {"reputation": 7522, "user_id": 3957754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lN343.png?s=128&g=1", "display_name": "JRichardsz", "link": "https://stackoverflow.com/users/3957754/jrichardsz"}, "edited": false, "score": 0, "creation_date": 1550039752, "post_id": 54659363, "comment_id": 96118399, "body": "@JRichardsz, if course its runnig in localhost. And in the ec2 with go, not the one with jenkins. The problem is the path. If I could change jenkins to create the File in another dir and not in workspace, its should solve the problem"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1550083019, "post_id": 54659363, "comment_id": 96143564, "body": "Where does <code>freelancers&#47;daos</code> come from? Is it fetched already? If it is, where is it?"}, {"owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "edited": false, "score": 0, "creation_date": 1550083909, "post_id": 54659363, "comment_id": 96143982, "body": "everything works on my computer and Heroku, freelancers/daos is a package inside my app. there is no problem with the application itself. just with Jenkins."}], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 7327745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fcbd2d8ea52236dffc3449c0a29e881?s=128&d=identicon&r=PG&f=1", "display_name": "Subbu M", "link": "https://stackoverflow.com/users/7327745/subbu-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1550013792, "creation_date": 1550013792, "answer_id": 54660193, "question_id": 54659363, "link": "https://stackoverflow.com/questions/54659363/deploy-go-application-via-jenkins/54660193#54660193", "title": "deploy go application via jenkins", "body": "<p>Set you environment correctly \n<a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SettingGOPATH</a></p>\n\n<p>Make sure package \"freelancers/daos\" is downloaded correctly to right path.</p>\n\n<p>Run and check your go env settings</p>\n"}], "owner": {"reputation": 1057, "user_id": 9993548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665efa711b885fb0bfda346fbe51c95c?s=128&d=identicon&r=PG", "display_name": "Nir Berko", "link": "https://stackoverflow.com/users/9993548/nir-berko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1580326339, "creation_date": 1550009133, "last_edit_date": 1550010025, "question_id": 54659363, "link": "https://stackoverflow.com/questions/54659363/deploy-go-application-via-jenkins", "title": "deploy go application via jenkins", "body": "<p>I just created two EC2 instances, one with Jenkins and one for the go application.</p>\n\n<p>I managed to create a node and a job that works together, and after starting the job for building the go application, I get the go files inside the workspace folder. </p>\n\n<p>and I don't understand what I need to do from now. I can't run <code>go run server.go</code> because it's doesn't in the go src folder so I am getting an error that the namespace doesn't exist.</p>\n\n<p>This is the error i get:</p>\n\n<pre><code>server.go:7:2: cannot find package \"freelancers/daos\" in any of:\n    /usr/lib/golang/src/freelancers/daos (from $GOROOT)\n    /home/ec2-user/projects/src/freelancers/daos (from $GOPATH)\n</code></pre>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1550006500, "post_id": 54658820, "comment_id": 96109231, "body": "@JimB that&#39;s similar but much, much simpler than the code quoted in the question, which involves a combination of conversion, assertion, and dereferencing."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1550007646, "post_id": 54658936, "comment_id": 96109704, "body": "FTR, <code>v.ptr</code> is an <code>unsafe.Pointer</code>, which is how it can be converted into any pointer type."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1550007974, "post_id": 54658936, "comment_id": 96109845, "body": "That was my guess but there wasn&#39;t enough context given to be sure of its type."}, {"owner": {"reputation": 31, "user_id": 11006562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YQmR811jTAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMuW_q4Ny1WV9DjE8venundU2XNRw/mo/photo.jpg?sz=128", "display_name": "Andrew Alferenkov", "link": "https://stackoverflow.com/users/11006562/andrew-alferenkov"}, "edited": false, "score": 0, "creation_date": 1550089876, "post_id": 54658936, "comment_id": 96146754, "body": "Thank you! That pointer in type conversion made me a little bit confused"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550089973, "post_id": 54658936, "comment_id": 96146804, "body": "It looks a little unusual because of that; the reason is that just <code>*float32(v.ptr)</code> would try to convert to a <code>float32</code> value and then dereference it (which you can&#39;t do because it&#39;s not a pointer), so the type has to be wrapped in parens."}, {"owner": {"reputation": 31, "user_id": 11006562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YQmR811jTAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMuW_q4Ny1WV9DjE8venundU2XNRw/mo/photo.jpg?sz=128", "display_name": "Andrew Alferenkov", "link": "https://stackoverflow.com/users/11006562/andrew-alferenkov"}, "edited": false, "score": 0, "creation_date": 1550089991, "post_id": 54658936, "comment_id": 96146809, "body": "If <code>unsafe.Pointer</code> can be converted into any pointer type why cant we just do smth like <code>*(*float64)(v.ptr)</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1550090107, "post_id": 54658936, "comment_id": 96146862, "body": "Because that&#39;s not the actual underlying type. That would take the next 64 bits of memory starting at the pointer location and treat it as a <code>float64</code>, when the actual value is only 32 bits long."}, {"owner": {"reputation": 31, "user_id": 11006562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YQmR811jTAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMuW_q4Ny1WV9DjE8venundU2XNRw/mo/photo.jpg?sz=128", "display_name": "Andrew Alferenkov", "link": "https://stackoverflow.com/users/11006562/andrew-alferenkov"}, "edited": false, "score": 0, "creation_date": 1550090194, "post_id": 54658936, "comment_id": 96146905, "body": "@Adrian Now I understand this. Thank you very much again!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1550006982, "creation_date": 1550006982, "answer_id": 54658936, "question_id": 54658820, "link": "https://stackoverflow.com/questions/54658820/what-does-this-code-from-go-sources-mean-like-float32v-ptr/54658936#54658936", "title": "What does this code from go sources mean? Like (*(*float32)(v.ptr))", "body": "<p>Let's unwrap the expression. We'll take it from innermost to outermost, since that's the order it's evaluated:</p>\n\n<pre><code>(*float32)(v.ptr)\n</code></pre>\n\n<p>Convert <code>v.ptr</code> to <code>*float32</code>, a pointer to a <code>float32</code>.</p>\n\n<pre><code>*(*float32)(v.ptr)\n</code></pre>\n\n<p>Dereference that pointer, giving us a <code>float32</code> value.</p>\n\n<pre><code>float64(*(*float32)(v.ptr))\n</code></pre>\n\n<p>Convert the <code>float32</code> value to a <code>float64</code> value.</p>\n\n<p>So, whatever <code>v.ptr</code> is, it's converted to a <code>float32</code> pointer, dereferenced, and then converted to <code>float64</code>, and returned.</p>\n"}], "owner": {"reputation": 31, "user_id": 11006562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YQmR811jTAQ/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMuW_q4Ny1WV9DjE8venundU2XNRw/mo/photo.jpg?sz=128", "display_name": "Andrew Alferenkov", "link": "https://stackoverflow.com/users/11006562/andrew-alferenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54658936, "answer_count": 1, "score": 1, "last_activity_date": 1550006982, "creation_date": 1550006330, "question_id": 54658820, "link": "https://stackoverflow.com/questions/54658820/what-does-this-code-from-go-sources-mean-like-float32v-ptr", "title": "What does this code from go sources mean? Like (*(*float32)(v.ptr))", "body": "<p>In reflection package I see the code like </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    return float64(*(*float32)(v.ptr))\n</code></pre>\n\n<p>What is *(*float32)(v.ptr)? I don't have any ideas</p>\n"}, {"tags": ["web-services", "docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1550005959, "post_id": 54658573, "comment_id": 96108969, "body": "\u201cI ignored the error return, and then my program panicked\u201d is distinctly not idiomatic Go.  You need to capture the error return.  The error message will probably include something useful."}, {"owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1550007891, "post_id": 54658573, "comment_id": 96109809, "body": "Thank you for the call out @DavidMaze - much appreciated!! It got me on the correct track with a new error message. I&#39;ve modified the original question with the actual problem."}], "answers": [{"tags": [], "owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "is_accepted": false, "score": 2, "last_activity_date": 1550012154, "creation_date": 1550012154, "answer_id": 54659901, "question_id": 54658573, "link": "https://stackoverflow.com/questions/54658573/docker-compose-api-call-and-endpoint-containerized/54659901#54659901", "title": "Docker-Compose API Call and Endpoint Containerized", "body": "<p>For anyone who's attempting to do something like this in the future: the above code actually <em>does</em> work. But where I was going wrong was that in my <code>url := \"http://apiconnection:8080/maccaption\"</code> I was referring to the image name instead of the service name I've defined in the docker-compose. </p>\n\n<p>changing the url to look at the service name instead of the image name corrected the issue and I'm now able to make API calls within my dockerized environment. </p>\n"}], "owner": {"reputation": 177, "user_id": 6613904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20b4277bb8450e16bf6fc49a9cba40b9?s=128&d=identicon&r=PG&f=1", "display_name": "henleyhoudini", "link": "https://stackoverflow.com/users/6613904/henleyhoudini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1550012154, "creation_date": 1550004997, "last_edit_date": 1550008102, "question_id": 54658573, "link": "https://stackoverflow.com/questions/54658573/docker-compose-api-call-and-endpoint-containerized", "title": "Docker-Compose API Call and Endpoint Containerized", "body": "<p>Using docker-compose I've got multiple containers running - one of them is the profiler container that calls an API, the other container apiconnection should be receiving the call and sending information back. However when I run the compose file it always returns <code>Get http://apiconnection:8080/maccaption: dial tcp: lookup apiconnection on 127.0.0.11:53: no such host</code> on the Profiler container at the <code>http.DefaultClient.Do</code> line.</p>\n\n<p>This is a sample of my compose file: </p>\n\n<pre><code>apiConnection:\n image: apiconnection:1.0\n ports:\n  - \"8080:8080\"\n networks: \n  - maccaptionNet\nprofiler:\n  image: profiler:1.0\n  networks: \n   - maccaptionNet\n  depends_on:\n   - \"apiConnection\"\n</code></pre>\n\n<p>I'm calling the api in my profiler image like so - it's erroring on <code>DefaultClient</code>: </p>\n\n<pre><code>url := \"http://apiconnection:8080/maccaption\"\n\nreq, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    log.Fatal(err)\n}\n\nres, err := http.DefaultClient.Do(req)\nif err != nil {\n    fmt.Println(\"Line 27\")\n    log.Fatal(err)\n}\n\nbody, err := ioutil.ReadAll(res.Body)\nif err != nil {\n    fmt.Println(\"Line 33\")\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>If I modify the <code>url := \"http://apiconnection:8080/maccaption\"</code> to look at localhost like this <code>url := \"http://localhost:8080/maccaption\"</code> it changes to <code>connect refused</code>, but I don't think I should be looking at localhost, I need to look at the Docker container don't I? </p>\n\n<p>I'm setting the url as a connection to the docker container and using the ports I've assigned in the docker-compose file. \nand receiving the request in my apiconnection image like this: </p>\n\n<pre><code>    r := mux.NewRouter()\n\nr.HandleFunc(\"/maccaption\", handleMaccaption).Methods(\"GET\")\n\nhttp.ListenAndServe(\":8080\", r)\n</code></pre>\n\n<p>All it should be doing now is starting up and making a single request to prove that it is working and returning some json information. This code works outside of docker, replacing the container name in the url variable with localhost. But I cannot get it running within docker. </p>\n\n<p>I've looked at these other sources for assistance but to no avail: \n<a href=\"https://stackoverflow.com/questions/53304923/how-to-call-api-endpoint-inside-docker-container\">how to call api endpoint inside docker container?</a>\n<a href=\"https://stackoverflow.com/questions/44784666/making-a-rest-call-to-endpoint-in-dockers\">Making a REST Call to Endpoint in Dockers</a>\n<a href=\"https://stackoverflow.com/questions/38880615/docker-compose-internal-communication-using-endpoints\">Docker-compose internal communication using endpoints</a></p>\n\n<p>Any pointers would be greatly appreciated - thank you! </p>\n\n<p>**EDIT - to fix my wonky code formatting</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 9, "last_activity_date": 1550005099, "creation_date": 1550005099, "answer_id": 54658598, "question_id": 54658441, "link": "https://stackoverflow.com/questions/54658441/python-like-json-handling-using-golang/54658598#54658598", "title": "Python like json handling using Golang", "body": "<p>There are third-party packages like <a href=\"https://github.com/tidwall/gjson\" rel=\"noreferrer\">gjson</a> that can help you do that.</p>\n\n<p>That said, note that Go is Go, and Python is Python. Go is statically typed, for better and worse. It takes more code to write simple JSON manipulation, but that code should be easier to maintain later since it's more strictly typed and the compiler helps you check against error. Types also serve as documentation - simply nesting dicts and arrays is completely arbitrary.</p>\n"}, {"tags": [], "owner": {"reputation": 68, "user_id": 9659427, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WgLHnA1JfOQ/AAAAAAAAAAI/AAAAAAAADHs/ts8-TuEcgRY/photo.jpg?sz=128", "display_name": "Myles", "link": "https://stackoverflow.com/users/9659427/myles"}, "is_accepted": false, "score": 2, "last_activity_date": 1550033283, "creation_date": 1550033283, "answer_id": 54662696, "question_id": 54658441, "link": "https://stackoverflow.com/questions/54658441/python-like-json-handling-using-golang/54662696#54662696", "title": "Python like json handling using Golang", "body": "<p>I have found the following resource very helpful in creating a struct from json. Unmarshaling should only match the fields you have defined in the struct, so take what you need, and leave the rest if you like.</p>\n\n<p><a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> </p>\n"}], "owner": {"reputation": 603, "user_id": 3583807, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33621d98b061051b0523a49d493a9281?s=128&d=identicon&r=PG&f=1", "display_name": "user3583807", "link": "https://stackoverflow.com/users/3583807/user3583807"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1067, "favorite_count": 1, "accepted_answer_id": 54658598, "answer_count": 2, "score": 3, "last_activity_date": 1550033283, "creation_date": 1550004301, "last_edit_date": 1550004879, "question_id": 54658441, "link": "https://stackoverflow.com/questions/54658441/python-like-json-handling-using-golang", "title": "Python like json handling using Golang", "body": "<p>Using Python I can do following:</p>\n\n<pre><code>r = requests.get(url_base + url)\njsonObj = json.loads(r.content.decode('raw_unicode_escape'))\nprint(jsonObj[\"PartDetails\"][\"ManufacturerPartNumber\"]\n</code></pre>\n\n<p>Is there any way to perform same thing using Golang?\nCurrently I need following:</p>\n\n<pre><code>json.Unmarshal(body, &amp;part_number_json)\nfmt.Println(\"\\r\\nPartDetails: \", part_number_json.(map[string]interface{})[\"PartDetails\"].(map[string]interface{})[\"ManufacturerPartNumber\"])\n</code></pre>\n\n<p>That is to say I need to use casting for each field of JSON what tires and makes the code unreadable. \nI tried this using <a href=\"https://stackoverflow.com/questions/52466447/loop-through-json-keys-and-values-and-same-time-replacing-specify-matched-value\">reflection</a> but it is not comphortable too.</p>\n\n<p><strong>EDIT</strong>:\ncurrently use following function:</p>\n\n<pre><code>func jso(json interface{}, fields ...string) interface{} {\n    res := json\n    for _, v := range fields {\n        res = res.(map[string]interface{})[v]\n    }\n    return res\n</code></pre>\n\n<p>and call it like that:</p>\n\n<pre><code>fmt.Println(\"PartDetails: \", jso( part_number_json, \"PartDetails\", \"ManufacturerPartNumber\") )\n</code></pre>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1550000875, "post_id": 54657446, "comment_id": 96106628, "body": "<a href=\"https://golang.org/pkg/runtime/?m=all#memclrNoHeapPointers\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/?m=all#memclrNoHeapPointers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1572868742, "post_id": 54658493, "comment_id": 103682960, "body": "The library parses binary files into structs while doing some decompression on the data, so I guess a bit of gc is necessary to read all the data into arrays and then decompress it further into structs. Thanks for the answer!"}], "tags": [], "owner": {"reputation": 10550, "user_id": 633094, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/8FbW8.jpg?s=128&g=1", "display_name": "munk", "link": "https://stackoverflow.com/users/633094/munk"}, "is_accepted": true, "score": 3, "last_activity_date": 1550005017, "last_edit_date": 1550005017, "creation_date": 1550004590, "answer_id": 54658493, "question_id": 54657446, "link": "https://stackoverflow.com/questions/54657446/what-does-runtime-memclrnoheappointers-do/54658493#54658493", "title": "What does runtime.memclrNoHeapPointers do?", "body": "<blockquote>\n  <p>func memclrNoHeapPointers(ptr unsafe.Pointer, n uintptr)</p>\n  \n  <p>memclrNoHeapPointers clears n bytes starting at ptr.</p>\n  \n  <p>Usually you should use typedmemclr. memclrNoHeapPointers should be\n  used only when the caller knows that *ptr contains no heap pointers\n  because either:</p>\n  \n  <ol>\n  <li><p>*ptr is initialized memory and its type is pointer-free.</p></li>\n  <li><p>*ptr is uninitialized memory (e.g., memory that's being reused</p></li>\n  </ol>\n  \n  <p>for a new allocation) and hence contains only \"junk\".</p>\n  \n  <p>in memclr_*.s go:noescape</p>\n</blockquote>\n\n<p>See <a href=\"https://github.com/golang/go/blob/9e277f7d554455e16ba3762541c53e9bfc1d8188/src/runtime/stubs.go#L78\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/9e277f7d554455e16ba3762541c53e9bfc1d8188/src/runtime/stubs.go#L78</a></p>\n\n<p>This is part of the garbage collector. <a href=\"https://github.com/golang/go/blob/75798e8ada7fcb286f633618ac2f55ad5240ed97/src/cmd/compile/internal/gc/builtin/runtime.go\" rel=\"nofollow noreferrer\">You can see the declaration here.</a></p>\n\n<p>The specifics of what it does are CPU dependent. <a href=\"https://github.com/golang/go/tree/50bd1c4d4eb4fac8ddeb5f063c099daccfb71b26/src/runtime\" rel=\"nofollow noreferrer\">See the various memclr_*.s files in the runtime for implmentation</a></p>\n\n<p>This does seem like a long time in the GC, but it's hard to say something about the memory usage of the library with just the data you've shown I think.</p>\n"}], "owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1041, "favorite_count": 0, "accepted_answer_id": 54658493, "answer_count": 1, "score": 2, "last_activity_date": 1550005017, "creation_date": 1549999986, "question_id": 54657446, "link": "https://stackoverflow.com/questions/54657446/what-does-runtime-memclrnoheappointers-do", "title": "What does runtime.memclrNoHeapPointers do?", "body": "<p>I am profiling a library and see that a function called <code>runtime.memclrNoHeapPointers</code> is taking up about 0.82seconds of the cpu-time. </p>\n\n<p>What does this function do, and what does this tell me about the memory-usage of the library i am profiling?</p>\n\n<p>The output, for completeness:</p>\n\n<pre><code>File: gribtest.test\nType: cpu\nTime: Feb 12, 2019 at 8:27pm (CET)\nDuration: 5.21s, Total samples = 5.11s (98.15%)\nShowing nodes accounting for 4.94s, 96.67% of 5.11s total\nDropped 61 nodes (cum &lt;= 0.03s)\n      flat  flat%   sum%        cum   cum%\n     1.60s 31.31% 31.31%      1.81s 35.42%  github.com/nilsmagnus/grib/griblib.(*BitReader).readBit\n     1.08s 21.14% 52.45%      2.89s 56.56%  github.com/nilsmagnus/grib/griblib.(*BitReader).readUint\n     0.37s  7.24% 59.69%      0.82s 16.05%  encoding/binary.(*decoder).value\n     0.35s  6.85% 66.54%      0.35s  6.85%  runtime.memclrNoHeapPointers\n</code></pre>\n"}, {"tags": ["c++", "go"], "comments": [{"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 7, "creation_date": 1549998477, "post_id": 54657046, "comment_id": 96105421, "body": "What is your C++ compiler settings? You are also using time points from different clocks."}, {"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 2, "creation_date": 1549998675, "post_id": 54657046, "comment_id": 96105538, "body": "Why two variables (<code>c</code> and <code>i</code>) in C++, but only one in Go?"}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1549998887, "post_id": 54657046, "comment_id": 96105647, "body": "FWIW, benchmarking C++ code can be hard.  Thankfully there are tools to help with it like <a href=\"http://quick-bench.com/\" rel=\"nofollow noreferrer\">Quick Bench</a> which uses google&#39;s benchamarking library."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1549999541, "post_id": 54657046, "comment_id": 96105971, "body": "Can you also make the go program complete?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549999545, "post_id": 54657046, "comment_id": 96105976, "body": "Your Go code and your C++ code have compile errors."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 0, "creation_date": 1550000037, "post_id": 54657046, "comment_id": 96106219, "body": "NathanOliver: because IDE was complaining that only ints should be used in for loops.  @SergeyA unfortunately I&#39;m not a c++ dev but anyways: I&#39;m using CLion with Visual c++ 15, CMake 3.13.2, I can see that CMake options are -DCMAKE_BUILD_TYPE=Debug"}, {"owner": {"reputation": 68702, "user_id": 1593860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1361e47a8bf06d20ffda9a686ceb7e68?s=128&d=identicon&r=PG", "display_name": "Pete Becker", "link": "https://stackoverflow.com/users/1593860/pete-becker"}, "edited": false, "score": 2, "creation_date": 1550000367, "post_id": 54657046, "comment_id": 96106388, "body": "Re: &quot; -DCMAKE_BUILD_TYPE=Debug&quot; -- that&#39;s what I guessed when I saw the title. Debug builds aren&#39;t optimized and run much slower than non-debug builds. For almost every question that starts with &quot;my C++ program is much slower than...&quot; the answer is &quot;turn on optimizations&quot;."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1550000455, "post_id": 54657046, "comment_id": 96106422, "body": "the code is fixed. sorry but i had to copy paste it on the rush and didn&#39;t pay attention to it."}, {"owner": {"reputation": 55924, "user_id": 5245033, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6dbfd37ccb940fd2afcd49e966ad97e4?s=128&d=identicon&r=PG&f=1", "display_name": "SergeyA", "link": "https://stackoverflow.com/users/5245033/sergeya"}, "edited": false, "score": 2, "creation_date": 1550000847, "post_id": 54657046, "comment_id": 96106611, "body": "C++ performance in debug builds should not be spoken about. Turn on optimizations and get back to us."}], "answers": [{"tags": [], "owner": {"reputation": 435402, "user_id": 179910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8962238339d771f0348967be6f97b1b?s=128&d=identicon&r=PG", "display_name": "Jerry Coffin", "link": "https://stackoverflow.com/users/179910/jerry-coffin"}, "is_accepted": false, "score": 3, "last_activity_date": 1550014336, "last_edit_date": 1592644375, "creation_date": 1550001077, "answer_id": 54657699, "question_id": 54657046, "link": "https://stackoverflow.com/questions/54657046/map-performance-comparison-between-go-and-c/54657699#54657699", "title": "map performance comparison between go and c++", "body": "<p>It's a bit hard to pin down &quot;the speed of C++&quot; (for almost any particular thing) because it can depend on quite a few variables, such as the compiler you use. For example, I'm typically seeing a difference of 2:1 or so between gcc and msvc for the C++ version of this code.</p>\n<p>As far as differences between C++ and Go, I'd guess it's mostly down to differences in how the hash tables are implemented. One obvious point is that Go's map implementation allocates data space in blocks of 8 elements at a time. At least the standard library implementations I've seen, <code>std::unordered_map</code> places only one item per block.</p>\n<p>We'd expect this to mean that in a typical case, the C++ code will do much larger number of individual allocations from the heap/free store, so its speed will depend much more heavily on the speed of the heap manager. The Go version should also have a substantially higher locality of reference so it makes better user of the cache.</p>\n<p>Given those differences, I'm a little surprised that you're only seeing a 10:1 difference. My immediate guess would have been (somewhat) higher than that--but as we all know, one measurement is worth more than 100 guesses.</p>\n<h2>Reference</h2>\n<p><a href=\"https://github.com/golang/go/blob/master/src/runtime/map.go\" rel=\"nofollow noreferrer\">Go's Map Implementation</a></p>\n<p><a href=\"https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/unordered_map.h\" rel=\"nofollow noreferrer\">liststdc++ unordered_map</a></p>\n<p><a href=\"https://github.com/llvm/llvm-project/blob/master/libcxx/include/unordered_map\" rel=\"nofollow noreferrer\">libc++ unordered_map</a></p>\n"}, {"comments": [{"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1550001964, "post_id": 54657852, "comment_id": 96107133, "body": "Wow! Got the tie too. Would you mind to explain me why reserve is making it so performant compared to the version without it?"}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1550002518, "post_id": 54657852, "comment_id": 96107385, "body": "Ok I got it, basically the hashmap was allocating memory everytime, while with reserve I allocate it once until it gets full again."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "reply_to_user": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1550002588, "post_id": 54657852, "comment_id": 96107417, "body": ":) Great! It reserves the number of buckets needed in one go instead of having to allocate more and more as the program runs. <a href=\"https://en.cppreference.com/w/cpp/container/unordered_map/reserve\" rel=\"nofollow noreferrer\">std::unordered_map::reserve</a> I guess you could run it without <code>reserve</code> and track <code>bucket_count</code> to see how many calls it needs to do to allocate new buckets."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1550004252, "post_id": 54657852, "comment_id": 96108226, "body": "@TedLyngmo:  Apples and oranges."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1550005273, "post_id": 54657852, "comment_id": 96108687, "body": "Indeed. It was the first go code I saw, wrote and compiled. I should have guessed it also had some optimizing option :-)"}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1550044777, "post_id": 54657852, "comment_id": 96120683, "body": "@peterSO Updated it. Is this one more fair?"}], "tags": [], "owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "is_accepted": true, "score": 2, "last_activity_date": 1550047526, "last_edit_date": 1550047526, "creation_date": 1550001709, "answer_id": 54657852, "question_id": 54657046, "link": "https://stackoverflow.com/questions/54657046/map-performance-comparison-between-go-and-c/54657852#54657852", "title": "map performance comparison between go and c++", "body": "<p>Updated to measure similar operations for both <code>cpp</code> and <code>go</code>. It starts measurment before calling the map-making function and ends it when the function returns. Both versions reserve space in the map and return the created map (from which a couple of numbers are printed).</p>\n\n<p>Slightly modified <code>cpp</code>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;unordered_map&gt;\n#include &lt;chrono&gt;\n\nstd::unordered_map&lt;double, double&gt; make_map(double times) {\n    std::unordered_map&lt;double, double&gt; m(times);\n\n    for (double c = 0; c &lt; times; ++c) {\n        m[c] = c + 10.0;\n    }\n    return m;\n}\n\nint main() {\n    std::chrono::high_resolution_clock::time_point start_time = std::chrono::high_resolution_clock::now();\n    auto m = make_map(10000000);\n    std::chrono::high_resolution_clock::time_point end_time = std::chrono::high_resolution_clock::now();\n    auto elapsed = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(end_time-start_time);\n    std::cout &lt;&lt; elapsed.count()/1000000000. &lt;&lt; \"s\\n\";\n    std::cout &lt;&lt; m[10] &lt;&lt; \"\\n\"\n              &lt;&lt; m[9999999] &lt;&lt; \"\\n\";    \n}\n\n% g++ -DNDEBUG -std=c++17 -Ofast -o perf perf.cpp\n% ./perf\n2.81886s\n20\n1e+07\n</code></pre>\n\n<p>Slightly modified <code>go</code> version:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc make_map(elem float64) map[float64]float64 {\n    m := make(map[float64]float64, int(elem))\n    var i float64 = 0\n    for ; i &lt; elem; i++ {\n        m[i] = i + 10\n    }\n    return m\n}\n\nfunc main() {\n    start_time := time.Now()\n    r := make_map(10000000)\n    end_time := time.Now()\n    fmt.Println(end_time.Sub(start_time))\n    fmt.Println(r[10])\n    fmt.Println(r[9999999])\n}\n\n% go build -a perf.go\n% ./perf\n1.967707381s\n20\n1.0000009e+07\n</code></pre>\n\n<p>It doesn't look like a tie as it did before the update. One thing slowing the cpp version down is the default hashing function for <code>double</code>. When replacing it with a really bad (but fast) hasher, I got the time down to 1.89489s.</p>\n\n<pre><code>struct bad_hasher {\n    size_t operator()(const double&amp; d) const {\n        static_assert(sizeof(double)==sizeof(size_t));\n\n        return\n            *reinterpret_cast&lt;const size_t*&gt;( reinterpret_cast&lt;const std::byte*&gt;(&amp;d) );\n    }\n};\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1550013240, "post_id": 54658408, "comment_id": 96111629, "body": "I wish someone would come and get some major optimization for the CPP code.. I&#39;m really curious honestly..."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1550044742, "post_id": 54658408, "comment_id": 96120662, "body": "I updated my measurement to try to measure the same things and at the same places in both go and cpp."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1550011228, "last_edit_date": 1550011228, "creation_date": 1550004116, "answer_id": 54658408, "question_id": 54657046, "link": "https://stackoverflow.com/questions/54657046/map-performance-comparison-between-go-and-c/54658408#54658408", "title": "map performance comparison between go and c++", "body": "<p><strong>Meaningless microbenchmarks produce meaningless results.</strong></p>\n\n<hr>\n\n<p>Continuing <a href=\"https://stackoverflow.com/q/54657046/221700\">@mrclx</a>'s and <a href=\"https://stackoverflow.com/a/54657852/221700\">@TedLyngmo</a>'s microbenchmark thread, fix the bug in @TedLyngmo's Go microbenchmark:</p>\n\n<p><code>perf.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc makeMap(elem float64) time.Duration {\n    x := time.Now()\n    o := make(map[float64]float64, int(elem))\n    var i float64 = 0\n    for ; i &lt; elem; i++ {\n        o[i] = i + 10\n    }\n    t := time.Now()\n    return t.Sub(x)\n}\n\nfunc main() {\n    r := makeMap(10000000)\n    fmt.Println(r)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +11af353531 Tue Feb 12 14:48:26 2019 +0000 linux/amd64\n$ go build -a perf.go\n$ ./perf\n1.649880112s\n$ \n</code></pre>\n\n<p><code>perf.cpp</code>:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;unordered_map&gt;\n#include &lt;chrono&gt;\n\nvoid make_map(double times) {\n    std::unordered_map&lt;double, double&gt; hm;\n    hm.reserve(static_cast&lt;size_t&gt;(times)); // &lt;- good stuff\n\n    for (double c = 0; c &lt; times; ++c) {\n        hm[c] = c + 10.0;\n    }\n}\n\nint main() {\n    std::chrono::high_resolution_clock::time_point start_time = std::chrono::high_resolution_clock::now();\n    make_map(10000000);\n    std::chrono::high_resolution_clock::time_point end_time = std::chrono::high_resolution_clock::now();\n    auto elapsed = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(end_time-start_time);\n    std::cout &lt;&lt; elapsed.count()/1000000000. &lt;&lt; \"s\\n\";\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ g++ --version\ng++ (Ubuntu 8.2.0-7ubuntu1) 8.2.0\n$ g++ -DNDEBUG -std=c++17 -Ofast -o perf perf.cpp\n$ ./perf\n3.09203s\n$ \n</code></pre>\n\n<hr>\n\n<p><strong>Go leads!</strong></p>\n"}], "owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 1, "closed_date": 1550005065, "accepted_answer_id": 54657852, "answer_count": 3, "score": -3, "last_activity_date": 1550049211, "creation_date": 1549998328, "last_edit_date": 1550049211, "question_id": 54657046, "link": "https://stackoverflow.com/questions/54657046/map-performance-comparison-between-go-and-c", "closed_reason": "Needs details or clarity", "title": "map performance comparison between go and c++", "body": "<p>I don't understand how golang is outperforming c++ in this operation by 10 times, even the map lookup is 3 times faster in go than c++.</p>\n\n<p>this is the c++ snippet</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;unordered_map&gt;\n#include &lt;chrono&gt;\n\nstd::chrono::nanoseconds elapsed(std::chrono::steady_clock::time_point start) {\n    std::chrono::steady_clock::time_point now = std::chrono::high_resolution_clock::now();\n    return std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(now - start);\n}\nvoid make_map(int times) {\n    std::unordered_map&lt;double, double&gt; hm;\n    double c = 0.0;\n    for (int i = 0; i &lt; times; i++) {\n        hm[c] = c + 10.0;\n        c += 1.0;\n    }\n}\n\nint main() {\n    std::chrono::steady_clock::time_point start_time = std::chrono::high_resolution_clock::now();\n    make_map(10000000);\n    printf(\"elapsed %lld\", elapsed(start_time).count());\n}\n</code></pre>\n\n<p>this is the golang snippet:</p>\n\n<pre><code>func makeMap() {\n    o := make(map[float64]float64)\n    var i float64 = 0\n    x := time.Now()\n    for ; i &lt;= 10000000; i++ {\n        o[i] = i+ 10\n    }\n    TimeTrack(x)\n}\nfunc TimeTrack(start time.Time) {\n    elapsed := time.Since(start)\n\n    // Skip this function, and fetch the PC and file for its parent.\n    pc, _, _, _ := runtime.Caller(1)\n\n    // Retrieve a function object this functions parent.\n    funcObj := runtime.FuncForPC(pc)\n\n    // Regex to extract just the function name (and not the module path).\n    runtimeFunc := regexp.MustCompile(`^.*\\.(.*)$`)\n    name := runtimeFunc.ReplaceAllString(funcObj.Name(), \"$1\")\n\n    log.Println(fmt.Sprintf(\"%s took %s\", name, elapsed))\n}\n</code></pre>\n\n<p>What I'd like to know is how to optimize the c++ to achieve better performance.</p>\n"}, {"tags": ["go", "polymorphism"], "comments": [{"owner": {"reputation": 25, "user_id": 8780608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51fae91caee09f68efef0fbb81be6af0?s=128&d=identicon&r=PG&f=1", "display_name": "Vitaliy Samofal", "link": "https://stackoverflow.com/users/8780608/vitaliy-samofal"}, "edited": false, "score": 1, "creation_date": 1549998855, "post_id": 54656970, "comment_id": 96105631, "body": "When I want to return a pointer to interface, I mean that this must be a pointer because I will return a struct that implemented this interface, and I don&#39;t want to copy this struct, I want to return already built object."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1550000746, "post_id": 54656970, "comment_id": 96106569, "body": "In Go you almost never need to use pointers to interfaces, certainly not from a constructor function that doesn&#39;t need to retain the pointer for later use. Just change your code to the second version, the one returning <code>Foo</code>, that&#39;s the right way to do it."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 8780608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51fae91caee09f68efef0fbb81be6af0?s=128&d=identicon&r=PG&f=1", "display_name": "Vitaliy Samofal", "link": "https://stackoverflow.com/users/8780608/vitaliy-samofal"}, "edited": false, "score": 0, "creation_date": 1550006674, "post_id": 54657620, "comment_id": 96109299, "body": "Yeah, I see, it&#39;s just a bit weird in terms of language syntax, my code looks valid, but compiler just argue ..."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 3, "last_activity_date": 1550000772, "creation_date": 1550000772, "answer_id": 54657620, "question_id": 54656970, "link": "https://stackoverflow.com/questions/54656970/go-factory-method-polymorphism-with-pointers/54657620#54657620", "title": "Go factory method polymorphism with pointers", "body": "<p>You just need to change the function signature to</p>\n\n<pre><code>func NewBarFoo() Foo {\n    return &amp;BarFoo{}\n}\n</code></pre>\n\n<p>You are still returning a pointer, it just so happens that the pointer implements the interface</p>\n"}], "owner": {"reputation": 25, "user_id": 8780608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51fae91caee09f68efef0fbb81be6af0?s=128&d=identicon&r=PG&f=1", "display_name": "Vitaliy Samofal", "link": "https://stackoverflow.com/users/8780608/vitaliy-samofal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1550000772, "creation_date": 1549998023, "question_id": 54656970, "link": "https://stackoverflow.com/questions/54656970/go-factory-method-polymorphism-with-pointers", "title": "Go factory method polymorphism with pointers", "body": "<pre><code>type Foo interface {\n    FooMethod()\n}\ntype BarFoo struct {\n}\nfunc (f *BarFoo) FooMethod() {\n}\nfunc NewBarFoo() *Foo {\n    return &amp;BarFoo{}\n}\n</code></pre>\n\n<p><strong>Error</strong>:\nCannot use '&amp;BarFoo{}' (type *BarFoo) as type *Foo</p>\n\n<p>Why I get compilation error for such code? Does polymorphism work for pointers? </p>\n\n<p>BTW, this code is fine </p>\n\n<pre><code>func NewBarFoo() Foo {\n    return &amp;BarFoo{}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2656, "user_id": 1186243, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ZeMe1.jpg?s=128&g=1", "display_name": "sbarow", "link": "https://stackoverflow.com/users/1186243/sbarow"}, "edited": false, "score": 0, "creation_date": 1549997437, "post_id": 54656762, "comment_id": 96104938, "body": "There are no line numbers above ;-) Better to state they are uncommented already."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 3, "last_activity_date": 1549997625, "creation_date": 1549997625, "answer_id": 54656859, "question_id": 54656762, "link": "https://stackoverflow.com/questions/54656762/go-channels-and-delays/54656859#54656859", "title": "Go Channels and delays", "body": "<p>Your main thread is waiting on <code>done</code>, then exiting. Meanwhile your first go function pipes 5 values into <code>ch</code>, then sends to <code>done</code>.</p>\n\n<p>The value in <code>done</code> then gets read from the main thread and <em>happens</em> to occur before the second go function reads the last value from <code>ch</code>. When it does so, it exits the program.</p>\n\n<p>Note that if your second thread <em>did</em> happen to both read from <code>ch</code> and <code>done</code>, then your program would deadlock since the main thread would never receive on <code>done</code> and all running go threads would be blocked waiting to receive on channels.</p>\n"}, {"tags": [], "owner": {"reputation": 3386, "user_id": 4158603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/6A1qm.png?s=128&g=1", "display_name": "areller", "link": "https://stackoverflow.com/users/4158603/areller"}, "is_accepted": false, "score": 2, "last_activity_date": 1549997728, "creation_date": 1549997728, "answer_id": 54656893, "question_id": 54656762, "link": "https://stackoverflow.com/questions/54656762/go-channels-and-delays/54656893#54656893", "title": "Go Channels and delays", "body": "<p>You have two <code>go</code> routines running in parallel. One inserts 5 numbers into the channel and then signals the main thread to exit, and another one reads the numbers from the channel.</p>\n\n<p>Note that once the go routine that is responsible for enqueuing the numbers into the channel finishes, it signals the main thread to exit, regardless of whether the go routine that reads the numbers finished or not. So you could end up with a case where the enqueueing go routine finished before the dequeuing finished, and the main thread exited.</p>\n\n<p>By adding the sleep, you make the enqueueing go routine live a bit longer and give a chance to the dequeueing go routine to read and print all the numbers before the enqueueing go routine signals the main thread to exit.</p>\n\n<p>To solve that, you could just run the dequeuing code in the main thread. No need to run it in a go routine in this case.</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1549997759, "creation_date": 1549997759, "answer_id": 54656899, "question_id": 54656762, "link": "https://stackoverflow.com/questions/54656762/go-channels-and-delays/54656899#54656899", "title": "Go Channels and delays", "body": "<p>You're not waiting for both goroutines, and only sending a single value over <code>done</code> to 2 receivers, which will deadlock if the second receiver happens to be <code>main</code>.</p>\n\n<p>Using a <code>WaitGroup</code> simplifies the code, and allows you to easily wait for as many goroutines as needed. <a href=\"https://play.golang.org/p/MWknv_9AFKp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MWknv_9AFKp</a></p>\n\n<pre><code>ch := make(chan int)\nvar wg sync.WaitGroup\n\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    defer close(ch)\n    for i := 0; i &lt; 5; i++ {\n        ch &lt;- i\n    }\n}()\n\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    for message := range ch {\n        fmt.Println(message)\n    }\n\n}()\n\nwg.Wait()\nfmt.Println(\"Exit\")\n</code></pre>\n"}], "owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 54656899, "answer_count": 3, "score": -1, "last_activity_date": 1549997759, "creation_date": 1549997265, "last_edit_date": 1549997577, "question_id": 54656762, "link": "https://stackoverflow.com/questions/54656762/go-channels-and-delays", "title": "Go Channels and delays", "body": "<p>I was just experimenting with Go channels on my Ubuntu 64 bit environment and got confused with the output the following program produced.</p>\n\n<p>I got the output:\n0\n1\n2\n3\nExit</p>\n\n<p>The output when I uncommented the two commented lines:\n0\n1\n2\n3\n4\nExit</p>\n\n<p>Please explain the behavior.\nTIA.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n    //\"time\"\n)\n\nfunc main() {\n    ch := make(chan int)\n    done := make(chan bool)\n    go func() {\n        for i := 0; i &lt; 5; i++ {\n            ch &lt;- i\n        }\n                //time.Sleep(1 * time.Second)\n        done &lt;- false\n    }()\n    go func() {\n        for {\n            select {\n            case message := &lt;-ch:\n                fmt.Println(message)\n            case &lt;-done:\n                return\n            }\n        }\n    }()\n    &lt;-done\n    fmt.Println(\"Exit\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1549994188, "post_id": 54655672, "comment_id": 96103538, "body": "Have you gone through the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1549994293, "post_id": 54655672, "comment_id": 96103573, "body": "You don&#39;t call variables at all."}], "answers": [{"comments": [{"owner": {"reputation": 701, "user_id": 1927177, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/kFCrf.jpg?s=128&g=1", "display_name": "Henri", "link": "https://stackoverflow.com/users/1927177/henri"}, "edited": false, "score": 0, "creation_date": 1549993766, "post_id": 54655783, "comment_id": 96103354, "body": "Thanks. The reason I am asking this question is because I want to define variables from an API in a function and pass those variables to other functions. You answered my question."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1549993266, "creation_date": 1549993266, "answer_id": 54655783, "question_id": 54655672, "link": "https://stackoverflow.com/questions/54655672/calling-a-variable-from-another-function-in-go/54655783#54655783", "title": "Calling a variable from another function in go", "body": "<p>It's not possible to print the value of the <code>A</code> variable declared in the <code>Smile()</code> function from <code>main()</code>.</p>\n\n<p>And the main reason for that is that the variable <code>A</code> only exists if code execution enters the <code>Smile()</code> function, more precisely reaches the <code>A</code> variable declaration. In your example this never happens.</p>\n\n<p>And even if in some other example this happens (e.g. <code>Smile()</code> is called), an application may have multiple goroutines, and multiple of them may be executing <code>Smile()</code> at the same time, resulting in the app having multiple <code>A</code> variables, independent from each other. In this situation, <em>which</em> would <code>A</code> in <code>main()</code> refer to?</p>\n\n<p><a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Go is lexically scoped using blocks.</a> This means the variable <code>A</code> declared inside <code>Smile()</code> is only accessible from <code>Smile()</code>, the <code>main()</code> function cannot refer to it. If you need such \"sharing\", you must define <code>A</code> outside of <code>Smile()</code>. If both <code>Smile()</code> and <code>main()</code> needs to access it, you have to make it either a global variable, or you have to pass it to the functions that need it.</p>\n\n<p>Making it a global variable, this is how it could look like:</p>\n\n<pre><code>var a int\n\nfunc smile() {\n    a = 5\n    fmt.Println(\"a in smile():\", a)\n}\n\nfunc main() {\n    smile()\n    fmt.Println(\"a in main():\", a)\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/4MhN-Z3ersh\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a in smile(): 5\na in main(): 5\n</code></pre>\n\n<p>Declaring it local in <code>main()</code> and passing it to <code>smile()</code>, this is how it could look like:</p>\n\n<pre><code>func smile(a int) {\n    fmt.Println(\"a in smile():\", a)\n}\n\nfunc main() {\n    a := 5\n    fmt.Println(\"a in main():\", a)\n    smile(a)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ZXbwbKVDXRJ\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a in main(): 5\na in smile(): 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 713, "user_id": 12162813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-22W2wmyNnEQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfCiW9MIj-T5ov3H31eHm8dOqD1pg/photo.jpg?sz=128", "display_name": "Thushara Buddhika", "link": "https://stackoverflow.com/users/12162813/thushara-buddhika"}, "is_accepted": false, "score": 1, "last_activity_date": 1571648989, "creation_date": 1571648989, "answer_id": 58483105, "question_id": 54655672, "link": "https://stackoverflow.com/questions/54655672/calling-a-variable-from-another-function-in-go/58483105#58483105", "title": "Calling a variable from another function in go", "body": "<p>The best way is, <a href=\"https://godoc.org/golang.org/x/tools/go/pointer\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tools/go/pointer</a></p>\n\n<blockquote>\n  <p>Pointers</p>\n</blockquote>\n\n<p>Ex:</p>\n\n<pre><code>func getData() {\n   primaryData := Primary.PrimaryData{}\n   getAirTemperatureData(&amp;primaryData)\n   // value will be available here\n}\n\nfunc getPrimaryData(primaryData *Primary.PrimaryData) {\n   primaryData.DataOne = \"Value\"\n}\n</code></pre>\n"}], "owner": {"reputation": 701, "user_id": 1927177, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/kFCrf.jpg?s=128&g=1", "display_name": "Henri", "link": "https://stackoverflow.com/users/1927177/henri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3199, "favorite_count": 0, "accepted_answer_id": 54655783, "answer_count": 2, "score": -4, "last_activity_date": 1571648989, "creation_date": 1549992865, "question_id": 54655672, "link": "https://stackoverflow.com/questions/54655672/calling-a-variable-from-another-function-in-go", "title": "Calling a variable from another function in go", "body": "<p>I know that variables are pass by value in go. However, I want to call a variable that in inside a func outside this function. Let me give you an example:</p>\n\n<pre><code>package main\n\nimport (\n\n    \"fmt\"\n)\n\nfunc Smile(){\n  A := 5\n}\n\nfunc main() {\n\n   fmt.Println(A)\n\n}\n</code></pre>\n\n<p>This gives me undefine A. </p>\n\n<p>what is the best way to pass A ? Should I use a pointer? How do I do that?</p>\n"}, {"tags": ["angular", "typescript", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1549989582, "post_id": 54654746, "comment_id": 96101207, "body": "What happens if you send the same data <a href=\"https://ec.haxx.se/http-multipart.html\" rel=\"nofollow noreferrer\">using <code>curl</code></a>? I mean, you have to figure out what part is at fault: your TS sending code or your Go receiving/processing code."}, {"owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1549995624, "post_id": 54654746, "comment_id": 96104150, "body": "@ThunderCat is there a way to check if the file is being sent along with the content in post body?"}, {"owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550002443, "post_id": 54654746, "comment_id": 96107353, "body": "@ThunderCat I am using FormFile provided by http package which returns the file for the provided key and that function is throwing EOF error. Also, I tried reading the file the way you said, it still doesn&#39;t work. Is there anything else I need to send in POST request?"}, {"owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550004062, "post_id": 54654746, "comment_id": 96108129, "body": "@ThunderCat your piece of code does make a bunch of numbers get printed on the terminal in go and yes FormFile is returning the error. I had guessed so, the error is because of the malformed request body but what is it that I need to add in the request body along with the file? I have specified everything I am sending in the post request above. I am really sorry if it is supposed to be obvious, this is because I am new to Go."}], "owner": {"reputation": 95, "user_id": 10438705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448ef964bc1090e2a49cc8b4fac6ca2f?s=128&d=identicon&r=PG&f=1", "display_name": "Neha", "link": "https://stackoverflow.com/users/10438705/neha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 458, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1549989699, "creation_date": 1549989430, "last_edit_date": 1549989699, "question_id": 54654746, "link": "https://stackoverflow.com/questions/54654746/processing-post-request-with-data-encoded-as-multipart-form-data", "title": "Processing POST request with data encoded as multipart/form-data", "body": "<p>I am using angular and typescript to send my file in a post request body to backend which is in golang, where it parses the file and uploads the data in file in the DB. When I am sending the file from Postman, the file is read and the data is being inserted in the DB successfully, which means my backend code is working just fine. When I am sending it from Typescript, it is giving me EOF error. Please find the code below - </p>\n\n<p>Angular - </p>\n\n<pre><code>&lt;input (change)=\"getFile($event.target.value,$event)\" type=\"file\" id=\"fileUpload\" name=\"fileUpload\" class=\"form-control\"\n            accept=\".csv\" /&gt;\n</code></pre>\n\n<p>TypeScript - </p>\n\n<pre><code>file: File\ngetFile(event_value, event){\n        this.file = event.target.files[0];\n        fileUpload(this.file)\n    }\n\nfileUpload(file: any){     \n    let url = `abc/abc/abc`\n    let header = {'Content-Type':'multipart/form-data; boundary=----abc', 'Authorization': 'authorizationToken'}\n\n    return this.http.post(url, {\"file\": file}, {headers: header})\n    .map((response: Response) =&gt; response.json())\n    .catch(this.handleError)\n  }\n</code></pre>\n\n<p>Error in Go:</p>\n\n<pre><code>{\"data\":{\"error\":\"multipart: NextPart: EOF\",\"code\":102,\"data\":null,\"url\":\"\"},\"level\":\"error\",\"msg\":\"{multipart: NextPart: EOF 102 \\u003cnil\\u003e }\",\"time\":\"2019-02-12T11:33:00-05:00\"}\n</code></pre>\n\n<p>Am I missing something, that needs to be sent in the header?</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go", "google-cloud-sdk"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1549985135, "post_id": 54653330, "comment_id": 96098438, "body": "what prevents you from reading that file in the golang directly ?"}, {"owner": {"reputation": 1703, "user_id": 801247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c78b0a3f8999559564de3cd9769a9bec?s=128&d=identicon&r=PG", "display_name": "user801247", "link": "https://stackoverflow.com/users/801247/user801247"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1549985321, "post_id": 54653330, "comment_id": 96098562, "body": "Nothing prevents me, I&#39;m just using an SDK to not reimplement the logic the provider provides. For example, both the aws cli (python) and the sdk (both python and go) , read AWS_PROFILE , AWS_ACCESS_KEY ..."}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1549985367, "post_id": 54653330, "comment_id": 96098589, "body": "Ach okay, seems legit"}], "answers": [{"tags": [], "owner": {"reputation": 1291, "user_id": 772027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1ae7b5fe133a53f8a5b1dc5640e4b76?s=128&d=identicon&r=PG", "display_name": "jmaitrehenry", "link": "https://stackoverflow.com/users/772027/jmaitrehenry"}, "is_accepted": false, "score": 1, "last_activity_date": 1549986342, "last_edit_date": 1592644375, "creation_date": 1549986342, "answer_id": 54653816, "question_id": 54653330, "link": "https://stackoverflow.com/questions/54653330/get-default-zone-region/54653816#54653816", "title": "Get default zone / region", "body": "<blockquote>\n<p>To sum up the question , how can I use the same config mechanism the gcloud cli uses with the Go sdk ?</p>\n</blockquote>\n<p>As far as I know, you can't. You need to specify the zone to all your operations.\nLong time ago, someone asked about <code>CLOUDSDK_CONFIG</code> and the last response is cristal clear:</p>\n<blockquote>\n<p>\u00a0Resolved: we decided not to honor CLOUDSDK_CONFIG, in the interest of maintaining simplicity for the ADC spec.</p>\n<p><a href=\"https://github.com/googleapis/google-cloud-go/issues/288\" rel=\"nofollow noreferrer\">https://github.com/googleapis/google-cloud-go/issues/288</a></p>\n</blockquote>\n<p>And I think it's true for all the <code>CLOUDSDK_*</code> env.</p>\n"}], "owner": {"reputation": 1703, "user_id": 801247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c78b0a3f8999559564de3cd9769a9bec?s=128&d=identicon&r=PG", "display_name": "user801247", "link": "https://stackoverflow.com/users/801247/user801247"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549986342, "creation_date": 1549984798, "question_id": 54653330, "link": "https://stackoverflow.com/questions/54653330/get-default-zone-region", "title": "Get default zone / region", "body": "<p>I'm using the Golang google-cloud-sdk to get informations on resources (specifically here compute instances, but it doesn't really matter).</p>\n\n<p>The <code>gcloud</code> cli allows to do something like this:</p>\n\n<pre><code>gcloud config set compute/zone ZONE\n</code></pre>\n\n<p>Which under the hood will write in <code>~/.config/gcloud/configurations/config_default</code> those value as something that looks like an ini file.</p>\n\n<p>Can the (go) sdk read config those config file ?</p>\n\n<p>The cli also read the environment variable <code>CLOUDSDK_COMPUTE_ZONE</code> if not defined in the config file.</p>\n\n<p>Can the sdk also read this variables ? </p>\n\n<p>To sum up the question , how can I use the same config mechanism the gcloud cli uses with the Go sdk ?</p>\n"}, {"tags": ["pointers", "go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 414, "user_id": 3371250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f11de743fa7ae72be84540d51e9f571?s=128&d=identicon&r=PG&f=1", "display_name": "Ipsider", "link": "https://stackoverflow.com/users/3371250/ipsider"}, "edited": false, "score": 0, "creation_date": 1550060732, "post_id": 54653380, "comment_id": 96130125, "body": "Of course. Somehow i was under the impression that I got a pointer to the struct. Thanks"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1549984923, "creation_date": 1549984923, "answer_id": 54653380, "question_id": 54653237, "link": "https://stackoverflow.com/questions/54653237/how-to-get-variable-name-of-string-pointer-by-using-reflection/54653380#54653380", "title": "How to get variable name of string pointer by using reflection?", "body": "<p>You cannot do this.</p>\n\n<p>When you write <code>f.s</code> all you have is a pointer to string. The information that some fields in some struct happens to have this as a value is completely lost/unavailable.</p>\n\n<p>I'm not going to recommend package unsafe here: You must redesign.</p>\n"}], "owner": {"reputation": 414, "user_id": 3371250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f11de743fa7ae72be84540d51e9f571?s=128&d=identicon&r=PG&f=1", "display_name": "Ipsider", "link": "https://stackoverflow.com/users/3371250/ipsider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 1, "accepted_answer_id": 54653380, "answer_count": 1, "score": -3, "last_activity_date": 1549984923, "creation_date": 1549984545, "question_id": 54653237, "link": "https://stackoverflow.com/questions/54653237/how-to-get-variable-name-of-string-pointer-by-using-reflection", "title": "How to get variable name of string pointer by using reflection?", "body": "<p>I want to get the name of a field name by using reflection. I pass the string as a pointer and then I want to retrieve the variable name in the function.</p>\n\n<pre><code>type FooBar struct {\n    foo *string\n}\n\nfunc bar(s *string) {\n\n    var name string\n\n    // TODO: Get name of the field that s is pointing to!\n\n    fmt.Println(\"Expected string is foo: \" + name)\n}\n\nfunc main() {\n    f := Foo{\"bar\"}\n    bar(f.s)\n}\n</code></pre>\n\n<p>I tried getting the value of s with</p>\n\n<pre><code>val := reflect.ValueOf(s)\n</code></pre>\n\n<p>and then I am out of my depth to get the variable name.</p>\n\n<p>I should mention that there are multiple fields in my struct and I don't know in advance which field is in question.</p>\n\n<p>Any help is appreciated. Thanks</p>\n"}, {"tags": ["database", "go", "sqlite"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "edited": false, "score": 0, "creation_date": 1549983978, "post_id": 54653006, "comment_id": 96097622, "body": "Is <code>sid</code> just a plain integer or do you use <a href=\"https://sqlite.org/autoinc.html\" rel=\"nofollow noreferrer\"><code>AUTOINCREMENT</code></a>?"}, {"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "edited": false, "score": 0, "creation_date": 1549984063, "post_id": 54653006, "comment_id": 96097671, "body": "only integer number and i want it will be incorrect per new user registered"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "edited": false, "score": 0, "creation_date": 1549984146, "post_id": 54653006, "comment_id": 96097726, "body": "Is it the primary key of the table? Is there any constraint on in? If no, you can enter anything you want, even though this is stupid. Use the features provided by SQLite to generate IDs."}, {"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "edited": false, "score": 0, "creation_date": 1549984349, "post_id": 54653006, "comment_id": 96097862, "body": "Yes this is primary key, but how it increment that number. in my older method find last sid number from database and increment + 1 but when many users request cause database error and say this sid already taken."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "edited": false, "score": 0, "creation_date": 1549984391, "post_id": 54653006, "comment_id": 96097891, "body": "Please <a href=\"https://stackoverflow.com/posts/54653006/edit\">edit</a> your question and show us the relevant but complete definition of the table."}, {"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "edited": false, "score": 0, "creation_date": 1549984596, "post_id": 54653006, "comment_id": 96098035, "body": "Edited you can now again check sir"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549988171, "post_id": 54653006, "comment_id": 96100338, "body": "Use an auto increment id. This has nothing to do with Go."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1549991861, "post_id": 54653006, "comment_id": 96102481, "body": "You should read <a href=\"https://www.sqlite.org/autoinc.html\" rel=\"nofollow noreferrer\">sqlite.org/autoinc.html</a> before using <code>AUTOINCREMENT</code> and make an informed decision about if you really need what it actually does, btw."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "edited": false, "score": 1, "creation_date": 1549985169, "post_id": 54653300, "comment_id": 96098461, "body": "Thank you so much sir, this fix my problem. I accept"}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1549991532, "post_id": 54653300, "comment_id": 96102315, "body": "Not quite. An <code>INTEGER PRIMARY KEY</code>/rowid column will always have a new number assigned if one is not given on insert. The misleadingly named <code>AUTOINCREMENT</code> just changes how that number is determined (and comes with a big warning about how you probably don&#39;t want to use it). See <a href=\"https://www.sqlite.org/autoinc.html\" rel=\"nofollow noreferrer\">sqlite.org/autoinc.html</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1550044374, "post_id": 54653300, "comment_id": 96120490, "body": "@Shawn Good advice, I&#39;ve changed my answer."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "is_accepted": true, "score": 4, "last_activity_date": 1550044358, "last_edit_date": 1550044358, "creation_date": 1549984714, "answer_id": 54653300, "question_id": 54653006, "link": "https://stackoverflow.com/questions/54653006/can-i-increase-number-value-for-each-new-user-in-sqlite3-database-use-golang/54653300#54653300", "title": "Can I increase number value for each new user in sqlite3 database use golang?", "body": "<p>Don't let the server code generate the ID. Let the DB do this job. SQLite has the <a href=\"https://sqlite.org/autoinc.html\" rel=\"nofollow noreferrer\"><code>AUTOINCREMENT</code></a> keyword for this task.</p>\n\n<p><strong>Edit:</strong> But as the SQLite documentation cleary tells use, the use of <code>INTEGER PRIMARY KEY</code> is recommended over <code>AUTOINCREMENT</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 54653300, "answer_count": 1, "score": -1, "last_activity_date": 1550044358, "creation_date": 1549983773, "last_edit_date": 1549984574, "question_id": 54653006, "link": "https://stackoverflow.com/questions/54653006/can-i-increase-number-value-for-each-new-user-in-sqlite3-database-use-golang", "title": "Can I increase number value for each new user in sqlite3 database use golang?", "body": "<p>I ask is possible to increase id number per new user in sqlite3 database using golang and xorm without cause async problem?</p>\n\n<ul>\n<li>I will use golang for http server. So may many user in same time http request and register</li>\n</ul>\n\n<p>For example this is my database</p>\n\n<pre><code>sid int\nusername string\npassword string\n</code></pre>\n\n<p>Now the question is for example I have 5 user before that and last user sid is 5, so it is possible to increase sid number for user 6 without cause problem?</p>\n\n<p>The main problem is this; In my method when new request received by server for register. Server check last sid from sqlite3 database. For example if last sid is 5 server increase this number with + 1 so our sid get 6 but when try save new user to sid 6 when server is busy and in same time another guy want register cause error to sid 6 already taken. I know this is not professional method and now try find solotion.</p>\n"}, {"tags": ["xml", "go", "xml-parsing"], "answers": [{"tags": [], "owner": {"reputation": 8276, "user_id": 2058552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rymLy.jpg?s=128&g=1", "display_name": "Mukesh Sharma", "link": "https://stackoverflow.com/users/2058552/mukesh-sharma"}, "is_accepted": true, "score": 0, "last_activity_date": 1550058231, "last_edit_date": 1550058231, "creation_date": 1549985008, "answer_id": 54653411, "question_id": 54652520, "link": "https://stackoverflow.com/questions/54652520/how-do-i-unmarshal-nested-xml-elements-into-an-array-of-strings/54653411#54653411", "title": "How do I unmarshal nested XML elements into an array of strings?", "body": "<p>You can use the following struct schema to parse the given XML.</p>\n\n<pre><code>type Results struct {\n    Meta   Meta   `xml:\"meta\"`\n    Result Result `xml:\"result\"`\n}\n\ntype Meta struct {\n    FieldOrder FieldOrder `xml:\"fieldOrder\"`\n}\n\ntype FieldOrder struct {\n    Fields []string `xml:\"field\"`\n}\n\ntype Result struct {\n    Fields []Field `xml:\"field\"`\n}\n\ntype Field struct {\n    K      string   `xml:\"k,attr\"`\n    Values []string `xml:\"value&gt;text\"`\n}\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/H6EHl_1dPLg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/H6EHl_1dPLg</a></p>\n"}], "owner": {"reputation": 23, "user_id": 9731648, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HzZx3sxp6n4/AAAAAAAAAAI/AAAAAAAAAH0/bn5BoAdyG4k/photo.jpg?sz=128", "display_name": "Kyrylo Skobylko", "link": "https://stackoverflow.com/users/9731648/kyrylo-skobylko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 54653411, "answer_count": 1, "score": -1, "last_activity_date": 1550058231, "creation_date": 1549982332, "last_edit_date": 1549985064, "question_id": 54652520, "link": "https://stackoverflow.com/questions/54652520/how-do-i-unmarshal-nested-xml-elements-into-an-array-of-strings", "title": "How do I unmarshal nested XML elements into an array of strings?", "body": "<p>My XML contains an array of predefined elements, but I can't pick up the array. Here is the XML structure:</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n&lt;results preview='0'&gt;\n    &lt;meta&gt;\n       &lt;fieldOrder&gt;\n          &lt;field&gt;values(metric_name)&lt;/field&gt;\n       &lt;/fieldOrder&gt;\n    &lt;/meta&gt;\n    &lt;result offset='0'&gt;\n        &lt;field k='values(metric_name)'&gt;\n            &lt;value&gt;&lt;text&gt;process.cpu.avg&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.cpu.last&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.cpu.max&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.cpu.min&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.disk.avg&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.disk.last&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.disk.max&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.disk.min&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.ram.avg&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.ram.last&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.ram.max&lt;/text&gt;&lt;/value&gt;\n            &lt;value&gt;&lt;text&gt;process.ram.min&lt;/text&gt;&lt;/value&gt;\n        &lt;/field&gt;\n    &lt;/result&gt;\n&lt;/results&gt;\n</code></pre>\n\n<p>I tried to make a struct that looks like:</p>\n\n<pre><code>type Metrics struct {\n    Value []string `xml:\"&gt;text\"`\n}\n</code></pre>\n\n<p>But it gives me empty array at output.</p>\n"}, {"tags": ["go", "raspberry-pi3", "sensors", "i2c"], "answers": [{"tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 1, "last_activity_date": 1550846589, "creation_date": 1550846589, "answer_id": 54829526, "question_id": 54652302, "link": "https://stackoverflow.com/questions/54652302/am2320-sensor-crcs-doesnt-match-crc-from-sensor0/54829526#54829526", "title": "AM2320 Sensor: CRCs doesn&#39;t match, CRC from sensor(0)", "body": "<p>Seems there was an issue with the library itself which was making two reads, but because the read code was not sent the values came as 0, as it can be seen in the logs:</p>\n\n<pre><code>2019-02-12T10:29:19.692 [     i2c] DEBUG  Write 3 hex bytes: [030004]\n2019-02-12T10:29:19.697 [     i2c] DEBUG  Read 8 hex bytes: [0304012500d92045] (first read that was ignored)\n2019-02-12T10:29:19.698 [     i2c] DEBUG  Read 8 hex bytes: [0000000000000000] (second one that came a 0)\nCRCs doesn't match: CRC from sensor(0) != calculated CRC(6912)\n</code></pre>\n\n<p>Made a PR to fix the issue: <a href=\"https://github.com/d2r2/go-aosong/pull/3\" rel=\"nofollow noreferrer\">https://github.com/d2r2/go-aosong/pull/3</a></p>\n"}], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "accepted_answer_id": 54829526, "answer_count": 1, "score": 2, "last_activity_date": 1550846589, "creation_date": 1549981676, "last_edit_date": 1549982673, "question_id": 54652302, "link": "https://stackoverflow.com/questions/54652302/am2320-sensor-crcs-doesnt-match-crc-from-sensor0", "title": "AM2320 Sensor: CRCs doesn&#39;t match, CRC from sensor(0)", "body": "<p>Note: Code is cross-compiled in windows 10.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n\n    aosong \"github.com/d2r2/go-aosong\"\n    i2c \"github.com/d2r2/go-i2c\"\n)\n\nconst i2CAddress = 0x5c\nconst i2CBus = 1\n\n// Server struct\ntype Server struct {\n    Sensor *aosong.Sensor\n    I2C    *i2c.I2C\n}\nfunc main() {\n        var err error\n    s := Server{Sensor: aosong.NewSensor(aosong.AM2320)}\n    s.I2C, err = i2c.NewI2C(i2CAddress, i2CBus)\n    if err != nil {\n        log.Printf(err.Error())\n    }\n    fmt.Println(s.Sensor.ReadRelativeHumidityAndTemperature(s.I2C))\n    defer s.I2C.Close()\n}\n</code></pre>\n\n<p>Debug info:</p>\n\n<pre><code>2019-02-12T10:29:19.692 [     i2c] DEBUG  Write 3 hex bytes: [030004]\n2019-02-12T10:29:19.697 [     i2c] DEBUG  Read 8 hex bytes: [0304012500d92045]\n2019-02-12T10:29:19.698 [     i2c] DEBUG  Read 8 hex bytes: [0000000000000000]\nCRCs doesn't match: CRC from sensor(0) != calculated CRC(6912)\n</code></pre>\n\n<p>Any ideea why the CRC from sensor is 0?</p>\n\n<p>I am able to read the sensor on the same bus with the same address with a python script.</p>\n\n<pre><code>#!/usr/bin/python\nimport posix\nfrom fcntl import ioctl\nimport time\nclass AM2320:\n        I2C_ADDR = 0x5c\n        I2C_SLAVE = 0x0703\n        def __init__(self, i2cbus = 1):\n                self._i2cbus = i2cbus\n        @staticmethod\n        def _calc_crc16(data):\n                crc = 0xFFFF\n                for x in data:\n                        crc = crc ^ x\n                        for bit in range(0, 8):\n                                if (crc &amp; 0x0001) == 0x0001:\n                                        crc &gt;&gt;= 1\n                                        crc ^= 0xA001\n                                else:\n                                        crc &gt;&gt;= 1\n                return crc\n        @staticmethod\n        def _combine_bytes(msb, lsb):\n                return msb &lt;&lt; 8 | lsb\n        def readSensor(self):\n                fd = posix.open(\"/dev/i2c-%d\" % self._i2cbus, posix.O_RDWR)\n                ioctl(fd, self.I2C_SLAVE, self.I2C_ADDR)\n# wake AM2320 up, goes to sleep to not warm up and affect the humidity sensor\n# This write will fail as AM2320 won't ACK this write\n                try:\n                        posix.write(fd, b'\\0x00')\n                except:\n                        pass\n                time.sleep(0.001) #Wait at least 0.8ms, at most 3ms\n# write at addr 0x03, start reg = 0x00, num regs = 0x04 */\n                posix.write(fd, b'\\x03\\x00\\x04')\n                time.sleep(0.0016) #Wait at least 1.5ms for result\n# Read out 8 bytes of result data\n# Byte 0: Should be Modbus function code 0x03\n# Byte 1: Should be number of registers to read (0x04)\n# Byte 2: Humidity msb\n# Byte 3: Humidity lsb\n# Byte 4: Temperature msb\n# Byte 5: Temperature lsb\n# Byte 6: CRC lsb byte\n# Byte 7: CRC msb byte\n                data = bytearray(posix.read(fd, 8))\n# Check data[0] and data[1]\n                if data[0] != 0x03 or data[1] != 0x04:\n                        raise Exception(\"First two read bytes are a mismatch\")\n# CRC check\n                if self._calc_crc16(data[0:6]) != self._combine_bytes(data[7], data[6]):\n                        raise Exception(\"CRC failed\")\n# Temperature resolution is 16Bit,\n# temperature highest bit (Bit15) is equal to 1 indicates a\n# negative temperature, the temperature highest bit (Bit15)\n# is equal to 0 indicates a positive temperature;\n# temperature in addition to the most significant bit (Bit14 ~ Bit0)\n# indicates the temperature sensor string value.\n# Temperature sensor value is a string of 10 times the\n# actual temperature value.\n                temp = self._combine_bytes(data[4], data[5])\n                if temp &amp; 0x8000:\n                        temp = -(temp &amp; 0x7FFF)\n                        temp /= 10.0\n                humi = self._combine_bytes(data[2], data[3]) / 10.0\n                return (temp, humi)\n\nam2320 = AM2320(1)\n(t,h) = am2320.readSensor()\nprint t, h\n</code></pre>\n"}, {"tags": ["go", "deadlock", "goroutine", "channels"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1549983533, "post_id": 54652265, "comment_id": 96097292, "body": "If it&#39;s sufficiently unlikely that this happens a lot, put the send to <code>controllerToWorker</code> into its own goroutine. If it happens a lot, so that you end up with enough goroutines to be a problem, redesign. Depending on the situation it may also be okay to simply discard some messages instead of blocking (which would be achieved with a default clause in a select statement)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549984681, "post_id": 54652265, "comment_id": 96098101, "body": "This seems like a flawed design to me; your worker doesn&#39;t fully encapsulate its own logic (some of the logic is in the controller), and is receiving different messages from different sources for different reasons at the same time. A worker should be a black box, accepting work and handling it completely before moving on."}, {"owner": {"reputation": 2402, "user_id": 4621142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Pa0B7.jpg?s=128&g=1", "display_name": "Bobface", "link": "https://stackoverflow.com/users/4621142/bobface"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549987037, "post_id": 54652265, "comment_id": 96099639, "body": "@Adrian I extended my question with my a description of my actual use case. How would you handle that situation?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549988957, "post_id": 54652265, "comment_id": 96100837, "body": "If the producer service is external, then it&#39;s not communicating by channel, it&#39;s communicating by websocket, which is a completely different scenario. That said, if the worker needs two-way communication with the controller (which, from your description, seems to be the real worker in this scenario), it shouldn&#39;t be waiting on the producer and the controller equally; it should send its message to the controller and await the response before continuing."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1549981932, "creation_date": 1549981932, "answer_id": 54652398, "question_id": 54652265, "link": "https://stackoverflow.com/questions/54652265/avoiding-deadlocks-in-bidirectional-communication-between-goroutines/54652398#54652398", "title": "Avoiding deadlocks in bidirectional communication between goroutines", "body": "<blockquote>\n  <p>[Is there ]an idiomatic way to avoid deadlocks in bidirectional communication between multiple goroutines?</p>\n</blockquote>\n\n<p>No. Nothing \"idiomatic\" or based on a \"pattern\".</p>\n\n<blockquote>\n  <p>How do you handle such situations in Go?</p>\n</blockquote>\n\n<p>You redesign. Concurrent circular data flow is best avoided.</p>\n"}], "owner": {"reputation": 2402, "user_id": 4621142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Pa0B7.jpg?s=128&g=1", "display_name": "Bobface", "link": "https://stackoverflow.com/users/4621142/bobface"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549986979, "creation_date": 1549981589, "last_edit_date": 1549986979, "question_id": 54652265, "link": "https://stackoverflow.com/questions/54652265/avoiding-deadlocks-in-bidirectional-communication-between-goroutines", "title": "Avoiding deadlocks in bidirectional communication between goroutines", "body": "<p>I am making my first experiences in Go, and so far I really like the goroutine and channels construct. I am wondering if there is an idiomatic way to avoid deadlocks in bidirectional communication between multiple goroutines. Consider the following example. There are three goroutines: <em>producer, worker</em> and <em>controller</em>. </p>\n\n<ul>\n<li><p>The producer produces integers. In reality this could be data coming\nfrom a network connection for example. </p></li>\n<li><p>The worker receives data from the producer and does some operation on\nit. Then, the worker directs the modified data to the controller.</p></li>\n<li><p>The controller sends a command to the worker in some cases. In the\nexample this would happen if the received integer is bigger than 180.</p></li>\n</ul>\n\n<p>The deadlock happens when the controller tries to send a command to the worker, while the worker tries to send an integer to the controller. </p>\n\n<pre><code>producerToWorker := make(chan int)\nworkerToController := make(chan int)\ncontrollerToWorker := make(chan bool) // bool represents a command for this example\n\n// Worker\ngo func() {\n    for {\n        select {\n        case i := &lt;-producerToWorker:\n            // Do some processing and send to controller\n            workerToController &lt;- (2 * i) + 1\n        case &lt;-controllerToWorker:\n            // Would react to the command here\n        }\n    }\n}()\n\n// Controller\ngo func() {\n    for {\n        select {\n        case i := &lt;-workerToController:\n            fmt.Println(i)\n            if i &gt; 180 {\n                // Send a command to the worker\n                controllerToWorker &lt;- true\n            }\n        }\n    }\n}()\n\n// Producer\nfor {\n    producerToWorker &lt;- rand.Intn(100)\n}\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>163\n175\n95\n113\n1\n189 // No deadlock\n23\n125\n179\n57\n149\n23\n91\n191 // No deadlock\n133\n95\n175\n177\n181 // No deadlock\n17\n175\n63\n27\n181 // Deadlock!\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>Buffering the channels would make this deadlock more unlikely, but not solve it logically. I would like to avoid mutexes if possible. How do you handle such situations in Go?</p>\n\n<p><strong>Edit</strong>: To give a more real-world description: I came across this problem when I tried to implement a websocket client. The websocket client (<em>worker</em>) connects to an external service (<em>producer</em>) and receives messages from it (<em>producerToWorker</em>) and passes them to the controller (<em>workerToController</em>) to handle the received messages. The controller needs to react to the received messages, for example send a response or disconnect the client when an invalid message is received (<em>controllerToWorker</em>).</p>\n"}, {"tags": ["go", "scanf"], "answers": [{"tags": [], "owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "is_accepted": true, "score": 0, "last_activity_date": 1549978409, "creation_date": 1549978409, "answer_id": 54651279, "question_id": 54651199, "link": "https://stackoverflow.com/questions/54651199/second-scanf-jump-scan-in-go/54651279#54651279", "title": "Second scanf jump scan in GO", "body": "<p>If you expect to end the read after hitting an enter, you want to add a new line into your format</p>\n\n<pre><code>fmt.printf (\"Report number\")\nfmt.scanf (\"%f\\n\", &amp;num1)\nfmt.printf (\"Report number\")\nfmt.scanf (\"%f\\n\", &amp;num2)\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 10451179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RBTzy.jpg?s=128&g=1", "display_name": "Ivo Jesus", "link": "https://stackoverflow.com/users/10451179/ivo-jesus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "closed_date": 1549979224, "accepted_answer_id": 54651279, "answer_count": 1, "score": 0, "last_activity_date": 1549978409, "creation_date": 1549978135, "question_id": 54651199, "link": "https://stackoverflow.com/questions/54651199/second-scanf-jump-scan-in-go", "closed_reason": "Duplicate", "title": "Second scanf jump scan in GO", "body": "<p>Dears,</p>\n\n<p>I am writing some basic programs that need to receive more than one variable, following the formed</p>\n\n<pre><code>fmt.printf (\"Report number\")\nfmt.scanf (\"%f\", &amp;num1)\nfmt.printf (\"Report number\")\nfmt.scanf (\"%f\", &amp;num2)\n</code></pre>\n\n<p>But the second scanf is always skipped, if I put a third, it is read normally.\nHow do I do it, so that all Scanfs are recognized?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549977857, "post_id": 54650472, "comment_id": 96093428, "body": "&quot;but with 100 runtime errors&quot; -- what errors?  Your question isn&#39;t complete until you explain the problem you&#39;re trying to solve."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549977920, "post_id": 54650472, "comment_id": 96093461, "body": "&quot;So what&#39;s the problem here?&quot; All of it. Concurrency is not Parallelism (worth googling it). Also: the error is pretty self explanatory: You <i>must</i> <i>not</i> write to the same variable from different goroutines."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549978068, "post_id": 54650472, "comment_id": 96093560, "body": "To &quot;speed up&quot; such calculations: Split the problem into disjunct bunches of work which can be done really independently (this is a hard! problem). Then do these subproblems and combine afterwards."}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549979661, "post_id": 54650472, "comment_id": 96094685, "body": "I&#39;m new to Go so plz you maybe too hard on me. My problem is simple, how to use channel inside paralleled for-loop. I use Go because people say it&#39;s faster and more advanced, so beyond my question I &#39;d like to know how to speed things up using paralleled for-loop, sum function seems a good challenge."}], "answers": [{"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549979361, "post_id": 54651112, "comment_id": 96094476, "body": "can I ask <code>sum &lt;- 0</code> this line happens before the go func or after, what&#39;s the point here ?"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549979726, "post_id": 54651112, "comment_id": 96094732, "body": "you gave the solution but could you explain more?"}, {"owner": {"reputation": 608, "user_id": 3793672, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/561bc6fb44996dff1cdc65159b16d4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Egorikas", "link": "https://stackoverflow.com/users/3793672/egorikas"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549980641, "post_id": 54651112, "comment_id": 96095297, "body": "there are two types of channels in go, buffered and non-buffered. So, every goroutine starts with waiting data from the channel <code>sum</code> and we need to put smth there. When non-buffered channel is used, writer waits for reader and reader waits for writer. if there is no writer, all readers wait forever. If you put <code>sum &lt;- 0</code> before function, <code>paralleSum</code> will be frozen, because no one will read the <code>sum</code> channel"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549980863, "post_id": 54651112, "comment_id": 96095444, "body": "I knew but how is it relevant? BTW, I got runtime error for your example, like <code>parallel result: 4950 fatal error: all goroutines are asleep - deadlock!</code>"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549981319, "post_id": 54651112, "comment_id": 96095776, "body": "ah It&#39;s my fault, I tried to use a <code>defer wg.Done()</code> at the beginning of the for loop, after put the wg.Done() at the right position like your example, it runs fine. Can I ask why it must be there ?"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549981920, "post_id": 54651112, "comment_id": 96096180, "body": "thanks so much, can I ask is this go channel feature like the async stuff like Promise and RxJS Observable ?  The go func() before <code>sum &lt;-0</code> is just put into a stack unless sum has an initial value then the program stack executes?"}, {"owner": {"reputation": 608, "user_id": 3793672, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/561bc6fb44996dff1cdc65159b16d4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Egorikas", "link": "https://stackoverflow.com/users/3793672/egorikas"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549982084, "post_id": 54651112, "comment_id": 96096303, "body": "Because of the nature of channels. You wrote the code, that will create the chain of writing to channels. Writings/readings goes one by one. So, after the last routine finishes, we will say to the main routine <code>listen the channel and wait a result</code>. The last summing routine will write a result to <code>sum</code> channel, then <code>parallelSum</code> routine will read it."}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "reply_to_user": {"reputation": 608, "user_id": 3793672, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/561bc6fb44996dff1cdc65159b16d4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Egorikas", "link": "https://stackoverflow.com/users/3793672/egorikas"}, "edited": false, "score": 0, "creation_date": 1549982446, "post_id": 54651112, "comment_id": 96096543, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/188288/discussion-between-tomriddle-1234-and-egorikas\">continue this discussion in chat</a>."}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1549982778, "post_id": 54651112, "comment_id": 96096770, "body": "So, what about <code>wg.Done()</code> before <code>sum &lt;-temp</code>? In the documentation, <code>wg.Done()</code> reduce the conter by 1, what&#39;s the point to put it before <code>sum &lt;-temp</code> in the loop"}], "tags": [], "owner": {"reputation": 608, "user_id": 3793672, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/561bc6fb44996dff1cdc65159b16d4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Egorikas", "link": "https://stackoverflow.com/users/3793672/egorikas"}, "is_accepted": false, "score": 1, "last_activity_date": 1549977869, "creation_date": 1549977869, "answer_id": 54651112, "question_id": 54650472, "link": "https://stackoverflow.com/questions/54650472/how-to-use-channel-inside-paralleled-for-loop/54651112#54651112", "title": "how to use channel inside paralleled for-loop", "body": "<p>I don't like the idea of summing numbers through channels. I'd rather use something classical like <code>sync.Mutex</code> or <code>atomic.AddUint64</code>. But, at least, I made your code working. \nWe aren't able to pass a value from one channel to another (I added <code>temp</code> variable). Also, there is <code>sync.WaitGroup</code> and other stuff. \nBut I still don't like the idea of the code.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"sync\"\n)\n\nfunc main() {\n    pc := make(chan int)\n    go parallelSum(pc)\n    result := &lt;- pc\n    fmt.Println(\"parallel result:\", result)\n}\n\n\nfunc parallelSum (c chan int){\n    sum := make(chan int)\n\n\n    wg := sync.WaitGroup{}\n    wg.Add(100)\n\n    for i :=1 ; i &lt;= 100;i++{\n        go func(i int){\n            temp := &lt;- sum\n            temp += i\n            wg.Done()\n\n            sum &lt;- temp\n        }(i)\n    }\n\n    sum &lt;- 0\n\n    wg.Wait()\n    temp := &lt;- sum\n    c &lt;- temp\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1550020872, "post_id": 54653323, "comment_id": 96113471, "body": "thankx for such clean solution! however this looks a bit tedious, do I have to explicitly distribute the task to cores ? In go routines doc, Go seems able to automatically optimize this ?"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1550021022, "post_id": 54653323, "comment_id": 96113501, "body": "And the <code>select</code> in <code>sumf</code> is a bit confused to me, it&#39;s a new pattern to me, could you explain <code>endc</code> ? why and when <code>case &lt;-endc</code> happen?"}, {"owner": {"reputation": 976, "user_id": 3227836, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R0UHm.png?s=128&g=1", "display_name": "agastalver", "link": "https://stackoverflow.com/users/3227836/agastalver"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 1, "creation_date": 1550045612, "post_id": 54653323, "comment_id": 96121098, "body": "@tomriddle_1234 you could generate more <b>go routines</b> than cores and golang will distribute this as optimal as it can, however physically it is unlikely to get better performance.  Regarding <code>select</code> there is a nice tour offered by golang.org: <a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow noreferrer\">select</a>. In simple words: <code>select</code> blocks until one of the cases are satsified, and then runs. Since <code>sumf</code> is a function that always waits for new data to come, it has to receive a signal to end, this is <code>endc</code>. Tell me if you need any additional explanation."}], "tags": [], "owner": {"reputation": 976, "user_id": 3227836, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R0UHm.png?s=128&g=1", "display_name": "agastalver", "link": "https://stackoverflow.com/users/3227836/agastalver"}, "is_accepted": false, "score": 1, "last_activity_date": 1549984777, "creation_date": 1549984777, "answer_id": 54653323, "question_id": 54650472, "link": "https://stackoverflow.com/questions/54650472/how-to-use-channel-inside-paralleled-for-loop/54653323#54653323", "title": "how to use channel inside paralleled for-loop", "body": "<p>When using go routines (i.e. <code>go foo()</code>), it is preferable to <strong>use communication over memory-sharing</strong>. In this matter, as you mention, channels are the golang way to handle communication.</p>\n\n<p>For your specific application, the paralleled sum similar to OpenMP, it would be preferable to detect the number of CPUs and generate as many routines as wished:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n    numCPU := runtime.NumCPU()\n    sumc := make(chan int, numCPU)\n    valuec := make(chan int)\n    endc := make(chan interface{}, numCPU)\n\n    // generate go routine per cpu\n    for i := 0; i &lt; numCPU; i++ {\n        go sumf(sumc, valuec, endc)\n    }\n\n    // generate values and pass it through the channels\n    for i := 0; i &lt; 100; i++ {\n        valuec &lt;- i\n    }\n\n    // tell go routines to end up when they are done\n    for i := 0; i &lt; numCPU; i++ {\n        endc &lt;- nil\n    }\n\n    // sum results\n    sum := 0\n    for i := 0; i &lt; numCPU; i++ {\n        procSum := &lt;-sumc\n        sum += procSum\n    }\n\n    fmt.Println(sum)\n}\n\nfunc sumf(sumc, valuec chan int, endc chan interface{}) {\n    sum := 0\n    for {\n        select {\n        case i := &lt;-valuec:\n            sum += i\n        case &lt;-endc:\n            sumc &lt;- sum\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Hopefully, this helps.</p>\n"}], "owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1549984777, "creation_date": 1549975636, "last_edit_date": 1549980741, "question_id": 54650472, "link": "https://stackoverflow.com/questions/54650472/how-to-use-channel-inside-paralleled-for-loop", "title": "how to use channel inside paralleled for-loop", "body": "<pre><code>func parallelSum (c chan int){\n  sum := 0\n  for i :=1 ; i&lt; 100;i++{\n    go func(i int){\n        sum += i\n    }(i)\n  }\n    time.Sleep(1*time.Second)\n    c &lt;- sum\n}\n</code></pre>\n\n<p>I'm trying to learn the parallel ability to speed up things like OpenMP. And here is an example of the intended summing up parallel loop in Go, this function runs as a goroutine.</p>\n\n<p>Note that the variable <code>sum</code> is not a channel here, so does this mean the variable sum access inside the for loop is a blocked operation? Is it now efficient enough? Is there a better solution?</p>\n\n<p>I knew the channel feature was designed for this, my obviously wrong implement below can compile, but with 100 runtime errors like following. </p>\n\n<pre><code>goroutine 4 [chan receive]:\nmain.parallelSumError(0xc0000180c0)\n    /home/tom/src/goland_newproject/main.go:58 +0xb4 //line 58 : temp := &lt;-sum\ncreated by main.main\n    /home/tom/src/goland_newproject/main.go:128 +0x2ca //line 128: go parallelSumError(pcr), the calling function\n</code></pre>\n\n<p>So what's the problem here? it seems summing is not a good example for paralleled for-loop, but actually I wish to know how to use channel inside paralleled for-loop.</p>\n\n<pre><code>func parallelSum (c chan int){\n    sum := make(chan int)\n    for i :=1 ; i&lt; 100;i++{\n        go func(i int){\n            temp := &lt;- sum //error here why?\n            temp += i\n            sum &lt;- temp\n        }(i)\n    }\n    time.Sleep(1*time.Second)\n    temp := &lt;-sum\n    c &lt;- temp\n}\n</code></pre>\n\n<p>both with the same main function </p>\n\n<pre><code>func main(){\n    pc := make(chan int)\n    go parallelSum(pc) \n    result = &lt;- pc\n    fmt.Println(\"parallel result:\", result)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549975221, "post_id": 54650314, "comment_id": 96091817, "body": "I don&#39;t understand your question. The <code>url</code> package just parses standard query parameters, and what you&#39;ve pasted confirms that (except for the discrepency between <code>foo=12</code> on your URL, and <code>foobar:[12]</code> in the result--which I assume is just a typo on your part). Do you need something different?"}, {"owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549977294, "post_id": 54650314, "comment_id": 96093086, "body": "All I&#39;m trying to understand is, if there is a way to pass a map in a query string. But since Query() produces a <code>map[string][]string</code> it&#39;s not really possible."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549977446, "post_id": 54650314, "comment_id": 96093179, "body": "A query string <i>is</i> a map. Beyond that, you can encode any arbitrary data into a query string, if you&#39;re creative enough. But there&#39;s no standardized method for doing so. You just need to do it in a way that your client and server both understand."}, {"owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549977613, "post_id": 54650314, "comment_id": 96093260, "body": "Thanks, I know a query string is a map. In case it wasn&#39;t clear in the question, I&#39;m trying to pass map called <code>filter_by</code> inside of the query string map."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549977719, "post_id": 54650314, "comment_id": 96093326, "body": "So what problem are you facing? Your question/problem still isn&#39;t clear."}, {"owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549978740, "post_id": 54650314, "comment_id": 96094053, "body": "How to construct the query string so that Query() would produce a map. I&#39;ve just gone with splitting <code>filter_by</code> up into <code>filter_by_name</code> and <code>filter_by_val</code> arrays and them merging them into a map in my app."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549979394, "post_id": 54650314, "comment_id": 96094505, "body": "I don&#39;t know what you mean by &quot;produce a map&quot;. Query() <i>does</i> produce a map. That&#39;s <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\">the only thing it can produce</a>."}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 0, "last_activity_date": 1549975647, "creation_date": 1549975647, "answer_id": 54650474, "question_id": 54650314, "link": "https://stackoverflow.com/questions/54650314/golang-and-maps-in-url-query-string/54650474#54650474", "title": "golang and maps in URL query string", "body": "<p>The problem here is that param may be array, like:</p>\n\n<pre><code>localhost:8000?foo[]=foo&amp;foo[]=bar\n</code></pre>\n\n<p>and in this case you have to have <code>map[string][]string</code> so out of box you have this, and for example upper you'll have:</p>\n\n<pre><code>url.Values{\"foo[]\":[]string{\"foo\", \"bar\"}}\n</code></pre>\n"}], "owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2336, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1549977310, "creation_date": 1549975083, "last_edit_date": 1549977310, "question_id": 54650314, "link": "https://stackoverflow.com/questions/54650314/golang-and-maps-in-url-query-string", "title": "golang and maps in URL query string", "body": "<p>Is it possible for Go's URL package to understand a map as a query parameter when using the <code>Query</code> method? Other languages would understand something like <code>filter_by[locale]=en_GB&amp;filter_by[test]=yes&amp;foo=12</code>.\nThe Query method seems to interpret this as <code>map[filter_by[locale]:[en_GB] filter_by[test]:[yes] foobar:[12]]</code>\nI'm trying to pass along some filter names and values for a GET request.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 3504, "user_id": 3502543, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z13lg.jpg?s=128&g=1", "display_name": "Maksym", "link": "https://stackoverflow.com/users/3502543/maksym"}, "is_accepted": true, "score": 2, "last_activity_date": 1549975635, "creation_date": 1549975635, "answer_id": 54650471, "question_id": 54650265, "link": "https://stackoverflow.com/questions/54650265/how-to-import-local-module-golang/54650471#54650471", "title": "How to import local module golang?", "body": "<p>The solution is to use <code>replace</code> feature:</p>\n\n<pre><code>replace bitbucket.org/xxx/yyy v0.0.0-fff-zzz =&gt; ../yyy/\n</code></pre>\n"}], "owner": {"reputation": 3504, "user_id": 3502543, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z13lg.jpg?s=128&g=1", "display_name": "Maksym", "link": "https://stackoverflow.com/users/3502543/maksym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2573, "favorite_count": 0, "closed_date": 1549977569, "accepted_answer_id": 54650471, "answer_count": 1, "score": 4, "last_activity_date": 1549975635, "creation_date": 1549974908, "question_id": 54650265, "link": "https://stackoverflow.com/questions/54650265/how-to-import-local-module-golang", "closed_reason": "Duplicate", "title": "How to import local module golang?", "body": "<p>How can I import locally build go module?</p>\n\n<p>Importing without version gives:</p>\n\n<pre><code>go: errors parsing go.mod:\n.../go.mod:4: usage: require module/path v1.2.3\n</code></pre>\n\n<p>In the list of modules via command:</p>\n\n<pre><code>go list -m all\n</code></pre>\n\n<p>I see it goes without version.</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1549972917, "last_edit_date": 1549972917, "creation_date": 1549971096, "answer_id": 54649182, "question_id": 54648929, "link": "https://stackoverflow.com/questions/54648929/how-to-dynamically-decide-on-number-of-goroutines-working-on-a-task/54649182#54649182", "title": "How to dynamically decide on number of goroutines working on a task", "body": "<p>How much CPU resource a goroutine gets depends on a lot of things.</p>\n\n<p>What we can say in general is that the goroutine that only handles the numbers dividable by 100 will most likely wait a lot more than the other. You shouldn't worry about this, waiting for an element on a channel does not require CPU resources, so if you have \"enough\" other goroutines that have jobs to do, they can utilize your CPU.</p>\n\n<p>Your example is simple for obvious reasons, but in a real-life example it would be more profitable to abstact your tasks into general tasks (e.g. handling any number could be a task), create and use a general worker pool, and send all tasks for execution to the pool. That way no matter how many goroutines the pool has, if there is work to do and there is a free (waiting) goroutine, it will take on the task, utilizing your CPU resource as much as possible. The job processor (executioner) should have the knowledge what to do with a number being <code>100</code> or <code>101</code>.</p>\n\n<p>For an example how such a goroutine pool can be implemented, see <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "is_accepted": false, "score": 1, "last_activity_date": 1549971107, "creation_date": 1549971107, "answer_id": 54649186, "question_id": 54648929, "link": "https://stackoverflow.com/questions/54648929/how-to-dynamically-decide-on-number-of-goroutines-working-on-a-task/54649186#54649186", "title": "How to dynamically decide on number of goroutines working on a task", "body": "<p>If there is nothing on <code>ch2</code> to read from, <code>handler2</code> does nothing. At the same time, <code>handler1</code> busy handling what it reads from  <code>ch1</code>. This consumes more CPU time.</p>\n\n<p>It would be interesting how long it takes from starting the three Goroutines to data being available on the channels. It is possible that <code>generator</code> has done all its work before <code>handler1</code> and <code>handler2</code> are ready to read from the channels. In this case, <code>handler2</code> would soon be finished with its work while <code>handler1</code> still has work to do.</p>\n\n<p>You could of course create more Goroutines of <code>handler1</code> which would handle data in a kind of round-robin manner. Depending on the nature of the work this could improve or degrade the overall performance.</p>\n\n<p>BTW, <code>generator</code> should <code>close</code> both <code>ch1</code> and <code>ch2</code> when everything is written.</p>\n"}], "owner": {"reputation": 485, "user_id": 5404251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca2027ddbfb95aec818ebc21e7b3717?s=128&d=identicon&r=PG&f=1", "display_name": "Anil", "link": "https://stackoverflow.com/users/5404251/anil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 4, "accepted_answer_id": 54649182, "answer_count": 2, "score": 4, "last_activity_date": 1549972917, "creation_date": 1549970264, "question_id": 54648929, "link": "https://stackoverflow.com/questions/54648929/how-to-dynamically-decide-on-number-of-goroutines-working-on-a-task", "title": "How to dynamically decide on number of goroutines working on a task", "body": "<p>I have written a dummy code to demonstrate the purpose.</p>\n\n<p>There are 2 channels and 3 goroutines in the code.</p>\n\n<p>1 goroutine is generating numbers based on if they are divisible by 100 with no remainder:</p>\n\n<ul>\n<li><p>If the number is divisible by 100, it pushes it to the first channel.</p></li>\n<li><p>Otherwise it pushes it to the second channel.</p></li>\n</ul>\n\n<p>2 goroutines are the consumers of these channels:</p>\n\n<ul>\n<li><p>1 goroutine is responsible for consuming the number 1...99 - 101...199 etc.</p></li>\n<li><p>Other goroutine is responsible for 100, 200, 300 etc.</p></li>\n</ul>\n\n<p>Now obviously, one goroutine has 99x more work to do than the other goroutine.\nHow is this handled in Go? If a goroutine works more than other, is this goroutine given more CPU time?\nOr should I handle this situation, for example creating 99 goroutines for the more resource-hungry channel? (for the sake of argument, the jobs are thought of as identical)</p>\n\n<pre><code>func main() {\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n\n    go generator(ch1, ch2)\n    go handler(ch1)\n    go handler2(ch2)\n\n    time.Sleep(1*time.Second)\n}\n\nfunc generator(chan1, chan2 chan int){\n    for i:=0 ; ; i++{\n        if i%100 == 0{\n            chan1 &lt;- i\n        }else{\n            chan2 &lt;- i\n        }\n    }\n}\n\nfunc handler(number chan int){\n    for _ = range number{\n        num := &lt;- number\n        fmt.Println(\"Number divided by 100 is 0. \", num)\n    }\n}\n\nfunc handler2(number chan int){\n    for _ = range number{\n        num := &lt;- number\n        fmt.Println(\"Number divided by 100 is not 0. \", num)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1549980805, "post_id": 54649104, "comment_id": 96095402, "body": "@TTKDroid, I would add on my Linux/amd64 platform with GCC 6.3, a statically-built C program which performs a single <code>printf(&quot;Hello world\\n&quot;);</code> compiles to the 792k binary (as measured by <code>ls -sh</code>). That&#39;s smaller than the Go version but note that the Go compiler links the whole Go <i>runtime</i> in\u2014the thing C simply does not have (channels, concurrency, reflection, and so on and so on)."}, {"owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "edited": false, "score": 0, "creation_date": 1550456283, "post_id": 54649104, "comment_id": 96261626, "body": "@peterSO so you&#39;re saying that using  -ldflags=-w will remove the reference of my source code name from the binary? Today I have /home/&lt;myuser&gt;/&lt;myproject&gt;/file.go"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1549977320, "last_edit_date": 1549977320, "creation_date": 1549970858, "answer_id": 54649104, "question_id": 54648916, "link": "https://stackoverflow.com/questions/54648916/golang-binary-keeps-reference-of-source-code-names-and-paths/54649104#54649104", "title": "Golang binary keeps reference of source code names and paths", "body": "<blockquote>\n  <p>I found things like comments of how specific function works</p>\n</blockquote>\n\n<hr>\n\n<p>They are not comments. They are string literals, mostly error messages. For example,</p>\n\n<pre><code>malloc.go:  throw(\"persistentalloc: align is not a power of 2\")\n\nlfstack.go: print(\"runtime: lfstack.push invalid packing: node=\"\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Now I know why a \"Hello World\" written in Golang and compiled\n  generates a 3mb binary...</p>\n</blockquote>\n\n<p>No, you don't.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/doc/faq\" rel=\"nofollow noreferrer\">Go: Frequently Asked Questions (FAQ)</a></p>\n  \n  <p><a href=\"https://golang.org/doc/faq#Why_is_my_trivial_program_such_a_large_binary\" rel=\"nofollow noreferrer\">Why is my trivial program such a large binary?</a></p>\n  \n  <p>The linker in the gc toolchain creates statically-linked binaries by\n  default. All Go binaries therefore include the Go runtime, along with\n  the run-time type information necessary to support dynamic type\n  checks, reflection, and even panic-time stack traces.</p>\n  \n  <p>A simple C \"hello, world\" program compiled and linked statically using\n  gcc on Linux is around 750 kB, including an implementation of printf.\n  An equivalent Go program using fmt.Printf weighs a couple of\n  megabytes, but that includes more powerful run-time support and type\n  and debugging information.</p>\n  \n  <p>A Go program compiled with gc can be linked with the -ldflags=-w flag\n  to disable DWARF generation, removing debugging information from the\n  binary but with no other loss of functionality. This can reduce the\n  binary size substantially.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>a \"Hello World\" written in Golang and compiled generates a 3mb\n  binary...</p>\n</blockquote>\n\n<p>That is an exaggeration; it's 2.0MB.</p>\n\n<pre><code>$ go version\ngo version devel +c7026f9d14 Sat Feb 9 17:34:48 2019 +0000 linux/amd64\n$ cat hello.go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, \u4e16\u754c\")\n}\n$ go build hello.go\n$ ./hello\nHello, \u4e16\u754c\n$ ls -s -h ./hello\n2.0M ./hello\n$ \n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1549977320, "creation_date": 1549970228, "question_id": 54648916, "link": "https://stackoverflow.com/questions/54648916/golang-binary-keeps-reference-of-source-code-names-and-paths", "title": "Golang binary keeps reference of source code names and paths", "body": "<p>Out of curiosity, I've opened the binary generated by GO compiler using a HEX Editor and to my surprise, I found in the binary the full path and filename of every source code used in my project. </p>\n\n<p>Like, it is clearly there information like <strong>/home/myusername/myprojectname/source.go</strong></p>\n\n<p>Even more surprised, I found things like comments of how specific function works</p>\n\n<p><a href=\"https://i.stack.imgur.com/c2JtG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/c2JtG.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now I know why a \"Hello World\" written in Golang and compiled generates a 3mb binary... </p>\n\n<p>Does anyone know if there is a way to strip out these things from golang binaries? Like, any compiler flags?</p>\n"}, {"tags": ["unit-testing", "go", "mocking", "testify"], "comments": [{"owner": {"reputation": 7445, "user_id": 1564365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2ff53772b33c8b0c305481ecb7e67141?s=128&d=identicon&r=PG", "display_name": "Kyslik", "link": "https://stackoverflow.com/users/1564365/kyslik"}, "edited": false, "score": 0, "creation_date": 1549969616, "post_id": 54648551, "comment_id": 96088420, "body": "Not sure how to do this in Go, the comment is just a side note. Perhaps using in memory sqlite3 might be better thing to use (<code>:memory:</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "is_accepted": false, "score": 5, "last_activity_date": 1549974402, "creation_date": 1549974402, "answer_id": 54650112, "question_id": 54648551, "link": "https://stackoverflow.com/questions/54648551/unit-testing-go-functions-having-orm-interactions/54650112#54650112", "title": "Unit Testing Go Functions having ORM interactions", "body": "<p>Refactor your code and break it down into smaller, testable functions which you pass dependencies to. Also create interfaces for the dependencies to make testing easier.</p>\n\n<p>For example:</p>\n\n<pre><code>type myDatabaseInterface interface {\n    Find(interface{}) // this signature should match the real db.Find()\n}\n\nfunc AllItems(w http.ResponseWriter, r *http.Request) {\n    db, err := gorm.Open(\"sqlite3\", \"test.db\")\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n    items := findItems(db)\n    json.NewEncoder(w).Encode(items)\n}\n\nfunc find(db myDatabaseInterface) ([]Item) {\n    var items []Item\n    db.Find(&amp;items)\n    return items\n}\n</code></pre>\n\n<p>Then you can create mocks for your dependencies and use them in your tests:</p>\n\n<pre><code>type mock struct {}\n\n// mock should implement myDatabaseInterface to be able to pass it to the function\nfunc (m *mock) Find(interface{}) {\n    // implement the mock to satisfy your test\n}\n\nfunc Test_find(t *testing.T) {\n    m := mock{}\n    res := find(m)\n    // do testing\n}\n</code></pre>\n\n<p>Instead of calling <code>Open</code> every time you handle a request maybe you should open it outside and have it available to your function. That way the handler becomes so small there's no need to test it really:</p>\n\n<pre><code>func makeAllItemsHandler(db myDatabaseInterface) func(http.ResponseWriter, *http.Request) {\n    return func(http.ResponseWriter, *http.Request) {\n        items := findItems(db)\n        json.NewEncoder(w).Encode(items)\n    }\n}\n</code></pre>\n\n<p>Then you can create a db once and for all when you set up your application and pass it to the functions that need it thus removing hard to test code from the functions.</p>\n"}], "owner": {"reputation": 1219, "user_id": 3426358, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/9f7fcc552dd4e78b2347319cd670a61e?s=128&d=identicon&r=PG&f=1", "display_name": "FlyingAura", "link": "https://stackoverflow.com/users/3426358/flyingaura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1549974402, "creation_date": 1549969126, "last_edit_date": 1549969434, "question_id": 54648551, "link": "https://stackoverflow.com/questions/54648551/unit-testing-go-functions-having-orm-interactions", "title": "Unit Testing Go Functions having ORM interactions", "body": "<p>I have written a function:</p>\n\n<pre><code>func AllItems(w http.ResponseWriter, r *http.Request) {\n    db, err := gorm.Open(\"sqlite3\", \"test.db\")\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n\n    var items [] Item\n    db.Find(&amp;items)\n    fmt.Println(\"{}\", items)\n\n    json.NewEncoder(w).Encode(items)\n}\n</code></pre>\n\n<p>I want to do unit testing on this. Ideally, unit testing means that each line of the function needs to be tested. I'm not sure how I should test if a database connection is opened and then if it is displaying all the contents of the database. How should I test this code? </p>\n\n<p>This function is the GET endpoint of a simple CRUD application. The code is <a href=\"https://github.com/ShubhamRathi/ToDo-App\" rel=\"nofollow noreferrer\">here</a>. </p>\n"}, {"tags": ["go", "unicode", "encoding", "character-encoding"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1549968065, "post_id": 54648117, "comment_id": 96087547, "body": "The <code>encoding&#47;json</code> package generates valid JSON, it shouldn&#39;t matter if a specific character is escaped or not. Why must it be escaped?"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1549968593, "post_id": 54648117, "comment_id": 96087865, "body": "You could do something like: <a href=\"https://play.golang.org/p/QG9_92D2nqt\" rel=\"nofollow noreferrer\">play.golang.org/p/QG9_92D2nqt</a> - however, it will ruin the ergonomics of your code."}, {"owner": {"reputation": 2852, "user_id": 543920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/5e43569f62a782023d80bd7383fe8488?s=128&d=identicon&r=PG", "display_name": "Jacob", "link": "https://stackoverflow.com/users/543920/jacob"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1549969294, "post_id": 54648117, "comment_id": 96088229, "body": "@icza a valid question. The simple answer is I need to match the output from a previous version of the API in order to not break compatibility (and yes, the consumers of the API is handling JSON incorrectly, but none the less...)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549970213, "post_id": 54648117, "comment_id": 96088772, "body": "Then you have to implement your own MarshalJSON method on appropriate (new) types."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1549971292, "post_id": 54648117, "comment_id": 96089404, "body": "I don&#39;t think comparing JSON outputs as string is wise, the same JSON data can be represented in numerous forms. So instead you should rewrite your &quot;JSON comparator&quot; to compare the actual data the JSON represents, and not the raw JSON text. Then escaping wouldn&#39;t matter."}], "owner": {"reputation": 2852, "user_id": 543920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/5e43569f62a782023d80bd7383fe8488?s=128&d=identicon&r=PG", "display_name": "Jacob", "link": "https://stackoverflow.com/users/543920/jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 533, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1549968269, "creation_date": 1549967837, "last_edit_date": 1549968269, "question_id": 54648117, "link": "https://stackoverflow.com/questions/54648117/escape-unicode-characters-in-json-encode-golang", "title": "Escape unicode characters in json encode golang", "body": "<p>Given the following example:</p>\n\n<pre><code>func main() {\n    buf := new(bytes.Buffer)\n    enc := json.NewEncoder(buf)\n    toEncode := []string{\"hello\", \"w\u00f6rld\"}\n    enc.Encode(toEncode)\n    fmt.Println(buf.String())\n}\n</code></pre>\n\n<p>I would like to have the output presented with escaped Unicode characters:</p>\n\n<blockquote>\n  <p>[\"hello\",\"w\\u00f6rld\"]</p>\n</blockquote>\n\n<p>Rather than:</p>\n\n<blockquote>\n  <p>[\"hello\",\"w\u00f6rld\"]</p>\n</blockquote>\n\n<p>I have attempted to write a function to quote the Unicode characters using <code>strconv.QuoteToASCII</code> and feed the results to <code>Encode()</code> however that results in double escaping:</p>\n\n<pre><code>func quotedUnicode(data []string) []string {\n    for index, element := range data {                                                \n                quotedUnicode := strconv.QuoteToASCII(element) \n                // get rid of additional quotes                         \n                quotedUnicode = strings.TrimSuffix(quotedUnicode, \"\\\"\") \n                quotedUnicode = strings.TrimPrefix(quotedUnicode, \"\\\"\") \n                data[index] = quotedUnicode                               \n         }                                                                                                                                    \n         return data                                                             \n}  \n</code></pre>\n\n<blockquote>\n  <p>[\"hello\",\"w\\\\u00f6rld\"]</p>\n</blockquote>\n\n<p>How can I ensure that the output from json.Encode contains correctly escaped Unicode characters?</p>\n"}, {"tags": ["sql", "database", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1549966542, "post_id": 54647553, "comment_id": 96086555, "body": "1. <b>NEVER</b> build up your query by concatenating strings. 2. Test the query first. 3. Read the documentation of <code>QueryRow</code> and think about what MobilePhone is doing in there. 4. Ask a human (this is more efficient)."}, {"owner": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1550013822, "post_id": 54647553, "comment_id": 96111794, "body": "thank you for your suggestion"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "edited": false, "score": 0, "creation_date": 1550013716, "post_id": 54647670, "comment_id": 96111771, "body": "I try with ? , but still get error &quot;mssql: Incorrect syntax near &#39;?&#39;.&quot;"}], "tags": [], "owner": {"reputation": 47115, "user_id": 235354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/097d761861529df52a6800744f1074d2?s=128&d=identicon&r=PG", "display_name": "jspcal", "link": "https://stackoverflow.com/users/235354/jspcal"}, "is_accepted": false, "score": 0, "last_activity_date": 1549966537, "creation_date": 1549966537, "answer_id": 54647670, "question_id": 54647553, "link": "https://stackoverflow.com/questions/54647553/why-i-cannot-multiple-parameter-in-golang-what-wrong-with-my-sql-query/54647670#54647670", "title": "why I cannot multiple parameter in golang what wrong with my sql query?", "body": "<p>Since your query doesn't contain any placeholders (<code>?</code> chars), there should be no additional args to <code>QueryRow</code>. Perhaps remove the extra args:</p>\n\n<pre><code>db.QueryRow(\"select SequenceID, MobilePhone, Output, WillBeSentDate, SentDate, Status, DtmUpd from SMSblast2 where SequenceID  IS NOT NULL AND MobilePhone IS NOT NULL\").Scan[...]\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 10492922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d552b697bcb2220e98ec1b66471f6123?s=128&d=identicon&r=PG&f=1", "display_name": "tester", "link": "https://stackoverflow.com/users/10492922/tester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1549966611, "creation_date": 1549966139, "last_edit_date": 1549966611, "question_id": 54647553, "link": "https://stackoverflow.com/questions/54647553/why-i-cannot-multiple-parameter-in-golang-what-wrong-with-my-sql-query", "title": "why I cannot multiple parameter in golang what wrong with my sql query?", "body": "<p>I have problem with  multiple parameter , I cannot implementing 2 parameter with sql query. and I'm still get error , error display mssql: Incorrect syntax near 'SequenceID'. what wrong with my query sql or maybe I wrong with my code ?</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main()  {\n    db, err :=  sql.Open(\"sqlserver\",\"sqlserver://sa:@localhost:1433?database=CONFINS&amp;connection+timeout=30\")\n    if err != nil{\n        fmt.Print(err.Error())\n    }\n\n\nerr = db.Ping()\n\nif err != nil {\n    fmt.Print(err.Error())\n}\ndefer db.Close()\n\ntype SMSBlast struct {\n    SequenceID  int\n    MobilePhone string\n    Output  string\n    WillBeSentDate *time.Time\n    SentDate *time.Time\n    Status *string\n    DtmUpd *time.Time\n}\n\nrouter := gin.Default()\n\n//Get a SMSBlast  detail\nrouter.POST(\"/SMSBlast/:SequenceID\", func(context *gin.Context) {\n    var(\n        smsblast SMSBlast\n        result gin.H\n    )\n\nSequenceID := context.Param(\"SequenceID\")\nMobilePhone := context.Param(\"MobilePhone\")\n\n    err := db.QueryRow(\"select SequenceID, MobilePhone, Output, WillBeSentDate, SentDate, Status, DtmUpd from SMSblast2 where SequenceID  IS NOT NULL  AND MobilePhone IS NOT NULL  \"+SequenceID , MobilePhone).Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n    //fmt.Println(row)\n    fmt.Println(err)\n    //err = row.Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n    if err != nil{\n        //if no results send null\n        result = gin.H{\n            \"result\": nil,\n            \"count\":  0,\n        }\n        }else{\n            result = gin.H{\n                \"result\" : smsblast,\n                \"count\" : 1,\n            }\n        }\n\n    context.JSON(http.StatusOK, result)\n})\n</code></pre>\n"}, {"tags": ["html", "templates", "go", "webserver"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1549955588, "creation_date": 1549955588, "answer_id": 54644621, "question_id": 54643907, "link": "https://stackoverflow.com/questions/54643907/golang-templates-header-with-dynamic-content/54644621#54644621", "title": "Golang Templates Header with Dynamic Content", "body": "<p>Add <code>os.HostName</code> as a <a href=\"https://godoc.org/html/template#Template.Funcs\" rel=\"nofollow noreferrer\">template function</a>.  Call that function in the header.</p>\n\n<p>Here's an example of defining the function when parsing the template:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Funcs(\n    template.FuncMap{\"hostname\": os.Hostname}).ParseFiles(fnames...))\n</code></pre>\n\n<p>Use the function like this:</p>\n\n<pre><code>{{define \"header\"}}\n    &lt;h1&gt;Device Name is: {{hostname}}&lt;/h1&gt;\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hpzRqNDUc3u\" rel=\"nofollow noreferrer\">Run it on the Playground</a>.</p>\n"}], "owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 0, "accepted_answer_id": 54644621, "answer_count": 1, "score": 2, "last_activity_date": 1549955588, "creation_date": 1549952355, "question_id": 54643907, "link": "https://stackoverflow.com/questions/54643907/golang-templates-header-with-dynamic-content", "title": "Golang Templates Header with Dynamic Content", "body": "<p>I have a small webserver written in Golang which runs on a bunch of unix devices.  I want the name of the device in the header of each page served by my webserver so that I can tell which device I'm looking at.</p>\n\n<p>The webserver has half a dozen web pages, and they all use a nested header template. Like this:</p>\n\n<pre><code>&lt;body&gt;\n    {{template \"header\"}}\n</code></pre>\n\n<p>And the header.html file could be something like:</p>\n\n<pre><code>{{define \"header\"}}\n    &lt;h1&gt;Device Name is: {{.}}&lt;/h1&gt;\n{{end}}\n</code></pre>\n\n<p>I want the name of the device (which is obtained through os.HostName()) to be in the header- and I can't figure out how to do it easily.</p>\n\n<p>What I can do is get the host name at the start of the program, and then pass this back to the HTML every time I call ExecuteTemplate.  And as I say, there are around 6 pages, so 6 handlers where I'd have to pass this name back via ExecuteTemplate in my handler function like this. Like this:</p>\n\n<pre><code>func XYZHandler(w http.ResponseWriter, r *http.Request) {\n    type returnInfo struct {\n        Name        string\n    }\n    XYZReturnInfo := returnInfo{Name: deviceName} // deviceName obtained at start of program\n    tmpl.ExecuteTemplate(w, \"XYZ.html\", returnInfo )\n}\n</code></pre>\n\n<p>And then the HTML page injects that into the header using <code>.Name</code>.</p>\n\n<p>But is there some way I can put that deviceName value into the header template once at the start of the program? So that then it gets nested into each page from then on?</p>\n\n<p>I should add I'm parsing my .html files at startup too.  Using ParseFiles.</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1549957559, "post_id": 54643767, "comment_id": 96081282, "body": "Prefix searches are possible, see <a href=\"https://stackoverflow.com/questions/39279779/search-a-string-beginning-with-a-prefix-in-google-app-engine-datastore/39280135#39280135\">Search a string beginning with a prefix in Google App Engine Datastore</a>. General <code>like</code> queries are not."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10679710, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZCnf2XGPUuI/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-htErsKu1Q57dEGQ3CZY-uFlkNjHA/mo/photo.jpg?sz=128", "display_name": "Tushar Bhutada", "link": "https://stackoverflow.com/users/10679710/tushar-bhutada"}, "edited": false, "score": 0, "creation_date": 1550007234, "post_id": 54646392, "comment_id": 96109531, "body": "We can&#39;t use &#39;%&#39; in the query. Though I have achieved this with Filter(&quot;Name &gt;=&quot;, name) but it searches from the start of the string I Want to search through entire string. The second thing is that is there any alternative way to use the &quot;OR&quot; operator in a query."}], "tags": [], "owner": {"reputation": 1, "user_id": 11049015, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-W9V9ucH_UaI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMRQJsTuYc1O6qT_QLwmlWSA1ISyQ/mo/photo.jpg?sz=128", "display_name": "nova trice", "link": "https://stackoverflow.com/users/11049015/nova-trice"}, "is_accepted": false, "score": 0, "last_activity_date": 1549962644, "creation_date": 1549962644, "answer_id": 54646392, "question_id": 54643767, "link": "https://stackoverflow.com/questions/54643767/alternative-way-of-like-operator-to-search-on-column-in-google-cloud-datastore/54646392#54646392", "title": "Alternative way of like operator to search on column in google cloud datastore", "body": "<p>Try This\nq:= datastore.NewQuery(ParcelKind).Filter(\"Name >=\", name%)</p>\n"}], "owner": {"reputation": 21, "user_id": 10679710, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZCnf2XGPUuI/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-htErsKu1Q57dEGQ3CZY-uFlkNjHA/mo/photo.jpg?sz=128", "display_name": "Tushar Bhutada", "link": "https://stackoverflow.com/users/10679710/tushar-bhutada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 1, "closed_date": 1549977608, "answer_count": 1, "score": 0, "last_activity_date": 1549962644, "creation_date": 1549951622, "last_edit_date": 1549951977, "question_id": 54643767, "link": "https://stackoverflow.com/questions/54643767/alternative-way-of-like-operator-to-search-on-column-in-google-cloud-datastore", "closed_reason": "Duplicate", "title": "Alternative way of like operator to search on column in google cloud datastore", "body": "<p>I am using Go lang with datastore as a database, I have to apply search on the UI table by the backend (i.e BY API). So  I went through the documentation and found there is no LIKE OPERATOR is supported in datastore. I also search with regex but this is also not supported.</p>\n\n<p>Still, I want to do it, Please assist with me these guys, I am really needy </p>\n\n<pre><code>// Here ParcelKind is the table name\n\nvar name string\n\nname =\"s\"\n\nq:= datastore.NewQuery(ParcelKind).Filter(\"Name\", name%)\n</code></pre>\n"}, {"tags": ["go", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "edited": false, "score": 0, "creation_date": 1549994255, "post_id": 54642730, "comment_id": 96103562, "body": "It Does Help. Thank You So Much."}], "tags": [], "owner": {"reputation": 538, "user_id": 1931060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S7dYV.jpg?s=128&g=1", "display_name": "imalice", "link": "https://stackoverflow.com/users/1931060/imalice"}, "is_accepted": true, "score": 4, "last_activity_date": 1549955384, "last_edit_date": 1549955384, "creation_date": 1549944954, "answer_id": 54642730, "question_id": 54641747, "link": "https://stackoverflow.com/questions/54641747/how-do-i-pass-an-array-of-configurations-to-a-yaml-file-in-golang/54642730#54642730", "title": "How do I pass an array of configurations to a YAML file in Golang?", "body": "<p>the type of tree that you need is <strong><em>[]map[string]int</em></strong></p>\n\n<p>example code:</p>\n\n<pre><code>settings := yaml.New()\nsettings.Set(\"another\", []map[string]int{{\"tree\": 1}})\nsettings.Write(\"test.yaml\")\n</code></pre>\n\n<p>the result of <strong><em>test.yaml</em></strong></p>\n\n<pre><code>another:\n- tree: 1\n</code></pre>\n\n<p>hope it help</p>\n"}], "owner": {"reputation": 23, "user_id": 10919667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03cc7fce6943ed99d661e34fbd1a5f22?s=128&d=identicon&r=PG&f=1", "display_name": "aditanix", "link": "https://stackoverflow.com/users/10919667/aditanix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 54642730, "answer_count": 1, "score": 1, "last_activity_date": 1549994297, "creation_date": 1549936283, "last_edit_date": 1549994297, "question_id": 54641747, "link": "https://stackoverflow.com/questions/54641747/how-do-i-pass-an-array-of-configurations-to-a-yaml-file-in-golang", "title": "How do I pass an array of configurations to a YAML file in Golang?", "body": "<p>I am trying to create a YAML configuration file using <a href=\"https://github.com/gosexy/yaml\" rel=\"nofollow noreferrer\">gosexy/yaml</a>.</p>\n\n<p>I know how to create a YAML file of the following format:</p>\n\n<pre><code>another:\n  tree:\n  - 1\n</code></pre>\n\n<p>I use the code <code>settings.Set(\"another\",\"tree\",[]int{1})</code> to create the above file.</p>\n\n<p>Now, how can I create a file of the format</p>\n\n<pre><code>another:\n  - tree: 1\n</code></pre>\n\n<p>I tried using the code <code>settings.Set(\"another\",[]{yaml.Set(\"tree\",1)})</code> to create the above file. As it might be obvious, I receive a type error since I am not passing the type to the array.</p>\n\n<p>Am I on the right track? If yes, what should be the type to be passed. If no, what is the alternative way to do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 1, "creation_date": 1549947489, "post_id": 54641499, "comment_id": 96077554, "body": "Make sure you have modules (go.mod, go.sum) in the root folder of ur project."}, {"owner": {"reputation": 811, "user_id": 2644113, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/23949b1ad01e3b7237a23382706a4305?s=128&d=identicon&r=PG", "display_name": "user2644113", "link": "https://stackoverflow.com/users/2644113/user2644113"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1549984369, "post_id": 54641499, "comment_id": 96097874, "body": "There are the go.mod/sum pair in the &#39;packages&#39; folder and also in the service root folder"}], "answers": [{"comments": [{"owner": {"reputation": 811, "user_id": 2644113, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/23949b1ad01e3b7237a23382706a4305?s=128&d=identicon&r=PG", "display_name": "user2644113", "link": "https://stackoverflow.com/users/2644113/user2644113"}, "edited": false, "score": 0, "creation_date": 1549984318, "post_id": 54643125, "comment_id": 96097843, "body": "I have 1.11.5 - only one version"}], "tags": [], "owner": {"reputation": 1759, "user_id": 8708123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcmM3.jpg?s=128&g=1", "display_name": "Fendi jatmiko", "link": "https://stackoverflow.com/users/8708123/fendi-jatmiko"}, "is_accepted": false, "score": 0, "last_activity_date": 1550557696, "last_edit_date": 1550557696, "creation_date": 1549947781, "answer_id": 54643125, "question_id": 54641499, "link": "https://stackoverflow.com/questions/54641499/go-mod-private-repo-import-path-cannot-find-module/54643125#54643125", "title": "Go Mod Private Repo import path (cannot find module)", "body": "<p>might be a good idea to provide more information about your <code>go version</code> . . i have same experience as yours just a weeks ago. . i solved it with downgrading my <code>go version</code> to version <code>1.11.1</code> before i had <code>1.11.5</code> and also i check i had two <code>go</code> installed in my system <code>try checking with command `which golang`</code> ,, i've had the first golang in <code>/usr/local/go</code> which is my go version that i install manually and the other is from <code>pacman</code> package manager which is located in <code>usr/local/bin</code> ...</p>\n\n<blockquote>\n  <p>EDIT :</p>\n</blockquote>\n\n<p>Oh yea, I remember now how to solve my problem : </p>\n\n<ol>\n<li>Remove <code>go mod</code> <em>cache</em>, mine was under <code>~/.cache</code> directory, i dont \nknow bout yours.</li>\n<li>Try <code>build</code> your code right away, under your project directory, go \nahead and issue <code>go build\n</code></li>\n</ol>\n\n<blockquote>\n  <p>EDIT 2 :</p>\n</blockquote>\n\n<p>i got it now, turns out nothing to do with any of my answer above, just now i stumble ( again ) with this problem,, open up your <code>go.mod</code> file and edit the first line to : </p>\n\n<p><code>module full/path/some/apiOfYours</code> to just <code>module apiOfYours</code></p>\n"}], "owner": {"reputation": 811, "user_id": 2644113, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/23949b1ad01e3b7237a23382706a4305?s=128&d=identicon&r=PG", "display_name": "user2644113", "link": "https://stackoverflow.com/users/2644113/user2644113"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2071, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1550557696, "creation_date": 1549934303, "question_id": 54641499, "link": "https://stackoverflow.com/questions/54641499/go-mod-private-repo-import-path-cannot-find-module", "title": "Go Mod Private Repo import path (cannot find module)", "body": "<p>I have this private GIT structure</p>\n\n<pre><code>github.com/my-company/project/webservices/service1\n\ngithub.com/my-company/project/packages/stringslices\n</code></pre>\n\n<p>In the main() of the service1 package:</p>\n\n<pre><code>package main\n\nimport (\n    slice \"github.com/my-company/project/packages/stringslices\"\n)\n\nfunc main() {\n   data := []string{\"a\",\"b\",\"c\"}\n\n    slice.SomeFunc(data)\n}\n</code></pre>\n\n<p>when I try to build I get this error:</p>\n\n<p>build github.com/my-company/project/webservices/service1: cannot find module for path github.com/my-company/project/packages/stringslices</p>\n\n<p>My project is outside the GOPATH\nEach project has a go.mod file with it</p>\n\n<p>How do I resolve this?  Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1549933143, "post_id": 54640620, "comment_id": 96074466, "body": "The reader attempts to copy BUF_SIZE bytes on every iteration of the copy loop. If the file is not a multiple of BUF_SIZE bytes or the file is not padded to the size, then the reader will get out of sync with the writer.  I don&#39;t know for sure because there&#39;s a lot of code that you are not showing. Consider replacing the reader loop with  <code>_, err := io.CopyN(file, c.sesh, h.Size)</code>.  The loop in the writer can also be replaced with io.CopyN.  Also, share the complete code."}, {"owner": {"reputation": 251, "user_id": 10897835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fad722ff71d6330172fc91a8118022f?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10897835/alex"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1549941448, "post_id": 54640620, "comment_id": 96076170, "body": "@ThunderCat I feel like an idiot. Been looking at this for almost 24 hours now not realizing that my <code>session.Write(buf[:n])</code> should be <code>session.Write(buf)</code>. Your comment about the padded size and reader out of sync made me realize it. So thank you."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1549942515, "post_id": 54640620, "comment_id": 96076399, "body": "Consider simplifying the code by replacing each of the copy loops with a single call to io.CopyN.  The <a href=\"https://godoc.org/archive/tar\" rel=\"nofollow noreferrer\">archive/tar</a> may be of interest to you. You are duplicating functionality in that package."}, {"owner": {"reputation": 251, "user_id": 10897835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fad722ff71d6330172fc91a8118022f?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10897835/alex"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550020655, "post_id": 54640620, "comment_id": 96113416, "body": "Thanks! I refactored to use archive/tar. Much less code"}], "owner": {"reputation": 251, "user_id": 10897835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fad722ff71d6330172fc91a8118022f?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/10897835/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1549927464, "creation_date": 1549927464, "question_id": 54640620, "link": "https://stackoverflow.com/questions/54640620/transfer-contents-of-directory-over-nets-tcp-connection", "title": "Transfer contents of directory over net&#39;s TCP connection", "body": "<p>I am currently learning Go and I am trying to send the contents of a directory to another machine over a plain tcp connection using Go's net package. \nIt works fine with individual files and small folders, but I run into issues if the folder contains many subfolders and larger files. I am using the <code>filepath.Walk</code> function to traverse over all files in the given directory. For each file or directory I send, I also send a header that provides the receiver with file name, file size, isDir properties so I know for how long I need to read for when reading the content. <strong>The issue I am having is that after a while when reading the header, I am reading actual file content of the previous file even though I already read that file from the connection</strong></p>\n\n<p>Here is the writer side. I simply traverse over the directory.</p>\n\n<pre><code>func transferDir(session *Session, dir string) error {\n  return filepath.Walk(dir, func(path string, info os.FileInfo, err error) error {\n    if err != nil {\n        return err\n    }\n\n    header := Header{Name: info.Name(), Size: info.Size(), Path: path}\n\n    if info.IsDir() {\n        header.SetDirBit()\n        session.WriteHeader(header)\n        return nil // nothing more to write\n    }\n\n    // content is a file. write the file now byte by byte\n    file, err := os.Open(path)\n    inf, err := file.Stat()\n\n    header.Size = inf.Size() // get the true size of the file\n\n    session.WriteHeader(header)\n\n    defer file.Close()\n\n    if err != nil {\n        return err\n    }\n\n    buf := make([]byte, BUF_SIZE)\n\n    for {\n        n, err := file.Read(buf)\n\n        if err != nil {\n            if err == io.EOF {\n                session.Write(buf[:n])\n                session.Flush()\n                break\n            } else {\n                log.Println(err)\n                return err\n            }\n        }\n\n        session.Write(buf[:n])\n        session.Flush()\n    }\n\n    return nil\n\n})\n</code></pre>\n\n<p>And here is the reader part</p>\n\n<pre><code>func (c *Clone) readFile(h Header) error {\n    file, err := os.Create(h.Path)\n    defer file.Close()\n    if err != nil {\n        return err\n    }\n\n    var receivedByts int64\n    fmt.Printf(\"Reading File: %s Size: %d\\n\", h.Name, h.Size)\n    for {\n        if (h.Size - receivedByts) &lt; BUF_SIZE {\n            n, err := io.CopyN(file, c.sesh, (h.Size - receivedByts))\n            fmt.Println(\"Written: %d err: %s\\n\", n, err)\n            break\n        }\n\n        n, err := io.CopyN(file, c.sesh, BUF_SIZE)\n        fmt.Println(\"Written: %d err: %s\\n\", n, err)\n        receivedByts += BUF_SIZE\n        fmt.Println(\"Bytes Read: \", receivedByts)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Now the weird part is that when I am looking at the print statements I see something like:\nReading File: test.txt Size: 14024</p>\n\n<p>Written 1024 nil</p>\n\n<p>Bytes Read 1024</p>\n\n<p>... This continues all the way to the break statement</p>\n\n<p>And the total of the Bytes read equals the actual file size. Yet, the subsequent read for the header will return content from the test.txt file. Almost like there is still stuff in the buffer, but I think I read it already....</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1549925934, "post_id": 54640302, "comment_id": 96072714, "body": "Your last paragraph is literally the definition of the problem. It doesn&#39;t matter that the two files are the same, the package path that leads to them is different. <code>github.com&#47;pcs-services&#47;message-queue-operator&#47;vendor&#47;k8s.io&zwnj;&#8203;&#47;apimachinery&#47;pkg&#47;ty&zwnj;&#8203;pes&quot;.UID</code> != <code>&quot;github.com&#47;pcs-services&#47;grafana&#47;vendor&#47;k8s.io&#47;apimachinery&#47;&zwnj;&#8203;pkg&#47;types&quot;.UID</code>."}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1549929642, "post_id": 54640302, "comment_id": 96073693, "body": "Are you using DEP? Try running a dep ensure"}], "answers": [{"tags": [], "owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "is_accepted": false, "score": 0, "last_activity_date": 1549975138, "creation_date": 1549975138, "answer_id": 54650327, "question_id": 54640302, "link": "https://stackoverflow.com/questions/54640302/type-mis-match-for-included-library-in-go/54650327#54650327", "title": "Type mis-match for included library in go", "body": "<p>The error says:</p>\n\n<pre><code>pkg/controller/messagequeue/messagequeue_controller.go:167:129: \ncannot use instance.ObjectMeta.GetUID() (type \n\"github.com/pcs-services/message-queue-operator/vendor/k8s.io/apimachinery/pkg/types\".UID) \nas type \n\"github.com/pcs-services/grafana/vendor/k8s.io/apimachinery/pkg/types\".UID \nin argument to grafana.DeployGrafana\n</code></pre>\n\n<p>So, you're using <code>github.com/pcs-services/grafana/vendor/k8s.io/apimachinery/pkg/types.UID</code> but imported <code>github.com/pcs-services/message-queue-operator/vendor/k8s.io/apimachinery/pkg/types.UID</code>. Check your imports and possibly run <code>dep ensure</code> (if you're using dep) to copy the correct dependencies to your vendor folder.</p>\n"}], "owner": {"reputation": 6305, "user_id": 72987, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9d1484425e9a125402f85497c7f86a00?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/72987/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549975138, "creation_date": 1549925192, "question_id": 54640302, "link": "https://stackoverflow.com/questions/54640302/type-mis-match-for-included-library-in-go", "title": "Type mis-match for included library in go", "body": "<p>I'm running into an issue with a library I made that I want to include in multiple projects</p>\n\n<pre><code># github.com/pcs-services/message-queue-operator/pkg/controller/messagequeue\npkg/controller/messagequeue/messagequeue_controller.go:167:129: cannot use instance.ObjectMeta.GetUID() (type \"github.com/pcs-services/message-queue-operator/vendor/k8s.io/apimachinery/pkg/types\".UID) as type \"github.com/pcs-services/grafana/vendor/k8s.io/apimachinery/pkg/types\".UID in argument to grafana.DeployGrafana\n</code></pre>\n\n<p>The files are the same in the main project to the </p>\n\n<pre><code>$ md5 k8s.io/apimachinery/pkg/types/uid.go\nMD5 (k8s.io/apimachinery/pkg/types/uid.go) = cc286eae550982db7f93c079e0df1f52\n</code></pre>\n\n<pre><code>$ md5 k8s.io/apimachinery/pkg/types/uid.go\nMD5 (k8s.io/apimachinery/pkg/types/uid.go) = cc286eae550982db7f93c079e0df1f52\n</code></pre>\n\n<p><code>k8s.io/apimachinery</code> is vendored in the main app but not the library. </p>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "edited": false, "score": 0, "creation_date": 1549925082, "post_id": 54639988, "comment_id": 96072453, "body": "1. your <code>checkErr</code> probably is not throwing a <code>panic</code>, and so the code execution is continuing 2. Simplest fix is to wrap the nullable cols in your sql statement with a <code>COALESCE(templates.L2Name, &#39;&#39;)</code>"}, {"owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "reply_to_user": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "edited": false, "score": 0, "creation_date": 1549939967, "post_id": 54639988, "comment_id": 96075860, "body": "Yes, i am not throwing a panic. But the variable l2name, l2contact, l3name, l3contact, l4name, l4contact are all nullable, why only cause the problem on L2Name?"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "edited": false, "score": 0, "creation_date": 1549939840, "post_id": 54640289, "comment_id": 96075835, "body": "Hi, it is still not working. The variable l2name, l2contact, l3name, l3contact, l4name, l4contact are all nullable, why only cause the problem on L2Name?"}, {"owner": {"reputation": 86, "user_id": 1546501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f29ee4b3edd00b88d017e32327971d?s=128&d=identicon&r=PG", "display_name": "user1546501", "link": "https://stackoverflow.com/users/1546501/user1546501"}, "reply_to_user": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "edited": false, "score": 0, "creation_date": 1551728815, "post_id": 54640289, "comment_id": 96738576, "body": "Because it comes first. Can you please give more details on what &quot;it is still not working&quot; means? If you made the change I suggested it would not fail with the same error. If you see the same exact error, you code was not updated."}], "tags": [], "owner": {"reputation": 86, "user_id": 1546501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f29ee4b3edd00b88d017e32327971d?s=128&d=identicon&r=PG", "display_name": "user1546501", "link": "https://stackoverflow.com/users/1546501/user1546501"}, "is_accepted": false, "score": 1, "last_activity_date": 1549925110, "creation_date": 1549925110, "answer_id": 54640289, "question_id": 54639988, "link": "https://stackoverflow.com/questions/54639988/sql-scan-error-on-column-index-19-name-l2name-unsupported-scan-storing-dri/54640289#54640289", "title": "sql: Scan error on column index 19, name &quot;L2Name&quot;: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>For fields that can be NULL you should use sql.NullString data structure.\nHere is more details:</p>\n\n<p><a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#NullString</a></p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "is_accepted": true, "score": 2, "last_activity_date": 1549942598, "creation_date": 1549942598, "answer_id": 54642448, "question_id": 54639988, "link": "https://stackoverflow.com/questions/54639988/sql-scan-error-on-column-index-19-name-l2name-unsupported-scan-storing-dri/54642448#54642448", "title": "sql: Scan error on column index 19, name &quot;L2Name&quot;: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>Simplest fix is to wrap the nullable cols in your sql statement with a COALESCE(templates.L2Name, ''), thanks for @pmk help.</p>\n\n<pre><code>  sqlstatement := \"SELECT\" +\n    \" assets.ID, assets.Name, assets.LastCheckIn, assets.Status, assets.OffTimer,\" +\n    \" assets.SafetyTimer, assets.HazardTimer, assets.HazardTimerStartedTime, assets.LastSignedOn,\" +\n    \" assets.Latitude, assets.Longitude, assets.TemplateID, assets.ActiveDeviceType, assets.CurrentDeviceID,\" +\n    \" assets.OffTimerTemp, assets.OrganisationID,\" +\n    \" organisations.Name As OrganisationName,\" +\n    \" devices.Label As CurrentDeviceName,\" +\n    \" templates.Name As TemplateName, COALESCE(templates.L2Name, ''), COALESCE(templates.L2Contact, ''),\" +\n    \" COALESCE(templates.L3Name, ''), COALESCE(templates.L3Contact, ''),\" +\n    \" COALESCE(templates.L4Name, ''), COALESCE(templates.L4Contact, ''), templates.Note\" +\n    \" FROM assets\" +\n    \" LEFT JOIN organisations ON assets.OrganisationID = organisations.ID\" +\n    \" LEFT JOIN devices ON assets.CurrentDeviceID = devices.ID\" +\n    \" JOIN templates ON assets.TemplateID = templates.ID\" +\n    \" WHERE assets.Status != 'Not monitoring' AND assets.AssetStatus = 'Active' AND assets.Display != '0'\"\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1663, "favorite_count": 0, "accepted_answer_id": 54642448, "answer_count": 2, "score": 2, "last_activity_date": 1549942598, "creation_date": 1549923362, "question_id": 54639988, "link": "https://stackoverflow.com/questions/54639988/sql-scan-error-on-column-index-19-name-l2name-unsupported-scan-storing-dri", "title": "sql: Scan error on column index 19, name &quot;L2Name&quot;: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string", "body": "<p>Using Golang and the built in database/sql library and the postgres lib/pq library, I'm trying to read from a database that has some null values in some of the records. the code compiles, but when I try to run it I get the following error:\n<code>\nsql: Scan error on column index 19, name \"L2Name\": unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string\n</code></p>\n\n<p>I have the struct like this:</p>\n\n<pre><code>// Assets Info Dataset\ntype AssetInfo struct {\n  Asset_id string\n  Asset_name string\n  Organisation_id string\n  LastCheckIn string\n  Asset_Status string\n  Asset_latitude string\n  Asset_longitude string\n  Organisation_name string\n  CurrentDevice_name string\n  AssetActiveDeviceType string\n  AssetSafetyTimer float32\n  TemplateName string\n  TemplateL2name string\n  TemplateL2contact string\n  TemplateL3name string\n  TemplateL3contact string\n  TemplateL4name string\n  TemplateL4contact string\n  TemplateEscalationNotes string\n}\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"stevejc:19939c@tcp(127.0.0.1:3306)/johntcw_loneworker?charset=utf8\")\n  checkErr(err)\n  defer db.Close()\n\n  for {\n    sqlstatement := \"SELECT\" +\n    \" assets.ID, assets.Name, assets.LastCheckIn, assets.Status, assets.OffTimer,\" +\n    \" assets.SafetyTimer, assets.HazardTimer, assets.HazardTimerStartedTime, assets.LastSignedOn,\" +\n    \" assets.Latitude, assets.Longitude, assets.TemplateID, assets.ActiveDeviceType, assets.CurrentDeviceID,\" +\n    \" assets.OffTimerTemp, assets.OrganisationID,\" +\n    \" organisations.Name As OrganisationName,\" +\n    \" devices.Label As CurrentDeviceName,\" +\n    \" templates.Name As TemplateName, templates.L2Name, templates.L2Contact, templates.L3Name, templates.L3Contact,\" +\n    \" templates.L4Name, templates.L4Contact, templates.Note\" +\n    \" FROM assets\" +\n    \" LEFT JOIN organisations ON assets.OrganisationID = organisations.ID\" +\n    \" LEFT JOIN devices ON assets.CurrentDeviceID = devices.ID\" +\n    \" JOIN templates ON assets.TemplateID = templates.ID\" +\n    \" WHERE assets.Status != 'Not monitoring' AND assets.AssetStatus = 'Active' AND assets.Display != '0'\"\n    // select monitoring assets\n    rows, err := db.Query(sqlstatement)\n    checkErr(err)\n\n    for rows.Next() {\n      var assetid string\n      var name string\n      var lastcheckin string\n      var status string\n      var offtimer float32\n      var offtimertemp float32\n      var safetytimer float32\n      var hazardtimer float32\n      var hazardstarttime string\n      var lastsignedon string\n      var lat string\n      var lon string\n      var templateid string\n      var activedevicetype string\n      var currentdeviceid string\n      var organisationid string\n      var organisationname string\n      var currentdevicename string\n      var templatename string\n      var l2name string\n      var l2contact string\n      var l3name string\n      var l3contact string\n      var l4name string\n      var l4contact string\n      var escalationnotes string\n\n\n      err = rows.Scan(&amp;assetid,\n        &amp;name,\n        &amp;lastcheckin,\n        &amp;status,\n        &amp;offtimer,\n        &amp;safetytimer,\n        &amp;hazardtimer,\n        &amp;hazardstarttime,\n        &amp;lastsignedon,\n        &amp;lat,\n        &amp;lon,\n        &amp;templateid,\n        &amp;activedevicetype,\n        &amp;currentdeviceid,\n        &amp;offtimertemp,\n        &amp;organisationid,\n        &amp;organisationname,\n        &amp;currentdevicename,\n        &amp;templatename,\n        &amp;l2name,\n        &amp;l2contact,\n        &amp;l3name,\n        &amp;l3contact,\n        &amp;l4name,\n        &amp;l4contact,\n        &amp;escalationnotes)\n      checkErr(err)\n\n      assetinfo := new(AssetInfo)\n      assetinfo.Asset_id = assetid\n      assetinfo.Asset_name = name\n      assetinfo.LastCheckIn = lastcheckin\n      assetinfo.Asset_Status = status\n      assetinfo.Organisation_id = organisationid\n      assetinfo.Asset_longitude = lon\n      assetinfo.Asset_latitude = lat\n      assetinfo.Organisation_name = organisationname\n      assetinfo.CurrentDevice_name = currentdevicename\n      assetinfo.AssetActiveDeviceType = activedevicetype\n      assetinfo.AssetSafetyTimer = safetytimer\n      assetinfo.TemplateName = templatename\n      assetinfo.TemplateL2name = l2name\n      assetinfo.TemplateL2contact = l2contact\n      assetinfo.TemplateL3name = l3name\n      assetinfo.TemplateL3contact = l3contact\n      assetinfo.TemplateL4name = l4name\n      assetinfo.TemplateL4contact = l4contact\n      assetinfo.TemplateEscalationNotes = escalationnotes\n</code></pre>\n\n<p>The output of the code is ok, I can get all the data I want from the database. Except the SQL error is also printed on the console. And the L2Name is not a null value here, I can get the value printing on the console. So don't know why the error showing a type ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549922914, "post_id": 54639498, "comment_id": 96071737, "body": "What is the &quot;standard third-party <code>os</code> package&quot;? Do you mean the <code>os</code> package from the the std library?"}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549923344, "post_id": 54639498, "comment_id": 96071872, "body": "Yes; I clarified."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1549924091, "post_id": 54639498, "comment_id": 96072127, "body": "Normally one doesn&#39;t test imports of a module, as they should be tested in isolation; and testing the stdlib outside of building the go toolchain is even more unusual. If testing <code>all</code> is something you really want to do, I would at least wrap the command in a script to filter out the stdlib packages (you could of course do it in a bash one-liner if you really want too)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1549924552, "post_id": 54639498, "comment_id": 96072262, "body": "You could run <code>go test .&#47;...</code> from the module&#39;s main folder. Doesn&#39;t that work for you? If you also want to test dependencies, run <code>go mod vendor</code>, and execute <code>go test .&#47;...</code> in the <code>vendor</code> folder too (created by <code>go mod</code>)."}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549924776, "post_id": 54639498, "comment_id": 96072336, "body": "@JimB According to the official golang modules, it&#39;s a good idea to run <code>go test all</code> before publishing a package &quot;to check for incompatibilities&quot;. <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1549925234, "post_id": 54639498, "comment_id": 96072504, "body": "I see, it&#39;s to verify the transitive dependency versions. While I don&#39;t completely agree with the choice to keep the stdlib in the <code>all</code> wildcard (history here: <a href=\"https://github.com/golang/go/issues/26317\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/26317</a>), you can still pretty easily filter out the deps in the command line using <code>go list</code>."}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549985546, "post_id": 54639498, "comment_id": 96098712, "body": "@JimB Could you expand on how <code>go list</code> would help this situation? I&#39;m aware <code>go list -f &#39;{{ .Deps }}</code> would list all the package dependencies, and I can see how one could then test the dependencies directly, but the <code>os</code> package, which is failing, still shows up in the dependency list, so it&#39;s not obvious what this gets me."}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549985623, "post_id": 54639498, "comment_id": 96098761, "body": "It seems that there&#39;s no elegant solution to the probelm and the best answer is really &quot;suspend the <code>go test all</code> until the stdlib is fixed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549986199, "post_id": 54639498, "comment_id": 96099129, "body": "There&#39;s examples in the linked issue. <code>all</code> is basically equivalent to <code>go  list -f &#39;{{ join .Deps  &quot; &quot;}}&#39;</code>, so you can filter out the problematic packages, or filter the entire std lib using something like <code>go list -f &quot;{{if not .Standard}}{{.ImportPath}}{{end}}&quot; $(go  list -f &#39;{{ join .Deps  &quot; &quot;}}&#39;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549921696, "post_id": 54639540, "comment_id": 96071224, "body": "I don&#39;t follow. I&#39;m familiar with using &#39;build&#39; tags for my own files, but the problem is a failure in the third party <code>os</code> package. I&#39;ve checked the source, and I don&#39;t see build tags in the test to key off. I agree there &quot;should&quot; be no such thing as an &quot;expected failure&quot;, but since there evidently is such a thing, I&#39;d like to deal with it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 2, "creation_date": 1549922674, "post_id": 54639540, "comment_id": 96071638, "body": "If you&#39;re talking about <code>os</code> in the stdlib, that&#39;s not 3rd party; 3rd party would be any dependency that&#39;s not part of your project nor part of the stdlib. I highly doubt there&#39;s a failure in the <code>os</code> package - the tests pass before they release a new stable version. Your question didn&#39;t indicate what test(s) were failing specifically so it&#39;s hard to offer more insight than that."}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549923902, "post_id": 54639540, "comment_id": 96072054, "body": "I apologize for my previous (deleted) comment. I did say which test was failing. The tests dealing with hardlinks in the <code>os</code> package. Sure, I could have been more clear. But the basic question still stands as the standard <code>os</code> package test does absolutely fail and rather than debate semantics, I&#39;d like to find a solution. If you have one, I&#39;d very much like to understand it, because as I understand your current answer, it does not seem relevant."}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549924101, "post_id": 54639540, "comment_id": 96072130, "body": "And, since you brought it up, I used the term &#39;third party&#39; because I was thinking of how one would solve this in general, where you want to &#39;go test all&#39; which entails tests from everything, so was using &#39;third party&#39; as a blanket term for &quot;not mine&quot;, which seems entirely appropriate to me. The fact that the failing test is in the standard lib is not relevant to the question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549984263, "post_id": 54639540, "comment_id": 96097818, "body": "It is relevant in some respects, for example, the fact that the stdlib is well-tested on all supported platforms prior to any version being released as stable. The <code>os</code> tests do not fail on darwin/amd64: <a href=\"https://build.golang.org/\" rel=\"nofollow noreferrer\">build.golang.org</a>"}, {"owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "edited": false, "score": 0, "creation_date": 1549984736, "post_id": 54639540, "comment_id": 96098146, "body": "Except that they do, in some cases, as shown by the evidence provided above, and confirmed by the golang team: <a href=\"https://github.com/golang/go/issues/28387\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/28387</a>. I appreciate your input, and I agree that the current state of affairs is transitory and that the best solution is perhaps to wait till the tests are fixed, but you keep insisting on things which are not in fact true. Anyone can make mistakes, and I&#39;m asking how to work around those mistakes when they inevitably crop up."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1549921084, "creation_date": 1549921084, "answer_id": 54639540, "question_id": 54639498, "link": "https://stackoverflow.com/questions/54639498/how-to-deal-with-expected-irrelevant-failures-in-go-test-all/54639540#54639540", "title": "How to deal with expected + irrelevant failures in &#39;go test all&#39;?", "body": "<p>You can use <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">build constraints</a> to choose which tests are run by OS, architecture, or build tag. For those that are for OS-specific functionality, just make the tests OS-specific. There should be no such thing as \"expected failures\", these are just tests that are being misapplied.</p>\n"}], "owner": {"reputation": 2212, "user_id": 929494, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e63e6e566d6f15d8e177e8894281aa37?s=128&d=identicon&r=PG", "display_name": "zanerock", "link": "https://stackoverflow.com/users/929494/zanerock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549985218, "creation_date": 1549920844, "last_edit_date": 1549985218, "question_id": 54639498, "link": "https://stackoverflow.com/questions/54639498/how-to-deal-with-expected-irrelevant-failures-in-go-test-all", "title": "How to deal with expected + irrelevant failures in &#39;go test all&#39;?", "body": "<p>I'm using NPM to manage build/test/version lifecycle of a go package using go 1.11 modules. Prior to publishing, I'd like to check 'everything', included the modules, so I run: <code>go test all</code> (which runs tests in all included modules).</p>\n\n<p>The problem is that the standard <code>os</code> package in go 1.11.5 (at least) fail on some Mac versions/environments (including mine). That's OK and irrelevant for my purposes, since the failures are in functions I don't use. However, this causes the publish process to fail since <code>go test</code> exits with a non-zero status.</p>\n\n<p>Any advice on how to deal with this?</p>\n\n<p>It would be great if there was a way to run all the tests for functions that are in the call tree of my local tests (<code>go test all -relevant</code>). Or, if I could name and skip the tests, that would be fine as well.</p>\n\n<p>I'm aware of the <code>-run</code> flag, but that doesn't seem to help because I cannot know beforehand what tests to run, and (from what I've seen) the regex used by <code>-run</code> doesn't support negative lookaheads so it would be very tedious to construct a regular expression to exclude certain tests.</p>\n\n<p>Failing <code>os</code> tests:</p>\n\n<pre><code>--- FAIL: TestStatError (0.00s)\n    os_test.go:200: symlink no-such-file symlink: permission denied\n--- FAIL: TestHardLink (0.00s)\n    os_test.go:694: open \"hardlinktestto\" failed: open hardlinktestto: permission denied\n--- FAIL: TestSymlink (0.00s)\n    os_test.go:780: Create(\"symlinktestto\") failed: open symlinktestto: permission denied\n--- FAIL: TestLongSymlink (0.00s)\n    os_test.go:847: symlink \"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef\", \"longsymlinktestfrom\" failed: symlink 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef longsymlinktestfrom: permission denied\n--- FAIL: TestRename (0.00s)\n    os_test.go:868: open \"renamefrom\" failed: open renamefrom: permission denied\n--- FAIL: TestRenameOverwriteDest (0.00s)\n    os_test.go:896: write file \"renameto\" failed: open renameto: permission denied\n--- FAIL: TestAppend (0.00s)\n    os_test.go:1684: Open: open append.txt: permission denied\n--- FAIL: TestSameFile (0.00s)\n    os_test.go:1766: Create(a): open a: permission denied\nFAIL\nFAIL    os  19.145s\n</code></pre>\n"}, {"tags": ["go", "rabbitmq", "microservices", "messagebroker", "go-micro"], "answers": [{"comments": [{"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "edited": false, "score": 0, "creation_date": 1550320262, "post_id": 54654510, "comment_id": 96230400, "body": "Thank you for the answer. I kind of figured this was the case but wanted some confirmation. Your suggestion of a multi-broker broker implementation is actually really good and I&#39;ll look into doing that"}], "tags": [], "owner": {"reputation": 26, "user_id": 11051940, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-O_J3e2GKfk8/AAAAAAAAAAI/AAAAAAAATvc/53YtXffmHCY/photo.jpg?sz=128", "display_name": "Asim Aslam", "link": "https://stackoverflow.com/users/11051940/asim-aslam"}, "is_accepted": true, "score": 1, "last_activity_date": 1549988638, "creation_date": 1549988638, "answer_id": 54654510, "question_id": 54638575, "link": "https://stackoverflow.com/questions/54638575/consume-from-one-broker-and-produce-to-another-using-go-micro/54654510#54654510", "title": "Consume from one broker and produce to another using Go Micro", "body": "<p>Go Micro was designed to be single process per service and initialise one of each abstraction. This is the design for 99% usecase of how we write software. There are a few who would like multi-transport, multi-broker, etc but this is outside the scope of the project and I think something that someone else can easily design e.g a broker which loads multiple brokers and then switches based on an option or prefix.</p>\n\n<p>Separately, I developed a service which loads multiple brokers to do message federation. This may be of interest to you <a href=\"https://github.com/microhq/federation-srv\" rel=\"nofollow noreferrer\">https://github.com/microhq/federation-srv</a></p>\n"}], "owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 54654510, "answer_count": 1, "score": 1, "last_activity_date": 1549988638, "creation_date": 1549916766, "question_id": 54638575, "link": "https://stackoverflow.com/questions/54638575/consume-from-one-broker-and-produce-to-another-using-go-micro", "title": "Consume from one broker and produce to another using Go Micro", "body": "<p>I am trying to write a microservice using the Go Micro framework which is going to consume from a RabbitMQ broker and Write to another.</p>\n\n<p>Go Micro has a RabbitMQ plugin however it seems that if one wants to use the Go Micro abstractions (Such as <code>micro.RegisterSubscriber</code>), one has to rely on a lot of global states internal to the library. I ended up setting up a consumer using <code>micro.RegisterSubscriber</code> and then manually creating a separate broker with care to not use any internal global state (Such as default exchange) and then call <code>broker.Publish</code> within the consumer function which meant I had to Marshal the message manually before shipping it.</p>\n\n<p>Is this not a supported pattern in Go Micro? Is there any better way of going about doing something like this?</p>\n\n<p>I should mention that the main reason for choosing Go Micro in this particular case is because it seems to have a reliable RabbitMQ abstraction with reconnect support which seems to be hard to come by in Go, not necessarily because I needed RPC support in this one case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 0, "creation_date": 1550001760, "post_id": 54638194, "comment_id": 96107044, "body": "The question may have been asked before but the circumstances and solution are completely different. I saw the &quot;duplicate&quot; and it gave me no clue as to how to solve my problem."}], "answers": [{"comments": [{"owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 0, "creation_date": 1549917387, "post_id": 54638401, "comment_id": 96069384, "body": "As a newbie I&#39;d really appreciate a code example for that."}, {"owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "reply_to_user": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 1, "creation_date": 1549918364, "post_id": 54638401, "comment_id": 96069828, "body": "@markhorrocks sure, see my edit"}], "tags": [], "owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "is_accepted": true, "score": 7, "last_activity_date": 1549918352, "last_edit_date": 1549918352, "creation_date": 1549915981, "answer_id": 54638401, "question_id": 54638194, "link": "https://stackoverflow.com/questions/54638194/runtime-error-invalid-memory-address-or-nil-pointer-dereference-again/54638401#54638401", "title": "runtime error: invalid memory address or nil pointer dereference, again", "body": "<p>the <code>store</code> that you are creating in your main func is not being assigned to the global <code>store</code>. The global store being used in your handler is still nil. This is because of how the <code>:=</code> operator works, and the fact that you are trying to assign to a var declared elsewhere.</p>\n\n<p>You could either </p>\n\n<ol>\n<li>assign to the global store correctly by not using the <code>:=</code> and declaring <code>var err error</code> above that line\ne.g.</li>\n</ol>\n\n<pre><code>var err error\nstore, err = mysqlstore.NewMySQLStore(...\n</code></pre>\n\n<ol start=\"2\">\n<li>Or the way that i recommend (without global vars) is to: initialize <code>store</code> in main as you have done, and also initialize your handler by wrapping the handler function in a closure and passing the store into that</li>\n</ol>\n\n<p>e.g. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/srinathgs/mysqlstore\"\n    \"net/http\"\n)\n\n// note: this returns a http.HandlerFunc, which works because\n// http.HandlerFunc is just a named type for a function which accepts http.ResponseWriter and *http.Request as args\n// see the docs at https://golang.org/pkg/net/http/#HandlerFunc\n// (but yea at the end of the day, this is a function which returns another function)\nfunc makeSessTest(store *mysqlstore.MySQLStore) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        session, err := store.Get(r, \"foobar\")\n        session.Values[\"bar\"] = \"baz\"\n        session.Values[\"baz\"] = \"foo\"\n        err = session.Save(r, w)\n        fmt.Printf(\"%#v\\n\", session)\n        fmt.Println(err)\n    }\n}\n\nfunc main() {\n    store, err := mysqlstore.NewMySQLStore(\"root:mypass@tcp(127.0.0.1:3306)/mydb?parseTime=true&amp;loc=Local\", \"sessions\", \"/\", 3600, []byte(\"&lt;SecretKey&gt;\"))\n    if err != nil {\n        panic(err)\n    }\n    defer store.Close()\n\n    http.HandleFunc(\"/\", makeSessTest(store))\n    http.ListenAndServe(\":8080\", nil)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1516, "favorite_count": 0, "closed_date": 1549916301, "accepted_answer_id": 54638401, "answer_count": 1, "score": -2, "last_activity_date": 1549918352, "creation_date": 1549915194, "last_edit_date": 1549916261, "question_id": 54638194, "link": "https://stackoverflow.com/questions/54638194/runtime-error-invalid-memory-address-or-nil-pointer-dereference-again", "closed_reason": "Duplicate", "title": "runtime error: invalid memory address or nil pointer dereference, again", "body": "<p>I am trying to use the mysqlstore backend package for gorilla sessions in a Golang web application. I am following <a href=\"https://github.com/srinathgs/mysqlstore\" rel=\"nofollow noreferrer\">this example</a> and my code is identical. The code builds and runs fine but when I go to localhost:8080/ in my browser I am getting this error </p>\n\n<blockquote>\n  <p>runtime error: invalid memory address or nil pointer dereference</p>\n</blockquote>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\n  import (\n    \"fmt\"\n    \"github.com/srinathgs/mysqlstore\"\n    \"net/http\"\n  )\n\n  var store *mysqlstore.MySQLStore\n\n  func sessTest(w http.ResponseWriter, r *http.Request) {\n    session, err := store.Get(r, \"foobar\")\n    session.Values[\"bar\"] = \"baz\"\n    session.Values[\"baz\"] = \"foo\"\n    err = session.Save(r, w)\n    fmt.Printf(\"%#v\\n\", session)\n    fmt.Println(err)\n  }\n\nfunc main() {\n\n    store, err := mysqlstore.NewMySQLStore(\"root:mypass@tcp(127.0.0.1:3306)/mydb?parseTime=true&amp;loc=Local\", \"sessions\", \"/\", 3600, []byte(\"&lt;SecretKey&gt;\"))\n    if err != nil {\n      panic(err)\n    }\n    defer store.Close()\n\n        http.HandleFunc(\"/\", sessTest)\n        http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Here is the full error message:</p>\n\n<blockquote>\n  <p>2019/02/12 02:46:43 http: panic serving [::1]:63119: runtime error:\n  invalid memory address or nil pointer dereference goroutine 34\n  [running]: net/http.(*conn).serve.func1(0xc000112320)\n    /usr/local/Cellar/go/1.11.5/libexec/src/net/http/server.go:1746 +0xd0\n  panic(0x12c9f40, 0x1560950)\n    /usr/local/Cellar/go/1.11.5/libexec/src/runtime/panic.go:513 +0x1b9\n  github.com/srinathgs/mysqlstore.(*MySQLStore).New(0x0, 0xc000138000,\n  0x1324045, 0x6, 0x158afa0, 0xc00010a000, 0xb)\n    /Users/Mark/go/src/github.com/srinathgs/mysqlstore/mysqlstore.go:137\n  +0xef github.com/gorilla/sessions.(*Registry).Get(0xc00011e0e0, 0x1376e20, 0x0, 0x1324045, 0x6, 0xc00010c100, 0x0, 0x1)\n    /Users/Mark/go/src/github.com/gorilla/sessions/sessions.go:139 +0x142\n  github.com/srinathgs/mysqlstore.(*MySQLStore).Get(0x0, 0xc000138000,\n  0x1324045, 0x6, 0x1086222, 0xc00010a044, 0xc00010a050)\n    /Users/Mark/go/src/github.com/srinathgs/mysqlstore/mysqlstore.go:131\n  +0x63 main.sessTest(0x13770a0, 0xc00013c000, 0xc000138000)    /Users/Mark/go/src/testsessions/main.go:12 +0x61\n  net/http.HandlerFunc.ServeHTTP(0x133a680, 0x13770a0, 0xc00013c000,\n  0xc000138000)</p>\n  \n  <p>&lt;\u2026></p>\n</blockquote>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1549914173, "post_id": 54637879, "comment_id": 96067870, "body": "The second example isn&#39;t valid JSON, so no, there is no way to make <code>encoding&#47;json</code> produce invalid JSON."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549917902, "post_id": 54637879, "comment_id": 96069620, "body": "Why do you want to produce invalid JSON?"}, {"owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "edited": false, "score": 1, "creation_date": 1549919204, "post_id": 54637879, "comment_id": 96070160, "body": "the second example is valid json if you remove the line breaks."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 10766931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c0cc360924ba44a4107a31902e2dfe?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/10766931/george"}, "edited": false, "score": 0, "creation_date": 1549992381, "post_id": 54639188, "comment_id": 96102725, "body": "That&#39;s what i needed, thank you"}], "tags": [], "owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "is_accepted": true, "score": -1, "last_activity_date": 1549920371, "last_edit_date": 1549920371, "creation_date": 1549919307, "answer_id": 54639188, "question_id": 54637879, "link": "https://stackoverflow.com/questions/54637879/how-to-marshal-and-escape-quotes/54639188#54639188", "title": "How to marshal and escape quotes", "body": "<p>(assuming you don't care about the line breaks in your desired output) - one way to do this is to loop through each of the values in your map, and marshal those into a json string first, using the standard <code>json.Marshal</code> function. Then add those strings back into your original map (or a new map if you like). Now that you have a map where the values are actually json string representations of the original values, you can marshal this outer map as json, and the encoder will escape any double quotes in the value strings for you. \nsee this example</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nvar yourMap = map[string]interface{}{\n    \"a\": 1,\n    \"b\": map[string]interface{}{\n        \"c\": 2,\n    },\n}\n\n\nfunc transform(m map[string]interface{}) (map[string]interface{}, error) {\n    newMap := make(map[string]interface{})\n    for k, v := range m {\n        bytez, err := json.Marshal(v)\n        if err != nil {\n            return nil, err\n        }\n        newMap[k] = string(bytez)\n    }\n    return newMap, nil\n}\n\nfunc main() {\n    newMap, err := transform(yourMap)\n    if err != nil {\n        panic(err)\n    }\n\n    b, err := json.Marshal(newMap)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(b))\n}\n\n</code></pre>\n\n<p>a cleaner way to encapsulate the above logic could be to declare a new named type for your map, and implement the custom marshalling in the Marshal method for that new type.</p>\n"}], "owner": {"reputation": 37, "user_id": 10766931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c0cc360924ba44a4107a31902e2dfe?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/10766931/george"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "closed_date": 1549950750, "accepted_answer_id": 54639188, "answer_count": 1, "score": -4, "last_activity_date": 1549920371, "creation_date": 1549913973, "last_edit_date": 1549914620, "question_id": 54637879, "link": "https://stackoverflow.com/questions/54637879/how-to-marshal-and-escape-quotes", "closed_reason": "Needs details or clarity", "title": "How to marshal and escape quotes", "body": "<p>I'm marshaling a <code>map[string]interface{}</code> and get a json:</p>\n\n<pre><code>{\n    \"test\": {\n        \"test2\": 123\n    }\n}\n</code></pre>\n\n<p>In some cases under an <code>interface{}</code> i have another <code>map[string]interface{}</code></p>\n\n<p>Is there any way to marshal it and escape double quotes to get json like this?</p>\n\n<pre><code>{\n    \"test\": \"{\n        \\\"test2\\\": 123\n    }\"\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549911370, "post_id": 54637011, "comment_id": 96066574, "body": "Why not just use <code>sort</code>?"}, {"owner": {"reputation": 289, "user_id": 4031654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1efa08165a674d2927404d859c0cc737?s=128&d=identicon&r=PG&f=1", "display_name": "pyofey", "link": "https://stackoverflow.com/users/4031654/pyofey"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549912062, "post_id": 54637011, "comment_id": 96066886, "body": "I did that actually but wanted to use insertion sort..."}], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 4031654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1efa08165a674d2927404d859c0cc737?s=128&d=identicon&r=PG&f=1", "display_name": "pyofey", "link": "https://stackoverflow.com/users/4031654/pyofey"}, "edited": false, "score": 1, "creation_date": 1549912295, "post_id": 54637246, "comment_id": 96067000, "body": "yes! I have converted the Python code to Go code but thank you for pointing out the <code>range</code> thingy on <code>go</code>"}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": true, "score": 4, "last_activity_date": 1549911986, "last_edit_date": 1549911986, "creation_date": 1549911217, "answer_id": 54637246, "question_id": 54637011, "link": "https://stackoverflow.com/questions/54637011/unknown-bug-in-golang-code-insertion-sort-in-2nd-pass/54637246#54637246", "title": "Unknown bug in Golang code: insertion sort in 2nd pass?", "body": "<p>Your for loop is wrong. When you do, <code>for i,_ := range arr[1:]{</code>, <strong>i becomes 0, not 1.</strong> You want to start traversing the array from the second element with pos 1, but when you do <code>arr[1:]</code>, your array changes, becomes a slice with one less element and your index still ends up being 0. </p>\n\n<p>To fix it, check the c++ code in the page you posted and implement the for loop that operates on the length of the original array.</p>\n\n<p>The <code>range arr</code> is similar to <code>foreach</code> in other languages and makes it hard to operate with indexes.  </p>\n\n<p>Note: I also checked the python code of the page. It also has a for loop for the python code. Long story short, use <code>range arr[1:]</code> with caution :)</p>\n\n<p><strong>The fix</strong> :  </p>\n\n<blockquote class=\"spoiler\">\n  <p> <code>for i, _ := range arr[1:]</code> <strong>=></strong> <code>for i:=1;i&lt;len(arr);i++</code>  </p>\n</blockquote>\n\n<p>It is given with a spoiler tag because I don't want to steal your joy of fixing the error.</p>\n"}], "owner": {"reputation": 289, "user_id": 4031654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1efa08165a674d2927404d859c0cc737?s=128&d=identicon&r=PG&f=1", "display_name": "pyofey", "link": "https://stackoverflow.com/users/4031654/pyofey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 54637246, "answer_count": 1, "score": -2, "last_activity_date": 1549911986, "creation_date": 1549910241, "last_edit_date": 1549911109, "question_id": 54637011, "link": "https://stackoverflow.com/questions/54637011/unknown-bug-in-golang-code-insertion-sort-in-2nd-pass", "title": "Unknown bug in Golang code: insertion sort in 2nd pass?", "body": "<p>I'm new to Go. I'm using <code>go version go1.10.4 linux/amd64</code>. My objective is to ask a single integer input from the user append it to an array and sort it. I'm using insertion sort for this. The program needs to exit on receiving <code>'X'</code> as input from the user.</p>\n\n<p>This is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    //  \"sort\"\n)\n\nfunc insertionSort(arr []int) []int {\n    // Traverse through 1 to len(arr)\n    for i, _ := range arr[1:] {\n        key := arr[i]\n        j := i - 1\n        for {\n            if j &gt;= 0 &amp;&amp; key &lt; arr[j] {\n                arr[j+1] = arr[j]\n                j = j - 1\n            } else {\n                break\n            }\n        }\n        arr[j+1] = key\n    }\n\n    return arr\n}\n\nfunc main() {\n    s := make([]int, 0, 3)\n    var x string\n    for {\n        fmt.Printf(\"Enter a number: \")\n        fmt.Scan(&amp;x)\n\n        if x == \"X\" {\n            break\n        }\n\n        xInt, _ := strconv.Atoi(x)\n        fmt.Println(xInt)\n\n        s = append(s, xInt)\n        //sort.Ints(s)\n        s = insertionSort(s)\n        fmt.Printf(\"%v\\n\", s)\n    }\n    fmt.Printf(\"%v\\n\", s)\n}\n</code></pre>\n\n<p>I'm getting the following output:</p>\n\n<pre><code>Enter a number: 5\n[5]\nEnter a number: 4\n[5 4]\nEnter a number: 3\n[4 5 3]\nEnter a number: 2\n[3 4 5 2]\nEnter a number: 1\n[2 3 4 5 1]\nEnter a number: X\n[2 3 4 5 1]\n</code></pre>\n\n<p><code>Question:</code></p>\n\n<p>Why is it getting sorted in 2nd pass? I mean it's first printing the appended array and then for next element, it's printing the sorted array of the previous element. Why? I'm sorting after appending so this should not be the case...</p>\n\n<p>I took (and converted from <code>Python</code> code) insertion sort code from <a href=\"https://www.geeksforgeeks.org/insertion-sort/\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": ["json", "api", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1549907144, "post_id": 54636182, "comment_id": 96064568, "body": "JSON objects must be unmarshalled into struct values or maps, but you have a slice value (which works with JSON arrays only)."}], "answers": [{"tags": [], "owner": {"reputation": 372, "user_id": 2044647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nsoLl.png?s=128&g=1", "display_name": "Tecnologer", "link": "https://stackoverflow.com/users/2044647/tecnologer"}, "is_accepted": false, "score": 2, "last_activity_date": 1549907649, "creation_date": 1549907649, "answer_id": 54636394, "question_id": 54636182, "link": "https://stackoverflow.com/questions/54636182/how-to-unmarshal-json-data-to-print-in-a-well-defined-format/54636394#54636394", "title": "How to unmarshal json data to print in a well defined format", "body": "<p>You need create a second struct to receive the whole JSON.</p>\n\n<pre><code>type JSONResponse struct {\n    Message    string     `json:\"Message\"`\n    Status     string     `json:\"Success\"`\n    PostOffice postOffice `json:\"PostOffice\"`\n}\n</code></pre>\n\n<p>This is because the <code>PostOffice</code> is an array inside of the response.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\n//this is the new struct\ntype JSONResponse struct {\n    Message    string     `json:\"Message\"`\n    Status     string     `json:\"Success\"`\n    PostOffice postOffice `json:\"PostOffice\"`\n}\n\ntype postOffice []struct {\n    Name    string\n    Taluk   string\n    Region  string\n    Country string\n}\n\nfunc main() {\n    data, err := http.Get(\"http://postalpincode.in/api/pincode/221010\")\n    if err != nil {\n        fmt.Printf(\"The http request has a error : %s\", err)\n    } else {\n        read, _ := ioutil.ReadAll(data.Body)\n        //change the type of the struct\n        var po JSONResponse\n        err = json.Unmarshal(read, &amp;po)\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n        }\n        fmt.Print(po)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1549907649, "creation_date": 1549906843, "question_id": 54636182, "link": "https://stackoverflow.com/questions/54636182/how-to-unmarshal-json-data-to-print-in-a-well-defined-format", "title": "How to unmarshal json data to print in a well defined format", "body": "<p>I can't figure out how to unmarshal the json data provided by an api and consume the data to print in a specified format.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype postOffice []struct {\n    Name    string\n    Taluk   string\n    Region  string\n    Country string\n}\n\nfunc main() {\n    data, err := http.Get(\"http://postalpincode.in/api/pincode/221010\")\n    if err != nil {\n        fmt.Printf(\"The http request has a error : %s\", err)\n    } else {\n        read, _ := ioutil.ReadAll(data.Body)\n        var po postOffice\n        err = json.Unmarshal(read, &amp;po)\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n        }\n        fmt.Print(po)\n    }\n\n}\n</code></pre>\n\n<p>The code was working well till the \"read\" was evaluated but is throwing the following error on using json.Unmarshal \"json: cannot unmarshal object into Go value of type main.post[]\"</p>\n"}, {"tags": ["go", "int"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1549899699, "post_id": 54634078, "comment_id": 96060379, "body": "There are no int128 in Go. You could use math/big.Int."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1549899712, "post_id": 54634078, "comment_id": 96060389, "body": "There is no <code>int128</code> type in Go. If you need &quot;bigger&quot; than <code>int64</code>, consider using <a href=\"https://golang.org/pkg/math/big/#Int\" rel=\"nofollow noreferrer\"><code>big.Int</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1549950321, "last_edit_date": 1549950321, "creation_date": 1549900313, "answer_id": 54634299, "question_id": 54634078, "link": "https://stackoverflow.com/questions/54634078/how-do-i-strconv-a-string-to-value-int128-currently-im-limited-to-int64/54634299#54634299", "title": "How do I strconv a string to value int128? currently i&#39;m limited to int64", "body": "<p>There is no Go type <code>int128</code>. Use the Go <code>math/big</code> package type <code>Int</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    z, ok := new(big.Int).SetString(\"zzzzzzzzzzzzzzzzzzzz\", 36)\n    if ok {\n        fmt.Println(z)\n        fmt.Println(z.Text(36))\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ln1PswhmK-l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ln1PswhmK-l</a></p>\n\n<p>Output:</p>\n\n<pre><code>13367494538843734067838845976575\nzzzzzzzzzzzzzzzzzzzz\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 9354876, "user_type": "registered", "profile_image": "https://graph.facebook.com/346798062463108/picture?type=large", "display_name": "Okit Tfseven", "link": "https://stackoverflow.com/users/9354876/okit-tfseven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "closed_date": 1549963858, "accepted_answer_id": 54634299, "answer_count": 1, "score": -3, "last_activity_date": 1549950321, "creation_date": 1549899602, "last_edit_date": 1549901113, "question_id": 54634078, "link": "https://stackoverflow.com/questions/54634078/how-do-i-strconv-a-string-to-value-int128-currently-im-limited-to-int64", "closed_reason": "Needs details or clarity", "title": "How do I strconv a string to value int128? currently i&#39;m limited to int64", "body": "<p>Given, stringvalue := \"zzzzzzzzzzzzzzzzzzzz\"</p>\n\n<pre><code>   i, err := strconv.ParseInt(stringvalue, 36, 0)\n</code></pre>\n\n<p>How do I return int128 as my stringvalue will be long enough to return int128?</p>\n"}, {"tags": ["go", "google-bigquery"], "answers": [{"comments": [{"owner": {"reputation": 431, "user_id": 1921782, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/823dff64d1cd834b6090497b3328c4d7?s=128&d=identicon&r=PG", "display_name": "RDs", "link": "https://stackoverflow.com/users/1921782/rds"}, "edited": false, "score": 0, "creation_date": 1549912052, "post_id": 54635271, "comment_id": 96066881, "body": "how do I get the column names and the values from this? I can use map to get the column names but it won&#39;t work with nested types."}, {"owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "reply_to_user": {"reputation": 431, "user_id": 1921782, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/823dff64d1cd834b6090497b3328c4d7?s=128&d=identicon&r=PG", "display_name": "RDs", "link": "https://stackoverflow.com/users/1921782/rds"}, "edited": false, "score": 0, "creation_date": 1549971451, "post_id": 54635271, "comment_id": 96089511, "body": "create another question for that with sample public DB in BQ i can access and ping me"}], "tags": [], "owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "is_accepted": false, "score": 4, "last_activity_date": 1549903585, "creation_date": 1549903585, "answer_id": 54635271, "question_id": 54633599, "link": "https://stackoverflow.com/questions/54633599/read-bq-query-result-without-struct/54635271#54635271", "title": "Read BQ query result without struct", "body": "<pre><code>for {\n     var values []bigquery.Value\n     err := it.Next(&amp;values)\n     if err == iterator.Done {\n        break\n     }\n     if err != nil {\n    // TODO: Handle error.\n}\nfmt.Println(values)\n}\n</code></pre>\n\n<p>Place rows into slice as you can store a row using anything that implements the <code>ValueLoader interface</code>, or with a slice or map of <code>bigquery.Value</code></p>\n\n<p>ref: <a href=\"https://godoc.org/cloud.google.com/go/bigquery\" rel=\"nofollow noreferrer\">godocs bq</a></p>\n"}], "owner": {"reputation": 431, "user_id": 1921782, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/823dff64d1cd834b6090497b3328c4d7?s=128&d=identicon&r=PG", "display_name": "RDs", "link": "https://stackoverflow.com/users/1921782/rds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1196, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1549903585, "creation_date": 1549898052, "last_edit_date": 1549898333, "question_id": 54633599, "link": "https://stackoverflow.com/questions/54633599/read-bq-query-result-without-struct", "title": "Read BQ query result without struct", "body": "<p>Has anybody tried storing result from a query to a map?\nI want to able to read data from BQ tables without having the need to define a struct that matches the BQ table schema.</p>\n\n<p>I have tried following <a href=\"https://kylewbanks.com/blog/query-result-to-map-in-golang\" rel=\"nofollow noreferrer\">https://kylewbanks.com/blog/query-result-to-map-in-golang</a>, but I want to use a RowIterator instead of the approach in this link.</p>\n\n<p>Here's the code I am struggling with:</p>\n\n<pre><code>//Removed error handling for brewity \nctx := context.Background()\nclient, _ := bigquery.NewClient(ctx, ProjectID)\nquery := fmt.Sprintf(\"SELECT * FROM `%s.%s.%s` LIMIT 5;\", ProjectID, DatasetId, ResourceName)\nqueryResult := client.Query(query)\nit, _ := queryResult.Read(ctx)\n\nfor {\n    row := make(map[string]bigquery.Value)\n    err := it.Next(&amp;row)\n    if err == iterator.Done {\n        break\n    }\n    if err != nil {\n        fmt.Printf(\"Error happened\")\n    }}\n</code></pre>\n\n<p>I am not sure how to proceed after this, I would ideally like to convert the data into a JSON format.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1549887393, "post_id": 54630240, "comment_id": 96052953, "body": "If two things do <i>not</i> have the same dependencies and each should have it&#39;s own go.mod. The go.mod contains <i>the</i> dependencies and not just <i>some</i> (read &quot;unrelated&quot;, &quot;old&quot;, and &quot;copy-past-leftovers&quot;) dependencies."}], "answers": [{"comments": [{"owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "edited": false, "score": 0, "creation_date": 1550097704, "post_id": 54632974, "comment_id": 96150004, "body": "Yeah, eventually that&#39;s what I did :) Thanks!"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 5, "last_activity_date": 1549896022, "creation_date": 1549896022, "answer_id": 54632974, "question_id": 54630240, "link": "https://stackoverflow.com/questions/54630240/go-modules-multiple-main-methods/54632974#54632974", "title": "go modules multiple main methods", "body": "<p>I believe you're looking for <em>submodules</em>. See <a href=\"https://github.com/go-modules-by-example/index/tree/master/009_submodules\" rel=\"noreferrer\">this walktrhough</a>.</p>\n\n<p>TLDR: you'll want a separate <code>go.mod</code> in each of your tools's <code>cmd</code> dir, and you can use the <code>replace</code> directive to point dependncies from these tools to your local module.</p>\n\n<p><a href=\"https://github.com/golang/go/issues/27542\" rel=\"noreferrer\">This Go Issue</a> and others linked from it suggest that figuring out \"the one right way\" to do this is still WIP, though I think your use case is simple enough.</p>\n"}], "owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1292, "favorite_count": 0, "accepted_answer_id": 54632974, "answer_count": 1, "score": 2, "last_activity_date": 1549896022, "creation_date": 1549886678, "question_id": 54630240, "link": "https://stackoverflow.com/questions/54630240/go-modules-multiple-main-methods", "title": "go modules multiple main methods", "body": "<p>I have a project with mutliple main methods.\nWhen running <code>go build program1/main1.go</code> which has a different set of dependencies than <code>program2/main2.go</code>, my first <code>go build</code> seems to alter my <code>go.mod</code> file and removes the dependencies it <em>thinks</em> it does not need. Yet <code>main2</code> would need these dependencies.</p>\n\n<p>I've tried using <code>go build ...</code> but that also created a different set of dependencies. Specifically, it seems like all the <code>//indirect</code> dependencies get removed and cause program2 to fail.</p>\n\n<p>Is there a way of running <code>go build</code> or <code>go run</code> without updating the <code>go.mod</code> file? Using <code>go build -mod=readonly program1/main1.go</code> it tells me that it fails because the dependencies need to be updated..</p>\n"}, {"tags": ["image", "go", "image-processing"], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 6442285, "user_type": "registered", "profile_image": "https://graph.facebook.com/1208416005846601/picture?type=large", "display_name": "Michele Riva", "link": "https://stackoverflow.com/users/6442285/michele-riva"}, "edited": false, "score": 0, "creation_date": 1549885084, "post_id": 54629573, "comment_id": 96051616, "body": "Thank you so much @icza, the explanation is extremely clear! Now it seems that the PNG transparent layer is converted to black, so merging multiple images results with a black image with the last layer printed on it."}, {"owner": {"reputation": 493, "user_id": 6442285, "user_type": "registered", "profile_image": "https://graph.facebook.com/1208416005846601/picture?type=large", "display_name": "Michele Riva", "link": "https://stackoverflow.com/users/6442285/michele-riva"}, "edited": false, "score": 0, "creation_date": 1549885138, "post_id": 54629573, "comment_id": 96051640, "body": "My fault, I used <code>draw.Src</code> instead of <code>draw.Over</code>. Thank you again!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 493, "user_id": 6442285, "user_type": "registered", "profile_image": "https://graph.facebook.com/1208416005846601/picture?type=large", "display_name": "Michele Riva", "link": "https://stackoverflow.com/users/6442285/michele-riva"}, "edited": false, "score": 1, "creation_date": 1549885301, "post_id": 54629573, "comment_id": 96051729, "body": "@MicheleRiva Yes, you have to use <code>draw.Over</code>. For a nice introduction, see blog post: <a href=\"https://blog.golang.org/go-imagedraw-package\" rel=\"nofollow noreferrer\">The Go image/draw package</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1549885405, "last_edit_date": 1549885405, "creation_date": 1549884431, "answer_id": 54629573, "question_id": 54629463, "link": "https://stackoverflow.com/questions/54629463/merge-multiple-images-in-go/54629573#54629573", "title": "Merge multiple images in Go", "body": "<p>In your first loop where you load the images, you also create a new, empty image and you store this empty image in <code>decodedImages</code>. And then you iterate over these empty images and combine them.</p>\n\n<p>Instead you should store the loaded images in <code>decodedImages</code>:</p>\n\n<pre><code>for i, img := range images {\n    decodedImages[i] = openAndDecode(\"./imgs/\" + img + \".png\")\n}\n</code></pre>\n\n<p>For this to work, declare <code>decodedImages</code> to be a slice of <code>image.Image</code> (since <code>openAndDecode()</code> returns a value of type <code>image.Image</code>):</p>\n\n<pre><code>var decodedImages = make([]image.Image, len(images))\n</code></pre>\n\n<p>Also, whenever you open a file and check the error, you should defer close it right after so if subsequent code fails, the file would still get closed.</p>\n\n<p>Also to \"combine\" images with an alpha channel, you should use <code>draw.Over</code> operator. Quoting from the blog post: <a href=\"https://blog.golang.org/go-imagedraw-package\" rel=\"nofollow noreferrer\">The Go Blog: The Go image/draw package</a>:</p>\n\n<blockquote>\n  <p>The <code>Over</code> operator performs the natural layering of a source image over a destination image: the change to the destination image is smaller where the source (after masking) is more transparent (that is, has lower alpha). The <code>Src</code> operator merely copies the source (after masking) with no regard for the destination image's original content. For fully opaque source and mask images, the two operators produce the same output, but the <code>Src</code> operator is usually faster.</p>\n</blockquote>\n"}], "owner": {"reputation": 493, "user_id": 6442285, "user_type": "registered", "profile_image": "https://graph.facebook.com/1208416005846601/picture?type=large", "display_name": "Michele Riva", "link": "https://stackoverflow.com/users/6442285/michele-riva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 990, "favorite_count": 0, "accepted_answer_id": 54629573, "answer_count": 1, "score": 2, "last_activity_date": 1569846325, "creation_date": 1549884064, "last_edit_date": 1569839982, "question_id": 54629463, "link": "https://stackoverflow.com/questions/54629463/merge-multiple-images-in-go", "title": "Merge multiple images in Go", "body": "<p>I am trying to merge an array of N images (where N will be a dynamic value) with Go, but I always get a black image as result.</p>\n\n<p>Here you are my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"image\"\n    \"image/draw\"\n    \"image/jpeg\"\n    \"image/png\"\n    \"log\"\n    \"os\"\n)\n\nfunc openAndDecode(imgPath string) image.Image {\n    img, err := os.Open(imgPath)\n    if err != nil {\n        log.Fatalf(\"Failed to open %s\", err)\n    }\n\n    decoded, err := png.Decode(img)\n    if err != nil {\n        log.Fatalf(\"Failed to decode %s\", err)\n    }\n    defer img.Close()\n\n    return decoded\n}\n\nfunc main () {\n    var images = [4]string{\"background\", \"shadow\", \"item1 \", \"item2\"}\n    var decodedImages = [4]*image.RGBA{}\n\n    for i, img := range images {\n        decodedImage := openAndDecode(\"./imgs/\" + img + \".png\")\n        bounds := decodedImage.Bounds()\n        newImg := image.NewRGBA(bounds)\n        decodedImages[i] = newImg\n    }\n\n    bounds := decodedImages[0].Bounds()\n    newImage := image.NewRGBA(bounds)\n\n    for _, img := range decodedImages {\n        draw.Draw(newImage, img.Bounds(), img, image.ZP, draw.Src)\n    }\n\n    result, err := os.Create(\"result.jpg\")\n    if err != nil {\n        log.Fatalf(\"Failed to create: %s\", err)\n    }\n\n    jpeg.Encode(result, newImage, &amp;jpeg.Options{jpeg.DefaultQuality})\n    defer result.Close()\n}\n</code></pre>\n\n<p>I am pretty new to Go and I can't find out where I am wrong.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 3, "creation_date": 1549883601, "post_id": 54629237, "comment_id": 96050820, "body": "How about this: <a href=\"https://stackoverflow.com/a/38579502/4636715\">stackoverflow.com/a/38579502/4636715</a>"}, {"owner": {"reputation": 11661, "user_id": 277267, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/F0Dwz.png?s=128&g=1", "display_name": "Daniel F", "link": "https://stackoverflow.com/users/277267/daniel-f"}, "reply_to_user": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1549883882, "post_id": 54629237, "comment_id": 96050977, "body": "@vahdet Yes! The wording is my problem, I wouldn&#39;t have found that question."}], "answers": [{"comments": [{"owner": {"reputation": 11661, "user_id": 277267, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/F0Dwz.png?s=128&g=1", "display_name": "Daniel F", "link": "https://stackoverflow.com/users/277267/daniel-f"}, "edited": false, "score": 1, "creation_date": 1549883761, "post_id": 54629304, "comment_id": 96050917, "body": "Ah, nice, so the iteration is similar to how it would have been done in C."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 11661, "user_id": 277267, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/F0Dwz.png?s=128&g=1", "display_name": "Daniel F", "link": "https://stackoverflow.com/users/277267/daniel-f"}, "edited": false, "score": 0, "creation_date": 1549902347, "post_id": 54629304, "comment_id": 96061967, "body": "You will find that go is often similar to C in that matter. The main differences are that the syntax is more modern and the standard library is much better"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 1, "last_activity_date": 1549883557, "creation_date": 1549883557, "answer_id": 54629304, "question_id": 54629237, "link": "https://stackoverflow.com/questions/54629237/iterate-array-of-string-pairwise-to-create-a-map/54629304#54629304", "title": "Iterate array of string pairwise to create a map", "body": "<p>You can write your own function, something like that:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar myarr = []string{\"key1\", \"val1\", \"key2\", \"val2\"}\n\nfunc mapify(kv []string) map[string]string {\n    mymap := make(map[string]string)\n\n    for i := 0; i+1 &lt;= len(kv); i = i + 2 {\n        mymap[kv[i]] = kv[i+1]\n    }\n\n    return mymap\n}\n\nfunc main() {\n    fmt.Println(myarr)\n    fmt.Println(mapify(myarr))\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<blockquote>\n<pre><code>[key1 val1 key2 val2]\nmap[key1:val1 key2:val2]\n</code></pre>\n</blockquote>\n\n<p><a href=\"https://goplay.space/#rUPRdlHO55u\" rel=\"nofollow noreferrer\">Try it here</a></p>\n"}], "owner": {"reputation": 11661, "user_id": 277267, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/F0Dwz.png?s=128&g=1", "display_name": "Daniel F", "link": "https://stackoverflow.com/users/277267/daniel-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "closed_date": 1549883660, "accepted_answer_id": 54629304, "answer_count": 1, "score": -2, "last_activity_date": 1549884105, "creation_date": 1549883328, "last_edit_date": 1549884105, "question_id": 54629237, "link": "https://stackoverflow.com/questions/54629237/iterate-array-of-string-pairwise-to-create-a-map", "closed_reason": "Duplicate", "title": "Iterate array of string pairwise to create a map", "body": "<p>I have an array of strings whose length is always a multiple of two.</p>\n\n<p>I want to create a map out of this array, so that</p>\n\n<pre><code>myarr = [\"key1\", \"val1\", \"key2\", \"val2\", ...]\n</code></pre>\n\n<p>becomes a map where</p>\n\n<pre><code>mymap := mapify(myarr)\nmymap['key1'] == \"val1\"\nmymap['key2'] == \"val2\"\n</code></pre>\n\n<p>In Python I can do this with the following code</p>\n\n<pre><code>mymap = {}\nfor x, y in zip(*[iter(myarr)]*2):\n  mymap[x] = y\n</code></pre>\n"}, {"tags": ["go", "sqlite", "go-xorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549887426, "post_id": 54628679, "comment_id": 96052982, "body": "<a href=\"https://godoc.org/github.com/go-xorm/xorm#hdr-Create_Engine\" rel=\"nofollow noreferrer\">godoc.org/github.com/go-xorm/xorm#hdr-Create_Engine</a> says <i>&quot;Generally, one engine for an application is enough.&quot;</i> So to answer your question <i>&quot;is it right way?&quot;</i>. No it&#39;s not."}, {"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1549888899, "post_id": 54628679, "comment_id": 96053821, "body": "Yes that&#39;s all, now I don&#39;t need to close engine?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1549890372, "post_id": 54628679, "comment_id": 96054664, "body": "If you want you can close the engine at the bottom of your app&#39;s <code>main</code> function, or at the top using <code>defer</code>. But my guess is that you don&#39;t have to, when your app exits any db connections that it created should be discarded... at least that&#39;s how it works with postgres and database/sql, i&#39;m not sure about sqlite3 with xorm."}, {"owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1549907014, "post_id": 54628679, "comment_id": 96064500, "body": "@MKOPriva thank you for information. I w&#39;ll try"}], "owner": {"reputation": 113, "user_id": 11034459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6dfed6ee23f471803b4387372ac33cf?s=128&d=identicon&r=PG&f=1", "display_name": "Zola Man", "link": "https://stackoverflow.com/users/11034459/zola-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549886367, "creation_date": 1549881618, "last_edit_date": 1549886367, "question_id": 54628679, "link": "https://stackoverflow.com/questions/54628679/do-i-need-to-close-sqlite3-database-connection-in-xorm", "title": "Do I need to close sqlite3 database connection in XORM?", "body": "<p>I use <code>https://github.com/go-xorm/xorm</code> for my Go software to handle database connection.</p>\n\n<p>In every function I use call initdb to get new xorm database session (is it right way?)</p>\n\n<pre><code>func InitDb() (*xorm.Session, error) {\n\n  // Create new engine\n  engine, err := xorm.NewEngine(\"sqlite3\",  \"Database.db\")\n\n  // This is right?\n  // defer engine.Close()\n\n  // Create session\n  session := engine.NewSession()\n\n  // What about this?\n  //defer session.Close()\n\n  return session, err\n}\n\nfunc Hello(){\ndb := InitDb()\n// Or should close database session here?\n//defer db.Close()\n\n}\n</code></pre>\n"}, {"tags": ["go", "inotify"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1549881236, "post_id": 54628258, "comment_id": 96049385, "body": "If you comment out all the code except <code>log.Println</code> in the <code>case ev := &lt;-watcher.Event:</code> branch, \u2014 does the problem still manifest itself?"}], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": false, "score": 0, "last_activity_date": 1549884159, "creation_date": 1549884159, "answer_id": 54629488, "question_id": 54628258, "link": "https://stackoverflow.com/questions/54628258/golang-fsnotify-sends-multiple-events-for-same-file-on-windows/54629488#54629488", "title": "Golang fsnotify sends multiple events for same file on Windows", "body": "<p>First off: <code>*fsnotify.FileEvent</code> indicates you are using an old version of the fsnotify package, change your dependency to: <code>github.com/fsnotify/fsnotify</code>.</p>\n\n<p>I don't have a Windows machine to test on, so I can't guarantee that this will fix your problem. But looks to me, that the later file modifications are attribute changes.</p>\n\n<p>Watching only the renames to other than *.tmp and *.crdownload should be enough to print your files, since your <code>RawFileToPrinter.exe</code> shouldn't care that the file was being downloaded from the internet or whatever attributes are beeing set after finishing your download.</p>\n"}], "owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1303, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549884159, "creation_date": 1549880252, "question_id": 54628258, "link": "https://stackoverflow.com/questions/54628258/golang-fsnotify-sends-multiple-events-for-same-file-on-windows", "title": "Golang fsnotify sends multiple events for same file on Windows", "body": "<p>I am writing a simple golang script to monitor Downloads folder on Windows. The idea is that whenever a new file gets downloaded it will be sent to printer. This works mostly as expected. Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"fmt\"\n    \"github.com/howeyc/fsnotify\"\n    \"os/exec\"\n)\n\nfunc main() {\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    done := make(chan bool)\n\n    // Process events\n    go func() {\n        for {\n            select {\n            case ev := &lt;-watcher.Event:\n                log.Println(\"event:\", ev)\n                c := exec.Command(\"cmd\", \"/C\", \"RawFileToPrinter.exe\", ev.Name)\n                if err := c.Run(); err != nil {\n                    fmt.Println(\"Error: \", err)\n                }\n\n            case err := &lt;-watcher.Error:\n                log.Println(\"error:\", err)\n            }\n        }\n    }()\n\n    err = watcher.Watch(\"C:\\\\Users\\\\admin\\\\Downloads\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Hang so program doesn't exit\n    &lt;-done\n\n    /* ... do stuff ... */\n    watcher.Close()\n}\n</code></pre>\n\n<p>Unfortunately I find that multiple events are sent for the same file as shown in the following log:</p>\n\n<pre><code>2019/02/11 15:34:26 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": CREATE\n(*fsnotify.FileEvent)(0x10e821c0)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": CREATE)\n2019/02/11 15:34:37 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": MODIFY\n(*fsnotify.FileEvent)(0x10e821d0)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": MODIFY)\n2019/02/11 15:34:40 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": RENAME\n(*fsnotify.FileEvent)(0x10e821e0)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\0fcc8a09-9c51-4c5e-a77c-d4f111f6931f.tmp\": RENAME)\n2019/02/11 15:34:41 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt.crdownload\": RENAME\n(*fsnotify.FileEvent)(0x10e821f0)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt.crdownload\": RENAME)\n2019/02/11 15:34:42 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt.crdownload\": RENAME\n(*fsnotify.FileEvent)(0x10e82200)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt.crdownload\": RENAME)\n2019/02/11 15:34:44 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": RENAME\n(*fsnotify.FileEvent)(0x10e82210)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": RENAME)\n2019/02/11 15:34:46 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY\n(*fsnotify.FileEvent)(0x10e82220)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY)\n2019/02/11 15:34:47 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY\n(*fsnotify.FileEvent)(0x10e82230)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY)\n2019/02/11 15:34:48 event: \"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY\n(*fsnotify.FileEvent)(0x10e82240)(\"C:\\\\Users\\\\admin\\\\Downloads\\\\Generico-Bill-MULW-132482.txt\": MODIFY)\n</code></pre>\n\n<p>This causes same file to be printed multiple times. The exe ignores *.tmp and *.crdownload. Is it possible to get a single event? If not how do I handle this condition? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549887012, "post_id": 54628252, "comment_id": 96052703, "body": "Are you sure that <code>serverPort</code> is the correct hostname? Seems odd to me, especially since the title says you want to connect to <code>localhost</code>."}, {"owner": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549887622, "post_id": 54628252, "comment_id": 96053083, "body": "@Peter my project is on localserver but I want to connect that project to the remote server"}, {"owner": {"reputation": 301, "user_id": 2705804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7UB7l.jpg?s=128&g=1", "display_name": "suraj-kumar-adhikari", "link": "https://stackoverflow.com/users/2705804/suraj-kumar-adhikari"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549903644, "post_id": 54628252, "comment_id": 96062761, "body": "@Peter If you check correctly <code>serverPort</code> is DB port not hostname. <code>SqlServerPort</code> is correct hostname and being replaced with constant."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 301, "user_id": 2705804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7UB7l.jpg?s=128&g=1", "display_name": "suraj-kumar-adhikari", "link": "https://stackoverflow.com/users/2705804/suraj-kumar-adhikari"}, "edited": false, "score": 0, "creation_date": 1549904473, "post_id": 54628252, "comment_id": 96063268, "body": "@surajprogrammez, the error message clearly shows that <code>serverPort:3306</code> is being dialed, so <code>SqlServerPort</code> is set to <code>&quot;serverPort&quot;</code> (or some value that implements fmt.Stringer)."}, {"owner": {"reputation": 301, "user_id": 2705804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7UB7l.jpg?s=128&g=1", "display_name": "suraj-kumar-adhikari", "link": "https://stackoverflow.com/users/2705804/suraj-kumar-adhikari"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549910878, "post_id": 54628252, "comment_id": 96066364, "body": "@Peter yes so most probably he has <code>serverPort</code> as value of <code>SqlServerPort</code> instead of IP/DNS of database server"}], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 2705804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7UB7l.jpg?s=128&g=1", "display_name": "suraj-kumar-adhikari", "link": "https://stackoverflow.com/users/2705804/suraj-kumar-adhikari"}, "edited": false, "score": 0, "creation_date": 1549903459, "post_id": 54632583, "comment_id": 96062650, "body": "He&#39;s replacing it with <code>SqlServerPort</code> he might have this constant defined somewhere but this is not the problem as far as I see. <code>dial tcp serverPort:3306: connect: connection timed out</code> Connection is timing out so this means something is wrong with DB server since the request is just being timed out."}, {"owner": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "edited": false, "score": 0, "creation_date": 1549939700, "post_id": 54632583, "comment_id": 96075801, "body": "@eliBendersky I&#39;m giving the proper address but I don&#39;t want to connect it with local server I want to connect it with the remote server but it will gives me the error of time out."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "edited": false, "score": 0, "creation_date": 1549941712, "post_id": 54632583, "comment_id": 96076229, "body": "@puneet55667788: are you sure you&#39;re giving the proper address? Print the values of all <code>Sql*</code> vars before the <code>sql.Open</code> statement is executing. Also you keep repeating &quot;I don&#39;t want to connect it with local server I want to connect it with the remote server&quot; but I have no idea what that means, sorry. Can you rephrase?"}, {"owner": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "edited": false, "score": 0, "creation_date": 1549943829, "post_id": 54632583, "comment_id": 96076692, "body": "@EliBendersky it means that I want to connect remote server sql database which is having a unique address with my code which is running on local server."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "edited": false, "score": 0, "creation_date": 1549978506, "post_id": 54632583, "comment_id": 96093902, "body": "@puneet55667788: that&#39;s what I understood. Look at the last line in my answer. I think your <code>SqlServerPort</code> has a bad value, probably <code>serverPort:3306</code>. <code>serverPort</code> is not a valid remote host address - you have to populate this variable with a valid one. Try to print out all your variables used in building the connection"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1549894832, "creation_date": 1549894832, "answer_id": 54632583, "question_id": 54628252, "link": "https://stackoverflow.com/questions/54628252/how-to-make-connection-with-mysql-server-on-localhost/54632583#54632583", "title": "How to make connection with mysql server on localhost?", "body": "<p>If you're trying to connect to a <em>remote</em> server you need its full address:</p>\n\n<pre><code>&lt;username&gt;:&lt;pw&gt;@tcp(&lt;HOST&gt;:&lt;port&gt;)/&lt;dbname&gt;\n</code></pre>\n\n<p>In your example I don't see the host anywhere, so it tries to connect to a server running on localhost (with port given by <code>SqlServerPort</code>).</p>\n\n<p><a href=\"http://go-database-sql.org/accessing.html\" rel=\"nofollow noreferrer\">A simple connection example</a>:</p>\n\n<pre><code>func main() {\n    db, err := sql.Open(\"mysql\",\n        \"user:password@tcp(127.0.0.1:3306)/hello\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<p>You'll need to replace <code>127.0.0.1</code> with the actual IP address (or hostname) of your remote server.</p>\n"}], "owner": {"reputation": 111, "user_id": 10493731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b24a7b83c1e4fcffbea7e0c4266ecefa?s=128&d=identicon&r=PG&f=1", "display_name": "puneet55667788", "link": "https://stackoverflow.com/users/10493731/puneet55667788"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549894832, "creation_date": 1549880247, "question_id": 54628252, "link": "https://stackoverflow.com/questions/54628252/how-to-make-connection-with-mysql-server-on-localhost", "title": "How to make connection with mysql server on localhost?", "body": "<p>I want to make a new connection with the sql server on localhost so that I can able to get the data from the sql server. but there is some problem while doing connection.</p>\n\n<p>error :- <code>[mysql] 2019/02/11 15:30:00 driver.go:81: net.Error from Dial()': dial tcp serverPort:3306: connect: connection timed out</code></p>\n\n<p>And the code I'm using is </p>\n\n<pre><code>func ConnectMsqlDb() (db *sql.DB, err error) {\ndb, err = sql.Open(\"mysql\", \n    fmt.Sprintf(\"%s:%s@tcp(%s:\"+SqlDbPort+\")/\"+SqlDatabase, \n    SqlUsername, SqlPassword, SqlServerPort))\nfmt.Println(\"OPEN\", db, err)\nif err != nil {\n    return nil, err\n}\n//defer db.Close()\nfmt.Println(\"PING:-\", err)\nerr = db.Ping()\nfmt.Println(\"PING:-\", err)\nif err != nil {\n    return nil, err\n}\nreturn db, nil\n}     \n</code></pre>\n\n<p>Can you help me to get out from this problem?</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "is_accepted": false, "score": 0, "last_activity_date": 1549878542, "creation_date": 1549878542, "answer_id": 54627741, "question_id": 54627656, "link": "https://stackoverflow.com/questions/54627656/what-happens-if-we-reassign-database-sql-rows-object-to-a-result-of-new-query/54627741#54627741", "title": "What happens if we reassign database/sql rows object to a result of new Query()? Does it close it automatically? Or should we close it ourselves?", "body": "<p>How about calling <code>Rows.Close()</code> *before<code>you assign to</code>rows` again?</p>\n\n<p>And no, <code>Rows.Close()</code> is not automatically called by a reassignment. If you do several <em>different</em> queries, use <em>different</em> variables to hold the rows returned by each. Call <code>defer rows.Close()</code> for each after assigning.</p>\n"}, {"tags": [], "owner": {"reputation": 132, "user_id": 6922184, "user_type": "registered", "profile_image": "https://graph.facebook.com/1395223827157742/picture?type=large", "display_name": "Yurii Kovalenko", "link": "https://stackoverflow.com/users/6922184/yurii-kovalenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1549966860, "creation_date": 1549966860, "answer_id": 54647786, "question_id": 54627656, "link": "https://stackoverflow.com/questions/54627656/what-happens-if-we-reassign-database-sql-rows-object-to-a-result-of-new-query/54647786#54647786", "title": "What happens if we reassign database/sql rows object to a result of new Query()? Does it close it automatically? Or should we close it ourselves?", "body": "<p>You need to call <code>rows.Close()</code> before each reassignment. By this way you will free memory from contents of \"rows\" pointer.\nAlso, be careful with <code>defer rows.Close()</code>, because:</p>\n\n<ol>\n<li>You'll free rows only at function end, not immediately. Just keep this in mind.</li>\n<li>If <code>rows</code> is not a pointer - it will call <code>Close()</code> only for last assigned object.</li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 11044411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/318ba9da1d22f1b4c0ea7f37812bd981?s=128&d=identicon&r=PG&f=1", "display_name": "Jem Maratov", "link": "https://stackoverflow.com/users/11044411/jem-maratov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549966860, "creation_date": 1549878227, "question_id": 54627656, "link": "https://stackoverflow.com/questions/54627656/what-happens-if-we-reassign-database-sql-rows-object-to-a-result-of-new-query", "title": "What happens if we reassign database/sql rows object to a result of new Query()? Does it close it automatically? Or should we close it ourselves?", "body": "<p>I'm working with postgresql using Golang, and I'm in a situation where I have to do several queries. If I store the results of each query in the same variable let's call it \"rows\", reassigning that variable each time to a new result of query, will it automatically close previous rows? Or should I each time close them manually? And if I should close them manually what happens if I defer rows.Close() each time? Is that so necessary? </p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 4129386, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2e3f2a58a1ddbed922e4076e6bddec36?s=128&d=identicon&r=PG&f=1", "display_name": "Blackout", "link": "https://stackoverflow.com/users/4129386/blackout"}, "is_accepted": true, "score": 5, "last_activity_date": 1549980285, "last_edit_date": 1549980285, "creation_date": 1549923592, "answer_id": 54640032, "question_id": 54627542, "link": "https://stackoverflow.com/questions/54627542/official-mongo-go-driver-using-sessions/54640032#54640032", "title": "Official mongo-go-driver using sessions", "body": "<p>The solution for my problem was found here: <a href=\"https://github.com/simagix/mongo-go-examples/blob/master/examples/transaction_test.go#L68\" rel=\"noreferrer\">https://github.com/simagix/mongo-go-examples/blob/master/examples/transaction_test.go#L68</a></p>\n\n<pre><code>if session, err = client.StartSession(); err != nil {\n        t.Fatal(err)\n    }\n    if err = session.StartTransaction(); err != nil {\n        t.Fatal(err)\n    }\n    if err = mongo.WithSession(ctx, session, func(sc mongo.SessionContext) error {\n        if result, err = collection.UpdateOne(sc, bson.M{\"_id\": id}, update); err != nil {\n            t.Fatal(err)\n        }\n        if result.MatchedCount != 1 || result.ModifiedCount != 1 {\n            t.Fatal(\"replace failed, expected 1 but got\", result.MatchedCount)\n        }\n\n        if err = session.AbortTransaction(sc); err != nil {\n            t.Fatal(err)\n        }\n        return nil\n    }); err != nil {\n        t.Fatal(err)\n    }\n    session.EndSession(ctx)\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 4129386, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2e3f2a58a1ddbed922e4076e6bddec36?s=128&d=identicon&r=PG&f=1", "display_name": "Blackout", "link": "https://stackoverflow.com/users/4129386/blackout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3643, "favorite_count": 1, "accepted_answer_id": 54640032, "answer_count": 1, "score": 0, "last_activity_date": 1586042507, "creation_date": 1549877821, "question_id": 54627542, "link": "https://stackoverflow.com/questions/54627542/official-mongo-go-driver-using-sessions", "title": "Official mongo-go-driver using sessions", "body": "<p>Is there any example of using sessions with official mongodb driver for golang? I am trying to use sessions to take advantage from transactions and it seems that just reading tests on github I can\u2019t find the way to do it.</p>\n\n<p>To be more specific I am struggling now with this:</p>\n\n<pre><code>session, err := pool.StartSession()                                              \n   if err != nil {                                                                  \n     log.Println(\"Could not create db session\", err)                                \n     return events.APIGatewayProxyResponse{                                         \n       Body:       err.Error(),                                                     \n       StatusCode: http.StatusInternalServerError,                                  \n     }, err                                                                         \n   }                                                                                \n   ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)          \n   defer cancel()                                                                   \n   defer session.EndSession(ctx)                                                    \n\n    var db *mongo.Database                                                           \n</code></pre>\n\n<p>Everything fine with code above but when I do:</p>\n\n<blockquote>\n  <p><code>db = session.Database(\"testrest\")</code></p>\n</blockquote>\n\n<p>It gives the error: </p>\n\n<blockquote>\n  <p>session.Database undefined (type mongo.Session has no field or method\n  Database)</p>\n</blockquote>\n\n<p>Which seems to work with mgo package\u2026 How do I select the database and run queries with session?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549880158, "post_id": 54628221, "comment_id": 96048664, "body": "Note: <code>InArray</code> code seems very far from idomatic Go code, but it is not part of the question."}, {"owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "edited": false, "score": 0, "creation_date": 1549880756, "post_id": 54628221, "comment_id": 96049050, "body": "Thank you leaf. You saved my time. But I need to ask one thing why I need to copy this thing. Because without copy if I print the newArr  before loop then it seems correct slice."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1549881063, "last_edit_date": 1549881063, "creation_date": 1549880121, "answer_id": 54628221, "question_id": 54627448, "link": "https://stackoverflow.com/questions/54627448/strange-behaviour-of-the-delete-element-within-nested-slice-in-golang/54628221#54628221", "title": "Strange behaviour of the delete element within nested slice in golang", "body": "<p>The code is not working as expected because all <code>newArr[day]</code> has a same underlying array as <code>newSpotsArr</code>. You need to make a copy of <code>newSportsArr</code> by make a new slice and copy data into it:</p>\n\n<pre><code>for _, day := range days {\n    newArr[day] = make([]int, len(newSpotsArr))\n    copy(newArr[day], newSpotsArr)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/kv-B9NnKqVd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kv-B9NnKqVd</a></p>\n\n<p>UPDATE:</p>\n\n<p><code>slice</code> in Go is a reference type. Under the hood, <code>slice</code> keeps 3 things: <code>len</code>,<code>cap</code>,and a <code>ptr</code>. The <code>ptr</code> is a pointer to a memory (underlying array). when you run <code>newArr[day]=newSpotsArr</code>, all three value is copied, which means, <code>newArr[day]</code> points to the same underlying array as <code>newSpotsArr</code>. So if you run <code>newSpotsArr[0]=-100</code>, all slices will see the that change.</p>\n\n<p>See also: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n"}], "owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 54628221, "answer_count": 1, "score": -2, "last_activity_date": 1549881063, "creation_date": 1549877466, "last_edit_date": 1549878649, "question_id": 54627448, "link": "https://stackoverflow.com/questions/54627448/strange-behaviour-of-the-delete-element-within-nested-slice-in-golang", "title": "Strange behaviour of the delete element within nested slice in golang", "body": "<p>I am working on a golang project. I am trying to maintain a slice from a existing slice where my new slice does not contain the existing slice element. I have tried the code like :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\" \n)\n\n\nfunc main(){\n    savedArr := make(map[string][]int)\n    newArr := make(map[string][]int)\n    days := []string{\"saturday\", \"friday\", \"sunday\"}\n    newSpotsArr := []int{10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 101}\n    savedArr[\"saturday\"] = []int{10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 101}\n    savedArr[\"friday\"] = []int{10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 101}\n    for _, day := range days{\n        newArr[day] = newSpotsArr\n    }\n    for day, newSpots := range newArr{\n        fmt.Println(\"day\", day)\n        fmt.Println(\"Top within loop\", newSpots)\n        for _, oldSpot := range savedArr[day]{\n            exists, idx := InArray(oldSpot, newSpots)\n            if exists {\n                newSpots = append(newSpots[:idx], newSpots[idx + 1:]...)\n            }\n        }\n        fmt.Println(\"Bottom within loop\", newSpots)\n    }\n}\n\nfunc InArray(val interface{}, array interface{}) (exists bool, index int) {\n    exists = false\n    index = -1\n    switch reflect.TypeOf(array).Kind() {\n        case reflect.Slice:\n            s := reflect.ValueOf(array)\n            for i := 0; i &lt; s.Len(); i++ {\n                if reflect.DeepEqual(val, s.Index(i).Interface()) == true {\n                    index = i\n                    exists = true\n                    return\n                }\n            }\n    }\n    return\n}\n</code></pre>\n\n<p>Its output is like: </p>\n\n<pre><code>day saturday\nTop within loop [10 20 30 40 50 60 70 80 90 100 101]\nBottom within loop []\nday friday\nTop within loop [101 101 101 101 101 101 101 101 101 101 101]\nBottom within loop [101 101 101 101 101 101 101 101 101 101]\nday sunday\nTop within loop [101 101 101 101 101 101 101 101 101 101 101]\nBottom within loop [101 101 101 101 101 101 101 101 101 101 101]\nfinalArr map[friday:[101 101 101 101 101 101 101 101 101 101] sunday:[101 101 101 101 101 101 101 101 101 101 101] saturday:[]]\n</code></pre>\n\n<p>I am  not able to understand how it is working. I was expecting its output should be like:</p>\n\n<pre><code>day saturday\nTop within loop [10 20 30 40 50 60 70 80 90 100 101]\nBottom within loop []\nday friday\nTop within loop [10 20 30 40 50 60 70 80 90 100 101]\nBottom within loop []\nday sunday\nTop within loop [10 20 30 40 50 60 70 80 90 100 101]\nBottom within loop [10 20 30 40 50 60 70 80 90 100 101]\nfinalArr map[friday:[] sunday:[10 20 30 40 50 60 70 80 90 100 101] saturday:[]]\n</code></pre>\n\n<p>Can anybody tell how it is working? \nAnd how I can achieve my desired output</p>\n"}, {"tags": ["parsing", "go", "cookies"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549874314, "post_id": 54626572, "comment_id": 96045474, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12756782/go-http-post-and-use-cookies\">Go HTTP Post and use Cookies</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549874660, "post_id": 54626572, "comment_id": 96045643, "body": "net/http.Request.Cookies does all you need, so what is the question?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549874951, "post_id": 54626572, "comment_id": 96045785, "body": "Also: Parsing a Set-Cookie HTTP header in itself does not help much in adding to a cookie jar."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10996129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/829627d137cbfbb3bbc602e62fbf215e?s=128&d=identicon&r=PG&f=1", "display_name": "gevageyo", "link": "https://stackoverflow.com/users/10996129/gevageyo"}, "edited": false, "score": 0, "creation_date": 1549874850, "post_id": 54626678, "comment_id": 96045745, "body": "I did that and cookie jar returns no cookies after the request."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11, "user_id": 10996129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/829627d137cbfbb3bbc602e62fbf215e?s=128&d=identicon&r=PG&f=1", "display_name": "gevageyo", "link": "https://stackoverflow.com/users/10996129/gevageyo"}, "edited": false, "score": 0, "creation_date": 1549876195, "post_id": 54626678, "comment_id": 96046386, "body": "@gevageyo If you have some code that doesn&#39;t work, you&#39;d better show us in the question. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 11, "user_id": 10996129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/829627d137cbfbb3bbc602e62fbf215e?s=128&d=identicon&r=PG&f=1", "display_name": "gevageyo", "link": "https://stackoverflow.com/users/10996129/gevageyo"}, "edited": false, "score": 0, "creation_date": 1549876828, "post_id": 54626678, "comment_id": 96046719, "body": "Is there some way to debug a jar to see all cookies inside?"}, {"owner": {"reputation": 11, "user_id": 10996129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/829627d137cbfbb3bbc602e62fbf215e?s=128&d=identicon&r=PG&f=1", "display_name": "gevageyo", "link": "https://stackoverflow.com/users/10996129/gevageyo"}, "edited": false, "score": 0, "creation_date": 1549876985, "post_id": 54626678, "comment_id": 96046817, "body": "I think it&#39;s the problem with cookiejar implementation. See this: <a href=\"http://jcla1.com/blog/improving-go-cookie-handling\" rel=\"nofollow noreferrer\">jcla1.com/blog/improving-go-cookie-handling</a>"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 2, "last_activity_date": 1549874533, "creation_date": 1549874533, "answer_id": 54626678, "question_id": 54626572, "link": "https://stackoverflow.com/questions/54626572/parsing-set-cookie-header-in-go/54626678#54626678", "title": "Parsing set-cookie header in go", "body": "<p>It's not expected that you construct a cookie jar manually. Instead pass an <code>http.CookieJar</code> interface to an <code>http.Client</code> when making the request and the cookies will be automatically handled for you.</p>\n\n<p>More information in <a href=\"https://stackoverflow.com/questions/31270461/what-is-the-difference-between-cookie-and-cookiejar\">this SO answer</a></p>\n\n<p>Essentially you would use the http client, and the cookiejar implementation here:\n<a href=\"https://golang.org/pkg/net/http/cookiejar/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/cookiejar/</a></p>\n\n<p>To do something like:</p>\n\n<pre><code>// All users of cookiejar should import \"golang.org/x/net/publicsuffix\"\njar, err := cookiejar.New(&amp;cookiejar.Options{PublicSuffixList: publicsuffix.List})\nif err != nil {\n        log.Fatal(err)\n}\n\nclient := &amp;http.Client{\n        Jar: jar,\n}\n</code></pre>\n\n<p>Example taken from here:\n<a href=\"https://golang.org/pkg/net/http/cookiejar/#example_New\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/cookiejar/#example_New</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9970411, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ug2EHmCDWk4/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2ZfrLpZ55J6fcxtkI5hM_X1wWO2w/mo/photo.jpg?sz=128", "display_name": "vishal pandey", "link": "https://stackoverflow.com/users/9970411/vishal-pandey"}, "is_accepted": false, "score": 0, "last_activity_date": 1567182433, "creation_date": 1567182433, "answer_id": 57730287, "question_id": 54626572, "link": "https://stackoverflow.com/questions/54626572/parsing-set-cookie-header-in-go/57730287#57730287", "title": "Parsing set-cookie header in go", "body": "<p>Needs to be HTTP/S call to work with cookieJar, try setting the URL.Scheme to HTTP. Should work</p>\n"}], "owner": {"reputation": 11, "user_id": 10996129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/829627d137cbfbb3bbc602e62fbf215e?s=128&d=identicon&r=PG&f=1", "display_name": "gevageyo", "link": "https://stackoverflow.com/users/10996129/gevageyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1057, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1567182433, "creation_date": 1549874077, "last_edit_date": 1549874530, "question_id": 54626572, "link": "https://stackoverflow.com/questions/54626572/parsing-set-cookie-header-in-go", "title": "Parsing set-cookie header in go", "body": "<p>I want to parse cookies returned by a POST request into a cookie jar but I can't find any documentation on this. Are there some good packages or so out there? Or how do I do it?</p>\n\n<p>Edit: it's not a duplicate. I am asking about parsing cookies returned by set-cookie, not sending cookies just by sending.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1549871873, "post_id": 54625867, "comment_id": 96044346, "body": "Who&#39;s &quot;they&quot; and where do they return that? SQL, the language, not just SQL Server, doesn&#39;t have <code>nil</code>. <i>Your</i> code though seems to return that value in case of error, without even checking what that error is"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549872659, "post_id": 54625867, "comment_id": 96044717, "body": "Aren&#39;t you missing <code>WHERE SequenceID = ?</code> in your sql string? Anyway that&#39;s just a guess, you should really just log the error that&#39;s returned from <code>row.Scan</code>, that way you&#39;ll know what you&#39;re doing wrong."}, {"owner": {"reputation": 5, "user_id": 10470905, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JRHeV4uN55Q/AAAAAAAAAAI/AAAAAAAAADE/QCdNoviqFPs/photo.jpg?sz=128", "display_name": "Devo Avidianto Pratama", "link": "https://stackoverflow.com/users/10470905/devo-avidianto-pratama"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1549873062, "post_id": 54625867, "comment_id": 96044932, "body": "@mkopriva I have correct that code with \t\trow := db.QueryRow(&quot;select SequenceID, MobilePhone, Output, WillBeSentDate, SentDate, Status, DtmUpd from SMSBlast2 where SequenceID = ?;&quot;,SequenceID) , but still display nil"}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1549873295, "post_id": 54625867, "comment_id": 96045035, "body": "@DevoAvidiantoPratama it&#39;s <i>your</i> code that does that, if there&#39;s any error. You should modify your code to at least log the error, not just return an emtpy result. You already had a syntax error that would prevent your query from running. The error message would have explained that."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1549873372, "post_id": 54625867, "comment_id": 96045071, "body": "@DevoAvidiantoPratama test the query using SSMS or ADS or any other database client tool you want before you write your code. If you can&#39;t run a query directly, you won&#39;t be able to run it using your own code"}, {"owner": {"reputation": 5, "user_id": 10470905, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JRHeV4uN55Q/AAAAAAAAAAI/AAAAAAAAADE/QCdNoviqFPs/photo.jpg?sz=128", "display_name": "Devo Avidianto Pratama", "link": "https://stackoverflow.com/users/10470905/devo-avidianto-pratama"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1549878071, "post_id": 54625867, "comment_id": 96047472, "body": "I test my query in SSMS , query is working , but after implementing in code is not display json @PanagiotisKanavos"}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 10470905, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JRHeV4uN55Q/AAAAAAAAAAI/AAAAAAAAADE/QCdNoviqFPs/photo.jpg?sz=128", "display_name": "Devo Avidianto Pratama", "link": "https://stackoverflow.com/users/10470905/devo-avidianto-pratama"}, "edited": false, "score": 0, "creation_date": 1549878104, "post_id": 54626334, "comment_id": 96047492, "body": "that correct thank you , I forget to delete db.ping()"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1549872935, "creation_date": 1549872935, "answer_id": 54626334, "question_id": 54625867, "link": "https://stackoverflow.com/questions/54625867/why-after-i-connect-to-sql-server-with-library-golang-go-mssqldb-it-prints-nil/54626334#54626334", "title": "why after I connect to sql server with library golang go-mssqldb, it prints &lt;nil&gt;?", "body": "<blockquote>\n<pre><code>    fmt.Println(db.Ping())\n</code></pre>\n</blockquote>\n\n<p>Prints the error returned by <code>db.Ping()</code>, which normally is <code>nil</code>.</p>\n"}], "owner": {"reputation": 5, "user_id": 10470905, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-JRHeV4uN55Q/AAAAAAAAAAI/AAAAAAAAADE/QCdNoviqFPs/photo.jpg?sz=128", "display_name": "Devo Avidianto Pratama", "link": "https://stackoverflow.com/users/10470905/devo-avidianto-pratama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1597309169, "creation_date": 1549870690, "last_edit_date": 1597309169, "question_id": 54625867, "link": "https://stackoverflow.com/questions/54625867/why-after-i-connect-to-sql-server-with-library-golang-go-mssqldb-it-prints-nil", "title": "why after I connect to sql server with library golang go-mssqldb, it prints &lt;nil&gt;?", "body": "<p>After I connect to sql server, it prints <code>&lt;nil&gt;</code> , what is wrong with my code or is there a problem with my connection to sql server because they just print <code>&lt;nil&gt;</code>?</p>\n<p>Error screenshot:</p>\n<p><a href=\"https://i.stack.imgur.com/OUSJc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OUSJc.png\" alt=\"enter image description here\" /></a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;database/sql&quot;\n    &quot;fmt&quot;\n    _ &quot;github.com/denisenkom/go-mssqldb&quot;\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;net/http&quot;\n)\n\nfunc main()  {\n    db, err :=  sql.Open(&quot;sqlserver&quot;,&quot;sqlserver://sa:@localhost:1433?database=CONFINS&amp;connection+timeout=30&quot;)\n    if err != nil{\n        fmt.Print(err.Error())\n    }\n\n\n    err = db.Ping()\n\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n    defer db.Close()\n\n    type SMSBlast struct {\n        SequenceID  string\n        MobilePhone string\n        Output  string\n        WillBeSentDate string\n        SentDate string\n        Status string\n        DtmUpd string\n    }\n\n    router := gin.Default()\n\n    //Get a SMSBlast  detail\n    router.GET(&quot;/SMSBlast2/:SequenceID&quot;, func(context *gin.Context) {\n        var(\n            smsblast SMSBlast\n            result gin.H\n        )\n\n        SequenceID := context.Param(&quot;SequenceID&quot;)\n        fmt.Println(db.Ping())\n        row := db.QueryRow(&quot;select SequenceID, MobilePhone, Output, WillBeSentDate, SentDate, Status, DtmUpd from SMSBlast2 = ?;&quot;,SequenceID)\n        err = row.Scan(&amp;smsblast.SequenceID, &amp;smsblast.MobilePhone, &amp;smsblast.Output, &amp;smsblast.WillBeSentDate, &amp;smsblast.SentDate, &amp;smsblast.Status, &amp;smsblast.DtmUpd)\n        if err != nil{\n            //if no results send null\n            result = gin.H{\n                &quot;result&quot;: nil,\n                &quot;count&quot;:  0,\n            }\n            }else{\n                result = gin.H{\n                    &quot;result&quot; : smsblast,\n                    &quot;count&quot; : 1,\n                }\n            }\n\n        context.JSON(http.StatusOK, result)\n    })\n    router.Run(&quot;:8080&quot;)\n\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 7671524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1d520bca9e00f0404d5f80408b2dcab?s=128&d=identicon&r=PG&f=1", "display_name": "Giwi", "link": "https://stackoverflow.com/users/7671524/giwi"}, "edited": false, "score": 0, "creation_date": 1550132056, "post_id": 54637936, "comment_id": 96159818, "body": "Thanks it works. You are right that the foreign key should be with PersonalDetail. Also, sql tags works better than gorm tags indeed."}], "tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": false, "score": 1, "last_activity_date": 1549914200, "creation_date": 1549914200, "answer_id": 54637936, "question_id": 54625825, "link": "https://stackoverflow.com/questions/54625825/zero-to-many-cannot-add-or-update-a-child-row-a-foreign-key-constraint-fails/54637936#54637936", "title": "Zero-to-Many: Cannot add or update a child row: a foreign key constraint fails", "body": "<p>Try defining your models like this:</p>\n\n<pre><code>type Report struct {\n  gorm.Model\n  PersonalDetail PersonalDetail `json:\"PersonalDetail\" gorm:\"foreignkey:ReportId\"`\n}\n\ntype PersonalDetail struct {\n  gorm.Model\n  Name string `json:\"Name\"`\n  Age string `json:\"Age\"`\n  ReportId uint `sql:\"type:bigint REFERENCES reports(id) ON DELETE CASCADE\"`\n}\n</code></pre>\n\n<p>I've had some trouble getting foreign keys to work in GORM, so I've found using the SQL tag to define the relation seems to work better. It's not quite as clean since you need to define the actual database name rather than the field name, but it works.</p>\n\n<p>Also keep in mind the order in which you migrate your tables. You may need to do it in an order, such that no tables that haven't yet been created yet aren't referenced. For this example, migrate <code>Reports</code> before <code>PersonalDetail</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 7671524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1d520bca9e00f0404d5f80408b2dcab?s=128&d=identicon&r=PG&f=1", "display_name": "Giwi", "link": "https://stackoverflow.com/users/7671524/giwi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549914200, "creation_date": 1549870523, "last_edit_date": 1549874808, "question_id": 54625825, "link": "https://stackoverflow.com/questions/54625825/zero-to-many-cannot-add-or-update-a-child-row-a-foreign-key-constraint-fails", "title": "Zero-to-Many: Cannot add or update a child row: a foreign key constraint fails", "body": "<p>I am new to Go and Gorm. I want to parse API response and store two tables. \nFor each \"reports\" table, there can be zero-to-many tables of \"personal_details\". </p>\n\n<p>However, gorm gave error when applying foreign key constraint because there's no record for PersonalDetail in API response sometimes.</p>\n\n<p>I followed gorm docs and tried has-many relationship but i think it did not work for zero-to-many relationship</p>\n\n<pre><code>db.Model(&amp;Report{}).AddForeignKey(\"personal_detail_id\", \"personal_details(id)\", \"RESTRICT\", \"RESTRICT\")\n\ntype Report struct{\n  gorm.Model\n  PersonalDetail PersonalDetail `json:\"PersonalDetail\" gorm:\"foreignkey:PersonalDetailId\"`\n  PersonalDetailId uint\n}\n\ntype PersonalDetail struct{\n  gorm.Model\n  Name string `json:\"Name\"`\n  Age string `json:\"Age\"`\n\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549868840, "post_id": 54624783, "comment_id": 96043101, "body": "Individual channels are ordered. Any other ordering you must orchestrate yourself."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1549869254, "post_id": 54624783, "comment_id": 96043260, "body": "Presumably that select statement is in some kind of loop? Otherwise only the first case proceeds (and then the sender blocks forever on the second send)."}, {"owner": {"reputation": 1797, "user_id": 633626, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/VacBs.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/633626/george"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549922566, "post_id": 54624783, "comment_id": 96071600, "body": "@Peter yep it&#39;s in a loop, sorry, I elided too much from the question."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 6, "last_activity_date": 1549871792, "last_edit_date": 1549871792, "creation_date": 1549867260, "answer_id": 54625146, "question_id": 54624783, "link": "https://stackoverflow.com/questions/54624783/is-writing-to-two-separate-channels-reliably-sequential/54625146#54625146", "title": "Is writing to two separate channels reliably sequential?", "body": "<p>Yes you can rely on this if the channels are unbuffered. See the <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">Go Memory Model</a>.</p>\n"}], "owner": {"reputation": 1797, "user_id": 633626, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/VacBs.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/633626/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 54625146, "answer_count": 1, "score": 3, "last_activity_date": 1549922589, "creation_date": 1549865158, "last_edit_date": 1549922589, "question_id": 54624783, "link": "https://stackoverflow.com/questions/54624783/is-writing-to-two-separate-channels-reliably-sequential", "title": "Is writing to two separate channels reliably sequential?", "body": "<p>If I have a select on two channels:</p>\n\n<pre><code>for {\n    select {\n    case &lt;-chan1:\n        // do something\n    case &lt;-chan2:\n        // do something else\n    }\n}\n</code></pre>\n\n<p>And in a separate goroutine I write sequentially to those channels:</p>\n\n<pre><code>chan1 &lt;- \"blah\"\nchan2 &lt;- true\n</code></pre>\n\n<p>Am I guaranteed to see \"do something\" execute before \"do something else\"?</p>\n\n<p>I know that select chooses randomly if it has two unblocked channels, but I was thinking that writing to the first channel might reliably \"interrupt\" the writing goroutine if the select is already blocking, implying that the select would run on the unblocked first channel before the second write.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549864368, "post_id": 54624564, "comment_id": 96041577, "body": "Hi thanks for the prompt reply, wouldn&#39;t it be fine if instead of passing waitgroup to <code>func1</code> I just passed it to <code>func2</code>, also, where do I put a <code>wait</code> for <code>func2</code> waitgroup, cause I&#39;m using it in <code>main</code>, can you please add the code you think should be for <code>main</code>, that would help greatly"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549882777, "post_id": 54624564, "comment_id": 96050360, "body": "Thanks, that helps a lot. So, the playground code, isn&#39;t good enough ?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549884534, "post_id": 54624564, "comment_id": 96051334, "body": "@temporarya given the context, I would say the code is good enough. If you want to improve it, you&#39;ll need to get into details"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549884598, "post_id": 54624564, "comment_id": 96051360, "body": "This is what I was trying to make  <a href=\"https://stackoverflow.com/questions/54628157/what-improvements-can-be-done-to-this-go-watcher\" title=\"what improvements can be done to this go watcher\">stackoverflow.com/questions/54628157/&hellip;</a>"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1549881528, "last_edit_date": 1549881528, "creation_date": 1549863845, "answer_id": 54624564, "question_id": 54624442, "link": "https://stackoverflow.com/questions/54624442/in-which-function-should-i-pass-the-waitgroup/54624564#54624564", "title": "In which function should I pass the WaitGroup?", "body": "<p>There are multiple problems in your code.</p>\n\n<p>In the loop, you are spawning multiple (3) goroutines that runs <code>func2</code>, and in <code>func2</code>, you send data to <code>ch2</code> and call <code>close(ch2)</code>. This is a problem. It can happen that when one goroutine is seding data to <code>ch2</code>, the other has closed that channel, which causes:</p>\n\n<pre><code>panic: close of closed channel\n\ngoroutine 6 [running]:\nmain.func2(0xc00006c000, 0xc000056180)\n    /home/projects/go-tuts/pipeline-loop.go:36 +0x72\ncreated by main.main\n    /home/projects/go-tuts/pipeline-loop.go:16 +0x10f\nexit status 2\n</code></pre>\n\n<p>In general, you don't need close a chanel multiple times - you only need to shut them once they are all finished. You need another <code>WaitGroup</code> for this; you need to pass both functions a <code>WaitGroup</code>.</p>\n\n<p>Further reading: <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n\n<p>UPDATE:</p>\n\n<p>Personally I use a pattern for \"works\" that produce data into a same channel and the channel needs to be closed after all works are done:</p>\n\n<pre><code>for something {\n    wg.Add(1)\n    go func(i int) {\n        work(ch)\n        wg.Done()\n    }\n}\n\ngo func() {\n    wg.Wait()\n    close()\n}()\n</code></pre>\n\n<p>I think it is a good idea that keeps the API clean from <code>WorkGroup</code> as <code>WorkGroup</code> is about how you sync the work instead of how the work is done.</p>\n\n<p>I have changed your code into this pattern: <a href=\"https://play.golang.org/p/vdCNsxWhgyQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vdCNsxWhgyQ</a></p>\n"}, {"comments": [{"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549864890, "post_id": 54624700, "comment_id": 96041706, "body": "Thanks, for the prompt reply Andrew, I suppose you&#39;re the same person from <a href=\"https://www.reddit.com/r/golang/comments/aou7f7/how_to_implement_pipeline_for_goroutines/eg42qm2\" rel=\"nofollow noreferrer\">this reddit thread</a>, anyway that&#39;s out of question. But the thing is I want each <code>func1</code>&#39;s output to be handled by a new <code>func2</code> because in this sample code it might look small but in actual it&#39;s a webcrawler, <code>func1</code> fetches data and <code>func2</code> processes it to store it in DB. That&#39;s why it&#39;s needed."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "reply_to_user": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549867768, "post_id": 54624700, "comment_id": 96042670, "body": "With your current soln all the func1 outputs go to the same channel so you have not control over which func2 handles them - they might all end up going through the same one anyway. Maybe you need multiple channels instead of just ch1 - one for each func1, then you need no WaitGroups - each func1 just closes its chan when finished. Just a thought.  (BTW Not me in reddit)"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549871675, "post_id": 54624700, "comment_id": 96044257, "body": "@andrew-w-phillips If I create multiple channels, how would I be able to handle it&#39;s output then ?"}], "tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": false, "score": 1, "last_activity_date": 1549864600, "creation_date": 1549864600, "answer_id": 54624700, "question_id": 54624442, "link": "https://stackoverflow.com/questions/54624442/in-which-function-should-i-pass-the-waitgroup/54624700#54624700", "title": "In which function should I pass the WaitGroup?", "body": "<p>I suspect you only want one channel to read from ch1 and write to ch2.  There is not much point in creating 3 go-routines to do the same thing (and you also end up closing the same channel mutliple time which causes a panic as leaf bebop pointed out)</p>\n\n<pre><code>func main() {\n    ch1 := make(chan int, 10) // Use buffered channel so as to avoid clogging\n    ch2 := make(chan string, 10)\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go func1(i, ch1, &amp;wg)\n    }\n    go func2(ch1, ch2)\n    wg.Wait()\n    close(ch1)\n    for val := range ch2 {\n        fmt.Println(val)\n    }\n}\n\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 54624564, "answer_count": 2, "score": -1, "last_activity_date": 1549881528, "creation_date": 1549863037, "last_edit_date": 1549864661, "question_id": 54624442, "link": "https://stackoverflow.com/questions/54624442/in-which-function-should-i-pass-the-waitgroup", "title": "In which function should I pass the WaitGroup?", "body": "<p>I have made a simple code example to understand the usage of pipeline, here it is.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    ch1 := make(chan int, 10) // Use buffered channel so as to avoid clogging\n    ch2 := make(chan string, 10)\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go func1(i, ch1, &amp;wg)\n        go func2(ch1, ch2)\n    }\n    wg.Wait()\n    close(ch1)\n    for val := range ch2 {\n        fmt.Println(val)\n    }\n}\n\nfunc func1(seconds int, ch chan&lt;- int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    time.Sleep(time.Duration(seconds) * time.Second)\n    fmt.Println(seconds)\n    ch &lt;- seconds\n}\n\nfunc func2(ch1 chan int, ch2 chan string) {\n    for range ch1 {\n        ch2 &lt;- \"hello\"\n    }\n    close(ch2)\n}\n</code></pre>\n\n<p>Now, the problem is <strong>I don't get consistent output</strong> ( I understand it's some concurrency issue, which I haven't fully understood ).</p>\n\n<h3>Output</h3>\n\n<pre><code>&gt; go run pipeline-loop.go \n0\n1\n2\nhello\nhello\n\n&gt; go run pipeline-loop.go \n0\n1\n2\nhello\nhello\nhello\n\n&gt; go run pipeline-loop.go \n0\n1\n2\nhello\nhello\n\n&gt; go run pipeline-loop.go \n0\n1\n2\nhello\nhello\n\n&gt; go run pipeline-loop.go \n0\n1\n2\nhello\nhello\npanic: close of closed channel\n\ngoroutine 6 [running]:\nmain.func2(0xc00006c000, 0xc000056180)\n    /home/projects/go-tuts/pipeline-loop.go:36 +0x72\ncreated by main.main\n    /home/projects/go-tuts/pipeline-loop.go:16 +0x10f\nexit status 2\n</code></pre>\n\n<p>Another guy changed the code ( and it was working ) and put <code>func2</code> outside the loop but I want <code>func2</code> for each iteration of the <code>func1</code>.</p>\n\n<h3>Problem</h3>\n\n<p>So, I want to understand as to where should the <code>WaitGroup</code> and <code>close(ch)</code> be used ?</p>\n\n<p>Thanks.<br>\nTemporarya<br>\n( A golang noobie )</p>\n\n<h2>Update</h2>\n\n<p>Based on a user's answer, I changed the code, now I get output as expected ( but not the solution to this question ) but still there's a deadlock.\n<a href=\"https://play.golang.org/p/O_rp_FLvNh8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/O_rp_FLvNh8</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    ch1 := make(chan int, 10) // Use buffered channel so as to avoid clogging\n    ch2 := make(chan string, 10)\n    var wg1 sync.WaitGroup\n    // var wg2 sync.WaitGroup\n    for i := 0; i &lt; 3; i++ {\n        wg1.Add(1)\n        go func1(i, ch1)\n        go func2(ch1, ch2, &amp;wg1)\n    }\n    for val := range ch2 {\n        fmt.Println(val)\n    }\n    wg1.Wait()\n    close(ch1)\n    close(ch2)\n}\n\n// func func1(seconds int, ch chan&lt;- int, wg *sync.WaitGroup) {\nfunc func1(seconds int, ch chan&lt;- int) {\n    // defer wg.Done()\n    time.Sleep(time.Duration(seconds) * time.Second)\n    fmt.Println(seconds)\n    ch &lt;- seconds\n}\n\nfunc func2(ch1 chan int, ch2 chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for range ch1 {\n        ch2 &lt;- \"hello\"\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549855148, "post_id": 54623302, "comment_id": 96039509, "body": "Yes. What is the question?"}, {"owner": {"reputation": 502, "user_id": 3475066, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/eece2dfaa4b728addd59d0eb8e0f4459?s=128&d=identicon&r=PG&f=1", "display_name": "object", "link": "https://stackoverflow.com/users/3475066/object"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1549855941, "post_id": 54623302, "comment_id": 96039649, "body": "@Volker Does leaking param in escape analysis mean resource leak? Go routines exit as expected, and channels won&#39;t block forever here. Then why is it shown as leak? Am I missing something?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549861014, "post_id": 54623302, "comment_id": 96040736, "body": "&quot;Does leaking param in escape analysis mean resource leak?&quot; No, of course not. Why do you think that?"}, {"owner": {"reputation": 3806, "user_id": 1335793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jnl3V.png?s=128&g=1", "display_name": "Davos", "link": "https://stackoverflow.com/users/1335793/davos"}, "edited": false, "score": 4, "creation_date": 1572525977, "post_id": 54623302, "comment_id": 103592600, "body": "&quot;Why would you think that?&quot; It&#39;s reasonable to assume that <code>leaking</code> is bad and related to its stem <code>leak</code>. I am struggling to think of an example context where leaking is a good thing, e.g leaking bucket, leaking gas tank, <i>taking a leak</i>, leaking capacitor, leaky boat, leaky abstraction. It may be obvious to high performance go experts, but for the rest of us it would be helpful to link to docs and provide brief clarification of what <code>leaking param</code> refers to."}], "answers": [{"tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": true, "score": 13, "last_activity_date": 1583547736, "last_edit_date": 1583547736, "creation_date": 1549856455, "answer_id": 54623663, "question_id": 54623302, "link": "https://stackoverflow.com/questions/54623302/escape-analysis-shows-channel-as-leaking-param/54623663#54623663", "title": "Escape analysis shows channel as leaking param", "body": "<p>The parameters in question are channels which are reference types. They are captured within the closure created in createStageTwo() and can continue to be used in the go routine for that closure when createStageTwo() returns.  Hence they are signaled as leaking parameters.  If they were not then they would be placed on the stack and become invalid when main() finished with them.</p>\n\n<p>This does not mean you have a problem. Escape analysis is <em>not</em> there to detect resource leaks and most people would never need to use it.  (It can be useful for performance problems where something is placed on the GC heap which you don't expect.)</p>\n\n<p>(Sorry @Volker I originally posted my answer in the comments which left your question hanging.)</p>\n"}], "owner": {"reputation": 502, "user_id": 3475066, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/eece2dfaa4b728addd59d0eb8e0f4459?s=128&d=identicon&r=PG&f=1", "display_name": "object", "link": "https://stackoverflow.com/users/3475066/object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1997, "favorite_count": 2, "accepted_answer_id": 54623663, "answer_count": 1, "score": 6, "last_activity_date": 1583547736, "creation_date": 1549853012, "last_edit_date": 1549869109, "question_id": 54623302, "link": "https://stackoverflow.com/questions/54623302/escape-analysis-shows-channel-as-leaking-param", "title": "Escape analysis shows channel as leaking param", "body": "<p><strong>What I'm trying to do:</strong>\nI'm trying to understand/build a go pipeline with three stages. Stage 1 writes to channel A. Stage 2 has multiple go routines. Each go routine reads from Channel A, performs some operation and writes result to Channel Bn(Channel B1, B2..Bn). Stage 3 has creates n(=total number of Channels in Stage 2) go routines, each go routine reads from one Channel from stage 2. It is based on bounded parallelism described in <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n\n<p><strong>Issue:</strong>\nThe pipeline works fine as expected, the operation is distributed among go routines. But when I did an escape analysis and found that channel parameter sent from one stage to another is reported as \"leaking param\".</p>\n\n<p><strong>Code snippet:</strong>\nFor simplicity, I'm posting code that shows stage 1 channel creation, and a stage 2 that prints value read from stage channel 1.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc createStageOne(numOfJobs int) &lt;-chan int {\n   stageOneChannel := make(chan int)\n   go func(nJobs int) {\n      for i := 0; i &lt; nJobs; i++ {\n        stageOneChannel &lt;- i\n      }\n      close(stageOneChannel)\n   }(numOfJobs)\n   return stageOneChannel\n} // stageOneChannel closes and go routine exits once nJobs are completed \n\nfunc createStageTwo(in &lt;-chan int, completionFlag chan struct{}) {\n    go func() {\n        for n := range in {\n            fmt.Println(\"Received from stage 1 channel \", n)\n        }\n        completionFlag &lt;- struct{}{}\n    }()\n}// Comes out of for loop when stage 1 channel closes and go routine also exits\n\n\nfunc main() {\n    numOfJobs := 10\n    stageOneChannel := createStageOne(numOfJobs)\n\n    done := make(chan struct{})\n    createStageTwo(stageOneChannel, done)\n\n    &lt;-done\n}\n</code></pre>\n\n<p>Here is the escape analysis result</p>\n\n<pre><code>$ go build -gcflags \"-m -l\"\n# concurrentHTTP/stackoverflow\n./pipeline.go:7:5: func literal escapes to heap\n./pipeline.go:7:5: func literal escapes to heap\n./pipeline.go:6:25: make(chan int) escapes to heap\n./pipeline.go:17:5: func literal escapes to heap\n./pipeline.go:17:5: func literal escapes to heap\n./pipeline.go:16:21: leaking param: in\n./pipeline.go:16:36: leaking param: completionFlag\n./pipeline.go:19:16: \"Received from stage 1 channel \" escapes to heap\n./pipeline.go:19:16: n escapes to heap\n./pipeline.go:19:15: createStageTwo.func1 ... argument does not escape\n./pipeline.go:29:14: make(chan struct {}) escapes to heap\n</code></pre>\n\n<p>Why is escape analysis reporting leaking param on <strong>in</strong> and <strong>completionFlag</strong> flag?</p>\n"}, {"tags": ["go", "binary-tree", "tree-traversal"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549850429, "post_id": 54622913, "comment_id": 96038639, "body": "How do we reproduce your problem? Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it in the question itself."}, {"owner": {"reputation": 457, "user_id": 8864420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ca9c3f8cb67c71704963f09c967f94a4?s=128&d=identicon&r=PG&f=1", "display_name": "solo", "link": "https://stackoverflow.com/users/8864420/solo"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549850781, "post_id": 54622913, "comment_id": 96038699, "body": "Hi @peterSO. My desired behavior is to output the following:  <code>[[4] [9 5] [3 0 1] [8 2] [7]]</code>. I&#39;m currently getting <code>[[4] [9 5] [3 0 1] [2 8] [7]]</code>, so <code>[2 8]</code> is in reverse order of the expected <code>[8 2]</code>. I will add an example of how to reproduce the problem above."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1549863188, "creation_date": 1549863188, "answer_id": 54624463, "question_id": 54622913, "link": "https://stackoverflow.com/questions/54622913/inconsistent-append-behavior-in-go/54624463#54624463", "title": "Inconsistent append behavior in Go?", "body": "<p>I has nothing to do with <code>append</code>.</p>\n\n<p>You are doing a DFS-traversal of a binary tree, the order is called DFS-order of that tree. Thing is that the DFS-order of the tree is not from top to bottom.</p>\n\n<p>Your code visit node <code>2</code> before node <code>8</code>, so the code <code>m[hd] = append(m[hd], t.Val)</code> makes <code>[2 8]</code> instead of <code>[8 2]</code>. There is nothing inconsistent.</p>\n\n<p>To fix the problem, you can either use a BFS to traverse the tree, or, you can keep the depth info into <code>m</code> and sort each <code>m[hd]</code> accordingly. </p>\n\n<p>Generally speaking, BFS is a better idea, but a sort is quickly hackable.</p>\n"}], "owner": {"reputation": 457, "user_id": 8864420, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ca9c3f8cb67c71704963f09c967f94a4?s=128&d=identicon&r=PG&f=1", "display_name": "solo", "link": "https://stackoverflow.com/users/8864420/solo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 54624463, "answer_count": 1, "score": -3, "last_activity_date": 1549863188, "creation_date": 1549848905, "last_edit_date": 1549854716, "question_id": 54622913, "link": "https://stackoverflow.com/questions/54622913/inconsistent-append-behavior-in-go", "title": "Inconsistent append behavior in Go?", "body": "<p>I'm writing a function that returns the vertical order traversal of a binary tree's node values. (ie, from top to bottom, column by column). Here's an example of expected input and output:</p>\n\n<pre><code>Input: [3,9,8,4,0,1,7,null,null,null,2,5] (0's right child is 2 and 1's left child is 5)\n\n     3\n    /\\\n   /  \\\n   9   8\n  /\\  /\\\n /  \\/  \\\n 4  01   7\n    /\\\n   /  \\\n   5   2\n\nOutput:\n\n[\n  [4],\n  [9,5],\n  [3,0,1],\n  [8,2],\n  [7]\n]\n</code></pre>\n\n<p>My function outputs everything as expected except for <code>[8,2]</code>\u2014I'm getting <code>[2,8]</code> instead: </p>\n\n<pre><code>[[4] [9 5] [3 0 1] [2 8] [7]]\n</code></pre>\n\n<p>This is what my function looks like:</p>\n\n<pre><code>func verticalOrder(root *TreeNode) [][]int {\n    if root == nil {\n        return [][]int{}\n    }\n    var (\n        hd       int\n        m        map[int][]int\n        vals     [][]int\n        min      int\n        max      int\n        traverse func(t *TreeNode, hd int, m map[int][]int)\n    )\n    m = make(map[int][]int)\n    min = 0\n    max = 0\n    traverse = func(t *TreeNode, hd int, m map[int][]int) {\n        if t == nil {\n            return\n        }\n        m[hd] = append(m[hd], t.Val)\n        if max &lt; hd {\n            max = hd\n        }\n        if min &gt; hd {\n            min = hd\n        }\n        traverse(t.Left, hd-1, m)\n        traverse(t.Right, hd+1, m)\n    }\n    traverse(root, hd, m)\n    for i := min; i &lt;= max; i++ {\n        vals = append(vals, m[i])\n    }\n    return vals\n}\n</code></pre>\n\n<p>Essentially, I'm using a hash map to keep track of nodes with the same horizontal distance, and appending them to an array. What I'm trying to figure out is how come my output works properly with <code>9</code> and <code>5</code> but not with <code>8</code> and <code>2</code>? Any feedback is much appreciated!</p>\n\n<h2>Steps to reproduce</h2>\n\n<p>Run the code below. You'll get an output of <code>[[4] [9 5] [3 0 1] [2 8] [7]]</code>; the output should be <code>[[4] [9 5] [3 0 1] [8 2] [7]]</code>. The thing that's tripping me up is <code>[9 5]</code> is appending in the correct, vertical order, whereas <code>[2 8]</code> is not despite being similar, so I'm not too sure where to go from here.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// TreeNode is a binary tree node.\ntype TreeNode struct {\n    Val   int\n    Left  *TreeNode\n    Right *TreeNode\n}\n\nfunc verticalOrder(root *TreeNode) [][]int {\n    if root == nil {\n        return [][]int{}\n    }\n\n    var (\n        hd       int\n        m        map[int][]int\n        vals     [][]int\n        min      int\n        max      int\n        traverse func(t *TreeNode, hd int, m map[int][]int)\n    )\n\n    m = make(map[int][]int)\n    min = 0\n    max = 0\n    traverse = func(t *TreeNode, hd int, m map[int][]int) {\n        if t == nil {\n            return\n        }\n\n        m[hd] = append(m[hd], t.Val)\n\n        if max &lt; hd {\n            max = hd\n        }\n        if min &gt; hd {\n            min = hd\n        }\n        traverse(t.Left, hd-1, m)\n        traverse(t.Right, hd+1, m)\n    }\n\n    traverse(root, hd, m)\n\n    for i := min; i &lt;= max; i++ {\n        vals = append(vals, m[i])\n    }\n\n    return vals\n}\n\nfunc main() {\n    root := &amp;TreeNode{\n        Val: 3,\n        Left: &amp;TreeNode{\n            Val: 9,\n            Left: &amp;TreeNode{\n                Val:   4,\n                Left:  nil,\n                Right: nil,\n            },\n            Right: &amp;TreeNode{\n                Val:  0,\n                Left: nil,\n                Right: &amp;TreeNode{\n                    Val:   2,\n                    Left:  nil,\n                    Right: nil,\n                },\n            },\n        },\n        Right: &amp;TreeNode{\n            Val: 8,\n            Left: &amp;TreeNode{\n                Val: 1,\n                Left: &amp;TreeNode{\n                    Val:   5,\n                    Left:  nil,\n                    Right: nil,\n                },\n                Right: nil,\n            },\n            Right: &amp;TreeNode{\n                Val:   7,\n                Left:  nil,\n                Right: nil,\n            },\n        },\n    }\n\n    fmt.Println(verticalOrder(root))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549842074, "post_id": 54621860, "comment_id": 96037228, "body": "If you don&#39;t want to declare the extra type you can always use an anonymous struct variable. E.g. <code>var embed struct { TM Events `json:&quot;_embedded&quot;` }</code>. Alternatively you can use a <code>map</code>, E.g. <code>var embed map[string]Events</code> however keep in mind that in this case all of the json&#39;s properties must be unmarshallable into the map&#39;s element type, that is, the object under <code>&quot;OtherStuff&quot;</code> must also be unmarshallable to Events, if not you&#39;ll get an error."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1549891792, "creation_date": 1549891792, "answer_id": 54631681, "question_id": 54621860, "link": "https://stackoverflow.com/questions/54621860/parsing-nested-json-string/54631681#54631681", "title": "Parsing Nested JSON string", "body": "<p>What you're looking for here is <code>json.RawMessage</code>. It can help delay parsing of certain values, and in you case <code>map[string]json.RawMessage</code> should represent the top-level object where you can selectively parse values. Here's a simplified example you can adjust to your case:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Event struct {\n    Name string `json:\"name\"`\n    Url  string `json:\"url\"`\n}\n\nfunc main() {\n    bb := []byte(`\n    {\n        \"event\": {\"name\": \"joe\", \"url\": \"event://101\"},\n        \"otherstuff\": 15.2,\n        \"anotherstuff\": 100\n    }`)\n\n    var m map[string]json.RawMessage\n    if err := json.Unmarshal(bb, &amp;m); err != nil {\n        panic(err)\n    }\n\n    if eventRaw, ok := m[\"event\"]; ok {\n        var event Event\n        if err := json.Unmarshal(eventRaw, &amp;event); err != nil {\n            panic(err)\n        }\n        fmt.Println(\"Parsed Event:\", event)\n    } else {\n        fmt.Println(\"Can't find 'event' key in JSON\")\n    }\n}\n</code></pre>\n\n<p>In your case look for the <code>_embedded</code> key and then <code>Unmarshal</code> its value to <code>Events</code></p>\n"}, {"tags": [], "owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "is_accepted": false, "score": 1, "last_activity_date": 1549942519, "creation_date": 1549942519, "answer_id": 54642436, "question_id": 54621860, "link": "https://stackoverflow.com/questions/54621860/parsing-nested-json-string/54642436#54642436", "title": "Parsing Nested JSON string", "body": "<p>yes of course</p>\n\n<pre><code>type Embed struct {\n    TM []struct {\n        Name  string `json:\"name\"`\n        Url   string `json:\"url\"`\n        Dates struct {\n            Start struct {\n                LocalDate string\n                LocalTime string\n            }\n        } // add tag here if you want \n    } `json:\"_embedded\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6420820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb7c9daf1b9f1c8e40463e002487be37?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy", "link": "https://stackoverflow.com/users/6420820/jimmy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1549942519, "creation_date": 1549838484, "question_id": 54621860, "link": "https://stackoverflow.com/questions/54621860/parsing-nested-json-string", "title": "Parsing Nested JSON string", "body": "<p>I am trying to parse a nested json string</p>\n\n<p>I did get it to work by using multiple structs, but I am wondering if I can parse the JSON without using an extra struct. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Events struct {\n    Events []Event `json:\"events\"`\n}\n\ntype Event struct {\n    Name    string  `json:\"name\"`\n    Url     string  `json:\"url\"`\n    Dates   struct {\n        Start   struct {\n            LocalDate   string \n            LocalTime   string\n        }\n    }\n}\n\ntype Embed struct {\n    TM Events `json:\"_embedded\"`\n}\n\nfunc TMGetEventsByCategory(location string, category string) {\n    parameters := \"city=\" + location + \"&amp;classificationName=\" + category + \"&amp;apikey=\" + api_key\n    tmUrl := tmBaseUrl + parameters\n    resp, err := http.Get(tmUrl)\n    var embed Embed\n    var tm Event\n    if err != nil {\n        log.Printf(\"The HTTP request failed with error %s\\n\", err)\n    } else {\n        data, _ := ioutil.ReadAll(resp.Body)\n\n        err := json.Unmarshal(data, &amp;embed)\n        json.Unmarshal(data, &amp;tm)\n\n    }\n}\n</code></pre>\n\n<p>JSON Data looks like this: </p>\n\n<pre><code>{\n  \"_embedded\": { \n     \"events\": [],\n  },\n  \"OtherStuff\": {\n  }\n}\n\n</code></pre>\n\n<p>Is it possible to get rid of the Embed struct and read straight to the events part of the json string?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1549842334, "post_id": 54621775, "comment_id": 96037274, "body": "Vendor (put into <code>vendor</code> folder) your dependencies. Tolls like <code>dep</code> and modules support that."}, {"owner": {"reputation": 301, "user_id": 2705804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7UB7l.jpg?s=128&g=1", "display_name": "suraj-kumar-adhikari", "link": "https://stackoverflow.com/users/2705804/suraj-kumar-adhikari"}, "edited": false, "score": 0, "creation_date": 1549903888, "post_id": 54621775, "comment_id": 96062923, "body": "As someone already answered, you need a dependency management tool like <code>deb</code> which will setup these dependencies for you."}, {"owner": {"reputation": 41, "user_id": 8284148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec4bd442667a89248c60b0b09f806a4?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Katich", "link": "https://stackoverflow.com/users/8284148/paul-katich"}, "edited": false, "score": 0, "creation_date": 1550002919, "post_id": 54621775, "comment_id": 96107596, "body": "I am using VGO with GOMODULES111=ON. It does create Vendor folder. I see all dependencies in vendor folder but not for internal packages."}], "answers": [{"tags": [], "owner": {"reputation": 39, "user_id": 7925806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GJ49bEQSegY/AAAAAAAAAAI/AAAAAAAAABo/WwQ6eZ5XRlE/photo.jpg?sz=128", "display_name": "Narendra Kamath", "link": "https://stackoverflow.com/users/7925806/narendra-kamath"}, "is_accepted": false, "score": 2, "last_activity_date": 1549860556, "last_edit_date": 1549860556, "creation_date": 1549859925, "answer_id": 54624045, "question_id": 54621775, "link": "https://stackoverflow.com/questions/54621775/cloud-functions-and-local-dependecies/54624045#54624045", "title": "Cloud functions and local dependecies", "body": "<p>You should use the dependency package management tool for this called as <strong>dep</strong>.</p>\n\n<p>Install dep by using the command:</p>\n\n<p><code>go get -u github.com/golang/dep/cmd/dep</code></p>\n\n<p>This would create the binary of dep in the <strong>GOBIN</strong> directory. Navigate to directory where main package is present and execute the command:</p>\n\n<p>For Windows:\n<code>%GOBIN%\\dep.exe init</code></p>\n\n<p>For Linux:\n<code>$GOBIN\\dep init</code> </p>\n\n<p>This would create <strong>Gopkg.toml</strong> and <strong>Gopkg.lock</strong> files along with the <strong>vendor</strong> folder that would solve your issue.</p>\n\n<p><strong>Reference</strong>: <a href=\"https://golang.github.io/dep/docs/introduction.html\" rel=\"nofollow noreferrer\">https://golang.github.io/dep/docs/introduction.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8904959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bf6368282a289f6bf13bb585beb7c23?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8904959/amit"}, "is_accepted": false, "score": 1, "last_activity_date": 1611839309, "creation_date": 1611839309, "answer_id": 65937735, "question_id": 54621775, "link": "https://stackoverflow.com/questions/54621775/cloud-functions-and-local-dependecies/65937735#65937735", "title": "Cloud functions and local dependecies", "body": "<p>The cloud function is a managed environment which google provision for us during the deployment of the function. While setting the environment google supplies all the system dependencies but any external dependency should be handled by function itself.</p>\n<p>While resolving external dependencies, it looks for Vendor directory , GOROOT and GOPATH to find to package being imported. If package is not found at any of these locations , you get this error.</p>\n<p>Solution</p>\n<ul>\n<li>Supply your package as vendor dependency by manually copying it there.</li>\n<li>OR create a go module for your package and supply go.mod file while deploying the cloud function. This way go knows where to find the package before building the function.</li>\n</ul>\n<p>Reference - <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/issues/1600\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/issues/1600</a></p>\n"}], "owner": {"reputation": 41, "user_id": 8284148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec4bd442667a89248c60b0b09f806a4?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Katich", "link": "https://stackoverflow.com/users/8284148/paul-katich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1611839309, "creation_date": 1549837897, "last_edit_date": 1572514394, "question_id": 54621775, "link": "https://stackoverflow.com/questions/54621775/cloud-functions-and-local-dependecies", "title": "Cloud functions and local dependecies", "body": "<p>I am trying to deploy to google cloud using deploy command and my code refers local package using the github url. I getting below when deploying using gcloud deploy command. So in this example. My endpoints package refers to local package price using the full git url. What am I missing here?</p>\n\n<pre><code>package endpoints\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/piscean/pricing/price\"\n    \"net/http\"\n)\n\nfunc LawnPricing(w http.ResponseWriter, r *http.Request) {\n\n    m, err := price.Pricing()\n\n    c, err := json.Marshal(m)\n\n    w.Write(c)\n    r.Body.Close()\n}\n</code></pre>\n\n<blockquote>\n  <p>ERROR: (gcloud.functions.deploy) OperationError: code=3, message=Build failed: /tmp/sgb/gopath/src/serverlessapp/vendor/endpoints/pricing.go:6:2: cannot find package \"github.com/piscean/pricing/price\" in any of:\n          /tmp/sgb/gopath/src/serverlessapp/vendor/github.com/piscean/pricing/price (vendor tree)\n          /go/src/github.com/piscean/pricing/price (from $GOROOT)\n          /tmp/sgb/gopath/src/github.com/piscean/pricing/price (from $GOPATH)\n  /tmp/sgb/gopath/src/serverlessapp/vendor/endpoints/zipcode.go:5:2: cannot find package \"github.com/piscean/pricing/zip\" in any of:\n          /tmp/sgb/gopath/src/serverlessapp/vendor/github.com/piscean/pricing/zip (vendor tree)\n          /go/src/github.com/piscean/pricing/zip (from $GOROOT)\n          /tmp/sgb/gopath/src/github.com/piscean/pricing/zip (from $GOPATH)</p>\n</blockquote>\n"}, {"tags": ["sockets", "ssl", "go", "systemd"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10876156, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wv3IVtQ7O9E/AAAAAAAAAAI/AAAAAAAAAKI/kDFPfQzHDNU/photo.jpg?sz=128", "display_name": "Andrew James", "link": "https://stackoverflow.com/users/10876156/andrew-james"}, "is_accepted": false, "score": 0, "last_activity_date": 1550730035, "creation_date": 1550730035, "answer_id": 54800507, "question_id": 54621640, "link": "https://stackoverflow.com/questions/54621640/activating-a-go-tls-socket-server-service-without-having-to-use-http-serve/54800507#54800507", "title": "Activating a Go TLS Socket server service without having to use http.Serve", "body": "<pre><code>I found a solution that works. The answer came from https://www.darkcoding.net/software/systemd-socket-activation-in-go/.\n\nMy new code looks like this\n\npackage main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n\n    \"github.com/coreos/go-systemd/journal\"\n)\n\nfunc createServerConfig(ca, crt, key string) (*tls.Config, error) {\n    caCertPEM, err := ioutil.ReadFile(ca)\n    if err != nil {\n        return nil, err\n    }`enter code here`\n\n    roots := x509.NewCertPool()\n    ok := roots.AppendCertsFromPEM(caCertPEM)\n    if !ok {\n        panic(\"failed to parse root certificate\")\n    }\n\n    cert, err := tls.LoadX509KeyPair(crt, key)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n        ClientAuth:   tls.RequireAndVerifyClientCert,\n        ClientCAs:    roots,\n    }, nil\n}\n\nconst (\n    ca          = \"/usr/local/bin/certs/ca-chain.cert.pem\"\n    crt         = \"/usr/local/bin/certs/tls-server2-SAN.pem\"\n    key         = \"/usr/local/bin/certs/tls-server2-SAN.key\"\n    BUFFER_SIZE = 1024`enter code here`\n)\n\nfunc main() {\n    if journal.Enabled() {\n        journal.Print(journal.PriInfo, \"all systems ready...\")\n    }\n\n    p := fmt.Println\n    now := time.Now()\n    p(now)\n\n    config, err := createServerConfig(ca, crt, key)\n    if err != nil {\n        log.Fatal(\"config failed: %s\", err.Error())\n    }\n    if os.Getenv(\"LISTEN_PID\") == strconv.Itoa(os.Getpid()) {\n        // systemd run\n        f := os.NewFile(3, \"from systemd\")\n        ln, err := net.FileListener(f)\n        if err != nil {\n            log.Fatal(err)\n        }\n        tlsListener := tls.NewListener(ln, config)\n        for {\n            conn, err := tlsListener.Accept()\n            if err != nil {\n                log.Fatal(\"accept failed: %s\", err.Error())\n                break\n            }\n            log.Printf(\"connection open: %s\", conn.RemoteAddr())\n            //printConnState(conn.(*tls.Conn))\n            go func(c net.Conn) {\n                wr, _ := io.Copy(c, c)\n                c.Close()\n                log.Printf(\"connection close: %s, written: %d\", conn.RemoteAddr(), wr)\n            }(conn)\n        }`enter code here`\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10876156, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wv3IVtQ7O9E/AAAAAAAAAAI/AAAAAAAAAKI/kDFPfQzHDNU/photo.jpg?sz=128", "display_name": "Andrew James", "link": "https://stackoverflow.com/users/10876156/andrew-james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 407, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550730035, "creation_date": 1549836897, "question_id": 54621640, "link": "https://stackoverflow.com/questions/54621640/activating-a-go-tls-socket-server-service-without-having-to-use-http-serve", "title": "Activating a Go TLS Socket server service without having to use http.Serve", "body": "<p>I have the following code and systemd unit files. What I'm trying to do is activate the listener without having to use http.Serve to accept and receive incoming connections. If I change ln, err := tls.Listen(\"tcp\", listen, config) to ln, err := activation.TLSListener(config) the only way I see I can receive data is using http.Serve. The error I get when using ln, err := activation.TLSListeners.(config) is ln.Accept undefined (type []net.Listener has no field or method Accept)</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"time\"\n\n    \"github.com/coreos/go-systemd/daemon\"\n    \"github.com/coreos/go-systemd/journal\"\n    \"github.com/coreos/go-systemd/activation\"\n)\n\nfunc createServerConfig(ca, crt, key string) (*tls.Config, error) {\n    caCertPEM, err := ioutil.ReadFile(ca)\n    if err != nil {\n        return nil, err\n    }\n\n    roots := x509.NewCertPool()\n    ok := roots.AppendCertsFromPEM(caCertPEM)\n    if !ok {\n        panic(\"failed to parse root certificate\")\n    }\n\n    cert, err := tls.LoadX509KeyPair(crt, key)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n        ClientAuth:   tls.RequireAndVerifyClientCert,\n        ClientCAs:    roots,\n    }, nil\n}\n\nconst (\n    ca  = \"/home/ajames/Shortcuts/Link to MainGoFolder/Workspace/servicecode/tls-server/certs/ca-chain.cert.pem\"\n    crt = \"/home/ajames/Shortcuts/Link to MainGoFolder/Workspace/servicecode/tls-server/certs/tls-server2-SAN.pem\"\n    key = \"/home/ajames/Shortcuts/Link to MainGoFolder/Workspace/servicecode/tls-server/certs/tls-server2-SAN.key\"\n    listen = \"127.0.0.1:4433\"\n)\n\nfunc main() {\n\n    if journal.Enabled() {\n        journal.Print(journal.PriInfo, \"all systems ready...\")\n    }\n\n    p := fmt.Println\n    now := time.Now()\n    p(now)\n\n    config, err := createServerConfig(ca, crt, key)\n    if err != nil {\n        log.Fatal(\"config failed: %s\", err.Error())\n    }\n\n    ln, err := tls.Listen(\"tcp\", listen, config)\n    if err != nil {\n        log.Fatal(\"listen failed: %s\", err.Error())\n    }\n    daemon.SdNotify(false, \"READY=1\")\n    log.Printf(\"listen on %s\", listen)\n\n    go func() {\n        interval, err := daemon.SdWatchdogEnabled(false)\n        if err != nil || interval == 0 {\n            return\n        }\n        for {\n            daemon.SdNotify(false, \"WATCHDOG=1\")\n            time.Sleep(interval / 3)\n        }\n    }()\n\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            log.Fatal(\"accept failed: %s\", err.Error())\n            break\n        }\n        log.Printf(\"connection open: %s\", conn.RemoteAddr())\n        //printConnState(conn.(*tls.Conn))\n\n        go func(c net.Conn) {\n            wr, _ := io.Copy(c, c)\n            c.Close()\n            log.Printf(\"connection close: %s, written: %d\", conn.RemoteAddr(), wr)\n        }(conn)\n    }\n}\n\n\n[Unit]\nDescription=tls server service\nAfter=network.target tls-server.socket\nRequires=tls-server.socket\n\n[Service]\nType=notify\nWatchdogSec=30s\nStandardInput=socket\nStandardError=journal\nExecStart=/usr/local/bin/tls-server\nNonBlocking=true\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n\n\n[Unit]\nDescription=tls server socket\nStartLimitIntervalSec=10\nPartOf=tls-server.service\nAfter=network.target\n\n[Socket]\nListenStream=127.0.0.1:4433\nNoDelay=true\nAccept=true\nReusePort=true\nMaxConnections=200\nWritable=true\n\n[Install]\nWantedBy=sockets.target\n</code></pre>\n"}, {"tags": ["bash", "go", "path"], "comments": [{"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "edited": false, "score": 0, "creation_date": 1549836765, "post_id": 54621580, "comment_id": 96035847, "body": "What does <code>type go</code> print?"}, {"owner": {"reputation": 38472, "user_id": 1815797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8be290f9af1ba6048c7022ef1109efc6?s=128&d=identicon&r=PG", "display_name": "gniourf_gniourf", "link": "https://stackoverflow.com/users/1815797/gniourf-gniourf"}, "edited": false, "score": 0, "creation_date": 1549836781, "post_id": 54621580, "comment_id": 96035852, "body": "<code>which</code> is not really what you want. You want <code>type -a go</code>."}, {"owner": {"reputation": 475, "user_id": 1985423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ba3779a101a0a2119b086442f2e283de?s=128&d=identicon&r=PG", "display_name": "Stefan Bollmann", "link": "https://stackoverflow.com/users/1985423/stefan-bollmann"}, "edited": false, "score": 0, "creation_date": 1549837739, "post_id": 54621580, "comment_id": 96036120, "body": "edited question (I have german output and translated)."}, {"owner": {"reputation": 38472, "user_id": 1815797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8be290f9af1ba6048c7022ef1109efc6?s=128&d=identicon&r=PG", "display_name": "gniourf_gniourf", "link": "https://stackoverflow.com/users/1815797/gniourf-gniourf"}, "edited": false, "score": 1, "creation_date": 1549837825, "post_id": 54621580, "comment_id": 96036143, "body": "There you go! you already have defined a function called <code>go</code> (probably defined in your <code>.bashrc</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "reply_to_user": {"reputation": 38472, "user_id": 1815797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8be290f9af1ba6048c7022ef1109efc6?s=128&d=identicon&r=PG", "display_name": "gniourf_gniourf", "link": "https://stackoverflow.com/users/1815797/gniourf-gniourf"}, "edited": false, "score": 0, "creation_date": 1549838453, "post_id": 54621774, "comment_id": 96036314, "body": "@gniourf_gniourf: For the record, I didn&#39;t see your comment (which solved it) until after I posted the answer (which was admittedly obvious given the updated question)."}, {"owner": {"reputation": 475, "user_id": 1985423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ba3779a101a0a2119b086442f2e283de?s=128&d=identicon&r=PG", "display_name": "Stefan Bollmann", "link": "https://stackoverflow.com/users/1985423/stefan-bollmann"}, "edited": false, "score": 0, "creation_date": 1549838540, "post_id": 54621774, "comment_id": 96036340, "body": "Together with <a href=\"https://unix.stackexchange.com/questions/322817/how-to-find-the-file-where-a-bash-function-is-defined\">How to find the function definition</a> found the culprit. <code>bash_aliases</code>."}], "tags": [], "owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "is_accepted": true, "score": 4, "last_activity_date": 1549837884, "creation_date": 1549837884, "answer_id": 54621774, "question_id": 54621580, "link": "https://stackoverflow.com/questions/54621580/go-bin-in-path-but-go-version-fails/54621774#54621774", "title": "Go bin in PATH, but &quot;go version&quot; fails", "body": "<p>Shell functions take priority over commands in your <code>$PATH</code>.</p>\n\n<p><code>which</code> doesn't necessarily find shell functions (in fact I don't think it can find them at all). <code>type -a</code> is more reliable, at least if you're using bash or another sh-derived shell.</p>\n\n<p>The problem is that you have an unrelated shell function called <code>go</code>.</p>\n\n<p>If you still want that function, I suggest giving it a different name, <code>Go</code> would work.</p>\n"}], "owner": {"reputation": 475, "user_id": 1985423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ba3779a101a0a2119b086442f2e283de?s=128&d=identicon&r=PG", "display_name": "Stefan Bollmann", "link": "https://stackoverflow.com/users/1985423/stefan-bollmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 54621774, "answer_count": 1, "score": 1, "last_activity_date": 1549837884, "creation_date": 1549836465, "last_edit_date": 1549837629, "question_id": 54621580, "link": "https://stackoverflow.com/questions/54621580/go-bin-in-path-but-go-version-fails", "title": "Go bin in PATH, but &quot;go version&quot; fails", "body": "<p>How can I use go using the standard installation instructions in bash? What do I do wrong?</p>\n\n<p>I followed the <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">installation instructions for go on Linux</a>. Therefore I downloaded the go tar.gz, untared it to <code>/usr/local</code> and added <code>export PATH=$PATH:/usr/local/go/bin</code> to <code>/etc/bash.bashrc</code> and made a <code>source /etc/bash.bashrc</code>.</p>\n\n<p>However, <code>go version</code> does not give the proper result. See: </p>\n\n<pre><code>user@machine:~$ which go\n/usr/local/go/bin/go\nuser@machine:~$ go version\nuser@machine:~$ /usr/local/go/bin/go version\ngo version go1.11.5 linux/amd64\n\nuser@machine:~$ type -a go\ngo is a function.\ngo () \n{ \n    eval dir=\\$$1;\n    cd \"$dir\"\n}\ngo is /usr/local/go/bin/go\n</code></pre>\n"}, {"tags": ["postgresql", "go", "pgx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1549827100, "post_id": 54619645, "comment_id": 96033181, "body": "(<a href=\"https://github.com/jackc/pgx/blob/master/conn_pool_test.go#L873-L886\" rel=\"nofollow noreferrer\">1.</a>), (2.) from 1. it&#39;s clear that you can pass the name as the <code>sql</code> argument to <code>Query&#47;QueryRow&#47;Exec</code>. <a href=\"https://github.com/jackc/pgx/blob/master/query.go#L455\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://github.com/jackc/pgx/blob/0b00887bf8e110d6e02e9e82c066cc616bc0ed71/conn.go#L1303\" rel=\"nofollow noreferrer\">this</a> confirm this and the <code>sendPreparedQuery</code> method then prepends the name with <code>EXECUTE</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549827107, "post_id": 54619645, "comment_id": 96033184, "body": "(3.) Don&#39;t get confused by the name of the parameter, when you pass in the name of the prepared statement then <code>sql</code> will hold the name of the prepared statement, that&#39;s when you get a match on the lines linked in 2."}], "answers": [{"comments": [{"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "edited": false, "score": 1, "creation_date": 1609695858, "post_id": 54679144, "comment_id": 115897417, "body": "<code>Prepare()</code> isn&#39;t a Pool method, its a Connection method. So you need to pick a connection from the pool, and then do Prepare on it"}], "tags": [], "owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "is_accepted": true, "score": 2, "last_activity_date": 1550090788, "creation_date": 1550090788, "answer_id": 54679144, "question_id": 54619645, "link": "https://stackoverflow.com/questions/54619645/named-prepared-statement-in-pgx-lib-how-does-it-work/54679144#54679144", "title": "Named prepared statement in pgx lib, how does it work?", "body": "<p><strong>@mkopriva</strong> pointed out that the <code>sql</code> text was misleading me. It has a double function here. If the <code>sql</code> variable does not match to a key in the <code>c.preparedStatements[sql]</code> map, the query contained in the <code>sql</code> gets prepared and a new <code>*PreparedStatement</code> struct is appointed to <code>ps</code>. If it did match a key, the <code>ps</code> variable will point to an entry of the map.</p>\n\n<p>So effectively you can do something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/jackc/pgx\"\n)\n\nfunc main() {\n    conf := pgx.ConnPoolConfig{\n        ConnConfig: pgx.ConnConfig{\n            Host:     \"/run/postgresql\",\n            User:     \"postgres\",\n            Database: \"test\",\n        },\n        MaxConnections: 5,\n    }\n    db, err := pgx.NewConnPool(conf)\n    if err != nil {\n        panic(err)\n    }\n    if _, err := db.Prepare(\"my-query\", \"select $1::int\"); err != nil {\n        panic(err)\n    }\n    row := db.QueryRow(\"my-query\", 10)\n    var i int\n    if err := row.Scan(&amp;i); err != nil {\n        panic(err)\n    }\n    fmt.Println(i)\n}\n</code></pre>\n"}], "owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2857, "favorite_count": 1, "accepted_answer_id": 54679144, "answer_count": 1, "score": 4, "last_activity_date": 1550090788, "creation_date": 1549823433, "last_edit_date": 1549823733, "question_id": 54619645, "link": "https://stackoverflow.com/questions/54619645/named-prepared-statement-in-pgx-lib-how-does-it-work", "title": "Named prepared statement in pgx lib, how does it work?", "body": "<h2>Introduction</h2>\n\n<h3>database/sql</h3>\n\n<p>In the Go standard sql library, the <a href=\"https://golang.org/pkg/database/sql/#Stmt\" rel=\"nofollow noreferrer\"><code>*Stmt</code></a> type has methods defined like:</p>\n\n<pre><code>func (s *Stmt) Exec(args ...interface{}) (Result, error)\nfunc (s *Stmt) Query(args ...interface{}) (*Rows, error)\n</code></pre>\n\n<p>The a new (unnamed) statement is prepared by:</p>\n\n<pre><code>func (db *DB) Prepare(query string) (*Stmt, error)\n</code></pre>\n\n<ol>\n<li>Connection pool is abstracted and not directly accessible</li>\n<li>A transaction is prepared on a single connection</li>\n<li>If the connection is not available at statment execution time, it will be re-prepared on a new connection.</li>\n</ol>\n\n<h3>pgx</h3>\n\n<p>The <a href=\"https://godoc.org/github.com/jackc/pgx#PreparedStatement\" rel=\"nofollow noreferrer\"><code>PreparedStatement</code></a> type doesn't have any methods defined. A new named prepared statement is prepared by:</p>\n\n<pre><code>func (p *ConnPool) Prepare(name, sql string) (*PreparedStatement, error)\n</code></pre>\n\n<ol>\n<li>Operations are directly on the connection pool</li>\n<li>The transaction gets prepared on all connections of the pool</li>\n<li>There is no clear way how to execute the prepared statement</li>\n</ol>\n\n<p>In a <a href=\"https://github.com/jackc/pgx/issues/294#issuecomment-319358285\" rel=\"nofollow noreferrer\">Github comment</a>, the author explains better the differences of architecture between pgx and database/sql. The documentation on <a href=\"https://godoc.org/github.com/jackc/pgx#ConnPool.Prepare\" rel=\"nofollow noreferrer\"><code>Prepare</code></a> also states (emphasis mine):</p>\n\n<blockquote>\n  <p>Prepare is idempotent; i.e. it is safe to call Prepare multiple times with the same name and sql arguments. This allows a <strong>code path to Prepare and Query/Exec/PrepareEx</strong> without concern for if the statement has already been prepared. </p>\n</blockquote>\n\n<h2>Small example</h2>\n\n<pre><code>package main\n\nimport (\n    \"github.com/jackc/pgx\"\n)\n\nfunc main() {\n    conf := pgx.ConnPoolConfig{\n        ConnConfig: pgx.ConnConfig{\n            Host:     \"/run/postgresql\",\n            User:     \"postgres\",\n            Database: \"test\",\n        },\n        MaxConnections: 5,\n    }\n    db, err := pgx.NewConnPool(conf)\n    if err != nil {\n        panic(err)\n    }\n    _, err = db.Prepare(\"my-query\", \"select $1\")\n    if err != nil {\n        panic(err)\n    }\n    // What to do with the prepared statement?\n}\n</code></pre>\n\n<h2>Question(s)</h2>\n\n<ol>\n<li>The <code>name</code> argument gives me the impression it can be executed by calling it by <code>name</code>, but how?</li>\n<li>The documentation gives the impression that <a href=\"https://godoc.org/github.com/jackc/pgx#ConnPool.Query\" rel=\"nofollow noreferrer\"><code>Query</code></a>/<a href=\"https://godoc.org/github.com/jackc/pgx#ConnPool.Exec\" rel=\"nofollow noreferrer\"><code>Exec</code></a> methods somehow leverage the prepared statements. However, those methods don't take a <code>name</code> argument. How does it match them?</li>\n<li>Presumably, matching is done by the query content. Then what's the whole point of naming statements?</li>\n</ol>\n\n<h3>Possible answers</h3>\n\n<p>This is how far I got myself:</p>\n\n<ol>\n<li>There are no methods that refer to the queries by name (assumption)</li>\n<li>Matching is done on the query body in <a href=\"https://github.com/jackc/pgx/blob/6067cfab4f674940e745d14579632430c2c33b32/conn.go#L1787-L1794\" rel=\"nofollow noreferrer\"><code>conn.ExecEx()</code></a>. If it is not yet prepared, it will be done:</li>\n</ol>\n\n<pre><code>ps, ok := c.preparedStatements[sql]\n            if !ok {\n                var err error\n                ps, err = c.prepareEx(\"\", sql, nil)\n                if err != nil {\n                    return \"\", err\n                }\n            }\n</code></pre>\n\n<ol start=\"3\">\n<li>PosgreSQL itself needs it for something (assumption).</li>\n</ol>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549833812, "post_id": 54619625, "comment_id": 96035056, "body": "When you encounter this specific error in your program (not the tests) what action do you take?"}, {"owner": {"reputation": 3247, "user_id": 625521, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f75ea35d0ffa8468c61f1fb2347a8000?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/625521/jonas"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549866375, "post_id": 54619625, "comment_id": 96042168, "body": "Panic can happen in package that is using bytes.Buffer . Package is handling this panic and transforming panic to normal error."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1549877851, "post_id": 54621889, "comment_id": 96047357, "body": "A nitpick: it&#39;s not a mock, <a href=\"https://martinfowler.com/articles/mocksArentStubs.html\" rel=\"nofollow noreferrer\">it&#39;s a stub</a>."}], "tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": true, "score": 3, "last_activity_date": 1549838724, "creation_date": 1549838724, "answer_id": 54621889, "question_id": 54619625, "link": "https://stackoverflow.com/questions/54619625/how-to-test-bytes-errtoolarge-panic-error/54621889#54621889", "title": "How to test bytes.ErrTooLarge panic error", "body": "<p>Sounds like a job for a mock object. Use this (badBuffer) in place of your bytes.Buffer during your test.</p>\n\n<pre><code>type badBuffer bytes.Buffer\n\nfunc (b *badBuffer) Write(p []byte) (n int, err error) {\n    panic(bytes.ErrTooLarge)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 3247, "user_id": 625521, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f75ea35d0ffa8468c61f1fb2347a8000?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/625521/jonas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 54621889, "answer_count": 1, "score": -1, "last_activity_date": 1549838724, "creation_date": 1549823267, "question_id": 54619625, "link": "https://stackoverflow.com/questions/54619625/how-to-test-bytes-errtoolarge-panic-error", "title": "How to test bytes.ErrTooLarge panic error", "body": "<p>I want to simulate bytes.ErrTooLarge panic error on bytes.Buffer.Write method and test panic handling. I have tried to write unlimited data amount to exceed memory but then whole test crashed. What are the other options?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 409, "user_id": 4476357, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lkPLG1GYS_Q/AAAAAAAAAAI/AAAAAAAAABg/gCmW6uoXgTk/photo.jpg?sz=128", "display_name": "cperez08", "link": "https://stackoverflow.com/users/4476357/cperez08"}, "is_accepted": false, "score": 0, "last_activity_date": 1550147569, "last_edit_date": 1550147569, "creation_date": 1549889994, "answer_id": 54631190, "question_id": 54618682, "link": "https://stackoverflow.com/questions/54618682/mongodb-get-items-inserted-in-last-30-min-ago/54631190#54631190", "title": "mongodb get items inserted in last 30 min ago", "body": "<p>You have two small things to fix here.</p>\n\n<ul>\n<li>If you want to fetch various records you should change the word <code>one</code> by <code>all</code></li>\n<li>you are doing a filter where your data time is Greater than, for this, you have to use a comparison query operator $gt</li>\n</ul>\n\n<p>here an example how your query should looks like</p>\n\n<p><code>collection.Find(bson.M{\"owner_id\": ownerID, \"created_at\": bson.M{\"$gt\": nowFormated}}).All(&amp;lt)</code></p>\n\n<p>Note: as this will return multiple records, remember change the <code>lt</code> by an slice.</p>\n"}], "owner": {"reputation": 25, "user_id": 10846813, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f022574070f0420981fabdfaf85a8?s=128&d=identicon&r=PG&f=1", "display_name": "ktskiun", "link": "https://stackoverflow.com/users/10846813/ktskiun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550147569, "creation_date": 1549817286, "question_id": 54618682, "link": "https://stackoverflow.com/questions/54618682/mongodb-get-items-inserted-in-last-30-min-ago", "title": "mongodb get items inserted in last 30 min ago", "body": "<p>i looking to check if exist item added in last 30 min in golang with mongodb.</p>\n\n<p>this is my type models:</p>\n\n<pre><code>type PayCoin struct {\n    ID            bson.ObjectId `json:\"id\" bson:\"_id\"`\n    OwnerID       bson.ObjectId `json:\"owner_id\" bson:\"owner_id\"`\n    PublicKey     string        `json:\"public_key\" bson:\"public_key\"`\n    PrivateKey    string        `json:\"-\" bson:\"private_key\"`\n    QrCode        string        `json:\"qrcode\" bson:\"-\"`\n    ExchangeRate  uint64        `json:\"exchange_rate\" bson:\"exchange_rate\"`\n    DepositAmount float32       `json:\"deposit_amount\" bson:\"deposit_amount\"`\n    Received      uint64        `json:\"received\" bson:\"received\"`\n    Completed     bool          `json:\"-\" bson:\"completed\"`\n    CreatedAt     time.Time     `json:\"created_at\" bson:\"created_at\"`\n    UpdatedAt     time.Time     `json:\"updated_at\" bson:\"updated_at\"`\n}\n</code></pre>\n\n<p>this is my current function :</p>\n\n<pre><code>func (s *Storage) CoinPayExistOperation(ownerID bson.ObjectId) (*models.PayCoin, error) {\n    collection := s.getCoinPay()\n    var lt models.PayCoin\n    timeFormat := \"2006-01-02 15:04:05\"\n    now := time.Now()\n    after := now.Add(-30*time.Minute)\n    nowFormated := after.Format(timeFormat)\n\n\n    err := collection.Find(bson.M{\"owner_id\": ownerID, \"created_at\": nowFormated}).One(&amp;lt)\n    return &amp;lt, err\n}\n</code></pre>\n\n<p>i want to check if exist items in database added in last 30 min, my current code not return any item, and in database exist. How i can do this ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1549851567, "last_edit_date": 1549851567, "creation_date": 1549817840, "answer_id": 54618757, "question_id": 54618633, "link": "https://stackoverflow.com/questions/54618633/parsing-time-as-2006-01-02t150405z0700-cannot-parse-as-2006/54618757#54618757", "title": "parsing time &quot;&quot;&quot;&quot; as &quot;&quot;2006-01-02T15:04:05Z07:00&quot;&quot;: cannot parse &quot;&quot;&quot; as &quot;2006&quot;", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"noreferrer\">Package time</a></p>\n  \n  <p>import \"time\"</p>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Time\" rel=\"noreferrer\">type Time</a></p>\n  \n  <p>A Time represents an instant in time with nanosecond precision.</p>\n  \n  <p>Programs using times should typically store and pass them as values,\n  not pointers. That is, time variables and struct fields should be of\n  type time.Time, not *time.Time.</p>\n</blockquote>\n\n<hr>\n\n<p>I just kept fixing likely problems, for example, <code>time.Time</code>, not <code>*time.Time</code>, a real date, and so on, until I got a reasonable result:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n    \"time\"\n)\n\ntype MyTime struct {\n    time.Time\n}\n\nfunc (m *MyTime) UnmarshalJSON(data []byte) error {\n    // Ignore null, like in the main JSON package.\n    if string(data) == \"null\" || string(data) == `\"\"` {\n        return nil\n    }\n    // Fractional seconds are handled implicitly by Parse.\n    tt, err := time.Parse(`\"`+time.RFC3339+`\"`, string(data))\n    *m = MyTime{tt}\n    return err\n}\n\ntype Added struct {\n    Added MyTime `json:\"added\"`\n}\n\nfunc main() {\n    st := strings.NewReader(`{\"added\": \"2012-04-23T18:25:43.511Z\"}`)\n\n    var a Added\n    err := json.NewDecoder(st).Decode(&amp;a)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Uusdp3DkXDU\" rel=\"noreferrer\">https://play.golang.org/p/Uusdp3DkXDU</a></p>\n\n<p>Output:</p>\n\n<pre><code>{2012-04-23 18:25:43.511 +0000 UTC}\n</code></pre>\n\n<p>With an empty (<code>\"\"</code>) date string, the <code>time.Time</code> zero value, <code>0001-01-01 00:00:00 +0000 UTC</code>:</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/eQoEyqBlhg2\" rel=\"noreferrer\">https://play.golang.org/p/eQoEyqBlhg2</a></p>\n\n<p>Output:</p>\n\n<pre><code>{0001-01-01 00:00:00 +0000 UTC}\n</code></pre>\n\n<p>Use the <code>time</code> <code>IsZero</code> method to test for the zero value.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/#Time.IsZero\" rel=\"noreferrer\">func (Time) IsZero</a></p>\n\n<pre><code>func (t Time) IsZero() bool\n</code></pre>\n  \n  <p>IsZero reports whether t represents the zero time instant, January 1,\n  year 1, 00:00:00 UTC.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": false, "score": 1, "last_activity_date": 1549855328, "last_edit_date": 1549855328, "creation_date": 1549842059, "answer_id": 54622281, "question_id": 54618633, "link": "https://stackoverflow.com/questions/54618633/parsing-time-as-2006-01-02t150405z0700-cannot-parse-as-2006/54622281#54622281", "title": "parsing time &quot;&quot;&quot;&quot; as &quot;&quot;2006-01-02T15:04:05Z07:00&quot;&quot;: cannot parse &quot;&quot;&quot; as &quot;2006&quot;", "body": "<p>I think you were very close to the solution with your custom marshaller. Maybe just revert to normal decoding for normal dates. This may help:</p>\n\n<pre><code>type MyTime time.Time\n\nfunc (m *MyTime) UnmarshalJSON(data []byte) error {\n    // Ignore null, like in the main JSON package.\n    if string(data) == \"null\" || string(data) == `\"\"` {\n        return nil\n    }\n    return json.Unmarshal(data, (*time.Time)(m))\n}\n</code></pre>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7395, "favorite_count": 2, "accepted_answer_id": 54618757, "answer_count": 2, "score": 4, "last_activity_date": 1549855328, "creation_date": 1549816952, "question_id": 54618633, "link": "https://stackoverflow.com/questions/54618633/parsing-time-as-2006-01-02t150405z0700-cannot-parse-as-2006", "title": "parsing time &quot;&quot;&quot;&quot; as &quot;&quot;2006-01-02T15:04:05Z07:00&quot;&quot;: cannot parse &quot;&quot;&quot; as &quot;2006&quot;", "body": "<p>I am trying to unmarshal some json into a struct and have the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n    \"time\"\n)\n\ntype Added struct {\n    Added *time.Time `json:\"added\"`\n}\n\nfunc main() {\n    st := strings.NewReader(`{\"added\": \"\"}`)\n\n    a := &amp;Added{}\n    err := json.NewDecoder(st).Decode(&amp;a)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(a)\n\n}\n</code></pre>\n\n<p>Running the above results in:</p>\n\n<pre><code>panic: parsing time \"\"\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"\"\" as \"2006\"\n</code></pre>\n\n<p>Ok, so I try a custom marshaller:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n    \"time\"\n)\n\ntype Added struct {\n    Added *MyTime `json:\"added\"`\n}\n\nfunc main() {\n    st := strings.NewReader(`{\"added\": \"\"}`)\n\n    a := &amp;Added{}\n    err := json.NewDecoder(st).Decode(&amp;a)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(a)\n\n}\n\ntype MyTime struct {\n    *time.Time\n}\n\nfunc (m *MyTime) UnmarshalJSON(data []byte) error {\n    // Ignore null, like in the main JSON package.\n    if string(data) == \"null\" || string(data) == `\"\"` {\n        return nil\n    }\n    // Fractional seconds are handled implicitly by Parse.\n    tt, err := time.Parse(`\"`+time.RFC3339+`\"`, string(data))\n    *m = MyTime{&amp;tt}\n    return err\n}\n</code></pre>\n\n<p>I then get:</p>\n\n<pre><code>&amp;{%!v(PANIC=runtime error: invalid memory address or nil pointer dereference)}\n</code></pre>\n\n<p>Ok, now what do I do? I'd simply like to handle the \"\" value from the json.</p>\n\n<p>My <a href=\"https://play.golang.org/p/NZXCXIyRZ_f\" rel=\"nofollow noreferrer\">playground</a> with the complete example is found.</p>\n"}]