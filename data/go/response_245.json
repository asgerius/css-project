[{"tags": ["c", "go", "linker"], "comments": [{"owner": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 1, "creation_date": 1568846478, "post_id": 58001562, "comment_id": 102408790, "body": "Maybe set up a build system with <code>make</code> or <code>ninja</code>?"}, {"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "reply_to_user": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568846641, "post_id": 58001562, "comment_id": 102408832, "body": "Wouldn&#39;t this still make me recompile the C?"}, {"owner": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568846751, "post_id": 58001562, "comment_id": 102408849, "body": "Not if you set it up right. Part of the purpose of such tools is that they support incremental compilation\u2014that is, only compiling files that have been changed since the last time they were compiled."}, {"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "reply_to_user": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568846908, "post_id": 58001562, "comment_id": 102408887, "body": "Cool! Could you point me toward a site that gives me a rough outline on this? I have looked through the documentation (no very much though) and did some google searches but found nothing."}, {"owner": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568847112, "post_id": 58001562, "comment_id": 102408936, "body": "<a href=\"https://www.gnu.org/software/make/manual/make.html\" rel=\"nofollow noreferrer\">Make manual</a>, <a href=\"https://ninja-build.org/manual.html\" rel=\"nofollow noreferrer\">Ninja manual</a>. They may be a bit dense, so google for more basic tutorials if you need."}, {"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "reply_to_user": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568849202, "post_id": 58001562, "comment_id": 102409307, "body": "I have googled and looked through both manuals. None mention using C and go."}, {"owner": {"reputation": 47629, "user_id": 900873, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/704ea9ee0d9090f571599bdf5f95eb39?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/900873/kevin"}, "edited": false, "score": 0, "creation_date": 1568849360, "post_id": 58001562, "comment_id": 102409334, "body": "Neither cares what languages you&#39;re using. Just set it up so the go file depends on the C object file, and the C object file depends on the C source. You may need to figure out the compiler flags to build go files one-at-a-time"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1568849473, "post_id": 58001562, "comment_id": 102409365, "body": "The problem is that you still need a build tool for Go that <code>make</code> or <code>ninja</code> will run, and that will build a minimal unit without all the dependencies.  The whole point of the question is that <code>go build</code> doesn&#39;t do that for the OP."}, {"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "edited": false, "score": 0, "creation_date": 1568850934, "post_id": 58001562, "comment_id": 102409666, "body": "Would that &quot;minimal unit without all the dependencies&quot; be an object file? Sorry for all  the questions."}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1568871886, "post_id": 58001562, "comment_id": 102413644, "body": "If you are not familiar with make, a simpler build tool is <a href=\"https://taskfile.dev/\" rel=\"nofollow noreferrer\">taskfile.dev</a>. Section <a href=\"https://taskfile.dev/#/usage?id=prevent-unnecessary-work\" rel=\"nofollow noreferrer\">taskfile.dev/#/usage?id=prevent-unnecessary-work</a> explains your use case. Regarding the proposed Ninja, I do not recommend to use it directly, it is too low-level. Use it via cmake. But again, taskfile is easier, although more verbose."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 1, "creation_date": 1568880229, "post_id": 58001562, "comment_id": 102417543, "body": "According to CGO page (<a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>) <code>... changes to files in other directories do not cause the package to be recompiled</code>"}, {"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "edited": false, "score": 0, "creation_date": 1568945212, "post_id": 58001562, "comment_id": 102444939, "body": "Did not see that! Must just be the linker. So sorry about this!"}], "owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1568846274, "creation_date": 1568846274, "question_id": 58001562, "link": "https://stackoverflow.com/questions/58001562/go-build-while-building-c-separately", "title": "go build while building C separately", "body": "<p>I have some Go code and some C code (quite a bit really).  I am calling the C code from the go code. Here is an example:</p>\n\n<p><strong>test.h</strong></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#ifndef TEST_H\n#define TEST_H\n\nvoid test();\n\n#endif\n</code></pre>\n\n<p><strong>test.c</strong></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include \"test.h\"\n\n#include &lt;stdio.h&gt;\n\nvoid test() {\n    printf(\"Hello from C!\")\n}\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n// #include \"test.h\"\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    C.test()\n}\n</code></pre>\n\n<p>Imagine I have much more C code. This C code takes a while to compile. When compiling using <code>go build</code>, it recompiles the C every time. Is it possible to compile the C and go separately? Meaning that if I am working on the Golang code, I won't have to compile to C code?</p>\n\n<p>I have tried linking the object files, but it seems very inefficient. If this is the best option? If so, could you provide a code example showing me how (as my way only works on Linux).</p>\n"}, {"tags": ["go", "ssl", "x509certificate", "x509"], "comments": [{"owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "reply_to_user": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "edited": false, "score": 0, "creation_date": 1568845882, "post_id": 58001289, "comment_id": 102408634, "body": "Thanks! Already found what I needed! Want to make that an answer and I will accept it?"}], "answers": [{"tags": [], "owner": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "is_accepted": true, "score": 2, "last_activity_date": 1568848418, "creation_date": 1568848418, "answer_id": 58001794, "question_id": 58001289, "link": "https://stackoverflow.com/questions/58001289/how-to-sign-cert-with-an-arbitrary-or-deprecated-extension/58001794#58001794", "title": "How to sign cert with an arbitrary or deprecated extension", "body": "<p>Go sources at <a href=\"https://golang.org/src/encoding/asn1/asn1.go\" rel=\"nofollow noreferrer\">https://golang.org/src/encoding/asn1/asn1.go</a> define:</p>\n\n<pre><code>// An ObjectIdentifier represents an ASN.1 OBJECT IDENTIFIER.\n\ntype ObjectIdentifier []int\n</code></pre>\n\n<p>So the object identifier (OID for short) is an array of integers. The asn1 module has methods to parse them, like <code>parseObjectIdentifier</code>.</p>\n\n<p>This is the structure you need to put after the <code>Id:</code> attribute.</p>\n\n<p>But now you need to find out the OID you want.</p>\n\n<p>While difficult to read, OpenSSL source code can show you OIDs of many things in the X.400/X.500/X.509 worlds, or at least those known by OpenSSL.</p>\n\n<p>If you go to <a href=\"https://github.com/openssl/openssl/blob/1aec7716c1c5fccf605a46252a46ea468e684454/crypto/objects/obj_dat.h\" rel=\"nofollow noreferrer\">https://github.com/openssl/openssl/blob/1aec7716c1c5fccf605a46252a46ea468e684454/crypto/objects/obj_dat.h</a></p>\n\n<p>and searching on <code>nsCertType</code> you get:</p>\n\n<pre><code>{\"nsCertType\", \"Netscape Cert Type\", NID_netscape_cert_type, 9, &amp;so[407]},\n</code></pre>\n\n<p><code>so</code> is defined previously, and if you jump at its 407<sup>th</sup> item you see:</p>\n\n<pre><code>    0x60,0x86,0x48,0x01,0x86,0xF8,0x42,0x01,0x01,  /* [  407] OBJ_netscape_cert_type */\n</code></pre>\n\n<p>and doing a final search on <code>OBJ_netscape_cert_type</code> in same file gives:</p>\n\n<pre><code>  71,    /* OBJ_netscape_cert_type           2 16 840 1 113730 1 1 */\n</code></pre>\n\n<p>which means the corresponding OID is 2.16.840.1.113730.1.1</p>\n\n<p>Or you can decode the above list of integers that describe this OID (see <a href=\"https://stackoverflow.com/questions/5929050/how-does-asn-1-encode-an-object-identifier\">How does ASN.1 encode an object identifier?</a> for details).</p>\n\n<ul>\n<li>first <code>0x60</code> is <code>96</code><sub>10</sub> so <code>2*40 + 16</code>, which means the OID starts with <code>2.16.</code></li>\n<li>then each other one is in \"base128\" form: if most significant bit is 1 combine the 7 least significant bits together of all following numbers until one has 0 as most significant bit</li>\n<li><code>0x86</code> is <code>10000110</code><sub>2</sub> so has to go with <code>0x48</code> aka <code>01001000</code><sub>2</sub> so it is in fact <code>00001101001000</code><sub>2</sub> or <code>840</code><sub>10</sub></li>\n<li><code>0x01</code> is less than 128 so it is itself, <code>1</code></li>\n<li><code>0x86</code> is still <code>10000110</code><sub>2</sub> but has to be paired with both <code>0xF8</code> (<code>11111000</code><sub>2</sub>) and <code>0x42</code> (<code>01000010</code><sub>2</sub> and we stop here since first bit is 0) so <code>000011011110001000010</code><sub>2</sub> altogether or <code>113730</code><sub>10</sub></li>\n<li>and the two last <code>0x01</code> are themselves, <code>1</code>.</li>\n</ul>\n\n<p>so we do get again <code>2.16.840.1.113730.1.1</code></p>\n\n<p>You can double check it at some online OID browser like here:\n<a href=\"http://oid-info.com/cgi-bin/display?oid=2.16.840.1.113730.1.1&amp;action=display\" rel=\"nofollow noreferrer\">http://oid-info.com/cgi-bin/display?oid=2.16.840.1.113730.1.1&amp;action=display</a>\nthat gives the following description for it:</p>\n\n<blockquote>\n  <p>Netscape certificate type (a Rec. ITU-T X.509 v3 certificate extension\n  used to identify whether the certificate subject is a Secure Sockets\n  Layer (SSL) client, an SSL server or a Certificate Authority (CA))</p>\n</blockquote>\n\n<p>You can then even browse various arcs, like the netscape one, or others, to find out other OIDs.</p>\n\n<p>You also get the full ASN.1 notation:</p>\n\n<pre><code>{joint-iso-itu-t(2) country(16) us(840) organization(1) netscape(113730) cert-ext(1) cert-type(1)}\n</code></pre>\n"}], "owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 58001794, "answer_count": 1, "score": 0, "last_activity_date": 1568848418, "creation_date": 1568844195, "last_edit_date": 1568845036, "question_id": 58001289, "link": "https://stackoverflow.com/questions/58001289/how-to-sign-cert-with-an-arbitrary-or-deprecated-extension", "title": "How to sign cert with an arbitrary or deprecated extension", "body": "<p>For example say I want to sign a cert with an arbitrary or deprecated extension (nsCertType for example): <a href=\"https://www.openssl.org/docs/manmaster/man5/x509v3_config.html\" rel=\"nofollow noreferrer\">https://www.openssl.org/docs/manmaster/man5/x509v3_config.html</a></p>\n\n<p>I believe I'm supposed to add the arbitrary extension as part of the certificate as per below but how / where do you discover the asn1 object identifier? I've read more documentation that I care to admit today and am still stumped. </p>\n\n<pre><code>tmpl := &amp;x509.Certificate{\n    SerialNumber:          big.NewInt(time.Now().Unix()*1000),\n    Subject:               pkix.Name{CommonName: \"edgeproxy\", Organization: []string{\"edgeproxy\"}},\n    NotBefore:             now,\n    NotAfter:              now.Add(caMaxAge),\n    ExtraExtensions:       []pkix.Extension{\n        {\n            Id: asn1.ObjectIdentifier{}, //what goes here\n            Critical: false,\n            []byte(\"sslCA\"),\n        },\n    },\n    ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth,x509.ExtKeyUsageClientAuth,x509.ExtKeyUsageEmailProtection, x509.ExtKeyUsageTimeStamping, x509.ExtKeyUsageMicrosoftCommercialCodeSigning, x509.ExtKeyUsageMicrosoftServerGatedCrypto, x509.ExtKeyUsageNetscapeServerGatedCrypto} ,\n    KeyUsage:              x509.KeyUsageCRLSign | x509.KeyUsageCertSign,\n    IsCA:                  true,\n    BasicConstraintsValid: true,\n}\n</code></pre>\n\n<p>In python I would do this but don't know how to port this into go (which is what I'm doing at the end of the day):</p>\n\n<pre><code>    OpenSSL.crypto.X509Extension(\n        b\"nsCertType\",\n        False,\n        b\"sslCA\"\n    ), \n</code></pre>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "edited": false, "score": 7, "creation_date": 1568842253, "post_id": 58000891, "comment_id": 102407702, "body": "I don&#39;t think that is a valid Json."}, {"owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "edited": false, "score": 5, "creation_date": 1568842421, "post_id": 58000891, "comment_id": 102407754, "body": "First, would recommend using a <a href=\"https://jsonlint.com\" rel=\"nofollow noreferrer\">JSON validator</a> and consult <a href=\"https://json.org/example.html\" rel=\"nofollow noreferrer\">how to write JSON</a>, then pass your now validated JSON to something like <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON to Go</a> to get a good idea of how to start"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568880993, "post_id": 58000891, "comment_id": 102417879, "body": "Your question doesn&#39;t make sense. 1. That&#39;s not JSON. 2. What&#39;s the best way <b>for what purpose</b>? 3. What have you tried? Include your code. What problems are you encountering?"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568899045, "post_id": 58002300, "comment_id": 102428030, "body": "A block of code with no explanation does not make for an effective answer."}], "tags": [], "owner": {"reputation": 9, "user_id": 12049424, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCKIpEMmgHtglOPjFe4ULNHlDDSc9ZwzItuZI8lug=k-s128", "display_name": "EE Hsiao", "link": "https://stackoverflow.com/users/12049424/ee-hsiao"}, "is_accepted": false, "score": -1, "last_activity_date": 1569315556, "last_edit_date": 1569315556, "creation_date": 1568853915, "answer_id": 58002300, "question_id": 58000891, "link": "https://stackoverflow.com/questions/58000891/problem-to-define-a-struct-and-marshall-it-to-json/58002300#58002300", "title": "Problem to define a struct and marshall it to json", "body": "<p>maybe as below that you want:</p>\n\n<pre><code>[\n    {\n        \"Database\" : \"flowers\",\n        \"Types\" : [\n            {\n                \"Type\" : \"sunflower\",\n                \"Location\" : \"behind\",\n                \"Height\" : \"130\"\n            },\n            {\n                \"Type\" : \"roses\",\n                \"Time\" : \"12:30\",\n                \"Date\" : \"12-12-2019\",\n                \"Height\" : \"150\"\n            }\n        ]\n    },\n    {\n        \"Database\" : \"fruits\",\n        \"Types\" : [\n            {\n                \"Type\" : \"apple\",\n                \"Height\" : \"200\"\n            },\n            {\n                \"Type\" : \"peer\",\n                \"Location\" : \"above\"\n            },\n            {\n                \"Type\" : \"banana\",\n                \"Color\" : \"green\"\n            }\n        ]\n    }\n]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": false, "score": 0, "last_activity_date": 1568881009, "last_edit_date": 1568881009, "creation_date": 1568878667, "answer_id": 58006006, "question_id": 58000891, "link": "https://stackoverflow.com/questions/58000891/problem-to-define-a-struct-and-marshall-it-to-json/58006006#58006006", "title": "Problem to define a struct and marshall it to json", "body": "<p>There are many ways that you could represent this data in your code and in json, here is just a couple of ways you could section it dependent on what is important to you and what you would do with the data after it is in the structs/json.</p>\n\n<pre><code>type (\nPlant struct {\n    Type            string              `json:\"type\"`           //flowers or fruits\n    Attributes      *PlantAttributes    `json:\"attributes\"`\n}\n\nPlantAttributes struct {\n    Name            string              `json:\"name\"`           //apple or roses etc\n    Location        string              `json:\"location\"`\n    Height          string              `json:\"height\"`\n    Time            string              `json:\"time\"`\n    Date            string              `json:\"date\"`\n    Color           string              `json:\"color\"`\n}\n</code></pre>\n\n<p>)</p>\n\n<p>or </p>\n\n<pre><code>type (\nFlowers struct {\n    Type            string                  `json:\"type\"`           // apples or bananas\n    Attributes      *PlantAttributes        `json:\"attributes\"`\n}\n\nFruit struct {\n    Type            string                  `json:\"type\"`           // sunflowers or roses\n    Attributes      *PlantAttributes        `json:\"attributes\"`\n}\n\nPlantAttributes struct {\n    Location        string              `json:\"location\"`\n    Height          string              `json:\"height\"`\n    Time            string              `json:\"time\"`\n    Date            string              `json:\"date\"`\n    Color           string              `json:\"color\"`\n}\n</code></pre>\n\n<p>)</p>\n"}], "owner": {"reputation": 1, "user_id": 12087240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GiXJ5G5bDkc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdTQal6QiS5FXkooUP4X8HBWyQMvA/photo.jpg?sz=128", "display_name": "Remco", "link": "https://stackoverflow.com/users/12087240/remco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": -9, "last_activity_date": 1569315556, "creation_date": 1568841812, "last_edit_date": 1568842386, "question_id": 58000891, "link": "https://stackoverflow.com/questions/58000891/problem-to-define-a-struct-and-marshall-it-to-json", "title": "Problem to define a struct and marshall it to json", "body": "<p>What would be the best way to represent the following in a struct / json string? -if even possible-</p>\n\n<p>Data i would like to handle looks something like:</p>\n\n<pre><code>{{Database : \"flowers\" ,  Type : \"sunflower\" - Location : \"behind\"\n                                           - Height   : \"130\"\n                     ,  Type : \"roses\"     - Time     : \"12:30\"\n                                           - Date     : \"12-12-2019\"\n                                           - Height   : \"150\" },\n{\nDatabase : \"fruits\"  ,  Type : \"apple\"     - Height   : \"200\"\n                     ,  Type : \"peer\"      - Location : \"above\"\n                     ,  Type : \"banana\"    - Color    : \"green\" }}\n</code></pre>\n\n<ul>\n<li>some of the items in a specific database like \"sunflower\" and \"apple\" for example have less or different specifications then \"roses\"</li>\n</ul>\n\n<p>Any hints where to start or any idea would be very helpfull and much appreciated.</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 1, "creation_date": 1568870852, "post_id": 58000650, "comment_id": 102413316, "body": "Maybe just change your logging pattern. Instead of appending log multiple messages with some progress information <code>First round [1&#47;3]</code>,  <code>First round [3&#47;3]</code>, <code>First round [2&#47;3]</code>. It would be very easy to filter out."}, {"owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1568871746, "post_id": 58000650, "comment_id": 102413587, "body": "Hmm, maybe, though this is just an abbreviated demo of what I&#39;m trying to do. In the actual program, the number of iterations is not fixed (it calls the API to pull pages of data until it done, not for a fixed number), and in some cases the number of iterations for each API can number in the hundreds. I thought about logging a new line for each API call, but that would result in a log file that could be thousands of lines long, and I decided against that. I&#39;m mostly interested in when an error occurs anyway, but the dots do let me know how many times an API was called."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "edited": false, "score": 0, "creation_date": 1568865142, "post_id": 58000798, "comment_id": 102412023, "body": "Oh man, that is really inconvenient. Going to have to think about this some more."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 4, "last_activity_date": 1568870685, "last_edit_date": 1568870685, "creation_date": 1568841221, "answer_id": 58000798, "question_id": 58000650, "link": "https://stackoverflow.com/questions/58000650/appending-to-current-line-with-log-package/58000798#58000798", "title": "Appending to current line with log package", "body": "<p>This cannot be achived. Logging package always adds end of line character. See <a href=\"https://golang.org/src/log/log.go#L169\" rel=\"nofollow noreferrer\">log.go line 169</a>.</p>\n\n<p>The logs can be written by many routines, therefore you no have guarantee that you attach to the previously logged line.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568898996, "post_id": 58003806, "comment_id": 102428002, "body": "If you use any concurrency, your logs may quickly become unreadable, with lines of interleaved messages from different goroutines."}, {"owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568902497, "post_id": 58003806, "comment_id": 102430217, "body": "@Adrian, you&#39;re right. Thankfully my program is only a single thread and the control flow is very linear. Otherwise I probably couldn&#39;t do this at all."}], "tags": [], "owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "is_accepted": false, "score": 1, "last_activity_date": 1568907513, "last_edit_date": 1568907513, "creation_date": 1568867918, "answer_id": 58003806, "question_id": 58000650, "link": "https://stackoverflow.com/questions/58000650/appending-to-current-line-with-log-package/58003806#58003806", "title": "Appending to current line with log package", "body": "<p>Grzegorz \u017bur is correct in his answer. Since the <code>log</code> package always appends a new line to the end of every string written to the log, there is no way to append more text to the end of that line when using that Writer, even if you bring in a different type of Writer to do the appends. I ended up having to roll my own.</p>\n\n<p>Package:</p>\n\n<pre><code>package mylogger\n\nimport (\n    \"os\"\n    \"bufio\"\n    \"time\"\n)\n\nvar logWriter *bufio.Writer\n\nfunc InitLogFile() (*os.File, error) {\n    logFile, err := os.Create(logPath)\n    if err != nil {\n        return nil, err\n    }\n\n    logWriter = bufio.NewWriter(logFile)\n\n    return logFile, nil\n}\n\nfunc Print(msg string) {\n    if logWriter != nil {\n        logWriter.WriteString(msg)\n        logWriter.Flush()\n    }\n}\n\nfunc NewLine(msg string) {\n    if logWriter != nil {\n        logWriter.WriteString(\"\\n\" + time.Now().Format(\"2006/02/01 15:04:05\") + \" \" + msg)\n        logWriter.Flush()\n    }\n}\n</code></pre>\n\n<p>Main program:</p>\n\n<pre><code>logFile, err := mylogger.InitLogFile()\ndefer logFile.Close()\n\nmylogger.NewLine(\"Starting first round\")\nfor i := 1; i &lt; 4; i++ {\n    request, err := http.NewRequest(\"GET\", \"http://www.someapi.com/pgNum=\" + i, nil)\n    response, err := client.Do(request)\n    mylogger.Print(\".\")\n}\n\nmylogger.NewLine(\"Starting second round\")\nfor j := 1; j &lt; 4; j++ {\n    request, err := http.NewRequest(\"GET\", \"http://www.someotherapi.com/pgNum=\" + j, nil)\n    response, err := client.Do(request)\n    mylogger.Print(\".\")\n}\n\nmylogger.NewLine(\"Done\")\n</code></pre>\n\n<p>This gets my desired result.</p>\n\n<p>Important note: This only works because my program operates in a single thread and has a linear flow. If there were any concurrency where different subroutines could call into the logging function at any time, this would fall apart very quickly.</p>\n\n<p>This is not my actual program, but an abbreviated gist of what it does. Error handling omitted for brevity. I'm not a Go expert, so I am open to comment.</p>\n"}], "owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568907513, "creation_date": 1568840345, "last_edit_date": 1568881081, "question_id": 58000650, "link": "https://stackoverflow.com/questions/58000650/appending-to-current-line-with-log-package", "title": "Appending to current line with log package", "body": "<p>I am writing a Go program and using the <code>log</code> package to write to a log file so that each new line will have a timestamp prepended to it. Sometimes I just want to append text to current line instead of starting a new line with the prepended timestamp.</p>\n\n<p>I thought the <code>log.Print()</code> method would do this, as the docs say it is supposed to work the same way as fmt.Print(). Instead, I have found that each call to <code>Print()</code> generates a new line with a timestamp. I can't find another method in the package that does what I am looking for.</p>\n\n<p>Is there a way to do this?</p>\n\n<p>Example program:</p>\n\n<pre><code>logFile, err := os.Create(\"myLog.log\")\ndefer logFile.Close()\nlogger := log.New(logFile, \"\", log.LstdFlags)\n\nlogger.Println(\"Starting first round\")\nfor i := 1; i &lt; 4; i++ {\n    request, err := http.NewRequest(\"GET\", \"http://www.someapi.com/pgNum=\" + i, nil)\n    response, err := client.Do(request)\n    logger.Print(\".\")\n}\n\nlogger.Println(\"Starting second round\")\nfor j := 1; j &lt; 4; j++ {\n    request, err := http.NewRequest(\"GET\", \"http://www.someotherapi.com/pgNum=\" + j, nil)\n    response, err := client.Do(request)\n    logger.Print(\".\")\n}\n\nlogger.Println(\"Done\")\n</code></pre>\n\n<p>Current output:</p>\n\n<pre><code>2019/09/18 13:27:49 Starting first round\n2019/09/18 13:27:49 .\n2019/09/18 13:27:50 .\n2019/09/18 13:27:51 .\n2019/09/18 13:27:52 Starting second round\n2019/09/18 13:27:52 .\n2019/09/18 13:27:53 .\n2019/09/18 13:27:54 .\n2019/09/18 13:27:55 Done\n</code></pre>\n\n<p>Desired output:</p>\n\n<pre><code>2019/09/18 13:27:49 Starting first round...\n2019/09/18 13:27:52 Starting second round...\n2019/09/18 13:27:55 Done\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 1, "user_id": 12087021, "user_type": "registered", "profile_image": "https://graph.facebook.com/1092102110926499/picture?type=large", "display_name": "Anton Z.", "link": "https://stackoverflow.com/users/12087021/anton-z"}, "edited": false, "score": 0, "creation_date": 1568840944, "post_id": 58000125, "comment_id": 102407274, "body": "UPD: also forgot to mention, if change environment in yaml to flex (no changes in the code) -- everything works (at least on single manual requests, didn&#39;t switched production to this)"}, {"owner": {"reputation": 746, "user_id": 11928097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K6NxO.jpg?s=128&g=1", "display_name": "Stefan G.", "link": "https://stackoverflow.com/users/11928097/stefan-g"}, "edited": false, "score": 0, "creation_date": 1568888925, "post_id": 58000125, "comment_id": 102422170, "body": "Hello Anton,   I&#39;ve been looking into the information you provided.  This seems to be a very specific situation, have you thought about raising this issue with GCP Support? They surely have many more tools to investigate and help you out."}, {"owner": {"reputation": 1, "user_id": 12087021, "user_type": "registered", "profile_image": "https://graph.facebook.com/1092102110926499/picture?type=large", "display_name": "Anton Z.", "link": "https://stackoverflow.com/users/12087021/anton-z"}, "reply_to_user": {"reputation": 746, "user_id": 11928097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K6NxO.jpg?s=128&g=1", "display_name": "Stefan G.", "link": "https://stackoverflow.com/users/11928097/stefan-g"}, "edited": false, "score": 0, "creation_date": 1568987664, "post_id": 58000125, "comment_id": 102461925, "body": "Yes, the interesting thing is... for about 20 hours envrionment was having this issue no matter what. Then it started running again, now up for 25 hours serving a part of splitted traffic (no code changes!) If the situation arises again, we will raise issue on GCP support as its probably on a level below of what we can diagnose. Will keep updating ticket and close it if situation can be considered resolved."}], "owner": {"reputation": 1, "user_id": 12087021, "user_type": "registered", "profile_image": "https://graph.facebook.com/1092102110926499/picture?type=large", "display_name": "Anton Z.", "link": "https://stackoverflow.com/users/12087021/anton-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1603844157, "creation_date": 1568837557, "question_id": 58000125, "link": "https://stackoverflow.com/questions/58000125/go1-12-2nd-gen-appengine-standard-cannot-make-any-request-to-external-resource", "title": "Go1.12 2nd Gen AppEngine Standard cannot make any request to external resource", "body": "<p>I've encountered a very strange issue regarding AppEngine behavior.\nWe are currently migrating from 1.9 version to 1.12 as 1.9 is going to be\nobsolete after 1st of October.\nAll went smooth, all APIs migrated, etc., etc.\nTested on staging environment (a separate GC Project for several days).</p>\n\n<p>After going to production, everything was alright for about 6 hours (!), after that\nall requests were timing out. Previous 1.9 version was kept alive and traffic was\nrerouted to it.</p>\n\n<p>Now this appears to be not a load problem: after the incident deploying Go 1.12 runtime without switching\nit as active version and accessing privately (a single request!) cannot be processed in a timely manner if\napplication handler has to make any request: to storage, datastore, or even plain http request\ndoes not work! e.g. even narrowing it down to:</p>\n\n<p>putting this code in main before everything else produces timeout\nafter deploy!</p>\n\n<p>AppEngine Standard environment. Go1.12. So no urlfetch.\nExample code (even no requests needed, multiple urls tested, all working locally and on STG Google Cloud Project with same code):</p>\n\n<pre><code>func main() {\n    fmt.Printf(\"Testing request to external server\\n\")\n    resp, err := http.Get(\"https://www.example.com\")\n    if err != nil {\n        fmt.Printf(\"Error making request to external server: %v\\n\", err)\n    }\n\n    data, err := ioutil.ReadAll(resp.Body)\n    if len(string(data)) &gt; 255 {\n        fmt.Printf(\"Content: %v\\n\", string(data)[0:255])\n    } else {\n        fmt.Printf(\"Content: %v\\n\", string(data))\n    }\n    resp.Body.Close()\n    ...\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), r))\n}\n</code></pre>\n\n<p>Results in this message during instance startup after deploy</p>\n\n<pre><code>Error making request to external server: Get https://www.example.com: dial tcp 123.123.123.123: i/o timeout\nStart program failed: failed to detect app after start: ForAppStart(): [aborted, context canceled. subject:\"app/valid\" Timeout:30m0s, attempts:6073 aborted, context canceled. subject:\"app/invalid\" Timeout:30m0s, attempts:6074]\n</code></pre>\n\n<p>(2nd line is understandable -- it just cannot connect and waits for too long).</p>\n\n<p>The most weird thing is if to deploy this code on staging environment (exactly the same file)\nit works. Seems that like GAE ran out of connection attempts or something like that on production\nenvironment in several hours (this is a pretty high-load project) and cannot proceed.</p>\n\n<p>What can be the issue of this behavior? Is it a bug? What can be leaking and how to diagnose this?\nI'm running out of ideas, googled for hours, any help would be appreciated.</p>\n"}, {"tags": ["go", "mongodb-query", "mgo"], "comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1568838670, "post_id": 57999323, "comment_id": 102406489, "body": "To be clear, you are checking the error, right? What you&#39;re experiencing is an error-free empty result set? If that&#39;s the case, I&#39;m worried your problem is somewhere else. Maybe it&#39;s the data? How the server is configured? Maybe some sort of data type mismatch? It certainly does not appear to be the mgo query. Does your <code>instance</code> struct have it&#39;s tags set up properly?"}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 5959651, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/195fa12ab8961f3ae65ce685060794a3?s=128&d=identicon&r=PG&f=1", "display_name": "Lin0523", "link": "https://stackoverflow.com/users/5959651/lin0523"}, "edited": false, "score": 0, "creation_date": 1568834821, "post_id": 57999471, "comment_id": 102405021, "body": "I&#39;ve tried that, also doesn&#39;t seem to work. Originally for status I was only ignoring the deleted ones using $ne, and that worked perfectly fine."}], "tags": [], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "is_accepted": false, "score": 0, "last_activity_date": 1568834197, "creation_date": 1568834197, "answer_id": 57999471, "question_id": 57999323, "link": "https://stackoverflow.com/questions/57999323/converting-mongodb-query-to-mgo/57999471#57999471", "title": "Converting Mongodb query to mgo", "body": "<p><code>$and</code> is unnecessary here. Mongo requires all fields in a query to be true for a document to be returned in the result set. Try setting them all in the same bson.M:</p>\n\n<pre><code>err := appInstanceCollection.Find(bson.M{\n    \"status\": bson.M{\"$nin\": []string{\"REJECTED\", \"DELETED\"}},\n    \"_id\": instanceID,\n  },\n}).One(&amp;instance)\n</code></pre>\n\n<p>As for why your provided <code>$and</code> mgo query doesn't work, I'm not sure. It looks fine to me.</p>\n"}], "owner": {"reputation": 151, "user_id": 5959651, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/195fa12ab8961f3ae65ce685060794a3?s=128&d=identicon&r=PG&f=1", "display_name": "Lin0523", "link": "https://stackoverflow.com/users/5959651/lin0523"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568834197, "creation_date": 1568833455, "question_id": 57999323, "link": "https://stackoverflow.com/questions/57999323/converting-mongodb-query-to-mgo", "title": "Converting Mongodb query to mgo", "body": "<p>I'm trying to do a query in mongo that basically will be...Get all documents that match this instance Id AND where the status does not equal Deleted or Rejected. I figured out how to do this in mongodb query but I'm having an issue translating it to golang mgo.</p>\n\n<p>This is the mongodb query:</p>\n\n<pre><code>db.getCollection('instance_documents').find( {\"$and\":[\n        { \"status\": {\"$nin\":['DELETED', \"REJECTED\"] }},\n        {\"_id\": \u201cinstanceID\u201d}\n    ]\n})\n</code></pre>\n\n<p>This is what I've tried so far in golang, the query does not work properly, it returns nothing:</p>\n\n<pre><code>err := appInstanceCollection.Find(bson.M{\n        \"$and\": []bson.M{\n                    {\"status\": bson.M{\"$nin\": []string{\"REJECTED\", \"DELETED\"}}},\n                    {\"_id\": instanceID},\n            },\n    }).One(&amp;instance)\n\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1569293960, "post_id": 58034696, "comment_id": 102540298, "body": "One thing to note: mongo-go&#39;s session is not the same concept as mgo&#39;s session. The rough equivalent of mgo&#39;s <code>Session</code> is mongo-go&#39;s <code>Client</code>. In mongo-go a session is used to group a series of operations which may be executed in a single transaction (which is not supported in mgo)."}], "tags": [], "owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "is_accepted": true, "score": 3, "last_activity_date": 1569010741, "creation_date": 1569010741, "answer_id": 58034696, "question_id": 57998402, "link": "https://stackoverflow.com/questions/57998402/how-can-i-convert-my-mgo-sessions-to-mongo-go-driver-clients-using-connection-po/58034696#58034696", "title": "How can I convert my mgo sessions to mongo-go-driver clients using connection pooling?", "body": "<p>There are a couple things I learned on this quest through the mongo-go-driver codebase that I thought I should share with the world before closing this question. If I'm wrong here - please correct me.</p>\n\n<p>You should not call <code>Connect()</code> over and over if you want to leverage connection pooling. It looked like each time Connect() was called, a new socket was created. This means that there's a risk of socket exhaustion over time unless you are manually <code>defer Close()</code>-ing it each time.</p>\n\n<p>In mongo-go-driver, sessions are automatically handled under the covers now when you make the call to execute the query (e.g. <code>All()</code>). You can* explicitly create and teardown a session, but you can't consume it using the singleton approach I proposed above without having to change all the caller functions.\nThis is because you can no longer call query operations on the session, you instead have to consume it using a WithSession function at the DB operation itself</p>\n\n<p>I realized that <code>writeconcern</code>, <code>readpref</code> and <code>readconcern</code> can all be set at the:</p>\n\n<ul>\n<li>client level (these are the defaults that everything will use if not overridden)</li>\n<li>session level</li>\n<li>database level</li>\n<li>query level</li>\n</ul>\n\n<p>So what I did is create Database options and overloaded *mongo.Database e.g.:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Database is a meta-helper that allows us to wrap and overload\n// the standard *mongo.Database type\ntype Database struct {\n    *mongo.Database\n}\n\n// NewEventualConnection returns a new instantiated Connection\n// to the DB using the 'Nearest' read preference.\n// Per https://github.com/go-mgo/mgo/blob/v2/session.go#L61\n// Eventual is the same as Nearest, but may change servers between reads.\n// Nearest: The driver reads from a member whose network latency falls within\n// the acceptable latency window. Reads in the nearest mode do not consider\n// whether a member is a primary or secondary when routing read operations;\n// primaries and secondaries are treated equivalently.\nfunc NewEventualConnection() (conn *Connection, success bool) {\n    conn = &amp;Connection{\n        client: baseConnection.client,\n        dbOptions: options.Database().\n            SetReadConcern(readconcern.Local()).\n            SetReadPreference(readpref.Nearest()).\n            SetWriteConcern(writeconcern.New(\n                writeconcern.W(1))),\n    }\n\n    return conn, true\n}\n// GetDB returns an overloaded Database object\nfunc (conn Connection) GetDB(dbname string) *Database {\n    dbByName := &amp;Database{conn.client.Database(dbname, conn.dbOptions)}\n}\n</code></pre>\n\n<p>This allows me to leverage connection pooling and maintain backwards compatibility with our codebase. Hopefully this helps someone else.</p>\n"}], "owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 1, "accepted_answer_id": 58034696, "answer_count": 1, "score": 6, "last_activity_date": 1569294396, "creation_date": 1568829407, "last_edit_date": 1569294396, "question_id": 57998402, "link": "https://stackoverflow.com/questions/57998402/how-can-i-convert-my-mgo-sessions-to-mongo-go-driver-clients-using-connection-po", "title": "How can I convert my mgo sessions to mongo-go-driver clients using connection pooling?", "body": "<p>Long, long ago, when we were using mgo.v2, we created some wrapper functions that copied the session, set the read pref and returned that for consumption by other libraries, e.g.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func NewMonotonicConnection() (conn *Connection, success bool) {\n    conn := &amp;Connection{\n        session: baseSession.Copy(),\n    }\n    conn.session.SetMode(mongo.Monotonic, true)\n\n    return conn, true\n}\n</code></pre>\n\n<p>We now just pass the default client (initialized using mongo.Connect and passed into a connection singleton) in an init function and then consumed like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func NewMonotonicConnection() (conn *Connection, success bool) {\n    conn = defaultConnection\n    return conn, true\n}\n</code></pre>\n\n<p>My understanding is that to leverage connection pooling, you need to use the same client (which is contained in defaultConn), and session is now implicitly handled inside of the <code>.All()</code>/cursor teardown. Please correct me if I'm wrong here.</p>\n\n<p>It would be nice if we could still set the readpref on these connections (e.g. set NearestMode on this connection before returning), but what's the community/standard way of doing that?</p>\n\n<ul>\n<li>I know I could call mongo.Connect over and over again, but is that expensive?</li>\n<li>I could create different clients - each client with a different readpref - but I was thinking that if a write occurred on that connection, it wouldn't ever go back to reading from a slave.</li>\n<li>It looks like I *can create sessions explicitly, but I'm not certain I should or if there are any implications around managing those explicitly in the new driver.</li>\n</ul>\n"}, {"tags": ["sockets", "go", "networking", "udp"], "comments": [{"owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "edited": false, "score": 0, "creation_date": 1568973334, "post_id": 57998208, "comment_id": 102454414, "body": "@frog2000 is correct, the problem was packet fragmentation and nothing to do with hole punching. Making sure packet size did not exceed MTU fixed the problem."}], "answers": [{"comments": [{"owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "edited": false, "score": 0, "creation_date": 1568831611, "post_id": 57998675, "comment_id": 102403696, "body": "Oh I see - yes you are right on the frame, I found that record (118) and it does indeed have the ports. I cannot rely on changing MTU as I am trying to develop an application which will be installed at sites where I have no such control.  I will try reducing packet size and see whether that makes a difference."}], "tags": [], "owner": {"reputation": 111, "user_id": 12086639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1f84e137e1edabbcbee21c67552993f?s=128&d=identicon&r=PG&f=1", "display_name": "frog2000", "link": "https://stackoverflow.com/users/12086639/frog2000"}, "is_accepted": true, "score": 5, "last_activity_date": 1568831246, "last_edit_date": 1568831246, "creation_date": 1568830598, "answer_id": 57998675, "question_id": 57998208, "link": "https://stackoverflow.com/questions/57998208/returned-udp-packets-lacking-port-and-fail-to-arrive/57998675#57998675", "title": "Returned UDP packets lacking port and fail to arrive", "body": "<p>This packet is fragmented, You can see this under Internet Protocol Version 4 > Flags. </p>\n\n<p>If you look at the frame as shown on the bottom of the picture you provided you should see the ports. </p>\n\n<p>net.ListenUDP doesn't appear to support fragmentation at the socket level. </p>\n\n<p>Do you have a PPPoe connection? You may need to reduce your packet size being sent by 8 bytes or change the MTU on the routers external interface of the remote side. You may also need to change the local routers MTU if it's on a PPPoe interface. </p>\n"}], "owner": {"reputation": 761, "user_id": 679310, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f3a5fd7af147a1e37d028b58a971db75?s=128&d=identicon&r=PG", "display_name": "richp10", "link": "https://stackoverflow.com/users/679310/richp10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57998675, "answer_count": 1, "score": 0, "last_activity_date": 1568831246, "creation_date": 1568828590, "question_id": 57998208, "link": "https://stackoverflow.com/questions/57998208/returned-udp-packets-lacking-port-and-fail-to-arrive", "title": "Returned UDP packets lacking port and fail to arrive", "body": "<p>Golang application with a client and server.  </p>\n\n<p>Server uses net.ListenUDP -- client also uses net.ListenUDP, connects to server and sends a packet with conn.WriteToUDP with the server address.  </p>\n\n<p>Server receives the packet with ReadFromUDP and grabs the return address.  Using this return address, it then sends a large number of packets back to the client. </p>\n\n<p>When running both client and server on local machine, this works perfectly. Using Wireshark I can inspect the UDP packets and see that they contain the source and destination ports - and in the application I can see that they arrive and my various checksum tests show the data is accurate. </p>\n\n<p>I then moved the server off site to a remote machine.  The application stops working.  I can successfully send the first message from the client to server - this is received just fine.  The server sends the response back 'toward' the client - but the client never receives them. </p>\n\n<p>Using Wireshark, I can see that the packets do arrive back on the local machine with the correct IP address.  It appears that my network router has performed NAT on the outgoing packets - and has correctly re-addressed response packets to the internal IP.. BUT there is no port. </p>\n\n<p>So I have UDP packets arriving on the correct machine, but no port - so the client application does not receive them. Application times out on ReadFromUDP. </p>\n\n<p>I don't know if it is relevant, but on local machine, Wireshark labels the packets as BT-uTP Utorrent packets.  When they come in from remote server, this is what I see in Wireshark - note the lack of Port. </p>\n\n<p><a href=\"https://i.stack.imgur.com/B9jtx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/B9jtx.png\" alt=\"screenshot of wireshark data\"></a></p>\n\n<p>Any thoughts how I can solve this.  I didn't think this was a UDP hole punching problem because although I am establishing a connection across a NAT it is with a server not a peer. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568824217, "post_id": 57997159, "comment_id": 102400795, "body": "<code>myInt64 := int64(myUint32)</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1568824266, "post_id": 57997159, "comment_id": 102400824, "body": "Taking the <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">Tour of Go</a> should answer most of your basic syntax questions."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1568824284, "post_id": 57997159, "comment_id": 102400830, "body": "@Adrian: That will only give you half the random bits expected."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568824573, "post_id": 57997159, "comment_id": 102400961, "body": "The question is quite obviously about how to convert a uint32 to meaningful output for a random source."}], "answers": [{"comments": [{"owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "edited": false, "score": 0, "creation_date": 1568826039, "post_id": 57997258, "comment_id": 102401517, "body": "just off the question: Would it be better to implement math.rand&#39;s Uint64() as (uint64(r.Uint32()) &lt;&lt; 32) | (uint64(r.Uint32()) &amp; 0xffffffff), instead of the <a href=\"https://golang.org/src/math/rand/rand.go#L91\" rel=\"nofollow noreferrer\">default</a> if my sources comes from 32-bits?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "edited": false, "score": 0, "creation_date": 1568880082, "post_id": 57997258, "comment_id": 102417479, "body": "I&#39;m not sure what you&#39;re asking. Are you asking if 32 random bits, repeated, is better than a pseudo-random number? I don&#39;t think there&#39;s a definitive answer to that. It depends on how you&#39;re using it. The best would be to read two 32-bit random numbers from your source, and combine them."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1568824499, "creation_date": 1568824499, "answer_id": 57997258, "question_id": 57997159, "link": "https://stackoverflow.com/questions/57997159/how-to-feed-a-random-source-with-uint32s/57997258#57997258", "title": "How to feed a random source with uint32s", "body": "<p>Converting a <code>uint32</code> to an <code>int64</code> is quite simple:</p>\n\n<pre><code>var u32 uint32 = /* some number */\nvar i64 int64 = int64(u32)\n</code></pre>\n\n<p>The problem with this alone is that you'll end up with an int64 that's half 0 bits, so you probably want to combine two of them:</p>\n\n<pre><code>var u1, u2 uint32 = /* two numbers */\nvar i64 uint64 = int64(u1) + int64(u2)&lt;&lt;32\n</code></pre>\n\n<p>See a complete example <a href=\"https://play.golang.org/p/YTdQytGIYms\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568824697, "creation_date": 1568824079, "last_edit_date": 1568824697, "question_id": 57997159, "link": "https://stackoverflow.com/questions/57997159/how-to-feed-a-random-source-with-uint32s", "title": "How to feed a random source with uint32s", "body": "<p>I'm trying to implement a 32-bit (MT19937-32, LFSR113 &amp; LFSR88, among others) random sources in Go, but <code>math.Rand</code>'s source interface accepts <code>Int63()</code> as method. </p>\n\n<p>How do we convert <code>uint32</code> to <code>int64</code> (non-negative int64, or 63-bit)</p>\n\n<p>here's an LFSR88 code (some methods and consts omitted):</p>\n\n<pre><code>type LFSR88 struct {\n    s1, s2, s3, b uint32\n}\n\n.\n.\n.\n\nfunc (lfsr *LFSR88) Uint32() uint32 {\n    lfsr.b = (((lfsr.s1 &lt;&lt; 13) ^ lfsr.s1) &gt;&gt; 19)\n    lfsr.s1 = (((lfsr.s1 &amp; 4294967294) &lt;&lt; 12) ^ lfsr.b)\n    lfsr.b = (((lfsr.s2 &lt;&lt; 2) ^ lfsr.s2) &gt;&gt; 25)\n    lfsr.s2 = (((lfsr.s2 &amp; 4294967288) &lt;&lt; 4) ^ lfsr.b)\n    lfsr.b = (((lfsr.s3 &lt;&lt; 3) ^ lfsr.s3) &gt;&gt; 11)\n    lfsr.s3 = (((lfsr.s3 &amp; 4294967280) &lt;&lt; 17) ^ lfsr.b)\n    return (lfsr.s1 ^ lfsr.s2 ^ lfsr.s3)\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "goracle"], "comments": [{"owner": {"reputation": 2069, "user_id": 11207414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8d2b0efd28e43f5580e7546cf912f5?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/11207414/mark"}, "edited": false, "score": 0, "creation_date": 1568892682, "post_id": 57996954, "comment_id": 102424235, "body": "It could be a network related <a href=\"https://tech.xing.com/a-reason-for-unexplained-connection-timeouts-on-kubernetes-docker-abd041cf7e02\" rel=\"nofollow noreferrer\">issue</a> From another point of view you should try to to watch the progress of your query/task - once finished your script should finished as completed <a href=\"https://stackoverflow.com/questions/10132847/how-to-see-progress-of-running-sql-stored-procedures\">example</a>"}, {"owner": {"reputation": 6003, "user_id": 4799035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tuyZM.jpg?s=128&g=1", "display_name": "Christopher Jones", "link": "https://stackoverflow.com/users/4799035/christopher-jones"}, "edited": false, "score": 0, "creation_date": 1570700977, "post_id": 57996954, "comment_id": 102999339, "body": "At a guess, try setting the SQL*Net option EXPIRE_TIME.  If your Oracle client libraries are 18+, you can set this in a &quot;client&quot; sqlnet.ora file where you deploy your app.  With a 19c client you could even add it to the connection string, see the last paragraph in <a href=\"https://oracle.github.io/node-oracledb/doc/api.html#-1421-easy-connect-syntax-for-connection-strings\" rel=\"nofollow noreferrer\">oracle.github.io/node-oracledb/doc/&hellip;</a> which is also valid for goracle.  If you have older clients, you will need to set this in the database sqlnet.ora, or use the even older ENABLE=BROKEN option"}], "owner": {"reputation": 1, "user_id": 6189817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JxJjK.jpg?s=128&g=1", "display_name": "Rafael B. S. Santos", "link": "https://stackoverflow.com/users/6189817/rafael-b-s-santos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570899036, "creation_date": 1568823256, "last_edit_date": 1570899036, "question_id": 57996954, "link": "https://stackoverflow.com/questions/57996954/problems-with-oracle-long-lived-connection-in-kubernetes-cluster", "title": "Problems with Oracle long-lived connection in Kubernetes cluster", "body": "<p>I am trying to deploy a Go application inside the Kubernetes cluster. My application uses the <code>goracle.v2</code> library to connect to the Oracle database. </p>\n\n<p>The problem only happens when my application is running inside the Kubernetes cluster. I have a process that executes a stored procedure and returns a cursor, and it often takes more than 10 minutes to execute. </p>\n\n<p>When this happens the active session that was there in the database ends and the pod that was running with the application is stopped and nothing else happens. And this scenario only happens when it runs inside the cluster. If I run the app locally it doesn't happen even if the process takes more than 10 minutes.</p>\n\n<p>Anyone have any idea what might be happening?</p>\n"}, {"tags": ["go", "ssl", "http-proxy"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1568820646, "post_id": 57995716, "comment_id": 102399000, "body": "You omitted the most important bit: <code>getCert</code>. Aside: the RootCAs field is meaningless for servers."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1568822219, "post_id": 57995716, "comment_id": 102399905, "body": "Also note that the root certificate is not usually included in the chain. There&#39;s no point in doing so. Clients are expected to already have the root certificate in their pool of trusted CAs. Including them in the chain adds no useful information and just wastes bandwidth."}, {"owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1568822705, "post_id": 57995716, "comment_id": 102400153, "body": "@Peter thanks peter, I&#39;ll update the post so that getCert is included within my gist."}], "answers": [{"comments": [{"owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "edited": false, "score": 0, "creation_date": 1568822962, "post_id": 57996434, "comment_id": 102400287, "body": "Thanks Peter! That was my missing piece. And yes your assumption was correct."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1568823021, "last_edit_date": 1568823021, "creation_date": 1568821163, "answer_id": 57996434, "question_id": 57995716, "link": "https://stackoverflow.com/questions/57995716/how-to-create-a-certificate-chain/57996434#57996434", "title": "How to create a certificate chain", "body": "<p>Go doesn't magically include the CA certificate in the TLS handshake. If you expected RootCAs to cause that, you are mistaken. It is irrelevant for servers:</p>\n\n<blockquote>\n  <p>RootCAs defines the set of root certificate authorities that <strong>clients</strong> use when verifying server certificates.</p>\n</blockquote>\n\n<p>You can either change GenerateCert to return the whole chain:</p>\n\n<pre><code>--- cert.go.orig        2019-09-18 17:35:29.408807334 +0200\n+++ cert.go     2019-09-18 17:35:45.028779955 +0200\n@@ -46,11 +46,11 @@\n        x, err := x509.CreateCertificate(rand.Reader, template, ca.Leaf, key.Public(), ca.PrivateKey)\n        if err != nil {\n                return nil, err\n        }\n        cert := new(tls.Certificate)\n-       cert.Certificate = append(cert.Certificate, x)\n+       cert.Certificate = append(cert.Certificate, x, ca.Leaf.Raw)\n        cert.PrivateKey = key\n        cert.Leaf, _ = x509.ParseCertificate(x)\n        return cert, nil\n }\n</code></pre>\n\n<p>... or make getCert append the CA cert in a similar fashion:</p>\n\n<pre><code>--- cert.go.orig        2019-09-18 18:07:45.924405370 +0200\n+++ cert.go     2019-09-18 18:08:11.998359456 +0200\n@@ -61,7 +61,8 @@\n func getCert(ca *tls.Certificate, host string) (*tls.Certificate, error) {\n        cert, err := GenerateCert(ca, host)\n        if err != nil {\n                return nil, err\n        }\n+       cert.Certificate = append(cert.Certificate, ca.Leaf.Raw)\n        return cert, nil\n }\n</code></pre>\n"}], "owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 57996434, "answer_count": 1, "score": 1, "last_activity_date": 1568823021, "creation_date": 1568818662, "last_edit_date": 1568822807, "question_id": 57995716, "link": "https://stackoverflow.com/questions/57995716/how-to-create-a-certificate-chain", "title": "How to create a certificate chain", "body": "<p>I'm working on a proxy server for automating browser integration tests. I've gotten to a place where I can create a root CA cert and then my self signed cert.</p>\n\n<p>However, where I'm failing is \"joining\" these together into a valid certificate chain that is then served. I feel like I'm missing something very trivial as the CA is created correctly and the self signed cert is being signed by the CA however the certificate chain never shows the CA when viewing the generated certificate within a browser.</p>\n\n<p>I realize this is somewhat a cryptic question, but let me know how I can make this more clear.</p>\n\n<p>Thanks everyone!</p>\n\n<pre><code>func Server(cn net.Conn, p ServerParam) *ServerConn {\n    conf := new(tls.Config)\n    if p.TLSConfig != nil {\n        *conf = *p.TLSConfig\n    }\n    sc := new(ServerConn)\n    // this is the CA certificate that is performing the signing and I had though would show as the \"root\" certificate in the chain\n    conf.RootCAs = buildBoolFromCA(p.CA)\n    conf.GetCertificate = func(hello *tls.ClientHelloInfo) (*tls.Certificate, error) {\n        sc.ServerName = hello.ServerName\n        // the self signed cert that is generated (the root CA however is not part of the chain\n        return getCert(p.CA, hello.ServerName)\n    }\n    sc.Conn = tls.Server(cn, conf)\n    return sc\n}\n</code></pre>\n\n<p>To reduce the size of this post I created a small gist here to show where I'm generating the CA and the self signed certificate: <a href=\"https://gist.github.com/jredl-va/d5df26877fc85095115731d98ea5ff33\" rel=\"nofollow noreferrer\">https://gist.github.com/jredl-va/d5df26877fc85095115731d98ea5ff33</a></p>\n\n<p><em>Update 1</em>\nAdded get cert to gist</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568833685, "post_id": 57995254, "comment_id": 102404576, "body": "The question title is misleading: There are no methods in your code."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1568817410, "creation_date": 1568817410, "answer_id": 57995330, "question_id": 57995254, "link": "https://stackoverflow.com/questions/57995254/method-on-unnamed-struct-type/57995330#57995330", "title": "Method on unnamed struct type", "body": "<p>The text </p>\n\n<pre><code>struct {\n   sync.Mutex\n   mapping map[string]string\n} {\n   mapping: make(map[string]string),\n}\n</code></pre>\n\n<p>is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>.  The <a href=\"https://golang.org/ref/spec#LiteralType\" rel=\"nofollow noreferrer\">literal's type</a> is the anonymous <a href=\"https://golang.org/ref/spec#StructType\" rel=\"nofollow noreferrer\">struct type</a>:</p>\n\n<pre><code>struct {\n   sync.Mutex\n   mapping map[string]string\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/ref/spec#LiteralValue\" rel=\"nofollow noreferrer\">literal's value</a> is </p>\n\n<pre><code>{\n   mapping: make(map[string]string),\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1568817412, "creation_date": 1568817412, "answer_id": 57995331, "question_id": 57995254, "link": "https://stackoverflow.com/questions/57995254/method-on-unnamed-struct-type/57995331#57995331", "title": "Method on unnamed struct type", "body": "<p>Let's break it down:</p>\n\n<pre><code>// create a variable cache of type anonymous struct\nvar cache = struct {\n    // Define anonymous struct fields\n    sync.Mutex\n    mapping map[string]string\n} { // Close struct definition; open value literal\n    mapping: make(map[string]string), // specify a field in the value\n} // Close value literal\n</code></pre>\n\n<p>Basically this statement defines a variable <code>cache</code>, specifies its type, and assigns it a value. The first set of braces encloses the type definition, the second set encloses the value literal. The variable's type is <code>struct { sync.Mutex, mapping map[string]string }</code>.</p>\n"}], "owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 57995330, "answer_count": 2, "score": 0, "last_activity_date": 1568818749, "creation_date": 1568817183, "last_edit_date": 1568818749, "question_id": 57995254, "link": "https://stackoverflow.com/questions/57995254/method-on-unnamed-struct-type", "title": "Method on unnamed struct type", "body": "<p>I'm trying to understand what the below code block does;</p>\n\n<pre><code>var cache = struct {\nsync.Mutex\nmapping map[string]string\n} {\nmapping: make(map[string]string),\n}\n</code></pre>\n\n<p>I don't understand the presence of <code>} {</code> or what the last line does.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568814632, "post_id": 57994273, "comment_id": 102395305, "body": "What is <code>router</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568819301, "post_id": 57994273, "comment_id": 102398228, "body": "Your code is unreadable. Please reformat your question to make it readable."}], "answers": [{"tags": [], "owner": {"reputation": 584, "user_id": 2499597, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4227019ae870abe1494266614ffa7224?s=128&d=identicon&r=PG", "display_name": "J19", "link": "https://stackoverflow.com/users/2499597/j19"}, "is_accepted": false, "score": -1, "last_activity_date": 1568815574, "creation_date": 1568815574, "answer_id": 57994673, "question_id": 57994273, "link": "https://stackoverflow.com/questions/57994273/how-can-i-fix-post-404-error-using-go-its-not-source-code-error/57994673#57994673", "title": "How can i fix POST 404 error using go? It&#39;s not source code error", "body": "<p>when you define your uri for HandlerFunc, parameters must go between {}</p>\n\n<p>/users/{id} instead of /users/:id</p>\n"}], "owner": {"reputation": 1, "user_id": 12085429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df5cc071b96b5742e5ce9d9f1333a508?s=128&d=identicon&r=PG&f=1", "display_name": "jeeongminje", "link": "https://stackoverflow.com/users/12085429/jeeongminje"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1568833537, "creation_date": 1568814433, "last_edit_date": 1568833537, "question_id": 57994273, "link": "https://stackoverflow.com/questions/57994273/how-can-i-fix-post-404-error-using-go-its-not-source-code-error", "title": "How can i fix POST 404 error using go? It&#39;s not source code error", "body": "<p>I enter my source code with golang book. \nMy source code is same with my golang book's source code</p>\n\n<p>check the source code</p>\n\n<p>-------golang--------</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n   r := &amp;router{make(map[string]map[string]HandlerFunc)}\n\n   r.HandleFunc(\"GET\", \"/\", func(c *Context) {\n       fmt.Fprintln(c.ResponseWriter, \"welcome!\")\n   })\n\n   r.HandleFunc(\"GET\", \"/about\", func(c *Context) {\n       fmt.Fprintln(c.ResponseWriter, \"about\")\n   })\n\n   r.HandleFunc(\"GET\", \"/users/:id\", func(c *Context) {\n       fmt.Fprintf(c.ResponseWriter, \"retrieve user %v\\n\",\n       c.Params[\"id\"])\n   })\n\n   r.HandleFunc(\"GET\", \"/users/:user_id/addresses/:address_id\", func(c *Context) {\n       fmt.Fprintf(c.ResponseWriter, \"retrieve user %v's address %v\\n\",\n       c.Params[\"user_id\"], c.Params[\"address_id\"])\n   })\n\n   r.HandleFunc(\"POST\", \"/users\", func(c *Context) {\n       fmt.Fprintf(c.ResponseWriter, \"create user\\n\")\n   })\n\n   r.HandleFunc(\"POST\", \"/users/:user_id/addresses\", func(c *Context) {\n       fmt.Fprintf(c.ResponseWriter, \"create user %v's address\\n\", c.Params[\"user_id\"])\n   })\n\n   http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>PS C:\\Users\\user\\go> curl <a href=\"http://localhost:8080/users/1\" rel=\"nofollow noreferrer\">http://localhost:8080/users/1</a>\ncurl : 404 page not found\nAt line:1 char:1\n+ curl <a href=\"http://localhost:8080/users/1\" rel=\"nofollow noreferrer\">http://localhost:8080/users/1</a>\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand</p>\n"}, {"tags": ["loops", "go", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1568813783, "creation_date": 1568813783, "answer_id": 57994071, "question_id": 57993878, "link": "https://stackoverflow.com/questions/57993878/prometheus-gauge-with-custom-collector-go/57994071#57994071", "title": "Prometheus gauge with custom collector - go", "body": "<p>The way it is written, your program will not go beyond that for loop. Try this instead:</p>\n\n<pre><code>go func() {\n //loop after given time\n    for range timerCh {\n        runJobs()\n\n    }\n}()\n</code></pre>\n\n<p>This runs the for loop in its own goroutine, and runJobs executes every so often.</p>\n"}], "owner": {"reputation": 29, "user_id": 11383611, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-acCnAkUqJ-Q/AAAAAAAAAAI/AAAAAAAAAik/0dMvTIwYoUk/photo.jpg?sz=128", "display_name": "Jaanus", "link": "https://stackoverflow.com/users/11383611/jaanus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 57994071, "answer_count": 1, "score": 0, "last_activity_date": 1568813783, "creation_date": 1568813166, "question_id": 57993878, "link": "https://stackoverflow.com/questions/57993878/prometheus-gauge-with-custom-collector-go", "title": "Prometheus gauge with custom collector - go", "body": "<p>i have problem on \"reseting\" the values for gauges because \"life stops\" as soon http servervice is started or when i start looping my \"runJob\" then is server not started..</p>\n\n<p>the way how i am trying to establish this: </p>\n\n<p>i load all the Job-s from YAML array.\ni generate gauges from that, then i run loop to get some values for them.\nThen i register them.</p>\n\n<p>And after that i start http service for prometheus.</p>\n\n<p>All works perfect, until next cycle - next cycle is just not starting.</p>\n\n<p>I tryed to move functions inside functions etc..</p>\n\n<p>so thats my main function: </p>\n\n<pre><code>        //gets poll time from yaml (60s)\n    timerCh := time.Tick(time.Duration(appConf.PollTimeSec) * time.Second)\n\n    //loop after given time\n    for range timerCh {\n        runJobs()\n\n    }\n\n    //start new muxServer\n    server := http.NewServeMux()\n    log.Println(\"DEBUG: Starting server\")\n    server.Handle(appConf.HostPath, promhttp.Handler())\n\n    http.ListenAndServe(\":\"+appConf.ListenerPort, server)\n</code></pre>\n\n<p>and my runJobs function basicly gets Http response codes\nand ads them to prometheus gauge values.\n-- everything is OK with that and it works very well on starting, but after i try to start it wheet sleep (as shown in main go) it just gets stuck - </p>\n\n<p>Server is up and values do not change.</p>\n\n<p>So i have (my optinion) two possible ways of fixing it: </p>\n\n<ol>\n<li><p>My \"runJobs\" is infinitive loop what runs after every minute</p>\n\n<ul>\n<li>thats why is server not started.</li>\n<li>But when i add there a if statement that on first run(cycle) should server be started, then it still gets stuck when server gets started (next loop cycle just woun't get started)</li>\n</ul></li>\n<li><p>And the other part, when i start the server first, then it never gets to the part where it starts runJobs()</p></li>\n</ol>\n\n<p>Prefered outcome should be that: </p>\n\n<p>server is started with first values, and after every minute it runs \"runJobs\" again.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1568813474, "post_id": 57993809, "comment_id": 102394592, "body": "You can&#39;t. Remember, in Go, one of the key rules of thumb is to <b>make zero values usable</b>. A <code>Foo{}</code> with no fields specified shouldn&#39;t just implode; if it does, that is a defect in the design of <code>Foo</code>. Take a look at the standard library; it&#39;s full of good examples of how to make a good type in Go."}], "answers": [{"comments": [{"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1568813320, "post_id": 57993861, "comment_id": 102394504, "body": "It is actually a very common problem, because we often need to change the type definition, like adding more fields, and then forgot to update the caller somewhere to specify the missing value, end up causing a bug."}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1568813502, "post_id": 57993861, "comment_id": 102394604, "body": "Whenever I see a <code>&amp;Foo{ RequireField1: &quot;fff&quot; }</code>, I&#39;m very nervous, because I don&#39;t know if this includes all the required fields."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 1, "creation_date": 1568819279, "post_id": 57993861, "comment_id": 102398217, "body": "@LeoZhang, if you add a field to a struct type in a way that breaks your stuff when it has the zero value, then you&#39;ve made a breaking change. Don&#39;t Do That(tm). Instead add a new type. See <a href=\"https://blog.golang.org/versioning-proposal\" rel=\"nofollow noreferrer\">&quot;The import compatibility rule&quot;</a>. But really the overarching rule is that of useful zero values."}, {"owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "edited": false, "score": 0, "creation_date": 1568826848, "post_id": 57993861, "comment_id": 102401833, "body": "Thanks for the answers."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 4, "last_activity_date": 1568813196, "last_edit_date": 1568813196, "creation_date": 1568813099, "answer_id": 57993861, "question_id": 57993809, "link": "https://stackoverflow.com/questions/57993809/how-to-hide-the-default-type-constructor-in-golang/57993861#57993861", "title": "How to hide the default type constructor in golang?", "body": "<blockquote>\n  <p>How to hide the default type constructor in golang?</p>\n</blockquote>\n\n<p>You <strong>cannot</strong> for an exported type.</p>\n\n<p>Get used to it, it is not a problem in real life.</p>\n\n<p>(For unexported types, just provide a <code>func NewUnexportedType(...) unexportedType</code>. ) </p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1568818134, "creation_date": 1568818134, "answer_id": 57995554, "question_id": 57993809, "link": "https://stackoverflow.com/questions/57993809/how-to-hide-the-default-type-constructor-in-golang/57995554#57995554", "title": "How to hide the default type constructor in golang?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a></p>\n  \n  <p>it's helpful to arrange when designing your data structures that the\n  zero value of each type can be used without further initialization.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>we often need to change the type definition, like adding more fields</p>\n</blockquote>\n\n<p>That is why you should make the zero value for struct fields significant. The behavior is by design. For example, it is used to maintain the Go 1 compatibility guarantee.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "is_accepted": true, "score": 1, "last_activity_date": 1568899648, "creation_date": 1568899648, "answer_id": 58012159, "question_id": 57993809, "link": "https://stackoverflow.com/questions/57993809/how-to-hide-the-default-type-constructor-in-golang/58012159#58012159", "title": "How to hide the default type constructor in golang?", "body": "<p>You can avoid this problem by making Foo type unexported.</p>\n\n<p>You can make an interface that is Exported and has all the methods that Foo type performs.</p>\n\n<p>Example:-</p>\n\n<pre><code>type Foo interface{\nDoSomething()\n}\n\ntype foo struct{\nRequiredField1 string\nRequiredField2 string\n}\n\nfunc NewFoo(requiredField1 string,requiredField2 string)*foo{\nreturn &amp;foo{\nRequiredField1:requiredField1,\nRequiredField2:requiredField2,\n}\n}\n\nfunc (f *foo)DoSomething(){\n// your implementation\n}\n</code></pre>\n\n<p>In this way all the caller will be able to access it but cannot create foo without NewFoo function.</p>\n"}], "owner": {"reputation": 2740, "user_id": 832847, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d537be713ae7b9be79f446de62e61f7?s=128&d=identicon&r=PG", "display_name": "Leo Zhang", "link": "https://stackoverflow.com/users/832847/leo-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 58012159, "answer_count": 3, "score": -3, "last_activity_date": 1568899648, "creation_date": 1568812931, "question_id": 57993809, "link": "https://stackoverflow.com/questions/57993809/how-to-hide-the-default-type-constructor-in-golang", "title": "How to hide the default type constructor in golang?", "body": "<p>The reason I have this question is that I often make mistakes that I forgot to specify a value to a struct's field, then the compiler is fine, but the zero value causes bugs.</p>\n\n<p>Here is an example. Say I have a type <code>Foo</code> defined like this in a package:</p>\n\n<pre><code>package types\n\ntype Foo struct {\n  RequiredField1 string\n  RequiredField2 string\n}\n</code></pre>\n\n<p>It is exposed and has 2 fields that I'd like both of them to be specified when the <code>Foo</code> struct is created.</p>\n\n<p>Then I can import and use it in my main function like this:</p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/foo/bar/types\"\n)\n\nfunc main() {\n  f := &amp;Foo{ \n    RequiredField1: \"fff\",\n  }\n  fmt.Printf(\"f.RequiredField2: %v\", f.RequiredField2)\n}\n</code></pre>\n\n<p>This causes a bug because I forgot to specify <code>RequiredField2</code> which is required. And I often make this kind of bugs :p</p>\n\n<p>Now, in order to leverage the compile and prevent this mistake, I made a constructor function for <code>Foo</code> and asks for the required values. </p>\n\n<pre><code>func NewFoo(field1 string, field2 string) *Foo {\n  return &amp;Foo{Field1: field1, Field2: field2}\n}\n</code></pre>\n\n<p>So that if I forgot to pass <code>field2</code>, the compiler won't compile my code:</p>\n\n<pre><code>func main() {\n    f := NewFoo(\"foo\")\n    fmt.Printf(\"f.Field2: %v\", f.Field2)\n}\n</code></pre>\n\n<p>The build will fail:</p>\n\n<pre><code>./prog.go:18:13: not enough arguments in call to NewFoo\n    have (string)\n    want (string, string)\n</code></pre>\n\n<p>Now the question is: how to stop the foreign callers (callers from other namespaces) from calling the default constructor of <code>Foo</code>, that is <code>&amp;Foo</code>, and force them to use the <code>NewFoo</code>? </p>\n\n<p>If I can, then I'm safe since NewFoo is the only way to create the <code>Foo</code> type and the compiler helps me ensure all fields are present when calling it.</p>\n"}, {"tags": ["go", "code-coverage"], "comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 1, "creation_date": 1568805297, "post_id": 57990520, "comment_id": 102389945, "body": "You started your service and made request to it  but you did not gave even a millisecond to process this request.  What will become if you add a <code>time.Sleep(time.Second)</code> after <code>http.Post</code>?  Although I recomend you to think about organizing your tests into suites: a) startup with <code>go main()</code>, b) tests itself, c) tear-down if needed"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1568805898, "post_id": 57990520, "comment_id": 102390311, "body": "I suspect the problem is that you&#39;re calculating stats for the wrong package. Use the <code>-coverpkg</code> flag to indicate which package(s) to calculate coverage stats for. See <a href=\"https://stackoverflow.com/q/28349085/13860\">here</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568806428, "post_id": 57990520, "comment_id": 102390632, "body": "Also, as mentioned in comments below, the way you&#39;re invoking your goroutine is completely wrong. You probably shouldn&#39;t run <code>main()</code> in a goroutine. Instead, start a goroutine that starts your app, but can be cancelled when the tests are done, perhaps with a <code>context.Context</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568810824, "post_id": 57990520, "comment_id": 102393036, "body": "The proper way to test main is by using <code>func TestMain(m *testing.M)</code> as described in the package documentation of package testing. Rule of thumb: <b>Always</b> read the <b>whole</b> package documentation first."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 3, "creation_date": 1568812021, "post_id": 57990520, "comment_id": 102393725, "body": "That&#39;s not a unit test... it&#39;s just not. Honestly, running everything and just making a request is the same as a bash script like <code>go run . &amp;; curl 0.0.0.0:8080&#47;do_something</code>"}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 1, "creation_date": 1568812891, "post_id": 57990520, "comment_id": 102394252, "body": "Why you omit check of response and error from <code>http.Post</code>? At least you need to add <code>resp, err:= http.Post(&quot;https:&#47;&#47;localhost&#47;do_something&quot;)</code> and check <code>resp and err </code> afterwards. Maybe you&#39;re trying POST on inexistent url?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568814038, "post_id": 57990520, "comment_id": 102394929, "body": "I would scrap this test altogether. It&#39;s not a unit test; it&#39;s calling <code>main</code> from within a test func which means all your flags etc. are going to be wrong; it calls <code>main</code> in a goroutine with no way to stop it; it makes no assertions therefore it will <i>always</i> pass unless it panics; it delivers exactly zero value as a test. Just delete it."}], "answers": [{"comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1568805555, "post_id": 57991365, "comment_id": 102390094, "body": "golang test coverage works by instrumenting original code with assignments per each line. It does not monitor threads. Read <a href=\"https://blog.golang.org/cover\" rel=\"nofollow noreferrer\">The cover story</a>. I thiink the real problem is that <code>TestSubSystem</code> exits right after <code>http.Post</code> without giving a chance to execute even a line in tested service."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568805763, "post_id": 57991365, "comment_id": 102390229, "body": "&quot;It\u2019s likely what\u2019s happening here is the code coverage system subsystem is only monitoring the originating thread&quot; -- No, this is not how it works, at all."}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "edited": false, "score": 0, "creation_date": 1568805942, "post_id": 57991365, "comment_id": 102390340, "body": "Thanks for the link to the cover story; I hadn\u2019t seen this one. \ud83d\udc4d\ud83c\udffb"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568806341, "post_id": 57991365, "comment_id": 102390571, "body": "I don&#39;t think the early exit is the explanation, either. You&#39;d probably get <i>some</i> coverage if that were the problem, not 0. But even so, the way the goroutine is done is clearly wrong."}], "tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": false, "score": -1, "last_activity_date": 1568815203, "last_edit_date": 1568815203, "creation_date": 1568804942, "answer_id": 57991365, "question_id": 57990520, "link": "https://stackoverflow.com/questions/57990520/how-to-generate-code-coverage-for-rest-service/57991365#57991365", "title": "How to generate code coverage for REST service", "body": "<p>Regardless of the root cause, I think there\u2019s an issue with your general approach here.</p>\n\n<p>I would suggest that some of what you\u2019re testing here isn\u2019t your code and you shouldn\u2019t bother. You don\u2019t need to <em>actually</em> test the http protocol and http package, right?</p>\n\n<p>So the way I\u2019ve handled this in the past is to break apart my the meaningful code that I want to test out of the http handler functions. The http handlers should only be responsible for validating input, calling the <em>actual</em> business logic, and then formatting output.</p>\n\n<p>Once you\u2019ve broken apart your code this way, you can directly call your meaningful functions from your tests. Your http handler functions should be so simple that there is no place for bugs to lurk.</p>\n\n<p>Don\u2019t seek 100% test coverage. Test what matters.</p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 1, "last_activity_date": 1568815796, "creation_date": 1568815796, "answer_id": 57994761, "question_id": 57990520, "link": "https://stackoverflow.com/questions/57990520/how-to-generate-code-coverage-for-rest-service/57994761#57994761", "title": "How to generate code coverage for REST service", "body": "<h2>Preface</h2>\n\n<p>This could not be a complete answer covering all cases. </p>\n\n<p>It's an attempt to explain how it could be possible to get zero coverage from what OP explained.</p>\n\n<h2>Test itself</h2>\n\n<blockquote>\n  <p>Tests are passing successfully but go test -cover returns 0% test coverage.</p>\n</blockquote>\n\n<ol>\n<li>Start of service with <code>go main()</code> inside <code>Test</code>-function</li>\n<li>Attempt of <code>http.Post</code> to service  without checks for errors and that response is not <code>nil</code></li>\n<li>No panics during test so test is passing</li>\n</ol>\n\n<h2>Problems in test</h2>\n\n<ol>\n<li>No guarantee that service is actually started before attempt of <code>http.Post</code></li>\n<li>Results of <code>http.Post</code> are not checked </li>\n</ol>\n\n<p>For first problem: </p>\n\n<ul>\n<li>bad/dirty solution: add <code>time.Sleep</code> after <code>go main()</code></li>\n<li>good/clean solution: instrument service with some kind of signalling/monitoring that serve loop is started </li>\n</ul>\n\n<p>For second problem:</p>\n\n<p>Take a look at such Test-function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestPost(t *testing.T) {\n    var b bytes.Buffer\n    http.Post(\"http:/inexistent.com/inexistent-url\", \"\", &amp;b)\n    t.Log(\"No problems!\")\n}\n</code></pre>\n\n<p>This test will always pass. Because it tests non-existense of panics only.</p>\n\n<p>To make this test more correct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestPost(t *testing.T) {\n    var b bytes.Buffer\n    if _, err:= http.Post(\"http:/inexistent.com/inexistent-url\", \"\", &amp;b); err!=nil{\n    t.Errorf(\"http.Post : %v\", err)\n}\n</code></pre>\n\n<h2>Proposals</h2>\n\n<ol>\n<li>Check <code>http.Post</code> results</li>\n<li>Check that tested service is actually started</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 27, "user_id": 7426258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/434255d185dddd6d13d43ee453bc9f39?s=128&d=identicon&r=PG&f=1", "display_name": "mann", "link": "https://stackoverflow.com/users/7426258/mann"}, "is_accepted": false, "score": 1, "last_activity_date": 1568914401, "creation_date": 1568914401, "answer_id": 58016274, "question_id": 57990520, "link": "https://stackoverflow.com/questions/57990520/how-to-generate-code-coverage-for-rest-service/58016274#58016274", "title": "How to generate code coverage for REST service", "body": "<p>Thanks all for your reply.\nI am able to get the coverage by -coverpkg.\nNot sure what exactly solved the issue below are couple of changes which worked for me as suggested by @Flimzy\n1. Moved REST server Initialization code from main to a function. and then in test case starting the REST server within go routine and gracefully terminating it by sending a message to channel</p>\n\n<pre><code>    channel := make(chan error) // create a channel will listen for error\n    go func(channel chan error) {\n        inithandler.InitRestServer(channel, )\n        _ = &lt;-channel // terminate the channel\n    }(channel)\nhttp.Post(\"https://localhost/do_something\") // call the endpoint and resp verification\n.\n.\nchannel &lt;- errors.New(\"stop\")\n</code></pre>\n\n<p>trigger test with -coverpkg</p>\n\n<pre><code>go test main_test.go -cover -coverpkg ./...\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 7426258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/434255d185dddd6d13d43ee453bc9f39?s=128&d=identicon&r=PG&f=1", "display_name": "mann", "link": "https://stackoverflow.com/users/7426258/mann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1568914401, "creation_date": 1568802150, "last_edit_date": 1568805750, "question_id": 57990520, "link": "https://stackoverflow.com/questions/57990520/how-to-generate-code-coverage-for-rest-service", "title": "How to generate code coverage for REST service", "body": "<p>I want to get test coverage of a REST service written in Go. I am spawning REST service through a goroutine, then making HTTP requests using rest client, and reviewing the HTTP responses. \nTests are passing successfully but <code>go test -cover</code> returns 0% test coverage. \nIs there a way to get the actual test coverage of all the packages used inside the go lang REST service.</p>\n\n<p><strong>my test file:</strong>\nmain_test.go</p>\n\n<pre><code>import (\n    \"testing\"\n)\n\n// Test started when the test binary is started. Only calls main.\nfunc TestSystem(t *testing.T) {\n    go main()    // Spinning up the go lang REST server in a separate go routine.\n    http.Post(\"https://localhost/do_something\")\n}\n</code></pre>\n\n<p>my output:</p>\n\n<pre><code>go test -cover  main_test.go\nok      command-line-arguments  0.668s  coverage: 0.0% of statements \n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-play-developer-api"], "answers": [{"comments": [{"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1568800630, "post_id": 57989849, "comment_id": 102387367, "body": "I&#39;ll check it out, thanks.  One would think that such a major change would be covered in the documentation though."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1568890288, "post_id": 57989849, "comment_id": 102422906, "body": "I&#39;ve tried setting up a service account and using that, but now the error that I get is &quot;Error 401: The current user has insufficient permissions to perform the requested operation., permissionDenied&quot;.  I&#39;ve even given the service account project wide &quot;owner&quot; permission instead of the usual &quot;editor&quot;, and I still get the same error."}, {"owner": {"reputation": 746, "user_id": 11928097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K6NxO.jpg?s=128&g=1", "display_name": "Stefan G.", "link": "https://stackoverflow.com/users/11928097/stefan-g"}, "reply_to_user": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1568892033, "post_id": 57989849, "comment_id": 102423853, "body": "I&#39;ve been looking into it John, and oddly enough it seems that many people that had a similar issue are commenting that it somehow takes 24-48h for the permissions to propagate. Have a look <a href=\"https://github.com/googleapis/google-api-nodejs-client/issues/1382#issuecomment-471179616\" rel=\"nofollow noreferrer\">here</a>, we will investigate further if that isn&#39;t the case. Let me know"}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1568896048, "post_id": 57989849, "comment_id": 102426130, "body": "Stefan, is there a reason that the Application Default Credentials are no longer supported.  This seems like a major change, but I&#39;ve found no documentation on this anywhere, so it&#39;s not even clear if it&#39;s intentional or a bug."}, {"owner": {"reputation": 746, "user_id": 11928097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K6NxO.jpg?s=128&g=1", "display_name": "Stefan G.", "link": "https://stackoverflow.com/users/11928097/stefan-g"}, "reply_to_user": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1568899598, "post_id": 57989849, "comment_id": 102428421, "body": "There isn&#39;t a reason or an official documentation stating that Application Default Credentials are no longer supported,  what i gave you as an answer was a workaround for people that had an issue similar to yours. Let&#39;s try and single it out, if it is a bug (which i incline to think it&#39;s not) we will report it. I have another idea that we can try. If you go to IAM -&gt; Service Accounts -&gt; App Engine Default Service Account -&gt; Create Key. As you had permissions for your default service accounts, attempt to do the workaround with that key, that way we can single out if it&#39;s the 24-48h thing."}, {"owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "edited": false, "score": 0, "creation_date": 1569097614, "post_id": 57989849, "comment_id": 102487934, "body": "Stefan, I set up a new service account and used the JSON file from that to authenticate.  That initially didn&#39;t work, but after waiting for 24-48 hours, it has started working without me changing anything on my side.  It seems to me that there are two bugs here on Google&#39;s side.  1) The default service accounts aren&#39;t authenticating properly with Go 1.11 (I&#39;ve confirmed that they still work on Go 1.9).  2) After setting the permissions, there is a really long time for those permissions to propagate through the system.  I&#39;m marking this issue as solved in the mean time."}], "tags": [], "owner": {"reputation": 746, "user_id": 11928097, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K6NxO.jpg?s=128&g=1", "display_name": "Stefan G.", "link": "https://stackoverflow.com/users/11928097/stefan-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1568800132, "creation_date": 1568800132, "answer_id": 57989849, "question_id": 57988871, "link": "https://stackoverflow.com/questions/57988871/defaultclient-scope-migrating-from-app-engine-go-1-9-to-1-11/57989849#57989849", "title": "DefaultClient scope migrating from App Engine (Go) 1.9 to 1.11", "body": "<p>I think the issue is in the differences of runtime in Go 1.9 and 1.11. It doesn't seem to allow you to use Application Default Credentials anymore, you have to set them via a JSON file in 1.11. I found someone who had a very similar issue to you and they used a workaround by uploading a key and using that to get a Client.</p>\n\n<p>Have a look <a href=\"https://stackoverflow.com/a/53733206/11928097\">here</a></p>\n\n<p>Let me know.</p>\n"}], "owner": {"reputation": 1634, "user_id": 340334, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61441c6f0027ee4f4b25b6dcf756f9a3?s=128&d=identicon&r=PG", "display_name": "JohnGB", "link": "https://stackoverflow.com/users/340334/johngb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 57989849, "answer_count": 1, "score": 2, "last_activity_date": 1568814790, "creation_date": 1568797136, "last_edit_date": 1568814790, "question_id": 57988871, "link": "https://stackoverflow.com/questions/57988871/defaultclient-scope-migrating-from-app-engine-go-1-9-to-1-11", "title": "DefaultClient scope migrating from App Engine (Go) 1.9 to 1.11", "body": "<p>I've recently been migrating an App Engine (Go) app from Go 1.9 to 1.11.  I've followed the steps in the\n<a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences\" rel=\"nofollow noreferrer\">Migrating your App Engine app from Go 1.9 to Go 1.11</a> document, excluding the optional ones.  I plan on doing the optional tasks later once I get this working.</p>\n\n<p>I get the app to build and I can deploy it just fine.  Most of everything works fine, with the exception of one API that is used to look up some info on a Google Play IAP.  When I do that, I get the following error:</p>\n\n<blockquote>\n  <p>Error 403: Insufficient Permission: Request had insufficient authentication scopes., insufficientPermissions</p>\n</blockquote>\n\n<p>I've checked, and the scope that I'm using is <code>https://www.googleapis.com/auth/androidpublisher</code>, which is still the scope listed in the <a href=\"https://developers.google.com/android-publisher/api-ref/purchases/products/get\" rel=\"nofollow noreferrer\">Google Play Developer API documentation</a>.</p>\n\n<p>I'm using the App Engine default service account for the client by calling <code>DefaultClient</code> from the <code>golang.org/x/oauth2/google</code> library, which returns a client without an error</p>\n\n<p>When I test the same code with Go 1.9, there are no authentication issues at all, and the API works.  I'm guessing that these is something in the authentication setup which has changed but I can't find any documentation on it, nor on what I should do differently.</p>\n\n<p>I have to imagine that a lot of people have had to do this migration, and I can't find any posts with this problem, so I'm lost as to why I'm getting it.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "edited": false, "score": 0, "creation_date": 1568805721, "post_id": 57987883, "comment_id": 102390196, "body": "Are you certain the database server isn\u2019t closing the connection?"}], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1568811892, "post_id": 57988883, "comment_id": 102393646, "body": "to check something periodically, it&#39;s better to use a ticker than <code>time.Sleep</code>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568832285, "post_id": 57988883, "comment_id": 102403973, "body": "your retry handler would be better using <a href=\"https://godoc.org/github.com/cenkalti/backoff#example-Retry\" rel=\"nofollow noreferrer\">godoc.org/github.com/cenkalti/backoff#example-Retry</a> ie <code>err := Retry(operation, WithMaxRetries(NewExponentialBackOff(), 5))</code>"}], "tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": 1, "last_activity_date": 1568797166, "creation_date": 1568797166, "answer_id": 57988883, "question_id": 57987883, "link": "https://stackoverflow.com/questions/57987883/why-are-database-connections-automatically-closed/57988883#57988883", "title": "Why are database connections automatically closed?", "body": "<p>You can global-search <code>DbInstance.Close()</code> to ensure not ever call it to close it yourself.\nIf not, you kan set db timeout for longer and raise amount of idle db connections.</p>\n\n<p>At last, It's most important to support auto-reconnecting db dataSource.</p>\n\n<p>Here is part of my auto-reconnecting part you might refer to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var DB *gorm.DB\nfunc init() {\n    dbConfig = fmt.Sprintf(\"host=%s user=%s dbname=%s sslmode=%s password=%s\",\n        \"localhost\",\n        \"postgres\",\n        \"dbname\",\n        \"disable\",\n        \"password\",\n    )\n    db, err := gorm.Open(\"postgres\",\n        dbConfig,\n    )\n    db.SingularTable(true)\n    db.LogMode(true)\n    db.DB().SetConnMaxLifetime(10 * time.Second)\n    db.DB().SetMaxIdleConns(30)\n    DB = db\n    // auto-connect\uff0cping per 60s, re-connect on fail or error with intervels 3s, 3s, 15s, 30s, 60s, 60s ...\n    go func(dbConfig string) {\n        var intervals = []time.Duration{3 * time.Second, 3 * time.Second, 15 * time.Second, 30 * time.Second, 60 * time.Second,\n        }\n        for {\n            time.Sleep(60 * time.Second)\n            if e := DB.DB().Ping(); e != nil {\n            L:\n                for i := 0; i &lt; len(intervals); i++ {\n                    e2 := RetryHandler(3, func() (bool, error) {\n                        var e error\n                        DB, e = gorm.Open(\"postgres\", dbConfig)\n                        if e != nil {\n                            return false, errorx.Wrap(e)\n                        }\n                        return true, nil\n                    })\n                    if e2 != nil {\n                        fmt.Println(e.Error())\n                        time.Sleep(intervals[i])\n                        if i == len(intervals)-1 {\n                            i--\n                        }\n                        continue\n                    }\n                    break L\n                }\n\n            }\n        }\n    }(dbConfig)\n}\n</code></pre>\n\n<p>By the way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Try f() n times on fail and one time on success \nfunc RetryHandler(n int, f func() (bool, error)) error {\n    ok, er := f()\n    if ok &amp;&amp; er == nil {\n        return nil\n    }\n    if n-1 &gt; 0 {\n        return RetryHandler(n-1, f)\n    }\n    return er\n}\n</code></pre>\n"}], "owner": {"reputation": 359, "user_id": 4035847, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c092362d9438873eb38c17e9618af6bc?s=128&d=identicon&r=PG&f=1", "display_name": "jayD", "link": "https://stackoverflow.com/users/4035847/jayd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1932, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1568862998, "creation_date": 1568793870, "last_edit_date": 1568862998, "question_id": 57987883, "link": "https://stackoverflow.com/questions/57987883/why-are-database-connections-automatically-closed", "title": "Why are database connections automatically closed?", "body": "<p>I'm having an issue with Gorm / Psql where my database connection get automatically closed. </p>\n\n<p>I never call defer <code>dbInstance.Close()</code> in main.go  (not anymore for now, I've removed it, since that's the only place in my code where I felt the connection could be wrongfully closed) nor was it ever anywhere else.</p>\n\n<p>The way I'm initializing my db is with a \"db\" package that looks like this:</p>\n\n<pre><code>package db\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nvar DbInstance *gorm.DB\n\nfunc Init() *gorm.DB {\n    if DbInstance != nil {\n        return DbInstance\n    }\n    fmt.Println(\"Opening Db\")\n    db, err := gorm.Open(\"postgres\", \"host=localhost port=5432 user=admin dbname=dbname sslmode=disable password=\")\n    if err != nil {\n        fmt.Println(err)\n        panic(\"failed to connect database\")\n    }\n    return db\n}\n</code></pre>\n\n<p>then I call <code>db.Init()</code> in my main.go and then only call the db from \"db.dbInstance\" from the rest of my program.</p>\n\n<p>As I've previously mentioned I used to call <code>defer db.DbInstance.Close()</code> from main.go but have tried removing it to see if it fixed the issue but it didn't. </p>\n\n<p>What's strange is that the db connection will work for hours and hours in many different calls/function but always end up closing at some point.</p>\n\n<p>From what i understand <a href=\"https://github.com/jinzhu/gorm/issues/1427\" rel=\"nofollow noreferrer\">it should work</a> : </p>\n\n<blockquote>\n  <p>gorm.Open() uses <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/</a>, which is\n  threadsafe and handles connection pooling for you. Don't call\n  gorm.Open() every request. Call it once when setting up your\n  application, and make sure you use defer db.Close() so connections are\n  cleanly ended when your program exits. </p>\n</blockquote>\n\n<p>Lastly I need to add that it seems (i'm not 100% sure) that it's closing after I do batch inserts but again the <code>.Close()</code> <strong>function is never called, anywhere in my program</strong>.</p>\n\n<p>I'm a bit lost as to what could be happening? Garbage collector (doesn't make sense the var is global)? psql driver closing in the background? Configuration issue?</p>\n\n<p>I'm adding the batch function for reference just in case:</p>\n\n<pre><code>func InsertWithPostGresLimitSizeV2(DB *gorm.DB, array []interface{}) {\n    if len(array) == 0 {\n        return\n    }\n    numberOfParams := len(DB.NewScope(array[0]).Fields())\n    // postgres is limited to 65535 params.\n    maxStructPerBulk := int(65535 / numberOfParams)\n    currentIndex := 0\n    if len(array) &gt; maxStructPerBulk {\n        for len(array) &gt; currentIndex {\n            if (maxStructPerBulk + currentIndex) &lt; len(array) {\n                slice := array[currentIndex:(currentIndex + maxStructPerBulk)]\n                currentIndex += maxStructPerBulk\n                _, err := DB.BatchInsert(slice)\n                log.Println(err)\n            } else {\n\n                slice := array[currentIndex:len(array)]\n                currentIndex = len(array)\n                _, err := DB.BatchInsert(slice)\n                log.Println(err)\n            }\n        }\n    } else {\n        _, err := DB.BatchInsert(array)\n        log.Println(err)\n    }\n}\n\nfunc BatchInsert(db *gorm.DB,objArr []interface{}) (int64, error) {\n    if len(objArr) == 0 {\n        return 0, errors.New(\"insert a slice length of 0\")\n    }\n\n    mainObj := objArr[0]\n    mainScope := db.NewScope(mainObj)\n    mainFields := mainScope.Fields()\n    quoted := make([]string, 0, len(mainFields))\n    for i := range mainFields {\n        if (mainFields[i].IsPrimaryKey &amp;&amp; mainFields[i].IsBlank) || (mainFields[i].IsIgnored) {\n            continue\n        }\n        quoted = append(quoted, mainScope.Quote(mainFields[i].DBName))\n    }\n\n    placeholdersArr := make([]string, 0, len(objArr))\n\n    for _, obj := range objArr {\n        scope := db.NewScope(obj)\n        fields := scope.Fields()\n        placeholders := make([]string, 0, len(fields))\n        for i := range fields {\n            if (fields[i].IsPrimaryKey &amp;&amp; fields[i].IsBlank) || (fields[i].IsIgnored) {\n                continue\n            }\n            var vars interface{}\n            if (fields[i].Name == \"CreatedAt\" || fields[i].Name == \"UpdatedAt\") &amp;&amp; fields[i].IsBlank {\n                vars = gorm.NowFunc()\n            } else {\n                vars = fields[i].Field.Interface()\n            }\n            placeholders = append(placeholders, mainScope.AddToVars(vars))\n        }\n        placeholdersStr := \"(\" + strings.Join(placeholders, \", \") + \")\"\n        placeholdersArr = append(placeholdersArr, placeholdersStr)\n\n        mainScope.SQLVars = append(mainScope.SQLVars, scope.SQLVars...)\n    }\n    mainScope.Raw(fmt.Sprintf(\"INSERT INTO %s (%s) VALUES %s\",\n        mainScope.QuotedTableName(),\n        strings.Join(quoted, \", \"),\n        strings.Join(placeholdersArr, \", \"),\n    ))\n    if err := mainScope.Exec().DB().Error; err != nil {\n        return 0, err\n    }\n    return mainScope.DB().RowsAffected, nil\n}\n</code></pre>\n\n<p>On last thing is that I was thinking of \" fixing \" the issue by calling my db through but the ping would slow each of my calls:</p>\n\n<pre><code>func getDb() *gorm.DB {\n    err := DbInstance.DB().Ping()\n    if err != nil {\n        fmt.Println(\"Connection to db closed opening a new one\")\n        return Init()\n    }\n    return DbInstance\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1568797607, "post_id": 57987718, "comment_id": 102385560, "body": "Golang driver on postgres suport time.Time type.It&#39;s well converted between time.Time &lt;---&gt; timestamp (without time zone)/date"}, {"owner": {"reputation": 379, "user_id": 6567055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-54co2AZ0T6Q/AAAAAAAAAAI/AAAAAAAASWI/ArbHxGqzEeo/photo.jpg?sz=128", "display_name": "Nathaniel Rand", "link": "https://stackoverflow.com/users/6567055/nathaniel-rand"}, "edited": false, "score": 0, "creation_date": 1568863161, "post_id": 57987718, "comment_id": 102411723, "body": "Would an OS timestamp (ex: unixTimestamp := now.Unix() ) not be sufficient when storing on the DB? Is there an advantage to using time.Now over now.Unix (other than universal to OS maybe?"}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 1, "last_activity_date": 1568796131, "last_edit_date": 1568796131, "creation_date": 1568793511, "answer_id": 57987772, "question_id": 57987718, "link": "https://stackoverflow.com/questions/57987718/how-to-store-gos-current-time-hour-minute-seconds-on-postgres-table/57987772#57987772", "title": "How to store Go&#39;s current time (hour-minute-seconds) on Postgres table?", "body": "<p>According to the <a href=\"https://golang.org/src/time/time.go?s=20268:20310#L583\" rel=\"nofollow noreferrer\">docs</a>, here is the signature of <code>Clock</code></p>\n\n<pre><code>func (t Time) Clock() (hour, min, sec int)\n</code></pre>\n\n<p>Clock returns three value. You need to save them separately if that is what you want.</p>\n\n<p>Alternatively, you can save into the db a stringified version of the time.</p>\n\n<pre><code>time.Now().String()\n</code></pre>\n\n<p>Or if you want to save the date according to a certain format</p>\n\n<pre><code>time.Now().Format(\"2006-01-02 15:04:05\") // use a date format\n</code></pre>\n\n<p>Or you can simply save <code>time.Now()</code> directly into the db and later when you'll retrieve the date, you'll format it</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1568803685, "last_edit_date": 1568803685, "creation_date": 1568795012, "answer_id": 57988205, "question_id": 57987718, "link": "https://stackoverflow.com/questions/57987718/how-to-store-gos-current-time-hour-minute-seconds-on-postgres-table/57988205#57988205", "title": "How to store Go&#39;s current time (hour-minute-seconds) on Postgres table?", "body": "<p>Just use <code>time.Time</code> values and let the driver worry about how to encode and decode them:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    _ \"github.com/lib/pq\"\n)\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    _, err = db.Exec(\"CREATE TABLE foo (t timetz)\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    now := time.Now()\n    _, err = db.Exec(\"INSERT INTO foo VALUES ($1)\", now)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var t time.Time\n    err = db.QueryRow(\"SELECT t FROM foo\").Scan(&amp;t)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(now.Format(time.RFC3339)) // 2019-09-18T10:22:36+02:00\n    fmt.Println(t.Format(time.RFC3339))   // 0000-01-01T10:22:36+02:00\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 10149313, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6PFUvfVebfg/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qygJvbLbWB2mB0IqjPQXFs_vibVg/mo/photo.jpg?sz=128", "display_name": "sanuj ", "link": "https://stackoverflow.com/users/10149313/sanuj"}, "is_accepted": false, "score": 0, "last_activity_date": 1614253086, "creation_date": 1614253086, "answer_id": 66367736, "question_id": 57987718, "link": "https://stackoverflow.com/questions/57987718/how-to-store-gos-current-time-hour-minute-seconds-on-postgres-table/66367736#66367736", "title": "How to store Go&#39;s current time (hour-minute-seconds) on Postgres table?", "body": "<p>If you want to store the time according to your desired format, then you can use the below code snippet</p>\n<pre><code>tt := time.Now().Format(&quot;02-01-2006 15:04:05&quot;)\nt,_ := time.Parse(&quot;02-01-2006 15:04:05&quot;,tt)   \n</code></pre>\n<p>You can insert this <strong>t</strong> in the postgres table</p>\n"}], "owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1614253086, "creation_date": 1568793327, "question_id": 57987718, "link": "https://stackoverflow.com/questions/57987718/how-to-store-gos-current-time-hour-minute-seconds-on-postgres-table", "title": "How to store Go&#39;s current time (hour-minute-seconds) on Postgres table?", "body": "<p>I want to store user checkin and checkout time (hour, minute, and second) on a Postgres table (the column type is of course <strong>time</strong>) via Go</p>\n\n<pre><code>query := `INSERT INTO oc_log (userid, userdate, checkin_time, checkin_location, checkout_time, checkout_location) VALUES ($1, $2, $3, $4, $5, $6)`\n\nerr := db.QueryRow(query, userid, time.Now().Format(\"01-02-2006\"), time.Now().Clock(), checkinlocation, \"\", \"\").Scan(&amp;tmpid)\n</code></pre>\n\n<p>The go linter complains that </p>\n\n<blockquote>\n  <p>multiple-value time.Now().Clock() in single-value context</p>\n</blockquote>\n\n<p>How to fix this?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1568791303, "post_id": 57986850, "comment_id": 102382180, "body": "Probably having a small (i.e. O(|CPU|), independent of len(subjects) pool of workers is the right way to do it. But if you really want one worker per subject: Do <i>not</i> use a channel, you can start the worker directly with the appropriate data. Collecting the results should always be done with a sync.Waitgroup. See blog.golang.org for examples on concurrency. What you try to do looks fhishy (even if it is a simple learning experience)."}, {"owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "edited": false, "score": 2, "creation_date": 1568791790, "post_id": 57986850, "comment_id": 102382434, "body": "you might want to use two different channels, one for sending the job and another for collecting the result like mentioned in this example - <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">gobyexample.com/worker-pools</a>. Let me know if you need more help on this."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568814356, "post_id": 57986850, "comment_id": 102395120, "body": "If you&#39;re creating a worker per value, why send the value on the channel at all? Just pass it as a parameter. And you should never have work coming in and results going out on the same channel."}], "answers": [{"comments": [{"owner": {"reputation": 8076, "user_id": 643104, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/087OJ.jpg?s=128&g=1", "display_name": "Mahesh", "link": "https://stackoverflow.com/users/643104/mahesh"}, "edited": false, "score": 0, "creation_date": 1568867163, "post_id": 57991369, "comment_id": 102412401, "body": "Thank you for detailed description. It really pointed out flows in my approch. I need to understand the concurrency patterns again in go. Sorry to ask but could you suggest good book/blog which can help understand concurrency in go for novice."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 8076, "user_id": 643104, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/087OJ.jpg?s=128&g=1", "display_name": "Mahesh", "link": "https://stackoverflow.com/users/643104/mahesh"}, "edited": false, "score": 0, "creation_date": 1568883267, "post_id": 57991369, "comment_id": 102419060, "body": "specifically about concurrency, nop. but goperhcon regularly provides a video about that subject <a href=\"https://www.youtube.com/results?search_query=gophercon\" rel=\"nofollow noreferrer\">youtube.com/results?search_query=gophercon</a> . review the gotour and this <a href=\"https://gobyexample.com/\" rel=\"nofollow noreferrer\">gobyexample.com</a> . if you know your pattern, you should be able to implement what you need"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1568804948, "creation_date": 1568804948, "answer_id": 57991369, "question_id": 57986850, "link": "https://stackoverflow.com/questions/57986850/how-to-create-channels-in-loop/57991369#57991369", "title": "How to create channels in loop?", "body": "<blockquote>\n  <p>\"// I think this will update data for all the routines ?\"</p>\n</blockquote>\n\n<p>A channel (to simplify) is not a data structure to store data.</p>\n\n<p>It is a structure to <strong>send</strong> and <strong>receive</strong> data over <strong>different</strong> goroutines. </p>\n\n<p>As such, notice that your worker function is doing send and receive on the same channel within each goroutine instances. If you were having only one instance of such worker, this would <strong>deadlock</strong> (<a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/race_detector.html</a>).</p>\n\n<p>In the version of the code you posted, for a beginner this might seem to work because you have many workers exchanging works to each other. But it is wrong for a correct program.</p>\n\n<p>As a consequence, if a worker can not read and write the same channel, then it must consume a specific writable channel to send its results to some other routines.</p>\n\n<blockquote>\n  <p>// I want to wait till all the routines set the data in channel and\n  return the data from workers.</p>\n</blockquote>\n\n<p>This is part of the synchronization mechanisms required to ensure that a pusher waits until all its workers has finished their job before proceeding further. (this blog post talks about it <a href=\"https://medium.com/golangspec/synchronized-goroutines-part-i-4fbcdd64a4ec\" rel=\"nofollow noreferrer\">https://medium.com/golangspec/synchronized-goroutines-part-i-4fbcdd64a4ec</a>)</p>\n\n<blockquote>\n  <p>// Rightfully this closes channel and here after I get error send on\n  Closed channel.</p>\n</blockquote>\n\n<p>Take care that you have n routines of workers executing in parallel. The first of this worker to reach the end of its function will close the channel, making it unwritable to other workers, and false signaling its end to main.</p>\n\n<p>Normally one use the close statement on the writer side to indicate that there is no more data into the channel. To indicate it has ended. This signal is consumed by readers to quit their read-wait operation of the channel.</p>\n\n<p>As an example, lets review this loop</p>\n\n<pre><code>    for {\n        select {\n            case data := &lt;- c :\n                fmt.Println(data)\n        }\n    }\n</code></pre>\n\n<p>it is bad, really bad.</p>\n\n<ol>\n<li>It is an infinite loop with no exit statement</li>\n<li>The select is superfluous and does not contain exit statement, remember that a read on a channel is a blocking operation.</li>\n<li>It is a bad rewrite of a standard pattern provided by the language, the range loop over a channel</li>\n</ol>\n\n<p>The range loop over a channel is very simply written</p>\n\n<pre><code>    for data := range c {\n        fmt.Println(data)\n    }\n</code></pre>\n\n<p>This pattern has one great advantage, it automatically detect a closed channel to exit the loop! letting you loop over only the relevant data to process. It is also much more succint.</p>\n\n<p>Also, your worker is a awkward in that it read and write only one element before quitting.\nSpawning go routines is cheap, but not free. You should always evaluate the trade-off between the costs of async processing and its actual workload.</p>\n\n<p>Overall, your code should be closer to what is demonstrated here \n<a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">https://gobyexample.com/worker-pools</a></p>\n"}], "owner": {"reputation": 8076, "user_id": 643104, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/087OJ.jpg?s=128&g=1", "display_name": "Mahesh", "link": "https://stackoverflow.com/users/643104/mahesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 657, "favorite_count": 0, "accepted_answer_id": 57991369, "answer_count": 1, "score": 0, "last_activity_date": 1568804948, "creation_date": 1568790217, "last_edit_date": 1568790899, "question_id": 57986850, "link": "https://stackoverflow.com/questions/57986850/how-to-create-channels-in-loop", "title": "How to create channels in loop?", "body": "<p>I am learning concurrency in go and how it works.</p>\n\n<p><strong>What I am trying to do ?</strong> </p>\n\n<ul>\n<li>Loop through slice of data </li>\n<li>Create struct for required/needed data</li>\n<li>Create channel for that struct</li>\n<li>Call worker func using go rutine and pass that channel to that rutine</li>\n<li>Using data from channel do some processing</li>\n<li>Set the processed output back into channel </li>\n<li>Wait in main thread to get output from all the channels which we kicked off</li>\n</ul>\n\n<p><strong>Code Which I tried</strong></p>\n\n<pre><code>        package main\n\n    import (\n        \"fmt\"\n        \"github.com/pkg/errors\"\n        \"time\"\n    )\n\n    type subject struct {\n        Name string\n        Class string\n        StartDate time.Time\n        EndDate time.Time\n    }\n\n    type workerData struct {\n        Subject string\n        Class string\n        Result string\n        Error error\n    }\n\n    func main () {\n\n        // Creating test data\n        var subjects []subject\n        st,_ := time.Parse(\"01/02/2016\",\"01/01/2015\")\n        et,_ := time.Parse(\"01/02/2016\",\"01/01/2016\")\n        s1 := subject{Name:\"Math\", Class:\"3\", StartDate:st,EndDate:et }\n        s2 := subject{Name:\"Geo\", Class:\"3\", StartDate:st,EndDate:et }\n        s3 := subject{Name:\"Bio\", Class:\"3\", StartDate:st,EndDate:et }\n        s4 := subject{Name:\"Phy\", Class:\"3\", StartDate:st,EndDate:et }\n        s5 := subject{Name:\"Art\", Class:\"3\", StartDate:st,EndDate:et }\n        subjects = append(subjects, s1)\n        subjects = append(subjects, s2)\n        subjects = append(subjects, s3)\n        subjects = append(subjects, s4)\n        subjects = append(subjects, s5)\n        c := make(chan workerData) // I am sure this is not how I should be creating channel\n\n        for i := 0 ; i&lt; len(subjects) ; i++ {\n            go worker(c)\n        }\n\n        for _, v := range subjects {\n            // Setting required data in channel\n            data := workerData{Subject:v.Name, Class:v.Class}\n\n            // set the data and start the routine\n            c &lt;- data // I think this will update data for all the routines ? SO how should create separate channel for each routine\n\n        }\n\n        // I want to wait till all the routines set the data in channel and return the data from workers.\n        for {\n            select {\n                case data := &lt;- c :\n                    fmt.Println(data)\n            }\n        }\n    }\n\n    func worker (c chan workerData) {\n        data := &lt;- c\n        // This can be any processing\n        time.Sleep(100 * time.Millisecond)\n        if data.Subject != \"Math\" {\n            data.Result = \"Pass\"\n        } else {\n            data.Error = errors.New(\"Subject not found\")\n        }\n        fmt.Println(data.Subject)\n        // returning processed data and error to channel\n        c &lt;- data\n        // Rightfully this closes channel and here after I get error send on Closed channel.\n        close(c)\n    }\n</code></pre>\n\n<p>Playgorund Link - <a href=\"https://play.golang.org/p/hs1-B1UR98r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hs1-B1UR98r</a></p>\n\n<p><strong>Issue I am Facing</strong> </p>\n\n<p>I am not sure how to create different channel for each data item. The way I am currently doing will update the channel data for all routines. I want to know is there way to create diffrent channel for each data item in loop and pass that to the go rutine. And then wait in main rutine to get the result back from rutines from all channels.</p>\n\n<p>Any pointers/ help would be great ? If any confusion feel free to comment.</p>\n"}, {"tags": ["xml", "go", "libxml2"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569058444, "post_id": 57986772, "comment_id": 102478910, "body": "That is a bit little to work with. The document as shown is a single document. So how should the fields to update be identified? All url tags? There is only one note per document?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569073449, "post_id": 57986772, "comment_id": 102482228, "body": "Furthermore: Why introducing a dependency to an archived glue code library? The task at hand can easily be achieved with Go\u2018s standard library."}], "answers": [{"tags": [], "owner": {"reputation": 2393, "user_id": 803422, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/51b462bd16ac918a8563fa50c6ce416f?s=128&d=identicon&r=PG", "display_name": "user803422", "link": "https://stackoverflow.com/users/803422/user803422"}, "is_accepted": false, "score": 2, "last_activity_date": 1569524833, "creation_date": 1569524833, "answer_id": 58123266, "question_id": 57986772, "link": "https://stackoverflow.com/questions/57986772/how-to-update-specific-xml-element-value-using-go-libxml2/58123266#58123266", "title": "How to update specific XML element value using go-libxml2", "body": "<blockquote>\n  <p>How to use go-libxml2 to modify XML?</p>\n</blockquote>\n\n<p>You cannot. go-libxml2 can load an XML-formatted text and work with the nodes, but it has no function for serializing to an XML-formatted text.</p>\n\n<p>Or you need to code your own functions for converting the tree of nodes to an XML-formatted string.</p>\n\n<p>That being said, you can load and modify the urls as follows:</p>\n\n<pre><code>doc, err := libxml2.ParseString(xmlstring)\n\nnodes := xpath.NodeList(doc.Find(`//url`))\nfor i := 0; i &lt; len(nodes); i++ {\n    newvalue := nodes[i].NodeValue() + \"?param=value\"\n    nodes[i].SetNodeValue(newvalue)\n}\n\n// But here you cannot serialize back the 'doc' tree to XML with go-libxml2.\n// You need to code on your own.\n</code></pre>\n"}], "owner": {"reputation": 5286, "user_id": 253986, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/083d94b9d308bca999a491fe8bc5368f?s=128&d=identicon&r=PG", "display_name": "Achaius", "link": "https://stackoverflow.com/users/253986/achaius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1569524833, "creation_date": 1568789944, "last_edit_date": 1568796655, "question_id": 57986772, "link": "https://stackoverflow.com/questions/57986772/how-to-update-specific-xml-element-value-using-go-libxml2", "title": "How to update specific XML element value using go-libxml2", "body": "<p>I want to update a XML element value using <a href=\"https://github.com/lestrrat/go-libxml2\" rel=\"noreferrer\">go-libxml2</a>. The element may occur anywhere in the XML document. For example in the following XML I want to update a  element</p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n - &lt;note&gt;\n       &lt;to&gt;Tove&lt;/to&gt;\n       &lt;from&gt;Jani&lt;/Ffrom&gt;\n       &lt;heading&gt;Reminder&lt;/heading&gt;\n       &lt;body&gt;Don't forget me this weekend!&lt;/body&gt;\n        &lt;url&gt;http://example.com&lt;/url&gt;\n        &lt;links&gt;\n            &lt;url&gt;http://link1.com&lt;/url&gt;\n            &lt;url&gt;http://link2.com&lt;/url&gt;\n        &lt;/links&gt;\n   &lt;/note&gt;\n</code></pre>\n\n<p>I want to add a additional query parameters in all  values. So my resultant xml will be as follows</p>\n\n<pre><code>      &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n - &lt;note&gt;\n       &lt;to&gt;Tove&lt;/to&gt;\n       &lt;from&gt;Jani&lt;/Ffrom&gt;\n       &lt;heading&gt;Reminder&lt;/heading&gt;\n       &lt;body&gt;Don't forget me this weekend!&lt;/body&gt;\n        &lt;url&gt;http://example.com?param=value&lt;/url&gt;\n        &lt;links&gt;\n            &lt;url&gt;http://link1.com?param=value&lt;/url&gt;\n            &lt;url&gt;http://link2.com?param=value&lt;/url&gt;\n        &lt;/links&gt;\n   &lt;/note&gt;\n</code></pre>\n\n<p>How to use go-libxml2 to modify XML?</p>\n"}, {"tags": ["go", "oauth-2.0"], "comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1568789595, "post_id": 57985903, "comment_id": 102381367, "body": "have you checked the value of <code>authCode</code> after scanning? Try doing this."}, {"owner": {"reputation": 1, "user_id": 11679633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3f103f44db8682bebc695413311e020?s=128&d=identicon&r=PG&f=1", "display_name": "The_Lisztomaniac", "link": "https://stackoverflow.com/users/11679633/the-lisztomaniac"}, "reply_to_user": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1568792598, "post_id": 57985903, "comment_id": 102382882, "body": "that won&#39;t work... i am supposed to paste authentication code on the terminal after the website displays the authentication code...and that&#39;s where the error comes forth.."}], "owner": {"reputation": 1, "user_id": 11679633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3f103f44db8682bebc695413311e020?s=128&d=identicon&r=PG&f=1", "display_name": "The_Lisztomaniac", "link": "https://stackoverflow.com/users/11679633/the-lisztomaniac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568792009, "creation_date": 1568786033, "last_edit_date": 1568792009, "question_id": 57985903, "link": "https://stackoverflow.com/questions/57985903/cannot-fetch-token-error-getting-authentication-code-for-amazondrive-using-oauth", "title": "Cannot fetch token error getting authentication code for amazondrive using oauth2", "body": "<p>I am trying to access amazon drive through a command line application. \nI have also created a security profile on amazon and enabled login with amazon.\nThe main function calls the <code>Setup()</code> function.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/fatih/color\"\n    \"github.com/toqueteos/webbrowser\"\n\n    \"golang.org/x/oauth2\"\n)\n\ntype ACDriveStore struct {\n    Config     oauth2.Config `json:\"oauth_config\"`\n    OAuthToken oauth2.Token  `json:\"oauth_token\"`\n}\n\nfunc (acd *ACDriveStore) Setup() bool {\n    config := receiveConfig()\n\n    token, err := getACDriveTokenFromWeb(config)\n    if err != nil {\n        color.Red(\"Unable to get client token: %v\", err)\n        return false\n    }\n\n    acd.OAuthToken = *token\n\n    return false\n}\n\nfunc getACDriveTokenFromWeb(config *oauth2.Config) (*oauth2.Token, error) {\n    authURL := config.AuthCodeURL(\"go-acd\", oauth2.AccessTypeOffline)\n    webbrowser.Open(authURL)\n\n    color.Yellow(\"Enter Auth Code: \")\n\n    var authCode string\n    if _, err := fmt.Scan(&amp;authCode); err != nil {\n        color.Red(\"Unable to read authentication code %v\", err)\n        return nil, err\n    }\n\n    tok, err := config.Exchange(oauth2.NoContext, authCode)\n    if err != nil {\n        color.Red(\"Unable to retrieve token from web %v\", err)\n        return tok, err\n    }\n\n    return tok, nil\n}\n\nfunc receiveConfig() *oauth2.Config {\n    var appKey, appSecret string\n\n    appKey, appSecret = AmazonDriveClientKey, AmazonDriveClientSecret\n\n    return &amp;oauth2.Config{\n        ClientID:     appKey,\n        ClientSecret: appSecret,\n        Endpoint: oauth2.Endpoint{\n            AuthURL:  \"https://www.amazon.com/ap/oa\",\n            TokenURL: \"https://api.amazon.com/auth/o2/token\",\n        },\n        RedirectURL: \"https://go-acd.appspot.com/oauth\",\n        Scopes:      []string{\"clouddrive:read\", \"clouddrive:write\"},\n    }\n}\n\n</code></pre>\n\n<p>But I am getting this error.</p>\n\n<blockquote>\n  <p>oauth2: cannot fetch token: 400 Bad Request\n  Response: {\"error\":\"invalid_request\",\"error_description\":\"The request is missing a required parameter : code\"}\n  null</p>\n</blockquote>\n"}, {"tags": ["regex", "go", "filebeat"], "answers": [{"comments": [{"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 1, "creation_date": 1568784556, "post_id": 57985650, "comment_id": 102379500, "body": "Or just use dot all mode, if that would be supported."}], "tags": [], "owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "is_accepted": false, "score": 0, "last_activity_date": 1568785165, "last_edit_date": 1568785165, "creation_date": 1568784529, "answer_id": 57985650, "question_id": 57985560, "link": "https://stackoverflow.com/questions/57985560/regexp-match-all-until-two-consecutive-special-characters/57985650#57985650", "title": "RegExp match all until two consecutive special characters (]])", "body": "<p>Since all you want to do is match the log entries, and not capture any info, use this:</p>\n\n<p><code>^\\[\\d{4}-\\d{2}-\\d{2}[\\s\\S]+?\\]\\]?$ /gm</code></p>\n\n<p>The idea is to capture the data lazily (by using <code>?</code>) until a single or two <code>]</code> are encountered at the end of the line.</p>\n\n<p><a href=\"https://regex101.com/r/yGP2HV/3\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": false, "score": 0, "last_activity_date": 1568785019, "last_edit_date": 1568785019, "creation_date": 1568784690, "answer_id": 57985682, "question_id": 57985560, "link": "https://stackoverflow.com/questions/57985560/regexp-match-all-until-two-consecutive-special-characters/57985682#57985682", "title": "RegExp match all until two consecutive special characters (]])", "body": "<p>Some of your groups are optional, not sure which ones, yet this expression might be OK to start with:</p>\n\n<pre><code>^\\[(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})\\s\\+(\\d{4})\\]\\[\\d{10}\\](\\[[^\\]]*\\])?\\[[^\\]]*\\]\\[[^\\]]*\\]\\[[^\\]]*\\]\\[[^\\]]*\\](\\[[\\s\\S]*?\\])?$\n</code></pre>\n\n<h3><a href=\"https://regex101.com/r/f8TaFW/1/\" rel=\"nofollow noreferrer\">Demo 1</a></h3>\n\n<p>or maybe,</p>\n\n<pre><code>^\\[(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})\\s\\+(\\d{4})\\]\\[(\\d{10})\\](\\[([^\\]]*)\\])?\\[([^\\]]*)\\]\\[([^\\]]*)\\]\\[([^\\]]*)\\]\\[([^\\]]*)\\](\\[([\\s\\S]*?)\\])?$\n</code></pre>\n\n<h3><a href=\"https://regex101.com/r/alrllp/1/\" rel=\"nofollow noreferrer\">Demo 2</a></h3>\n\n<p>if you might want to capture those data in the brackets. </p>\n\n<hr>\n\n<p>If you wish to simplify/modify/explore the expression, it's been explained on the top right panel of <a href=\"https://regex101.com/r/alrllp/1/\" rel=\"nofollow noreferrer\">regex101.com</a>. If you'd like, you can also watch in <a href=\"https://regex101.com/r/alrllp/1/debugger\" rel=\"nofollow noreferrer\">this link</a>, how it would match against some sample inputs.</p>\n\n<hr>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1568830116, "creation_date": 1568830116, "answer_id": 57998558, "question_id": 57985560, "link": "https://stackoverflow.com/questions/57985560/regexp-match-all-until-two-consecutive-special-characters/57998558#57998558", "title": "RegExp match all until two consecutive special characters (]])", "body": "<p>if you want to parse the data, you can optin for a bufio.Scanner like interface</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"io\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n\n    input := `\n[2019-05-24 09:58:39 +0200][0000000000][Debug][External][RESTLM][HTDOC_REQUEST][Some Debug Loginformation]\n[2019-05-24 09:58:40 +0200][0000000000][Debug][External][RESTLM][HTDOC_REQUEST][Some Debug Loginformation]\n[2019-05-24 09:58:41 +0200][0000000026][Debug][External][RESTLM][REST_RESPONSE][[45][HTTP/1.0 201 Created\n    Server: Test/2019.3\n    Pragma: no-cache\n    Cache-control: no-cache\n    Content-Type: text/xml\n    Content-Length: 255\n\n    &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;Status&gt;&lt;Repository&gt;&lt;Path&gt;D:/repository/tabfiles&lt;/Path&gt;&lt;Version&gt;4_0&lt;/Version&gt;&lt;Fingerprint&gt;p12uqocQM0gtaRieBldCix/CSSs=&lt;/Fingerprint&gt;&lt;/Repository&gt;&lt;System&gt;Running&lt;/System&gt;&lt;/Status&gt;]]\n[2019-05-24 09:58:42 +0200][0000000000][Debug][External][RESTLM][REST_REQUEST][[45][POST / HTTP/1.1\n    Content-Type: text/xml; charset=utf-8\n    Cache-Control: no-cache\n    Pragma: no-cache\n    User-Agent: Java/11.0.2\n    Host: serverxyz:24821\n    Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\n    Connection: keep-alive\n    Content-Length: 10\\]\n\n    &lt;Status /&gt;]]\n`\n    // input = `[2019-05-24 09:58:39 +0200][0000000000][Debug][External][RESTLM][HTDOC_REQUEST][Some Debug Loginformation]`\n\n    src := strings.NewReader(input)\n    parser := newScanner(src)\n    for parser.Scan() {\n        line := parser.Items()\n        if len(line) &gt; 2 &amp;&amp; line[2] == \"DEBUG\" {\n            continue\n        }\n        log.Printf(\"line %#v\\n\", line)\n    }\n    log.Println(\"done\")\n}\n\ntype scanner struct {\n    *bufio.Scanner\n    buf            []byte\n    openedBrackets int\n    lineDone       bool\n    atEOF          bool\n    lines          [][]string\n    currentCols    []string\n    currentCol     []byte\n}\n\nfunc newScanner(r io.Reader) *scanner {\n    b := bufio.NewScanner(r)\n    s := &amp;scanner{\n        Scanner:     b,\n        buf:         make([]byte, 500),\n        lines:       [][]string{},\n        currentCols: []string{},\n        currentCol:  []byte{},\n    }\n    b.Split(s.parse)\n    return s\n}\n\nfunc (s *scanner) Scan() bool {\n    for !s.lineDone {\n        if s.Scanner.Scan() {\n            s.lineDone = false\n            return true\n        } else if s.atEOF {\n            return false\n        }\n    }\n    return false\n}\n\nfunc (s *scanner) Items() []string {\n    if len(s.lines) == 0 {\n        return nil\n    }\n    return s.lines[len(s.lines)-1]\n}\n\nvar (\n    buf          = make([]byte, 500)\n    eol          = []byte(\"\\n\")[0]\n    bracketClose = []byte(\"]\")[0]\n    bracketOpen  = []byte(\"[\")[0]\n    backslash    = []byte(\"\\\\\")[0]\n)\n\nfunc (s *scanner) parse(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    var d byte\n    var i int\n    var since int\n    for i, d = range data {\n        if d == bracketClose {\n            if i &gt; 0 &amp;&amp; data[i-1] == backslash {\n                continue\n            }\n            s.currentCol = append(s.currentCol, data[since+1:i]...)\n            since = i\n            s.openedBrackets--\n            if s.openedBrackets == 0 {\n                s.currentCols = append(s.currentCols, string(s.currentCol))\n                s.currentCol = s.currentCol[:0]\n            } else {\n                s.currentCol = append(s.currentCol, d)\n            }\n        } else if s.openedBrackets == 0 &amp;&amp; d == eol {\n            line := make([]string, len(s.currentCols))\n            copy(line, s.currentCols)\n            s.lines = append(s.lines, line)\n            s.currentCols = s.currentCols[:0]\n            s.openedBrackets = 0\n            s.lineDone = true\n            return i + 1, data[i+1:], nil\n\n        } else if d == bracketOpen {\n            if i &gt; 0 &amp;&amp; data[i-1] == backslash {\n                continue\n            }\n            since = i\n            if s.openedBrackets &gt; 0 {\n                s.currentCol = append(s.currentCol, d)\n            }\n            s.openedBrackets++\n        }\n    }\n    if atEOF {\n        s.atEOF = true\n        s.lineDone = true\n        if len(s.currentCols) &gt; 0 {\n            line := make([]string, len(s.currentCols))\n            copy(line, s.currentCols)\n            s.lines = append(s.lines, line)\n            s.currentCols = s.currentCols[:0]\n            s.openedBrackets = 0\n            s.lineDone = true\n            return len(data) + 1, nil, nil\n        }\n        return len(data) + 1, nil, io.EOF\n    }\n    return len(data) + 1, nil, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6497404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de8bc7865fe37d48e61257ad9d0ce2a7?s=128&d=identicon&r=PG&f=1", "display_name": "Peter K.", "link": "https://stackoverflow.com/users/6497404/peter-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1568830116, "creation_date": 1568784042, "last_edit_date": 1568784541, "question_id": 57985560, "link": "https://stackoverflow.com/questions/57985560/regexp-match-all-until-two-consecutive-special-characters", "title": "RegExp match all until two consecutive special characters (]])", "body": "<p>I tried to figure out one (multiline.pattern) or two (multiline.pattern &amp; exclude_line) regex in order to ship log information from filebeat to logstash.\nThe system which writes the logs has a standardized log format which looks as follows</p>\n\n<pre><code>[2019-08-28 10:38:57 +0200][0000000000][Info][User][OLS][201][Some Logging Information]\n</code></pre>\n\n<p>To match this I have built up the regex (maybe this needs also some improvements :-))</p>\n\n<pre><code>^\\[(\\d{4})-(\\d{2})-(\\d{2})\\s(\\d{2}):(\\d{2}):(\\d{2})\\s\\+(\\d{4})\\]\\[\\d{10}\\]\\[[^\\]]*\\]\\[[^\\]]*\\]\\[[^\\]]*\\]\\[[\\d]*\\]\\[[^\\]]*\\]$\n</code></pre>\n\n<p>Unfortunately the log structure changes when the system runs in debug mode</p>\n\n<pre><code>[2019-05-24 09:58:39 +0200][0000000000][Debug][External][RESTLM][HTDOC_REQUEST][Some Debug Loginformation]\n[2019-05-24 09:58:39 +0200][0000000000][Debug][External][RESTLM[HTDOC_REQUEST][Some Debug Loginformation]\n[2019-05-24 09:58:34 +0200][0000000026][Debug][External][RESTLM][REST_RESPONSE][[45][HTTP/1.0 201 Created\n    Server: Test/2019.3\n    Pragma: no-cache\n    Cache-control: no-cache\n    Content-Type: text/xml\n    Content-Length: 255\n\n    &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;Status&gt;&lt;Repository&gt;&lt;Path&gt;D:/repository/tabfiles&lt;/Path&gt;&lt;Version&gt;4_0&lt;/Version&gt;&lt;Fingerprint&gt;p12uqocQM0gtaRieBldCix/CSSs=&lt;/Fingerprint&gt;&lt;/Repository&gt;&lt;System&gt;Running&lt;/System&gt;&lt;/Status&gt;]]\n[2019-05-24 09:58:34 +0200][0000000000][Debug][External][RESTLM][REST_REQUEST][[45][POST / HTTP/1.1\n    Content-Type: text/xml; charset=utf-8\n    Cache-Control: no-cache\n    Pragma: no-cache\n    User-Agent: Java/11.0.2\n    Host: serverxyz:24821\n    Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\n    Connection: keep-alive\n    Content-Length: 10\n\n    &lt;Status /&gt;]]\n</code></pre>\n\n<p>I want to exclude those log entries (multiline) which contains \"Debug\" in the 3rd field.\nFrom my point of view the main difference between normal and debug log is in 6th field is not a [\\d*].\nAnd in some cases, I think this is my problem, there is a log inside the Loginformation (last logfield) - which looks like [[[45][some text][other text]]</p>\n\n<p>What I am looking for is either a regex which matches one complete log entry independent of debug or normal.\nOr two expression\n1st match of normal logs\n2nd match debug logs (and exclude them)</p>\n"}, {"tags": ["go", "kubernetes", "client-go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568775053, "post_id": 57984137, "comment_id": 102377448, "body": "Those imports don&#39;t look right. Look at the examples here: <a href=\"https://github.com/kubernetes/client-go/tree/master/examples\" rel=\"nofollow noreferrer\">github.com/kubernetes/client-go/tree/master/examples</a>"}, {"owner": {"reputation": 37, "user_id": 12082462, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B1ldRhgwQSU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reeyMktvKQ1srIQoxUAhZ1J8GGkbA/photo.jpg?sz=128", "display_name": "edselwang", "link": "https://stackoverflow.com/users/12082462/edselwang"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568789179, "post_id": 57984137, "comment_id": 102381183, "body": "yes, kubernetes has meraged some client-go api into it&#39;s api, but i can not find out how to do watch-list functions."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568789745, "post_id": 57984137, "comment_id": 102381428, "body": "This is the ClientSet doc: <a href=\"https://godoc.org/k8s.io/client-go/kubernetes#Clientset\" rel=\"nofollow noreferrer\">godoc.org/k8s.io/client-go/kubernetes#Clientset</a>. You can call ClientSet.CoreV1(), and from that, you can get one of the getter interfaces, and call the Watch API to watch a resource."}, {"owner": {"reputation": 37, "user_id": 12082462, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B1ldRhgwQSU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reeyMktvKQ1srIQoxUAhZ1J8GGkbA/photo.jpg?sz=128", "display_name": "edselwang", "link": "https://stackoverflow.com/users/12082462/edselwang"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568794723, "post_id": 57984137, "comment_id": 102383955, "body": "emm.. I have a try. it seem to be a client-go version problem."}], "owner": {"reputation": 37, "user_id": 12082462, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-B1ldRhgwQSU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reeyMktvKQ1srIQoxUAhZ1J8GGkbA/photo.jpg?sz=128", "display_name": "edselwang", "link": "https://stackoverflow.com/users/12082462/edselwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 620, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568789035, "creation_date": 1568772643, "last_edit_date": 1568789035, "question_id": 57984137, "link": "https://stackoverflow.com/questions/57984137/some-probelm-when-i-use-client-go-for-kubernetes-watch-list", "title": "Some probelm when I use client-go for kubernetes watch list", "body": "<p>I have some when I use the code in StackOverflow. Such as </p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"time\"\n\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/pkg/api/v1\"\n    \"k8s.io/client-go/pkg/fields\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\nvar (\n    kubeconfig = flag.String(\"kubeconfig\", \"./config\", \"absolute path to the kubeconfig file\")\n)\n\nfunc main() {\n    flag.Parse()\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n    if err != nil {\n        panic(err.Error())\n    }\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    watchlist := cache.NewListWatchFromClient(clientset.Core().RESTClient(), \"services\", v1.NamespaceDefault,\n        fields.Everything())\n    _, controller := cache.NewInformer(\n        watchlist,\n        &amp;v1.Service{},\n        time.Second * 0,\n        cache.ResourceEventHandlerFuncs{\n            AddFunc: func(obj interface{}) {\n                fmt.Printf(\"service added: %s \\n\", obj)\n            },\n            DeleteFunc: func(obj interface{}) {\n                fmt.Printf(\"service deleted: %s \\n\", obj)\n            },\n            UpdateFunc:func(oldObj, newObj interface{}) {\n                fmt.Printf(\"service changed \\n\")\n            },\n        },\n    )\n    stop := make(chan struct{})\n    go controller.Run(stop)\n    for{\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n\n<p>it have some errors:</p>\n\n<ol>\n<li><p>i can not find the package <code>\"k8s.io/client-go/pkg/api/v1\"</code> and <code>\"k8s.io/client-go/pkg/fields\"</code>, i don't know how to find it:</p>\n\n<p><a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go</a></p></li>\n<li><p>the code</p></li>\n</ol>\n\n<pre><code>watchlist := cache.NewListWatchFromClient(clientset.Core().RESTClient(), \"services\", v1.NamespaceDefault,\n        fields.Everything())\n</code></pre>\n\n<p>has the error:</p>\n\n<blockquote>\n  <p>Cannot use 'clientSet.CoreV1().RESTClient()' (type rest.Interface) as\n  type Getter Type does not implement 'Getter' as some methods are\n  missing: Get() *restclient.Request</p>\n</blockquote>\n\n<p>Could anyone tell me how to resolve it?\nThanks in advance.</p>\n"}, {"tags": ["go", "sum", "boolean", "boolean-operations"], "answers": [{"comments": [{"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "edited": false, "score": 0, "creation_date": 1568771141, "post_id": 57983816, "comment_id": 102376762, "body": "Is there really no better way to say &quot;count the number of elements equal to <code>x</code>&quot;?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "edited": false, "score": 2, "creation_date": 1568771463, "post_id": 57983816, "comment_id": 102376803, "body": "@Alexander Go is notorious for leaving the low level but straightforward operations to the implementer. The language&#39;s opinion is that doing otherwise is hiding the true complexity of those operations."}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1568774978, "post_id": 57983816, "comment_id": 102377428, "body": "@AdamSmith Interesting. Not my cup of tea, but I haven&#39;t looked too deeply into why that is or what advantages it might have"}, {"owner": {"reputation": 893, "user_id": 5188833, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6e55d433a6bd03a6cd367998042ba58c?s=128&d=identicon&r=PG&f=1", "display_name": "emmdee", "link": "https://stackoverflow.com/users/5188833/emmdee"}, "reply_to_user": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "edited": false, "score": 1, "creation_date": 1568779174, "post_id": 57983816, "comment_id": 102378176, "body": "@Alexander I choose it because it is incredibly simple and straightforward to compile standalone linux, win, and mac executables. Typically I go with python but the cross-platform functionality &amp; natural portability of Go really hooked me."}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 893, "user_id": 5188833, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6e55d433a6bd03a6cd367998042ba58c?s=128&d=identicon&r=PG&f=1", "display_name": "emmdee", "link": "https://stackoverflow.com/users/5188833/emmdee"}, "edited": false, "score": 0, "creation_date": 1568780273, "post_id": 57983816, "comment_id": 102378406, "body": "@emmdee Yeah, I&#39;ve heard of those &quot;perks&quot;,  just the &quot;use primitives for most things&quot; style is novel to me"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1568773972, "last_edit_date": 1568773972, "creation_date": 1568769912, "answer_id": 57983816, "question_id": 57983764, "link": "https://stackoverflow.com/questions/57983764/how-to-get-sum-of-true-bools/57983816#57983816", "title": "How to get &quot;sum&quot; of true bools", "body": "<blockquote>\n  <p>identify if more than one of the set of bool vars are set to true</p>\n</blockquote>\n\n<hr>\n\n<p>For example, write a set function:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc nTrue(b ...bool) int {\n    n := 0\n    for _, v := range b {\n        if v {\n            n++\n        }\n    }\n    return n\n}\n\nfunc main() {\n    v1, v2, v3 := true, false, true\n\n    fmt.Println(nTrue(v1, v2, v3))\n\n    if nTrue(v1, v2, v3) &gt; 1 {\n        // . .   .\n    }\n    // Or\n    if n := nTrue(v1, v2, v3); n &gt; 1 {\n        // . .   .\n    }\n    // Or\n    n := nTrue(v1, v2, v3)\n    if n &gt; 1 {\n        // . .   .\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/g3WCN6BgGly\" rel=\"noreferrer\">https://play.golang.org/p/g3WCN6BgGly</a></p>\n\n<p>Output:</p>\n\n<pre><code>2\n</code></pre>\n\n<hr>\n\n<p>For example, range over the set,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    v1, v2, v3 := true, false, true\n\n    boolval := 0\n    for _, v := range []bool{v1, v2, v3} {\n        if v {\n            boolval++\n        }\n    }\n    if boolval &gt; 1 {\n        // . .   .\n    }\n\n    fmt.Println(boolval &gt; 1, boolval)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/R6UGb8YYEFw\" rel=\"noreferrer\">https://play.golang.org/p/R6UGb8YYEFw</a></p>\n\n<p>Output:</p>\n\n<pre><code>true 2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": -3, "last_activity_date": 1568771611, "creation_date": 1568771611, "answer_id": 57983997, "question_id": 57983764, "link": "https://stackoverflow.com/questions/57983764/how-to-get-sum-of-true-bools/57983997#57983997", "title": "How to get &quot;sum&quot; of true bools", "body": "<p>Depending on how you're getting the values of <code>firstbool</code> et. al, there might be a more idiomatic approach you should take here. Consider that channels and goroutines can handle doing the accounting in the background. If your booleans are the result of some heavier operations, it might make sense to do something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc firstFunc(ch chan bool) {\n    // assume this works, true!\n    ch &lt;- true\n}\n\nfunc secondFunc(ch chan bool) {\n    // assume this fails, false!\n    ch &lt;- false\n}\n\nfunc thirdFunc(ch chan bool) {\n    // assume this works, true!\n    ch &lt;- true\n}\n\nfunc listener(ch chan bool, numCallers int) &lt;-chan bool {\n    outch := make(chan bool)\n    THRESHOLD := 2\n    go func(outch chan&lt;- bool) {\n        count := 0\n        trues := 0\n\n        for count &lt; numCallers &amp;&amp; trues &lt; THRESHOLD {\n            val := &lt;-ch\n            if val {\n                trues++\n            }\n            count++\n        }\n        outch &lt;- trues &gt;= THRESHOLD\n    }(outch)\n    return outch\n}\n\nfunc main() {\n    ch := make(chan bool)\n    resultch := listener(ch, 3)\n\n    go firstFunc(ch)\n    go secondFunc(ch)\n    go thirdFunc(ch)\n\n    if &lt;-resultch {\n        fmt.Println(\"Two or more processes succeeded\")\n    }\n}\n</code></pre>\n\n<p>However this is <em>way</em> over-engineered for a simple need, so consider this only if this pattern fits the larger design of your application.</p>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1568775531, "post_id": 57984377, "comment_id": 102377532, "body": "The fundamental question: &quot;I always flag my logic if I am writing successive if{} statements,&quot; In the example, there are three successive <code>if</code> statements. Perhaps there are four, or seven, or forty-two successive <code>if</code> statements. How would you sum those examples?"}], "tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": -2, "last_activity_date": 1568792429, "last_edit_date": 1568792429, "creation_date": 1568774954, "answer_id": 57984377, "question_id": 57983764, "link": "https://stackoverflow.com/questions/57983764/how-to-get-sum-of-true-bools/57984377#57984377", "title": "How to get &quot;sum&quot; of true bools", "body": "<p>Maybe I'm tragically misunderstand something but this question is looks like exercise in boolean algebra.</p>\n\n<h3>First: let's clarify what \"sum\" means</h3>\n\n<blockquote>\n  <p>The goal here is to identify if more than one of the set of bool vars are set to true</p>\n</blockquote>\n\n<p>So \"sum\" actually means: <strong>\"more than once</strong> or <strong>\"twice or more\"</strong></p>\n\n<h3>Second: let's write \"More than Once\" directly</h3>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func MoreThanOnce(a, b, c bool) bool {\n    return ( \n        a&amp;&amp;(b||c)) || \n        (a||b)&amp;&amp;c ||        \n        (a||c)&amp;&amp;b\n}\n</code></pre>\n\n<h3>Third: Simplify</h3>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func MoreThanOnce(a, b, c bool) bool { return a&amp;&amp;b || a&amp;&amp;c  || b&amp;&amp;c}\n</code></pre>\n\n<h3>Result</h3>\n\n<p>One line, no <code>if</code>s, no channels, no pointers. </p>\n\n<p>Is this what was wanted?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>From @peterSO comment:</p>\n\n<blockquote>\n  <p>In the example, there are three successive if statements. Perhaps there are four, or seven, or forty-two successive if statements. How would you sum those examples?</p>\n</blockquote>\n\n<h3>Generalize</h3>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func MoreThanOnce(vs...bool) (result bool){\n    for i:=0; i&lt;len(vs); i++{\n      for j:=i+1; j&lt;len(vs); j++{ \n        if i!=j{  // this `if` could be omitted\n        result = result || vs[i] &amp;&amp; vs[j]\n        }\n      }\n    }\n    return\n}\n</code></pre>\n\n<p>Is this what was asked?</p>\n"}], "owner": {"reputation": 893, "user_id": 5188833, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6e55d433a6bd03a6cd367998042ba58c?s=128&d=identicon&r=PG&f=1", "display_name": "emmdee", "link": "https://stackoverflow.com/users/5188833/emmdee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 762, "favorite_count": 1, "accepted_answer_id": 57983816, "answer_count": 3, "score": 0, "last_activity_date": 1568792429, "creation_date": 1568769266, "last_edit_date": 1568792028, "question_id": 57983764, "link": "https://stackoverflow.com/questions/57983764/how-to-get-sum-of-true-bools", "title": "How to get &quot;sum&quot; of true bools", "body": "<p>In this scenario I have 3x boolean vars (already set to either <code>true</code> or <code>false</code>)</p>\n\n<p><strong>The goal here is to identify if more than one of the set of bool vars are set to true</strong></p>\n\n<p>Right now I have the following written, which does work: </p>\n\n<pre><code>    boolval := 0\n    if *firstbool {\n        boolval++\n    }\n    if *secondbool {\n        boolval++\n    }\n    if *thirdbool {\n        boolval++\n    }\n    if boolval &gt; 1 {\n        // More than 1 of the bool vars are true\n    }\n\n</code></pre>\n\n<p>I always flag my logic if I am writing successive <code>if{}</code> statements, so I figured I would ask you geniuses how you would accomplish this.</p>\n"}, {"tags": ["go", "pprof"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 21, "user_id": 6782450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b998f2cdfd2a979d4fa64d3a4f7e84a6?s=128&d=identicon&r=PG&f=1", "display_name": "torpido", "link": "https://stackoverflow.com/users/6782450/torpido"}, "edited": false, "score": 0, "creation_date": 1568803102, "post_id": 57984501, "comment_id": 102388742, "body": "then you should accept the answer to give it better visibility to other users. Thanks!"}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1569433751, "post_id": 57984501, "comment_id": 102599075, "body": "Click on the V at the left of the response @torbido"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 2, "last_activity_date": 1568775936, "creation_date": 1568775936, "answer_id": 57984501, "question_id": 57983055, "link": "https://stackoverflow.com/questions/57983055/how-to-calculate-pprof-output-and-avoid-pprof-to-drop-nodes-which-their-cum-is-l/57984501#57984501", "title": "How to calculate pprof output and avoid pprof to drop nodes which their cum is less than 0.10s", "body": "<p>you can use <code>--trim=false</code> to show all nodes in the report</p>\n\n<p><a href=\"https://github.com/google/pprof/blob/master/internal/driver/commands.go#L165\" rel=\"nofollow noreferrer\">https://github.com/google/pprof/blob/master/internal/driver/commands.go#L165</a></p>\n"}], "owner": {"reputation": 21, "user_id": 6782450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b998f2cdfd2a979d4fa64d3a4f7e84a6?s=128&d=identicon&r=PG&f=1", "display_name": "torpido", "link": "https://stackoverflow.com/users/6782450/torpido"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1568775936, "creation_date": 1568761702, "question_id": 57983055, "link": "https://stackoverflow.com/questions/57983055/how-to-calculate-pprof-output-and-avoid-pprof-to-drop-nodes-which-their-cum-is-l", "title": "How to calculate pprof output and avoid pprof to drop nodes which their cum is less than 0.10s", "body": "<p>I'm trying to figure out how pprof calculates the %cum of each node in my Go application output.\nI've attached part of my pprof png output to emphesise the problem which I'm trying to figure out <a href=\"https://i.stack.imgur.com/9Zbh6.png\" rel=\"nofollow noreferrer\">pprof png output</a>\nIn this part of the pprof output there are two nodes:</p>\n\n<p>Node A) runtime scanobject - </p>\n\n<blockquote>\n  <p>flat=1.06s %flat=5.54%</p>\n  \n  <p>cum=1.64s %cum=8.57%</p>\n</blockquote>\n\n<p>Node B) runtime findobject (which is being called by scanobject)-</p>\n\n<blockquote>\n  <p>flat=0.46s %flat=2.4%</p>\n  \n  <p>cum=0.54s %cum=2.82%</p>\n</blockquote>\n\n<p>No metter how cumulative A is being calculated, the numbers does not sum up to func A cumulative (1.64s):</p>\n\n<blockquote>\n  <p>A flat + B flat = 1.06s + 0.46s = 1.52s</p>\n  \n  <p>A flat + B cum = 1.06s + 0.54s = 1.6s</p>\n</blockquote>\n\n<p>One thing that might explain this difference, is that pprof dropps cumulatives which are less than 0.10s, so it might be that there are minor functions which are related to node A that are missing from the pprof output.\nIf that is the root cause, I was wondering if there is a way to tell pprof to make full pprof output</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 4, "creation_date": 1568758986, "post_id": 57982741, "comment_id": 102374581, "body": "<a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 12082306, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8db58dbc60ea2e49dc6b6473b45e4da6?s=128&d=identicon&r=PG", "display_name": "Nhoorical", "link": "https://stackoverflow.com/users/12082306/nhoorical"}, "is_accepted": true, "score": 1, "last_activity_date": 1568767841, "creation_date": 1568767841, "answer_id": 57983637, "question_id": 57982741, "link": "https://stackoverflow.com/questions/57982741/how-to-check-in-go-if-variable-of-type-interface-is-of-certain-struct-type-that/57983637#57983637", "title": "How to check in Go if variable of type Interface is of certain struct type that implements it?", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a> as mentioned the tour page linked by @CeriseLim\u00f3n.</p>\n\n<pre><code>func Foo(v A) {\n    switch v := v.(type) {\n    case B:\n        // It's a B\n    case C:\n        // It's a C\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lyKrmyts7hn\" rel=\"nofollow noreferrer\">See it in action in the playground</a>.</p>\n"}], "owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 57983637, "answer_count": 1, "score": -2, "last_activity_date": 1568778388, "creation_date": 1568758860, "question_id": 57982741, "link": "https://stackoverflow.com/questions/57982741/how-to-check-in-go-if-variable-of-type-interface-is-of-certain-struct-type-that", "title": "How to check in Go if variable of type Interface is of certain struct type that implements it?", "body": "<p>Lets say that I have the following:</p>\n\n<pre><code>type A Interface{\n   ....\n}\n\n//Implements A\ntype B struct{\n   ....\n}\n\n//Imlements A\ntype C struct{\n   ....\n}\n</code></pre>\n\n<p>And now I have a function which accepts variable of type <code>A</code> as an argument:</p>\n\n<pre><code>func Foo(obj A){\n     if A is B{\n          ....\n     }else if A is C{\n          ....\n     }\n}\n</code></pre>\n\n<p>And a <code>main</code> function:</p>\n\n<pre><code>func main(){\n\n    b := B{}\n    Foo(b)\n\n}\n</code></pre>\n\n<p>How can I check if the argument passed to the function is actually type <code>B</code>?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568825042, "post_id": 57982277, "comment_id": 102401134, "body": "Why are you doing this with Go at all, when you can do it <a href=\"https://stackoverflow.com/questions/356578/how-to-output-mysql-query-results-in-csv-format\">directly with MySQL</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1568824959, "last_edit_date": 1568824959, "creation_date": 1568773514, "answer_id": 57984240, "question_id": 57982277, "link": "https://stackoverflow.com/questions/57982277/how-to-use-csv-writer-to-output-mysql-data/57984240#57984240", "title": "How to use csv.Writer to output MySQL data", "body": "<p>csv.Write in stdlib gets an array of strings, so you should do something like this in your for-loop:</p>\n\n<pre><code>writer.Write([]string{TestTable.id, TestTable.testId, TestTable.testtwoId, TestTable.testthreeId, TestTable.testfourId})\n</code></pre>\n\n<p>If some of those fields of TestTable are not strings, you have to convert them to strings as necessary.</p>\n"}], "owner": {"reputation": 45, "user_id": 5893162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b75f055c8d9db1690609e7f546125ef?s=128&d=identicon&r=PG&f=1", "display_name": "Zl1987", "link": "https://stackoverflow.com/users/5893162/zl1987"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568824959, "creation_date": 1568755692, "last_edit_date": 1568824946, "question_id": 57982277, "link": "https://stackoverflow.com/questions/57982277/how-to-use-csv-writer-to-output-mysql-data", "title": "How to use csv.Writer to output MySQL data", "body": "<p>I'm trying to export the results of a MySQL query to a .csv file via Go.</p>\n\n<p>In my current code, I am able to print out the results of my query in a command window, but I'd like to export those results via .csv file.</p>\n\n<p>My current code looks like this:</p>\n\n<pre><code>results, err := db.Query(\"SELECT id, testId, testtwoId, testthreeId, testfourId  FROM TestTable LIMIT 100\")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    for results.Next() {\n        var estTable TestTable\n\n        err = results.Scan(&amp;orderEvent.id, &amp;orderEvent.testId, &amp;orderEvent.eventId, &amp;orderEvent.createTime, &amp;orderEvent.updateTime)\n        if err != nil {\n            panic(err.Error())\n        }\n        log.Println(TestTable.id, TestTable.testId, TestTable.testtwoId, TestTable.testthreeId, TestTable.testfourId)\n    }\n</code></pre>\n\n<p>When running my file, I am able to view my tables data without issue, but I'd still like to export this data via .csv.</p>\n\n<p>I was looking around and found some code for .csv functionality, however I'm uncertain how to apply this to my current code.</p>\n\n<p>I thought about applying something like this: </p>\n\n<pre><code>\n    file, err := os.Create(\"result.csv\")\n    checkError(\"Cannot create file\", err)\n    defer file.Close()\n\n    writer := csv.NewWriter(file)\n    defer writer.Flush()\n\n    for _, value := range data {\n        err := writer.Write(value)\n        checkError(\"Cannot write to file\", err)\n    }\n}\n\nfunc checkError(message string, err error) {\n    if err != nil {\n        log.Fatal(message, err)\n    }\n}\n</code></pre>\n\n<p>However, I am currently not sure how to apply this in my code.</p>\n"}, {"tags": ["go", "distributed-computing", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1568761813, "post_id": 57982006, "comment_id": 102375197, "body": "you want a <a href=\"https://godoc.org/google.golang.org/grpc#WithStreamInterceptor\" rel=\"nofollow noreferrer\">stream client interceptor</a>, and <a href=\"https://godoc.org/google.golang.org/grpc/metadata\" rel=\"nofollow noreferrer\">google.golang.org/grpc/metadata</a>. This way you can intercept each call and check it&#39;s identity based on whatever flow (I agree with the answer, <a href=\"https://github.com/dgrijalva/jwt-go\" rel=\"nofollow noreferrer\">JWT</a> is a nice option)"}], "answers": [{"tags": [], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "is_accepted": false, "score": 0, "last_activity_date": 1568756805, "creation_date": 1568756805, "answer_id": 57982469, "question_id": 57982006, "link": "https://stackoverflow.com/questions/57982006/how-do-i-respond-to-multiple-grpc-clients/57982469#57982469", "title": "How do I respond to multiple gRPC clients?", "body": "<p>This sounds like a common authentication/authorization problem that ultimately won't have much to do with gRPC or Go.</p>\n\n<p>You need a way for a client to indicate who they are. Personally I'm a fan of <a href=\"https://jwt.io/\" rel=\"nofollow noreferrer\">JWTs</a>. In a standard HTTP request, there are authorization headers that can indicate who is making the request. Similarly, gRPC supports meta data attached to each remote call. In my current work project, every call must have a JWT in the meta data or else I don't process the request. Every call except the login endpoint that is.</p>\n\n<p>I haven't looked into how to get details like a gRPC client's IP address or other information about a client's connection but chances are that anything provided by gRPC's generated code is something potentially faked by the client. When architected correctly, JWTs can offer cryptographic confidence that the client is who they claim to be.</p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 12081788, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-v5jUwbfZK6E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3retZLDERmM7v5pYKsGyOCU_nSYe6A/photo.jpg?sz=128", "display_name": "iamalsaher", "link": "https://stackoverflow.com/users/12081788/iamalsaher"}, "edited": false, "score": 0, "creation_date": 1568808832, "post_id": 57984261, "comment_id": 102391907, "body": "Yeah the broadcast was not happening to each stream, I misunderstood that, thanks for your help"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1568773837, "creation_date": 1568773837, "answer_id": 57984261, "question_id": 57982006, "link": "https://stackoverflow.com/questions/57982006/how-do-i-respond-to-multiple-grpc-clients/57984261#57984261", "title": "How do I respond to multiple gRPC clients?", "body": "<p>There are two ways to read this question. One way is to read it as the auth problem as answered before. The second way is how I read it, as a connection/session problem.</p>\n\n<p>When the client connects, the grpc server will invoke a function to implement the call in its own goroutine, and that function will be only talking to the client that initiated that call. So, the struct you registered as your grpc server will be shared among many connections, but each connection will run in its own goroutine, and will only talk to the client that initiated it. That also means you have to make sure the grpc server implementation is thread-safe.</p>\n\n<p>You mentioned data is being broadcasted to every client? There is no broadcast in grpc, are you sure that's what's happening?</p>\n"}], "owner": {"reputation": 53, "user_id": 12081788, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-v5jUwbfZK6E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3retZLDERmM7v5pYKsGyOCU_nSYe6A/photo.jpg?sz=128", "display_name": "iamalsaher", "link": "https://stackoverflow.com/users/12081788/iamalsaher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2510, "favorite_count": 1, "accepted_answer_id": 57984261, "answer_count": 2, "score": 4, "last_activity_date": 1568792157, "creation_date": 1568754014, "last_edit_date": 1568792157, "question_id": 57982006, "link": "https://stackoverflow.com/questions/57982006/how-do-i-respond-to-multiple-grpc-clients", "title": "How do I respond to multiple gRPC clients?", "body": "<p>I am building an application which can have multiple gRPC servers and definitely will have multiple gRPC clients, I wanted to know, how to identify on server side that this is the client I am talking to and only send data to that client. I am using bidirectional streaming RPC and right now the data gets broadcasted to every client and I don't want that. What functions in go gRPC make it possible or how can I implement it?</p>\n"}, {"tags": ["go", "go-interface", "go-map"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1568753409, "post_id": 57981767, "comment_id": 102372876, "body": "Please consider making your question readable."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568774146, "post_id": 57981767, "comment_id": 102377271, "body": "You might want to try one of the json pointer libraries, like: <a href=\"https://github.com/go-openapi/jsonpointer\" rel=\"nofollow noreferrer\">github.com/go-openapi/jsonpointer</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568776771, "post_id": 57981767, "comment_id": 102377744, "body": "type switches <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Switch_statements</a>"}], "owner": {"reputation": 140, "user_id": 6506889, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Wp35t.jpg?s=128&g=1", "display_name": "Srinivas Bandaru", "link": "https://stackoverflow.com/users/6506889/srinivas-bandaru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568776881, "creation_date": 1568752757, "last_edit_date": 1568776881, "question_id": 57981767, "link": "https://stackoverflow.com/questions/57981767/iterating-and-updating-attributes-of-a-value-of-a-mapstringinterface", "title": "iterating and updating attributes of a value of a map[string]interface{}", "body": "<p>We have an interface object like below and Data looks below</p>\n\n<p>[ map[com.org.exts.criteria.model.Sourceemployee:map[active:true ids:map[com.org.exts.criteria.model.employee.ids:map[alternateIds: alternateSubId:map[string:SomeValuestring] IDnumber: somefiledAssignedIds: familyId:map[int:111] MyAccountIds: ABCNumbers: OldIds: nrtNumbers: GHTNumb: Somefiledx: Somefiledx: Somefiledz:map[string:OldId1] somefiled779: someIds: somenumberfiled: someoriginid: someconsumerids:]</p>\n\n<p>I can cast the interface as a map[string]interface{}, But when we do that the structure is nested with maps. Whats the best of iterating through all of the attributes within the interface object? </p>\n\n<pre><code>//My code looks below.\n    func (m *DataMapping) Map(rowMap *Datamapper.RowMap, previousRowValue map[string]interface{}) (buffer bytes.Buffer, err error) {\n        for stageKey := range previousRowValue {\n            stageKeyValueData := previousStageValue[stageKey]\n            // Some code for iterating through the map here is the challenge\n        }\n     }\n</code></pre>\n\n<p>We can cast the interface as a map[string]interface{} as mentioned in above code, But unable to navigate dynamically nested with maps. Trying to dynamically traverse through each attribute in map and able to update it.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568751559, "post_id": 57981481, "comment_id": 102372161, "body": "The structure looks fine, with the exception of the json tags. What is the problem you&#39;re seeing? If some keys are missing, they will be left empty when unmarshaled."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568751584, "post_id": 57981481, "comment_id": 102372167, "body": "&quot;Unstructured&quot; is maybe not the right word (if it&#39;s valid JSON, it&#39;s structured), but it seems like you&#39;re talking about dynamic or unpredictable JSON. In that case, there&#39;s some key questions to ask here: 1) do you need all of the data, or just certain fields? And 2) which parts vary and how do they vary?"}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "edited": false, "score": 0, "creation_date": 1568751945, "post_id": 57981481, "comment_id": 102372308, "body": "May or may not containing some keys is a feature of JSON; to Adrian&#39;s point, it&#39;s not unstructured. If it was unpredictable, that would prove more challenging; So is there any kind of data contract, or are you expecting to take in just random stuff and parse it?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11471017"}, "edited": false, "score": 0, "creation_date": 1568752137, "post_id": 57981481, "comment_id": 102372390, "body": "I&#39;m mainly needing the records object so I can iterate over it. I can unpack responseData[&quot;records&quot;] to the point I can iterate over it but every attempt to assert that into one of my structs fails with various errors. Also I left out the struct tags just for simplicity."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568752402, "post_id": 57981481, "comment_id": 102372490, "body": "What are you unmarshaling the overall document into? You&#39;ve only shown type definitions for a child field of a child field. Based on your comment it seems like you&#39;re unmarshaling into a map, in which case no, you can&#39;t assert that to any struct type; it will be unmarshaled <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">according to the documentation</a>, i.e. using only built-in types."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568752511, "post_id": 57981481, "comment_id": 102372523, "body": "Note that it&#39;s not unusual at all to define a type which only includes the fields you care about; any fields in the JSON that do not appear in the struct will just be ignored. So if the fields you need are well-defined and predictable (i.e. always have the same keys and types), there&#39;s no real trick to it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1568753106, "post_id": 57981481, "comment_id": 102372763, "body": "Change <code>Site</code> and <code>Somevar2</code> to <code>map[string]interface{}</code> or to a proper struct, because their corresponding json contains ints, so when you use only <code>map[string]string</code> it will fail. Other than that your code works <a href=\"https://play.golang.com/p/rTgaXhXD1V6\" rel=\"nofollow noreferrer\">play.golang.com/p/rTgaXhXD1V6</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11471017"}, "edited": false, "score": 0, "creation_date": 1568753139, "post_id": 57981481, "comment_id": 102372788, "body": "I added my code."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1568781669, "creation_date": 1568781669, "answer_id": 57985206, "question_id": 57981481, "link": "https://stackoverflow.com/questions/57981481/umarshalling-large-unstructured-rest-json-response/57985206#57985206", "title": "Umarshalling large unstructured REST/JSON Response", "body": "<p>Change the <code>Site</code> and <code>Somevar2</code> fields to <code>map[string]interface{}</code> or to a proper struct, because their corresponding json contains ints, so when you use only <code>map[string]string</code> it will fail.</p>\n\n<p>Other than that your code works <a href=\"https://play.golang.com/p/rTgaXhXD1V6\" rel=\"nofollow noreferrer\">https://play.golang.com/p/rTgaXhXD1V6</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11471017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568781669, "creation_date": 1568751323, "last_edit_date": 1568752917, "question_id": 57981481, "link": "https://stackoverflow.com/questions/57981481/umarshalling-large-unstructured-rest-json-response", "title": "Umarshalling large unstructured REST/JSON Response", "body": "<p>I'm having a heck of a time figuring out how to unmarshal a large unstructured json response into a usable object.</p>\n\n<p>Here is a sample response (trimmed to show the part I'm having trouble with)</p>\n\n<p>This has been <em>greatly</em> trimmed as this is a very large json response. I left the struct tags off below as well for simplicity.</p>\n\n<pre><code>{\n    \"responseStatus\": \"ok\",\n    \"responseHeader\": {\n        \"status\": \"ok\",\n        \"requestId\": \"blah\"\n    },\n    \"responseData\": {\n        \"records\": [\n            {\n                \"name\": \"blah\",\n                \"site\": {\n                    \"id\": 1,\n                    \"name\": \"west\"\n                },\n                \"somevar1\": \"someval\",\n                \"somevar2\": {\n                    \"x\": 2,\n                    \"y\": 1\n                },\n                \"entries\": [\n                    {\n                        \"model\": \"100\",\n                    },\n                    {\n                        \"model\": \"200\",\n                    }\n                ]\n            },\n      ]\n}\n</code></pre>\n\n<p>So records is a large list of \"objects\". I need to convert these to a type I defined. The \"entries\" list also needs to be converted to its object type.</p>\n\n<pre><code>type Record struct {\n    Name         string\n    Site         map[string]string\n    Somevar1     string\n    Somevar2     map[string]string\n    Entries      []Entry\n}\n\ntype Entry struct {\n    Model       string\n\n}\n</code></pre>\n\n<p>Here I can get the responseData into an object I can iterate over:</p>\n\n<pre><code>results := data[\"responseData\"].(map[string]interface{})\ndevices := results[\"records\"].([]interface{})\n\nfor _, device := range devices {\n    fmt.Fprintf(os.Stdout, \"%T\\n\", device)\n    fmt.Fprintf(os.Stdout, \"%+v\\n\", device)\n}\n</code></pre>\n\n<p>Here is a sample output from 1 iteration:</p>\n\n<pre><code>map[string]interface {}\nmap[name:foo site:map[id:2 name:somewhere somevar1: blah somevar2:map[x:1 y:2] entries:[map[model:100]  map[model:200]\n</code></pre>\n\n<p>This is where I'm stuck. I need to take this line above and get convert it into my type Record while also converting the Entries to []Entry.</p>\n"}, {"tags": ["http", "go", "dockerhub"], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1568751409, "post_id": 57981288, "comment_id": 102372098, "body": "Sorry, I forgot to put the method back on patch because of all the testing. Same issue"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1568751966, "post_id": 57981288, "comment_id": 102372317, "body": "You might try setting to Content-Length as well."}, {"owner": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1568927692, "post_id": 57981288, "comment_id": 102441514, "body": "I have set the Content-Length, but it remains the same behavior. <a href=\"https://git.cryptic.systems/volker.raschek/dhd/src/branch/master/pkg/hub/hub.go#L126\" rel=\"nofollow noreferrer\">git.cryptic.systems/volker.raschek/dhd/src/branch/master/pkg&zwnj;&#8203;/&hellip;</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1568931209, "post_id": 57981288, "comment_id": 102442410, "body": "If I was troubleshooting this, I&#39;d printf the request, figure out how curl writes the request (would curl -v help?), and try to see if there&#39;s a mismatch."}, {"owner": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1569321158, "post_id": 57981288, "comment_id": 102551110, "body": "It seems to be the content encoding. However, I don&#39;t know how to remove the encoding that golang automatically adds - diff: <a href=\"https://www.diffchecker.com/XcRRgtnM\" rel=\"nofollow noreferrer\">diffchecker.com/XcRRgtnM</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "edited": false, "score": 0, "creation_date": 1569436591, "post_id": 57981288, "comment_id": 102600268, "body": "It appears like default transport adds that. You might want to try the request with a client that has a <code>Transport</code> with <code>DisableCompression</code> set to true."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1568750452, "creation_date": 1568750452, "answer_id": 57981288, "question_id": 57981247, "link": "https://stackoverflow.com/questions/57981247/http-patch-request-with-urlencoded-body/57981288#57981288", "title": "http patch request with urlencoded body", "body": "<p>The curl request you mentioned is using a Patch request, you're using a Post request. Try http.MethodPatch instead.</p>\n"}], "owner": {"reputation": 377, "user_id": 7652996, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ItnHH.png?s=128&g=1", "display_name": "Volker Raschek", "link": "https://stackoverflow.com/users/7652996/volker-raschek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568792176, "creation_date": 1568750227, "last_edit_date": 1568792176, "question_id": 57981247, "link": "https://stackoverflow.com/questions/57981247/http-patch-request-with-urlencoded-body", "title": "http patch request with urlencoded body", "body": "<p>I would like to update my repository to docker hub via the provided API. I wrote a small program in Go that reads the content of a README.md file and sets the content as a description of the repository. </p>\n\n<p>The program queries a JWT token using the login credentials of the given parms. The JWT token is then attached to the patch request for authentication. For the HTTP patch request I get the status code 200, but the description of the repository is not updated.</p>\n\n<p>Here is an excerpt of the function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>data := url.Values{}\ndata.Set(\"full_description\", repository.FullDescription)\n\nreq, err := http.NewRequest(http.MethodPatch, patchURL.String(), strings.NewReader(data.Encode()))\nif err != nil {\n  return nil, fmt.Errorf(\"Can not create request to update readme: %v\", err)\n}\nreq.Header.Add(\"Authorization\", fmt.Sprintf(\"JWT %v\", token.Token))\nreq.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n\n<p>The complete function is provided on my <a href=\"https://git.cryptic.systems/volker.raschek/dhd/src/branch/master/pkg/hub/hub.go#L98\" rel=\"nofollow noreferrer\">repository</a>.</p>\n\n<p>After some time of searching I found a similar project that sends the request via curl. The flag --urlencode of curl is used. Without this flag the description will not be updated. </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># Send a PATCH request to update the description of the repository\necho \"Sending PATCH request\"\nREPO_URL=\"https://hub.docker.com/v2/repositories/${DOCKERHUB_REPOSITORY}/\"\nRESPONSE_CODE=$(curl -s --write-out %{response_code} --output /dev/null -H \"Authorization: JWT ${TOKEN}\" -X PATCH --data-urlencode full_description@${README_FILEPATH} ${REPO_URL})\necho \"Received response code: $RESPONSE_CODE\"\n</code></pre>\n\n<p>The complete source code of the project is hosted on <a href=\"https://github.com/peter-evans/dockerhub-description/blob/master/entrypoint.sh\" rel=\"nofollow noreferrer\">github</a></p>\n\n<p>Now I ask myself the question, how do I encode the content of the request so that the patch request is successfully accepted by the API?</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568749586, "post_id": 57980991, "comment_id": 102371365, "body": "The code should work as written. What problem did you encounter?"}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568749797, "post_id": 57980991, "comment_id": 102371461, "body": "I am trying to understand how <code>userRole</code> from datastore, will be mapped to <code>UserType</code>? Unfortunately, i don&#39;t have anything setup locally and only option is to run in prod which i can&#39;t do."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568750132, "post_id": 57980991, "comment_id": 102371603, "body": "The datastore package encodes and decodes types with <a href=\"https://godoc.org/reflect#Kind.String\" rel=\"nofollow noreferrer\">kind string</a> as datastore strings.   The underlying string value is transferred do and from the datastore with no translation."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568750599, "post_id": 57980991, "comment_id": 102371784, "body": "Run <a href=\"https://play.golang.org/p/MRN-jKt-HrI\" rel=\"nofollow noreferrer\">play.golang.org/p/MRN-jKt-HrI</a> to observe how the datastore codec handles fields with type <code>UserType</code> ."}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568752327, "post_id": 57980991, "comment_id": 102372458, "body": "So I can just test datastore on golang playground. Nice. This is what I wanted. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1568749805, "creation_date": 1568749805, "answer_id": 57981161, "question_id": 57980991, "link": "https://stackoverflow.com/questions/57980991/how-to-read-custom-types-from-datastore/57981161#57981161", "title": "How to read custom types from datastore", "body": "<p>What you're essentially doing with UserType is that you have two valid values, and you're mapping all other values to a common unknown value. The following should work:</p>\n\n<pre><code>for i, key := range keys {\n        userDetails[i].NameID = key.Name\n        userDetails[i].UserRole = UserTypeFromString( string(userDetails[i].UserRole))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "is_accepted": false, "score": 0, "last_activity_date": 1568762167, "creation_date": 1568762167, "answer_id": 57983091, "question_id": 57980991, "link": "https://stackoverflow.com/questions/57980991/how-to-read-custom-types-from-datastore/57983091#57983091", "title": "How to read custom types from datastore", "body": "<p>If you make your struct implement PropertyLoadSaver interface </p>\n\n<p><a href=\"https://godoc.org/cloud.google.com/go/datastore#hdr-The_PropertyLoadSaver_Interface\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/datastore#hdr-The_PropertyLoadSaver_Interface</a></p>\n\n<p>then you can handle these special requirements. You wouldn't have to remember to post process with every get/query.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 12083373, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/475512176e94c33b3d6c165e5d2eba68?s=128&d=identicon&r=PG", "display_name": "Brandon Jones", "link": "https://stackoverflow.com/users/12083373/brandon-jones"}, "is_accepted": false, "score": 1, "last_activity_date": 1568789483, "creation_date": 1568789483, "answer_id": 57986655, "question_id": 57980991, "link": "https://stackoverflow.com/questions/57980991/how-to-read-custom-types-from-datastore/57986655#57986655", "title": "How to read custom types from datastore", "body": "<p>The code in the question works as is. There's no need to implement PropertyLoadSaver or loop over returned entities as suggested in other answers.</p>\n\n<p>The custom data type is a string. The datastore package marshals all string types to and from datastore strings.  It just works.</p>\n"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1568789483, "creation_date": 1568749062, "question_id": 57980991, "link": "https://stackoverflow.com/questions/57980991/how-to-read-custom-types-from-datastore", "title": "How to read custom types from datastore", "body": "<p>I have a datastore table, which is like that</p>\n\n<pre><code>Name/ID  |  UserEmail  |  UserRole  |  UserPermissions \n------------------------------------------------------\n</code></pre>\n\n<p>The <code>UserRole</code> attribute in json is a <code>string</code>. However, in <code>Go</code> code, it's a type</p>\n\n<pre><code>type UserDetails struct {\n    NameID string\n    UserEmail string\n    UserRole UserType\n    UserPermissions string //json??\n}\n\ntype UserType string\n\nconst (\n    UnknownUserRole UserType = \"UNKNOWN\"\n    SiteAdmin       UserType = \"SITE_ADMIN\"\n    SiteHR UserType = \"SITE_HR\"\n)\n\nfunc (ut *UserType) String() string {\n    return string(*ut)\n}\n\nfunc UserTypeFromString(userType string) UserType {\n    switch userType {\n    case \"SITE_ADMIN\":\n        return SiteAdmin\n    case \"SITE_HR\":\n        return SiteHR\n    default:\n        return UnknownRole\n    }\n}\n</code></pre>\n\n<p>Now, I have to read <em>all</em> users for given <code>org</code>. I am using this code to do so</p>\n\n<pre><code>func (c DataStoreClient) GetUserDetailsByOrg(ctx context.Context, orgName string) ([]*UserDetails, error) {\n    var userDetails []*UserDetails\n    q := datastore.NewQuery(userDetailsKind).\n        Namespace(orgName)\n    keys, err := c.client.GetAll(ctx, q, &amp;userDetails)\n    for i, key := range keys {\n        userDetails[i].NameID = key.Name\n    }\n    return userDetails, err\n}\n</code></pre>\n\n<p>How can i read <code>UserType</code> from datastore using above code into <code>UserDetails.UserType</code> enum? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1610320648, "last_edit_date": 1610320648, "creation_date": 1610312117, "answer_id": 65658406, "question_id": 57979613, "link": "https://stackoverflow.com/questions/57979613/how-to-elegantly-migrate-from-uses-of-syscall-syscall/65658406#65658406", "title": "How to elegantly migrate from uses of `syscall.Syscall()`?", "body": "<p>I think the correct way to handle this, is to use the <a href=\"//github.com/golang/sys/tree/master/windows/mkwinsyscall\" rel=\"nofollow noreferrer\">mkwinsyscall</a> tool.\nYou can create a Go file like this:</p>\n<pre><code>package main\n//go:generate mkwinsyscall -output zmsi.go msi.go\n//sys MsiOpenDatabase(dbPath string, persist int, db *windows.Handle) (e error) = msi.MsiOpenDatabaseW\n</code></pre>\n<p>Then run <code>go generate</code>, and you get a result file like this (some parts removed\nfor brevity):</p>\n<pre><code>func MsiOpenDatabase(dbPath string, persist int, db *windows.Handle) (e error) {\n    var _p0 *uint16\n    _p0, e = syscall.UTF16PtrFromString(dbPath)\n    if e != nil {\n        return\n    }\n    return _MsiOpenDatabase(_p0, persist, db)\n}\n\nfunc _MsiOpenDatabase(dbPath *uint16, persist int, db *windows.Handle) (e error) {\n    r0, _, _ := syscall.Syscall(procMsiOpenDatabaseW.Addr(), 3, uintptr(unsafe.Pointer(dbPath)), uintptr(persist), uintptr(unsafe.Pointer(db)))\n    if r0 != 0 {\n        e = syscall.Errno(r0)\n    }\n    return\n}\n</code></pre>\n<p>As you can see, it automatically takes care of the string conversion, as well\nas the Syscall code, and even the error handling.</p>\n"}], "owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1610320648, "creation_date": 1568742693, "last_edit_date": 1610201262, "question_id": 57979613, "link": "https://stackoverflow.com/questions/57979613/how-to-elegantly-migrate-from-uses-of-syscall-syscall", "title": "How to elegantly migrate from uses of `syscall.Syscall()`?", "body": "<p>The <a href=\"https://golang.org/pkg/syscall/\" rel=\"nofollow noreferrer\"><code>syscall</code></a> package is deprecated. Assume I have the following code which I would like to migrate to something that is not deprecated:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>someGoObject := &amp;struct{int; float32}{5, 45.4}\nsyscall.Syscall6(someProc.Addr(), 1, uintptr(unsafe.Pointer(someGoObject)), 0, 0, 0, 0, 0)\n</code></pre>\n<p>whereby <code>someProc</code> is of type <code>*syscall.LazyProc</code> (<a href=\"https://golang.org/pkg/syscall/?GOOS=windows\" rel=\"nofollow noreferrer\">Windows</a>).</p>\n<p>The <a href=\"https://godoc.org/golang.org/x/sys/\" rel=\"nofollow noreferrer\">sys subrepository</a>, which the <code>syscall</code> docs recommend to use instead, no longer offers a function akin to <code>syscall.Syscall</code>, and if the desired function is not implemented over there, one might attempt to solve the problem the following way, and believe the job is done:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>someProc.Call(uintptr(unsafe.Pointer(someGoObject)))\n</code></pre>\n<p>whereby now <code>someProc</code> is of type <a href=\"https://godoc.org/golang.org/x/sys/windows#LazyProc\" rel=\"nofollow noreferrer\"><code>*windows.LazyProc</code></a>.</p>\n<p>However, if we did this, we would not get one of <code>syscall.Syscall</code>'s (and friends') guarantees, because <code>LazyProc.Call()</code> <a href=\"https://go.googlesource.com/sys/+/77190671981848ff71219ecfff38636c9add3b79/windows/dll_windows.go#346\" rel=\"nofollow noreferrer\">is not implemented in assembly</a>:</p>\n<blockquote>\n<p><strong>(4) Conversion of a Pointer to a uintptr when calling syscall.Syscall.</strong></p>\n<p>The Syscall functions in package syscall pass their uintptr arguments\ndirectly to the operating system, which then may, depending on the\ndetails of the call, reinterpret some of them as pointers. That is,\nthe system call implementation is implicitly converting certain\narguments back from uintptr to pointer.</p>\n<p>If a pointer argument must be converted to uintptr for use as an\nargument, that conversion must appear in the call expression itself:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>syscall.Syscall(SYS_READ, uintptr(fd), uintptr(unsafe.Pointer(p)), uintptr(n))\n</code></pre>\n<p>The compiler handles a Pointer converted to a uintptr in\nthe argument list of a call to a function implemented in assembly by\narranging that the referenced allocated object, if any, is retained\nand not moved until the call completes, even though from the types\nalone it would appear that the object is no longer needed during the\ncall.</p>\n<p>For the compiler to recognize this pattern, the conversion must appear\nin the argument list:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// INVALID: uintptr cannot be stored in variable\n// before implicit conversion back to Pointer during system call.\nu := uintptr(unsafe.Pointer(p))\nsyscall.Syscall(SYS_READ, uintptr(fd), u, uintptr(n))\n</code></pre>\n</blockquote>\n<p>(Taken from <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/unsafe/</a> )</p>\n<p>The way I see it, the only way to be safe is to alloc the memory using C. However, this means we need to copy our data and increases the amount of code which needs to be written by quite a bit.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>someObject := (*struct{int; float32})(C.calloc(1, unsafe.Sizeof(struct{int; float32}{}))) // Alloc\n*someObject = struct{int; float32}{123, 456.789} // Fill with desired data\nsomeProc.Call(uintptr(unsafe.Pointer(someObject))) // The actual call\nC.free(unsafe.Pointer(someObject)) // Clean up\n\n</code></pre>\n<p>Is there a better way?</p>\n"}, {"tags": ["go", "go-get"], "comments": [{"owner": {"reputation": 467, "user_id": 6084322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AbngT.jpg?s=128&g=1", "display_name": "Jeffy Mathew", "link": "https://stackoverflow.com/users/6084322/jeffy-mathew"}, "edited": false, "score": 0, "creation_date": 1568738958, "post_id": 57978688, "comment_id": 102366934, "body": "Which version of go are you using?"}, {"owner": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "reply_to_user": {"reputation": 467, "user_id": 6084322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AbngT.jpg?s=128&g=1", "display_name": "Jeffy Mathew", "link": "https://stackoverflow.com/users/6084322/jeffy-mathew"}, "edited": false, "score": 0, "creation_date": 1568739279, "post_id": 57978688, "comment_id": 102367074, "body": "I have go1.13 darwin/amd64 installed"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568777379, "post_id": 57978688, "comment_id": 102377858, "body": "Just read How to Write Go Code and stick to it. Dead simple."}, {"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1568798567, "post_id": 57978688, "comment_id": 102386154, "body": "packages are managed auto by GOPATH or Gomodule. User only care using <code>go get ...</code> to fullfill gopath or mod."}], "answers": [{"comments": [{"owner": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "edited": false, "score": 0, "creation_date": 1568739624, "post_id": 57978768, "comment_id": 102367210, "body": "Is it common practise to add the installed packages in the git repository?"}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "reply_to_user": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "edited": false, "score": 1, "creation_date": 1568739710, "post_id": 57978768, "comment_id": 102367239, "body": "No. Go get will auto-download dependencies (in theory). If you follow the steps in the first link above, everything works well.  Your dependencies should be fully-qualified, eg. &quot;github.com/user/project&quot;"}, {"owner": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "edited": false, "score": 0, "creation_date": 1568740480, "post_id": 57978768, "comment_id": 102367545, "body": "Do you know why for example open source projects like Kubernetes do not have a src folder in their repository?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1568741271, "post_id": 57978768, "comment_id": 102367910, "body": "@VolatileCoder: You references appear to be obsolete. They do not appear to have been updates for Go modules."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568741389, "post_id": 57978768, "comment_id": 102367955, "body": "Without modules, it <i>is</i> common to store dependencies in the git repository, in the <code>&#47;vendor</code> directory. Although this isn&#39;t required, or always desired."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "edited": false, "score": 1, "creation_date": 1568742803, "post_id": 57978768, "comment_id": 102368568, "body": "@thiloilg the <code>src</code> directory <i>is not your project</i>. It is a workspace containing all your non-module projects and their dependencies. If you&#39;re checking out directly into <code>src</code>, you haven&#39;t read the linked guides. On the other hand, if you are using modules, any downloaded dependencies are in a cache directory, also outside your project directory. Modules also largely obviates the need for vendoring dependencies since it specifies versions and hashes; I personally have not found it at all common to see a vendor directory in a module project."}, {"owner": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568743083, "post_id": 57978768, "comment_id": 102368668, "body": "@Adrian Thanks I understand. I have a mono repo with a couple of node microservices so i can&#39;t use src as my workspace. I guess modules is the way to go then."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568743187, "post_id": 57978768, "comment_id": 102368704, "body": "Sure you can, you just have to put your project in a reasonable place, again according to the linked documentation. <code>src&#47;myscm.co&#47;myproject&#47;mypackage</code> can contain NodeJS code, it will just be ignored."}], "tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1568741297, "last_edit_date": 1568741297, "creation_date": 1568739063, "answer_id": 57978768, "question_id": 57978688, "link": "https://stackoverflow.com/questions/57978688/how-to-organise-your-go-project-in-the-right-way/57978768#57978768", "title": "How to organise your Go project in the right way?", "body": "<p>This sounds like an issue in your workspace.</p>\n\n<p>Your workspace directory should look like this, but your workspace should <strong>not</strong> be the root of your repo. </p>\n\n<pre><code>/bin //&lt;--compiled binaries\n/src\n   /adomain.com/yourstuff //&lt;--these folders are where your repo root should be\n   /gihub.com/otherstuff //&lt;--these folders are your dependencies\n/pkg //&lt;-- installed packages / program files\n</code></pre>\n\n<p>Read the official Go documentation here:</p>\n\n<p><a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n\n<p>A widely-used standard for organizing projects is below: </p>\n\n<p><a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">https://github.com/golang-standards/project-layout</a> </p>\n\n<p>See also: <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html</a></p>\n"}], "owner": {"reputation": 725, "user_id": 6394630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/3HAft.jpg?s=128&g=1", "display_name": "thiloilg", "link": "https://stackoverflow.com/users/6394630/thiloilg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 790, "favorite_count": 0, "accepted_answer_id": 57978768, "answer_count": 1, "score": -2, "last_activity_date": 1568798351, "creation_date": 1568738784, "last_edit_date": 1568741079, "question_id": 57978688, "link": "https://stackoverflow.com/questions/57978688/how-to-organise-your-go-project-in-the-right-way", "title": "How to organise your Go project in the right way?", "body": "<p>I have problems setting up my first go project. I want to keep my packages out of my git repository.</p>\n\n<p><code>go get</code> installs my packages by default in my <code>/src</code> folder. This way I can't simply ignore a folder to ignore all packages.</p>\n\n<p>Can I install all my packages in for example <code>/pkg</code> and how would I do this? Is there a Go way of solving this issue?</p>\n\n<p>In large open source projects written in Go like for example Kubernetes I cannot find a <code>/src</code> directory.</p>\n"}, {"tags": ["go", "dependencies", "vendor"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568735479, "post_id": 57977865, "comment_id": 102365373, "body": "The proper &quot;fix&quot; is to use dep no longer."}, {"owner": {"reputation": 10817, "user_id": 182629, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7113be3430f71d9b089c58c762a494e7?s=128&d=identicon&r=PG", "display_name": "Alex Ciminian", "link": "https://stackoverflow.com/users/182629/alex-ciminian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568735721, "post_id": 57977865, "comment_id": 102365503, "body": "I had to do this while rebasing changes in a fork on a new upstream release - it&#39;s not really under my control."}], "answers": [{"tags": [], "owner": {"reputation": 10817, "user_id": 182629, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7113be3430f71d9b089c58c762a494e7?s=128&d=identicon&r=PG", "display_name": "Alex Ciminian", "link": "https://stackoverflow.com/users/182629/alex-ciminian"}, "is_accepted": true, "score": -1, "last_activity_date": 1568735373, "creation_date": 1568735373, "answer_id": 57977866, "question_id": 57977865, "link": "https://stackoverflow.com/questions/57977865/how-can-i-fix-dep-ensure-error-cannot-stat-file-on-mac/57977866#57977866", "title": "How can I fix dep ensure error &#39;cannot stat file&#39; on Mac?", "body": "<p>There are <a href=\"https://github.com/golang/dep/issues/1625\" rel=\"nofollow noreferrer\">known</a> <a href=\"https://github.com/golang/dep/issues/2024\" rel=\"nofollow noreferrer\">issues</a> with <code>dep</code> 0.5 (latest at this time) which cause the error. There's no fix yet, but you can downgrade to 0.4 to get things working.</p>\n\n<p>You can use the install script in the project repo and specify the desired version through an environment variable.</p>\n\n<pre><code>export DEP_RELEASE_TAG=\"v0.4.1\"\ncurl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\n</code></pre>\n"}], "owner": {"reputation": 10817, "user_id": 182629, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7113be3430f71d9b089c58c762a494e7?s=128&d=identicon&r=PG", "display_name": "Alex Ciminian", "link": "https://stackoverflow.com/users/182629/alex-ciminian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 57977866, "answer_count": 1, "score": -1, "last_activity_date": 1568735373, "creation_date": 1568735373, "question_id": 57977865, "link": "https://stackoverflow.com/questions/57977865/how-can-i-fix-dep-ensure-error-cannot-stat-file-on-mac", "title": "How can I fix dep ensure error &#39;cannot stat file&#39; on Mac?", "body": "<p>When running <code>dep ensure</code> on a large project it fails with the following error:</p>\n\n<pre><code>cannot Stat: stat &lt;project&gt;/vendor/github.com/prometheus/procfs/fixtures/self/fd/0: no such file or directory\n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["dictionary", "go", "post", "struct", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568735682, "post_id": 57977531, "comment_id": 102365487, "body": "Have you tried passing in a map? It seems to me that gin&#39;s json binding is using the std lib&#39;s json decoder, which accepts maps. If you did try but it failed, can you add the error you&#39;ve got back?"}, {"owner": {"reputation": 21, "user_id": 10261950, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EH0mAIu5Asc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNHtTpJrPwMxm3lPQBzC5jLgON97A/mo/photo.jpg?sz=128", "display_name": "Richard Miller", "link": "https://stackoverflow.com/users/10261950/richard-miller"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568831535, "post_id": 57977531, "comment_id": 102403663, "body": "@mkopriva This works!  Thanks.  I hadn&#39;t seen an example of the function working on a map before."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10261950, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EH0mAIu5Asc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNHtTpJrPwMxm3lPQBzC5jLgON97A/mo/photo.jpg?sz=128", "display_name": "Richard Miller", "link": "https://stackoverflow.com/users/10261950/richard-miller"}, "edited": false, "score": 0, "creation_date": 1568832864, "post_id": 57979128, "comment_id": 102404197, "body": "Thanks for the example!  Gin&#39;s bind functionality totally works too.  I didn&#39;t realize Unmarshal would work for maps.  I did have to use a <code>map[string]interface{}</code> since I have ints in the requests, but I can assert their types as I need to."}], "tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": false, "score": 3, "last_activity_date": 1568740612, "creation_date": 1568740612, "answer_id": 57979128, "question_id": 57977531, "link": "https://stackoverflow.com/questions/57977531/how-can-you-bind-a-post-body-to-map/57979128#57979128", "title": "How can you bind a POST body to map?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n\n    strbody:=[]byte(\"{\\\"mic\\\":\\\"check\\\"}\")\n\n    mapbody:=make(map[string]string)\n\n    json.Unmarshal(strbody,&amp;mapbody)\n\n    fmt.Println(fmt.Sprint(\"Is this thing on? \", mapbody[\"mic\"]))\n\n}    \n//returns Is this thing on? check\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ydLuLsY8qla\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ydLuLsY8qla</a></p>\n"}], "owner": {"reputation": 21, "user_id": 10261950, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EH0mAIu5Asc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNHtTpJrPwMxm3lPQBzC5jLgON97A/mo/photo.jpg?sz=128", "display_name": "Richard Miller", "link": "https://stackoverflow.com/users/10261950/richard-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2969, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1605551834, "creation_date": 1568734038, "last_edit_date": 1597430995, "question_id": 57977531, "link": "https://stackoverflow.com/questions/57977531/how-can-you-bind-a-post-body-to-map", "title": "How can you bind a POST body to map?", "body": "<p>I've been using Gin's ShouldBind() method to bind form data to a struct:</p>\n\n<pre><code>type UpdateUserInfoContext struct {\n    Country   string `json:\"country\"`\n    EmailAddr string `json:\"emailAddr\"`\n    LoginID   string `json:\"loginID\"`\n    UserName  string `json:\"username\"`\n}\n\nfunc (h *handler) updateUserInfo(ctx *gin.Context) {\n\n    var json UpdateUserInfoContext\n\n    if err := ctx.ShouldBind(&amp;json); err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n        return\n    }\n\n    h.service.UpdateUserPassword(json)\n\n    ctx.JSON(http.StatusOK, \"success\")\n\n}\n</code></pre>\n\n<p>But now I need to build a large, dynamic UPDATE SQL based on what is and isn't present in the body of a POST request. Since ShouldBind() binds to a struct I can't iterate over the values in the body without using reflection.  I figured an easier way would be to see if there's a method to bind the requests to a map instead of a struct.  There is the context method <code>PostFormMap(key string)</code>, however as far as I can tell from the example given here (<a href=\"https://github.com/gin-gonic/gin#another-example-query--post-form\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#another-example-query--post-form</a>), this method requires the values correspond to to the argument key in the request body.  Does anyone have any experience doing this?  Thank you!</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568732651, "post_id": 57977119, "comment_id": 102363873, "body": "Every BSON document in MongoDB is, at its root, a BSON object (equivalent to a JSON object); it cannot possibly be a string. Take a look at your data - are you trying to extract a string <i>field</i> from the documents maybe?"}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568733279, "post_id": 57977119, "comment_id": 102364216, "body": "@Adrian Want to store the resulting json as a text in a slice"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568733741, "post_id": 57977119, "comment_id": 102364466, "body": "You can&#39;t, because Mongo doesn&#39;t return JSON. It returns BSON. You&#39;d need to unmarshal the BSON into memory and then marshal that back into JSON. Can you maybe offer up any details or context on what you&#39;re actually trying to accomplish?"}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568733796, "post_id": 57977119, "comment_id": 102364490, "body": "The thing is I dont know what type of json structure I would be getting from mongo which is why, I want to store the json in a slice of strings?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568734155, "post_id": 57977119, "comment_id": 102364694, "body": "OK, but the thing still is MongoDB <b>does not operate in JSON, it operates in BSON, which is a binary format, not a text format</b>."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1568743522, "post_id": 57977119, "comment_id": 102368830, "body": "Time for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1568733310, "post_id": 57977244, "comment_id": 102364237, "body": "What type is  <code>Field</code> here? Is it a string?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1568733466, "post_id": 57977244, "comment_id": 102364317, "body": "<code>string</code>, I guess, that&#39;s what you&#39;re trying to retrieve. I edited the answer."}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1568733558, "post_id": 57977244, "comment_id": 102364363, "body": "The thing is I dont know what type of json structure I would be getting from mongo which is why, I want to store the json in a slice of strings? The above answer will just have empty strings in the slice I think"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1568733985, "post_id": 57977244, "comment_id": 102364594, "body": "I edited the answer. That should give you a JSON string for the result set. If you want to store in an array of strings, you can iterate through <code>a</code> array and unmarshal each."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1568733922, "last_edit_date": 1568733922, "creation_date": 1568732993, "answer_id": 57977244, "question_id": 57977119, "link": "https://stackoverflow.com/questions/57977119/get-a-slice-of-json-string-from-mongo-using-golang/57977244#57977244", "title": "Get a slice of json string from mongo using golang", "body": "<p>When you select all but <code>_id</code>, the return will be a document containing only the remaining fields. You can do:</p>\n\n<pre><code>type fieldDoc struct {\n  Field string `bson:\"name\"`\n}\nvar a []fieldDoc\nerr := col.Find(nil).Select(bson.M{\"_id\": 0}).All(&amp;a)\n</code></pre>\n\n<p>If you don't know the underlying structure:</p>\n\n<pre><code>var a []bson.M\nerr := col.Find(nil).Select(bson.M{\"_id\": 0}).All(&amp;a)\n</code></pre>\n\n<p>That should give you the documents encoded as bson objects. That is a map[string]interface{}, so you <em>should</em> be able to marshal it to JSON if you want json output:</p>\n\n<pre><code>jsonDocs, err:=json.Marshal(a)\n</code></pre>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "accepted_answer_id": 57977244, "answer_count": 1, "score": -2, "last_activity_date": 1568733922, "creation_date": 1568732545, "question_id": 57977119, "link": "https://stackoverflow.com/questions/57977119/get-a-slice-of-json-string-from-mongo-using-golang", "title": "Get a slice of json string from mongo using golang", "body": "<p>I am trying to get a slice of json text from mongo using the below code in golang </p>\n\n<pre><code>var a []string\nerr := col..Find(nil).Select(bson.M{\"_id\": 0}).All(&amp;a)\n</code></pre>\n\n<p>I get the error <code>Unsupported document type for unmarshalling: string</code></p>\n\n<p><strong>May I know the right way to do this?</strong></p>\n"}, {"tags": ["go", "input", "buffer", "user-input"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1568732869, "creation_date": 1568732869, "answer_id": 57977205, "question_id": 57977094, "link": "https://stackoverflow.com/questions/57977094/problem-while-taking-user-input-via-fmt-scanln-in-golang/57977205#57977205", "title": "Problem while taking user input via fmt.Scanln() in golang", "body": "<p>This is wrong:</p>\n\n<pre><code>    fmt.Println(\"Rollno: \" + string(i) + a.Grades[i].Rollno)\n</code></pre>\n\n<p>Instead, use</p>\n\n<pre><code>    fmt.Println(\"Rollno: \" + strconv.Itoa(i) + a.Grades[i].Rollno)\n</code></pre>\n\n<p>Or, better:</p>\n\n<pre><code>    fmt.Printf(\"Rollno: %d %s\\n\",i a.Grades[i].Rollno)\n</code></pre>\n"}], "owner": {"reputation": 38, "user_id": 9036766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1982858405320546/picture?type=large", "display_name": "Muhammad Rehan Javed", "link": "https://stackoverflow.com/users/9036766/muhammad-rehan-javed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1568906687, "creation_date": 1568732442, "last_edit_date": 1568906687, "question_id": 57977094, "link": "https://stackoverflow.com/questions/57977094/problem-while-taking-user-input-via-fmt-scanln-in-golang", "title": "Problem while taking user input via fmt.Scanln() in golang", "body": "<p>I m trying to take an input from the user through my console in <strong>golang</strong> by using <strong>fmt.Scanln()</strong>. It is working fine under normal circumstances. However, whenever I take input in a loop, the inputs are correct in the first iteration but during the <strong>next iterations</strong> of a loop, an <strong>extra smiley</strong> is added in the front of the received string. I don't know what the problem is. Will be very thankful if anyone proposes some solution.</p>\n\n<pre><code>func (a *Block) fillBlock() {\nfmt.Println(\"Block Details:\")\nfmt.Print(\"Enter Block Name: \")\nfmt.Scanln(&amp;a.Data)\n\nfor i := 0; i &lt; Students; i++ {\n    fmt.Print(i, \"Enter Student Roll# \")\n    fmt.Scanln(&amp;a.Grades[i].Rollno)\n    fmt.Print(i, \"Enter Student Grade# \")\n    fmt.Scanln(&amp;a.Grades[i].Grade)\n}\n\nfmt.Println(\"\\nInput Data:\")\n\nfmt.Println(\"Data: \",a.Data)\n\n// Iterating over each student\nfor i := 0; i &lt; Students &amp;&amp; (a.Grades[i].Rollno != \"\" &amp;&amp; a.Grades[i].Grade != \"\"); i++ {\n    fmt.Println(\"Rollno: \" + string(i) + a.Grades[i].Rollno)\n    fmt.Println(\"Grade: \" + string(i) + a.Grades[i].Grade)\n}\n</code></pre>\n\n<p>}</p>\n\n<p><a href=\"https://i.stack.imgur.com/xgpGk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xgpGk.png\" alt=\"Output\"></a></p>\n"}, {"tags": ["reactjs", "postgresql", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568730683, "post_id": 57976477, "comment_id": 102362712, "body": "Is the directory really &quot;.client&quot;? <code>http.Dir(&quot;.client&#47;&quot;)</code> Or is it  client <code>http.Dir(&quot;.&#47;client&quot;)</code>"}, {"owner": {"reputation": 1, "user_id": 12080104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f2aac80da609445268caec8192da853?s=128&d=identicon&r=PG&f=1", "display_name": "codexpert", "link": "https://stackoverflow.com/users/12080104/codexpert"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568731041, "post_id": 57976477, "comment_id": 102362920, "body": "If i would direct to App.js, shouldn&#39;t it be &quot;client/&quot;? Anyways I am really new to reactjs and go, so I don&#39;t really know whether that&#39;s the way to connect to my .js file"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568731229, "post_id": 57976477, "comment_id": 102363030, "body": "If you&#39;re trying to serve the App.js from appName directory, then http.Dir should be either &quot;client&quot; or &quot;./client&quot;, not &quot;.client&quot;, and you should load it as /client/src/App.js. Also for the pathPrefix, I think it should be &quot;/client&quot;, but I&#39;m not so sure about that."}, {"owner": {"reputation": 1, "user_id": 12080104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f2aac80da609445268caec8192da853?s=128&d=identicon&r=PG&f=1", "display_name": "codexpert", "link": "https://stackoverflow.com/users/12080104/codexpert"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568731382, "post_id": 57976477, "comment_id": 102363091, "body": "thanks for the info. I&#39;ve tried but it still doesn&#39;t work."}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "edited": false, "score": 0, "creation_date": 1568732531, "post_id": 57976477, "comment_id": 102363785, "body": "What are you requesting? It should be localhost:3030/src/App.js ; (I&#39;m wondering if you&#39;re requesting localhost:3030/App.js...)"}, {"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1568732798, "post_id": 57976477, "comment_id": 102363956, "body": "looks like it should actually be <code>localhost:3000&#47;client&#47;src&#47;App.js</code>, however you should know that this won&#39;t execute your javascript but instead write it to the response so you&#39;ll just recieve a JS file as plaintext and I do not think that&#39;s what you want? If you&#39;re trying to render a react component you should serve an HTML page with your js included. If you really do want to serve a plaintext JS file then I have this working using <code>http.NewServeMux</code> and can share that code with you"}], "owner": {"reputation": 1, "user_id": 12080104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f2aac80da609445268caec8192da853?s=128&d=identicon&r=PG&f=1", "display_name": "codexpert", "link": "https://stackoverflow.com/users/12080104/codexpert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568734751, "creation_date": 1568730487, "last_edit_date": 1568734751, "question_id": 57976477, "link": "https://stackoverflow.com/questions/57976477/connect-reactjs-file-in-main-go", "title": "Connect ReactJS file in Main.go", "body": "<p>I am trying to develop a web application with ReactJS and a Go server. The web app works when I connect ReactJS file with Node.js, but it shows an error on the output when I connect ReactJS file with the Go server.</p>\n\n<p>output: </p>\n\n<blockquote>\n  <p>\"404 page not found\"</p>\n</blockquote>\n\n<p>main.go: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n)\n\nvar items = []*Item{}\n\n// Item representing the todo\ntype Item struct {\n    ID   string `json:\"item_id\"`\n    Name string `json:\"item_name\"`\n}\n\nfunc main() {\n    //r := http.NewServeMux()\n     r := mux.NewRouter()\n\n    r.PathPrefix(\"client/\").Handler(http.StripPrefix(\"client/\", http.FileServer(http.Dir(\".client/\"))))\n    r.HandleFunc(\"/api/new-item\", addItemHandler)\n    fmt.Println(\"Running server on port :3000\")\n    http.ListenAndServe(\":3000\", r)\n}\n\nfunc addItemHandler(w http.ResponseWriter, r *http.Request) {\n    item := &amp;Item{}\n    json.NewDecoder(r.Body).Decode(item)\n    items = append(items, item)\n}\n</code></pre>\n\n<p>my file structure:</p>\n\n<pre><code>appName/main.go\nappName/client/src/App.js\n</code></pre>\n\n<p>I would like the web app to load <code>App.js</code> when I run <code>main.go</code></p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go", "channel", "goland"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1568727914, "post_id": 57975613, "comment_id": 102360952, "body": "You have 2 concurrent goroutines, one (the <code>main</code>) is receiving values from the channel, so whatever you &quot;put&quot; in that channel may be out of it immediately. There&#39;s some &quot;time&quot; between sending on your channel and getting its length. During this time it&#39;s not guaranteed that the channel is not touched."}, {"owner": {"reputation": 319, "user_id": 1763395, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/5b42ae5aa6f2b4a98f890b38a837d7f8?s=128&d=identicon&r=PG", "display_name": "Dimitry", "link": "https://stackoverflow.com/users/1763395/dimitry"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1568728128, "post_id": 57975613, "comment_id": 102361113, "body": "Shouldn&#39;t the write goroutine be active until buffered channel is full?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1568728201, "post_id": 57975613, "comment_id": 102361160, "body": "No. They&#39;re running <i>concurrently</i>. You should assume, conceptually, that they are both active at the same time - that&#39;s the definition of &quot;concurrent&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 3975328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6b08acb47d5ffc39deb8596aa336653?s=128&d=identicon&r=PG&f=1", "display_name": "Shivam Pradhan", "link": "https://stackoverflow.com/users/3975328/shivam-pradhan"}, "is_accepted": true, "score": 2, "last_activity_date": 1568795394, "last_edit_date": 1592644375, "creation_date": 1568795394, "answer_id": 57988320, "question_id": 57975613, "link": "https://stackoverflow.com/questions/57975613/length-of-channel-is-zero-after-adding-element/57988320#57988320", "title": "Length of channel is zero after adding element", "body": "<p>As per the concept of GO buffer, you can push elements in channels as per defined buffer size (in your case it is 2). But at the time an element is pushed into channel, same is being read by the main GO routine which leads to a decrease in the size of channel to zero. So, if you put some time.Sleep before your read statement you will get the expected result.</p>\n<p>`</p>\n<pre><code>package main\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n)\n\nfunc write(ch chan int) {\n    for i := 1; i &lt;= 5; i++ {\n        ch &lt;- i\n        fmt.Printf(&quot;Channel's length is %d\\n&quot;, len(ch))\n    }\n    close(ch)\n}\nfunc main() {\n    ch := make(chan int, 2)\n    go write(ch)\n    time.Sleep(2*time.Second)\n    for v := range ch {\n        fmt.Println(v)\n        time.Sleep(2*time.Second)\n    }\n}`\n</code></pre>\n<p><strong>Output</strong> for the above code is:</p>\n<blockquote>\n<p>Channel's length is 1</p>\n<p>Channel's length is 2</p>\n<p>1</p>\n<p>Channel's length is 2</p>\n<p>2</p>\n<p>Channel's length is 2</p>\n<p>3</p>\n<p>Channel's length is 2</p>\n<p>4</p>\n<p>5</p>\n</blockquote>\n"}], "owner": {"reputation": 319, "user_id": 1763395, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/5b42ae5aa6f2b4a98f890b38a837d7f8?s=128&d=identicon&r=PG", "display_name": "Dimitry", "link": "https://stackoverflow.com/users/1763395/dimitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 57988320, "answer_count": 1, "score": -3, "last_activity_date": 1568795394, "creation_date": 1568727797, "last_edit_date": 1568737982, "question_id": 57975613, "link": "https://stackoverflow.com/questions/57975613/length-of-channel-is-zero-after-adding-element", "title": "Length of channel is zero after adding element", "body": "<p>I learn buffered channels in Go and some magic is hidden from me.\nI have this code </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc write(ch chan int) {\n    for i := 1; i &lt;= 5; i++ {\n        ch &lt;- i\n        fmt.Printf(\"Channel's length is %d\\n\", len(ch))\n    }\n    close(ch)\n}\nfunc main() {\n    ch := make(chan int, 2)\n    go write(ch)\n\n    for v := range ch {\n        fmt.Println(v)\n    }\n}\n</code></pre>\n\n<p>The output is </p>\n\n<pre><code>Channel's length is 0\nChannel's length is 1\nChannel's length is 2\n1\n2\n3\n4\nChannel's length is 2\nChannel's length is 0\n5\n</code></pre>\n\n<p>Why is the channel's length on the first iteration in write goroutine is zero? What do I don't know?</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 1, "creation_date": 1568727145, "post_id": 57975344, "comment_id": 102360446, "body": "You can use regular expressions in mux routing: <code>s.HandleFunc(&quot;&#47;articles&#47;{category}&#47;{id:[0-9]+}&quot;, ArticleHandler)</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1568727234, "post_id": 57975344, "comment_id": 102360496, "body": "If this is gorilla/mux, you can use a subrouter: <code>userRouter:=r.Path(&quot;&#47;user&quot;).Subrouter()</code>"}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1568727272, "post_id": 57975344, "comment_id": 102360520, "body": "It is. It is. <code>gorilla&#47;mux</code> Thank you!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568727652, "post_id": 57975344, "comment_id": 102360774, "body": "If it were <code>net&#47;http</code>, then  exactly the code you posted would work exactly like intended. The stdlib router treats routs with a trailing slash as prefix handlers."}], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1568727765, "post_id": 57975574, "comment_id": 102360869, "body": "So how will I know about which is it? It&#39;s <code>signup</code> or &#39;signin&#39; inside <code>makeUserHandler</code>?"}, {"owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1568800046, "post_id": 57975574, "comment_id": 102387040, "body": "When prefix path is matched in main.go it will forward it to the makeUserHandler router. From there that router will match its path i.e. &quot;/signup&quot; or &quot;/signin&quot; and call the  appropriate handler i.e. signupHandler or signinHandler."}], "tags": [], "owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "is_accepted": true, "score": 2, "last_activity_date": 1568727671, "creation_date": 1568727671, "answer_id": 57975574, "question_id": 57975344, "link": "https://stackoverflow.com/questions/57975344/how-to-implement-sub-routes/57975574#57975574", "title": "How to implement sub-routes", "body": "<p>There is a PathPrefix function in mux. You can use it to make the path prefix i.e. \"/user\" in this case.</p>\n\n<p>example:- </p>\n\n<p>userHandler.go</p>\n\n<pre><code>func makeUserHandler()http.Handler{\n  //Define all you handlers here\n  r := mux.NewRouter()\n  r.HandleFunc(\"user/signup\", signupHandler).Methods(\"POST\")\n  r.HandleFunc(\"user/signin\", signinHandler).Methods(\"POST\")\n  r.HandleFunc(\"user/profile\", profileHandler).Methods(\"GET\")\n  r.HandleFunc(\"user/cart\", cartHandler).Methods(\"POST\")\n  r.HandleFunc(\"user/products\", productsHandler).Methods(\"GET\")\n  return r\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>r := mux.NewRouter()\nr.PathPrefix(\"/user\").Handler(makeUserHandler())\n</code></pre>\n\n<p>Please make necessary changes to the above code as per your requirement.</p>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 57975574, "answer_count": 1, "score": -2, "last_activity_date": 1568738871, "creation_date": 1568726979, "last_edit_date": 1568738871, "question_id": 57975344, "link": "https://stackoverflow.com/questions/57975344/how-to-implement-sub-routes", "title": "How to implement sub-routes", "body": "<p>I want to achieve routes like</p>\n\n<p><code>user/profile</code></p>\n\n<p><code>user/cart</code></p>\n\n<p><code>user/products</code></p>\n\n<p>Currently, I'm doing this</p>\n\n<pre><code>r.HandleFunc(\"user/signup\", signupHandler).Methods(\"POST\")\nr.HandleFunc(\"user/signin\", signinHandler).Methods(\"POST\")\nr.HandleFunc(\"user/profile\", profileHandler).Methods(\"GET\")\nr.HandleFunc(\"user/cart\", cartHandler).Methods(\"POST\")\nr.HandleFunc(\"user/products\", productsHandler).Methods(\"GET\")\n</code></pre>\n\n<p>As you can see these routes starts with <code>user</code> so can how can I know it's a <code>user</code> routes so I can send handle it in a different file.</p>\n\n<p>I want something like</p>\n\n<pre><code>r.HandleFunc(\"user/\", handlerWhichHandelAllTheRequestFromUser)\n</code></pre>\n\n<p>It should handle all the URL which starts from <code>users</code>.</p>\n\n<p>I'm using mux gorilla</p>\n"}, {"tags": ["json", "go", "nested"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1568727440, "post_id": 57975265, "comment_id": 102360636, "body": "Can you provide some kind of explanation of the issue? Just a pile of sample code is not really enough to understand your question."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1568730093, "post_id": 57975265, "comment_id": 102362353, "body": "There is no function in the standard library that transforms your slice into the data structure you want, and SO isn&#39;t a coding service. You&#39;ll have to write that yourself."}, {"owner": {"reputation": 3, "user_id": 6454289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ec863b4ade367b4c7476e6bdb1cfeb6?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Fariz Hidayat", "link": "https://stackoverflow.com/users/6454289/muhammad-fariz-hidayat"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568735231, "post_id": 57975265, "comment_id": 102365248, "body": "@Adrian I want to nested my value result JSON sir. i was edited my question."}], "answers": [{"tags": [], "owner": {"reputation": 573, "user_id": 9100468, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CmkMNlW2J6k/AAAAAAAAAAI/AAAAAAAAYbA/S66MIb_UIX0/photo.jpg?sz=128", "display_name": "Isaac Weingarten", "link": "https://stackoverflow.com/users/9100468/isaac-weingarten"}, "is_accepted": false, "score": 0, "last_activity_date": 1568750439, "creation_date": 1568750439, "answer_id": 57981283, "question_id": 57975265, "link": "https://stackoverflow.com/questions/57975265/get-value-json-to-create-a-nested-in-golang/57981283#57981283", "title": "Get value JSON to create a nested in golang", "body": "<p>maybe this tool can help you <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON-to-Go - https://mholt.github.io/json-to-go/</a></p>\n\n<pre><code>type AutoGenerated struct {\n    Jumlahdata int `json:\"jumlahdata\"`\n    Result     []struct {\n        QUICKDATAHID string `json:\"QUICK_DATA_H_ID\"`\n        ORDERTRXHID  string `json:\"ORDER_TRX_H_ID\"`\n        QUESTION     []struct {\n            FULLNAME  string `json:\"FULLNAME\"`\n            ALAMATKTP string `json:\"ALAMAT_KTP\"`\n        } `json:\"QUESTION\"`\n        DTMCRT time.Time `json:\"DTM_CRT\"`\n    } `json:\"result\"`\n    Statusdb    int `json:\"statusdb\"`\n    Statusload  int `json:\"statusload\"`\n    Statusquery int `json:\"statusquery\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 599, "user_id": 7207673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CrIYf.png?s=128&g=1", "display_name": "Juan-Kabbali", "link": "https://stackoverflow.com/users/7207673/juan-kabbali"}, "is_accepted": false, "score": 0, "last_activity_date": 1614985070, "creation_date": 1614985070, "answer_id": 66500636, "question_id": 57975265, "link": "https://stackoverflow.com/questions/57975265/get-value-json-to-create-a-nested-in-golang/66500636#66500636", "title": "Get value JSON to create a nested in golang", "body": "<p>For that, personally i love to use <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">gabs</a> module which allows to handle those kind of situation in a more human friendly way.</p>\n<hr />\n<p>For installing the module use:</p>\n<pre><code>go get github.com/Jeffail/gabs/v2\n</code></pre>\n<hr />\n<p>So take your json string and pass it to <code>gabs.ParseJSON</code> as follows</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// jsonParsed var contains a set of functions to play arround\njsonParsed, _ := gabs.ParseJSON([]byte(`{\n    &quot;outter&quot;:{\n        &quot;inner&quot;:{\n            &quot;value1&quot;:10,\n            &quot;value2&quot;:22\n        },\n        &quot;alsoInner&quot;:{\n            &quot;value1&quot;:20,\n            &quot;array1&quot;:[\n                30, 40\n            ]\n        }\n    }\n}`))\n\n// you can check for keys existence\nexists := jsonParsed.Exists(&quot;outter&quot;, &quot;inner&quot;, &quot;value1&quot;)\n// exists == true\n\n// you can pretty print your json\nfmt.Println(jsonObj.StringIndent(&quot;&quot;, &quot;  &quot;))\n\n// you can search for specific values in your inner object\nvalue, ok = jsonParsed.Search(&quot;outter&quot;, &quot;inner&quot;, &quot;value1&quot;).Data().(float64)\n// value == 10.0, ok == true\n\n// and much more ...\n</code></pre>\n<p>Take a look at the <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">documentation</a></p>\n"}], "owner": {"reputation": 3, "user_id": 6454289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ec863b4ade367b4c7476e6bdb1cfeb6?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Fariz Hidayat", "link": "https://stackoverflow.com/users/6454289/muhammad-fariz-hidayat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1614985070, "creation_date": 1568726713, "last_edit_date": 1568734837, "question_id": 57975265, "link": "https://stackoverflow.com/questions/57975265/get-value-json-to-create-a-nested-in-golang", "title": "Get value JSON to create a nested in golang", "body": "<p>I'm trying to create dynamically nested json from value FIELD_QUESTION and FIELD_ANSWER in golang.</p>\n\n<p>my result json</p>\n\n<pre><code>{\n\"jumlahdata\": 2,\n\"result\": [\n    {\n        \"QUICK_DATA_H_ID\": \"1\",\n        \"ORDER_TRX_H_ID\": \"1\",\n        \"FIELD_QUESTION\": \"FULLNAME\",\n        \"FIELD_ANSWER\": \"RUBEN\",\n        \"DTM_CRT\": \"2019-08-28T16:25:15.757Z\"\n    },\n    {\n        \"QUICK_DATA_H_ID\": \"2\",\n        \"ORDER_TRX_H_ID\": \"1\",\n        \"FIELD_QUESTION\": \"ALAMAT_KTP\",\n        \"FIELD_ANSWER\": \"jalandisana\",\n        \"DTM_CRT\": \"2019-08-28T16:25:15.757Z\"\n    }\n],\n\"statusdb\": 200,\n\"statusload\": 200,\n\"statusquery\": 200\n</code></pre>\n\n<p>}</p>\n\n<p>expected result nested</p>\n\n<pre><code>{\n\"jumlahdata\": 1,\n\"result\": [\n    {\n        \"QUICK_DATA_H_ID\": \"1\",\n        \"ORDER_TRX_H_ID\": \"1\",\n        \"QUESTION\":[{\n            \"FULLNAME\": \"RUBEN\",\n            \"ALAMAT_KTP\": \"jalandisana\",\n        }]\n        \"DTM_CRT\": \"2019-08-28T16:25:15.757Z\"\n    }\n],\n\"statusdb\": 200,\n\"statusload\": 200,\n\"statusquery\": 200\n</code></pre>\n\n<p>}</p>\n\n<p>can anyone help with this? Please let me know if I haven't been clear enough!</p>\n"}, {"tags": ["go", "go-pg"], "answers": [{"comments": [{"owner": {"reputation": 305, "user_id": 4035772, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e4ddee25d7e15b235c0cac0869086b20?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/4035772/mahesh-s"}, "edited": false, "score": 1, "creation_date": 1591115186, "post_id": 57973370, "comment_id": 109930630, "body": "I am getting this issue <code>db.AddQueryHook undefined (type *pg.DB has no field or method AddQueryHook)</code>"}], "tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1568721698, "last_edit_date": 1568721698, "creation_date": 1568720000, "answer_id": 57973370, "question_id": 57973171, "link": "https://stackoverflow.com/questions/57973171/convert-go-pg-query-into-plain-sql/57973370#57973370", "title": "convert go-pg query into plain sql", "body": "<p>This is listed in the project's wiki: </p>\n\n<blockquote>\n  <p><a href=\"https://github.com/go-pg/pg/wiki/FAQ#how-can-i-viewlog-queries-this-library-generates\" rel=\"nofollow noreferrer\">How to view queries this library generates?</a></p>\n</blockquote>\n\n<p><strong>How to view queries this library generates?</strong></p>\n\n<p>You can setup query logger like this:</p>\n\n<pre><code>type dbLogger struct { }\n\nfunc (d dbLogger) BeforeQuery(c context.Context, q *pg.QueryEvent) (context.Context, error) {\n    return c, nil\n}\n\nfunc (d dbLogger) AfterQuery(c context.Context, q *pg.QueryEvent) (context.Context, error) {\n    fmt.Println(q.FormattedQuery())\n    return c, nil\n}\n\ndb := pg.Connect(&amp;pg.Options{...})\ndb.AddQueryHook(dbLogger{})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 14327292, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bC2IgsVJgXQ/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuckHoxJSorBgkD65knloCR1xnCaJRg/photo.jpg?sz=128", "display_name": "Arnaud Celermajer", "link": "https://stackoverflow.com/users/14327292/arnaud-celermajer"}, "is_accepted": false, "score": 2, "last_activity_date": 1606829361, "creation_date": 1606829361, "answer_id": 65091397, "question_id": 57973171, "link": "https://stackoverflow.com/questions/57973171/convert-go-pg-query-into-plain-sql/65091397#65091397", "title": "convert go-pg query into plain sql", "body": "<pre><code> //db your *pg.DB\n// q your  *orm.Query = db.Model(&amp;yourModel).\n\n\n\n qq := pg.QueryEvent{\n            DB:        db,\n            Model:     q.TableModel(),\n            Query:     q,\n        }\n fmt.Println(qq.FormattedQuery())\n</code></pre>\n<p>So in your case</p>\n<pre><code>q:= db.Model(story).\n        Relation(&quot;Author&quot;).\n        Where(&quot;story.id = ?&quot;, story1.Id)\nfmt.Println(&quot;running SQL:&quot;)\nqq := pg.QueryEvent{\n                DB:        db,\n                Model:     q.TableModel(),\n                Query:     q,\n            }\nfmt.Println(qq.FormattedQuery()) \nq.Select()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 47, "user_id": 14683725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/513bd8ad1dc04c081a65464f9b168de7?s=128&d=identicon&r=PG&f=1", "display_name": "r1v3n", "link": "https://stackoverflow.com/users/14683725/r1v3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1617107220, "last_edit_date": 1617107220, "creation_date": 1617104583, "answer_id": 66870343, "question_id": 57973171, "link": "https://stackoverflow.com/questions/57973171/convert-go-pg-query-into-plain-sql/66870343#66870343", "title": "convert go-pg query into plain sql", "body": "<h3>Problem: There is no default parsing to RAW sql from ORM since v10.</h3>\n<hr />\n<p>Well, that's too late i guess. Maybe someone (like me) will face this problem in 2021. There is some steps how you could solve this:</p>\n<ul>\n<li>[x] Read DOCs.</li>\n<li>[x] Check all structs.</li>\n<li>[x] Implement all methods.</li>\n</ul>\n<h3>Solving the problem</h3>\n<hr />\n<p>This solve is &quot;forked&quot; from this <a href=\"https://github.com/go-pg/pg/issues/1366\" rel=\"nofollow noreferrer\">issue</a> but i'll explain it step by step.\nFirst of all we need to read some <a href=\"https://github.com/go-pg/pg/blob/v10/hook.go#L46\" rel=\"nofollow noreferrer\">source code</a> of go-pg hook.\nAs I said before: we need to check all structs from this doc. But we're lucky. There is only 1 struct!</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// QueryEvent ...\ntype QueryEvent struct {\n    StartTime  time.Time\n    DB         orm.DB\n    Model      interface{}\n    Query      interface{}\n    Params     []interface{}\n    fmtedQuery []byte\n    Result     Result\n    Err        error\n\n    Stash map[interface{}]interface{}\n}\n</code></pre>\n<p>We don't really need to implement this struct completely.\nBut when you use db.AddQueryHook() (where db is ref on our DB connection and AddQueryHook() is method) AddQueryHook() wait's from you this <strong>interface</strong>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type QueryHook interface {\n    BeforeQuery(context.Context, *QueryEvent) (context.Context, error)\n    AfterQuery(context.Context, *QueryEvent) error\n}\n</code></pre>\n<p>So, we already read DOCs, checked structs. And what's next? Answer is pretty easy:</p>\n<ul>\n<li>Implement all methods.</li>\n</ul>\n<p>TBH, I thought that this is harder than it is.\nTo implement it you just need to create 2 methods of current (new empty) structure that implements functionality of methods above, like this:</p>\n<ol>\n<li>Creating empty structure\n<code>type dbLogger struct{}</code></li>\n<li>Adding methods from doc:</li>\n</ol>\n<pre class=\"lang-golang prettyprint-override\"><code>func (d dbLogger) BeforeQuery(c context.Context, q *pg.QueryEvent) (context.Context, error) {\n    return c, nil\n}\n\nfunc (d dbLogger) AfterQuery(c context.Context, q *pg.QueryEvent) error {\n    fq, _ := q.FormattedQuery()\n    fmt.Println(string(fq))\n    return nil\n}\n</code></pre>\n<hr />\n<p>I hope this helps everyone who ever encounters this problem.</p>\n"}, {"tags": [], "owner": {"reputation": 2902, "user_id": 210594, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/UgxR3.jpg?s=128&g=1", "display_name": "justcompile", "link": "https://stackoverflow.com/users/210594/justcompile"}, "is_accepted": false, "score": 1, "last_activity_date": 1618932833, "creation_date": 1618932833, "answer_id": 67181996, "question_id": 57973171, "link": "https://stackoverflow.com/questions/57973171/convert-go-pg-query-into-plain-sql/67181996#67181996", "title": "convert go-pg query into plain sql", "body": "<p>I've just been upgrading from go-pg v7 to v10 &amp; had a problem where <code>Query.AppendFormat()</code> which is what I was using to get the RAW SQL had been removed.</p>\n<p>After using the comments in this post for inspiration I managed extract it, using the code below</p>\n<pre class=\"lang-golang prettyprint-override\"><code>\nimport (\n    &quot;github.com/go-pg/pg/v10/orm&quot;\n)\n\nfunc QueryToString(q *orm.Query) string {\n    value, _ := q.AppendQuery(orm.NewFormatter(), nil)\n\n    return string(value)\n}\n\n</code></pre>\n<p>Hope this helps future viewers</p>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1276, "favorite_count": 0, "accepted_answer_id": 57973370, "answer_count": 4, "score": 2, "last_activity_date": 1618932833, "creation_date": 1568719217, "question_id": 57973171, "link": "https://stackoverflow.com/questions/57973171/convert-go-pg-query-into-plain-sql", "title": "convert go-pg query into plain sql", "body": "<p>Is it possible to convert <a href=\"https://github.com/go-pg/pg#look--feel\" rel=\"nofollow noreferrer\">go-pg</a> query </p>\n\n<pre><code>err = db.Model(story).\n        Relation(\"Author\").\n        Where(\"story.id = ?\", story1.Id).\n        Select()\n</code></pre>\n\n<p>into plain SQL? </p>\n\n<p>It would be helpful for debugging. So I could copy this plain SQL query and run in psql client as a string.\nProbably there is some kind of package for this?</p>\n"}, {"tags": ["xml", "validation", "go", "xsd", "libxml2"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1568718660, "post_id": 57972627, "comment_id": 102355841, "body": "<a href=\"https://tools.ietf.org/html/rfc3986#section-3.3\" rel=\"nofollow noreferrer\">Square brackets are not allowed in the path component of a URI</a>. Your validator is correct and the solution is to put a valid URI into your document."}], "answers": [{"tags": [], "owner": {"reputation": 198290, "user_id": 1030675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/957956ce51706d03f19a4dc85a767bb1?s=128&d=identicon&r=PG", "display_name": "choroba", "link": "https://stackoverflow.com/users/1030675/choroba"}, "is_accepted": true, "score": 4, "last_activity_date": 1568717726, "creation_date": 1568717726, "answer_id": 57972770, "question_id": 57972627, "link": "https://stackoverflow.com/questions/57972627/libxml2-fails-on-xsd-schema-validation-for-element-type-anyuri-containing-specia/57972770#57972770", "title": "libxml2 fails on xsd schema validation for element type anyURI containing special characters like &quot;[&quot;, &quot;[&quot;", "body": "<p>See <a href=\"https://tools.ietf.org/html/rfc3986\" rel=\"nofollow noreferrer\">RFC3986</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>A host identified by an Internet Protocol literal address, version 6\n     [RFC3513] or later, is distinguished by enclosing the IP literal\n     within square brackets (\"[\" and \"]\").  This is <strong>the only place where\n     square bracket characters are allowed</strong> in the URI syntax.</p>\n</blockquote>\n\n<p>Try replacing them with <code>%5b</code> and <code>%5d</code>, respectively.</p>\n"}], "owner": {"reputation": 5286, "user_id": 253986, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/083d94b9d308bca999a491fe8bc5368f?s=128&d=identicon&r=PG", "display_name": "Achaius", "link": "https://stackoverflow.com/users/253986/achaius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 57972770, "answer_count": 1, "score": 2, "last_activity_date": 1568717726, "creation_date": 1568717201, "question_id": 57972627, "link": "https://stackoverflow.com/questions/57972627/libxml2-fails-on-xsd-schema-validation-for-element-type-anyuri-containing-specia", "title": "libxml2 fails on xsd schema validation for element type anyURI containing special characters like &quot;[&quot;, &quot;[&quot;", "body": "<p>I am using <a href=\"https://github.com/lestrrat/go-libxml2\" rel=\"nofollow noreferrer\">go-libxml2</a> for my xsd schema validation. I have an XML element  which takes url as a value. My xsd also contains its type as anyURI as follows</p>\n\n<pre><code>&lt;xs:element name=\"url\" type=\"xs:anyURI\"&gt; \n</code></pre>\n\n<p>The following code throws error on validation url which contains \"[]\"</p>\n\n<pre><code>xsd.schema.Validate(xml)\n</code></pre>\n\n<p>The following is the sample url which throws an error</p>\n\n<pre><code>&lt;url&gt;\n    &lt;![CDATA[\n        http://example.com/orda/var[div]=super\n    ]]&gt;\n&lt;/url&gt;\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>'http://example.com/orda/var[div]=super is not a valid value of the atomic type 'xs:anyURI'\n</code></pre>\n\n<p>Regular urls are working fine. Any idea how to solve this issue</p>\n"}, {"tags": ["postgresql", "go", "pq"], "comments": [{"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 2, "creation_date": 1568708245, "post_id": 57969889, "comment_id": 102350351, "body": "Must be <code>err := db...</code>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1568709813, "post_id": 57969889, "comment_id": 102351173, "body": "<a href=\"https://tour.golang.org/basics/10\" rel=\"nofollow noreferrer\">tour.golang.org/basics/10</a>"}], "answers": [{"tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": false, "score": 2, "last_activity_date": 1568715853, "creation_date": 1568715853, "answer_id": 57972258, "question_id": 57969889, "link": "https://stackoverflow.com/questions/57969889/err-cannot-be-infered-from-db-queryrow/57972258#57972258", "title": "err cannot be infered from db.QueryRow()", "body": "<p>In checkin, you didn't declare the err variable. </p>\n\n<p>use either: </p>\n\n<pre><code>var err error\n</code></pre>\n\n<p>or the := shorthand</p>\n\n<pre><code>err := db.QueryRow(query, userId, time.Now(), userToken).Scan(&amp;tmpToken)\n</code></pre>\n"}], "owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568715853, "creation_date": 1568707452, "question_id": 57969889, "link": "https://stackoverflow.com/questions/57969889/err-cannot-be-infered-from-db-queryrow", "title": "err cannot be infered from db.QueryRow()", "body": "<p>I'm trying to implement a simple POST API to insert data on Postgres DB, like this:</p>\n\n<blockquote>\n  <p><a href=\"http://123.123.10.10/checkin?userid=clive&amp;token=1234jhhasdbn\" rel=\"nofollow noreferrer\">http://123.123.10.10/checkin?userid=clive&amp;token=1234jhhasdbn</a></p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/mux\"\n    _ \"github.com/lib/pq\"\n)\n\nconst (\n    host     = \"localhost\"\n    port     = 2019\n    user     = \"postgres\"\n    password = \"dbadmin\"\n    dbname   = \"oc-indo-dev\"\n)\n\n\ntype Response struct {\n    Status  int    `json:\"status\"`\n    Message string `json:\"message\"`\n    Token string `json:\"token\"`\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/checkin\", checkin).Methods(\"POST\")\n    http.Handle(\"/\", router)\n    fmt.Println(\"Connected to port 1234\")\n    log.Fatal(http.ListenAndServe(\":1234\", router))\n}\n\nfunc DBconnect() *sql.DB {\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        host, port, user, password, dbname)\n    db, err := sql.Open(\"postgres\", psqlInfo)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return db\n}\n\nfunc checkin(w http.ResponseWriter, r *http.Request) {\n    var response Response\n    var tmpToken string\n\n    r.ParseForm()\n    userId := r.Form.Get(\"userid\")\n    userToken := r.Form.Get(\"token\")\n\n    db := DBconnect()\n    defer db.Close()\n\n    query := `INSERT INTO oc_token (userid, time, token) VALUES ($1, $2, $3) RETURNING token`\n    err = db.QueryRow(query, userId, time.Now(), userToken).Scan(&amp;tmpToken)\n\n    if (err != nil){\n        response.Status = 500\n        response.Message = \"Invalid checkin\"\n        response.Token = \"\"\n    } else {\n        response.Status = 200\n        response.Message = \"Succesfully checkedin\"\n        response.Token = tmpToken\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(response)\n\n}\n</code></pre>\n\n<p>THe Go compiler (I'm using v1.13) complained:</p>\n\n<blockquote>\n  <p>.\\checkin.go:63:2: undefined: err </p>\n  \n  <p>.\\checkin.go:65:6: undefined: err</p>\n</blockquote>\n\n<p>How to fix this? </p>\n"}, {"tags": ["go", "command-line", "flags"], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "edited": false, "score": 0, "creation_date": 1568732487, "post_id": 57972717, "comment_id": 102363756, "body": "So I should be writing <code>flag.CommandLine = flag.NewFlagSet(os.Args[0], flag.ExitOnError) </code> in my <code>resetFlags()</code> function which is called in each of the test functions? Or should I put that in my <code>main.go</code> file?"}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "reply_to_user": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "edited": false, "score": 0, "creation_date": 1568732710, "post_id": 57972717, "comment_id": 102363901, "body": "Since that it only used in your tests, I&#39;d create a func in your _test package. This isn&#39;t normal/desirable behavior."}, {"owner": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "edited": false, "score": 0, "creation_date": 1568733603, "post_id": 57972717, "comment_id": 102364386, "body": "So now when I call this function which resets the flags in each of my tests, it says <code>flag provided but not defined: flag1</code>."}, {"owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "reply_to_user": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "edited": false, "score": 0, "creation_date": 1568738791, "post_id": 57972717, "comment_id": 102366862, "body": "You need to redefine the flags after you to reset it."}, {"owner": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "edited": false, "score": 0, "creation_date": 1568743868, "post_id": 57972717, "comment_id": 102368983, "body": "Great Idea. Thanks!"}], "tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1568717506, "creation_date": 1568717506, "answer_id": 57972717, "question_id": 57969637, "link": "https://stackoverflow.com/questions/57969637/how-to-unset-flags-visited-on-command-line-in-golang-for-tests/57972717#57972717", "title": "How to unset flags Visited on command line in GoLang for Tests", "body": "<p>Based on the <a href=\"https://golang.org/src/flag/flag.go\" rel=\"nofollow noreferrer\">source code for flag</a> this should work (you'll need to add os to your imports): </p>\n\n<pre><code>flag.CommandLine = flag.NewFlagSet(os.Args[0], flag.ExitOnError) //flags are now reset\n</code></pre>\n\n<hr>\n\n<p>Also, a couple things, as a matter of style: </p>\n\n<p>Maps return the default value when a key is not found. So all of these init / reset lines can be deleted.</p>\n\n<pre><code>flagset = make(map[string]bool)\n// the initialization lines are not needed; bool already initalizes to false:\n//flagset[\"flag1\"] = false\n//...\n\nfunc LoadCommandLineArguments(args []string) error{\n   //...\n}\n\nfunc resetFlags(){\n   /* Reset flag variables */\n   flagset = make(map[string]bool)//just make a new map\n}\n</code></pre>\n"}], "owner": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "accepted_answer_id": 57972717, "answer_count": 1, "score": 0, "last_activity_date": 1568717506, "creation_date": 1568706550, "question_id": 57969637, "link": "https://stackoverflow.com/questions/57969637/how-to-unset-flags-visited-on-command-line-in-golang-for-tests", "title": "How to unset flags Visited on command line in GoLang for Tests", "body": "<p>I'm trying to run tests which call the same function multiple times with different arguments each time. This is an application that accepts different command line flags. If no commandline flag is supplied then the default value is used.</p>\n\n<pre><code>flagset = make(map[string]bool)\nflagset[\"flag1\"] = false\nflagset[\"flag2\"] = false\nflagset[\"flag3\"] = false\nflagset[\"flag4\"] = false\nfunc LoadCommandLineArguments(args []string) error{\n        err := flag.CommandLine.Parse(args)\n        /*Do error handling\n         */\n       flag.Visit(func(f *flag.Flag) { flagset[f.Name] = true })\n       // Iterate through all the flags and set their default values whatever was not passed on the commandline.\n}\n\nfunc resetFlags(){\n/* Reset flag variables to their original default values and set map values to false */\nflagset[\"flag1\"] = false\nflagset[\"flag2\"] = false\nflagset[\"flag3\"] = false\nflagset[\"flag4\"] = false\n}\n</code></pre>\n\n<p>I have different test functions each of which supply different flags for tests. Eg: This is how my test file looks like</p>\n\n<pre><code>func TestFlag1(t *testing.T) {\n   resetFlags()\n   err := LoadCommandLineArguments([]string{\"-flag1=somevalue1\"})\n}\nfunc TestFlag2(t *testing.T) {\nresetFlags()\nerr := LoadCommandLineArguments([]string{\"-flag2=somevalue2\"})\n}\nfunc TestFlag3(t *testing.T) {\nresetFlags()\nerr := LoadCommandLineArguments([]string{\"-flag3=somevalue3\"})\n}\nfunc TestFlag4(t *testing.T) {\nresetFlags()\nerr := LoadCommandLineArguments([]string{\"\"})\n}\n</code></pre>\n\n<p>Whenever I run my test file and each unit test separately all of them seem to work fine. \nBut when I run the whole file test file together, by the time it reaches testFlag4, in LoadCommandLineArguments, it Visits all the flags and thinks all of them were passed on the commandline even though I'm resetting them at the beginning of each test function.</p>\n\n<p>In TestFlag1 it thinks flag1 was passed. </p>\n\n<p>In TestFlag2 it thinks flag1 and flag2 were passed. </p>\n\n<p>In TestFlag3, it thinks flag1, flag2, flag3 were passed. </p>\n\n<p>Similarly, in TestFlag4, it thinks flag1 was also passed, flag2 was also passed, flag3 was also passed, when I didn't pass anything. I want this test to have no command line flags passed. The flags.Visit function should not be able to get true for any of the flags.</p>\n\n<p>I know by setting my map values to false, I'm not actually unsetting the command line values passed but then whats the way to do this? </p>\n\n<p>Is there a way to <strong>Unvisit / Unset</strong> commandline flags in Golang? \nAny help will be appreciated.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "stream", "zip"], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568708867, "post_id": 57969297, "comment_id": 102350649, "body": "Why a zip file as a whole could not be a single source of bytes? We could still transfer it byte after byte without caring about the inner files. Do you mean that to be able to extract some files in a zip, we still need to iterate on the entire file to read these metadata? If I understand, that would effectively mean we cannot extract an inner file (or part of an inner file) from a chunk of a zip file. Do you confirm? And is it in that regard that <code>zip.Reader</code>/<code>zip.Writer</code> don&#39;t implement <code>io.Reader</code>/<code>io.Writer</code>?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568709993, "post_id": 57969297, "comment_id": 102351264, "body": "Yes, an archive file can still be looked at as a single source of bytes, this is what the <code>archive&#47;zip</code> package does, because it needs to parse it / extract data from it. But from a user&#39;s point of view, you&#39;re not interested in the compressed data and zip internals, you&#39;re interested in the decoded, decompressed data, which is a set of files, which is not a single source of bytes."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568710055, "post_id": 57969297, "comment_id": 102351298, "body": "And you do not need to read the whole file to extract a single file from it. Yes, it&#39;s not enough to just read the beginning of the file, as metadata may be &quot;scattered&quot; all over the zip file, but the implementation jumps over the data it doesn&#39;t need, and thus doesn&#39;t read the whole file."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568710133, "post_id": 57969297, "comment_id": 102351339, "body": "For example, the file headers in the zip archive contain the compressed length. The <code>archive&#47;zip</code> package just &quot;jumps&quot; over (seeks) the uncompressed data until you explicitly ask for it e.g. with <code>File.Open()</code>."}, {"owner": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568711249, "post_id": 57969297, "comment_id": 102351989, "body": "Thanks for the clarification. But there is still a little point I don&#39;t really grasp. Does it mean the current implementation of <code>archive&#47;zip</code> does not allow to extract all files from a zip while being currently streamed (over a network connection for instance)? Say it receives the first 30kb, extracts what is can, then receives the next 30kb, extracts, etc... It seems to be up to the end user to decide which file to extract (and not at the same time as being streamed)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568711745, "post_id": 57969297, "comment_id": 102352270, "body": "@Loric- Theoretically if you just have an input stream of the zip archive, you could iterate over it and just extract (save) what you need. Typical implementations however first <i>parse</i> the whole file (it doesn&#39;t mean they <i>read</i> the whole file) to gather what files are included in the archive. Same goes for <code>archive&#47;zip</code> package: it first scans the archive to gather the file list, which it exposes via the <code>Reader.File</code> field which then you can iterate over and acquire <code>io.Reader</code> for those files (from the archive) you need."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568711857, "post_id": 57969297, "comment_id": 102352323, "body": "@Loric- That&#39;s why the <code>archive&#47;zip</code> package provides you &quot;only&quot; 2 ways to process an archive: either a file (<code>zip.OpenReader()</code>) because a file is seekable, or the <code>zip.NewReader()</code> function which requires an <code>io.ReaderAt</code>, not just a simple <code>io.Reader</code>, the former allows the implementation to &quot;jump&quot; in the input to only read parts it needs."}, {"owner": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "edited": false, "score": 0, "creation_date": 1568807627, "post_id": 57969297, "comment_id": 102391239, "body": "Thanks for globally explaining the guts of the <code>archive&#47;zip</code> package!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1568706764, "last_edit_date": 1568706764, "creation_date": 1568705196, "answer_id": 57969297, "question_id": 57969180, "link": "https://stackoverflow.com/questions/57969180/should-i-implement-io-reader-io-writer-if-my-type-does-not-make-sense-as-a-strea/57969297#57969297", "title": "Should I implement io.Reader/io.Writer if my type does not make sense as a stream?", "body": "<blockquote>\n  <p>As far as I understand, the package <code>archive/zip</code> does not allow to decompress a zip file as a stream. We have to fully load the zip in memory or as a file and decompress afterwards.</p>\n</blockquote>\n\n<p>Wrong. Some metadata needs to be loaded into memory, yes, but you do not need to load everything into memory. You can extract individual files from a zip archive. See <a href=\"https://stackoverflow.com/questions/57955434/how-to-unzip-a-single-file/57956844#57956844\">How to unzip a single file?</a></p>\n\n<p>Yes, <a href=\"https://golang.org/pkg/archive/zip/#Reader\" rel=\"nofollow noreferrer\"><code>zip.Reader</code></a> and <a href=\"https://golang.org/pkg/archive/zip/#Writer\" rel=\"nofollow noreferrer\"><code>zip.Writer</code></a> doesn't implement <code>io.Reader</code> and <code>io.Writer</code>, because they are not a single source or target of bytes. But the files in them, they are. So the files in them implement <code>io.Reader</code> and <code>io.Writer</code>. More specifically a file in an archive is represented by a <a href=\"https://golang.org/pkg/archive/zip/#File\" rel=\"nofollow noreferrer\"><code>zip.File</code></a> which may be used to obtain an <code>io.Reader</code> to get its (uncompressed) content using <a href=\"https://golang.org/pkg/archive/zip/#File.Open\" rel=\"nofollow noreferrer\"><code>File.Open()</code></a>.  When you add a new entry to a zip archive using e.g. <a href=\"https://golang.org/pkg/archive/zip/#Writer.Create\" rel=\"nofollow noreferrer\"><code>Writer.Create()</code></a>, that returns you an <code>io.Writer</code> because that represents a target of bytes, you can write the file's content into it.</p>\n\n<p>Back to your exmaple: <code>MyZip</code> also does not represent a single source or destination of bytes, so it doesn't make sense to itself implement <code>io.Reader</code> or <code>io.Writer</code>, so don't do it. Similarly to <code>archive/zip</code>, the individual files in it may do so.</p>\n"}], "owner": {"reputation": 1598, "user_id": 1955704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/90de93f0b1184d5daea7574e4fa5e37d?s=128&d=identicon&r=PG", "display_name": "Loric-", "link": "https://stackoverflow.com/users/1955704/loric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 57969297, "answer_count": 1, "score": 0, "last_activity_date": 1568706764, "creation_date": 1568704702, "question_id": 57969180, "link": "https://stackoverflow.com/questions/57969180/should-i-implement-io-reader-io-writer-if-my-type-does-not-make-sense-as-a-strea", "title": "Should I implement io.Reader/io.Writer if my type does not make sense as a stream?", "body": "<p>Question regarding zip and <code>io.Reader</code>/<code>io.Writer</code>. As far as I understand, one of the purpose of <code>io/Reader</code>/<code>io.Writer</code> is streaming. But should I implement one of these if my type does not really make sense \"as chunks\"?</p>\n\n<p>For more details:</p>\n\n<p>Lets say I have this struct.</p>\n\n<pre><code>type MyZip struct {\n    file1, file2 []byte\n}\n</code></pre>\n\n<p><code>MyZip</code> represents a particular structured zip. Let's say for example it represents a zip file containing exactly a file named <code>file1</code> and a file named <code>file2</code>. <code>MyZip</code> has the responsibility of parsing a zip file to extract these two files into two <code>[]byte</code> fields. It also should handle the other way around (turning these two <code>[]byte</code> fields as two files named <code>test1</code> and <code>test2</code> archived into a zip file).</p>\n\n<p>As far as I understand, the package <code>archive/zip</code> does not allow to decompress a zip file as a stream. We have to fully load the zip in memory or as a file and decompress afterwards.</p>\n\n<p>So to refine my question, does it make sense for <code>MyZip</code> to implement <code>io.Reader</code>/<code>io.Writer</code> for reading/writing from/to the final zip file?</p>\n\n<p>As said above, as I cannot extract the two files on the fly, I would have to add some sort of buffer to <code>MyZip</code> and just read/write from/to this buffer. So the zip would anyway be fully stored in memory before being streamed. Is it a counter indication for not using <code>io.Reader</code>/<code>io.Writer</code>?</p>\n\n<p>Thanks a lot for shedding light!</p>\n"}, {"tags": ["mongodb", "unit-testing", "go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 856, "user_id": 522005, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4e410fd984af8198028c1c4495f7bf69?s=128&d=identicon&r=PG", "display_name": "Vahid Jafari", "link": "https://stackoverflow.com/users/522005/vahid-jafari"}, "edited": false, "score": 0, "creation_date": 1568704029, "post_id": 57968716, "comment_id": 102348215, "body": "As you mentioned I defined an interface for CRUD, so I can mock CRUD operation in upper layers. But my question was about writing tests for CRUD operations.  I decide to use official mongo driver, It does not contain something like dbtest."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 856, "user_id": 522005, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4e410fd984af8198028c1c4495f7bf69?s=128&d=identicon&r=PG", "display_name": "Vahid Jafari", "link": "https://stackoverflow.com/users/522005/vahid-jafari"}, "edited": false, "score": 1, "creation_date": 1568704187, "post_id": 57968716, "comment_id": 102348290, "body": "@VahidJafari You can still <code>import github.com&#47;globalsign&#47;mgo&#47;dbtest</code> in your tests. Or do a little bit of copy, as suggested."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 7, "last_activity_date": 1568702752, "creation_date": 1568702752, "answer_id": 57968716, "question_id": 57967604, "link": "https://stackoverflow.com/questions/57967604/mocking-official-mongodb-driver/57968716#57968716", "title": "Mocking official MongoDb driver", "body": "<p>Usually, you do not. What you should do is to define a data access interface, </p>\n\n<pre><code>type CRUD interface {\n  Create(yourModel) error\n  Read(page, size, skip) []yourModel\n  Update(yourModel) error\n  Delete(yourModel) error\n}\n</code></pre>\n\n<p>and implement it.</p>\n\n<p>You then mock the interface, for example with <a href=\"https://github.com/stretchr/testify#mock-package\" rel=\"noreferrer\">testify/mock</a>:</p>\n\n<pre><code>type MockedCRUD struct {\n  mock.Mock\n}\n\nfunc(m *MockedCRUD)Create(y yourModel) error{\n  returned m.Called(y).Error(0)\n}\n// And so on and so forth\n</code></pre>\n\n<p>Since <code>MockedCRUD</code> satisfies the CRUD interface, you can use it as you would use your <code>MongoCRUD</code> implementation, without any hassle:</p>\n\n<pre><code>func TestYourApplicationLogicCallingCreate( t *testing.T){\n    model := YourModel{Type: \u201dBaz\u201d})\n\n    mocked := new(MockedCRUD)\n    mocked.On(\u201dCreate\u201d,model).Return(ErrInvalidType)\n\n    app := YourApplication{CRUD:mocked}\n\n    err := app.yourApplicationLogicCallingCreate(model)\n\n    assert.Error(t,err)\n    assert.Equal(t,ErrInvalidType,err)\n\n}\n</code></pre>\n\n<p>Remains the question how do you test the implementation of the CRUD interface. I used to use the mgo driver, originally developed by Gustavo Niemeyer and taken over by globalsign. That brought a nifty little package called <a href=\"https://godoc.org/github.com/globalsign/mgo/dbtest\" rel=\"noreferrer\">dbtest</a>. It is actually a very thin wrapper around a MongoDB instance, starting and stopping one on demand, with the ability to reset the data in between tests. Either just import <code>dbtest</code> or, to quote a Go Proverb</p>\n\n<blockquote>\n  <p>A little bit of copy is better than a little bit of dependency.</p>\n</blockquote>\n\n<p>(Remember to give credit, though, and retain the copyright notes.)</p>\n\n<p>So, using the method described above you can do your unit tests pretty fast against a mock, with stable and predictable answers tailored to your tests and only do relatively expensive and slow tests against MongoDB only where you absolutely must.</p>\n\n<p>Added bonus: it is relatively easy to swap out your actual persistence technology.</p>\n"}], "owner": {"reputation": 856, "user_id": 522005, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4e410fd984af8198028c1c4495f7bf69?s=128&d=identicon&r=PG", "display_name": "Vahid Jafari", "link": "https://stackoverflow.com/users/522005/vahid-jafari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3196, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1568706453, "creation_date": 1568696399, "last_edit_date": 1568706453, "question_id": 57967604, "link": "https://stackoverflow.com/questions/57967604/mocking-official-mongodb-driver", "title": "Mocking official MongoDb driver", "body": "<p>I need to define these interfaces to mock official mongo driver</p>\n\n<pre><code>type MgCollection interface {   \n    FindOne(ctx context.Context, filter interface{}, opts ...*options.FindOneOptions) *mongo.SingleResult\n    // Other methods\n}\n\ntype MgDatabase interface {\n    Collection(name string, opts ...*options.CollectionOptions) MgCollection\n    // Other methods\n}\n</code></pre>\n\n<p>In mongo driver package there are two structs <strong>mongo.Collection</strong> and <strong>mongo.Database</strong> with these methods</p>\n\n<pre><code>func (coll *Collection) FindOne(ctx context.Context, filter interface{}, opts ...*options.FindOneOptions) *SingleResult {\n    // Method code\n}\n\nfunc (db *Database) Collection(name string, opts ...*options.CollectionOptions) *Collection {\n    // Method code\n}\n</code></pre>\n\n<p>The struct <strong>*mongo.Collection</strong> implement <strong>MgCollection</strong> correctly, so this code compiles without error</p>\n\n<pre><code>var col mgdriver.MgCollection\ncol = &amp;mongo.Collection{}\ncol.FindOne(ctx, nil, nil)\n</code></pre>\n\n<p>But The struct <strong>*mongo.Database</strong> not implement <strong>MgDatabase</strong>, so I when I write something like this:</p>\n\n<pre><code>var db mgdriver.MgDatabase\ndb = &amp;mongo.Database{}\ndb.Collection(\"Test\", nil)\n</code></pre>\n\n<p>Compiler show this error: </p>\n\n<blockquote>\n  <p>cannot use &amp;mongo.Database literal (type *mongo.Database) as type\n  mgdriver.MgDatabase in assignment:    *mongo.Database does not implement\n  mgdriver.MgDatabase (wrong type for Collection method)        have\n  Collection(string, ...*options.CollectionOptions) *mongo.Collection\n        want Collection(string, ...*options.CollectionOptions)\n  mgdriver.MgCollection</p>\n</blockquote>\n\n<p>Both <strong>mongo.Collection</strong> and <strong>mongo.Database</strong> are in the official package and I cannot change any code in that package. so how can I change my interfaces to mock official mongo driver correctly?</p>\n"}, {"tags": ["go", "logging", "beego"], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 2936634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4317507fa6ef227b9bbd99b43f0f89f?s=128&d=identicon&r=PG&f=1", "display_name": "Aliaksandr", "link": "https://stackoverflow.com/users/2936634/aliaksandr"}, "is_accepted": false, "score": 2, "last_activity_date": 1577812789, "creation_date": 1577812789, "answer_id": 59546916, "question_id": 57966371, "link": "https://stackoverflow.com/questions/57966371/elogrus-no-active-connection-found/59546916#59546916", "title": "elogrus no active connection found", "body": "<p>You have to authenticate, if you didn't change default password you might use something like this:\nAlso set off the sniff. More details about it: <a href=\"https://github.com/olivere/elastic/wiki/Sniffing\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic/wiki/Sniffing</a></p>\n\n<pre><code>client, err := elastic.NewClient(\n    elastic.SetBasicAuth(\"elastic\", \"changeme\"),\n    elastic.SetURL(\"http://localhost:9200\"),\n    elastic.SetSniff(false),\n)\n</code></pre>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577812789, "creation_date": 1568685301, "last_edit_date": 1568706476, "question_id": 57966371, "link": "https://stackoverflow.com/questions/57966371/elogrus-no-active-connection-found", "title": "elogrus no active connection found", "body": "<p>I'm using elasticsearch, kibana on docker, and Go.</p>\n\n<blockquote>\n  <p>time=\"2019-09-17T09:52:02+08:00\" level=panic msg=\"no active connection found: no Elasticsearch node available\"\n  panic: (*logrus.Entry) (0x736fe0,0xc000136150)</p>\n</blockquote>\n\n<pre><code>import (\n\"github.com/olivere/elastic/v7\"\n\"github.com/sirupsen/logrus\"\n\"gopkg.in/sohlich/elogrus.v7\"\n)\n\nfunc main() {\n log := logrus.New()\n client, err := elastic.NewClient(elastic.SetURL(\"http://localhost:9200\"))\nif err != nil {\n    log.Panic(err)\n}\n hook, err := elogrus.NewAsyncElasticHook(client, \"localhost\", logrus.DebugLevel, \"mylog\")\n if err != nil {\n    log.Panic(err)\n}\n log.Hooks.Add(hook)\n\n log.WithFields(logrus.Fields{\n    \"name\": \"joe\",\n    \"age\":  42,\n }).Error(\"Hello world!\")\n}\n</code></pre>\n\n<p>This is the package I'm using\n<a href=\"https://github.com/sohlich/elogrus\" rel=\"nofollow noreferrer\">https://github.com/sohlich/elogrus</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/eBGPl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eBGPl.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1568671608, "post_id": 57964922, "comment_id": 102340785, "body": "You add it as a parameter after the <code>?</code> in your open string"}, {"owner": {"reputation": 45, "user_id": 5893162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b75f055c8d9db1690609e7f546125ef?s=128&d=identicon&r=PG&f=1", "display_name": "Zl1987", "link": "https://stackoverflow.com/users/5893162/zl1987"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1568673112, "post_id": 57964922, "comment_id": 102341164, "body": "Hi Derek, do you mean like this? <code>db, err := sql.Open(&quot;mysql&quot;, &quot;&lt;username&gt;:&lt;password&gt;@tcp(127.0.0.1:&lt;port&gt;)&#47;&lt;dbname&gt;?allowC&zwnj;&#8203;leartextPasswords=1?&zwnj;&#8203;charset=utf8&quot; )</code>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1568682597, "post_id": 57964922, "comment_id": 102342952, "body": "@Zl1987: <code>b, err := sql.Open(&quot;mysql&quot;, &quot;&lt;username&gt;:&lt;password&gt;@tcp(127.0.0.1:&lt;port&gt;)&#47;&lt;dbname&gt;?allowC&zwnj;&#8203;leartextPasswords=1&amp;&zwnj;&#8203;charset=utf8&quot; )</code>"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 2, "last_activity_date": 1568690846, "last_edit_date": 1568690846, "creation_date": 1568689332, "answer_id": 57966788, "question_id": 57964922, "link": "https://stackoverflow.com/questions/57964922/allowcleartextpasswords-1-to-dsn/57966788#57966788", "title": "allowCleartextPasswords=1 to DSN", "body": "<p>Since you mentioned you're using <code>MySQL</code> I recommend leveraging the native struct <a href=\"https://godoc.org/github.com/go-sql-driver/mysql#Config\" rel=\"nofollow noreferrer\">mysql.Config</a> like so:</p>\n\n<pre><code>loc, _ := time.LoadLocation(\"America/Chicago\") // handle any errors!\n\nc := mysql.Config{\n    User:                    \"user\",\n    Passwd:                  \"pa55w0rd\",\n    Net:                     \"tcp\",\n    Addr:                    \"127.0.0.1:3306\",\n    DBName:                  \"dbname\",\n    Params:                  map[string]string{\"charset\": \"utf8\"}, // extra params\n    AllowCleartextPasswords: true,\n    ParseTime:               true, // demo option\n    Loc:                     loc,  // demo option\n}\nfmt.Println(c.FormatDSN())\n</code></pre>\n\n<p>It will properly format the <code>DSN</code> string for you - escaping any sensitive character values along the way (e.g. the <code>loc</code> value):</p>\n\n<pre><code>user:pa55w0rd@tcp(127.0.0.1:3306)/dbname?allowCleartextPasswords=true&amp;allowNativePasswords=false&amp;loc=America%2FChicago&amp;parseTime=true&amp;maxAllowedPacket=0&amp;charset=utf8\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ePw9_fdiTNg\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}], "owner": {"reputation": 45, "user_id": 5893162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b75f055c8d9db1690609e7f546125ef?s=128&d=identicon&r=PG&f=1", "display_name": "Zl1987", "link": "https://stackoverflow.com/users/5893162/zl1987"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1568706492, "creation_date": 1568671308, "last_edit_date": 1568706492, "question_id": 57964922, "link": "https://stackoverflow.com/questions/57964922/allowcleartextpasswords-1-to-dsn", "title": "allowCleartextPasswords=1 to DSN", "body": "<p>I'm attempting to connect to my local DB via a mysql connection to initiate and run a query off of my database via Go.</p>\n\n<p>When attempting to connect, I am met with this error: </p>\n\n<p><code>this user requires clear text authentication. If you still want to use it, please add allowCleartextPasswords=1' to your DSN</code></p>\n\n<p>My Db connection looks like the following: <code>db, err := sql.Open(\"sql\", \"&lt;username&gt;:&lt;password&gt;@tcp(127.0.0.1:&lt;port&gt;)/&lt;dbname&gt;?charset=utf8\" )</code></p>\n\n<p>Where can I include this dependency for cleartext authentication?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1568675619, "last_edit_date": 1568675619, "creation_date": 1568675221, "answer_id": 57965375, "question_id": 57964787, "link": "https://stackoverflow.com/questions/57964787/request-body-empty-after-posting-data-to-endpoint/57965375#57965375", "title": "Request body empty after posting data to endpoint", "body": "<ul>\n<li>The JSON codec ignores the <code>hostname</code> field because the field is not <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a>. Fix by capitalizing the name of the field.</li>\n<li>There is a data race on <code>domains</code>.  Fix by protecting access to the variable with a <a href=\"https://godoc.org/sync#Mutex\" rel=\"nofollow noreferrer\">mutex</a>. </li>\n<li>The application ignores errors. Fix by checking for and handing the error returned from the JSON decoder.</li>\n</ul>\n\n<p>Here's the code with fixes:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n)\n\ntype Domain struct {\n    Hostname string `json:\"hostname,omitempty\"`\n}\n\nvar (\n    domains []Domain\n    mu      sync.Mutex\n)\n\nfunc CreateDomainEndpoint(w http.ResponseWriter, req *http.Request) {\n    var domain Domain\n    if err := json.NewDecoder(req.Body).Decode(&amp;domain); err != nil {\n        http.Error(w, \"bad request\", 400)\n        return\n    }\n    mu.Lock()\n    domains = append(domains, domain)\n    // To avoid holding the mutex while writing to the\n    // response body, make a local copy of the slice header.\n    d := domains\n    mu.Unlock()\n\n    json.NewEncoder(w).Encode(d)\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", CreateDomainEndpoint).Methods(\"POST\")\n\n    log.Fatal(http.ListenAndServe(\":4000\", handlers.CORS(handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\", \"Authorization\"}), handlers.AllowedMethods([]string{\"GET\", \"POST\", \"PUT\", \"HEAD\", \"OPTIONS\"}), handlers.AllowedOrigins([]string{\"*\"}))(router)))\n}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 7480297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d9a07c6ab82234db85c7bf54bc2c0?s=128&d=identicon&r=PG&f=1", "display_name": "jm21356", "link": "https://stackoverflow.com/users/7480297/jm21356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 57965375, "answer_count": 1, "score": -3, "last_activity_date": 1568675619, "creation_date": 1568670304, "question_id": 57964787, "link": "https://stackoverflow.com/questions/57964787/request-body-empty-after-posting-data-to-endpoint", "title": "Request body empty after posting data to endpoint", "body": "<p>I'm not sure why the data being posted is not present when running the following curl request:</p>\n\n<pre><code>curl --request POST http://localhost:4000 --header \"Content-Type: application/json\" --data '{ \"hostname\": \"bbc.co.uk\" }'\n</code></pre>\n\n<p>against the code below. It's essentially just posting json with the variable <code>hostname</code> but for some reason it's not appearing in <code>req.Body</code> or appearing in the <code>Domain</code> structure array. Please note this is based on <a href=\"https://www.thepolyglotdeveloper.com/2016/07/create-a-simple-restful-api-with-golang/\" rel=\"nofollow noreferrer\">this tutorial</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"fmt\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/handlers\"\n)\n\ntype Domain struct {\n    hostname string   `json:\"hostname,omitempty\"`\n}\n\nvar domains []Domain\n\nfunc CreateDomainEndpoint(w http.ResponseWriter, req *http.Request) {\n    var domain Domain\n\n    fmt.Println(req.Body)\n    _ = json.NewDecoder(req.Body).Decode(&amp;domain)\n    domains = append(domains, domain)\n    json.NewEncoder(w).Encode(domains)\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", CreateDomainEndpoint).Methods(\"POST\")\n\n    log.Fatal(http.ListenAndServe(\":4000\", handlers.CORS(handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\", \"Authorization\"}), handlers.AllowedMethods([]string{\"GET\", \"POST\", \"PUT\", \"HEAD\", \"OPTIONS\"}), handlers.AllowedOrigins([]string{\"*\"}))(router)))\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-lambda"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 1, "creation_date": 1568672527, "post_id": 57965038, "comment_id": 102341014, "body": "I understand it looks like it&#39;s the binary, but it&#39;s actually the built application, I was following this: <a href=\"https://github.com/awslabs/aws-sam-cli/issues/274#issuecomment-362608391\" rel=\"nofollow noreferrer\">github.com/awslabs/aws-sam-cli/issues/&hellip;</a> But after I remove the .go it&#39;s still giving me this error after <code>go build </code>go build -o main main.go`  ` {   &quot;errorMessage&quot;: &quot;fork/exec /var/task/main: permission denied&quot;,   &quot;errorType&quot;: &quot;PathError&quot; } `"}, {"owner": {"reputation": 4865, "user_id": 2378643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mt7f4.png?s=128&g=1", "display_name": "Anon Coward", "link": "https://stackoverflow.com/users/2378643/anon-coward"}, "reply_to_user": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 0, "creation_date": 1568672968, "post_id": 57965038, "comment_id": 102341128, "body": "Ahh, I see.  What platform did you build the zip file on, and what do the permissions in the zip file look like?"}, {"owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 0, "creation_date": 1568673077, "post_id": 57965038, "comment_id": 102341155, "body": "Unfortunately windows, and it seems I have full permissions on the zip as well as the built go application: <a href=\"https://ibb.co/F0BH7JR\" rel=\"nofollow noreferrer\">ibb.co/F0BH7JR</a>"}, {"owner": {"reputation": 4865, "user_id": 2378643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mt7f4.png?s=128&g=1", "display_name": "Anon Coward", "link": "https://stackoverflow.com/users/2378643/anon-coward"}, "reply_to_user": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 0, "creation_date": 1568675048, "post_id": 57965038, "comment_id": 102341599, "body": "Fair enough, you&#39;ll need to set the executable bit on the executable as well.  Doing it on Windows is tricky, I edited in a small python script that does that, which might be a useful starting point."}, {"owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 0, "creation_date": 1568690458, "post_id": 57965038, "comment_id": 102344391, "body": "I don&#39;t fully understand the &quot;executable bit&quot; can you explain?"}, {"owner": {"reputation": 4865, "user_id": 2378643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mt7f4.png?s=128&g=1", "display_name": "Anon Coward", "link": "https://stackoverflow.com/users/2378643/anon-coward"}, "reply_to_user": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 3, "creation_date": 1568691341, "post_id": 57965038, "comment_id": 102344517, "body": "Unix <a href=\"https://en.wikipedia.org/wiki/File_system_permissions\" rel=\"nofollow noreferrer\">file perms</a> control if a file can be read, written, and unlike Windows if they can be executed.  The Python example I showed sets the file mode to &quot;755&quot; (0x81ed0000 in external_attr ) and the source OS to Unix (the 3 in create_system).  The net result is when the Lambda container unpacks any file it&#39;ll be marked executable so your main executable can be run by the engine that launches it.  It&#39;s a bit of a hack because most Windows zip programs ignore the external_attr bits, which end up being converted to read/write only by unix."}, {"owner": {"reputation": 7031, "user_id": 3018212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3e1cc254d1170164a295e8372059e9e9?s=128&d=identicon&r=PG", "display_name": "Eric D. Johnson", "link": "https://stackoverflow.com/users/3018212/eric-d-johnson"}, "edited": false, "score": 0, "creation_date": 1617039126, "post_id": 57965038, "comment_id": 118184546, "body": "You answer lead me to the answer on Windows. I had to carefully follow <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/golang-package.html#golang-package-windows\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/lambda/latest/dg/&hellip;</a> and blam, it worked!"}], "tags": [], "owner": {"reputation": 4865, "user_id": 2378643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mt7f4.png?s=128&g=1", "display_name": "Anon Coward", "link": "https://stackoverflow.com/users/2378643/anon-coward"}, "is_accepted": true, "score": 4, "last_activity_date": 1568675015, "last_edit_date": 1568675015, "creation_date": 1568672172, "answer_id": 57965038, "question_id": 57964626, "link": "https://stackoverflow.com/questions/57964626/permissions-denied-when-trying-to-invoke-go-aws-lambda-function/57965038#57965038", "title": "Permissions denied when trying to invoke Go AWS Lambda function", "body": "<p>You're attempting to run the go source code file.  You need to run the binary:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># Build the binary for your module\nGOOS=linux go build main.go\n\n# Package the binary, note we're packaging \"main\", not \"main.go\" here:\nzip function.zip main\n\n# And upload \"function.zip\" this package to Lambda\n</code></pre>\n\n<p>For more details, including directions to run through this process on other platforms, see the <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/lambda-go-how-to-create-deployment-package.html\" rel=\"nofollow noreferrer\">AWS Lambda Deployment documentations</a></p>\n\n<p>Also, you'll need to set the executable bit in the zipfile.  There are a bunch of ways to do this, if you want to do it on Windows, you'll need to run a python script like this:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import zipfile\nimport time\n\ndef make_info(filename):\n    info = zipfile.ZipInfo(filename)\n    info.date_time = time.localtime()\n    info.external_attr = 0x81ed0000\n    info.create_system = 3\n    return info\n\nzip_source = zipfile.ZipFile(\"source_file.zip\")\nzip_file = zipfile.ZipFile(\"dest_file.zip\", \"w\", zipfile.ZIP_DEFLATED)\n\nfor cur in zip_source.infolist():\n    zip_file.writestr(make_info(cur.filename), zip_source.open(cur.filename).read(), zipfile.ZIP_DEFLATED)\n\nzip_file.close()\n</code></pre>\n\n<p>This will take a <code>source_file.zip</code> and repackage it as <code>dest_file.zip</code> with the same contents, but with the executable bit set for all of the files.</p>\n"}, {"tags": [], "owner": {"reputation": 452, "user_id": 5834438, "user_type": "registered", "profile_image": "https://graph.facebook.com/515216871971511/picture?type=large", "display_name": "Mohamed Elbahja", "link": "https://stackoverflow.com/users/5834438/mohamed-elbahja"}, "is_accepted": false, "score": 0, "last_activity_date": 1582987164, "creation_date": 1582987164, "answer_id": 60466237, "question_id": 57964626, "link": "https://stackoverflow.com/questions/57964626/permissions-denied-when-trying-to-invoke-go-aws-lambda-function/60466237#60466237", "title": "Permissions denied when trying to invoke Go AWS Lambda function", "body": "<p>I was having the same issue when I tried to invoke serverless function locally, I disabled selinux temporarily and I invoked the function and it's worked successfully.</p>\n"}, {"tags": [], "owner": {"reputation": 122, "user_id": 6938933, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WgKT6UyjvK8/AAAAAAAAAAI/AAAAAAAABMg/Lsyh8UL6B_0/photo.jpg?sz=128", "display_name": "Sanhaji Omar", "link": "https://stackoverflow.com/users/6938933/sanhaji-omar"}, "is_accepted": false, "score": 0, "last_activity_date": 1605226235, "creation_date": 1605226235, "answer_id": 64813684, "question_id": 57964626, "link": "https://stackoverflow.com/questions/57964626/permissions-denied-when-trying-to-invoke-go-aws-lambda-function/64813684#64813684", "title": "Permissions denied when trying to invoke Go AWS Lambda function", "body": "<p>I had the same issue, you got to make sure the name of the binary is similar to the handler's name. That should be your case already:</p>\n<pre><code>$ unzip -l main.zip \nArchive:  main.zip\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n 21477357  11-13-2020 00:02   main\n</code></pre>\n<p>More tricky though you should make sure the binary has the right permissions, as  Anon Coward highlighted in a comment:</p>\n<pre><code>$ ls -l bin/main \n-rwxrwxr-x 1 root root 19325838 nov.  12 03:23 bin/main\n\n</code></pre>\n<p>That should make your binary executable.</p>\n<p>In my case I could not <code>chmod 755</code> the binary because I was working in an Ubuntu VM under a shared folder mounted in the VM so I ended up with these perms and I could not change them:</p>\n<pre><code>$ ls -l bin/main \n-rwxrwx--- 1 root vboxsf 19325838 Nov 12 02:23 bin/main\n</code></pre>\n<p>I would be curious to know why I could not change the group and the perms on the file inside the vm, if someone has an answer.</p>\n"}], "owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2950, "favorite_count": 1, "accepted_answer_id": 57965038, "answer_count": 3, "score": 3, "last_activity_date": 1605226235, "creation_date": 1568669266, "last_edit_date": 1568673986, "question_id": 57964626, "link": "https://stackoverflow.com/questions/57964626/permissions-denied-when-trying-to-invoke-go-aws-lambda-function", "title": "Permissions denied when trying to invoke Go AWS Lambda function", "body": "<p>I've created a AWS Lambda function that I'm using a Webhook to call an <a href=\"https://i.stack.imgur.com/kgyED.png\" rel=\"nofollow noreferrer\">API Gateway</a> Below is the code I've built with <code>go build -o main.go</code> since I've been reading that you have to specify the extension. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc HandleRequest(ctx context.Context) (string, error) {\n    return fmt.Sprintf(\"Hello!\"), nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n</code></pre>\n\n<p>The issue is even though I have <a href=\"https://i.stack.imgur.com/eh8Ql.png\" rel=\"nofollow noreferrer\">public permissions</a> on my uploaded <a href=\"https://i.stack.imgur.com/ixTE3.png\" rel=\"nofollow noreferrer\">S3 function .zip</a> as well as <a href=\"https://i.stack.imgur.com/FQJdo.png\" rel=\"nofollow noreferrer\">role permissions</a> I'm still getting a permissions error. </p>\n\n<pre><code>{\n  \"errorMessage\": \"fork/exec /var/task/main: permission denied\",\n  \"errorType\": \"PathError\"\n}\n</code></pre>\n"}, {"tags": ["go", "bleve"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1568703865, "post_id": 57964623, "comment_id": 102348123, "body": "I sincerely doubt bleve will \u201ecrash without any error\u201c. Either there is an error or there is a panic. Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 5455, "user_id": 703529, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh3.googleusercontent.com/-G-kFsAfpLpU/AAAAAAAAAAI/AAAAAAAAAJE/8uMPWwMFaD0/photo.jpg?sz=128", "display_name": "serkan", "link": "https://stackoverflow.com/users/703529/serkan"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1568744921, "post_id": 57964623, "comment_id": 102369436, "body": "I actually do doubt myself too since i am very new to golang. Easily i might have done something wrong. Only thing that i can assume is adding &quot;tq.SetFuzziness(5)&quot; multiple times. Not sure though."}], "owner": {"reputation": 5455, "user_id": 703529, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh3.googleusercontent.com/-G-kFsAfpLpU/AAAAAAAAAAI/AAAAAAAAAJE/8uMPWwMFaD0/photo.jpg?sz=128", "display_name": "serkan", "link": "https://stackoverflow.com/users/703529/serkan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568744840, "creation_date": 1568669251, "last_edit_date": 1568744840, "question_id": 57964623, "link": "https://stackoverflow.com/questions/57964623/fuzzy-search-in-bleve", "title": "fuzzy search in bleve", "body": "<p>I have come up below code but not to sure how to move forward.</p>\n\n<p>In short I am trying get result for such case,</p>\n\n<p>When searched \"ome\" i need \"bbb something aaa\" to be found. Have tried to add\ntq.SetFuzziness(5) but this causes ap to crash without any error. I would appreciate any help.</p>\n\n<pre><code>    param := c.DefaultQuery(\"param\", \"\")\n\n    split := strings.Split(param, \" \")\n\n    tqs := make([]query.Query, len(split))\n    for i, token := range split {\n        tq := bleve.NewFuzzyQuery(token)\n        tq.SetField(\"Content\")\n        //tq.SetFuzziness(5) this line cause error.\n        tqs[i] = tq\n    }\n\n    allQuery := bleve.NewConjunctionQuery(tqs...)\n\n    req := bleve.NewSearchRequest(allQuery)\n    req.Highlight = bleve.NewHighlightWithStyle(\"html\")\n    req.Fields = []string{\"ID\", \"Title\", \"Content\", \"RawContent\"}\n    res, err := index.Search(req)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568668065, "post_id": 57964347, "comment_id": 102339825, "body": "What have you tried? Include your code. What problems did you encounter?"}, {"owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568668160, "post_id": 57964347, "comment_id": 102339859, "body": "i did some reading on mutex/channels but could not find something like this. My current workaround is os.exec to netstat and counting the established connections"}, {"owner": {"reputation": 2202, "user_id": 1452497, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9WtY4.png?s=128&g=1", "display_name": "Antiga", "link": "https://stackoverflow.com/users/1452497/antiga"}, "edited": false, "score": 2, "creation_date": 1568668177, "post_id": 57964347, "comment_id": 102339866, "body": "There&#39;s a couple distinct and separate questions here. To your first one: you can use a semaphore (in Go, usually just a blocking/buffered channel). The other questions are a bit more involved and there&#39;s a lot of different solutions to reason about. What have you tried so far?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1568668582, "post_id": 57964347, "comment_id": 102339993, "body": "As a starting point: <a href=\"https://gobyexample.com/rate-limiting\" rel=\"nofollow noreferrer\">gobyexample.com/rate-limiting</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1568669784, "post_id": 57964347, "comment_id": 102340350, "body": "you can wrap previous into a middleware, and that&#39;s it."}, {"owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "edited": false, "score": 0, "creation_date": 1568672132, "post_id": 57964347, "comment_id": 102340926, "body": "middleware? baby steps pls"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568697064, "post_id": 57964347, "comment_id": 102345663, "body": "I don&#39;t understand the 10 minutes waiting. Why not start, when one process is finished?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1568704007, "post_id": 57964347, "comment_id": 102348207, "body": "Aside from that, you have no control from the server side when a client chooses to timeout. @tooptoop4 Stackoverflow is a site where you ask <i>peers</i> for help in programming questions. If you want to have your problem at hand implemented for you, hire a freelancer."}, {"owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568704712, "post_id": 57964347, "comment_id": 102348540, "body": "@apxp you can start when one process finishes, BUT if all 100 processes take more than 10mins then 101st should timeout"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1568704847, "post_id": 57964347, "comment_id": 102348615, "body": "Note that <a href=\"https://golang.org/pkg/net/#Listener\" rel=\"nofollow noreferrer\">net.Listener</a> is an interface, so you can easily wrap the native listener to count your connections. No need for exec&#39;ing netstat."}, {"owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1568705057, "post_id": 57964347, "comment_id": 102348711, "body": "@MarkusWMahlberg what i&#39;m saying is the server can give a timeout error response if it knows the request has been waiting in line for &gt;=10min"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568729231, "post_id": 57964347, "comment_id": 102361804, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/19647344/golang-how-to-timeout-a-semaphore\">Golang: How to timeout a semaphore?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "edited": false, "score": 0, "creation_date": 1568730437, "post_id": 57975918, "comment_id": 102362571, "body": "&quot; throttling connections is a different problem altogether&quot; what does this mean? i thought this will throttle to a limit of 100 connections at once and make others wait for up to 10mins"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568731617, "post_id": 57975918, "comment_id": 102363235, "body": "Why are there 2 empty returns?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1568732231, "post_id": 57975918, "comment_id": 102363608, "body": "@apxp just for the sake of being explicit in the example. Presumably a handler will do more than just what is shown, and failing to return after a response could cause undesired behavior."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "edited": false, "score": 0, "creation_date": 1568732353, "post_id": 57975918, "comment_id": 102363671, "body": "@tooptoop4 that would require throttling at the listener, which is more complicated; and clients typically have a much shorter timeout for connections than for a response. For example, browsers will often time out after about 30 seconds if they can&#39;t establish a connection, but will wait up to 5 minutes after a connection is established to receive a response. The shown example could have a large number of connections, but will only process the requests up to 100 at a time. The other connections will be established but awaiting a response."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1568728746, "creation_date": 1568728746, "answer_id": 57975918, "question_id": 57964347, "link": "https://stackoverflow.com/questions/57964347/how-to-limit-concurrent-connections-to-go-api/57975918#57975918", "title": "How to limit concurrent connections to Go API", "body": "<p>There's no need for the netstats or the tickers or any of that (it won't work anyway - as soon as netstat sees &lt;100 connections nothing is stopping the next 100 request from all noticing and you ending up running 199 requests at once; plus, a request that's waiting to be handled is still going to turn up in netstat - throttling <em>connections</em> is a different problem altogether). Just use a buffered channel as a semaphore; it's already thread-safe.</p>\n\n<pre><code>sem := make(chan struct{}, 100)\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    timeout := time.After(10 * time.Minute)\n    select {\n        case &lt;- timeout:\n            http.Error(w, \"Sorry\", http.StatusUnavailable)\n            return\n        case sem &lt;- struct{}:\n            w.Write([]byte(\"Hello\"))\n            &lt;- sem\n            return\n    }\n}\n</code></pre>\n\n<p>Note though that most clients will have already timed out long before the 10 minute mark.</p>\n"}], "owner": {"reputation": 239, "user_id": 8874837, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6f1736fca49aaa3304af6382f275c337?s=128&d=identicon&r=PG&f=1", "display_name": "tooptoop4", "link": "https://stackoverflow.com/users/8874837/tooptoop4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 57975918, "answer_count": 1, "score": -2, "last_activity_date": 1568728746, "creation_date": 1568667575, "last_edit_date": 1568668763, "question_id": 57964347, "link": "https://stackoverflow.com/questions/57964347/how-to-limit-concurrent-connections-to-go-api", "title": "How to limit concurrent connections to Go API", "body": "<p>i am starting up a Go API with listenandserve to accept HTTP requests.</p>\n\n<p>How can I achieve the below goal?</p>\n\n<ol>\n<li>Allow maximum 100 simultaneous HTTP requests</li>\n<li>The 101st request (and any others) should wait for 10mins to attempt to fall into this '100 simultaneous' limit (ie hopefully some of the first 100 requests should finish)</li>\n<li>If 10mins pass and no available request 'slots' have opened up then return error for that request that has been waiting</li>\n<li>Order of which request 101...102...x that gets run next is unimportant</li>\n</ol>\n\n<p>current version is completely un-go:</p>\n\n<pre><code>    timeout := time.After(10 * time.Minute)\n    tick := time.Tick(15 * time.Second)\n    fullcmdfirst := fmt.Sprintf(\"netstat -anp | grep procname | grep ESTABLISHED | grep -v grep | wc -l\")\n    outputfirst, err1first := exec.Command(\"/bin/sh\", \"-c\", fullcmdfirst).CombinedOutput()\n    if strconv.ParseFloat(string(outputfirst)) &lt; 100 {\n        return nil\n    }\n\n    // Keep trying until we're timed out or lock acquired\n    for {\n        select {\n        // Got a timeout! fail with a timeout error\n        case &lt;-timeout:\n            return errors.New(\"Error: timed out \")\n        // Got a tick, we should check if we can acquire\n        case &lt;-tick:\n            fullcmd := fmt.Sprintf(\"netstat -anp | grep procname | grep ESTABLISHED | grep -v grep | wc -l\")\n            output, err1 := exec.Command(\"/bin/sh\", \"-c\", fullcmd).CombinedOutput()\n            if strconv.ParseFloat(string(outputfirst)) &lt; 100 {\n                l.Printf(\"start req\")\n                return nil\n            }\n        }\n    }\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-api-gateway"], "owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568663151, "creation_date": 1568663151, "question_id": 57963491, "link": "https://stackoverflow.com/questions/57963491/getting-a-patherror-in-aws-lambda-when-calling-gateway-api-go-function", "title": "Getting a PathError in AWS Lambda when calling Gateway API Go function", "body": "<p>I'm setting up a AWS Lambda function that runs Go 1.x that I call with a web hook on a form submit on my website. \nThis is the <a href=\"https://i.stack.imgur.com/dOh7Z.png\" rel=\"nofollow noreferrer\">AWS Designer</a> and <a href=\"https://i.stack.imgur.com/9u8Jp.png\" rel=\"nofollow noreferrer\">Gateway POST request</a></p>\n\n<p>When I call the Gateway API\n<a href=\"https://i.stack.imgur.com/iV6pO.png\" rel=\"nofollow noreferrer\">Gateway API Endpoint</a> I get a return of <code>errorMessage\":\"fork/exec /var/task/WebhookForm: no such file or directory\",\"errorType\":\"PathError</code> the <code>WebhookForm</code> is the function that I should be invoking but I can't seem to figure this problem out. </p>\n\n<pre><code>//WebhooksForm/main.go\npackage main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net/smtp\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc HandleRequest(ctx context.Context, name MyEvent) (string, error) {\n    return fmt.Sprintf(\"Hello!\"), nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "edited": false, "score": 6, "creation_date": 1568650838, "post_id": 57960694, "comment_id": 102333324, "body": "It is useful to make large constants more readable in the source code."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 6, "creation_date": 1568651872, "post_id": 57960694, "comment_id": 102333741, "body": "For the same reason why <code>a := 0x186a0 ; fmt.Println(a)</code> prints <code>100000</code> and not <code>0x186a0</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1568656315, "post_id": 57960694, "comment_id": 102335520, "body": "Are you asking why the decision was made to support that syntax, or what that syntax means? The former is opinion based, and off-topic. The latter is just a matter of reading the spec."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1568657920, "post_id": 57960694, "comment_id": 102336115, "body": "Why all the down-votes??! I&#39;ve been using <code>go</code> a long time and didn&#39;t know you could add these type of decorators. So I learned something new from this question."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1568658470, "post_id": 57960694, "comment_id": 102336315, "body": "@colminator: Probably because it&#39;s off-topic, and shows no research effort. As for you not knowing about this--that&#39;s not surprising, as it&#39;s only been possible for less than two weeks."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1568655818, "last_edit_date": 1568655818, "creation_date": 1568651247, "answer_id": 57960966, "question_id": 57960694, "link": "https://stackoverflow.com/questions/57960694/why-underscore-ignored-in-output/57960966#57960966", "title": "Why _(underscore) ignored in output?", "body": "<p>It's not ignored in the output; it's ignored in the source code. The underscores are a convenience to make large number literals in code easier to read; the literal is still an integer, and integers don't contain underscores. You could always use a string of course:</p>\n\n<pre><code>a := \"1_00_000\"\nfmt.Println(a)\n</code></pre>\n\n<p>Underscores as separators were added as a new feature in Go 1.13: <a href=\"https://golang.org/doc/go1.13#language\" rel=\"nofollow noreferrer\">https://golang.org/doc/go1.13#language</a></p>\n"}, {"tags": [], "owner": {"reputation": 1052, "user_id": 7768287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ySIAC.png?s=128&g=1", "display_name": "Tiya Jose", "link": "https://stackoverflow.com/users/7768287/tiya-jose"}, "is_accepted": false, "score": 3, "last_activity_date": 1568654434, "creation_date": 1568654434, "answer_id": 57961634, "question_id": 57960694, "link": "https://stackoverflow.com/questions/57960694/why-underscore-ignored-in-output/57961634#57961634", "title": "Why _(underscore) ignored in output?", "body": "<p>Underscores are just digit separators.This new feature is introduced in Go 1.13 to improve readability.It is not printed along with the number.</p>\n\n<p>The digits of any number literal can be separated (grouped) using underscores, such as in 1_000_000, 0b_1010_011 to make it more readable.</p>\n\n<pre><code>d := 9795696874578\nd := 9_795_696_874_578 // thousand separators\n</code></pre>\n\n<p>Here underscored literals are much easier to read.</p>\n"}], "owner": {"reputation": 2667, "user_id": 1508147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nueRO.jpg?s=128&g=1", "display_name": "Sathishkumar Rakkiasamy", "link": "https://stackoverflow.com/users/1508147/sathishkumar-rakkiasamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 57960966, "answer_count": 2, "score": -1, "last_activity_date": 1568655818, "creation_date": 1568650120, "last_edit_date": 1568655290, "question_id": 57960694, "link": "https://stackoverflow.com/questions/57960694/why-underscore-ignored-in-output", "title": "Why _(underscore) ignored in output?", "body": "<p>I would like to know the reason behind the output of this program.</p>\n\n<pre><code>package main\n</code></pre>\n\n<p><strong>Program</strong></p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    a := 1_00_000\n    fmt.Println(a)\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<p><code>100000</code></p>\n\n<p>How come the underscore is ignored in the output. What is the use of this new feature in Go?</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568643282, "post_id": 57958548, "comment_id": 102329289, "body": "Your map has keys of type <code>string</code>, so you must use <code>string</code> and not <code>Capability</code>. Which is easy as you can convert a Capability to a string."}, {"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568643975, "post_id": 57958548, "comment_id": 102329681, "body": "@Volker how do I conver? with <code>strconv</code> ?  didn&#39;t see an option to do it."}, {"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568644079, "post_id": 57958548, "comment_id": 102329755, "body": "I also tried string(cap) but I am getting other errors"}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1568643308, "creation_date": 1568643308, "answer_id": 57958752, "question_id": 57958548, "link": "https://stackoverflow.com/questions/57958548/cant-use-underlying-type-of-string-inside-map-of-string-cannot-use-xxx-typ/57958752#57958752", "title": "Can&#39;t use underlying type of string inside map of string: &quot;cannot use &lt;xxx&gt; (type &lt;yyy&gt;) as type string in map index&quot;", "body": "<p>No it is not a string. It is a type, wich base type is a string. </p>\n\n<p>So the exact type is important. You can also not add celcius to fahrenheit degrees, even if both types would have integer base types.</p>\n"}, {"tags": [], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "is_accepted": true, "score": 0, "last_activity_date": 1568644311, "creation_date": 1568644311, "answer_id": 57959046, "question_id": 57958548, "link": "https://stackoverflow.com/questions/57958548/cant-use-underlying-type-of-string-inside-map-of-string-cannot-use-xxx-typ/57959046#57959046", "title": "Can&#39;t use underlying type of string inside map of string: &quot;cannot use &lt;xxx&gt; (type &lt;yyy&gt;) as type string in map index&quot;", "body": "<p>Just need to change to use <code>string</code> on the cap:  </p>\n\n<pre><code>fmt.Print(string(caps_list[string(cap)]))  \n</code></pre>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 621, "favorite_count": 0, "closed_date": 1568645383, "accepted_answer_id": 57959046, "answer_count": 2, "score": -5, "last_activity_date": 1568644311, "creation_date": 1568642617, "question_id": 57958548, "link": "https://stackoverflow.com/questions/57958548/cant-use-underlying-type-of-string-inside-map-of-string-cannot-use-xxx-typ", "closed_reason": "Duplicate", "title": "Can&#39;t use underlying type of string inside map of string: &quot;cannot use &lt;xxx&gt; (type &lt;yyy&gt;) as type string in map index&quot;", "body": "<p>I have underlying type of string: <code>type Capability string</code>.  </p>\n\n<p>I wanted to use it as a string inside map of strings but I am getting an error:  </p>\n\n<blockquote>\n  <p>cannot use cap (type Capability) as type string in map index</p>\n</blockquote>\n\n<p>This is my code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\ntype Capability string\nvar caps_list = map[string]int {\n    \"HOME\" : 1,\n}\n\nfunc main() {\n\n    var cap Capability // string\n    cap = \"HOME\"\n    fmt.Print(string(caps_list[cap]))\n}  \n</code></pre>\n\n<p>Why it doesn't accept it ? it is a string after all.  </p>\n\n<p>You can try my code here:<br>\n<a href=\"https://play.golang.org/p/r-h9Hu8_eoM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/r-h9Hu8_eoM</a></p>\n"}, {"tags": ["go", "raspberry-pi"], "answers": [{"comments": [{"owner": {"reputation": 211, "user_id": 1878480, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/49d726644cf56d4b4a6c28c001b6d03a?s=128&d=identicon&r=PG", "display_name": "flagadajones", "link": "https://stackoverflow.com/users/1878480/flagadajones"}, "edited": false, "score": 0, "creation_date": 1569065485, "post_id": 57965351, "comment_id": 102480405, "body": "hi,  thanks i&#39;ve tried it but, it need X11 server to draw to screen, to direct pass through GPU"}], "tags": [], "owner": {"reputation": 105, "user_id": 8741480, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-f96oD-YPOM0/AAAAAAAAAAI/AAAAAAAAClE/YQVvqggon_Q/photo.jpg?sz=128", "display_name": "Sindri Ingolfsson", "link": "https://stackoverflow.com/users/8741480/sindri-ingolfsson"}, "is_accepted": false, "score": 0, "last_activity_date": 1568674999, "creation_date": 1568674999, "answer_id": 57965351, "question_id": 57957354, "link": "https://stackoverflow.com/questions/57957354/how-to-draw-direct-to-raspberrypi-screen-with-golang/57965351#57965351", "title": "How to draw direct to raspberrypi screen with golang", "body": "<p>If you were using pygame before then <a href=\"https://github.com/faiface/pixel\" rel=\"nofollow noreferrer\">pixel</a> might be what you are looking for. It's a simple to use and has some great examples listed in the github README.</p>\n"}], "owner": {"reputation": 211, "user_id": 1878480, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/49d726644cf56d4b4a6c28c001b6d03a?s=128&d=identicon&r=PG", "display_name": "flagadajones", "link": "https://stackoverflow.com/users/1878480/flagadajones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568674999, "creation_date": 1568638475, "question_id": 57957354, "link": "https://stackoverflow.com/questions/57957354/how-to-draw-direct-to-raspberrypi-screen-with-golang", "title": "How to draw direct to raspberrypi screen with golang", "body": "<p>I search a best practice to draw( ellipse, circle, png image etc... with mask combination) direct to a raspberypi Screen and in fullscreen without windows borders,etc....</p>\n\n<p>I've found many document which explian image/draw package but i've not found code example or boilerplate to start my project With GO.</p>\n\n<p>My project is to draw a \"robot face\" on Pi screen will react to camera mouvements. Currently i draw it in python with pygame like this :</p>\n\n<pre><code>pygame.display.set_mode(self.size, pygame.FULLSCREEN)\n</code></pre>\n\n<p>but i want to migrate to GO.</p>\n\n<p>Any help will be welcome to give me the right way to do or code examples.</p>\n"}, {"tags": ["go", "terraform", "alibaba-cloud"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1568648622, "post_id": 57957331, "comment_id": 102332340, "body": "The error means that the two types, although equivalent, because they live in separate packages, are treated as different. To make the code work, you can either import <code>oss</code> from the <code>github.com&#47;terraform-providers&#47;terraform-provider-alicloud&#47;v&zwnj;&#8203;endor&#47;....</code> path. Or have <i>your</i> app vendor both <code>connectivity</code> and <code>oss</code>."}, {"owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568649782, "post_id": 57957331, "comment_id": 102332904, "body": "@mkopriva that seems like it would be good enough for an answer if you want to post it and flesh it out with a reference to documentation about this."}, {"owner": {"reputation": 2363, "user_id": 1217998, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/536ab18f11a1222292ccfbc9d1cdda75?s=128&d=identicon&r=PG", "display_name": "Souradeep Nanda", "link": "https://stackoverflow.com/users/1217998/souradeep-nanda"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568779439, "post_id": 57957331, "comment_id": 102378224, "body": "@mkopriva Vendoring both worked. <code>go mod vendor</code> <code>go build -v</code> Can you add this as an answer, I will accept it."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11950127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7db92f5bf15350642dca4b38826aad2e?s=128&d=identicon&r=PG&f=1", "display_name": "cfmy", "link": "https://stackoverflow.com/users/11950127/cfmy"}, "is_accepted": false, "score": -1, "last_activity_date": 1568688603, "creation_date": 1568688603, "answer_id": 57966706, "question_id": 57957331, "link": "https://stackoverflow.com/questions/57957331/how-to-make-golang-not-confuse-vendor-import-with-absolute-import/57966706#57966706", "title": "How to make golang not confuse vendor import with absolute import?", "body": "<p>The compiler cannot replace <em>\"github.com/aliyun/aliyun-oss-go-sdk/oss\".Client</em> with <em>github.com/terraform-providers/terraform-provider-alicloud/vendor/github.com/aliyun/aliyun-oss-go-sdk/oss\".Client</em>, even they have the same name(but from different package).</p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1568782387, "creation_date": 1568782387, "answer_id": 57985301, "question_id": 57957331, "link": "https://stackoverflow.com/questions/57957331/how-to-make-golang-not-confuse-vendor-import-with-absolute-import/57985301#57985301", "title": "How to make golang not confuse vendor import with absolute import?", "body": "<p>The error means that the two types, although equivalent, because they live in separate packages, are treated as different. To make the code work, you can either import <code>oss</code> from the <code>github.com/terraform-providers/terraform-provider-alicloud/vendor/...</code> path. Or have your app vendor both <code>connectivity</code> and <code>oss</code>.</p>\n"}], "owner": {"reputation": 2363, "user_id": 1217998, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/536ab18f11a1222292ccfbc9d1cdda75?s=128&d=identicon&r=PG", "display_name": "Souradeep Nanda", "link": "https://stackoverflow.com/users/1217998/souradeep-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "accepted_answer_id": 57985301, "answer_count": 2, "score": 3, "last_activity_date": 1575719139, "creation_date": 1568638392, "last_edit_date": 1575719139, "question_id": 57957331, "link": "https://stackoverflow.com/questions/57957331/how-to-make-golang-not-confuse-vendor-import-with-absolute-import", "title": "How to make golang not confuse vendor import with absolute import?", "body": "<p>I dont understand what the error means but I think it is getting confused between the package in absolute path and in the vendor path. How do I make it not confused?</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># github.com/GoogleCloudPlatform/terraformer/providers/alicloud\nproviders/alicloud/dum.go:10:35: cannot use func literal (type func(*\"github.com/aliyun/aliyun-oss-go-sdk/oss\".Client) (interface {}, error)) as type func(*\"github.com/terraform-providers/terraform-provider-alicloud/vendor/github.com/aliyun/aliyun-oss-go-sdk/oss\".Client) (interface {}, error) in argument to client.WithOssClient\n</code></pre>\n\n<p>Here is the minimum reproducible code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dum\n\nimport (\n    oss \"github.com/aliyun/aliyun-oss-go-sdk/oss\"\n    \"github.com/terraform-providers/terraform-provider-alicloud/alicloud/connectivity\"\n)\n\nfunc dum() error {\n    client := connectivity.AliyunClient{}\n    raw, err := client.WithOssClient(func(ossClient *oss.Client) (interface{}, error) {\n        return ossClient.ListBuckets()\n    })\n    if err != nil {\n        return err\n    }\n    println(raw)\n\n    return nil\n}\n\n</code></pre>\n\n<p>EDIT: Solution</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go mod vendor\ngo build -v\n</code></pre>\n"}, {"tags": ["go", "unzip"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1568631787, "post_id": 57955434, "comment_id": 102322913, "body": "Yes, it&#39;s possible. What have you tried? Where did you get stuck? Please include your attempt, aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 620, "user_id": 2614117, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/09c83e4b5577ad0438a7c74ef47bcecf?s=128&d=identicon&r=PG", "display_name": "Nemo XXX", "link": "https://stackoverflow.com/users/2614117/nemo-xxx"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1568635616, "post_id": 57955434, "comment_id": 102324872, "body": "I&#39;m using the <a href=\"https://golang.org/src/archive/zip/example_test.go\" rel=\"nofollow noreferrer\">ExampleReader</a> function with an added file name check that breaks the loop if the file name matches <code>folder2&#47;file1.txt</code>.   What I need to know is how to get the file handle without a loop."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1568635878, "post_id": 57955434, "comment_id": 102324991, "body": "<code>zip.Reader</code> provides you the content of the archive, the files as a slice. There is no helper method to get a file by name, you have to iterate over the files with a loop. You don&#39;t need to open / extract the files, but to find a file by name, you have to use a loop. What&#39;s wrong with using a loop?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1568639025, "last_edit_date": 1568639025, "creation_date": 1568636601, "answer_id": 57956844, "question_id": 57955434, "link": "https://stackoverflow.com/questions/57955434/how-to-unzip-a-single-file/57956844#57956844", "title": "How to unzip a single file?", "body": "<p><a href=\"https://golang.org/pkg/archive/zip/#Reader\" rel=\"nofollow noreferrer\"><code>zip.Reader</code></a> provides you the content of the archive, the files as a <em>slice</em> (of <a href=\"https://golang.org/pkg/archive/zip/#File\" rel=\"nofollow noreferrer\"><code>zip.File</code></a>). There is no helper method to get a file by name, you have to iterate over the files with a loop. You don't need to open / extract the files, but to find a file by name, you have to use a loop.</p>\n\n<p>For example:</p>\n\n<pre><code>r, err := zip.OpenReader(\"testdata/readme.zip\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer r.Close()\n\nfor _, f := range r.File {\n    if f.Name != \"folder2/file1.txt\" {\n        continue\n    }\n\n    // Found it, print its content to terminal:\n    rc, err := f.Open()\n    if err != nil {\n        log.Fatal(err)\n    }\n    _, err = io.Copy(os.Stdout, rc)\n    if err != nil {\n        log.Fatal(err)\n    }\n    rc.Close()\n    fmt.Println()\n    break\n}\n</code></pre>\n"}], "owner": {"reputation": 620, "user_id": 2614117, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/09c83e4b5577ad0438a7c74ef47bcecf?s=128&d=identicon&r=PG", "display_name": "Nemo XXX", "link": "https://stackoverflow.com/users/2614117/nemo-xxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 57956844, "answer_count": 1, "score": 0, "last_activity_date": 1568639025, "creation_date": 1568631647, "question_id": 57955434, "link": "https://stackoverflow.com/questions/57955434/how-to-unzip-a-single-file", "title": "How to unzip a single file?", "body": "<p>I've found lots of examples on how to extract <em>all</em> files from .zip, but I can't figure out how to extract a single file without iterating over all files in the .zip file.</p>\n\n<p>Is it possible in Go to extract a single file from a .zip archive without iterating over all files in the .zip file?</p>\n\n<p>For example, if a zip file contained:</p>\n\n<pre><code>folder1/file1.txt\nfolder1/file2.txt\nfolder1/file3.txt\nfolder2/file1.txt\n</code></pre>\n\n<p>How would I extract only  <code>folder2/file1.txt</code>?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568632918, "post_id": 57955253, "comment_id": 102323483, "body": "Logrus is already an abstraction. Why wrap it?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1568632967, "post_id": 57955253, "comment_id": 102323501, "body": "&quot;This code is not working&quot; is not a problem statement. What is the observed behavior? What did you expect instead?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1568643687, "post_id": 57955253, "comment_id": 102329503, "body": "<code>loggerImpl</code>... that&#39;s such a Java name. Also: the easiest way to abstract is to declare a common interface (e.g. <code>Error(f)</code>, <code>Debug(f)</code>, etc..) and then just use whichever logging package conforms to that interface (zerolog doesn&#39;t I believe, but most others will)"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1568662727, "post_id": 57955253, "comment_id": 102337897, "body": "@EliasVanOotegem - 1 . how would you change the name instead of &quot;loggerImpel&quot; :) , 2. what I need is a bit more tricky ,  change the &quot;engine&quot; from <code>logrus</code> to <code>zap</code> (or any other logger)  without the user need to change the call to the logger api which I was provided, imagine that a lot of users are using &quot;my logger&quot; which wrap logrus, after few month logrus is deprecated and I want to change the engine but that the users will not need to change there calls to the logger, how it can be achieved in golang ? 3. any example will be very helpful ..."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568639626, "post_id": 57956182, "comment_id": 102327115, "body": "to decouple more consider using private interface, it might be a bit of copy paste within multiple package, but it unties things more."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1568662628, "post_id": 57956182, "comment_id": 102337854, "body": "Thanks, what I need is a bit more tricky , change the &quot;engine&quot; from logrus to zap without the user need to change the call to the logger, imagine that a lot of users are using &quot;my logger&quot; which wrap logrus, after few month logrus is deprecated and I want to change the engine but that the users will not need to change there calles to the logger, how it can be achieved in golang ?"}], "tags": [], "owner": {"reputation": 73, "user_id": 5946845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0a7b088c59dbbba931cf993bbdf1bb?s=128&d=identicon&r=PG&f=1", "display_name": "swapna p", "link": "https://stackoverflow.com/users/5946845/swapna-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1568634409, "creation_date": 1568634409, "answer_id": 57956182, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/57956182#57956182", "title": "Abstract implementation of log repo", "body": "<p>Abstract out the methods required or common methods by creating a interface and implement the interface like:</p>\n\n<pre><code>type Logger interface {\n    SetLevel(level string)\n    Errorf(format string, args ...interface{})\n}\n\ntype LogrusLogger struct {\n    label      string\n    version    string\n    loggerImpl *logrus.Logger\n}\n\ntype zapLogger struct {\n    label      string\n    version    string\n    loggerImpl *logrus.Logger\n}\n</code></pre>\n\n<p>Initialize the log based on requirement: </p>\n\n<pre><code>Logger log := new LogrusLogger{}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>Logger log := new ZapLogger{}\n</code></pre>\n\n<p>use it as:</p>\n\n<pre><code>log.Errorf(\"message\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569221243, "post_id": 58008406, "comment_id": 102511144, "body": "HI, thanks,<code>1.</code>  I think using it like <code>logger.Info().Log</code> create it&#39;s a bit &quot;verbose&quot; , is there a way to use a shorter way ? like <code>logger.info(&quot;bla bla&quot;)</code> ? <code>2.</code> why I need also to put <code>&quot;msg&quot;</code> inside, what is the benfit and if there a way to avoid it ? <code>3.</code> it will be great if you can provide example how can I switch between <code>zap</code> and <code>logrus</code> , from your example I dont understand how the <code>switch</code> does it...thanks!"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1570129670, "post_id": 58008406, "comment_id": 102825963, "body": "HI It will be great if you can answer my question than I mark it as resolved as I decide to use it ... thanks!"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1570133691, "post_id": 58008406, "comment_id": 102827620, "body": "it will be great if you just put some example how would you switch your all implementation to <code>logrus</code> , I try to put in the init the following which doesnt work <code>func Init(format LogFormat) { \tvar l log.Logger \tswitch format { \tcase FormatJson: \t\tl = log.NewJSONLogger(os.Stdout) \tcase FormatLogfmt: \t\tl = log.NewLogfmtLogger(os.Stdout) \tcase FormatNop: \t\tl = log.NewNopLogger() \tcase Logrus: \t\tl = logrus.New()</code>"}, {"owner": {"reputation": 334, "user_id": 2192186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25c2587230100a4daedcab063e2ed979?s=128&d=identicon&r=PG", "display_name": "Zaq Wiedmann", "link": "https://stackoverflow.com/users/2192186/zaq-wiedmann"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1576538109, "post_id": 58008406, "comment_id": 104924956, "body": "@JhonD Probably no longer useful, but I updated my answer with an example for logus. The upshot is you need to actually meet the <code>Logger</code> interface for <code>go-kit</code> when using the logger I linked. Go Kit provides implementations for logrus (and zap) so you just need to import their packages"}], "tags": [], "owner": {"reputation": 334, "user_id": 2192186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25c2587230100a4daedcab063e2ed979?s=128&d=identicon&r=PG", "display_name": "Zaq Wiedmann", "link": "https://stackoverflow.com/users/2192186/zaq-wiedmann"}, "is_accepted": false, "score": 4, "last_activity_date": 1576537958, "last_edit_date": 1576537958, "creation_date": 1568887002, "answer_id": 58008406, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/58008406#58008406", "title": "Abstract implementation of log repo", "body": "<p>Suggest thinking about the problem differently and avoiding the type/interface shenanigans entirely. Create a stateless logger with an API you like and that feels reasonable to implement across different loggers. If you want to update the underlying logger, update it, users only need to update their dependencies to see it. If you want to maintain separation, you can isolate logger backends by import paths.</p>\n\n<p><a href=\"https://gitlab.com/tight5/kit/blob/master/logger/logger.go\" rel=\"nofollow noreferrer\">https://gitlab.com/tight5/kit/blob/master/logger/logger.go</a> follows this and might inspire your own purposes. It's heavily based around go-kit's logger, which we liked to begin with, and wanted to be able to drop it in as needed for instrumentation. It also redirects the stdlib log package, which we valued so users did not have to update all of they're existing log statements to our library.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport (\n    \"gitlab.com/tight5/kit/logger\"\n    \"log\"\n)\n\nfunc main() {\n    logger.Info().Log(\"msg\", \"this is a logging example\")\n    log.Println(\"also logs through kit logger\")\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6sBfI85Yx6g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6sBfI85Yx6g</a></p>\n\n<p><code>go-kit</code>s log interface is powerful and I'd evaluate that before any home grow: <a href=\"https://github.com/go-kit/kit/blob/master/log/log.go\" rel=\"nofollow noreferrer\">https://github.com/go-kit/kit/blob/master/log/log.go</a> is just <code>func Log(keyvals ...interface{})</code>, and supports <code>zap</code> and <code>logrus</code> backends right now.</p>\n\n<p><a href=\"https://github.com/go-kit/kit/tree/master/log/logrus\" rel=\"nofollow noreferrer\">https://github.com/go-kit/kit/tree/master/log/logrus</a><br>\n<a href=\"https://github.com/go-kit/kit/tree/master/log/zap\" rel=\"nofollow noreferrer\">https://github.com/go-kit/kit/tree/master/log/zap</a></p>\n\n<p>In the linked package-level logger for example, changing the backend for users is as easy as changing the default in: <a href=\"https://gitlab.com/tight5/kit/blob/master/logger/logger.go#L42-53\" rel=\"nofollow noreferrer\">https://gitlab.com/tight5/kit/blob/master/logger/logger.go#L42-53</a> (we called it format in our abstraction, but you're really just picking the logger implementation)</p>\n\n<p>Here is an excerpt from the above to show an example implementation for logrus (zap would be very similar).</p>\n\n<pre><code>... other imports ... \nimport kitlogrus \"github.com/go-kit/kit/log/logrus\"\nimport \"github.com/sirupsen/logrus\"\nfunc Init(format LogFormat, logLevel LogLevel) {\n    var l log.Logger\n    switch format {\n    case FormatJson:\n        l = log.NewJSONLogger(os.Stdout)\n    case FormatLogfmt:\n        l = log.NewLogfmtLogger(os.Stdout)\n    case FormatNop:\n        l = log.NewNopLogger()\n    case FormatLogrus:\n        l = kitlogrus.NewLogrusLogger(logrus.New())\n    case FormatZap:\n    default:\n        panic(fmt.Errorf(\"invalid log format: %v\", format))\n    }\n    ...\n}\n</code></pre>\n\n<p>Hope this sparks an idea for your own implementation!</p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569221669, "post_id": 58013302, "comment_id": 102511346, "body": "thanks, it will be great if you can provide full example how can I use it with your logic and switch between of them...thanks!"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569318894, "post_id": 58013302, "comment_id": 102549824, "body": "@JhonD, edited the example to include more details."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569397899, "post_id": 58013302, "comment_id": 102579607, "body": "Thanks, it will be great if you can provide a working example...I put the interface functions but still have lot errors..."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569398214, "post_id": 58013302, "comment_id": 102579771, "body": "Thanks, it will be great if you can provide a working example...I put the interface functions but still have lot errors...one adapter will be sufficient"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569406393, "post_id": 58013302, "comment_id": 102584260, "body": "Thanks!, but the adapter shoulden&#39;t be <code>logrus</code> or <code>zap</code>? how can it be done ?"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569406563, "post_id": 58013302, "comment_id": 102584336, "body": "when changing it to logrus I got errors in  <code>logger := NewLogger(StdLoggerAdapter{})</code>"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569406611, "post_id": 58013302, "comment_id": 102584379, "body": "I define the interface like <code>type Adapter interface { \tSetLevel(level string) \tTracef(format string, args ...interface{}) \tDebugf(string, ...interface{}) \tInfof(format string, args ...interface{}) \tWarnf(format string, args ...interface{}) \tErrorf(format string, args ...interface{}) \tFatalf(format string, args ...interface{}) \tPanicf(format string, args ...interface{}) \tTrace(args ...interface{}) \tDebug(args ...interface{}) \tInfo(args ...interface{}) \tWarn(args ...interface{}) \tError(args ...interface{}) \tFatal(args ...interface{}) }</code>"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569407310, "post_id": 58013302, "comment_id": 102584727, "body": "Please see my update, I change it, should it be like this ? inside the methods it looks like recursive calls, should it be like this ?  e.g. <code>func (l StdLoggerAdapter) Infof(format string, args ...interface{}) { \tl.Infof(format,args) } </code>"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569409244, "post_id": 58013302, "comment_id": 102585759, "body": "Please see my update in the question, the code fails"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569426494, "post_id": 58013302, "comment_id": 102595934, "body": "HI Any update ? the code in the post is working with your suggestion but I got erorrs"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569436253, "post_id": 58013302, "comment_id": 102600132, "body": "See the edit including logrus. What you did above is a recursive call, and will cause stack overflow."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569438128, "post_id": 58013302, "comment_id": 102600887, "body": "ok, so I dont understand why you have <code>(l LogrusAdapter)</code> inside the method if you dont use them ..."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569438248, "post_id": 58013302, "comment_id": 102600936, "body": "in addition there is only one print although your main include two, the only one is ` stdlib logger debug msg `"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569438315, "post_id": 58013302, "comment_id": 102600974, "body": "it will be great if you also add comments what I should put in the adapter structs and in general"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569439058, "post_id": 58013302, "comment_id": 102601297, "body": "My code is for illustrating the point. Your implementation may use the receiver l. It probably printed one msg because default logrus log level is info and will not print debug level messages. The adapter struct contents will depend on your implementation and the logger backend. It might simply be empty if you do not need anything. They simply become implementations of the adapter interface that way."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1569436217, "last_edit_date": 1569436217, "creation_date": 1568903294, "answer_id": 58013302, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/58013302#58013302", "title": "Abstract implementation of log repo", "body": "<p>You can use an adapter:</p>\n\n<pre><code>package main\n\nimport (\n \"log\"\n \"github.com/sirupsen/logrus\"\n)\n\ntype Logger struct {\n   adapter Adapter\n}\n\nfunc (l *Logger) SetLogger(a Adapter) {\n   l.adapter=a\n}\n\nfunc (l *Logger) Debugf(fmt string,args...interface{}) {\n   l.adapter.Debugf(fmt,args...)\n}\n\ntype Adapter interface {\n   Debugf(string,...interface{})\n}\n\ntype StdLoggerAdapter struct {}\n\nfunc (l StdLoggerAdapter) Debugf(fmt string,args...interface{}) {\n   log.Printf(fmt,args...)\n}\n\ntype LogrusAdapter struct {}\n\nfunc (l LogrusAdapter) Debugf(fmt string,args...interface{}) {\n   logrus.Debugf(fmt,args...)\n}\n\n\nfunc NewLogger(a Adapter) Logger {\n   return Logger{adapter:a}\n}\n\n\nfunc main() {\n    logger:=NewLogger(StdLoggerAdapter{})\n    logger.Debugf(\"stdlib logger debug msg\")\n    logger.SetLogger(LogrusAdapter{})\n    logger.Debugf(\"logrus debug msg\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 192, "user_id": 6213262, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-q8sGr7EdSW8/AAAAAAAAAAI/AAAAAAAAADM/-gLxrl9BrHg/photo.jpg?sz=128", "display_name": "Gagan Chouhan", "link": "https://stackoverflow.com/users/6213262/gagan-chouhan"}, "is_accepted": false, "score": 1, "last_activity_date": 1569038247, "creation_date": 1569038247, "answer_id": 58037157, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/58037157#58037157", "title": "Abstract implementation of log repo", "body": "<p>I have created this repository for personal use I think it can be improved to serves your purpose.</p>\n\n<p>You can have a look.</p>\n\n<p>PS: While adding new logger like (zerolog) you can change value of the variable <code>logger</code> and change the methods (<code>Info(args ...)</code>, <code>Debug(args ...)</code> etc.) according to your needs. </p>\n\n<p><a href=\"https://gitlab.com/gagan2906/log-wrapper/\" rel=\"nofollow noreferrer\">log-wrapper</a></p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569485585, "post_id": 58111692, "comment_id": 102614477, "body": "thanks it will be great if you can provide the working code"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569489477, "post_id": 58111692, "comment_id": 102616505, "body": "I can&#39;t provide full working code because it&#39;s a lot of work to dig into zap and logrus and try to force them to match the hypothetical interface. I have only provided the general direction for how to do something <i>like</i> this. The details must be filled by you depending on the details of your situation."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1569491632, "post_id": 58111692, "comment_id": 102617761, "body": "ahh no, im talking about just one implementation for zap or logrus whatever its easy to you...thanks"}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 1, "last_activity_date": 1569483138, "creation_date": 1569483138, "answer_id": 58111692, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/58111692#58111692", "title": "Abstract implementation of log repo", "body": "<p>I'm a bit confused to be honest about what you're trying to do.</p>\n\n<p>In general, to answer the <em>meat</em> of your question:</p>\n\n<p>To make it possible to switch between different logging libraries in your code, you must define a specific interface and then implement it for each library. Since you can't implement methods on structs in another package, you will have to wrap the other libraries and define the methods on your wrappers.</p>\n\n<p>Your example code has 'level' as a property of <em>your</em> logger; I guess you want <em>your</em> logger to decide what level of logging you want, and just use the library logger as a pipe for pumping messages.</p>\n\n<p>So, let's assume a simplified version:</p>\n\n<pre><code>type LogLevel int\n\nconst (\n    LevelInfo LogLevel = iota\n    LevelDebug\n    LevelWarn\n    LevelError\n    LevelFatal\n)\n\ntype interface ILogger {\n    Log(args ...interface{})\n}\n\ntype struct Logger {\n    Level LogLevel\n    internal ILogger\n}\n</code></pre>\n\n<p>This will be the basis of everything else.</p>\n\n<p>There's a question worth pausing over:</p>\n\n<p>Do the different loggers provide compatible interfaces? If you switch between 'zap' and 'logrus' is it because you maybe actually want to use their specific interfaces? Maybe they provide some more specialized functionality that you actually want.</p>\n\n<p>If you hide them behind a common interface like <code>ILogger</code> here, you will <em>lose</em> any benefit these loggers provide in terms of actually logging.</p>\n\n<p>Anyway, we will proceed, ignoring this concern, let's see how you can use these primitives:</p>\n\n<pre><code>func NewLogger(internal ILogger) *Logger {\n    return &amp;Logger{\n        Level: LeveLInfo,\n        internal: internal,\n    }\n}\n\nfunc (logger *Logger) Log(level LogLevel, args ...interface{}) {\n    if level &gt;= logger.Level {\n        logger.internal.Log(args...)\n    }\n}\nfunc (logger *Logger) Logf(level LogLevel, fmt string, args ...interface{}) {\n    if level &gt;= logger.Level {\n        msg := fmt.Sprintf(fmt, args...)\n        logger.internal.Log(msg)\n    }\n}  \n</code></pre>\n\n<p>Now you can implement <code>Info</code> and <code>Infof</code> and <code>Debug</code> and <code>Debugf</code> .. etc as simple convenience methods.</p>\n\n<p>Here's an example. The rest will be left as an exercise to the reader.</p>\n\n<pre><code>func (logger *Logger) Infof(format string, args ...interface{}) {\n    logger.Logf(LevelInfo, format, args...)\n}\nfunc (logger *Logger) Info(args ...interface{}) {\n    logger.Log(LevelInfo, args...)\n}\n</code></pre>\n\n<p>Now the hard part: forcing all third party libraries to conform to your interface.</p>\n\n<p>I'm not familiar with all the different logging libraries, so this may prove to be not so simple. You might have to change the design of the <code>ILogger</code> interface to make it more feasible.</p>\n\n<p>In any case, this is how you would generally do it:</p>\n\n<pre><code>type ZapLogger *zap.Logger\n\nfunc (z ZapLogger) Log(args ...interface{}) {\n    zz := *zap.Logger(z)\n    // TODO: do something to pump `args` into `zz`\n}\n\ntype LogrusLogger *logrus.Logger\n\nfunc (g LogrusLogger) Log(args ...interface{}) {\n    gg := *logrus.Logger(g)\n    // TODO: do something to pump `args` into `gg`\n}\n</code></pre>\n\n<p>Now, you have these types like <code>LogrusLogger</code> and <code>ZapLogger</code> which implement <code>ILogger</code> and can be easily cast back and forth with the underlying logging library at no cost.</p>\n\n<p>So you can instantiate your own logger to wrap the underlying 3rd party logger</p>\n\n<pre><code>var underlying *logrus.Logger = MakeMyLogrusLogger(...)\nvar myLogger = NewLogger(LogrusLogger(underlying))\n</code></pre>\n\n<p>Now everyone can call <code>myLogger.Infof(....)</code> to log stuff.</p>\n\n<p>If you ever decide to switch to <code>zap</code> or whatever, you would change the above line (and also you would have to define the implementation of the ILogger interface for zap)</p>\n\n<pre><code>var underlying *zap.Logger = MakeMyZapLogger(...)\nvar myLogger = NewLogger(ZapLogger(underlying))\n</code></pre>\n\n<hr>\n\n<p>With all that said, I think this whole endeavor is fruitless and not really worth it. Since these libraries don't seem to provide compatible interfaces, and the whole point of using one library over the other is because you like the <em>different</em> interface that this other library provides for you.</p>\n"}, {"tags": [], "owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "is_accepted": false, "score": 0, "last_activity_date": 1607144545, "creation_date": 1607144545, "answer_id": 65153943, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo/65153943#65153943", "title": "Abstract implementation of log repo", "body": "<p>I had the same issue, I had to create a library that would be used by multiple microservices and needed some HTTP logging. Instead of making all microservices use one log library, I had to allow either logrus or zap.</p>\n<p>I created a <a href=\"https://github.com/arun0009/go-logger\" rel=\"nofollow noreferrer\">logger</a> interface with two implementations (logrus and zap).</p>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1367, "favorite_count": 4, "answer_count": 6, "score": 2, "last_activity_date": 1607144545, "creation_date": 1568630962, "last_edit_date": 1576570574, "question_id": 57955253, "link": "https://stackoverflow.com/questions/57955253/abstract-implementation-of-log-repo", "title": "Abstract implementation of log repo", "body": "<p>I want to <code>wrap / abstract</code> the log API (hide the implementation) and use some library\nThe reason that we want to hide the implementation is that we want to provide our log API and hide the logger lib which is used under the hod , now its <code>[logrus][1]</code> and it can be also <code>zap</code> <code>klog</code> and who use the log api do not need to change the his log code usage when I switch to different logger implementation (we are just changing the engine... ) </p>\n\n<p>What I did is create struct and the <code>init logger</code> return my struct and in addition create functions (see below) that wrap the functionality ,</p>\n\n<pre><code>package logger\n\nimport (\n   \"fmt\"\n   \"os\"\n\n   \"github.com/sirupsen/logrus\"\n)\n\nconst (\n   AppLogLevel = \"APP_LOG\"\n   defLevel    = \"error\"\n)\n\ntype Logger struct {\n   label      string\n   version    string\n   loggerImpl *logrus.Logger\n}\n\n// init logger\nfunc NewLogger(level string,version string) *Logger {\n\n   lvl := logLevel(level)\n   logger := &amp;logrus.Logger{\n      Out:       os.Stdout,\n      Level:     lvl,\n      Formatter: &amp;logrus.TextFormatter{},\n   }\n   return &amp;Logger{\n      version: version,\n      loggerImpl: logger,\n   }\n}\n\n// GetLogLevel - Get level from env\nfunc getLogLevel() string {\n   lvl, _ := os.LookupEnv(AppLogLevel)\n   if lvl != \"\" {\n      return lvl\n   }\n   return defLevel\n}\n\nfunc logLevel(lvl string) logrus.Level {\n\n   switch lvl {\n   case \"debug\":\n      return logrus.DebugLevel\n   case \"info\":\n      return logrus.InfoLevel\n   case \"error\":\n      return logrus.ErrorLevel\n   case \"warn\":\n      return logrus.WarnLevel\n   case \"fatal\":\n      return logrus.FatalLevel\n   case \"panic\":\n      return logrus.PanicLevel\n   default:\n      panic(fmt.Sprintf(\"the specified %s log level is not supported\", lvl))\n   }\n}\n\nfunc (logger *Logger) SetLevel(level string) {\n   lvl := logLevel(level)\n   logger.loggerImpl.SetLevel(lvl)\n}\n\n\n\nfunc (logger *Logger) Debugf(format string, args ...interface{}) {\n   logger.loggerImpl.Debugf(format, args...)\n}\nfunc (logger *Logger) Infof(format string, args ...interface{}) {\n   logger.loggerImpl.Infof(format, args...)\n}\n\n\nfunc (logger *Logger) Errorf(format string, args ...interface{}) {\n   logger.loggerImpl.Errorf(format, args...)\n}\n\nfunc (logger *Logger) Fatalf(format string, args ...interface{}) {\n   logger.loggerImpl.Fatalf(format, args...)\n}\n\nfunc (logger *Logger) Panicf(format string, args ...interface{}) {\n   logger.loggerImpl.Panicf(format, args...)\n}\n\nfunc (logger *Logger) Debug(args ...interface{}) {\n   logger.loggerImpl.Debug(args...)\n}\n\nfunc (logger *Logger) Info(args ...interface{}) {\n   logger.loggerImpl.Info(args...)\n}\n\nfunc (logger *Logger) Warn(args ...interface{}) {\n   logger.loggerImpl.Warn(args...)\n}\n\nfunc (logger *Logger) Error(args ...interface{}) {\n   logger.loggerImpl.Error(args...)\n}\n\nfunc (logger *Logger) Fatal(args ...interface{}) {\n   logger.loggerImpl.Fatal(args...)\n}\n\nfunc (logger *Logger) Panic(args ...interface{}) {\n   logger.loggerImpl.Panic(args...)\n}\n</code></pre>\n\n<p>...</p>\n\n<p>Do I miss something ? As when I try to change it to zap (change the structure to the following:</p>\n\n<pre><code>type Logger struct {\n    label      string\n    version    string\n    loggerImpl *zap.Logger\n}\n</code></pre>\n\n<p>This code is not working (all the functions code which works for logrus)</p>\n\n<p><code>logger.loggerImpl.SetLevel(lvl)</code></p>\n\n<p>and also </p>\n\n<p><code>logger.loggerImpl.Tracef(format, args...)</code></p>\n\n<p>etc as <a href=\"https://github.com/uber-go/zap\" rel=\"nofollow noreferrer\"><code>zap</code></a> lib doenst have them ,any idea how to abstract it which can support both or more in the future? </p>\n\n<p><strong>update</strong></p>\n\n<p>I try with the following (adapter pattern) : (but it looks that inside the method I have now recursive calls ) any idea how to avoid it ? </p>\n\n<pre><code>package logger\n\nimport (\n    log \"github.com/sirupsen/logrus\"\n)\n\ntype Logger struct {\n    adapter Adapter\n}\n\nfunc (l *Logger) SetLogger(a Adapter) {\n    l.adapter = a\n}\n\nfunc (l *Logger) Debugf(fmt string, args ...interface{}) {\n    l.adapter.Debugf(fmt, args...)\n}\n\ntype Adapter interface {\n    SetLevel(level string)\n    Tracef(format string, args ...interface{})\n    Debugf(string, ...interface{})\n    Infof(format string, args ...interface{})\n    Warnf(format string, args ...interface{})\n    Errorf(format string, args ...interface{})\n    Fatalf(format string, args ...interface{})\n    Panicf(format string, args ...interface{})\n    Trace(args ...interface{})\n    Debug(args ...interface{})\n    Info(args ...interface{})\n    Warn(args ...interface{})\n    Error(args ...interface{})\n    Fatal(args ...interface{})\n}\n\ntype StdLoggerAdapter struct {\n}\n\nfunc (l StdLoggerAdapter) SetLevel(level string) {\n    lvl := logLevel(level)\n    l.SetLevel(string(lvl))\n}\n\nfunc (l StdLoggerAdapter) Tracef(format string, args ...interface{}) {\n    l.Tracef(format, args...)\n}\n\nfunc (l StdLoggerAdapter) Infof(format string, args ...interface{}) {\n    l.Infof(format,args)\n}\n\nfunc (l StdLoggerAdapter) Warnf(format string, args ...interface{}) {\n    l.Warnf(format,args)\n}\n\n...\nfunc (l StdLoggerAdapter) Debugf(fmt string, args ...interface{}) {\n    log.Printf(fmt, args...)\n}\n\nfunc NewLogger(a Adapter) Logger {\n    return Logger{adapter: a}\n}\n\nfunc main() {\n    logger := NewLogger(StdLoggerAdapter{})\n    logger.Debugf(\"stdlib logger debug msg\")\n}\n\nfunc logLevel(lvl string) log.Level {\n    var level log.Level\n    switch lvl {\n    //case \"trace\":\n    //  level = log.TraceLevel\n    case \"debug\":\n        level = log.DebugLevel\n    case \"info\":\n        level = log.InfoLevel\n    case \"warn\":\n        level = log.WarnLevel\n    case \"error\":\n        level = log.ErrorLevel\n    case \"fatal\":\n        level = log.FatalLevel\n    case \"panic\":\n        level = log.PanicLevel\n    default:\n        level = log.ErrorLevel\n    }\n    return level\n}\n</code></pre>\n"}, {"tags": ["go", "grpc", "grpc-java", "grpc-go"], "comments": [{"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1568634873, "post_id": 57955090, "comment_id": 102324476, "body": "If you look at the official gRPC web site, it has plenty of benchmarks"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1568645970, "post_id": 57955090, "comment_id": 102330888, "body": "benchmarking is fun, but it never tells the whole story. It depends on the quality of the code, or even how you define performance. Raw throughput, maintenance cost, scaling, stability, etc... As for gRPC itself, in my experience the performance difference between well written Java and Go being similar, with Go just edging out Java in our use-cases. This was with people having a couple of years experience writing golang. The first attempts by Java devs to write go tend to be bloated an inefficient, also worth keeping in mind"}], "answers": [{"tags": [], "owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "is_accepted": false, "score": 1, "last_activity_date": 1568676566, "creation_date": 1568676566, "answer_id": 57965521, "question_id": 57955090, "link": "https://stackoverflow.com/questions/57955090/grpc-implementation-performance-java-v-s-golang/57965521#57965521", "title": "gRPC implementation performance - java v/s goLang", "body": "<p>Take a look at the <a href=\"https://grpc.io/docs/guides/benchmarking/\" rel=\"nofollow noreferrer\">public grpc benchmarks</a>. The <a href=\"https://performance-dot-grpc-testing.appspot.com/explore?dashboard=5652536396611584\" rel=\"nofollow noreferrer\">multi-language performance dashboard @master</a> shows Go and Java pretty neck-and-neck. In general Java has slightly better performance and latency, but Go does better in some cases like latency with streaming ping-pong.</p>\n\n<p>Since they are so similar, it is probably best to decide which language you want to use based on other factors.</p>\n"}, {"tags": [], "owner": {"reputation": 5558, "user_id": 68490, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b3c70bbc491ede87ae5682c561af07d2?s=128&d=identicon&r=PG", "display_name": "Tore Nestenius", "link": "https://stackoverflow.com/users/68490/tore-nestenius"}, "is_accepted": false, "score": 0, "last_activity_date": 1609682126, "creation_date": 1609682126, "answer_id": 65550596, "question_id": 57955090, "link": "https://stackoverflow.com/questions/57955090/grpc-implementation-performance-java-v-s-golang/65550596#65550596", "title": "gRPC implementation performance - java v/s goLang", "body": "<p>There was a recent Hacker news post related to this, apparently the Java implementation is bloated and heavy.</p>\n<p><a href=\"https://news.ycombinator.com/item?id=25582962\" rel=\"nofollow noreferrer\">Don't Use Protobuf for Telemetry</a></p>\n"}], "owner": {"reputation": 109, "user_id": 4594152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xHiva.jpg?s=128&g=1", "display_name": "girish TS", "link": "https://stackoverflow.com/users/4594152/girish-ts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1384, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1609682126, "creation_date": 1568630343, "question_id": 57955090, "link": "https://stackoverflow.com/questions/57955090/grpc-implementation-performance-java-v-s-golang", "title": "gRPC implementation performance - java v/s goLang", "body": "<p>gRPC supports rpc server and client implementation in many languages. \nI need to know whether there is any significant performance differences in implementing gRPC server and client in goLang v/s Java . If we are looking for high performance and scale , which implementation will be better go or java</p>\n\n<p>Thanks\nGirish T S</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568630134, "post_id": 57954750, "comment_id": 102322037, "body": "FYI in Go there&#39;s <code>struct</code> and there&#39;s <code>map</code>, and they are not one and the same thing. So you&#39;re not comparing 2 structs but two maps."}, {"owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568630558, "post_id": 57954750, "comment_id": 102322257, "body": "@mkopriva sorry about that, But in my case the map[string]interface is part of a struct I thought of making it simpler."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568630611, "post_id": 57954750, "comment_id": 102322291, "body": "How are you populating <code>a</code> and <code>b</code>? Are you doing <code>a[&quot;sample&quot;] = 1</code> and <code>b[&quot;sample&quot;] = 1</code>? Or is one of them unmarshaled from json for example? I&#39;m asking because a json number, even if it represents an integer, is unmarshaled into a <code>float64</code> if the destination type is <code>interface{}</code> by the <code>encoding&#47;json</code> pacakge."}, {"owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568630793, "post_id": 57954750, "comment_id": 102322378, "body": "@ mkopriva well that could be the case. Is there any method I can test this ?  So I am sending this value from one service to another by marshalling it into json"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568631106, "post_id": 57954750, "comment_id": 102322544, "body": "<a href=\"https://play.golang.com/p/SwXN552p3wl\" rel=\"nofollow noreferrer\">play.golang.com/p/SwXN552p3wl</a> This behaviour is documented <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">here</a>; see the paragraph <i>&quot;To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value: ...&quot;</i>"}, {"owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568631221, "post_id": 57954750, "comment_id": 102322615, "body": "Thank you this explains and answers my question"}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "is_accepted": false, "score": 0, "last_activity_date": 1568686105, "creation_date": 1568686105, "answer_id": 57966454, "question_id": 57954750, "link": "https://stackoverflow.com/questions/57954750/go-cmp-when-comparing-2-structs-treats-empty-interface-value-as-int-and-flat64/57966454#57966454", "title": "go-cmp when comparing 2 structs treats empty interface value as int and flat64", "body": "<p>As the struct was unmarshalled from json, json treats all numbers as float </p>\n"}], "owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 615, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568686105, "creation_date": 1568629033, "last_edit_date": 1568630642, "question_id": 57954750, "link": "https://stackoverflow.com/questions/57954750/go-cmp-when-comparing-2-structs-treats-empty-interface-value-as-int-and-flat64", "title": "go-cmp when comparing 2 structs treats empty interface value as int and flat64", "body": "<p>So I am using go-cmp <code>github.com/google/go-cmp/cmp</code>. To compare 2 structs.\nBoth the structs are of same type. When comparing the result I am seeing the following difference.</p>\n\n<p>I am using go v1.12</p>\n\n<pre><code>type Sample struct{\n   Field1 map[string]interface\n}\nvar a Sample\nvar b Sample\n\ncmp.Diff(a,b)\n\n\n// Somewhere in code I do this\na.Field1[\"sample\"] = 1 // this is optional.\n</code></pre>\n\n<p>So if I compare a and b I see the diff where it interprets the same field as int(0) and float64(0) </p>\n\n<pre><code>-: int(0)\n+: float64(0)\n</code></pre>\n\n<p>I expect the diff to be nil</p>\n"}, {"tags": ["git", "go", "go-git"], "comments": [{"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1568632241, "post_id": 57954234, "comment_id": 102323133, "body": "ah, your question is specifically about <code>go-git</code> ?"}, {"owner": {"reputation": 3, "user_id": 11355063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9I3Wc.jpg?s=128&g=1", "display_name": "leonmbecker", "link": "https://stackoverflow.com/users/11355063/leonmbecker"}, "reply_to_user": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1568633849, "post_id": 57954234, "comment_id": 102323909, "body": "yes exactly, sorry for the misconception ..."}, {"owner": {"reputation": 4629, "user_id": 3474146, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rb7ih.jpg?s=128&g=1", "display_name": "alex", "link": "https://stackoverflow.com/users/3474146/alex"}, "edited": false, "score": 0, "creation_date": 1568639823, "post_id": 57954234, "comment_id": 102327227, "body": "Per <a href=\"https://github.com/src-d/go-git/blob/master/COMPATIBILITY.md\" rel=\"nofollow noreferrer\">github.com/src-d/go-git/blob/master/COMPATIBILITY.md</a> - <code>tag</code> operations are supported.  Does <code>git tag --merged &lt;branchname&gt;</code> not work?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1568647903, "post_id": 57954234, "comment_id": 102332006, "body": "There is no such thing as &quot;tags of a branch&quot;. Tags are just tags: they are just names for some specific commit. The word <i>branch</i>, however, is ambiguous: see <a href=\"http://stackoverflow.com/questions/25068543/what-exactly-do-we-mean-by-branch\" title=\"what exactly do we mean by branch\">stackoverflow.com/questions/25068543/&hellip;</a> \u2014 and if you mean branch <i>names</i>, those are once again just a name for a specific commit, but those names evolve, i.e., change <i>which</i> specific commit they mean, over time."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1568648049, "post_id": 57954234, "comment_id": 102332079, "body": "That said, note that <code>git tag --merged</code> means: <i>for each tag, check to see if the tag identifies a commit that is an ancestor of the current commit; if so, print that tag</i> so it&#39;s just: <code>for t := range tags { if t.is_ancestor(current) { print t } }</code>, more or less. (How to map that to go-git, I&#39;m not sure.) Note that Git&#39;s own is-ancestor test considers any commit H to be an ancestor of H: it&#39;s really a precedes-or-equals operator."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1568648393, "post_id": 57954234, "comment_id": 102332227, "body": "It looks like you&#39;ll want to use the <code>Tags()</code> function of a <code>Repository</code> instance: <a href=\"https://godoc.org/gopkg.in/src-d/go-git.v4#Repository.Tags\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/src-d/go-git.v4#Repository.Tags</a> (BTW note that tags can name a tag object, in which case you must indirect through the tag object, and then ultimately a tag can name a tree or blob object rather than a commit, so make sure your code handles that case.)"}], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 0, "last_activity_date": 1568733868, "creation_date": 1568733868, "answer_id": 57977476, "question_id": 57954234, "link": "https://stackoverflow.com/questions/57954234/get-tags-of-specific-branch/57977476#57977476", "title": "Get Tags of specific Branch", "body": "<p>Not exactly a short solution, but the following code achieved the goal by:</p>\n\n<ol>\n<li>Read the commit hashes of the entire branch.</li>\n<li>Read all the tags of the repository.</li>\n<li>Check and only print the tag of which the hash is in the branch.</li>\n</ol>\n\n<p>Note: Didn't try with annotated tag yet. But it should be close.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/src-d/go-billy/memfs\"\n    \"gopkg.in/src-d/go-git.v4\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/object\"\n    \"gopkg.in/src-d/go-git.v4/storage/memory\"\n)\n\nfunc getBranchHashes(repo *git.Repository, branchName string) (hashes map[plumbing.Hash]bool, err error) {\n\n    // get branch reference name\n    branch, err := repo.Branch(\"master\")\n    if err != nil {\n        return\n    }\n\n    // get reference of the reference name\n    ref, err := repo.Reference(branch.Merge, true)\n    if err != nil {\n        return\n    }\n\n    // retrieve logs from the branch reference commit\n    // (default order is depth first)\n    logs, err := repo.Log(&amp;git.LogOptions{\n        From: ref.Hash(),\n    })\n    if err != nil {\n        return\n    }\n    defer logs.Close()\n\n    // a channel to collect all hashes\n    chHash := make(chan plumbing.Hash)\n    chErr := make(chan error)\n    go func() {\n        err = logs.ForEach(func(commit *object.Commit) (err error) {\n            chHash &lt;- commit.Hash\n            return\n        })\n        if err != nil {\n            chErr &lt;- err\n        }\n        close(chErr)\n        close(chHash)\n    }()\n\n    // make all hashes into a map\n    hashes = make(map[plumbing.Hash]bool)\nhashLoop:\n    for {\n        select {\n        case err = &lt;-chErr:\n            if err != nil {\n                return\n            }\n            break hashLoop\n        case h := &lt;-chHash:\n            hashes[h] = true\n        }\n    }\n    return\n}\n\ntype TagRef struct {\n    Hash plumbing.Hash\n    Name string\n}\n\nfunc main() {\n    // Filesystem abstraction based on memory\n    fs := memfs.New()\n\n    // Git objects storer based on memory\n    storer := memory.NewStorage()\n\n    // Clones the repository into the worktree (fs) and storer all the .git\n    // content into the storer\n    repo, err := git.Clone(storer, fs, &amp;git.CloneOptions{\n        URL: \"https://github.com/yookoala/gofast.git\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    hashes, err := getBranchHashes(repo, \"master\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // get all tags in the repo\n    tags, err := repo.Tags()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    tagRefs := make(chan TagRef)\n    go func() {\n        err = tags.ForEach(func(ref *plumbing.Reference) (err error) {\n            if annotedTag, err := repo.TagObject(ref.Hash()); err != plumbing.ErrObjectNotFound {\n                if annotedTag.TargetType == plumbing.CommitObject {\n                    tagRefs &lt;- TagRef{\n                        Hash: annotedTag.Target,\n                        Name: ref.Name().Short(),\n                    }\n                }\n                return nil\n            }\n            tagRefs &lt;- TagRef{\n                Hash: ref.Hash(),\n                Name: ref.Name().Short(),\n            }\n            return\n        })\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        close(tagRefs)\n    }()\n\n    for tagRef := range tagRefs {\n        if _, ok := hashes[tagRef.Hash]; ok {\n            log.Printf(\"tag: %s, hash: %s\", tagRef.Name, tagRef.Hash)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11355063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9I3Wc.jpg?s=128&g=1", "display_name": "leonmbecker", "link": "https://stackoverflow.com/users/11355063/leonmbecker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 57977476, "answer_count": 1, "score": 0, "last_activity_date": 1568733868, "creation_date": 1568627241, "last_edit_date": 1568634288, "question_id": 57954234, "link": "https://stackoverflow.com/questions/57954234/get-tags-of-specific-branch", "title": "Get Tags of specific Branch", "body": "<p>Using <a href=\"https://github.com/src-d/go-git\" rel=\"nofollow noreferrer\"><code>go-git</code></a> : is there a way to get only (lightweight and annotated) tags of a specific branch ? </p>\n\n<p>As I\u2019m mainly interested in the tags of the master branch, something like <code>git tag --merged</code> would be sufficient too. </p>\n\n<p>It doesn\u2019t seem to be possible with the basic go-git methods like <code>Tags()</code>...</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3731, "user_id": 4349666, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e849d156870115f4e2a851cbfdaac99d?s=128&d=identicon&r=PG&f=1", "display_name": "Manish Gupta", "link": "https://stackoverflow.com/users/4349666/manish-gupta"}, "edited": false, "score": 0, "creation_date": 1568625386, "post_id": 57953571, "comment_id": 102319571, "body": "I would do that but the algorithm I am trying to implement reads the file in reverse order. I am trying to read a very large file size (~8-10 GB) and if I do it from top to bottom the computational complexity will rise exponentially. Is there any way to implement some kind of reverse io.Reader and then then pass this reader object to encoding/csv csv.Reader."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1568628587, "post_id": 57953571, "comment_id": 102321262, "body": "&quot;Is there any way to implement some kind of reverse io.Reader &quot; -- In a word: No."}, {"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1568628777, "post_id": 57953571, "comment_id": 102321354, "body": "I can&#39;t see why not? Load the last 16K or so of the file into a buffer; work backwards until you find a linebreak, process the line, repeat until you run out of buffer. Then load the next 16K from the end, and so on. Granted this becomes difficult if you have to cope with linebreaks inside quoted strings, but for almost all CSVs you won&#39;t, and you&#39;ll know your input data."}, {"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 1, "creation_date": 1568628947, "post_id": 57953571, "comment_id": 102321432, "body": "Or you can always do a pass of the file forwards to save the starting offset of each line without processing the data, and then seek backwards through the file to locate each line one at a time. If you have a huge number of lines then you just need to save the offset of each 100th line, say, and then you can read in and process batches of 100 lines in reverse."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1568629317, "post_id": 57953571, "comment_id": 102321612, "body": "@Rup: You should contribute those suggestions as an answer :)"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1568624695, "creation_date": 1568624695, "answer_id": 57953571, "question_id": 57953490, "link": "https://stackoverflow.com/questions/57953490/how-to-read-a-csv-file-in-reverse/57953571#57953571", "title": "How to read a CSV file in reverse", "body": "<blockquote>\n  <p>How to read the CSV file without loading the whole file in memory in reverse?</p>\n</blockquote>\n\n<p>Basically not at all. CSV is not a format with a fixed record size and thus you cannot access individual lines directly. You always <em>must</em> read from the beginning. But of course there is no need to keep in memory what you have read and are not interested in: E.g. the encoding/csv doesn't do what you want to avoid.</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1568635325, "post_id": 57954940, "comment_id": 102324722, "body": "` read in the last 16K of the file into a binary buffer and then work backwards through it to find a line break to identify that you&#39;ve found a line. ` Consider its a bit more complicated than that. One case i can think of is a file ending with the line separator with len(line)&gt;len(readbuf), a regular line parser would then have line[len(line)-len(readbuf):] into its buffer, because it has a trailing line separator, the line parser would detect a line, resets its buffer, thus breaking."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1568635489, "post_id": 57954940, "comment_id": 102324813, "body": "**so you need a parser aware."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1568649476, "post_id": 57954940, "comment_id": 102332754, "body": "&quot;read in the last 16K of the file into a binary buffer and then work backwards through it to find a line break to identify that you&#39;ve found a line.&quot; If the values contain a line break, what then! Read <a href=\"https://www.ietf.org/rfc/rfc4180.txt\" rel=\"nofollow noreferrer\">ietf.org/rfc/rfc4180.txt</a>."}, {"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1568650237, "post_id": 57954940, "comment_id": 102333074, "body": "@peterSO Yes, I mentioned that. Most CSVs don\u2019t, though, and chances are OP will know their data and if they have to worry about it or not."}], "tags": [], "owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "is_accepted": false, "score": -2, "last_activity_date": 1568630062, "last_edit_date": 1592644375, "creation_date": 1568629726, "answer_id": 57954940, "question_id": 57953490, "link": "https://stackoverflow.com/questions/57953490/how-to-read-a-csv-file-in-reverse/57954940#57954940", "title": "How to read a CSV file in reverse", "body": "<p>A few general suggestions: apologies I don't know Go or its CSV library well enough to know if these are practical or not here.</p>\n<ol>\n<li><p>Perform a pass of the CSV file forwards without processing the data, saving the file offset every line or every 100 lines (say). You can then work backwards through your array of file offsets, seeking to each individual line to process or read in a block of 100 lines in one go and then work through the block in reverse in your code.</p>\n</li>\n<li><p>Implement your own backwards file reader: read in the last 16K of the file into a binary buffer and then work backwards through it to find a line break to identify that you've found a line. Then process the line and seek the next one; if you run out of data then load the next 16K buffer to find the start of that line.</p>\n<p>Hopefully you can borrow logic for this from the Go runtime library. This does however become complicated if you have linebreaks inside quoted blocks in your file, i.e. a linebreak might not represent a new CSV line, but hopefully you'll know whether your data does or not.</p>\n</li>\n<li><p>Find some external utility to reverse your file for you, e.g. if each line starts with a timestamp or record ID then you can probably just use your OS's built in sort (give or take the column header line). You can then just process the already-reversed file in your app.</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 3731, "user_id": 4349666, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e849d156870115f4e2a851cbfdaac99d?s=128&d=identicon&r=PG&f=1", "display_name": "Manish Gupta", "link": "https://stackoverflow.com/users/4349666/manish-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 243, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1568630062, "creation_date": 1568624443, "last_edit_date": 1568628535, "question_id": 57953490, "link": "https://stackoverflow.com/questions/57953490/how-to-read-a-csv-file-in-reverse", "title": "How to read a CSV file in reverse", "body": "<p>I am trying to read a CSV file in reverse. I can do that by loading the rows of CSV file in a slice and reversing the slice but this is a wrong approach for large file sizes.\nCSV reader returns a cursor which does not load the whole file in memory.</p>\n\n<p>But I could not find anything which implements something like a reverseCSVReader.</p>\n\n<p>How to read the CSV file without loading the whole file in memory in reverse?</p>\n"}, {"tags": ["go", "field", "reflect"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568628360, "post_id": 57953306, "comment_id": 102321135, "body": "<a href=\"https://play.golang.com/p/MbZ6iRliqHE\" rel=\"nofollow noreferrer\">play.golang.com/p/MbZ6iRliqHE</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568631505, "post_id": 57953306, "comment_id": 102322759, "body": "Please do not paste code into comments, it is unreadable. You can update the question and add the updated code there, also add the error that you&#39;re seeing."}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568631791, "post_id": 57953306, "comment_id": 102322915, "body": "Sorry, It was my first question in stackoverflow."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568633091, "post_id": 57953306, "comment_id": 102323555, "body": "You need to pass a pointer to <code>b</code>. E.g. <code>Assing(a, &amp;b)</code>."}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568633275, "post_id": 57953306, "comment_id": 102323643, "body": "Thank you for answer. Now how can i mark your answer as correct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568634195, "post_id": 57953306, "comment_id": 102324113, "body": "Comments cannot be marked so i&#39;ve provided an answer which you can mark instead."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1568634140, "creation_date": 1568634140, "answer_id": 57956102, "question_id": 57953306, "link": "https://stackoverflow.com/questions/57953306/how-to-assign-value-into-reflect-field/57956102#57956102", "title": "How to assign value into reflect Field()?", "body": "<p>For <code>Assign</code> to work, the second argument must be <em>addressable</em>, i.e. you need to pass a pointer to the struct value.</p>\n\n<pre><code>// the second argument MUST be a pointer to the struct\nAssing(source, &amp;target)\n</code></pre>\n\n<p>Then you need to slightly modify your implementation of <code>Assign</code> since a pointer does not have fileds. You can use the <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>Elem()</code></a> method to get the struct value to which the pointer points.</p>\n\n<pre><code>func Assign(sour interface{}, dist interface{}) uint {\n    counter := 0\n    source := reflect.ValueOf(sour)\n\n    // dist is expected to be a pointer, so use Elem() to\n    // get the type of the value to which the pointer points\n    target := reflect.ValueOf(dist).Elem()\n\n    typeSource := reflect.TypeOf(sour)\n\n    typeTarget := target.Type()\n    for i := 0; i &lt; source.NumField(); i++ {\n        for j := 0; j &lt; target.NumField(); j++ {\n            if typeSource.Field(i).Type == typeTarget.Field(j).Type &amp;&amp; typeSource.Field(i).Name == typeTarget.Field(j).Name {\n                counter = counter + 1\n                target.FieldByName(typeSource.Field(i).Name).Set(source.Field(i))\n\n            }\n        }\n    }\n\n    return uint(counter)\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 57956102, "answer_count": 1, "score": 3, "last_activity_date": 1568634140, "creation_date": 1568623682, "last_edit_date": 1568631622, "question_id": 57953306, "link": "https://stackoverflow.com/questions/57953306/how-to-assign-value-into-reflect-field", "title": "How to assign value into reflect Field()?", "body": "<p>I faced such a problem.\n I need to compare two structure  if they type and name of field is equal. \nTo assign value from sour to dist. I write some code, but here I can assign reflect.Field() value. Could you help me? And I create the test in the bellow</p>\n\n<pre><code>import (\n    \"reflect\"\n    \"testing\"\n)\n\nfunc Assign(sour interface{}, dist interface{}) uint {\n    counter := 0\n    source  := reflect.ValueOf(sour)\n\n    target  := reflect.ValueOf(dist)\n\n    typeSource := reflect.TypeOf(sour)\n\n\n    typeTarget := reflect.TypeOf(dist)\n    for i:=0; i&lt;source.NumField(); i++{\n        for j:=0; j&lt;target.NumField();j++{\n            if (typeSource.Field(i).Type==typeTarget.Field(j).Type &amp;&amp; typeSource.Field(i).Name==typeTarget.Field(j).Name){\n                counter = counter + 1\n                target.FieldByName(typeSource.Field(i).Name).Set(source.Field(i))\n\n\n            }\n        }\n    }\n\n    return uint(counter)\n}\n\nfunc TestAssign(t *testing.T) {\n    type A struct {\n        A string\n        B uint\n        C string\n    }\n    type B struct {\n        AA string\n        B  int\n        C  string\n    }\n    var (\n        a = A{\n            A: \"\u0422\u0435\u0441\u0442 A\",\n            B: 55,\n            C: \"Test C\",\n        }\n        b = B{\n            AA: \"OKOK\",\n            B:  10,\n            C:  \"FAFA\",\n        }\n    )\n    result := Assign(a, b)\n    switch true {\n    case b.B != 10:\n        t.Errorf(\"b.B = %d; need to be 10\", b.B)\n    case b.C != \"Test C\":\n        t.Errorf(\"b.C = %v; need to be  'Test C'\", b.C)\n    case result != 1:\n        t.Errorf(\"Assign(a,b) = %d; need to be 1\", result)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 3320, "user_id": 3480808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbca64f49de22131b4b51fddfa8a7df4?s=128&d=identicon&r=PG", "display_name": "Michael Doubez", "link": "https://stackoverflow.com/users/3480808/michael-doubez"}, "is_accepted": true, "score": 1, "last_activity_date": 1568664842, "creation_date": 1568664842, "answer_id": 57963829, "question_id": 57952695, "link": "https://stackoverflow.com/questions/57952695/prometheus-counters-how-to-get-current-value-with-golang-client/57963829#57963829", "title": "Prometheus counters: How to get current value with golang client?", "body": "<p>Currently there is no way to get the value of a counter in the official Golang implementation.</p>\n\n<p>You can also avoid double counting by incrementing your own counter and use an <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#CounterFunc\" rel=\"nofollow noreferrer\">CounterFunc</a> to collect it.</p>\n\n<p>Note: use integral type and <code>atomic</code> to avoid concurrent access issues</p>\n\n<pre><code>// declare the counter as unsigned int\nvar requestsCounter uint64 = 0\n\n// register counter in Prometheus collector\nprometheus.MustRegister(prometheus.NewCounterFunc(\n    prometheus.CounterOpts{\n        Name: \"requests_total\",\n        Help: \"Counts number of requests\",\n    },\n    func() float64 {\n        return float64(atomic.LoadUint64(&amp;requestsCounter))\n    }))\n\n// somewhere in your code\natomic.AddUint64(&amp;requestsCounter, 1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1033, "user_id": 77193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cf82705f5ab43c73273ab5d690866b3?s=128&d=identicon&r=PG", "display_name": "Tim Bunce", "link": "https://stackoverflow.com/users/77193/tim-bunce"}, "is_accepted": false, "score": 2, "last_activity_date": 1573814860, "creation_date": 1573814860, "answer_id": 58875389, "question_id": 57952695, "link": "https://stackoverflow.com/questions/57952695/prometheus-counters-how-to-get-current-value-with-golang-client/58875389#58875389", "title": "Prometheus counters: How to get current value with golang client?", "body": "<p>It is possible to read the value of a counter (or any metric) in the official Golang implementation. I'm not sure when it was added.</p>\n\n<p>This works for me:</p>\n\n<pre><code>func getMetricValue(col prometheus.Collector) float64 {\n    c := make(chan prometheus.Metric, 1) // 1 for metric with no vector\n    col.Collect(c)      // collect current metric value into the channel\n    m := dto.Metric{}\n    _ = (&lt;-c).Write(&amp;m) // read metric value from the channel\n    return *m.Counter.Value\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 776, "user_id": 10187244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VklC4.jpg?s=128&g=1", "display_name": "Deep Nirmal", "link": "https://stackoverflow.com/users/10187244/deep-nirmal"}, "is_accepted": false, "score": 2, "last_activity_date": 1592941062, "creation_date": 1592941062, "answer_id": 62542496, "question_id": 57952695, "link": "https://stackoverflow.com/questions/57952695/prometheus-counters-how-to-get-current-value-with-golang-client/62542496#62542496", "title": "Prometheus counters: How to get current value with golang client?", "body": "<p>It's easy, have a function to fetch Prometheus counter value</p>\n<pre><code>\nimport (\n    &quot;github.com/prometheus/client_golang/prometheus&quot;\n    dto &quot;github.com/prometheus/client_model/go&quot;\n    &quot;github.com/prometheus/common/log&quot;\n)\n\nfunc GetCounterValue(metric *prometheus.CounterVec) float64 {\n    var m = &amp;dto.Metric{}\n    if err := metric.WithLabelValues(&quot;label1&quot;, &quot;label2&quot;).Write(m); err != nil {\n        log.Error(err)\n        return 0\n    }\n    return m.Counter.GetValue()\n}\n</code></pre>\n"}], "owner": {"reputation": 1340, "user_id": 2460419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/420012dce5396e696185023fa03c5046?s=128&d=identicon&r=PG", "display_name": "Prisacari Dmitrii", "link": "https://stackoverflow.com/users/2460419/prisacari-dmitrii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2204, "favorite_count": 0, "accepted_answer_id": 57963829, "answer_count": 3, "score": 3, "last_activity_date": 1592941062, "creation_date": 1568621150, "question_id": 57952695, "link": "https://stackoverflow.com/questions/57952695/prometheus-counters-how-to-get-current-value-with-golang-client", "title": "Prometheus counters: How to get current value with golang client?", "body": "<p>I am using counters to count the number of requests. Is there any way to get current value of a prometheus counter?</p>\n\n<p>My aim is to reuse existing counter without allocating another variable.</p>\n\n<p>Golang prometheus client version is 1.1.0.</p>\n"}, {"tags": ["go", "dependencies", "dependency-management", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568620156, "post_id": 57952397, "comment_id": 102317081, "body": "Packages with major version &gt; 1 must be imported with an import path ending in &quot;/v2&quot;. You <b>cannot</b> have the same package (identified by its import path) in two different versions. That&#39;s why a different version needs a different import path: Append v2. Consolt the Go Modules wiki which explains all this. (Possible duplicate)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1568620192, "post_id": 57952397, "comment_id": 102317099, "body": "The Go modules concept builds on that modules must be semantically versioned according to semver. And if one of your requirement is <code>v1.12</code> and other is <code>v1.0</code>, that is the same major version, thus the <code>v1.12</code> must be compatible with <code>v1.0</code>, and so the go tool will choose <code>v1.12</code> which should work. If you need a different major versions, starting with <code>v2</code> it must be part of the import path, thus it will count as a different package / dependency, and all different major version will be included separately."}, {"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568620501, "post_id": 57952397, "comment_id": 102317217, "body": "@Volker, I&#39;ve changed the versioning in the question, as my issue isn&#39;t actually with <code>v1</code> vs. <code>v2</code>, but with <code>v0</code> vs. <code>v1</code>. So your suggestion doesn&#39;t apply. I was unaware of the <code>v2</code>+ specifics you mentioned, though. Good to know."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568620853, "post_id": 57952397, "comment_id": 102317369, "body": "You <i>cannot</i> have v0.0.0 and v1.0.0 of the same package. Dead simple. v0.0.0 is not even valid but just used for compatibility. Sometimes all you can do is fix upstream."}, {"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568621027, "post_id": 57952397, "comment_id": 102317436, "body": "@Volker Ok, so if one of my dependencies requires a <code>v0.x.x</code> version of the package, and the other dependency requires a <code>v1.x.x</code> version, the only solution is to change the requirement that one of those dependencies has in its <code>go.mod</code> file? Is that correct? Initially with the go modules thing, I had the impression that sub-modules might be able to get away with different versions. For example, if I made a second <code>go.mod</code> file in my repo for my package that needed the other version of the dependency, I thought that might work, but I could be way off course with what go modules are capable of."}, {"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1568621446, "post_id": 57952397, "comment_id": 102317611, "body": "@icza An interesting thing is that I&#39;m actually dealing with two errors of the same format described in the question. One is with a <code>v0.x.x</code> vs. <code>v1.x.x</code>, but the other is with a <code>v1.4.x</code> vs. a <code>v1.1.x</code>. Thus, the expected go tool behavior of automatically selecting doesn&#39;t appear to be working in this case. Note that this might be an edge case, as it involves importing a sub-module for one of those two versions (<code>v1.4.x</code> and <code>v1.1.x</code>)."}, {"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "edited": false, "score": 0, "creation_date": 1568622074, "post_id": 57952397, "comment_id": 102317922, "body": "To again remove the possibility of people coming to solutions to my question that do not fix the errors, I am going to change the versioning in the question to be only differences in minor versioning."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568622202, "post_id": 57952397, "comment_id": 102317970, "body": "Well, semantically a module <i>cannot</i> require v0.x.y of a dependency as this means something like &quot;I need the dependency in a not-released version. Go goes strictly Semver here (see <a href=\"https://semver.org/#spec-item-4\" rel=\"nofollow noreferrer\">semver.org/#spec-item-4</a>). If you really are forced to do this: Ask on golang-nuts."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568622316, "post_id": 57952397, "comment_id": 102318018, "body": "Go modules resolves version according to minimum version selection. If A has transitive dependencies on B in version 1.2 and 1.4 Then version 1.4 will be chosen and you will not see an error."}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "is_accepted": true, "score": 8, "last_activity_date": 1568675491, "creation_date": 1568675491, "answer_id": 57965400, "question_id": 57952397, "link": "https://stackoverflow.com/questions/57952397/how-to-resolve-conflicting-go-module-dependencies-when-a-top-level-module-and-on/57965400#57965400", "title": "How to resolve conflicting go module dependencies when a top-level module and one of its sub-modules are separately imported as separate versions?", "body": "<p>The issue turned out to be that one of the dependencies was referencing a version of the <code>github.com/shared/dependency/api</code> that was <strong>pre-go-modules</strong>. </p>\n\n<p>This caused the go tooling to have a module reference to the <code>github.com/shared/dependency/api</code> sub-module, but also a black box import of the entire <code>github.com/shared/dependency</code> repo for the pre-go-modules version. In this example, it would mean that <code>v1.2.0</code> had go modules (had a <code>go.mod</code> file), and <code>v1.1.0</code> did not.</p>\n\n<p>Adding the following line to my <code>go.mod</code> file was able to fix the issue, and this solution worked with multiple dependencies I had with such conflicts:</p>\n\n<pre><code>replace (\n    github.com/shared/dependency =&gt; github.com/shared/dependency v1.2.0\n)\n</code></pre>\n\n<p>Note that this solution only works because we are forcing references to the shared dependency to use go-module-enabled versions (v1.2.0+).</p>\n"}], "owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4936, "favorite_count": 0, "accepted_answer_id": 57965400, "answer_count": 1, "score": 4, "last_activity_date": 1568675491, "creation_date": 1568619880, "last_edit_date": 1568623915, "question_id": 57952397, "link": "https://stackoverflow.com/questions/57952397/how-to-resolve-conflicting-go-module-dependencies-when-a-top-level-module-and-on", "title": "How to resolve conflicting go module dependencies when a top-level module and one of its sub-modules are separately imported as separate versions?", "body": "<p>I have two dependencies in my project.</p>\n\n<p><code>go.mod</code>:</p>\n\n<pre><code>module github.com/test-org/test-repo\n\ngo 1.12\n\nrequire (\n    github.com/foo/bar v1.0.0\n    github.com/raz/mataz v1.0.0\n)\n</code></pre>\n\n<hr>\n\n<p>After running <code>go mod download</code>, those two dependencies result in two different versions of a <code>github.com/shared/dependency</code> to be downloaded. The interesting thing is that the <code>github.com/shared/dependency</code> contains sub-modules, e.g.:</p>\n\n<pre><code>dependency\n  -- go.mod\n  -- api\n      -- go.mod\n</code></pre>\n\n<p>Inspecting the downloaded modules shows two versions are downloaded to my local machine:</p>\n\n<p><code>ls ${GOPATH}/pkg/mod/github.com/shared</code>:</p>\n\n<pre><code>[dir] dependency    [dir] dependency@v1.1.0\n</code></pre>\n\n<p><code>ls ${GOPATH}/pkg/mod/github.com/shared/dependency</code>:</p>\n\n<pre><code>[dir] api@v1.2.0\n</code></pre>\n\n<hr>\n\n<p>Looking at the contents of these directories:</p>\n\n<p><code>${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0</code>:</p>\n\n<p>The file contents of the whole repo in v1.1.0, including the <code>api</code> folder with its own <code>go.mod</code> file.</p>\n\n<p><code>${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0</code>:</p>\n\n<p>The file contents of the <code>api</code> folder of the repo in v1.2.0, including the <code>go.mod</code> file.</p>\n\n<hr>\n\n<p>Finally, I have a <code>.go</code> file in my <code>test-repo</code> with the following setup:</p>\n\n<pre><code>package test-package\n\nimport (\n    \"github.com/foo/bar\"\n)\n\nfunc MyFunc() {...bar.NewBar()...}\n</code></pre>\n\n<p>When I try to run a test of <code>MyFunc</code> (that exists elsewhere), I get an <code>unknown import path...ambiguous import...</code> error message. e.g.</p>\n\n<p><code>go test github.com/test-org/test-repo/test-package -test.run=TestMyFunc -v</code>:</p>\n\n<pre><code>unknown import path \"github.com/shared/dependency/api\": ambiguous import: found github.com/shared/dependency/api in multiple modules:\n    github.com/shared/dependency v1.1.0 (${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api)\n    github.com/shared/dependency v1.2.0 (${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0)\n</code></pre>\n\n<p>The error points to the <code>import</code> line of the <code>.go</code> file importing <code>github.com/shared/dependency/api</code> in the <code>github.com/foo/bar</code> repo. It doesn't know which <code>api</code> to choose in my local <code>${GOPATH}/pkg/mod</code> folder, given the two versions available:</p>\n\n<ol>\n<li><code>${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api</code></li>\n<li><code>${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0</code></li>\n</ol>\n\n<hr>\n\n<p>Is there any way that I can make that <code>go test</code> call work (solve the dependency conflicts)? Neither of my two dependencies explicitly call out downloading the full <code>shared/dependency@v1.1.0</code>, but for some reason it gets pulled in. If that weren't there, it would seemingly fix the issue.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1568620305, "post_id": 57952386, "comment_id": 102317142, "body": "Most likely this is an instance of <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>."}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1568625354, "post_id": 57952386, "comment_id": 102319552, "body": "Can you share a reproducible/runnable code like I have prototyped here: <a href=\"https://play.golang.org/p/gg4hTEM7mJj\" rel=\"nofollow noreferrer\">play.golang.org/p/gg4hTEM7mJj</a>"}, {"owner": {"reputation": 11, "user_id": 12070983, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nxije1exjWM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7MKwJ1-84eyvVqihinGBeiB0UgQ/photo.jpg?sz=128", "display_name": "Katrin Cullen", "link": "https://stackoverflow.com/users/12070983/katrin-cullen"}, "edited": false, "score": 0, "creation_date": 1568626551, "post_id": 57952386, "comment_id": 102320204, "body": "<a href=\"https://play.golang.org/p/U4kTGDTeq0Q\" rel=\"nofollow noreferrer\">play.golang.org/p/U4kTGDTeq0Q</a>"}], "answers": [{"tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": false, "score": 0, "last_activity_date": 1568721511, "creation_date": 1568721511, "answer_id": 57973754, "question_id": 57952386, "link": "https://stackoverflow.com/questions/57952386/how-to-fix-m0-nil-so-that-it-would-count-it-in-err/57973754#57973754", "title": "How to fix m[0] == nil {} so that it would count it in err", "body": "<p>This code is a little more expressive. I hope it helps. </p>\n\n<p>As far as whether m[0]==nil--why add an error into the slice in the first place if it was nil?</p>\n\n<pre><code>func (m Errors) Error() string {\n\n    count := 0\n\n    if m != nil {\n        count = len(m)\n    }\n\n    switch count {\n    case 0: \n        return \"(0 errors)\"\n    case 1:\n        return m[0].Error()\n    default:\n        return fmt.Sprint(m[0].Error(), \" (and \", count, \" other errors)\")\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12070983, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nxije1exjWM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7MKwJ1-84eyvVqihinGBeiB0UgQ/photo.jpg?sz=128", "display_name": "Katrin Cullen", "link": "https://stackoverflow.com/users/12070983/katrin-cullen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1568721511, "creation_date": 1568619815, "last_edit_date": 1568620071, "question_id": 57952386, "link": "https://stackoverflow.com/questions/57952386/how-to-fix-m0-nil-so-that-it-would-count-it-in-err", "title": "How to fix m[0] == nil {} so that it would count it in err", "body": "<p>I'm writing a code that and stuck at <code>m[0] == nil</code>. if code has <code>{[]error{nil, err}</code> it should return <code>err ==  1 { return m[0].Error()}</code>\nbut insted it counts <code>nil</code> as err and returns <code>for m[0] == nil{ return \"0 errors\"</code></p>\n\n<p>another example is <code>{[]error{err, nil}</code>  that should return <code>m[0].Error()</code> and not for <code>err==2</code> </p>\n\n<p>I've added if <code>m== nil</code>  and \n (<code>m[0] ==nil</code>   - otherwise I get panic: runtime error: invalid memory address or nil pointer dereference )</p>\n\n<pre><code>type Errors []error\n\n\nfunc (m Errors) Error() string {\n\n  if m == nil{\n    return \"(0 errors)\"\n  }else if err := len(m); err == 0 {\n    return \"(0 errors)\" \n  }else if m[0]==nil{\n    return \"(0 errors)\"\n  }else if err == 1 {\n    return m[0].Error()\n  } else if err == 2 {\n    return m[0].Error() + \" (and 1 other error)\"    \n  }else {\n    return  fmt.Sprint(m[0].Error(), \" (and 2 other errors)\")\n  } \n}\n</code></pre>\n"}, {"tags": ["go", "tcp", "connection"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1568658336, "post_id": 57952317, "comment_id": 102336271, "body": "tcp is bidirectionnal. you can read write using the same wires. Assuming Alice and Box, Alice connects to Bob, or vice et versa, then Alice can read a Bob&#39;s message and directly send it back to Bob. Be careful though, if they both echo each other it is an infinite loop over the wire."}], "answers": [{"tags": [], "owner": {"reputation": 468, "user_id": 450333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11263845c2ece6187c3b87b2be66f60a?s=128&d=identicon&r=PG", "display_name": "Kent", "link": "https://stackoverflow.com/users/450333/kent"}, "is_accepted": false, "score": 1, "last_activity_date": 1568639696, "creation_date": 1568639696, "answer_id": 57957691, "question_id": 57952317, "link": "https://stackoverflow.com/questions/57952317/golang-tcp-server-exchange-data-between-clients/57957691#57957691", "title": "Golang TCP Server - Exchange Data between Clients", "body": "<p>Problem looks to be that you need a pms connection for every ast connection your getting, inserting your acceptanse of ast connections in a loop would probably solve your immediate problem, like this</p>\n\n<pre><code>for {\n    pmsConn, pmsErr := pmsListener.Accept()\n\n    if pmsErr != nil {\n        fmt.Printf(\"Some connection error: %s\\n\", pmsErr)\n    }\n\n    go handlePMSConnection(pmsConn)\n    for {\n        astConn, astErr := astListener.Accept()\n\n        if astErr != nil {\n            fmt.Printf(\"Some connection error: %s\\n\", astErr)\n        }\n        go handleAstConnection(astConn, pmsConn)\n    }\n}\n</code></pre>\n\n<p>But problems would arise if you lost the pms connection, and what would happen if you get multiple ast connections. And you would need to connect the pms connection before the ast connection.</p>\n"}], "owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568639696, "creation_date": 1568619568, "question_id": 57952317, "link": "https://stackoverflow.com/questions/57952317/golang-tcp-server-exchange-data-between-clients", "title": "Golang TCP Server - Exchange Data between Clients", "body": "<p>I'm looking to implement a TCP server in go, which should be able to receive data from one client and send it to another. What will be the correct way to achieve that? I tried the following code:</p>\n\n<pre><code>astSrc := *addr + \":\" + strconv.Itoa(*astPort)\nastListener, _ := net.Listen(\"tcp\", astSrc)\nfmt.Printf(\"Listening on %s for Client Connections.\\n\", astSrc)\n\ndefer astListener.Close()\n\npmsSrc := *addr + \":\" + strconv.Itoa(*pmsPort)\npmsListener, _ := net.Listen(\"tcp\", pmsSrc)\nfmt.Printf(\"Listening on %s for DB Connections.\\n\", pmsSrc)\n\ndefer pmsListener.Close()\n\nfor {\npmsConn, pmsErr := pmsListener.Accept()\n\nif pmsErr != nil {\n    fmt.Printf(\"Some connection error: %s\\n\", pmsErr)\n}\n\ngo handlePMSConnection(pmsConn)\n\nastConn, astErr := astListener.Accept()\n\nif astErr != nil {\n    fmt.Printf(\"Some connection error: %s\\n\", astErr)\n}\ngo handleAstConnection(astConn, pmsConn)\n}\n</code></pre>\n\n<p>I was thinking to use 2 different ports for each client (astSrc - which is an short time connection  and pmsSrc - permanent connection) and make 2 listeners for each of them. I want to be able to receive a message from Client-1 connected to the astSrc port, and pass it on Client-2 (pmsSrc port). This code is working so far, but if the client-1 is discconected and then connected back - the server is not accepting any message anymore. I don't know if it's correct to handle both connections in the same loop, i think that's the problem, but if I'm taking out of the loop one connection then that connection will be unreachable. Could you please point me into right direction?</p>\n"}, {"tags": ["go", "testing", "integration-testing"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1568618181, "post_id": 57950202, "comment_id": 102316237, "body": "That really depends. The natural thing would be to do an individual test for each of the four methods. Unless there is good reason to not do it, e.g. if you use the stuff you created to get and delete afterwards."}], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 2414652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/014d0fb43567f59e8cc08523097a1285?s=128&d=identicon&r=PG", "display_name": "hdlopez", "link": "https://stackoverflow.com/users/2414652/hdlopez"}, "is_accepted": true, "score": 3, "last_activity_date": 1568607837, "creation_date": 1568607837, "answer_id": 57950361, "question_id": 57950202, "link": "https://stackoverflow.com/questions/57950202/how-to-write-clean-integration-tests/57950361#57950361", "title": "How to write clean integration tests", "body": "<p>If you think in maintainability and clean code, IMHO I would recommend you to test each CRUD functions in a different test.</p>\n\n<p>Regarding your question about multiple test cases I would say that a good approach is to use DDT (data-driven-testing or table-driven-testing). Something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Test_create(t *testing.T) {\n    type args struct {\n        // Define here your function arguments\n        arg1 string,\n        arg2 string,\n    }\n    tests := []struct {\n        name string\n        args args\n        want bool // Your possible function output\n    }{\n    // TODO: Add test cases.\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            if got := create(tt.args.id); got != tt.want {\n                t.Errorf(\"create() = %v, want %v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>Using <a href=\"https://github.com/cweill/gotests\" rel=\"nofollow noreferrer\">gotests</a> you can generate clean and nice tests for your functions.</p>\n"}], "owner": {"reputation": 731, "user_id": 5865411, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/z2dJz.png?s=128&g=1", "display_name": "dev-x", "link": "https://stackoverflow.com/users/5865411/dev-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 57950361, "answer_count": 1, "score": -1, "last_activity_date": 1568617753, "creation_date": 1568606290, "last_edit_date": 1568617753, "question_id": 57950202, "link": "https://stackoverflow.com/questions/57950202/how-to-write-clean-integration-tests", "title": "How to write clean integration tests", "body": "<p>I want to write an integration test using Go and MySQL. But I confused how to do this clean. I have 4 functions: create, get, update, and delete. Is it a good practice if I just have one test function to test all my code? For example:</p>\n\n<pre><code>func TestCRUD(t *testing.T){\n    t.Run(\"success case\", func(t *testing.T){\n         // call create func\n\n         // call update func\n\n         // call get func\n\n         // call delete func\n    })\n}\n</code></pre>\n\n<p>If I have code like above, I just have one test function to test all my code. If I want to add a test case, I just add to <code>TestCRUD()</code> function. Is it a good practice?</p>\n\n<p>Or should I write test function for each CRUD function? So I have 4 test functions and every test function also have many test cases. How can I write my integration test clean?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "edited": false, "score": 0, "creation_date": 1568607928, "post_id": 57949954, "comment_id": 102313177, "body": "<a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1568622155, "post_id": 57949954, "comment_id": 102317948, "body": "If you need to rely on the capacity, that&#39;s a code smell. Arranging capacity should be purely for efficiency / performance, and not for validity of code. You should most likely use slices differently, or not use slices if this is an issue for you."}], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 772528, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/6845d7b19bae18988bd4d181ce6bf455?s=128&d=identicon&r=PG", "display_name": "ChandlerSong", "link": "https://stackoverflow.com/users/772528/chandlersong"}, "edited": false, "score": 0, "creation_date": 1568644105, "post_id": 57950176, "comment_id": 102329771, "body": "if I want the newSlice and old one can share the array, if the capacity of new is not enough, extend both and make sure this two share the same array.  the requirement is strange, I am beginner of GO,  just hope to know how to write Go style code."}], "tags": [], "owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "is_accepted": false, "score": 1, "last_activity_date": 1568606094, "creation_date": 1568606094, "answer_id": 57950176, "question_id": 57949954, "link": "https://stackoverflow.com/questions/57949954/how-to-to-elegantly-make-slice-append-safe/57950176#57950176", "title": "How to to elegantly make slice append safe", "body": "<p>This is a really good source for random slice things: <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SliceTricks</a></p>\n\n<p>In this case, I would recommend just creating a new slice first, then appending elements every time afterwards like so:</p>\n\n<pre><code>slice := []int{10, 20, 30, 40, 50, 60}\n\nnewSlice := make([]int, 0)\nnewSlice = append(newSlice, slice[2:4:5]...)\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n\nnewSlice = append(newSlice, 70)\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n\nnewSlice = append(newSlice, 80)\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n</code></pre>\n\n<p>Which results in:</p>\n\n<pre><code>old slice is [10 20 30 40 50 60] \nnew slice is [30 40] \nold slice is [10 20 30 40 50 60] \nnew slice is [30 40 70] \nold slice is [10 20 30 40 50 60] \nnew slice is [30 40 70 80]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1568607882, "last_edit_date": 1568607882, "creation_date": 1568607574, "answer_id": 57950334, "question_id": 57949954, "link": "https://stackoverflow.com/questions/57949954/how-to-to-elegantly-make-slice-append-safe/57950334#57950334", "title": "How to to elegantly make slice append safe", "body": "<p>To force allocation of a new backing array in append, use a slice with equal length and capacity.  Create that slice with the three value <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">slice expression</a>.</p>\n\n<pre><code>newSlice = append(newSlice[:len(newSlice):len(newSlice)], 70)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-s15uYlJiaI\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>As noted in the question, you can also create a slice with equal length and capacity using:</p>\n\n<pre><code>newSlice := slice[2:4:4]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/klqXDGWoroD\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 329, "user_id": 772528, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/6845d7b19bae18988bd4d181ce6bf455?s=128&d=identicon&r=PG", "display_name": "ChandlerSong", "link": "https://stackoverflow.com/users/772528/chandlersong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1568617906, "creation_date": 1568603578, "last_edit_date": 1568617906, "question_id": 57949954, "link": "https://stackoverflow.com/questions/57949954/how-to-to-elegantly-make-slice-append-safe", "title": "How to to elegantly make slice append safe", "body": "<pre><code>slice := []int{10, 20, 30, 40, 50,60}\n\nnewSlice := slice[2:4:5]\n\n\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n\nnewSlice = append(newSlice,70)\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n\nnewSlice = append(newSlice,80)\n\nfmt.Printf(\"old slice is %d \\n\", slice)\nfmt.Printf(\"new slice is %d \\n\", newSlice)\n</code></pre>\n\n<p>and the output will be</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>old slice is [10 20 30 40 50 60] \nnew slice is [30 40] \nold slice is [10 20 30 40 70 60] \nnew slice is [30 40 70] \nold slice is [10 20 30 40 70 60] \nnew slice is [30 40 70 80] \n</code></pre>\n\n<p>the append have the different behavior. I know the reason why cause the append have different behavior. Because the new and old share the array when the new slice capacity is more than length, but append 80, capacity is not big enough, so it creates a new array. So check capacity will to avoid append have different behavior or I can define the new slice <code>newSlice := slice[2:4:4]</code></p>\n\n<p>Is there any elegant solution? Because check before each append is a little ugly, and in some situation, I hope the old and new can share the slice all the time. How to make it happened elegant?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1568736539, "post_id": 57952218, "comment_id": 102365876, "body": "Thanks for your answer. If I make a second User struct (which is not that clean in my opinion) It must have a different name. I assume I have to tell gorm to look on the User table even though the model has a different name, correct?"}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "reply_to_user": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 0, "creation_date": 1568737905, "post_id": 57952218, "comment_id": 102366452, "body": "Of course, if you define a second type struct, it will have a different name. You will use the second type struct only as <code>Find</code> parameters"}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 3, "last_activity_date": 1568619121, "creation_date": 1568619121, "answer_id": 57952218, "question_id": 57949645, "link": "https://stackoverflow.com/questions/57949645/gorm-query-without-gorm-model-columns/57952218#57952218", "title": "Gorm query without gorm.Model columns", "body": "<p>You can define your <code>User</code> type without including <code>gorm.Model</code> struct</p>\n\n<pre><code>type User struct{\n    Firstname string\n    Lastname string\n}\n</code></pre>\n\n<p>Alternatively, you can use two types, one with <code>gorm.Model</code> and the second without it. You can use the latter when retrieving values without <code>gorm.Model</code> properties. </p>\n"}], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 57952218, "answer_count": 1, "score": 2, "last_activity_date": 1568619121, "creation_date": 1568600220, "last_edit_date": 1568618020, "question_id": 57949645, "link": "https://stackoverflow.com/questions/57949645/gorm-query-without-gorm-model-columns", "title": "Gorm query without gorm.Model columns", "body": "<p>How can I omit the columns that come from the gorm.Model. E.g. CreatedDate, modifiedDate.</p>\n\n<p>Consider the following model:</p>\n\n<pre><code>type User struct{\n    gorm.Model\n    Firstname string\n    Lastname string\n}\n</code></pre>\n\n<p>Now I can select specific column with:</p>\n\n<pre><code>db.Select(\"Firstname\").Find(&amp;users)\n</code></pre>\n\n<p>However, while it excludes the Lastname column, it does not exclude the columns that come from the gorm.Model. So the result would look something like:</p>\n\n<pre><code>[{\"ID\":0,\"CreatedAt\":\"0001-01-01T00:00:00Z\",\"UpdatedAt\":\"0001-01-01T00:00:00Z\",\"DeletedAt\":null,\"Firstname\":\"Foobar\"}]\n</code></pre>\n\n<p>I want only the Firstname column.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1568612593, "post_id": 57949336, "comment_id": 102314176, "body": "Not <i>precisely</i> a duplicate, but see <a href=\"https://stackoverflow.com/q/122400/1256452\">stackoverflow.com/q/122400/1256452</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11844632, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gK71TNJaZIY/AAAAAAAAAAI/AAAAAAAAABA/YcySMFTfqqk/photo.jpg?sz=128", "display_name": "janbar", "link": "https://stackoverflow.com/users/11844632/janbar"}, "edited": false, "score": 0, "creation_date": 1568597044, "post_id": 57949362, "comment_id": 102311556, "body": "Thank you so much. I have checked. It&#39;s really a problem."}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "reply_to_user": {"reputation": 13, "user_id": 11844632, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gK71TNJaZIY/AAAAAAAAAAI/AAAAAAAAABA/YcySMFTfqqk/photo.jpg?sz=128", "display_name": "janbar", "link": "https://stackoverflow.com/users/11844632/janbar"}, "edited": false, "score": 0, "creation_date": 1568622266, "post_id": 57949362, "comment_id": 102317993, "body": "@janbar if this answer satisfies your question, then please accept it."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 4, "last_activity_date": 1568596821, "creation_date": 1568596821, "answer_id": 57949362, "question_id": 57949336, "link": "https://stackoverflow.com/questions/57949336/how-to-use-os-open-when-no-such-file-return-err-is-nil/57949362#57949362", "title": "How to use os.Open when no such file return err is nil", "body": "<p>Are you using Windows by any chance? \"con\" is a reserved file name, a relic of the DOS days.</p>\n"}], "owner": {"reputation": 13, "user_id": 11844632, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gK71TNJaZIY/AAAAAAAAAAI/AAAAAAAAABA/YcySMFTfqqk/photo.jpg?sz=128", "display_name": "janbar", "link": "https://stackoverflow.com/users/11844632/janbar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 57949362, "answer_count": 1, "score": 1, "last_activity_date": 1568657019, "creation_date": 1568596460, "last_edit_date": 1568657019, "question_id": 57949336, "link": "https://stackoverflow.com/questions/57949336/how-to-use-os-open-when-no-such-file-return-err-is-nil", "title": "How to use os.Open when no such file return err is nil", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    f := \"D:\\\\cron\"\n    fmt.Println(os.Stat(f))\n    fmt.Println(os.Open(f))\n\n    f = \"D:\\\\con\"\n    fmt.Println(os.Stat(f))\n    fmt.Println(os.Open(f))\n}\n\nresult\uff1a\n&lt;nil&gt; CreateFile D:\\cron: The system cannot find the file specified.\n&lt;nil&gt; open D:\\cron: The system cannot find the file specified.\n&lt;nil&gt; CreateFile D:\\con: The parameter is incorrect.\n&amp;{0xc000086a00} &lt;nil&gt;\n</code></pre>\n\n<p>I think when the file doesn't exist,os.Open should return err != nil<br>\nBut I wonder why \"D:\\con\" returns err == nil</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1568589551, "post_id": 57948841, "comment_id": 102310607, "body": "See <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a> for the recommended way of managing package versions."}, {"owner": {"reputation": 324, "user_id": 5654201, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-foGBZQy_xpw/AAAAAAAAAAI/AAAAAAAAABs/mzkiWQ2JKYM/photo.jpg?sz=128", "display_name": "Ben Sarah Golightly", "link": "https://stackoverflow.com/users/5654201/ben-sarah-golightly"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568589726, "post_id": 57948841, "comment_id": 102310625, "body": "@CeriseLim&#243;n that looks right - make it an answer I&#39;ll accept it"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1568590171, "creation_date": 1568590171, "answer_id": 57948915, "question_id": 57948841, "link": "https://stackoverflow.com/questions/57948841/managing-hardcoded-import-paths/57948915#57948915", "title": "managing hardcoded import paths", "body": "<p>See <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a> for the recommended way of managing package versions.</p>\n"}], "owner": {"reputation": 324, "user_id": 5654201, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-foGBZQy_xpw/AAAAAAAAAAI/AAAAAAAAABs/mzkiWQ2JKYM/photo.jpg?sz=128", "display_name": "Ben Sarah Golightly", "link": "https://stackoverflow.com/users/5654201/ben-sarah-golightly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 57948915, "answer_count": 1, "score": -1, "last_activity_date": 1568657033, "creation_date": 1568589160, "last_edit_date": 1568657033, "question_id": 57948841, "link": "https://stackoverflow.com/questions/57948841/managing-hardcoded-import-paths", "title": "managing hardcoded import paths", "body": "<p>In Go, it is common that some packages are versioned. So a program might look like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-gl/gl/v3.3-core/gl\"\n    \"github.com/go-gl/glfw/v3.2/glfw\"\n)\n\n// ... do stuff\n</code></pre>\n\n<p>Sometimes, I might want to update the version of glfw. Lets imagine GLFW 3.3 bindings come to Go and I want to update from 3.2.</p>\n\n<p>I might have multiple Go files in a project all using glfw. I don't want to go into each of them and update the version of the import by hand. Ideally I wouldn't be copying that long path around, either, and I could define it in one place per project.</p>\n\n<ul>\n<li>Maybe I could write a script to find+replace \"github.com/go-gl/glfw/v3.2/glfw\"</li>\n<li>Maybe I could template the file with Genny</li>\n<li>Maybe I could create a symlink inside the root Go path \"glfw\" -> \"github.com/go-gl/glfw/v3.2/glfw\", update it when changing version, and just use <code>import \"glfw\"</code>\n\n<ul>\n<li>but this information then lives \"outside\" the project, so no-one cloning my project knows what version to use</li>\n<li>but this is a global change and I might have multiple projects which want to depend on different versions</li>\n</ul></li>\n</ul>\n\n<p>Ideally I would be able to do something like this in each source file:</p>\n\n<pre><code>package main\n\nimport (\n    $gl\n    $glfw\n)\n</code></pre>\n\n<p>And in some project-level dot file, something like:</p>\n\n<pre><code>gl=github.com/go-gl/gl/v3.3-core/gl\nglfw=github.com/go-gl/glfw/v3.2/glfw\n</code></pre>\n\n<p>Or, a command-line argument attached to <code>go build</code> defining constants that could look something like:</p>\n\n<pre><code>go build -Dgl=github.com/go-gl/gl/v3.3-core/gl -Dglfw=github.com/go-gl/glfw/v3.2/glfw\n</code></pre>\n\n<p>How is everyone else handling this currently?</p>\n"}, {"tags": ["amazon-web-services", "go", "nginx", "websocket", "aws-application-load-balancer"], "comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1568652792, "post_id": 57948583, "comment_id": 102334097, "body": "<i>&quot;that traffic is being directed to HTTPS&quot;</i> presumably means <b>redirected</b> and if so, that explains perfectly why you are getting a 301.  Change the web socket URL to <code>wss:&#47;&#47;</code> -- <code>let socket = new WebSocket(&quot;wss:&#47;&#47;...</code>."}, {"owner": {"reputation": 103, "user_id": 6610071, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m2m7P.png?s=128&g=1", "display_name": "CJMobileApps", "link": "https://stackoverflow.com/users/6610071/cjmobileapps"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1568689955, "post_id": 57948583, "comment_id": 102344311, "body": "@Michael-sqlbot Thanks this worked!"}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 6610071, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m2m7P.png?s=128&g=1", "display_name": "CJMobileApps", "link": "https://stackoverflow.com/users/6610071/cjmobileapps"}, "edited": false, "score": 0, "creation_date": 1568690064, "post_id": 57948876, "comment_id": 102344333, "body": "This partly worked also had to change <b>ws://</b> to <b>wss://</b>"}], "tags": [], "owner": {"reputation": 63596, "user_id": 2314073, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/buvFz.png?s=128&g=1", "display_name": "Juned Ahsan", "link": "https://stackoverflow.com/users/2314073/juned-ahsan"}, "is_accepted": false, "score": 2, "last_activity_date": 1568590177, "last_edit_date": 1568590177, "creation_date": 1568589604, "answer_id": 57948876, "question_id": 57948583, "link": "https://stackoverflow.com/questions/57948583/websocket-connection-fails-with-301-while-using-go-on-aws-application-load-balan/57948876#57948876", "title": "WebSocket connection fails with 301 while using Go on AWS Application Load Balancer", "body": "<p>First check that you have everything correct in terms of AWS ALB config and the requests are reaching the Nginx server, which you can check in the logs. Also try to hit your websocket URL through Nginx. You need an additional config in Nginx to support websockets under your location as mentioned here :</p>\n\n<pre><code>proxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"Upgrade\";\n</code></pre>\n\n<p>I have experienced the same issue and using this config thing started to work like a breeze.</p>\n\n<p>Reference : <a href=\"http://nginx.org/en/docs/http/websocket.html\" rel=\"nofollow noreferrer\">Nginx WebSocket proxying</a></p>\n\n<p><strong>Note</strong>: Websockets work with AWS ALB for sure, so don't doubt that part.</p>\n"}, {"tags": [], "owner": {"reputation": 103, "user_id": 6610071, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m2m7P.png?s=128&g=1", "display_name": "CJMobileApps", "link": "https://stackoverflow.com/users/6610071/cjmobileapps"}, "is_accepted": true, "score": 0, "last_activity_date": 1568690416, "creation_date": 1568690416, "answer_id": 57966894, "question_id": 57948583, "link": "https://stackoverflow.com/questions/57948583/websocket-connection-fails-with-301-while-using-go-on-aws-application-load-balan/57966894#57966894", "title": "WebSocket connection fails with 301 while using Go on AWS Application Load Balancer", "body": "<p>I was able to get it to work by combining both answers.</p>\n\n<p>nginx.conf now looks like</p>\n\n<pre><code>http {\n  server_tokens off;\n  server {\n    listen 80;\n\n    location / {\n      proxy_set_header X-Forwarded-For $remote_addr;\n      proxy_set_header Host            $http_host;\n      proxy_pass http://web:8080/;\n    }\n\n    location /websocket {\n           proxy_http_version 1.1;\n           proxy_set_header Upgrade $http_upgrade;\n           proxy_set_header Connection \"upgrade\";\n           proxy_pass http://web:8080/websocket;\n    }\n  }\n}\n</code></pre>\n\n<p>Then change the JavaScript file <strong>ws://</strong> to <strong>wss://</strong></p>\n\n<pre><code>&lt;script&gt;\n    let socket = new WebSocket(\"wss://myexamplesite.com/websocket\")\n\n    console.log(\"Attempting Websocket Connection\")\n\n    socket.onopen = () =&gt; {\n        console.log(\"Successfully Connected\");\n        socket.send(\"Hi From the Client!\")\n    }\n\n    socket.onclose = (event) =&gt; {\n        console.log(\"Socket Closed Connection: \", event)\n    }\n\n    socket.onmessage = (msg) =&gt; {\n        console.log(msg);\n    }\n\n    socket.onerror = (error) =&gt; {\n        console.log(\"Socket Error: \", error)\n    }\n&lt;/script&gt;\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 6610071, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m2m7P.png?s=128&g=1", "display_name": "CJMobileApps", "link": "https://stackoverflow.com/users/6610071/cjmobileapps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2127, "favorite_count": 0, "accepted_answer_id": 57966894, "answer_count": 2, "score": 0, "last_activity_date": 1568690416, "creation_date": 1568585814, "question_id": 57948583, "link": "https://stackoverflow.com/questions/57948583/websocket-connection-fails-with-301-while-using-go-on-aws-application-load-balan", "title": "WebSocket connection fails with 301 while using Go on AWS Application Load Balancer", "body": "<p>I'm trying to run a Go Server with WebSockets on an AWS Application Load Balancer but I am getting an <strong>'Error during WebSocket handshake: Unexpected response code: 301'</strong>. </p>\n\n<p>AWS says that The Application Load Balancers supports WebSockets via <strong>ws://</strong> protocols but I can not find any further documentation other than the following:</p>\n\n<p>Here's <a href=\"https://aws.amazon.com/blogs/aws/new-aws-application-load-balancer/\" rel=\"nofollow noreferrer\">aws load-balancer link</a></p>\n\n<blockquote>\n  <p>The Application Load Balancer supports two additional protocols: WebSocket and HTTP/2.</p>\n  \n  <p>WebSocket allows you to set up long-standing TCP connections between your client and your server. This is a more efficient alternative to the old-school method which involved HTTP connections that were held open with a \u201cheartbeat\u201d for very long periods of time. WebSocket is great for mobile devices and can be used to deliver stock quotes, sports scores, and other dynamic data while minimizing power consumption. ALB provides native support for WebSocket via the ws:// and wss:// protocols.</p>\n</blockquote>\n\n<p>I can get JavaScript to connect to my Go server via WebSockets locally but when I deploy AWS it does not work. This is when the JavaScript displays a 301 error.</p>\n\n<p>The Application Load Balancer is listening on <strong>HTTP: 80</strong> and that traffic is being directed to <strong>HTTPS: 443</strong>. All of the Security Groups are pretty much similarly set up to allow traffic through. If I do a normal GET call to retrieve data from my server while deployed on AWS it works perfectly fine.</p>\n\n<p>Local call that works to connect to localhost</p>\n\n<pre><code>&lt;script&gt;\n    let socket = new WebSocket(\"ws://localhost:8080/websocket\")\n\n    console.log(\"Attempting Websocket Connection\")\n\n    socket.onopen = () =&gt; {\n        console.log(\"Successfully Connected\");\n        socket.send(\"Hi From the Client!\")\n    }\n\n    socket.onclose = (event) =&gt; {\n        console.log(\"Socket Closed Connection: \", event)\n    }\n\n    socket.onmessage = (msg) =&gt; {\n        console.log(msg);\n    }\n\n    socket.onerror = (error) =&gt; {\n        console.log(\"Socket Error: \", error)\n    }\n&lt;/script&gt;\n</code></pre>\n\n<p>Connect to remote server that does not work.</p>\n\n<pre><code>&lt;script&gt;\n    let socket = new WebSocket(\"ws://myexamplesite.com/websocket\")\n\n    console.log(\"Attempting Websocket Connection\")\n\n    socket.onopen = () =&gt; {\n        console.log(\"Successfully Connected\");\n        socket.send(\"Hi From the Client!\")\n    }\n\n    socket.onclose = (event) =&gt; {\n        console.log(\"Socket Closed Connection: \", event)\n    }\n\n    socket.onmessage = (msg) =&gt; {\n        console.log(msg);\n    }\n\n    socket.onerror = (error) =&gt; {\n        console.log(\"Socket Error: \", error)\n    }\n&lt;/script&gt;\n</code></pre>\n\n<p>nginx.conf </p>\n\n<pre><code>events {\n    worker_connections 1024;\n}\n\nhttp {\n  server_tokens off;\n  server {\n    listen 80;\n\n    location / {\n      proxy_set_header X-Forwarded-For $remote_addr;\n      proxy_set_header Host            $http_host;\n      proxy_pass http://web:8080/;\n    }\n  }\n}\n</code></pre>\n\n<p>I expect to be able to establish a WebSocket connection but the following error is returning from the JavaScript file: </p>\n\n<p><em>WebSocket connection to 'ws://myexamplesite.com/websocket' failed: Error during WebSocket handshake: Unexpected response code: 301</em></p>\n"}, {"tags": ["xml", "parsing", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568586242, "post_id": 57948561, "comment_id": 102310103, "body": "It might help if you check the error from unmarshal. Then, you can printf the record (or use a debugger), and see what&#39;s in it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1568646583, "post_id": 57948561, "comment_id": 102331225, "body": "&quot;Go is not recognizing the structs&quot; meaning what exactly? What error(s) are you getting?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1568618591, "last_edit_date": 1568618591, "creation_date": 1568586637, "answer_id": 57948649, "question_id": 57948561, "link": "https://stackoverflow.com/questions/57948561/parsing-xml-file-using-go/57948649#57948649", "title": "Parsing XML file using Go", "body": "<p>Your code doesn't even compile. You need to index the slices inside the loops, you can't refer to fields of elements of slices without indexing them. Also <code>Record.Controlfield</code> and <code>Record.Datafield</code> are not \"related\", it's senseless to process them with embedded loops.</p>\n\n<p>However, you do need to use nested loops to check <code>Subfield</code> of a <code>Datafield</code> whose tag matches.</p>\n\n<p>Something like this:</p>\n\n<pre><code>for i := range record.Datafield {\n    df := &amp;record.Datafield[i]\n    if df.Tag == \"650\" {\n        for j := range df.Subfield {\n            if df.Subfield[j].Code == \"a\" {\n                fmt.Println(\"Kind of Music: \" + df.Subfield[j].Text)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/HJci3jO9T94\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note that you could use <code>for range</code> to also \"get\" the element at the given index, but since you have some kind of generated struct which uses anonymous structs (and not pointers), such a loop would copy all elements (hence I stayed with \"manual indexing\").</p>\n\n<p>Also do check all errors, e.g. <code>ioutil.ReadAll(xmlFile)</code> and <code>xml.Unmarshal(data, &amp;record)</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 10486176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d1230535efa4a9cdf09783c778f4478?s=128&d=identicon&r=PG&f=1", "display_name": "DPC", "link": "https://stackoverflow.com/users/10486176/dpc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 57948649, "answer_count": 1, "score": 1, "last_activity_date": 1568618591, "creation_date": 1568585581, "question_id": 57948561, "link": "https://stackoverflow.com/questions/57948561/parsing-xml-file-using-go", "title": "Parsing XML file using Go", "body": "<p>I'm new on Go. I have a task to do where I have a xml file with the following structure. There many other tag record in this file. </p>\n\n<p>I need to read all the records, and print the information about the Kind of music but only where datafield tag is equal \"650\" and the subfield code tag = \"a\".  </p>\n\n<pre><code>&lt;record&gt;\n  &lt;leader&gt;01153cjm a22002771a 4500&lt;/leader&gt;\n  &lt;controlfield tag=\"001\"&gt;   00000838 &lt;/controlfield&gt;\n  &lt;controlfield tag=\"003\"&gt;DLC&lt;/controlfield&gt;\n  &lt;controlfield tag=\"005\"&gt;20030506181700.0&lt;/controlfield&gt;\n  &lt;controlfield tag=\"007\"&gt;sd|zsngnnmmned&lt;/controlfield&gt;\n  &lt;controlfield tag=\"008\"&gt;000824s1998    nyuppn                  d&lt;/controlfield&gt;\n  &lt;datafield tag=\"050\" ind1=\"0\" ind2=\"0\"&gt;\n    &lt;subfield code=\"a\"&gt;SDA 16949&lt;/subfield&gt;\n  &lt;/datafield&gt;\n  &lt;datafield tag=\"010\" ind1=\" \" ind2=\" \"&gt;\n    &lt;subfield code=\"a\"&gt;   00000838 &lt;/subfield&gt;\n  &lt;/datafield&gt;\n  &lt;datafield tag=\"020\" ind1=\" \" ind2=\" \"&gt;\n    &lt;subfield code=\"c\"&gt;$15.98&lt;/subfield&gt;\n  &lt;/datafield&gt;\n  &lt;datafield tag=\"024\" ind1=\"1\" ind2=\" \"&gt;\n    &lt;subfield code=\"a\"&gt;601215312621&lt;/subfield&gt;\n  &lt;/datafield&gt;\n  &lt;datafield tag=\"650\" ind1=\" \" ind2=\"0\"&gt;\n    &lt;subfield code=\"a\"&gt;Rap (Music)&lt;/subfield&gt;\n  &lt;/datafield&gt;\n&lt;/record&gt;\n\n</code></pre>\n\n<p>My code is:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\ntype Record struct {\n    XMLName      xml.Name `xml:\"record\"`\n    Text         string   `xml:\",chardata\"`\n    Leader       string   `xml:\"leader\"`\n    Controlfield []struct {\n        Text string `xml:\",chardata\"`\n        Tag  string `xml:\"tag,attr\"`\n    } `xml:\"controlfield\"`\n    Datafield []struct {\n        Text     string `xml:\",chardata\"`\n        Tag      string `xml:\"tag,attr\"`\n        Ind1     string `xml:\"ind1,attr\"`\n        Ind2     string `xml:\"ind2,attr\"`\n        Subfield []struct {\n            Text string `xml:\",chardata\"`\n            Code string `xml:\"code,attr\"`\n        } `xml:\"subfield\"`\n    } `xml:\"datafield\"`\n}\n\nfunc main() {\n\n    xmlFile, err := os.Open(\"music_lite3.xml\")\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Successfully Opened music_lite3.xml\")\n\n    defer xmlFile.Close()\n\n    data, _ := ioutil.ReadAll(xmlFile)\n\n    var record Record\n\n    xml.Unmarshal(data, &amp;record)\n\n    for j := 0; j &lt; len(record.Controlfield); j++ {\n        for i := 0; i &lt; len(record.Datafield); i++ {\n            if record.Datafield == \"650\" {\n                if record.Datafield.Subfield.Code == \"a\" {\n                    fmt.Println(\"Kind of Music: \" + record.Datafield.Subfield.Text)\n                }\n            }\n        }\n    }\n}\n\n</code></pre>\n\n<p>I'm having problems to acess the structs datafield and subfield. \nIt seems that when a call record.Datafield and record.Datafield.Subfield.Code \nGo is not recognizing the structs. </p>\n\n<p>Anyone can help me?\nThanks in advance.</p>\n\n<p>=)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1884, "user_id": 5669031, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9cbfb0e0c069667a5ecf8f9e07f196aa?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Saremi", "link": "https://stackoverflow.com/users/5669031/jeff-saremi"}, "is_accepted": false, "score": 0, "last_activity_date": 1568672885, "creation_date": 1568672885, "answer_id": 57965127, "question_id": 57948255, "link": "https://stackoverflow.com/questions/57948255/incremental-build-with-go-build-or-go-install-does-not-work/57965127#57965127", "title": "Incremental build with go build (or go install) does not work", "body": "<p>I needed to upgrade to go 1.13\nI was using 1.09</p>\n"}], "owner": {"reputation": 1884, "user_id": 5669031, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9cbfb0e0c069667a5ecf8f9e07f196aa?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Saremi", "link": "https://stackoverflow.com/users/5669031/jeff-saremi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568672885, "creation_date": 1568582373, "question_id": 57948255, "link": "https://stackoverflow.com/questions/57948255/incremental-build-with-go-build-or-go-install-does-not-work", "title": "Incremental build with go build (or go install) does not work", "body": "<p>I have a go project and not much exposure to Go! I am issuing the command <code>go build</code> or <code>go install</code> repeatedly, with absolutely no changes or modifications to the source code</p>\n\n<p>Example:</p>\n\n<pre><code>${GOLANGBIN}/go build -v -i -o $(OUTPUT_DIRECTORY)/bin/main src/main\n</code></pre>\n\n<p>I am expecting that after the first time, my binaries not get updated at all. However, after each build, my binaries are up to the date with the latest timestamp.</p>\n\n<p>Is Go capable of only building what needs to be built (since last time) and not build what is already up to date?</p>\n"}, {"tags": ["sockets", "go"], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 0, "last_activity_date": 1568586998, "creation_date": 1568586998, "answer_id": 57948677, "question_id": 57947174, "link": "https://stackoverflow.com/questions/57947174/get-service-name-by-port/57948677#57948677", "title": "get service name by port", "body": "<p>You can modify the code from that netdb library to load a <code>services</code> file you provide <a href=\"https://github.com/dominikh/go-netdb/blob/master/netdb.go#L71\" rel=\"nofollow noreferrer\">instead of <code>/etc/services</code></a>.</p>\n\n<p>Perhaps better yet, since this is essentially just a key/value mapping, create a <code>ports.go</code> file with:</p>\n\n<pre><code>var tcpPorts = map[int]string{\n    80: \"http\"\n    // ...\n}\n</code></pre>\n\n<p>And then do a regular map lookup.</p>\n\n<p>To list all TCP ports you can do something like:</p>\n\n<pre><code>$ sed -E '/tcp$/!d; s!^([a-zA-Z0-9\\-]+)\\s+([0-9]+)/\\w+!\\t\\2: \"\\1\",!;' /etc/services\n1: \"tcpmux\",\n2: \"compressnet\",\n3: \"compressnet\",\n5: \"rje\",\n7: \"echo\",\n9: \"discard\",\n11: \"systat\",\n13: \"daytime\",\n17: \"qotd\",\n19: \"chargen\",\n.. many more ..\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 10289856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aqjWf.jpg?s=128&g=1", "display_name": "Anton Gult", "link": "https://stackoverflow.com/users/10289856/anton-gult"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568586998, "creation_date": 1568572754, "last_edit_date": 1568580265, "question_id": 57947174, "link": "https://stackoverflow.com/questions/57947174/get-service-name-by-port", "title": "get service name by port", "body": "<p>I'm writing simple net scanner and stuck at resolving service name by port number. What's the best way to do this? I supposed it should be something like python's <code>socket.getservbyport()</code> and founded <a href=\"https://godoc.org/honnef.co/go/netdb\" rel=\"nofollow noreferrer\">this lib</a>, but unfortunately Dev environment bases on Windows, also I wanted built-in solution not a parsers.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"strings\"\n    \"sync\"\n    \"time\"\n)\n\ntype PortScanner struct {\n    ip string\n}\n\nfunc ScanPort(ip string, port int, timeout time.Duration) {\n    target := fmt.Sprintf(\"%s:%d\", ip, port)\n    conn, err := net.DialTimeout(\"tcp\", target, timeout)\n    if err != nil {\n        if strings.Contains(err.Error(), \"too many open files\") {\n            time.Sleep(timeout)\n            ScanPort(ip, port, timeout)\n        }\n        return\n    }\n\n    if err = conn.Close(); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(port, \"open\")\n}\n\nfunc (ps *PortScanner) Start(f, l int, timeout time.Duration) {\n    wg := sync.WaitGroup{}\n    defer wg.Wait()\n\n    for port := f; port &lt;= l; port++ {\n        wg.Add(1)\n        go func(port int) {\n            defer wg.Done()\n            ScanPort(ps.ip, port, timeout)\n        }(port)\n    }\n}\n\nfunc main() {\n    ps := &amp;PortScanner{ip: \"127.0.0.1\"}\n    ps.Start(1, 65535, 500*time.Millisecond)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568572081, "post_id": 57946924, "comment_id": 102307212, "body": "<code>string(ipaddr[:])</code> seems to just return an empty string. Also, according to <a href=\"https://en.wikipedia.org/wiki/IP_address#IPv4_addresses\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/IP_address#IPv4_addresses</a>, an IPv4 address consists of 32 bits or 4 bytes, so I believe the problem is stated realistically."}], "answers": [{"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": true, "score": 4, "last_activity_date": 1568571962, "creation_date": 1568571962, "answer_id": 57947045, "question_id": 57946924, "link": "https://stackoverflow.com/questions/57946924/how-to-convert-an-array-of-bytes-to-an-array-of-strings-in-go/57947045#57947045", "title": "How to convert an array of bytes to an array of strings in Go?", "body": "<p>Add this method:</p>\n\n<pre><code>func (a IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", a[0], a[1], a[2], a[3])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1568571977, "creation_date": 1568571977, "answer_id": 57947048, "question_id": 57946924, "link": "https://stackoverflow.com/questions/57946924/how-to-convert-an-array-of-bytes-to-an-array-of-strings-in-go/57947048#57947048", "title": "How to convert an array of bytes to an array of strings in Go?", "body": "<p>Instead of <code>string(b)</code>, try <code>strconv.Itoa(int(b))</code> to convert the numeric value to a string.</p>\n"}, {"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": false, "score": 2, "last_activity_date": 1568572562, "creation_date": 1568572562, "answer_id": 57947142, "question_id": 57946924, "link": "https://stackoverflow.com/questions/57946924/how-to-convert-an-array-of-bytes-to-an-array-of-strings-in-go/57947142#57947142", "title": "How to convert an array of bytes to an array of strings in Go?", "body": "<p>Independently, I came up with the same solution as outlined by <a href=\"https://stackoverflow.com/users/11923999/bserdar\">bserdar</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype IPAddr [4]byte\n\nfunc (ipaddr IPAddr) String() string {\n    ipaddrStrings := make([]string, 4)\n    for i, b := range ipaddr {\n        ipaddrStrings[i] = strconv.Itoa(int(b))\n    }\n    return strings.Join(ipaddrStrings, \".\")\n}\n\nfunc main() {\n    hosts := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for name, ip := range hosts {\n        fmt.Printf(\"%v: %v\\n\", name, ip)\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>This prints:</p>\n\n<pre><code>loopback: 127.0.0.1\ngoogleDNS: 8.8.8.8\n</code></pre>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57947045, "answer_count": 3, "score": 2, "last_activity_date": 1568572562, "creation_date": 1568571270, "question_id": 57946924, "link": "https://stackoverflow.com/questions/57946924/how-to-convert-an-array-of-bytes-to-an-array-of-strings-in-go", "title": "How to convert an array of bytes to an array of strings in Go?", "body": "<p>I'm trying to complete this exercise in the Tour of Go, <a href=\"https://tour.golang.org/methods/18\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/18</a>, to implement a <code>String()</code> method for an <code>IPAddr</code> type consisting of an array of four bytes. So far I've tried:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\ntype IPAddr [4]byte\n\nfunc (ipaddr IPAddr) String() string {\n    ipaddrStrings := make([]string, 4)\n    for i, b := range ipaddr {\n        ipaddrStrings[i] = string(b)\n    }\n    return strings.Join(ipaddrStrings, \".\")\n}\n\nfunc main() {\n    hosts := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for name, ip := range hosts {\n        fmt.Printf(\"%v: %v\\n\", name, ip)\n    }\n}\n</code></pre>\n\n<p>However, this prints</p>\n\n<pre><code>loopback: ...\ngoogleDNS:.\n</code></pre>\n\n<p>I've also tried, following <a href=\"https://programming.guide/go/convert-byte-slice-to-string.html\" rel=\"nofollow noreferrer\">https://programming.guide/go/convert-byte-slice-to-string.html</a>, to do <code>string(ipaddr)</code>, but this results in a</p>\n\n<pre><code>cannot convert ipaddr (type IPAddr) to type string\n</code></pre>\n\n<p>How can I complete this exercise?</p>\n"}, {"tags": ["arrays", "go", "slice", "shuffle", "letter"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568570673, "post_id": 57946792, "comment_id": 102306870, "body": "In the nested for-loop, you  have an <code>if i==0</code> condition, which is always true the first time that loop runs, so it returns without executing the rest of the code. Inner for-loop index <code>i</code> is shadowing the outer loop <code>i</code>, so maybe that&#39;s the source of your confusion."}, {"owner": {"reputation": 11, "user_id": 12070983, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nxije1exjWM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7MKwJ1-84eyvVqihinGBeiB0UgQ/photo.jpg?sz=128", "display_name": "Katrin Cullen", "link": "https://stackoverflow.com/users/12070983/katrin-cullen"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568571091, "post_id": 57946792, "comment_id": 102306954, "body": "but how to fix so that i it will print and shuffle?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568572904, "post_id": 57946792, "comment_id": 102307466, "body": "With the way you&#39;re doing it, you&#39;ll lose word boundaries and punctuation. So I suggest you change your algorithm. One way you can do this is to convert your string to a []rune, and iterate the elements. As you&#39;re iterating, find out word boundaries, shuffle the bytes in between using rand.Shuffle, and convert the resulting []rune to string and return."}, {"owner": {"reputation": 11, "user_id": 12070983, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nxije1exjWM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7MKwJ1-84eyvVqihinGBeiB0UgQ/photo.jpg?sz=128", "display_name": "Katrin Cullen", "link": "https://stackoverflow.com/users/12070983/katrin-cullen"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568573578, "post_id": 57946792, "comment_id": 102307652, "body": "can you explain with some code example?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1568574089, "post_id": 57946792, "comment_id": 102307768, "body": "I can&#39;t write the code for you, but the algorithm I described need to keep a state variable that tells whether you&#39;re in a word or not. When you&#39;re not in a word if you see a letter (unicode.IsLetter), you change the state variable, and continue as long as you see letters. When you see a non-letter, that gives you the end of the word. Then, you can shuffle the runes between word start+1:word end-1, and continue."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1568643661, "last_edit_date": 1568643661, "creation_date": 1568642875, "answer_id": 57958629, "question_id": 57946792, "link": "https://stackoverflow.com/questions/57946792/how-to-fix-this-code-so-that-it-shuffles-letters-and-has-no-affect-on-first-lett/57958629#57958629", "title": "How to fix this code so that it shuffles letters and has no affect on first letter and last letter, punctuation", "body": "<blockquote>\n  <p>I'm very new to goland/go.</p>\n</blockquote>\n\n<hr>\n\n<p>Avoid writing programs in a new language as if you are still writing programs in an old language.</p>\n\n<hr>\n\n<blockquote>\n  <p>write code that takes a string and seed. It should return a shuffled\n  string where the 1st and last letters in the word, punctuation and\n  numbers are untouched.</p>\n  \n  <p>Example:</p>\n\n<pre><code>my name is Nikki. My number is 333\n</code></pre>\n  \n  <p>should be</p>\n\n<pre><code>my nmae is Nkiki. My nebumr is 333\n</code></pre>\n</blockquote>\n\n<p>Here is a solution written in Go.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"unicode\"\n)\n\nfunc shuffle(word []rune, rand *rand.Rand) {\n    if len(word) &lt; 4 {\n        return\n    }\n    chars := word[1 : len(word)-1]\n    rand.Shuffle(\n        len(chars),\n        func(i, j int) {\n            chars[i], chars[j] = chars[j], chars[i]\n        },\n    )\n}\n\nfunc scramble(text string, seed int64) string {\n    rand := rand.New(rand.NewSource(seed))\n\n    chars := []rune(text)\n    inWord := false\n    i := 0\n    for j, char := range chars {\n        if !unicode.IsLetter(char) {\n            if inWord {\n                shuffle(chars[i:j], rand)\n            }\n            inWord = false\n        } else if !inWord {\n            inWord = true\n            i = j\n        }\n    }\n    if inWord {\n        shuffle(chars[i:len(chars)], rand)\n    }\n    return string(chars)\n}\n\nfunc main() {\n    for _, text := range []string{\n        \"my name is Nikki. My number is 333\",\n        \"The quick brown fox jumps over the lazy dog.\",\n        loremipsum,\n    } {\n        fmt.Printf(\"%q\\n\", text)\n        fmt.Printf(\"%q\\n\", scramble(text, 100))\n    }\n}\n\nvar loremipsum = `\nLorem ipsum dolor sit amet, consectetur adipiscing elit, \nsed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \nUt enim ad minim veniam, \nquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. \nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. \nExcepteur sint occaecat cupidatat non proident, \nsunt in culpa qui officia deserunt mollit anim id est laborum.\n`\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/NoHXynQSD4p\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NoHXynQSD4p</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"my name is Nikki. My number is 333\"\n\"my name is Nkiki. My neubmr is 333\"\n\"The quick brown fox jumps over the lazy dog.\"\n\"The quick bowrn fox jmups over the lzay dog.\"\n\"\\nLorem ipsum dolor sit amet, consectetur adipiscing elit, \\nsed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \\nUt enim ad minim veniam, \\nquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. \\nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. \\nExcepteur sint occaecat cupidatat non proident, \\nsunt in culpa qui officia deserunt mollit anim id est laborum.\\n\"\n\"\\nLorem isupm dloor sit amet, csttunoecer andiipcsig elit, \\nsed do emiousd tepmor idinicdnut ut lorbae et dorloe mgnaa aqilua. \\nUt einm ad miinm vinaem, \\nquis notursd eioattxceirn ualmlco libroas nisi ut aqiiulp ex ea cdmoomo cuanqesot. \\nDius aute iurre dolor in rienreehredpt in vlptuotae vielt esse clulim drlooe eu fuagit nulla ptaaiurr. \\nEepuxcter snit ocecacat citapadut non prinodet, \\nsnut in cpula qui oficfia dsuenret milolt ainm id est laorbum.\\n\"\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12070983, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nxije1exjWM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7MKwJ1-84eyvVqihinGBeiB0UgQ/photo.jpg?sz=128", "display_name": "Katrin Cullen", "link": "https://stackoverflow.com/users/12070983/katrin-cullen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1568643661, "creation_date": 1568570277, "last_edit_date": 1568577034, "question_id": 57946792, "link": "https://stackoverflow.com/questions/57946792/how-to-fix-this-code-so-that-it-shuffles-letters-and-has-no-affect-on-first-lett", "title": "How to fix this code so that it shuffles letters and has no affect on first letter and last letter, punctuation", "body": "<p>I'm dealing with go/golang, trying to write code that takes a string and seed. It should return a shuffled string where the 1st and last letters in the word, punctuation and numbers are untouched.</p>\n\n<p>Example:    </p>\n\n<blockquote>\n  <p>my name is Nikki. My number is 333</p>\n</blockquote>\n\n<p>should be </p>\n\n<blockquote>\n  <p>my nmae is Nkiki. My nebumr is 333</p>\n</blockquote>\n\n<p>I'm very new to goland/go. Have tried to do it with <code>rand.Shuffle</code>: </p>\n\n<pre><code>   func splitText(text string) []string {\n    re := regexp.MustCompile(\"[A-Za-z0-9']+|[':;?().,!\\\\ ]\")\n    return re.FindAllString(text, -1)}\n\n\n    func scramble(text string, seed int64) string {\n\n    rand.Seed(seed)\n    split := splitText(text)\n\n    for i := range split {\n        e := split[i]\n\n        r := []byte(e)\n\n        for i := 0; i &lt; len(r); i++ {\n            l := len(r) - 1\n            if i == 0 {\n                return string(r[0])\n            }\n            if i == l {\n                return string(r[l])\n            }\n\n            if i &gt; 0 || i &lt; l {\n                n := rand.Intn(l)\n                x := r[i]\n                r[i] = r[n]\n                r[n] = x\n\n            }\n\n            if (r[i] &gt;= 32 &amp;&amp; r[i] &lt;= 62) || (r[i] &gt;= 91 &amp;&amp; r[i] &lt;= 96) {\n                return string(r[i])\n            }\n        }\n\n    }\n    return text\n\n}\n\nfunc main() {\n\n    v := (\"The quick brown fox jumps over the lazy dog.\")\n    scramble(v, 100)\n    fmt.Println(scramble(v, 100))\n\n}\n</code></pre>\n\n<p>But this returns only one letter and only if <code>remoe f==0</code> or <code>f==l</code>, it doesn't hop to the next word.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 739, "user_id": 7559012, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/695e8ec49e5dae82f56dd6874ff187a0?s=128&d=identicon&r=PG&f=1", "display_name": "Bonje Fir", "link": "https://stackoverflow.com/users/7559012/bonje-fir"}, "edited": false, "score": 0, "creation_date": 1568566958, "post_id": 57946247, "comment_id": 102305972, "body": "What happens to previous channel when we make a new one? Golang releases its resources? (in <code>C++</code> when you <code>new</code> an object you must <code>delete</code> it o.w. it has memory leak)? what happens here?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 739, "user_id": 7559012, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/695e8ec49e5dae82f56dd6874ff187a0?s=128&d=identicon&r=PG&f=1", "display_name": "Bonje Fir", "link": "https://stackoverflow.com/users/7559012/bonje-fir"}, "edited": false, "score": 3, "creation_date": 1568567356, "post_id": 57946247, "comment_id": 102306071, "body": "If a channel has no pointers to it, then it will be garbage collected. However, in this case you have goroutine1 still waiting to write to the channel, so the channel is still being used. However the channel is lost because you redefined the channel variable. So both the channel and the goroutine are leaked."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1568566307, "creation_date": 1568566307, "answer_id": 57946247, "question_id": 57946005, "link": "https://stackoverflow.com/questions/57946005/dangling-goroutine-in-golang/57946247#57946247", "title": "Dangling goroutine in golang", "body": "<p>For <code>i=1</code>, the loop creates two goroutines, and starts waiting to read from the channel. goroutine2 writes first and terminates. The channel is read, and then <code>i</code> becomes 2. goroutine1 will wait forever, because nobody will read from the channel again. You create a new channel, and do the same thing. When everything is said and done, you have three instances of goroutine1 waiting to write to three different channels.</p>\n"}], "owner": {"reputation": 739, "user_id": 7559012, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/695e8ec49e5dae82f56dd6874ff187a0?s=128&d=identicon&r=PG&f=1", "display_name": "Bonje Fir", "link": "https://stackoverflow.com/users/7559012/bonje-fir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 57946247, "answer_count": 1, "score": -2, "last_activity_date": 1568566307, "creation_date": 1568564537, "question_id": 57946005, "link": "https://stackoverflow.com/questions/57946005/dangling-goroutine-in-golang", "title": "Dangling goroutine in golang", "body": "<p>In the following code</p>\n\n<ol>\n<li>What happens to <code>goroutine1</code>?(at the end of program we have three goroutine <code>goroutine1</code> without any functionality)</li>\n<li>What happens to channel?(when we make a channel in loop it release the previous channel memory? close it? or something else?)</li>\n</ol>\n\n<pre><code>func main() {\n    for i := 1; i &lt;= 3; i += 1 {\n        ch := make(chan int)\n\n        // gorutine1\n        go func() {\n            time.Sleep(3 * time.Second)\n            ch &lt;- i\n            fmt.Println(\"gorutine1 end\")\n        }()\n\n        // gorutine2\n        go func() {\n            time.Sleep(1 * time.Second)\n            ch &lt;- i+1000\n            fmt.Println(\"gorutine2 end\")\n        }()\n\n        fmt.Println(\"loop\", &lt;-ch)\n    }\n\n    time.Sleep(10 * time.Second)\n    fmt.Println(\"main end\")\n}\n</code></pre>\n\n<p>Run above code <a href=\"https://play.golang.org/p/oIrNMKSwypt\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": ["http", "go", "request"], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "edited": false, "score": 0, "creation_date": 1568565702, "post_id": 57945940, "comment_id": 102305646, "body": "thanks for the answer miss but it didn&#39;t work, even the server doesn&#39;t receive the json data"}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "edited": false, "score": 0, "creation_date": 1568565850, "post_id": 57945940, "comment_id": 102305687, "body": "Can you post the code where you set up routing for the server? If the handler is never being invoked there is likely a problem there."}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "edited": false, "score": 0, "creation_date": 1568566379, "post_id": 57945940, "comment_id": 102305817, "body": "Okay, so your server IS receiving the request and is failing to parse the json data? Can you look that the stack trace to identify exactly where it&#39;s failing? It definitely seems like something is wrong with your request body, as bserdar noted."}, {"owner": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "edited": false, "score": 0, "creation_date": 1568566681, "post_id": 57945940, "comment_id": 102305895, "body": "Yes, I am trying to do what Bserdar said."}], "tags": [], "owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "is_accepted": false, "score": 0, "last_activity_date": 1568564108, "creation_date": 1568564108, "answer_id": 57945940, "question_id": 57945877, "link": "https://stackoverflow.com/questions/57945877/golang-server-does-not-decode-json-invalid-character-in-literal-false-expe/57945940#57945940", "title": "golang server does not decode json (invalid character &#39; &#39; in literal false (expecting &#39;a&#39;)400&quot;)", "body": "<p>It could be an issue with your JWT auth since you're ignoring that potential error coming from <code>jwtauth.FromContext</code>. Try adding error handling there and see if you get anything useful. </p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1568566003, "creation_date": 1568566003, "answer_id": 57946204, "question_id": 57945877, "link": "https://stackoverflow.com/questions/57945877/golang-server-does-not-decode-json-invalid-character-in-literal-false-expe/57946204#57946204", "title": "golang server does not decode json (invalid character &#39; &#39; in literal false (expecting &#39;a&#39;)400&quot;)", "body": "<p>Your multipart construction seems wrong. You create the first part from a file, but you don't create a second part for the json, you decode it directly into to the buffer. Instead, you should use <code>writer.CreatePart</code> to create a new part, and write the json data to the writer returned from that.</p>\n"}], "owner": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 755, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1568566003, "creation_date": 1568563703, "last_edit_date": 1568565948, "question_id": 57945877, "link": "https://stackoverflow.com/questions/57945877/golang-server-does-not-decode-json-invalid-character-in-literal-false-expe", "title": "golang server does not decode json (invalid character &#39; &#39; in literal false (expecting &#39;a&#39;)400&quot;)", "body": "<p>I am trying to send a file and json data from a client to the server, but the server does not respond to the request and fails to decode the json data but the file is received</p>\n\n<p>I am using a map and I send it as a json format(avsUpload), the reason for this is that the client can have a quantity of data n and a struc is not ideal</p>\n\n<p>client code:</p>\n\n<pre><code>func UploadFile(file_up string,avsUpload map[string]string){\n\n//get file\nfile, err := os.Open(file_up)\nif err!=nil{\n     fmt.Println(red(\" ERROR \")+\"open file\",file,err)\n     return\n}\n\ndefer file.Close()\n\n//get file info\nfileInfo, err := os.Stat(file_up)\nif err!=nil{\n     fmt.Println(red(\" ERROR \")+\"geting file info\",err)\n     return\n}\n\n//create form\nbody := &amp;bytes.Buffer{}\nwriter := multipart.NewWriter(body)\npart, err := writer.CreateFormFile(\"file\", fileInfo.Name())\nif err != nil {\n     fmt.Println(red(\" ERROR \")+\"creating form file\",err)\n     return\n}\n\nio.Copy(part, file)\nwriter.Close()\n\n//encode json, avsUpload as map\njson.NewEncoder(body).Encode(avsUpload)\n\n//create request\nrequest, err := http.NewRequest(\"POST\", \"http://127.0.0.1:2047/ctrl/upload\", body)\nif err != nil {\n    fmt.Println(red(\" ERROR \"),err)\n    return\n}\n\n//add headers\nrequest.Header.Add(\"Content-Type\", writer.FormDataContentType())\nrequest.Header.Add(\"Content-Type\",\"application/json; charset=utf-8\")\nrequest.Header.Add(\"Authorization\", \"BEARER \"+readKey())\nrequest.Header.Add(\"Content-Length\", strconv.FormatInt(request.ContentLength,10))\n\n//create req \nclient := &amp;http.Client{}\nresponse, err := client.Do(request)\nif err != nil {\n    fmt.Println(red(\" ERROR \"),err)\n    return\n}\ndefer response.Body.Close()\n\ncontent, err := ioutil.ReadAll(response.Body) \nif err != nil {\n   fmt.Println(red(\" ERROR \"),err)\n}\n\nfmt.Println(\" \"+string(content))\n}\n</code></pre>\n\n<p>capturing the requests, I could see that json data is sent normally</p>\n\n<p>server code:</p>\n\n<pre><code>func Upload(w http.ResponseWriter, r *http.Request){\n\n//set header\nw.Header().Set(\"Content-Type\", \"multipart/form-data\")\nw.Header().Set(\"Content-Type\", \"application/json\")\n\n\n//set max request size\nr.Body = http.MaxBytesReader(w, r.Body, MaxFileSize)\n\nfmt.Println(\"size&gt;&gt;&gt; \",r.ContentLength)\n//close conection if request is &gt; MaxFileSize\nif r.ContentLength &gt; MaxFileSize  {\n     http.Error(w, \"File size is too large, max \"+strconv.Itoa(FileSize)+\" mb's\\n\", http.StatusExpectationFailed)\n     log.Error(w, \"File size is too large, max \"+strconv.Itoa(FileSize)+\" mb's\", http.StatusExpectationFailed)\n     return\n} \n\n//create miltipart reader   \nreader, err := r.MultipartReader()\nif err != nil {\n    log.Error(w, err.Error(), http.StatusBadRequest)\n    return\n}\n\n// parse file form\np, err := reader.NextPart()\nif err != nil &amp;&amp; err != io.EOF {\n    log.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\n\n//check if te variable file exist in form\nif p.FormName() != \"file\" {\n    http.Error(w, \"file is expected\\n\", http.StatusBadRequest)\n    log.Error(w, \"file is expected\", http.StatusBadRequest)\n    return\n}\n\n//check file name length \nif len(p.FileName()) &gt; 100 {\n    http.Error(w, \"file name is too long\\n\", http.StatusBadRequest)\n    log.Error(w, \"file name is too long\", http.StatusBadRequest)\n    return\n}\n\n//check if te filename contains spaces\nvar fileName string\nif strings.Contains(p.FileName(), \" \"){\n    fileName=strings.Replace(p.FileName(), \" \", \"_\", -1)\n}else{\n    fileName=p.FileName()\n}\n\n//get user from id in token\n_, claims, err := jwtauth.FromContext(r.Context()) \nif err != nil {\n    log.Error(w, err.Error(), http.StatusBadRequest)\n    return\n}\nuser:=getUser(int(claims[\"id\"].(float64)))\n\n//create buffer   \nbuf := bufio.NewReader(p)\n\n//upload file to user dir\nf, err := os.OpenFile(\"test/\"+user+\"/tmpfile/\"+fileName, os.O_WRONLY|os.O_CREATE, 0666)\nif err != nil {\n   log.Error(w, err.Error(), http.StatusInternalServerError)\n   return\n}\ndefer f.Close()\n\n//decode json from client\navsSelect:=make(map[string]string)\nerr = json.NewDecoder(r.Body).Decode(&amp;avsSelect)\nif err != nil {\n      log.Error(w, err.Error(), http.StatusBadRequest)\n      return\n    }\n\n//copy file to user dir\nlmt := io.MultiReader(buf, io.LimitReader(p, MaxFileSize - 511))\nfileSize, err := io.Copy(f, lmt)\nif err != nil &amp;&amp; err != io.EOF {\n    http.Error(w, \"File size is too large, max \"+strconv.Itoa(FileSize)+\" mb's\\n\", http.StatusExpectationFailed)\n    log.Error(w, err.Error(), http.StatusInternalServerError)\n    os.Remove(f.Name())\n    return\n}\n\ndefer p.Close()\n\n//print conformation message\nw.Write([]byte(fmt.Sprintf(green(\"SERVER: \")+\"File \"+fileName+\" uploaded\")))\nfmt.Sprintf(\"File \"+fileName+\" uploaded\")\nlog.Info(\"Size request: %#v\\n\", r.ContentLength)\nlog.Info(\"Size file uploaded: %#v\\n\",fileSize)\nreturn\n}\n</code></pre>\n\n<p>The server records the following for diferents request:</p>\n\n<pre><code>invalid character ' ' in literal false (expecting 'a')400\ninvalid character '\u00a5' looking for beginning of value400\"\ninvalid character '\\\\u0086' looking for beginning of value400\"\n</code></pre>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 1715, "user_id": 2631732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc9c1998e15be9375572a153883ee4d6?s=128&d=identicon&r=PG", "display_name": "Daniel Corin", "link": "https://stackoverflow.com/users/2631732/daniel-corin"}, "edited": false, "score": 1, "creation_date": 1568565898, "post_id": 57945730, "comment_id": 102305698, "body": "You might find these answers useful: <a href=\"https://stackoverflow.com/questions/33034241/how-to-get-the-stack-trace-pointing-to-actual-error-reason-in-golang\" title=\"how to get the stack trace pointing to actual error reason in golang\">stackoverflow.com/questions/33034241/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3734, "user_id": 2921363, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5caeedd7806ff7242659106e06d3f2a9?s=128&d=identicon&r=PG&f=1", "display_name": "bsapaka", "link": "https://stackoverflow.com/users/2921363/bsapaka"}, "is_accepted": false, "score": 7, "last_activity_date": 1573879305, "creation_date": 1573879305, "answer_id": 58887639, "question_id": 57945730, "link": "https://stackoverflow.com/questions/57945730/stack-trace-and-golang-errors-unwrap/58887639#58887639", "title": "stack trace and golang errors.Unwrap()", "body": "<p><code>errors.Unwrap</code> is for peeling off layers of an error that has been wrapped.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// error 1 wrapped by 2 wrapped by 3\nerr1 := errors.New(\"error 1\")\nerr2 := fmt.Errorf(\"error 2: %w\", err1)\nerr3 := fmt.Errorf(\"error 3: %w\", err2)\n\nfmt.Println(err1) // \"error 1\"\nfmt.Println(err2) // \"error 2: error 1\"\nfmt.Println(err3) // \"error 3: error 2: error 1\"\n\n// unwrap peels a layer off\nfmt.Println(errors.Unwrap(err3)) // \"error 2: error 1\"\nfmt.Println(errors.Unwrap(errors.Unwrap(err3))) // \"error 1\"\n</code></pre>\n\n<p>You can recursively unwrap to get to the inner most error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>currentErr := err3\nfor errors.Unwrap(currentErr) != nil {\n  currentErr = errors.Unwrap(currentErr)\n}\n\nfmt.Println(currentErr) // \"error 1\"\n</code></pre>\n\n<p>For an error that contains both low-level and human-readable error, you can implement a custom error.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Error struct {\n  LowLevel error\n  HumanReadable string\n}\n\nfunc (e Error) Error() string {\n  return e.HumanReadable\n}\n\nfunc (e Error) Unwrap() error {\n  return e.LowLevel\n}\n\n// helper\nfunc NewError(inner error, outer string) *Error {\n  return &amp;Error{\n    LowLevel: inner, \n    HumanReadable: outer,\n  }\n}\n</code></pre>\n\n<p>In your called function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Create(book *model.Book) error {\n  ...\n\n  if err != nil {\n     return NewError(err, \"failed to create book\")\n  }\n\n  ...\n}\n</code></pre>\n\n<p>In your caller:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n  ...\n  err := Create(&amp;bk)\n  if err != nil {\n    log.Print(errors.Unwrap(err)) // internally log low-level error\n    fmt.Print(err) // present human-readable error to user\n  }\n  ...\n}\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 3137124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d172ba9b38c199b0d8176fd42c15b2c?s=128&d=identicon&r=PG&f=1", "display_name": "user3137124", "link": "https://stackoverflow.com/users/3137124/user3137124"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4020, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1573879305, "creation_date": 1568562637, "last_edit_date": 1568563309, "question_id": 57945730, "link": "https://stackoverflow.com/questions/57945730/stack-trace-and-golang-errors-unwrap", "title": "stack trace and golang errors.Unwrap()", "body": "<p>I would like to build a stack trace that includes a low level db error with a second error which is human readable.</p>\n\n<p>Is the new errors.Unwrap() function in golang 1.13 built for this purpose?  Not sure I understand how to use it.  Looking for an example on how to do this.</p>\n\n<pre><code>// model/book.go\npackage model\n\ntype Book struct {\n    Id     uint32  `json:\"id\"     db:\"id\"`\n    Title  string  `json:\"title\"  db:\"title\"`\n    Author string  `json:\"author\" db:\"author\"`\n    Price  float32 `json:\"price\"  db:\"price\"`\n}\n\nfunc (b *Book) Tablename() string {\n    return \"books\"\n}\n\n\n// main.go\npackage main\n\nfunc main() {\n    bk := model.Book{\n        Title:  \"oliver twist\",\n        Author: \"charles dickens\",\n        Price:  10.99,\n    }\n\n    err:= Create(&amp;bk)\n    if err !=nil {\n        // how to use Unwrap?\n    }\n\n}\nfunc Create(book *model.Book) error {\n    insertSQL := \"INSERT INTO ....\"\n    // code to insert\n    if err != nil {\n        return err\n    }\n    book.Id = uint32(lastID)\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": false, "score": 2, "last_activity_date": 1568563046, "creation_date": 1568563046, "answer_id": 57945783, "question_id": 57945551, "link": "https://stackoverflow.com/questions/57945551/what-is-the-proper-golang-workflow-for-developing-locally-and-pushing-to-github/57945783#57945783", "title": "What is the proper golang workflow for developing locally and pushing to github?", "body": "<p>Use the 'replace' directive in your application go.mod file to specify modules that are local:</p>\n\n<pre><code>replace example.com/original/import/path =&gt; /your/forked/import/path\n</code></pre>\n\n<p>See: <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive</a></p>\n"}, {"tags": [], "owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "is_accepted": true, "score": 0, "last_activity_date": 1571353387, "creation_date": 1571353387, "answer_id": 58441774, "question_id": 57945551, "link": "https://stackoverflow.com/questions/57945551/what-is-the-proper-golang-workflow-for-developing-locally-and-pushing-to-github/58441774#58441774", "title": "What is the proper golang workflow for developing locally and pushing to github?", "body": "<p>I simply needed to follow the directions here:</p>\n\n<p>My workspace was not in the default location, no did I override the GOPATH ... and so that caused some grief.</p>\n"}], "owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 58441774, "answer_count": 2, "score": -2, "last_activity_date": 1571353387, "creation_date": 1568561270, "last_edit_date": 1568598435, "question_id": 57945551, "link": "https://stackoverflow.com/questions/57945551/what-is-the-proper-golang-workflow-for-developing-locally-and-pushing-to-github", "title": "What is the proper golang workflow for developing locally and pushing to github?", "body": "<p>What is the proper workflow to develop locally and push golang code to github?  Before the code is pushed to github, I won't be able to reference those libraries in commands and I would prefer not to push half-baked code.</p>\n\n<p>If I run go build, that does not install the module.  Similarly, if I run go install, I don't see any additional files created under my ~/go directory.  It is only when I commit my changes and push to github followed by doing a go get -u github.com ... that I see the packages being installed.</p>\n"}, {"tags": ["c", "visual-studio", "go"], "comments": [{"owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 0, "creation_date": 1568556720, "post_id": 57944793, "comment_id": 102303500, "body": "You&#39;re not linking the library."}, {"owner": {"reputation": 11, "user_id": 5914402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1430d8910afa7fe0a2d9de6af5dfef2?s=128&d=identicon&r=PG&f=1", "display_name": "kpage", "link": "https://stackoverflow.com/users/5914402/kpage"}, "reply_to_user": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 0, "creation_date": 1568557554, "post_id": 57944793, "comment_id": 102303698, "body": "I believe I am, I&#39;ve added <code>ctest.a</code> to &quot;Additional Dependencies&quot; and its directory to &quot;Additional Library Directories&quot;"}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1568558099, "post_id": 57944793, "comment_id": 102303849, "body": "There is a lot here <a href=\"https://stackoverflow.com/questions/6125683/call-go-functions-from-c\" title=\"call go functions from c\">stackoverflow.com/questions/6125683/call-go-functions-from-c</a>"}, {"owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 0, "creation_date": 1568563070, "post_id": 57944793, "comment_id": 102304961, "body": "I don&#39;t believe visual studio supports .a file format. Try compiling it as .lib and static."}], "owner": {"reputation": 11, "user_id": 5914402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1430d8910afa7fe0a2d9de6af5dfef2?s=128&d=identicon&r=PG&f=1", "display_name": "kpage", "link": "https://stackoverflow.com/users/5914402/kpage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 250, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568555817, "creation_date": 1568555817, "question_id": 57944793, "link": "https://stackoverflow.com/questions/57944793/access-golang-code-from-a-c-project-in-visual-studio-2019", "title": "Access Golang code from a C project in Visual Studio 2019", "body": "<p>I have a C project in Visual Studio 2019 and I would like to use certain functions written in Go within it.</p>\n\n<p>I have a test file called <code>ctest.go</code> which has the following contents:</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"fmt\"\n)\n\n//export printInt\nfunc printInt(x int) {\n    fmt.Printf(\"Hello from go: %d\", x)\n}\n\nfunc main() {}\n</code></pre>\n\n<p>I'm generating a static library with this command:</p>\n\n<pre><code>go build -buildmode=c-archive ctest.go\n</code></pre>\n\n<p>I end up with two files, <code>ctest.a</code> and <code>ctest.h</code> which I include in my VS project. I include <code>ctest.h</code> in my code and immediately get these errors:</p>\n\n<pre><code>identifier \"__SIZE_TYPE__\" is undefined\nexpected a ';'\nexpected a ';'\n</code></pre>\n\n<p>The generated header file contains the following lines which caused it:</p>\n\n<pre><code>typedef __SIZE_TYPE__ GoUintptr;\ntypedef float _Complex GoComplex64;\ntypedef double _Complex GoComplex128;\n</code></pre>\n\n<p>I replaced <code>__SIZE_TYPE__</code> by <code>size_t</code> and just commented out the <code>_Complex</code> lines to stop the errors.</p>\n\n<p>Now my VS project compiles while including the header file. But as soon as I try to use my go function like this:</p>\n\n<pre><code>printInt(5);\n</code></pre>\n\n<p>I get 2 warnings followed by 6 errors:</p>\n\n<pre><code>Warning LNK4078 multiple '.text' sections found with different attributes (60600060)    AWO F:\\AWO\\AWO\\ctest.a(go.o)\nWarning LNK4078 multiple '.text' sections found with different attributes (60600060)    AWO F:\\AWO\\AWO\\ctest.a(go.o)\nError   LNK2019 unresolved external symbol __imp___iob referenced in function __cgo_preinit_init    AWO F:\\AWO\\AWO\\ctest.a(000005.o)\nError   LNK2001 unresolved external symbol __imp___iob  AWO F:\\AWO\\AWO\\ctest.a(000006.o)\nError   LNK2001 unresolved external symbol __imp___iob  AWO F:\\AWO\\AWO\\ctest.a(000007.o)\nError   LNK2019 unresolved external symbol _fprintf referenced in function _x_cgo_sys_thread_create AWO F:\\AWO\\AWO\\ctest.a(000005.o)\nError   LNK2001 unresolved external symbol _fprintf AWO F:\\AWO\\AWO\\ctest.a(000007.o)\nError   LNK1120 2 unresolved externals  AWO F:\\AWO\\Debug\\AWO.exe    1   \n</code></pre>\n\n<p>This is where I'm stuck. I'm not sure what I'm doing wrong or should be doing differently to properly use the library generated with go.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 1520, "user_id": 3871007, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/100002700876168/picture?type=large", "display_name": "Prasanna Anbazhagan", "link": "https://stackoverflow.com/users/3871007/prasanna-anbazhagan"}, "edited": false, "score": 0, "creation_date": 1568572578, "post_id": 57944485, "comment_id": 102307362, "body": "You cannot put Teacher under Student. the above one looks good. It is not contradicting the design."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556000, "post_id": 57944788, "comment_id": 102303326, "body": "let say i have JSON request like this : { studentName: &quot;me&quot;, teacher: [&quot;myTeacher&quot;, &quot;secondeTeacher&quot;]}, will it created teacherID on student ? ,"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556094, "post_id": 57944788, "comment_id": 102303356, "body": "GORM doesn&#39;t create records based on ANY json. It is your task to unmarshal JSON to the struct and (may be) map them to the database level models"}, {"owner": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556433, "post_id": 57944788, "comment_id": 102303445, "body": "I was get confused how to make request for your schema in go, I do like the request like this &amp;req{ teacher: &quot;yess&quot; , student: []student{&quot;tes&quot;, &quot;testone&quot;}} then it gonna create the students on teacher"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556615, "post_id": 57944788, "comment_id": 102303480, "body": "GORM doesn&#39;t work with JSON, to create records you need to use <code>db.Create()</code> method <a href=\"https://gorm.io/docs/create.html\" rel=\"nofollow noreferrer\">gorm.io/docs/create.html</a>"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556694, "post_id": 57944788, "comment_id": 102303497, "body": "And yes, you need to create Teacher first, and then create the Students."}, {"owner": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556788, "post_id": 57944788, "comment_id": 102303520, "body": "so after create teacher then we get teacher id ? and then make db.Update(&amp;{student{teacher: teacher.id }}) something like that ??"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556850, "post_id": 57944788, "comment_id": 102303533, "body": "After Create() the teacher you will have teacher_id. Then you need to Create() Students with this teacher_id."}, {"owner": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556918, "post_id": 57944788, "comment_id": 102303548, "body": "it something like we create teacher first then create student again , hmm is there any way to make those automatic to create only once ??"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "edited": false, "score": 0, "creation_date": 1568556991, "post_id": 57944788, "comment_id": 102303571, "body": "Why <code>again</code>? You create a teacher, next create student. That&#39;s all."}], "tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": false, "score": 0, "last_activity_date": 1568555792, "creation_date": 1568555792, "answer_id": 57944788, "question_id": 57944485, "link": "https://stackoverflow.com/questions/57944485/how-to-make-correctly-has-many-associations-in-golang-with-go/57944788#57944788", "title": "how to make correctly has many associations in Golang with go", "body": "<pre><code>type Teacher struct {\n   gorm.Model \n   Name string\n}\n\ntype Student struct {\n  gorm.Model\n  Name string\n  TeacherId uint `gorm:\"TYPE:integer REFERENCES teachers;index\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 12070137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29f2095f1603b08f40d60868ed9c2b31?s=128&d=identicon&r=PG&f=1", "display_name": "iuer ui", "link": "https://stackoverflow.com/users/12070137/iuer-ui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569340375, "creation_date": 1568553510, "last_edit_date": 1569340375, "question_id": 57944485, "link": "https://stackoverflow.com/questions/57944485/how-to-make-correctly-has-many-associations-in-golang-with-go", "title": "how to make correctly has many associations in Golang with go", "body": "<p>let say one teacher has many students and student only has one teacher, how to implement it on Gorm Golang ?</p>\n\n<p>my opinion is </p>\n\n<pre><code>type Teacher struct {\n   gorm.Model \n   Name string\n   Student []Student\n}\n\ntype Student struct {\n  gorm.Model\n  Name string\n}\n</code></pre>\n\n<p>is those correct ?? and if not how to make it to be associated? and how about if we query it to create ? should I create another StudentID on it ? </p>\n"}, {"tags": ["go", "google-cloud-dataflow", "apache-beam"], "answers": [{"comments": [{"owner": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "edited": false, "score": 0, "creation_date": 1568742990, "post_id": 57977577, "comment_id": 102368635, "body": "thanks, this is a must have feature I&#39;ll probably dive into it"}, {"owner": {"reputation": 1486, "user_id": 4368200, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WOvXcKyTZjY/AAAAAAAAAAI/AAAAAAAAABQ/IRQO4istER4/photo.jpg?sz=128", "display_name": "Lukasz Cwik", "link": "https://stackoverflow.com/users/4368200/lukasz-cwik"}, "reply_to_user": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "edited": false, "score": 0, "creation_date": 1568754450, "post_id": 57977577, "comment_id": 102373257, "body": "That would be great, and you may find the Apache Beam contribution guide a helpful starting place on how to contribute your change (<a href=\"https://beam.apache.org/contribute/\" rel=\"nofollow noreferrer\">beam.apache.org/contribute</a>)"}], "tags": [], "owner": {"reputation": 1486, "user_id": 4368200, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WOvXcKyTZjY/AAAAAAAAAAI/AAAAAAAAABQ/IRQO4istER4/photo.jpg?sz=128", "display_name": "Lukasz Cwik", "link": "https://stackoverflow.com/users/4368200/lukasz-cwik"}, "is_accepted": false, "score": 1, "last_activity_date": 1568734237, "creation_date": 1568734237, "answer_id": 57977577, "question_id": 57944416, "link": "https://stackoverflow.com/questions/57944416/apache-beam-batching-elements-for-api-calls-with-the-go-sdk/57977577#57977577", "title": "Apache Beam - Batching elements for API calls with the Go SDK?", "body": "<p>There is no such transform that is part of the Beam Go SDK at this time.</p>\n\n<p>You would need to translate the GroupIntoBatches [<a href=\"https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/GroupIntoBatches.java\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://github.com/apache/beam/blob/d8c11464e9af426448c057993e3dca51adb8d697/sdks/python/apache_beam/transforms/util.py#L684\" rel=\"nofollow noreferrer\">2</a>] implementation into Go code. This would be a valuable contribution to Apache Beam so please contribute it if you do this.</p>\n"}], "owner": {"reputation": 652, "user_id": 9726037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtEYC.jpg?s=128&g=1", "display_name": "MichelDelpech", "link": "https://stackoverflow.com/users/9726037/micheldelpech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568734237, "creation_date": 1568553018, "question_id": 57944416, "link": "https://stackoverflow.com/questions/57944416/apache-beam-batching-elements-for-api-calls-with-the-go-sdk", "title": "Apache Beam - Batching elements for API calls with the Go SDK?", "body": "<p>I'm building a Beam pipeline with the Go SDK.</p>\n\n<p>I have to do some data enrichment by calling a ML model somewhere on the Cloud. </p>\n\n<p>As I am processing a lot of elements, I can't just make an API call for each element, this will introduce a huge latency. I need to send a batch of elements.</p>\n\n<p>I know in python there is a <code>BatchElements()</code> PTransform, how to make something similar in Go?</p>\n"}, {"tags": ["sql", "postgresql", "go", "sqlx", "pq"], "comments": [{"owner": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "edited": false, "score": 0, "creation_date": 1568552682, "post_id": 57943868, "comment_id": 102302559, "body": "I guess that $1 and $2 are not understood as parameters. Did you check using same way as &quot;:name&quot;. Here it may be &quot;:1&quot; and &quot;:2&quot;"}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "reply_to_user": {"reputation": 3311, "user_id": 1377101, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/784e2ea3644631d338aca027d9085a9d?s=128&d=identicon&r=PG", "display_name": "igr", "link": "https://stackoverflow.com/users/1377101/igr"}, "edited": false, "score": 0, "creation_date": 1568564355, "post_id": 57943868, "comment_id": 102305283, "body": "No, <code>$</code> is the correct notation in this case."}, {"owner": {"reputation": 1485, "user_id": 12022565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c2c8a3b0ce2375f236807e8cf806043?s=128&d=identicon&r=PG&f=1", "display_name": "Islingre", "link": "https://stackoverflow.com/users/12022565/islingre"}, "edited": false, "score": 1, "creation_date": 1568592132, "post_id": 57943868, "comment_id": 102310937, "body": "According to the <a href=\"https://www.postgresql.org/docs/current/sql-do.html\" rel=\"nofollow noreferrer\">documentation</a>, the <code>DO</code> statement takes no parameters. Thus I would also guess <code>$</code> is invalid. Have you tried it with <code>:</code>? Perhaps you also might be able to build your SQL command string directly with the parameters (eventhough this is indeed not that nice)"}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "edited": false, "score": 0, "creation_date": 1568657922, "post_id": 57943868, "comment_id": 102336117, "body": "Indeed, that&#39;s the issue. I guess I will split that up into two queries and run them in a single transaction."}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "edited": false, "score": 0, "creation_date": 1568657944, "post_id": 57943868, "comment_id": 102336123, "body": "Feel free to post this as an answer to have it marked as solution."}], "owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 962, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568548536, "creation_date": 1568548536, "question_id": 57943868, "link": "https://stackoverflow.com/questions/57943868/sql-expected-0-arguments-got-2", "title": "sql: expected 0 arguments, got 2", "body": "<p>I'm struggling to properly utilize <code>sqlx</code> and the <code>pq</code> driver for Postgres to create a row in the database. Let's start simple:</p>\n\n<p>I have a <code>user</code>, <code>role</code> and <code>user_role</code> table. I want to insert a role into the database and get the ID of the inserted row. This works flawlessly using the following sql:</p>\n\n<p><code>const createRoleSQL = \"INSERT INTO role (name) VALUES (:name) RETURNING id\"</code></p>\n\n<p>To make that work in go, I prepare the statement at some point:</p>\n\n<pre><code>createStmt, err := db.PrepareNamed(createRoleSQL)\nif err != nil {\n    // ...\n}\n</code></pre>\n\n<p>When creating, I run the query as part of a transaction <code>tx</code>. <code>role</code> is obviously a struct with the correct fields and <code>db</code> tags:</p>\n\n<pre><code>if err := tx.NamedStmt(createStmt).QueryRow(role).Scan(&amp;role.ID); err != nil {\n    // ...\n}\n</code></pre>\n\n<p>This works perfectly fine.</p>\n\n<p>Now I wanted to extend that and insert a new role and assign it to a user:</p>\n\n<pre><code>const createUserRoleSQL = `\nDO $$\nDECLARE role_id role.id%TYPE;\nBEGIN\n    INSERT INTO role (name) VALUES ($2) RETURNING id INTO role_id;\n    INSERT INTO user_role (user_id, role_id) VALUES ($1, role_id);\nEND $$`\n\ncreateStmt, err := db.Preparex(createUserRoleSQL)\nif err != nil {\n    // ...\n}\n\nif err := tx.Stmtx(createStmt).QueryRow(userID, role.Name).Scan(&amp;role.ID); err != nil {\n    // ...\n}\n</code></pre>\n\n<p>Unfortunately this fails with <code>sql: expected 0 arguments, got 2</code>. Is it possible to achieve what I want to do, with a single query?</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1568542912, "post_id": 57943124, "comment_id": 102300580, "body": "<a href=\"https://github.com/jackc/pgx/issues/281#issuecomment-307247685\" rel=\"nofollow noreferrer\">github.com/jackc/pgx/issues/281#issuecomment-307247685</a> ?"}, {"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1568542980, "post_id": 57943124, "comment_id": 102300593, "body": "I&#39;m not sure that you are binding the parameters correctly."}, {"owner": {"reputation": 91, "user_id": 9193147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb21d4158dcdec4c0c2b119ed0e820e?s=128&d=identicon&r=PG&f=1", "display_name": "John F", "link": "https://stackoverflow.com/users/9193147/john-f"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1568543755, "post_id": 57943124, "comment_id": 102300743, "body": "@mh-cbon Thanks, SET description = concat(description, $2::varchar) works."}], "owner": {"reputation": 91, "user_id": 9193147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb21d4158dcdec4c0c2b119ed0e820e?s=128&d=identicon&r=PG&f=1", "display_name": "John F", "link": "https://stackoverflow.com/users/9193147/john-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1568542485, "creation_date": 1568542485, "question_id": 57943124, "link": "https://stackoverflow.com/questions/57943124/append-text-to-column-using-go-with-pq-driver", "title": "Append text to column using go with pq driver", "body": "<p>I am trying to append text to a database column using golang and the pq driver.</p>\n\n<p>The error I am getting is <code>panic: pq: could not determine data type of parameter $2</code></p>\n\n<pre><code>sqlStatement := `\nUPDATE sales\nSET description = concat(description, $2)\nWHERE id = $1;`\n\nid:=1\ndesc := \"appendthis\"\n\nres, err := db.Exec(sqlStatement, id, desc)\nif err != nil {\n   panic(err)\n}\n</code></pre>\n\n<p>I also tried \n<code>SET description = description || $2</code> which didn't panic, though the field did not get updated.\nAny ideas what I am doing wrong?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-api-gateway", "dynamo-local"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1568539266, "post_id": 57942700, "comment_id": 102299969, "body": "It looks like length(tableName) must me more than 3"}, {"owner": {"reputation": 21, "user_id": 11211307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9f330ee9780d7f9e5db90691f88391e?s=128&d=identicon&r=PG&f=1", "display_name": "leosakashita", "link": "https://stackoverflow.com/users/11211307/leosakashita"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1568543037, "post_id": 57942700, "comment_id": 102300601, "body": "@bayrinat I tried some patterns. First, I hard-code &quot;User&quot; for tableName. Then <code>&quot;ResourceNotFoundException Requested resource not found\\n\\tstatus code: 400, request id: RPFTVHFR7B85093FEI0VRN63V3VV4KQNSO5AEMVJF66Q9ASUAAJG&quot;&quot; occured.</code> Second, I hard-code &quot;<a href=\"http://localhost:8000\" rel=\"nofollow noreferrer\">localhost:8000</a>&quot; for endpoint in addition to tableName. Then this message is appeared. <code>Function &#39;UserGetFunction&#39; timed out after 5 seconds</code> I haven&#39;t solved the problem yet."}, {"owner": {"reputation": 21, "user_id": 11211307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9f330ee9780d7f9e5db90691f88391e?s=128&d=identicon&r=PG&f=1", "display_name": "leosakashita", "link": "https://stackoverflow.com/users/11211307/leosakashita"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1568615627, "post_id": 57942700, "comment_id": 102315186, "body": "I know some things. First problem was because the value could not be read from the environment variable. This problem has not been solved yet. Second problem was because &quot;localhost&quot; expression. Rewriting &quot;localhost&quot; to &quot;xxx.xxx.xxx.xxx&quot; worked fine.(&quot;xxx.xxx.xxx.xxx&quot; is ip address of my laptop)"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 11211307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9f330ee9780d7f9e5db90691f88391e?s=128&d=identicon&r=PG&f=1", "display_name": "leosakashita", "link": "https://stackoverflow.com/users/11211307/leosakashita"}, "is_accepted": true, "score": 1, "last_activity_date": 1568619699, "creation_date": 1568619699, "answer_id": 57952353, "question_id": 57942700, "link": "https://stackoverflow.com/questions/57942700/i-cant-read-from-the-environment-variable-aws-lambda-in-go/57952353#57952353", "title": "I can&#39;t read from the environment variable (aws-lambda in Go)", "body": "<p>That's been resolved.</p>\n\n<p><strong>First Problem: can't read from the environment variable</strong><br>\nThis was because the indent size deviation of template.yaml. Category \"<strong>Events</strong>\" and Category \"<strong>Environment</strong>\" had to be in line.</p>\n\n<p><strong>Second Problem: error with \"Function 'UserGetFunction' timed out after 5 seconds\"</strong><br>\nThis was because \"localhost\" expression. Rewriting \"localhost\" in env.json to \"xxx.xxx.xxx.xxx\" worked fine.(\"xxx.xxx.xxx.xxx\" is ip address of your laptop)</p>\n"}], "owner": {"reputation": 21, "user_id": 11211307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9f330ee9780d7f9e5db90691f88391e?s=128&d=identicon&r=PG&f=1", "display_name": "leosakashita", "link": "https://stackoverflow.com/users/11211307/leosakashita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 57952353, "answer_count": 1, "score": 1, "last_activity_date": 1568619699, "creation_date": 1568538768, "last_edit_date": 1568615715, "question_id": 57942700, "link": "https://stackoverflow.com/questions/57942700/i-cant-read-from-the-environment-variable-aws-lambda-in-go", "title": "I can&#39;t read from the environment variable (aws-lambda in Go)", "body": "<p>I want to test AWS Lambda in local environment using DynamoDB Local and SAM CLI.\nI create a simple user db table(id, name) and I'm trying to get the data.</p>\n\n<p>I run \"sam local start-api --env-vars test/env.json\". When I access \"<a href=\"http://localhost:3000/users/1\" rel=\"nofollow noreferrer\">http://localhost:3000/users/1</a>\", an error occured. Error message is below. I can't understand what this error message means. How do I fix this error?</p>\n\n<pre><code>{\n  \"errorMessage\": \"InvalidParameter: 1 validation error(s) found.\\n- minimum field size of 3, GetItemInput.TableName.\\n\",\n  \"errorType\": \"ErrInvalidParams\"\n}\n</code></pre>\n\n<p>This is my code.</p>\n\n<pre><code>func handler(request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    // Environment variables\n    endpoint := os.Getenv(\"DYNAMODB_ENDPOINT\")\n    tableName := os.Getenv(\"DYNAMODB_TABLE_NAME\")\n\n    // Request\n    id, _ := request.PathParameters[\"id\"]\n\n    // DynamoDB\n    sess := session.Must(session.NewSession())\n    config := aws.NewConfig().WithRegion(\"ap-northeast-1\")\n    if len(endpoint) &gt; 0 {\n        config = config.WithEndpoint(endpoint)\n    }\n\n    db := dynamodb.New(sess, config)\n    response, err := db.GetItem(&amp;dynamodb.GetItemInput{\n        TableName: aws.String(tableName),\n        Key: map[string]*dynamodb.AttributeValue{\n            \"Id\": {\n                N: aws.String(string(id)),\n            },\n        },\n        AttributesToGet: []*string{\n            aws.String(\"Id\"),\n            aws.String(\"Name\"),\n        },\n        ConsistentRead:         aws.Bool(true),\n        ReturnConsumedCapacity: aws.String(\"NONE\"),\n    })\n    if err != nil {\n        return events.APIGatewayProxyResponse{}, err\n    }\n\n    user := User{}\n    err = dynamodbattribute.Unmarshal(&amp;dynamodb.AttributeValue{M: response.Item}, &amp;user)\n    if err != nil {\n        return events.APIGatewayProxyResponse{}, err\n    }\n\n    // Json\n    bytes, err := json.Marshal(user)\n    if err != nil {\n        return events.APIGatewayProxyResponse{}, err\n    }\n\n    return events.APIGatewayProxyResponse{\n        Body:       string(bytes),\n        StatusCode: 200,\n    }, nil\n}\n\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/xfNF9.png\" rel=\"nofollow noreferrer\">error message</a></p>\n"}, {"tags": ["google-app-engine", "go", "telegram-bot"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568533688, "post_id": 57942125, "comment_id": 102298876, "body": "Your question is incomplete as there is not enough code to make even a guess. Try to use ngrok do debug locally."}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568533738, "post_id": 57942125, "comment_id": 102298886, "body": "@AlexanderTrakhimenok it works as expected localy, nothing speshial there"}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568533771, "post_id": 57942125, "comment_id": 102298895, "body": "@AlexanderTrakhimenok maybe it&#39;s GAE specific issue?"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568533820, "post_id": 57942125, "comment_id": 102298903, "body": "Is your framework uses webhooks or pull? If pulls it may be root cause as GAE probably closes long connection"}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568533921, "post_id": 57942125, "comment_id": 102298931, "body": "@AlexanderTrakhimenok the only library I use is <code>github.com&#47;go-telegram-bot-api&#47;telegram-bot-api</code> and i&#39;m not shure what is pull and webhooks - so maybe not"}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568534114, "post_id": 57942125, "comment_id": 102298965, "body": "@AlexanderTrakhimenok the bot just reads and sends messages according to app logic"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 2, "creation_date": 1568624158, "post_id": 57942125, "comment_id": 102318938, "body": "I advise you to use webhooks (<a href=\"https://core.telegram.org/bots/webhooks\" rel=\"nofollow noreferrer\">core.telegram.org/bots/webhooks</a>). I use my own framework and it works on GAE just fine - <a href=\"https://github.com/strongo/bots-api-telegram\" rel=\"nofollow noreferrer\">github.com/strongo/bots-api-telegram</a>"}, {"owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1568629993, "post_id": 57942125, "comment_id": 102321962, "body": "@AlexanderTrakhimenok I tried but there were troubles also, look at this <a href=\"https://stackoverflow.com/questions/57950893/seeting-up-a-webhook-for-gae-telegram-bot-deployed\" title=\"seeting up a webhook for gae telegram bot deployed\">stackoverflow.com/questions/57950893/&hellip;</a>"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "edited": false, "score": 0, "creation_date": 1568635723, "post_id": 57942125, "comment_id": 102324923, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/199515/discussion-between-alexander-trakhimenok-and-rozerro\">continue this discussion in chat</a>."}], "owner": {"reputation": 2016, "user_id": 5829191, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/rwxZQ.jpg?s=128&g=1", "display_name": "rozerro", "link": "https://stackoverflow.com/users/5829191/rozerro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568533411, "creation_date": 1568533411, "question_id": 57942125, "link": "https://stackoverflow.com/questions/57942125/telegram-bot-stops-serving-after-small-peroid-of-time", "title": "Telegram bot stops serving after small peroid of time", "body": "<p>I uploaded a simple telegram bot to google-aplication-engine. And after uploading it works as expected some time. Then it stoped respond to request from telegram. \nThe bot is very simple</p>\n\n<pre><code>func main() {\n    bot, err := tba.NewBotAPI(\"apitockenhere\")\n    ...\n    for {\n        select {\n        case update := &lt;-uchan:\n        ...\n    }\n}\n</code></pre>\n\n<p>If I open web application in browser (it doesnot contais any handlers) then telegram bot again starts working some time and then stops.</p>\n\n<p>How to modify the code to prevent it from stopping?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 511, "user_id": 10340130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd380558f8a71a63a89ae9e37195019c?s=128&d=identicon&r=PG", "display_name": "njras", "link": "https://stackoverflow.com/users/10340130/njras"}, "edited": false, "score": 1, "creation_date": 1568527806, "post_id": 57941547, "comment_id": 102297955, "body": "Unix timestamps are timezone independent - <a href=\"https://stackoverflow.com/questions/23062515/do-unix-timestamps-change-across-timezones\" title=\"do unix timestamps change across timezones\">stackoverflow.com/questions/23062515/&hellip;</a>. It is supposed to be same seconds."}, {"owner": {"reputation": 12464, "user_id": 1376448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f16da5431a99911ebc32093a28bc591?s=128&d=identicon&r=PG", "display_name": "kiddorails", "link": "https://stackoverflow.com/users/1376448/kiddorails"}, "edited": false, "score": 0, "creation_date": 1568528483, "post_id": 57941547, "comment_id": 102298019, "body": "It will be same amount of seconds. If you offset with your timezone at time.Now(), the unix beginning time at Jan 1 1970 will offset by same amount of hours too. Unixtime doesn&#39;t change across locations, that&#39;s the very reason it&#39;s used in systems"}], "answers": [{"comments": [{"owner": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568528208, "post_id": 57941605, "comment_id": 102297993, "body": "Second() methon returns the second offset within the minute specified by t, in the range [0, 59]    but my purpose is to get the number of seconds elapsed since January 1"}, {"owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "reply_to_user": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568528897, "post_id": 57941605, "comment_id": 102298077, "body": "also, is it current year&#39;s January 1 or 1970&#39;s January 1?"}, {"owner": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568529537, "post_id": 57941605, "comment_id": 102298160, "body": "As time zone is dynamic. In that case I only know the time zone string like &quot;Asia/Dhaka&quot;. but don&#39;t know the value like 6 hours."}, {"owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "reply_to_user": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568529796, "post_id": 57941605, "comment_id": 102298206, "body": "if its asia/dhaka, it should be +6 hours with UTC"}, {"owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "reply_to_user": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568530035, "post_id": 57941605, "comment_id": 102298239, "body": "also in <code>time.FixedZone(&quot;Asia&#47;Dhaka&quot;, 6*60*60)</code> &quot;Asia/Dhaka&quot; is name, if you need some other timezone&#39;s information, then you need to provide different offset value. for &quot;asia/dhaka&quot; its 6*60*60. if this time zone if dynamic use name in more genarelize manner and change offset  value according to your need"}, {"owner": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "edited": false, "score": 0, "creation_date": 1568530127, "post_id": 57941605, "comment_id": 102298251, "body": "as I said it&#39;s dynamic in previous comment. it&#39;s not always asia/dhaka. it can be another time zone also."}], "tags": [], "owner": {"reputation": 2165, "user_id": 3427852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/1390962419/picture?type=large", "display_name": "Abu Hanifa", "link": "https://stackoverflow.com/users/3427852/abu-hanifa"}, "is_accepted": true, "score": 1, "last_activity_date": 1568530781, "last_edit_date": 1568530781, "creation_date": 1568527986, "answer_id": 57941605, "question_id": 57941547, "link": "https://stackoverflow.com/questions/57941547/how-to-get-time-in-seconds-with-add-time-zone-in-go/57941605#57941605", "title": "How to get time in seconds with add time zone in go", "body": "<p>If you want current clock time's second part only use below code:</p>\n\n<pre><code>loc := time.FixedZone(\"some_common_name\", 6*60*60)\nts := time.Now().In(loc).Second()\nfmt.Println(ts)\n</code></pre>\n\n<hr>\n\n<p>If you want seconds from start of current year(like 01.01.1970)</p>\n\n<pre><code>loc := time.FixedZone(\"some_common_name\", 6*60*60)\ntp := time.Date(1970, 1, 1, 0, 0, 0, 0, loc)\nts := time.Now().Sub(tp).Seconds()\nfmt.Printf(\"%v\", ts)\n</code></pre>\n\n<p>In case, you want different time zone information, change offset value of <code>time.FixedZone()</code> functions. As, if you want GMT +5, then use 5*60*60 as offset value </p>\n"}], "owner": {"reputation": 628, "user_id": 5882770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f12feed8b016e52d78275f8729a64a03?s=128&d=identicon&r=PG&f=1", "display_name": "Shakhawat Hossain", "link": "https://stackoverflow.com/users/5882770/shakhawat-hossain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 57941605, "answer_count": 1, "score": 0, "last_activity_date": 1568530781, "creation_date": 1568527254, "last_edit_date": 1568529049, "question_id": 57941547, "link": "https://stackoverflow.com/questions/57941547/how-to-get-time-in-seconds-with-add-time-zone-in-go", "title": "How to get time in seconds with add time zone in go", "body": "<p>I am using time.Time in go. to get time in seconds (the number of seconds elapsed since 1970's January 1) I am using </p>\n\n<pre><code>now := Time.now()\nloc, err := time.LoadLocation(country.Timezone) // time zone in Asia/Dhaka\nnow = now.In(loc)\n</code></pre>\n\n<p>then, </p>\n\n<pre><code>seconds := now.Unix()\n</code></pre>\n\n<p>but the seconds giving seconds without adding the time zone seconds. it actually giving the seconds in UTC. My question is, how can I get seconds with added 6 hours ( asia/dhaka time zone is UTC+6)? </p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1568533484, "post_id": 57941502, "comment_id": 102298830, "body": "I am not a fan of reinventing the wheel, and when it comes to dependency injection (a concept which in the long run imho causes more pain than it does good), <a href=\"https://rationaleemotions.com/Dependency_Injection_in_GoLang/\" rel=\"nofollow noreferrer\">Go has actually a plethora of options</a>."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1568554413, "post_id": 57941502, "comment_id": 102302936, "body": "The <a href=\"https://en.wikipedia.org/wiki/Factory_(object-oriented_programming)\" rel=\"nofollow noreferrer\">factory pattern</a> is a staple of Java programs that try to do this sort of thing (have a second interface that can create objects of the first-interface type, and pass a factory as a parameter to <code>SelectSomething()</code> that needs to create new objects) but it&#39;s not especially common in Go that I&#39;ve seen."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 9063497, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vs5DWZ9wuFk/AAAAAAAAAAI/AAAAAAAAARI/I2LlVcbGy3E/photo.jpg?sz=128", "display_name": "Johnny Bonelli", "link": "https://stackoverflow.com/users/9063497/johnny-bonelli"}, "edited": false, "score": 0, "creation_date": 1568533912, "post_id": 57942084, "comment_id": 102298925, "body": "it not exactly what i was asking.   Your example exactly what indicated in the last example.  My question of how foo() in package X can return a slice of *interface or map without actually creating type T inside a package.  so externally receiver can type case to type T2 if type T is a subset of T2.  I guess you can&#39;t you need inheritance for that or inside a package you need to create type T itself implement all interface return that as a slice of the interface and on receiver do same so it bi-direction mapping."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 73, "user_id": 9063497, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vs5DWZ9wuFk/AAAAAAAAAAI/AAAAAAAAARI/I2LlVcbGy3E/photo.jpg?sz=128", "display_name": "Johnny Bonelli", "link": "https://stackoverflow.com/users/9063497/johnny-bonelli"}, "edited": false, "score": 0, "creation_date": 1568535747, "post_id": 57942084, "comment_id": 102299259, "body": "@JohnnyBonelli Yes, for a good reason here is no such thing as inheritance in Go. But you can use composition. I am really not sure I got your question, though. From my point of view, it is overly complicated."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1568532931, "creation_date": 1568532931, "answer_id": 57942084, "question_id": 57941502, "link": "https://stackoverflow.com/questions/57941502/generic-approach-and-recommendation-how-to-remove-dependency/57942084#57942084", "title": "Generic approach and recommendation how to remove dependency", "body": "<p>You want a type to behave in a certain way. That is achieved via an interface. This case is no different. Simply add the desired behavior to your interface, as demonstrated below with the <code>Foo</code> interface.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo interface {\n    Bar()\n    TypeOf() reflect.Type\n}\n\ntype Baz struct{}\n\nfunc (b Baz) Bar() {\n    fmt.Println(\"I am a Fooer!\")\n}\n\nfunc (b Baz) TypeOf() reflect.Type {\n    return reflect.TypeOf(b)\n}\n\nfunc DoSomeThing(f Foo) {\n    f.Bar()\n    fmt.Println(f.TypeOf())\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    b := Baz{}\n    DoSomeThing(b)\n}\n</code></pre>\n\n<p><strong><kbd><a href=\"https://play.golang.org/p/I0Q8ag04A5X\" rel=\"nofollow noreferrer\">Run on playground</a></kbd></strong></p>\n"}], "owner": {"reputation": 73, "user_id": 9063497, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vs5DWZ9wuFk/AAAAAAAAAAI/AAAAAAAAARI/I2LlVcbGy3E/photo.jpg?sz=128", "display_name": "Johnny Bonelli", "link": "https://stackoverflow.com/users/9063497/johnny-bonelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568532931, "creation_date": 1568526499, "question_id": 57941502, "link": "https://stackoverflow.com/questions/57941502/generic-approach-and-recommendation-how-to-remove-dependency", "title": "Generic approach and recommendation how to remove dependency", "body": "<p>I have a question regarding dependency injection. \nPlease consider the example below.</p>\n\n<p>For example, selector() is a function that select something and guarantee return an interface</p>\n\n<p>In this example</p>\n\n<p>bar.node.go</p>\n\n<pre><code>type NodeTemplate struct {\n     Name string\n}\n\n// satisfy interface declared in db.foo.go \n//but never imports anything from db.foo.go\nfunc (node *NodeTemplate) GetUuidName() string {\n   if node != nil {\n      return node.Name\n   }\n   return \n}\n</code></pre>\n\n<p>db.foo.go</p>\n\n<pre><code>// interface declared in db.foo.go\n\ntype Node interface {\n   GetUuidName() string\n}\n\n</code></pre>\n\n<p>Option A\n// So selector receives a map of Some interface and populate a map</p>\n\n<pre><code>func SelectSomething(nodemap map[string]Node, selectFactor string) {\n     // selection from db and result populate in a map\n}\n</code></pre>\n\n<p>Option B</p>\n\n<p>Another pattern SelectSomething return a Node\nand it Interface</p>\n\n<p>So another package will depend on importing Node \nand that will introduce a dependency.</p>\n\n<pre><code>func SelectSomething(seleconsomething) []*Node {\n  // do selection and return a slice of SomeInterface\n\nn := &amp;Node{} // here it need to be concret type T\nreturn Node\n}\n</code></pre>\n\n<p>So based on logic I've described I see the first approach is better but in that approach,  select need do concrete type allocation in order to populate a map.   </p>\n\n<p>Consider another example</p>\n\n<pre><code>db.foo.go\n\ntype Node interface {\n   GetUuidName() string\n}\n\nfunc inserter(node *Node) error {\n   // do some work \n   node.GetUuidName()\n}\n</code></pre>\n\n<p>For a case like in inserter case, inserter has no external dependency, inserter just needs to receive something that satisfies the interface.  Declare interfaces locally and that brake a dependancy.</p>\n\n<p>But in the case of selector example, it has to do memory allocation in order to return or populate a map or return something that has concrete type T. So in both case, it has to have internal re-presentation. </p>\n\n<p>So here is my question can selector somehow at run time figure out a type it receives based on the interface and instantiate an object of that type and insert to a map as an interface or return a slice of the interface. ?</p>\n\n<p>By doing so selector function will have no dependancy on what it receives it just guarantee it will instantiate the same object type T\nand return interface. </p>\n\n<p>or can selector return interface but I guess I have to have a bi-directional interface between db package and package X or dynamic dispatcher need to do some magic ?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "blockchain", "hyperledger-fabric-sdk-go"], "comments": [{"owner": {"reputation": 529, "user_id": 1317806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/494fd6fab92e92a5a0bb35c5046d93b2?s=128&d=identicon&r=PG", "display_name": "SJP", "link": "https://stackoverflow.com/users/1317806/sjp"}, "edited": false, "score": 0, "creation_date": 1568527123, "post_id": 57941472, "comment_id": 102297883, "body": "I just tried with <code>go version go1.11.4 darwin&#47;amd64</code> and it installed correctly. I am on OSX."}], "answers": [{"tags": [], "owner": {"reputation": 633, "user_id": 59511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/037021b18e2fed97487375c7461997d2?s=128&d=identicon&r=PG", "display_name": "mhb", "link": "https://stackoverflow.com/users/59511/mhb"}, "is_accepted": false, "score": 0, "last_activity_date": 1569446385, "last_edit_date": 1569446385, "creation_date": 1569399978, "answer_id": 58094220, "question_id": 57941472, "link": "https://stackoverflow.com/questions/57941472/not-able-to-install-fabric-sdk-go-and-its-dependencies/58094220#58094220", "title": "Not able to install fabric-sdk-go and its dependencies", "body": "<p>If modules aren't turned on, <code>go get</code> will grab the incorrect version of some dependencies. As will most other dependency tools.</p>\n\n<p>The first error <code># github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric/core/operations</code> is due to go-kit differences between v0.8.0 and v0.9.0.</p>\n\n<p>The second error <code># github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util</code> is due to a more recent version of cfssl than supported.</p>\n\n<p>The sdk doesn't have an actual binary output, so we shouldn't be <code>go get</code>'ting it in any case.</p>\n"}], "owner": {"reputation": 382, "user_id": 8507208, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-piA3hykUNzU/AAAAAAAAAAI/AAAAAAAAAV8/pT3e9gHiJS8/photo.jpg?sz=128", "display_name": "Sibaprasad Maiti", "link": "https://stackoverflow.com/users/8507208/sibaprasad-maiti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569446385, "creation_date": 1568525988, "question_id": 57941472, "link": "https://stackoverflow.com/questions/57941472/not-able-to-install-fabric-sdk-go-and-its-dependencies", "title": "Not able to install fabric-sdk-go and its dependencies", "body": "<p>I am trying to download <code>fabric-sdk-go</code> library and all its dependency with the below command in a linux VM. </p>\n\n<pre><code>go get -u github.com/hyperledger/fabric-sdk-go/... \n</code></pre>\n\n<p>It is giving the below error. </p>\n\n<pre><code># github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric/core/operations\n../github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric/core/operations/system.go:227:23: not enough arguments in call to s.statsd.SendLoop\n        have (&lt;-chan time.Time, string, string)\n        want (context.Context, &lt;-chan time.Time, string, string)\n# github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util\n../github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:47:8: cannot convert nil to type csr.KeyRequest\n../github.com/hyperledger/fabric-sdk-go/internal/github.com/hyperledger/fabric-ca/util/csp.go:132:37: cannot use req.KeyRequest (type *csr.KeyRequest) as type csr.KeyRequest in argument to getBCCSPKeyOpts\n</code></pre>\n\n<p>Could this be because of <code>go</code> version mismatch or something? Here is the <code>go version</code> I am using the in linux VM. </p>\n\n<pre><code>go version go1.12.8 linux/amd64\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1568509954, "post_id": 57940353, "comment_id": 102295891, "body": "See <a href=\"https://github.com/golang/go/wiki/Modules#can-i-work-entirely-outside-of-vcs-on-my-local-filesystem\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 2098, "user_id": 4537346, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/f1b88bba0a7ac2231221ad56d5f00837?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Thompson", "link": "https://stackoverflow.com/users/4537346/martin-thompson"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568513519, "post_id": 57940353, "comment_id": 102296238, "body": "Thanks @CeriseLim&#243;n - but I still don&#39;t get it.   If I put one go.mod in the root directory - I am expecting to access a package using import &quot;mymodule/mysubdir/mypackage&quot;  but it&#39;s not working"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1568514029, "post_id": 57940353, "comment_id": 102296306, "body": "Follow the <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/1nYoAMFZVVM/eppaRW2rCAAJ\" rel=\"nofollow noreferrer\">example linked from the wiki page</a>.  Create a go.mod file in each module.  Change &quot;hello&quot; to &quot;module1&quot; and &quot;goodbye&quot; to &quot;module2&quot; to match the code in question.   Replace &quot;example.com/me/&quot; with whatever you want or use it as is."}], "answers": [{"comments": [{"owner": {"reputation": 2098, "user_id": 4537346, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/f1b88bba0a7ac2231221ad56d5f00837?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Thompson", "link": "https://stackoverflow.com/users/4537346/martin-thompson"}, "edited": false, "score": 0, "creation_date": 1568596085, "post_id": 57944766, "comment_id": 102311446, "body": "Apparently not any more  <a href=\"https://www.melvinvivas.com/go-version-1-11-modules/#targetText=Modules%20are%20a%20collection%20of%20related%20Go%20packages.&amp;targetText=With%20the%20current%20version%201.11,search%20for%20source%20code%20dependencies\" rel=\"nofollow noreferrer\">melvinvivas.com/go-version-1-11-modules/&hellip;</a>."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 2098, "user_id": 4537346, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/f1b88bba0a7ac2231221ad56d5f00837?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Thompson", "link": "https://stackoverflow.com/users/4537346/martin-thompson"}, "edited": false, "score": 0, "creation_date": 1574716596, "post_id": 57944766, "comment_id": 104322996, "body": "Updated with the new <code>go mod init</code>"}, {"owner": {"reputation": 554, "user_id": 4978619, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mfuR_lXQAeE/AAAAAAAAAAI/AAAAAAAAAdE/XdJgi2I6ecQ/photo.jpg?sz=128", "display_name": "Adharsh M", "link": "https://stackoverflow.com/users/4978619/adharsh-m"}, "edited": false, "score": 0, "creation_date": 1596535753, "post_id": 57944766, "comment_id": 111835503, "body": "I have 2 folders inside a root folder, module1 and module2 when i initialized both with go mod, and used the 2nd one inside first one, i couldn&#39;t get it, package x is not found in GOROOT"}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1596625842, "post_id": 57944766, "comment_id": 111870047, "body": "Have you insert the second dependencies into the first <code>go.mod</code> file? If the project is open source, please share the link"}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 8, "last_activity_date": 1572948258, "last_edit_date": 1572948258, "creation_date": 1568555686, "answer_id": 57944766, "question_id": 57940353, "link": "https://stackoverflow.com/questions/57940353/how-to-structure-golang-modules-and-project-structure-in-the-new-way/57944766#57944766", "title": "How to Structure Golang Modules and Project structure in the New way", "body": "<h1>OLD WAY</h1>\n\n<p>Go modules have to be placed in GOPATH for be used.</p>\n\n<p>When i start a new go project, i usually create a folder into the gopath</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cd $GOPATH\nls\n</code></pre>\n\n<p>Here you find 3 folder</p>\n\n<pre><code>bin  pkg  src\nls src\n&gt;code.cloudfoundry.org  github.com  github.ibm.com  golang.org  gopkg.in  go.uber.org  honnef.co  winterdrache.de\n</code></pre>\n\n<p>Into src, there are the code that you retrieve using 'go get' command.</p>\n\n<p>Everything that is here can be imported(/exported) into your software.</p>\n\n<p>Assume this test project:</p>\n\n<pre><code>github.ibm.com/\n\u2514\u2500\u2500 Alessio-Savi\n    \u2514\u2500\u2500 GoLog-Viewer\n        \u251c\u2500\u2500 conf\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 dev.json\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 test.json\n        \u251c\u2500\u2500 database\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 cloudant\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 cloudant.go\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 db2\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 db2.go\n        \u251c\u2500\u2500 datastructure\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 datastructures.go\n        \u251c\u2500\u2500 GinProva.go\n        \u251c\u2500\u2500 README.md\n        \u251c\u2500\u2500 request\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 request.go\n        \u2514\u2500\u2500 resources\n            \u2514\u2500\u2500 template01.html\n</code></pre>\n\n<p>NOTE: Data structure are saved in a go file in a properly directory for avoid circle-import</p>\n\n<p>You can import the datastructures.go (or another file that you need) using the following import statement</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package mypackage\n\nimport(\n    \"github.ibm.com/Alessio-Savi/GoLog-Viewer/datastructure\"\n)\n</code></pre>\n\n<p>In other file (in the same project as in other) you can simply use the package and let the IDE help you (due to the fact the the module/project is in GOPATH)</p>\n\n<p><a href=\"https://i.stack.imgur.com/rDvbY.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/rDvbY.png\" alt=\"enter image description here\"></a></p>\n\n<h1>New way</h1>\n\n<p>In order to create a new module, you can use the new <code>go module init</code> gotool command.</p>\n\n<p>A common way for create a new module, in case of public source code, is the follwing:  </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go mod init github.com/username/modulename\n</code></pre>\n\n<p>This will generate two file:  </p>\n\n<ol>\n<li>go.mod</li>\n<li>go.sum</li>\n</ol>\n\n<p>The <code>go.mod</code> file will contain every library/external golang code necessary to run your module.\nThe <code>go.sum</code> file will contain the hash of the library.</p>\n\n<p>I'll use for example my little general purpose library, called <code>GoGPUtils</code>.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>mkdir GoGPUtils\ncd $_\ngo mod init github.com/alessiosavi/GoGPUtils\n</code></pre>\n\n<p>Now, you can insert the library that you need in your code in the <code>go.mod</code> library. Assume that you need the <code>ahocorasick</code> implementation for work with string search, the <code>go.mod</code> file will contains the following content:</p>\n\n<pre><code>module github.com/alessiosavi/GoGPUtils\n\ngo 1.13\n\nrequire (\n    github.com/alessiosavi/ahocorasick v0.0.3\n    golang.org/x/tools v0.0.0-20191031220737-6d8f1af9ccc0 // indirect\n)\n</code></pre>\n\n<p>In the <code>require</code> section, there are the list of package needed. Now you can import the <code>ahocorasick</code> library in your code as following:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    ahocorasick \"github.com/alessiosavi/ahocorasick\"\n)\n</code></pre>\n"}], "owner": {"reputation": 2098, "user_id": 4537346, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/f1b88bba0a7ac2231221ad56d5f00837?s=128&d=identicon&r=PG&f=1", "display_name": "Martin Thompson", "link": "https://stackoverflow.com/users/4537346/martin-thompson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5003, "favorite_count": 1, "answer_count": 1, "score": 10, "last_activity_date": 1572948258, "creation_date": 1568509031, "question_id": 57940353, "link": "https://stackoverflow.com/questions/57940353/how-to-structure-golang-modules-and-project-structure-in-the-new-way", "title": "How to Structure Golang Modules and Project structure in the New way", "body": "<p>It seems that the way modules are used since 1.11 has changed , and I am trying to understand how to reference a module / package from another directory.</p>\n\n<p>Lets say I have a folder structure\n\\root\\module1\n\\root\\module2</p>\n\n<p>I have a go.mod in each directory and I can access / use those modules from the \\root directory</p>\n\n<p>How can I access module2 from module1.  The modules are not published anywhere ( nor do I want them to be ) - I just want to access them.  Module 2 contains types / structs that I need to use in mondule1 </p>\n\n<p>Kind Regards\nMartin</p>\n"}, {"tags": ["go", "packr"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1568498645, "post_id": 57939424, "comment_id": 102294452, "body": "&quot;still produces a binary with templates correctly embedded.&quot; --- how did you verify that?"}, {"owner": {"reputation": 101, "user_id": 1807397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95438748cc14bf05f7f3c00d721ffab5?s=128&d=identicon&r=PG", "display_name": "Karma Fusebox", "link": "https://stackoverflow.com/users/1807397/karma-fusebox"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1568499264, "post_id": 57939424, "comment_id": 102294554, "body": "@zerkms I can move the binary around and it is still able to produce the template contents. This would return filenotfound errors if they weren&#39;t embedded."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1568503038, "post_id": 57939424, "comment_id": 102295126, "body": "Maybe it&#39;s just that packr knows where to look for the files. <a href=\"https://github.com/gobuffalo/packr/tree/master/v2#development-made-easy\" rel=\"nofollow noreferrer\">github.com/gobuffalo/packr/tree/master/v2#development-made-e&zwnj;&#8203;asy</a> <i>&quot;Packr takes file resolution a step further. When declaring a new box you use a relative path, ./templates. When Packr receives this call it calculates out the absolute path to that directory. By doing this it means you can be guaranteed that Packr can find your files correctly, even if you&#39;re not running in the directory that the box was created in.&quot;</i>"}, {"owner": {"reputation": 101, "user_id": 1807397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95438748cc14bf05f7f3c00d721ffab5?s=128&d=identicon&r=PG", "display_name": "Karma Fusebox", "link": "https://stackoverflow.com/users/1807397/karma-fusebox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1568505257, "post_id": 57939424, "comment_id": 102295380, "body": "@mkopriva bingo! That explains why the binary can be moved around safely (thus pretending to have embedded stuff), but only works as long as the template files remain in their location. I didn&#39;t think of that. And no idea why I missed that info in the docs. If you&#39;d like to add this as an answer, I&#39;ll gladly mark it accepted. Thank you!"}], "owner": {"reputation": 101, "user_id": 1807397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95438748cc14bf05f7f3c00d721ffab5?s=128&d=identicon&r=PG", "display_name": "Karma Fusebox", "link": "https://stackoverflow.com/users/1807397/karma-fusebox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1568496849, "creation_date": 1568496849, "question_id": 57939424, "link": "https://stackoverflow.com/questions/57939424/how-why-can-gobuffalo-packr-run-at-build-time", "title": "How (why) can gobuffalo/packr run at build-time?", "body": "<p>I am using <a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\">gobuffalo/packr</a> to embed template files into my golang binary. Consider this simplified example:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gobuffalo/packr\"\n)\n\nfunc main() {\n    foo, _ := packr.NewBox(\"./templates\").FindString(\"text.tpl\")\n    println(foo)\n}\n</code></pre>\n\n<p>According to the packr docs, one has to run the <code>packr2</code> command in order to preprocess the template files so that they can be read and embedded by the regular go-compiler when it runs afterwards.</p>\n\n<p>However, I do NOT have the packr repo or the binary itself installed. That import line in the golang code is the only reference to packr on my machine. And yet, running <code>go install</code> still produces a binary with templates correctly embedded. </p>\n\n<p><strong>Question:</strong>\nHow can this be? What mechanism does packr employ here to be invoked at regular build time?</p>\n\n<p>(Initially I assumed that packr might just use some init() magic to trigger the preprocessing. I also played around with go-generate annotations to reproduce that behaviour. Both experiments were unsuccesful - init() functions are not run at build time; and go-generate needs to be called explicitely. That leads me to believe, packr is using somewhat more delicate magic here.)</p>\n"}, {"tags": ["go", "buffer"], "comments": [{"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1568492426, "post_id": 57938904, "comment_id": 102293406, "body": "When is a line &quot;truncated&quot; ? Could you add some example input lines ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568492436, "post_id": 57938904, "comment_id": 102293409, "body": "What exactly do you mean by &quot;truncation&quot;?"}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568493060, "post_id": 57938904, "comment_id": 102293527, "body": "truncated input would be, for example, if the buffer you are reading is for example 712 bytes in 4 lines, but your buffer is only 512 and p.Read will only get 512 bytes and only 3 lines and 34bytes of the last line, so you need to store the remaining and prepend the first line of the next buffer that will come with 200 bytes."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568493729, "post_id": 57938904, "comment_id": 102293628, "body": "You&#39;re first chunking the stream, and then trying to read lines from it. that&#39;s overkill, and likely to be wrong. Instead, use the scanner directly to read from the reader."}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568500486, "post_id": 57938904, "comment_id": 102294756, "body": "@bserdar could you please provide an example for that? The input for this code (data byte array) comes from processing the output of exec.Command execution that runs &quot;forever&quot;, it&#39;s not a network data or a flat file."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568520493, "post_id": 57938904, "comment_id": 102297090, "body": "@martin your code doesn&#39;t make sense if your intent is to process unbounded input stream. What does the function return? If the input is really unbounded, then you should: 1) Create the scanner using the reader directly, 2) Process the lines as they come. You should either process each line once you read them, pass the lines to a callback function for processing, or read the input in a separate goroutine and send the lines via a channel. The reader function will not return until all lines are read, so you either read and keep everything or process each line as you read them."}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568561070, "post_id": 57938904, "comment_id": 102304574, "body": "it doesn&#39;t matter what the function returns, you can replace the printf for a callback like I did in the edit, the point is to be able to processes the input for a daemon that keeps throwing output in the pipe from exec.Command,"}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568561274, "post_id": 57938904, "comment_id": 102304614, "body": "btw, the code is working perfectly, I just need a better way of doing this, see if you have enough information now @bserdar"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1568565709, "post_id": 57938904, "comment_id": 102305649, "body": "In that case, the answer by @mh-cbon is the best way to do this: use scanner directly."}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568569532, "post_id": 57938904, "comment_id": 102306631, "body": "@bserder I tried that, see the edit, the full code and output are there. Now it gives me a funky output. Thank you for looking into this."}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568575640, "post_id": 57938904, "comment_id": 102308136, "body": "I started two consumers over the same producer, the other one was supposed to be for stderr, sorry guys and thanks a lot for all the help."}], "answers": [{"comments": [{"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568561583, "post_id": 57938994, "comment_id": 102304661, "body": "thanks for the effort @mh-cbon, if I not supposed to use Scanner, what would be the alternative? I edited and added more info, see if this is clear now"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568562492, "post_id": 57938994, "comment_id": 102304847, "body": "using a bufio.Scanner is correct. But re instantiate a new Scanner to scan one line is not a correct usage. Assuming ping outputs to stdout, you can make a <code>bufio.NewScanner(cmd.Stdout)</code> and handles lines spitted out by the scanner directly."}, {"owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "edited": false, "score": 0, "creation_date": 1568568651, "post_id": 57938994, "comment_id": 102306396, "body": "please take a look at the edit I made, see if that&#39;s what you mean and see if you can find what&#39;s wrong. thx!!"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1568573531, "last_edit_date": 1568573531, "creation_date": 1568492489, "answer_id": 57938994, "question_id": 57938904, "link": "https://stackoverflow.com/questions/57938904/bufio-scanner-how-to-know-if-we-are-processing-a-new-line-or-a-truncated-string/57938994#57938994", "title": "bufio.Scanner: how to know if we are processing a new line or a truncated string?", "body": "<p>this is not how a <code>bufio.Scanner</code> should be used.</p>\n\n<p>The <code>bufio.Scanner</code> takes a reader and can return lines directly out of it.</p>\n\n<p><code>bufio.Scanner</code> will fail if the token is larger than <code>bufio.Scanner.maxTokenSize</code> which by default is <code>MaxScanTokenSize</code> but it won't return truncated results.</p>\n\n<p>You can also check the test suite at <a href=\"https://golang.org/src/bufio/scan_test.go#L214\" rel=\"nofollow noreferrer\">https://golang.org/src/bufio/scan_test.go#L214</a> (not that the MaxTokenSize method being used is defined with a special scheme to exists only during tests see <a href=\"https://golang.org/src/bufio/export_test.go#L16\" rel=\"nofollow noreferrer\">https://golang.org/src/bufio/export_test.go#L16</a>)</p>\n\n<p>You can also define your own underlying buffer before scanning to change that value <a href=\"https://golang.org/pkg/bufio/#Scanner.Buffer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/bufio/#Scanner.Buffer</a></p>\n\n<p>to roll your own version it might look like this <a href=\"https://play.golang.org/p/kDcO6eZPVhY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kDcO6eZPVhY</a> however going down that path requires you write additional tests and benchmarks.</p>\n\n<hr>\n\n<p>After multiple comments, here what OP was looking for:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"io\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n\n    cmd := exec.Command(\"ping\", \"8.8.8.8\")\n    var out io.Reader\n    {\n        stdout, err := cmd.StdoutPipe()\n        if err != nil {\n            log.Fatal(err)\n        }\n        stderr, err := cmd.StderrPipe()\n        if err != nil {\n            log.Fatal(err)\n        }\n        out = io.MultiReader(stdout, stderr)\n    }\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n    // defer cmd.Process.Kill()\n    s := bufio.NewScanner(out)\n    for s.Scan() {\n        log.Println(s.Text())\n    }\n    // if out closes, cmd closed.\n    log.Println(\"all done\")\n}\n</code></pre>\n"}], "owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 0, "accepted_answer_id": 57938994, "answer_count": 1, "score": -1, "last_activity_date": 1568573531, "creation_date": 1568491752, "last_edit_date": 1568570430, "question_id": 57938904, "link": "https://stackoverflow.com/questions/57938904/bufio-scanner-how-to-know-if-we-are-processing-a-new-line-or-a-truncated-string", "title": "bufio.Scanner: how to know if we are processing a new line or a truncated string?", "body": "<p>I basically need to process each string line from a limited buffer that is read from a stream. Using the bufio.Scanner I can go line-by-line with the scanner but had to use what seems to be an over-complicated solution to detect <em>\"truncation\"</em>. Is there a better way of doing this? Thanks a lot. I'm not tight to any lib or anything.</p>\n\n<pre><code>func (p *Parser) Read(data []byte, tmpline *string, n int, bufSize int) {\n    var line string\n    strdata := string(data)\n    scanner := bufio.NewScanner(strings.NewReader(strdata))\n    line = \"\"\n    for scanner.Scan() {\n        if line != \"\" {\n            if p.lineProcessor != nil {\n                p.lineProcessor(line)\n            }\n        }\n        line = scanner.Text()\n        if *tmpline != \"\" {\n            line = *tmpline + line //prepend line here\n            *tmpline = \"\"\n        }\n    }\n    if n == bufSize &amp;&amp; data[bufSize-1] != '\\n' { //detecting a fragment here, overcomplicated?\n        *tmpline = line\n    } else {\n            //fmt.Println(\"last line &gt;[\" + line + \"]\")\n            if p.lineProcessor != nil {\n                p.lineProcessor(line)\n            }\n    }\n}\n\nfunc (p *Parser) Handle(r io.Reader, bufSize int) ([]byte, error) {\n    var out []byte\n    buf := make([]byte, bufSize)\n    var n int\n    var err error\n    tmpline := \"\"\n    for {\n        n, err = r.Read(buf[:])\n        if n &gt; 0 {\n            data := buf[:n]\n            p.Read(data, &amp;tmpline, n, bufSize)\n        }\n        if err != nil {\n            if err == io.EOF {\n                err = nil\n            }\n            break\n        }\n    }\n    return out, err\n}\n\nmain\n...\ncmd := exec.Command(\"ping\", \"8.8.8.8\")\n\n//var stdout, stderr []byte\nvar errStdout, errStderr error\n//this is the type of stream I want to process **stdoutIn** and **stderrIn**\nstdoutIn, _ := cmd.StdoutPipe()\nstderrIn, _ := cmd.StderrPipe()\n// 10 is the bufSize\nparser.Init(stdoutIn, stderrIn, wg, 10, lineProcessor)\n...\n</code></pre>\n\n<p><strong>EDIT</strong>: I tried to implement the proposed solution. Now I have broke what was working (even though seemed overcomplicated). The output seems to be very funky. Here's the FULL CODE and FULL OUTPUT:</p>\n\n<pre><code>package main\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os/exec\"\n    \"sync\"\n)\ntype LineProcessor func(string)\ntype Parser struct {\n    r             io.Reader\n    lineProcessor LineProcessor\n    scanner       bufio.Scanner\n}\n\nfunc (p *Parser) Init(stdoutIn io.Reader, stderrIn io.Reader,\n    wg sync.WaitGroup,\n    lineProcessor LineProcessor) {\n    wg.Add(2)\n    p.lineProcessor = lineProcessor\n    p.scanner = *bufio.NewScanner(stdoutIn)\n    go p.Handler(stdoutIn, wg)\n    go p.Handler(stderrIn, wg)\n}\nfunc (p *Parser) Handler(r io.Reader, wg sync.WaitGroup) { // ([]byte, error)\n    var line string\n    for p.scanner.Scan() {\n        line = p.scanner.Text()\n        if p.lineProcessor != nil {\n            p.lineProcessor(line)\n        }\n    }\n    wg.Done()\n}\nfunc lineProcessor(line string) {\n    fmt.Println(line)\n}\nfunc main() {\n    var err error\n    cmd := exec.Command(\"ping\", \"8.8.8.8\") \n\n    var errStdout, errStderr error\n    stdoutIn, _ := cmd.StdoutPipe()\n    stderrIn, _ := cmd.StderrPipe()\n\n    var parser Parser\n\n    var wg sync.WaitGroup\n    parser.Init(stdoutIn, stderrIn, wg, lineProcessor)\n\n    err = cmd.Start()\n    if err != nil {\n        log.Fatalf(\"cmd.Start() failed with '%s'\\n\", err)\n    }\n\n    fmt.Printf(\"Waiting\\n\")\n    wg.Wait()\n\n    err = cmd.Wait()\n    if err != nil {\n        log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n    }\n    if errStdout != nil || errStderr != nil {\n        log.Fatal(\"failed to capture stdout or stderr\\n\")\n    }\n}\n\n$./buggysolution\nWaiting\nPING 8.8.8.8 (8.8.8.8): 56 data bytes\n64 bytes from 8.8.8.8: icmp_seq=0 ttl=52 time=4.786 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=52 time=3.661 ms\n64 bytes from 8.8.8.8: icmp_seq=4 ttl=52 time=4.117 ms\n64 bytes from 8.8.8.8: icmp_seq=6 ttl=52 time=4.172 ms\n64 bytes from 8.8.8.8: icmp_seq=8 ttl=52 time=3.584 ms\n64 bytes from 8.8.8.8: icmp_seq=10 ttl=52 time=4.301 ms\nmp_seq=11 ttl=52 time=4.534 ms\n64 bytes from 8.8.8.8: icmp_seq=12 ttl=52 time=4.349 ms\n64 bytes from 8.8.8.8: icmp_seq=13 ttl=52 time=4.923 ms\n64 bytes from 8.8.8.8: icmp_seq=14 ttl=52 time=4.349 ms\n64 bytes from 8.8.8.8: icmp_seq=15 ttl=52 time=4.106 ms\n64 bytes from 8.8.8.8: icmp_seq=16 ttl=52 time=4.270 ms\n64 bytes from 8.8.8.8: icmp_seq=17 ttl=52 time=4.231 ms\n64 bytes from 8.8.8.8: icmp_seq=18 ttl=52 time=4.915 ms\n64 bytes from 8.8.8.8: icmp_seq=19 ttl=52 time=4.487 ms\n64 bytes from 8.8.8.8: icmp_seq=20 ttl=52 time=4.182 ms\n64 bytes from 8.8.8.8: icmp_seq=21 ttl=52 time=4.369 ms\n64 bytes from 8.8.8.8: icmp_seq=22 ttl=52 time=4.287 ms\n64 bytes from 8.8.8.8: icmp_seq=23 ttl=52 time=3.922 ms\n64 bytes from 8.8.8.8: icmp_seq=24 ttl=52 time=4.905 ms\n64 bytes from 8.8.8.8: icmp_seq=25 ttl=52 time=4.226 ms\n64 bytes from 8.8.8.8: icmp_seq=27 ttl=52 time=4.052 ms\n64 bytes from 8.8.8.8: icmp_seq=29 ttl=52 time=3.453 ms\n64 bytes from 8.8.8.8: icmp_seq=31 ttl=52 time=5.103 ms\n64 bytes from 8.8.8.8: icmp_seq=33 ttl=52 time=4.066 ms\n64 bytes from 8.8.8.8: icmp_seq=35 ttl=52 time=4.128 ms\n64 bytes from 8.8.8.8: icmp_seq=37 ttl=52 time=4.982 ms\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=52 time=4.206 ms\n.64 bytes from 8.8.8.8: icmp_seq=39 ttl=52 time=4.215 ms\n.8: icmp_seq=3 ttl=52 time=4.218 ms\ntl=52 time=3.650 ms\n8: icmp_seq=2 ttl=52 time=3.661 ms\nttl=52 time=4.791 ms\n: icmp_seq=5 ttl=52 time=3.581 ms\n ttl=52 time=4.211 ms\n icmp_seq=4 ttl=52 time=4.117 ms\n4 ttl=52 time=4.245 ms\nicmp_seq=7 ttl=52 time=4.955 ms\n45 ttl=52 time=4.518 ms\ncmp_seq=6 ttl=52 time=4.172 ms\n=46 ttl=52 time=4.764 ms\nseq 9\n^C\n</code></pre>\n\n<p>Thanks for any fix.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568495347, "post_id": 57938875, "comment_id": 102293915, "body": "Show messages logged for the application and the code that runs the net/http server."}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568496943, "post_id": 57938875, "comment_id": 102294159, "body": "Edited my original post to include a screenshot of the logs!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568497605, "post_id": 57938875, "comment_id": 102294276, "body": "The application responds to /_ah/start with a redirect (status 301).  How did you determine that the application responds with a 200 running locally? Does the application redirect any requests?"}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568498556, "post_id": 57938875, "comment_id": 102294439, "body": "When I run my server locally I am able to hit <code>&#47;_ah&#47;start</code> and it returns a 200. I am not sure how to mimic the setup of the actual AppEngine environment locally so that basically just validates that my server works as expected in a more general sense, not that it works in the context of AppEngine. I have no idea where the redirect is coming from when I deploy to GAE, but it&#39;s interesting that that first error log happens before my server logs anything, meaning it&#39;s trying to hit that endpoint before running main.go."}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568498655, "post_id": 57938875, "comment_id": 102294456, "body": "My server only redirects http traffic to https, which I added when I was using the flex environment. I wonder if that&#39;s the culprit? I&#39;ll try removing that middleware and see what happens."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568498846, "post_id": 57938875, "comment_id": 102294483, "body": "The application must serve traffic over http when running in the standard environment.  Remove the redirect.  If that does not work, the update the question with the code that runs the http/server (as requested earlier) and anything else that might be relevant."}, {"owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1568499241, "post_id": 57938875, "comment_id": 102294546, "body": "Removing the https redirect did the trick! Thanks for pointing me in the right direction. I didn&#39;t think that could be the issue because the logs seemed to indicate that it was making that request and being redirected before even starting my server. Also my bad re: the code - I misread your comment as just asking for the <i>logs</i> from both places, hence that screenshot."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1568499940, "last_edit_date": 1568499940, "creation_date": 1568499346, "answer_id": 57939667, "question_id": 57938875, "link": "https://stackoverflow.com/questions/57938875/gae-go-1-11-instance-startup-issues-when-migrating-from-flex-to-standard/57939667#57939667", "title": "GAE Go 1.11 instance startup issues when migrating from flex to standard", "body": "<p>The application redirects http to https per discussion in the comments.</p>\n\n<p>An application running in the standard environment must serve http.  The App Engine infrastructure handles https.</p>\n\n<p>Fix by removing the redirect from http to https.</p>\n"}], "owner": {"reputation": 193, "user_id": 6865723, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qKOX--5uDDY/AAAAAAAAAAI/AAAAAAAAAq8/CSqOjs28cyo/photo.jpg?sz=128", "display_name": "Kayla Fuchs", "link": "https://stackoverflow.com/users/6865723/kayla-fuchs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 57939667, "answer_count": 1, "score": 1, "last_activity_date": 1568499940, "creation_date": 1568491511, "last_edit_date": 1568496915, "question_id": 57938875, "link": "https://stackoverflow.com/questions/57938875/gae-go-1-11-instance-startup-issues-when-migrating-from-flex-to-standard", "title": "GAE Go 1.11 instance startup issues when migrating from flex to standard", "body": "<p>I am in the process of migrating a simple app using the Go 1.11 runtime from the AppEngine flex environment to the standard environment because flex got shockingly expensive for my low-traffic site (and standard wasn't available for this runtime until recently). Every time GAE hits the <code>/_ah/start</code> endpoint for my app it logs a 301 and the following error: <code>Process terminated because it failed to respond to the start request with an HTTP status code of 200-299 or 404.</code></p>\n\n<p>My server does have a handler for <code>/_ah/start</code> that simply writes a 200 and works fine locally. I also tried adding a handler for all routes in <code>app.yaml</code> just to make sure requests to the AppEngine load balancer are actually being routed to my server, but it still isn't working. I know from the service logs that my server is starting and listening on the correct port but it gets restarted over and over and can't actually handle any requests because of this issue with the GAE start request.</p>\n\n<p>Here's my <code>app.yaml</code>:</p>\n\n<pre><code>runtime: go111\ninstance_class: B1\nbasic_scaling:\n  max_instances: 1\nhandlers:\n- url: /.*\n  script: auto\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/u52Gh.png\" rel=\"nofollow noreferrer\">Edit: Here's a screenshot of the logs</a></p>\n"}]