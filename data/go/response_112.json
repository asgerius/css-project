[{"tags": ["python", "go", "utf-8", "language-comparisons"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488399737, "post_id": 42541297, "comment_id": 72218349, "body": "strings in Go are assumed to be utf8 encoded. What problem are you trying to solve?"}, {"owner": {"reputation": 67, "user_id": 7643529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/693a0db34894a7d1062d810fad28f420?s=128&d=identicon&r=PG&f=1", "display_name": "Jim", "link": "https://stackoverflow.com/users/7643529/jim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488431663, "post_id": 42541297, "comment_id": 72230211, "body": "I am trying to bcrypt a password that a user enters. The python code does an str.encode(&#39;utf8&#39;) before bcrypting it. I was wondering how do I do the equivalent in Go, but I guess it&#39;s &quot;already handled&quot;?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488433740, "post_id": 42541297, "comment_id": 72230902, "body": "Read <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a> carefully."}], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 13, "last_activity_date": 1488400338, "creation_date": 1488400338, "answer_id": 42541495, "question_id": 42541297, "link": "https://stackoverflow.com/questions/42541297/equivalent-of-pythons-encodeutf8-in-golang/42541495#42541495", "title": "Equivalent of python&#39;s encode(&#39;utf8&#39;) in golang", "body": "<p>In Python, <code>str.encode('utf8')</code> converts a string to bytes. In Go, strings are utf-8 encoded already, if you need bytes, you can do: <code>[]byte(str)</code>. </p>\n"}], "owner": {"reputation": 67, "user_id": 7643529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/693a0db34894a7d1062d810fad28f420?s=128&d=identicon&r=PG&f=1", "display_name": "Jim", "link": "https://stackoverflow.com/users/7643529/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6149, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1536031378, "creation_date": 1488399661, "last_edit_date": 1536031378, "question_id": 42541297, "link": "https://stackoverflow.com/questions/42541297/equivalent-of-pythons-encodeutf8-in-golang", "title": "Equivalent of python&#39;s encode(&#39;utf8&#39;) in golang", "body": "<p>How can I convert a string in Golang to UTF-8 in the same way as one would use <code>str.encode('utf8')</code> in Python? (I am trying to translate some code from Python to Golang; the str comes from user input, and the encoding is used to calculate a hash)</p>\n\n<p>As far as I understand, the Python code converts unicode text into a string. The string is a collection of UTF-8 bytes. This sounds similar to strings in Go. So is this encoding already done for me when I store some text as a Go string?</p>\n\n<p>Should I walk over the string and try <code>utf8.EncodeRune</code> in go? I'm really confused. </p>\n"}, {"tags": ["go", "ssh", "aix", "pty"], "comments": [{"owner": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "edited": false, "score": 0, "creation_date": 1488396630, "post_id": 42540183, "comment_id": 72216529, "body": "There are support forums for AIX on IBM websites. (Sorry I don&#39;t have the URLS anymore (and they have likely changed anyway)). Also, there is pretty good group of AIX users on <a href=\"http://ittoolbox.com\" rel=\"nofollow noreferrer\">ittoolbox.com</a> forums. You do a simple sign up, and then search/browse their forums. Once you find the AIX forum, you may need to &quot;join&quot; it separately. I don&#39;t think you&#39;ll find the exact answer there, but a better place to get AIX help. Good luck."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488398634, "post_id": 42540183, "comment_id": 72217698, "body": "Uh. Why xterm? Isn&#39;t it the program supposed to run remotely? If yes, does it have a chance to do that successfully (that is, sees a proper DISPLAY variable in its environment block etc)? What if you try something else instead?"}, {"owner": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 1, "creation_date": 1488431198, "post_id": 42540183, "comment_id": 72230050, "body": "Random questions: Why would you use <code>sudo</code> if you connect as <code>root</code>? Why don&#39;t you upgrade to OpenSSL-1.0.2k and OpenSSH-7.4p1? Did try to run sshd in debug mode (<code>sshd -D -d -d -d p anotherport</code>)?"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "edited": false, "score": 0, "creation_date": 1488437469, "post_id": 42540183, "comment_id": 72232457, "body": "@shellter thank you. I&#39;ll try."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488437582, "post_id": 42540183, "comment_id": 72232515, "body": "@kostix thank you for your question. Maybe I explained improperly. The program connects to the remote server via SSH then gathers some data and sends it back to the main service. Also, we have the local agent which is recommended way to work with our service but AIX is not supported by Go so the only way to gather data is to use the program from the question."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 1339, "user_id": 2141064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c56d69ec8f5e469a8c6ca22d60271e9b?s=128&d=identicon&r=PG", "display_name": "Lorinczy Zsigmond", "link": "https://stackoverflow.com/users/2141064/lorinczy-zsigmond"}, "edited": false, "score": 0, "creation_date": 1488437652, "post_id": 42540183, "comment_id": 72232545, "body": "@LorinczyZsigmond thank you for your reply. We don&#39;t require to use root account from end-users. They may log in as root, as a user with sudo privileges, and as a simple user. You are right and in first and last cases we don&#39;t need <code>pty</code>, but some part of our users uses the second variant so we should support it too. And thank you for the idea about debugging from the server side. I&#39;ll try."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488450578, "post_id": 42540183, "comment_id": 72240591, "body": "Sorry, disregard my comment: I was on mobile and had no simple way to see the docs so I thought <code>RequestPty()</code> also starts a remote process. Now I see that&#39;s the terminal name string."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1488450623, "post_id": 42540183, "comment_id": 72240624, "body": "Hm. I wonder whether specifying <code>vt100</code> or even <code>dumb</code> fixes the problem."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488465043, "post_id": 42540183, "comment_id": 72250579, "body": "@kostix I already tried <code>vt100</code> yesterday. Tried <code>dumb</code> right now with the same result. A bit later I&#39;ll try ssh debug as @LorinczyZsigmond suggested but not sure if it will display <code>pty</code> related issues."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488467092, "post_id": 42540183, "comment_id": 72252064, "body": "You can also connect with the openssh client with <code>-vvv</code> to see how that might be handling the connection differently."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488472173, "post_id": 42540183, "comment_id": 72255700, "body": "@JimB @kostix I compared Debian and AIX <code>sshd</code> debug output and updated the post. It seems like a bug in OpenSSH but I don&#39;t know if this is possible for two different versions of OpenSSH. Anyway, I&#39;m pretty sure now that this is not Go SSH implementation issue. So I&#39;ll just try to replace commands that require <code>sudo</code> with alternatives when it is possible."}, {"owner": {"reputation": 1875, "user_id": 341980, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0ce4db5e1083663c575158643313852c?s=128&d=identicon&r=PG", "display_name": "pedz", "link": "https://stackoverflow.com/users/341980/pedz"}, "edited": false, "score": 0, "creation_date": 1491094292, "post_id": 42540183, "comment_id": 73401727, "body": "From the setsid() man page: EPERM \tThe calling process is already a process group leader, or the process group ID of a process other than the calling process matches the process ID of the calling process. -- but why sshd would be hitting that is beyond me.  And why this is specific to your particular path is also very odd."}], "answers": [{"comments": [{"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "edited": false, "score": 0, "creation_date": 1498204125, "post_id": 44714477, "comment_id": 76414003, "body": "Thanks. I&#39;ll try."}], "tags": [], "owner": {"reputation": 1, "user_id": 8203528, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/1bad0b1e8383081d2fd4a92bc186efb0?s=128&d=identicon&r=PG", "display_name": "mi4mana", "link": "https://stackoverflow.com/users/8203528/mi4mana"}, "is_accepted": false, "score": 0, "last_activity_date": 1498201093, "last_edit_date": 1498201093, "creation_date": 1498199322, "answer_id": 44714477, "question_id": 42540183, "link": "https://stackoverflow.com/questions/42540183/gos-ssh-client-and-pty-on-aix/44714477#44714477", "title": "Go&#39;s SSH client and PTY on AIX", "body": "<p>I had similar problem with \"Allocating pty\" and then exiting from ssh session. Here is log of my sshd debug:</p>\n\n<p>sshd drops connection with error :3004-010 Failed setting terminal ownership and mode.</p>\n\n<blockquote>\n  <p><strong>debug1: Allocating pty.</strong><br>\n  debug1: session_pty_req: session 0 alloc /dev/pts/2<br>\n  <strong>debug1: Ignoring unsupported tty mode opcode 13 (0xd)<br>\n  debug1: Ignoring unsupported tty mode opcode 18 (0x12)</strong><br>\n  debug1: server_input_channel_req: channel 0 request env reply 0<br>\n  debug1: session_by_channel: session 0 channel 0<br>\n  debug1: session_input_channel_req: session 0 req env<br>\n  debug2: Ignoring env request LANG: disallowed name<br>\n  debug1: server_input_channel_req: channel 0 request shell reply 1<br>\n  debug1: session_by_channel: session 0 channel 0<br>\n  debug1: session_input_channel_req: session 0 req shell<br>\n  debug1: Values: options.num_allow_users: 0<br>\n  debug1: RLOGIN VALUE  :1  </p>\n  \n  <p>setsid: Operation not permitted.</p>\n  \n  <p>The OS is AIX 7.1 (7100-04-03-1642)</p>\n</blockquote>\n\n<p>The goal of my environment is to authenticate user on AIX through remote ldap user over ssh (ldap server actually is novell eDirectory). \nSo, I had similar issue with user authentication.</p>\n\n<p>I fixed login over ssh as in eDirectory Schema (rfc2703), added following object extensions to the user:</p>\n\n<p>posixAccount<br>\nposixGroup<br>\nshadowAccount<br>\nuamPosixUser (as I am not sure is it necessary this object)  </p>\n\n<p>I just want to note that on OS AIX following user isn't local, not exist in <code>/etc/passwd</code> and <code>/etc/group</code>.</p>\n\n<p>V.Davidov</p>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 5342477, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qwPNU.jpg?s=128&g=1", "display_name": "Oleg Korchagin", "link": "https://stackoverflow.com/users/5342477/oleg-korchagin"}, "is_accepted": true, "score": 3, "last_activity_date": 1574241270, "creation_date": 1574241270, "answer_id": 58950627, "question_id": 42540183, "link": "https://stackoverflow.com/questions/42540183/gos-ssh-client-and-pty-on-aix/58950627#58950627", "title": "Go&#39;s SSH client and PTY on AIX", "body": "<p>better late than never</p>\n\n<p>IBM said it was a bug in openssh - race condition while PTY allocation\n<a href=\"https://www-01.ibm.com/support/docview.wss?uid=isg1IV82042\" rel=\"nofollow noreferrer\">https://www-01.ibm.com/support/docview.wss?uid=isg1IV82042</a></p>\n\n<p>fixed in package openssh.base.server:7.5.102.1500</p>\n\n<p>it strange that bug only occurs in aix, never in linux. nevertheless, problem is solved in my case</p>\n"}], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1265, "favorite_count": 0, "accepted_answer_id": 58950627, "answer_count": 2, "score": 2, "last_activity_date": 1574241270, "creation_date": 1488395923, "last_edit_date": 1497687166, "question_id": 42540183, "link": "https://stackoverflow.com/questions/42540183/gos-ssh-client-and-pty-on-aix", "title": "Go&#39;s SSH client and PTY on AIX", "body": "<p>I doubt that I'll get an answer here as AIX is very rare thing but I should try at least.</p>\n\n<p><strong>The background</strong></p>\n\n<p>We have the program. The program uses <code>golang.org/x/crypto/ssh</code> library to connect to the remote services and do some things. The program is part of the large service and widely tested by end-users. It works without issues (at least related to connection) not only with all Linux-based clients (include quite old things like Ubuntu 12.02) but also with the clients on FreeBSD, OpenBSD, NetBSD, MacOSX, Solaris SPARC, HP-UX and other *nixes. So looks like it wasn't tested only on the Samsung refrigerators. And yesterday I was sure that it will be able to connect to the refrigerator and do what is needed without any issues. But that was yesterday... </p>\n\n<p><strong>The problem</strong></p>\n\n<p>Today we decided to add AIX support to our program. And we partly failed.</p>\n\n<p>The problem description is simple: after <code>pty</code> request program stops working. I mean I can do <code>ssh.RequestPty</code> it executes without any issues but when I'm trying to execute commands after the app just hangs. Without errors, without nothing. Just hangs. </p>\n\n<p><em>When it works?</em></p>\n\n<ol>\n<li>It works in PuTTY/KiTTY so I'm able to connect to the remote host.</li>\n<li>If I remove <code>requestPty</code> - everything works. But we need <code>pty</code> for the <code>sudo</code>. </li>\n<li>It works without issues if I request <code>session.Shell</code> even with <code>pty</code> requested. So if I write kind of interactive shell, it works perfectly.</li>\n</ol>\n\n<p><strong>What have I tried so far</strong></p>\n\n<p>I tried to debug so far as I could. The last command that executes is <code>ch.sendMessage(msg)</code> from <code>ssh/channel.go</code>. I mean it writes packet and that's all. No data returned from the remote host.</p>\n\n<p>For the tests, I used 3 versions of AIX - 5.3, 6.1 and 7.1. No difference.</p>\n\n<p>OpenSSH versions are different:</p>\n\n<ul>\n<li>5.3 - OpenSSH_5.2p1, OpenSSL 0.9.8k 25 Mar 2009</li>\n<li>6.1 &amp; 7.1 - OpenSSH_6.0p1, OpenSSL 1.0.1e 11 Feb 2013</li>\n</ul>\n\n<p>All machines are running in LPARs but I doubt this is related to the issue.</p>\n\n<p>I have no idea what is wrong. And I even can't say if this is common AIX issue or only our test machine. Here is the sample program that should write <code>IT WORKS</code> if it works </p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc main() {\n    server := \"127.0.0.1:22\"\n    user := \"root\"\n    p := \"password\"\n\n    config := &amp;ssh.ClientConfig{\n        User: user,\n        Auth: []ssh.AuthMethod{ssh.Password(p)},\n    }\n    conn, err := ssh.Dial(\"tcp\", server, config)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer conn.Close()\n    session, err := conn.NewSession()\n    if err != nil {\n        panic(err.Error())\n    }\n    defer session.Close()\n\n    // Comment below and everything works\n    modes := ssh.TerminalModes{\n        ssh.ECHO:          0,\n        ssh.TTY_OP_ISPEED: 14400,\n        ssh.TTY_OP_OSPEED: 14400,\n    }\n\n    if err := session.RequestPty(\"xterm\", 80, 40, modes); err != nil {\n        panic(err.Error())\n    }\n    // Comment above and everything works\n    session.Run(\"echo 1\")\n    println(\"IT WORKS\")\n}\n</code></pre>\n\n<p>If you have AIX somewhere around and can run this code against it I'd appreciate your feedback. </p>\n\n<p>If you have any ideas (even crazy) why it may fail and where else I can look, don't be shy.</p>\n\n<p><strong>Update (2017-03-02):</strong></p>\n\n<p>By suggestion from @LorinczyZsigmond I launched <code>sshd</code> in debug mode. Results are a bit strange.</p>\n\n<p>Here is part of <code>Debian 9.0 OpenSSH_6.0p1 Debian-4+deb7u3, OpenSSL 1.0.1t  3 May 2016</code> log after sample program execution:</p>\n\n<pre><code>debug1: session_input_channel_req: session 0 req pty-req\ndebug1: Allocating pty.\ndebug1: session_pty_req: session 0 alloc /dev/pts/1\ndebug1: SELinux support disabled\ndebug1: server_input_channel_req: channel 0 request exec reply 1\ndebug1: session_by_channel: session 0 channel 0\ndebug1: session_input_channel_req: session 0 req exec\n\ndebug2: fd 3 setting TCP_NODELAY\n\ndebug3: packet_set_tos: set IP_TOS 0x10\n\ndebug1: Setting controlling tty using TIOCSCTTY.\n\ndebug2: channel 0: rfd 10 isatty\ndebug2: fd 10 setting O_NONBLOCK\n\ndebug3: fd 8 is O_NONBLOCK\n\ndebug2: channel 0: rcvd eof\ndebug2: channel 0: output open -&gt; drain\n</code></pre>\n\n<p>It works as expected.</p>\n\n<p>Now the same block from <code>AIX 7.1 OpenSSH_6.0p1, OpenSSL 1.0.1e 11 Feb 2013</code> log:</p>\n\n<pre><code>debug1: session_input_channel_req: session 0 req pty-req\ndebug1: Allocating pty.\ndebug1: session_pty_req: session 0 alloc /dev/pts/42\ndebug1: server_input_channel_req: channel 0 request exec reply 1\ndebug1: session_by_channel: session 0 channel 0\ndebug1: session_input_channel_req: session 0 req exec\ndebug1: Values: options.num_allow_users: 0\ndebug1: RLOGIN VALUE  :1\ndebug1: audit run command euid 0 user root command 'whoami'\n\nsetsid: Operation not permitted.\n</code></pre>\n\n<p>After <code>setsid: Operation not permitted.</code> it does nothing until I kill it with <kbd>Ctrl+C</kbd>. When I kill it it returns:</p>\n\n<pre><code>debug2: fd 4 setting TCP_NODELAY\ndebug3: packet_set_tos: set IP_TOS 0x10\ndebug2: channel 0: rfd 10 isatty\ndebug2: fd 10 setting O_NONBLOCK\ndebug3: fd 8 is O_NONBLOCK\ndebug2: notify_done: reading\nExiting on signal 2\ndebug1: do_cleanup\ndebug1: session_pty_cleanup: session 0 release /dev/pts/42\ndebug1: audit session close euid 0 user root tty name /dev/pts/42\ndebug1: audit event euid 0 user root event 12 (SSH_connabndn)\ndebug1: Return Val-1 for auditproc:0\n</code></pre>\n\n<p>And sends the result of <code>whoami</code> back to the client. This looks like a bug in SSH server, but is this possible for the 2 different versions?</p>\n\n<p>Another interesting fact is when I run <code>sshd</code> with <code>truss</code> (kind of <code>strace</code> for AIX) the output looks like this:</p>\n\n<pre><code>debug1: session_input_channel_req: session 0 req pty-req\ndebug1: Allocating pty.\ndebug1: session_pty_req: session 0 alloc /dev/pts/42\ndebug1: server_input_channel_req: channel 0 request exec reply 1\ndebug1: session_by_channel: session 0 channel 0\ndebug1: session_input_channel_req: session 0 req exec\ndebug1: Values: options.num_allow_users: 0\ndebug1: RLOGIN VALUE  :1\ndebug1: audit run command euid 0 user root command 'whoami'\n\ndebug2: fd 4 setting TCP_NODELAY\n\ndebug3: packet_set_tos: set IP_TOS 0x10\n\ndebug2: channel 0: rfd 10 isatty\ndebug2: fd 10 setting O_NONBLOCK\n\ndebug3: fd 8 is O_NONBLOCK\n\nsetsid: Operation not permitted.\n\ndebug2: channel 0: rcvd eof\ndebug2: channel 0: output open -&gt; drain\ndebug2: channel 0: obuf empty\ndebug2: channel 0: close_write\ndebug2: channel 0: output drain -&gt; closed\n</code></pre>\n\n<p>But <code>truss</code> output is a bit more strange than <code>strace</code> one (at least for someone who don't use *nix trace tools on daily basis) so I don't understand what is going on in the logs. If there is someone more skilled with this stuff here is the part of the trace data <a href=\"http://pastebin.com/YdzQwbt2\" rel=\"nofollow noreferrer\">http://pastebin.com/YdzQwbt2</a> from <code>debug1: RLOGIN VALUE  :1</code>.</p>\n\n<p>Also, in the logs, I found that <code>ssh.Shell()</code> works because it doesn't request <code>pty</code>. It starts an interactive session (or something like that). But in my case, the interactive session is not an option.</p>\n"}, {"tags": ["json", "go", "struct", "google-ads-api"], "answers": [{"tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": true, "score": 2, "last_activity_date": 1488583091, "creation_date": 1488583091, "answer_id": 42590032, "question_id": 42539006, "link": "https://stackoverflow.com/questions/42539006/golang-gads-package-authentication-without-file/42590032#42590032", "title": "Golang gads Package Authentication without File", "body": "<p>Assuming you have the credentials in a string as json, make the <code>AuthConfig</code> in your code like:</p>\n\n<pre><code>func NewCredentialsFromStr(config string, ctx context.Context) (ac gads.AuthConfig, err error) {\n    if err := json.Unmarshal(config, &amp;ac); err != nil {\n        return ac, err\n    }\n    ac.file = pathToFile\n    ac.tokenSource = ac.OAuth2Config.TokenSource(ctx, ac.OAuth2Token)\n    ac.Auth.Client = ac.OAuth2Config.Client(ctx, ac.OAuth2Token)\n    return ac, err\n}\n</code></pre>\n"}], "owner": {"reputation": 965, "user_id": 3291194, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ziZgJ.jpg?s=128&g=1", "display_name": "Alex Luis Arias", "link": "https://stackoverflow.com/users/3291194/alex-luis-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 42590032, "answer_count": 1, "score": 1, "last_activity_date": 1488583091, "creation_date": 1488391921, "question_id": 42539006, "link": "https://stackoverflow.com/questions/42539006/golang-gads-package-authentication-without-file", "title": "Golang gads Package Authentication without File", "body": "<p>I'm trying to use a google adwords api golang package I found. However, this package only has methods/functions for authenticating against a file that contains all the credentials. \nI am very new to Golang so I'm not sure how to go about creating a new function to authenticate using string variables that contain the necessary information. </p>\n\n<p>The package can be found at: \n<a href=\"https://github.com/emiddleton/gads\" rel=\"nofollow noreferrer\">https://github.com/emiddleton/gads</a></p>\n\n<p>I did some digging to see if I can figure it out. I found an example for the structure of the file that contains the information. Here's an example:</p>\n\n<pre><code> {\n     \"oauth2.Config\": {\n         \"ClientID\": \"4585432543254323-f4qfewtg2qtg5esy24t45h.apps.googleusercontent.com\",\n         \"ClientSecret\": \"fa74ehgyjhtrrjtbrsu56hHjhhrtger\",\n         \"Endpoint\": {\n             \"AuthURL\": \"https://accounts.google.com/o/oauth2/auth\",\n             \"TokenURL\": \"https://accounts.google.com/o/oauth2/token\"\n         },\n         \"RedirectURL\": \"oob\",\n         \"Scopes\": [\n             \"https://adwords.google.com/api/adwords\"\n         ]\n     },\n     \"oauth2.Token\": {\n         \"access_token\": \"jfdsalkfjdskalfjdaksfdasfdsahrtsrgf\",\n         \"token_type\": \"Bearer\",\n         \"refresh_token\": \"g65wurefej87ruy4fcyfdsafdsafdsafsdaf4fu\",\n         \"expiry\": \"2015-03-05T00:13:23.382907238+09:00\"\n     },\n     \"gads.Auth\": {\n         \"CustomerId\": \"INSERT_YOUR_CLIENT_CUSTOMER_ID_HERE\",\n         \"DeveloperToken\": \"INSERT_YOUR_DEVELOPER_TOKEN_HERE\",\n         \"UserAgent\": \"tests (Golang 1.4 github.com/emiddleton/gads)\"\n     }\n }\n</code></pre>\n\n<p>It's a JSON object. I see the package is using the following function to bring in the information:</p>\n\n<pre><code>func NewCredentialsFromFile(pathToFile string, ctx context.Context) (ac AuthConfig, err error) {\n    data, err := ioutil.ReadFile(pathToFile)\n    if err != nil {\n        return ac, err\n    }\n    if err := json.Unmarshal(data, &amp;ac); err != nil {\n        return ac, err\n    }\n    ac.file = pathToFile\n    ac.tokenSource = ac.OAuth2Config.TokenSource(ctx, ac.OAuth2Token)\n    ac.Auth.Client = ac.OAuth2Config.Client(ctx, ac.OAuth2Token)\n    return ac, err\n</code></pre>\n\n<p>Where pathToFile is is already defined. The path would be to the json file that would be placed in the user's home directory. </p>\n\n<p>What would be the best way to add another function that does not rely on using a file for the credentials?</p>\n"}, {"tags": ["go", "blockchain", "hyperledger", "hyperledger-fabric", "smartcontracts"], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 3824841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hUElY.jpg?s=128&g=1", "display_name": "Ashishkel", "link": "https://stackoverflow.com/users/3824841/ashishkel"}, "edited": false, "score": 0, "creation_date": 1489386212, "post_id": 42545437, "comment_id": 72630885, "body": "TristeShine is not asking for changing the data in the ledger. User just wants to see the updated age values when he/she queries for data. As long as the age column is not a key attribute, they can use the replaceRow API Fabric has provided. This API do not overwrite the existing data, rather creates link to the new value of age. So when TristeShine uses selection API from Fabric smart contract, fabric would show the data (rows) with updated values of age. So while you are write fundamentally that you can not change anything, but it&#39;s possible to create the perception of update operation."}], "tags": [], "owner": {"reputation": 11, "user_id": 7428034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/122f704207843f922c02d5e04c0c7387?s=128&d=identicon&r=PG&f=1", "display_name": "Willson", "link": "https://stackoverflow.com/users/7428034/willson"}, "is_accepted": false, "score": 0, "last_activity_date": 1488419539, "creation_date": 1488419539, "answer_id": 42545437, "question_id": 42536508, "link": "https://stackoverflow.com/questions/42536508/how-to-use-stub-createtable-in-hyperledger-programming/42545437#42545437", "title": "How to use stub.CreateTable in Hyperledger programming", "body": "<p>You can not change anything on the ledger.The only way you can update the person infomation is insert a new line to cover the old.</p>\n"}, {"tags": [], "owner": {"reputation": 473, "user_id": 7573591, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-f5mCOcQBLPU/AAAAAAAAAAI/AAAAAAAAAdU/X3FLg4Rpk78/photo.jpg?sz=128", "display_name": "ecn", "link": "https://stackoverflow.com/users/7573591/ecn"}, "is_accepted": false, "score": 0, "last_activity_date": 1488443718, "creation_date": 1488443718, "answer_id": 42550409, "question_id": 42536508, "link": "https://stackoverflow.com/questions/42536508/how-to-use-stub-createtable-in-hyperledger-programming/42550409#42550409", "title": "How to use stub.CreateTable in Hyperledger programming", "body": "<p>Here is a chaincode where a table is used. You can see how to create a table, insert, delete rows : \n<a href=\"https://github.com/hyperledger/fabric/blob/master/examples/chaincode/go/asset_management_interactive/asset_management.go#L51-L54\" rel=\"nofollow noreferrer\">https://github.com/hyperledger/fabric/blob/master/examples/chaincode/go/asset_management_interactive/asset_management.go#L51-L54</a></p>\n\n<p>Hope this helps</p>\n"}, {"tags": [], "owner": {"reputation": 1805, "user_id": 5865712, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-Y5Rum91W6os/AAAAAAAAAAI/AAAAAAAAAGI/J3TK0_uwiHw/photo.jpg?sz=128", "display_name": "Chris Sharp", "link": "https://stackoverflow.com/users/5865712/chris-sharp"}, "is_accepted": false, "score": 0, "last_activity_date": 1488467802, "creation_date": 1488467802, "answer_id": 42559166, "question_id": 42536508, "link": "https://stackoverflow.com/questions/42536508/how-to-use-stub-createtable-in-hyperledger-programming/42559166#42559166", "title": "How to use stub.CreateTable in Hyperledger programming", "body": "<p>Please look at the cases in the switch statement in the <code>invoke</code> method of this code. I believe the <code>case \"replaceRowTableOne\":</code> case has some insight as to what you're trying to do.</p>\n\n<p><a href=\"https://github.com/christo4ferris/fabric-docs/blob/master/bddtests/chaincode/go/table/table.go\" rel=\"nofollow noreferrer\">https://github.com/christo4ferris/fabric-docs/blob/master/bddtests/chaincode/go/table/table.go</a></p>\n"}], "owner": {"reputation": 59, "user_id": 6907091, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh5.googleusercontent.com/-zPrkSR7X3TI/AAAAAAAAAAI/AAAAAAAAANk/-nGd0-MtIAo/photo.jpg?sz=128", "display_name": "TristeShine", "link": "https://stackoverflow.com/users/6907091/tristeshine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 342, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1489662108, "creation_date": 1488384268, "last_edit_date": 1489662108, "question_id": 42536508, "link": "https://stackoverflow.com/questions/42536508/how-to-use-stub-createtable-in-hyperledger-programming", "title": "How to use stub.CreateTable in Hyperledger programming", "body": "<p>A chaincode based on Hyperledger uses stub.PutState and stub.GetState to interact with the data base. However, if I have a struct with more than one attibutes, for example :</p>\n\n<p><code>person {\n   \"ID\": \"123\",\n   \"firstname\":\"joe\",\n   \"lastname\":\"doe\",\n   \"age\":\"34\",\n}</code></p>\n\n<p>Then if I want to update the age, what arguments should I send to the method ?</p>\n\n<p>I noticed that there is stub.CreateTable method which seems to be more convenient for my case, however, I couldn't find any document or explication about how to use this method. Would you please give me a link to the document or some brief explication please ?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488383935, "post_id": 42536265, "comment_id": 72208413, "body": "It works for me with Go 1.8, so I&#39;m afraid I can&#39;t help much. But you might consider upgrading. Go 1.6 is a year old now."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488384027, "post_id": 42536265, "comment_id": 72208481, "body": "Why are you using gccgo?"}, {"owner": {"reputation": 35, "user_id": 7642300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f8ad89a487d997a7a8ca509497b4bce?s=128&d=identicon&r=PG&f=1", "display_name": "St&#252;mperhacker", "link": "https://stackoverflow.com/users/7642300/st%c3%bcmperhacker"}, "edited": false, "score": 1, "creation_date": 1488384546, "post_id": 42536265, "comment_id": 72208840, "body": "You Guys are awesome, my Arch Linus Installation came with gccgo and not the real one. <code>yaourt -S go</code>  resolved the conflict and now everything works. Thank you a lot"}], "owner": {"reputation": 35, "user_id": 7642300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f8ad89a487d997a7a8ca509497b4bce?s=128&d=identicon&r=PG&f=1", "display_name": "St&#252;mperhacker", "link": "https://stackoverflow.com/users/7642300/st%c3%bcmperhacker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488383586, "creation_date": 1488383586, "question_id": 42536265, "link": "https://stackoverflow.com/questions/42536265/go-get-does-not-find-import-file-in-dependencies", "title": "go get does not find import file in dependencies", "body": "<p>I am trying to use go get to download the \"dlv\" package but am running into the following error:</p>\n\n<pre><code>go get github.com/derekparker/delve/cmd/dlv       \n# github.com/derekparker/delve/pkg/config\nsrc/github.com/derekparker/delve/pkg/config/config.go:10:2: error: import file \u2018gopkg.in/yaml.v2\u2019 not found\n  yaml \"gopkg.in/yaml.v2\"\n  ^\nsrc/github.com/derekparker/delve/pkg/config/config.go:69:8: error: reference to undefined name \u2018yaml\u2019\n  err = yaml.Unmarshal(data, &amp;c)\n</code></pre>\n\n<p>A similar thing happens when I try to install \"go-plus\" for atom.\nAfter exhausting research I am not sure what the problem is, my go env is:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/martin/go\"\nGORACE=\"\"\nGOROOT=\"/usr\"\nGOTOOLDIR=\"/usr/lib/gcc/x86_64-pc-linux-gnu/6.3.1\"\nGO15VENDOREXPERIMENT=\"1\"\nCC=\"/usr/bin/gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"/usr/bin/g++\"\nCGO_ENABLED=\"1\"\n\ngo version: go version go1.6.1 gccgo (GCC) 6.3.1 20170109 linux/amd64\n</code></pre>\n\n<p>I am able to install other packages with go get just fine, only when external dependencies are involved the import files cannot be found.</p>\n\n<p>Any tips are greatly appreciated</p>\n"}, {"tags": ["dictionary", "go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488379098, "post_id": 42533950, "comment_id": 72204638, "body": "Can you make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates the behavior. Runing your code as shown works: <a href=\"https://play.golang.org/p/bomHKW6p_z\" rel=\"nofollow noreferrer\">play.golang.org/p/bomHKW6p_z</a>"}, {"owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "edited": false, "score": 0, "creation_date": 1488381148, "post_id": 42533950, "comment_id": 72206206, "body": "can you run the test with the -v flag? I have tried running it as is together with the -v flag but everything is passing"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1488420998, "post_id": 42533950, "comment_id": 72226856, "body": "What version of go?"}, {"owner": {"reputation": 81, "user_id": 5559226, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2db6ec22bed47d6ba22da0fd9df3c75d?s=128&d=identicon&r=PG&f=1", "display_name": "David Kane", "link": "https://stackoverflow.com/users/5559226/david-kane"}, "edited": false, "score": 0, "creation_date": 1488431722, "post_id": 42533950, "comment_id": 72230224, "body": "Version 1.7.3 on mac."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1488583790, "post_id": 42533950, "comment_id": 72312499, "body": "this just works: <a href=\"https://play.golang.org/p/wvb8JK2RKO\" rel=\"nofollow noreferrer\">play.golang.org/p/wvb8JK2RKO</a>"}], "owner": {"reputation": 81, "user_id": 5559226, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2db6ec22bed47d6ba22da0fd9df3c75d?s=128&d=identicon&r=PG&f=1", "display_name": "David Kane", "link": "https://stackoverflow.com/users/5559226/david-kane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488399970, "creation_date": 1488377411, "last_edit_date": 1488399970, "question_id": 42533950, "link": "https://stackoverflow.com/questions/42533950/reflect-deepequal-mapstringstring-giving-false-when-should-be-true", "title": "reflect.DeepEqual map[string][]string Giving False When Should be True", "body": "<p>I am testing a function that creates an anagram dictionary from a slice of words (strings). I am comparing map[string][]string. When I test the function, using reflect.DeepEqual() I get false, when under further inspection, I find the maps to be identical.</p>\n\n<p>Code:</p>\n\n<pre><code>//Given a slice of words, returns an anagram Dict - A Map of alphabetic hashes, to words of that hash\nfunc AnagramDictFromWordSlice(wordlist []string) map[string][]string {\n    var ad = make(map[string][]string)\n    for _, word := range wordlist {\n        hash := HashWord(word)\n        if val, ok := ad[hash]; ok {\n            ad[hash] = append(val, word)\n        } else {\n            ad[hash] = []string{word}\n        }\n    }\n    return ad\n}\n\n//Given a word, returns that alphabetic hash of that word. e.g. \"word\" -&gt; \"dorw\"\nfunc HashWord(input string) string {\n    s := strings.Replace(input, \"'\", \"\", -1)\n    s = strings.Replace(s, \"-\", \"\", -1)\n    s = strings.ToLower(s)\n    ss := strings.Split(s, \"\")\n    sort.Strings(ss)\n    return strings.Join(ss, \"\")\n}\n\nfunc TestAnagramDictFromWordSlice(t *testing.T) {\n    words := []string{\"abaci\", \"aback\", \"abacus\", \"abacuses\", \"abaft\", \"abalone\", \"fabat\", \"cusaba\"}\n    expected := make(map[string][]string)\n    expected[\"aabci\"] = []string{\"abaci\"}\n    expected[\"aabck\"] = []string{\"aback\"}\n    expected[\"aabcsu\"] = []string{\"abacus\", \"cusaba\"}\n    expected[\"aabcessu\"] = []string{\"abacuses\"}\n    expected[\"aabft\"] = []string{\"abaft\", \"fabat\"}\n    expected[\"aabelno\"] = []string{\"abalone\"}\n    actual := AnagramDictFromWordSlice(words)\n    if !reflect.DeepEqual(expected, actual) {\n        t.Errorf(\"\\nExpected %v, \\ngot %v\", expected, actual)\n    }\n}\n</code></pre>\n\n<p>Again, after running the test, I get a false for the deep equals, even though the two maps, once printed out are identical. Is there something I've missed?</p>\n\n<p>***EDIT:</p>\n\n<p>I've updated the failing test to spit out more info. Code here.</p>\n\n<pre><code>func TestAnagramDictFromWordSlice(t *testing.T) {\nwords := []string{\"abaci\", \"aback\", \"abacus\", \"abacuses\", \"abaft\", \"abalone\", \"fabat\", \"cusaba\"}\nexpected := make(map[string][]string)\nexpected[\"aabci\"] = []string{\"abaci\"}\nexpected[\"aabck\"] = []string{\"aback\"}\nexpected[\"aabcsu\"] = []string{\"abacus\", \"cusaba\"}\nexpected[\"aabcessu\"] = []string{\"abacuses\"}\nexpected[\"aabft\"] = []string{\"abaft\", \"fabat\"}\nexpected[\"aabelno\"] = []string{\"abalone\"}\nactual := AnagramDictFromWordSlice(words))\nif !reflect.DeepEqual(expected, actual) {\n    t.Errorf(\"\\nExpected %v, \\ngot %v\", expected, actual)\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabci\"], actual[\"aabci\"], reflect.DeepEqual(expected[\"aabci\"], actual[\"aabci\"]))\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabck\"], actual[\"aabck\"], reflect.DeepEqual(expected[\"aabck\"], actual[\"aabck\"]))\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabcsu\"], actual[\"aabcsu\"], reflect.DeepEqual(expected[\"aabcsu\"], actual[\"aabcsu\"]))\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabcessu\"], actual[\"aabcessu\"], reflect.DeepEqual(expected[\"aabcessu\"], actual[\"aabcessu\"]))\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabft\"], actual[\"aabft\"], reflect.DeepEqual(expected[\"aabft\"], actual[\"aabft\"]))\n    t.Errorf(\"Expected: %v, Got: %v, %t\", expected[\"aabelno\"], actual[\"aabelno\"], reflect.DeepEqual(expected[\"aabelno\"], actual[\"aabelno\"]))\n    t.Errorf(\"Length of expected: %v, length of actual: %v\", len(expected), len(actual))\n}\n</code></pre>\n\n<p>}</p>\n\n<p>And here is the error message. </p>\n\n<pre><code>--- FAIL: TestAnagramDictFromWordSlice (0.00s)\nmain_test.go:26: \n    Expected map[aabci:[abaci] aabck:[aback] aabcsu:[abacus cusaba] aabcessu:[abacuses] aabft:[abaft fabat] aabelno:[abalone]], \n    got map[aabci:[abaci] aabck:[aback] aabcsu:[abacus cusaba] aabcessu:[abacuses] aabft:[abaft fabat] aabelno:[abalone]]\nmain_test.go:27: Expected: [abaci], Got: [abaci], true\nmain_test.go:28: Expected: [aback], Got: [aback], true\nmain_test.go:29: Expected: [abacus cusaba], Got: [abacus cusaba], true\nmain_test.go:30: Expected: [abacuses], Got: [abacuses], true\nmain_test.go:31: Expected: [abaft fabat], Got: [abaft fabat], true\nmain_test.go:32: Expected: [abalone], Got: [abalone], true\nmain_test.go:33: Length of expected: 6, length of actual: 6\n</code></pre>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 6034, "user_id": 4460500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7TTnO.jpg?s=128&g=1", "display_name": "VolAnd", "link": "https://stackoverflow.com/users/4460500/voland"}, "edited": false, "score": 1, "creation_date": 1488368053, "post_id": 42530538, "comment_id": 72196945, "body": "are you sure  that memory allocated in main program can be reallocated in C function? It can be differences in memory management"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1488382566, "post_id": 42530538, "comment_id": 72207354, "body": "Instead of resorting to three star programming, have the function return a <code>char**</code>. The return code of the function does nothing meaningful currently."}, {"owner": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "reply_to_user": {"reputation": 6034, "user_id": 4460500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7TTnO.jpg?s=128&g=1", "display_name": "VolAnd", "link": "https://stackoverflow.com/users/4460500/voland"}, "edited": false, "score": 0, "creation_date": 1488388612, "post_id": 42530538, "comment_id": 72211685, "body": "@VolAnd The current working part (with <code>char**</code>) is correct. However, I&#39;m not sure what to do for my target (<code>char***</code>)."}, {"owner": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1488388799, "post_id": 42530538, "comment_id": 72211785, "body": "@Lundin This is only a sample... not what my actually code does"}], "answers": [{"comments": [{"owner": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "edited": false, "score": 0, "creation_date": 1488389692, "post_id": 42533858, "comment_id": 72212312, "body": "I&#39;m still experimenting how to correctly get go string from <code>a</code> - simply using <code>C.GoString(a[0])</code> doesn&#39;t produce the correct result. But...what does the magic number 30 do?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "edited": false, "score": 0, "creation_date": 1488390012, "post_id": 42533858, "comment_id": 72212538, "body": "@renyuneyun: the &quot;magic number&quot; isn&#39;t 30, it&#39;s <code>1&lt;&lt;30-1</code>, or 1073741823. It&#39;s just a large array size, since array types are static."}, {"owner": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "edited": false, "score": 0, "creation_date": 1488390513, "post_id": 42533858, "comment_id": 72212836, "body": "Thanks a lot :)  (Yeah, I&#39;m aware that&#39;s bitwise operation.) I just happen to see that value all around and am wondering why it&#39;s 2^30 rather than other values. Regarding getting go strings, assigning <code>a</code> another time to get the new pointer value of <code>cArray</code> would produce successful results."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "edited": false, "score": 0, "creation_date": 1488390946, "post_id": 42533858, "comment_id": 72213088, "body": "@renyuneyun: Ah ok, in that case the 30 is because <code>2^30 - 1</code> is the largest array size that can be used on all architectures."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1488379680, "last_edit_date": 1488379680, "creation_date": 1488377158, "answer_id": 42533858, "question_id": 42530538, "link": "https://stackoverflow.com/questions/42530538/how-to-pass-pointer-to-slice-to-c-function-in-go/42533858#42533858", "title": "How to pass pointer to slice to C function in go", "body": "<p>A Go slice is both allocated in Go, and a different data structure than a C array, so you can't pass it to a C function (cgo will also prevent you from doing this because a slice contains a Go pointer)</p>\n\n<p>You need to allocate the array in C in order to manipulate the array in C. Just like with C.CString, you will also need to track where to free the outer array, especially if the C function may possibly allocate a new array. </p>\n\n<pre><code>cArray := C.malloc(C.size_t(c_count) * C.size_t(unsafe.Sizeof(uintptr(0))))\n\n// convert the C array to a Go Array so we can index it\na := (*[1&lt;&lt;30 - 1]*C.char)(cArray)\nfor index, value := range strs {\n    a[index] = C.CString(value)\n}\n\nerr := C.f(&amp;c_count, (***C.char)(unsafe.Pointer(&amp;cArray)))\n</code></pre>\n"}], "owner": {"reputation": 498, "user_id": 2854555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2056d56888b443ab438fb956e898cc9d?s=128&d=identicon&r=PG", "display_name": "renyuneyun", "link": "https://stackoverflow.com/users/2854555/renyuneyun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3405, "favorite_count": 2, "accepted_answer_id": 42533858, "answer_count": 1, "score": 5, "last_activity_date": 1498649923, "creation_date": 1488367777, "last_edit_date": 1498649923, "question_id": 42530538, "link": "https://stackoverflow.com/questions/42530538/how-to-pass-pointer-to-slice-to-c-function-in-go", "title": "How to pass pointer to slice to C function in go", "body": "<p>Background: using cgo to call C functions from Golang.</p>\n\n<p>I want to use a C function which has this signature: <code>int f(int *count, char ***strs)</code>.\nIt will modify the data of <code>count</code> and <code>strs</code>, which is the reason why it uses pointer to them.\nThe value of <code>count</code> is the length of <code>strs</code>; <code>strs</code> is an array of string; the return value is simply an (boolean) indicator which states whether there is an error or not.</p>\n\n<p>In golang, I can successfully pass and modify <code>count</code> by using <code>C.f((*C.int)(&amp;count))</code>; pass <code>[]string</code> by using <code>[]*C.char</code>. Sample code is like this:</p>\n\n<pre><code>/*\n#include &lt;stdio.h&gt;\nint f(int *c, char **str) {\n    int i;\n    printf(\"%d\\n\", *c);\n    for (i = 0; i &lt; *c; i++) {\n        printf(\"%s\\n\", str[i]);\n    }\n    *c = (*c) + 1;\n    return 1;\n}\n*/\nimport \"C\"\nfunc go_f(strs []string) int {\n    count := len(strs)\n    c_count := C.int(count)\n\n    c_strs := make([]*C.char, count)\n    for index, value := range strs {\n        c_strs[index] = C.CString(value)\n        defer C.free(unsafe.Pointer(c_strs[index]))\n    }\n\n    err := C.f(&amp;c_argc, (**C.char)(&amp;c_argv[0]))\n    return int(err)\n}\n</code></pre>\n\n<p>As you can see, the C function is currently <code>int f(int *c, char **str)</code>, but what I'd like is <code>int f(int *c, char ***str)</code>.</p>\n\n<p>This is to say: what I actually want is to enable the modification to the string array (e.g. resize) in C and turn it back to a Go string slice so I can still use it in Go.</p>\n\n<p>How to do this? I've searched and experimented for a while but with no luck.</p>\n"}, {"tags": ["arrays", "go", "return", "return-value", "slice"], "answers": [{"comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488368428, "post_id": 42530418, "comment_id": 72197200, "body": "That is a nicely detailed answer. What confused me is my assumption that the array would be allocated on the stack and released on return like in C and C++. If it&#39;s allocated on the heap I gain nothing by using this code pattern. Is there another solution than using a recursive function to use the stack and to allocate once and only once the exactly required size ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488368909, "post_id": 42530418, "comment_id": 72197515, "body": "@chmike See edited answer. You may choose to pass a pointer to an array as an argument."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370060, "post_id": 42530418, "comment_id": 72198274, "body": "Thanks for the suggestion. But it doesn&#39;t fit my goal. The function foo is generating some data to be returned in a slice which I know will never exceed 100 for instance.  The problem is that I don&#39;t know in advance the amount of data produced and in general it will be much less than 100. Around 10 or so. I assumed the array was allocated on the stack. This assumption is wrong. Small arrays are. Not such big arrays."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370232, "post_id": 42530418, "comment_id": 72198377, "body": "@chmike You may return a slice of the array you passed that designates the _useful part (that you filled), that&#39;s not a problem. Edited to make it clear. Also this is considered a small array and it will be allocated on stack. For details see <a href=\"http://stackoverflow.com/questions/42243197/what-is-considered-small-object-in-go-regarding-stack-allocation/42244087#42244087\">What is considered \u201csmall\u201d object in Go regarding stack allocation?</a>"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370538, "post_id": 42530418, "comment_id": 72198593, "body": "I tested in the playground as you suggested me and the array was apparently not allocated on the stack. It was with the array <code>[11]byte</code> which I used in another place of my code. I suspect that go has a strategy to keep stacks small because of goroutines. This would make sense."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370679, "post_id": 42530418, "comment_id": 72198679, "body": "@chmike If you read the linked answer, it shows the limit is around 64 KB after which variables are allocated on heap (even without escaping). <code>[100]uint64</code> is nowehere near that limit. If you return a slice pointing to it, that counts as &quot;escaping&quot;."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370900, "post_id": 42530418, "comment_id": 72198834, "body": "Check the code I wrote. Even an 11 uint64 array is apparently allocated on the stack. Replace uint64 with byte and you will see it&#39;s allocated on the stack (apparently)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488371407, "post_id": 42530418, "comment_id": 72199176, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/136957/discussion-between-icza-and-chmike\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1480, "user_id": 5992714, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UVj07.jpg?s=128&g=1", "display_name": "human", "link": "https://stackoverflow.com/users/5992714/human"}, "edited": false, "score": 0, "creation_date": 1578376603, "post_id": 42530418, "comment_id": 105408600, "body": "@icza what does &quot;leaking param: tmp to result ~r1 level=0&quot; actually mean?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1480, "user_id": 5992714, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UVj07.jpg?s=128&g=1", "display_name": "human", "link": "https://stackoverflow.com/users/5992714/human"}, "edited": false, "score": 1, "creation_date": 1578381145, "post_id": 42530418, "comment_id": 105410051, "body": "@bigdatamann That&#39;s the analysis result of the <code>foo()</code> function: it says that the analyzer detected that the (input) parameter <code>tmp</code> is referenced by the return value, so this should be taken into consideration when analysing calls of <code>foo()</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1488373069, "last_edit_date": 1495535390, "creation_date": 1488367439, "answer_id": 42530418, "question_id": 42530219, "link": "https://stackoverflow.com/questions/42530219/is-returning-a-slice-of-a-local-array-in-a-go-function-safe/42530418#42530418", "title": "Is returning a slice of a local array in a Go function safe?", "body": "<p>This is detailed in <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Spec: Slice expressions</a>.</p>\n\n<p>The array will not be copied, but instead the result of the slice expression will be a slice that refers to the array. In Go it is perfectly safe to return local variables or their addresses from functions or methods, the Go compiler performs an <a href=\"https://en.wikipedia.org/wiki/Escape_analysis\" rel=\"nofollow noreferrer\">escape analysis</a> to determine if a value may escape the function, and if so (or rather if it can't prove that a value may not escape), it allocates it on the heap so it will be available after the function returns.</p>\n\n<p>The slice expression: <code>tmp[:end]</code> means <code>tmp[0:end]</code> (because a missing <code>low</code> index defaults to zero). Since you didn't specify the capacity, it will default to <code>len(tmp) - 0</code> which is <code>len(tmp)</code> which is <code>100</code>.</p>\n\n<p>You can also control the result slice's capacity by using a <em>full slice expression</em>, which has the form:</p>\n\n<pre><code>a[low : high : max]\n</code></pre>\n\n<p>Which sets the resulting slice's capacity to <code>max - low</code>.</p>\n\n<p>More examples to clarify the resulting slice's length and capacity:</p>\n\n<pre><code>var a [100]int\n\ns := a[:]\nfmt.Println(len(s), cap(s)) // 100 100\ns = a[:50]\nfmt.Println(len(s), cap(s)) // 50 100\ns = a[10:50]\nfmt.Println(len(s), cap(s)) // 40 90\ns = a[10:]\nfmt.Println(len(s), cap(s)) // 90 90\n\ns = a[0:50:70]\nfmt.Println(len(s), cap(s)) // 50 70\ns = a[10:50:70]\nfmt.Println(len(s), cap(s)) // 40 60\ns = a[:50:70]\nfmt.Println(len(s), cap(s)) // 50 70\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/ECJck-Px0p\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Avoiding heap allocation</h3>\n\n<p>If you want to allocate it on the stack, you can't return any value that points to it (or parts of it). If it would be allocated on the stack, there would be no guarantee that after returning it remains available.</p>\n\n<p>A possible solution to this would be to pass a pointer to an array as an argument to the function (and you may return a slice designating the <em>useful</em> part that the function filled), e.g.:</p>\n\n<pre><code>func foo(tmp *[100]uint64) []uint64 {\n    // ...\n    return tmp[:end]\n}\n</code></pre>\n\n<p>If the caller function creates the array (on the stack), this will not cause a \"reallocation\" or \"moving\" to the heap:</p>\n\n<pre><code>func main() {\n    var tmp [100]uint64\n    foo(&amp;tmp)\n}\n</code></pre>\n\n<p>Running <code>go run -gcflags '-m -l' play.go</code>, the result is:</p>\n\n<pre><code>./play.go:8: leaking param: tmp to result ~r1 level=0\n./play.go:5: main &amp;tmp does not escape\n</code></pre>\n\n<p>The variable <code>tmp</code> is not moved to heap.</p>\n\n<p>Note that <code>[100]uint64</code> is considered a small array to be allocated on the stack. For details see <a href=\"https://stackoverflow.com/questions/42243197/what-is-considered-small-object-in-go-regarding-stack-allocation/42244087#42244087\">What is considered &quot;small&quot; object in Go regarding stack allocation?</a></p>\n"}, {"comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1488370332, "post_id": 42530425, "comment_id": 72198455, "body": "I assumed the array was allocated on the stack. This is the case only for small arrays. The big array above is allocate on the heap, so indeed, a slice would carry it along and much memory space would be wasted unless I copy the relevant data in a slice allocated my self. But that function would allocate two objects, which is would like to avoid. So using that array is a bad choice in the first place."}], "tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 1, "last_activity_date": 1488367456, "creation_date": 1488367456, "answer_id": 42530425, "question_id": 42530219, "link": "https://stackoverflow.com/questions/42530219/is-returning-a-slice-of-a-local-array-in-a-go-function-safe/42530425#42530425", "title": "Is returning a slice of a local array in a Go function safe?", "body": "<p>The data is not copied. The array will be used as the underlying array of the slice.</p>\n\n<p>It looks like you're worrying about the life time of the array, but the compiler and garbage collector will figure that out for you. It's as safe as returning pointers to \"local variables\".</p>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1488367650, "creation_date": 1488367650, "answer_id": 42530499, "question_id": 42530219, "link": "https://stackoverflow.com/questions/42530219/is-returning-a-slice-of-a-local-array-in-a-go-function-safe/42530499#42530499", "title": "Is returning a slice of a local array in a Go function safe?", "body": "<p>Nothing wrong happens.</p>\n\n<p>Go does not make a copy but compiler performs <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">escape analysis</a> and allocates the variable that will be visible outside function on heap.</p>\n\n<p>The capacity will be the capacity of underlying array.</p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2951, "favorite_count": 2, "accepted_answer_id": 42530418, "answer_count": 3, "score": 5, "last_activity_date": 1488373069, "creation_date": 1488366805, "last_edit_date": 1488370041, "question_id": 42530219, "link": "https://stackoverflow.com/questions/42530219/is-returning-a-slice-of-a-local-array-in-a-go-function-safe", "title": "Is returning a slice of a local array in a Go function safe?", "body": "<p>What happens if I return a slice of an array that is a local variable of a function or method? Does Go copy the array data into a slice create with <code>make()</code>? Will the capacity match the slice size or the array size?</p>\n\n<pre><code>func foo() []uint64 {\n    var tmp [100]uint64\n    end := 0\n    ...\n    for ... {\n        ...\n        tmp[end] = uint64(...)\n        end++\n        ...\n    }\n    ... \n    return tmp[:end]\n} \n</code></pre>\n"}, {"tags": ["go", "constants"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1488366447, "last_edit_date": 1495540435, "creation_date": 1488366137, "answer_id": 42529986, "question_id": 42529691, "link": "https://stackoverflow.com/questions/42529691/why-cant-we-declare-a-map-and-fill-it-after-in-the-const/42529986#42529986", "title": "Why can&#39;t we declare a map and fill it after in the const?", "body": "<p><a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">Constants</a> are called <em>constants</em> for a reason: you expect them to be just that: <em>constant</em>.</p>\n\n<p>The <em>type</em> defines what operations you may perform on a value of that type. The <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">map</a> type in Go is not constant, you can change its key-value pairs after its creation, so you cannot have <code>map</code> constants.</p>\n\n<p>Your \"palette\" to choose constants from is defined in the Spec: Constants:</p>\n\n<blockquote>\n  <p>There are <em>boolean constants</em>, <em>rune constants</em>, <em>integer constants</em>, <em>floating-point constants</em>, <em>complex constants</em>, and <em>string constants</em>.</p>\n</blockquote>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/13137463/declare-a-constant-array/29365828#29365828\">Declare a constant array</a></p>\n\n<p>Workaround is simple: declare it to be a variable instead of a constant.</p>\n"}], "owner": {"reputation": 230, "user_id": 4912384, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/227f1ec3e97095379d734632cce62d92?s=128&d=identicon&r=PG&f=1", "display_name": "MrBouh", "link": "https://stackoverflow.com/users/4912384/mrbouh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 42529986, "answer_count": 1, "score": -1, "last_activity_date": 1488375513, "creation_date": 1488365362, "last_edit_date": 1488375513, "question_id": 42529691, "link": "https://stackoverflow.com/questions/42529691/why-cant-we-declare-a-map-and-fill-it-after-in-the-const", "title": "Why can&#39;t we declare a map and fill it after in the const?", "body": "<p>Just why... why does this generate an error?\nIs it because it reallocates the map to allow the extension or just because the compiler parser is not meant to handle these cases?</p>\n\n<pre><code>const (\n        paths = &amp;map[string]*map[string]string {\n            Smith: {\n                \"theFather\": \"John\",\n            },\n        }\n        paths[\"Smith\"][\"theSon\"] = paths[\"Smith\"][\"theFather\"] + \" Junior\"\n)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1488357998, "post_id": 42526950, "comment_id": 72189865, "body": "You can&#39;t enforce such a thing. You may take advantage of <a href=\"https://golang.org/pkg/runtime/#SetFinalizer\" rel=\"nofollow noreferrer\"><code>runtime.SetFinalizer()</code></a>, but it doesn&#39;t give you guarantees. See related question: <a href=\"http://stackoverflow.com/questions/36826232/how-to-make-sure-that-a-method-is-used-after-an-object-is-created-in-golang/36826362#36826362\">How to make sure that a method is used after an object is created in golang?</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488361785, "post_id": 42526950, "comment_id": 72192497, "body": "You should also avoid <code>SetFinalizer()</code>, especially in Go 1.8, because it can, in some situations, end up being called early."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 6, "creation_date": 1488362644, "post_id": 42526950, "comment_id": 72193130, "body": "Document your package properly. Things like cleaning up are the responsibility of the user. The more a package <i>tries</i> to take care of things behind the scenes, the more likely it is to cause problems for the users in the long run."}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 0, "last_activity_date": 1488365484, "creation_date": 1488365484, "answer_id": 42529742, "question_id": 42526950, "link": "https://stackoverflow.com/questions/42526950/enforce-calling-close-when-finished-working-with-the-package/42529742#42529742", "title": "Enforce calling Close() when finished working with the package", "body": "<p>As for just about any resource (and a connection is no different), a user should call the functions to return resources to the system after use. Most users understand this across languages and architectures, so I don't see why your package users should have any concern. Go addresses this problem very elegantly by including the defer statement which makes it very easy to provide for releasing a resource.</p>\n"}], "owner": {"reputation": 4212, "user_id": 1660762, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/x6IJ8.jpg?s=128&g=1", "display_name": "Dotan", "link": "https://stackoverflow.com/users/1660762/dotan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 42529742, "answer_count": 1, "score": 1, "last_activity_date": 1488365484, "creation_date": 1488357681, "last_edit_date": 1488361812, "question_id": 42526950, "link": "https://stackoverflow.com/questions/42526950/enforce-calling-close-when-finished-working-with-the-package", "title": "Enforce calling Close() when finished working with the package", "body": "<p>I'm writing a package in go that creates a connection to Kafka.</p>\n\n<p>I create the connection in the <code>init()</code> function in the main file in the package. After the program that uses the package stops, I want to call a function called <code>Close()</code></p>\n\n<p>Is there a way to enforce it in the package level, instead of giving this responsibility to the user?</p>\n\n<p>Assume that the connection should be available throughout the run of the user's program, I don't want to initialize it every time.</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 41, "user_id": 6737423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370f8a518b57772d44f7c4b065829fd8?s=128&d=identicon&r=PG&f=1", "display_name": "leesper", "link": "https://stackoverflow.com/users/6737423/leesper"}, "edited": false, "score": 0, "creation_date": 1488356590, "post_id": 42526041, "comment_id": 72188962, "body": "When I run go test -v it displays the same thing."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1488362002, "post_id": 42526041, "comment_id": 72192672, "body": "If it says literally exactly the same thing when you run &#39;test -v&#39;, then there&#39;s something wrong with your code that isn&#39;t apparent in the code you pasted--such as you have an <code>init()</code> function somewhere that&#39;s calling <code>os.Exit(1)</code>."}, {"owner": {"reputation": 41, "user_id": 6737423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370f8a518b57772d44f7c4b065829fd8?s=128&d=identicon&r=PG&f=1", "display_name": "leesper", "link": "https://stackoverflow.com/users/6737423/leesper"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1488362265, "post_id": 42526041, "comment_id": 72192851, "body": "yeah, you are definitely right!!! I use a Fatal() call in my init() function...I spent the whole afternoon on this shit... I just wanna find some place to cry. : ("}, {"owner": {"reputation": 487, "user_id": 1866988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41d0826312945dee38a168f8daa38a14?s=128&d=identicon&r=PG", "display_name": "Fedir Petryk", "link": "https://stackoverflow.com/users/1866988/fedir-petryk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1537183705, "post_id": 42526041, "comment_id": 91677509, "body": "Thanks @Flimzy, your comment saved my day )"}], "owner": {"reputation": 41, "user_id": 6737423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370f8a518b57772d44f7c4b065829fd8?s=128&d=identicon&r=PG&f=1", "display_name": "leesper", "link": "https://stackoverflow.com/users/6737423/leesper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3569, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1488354686, "creation_date": 1488354686, "question_id": 42526041, "link": "https://stackoverflow.com/questions/42526041/golang-test-exit-status-1-and-shows-nothing", "title": "golang test exit status -1 and shows nothing", "body": "<p>Recently I've been working on a Restful app in golang, strange things happened when I try to write tests in different subdirectories. My project structure is:</p>\n\n<pre><code>\u251c\u2500\u2500 handlers/\n\u2502   \u251c\u2500\u2500 defs.go\n\u2502   \u251c\u2500\u2500 hello_test.go\n\u2502   \u251c\u2500\u2500 hello.go\n\u251c\u2500\u2500 server/\n\u2502   \u251c\u2500\u2500 codes.go\n\u2502   \u251c\u2500\u2500 middlewares_test.go\n\u2502   \u251c\u2500\u2500 middlewares.go\n\u251c\u2500\u2500 utility/\n\u2502   \u251c\u2500\u2500 auth.go\n\u2502   \u251c\u2500\u2500 auth_test.go\n</code></pre>\n\n<p>All files in handlers/ are declared \"package handlers\", all files in server/ are declared \"package server\", and so on. When I run go test in utility/ and handlers/ everything is fine. But if I run go test in server/, it returns me nothing but just:</p>\n\n<pre><code>[likejun@localhost server]$ go test\nexit status 1\nFAIL    server_golang/server    0.003s\n</code></pre>\n\n<p>It seems that it exits with a code 1 before even run, could someone tells me why this happened? Thank you, I've been spent the whole afternoon on it.</p>\n\n<p>the code in middleware_test.go</p>\n\n<pre><code>package server\n\nimport (\n    \"io\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc TestHello(t *testing.T) {\n    req, err := http.NewRequest(http.MethodGet, \"/\", nil)\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    rec := httptest.NewRecorder()\n\n    func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        io.WriteString(w, `{\"hello\": \"world\"}`)\n    }(rec, req)\n\n    if status := rec.Code; status != http.StatusOK {\n        t.Errorf(\"handler returned wrong status code: got %d want %d\", status, http.StatusOK)\n    }\n\n    if rec.Header().Get(\"Content-Type\") != \"application/json\" {\n        t.Errorf(\"handler returned wrong content type header: got %s want %s\", rec.Header().Get(\"Content-Type\"), \"application/json\")\n    }\n\n    expected := `{\"hello\": \"world\"}`\n    if rec.Body.String() != expected {\n        t.Errorf(\"handler returned unexpected body: got %s want %s\", rec.Body.String(), expected)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1488353141, "post_id": 42525499, "comment_id": 72187137, "body": "If you place  <code>defer req.Body.Close()</code> at the end, you wouldn&#39;t need the <code>defer</code> keyword, but you risk that you or any future programmer touching the code accidentally add code that returns from your function early , and then <code>req.Body.Close()</code> wouldn&#39;t run."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488354292, "post_id": 42525499, "comment_id": 72187733, "body": "It&#39;s not stressed / clear, but are you asking about <code>http.Handler</code>, being at server side, serving incoming requests? Or being the client, making outgoing HTTP requests to other servers?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488371559, "post_id": 42525499, "comment_id": 72199282, "body": "@JimB That&#39;s actually the answer, post it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488376146, "post_id": 42525499, "comment_id": 72202575, "body": "@icza: I figured I&#39;d find a dup, but no luck ;)"}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 2679859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a062ae8b00195f37d7d070d2fa29eb08?s=128&d=identicon&r=PG&f=1", "display_name": "user2679859", "link": "https://stackoverflow.com/users/2679859/user2679859"}, "edited": false, "score": 4, "creation_date": 1531494850, "post_id": 42525589, "comment_id": 89631797, "body": "This answer only applies to &quot;CLIENT&quot; side http request.  Server side (as asked in question) does not need to close."}], "tags": [], "owner": {"reputation": 529, "user_id": 1317806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/494fd6fab92e92a5a0bb35c5046d93b2?s=128&d=identicon&r=PG", "display_name": "SJP", "link": "https://stackoverflow.com/users/1317806/sjp"}, "is_accepted": false, "score": 1, "last_activity_date": 1488353010, "creation_date": 1488353010, "answer_id": 42525589, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close/42525589#42525589", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<p>According to the Go <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">documentation</a> it is up to you to close the body once you are done with it. </p>\n\n<p>I usually put the defer line right after the line where I check the request for errors.</p>\n"}, {"comments": [{"owner": {"reputation": 2345, "user_id": 2102087, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0382d81dd8afcfa8058df1bdb27fe197?s=128&d=identicon&r=PG", "display_name": "Denis V", "link": "https://stackoverflow.com/users/2102087/denis-v"}, "edited": false, "score": 13, "creation_date": 1506759474, "post_id": 42525774, "comment_id": 79956010, "body": "I will just leave it here: <code>For server requests the Request Body is always non-nil</code>..."}, {"owner": {"reputation": 111, "user_id": 2679859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a062ae8b00195f37d7d070d2fa29eb08?s=128&d=identicon&r=PG&f=1", "display_name": "user2679859", "link": "https://stackoverflow.com/users/2679859/user2679859"}, "edited": false, "score": 4, "creation_date": 1531494891, "post_id": 42525774, "comment_id": 89631831, "body": "This answer only applies to &quot;CLIENT&quot; side http request. Server side (as asked in question) does not need to close.  (but your answer <i>is</i> useful when applied to Client side)"}, {"owner": {"reputation": 2817, "user_id": 4603538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HQPow.png?s=128&g=1", "display_name": "TwiN", "link": "https://stackoverflow.com/users/4603538/twin"}, "reply_to_user": {"reputation": 2345, "user_id": 2102087, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0382d81dd8afcfa8058df1bdb27fe197?s=128&d=identicon&r=PG", "display_name": "Denis V", "link": "https://stackoverflow.com/users/2102087/denis-v"}, "edited": false, "score": 0, "creation_date": 1575515822, "post_id": 42525774, "comment_id": 104595259, "body": "@DenisV unless you&#39;re testing your controllers and you create your own request, but neglect to add a body to your request (i.e. by using <code>http.NewRequest(&quot;some method&quot;, &quot;some path&quot;, nil)</code>)"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 8, "last_activity_date": 1488353714, "creation_date": 1488353714, "answer_id": 42525774, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close/42525774#42525774", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<blockquote>\n  <p>What is the correct place to put this in? Should I put it in the end of the function or does it matter at all, and I can put it in the beginning?</p>\n</blockquote>\n\n<p>Neither nor. Both are terribly wrong.</p>\n\n<p>The <code>defer req.Body.Close()</code> has become cult.</p>\n\n<p>Hard facts first:</p>\n\n<ol>\n<li><p>If the request failed (non nil error returned) there <em>is</em> no Body to close, neither in a defered way nor a direct way.</p></li>\n<li><p>You must close the Body (if present) on all code paths you might take.</p></li>\n<li><p>You probably do not want to close the Body before having processed it (or at least parts of it).</p></li>\n</ol>\n\n<p>Back to the options in your question:</p>\n\n<ul>\n<li><p>\"at the beginning [of the function]\": Totally wrong as Body might be nil (fact 1).</p></li>\n<li><p>\"at the end [of the function]\": Totally wrong because of A) it is dangerous as you might miss a code path leaving your function (fact 2) and B) even if you equip all your function ends (i.e. returns) with <code>defer Bod.Close()</code> it is totally <em>useless</em> to defer it instead of simply closing it via <code>Body.Close()</code>.</p></li>\n</ul>\n\n<p>The <em>only</em> sensible way of defered closing the request body is once, right after having established that Body is non-nil what means the request did not return an error.</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 60, "last_activity_date": 1488376252, "creation_date": 1488376252, "answer_id": 42533540, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close/42533540#42533540", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<p>A request body does not need to be closed in the handler. From the <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"noreferrer\"><code>http.Request</code> documentation</a></p>\n\n<pre><code>// The Server will close the request body. The ServeHTTP\n// Handler does not need to.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 595, "user_id": 6633003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fNSzq.png?s=128&g=1", "display_name": "Andrew Siplas", "link": "https://stackoverflow.com/users/6633003/andrew-siplas"}, "is_accepted": false, "score": 4, "last_activity_date": 1550534743, "creation_date": 1550534743, "answer_id": 54757136, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close/54757136#54757136", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<h2><code>net/http</code></h2>\n\n<h3>Server requests</h3>\n\n<p>Clarified at <a href=\"https://github.com/golang/go/commit/2ede818ae0761fc57dc1b52b4c8673933a3ff3fa\" rel=\"nofollow noreferrer\" title=\"commit 2ede818ae0761fc57dc1b52b4c8673933a3ff3fa\">2ede818</a>, <code>net/http</code> states that:</p>\n\n<blockquote>\nFor server requests, the Request Body is always non-nil but will return EOF immediately when no body is present.\n\n<strong>The Server will close the request body. The ServeHTTP Handler does not need to.</strong>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 169, "user_id": 3817040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b604079446bf1b947521d04cfa3c0325?s=128&d=identicon&r=PG", "display_name": "zhangjie", "link": "https://stackoverflow.com/users/3817040/zhangjie"}, "is_accepted": false, "score": 1, "last_activity_date": 1604571597, "creation_date": 1604571597, "answer_id": 64695193, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close/64695193#64695193", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<p>As mentioned in the documentation, no need to explicit close it both in client and server side.</p>\n<pre><code>// Body is the request's body. \n// \n// For client requests, a nil body means the request has no \n// body, such as a GET request. The HTTP Client's Transport \n// is responsible for calling the Close method. \n// \n// For server requests, the Request Body is always non-nil \n// but will return EOF immediately when no body is present. \n// The Server will close the request body. The ServeHTTP \n// Handler does not need to. \n</code></pre>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14368, "favorite_count": 4, "answer_count": 5, "score": 23, "last_activity_date": 1604571597, "creation_date": 1488352728, "last_edit_date": 1488360985, "question_id": 42525499, "link": "https://stackoverflow.com/questions/42525499/where-to-put-defer-req-body-close", "title": "Where to put &quot;defer req.Body.Close()&quot;?", "body": "<p>I have <code>net/http</code> handlers that have <code>defer req.Body.Close()</code> in each on web server side.</p>\n\n<p>What is the correct place to put this in? Should I put it in the end of the function or does it matter at all, and I can put it in the beginning?</p>\n"}, {"tags": ["image", "go", "compiler-errors", "decode"], "comments": [{"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488334261, "post_id": 42521927, "comment_id": 72180730, "body": "<code>image.Decode</code> should autodetect the format.  I&#39;m not sure what you&#39;re asking.  What&#39;s web.go line 21?"}, {"owner": {"reputation": 61, "user_id": 7392119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207437525199214/picture?type=large", "display_name": "Anis Mokeddes", "link": "https://stackoverflow.com/users/7392119/anis-mokeddes"}, "reply_to_user": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488334512, "post_id": 42521927, "comment_id": 72180790, "body": "Yes, normally it&#39;s autodetect the format."}, {"owner": {"reputation": 61, "user_id": 7392119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207437525199214/picture?type=large", "display_name": "Anis Mokeddes", "link": "https://stackoverflow.com/users/7392119/anis-mokeddes"}, "reply_to_user": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488334566, "post_id": 42521927, "comment_id": 72180796, "body": "web.go line 21 is the error i have when i build my programme ( web.go is the name of my project) line 21"}], "answers": [{"tags": [], "owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "is_accepted": true, "score": 2, "last_activity_date": 1488337386, "creation_date": 1488337386, "answer_id": 42522418, "question_id": 42521927, "link": "https://stackoverflow.com/questions/42521927/not-able-to-decode-different-image-formats-in-golang-assignment-count-mismatch/42522418#42522418", "title": "Not able to decode different image formats in GOLANG (assignment count mismatch)", "body": "<p>So that's just the go compiler saying you're getting 3 values returned from <code>image.Decode</code> and you're only assigning 2 of them.</p>\n\n<p>Do this:</p>\n\n<pre><code>img, format, err := image.Decode(reader)\nfmt.Printf(\"Image Type: %s\\n\", format)\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 7392119, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207437525199214/picture?type=large", "display_name": "Anis Mokeddes", "link": "https://stackoverflow.com/users/7392119/anis-mokeddes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 682, "favorite_count": 0, "accepted_answer_id": 42522418, "answer_count": 1, "score": -1, "last_activity_date": 1488352226, "creation_date": 1488333880, "last_edit_date": 1488352226, "question_id": 42521927, "link": "https://stackoverflow.com/questions/42521927/not-able-to-decode-different-image-formats-in-golang-assignment-count-mismatch", "title": "Not able to decode different image formats in GOLANG (assignment count mismatch)", "body": "<p>I want to decode images of different formats and I'm running into problems calling <code>image.Decode</code>.</p>\n\n<p>Here's my code and here's the error I'm seeing:</p>\n\n<p>/myproject.go:21: assignment count mismatch: 2 = 3</p>\n\n<pre><code>package main\n\nimport (\n \"fmt\"\n \"image\"\n \"log\"\n \"os\"\n)\n\nfunc check(e error) {\n if e != nil {\n     log.Fatal(e)\n }\n}\n\nfunc loadanddeconde(filename string) image.Image {\n  reader, err := os.Open(filename)\n  check(err)\n  defer reader.Close()\n\n/*21.line*/  img, err := image.Decode(reader)\n  check(err)\n  return img\n  }\n\nfunc main() {\n img := loadanddeconde(\"/home/gomok/Bureau/JSK.jpg\")\n fmt.Printf(\"IMAGE TYPE: %T \\n\", img)\n}\n</code></pre>\n"}, {"tags": ["function", "loops", "go", "scope", "closures"], "comments": [{"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488337981, "post_id": 42521462, "comment_id": 72181649, "body": "Why do you have the core map and the list?  It seems like you only append to cpuCores when txt == 0 and otherwise put things in the core map but in your return value you only use cpuCores."}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "is_accepted": false, "score": -1, "last_activity_date": 1488338091, "creation_date": 1488338091, "answer_id": 42522513, "question_id": 42521462, "link": "https://stackoverflow.com/questions/42521462/there-is-no-way-to-use-variable-using-range/42522513#42522513", "title": "There is no way to use variable using range", "body": "<p><code>\n//copying the variable also does not work\n        core := core\n</code>\nIn golang, map types are reference types and we can not copy a map by <code>:=</code>. </p>\n\n<p>You should make a new map in every loop.</p>\n"}, {"comments": [{"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1488488298, "post_id": 42522537, "comment_id": 72265549, "body": "actually cpu core is a map containint all the data about a single core /proc/cpuinfo provides and in my machine there are 4 cores so i wanna end up with a slice of maps of size 4 i get 4 entries but the problem is that they are the last cpu info only"}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "reply_to_user": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1488515511, "post_id": 42522537, "comment_id": 72275005, "body": "Ah.  So you need to instantiate a new map every time through your loop.  Instead of creating <code>core</code> outside of the loop create it in the loop and you should be fine.  Right now you&#39;re making a list that contains four references to the exact same map which you keep overwriting with the last value."}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "reply_to_user": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1488515760, "post_id": 42522537, "comment_id": 72275073, "body": "That said, I think it is more idiomatic in go to use a Struct for this."}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1488523211, "post_id": 42522537, "comment_id": 72277799, "body": "i cannot create because in every iteration theres something new added into the map and yes struct could be cooler but im reading from /proc/cpuinfo and i dont want to write a struct and manually assign all variables i get from cpuinfo file thats the reason i use map"}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1488523276, "post_id": 42522537, "comment_id": 72277834, "body": "what do u think will my approach below cause memory leak actually i think gc will deal with the trash info"}], "tags": [], "owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "is_accepted": false, "score": 1, "last_activity_date": 1488338625, "last_edit_date": 1488338625, "creation_date": 1488338252, "answer_id": 42522537, "question_id": 42521462, "link": "https://stackoverflow.com/questions/42521462/there-is-no-way-to-use-variable-using-range/42522537#42522537", "title": "There is no way to use variable using range", "body": "<p>Seems like you want to do something like:</p>\n\n<pre><code>struct CpuCore {\n    VendorID string\n    ModelName string\n}\n\nfunc GetCpuInfo() CpuInfo {\n    cpus, err := os.Open(\"/proc/cpuinfo\")\n    if err != nil {\n        log.Fatalln(\"Cannot open /proc/cpuinfo\")\n    }\n    defer cpus.Close()\n    s := bufio.NewScanner(cpus)\n    cpuCores := make(CpuCore, 0)\n    for s.Scan() {\n        txt := s.Text()\n\n        fields := strings.Split(txt, \":\")\n\n        if len(fields) &lt; 2 {\n            continue\n        }\n\n        var k, v = strings.TrimSpace(fields[0]), strings.TrimSpace(fields[1])\n        cpuCores = append(cpuCores, CpuCores{VendorID: k, ModelName: v})\n    }\n    return CpuInfo{\n        Cores:    cpuCores,\n        CpuCount: uint(runtime.NumCPU()),\n        Brand:    cpuCores[0].VendorID,\n        Model:    cpuCores[0].ModelName,\n    }\n}\n</code></pre>\n\n<p>I'm assuming you have a struct <code>CpuCore</code> and that you want to make an array of them called <code>cpuCores</code>.</p>\n\n<p>Perhaps if you include more of your code and types that would allow us to actually try to run this code. </p>\n"}, {"tags": [], "owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "is_accepted": true, "score": 0, "last_activity_date": 1488488610, "creation_date": 1488488610, "answer_id": 42565894, "question_id": 42521462, "link": "https://stackoverflow.com/questions/42521462/there-is-no-way-to-use-variable-using-range/42565894#42565894", "title": "There is no way to use variable using range", "body": "<p>I just found the way around by resetting the core variable after appending it </p>\n\n<pre><code>if len(txt) == 0 {\n                cpuCores = append(cpuCores, core)\n                core=map[string]string{}\n            }\n</code></pre>\n\n<p>like this but I am not sure if this can cause a memory leak </p>\n"}], "owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 42565894, "answer_count": 3, "score": 0, "last_activity_date": 1488488610, "creation_date": 1488330369, "last_edit_date": 1488362072, "question_id": 42521462, "link": "https://stackoverflow.com/questions/42521462/there-is-no-way-to-use-variable-using-range", "title": "There is no way to use variable using range", "body": "<p>I have written a simple script that will read the /proc/cpuinfo and return a <code>[]map[string]string</code> containing the info about the cores.</p>\n\n<p>The problem is I am unable to use the values inside the range it always gives me the info of the last CPU.</p>\n\n<p>I tried using closures literally everywhere with no success. And also I tried to copy the variables locally in the loop and still no success.</p>\n\n<p>Here is my code </p>\n\n<pre><code>func GetCpuInfo() CpuInfo {\n    cpus, err := os.Open(\"/proc/cpuinfo\")\n    if err != nil {\n        log.Fatalln(\"Cannot open /proc/cpuinfo\")\n    }\n    defer cpus.Close()\n    s := bufio.NewScanner(cpus)\n    cpuCores := make(CpuCores, 0)\n    core := map[string]string{}\n    for s.Scan() {\n        txt := s.Text()\n//copying the variable also does not work\n        core := core\n\n        if len(txt) == 0 {\n//tried to use closure here with no success\n            cpuCores = append(cpuCores, core)\n            continue\n        }\n        fields := strings.Split(txt, \":\")\n        if len(fields) &lt; 2 {\n            continue\n        }\n//using closure here wont work either\n        var k, v = strings.TrimSpace(fields[0]), strings.TrimSpace(fields[1])\n        core[k] = v\n    }\n    return CpuInfo{\n        Cores:    cpuCores,\n        CpuCount: uint(runtime.NumCPU()),\n        Brand:    cpuCores[0][\"vendor_id\"],\n        Model:    cpuCores[0][\"model name\"],\n    }\n}\n</code></pre>\n\n<p>As you see from the code seems like there is no way to use this variable or i am really missing some huge point.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1488324079, "post_id": 42520555, "comment_id": 72178136, "body": "Can you share the code you have in Go even if it&#39;s incorrect? This library is most popular I believe: <a href=\"https://github.com/garyburd/redigo\" rel=\"nofollow noreferrer\">github.com/garyburd/redigo</a>"}, {"owner": {"reputation": 390, "user_id": 1262847, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/0929b0c02511869cd5bd270ae4076db0?s=128&d=identicon&r=PG", "display_name": "jthomasbailey", "link": "https://stackoverflow.com/users/1262847/jthomasbailey"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1488324197, "post_id": 42520555, "comment_id": 72178163, "body": "@squiguy I don&#39;t really have anything having to do with the array and Redis response, I don&#39;t know where to start. I get the response and I can print it out, that&#39;s about it.  edit: I&#39;m using gopkg.in/redis.v5 which is working pretty good, I just don&#39;t know how to push json to an array in Go."}], "answers": [{"tags": [], "owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "is_accepted": true, "score": 2, "last_activity_date": 1488390519, "last_edit_date": 1488390519, "creation_date": 1488324671, "answer_id": 42520653, "question_id": 42520555, "link": "https://stackoverflow.com/questions/42520555/how-to-push-a-json-object-to-an-array-in-go/42520653#42520653", "title": "How to &quot;push&quot; a json object to an array in Go?", "body": "<p>Let's say you want to get a string response from Redis. Using the <a href=\"https://github.com/garyburd/redigo\" rel=\"nofollow noreferrer\">redigo</a> library you can send a command and receive the response back using it's helper methods.</p>\n\n<p>This is a snippet of how you can do that:</p>\n\n<pre><code>import \"github.com/garyburd/redigo/redis\"\n\nsomeCap := 10 // Make the slice however large you need it.\nmyarray := make([]string, someCap)\nredisConn, err := redis.Dial(\"tcp\" \"your_redis_host:port\")\nif err != nil {\n    // Handle your error accordingly.\n}\ndefer redisConn.Close()\n\nresp, err := redis.String(redisConn.Do(\"GET\", \"some_key\"))\nif err != nil {\n    // Handle your error accordingly.\n}\nmyarray = append(myarray, resp)\n</code></pre>\n"}], "owner": {"reputation": 390, "user_id": 1262847, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/0929b0c02511869cd5bd270ae4076db0?s=128&d=identicon&r=PG", "display_name": "jthomasbailey", "link": "https://stackoverflow.com/users/1262847/jthomasbailey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1201, "favorite_count": 0, "accepted_answer_id": 42520653, "answer_count": 1, "score": 0, "last_activity_date": 1488390519, "creation_date": 1488323982, "question_id": 42520555, "link": "https://stackoverflow.com/questions/42520555/how-to-push-a-json-object-to-an-array-in-go", "title": "How to &quot;push&quot; a json object to an array in Go?", "body": "<p>I'm just fetching json from a Redis db and trying to append it to an array.</p>\n\n<p>In Javascript I would do something like this:</p>\n\n<pre><code>var myarray = [];\n\n//blah blah contact Redis and get the response\n\nmyarray.push(redisresponse);\n</code></pre>\n\n<p>I'm having trouble figuring out how to do that in Go.  </p>\n\n<p>Library suggestions welcome!</p>\n"}, {"tags": ["go", "ethereum", "smartcontracts"], "comments": [{"owner": {"reputation": 2107, "user_id": 1700106, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7asln.jpg?s=128&g=1", "display_name": "Samuel Hawksby-Robinson", "link": "https://stackoverflow.com/users/1700106/samuel-hawksby-robinson"}, "edited": false, "score": 0, "creation_date": 1488407851, "post_id": 42520417, "comment_id": 72222709, "body": "You may find this helpful <a href=\"http://ethereum.stackexchange.com/questions/3514/how-to-call-a-contract-method-using-the-eth-call-json-rpc-api\" title=\"how to call a contract method using the eth call json rpc api\">ethereum.stackexchange.com/questions/3514/&hellip;</a> . Depends on what kind of things you are wanting to do with Go and Ethereum."}], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 5378688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d282abf2a0434e5c15c66ca4df2daabf?s=128&d=identicon&r=PG&f=1", "display_name": "Sushant Kumar", "link": "https://stackoverflow.com/users/5378688/sushant-kumar"}, "edited": false, "score": 0, "creation_date": 1544676250, "post_id": 50572552, "comment_id": 94362775, "body": "is it possible to access the smart contract without building the ABI generation steps. Like how we access the contract instance in web3.js or web3.py ?"}, {"owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "reply_to_user": {"reputation": 387, "user_id": 5378688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d282abf2a0434e5c15c66ca4df2daabf?s=128&d=identicon&r=PG&f=1", "display_name": "Sushant Kumar", "link": "https://stackoverflow.com/users/5378688/sushant-kumar"}, "edited": false, "score": 1, "creation_date": 1544680674, "post_id": 50572552, "comment_id": 94363965, "body": "@SushantKumar yes you don&#39;t have to use the abi helper package and you can send raw transactions to read or write data but you&#39;ll need to construct the encoded arguments manually"}], "tags": [], "owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "is_accepted": false, "score": 7, "last_activity_date": 1528073881, "last_edit_date": 1528073881, "creation_date": 1527535977, "answer_id": 50572552, "question_id": 42520417, "link": "https://stackoverflow.com/questions/42520417/how-to-call-an-ethereum-contract-from-go/50572552#50572552", "title": "How to call an Ethereum contract from Go?", "body": "<p>Here's a simple example of how you can interact with a smart contract in Go. Assuming you have <code>solc</code> and <code>abigen</code> installed.</p>\n\n<pre><code>solc --abi Store.sol &gt; Store.abi\nsolc --bin Store.sol &gt; Store.bin\nabigen --bin=Store.bin --abi=Store.abi --pkg=store --out=Store.go\n</code></pre>\n\n<p>Store.sol</p>\n\n<pre><code>pragma solidity ^0.4.24;\n\ncontract Store {\n  event ItemSet(bytes32 key, bytes32 value);\n\n  string public version;\n  mapping (bytes32 =&gt; bytes32) public items;\n\n  constructor(string _version) public {\n    version = _version;\n  }\n\n  function setItem(bytes32 key, bytes32 value) external {\n    items[key] = value;\n    emit ItemSet(key, value);\n  }\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"crypto/ecdsa\"\n    \"fmt\"\n    \"log\"\n    \"math/big\"\n\n    \"github.com/ethereum/go-ethereum/accounts/abi/bind\"\n    \"github.com/ethereum/go-ethereum/common\"\n    \"github.com/ethereum/go-ethereum/crypto\"\n    \"github.com/ethereum/go-ethereum/ethclient\"\n\n    store \"./contracts\" // for demo\n)\n\nfunc main() {\n    client, err := ethclient.Dial(\"https://rinkeby.infura.io\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    privateKey, err := crypto.HexToECDSA(\"fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    publicKey := privateKey.Public()\n    publicKeyECDSA, ok := publicKey.(*ecdsa.PublicKey)\n    if !ok {\n        log.Fatal(\"error casting public key to ECDSA\")\n    }\n\n    fromAddress := crypto.PubkeyToAddress(*publicKeyECDSA)\n    nonce, err := client.PendingNonceAt(context.Background(), fromAddress)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    gasPrice, err := client.SuggestGasPrice(context.Background())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    auth := bind.NewKeyedTransactor(privateKey)\n    auth.Nonce = big.NewInt(int64(nonce))\n    auth.Value = big.NewInt(0)     // in wei\n    auth.GasLimit = uint64(300000) // in units\n    auth.GasPrice = gasPrice\n\n    address := common.HexToAddress(\"0x147B8eb97fD247D06C4006D269c90C1908Fb5D54\")\n    instance, err := store.NewStore(address, client)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    key := [32]byte{}\n    value := [32]byte{}\n    copy(key[:], []byte(\"foo\"))\n    copy(value[:], []byte(\"bar\"))\n\n    tx, err := instance.SetItem(auth, key, value)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"tx sent: %s\", tx.Hash().Hex()) // tx sent: 0x8d490e535678e9a24360e955d75b27ad307bdfb97a1dca51d0f3035dcee3e870\n\n    result, err := instance.Items(&amp;bind.CallOpts{}, key)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(string(result[:])) // \"bar\"\n}\n</code></pre>\n\n<p>For more examples, check out the <a href=\"https://github.com/miguelmota/ethereum-development-with-go-book\" rel=\"noreferrer\">Ethereum Development with Go book</a>.</p>\n"}], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4291, "favorite_count": 4, "answer_count": 1, "score": 4, "last_activity_date": 1528073881, "creation_date": 1488323171, "question_id": 42520417, "link": "https://stackoverflow.com/questions/42520417/how-to-call-an-ethereum-contract-from-go", "title": "How to call an Ethereum contract from Go?", "body": "<p>I've tried to follow the <a href=\"https://github.com/ethereum/go-ethereum/wiki/Native-DApps:-Go-bindings-to-Ethereum-contracts\" rel=\"nofollow noreferrer\">go-ethereum guide for this</a> but it <a href=\"https://github.com/ethereum/go-ethereum/issues/3726\" rel=\"nofollow noreferrer\">seems out of date</a>. I've tried looking around for a web3 library in Go but everything tries to point back to \"use geth.\"</p>\n\n<p>From Go, how do I call a contract in the Ethereum block chain? How different would it be if I'm targeting testnet or testrpc?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "edited": false, "score": 1, "creation_date": 1488309010, "post_id": 42516717, "comment_id": 72170680, "body": "If you are using a boolean for this, why are you making two channels?"}], "answers": [{"tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1488308888, "creation_date": 1488308888, "answer_id": 42516860, "question_id": 42516717, "link": "https://stackoverflow.com/questions/42516717/how-to-stop-goroutine/42516860#42516860", "title": "How to stop goroutine", "body": "<p>When you close the <code>run</code> channel, <code>case &lt;-run</code> will always trigger: listening on a closed channel returns a zero value immediately.</p>\n\n<p>if you want to stop the goroutine, you should return after you get the <code>&lt;-quit</code> signal.</p>\n\n<p>As a side note, your <code>default:</code> clause makes the for loop actively work, you should get rid of it (you will still be listening on both channels)</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5646735"}, "edited": false, "score": 0, "creation_date": 1488312673, "post_id": 42517082, "comment_id": 72172577, "body": "That&#39;s it! It runs, thank you!"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1488312828, "post_id": 42517082, "comment_id": 72172663, "body": "No reason to do a read from the channel and then check the value.  You can read from the channel directly in the if statement: <code>if !&lt;-statusChannel {</code>.  Example: <a href=\"https://play.golang.org/p/3q5jpC19rW\" rel=\"nofollow noreferrer\">play.golang.org/p/3q5jpC19rW</a>.  You can also compress the send on the status channel by simply unconditionally sending the results of boolean expression you&#39;re currently using as the if statement&#39;s condition."}], "tags": [], "owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "is_accepted": false, "score": 1, "last_activity_date": 1488309722, "creation_date": 1488309722, "answer_id": 42517082, "question_id": 42516717, "link": "https://stackoverflow.com/questions/42516717/how-to-stop-goroutine/42517082#42517082", "title": "How to stop goroutine", "body": "<p>Here's an isolated commented runable version of how such a signaling system might be implemented.</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"log\"\n)\n\nfunc main() {\n    statusChannel := make(chan bool)\n    go applicationLoop(statusChannel)\n\n    // reasonably random outcome for testing\n    if time.Now().Unix() % 2 == 0 {\n        statusChannel&lt;-true\n    } else {\n        statusChannel&lt;-false\n    }\n\n    for {\n        // busy loop for testing\n        time.Sleep(1000)\n    }\n}\n\nfunc applicationLoop(statusChannel chan bool) {\n    defer close(statusChannel)\n    for {\n        log.Printf(\"waiting for signal...\\n\")\n        shouldContinue := &lt;-statusChannel\n        if !shouldContinue {\n            log.Print(\"received false, breaking...\\n\")\n            break\n        }\n        // run your code here\n        // you should use a second channel to return results, as the channel is not buffered\n        log.Print(\"working...\\n\")\n    }\n}\n</code></pre>\n\n<p>Do note that sending a value to <code>statusChannel</code> while is is not listening for a value will make the example blow up in your face. Either use a buffered channel or a channel that signals back to <code>main</code> when the goroutine is back to listening for a signal.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1488316534, "creation_date": 1488316534, "answer_id": 42518866, "question_id": 42516717, "link": "https://stackoverflow.com/questions/42516717/how-to-stop-goroutine/42518866#42518866", "title": "How to stop goroutine", "body": "<p>This problem has two parts. </p>\n\n<p>First we need to stop child goroutines somehow in a way that even if a parent goroutines stops, all it's children should get notified and stop - a hierarchy of stop signals that goes down but not up.</p>\n\n<p>On the other hand the parent needs to wait for it's children until they are done. Otherwise we would return from a goroutine or even exit from the app before some goroutines are finished properly.</p>\n\n<p>For simplicity we ignore implementing error handling, timeouts and the like.</p>\n\n<p>For handling the first problem we use <code>context.Context</code> which gives us a nice hierarchy of execution context handling tools and for solving the second problem we use <code>sync.WaitGroup</code> which allows us to wait for a group of goroutines to complete their tasks. A simple demonstration would be:</p>\n\n<pre><code>func main() {\n    all := &amp;sync.WaitGroup{}\n    rootCtx, rootCancel := context.WithCancel(context.Background())\n\n    all.Add(1)\n    go level1(rootCtx, all)\n\n    // just to simulate stop, we could use an os signal instead\n    // app ends after 3 seconds\n    go func() {\n        time.Sleep(time.Second * 3)\n        rootCancel()\n    }()\n\n    all.Wait()\n}\n\nfunc level1(parent context.Context, all *sync.WaitGroup) {\n    defer all.Done()\n    l1Ctx, l1Cancel := context.WithCancel(parent)\n    defer l1Cancel()\n\n    for i := 0; i &lt; 3; i++ {\n        all.Add(1)\n        go level2(l1Ctx, all)\n    }\n\n    for {\n        select {\n        case &lt;-parent.Done():\n            return\n        // other cases if any,\n        // this is a sample\n        case &lt;-time.After(time.Second):\n            log.Println(`level1`)\n        }\n    }\n}\n\nfunc level2(parent context.Context, all *sync.WaitGroup) {\n    defer all.Done()\n    for {\n        select {\n        case &lt;-parent.Done():\n            return\n        case &lt;-time.After(time.Second):\n            log.Println(`level2`)\n        }\n    }\n}\n</code></pre>\n\n<p>Which gives us some output like:</p>\n\n<pre><code>[  info ] level2\n[  info ] level2\n[  info ] level2\n[  info ] level1\n[  info ] level2\n[  info ] level1\n[  info ] level2\n[  info ] level2\n</code></pre>\n\n<p>Currently there is no official package that provide a functionality which combines <code>context.Context</code> and <code>sync.WaitGroup</code>. The nearest thing is an <a href=\"https://github.com/golang/sync/blob/master/errgroup/errgroup.go\" rel=\"nofollow noreferrer\"><code>errgroup</code></a> which can resemble this functionality with some hacks.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5646735"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4236, "favorite_count": 0, "closed_date": 1488481628, "answer_count": 3, "score": 4, "last_activity_date": 1488362353, "creation_date": 1488308439, "last_edit_date": 1488362353, "question_id": 42516717, "link": "https://stackoverflow.com/questions/42516717/how-to-stop-goroutine", "closed_reason": "Duplicate", "title": "How to stop goroutine", "body": "<p>I have a goroutine that calls a function and with a special parameter i want to start or stop this goroutine. My problem is that this code never stops my goroutine, it creates everytime a new job. </p>\n\n<pre><code>quit := make(chan bool)\nrun := make(chan bool)\n\n    go func() {\n        for {\n            select {\n            case &lt;-quit:\n                close(run)\n            case &lt;-run:\n                myFunc(c)\n            default:\n            }\n        }\n    }()\n\n    if x == true {\n        quit &lt;- true\n    } else {\n        run &lt;- true\n    }\n</code></pre>\n\n<p>How do I stop my routine? </p>\n"}, {"tags": ["go", "colors", "rgb", "image-manipulation", "grayscale"], "comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1531505908, "post_id": 42516203, "comment_id": 89637345, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41350255/convert-an-image-to-grayscale-in-go\">Convert an image to grayscale in Go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1488318991, "post_id": 42518487, "comment_id": 72175866, "body": "nice answer! I didn&#39;t want to get into luminosity, but I probably should have included <code>GrayModel</code>."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488328570, "post_id": 42518487, "comment_id": 72179345, "body": "HI, didn&#39;t realise there was a better way to convert to Grayscale. I&#39;ve put your code into mine and it is returning an error regarding y. The error is as follows, .\\rgbtogray.go:36: cannot use y (type uint32) as type int in argument to imgSet.Set. Any further tips?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488344221, "post_id": 42518487, "comment_id": 72183397, "body": "@benjano Are you sure you copied my code correctly? Sounds like you missed passing <code>x</code> and <code>y</code> to <code>imgSet.Set()</code>. If not, please post what is causing error exactly."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366265, "post_id": 42518487, "comment_id": 72195736, "body": "I&#39;m pretty sure I am, I have edited my answer to show my code in its current state."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366422, "post_id": 42518487, "comment_id": 72195838, "body": "Could the issue be with the fact the variable is called y which it the coordinate variable? I&#39;ve changed that to Z and now the code runs however it just returns a blank image."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366526, "post_id": 42518487, "comment_id": 72195901, "body": "@benjano Yep, don&#39;t call it <code>y</code> as it shadows the other <code>y</code> variable..."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366629, "post_id": 42518487, "comment_id": 72195964, "body": "@icza I have changed it to Z and it&#39;s running, the image it returns however is just blank."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366879, "post_id": 42518487, "comment_id": 72196136, "body": "@benjano I tested it and it works for me. Change your logging: <code>log.Fatal(os.Stderr, &quot;%s: %v\\n&quot;, &quot;flower.jpg&quot;, err)</code> =&gt; <code>log.Fatalf(&quot;%s: %v\\n&quot;, &quot;flower.jpg&quot;, err)</code>"}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488366895, "post_id": 42518487, "comment_id": 72196147, "body": "Hi @icza I have tried you second suggested solution and it is working for me now. Thank you for the help."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488367052, "post_id": 42518487, "comment_id": 72196260, "body": "I have both versions working now, not sure what was happening with it before."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 31, "last_activity_date": 1493099543, "last_edit_date": 1493099543, "creation_date": 1488315012, "answer_id": 42518487, "question_id": 42516203, "link": "https://stackoverflow.com/questions/42516203/converting-rgba-image-to-grayscale-golang/42518487#42518487", "title": "Converting RGBA image to Grayscale Golang", "body": "<p><a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"noreferrer\"><code>Color.RGBA()</code></a> is a method that returns the alpha-premultiplied red, green, blue and alpha values, all being of type <code>uint32</code>, but only being in the range of <code>[0, 0xffff]</code> (using only 16 bits out of 32). This means you can add these components, they will not overflow (max value of each component fits into 16 bits, so their sum will fit into 32 bits).</p>\n\n<p>One thing to note here: the result will also be alpha-premultiplied, and after dividing by 3, it will still be in the range of <code>[0..0xffff]</code>. So by doing a <code>uint8(r)</code> type conversion, you're just keeping the lowest 8 bits, which will be seemingly just a random value compared to the whole number. You should rather take the highest 8 bits.</p>\n\n<p>But not so fast. What we're trying to do here is convert a color image to a grayscale image, which will lose the \"color\" information, and what we want is basically the luminosity of each pixel. Your proposed solution is called the <em>average</em> method, and it gives rather poor result, because it takes all the R, G and B components with equal weight, even though these colors have different wavelength and thus contribute in different measures to the luminosity of the overall pixel. Read more about it here: <a href=\"https://www.tutorialspoint.com/dip/grayscale_to_rgb_conversion.htm\" rel=\"noreferrer\">Grayscale to RGB Conversion</a>.</p>\n\n<p>For a realistic RGB -> grayscale conversion, the following weights have to be used:</p>\n\n<pre><code>Y = 0.299 * R +  0.587 * G + 0.114 * B\n</code></pre>\n\n<p>You can read more behind these weights (and variants) on wikipedia: <a href=\"https://en.wikipedia.org/wiki/Grayscale\" rel=\"noreferrer\">Grayscale</a>. This is called the <em>luminosity</em> method, and this will give the best grayscale images.</p>\n\n<p>So far so good, we have the luminosity, how do we go to a <code>color.Color</code> value from here? One option is to use a <a href=\"https://golang.org/pkg/image/color/#RGBA\" rel=\"noreferrer\"><code>color.RGBA</code></a> color value, where you specify the same luminosity to all components (alpha may be kept). And if you intend to use an <a href=\"https://golang.org/pkg/image/#RGBA\" rel=\"noreferrer\"><code>image.RGBA</code></a> returned by <a href=\"https://golang.org/pkg/image/#NewRGBA\" rel=\"noreferrer\"><code>image.NewRGBA()</code></a>, probably this is the best way as no color conversion will be needed when setting the color (as it matches the image's color model).</p>\n\n<p>Another tempting choice is to use the <a href=\"https://golang.org/pkg/image/color/#Gray\" rel=\"noreferrer\"><code>color.Gray</code></a> which is a color (implements the <code>color.Color</code> interface), and models a color just the way we have it now: with <code>Y</code>, stored using an <code>uint8</code>. An alternative could be <a href=\"https://golang.org/pkg/image/color/#Gray16\" rel=\"noreferrer\"><code>color.Gray16</code></a> which is basically the \"same\", but uses 16 bits to store <code>Y</code> as an <code>uint16</code>. For these, best would be to also use an image with the matching color model, such as <a href=\"https://golang.org/pkg/image/#Gray\" rel=\"noreferrer\"><code>image.Gray</code></a> or <a href=\"https://golang.org/pkg/image/#Gray16\" rel=\"noreferrer\"><code>image.Gray16</code></a> (although this is not a requirement).</p>\n\n<p>So the conversion should be:</p>\n\n<pre><code>oldPixel := img.At(x, y)\nr, g, b, _ := oldPixel.RGBA()\nlum := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\npixel := color.Gray{uint8(lum / 256)}\nimgSet.Set(x, y, pixel)\n</code></pre>\n\n<p>Note that we needed to convert the R, G, B components to <code>float64</code> to be able to multiply by the weights. Since <code>r</code>, <code>g</code>, <code>b</code> are already of type <code>uint32</code>, we could substitute this with integer operations (without overflow).</p>\n\n<p>Without going into details \u2013and because the standard lib already has a solution for this\u2013, here it is:</p>\n\n<pre><code>oldPixel := img.At(x, y)\nr, g, b, _ := oldPixel.RGBA()\nlum := (19595*r + 38470*g + 7471*b + 1&lt;&lt;15) &gt;&gt; 24\nimgSet.Set(x, y, color.Gray{uint8(lum)})\n</code></pre>\n\n<p>Now without writing such \"ugly\" things, the recommended way is to simply use the color converters of the <a href=\"https://golang.org/pkg/image/color/\" rel=\"noreferrer\"><code>image/color</code></a> package, called <a href=\"https://golang.org/pkg/image/color/#Model\" rel=\"noreferrer\"><code>Model</code></a>s. The prepared <code>color.GrayModel</code> model is able to convert any colors to the model of <code>color.Gray</code>.</p>\n\n<p>It's this simple:</p>\n\n<pre><code>oldPixel := img.At(x, y)\npixel := color.GrayModel.Convert(oldPixel)\nimgSet.Set(x, y, pixel)\n</code></pre>\n\n<p>It does the same as our last <em>luminosity</em> weighted model, using integer-arithmetic. Or in one line:</p>\n\n<pre><code>imgSet.Set(x, y, color.GrayModel.Convert(img.At(x, y)))\n</code></pre>\n\n<p>To have a higher, 16-bit grayscale resolution:</p>\n\n<pre><code>imgSet.Set(x, y, color.Gray16Model.Convert(img.At(x, y)))\n</code></pre>\n\n<p>One last note: since you're drawing on an image returned by <code>image.NewRGBA()</code>, it is of type <code>*image.RGBA</code>. You don't need to check if it has a <code>Set()</code> method, because <code>image.RGBA</code> is a static type (not interface), and it does have a <code>Set()</code> method, it is checked at compile time. The case when you do need to check is if you have an image of the general <a href=\"https://golang.org/pkg/image/#Image\" rel=\"noreferrer\"><code>image.Image</code></a> type which is an interface, but this interface does not contain / \"prescribe\" the <code>Set()</code> method; but the dynamic type implementing this interface may provide that nonetheless.</p>\n"}], "owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10307, "favorite_count": 3, "accepted_answer_id": 42518487, "answer_count": 1, "score": 10, "last_activity_date": 1493099543, "creation_date": 1488306530, "last_edit_date": 1495541392, "question_id": 42516203, "link": "https://stackoverflow.com/questions/42516203/converting-rgba-image-to-grayscale-golang", "title": "Converting RGBA image to Grayscale Golang", "body": "<p>I'm currently working on a program to convert and RGBA image to grayscale.</p>\n\n<p>I asked a question earlier and was directed to the following answer -\n<a href=\"https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-go-lang-image\">Change color of a single pixel - Go lang image</a></p>\n\n<p>Here is my original question - <a href=\"https://stackoverflow.com/questions/42513797/program-to-convert-rgba-to-grayscale-golang?noredirect=1#comment72166960_42513797\">Program to convert RGBA to grayscale Golang</a></p>\n\n<p>I have edited my code so it now successfully runs - however the image outputted is not what I want. It is converted to grayscale however the pixels are all messed up making it look like noise on an old TV.</p>\n\n<pre><code>package main\n\nimport (\n\"image\"\n\"image/color\"\n\"image/jpeg\"\n\"log\"\n\"os\"\n)\n\ntype ImageSet interface {\nSet(x, y int, c color.Color)\n}\n\n\nfunc main() {\nfile, err := os.Open(\"flower.jpg\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\n\nimg, err := jpeg.Decode(file)\nif err != nil {\n    log.Fatal(os.Stderr, \"%s: %v\\n\", \"flower.jpg\", err)\n}\n\nb := img.Bounds()\n\nimgSet := image.NewRGBA(b)\nfor y := 0; y &lt; b.Max.Y; y++ {\n    for x := 0; x &lt; b.Max.X; x++ {\n      oldPixel := img.At(x, y)\n       r, g, b, a:= oldPixel.RGBA()\n       r = (r+g+b)/3\n       pixel := color.RGBA{uint8(r), uint8(r), uint8(r), uint8(a)}\n       imgSet.Set(x, y, pixel)\n     }\n    }\n\n    outFile, err := os.Create(\"changed.jpg\")\n    if err != nil {\n      log.Fatal(err)\n    }\n    defer outFile.Close()\n    jpeg.Encode(outFile, imgSet, nil)\n\n}\n</code></pre>\n\n<p>I know I haven't added in the <code>if else</code> statement for checking if the image can accept the <code>Set()</code> method, however the suggestion for simply making a new image seems to have solved this.</p>\n\n<p>Any help much appreciated.</p>\n\n<p>Edit:</p>\n\n<p>I've added in some suggested code from the answer below:</p>\n\n<pre><code>    package main\n\nimport (\n//\"fmt\"\n\"image\"\n\"image/color\"\n\"image/jpeg\"\n\"log\"\n\"os\"\n)\n\ntype ImageSet interface {\nSet(x, y int, c color.Color)\n}\n\n\nfunc main() {\nfile, err := os.Open(\"flower.jpg\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\n\nimg, err := jpeg.Decode(file)\nif err != nil {\n    log.Fatal(os.Stderr, \"%s: %v\\n\", \"flower.jpg\", err)\n}\n\nb := img.Bounds()\nimgSet := image.NewRGBA(b)\nfor y := 0; y &lt; b.Max.Y; y++ {\n    for x := 0; x &lt; b.Max.X; x++ {\n      oldPixel := img.At(x, y)\n      r, g, b, _ := oldPixel.RGBA()\n      y := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\n      pixel := color.Gray{uint8(y / 256)}\n      imgSet.Set(x, y, pixel)\n     }\n    }\n\n    outFile, err := os.Create(\"changed.jpg\")\n    if err != nil {\n      log.Fatal(err)\n    }\n    defer outFile.Close()\n    jpeg.Encode(outFile, imgSet, nil)\n\n}\n</code></pre>\n\n<p>I currently get the following error.</p>\n\n<pre><code>.\\rgbtogray.go:36: cannot use y (type uint32) as type int in argument to imgSet.Set\n</code></pre>\n\n<p>Am I missing something from the answer? Any tips appreciated.</p>\n"}, {"tags": ["date", "parsing", "go", "time"], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 4021691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1mgnRi1ocS4/AAAAAAAAAAI/AAAAAAAAADc/4tIbU_06tOo/photo.jpg?sz=128", "display_name": "Andrew Dawson", "link": "https://stackoverflow.com/users/4021691/andrew-dawson"}, "edited": false, "score": 0, "creation_date": 1488307634, "post_id": 42516353, "comment_id": 72169946, "body": "Thank you. I did not realize the reference date had to be a specific date."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1488307075, "creation_date": 1488307075, "answer_id": 42516353, "question_id": 42516194, "link": "https://stackoverflow.com/questions/42516194/golang-time-parse-defining-new-format-type/42516353#42516353", "title": "Golang time.Parse Defining New Format Type", "body": "<p>Your format string is using the wrong <a href=\"https://godoc.org/time#Parse\" rel=\"nofollow noreferrer\">reference date</a> (<code>2006-01-02 15:04:05</code>). It should be the following:</p>\n\n<pre><code>const longForm2 = \"2006/01/02 15:04:05\"\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 4021691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1mgnRi1ocS4/AAAAAAAAAAI/AAAAAAAAADc/4tIbU_06tOo/photo.jpg?sz=128", "display_name": "Andrew Dawson", "link": "https://stackoverflow.com/users/4021691/andrew-dawson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 0, "closed_date": 1488346746, "accepted_answer_id": 42516353, "answer_count": 1, "score": -1, "last_activity_date": 1488307075, "creation_date": 1488306508, "last_edit_date": 1495541828, "question_id": 42516194, "link": "https://stackoverflow.com/questions/42516194/golang-time-parse-defining-new-format-type", "closed_reason": "Duplicate", "title": "Golang time.Parse Defining New Format Type", "body": "<p>I am trying to parse a date of the format \"2017/02/28 17:07:54\". I am using the time.Parse method.</p>\n\n<p>playground example: <a href=\"https://play.golang.org/p/B_hnws1AGv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/B_hnws1AGv</a></p>\n\n<p>This is failing. It produces a time object: 0001-01-01 00:00:00 +0000 UTC (which clearly is not the date I am trying to parse). </p>\n\n<p>How can I parse a date of this format? My end goal is to convert  \"2017/02/28 17:07:54\" to \"Feb 28\" Note that I do not want \"February 28\" I want \"Feb 28.\"</p>\n\n<p>I have looked at the following links:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/36807596/how-to-convert-date-format-in-golang\">How to convert date format in golang?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/25845172/parsing-date-string-in-golang\">Parsing date string in golang</a></li>\n</ul>\n"}, {"tags": ["go", "hashicorp-vault"], "answers": [{"comments": [{"owner": {"reputation": 1300, "user_id": 826797, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae5bf6a2566204b386bf2898443be58d?s=128&d=identicon&r=PG", "display_name": "NobbZ", "link": "https://stackoverflow.com/users/826797/nobbz"}, "edited": false, "score": 2, "creation_date": 1504607343, "post_id": 42590985, "comment_id": 79064735, "body": "But how can I use that received secret in subsequent requests? How can I change the Token in a client?"}, {"owner": {"reputation": 169, "user_id": 446077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da1bc4132650be983e2cc101d23c0e70?s=128&d=identicon&r=PG", "display_name": "victorcastell", "link": "https://stackoverflow.com/users/446077/victorcastell"}, "edited": false, "score": 0, "creation_date": 1547049905, "post_id": 42590985, "comment_id": 95060693, "body": "For a detailed example see <a href=\"https://groups.google.com/d/msg/vault-tool/cS7J2KbAwZg/7pu6PYSRAAAJ\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/vault-tool/cS7J2KbAwZg/7pu6PYSRAAAJ</a>"}], "tags": [], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "is_accepted": true, "score": 7, "last_activity_date": 1488590354, "creation_date": 1488590354, "answer_id": 42590985, "question_id": 42515866, "link": "https://stackoverflow.com/questions/42515866/authentication-methods-using-the-vault-api-package/42590985#42590985", "title": "Authentication methods using the vault API package", "body": "<p>I managed to figure this out, eventually. It's not totally obvious, but makes sense.</p>\n\n<p>Vault has a <a href=\"https://godoc.org/github.com/hashicorp/vault/api#Logical.Write\" rel=\"noreferrer\">generic write method</a> it uses to write data. You can utilise this to perform a login with the API by simply building the URL and sending a PUT request to that endpoint</p>\n\n<p>It looks a bit like this:</p>\n\n<pre><code>// create a vault client\nclient, err := api.NewClient(&amp;api.Config{Address: url, HttpClient: httpClient})\nif err != nil {\n    panic(err)\n}\n\n// to pass the password\noptions := map[string]interface{}{\n   \"password\": password,        \n}\n\n// the login path\n// this is configurable, change userpass to ldap etc\npath := fmt.Sprintf(\"auth/userpass/login/%s\", username)\n\n// PUT call to get a token\nsecret, err := client.Logical().Write(path, options)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57, "user_id": 4982035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f4dfa381361c71b0f36ff10fbdeb19?s=128&d=identicon&r=PG&f=1", "display_name": "Saturnus", "link": "https://stackoverflow.com/users/4982035/saturnus"}, "is_accepted": false, "score": 1, "last_activity_date": 1603181503, "creation_date": 1603181503, "answer_id": 64441062, "question_id": 42515866, "link": "https://stackoverflow.com/questions/42515866/authentication-methods-using-the-vault-api-package/64441062#64441062", "title": "Authentication methods using the vault API package", "body": "<p>Without having enough reputation adding an extra hint here instead of a comment to the accepted answer. The token can be extracted from the auth response something like this:</p>\n<pre><code>client.SetToken(secret.Auth.ClientToken)\n</code></pre>\n<p>The relevant interfaces are documented here:</p>\n<p><a href=\"https://godoc.org/github.com/hashicorp/vault/api#Secret\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/hashicorp/vault/api#Secret</a></p>\n<p><a href=\"https://godoc.org/github.com/hashicorp/vault/api#SecretAuth\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/hashicorp/vault/api#SecretAuth</a></p>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3083, "favorite_count": 1, "accepted_answer_id": 42590985, "answer_count": 2, "score": 4, "last_activity_date": 1603181503, "creation_date": 1488305324, "last_edit_date": 1544979149, "question_id": 42515866, "link": "https://stackoverflow.com/questions/42515866/authentication-methods-using-the-vault-api-package", "title": "Authentication methods using the vault API package", "body": "<p>I am trying to use the <a href=\"https://github.com/hashicorp/vault/tree/master/api\" rel=\"nofollow noreferrer\">Vault Golang Package</a> to authenticate using the API.</p>\n\n<p>I created a new client, and then can set my token:</p>\n\n<pre><code>client, err := api.NewClient(&amp;api.Config{Address: vaultAddr, HttpClient: httpClient})\n\n if err != nil {\n   return nil, errors.Wrap(err, \"could not create vault client\")\n }\n\nclient.SetToken(token)\n</code></pre>\n\n<p>That's great and all, but I want to auth against the API using one of the other auth methods, (LDAP, Userpass etc)</p>\n\n<p>Is this even possible? How can I retrieve a token using the API?</p>\n\n<p>I guess I could just use net/http to retrieve the token using an API call, but is there any method to actually auth in another way?</p>\n"}, {"tags": ["ruby-on-rails", "heroku", "go", "worker"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1488375065, "post_id": 42515709, "comment_id": 72201850, "body": "whenever the box runs out of RAM the OS will kill the offending process ... in the same address space as your process run the command : ` top` or similar during an execution of your process to confirm you still have free space during such a kill event"}], "owner": {"reputation": 1933, "user_id": 6342826, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/iSdHY.jpg?s=128&g=1", "display_name": "Leticia Esperon", "link": "https://stackoverflow.com/users/6342826/leticia-esperon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488304748, "creation_date": 1488304748, "question_id": 42515709, "link": "https://stackoverflow.com/questions/42515709/running-long-tasks-that-cannot-be-interrupted-in-heroku", "title": "Running long tasks that cannot be interrupted in Heroku", "body": "<p>I have a problem that I think must be very common but I'm not finding a solution. \nI have go routines in my Go app in Heroku, which are long (7 minutes), use the app's Redis database, and cannot be interrupted. I saw that the auto scaler sometimes kills the Heroku dyno which is running the task. I need a way of running this task independently from the dynos so I know that it is completed.\nI have the exact same problem in my Rails app. </p>\n\n<p>I was mentioned the 'one-off-dynos' and I read a bit about them. \nIs there something similar I could use from my Rails and Go code that can take care of my tasks without interrupting them?\nI tried with the delayed jobs worker but maybe this isn't the cleanest thing to do.\nWhat do you recommend I do?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 2, "creation_date": 1488304237, "post_id": 42515407, "comment_id": 72168158, "body": "It looks like almost everything is <i>NOT SUPPORTED</i>. Is it really a regex engine? Anyway, assertions are not available ( it says ) so <code>(?!somestring)</code>, which is what you need, is out. The only way around it is to use your regex <code>\\&#47;.*\\&#47;.*\\&#47;(.*)</code> in a while loop. Each match, string compare group 1 with <code>somestring</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1488304730, "post_id": 42515407, "comment_id": 72168422, "body": "RE2 (which Go implements) doesn&#39;t support lookarounds. Just check the submatches yourself."}], "answers": [{"tags": [], "owner": {"reputation": 1529, "user_id": 4710204, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cf5731a9767744d9fa0dc6e3f891175?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan", "link": "https://stackoverflow.com/users/4710204/ryan"}, "is_accepted": false, "score": 5, "last_activity_date": 1488305084, "creation_date": 1488305084, "answer_id": 42515807, "question_id": 42515407, "link": "https://stackoverflow.com/questions/42515407/is-there-a-way-to-match-everything-except-a-constant-string-using-go-regexp/42515807#42515807", "title": "Is there a way to match everything except a constant string using Go.Regexp?", "body": "<p>Golang intentionally leaves this feature out as there is no way to implement it in O(n) time to satisfy the constraints of a true Regular Expression <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/7qgSDWPIh_E\" rel=\"noreferrer\">according to Russ Cox</a>:</p>\n\n<blockquote>\n  <p>The lack of generalized assertions, like the lack of backreferences, \n  is not a statement on our part about regular expression style.  It is \n  a consequence of not knowing how to implement them efficiently.  If \n  you can implement them while preserving the guarantees made by the \n  current package regexp, namely that it makes a single scan over the \n  input and runs in O(n) time, then I would be happy to review and \n  approve that CL.  However, I have pondered how to do this for five \n  years, off and on, and gotten nowhere.</p>\n</blockquote>\n\n<p>It looks like the best way to do this is to manually check the match after as JimB mentions above.</p>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1488447382, "last_edit_date": 1495541357, "creation_date": 1488447382, "answer_id": 42551653, "question_id": 42515407, "link": "https://stackoverflow.com/questions/42515407/is-there-a-way-to-match-everything-except-a-constant-string-using-go-regexp/42551653#42551653", "title": "Is there a way to match everything except a constant string using Go.Regexp?", "body": "<p>The <code>anything/anything/somestring</code> should not be expressed as <code>\\/.*\\/.*\\/(.*)</code>. The first <code>.*</code> matches up to the last but one <code>/</code> in the string. You need to use a negated character class <code>[^/]</code> (not the <code>/</code> should not be escaped in Go regex).</p>\n\n<p>Since RE2 that Go uses does not support lookaheads, you need to capture (as <a href=\"https://stackoverflow.com/questions/42515407/is-there-a-way-to-match-everything-except-a-constant-string-using-go-regexp#comment72168422_42515407\">JimB mentions in the comments</a>) <em>all three parts</em> you are interested in, and after checking the capture group #1 value, decide what to return:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    s := \"anything/anything/somestring\"\n    r := regexp.MustCompile(`^[^/]+/[^/]+/(.*)`)\n    val := r.FindStringSubmatch(s)\n    // fmt.Println(val[1]) // -&gt; somestring\n    if len(val) &gt; 1 &amp;&amp; val[1] != \"somestring\" { // val has more than 1 element and is not equal to somestring?\n        fmt.Println(val[1])      // Use val[1]\n    } else {\n        fmt.Println(\"No match\")  // Else, report no match\n    }\n}\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/3vlJ5zq6l7\" rel=\"nofollow noreferrer\">Go demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 3223712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cTBck.jpg?s=128&g=1", "display_name": "Noteworthy", "link": "https://stackoverflow.com/users/3223712/noteworthy"}, "is_accepted": false, "score": 0, "last_activity_date": 1605263182, "creation_date": 1605263182, "answer_id": 64819264, "question_id": 42515407, "link": "https://stackoverflow.com/questions/42515407/is-there-a-way-to-match-everything-except-a-constant-string-using-go-regexp/64819264#64819264", "title": "Is there a way to match everything except a constant string using Go.Regexp?", "body": "<p>There is <a href=\"https://github.com/dlclark/regexp2\" rel=\"nofollow noreferrer\">regexp2</a> which implement a feature-rich RegExp engine for Go,  it doesn't have constant time guarantees like the built-in <code>regexp</code> package, but it allows backtracking. You can use then something like <code>(?!somestring)</code> to solve your problem.</p>\n"}], "owner": {"reputation": 1529, "user_id": 4710204, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6cf5731a9767744d9fa0dc6e3f891175?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan", "link": "https://stackoverflow.com/users/4710204/ryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9535, "favorite_count": 0, "accepted_answer_id": 42551653, "answer_count": 3, "score": 6, "last_activity_date": 1605263182, "creation_date": 1488303737, "last_edit_date": 1495539967, "question_id": 42515407, "link": "https://stackoverflow.com/questions/42515407/is-there-a-way-to-match-everything-except-a-constant-string-using-go-regexp", "title": "Is there a way to match everything except a constant string using Go.Regexp?", "body": "<p>I have found many similar <a href=\"https://stackoverflow.com/questions/22251490/regex-that-matches-everything-except-a-constant\">questions</a> that do not work with the <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"noreferrer\">Go regex syntax</a>.</p>\n\n<p>The string that I am attempting to match against is in the form of <code>anything/anything/somestring</code>. With the pattern <code>\\/.*\\/.*\\/(.*)</code>, I will match <code>somestring</code>, but I am trying to match anything except strings that contain <code>somestring</code>.</p>\n\n<p>Most answers propose using something like <code>\\/.*\\/.*\\/((?!somestring).*)</code>, however in golang regexp I get: <code>? The preceding token is not quantifiable</code>.</p>\n\n<p>For clarification: <code>/test/test/MATCH</code> would produce a match while <code>/test/test/somestring</code> would not. Is this possible with the (limited) Go regex syntax?</p>\n"}, {"tags": ["go", "dao"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7636981, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EtOgJexVQIs/AAAAAAAAAAI/AAAAAAAAD6s/x3nYZ7HPUas/photo.jpg?sz=128", "display_name": "Alejandro Arnaud", "link": "https://stackoverflow.com/users/7636981/alejandro-arnaud"}, "edited": false, "score": 0, "creation_date": 1489630122, "post_id": 42515712, "comment_id": 72759400, "body": "How would this technique affect the performance of different databases? and thanks."}], "tags": [], "owner": {"reputation": 1762, "user_id": 5120331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YhTAB.png?s=128&g=1", "display_name": "Corvus Crypto", "link": "https://stackoverflow.com/users/5120331/corvus-crypto"}, "is_accepted": false, "score": 0, "last_activity_date": 1488304751, "creation_date": 1488304751, "answer_id": 42515712, "question_id": 42515149, "link": "https://stackoverflow.com/questions/42515149/working-with-multiple-databases-dao-pattern/42515712#42515712", "title": "Working with multiple databases (DAO Pattern)", "body": "<p>Cases like this your best bet is to use a universal identifier (UID) There are many ways to do this, though my personal favorite is just UUID v4. You can read the full UUID spec here <a href=\"https://tools.ietf.org/html/rfc4122\" rel=\"nofollow noreferrer\">https://tools.ietf.org/html/rfc4122</a>.</p>\n\n<p>Just configure your SQL tables and code to ensure uniqueness with this identifier and you can easily do lookups between databases using whichever access pattern you wish to implement.</p>\n\n<p>e.g.</p>\n\n<pre><code>SQL\n\nID(Primary Key) | UID (unique)\n         0      |   xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n\nMONGO\n\n{\n  _id: ObjectID(),\n  uid: \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n</code></pre>\n\n<p>now just lookup on uid only and you can be database agnostic at the higher level.</p>\n"}], "owner": {"reputation": 1, "user_id": 7636981, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EtOgJexVQIs/AAAAAAAAAAI/AAAAAAAAD6s/x3nYZ7HPUas/photo.jpg?sz=128", "display_name": "Alejandro Arnaud", "link": "https://stackoverflow.com/users/7636981/alejandro-arnaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488304751, "creation_date": 1488302838, "question_id": 42515149, "link": "https://stackoverflow.com/questions/42515149/working-with-multiple-databases-dao-pattern", "title": "Working with multiple databases (DAO Pattern)", "body": "<p>I am creating a project which should be able to use different databases for the persistence of data. I have implemented a DAO pattern, but I have a problem when working with the ID in the struct, since for example MongoDB uses BSON whereas SQL databases use uint.</p>\n\n<p>What solution do you recommend to implement the ID field in the struct.</p>\n\n<p>What I can think of is to create an ID object that contains fields for BSON and uint IDs with GetBSON, GetUint methods and a GetID method that encodes either BSON or uint to MD5 (or some other encoding) I would use the GetBSON and GetUint methods to work with the Databases and the GetID method to work on the application as well as to send it through the REST API.</p>\n"}, {"tags": ["image", "go", "colors", "image-manipulation"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488298907, "post_id": 42513797, "comment_id": 72164940, "body": "There is no guarantee that the implementation of <code>image.Image</code> you get back from <code>jpeg.Decode()</code> has a <code>Set()</code> method. See this answer for workarounds and alternatives: <a href=\"http://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-go-lang-image/36577076#36577076\">Change color of a single pixel - Go lang image</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488299495, "post_id": 42513797, "comment_id": 72165335, "body": "The errors are pretty self explanatory. If not: Take the tour of Go once more."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488299620, "post_id": 42513797, "comment_id": 72165413, "body": "I&#39;ve made a number of changes, the error I get now is - panic: interface conversion: *image.YCbCr is not main.ImageSet: missing method Set"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488299918, "post_id": 42513797, "comment_id": 72165641, "body": "To correct the compile time errors in your code: use short variable declaration: <code>imgSet := img.(ImageSet)</code>, and pass an additional argument to <code>jpeg.Encode()</code> like: <code>err = jpeg.Encode(fd, img, nil)</code>. But even after that it won&#39;t work, for reasoning see my linked answer."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488301288, "post_id": 42513797, "comment_id": 72166446, "body": "I&#39;m looking at your other answer and trying to understand it now - should I ask questions relating to it on this question or the one with your answer on?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488301802, "post_id": 42513797, "comment_id": 72166788, "body": "Actually your question is a duplicate of the other, and should be closed. So I guess ask in the other if it&#39;s related to the answer. Or post a new question if you encountered new problems while trying to use ideas from it."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488301868, "post_id": 42513797, "comment_id": 72166833, "body": "Okay will do, thanks"}], "owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "closed_date": 1488302042, "answer_count": 0, "score": 0, "last_activity_date": 1488299749, "creation_date": 1488298726, "last_edit_date": 1488299749, "question_id": 42513797, "link": "https://stackoverflow.com/questions/42513797/program-to-convert-rgba-to-grayscale-golang", "closed_reason": "Duplicate", "title": "Program to convert RGBA to grayscale Golang", "body": "<p>I'm currently working on writing a program to convert an RGBA image to grayscale. I know there are much simpler ways of doing this however I'm trying to do it this way do to this method being more suitable for the work I'm doing in the future.</p>\n\n<p>I'm trying to step through each pixel one by one using two for loops. Then convert the RGBA value of the pixel to gray and then save the new image.</p>\n\n<p>Below is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"image/color\"\n    \"image/jpeg\"\n    \"log\"\n    \"os\"\n)\n\ntype ImageSet interface {\n    Set(x, y int, c color.Color)\n}\n\nfunc main() {\n    file, err := os.Open(\"biden.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    img, err := jpeg.Decode(file)\n    if err != nil {\n        log.Fatal(os.Stderr, \"%s: %v\\n\", \"biden.jpg\", err)\n    }\n\n    b := img.Bounds()\n\n  imgSet = img.(ImageSet)\n    for y := b.Min.Y; y &lt; b.Max.Y; y++ {\n        for x := b.Min.X; x &lt; b.Max.X; x++ {\n            oldPixel := img.At(x, y)\n            r, g, b, a := oldPixel.RGBA()\n            //fmt.Println(r, g, b, a)\n            r = (r+g+b)/3\n        //  g = (r+g+b)/3\n            //b = (r+g+b)/3\n            pixel := color.RGBA{uint8(r), uint8(r), uint8(r), uint8(a)}\n            imgSet.Set(x, y, pixel)\n        }\n    }\n\n    fd, err := os.Create(\"gray.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = jpeg.Encode(fd, img)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = fd.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p>I get the following errors when trying to run this code.</p>\n\n<pre><code>   # command-line-arguments\n.\\rgbtogray.go:28: undefined: imgSet\n.\\rgbtogray.go:38: undefined: imgSet in imgSet.Set\n.\\rgbtogray.go:47: not enough arguments in call to jpeg.Encode\n    have (*os.File, image.Image)\n    want (io.Writer, image.Image, *jpeg.Options)\n[Finished in 4.002s]\n</code></pre>\n\n<p>Can anyone see where these errors are coming from and why the code does not work?</p>\n\n<p>Edit:</p>\n\n<p>Made a couple of changes - </p>\n\n<pre><code>    package main\n\nimport (\n    \"image/color\"\n    \"image/jpeg\"\n  \"image/png\"\n    \"log\"\n    \"os\"\n)\n\ntype ImageSet interface {\n    Set(x, y int, c color.Color)\n}\n\nfunc main() {\n    file, err := os.Open(\"biden.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    img, err := jpeg.Decode(file)\n    if err != nil {\n        log.Fatal(os.Stderr, \"%s: %v\\n\", \"biden.jpg\", err)\n    }\n\n    b := img.Bounds()\n\n    imgSet := img.(ImageSet)\n    for y := b.Min.Y; y &lt; b.Max.Y; y++ {\n        for x := b.Min.X; x &lt; b.Max.X; x++ {\n      oldPixel := img.At(x, y)\n           r, g, b, a := oldPixel.RGBA()\n           //fmt.Println(r, g, b, a)\n           g = (r+g+b)/3\n           pixel := color.RGBA{uint8(g), uint8(g), uint8(g), uint8(a)}\n           imgSet.Set(x, y, pixel)\n        }\n    }\n\n    fd, err := os.Create(\"gray.jpg\")\n  defer fd.Close()\n    png.Encode(fd, img)\n\n}\n</code></pre>\n\n<p>The error I now get is - </p>\n\n<pre><code> panic: interface conversion: *image.YCbCr is not main.ImageSet: missing method Set\n</code></pre>\n\n<p>I know using png.Encode at the bottom is strange but this is how someone I know fixed their issues.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "edited": false, "score": 0, "creation_date": 1488298291, "post_id": 42513387, "comment_id": 72164527, "body": "Thank you for the quick response its much appreciated I&#39;m trying to implement you&#39;re structure at the minute but can seem to initialize the structs with data. As for the suggestion I agree you&#39;re way is better and more efficient I will be using an array instead."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "edited": false, "score": 0, "creation_date": 1488298728, "post_id": 42513387, "comment_id": 72164826, "body": "@coder-noob I have updated the answer with additional information, and a correction to the <code>Courses</code> type."}, {"owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "edited": false, "score": 0, "creation_date": 1488299665, "post_id": 42513387, "comment_id": 72165456, "body": "Thank you for you&#39;re help i will go implement this now."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1488298694, "last_edit_date": 1488298694, "creation_date": 1488297545, "answer_id": 42513387, "question_id": 42513223, "link": "https://stackoverflow.com/questions/42513223/object-within-an-object-within-an-object-golang/42513387#42513387", "title": "Object within an Object within an Object Golang", "body": "<p>Your described structure, as I understand it, can be represented in Go as follows:</p>\n\n<pre><code>type Hole struct {\n    // Whatever you want here\n}\n\ntype Course struct {\n    Hole1 Hole `json:\"hole 1\"`\n    Hole2 Hole `json:\"hole 2\"`\n    // ...\n    Hole18 Hole `json:\"hole 18\"`\n}\n\ntype Courses struct {\n    //  Date       CourseName\n    map[string]map[string]Course\n}\n</code></pre>\n\n<p>I would suggest, however, using an 18-element array for your holes, but that's up to you:</p>\n\n<pre><code>type Course struct {\n    Holes [18]Hole\n}\n</code></pre>\n\n<p>Then you can instantiate one of these trees as (using a <code>[18]Hole</code> array; adjust accordingly if you use a different implementation):</p>\n\n<pre><code>courses := Courses{\n    map[string]map[string]Course{\n        \"2017-01-01\": map[string]Course{\n            \"Bob's Course\": Course{\n                [18]Hole{\n                    Hole{\n                      // Hole 1\n                    },\n                    Hole{\n                      // Hole 2\n                    },\n                    // ..\n                },\n            },\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 42513387, "answer_count": 1, "score": 0, "last_activity_date": 1488298694, "creation_date": 1488297107, "question_id": 42513223, "link": "https://stackoverflow.com/questions/42513223/object-within-an-object-within-an-object-golang", "title": "Object within an Object within an Object Golang", "body": "<p>I'm attempting to create nested objects in mongoDB with no luck the format I am trying to achieve is as follows </p>\n\n<pre><code> \"Courses\":{\n    \"Date\":{\n      \"CourseName\"  :{\n                \"hole 1\"{\n\n                }\n                \"hole 2\"{\n\n                }\n                ...so on until 18 \n               }//coursename\n             }//date \n          }//courses\n</code></pre>\n\n<p>I've tried and succeeded with getting the date object within course by doing the following:</p>\n\n<pre><code>u := req.FormValue(\"username\")\nco := req.FormValue(\"course\")\nd := req.FormValue(\"date\")\n\nng := nGame{Username: u, Course: co, Dates: d}\ncn := courseName{CName: co}\nquery := bson.M{\"username\": u}\nupdate := bson.M{\"$push\": bson.M{\"Course\": bson.M{ng.Dates: cn}}}  \nerr = c.Update(query, update)\n</code></pre>\n\n<p>The date object has the course name inside it what i'm trying to do is make course name another object which then I can insert the hole object. </p>\n\n<p>The Structs i'm using are as follows: </p>\n\n<pre><code>type (\nnGame struct {\n    Username string\n    Course   string\n    Location string\n    Dates    string\n}\n)\ntype (\ncourseName struct {\n    CName string\n}\n)\n</code></pre>\n"}, {"tags": ["go", "multilingual", "revel"], "comments": [{"owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "edited": false, "score": 0, "creation_date": 1488296015, "post_id": 42512345, "comment_id": 72162782, "body": "It does not. You probably have to hack together your own router for this. But I should ask, why? This seems like it&#39;d complicate your application unneccessarily and no modern web app I know does this."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "edited": false, "score": 0, "creation_date": 1488297136, "post_id": 42512345, "comment_id": 72163645, "body": "I agree with @Gant. You should not do this. APIs are for computers to read. You should make the content multi-lingual, not the API routes."}, {"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1488301809, "post_id": 42512345, "comment_id": 72166792, "body": "Thank you guys. I give up on this approach. Stupid clients!"}], "owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488297070, "creation_date": 1488294671, "last_edit_date": 1488297070, "question_id": 42512345, "link": "https://stackoverflow.com/questions/42512345/how-to-set-up-routes-in-different-languages-in-golang-revel-framework", "title": "How to set up routes in different languages in golang Revel framework?", "body": "<p>in Node.js you can do something like <code>app.get(\"/:someroute(sign-in|anmelden)\")</code> and you got yourself routes in different languages.</p>\n\n<p>Can you do same in Golang Revel? Have routes defined like that with regex?\nor some other way of supporting routes in different languages without having code redundancies? </p>\n\n<pre><code>GET     /login                                  App.Login\nGET     /anmelden                               App.Login\n</code></pre>\n\n<p>this two to be actually one route?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1488294846, "post_id": 42512293, "comment_id": 72161919, "body": "See <a href=\"http://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a>"}, {"owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "edited": false, "score": 0, "creation_date": 1488296159, "post_id": 42512293, "comment_id": 72162892, "body": "The answer is most certainly buffered channels. If you haven&#39;t gone through it, the go tour explains go concurrency primitives quite well. <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/2</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 2, "last_activity_date": 1488655304, "creation_date": 1488655304, "answer_id": 42600281, "question_id": 42512293, "link": "https://stackoverflow.com/questions/42512293/how-to-send-of-go-routines-in-a-worker-pool/42600281#42600281", "title": "How to send of GO routines in a worker pool", "body": "<p>Here you have a generic pattern for implementing concurrent image processors giving control to the caller over the image partitioning to split the work in n parts and over the concurrency level of the execution (i.e. the number of worker goroutines used for executing the (possibly different) number of processing jobs).</p>\n\n<p>See the <code>pprocess</code> func which implements the whole pattern taking a <code>Partitioner</code> and a <code>Processor</code>, the former being a func that takes the job of returning n image partitions to operate on, and the latter being a func which will be used for processing each partition.</p>\n\n<p>I implemented the vertical splitting you expressed in your code example in the func <code>splitVert</code> which returns a function which can split an image in n vertical sections.</p>\n\n<p>For doing some actual work I implemented the <code>gray</code> func which is a <code>Processor</code> that transform pixel colors to gray levels (luminance).</p>\n\n<p>Here's the working code:</p>\n\n<pre><code>type MutableImage interface {\n    image.Image\n    Set(x, y int, c color.Color)\n}\n\ntype Processor func(MutableImage, image.Rectangle)\n\ntype Partitioner func(image.Image) []image.Rectangle\n\nfunc pprocess(i image.Image, concurrency int, part Partitioner, proc Processor) image.Image {\n    m := image.NewRGBA(i.Bounds())\n    draw.Draw(m, i.Bounds(), i, i.Bounds().Min, draw.Src)\n    var wg sync.WaitGroup\n    c := make(chan image.Rectangle, concurrency*2)\n    for n := 0; n &lt; concurrency; n++ {\n        wg.Add(1)\n        go func() {\n            for r := range c {\n                proc(m, r)\n            }\n            wg.Done()\n        }()\n    }\n    for _, p := range part(i) {\n        c &lt;- p\n    }\n    close(c)\n    wg.Wait()\n    return m\n}\n\nfunc gray(i MutableImage, r image.Rectangle) {\n    for x := r.Min.X; x &lt;= r.Max.X; x++ {\n        for y := r.Min.Y; y &lt;= r.Max.Y; y++ {\n            c := i.At(x, y)\n            r, g, b, _ := c.RGBA()\n            l := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\n            i.Set(x, y, color.Gray{uint8(l / 256)})\n        }\n    }\n}\n\nfunc splitVert(c int) Partitioner {\n    return func(i image.Image) []image.Rectangle {\n        b := i.Bounds()\n        s := float64(b.Dy()) / float64(c)\n        rs := make([]image.Rectangle, c)\n        for n := 0; n &lt; c; n++ {\n            m := float64(n)\n            x0 := b.Min.X\n            y0 := b.Min.Y + int(0.5+m*s)\n            x1 := b.Max.X\n            y1 := b.Min.Y + int(0.5+(m+1)*s)\n            if n &lt; c-1 {\n                y1--\n            }\n            rs[n] = image.Rect(x0, y0, x1, y1)\n        }\n        return rs\n    }\n}\n\nfunc main() {\n    i, err := jpeg.Decode(os.Stdin)\n    if err != nil {\n        log.Fatalf(\"decoding image: %v\", err)\n    }\n    o := pprocess(i, runtime.NumCPU(), splitVert(8), gray)\n    err = jpeg.Encode(os.Stdout, o, nil)\n    if err != nil {\n        log.Fatalf(\"encoding image: %v\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 4368004, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/333c847aad425113e386336dcf420c83?s=128&d=identicon&r=PG&f=1", "display_name": "CS456", "link": "https://stackoverflow.com/users/4368004/cs456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488655304, "creation_date": 1488294541, "question_id": 42512293, "link": "https://stackoverflow.com/questions/42512293/how-to-send-of-go-routines-in-a-worker-pool", "title": "How to send of GO routines in a worker pool", "body": "<p>im writing an algorithm to break down an image into segments and manipulate it, however the way im currently using Go routines isn't quite optimal. </p>\n\n<p>I'd like to split it into a worker pool, firing off routines and having each worker take a new job until the image is completed. </p>\n\n<p>I have it split into 8 as such: </p>\n\n<pre><code>var bounds = img.Bounds()\n            var halfHeight = bounds.Max.Y / 2\n            var eighthOne = halfHeight / 4\n            var eighthTwo = eighthOne + eighthOne\n            var eighthThree = eighthOne + eighthTwo\n            var eighthFive = halfHeight + eighthOne\n            var eighthSix = halfHeight + eighthTwo\n            var eighthSeven = halfHeight + eighthThree\n\n            elapsed := time.Now()\n            go Threshold(pic, c2, 0, eighthOne)\n            go Threshold(pic, c5, eighthOne, eighthTwo)\n            go Threshold(pic, c6, eighthTwo, eighthThree)\n            go Threshold(pic, c7, eighthThree, halfHeight)\n            go Threshold(pic, c8, halfHeight, eighthFive)\n            go Threshold(pic, c9, eighthFive, eighthSix)\n            go Threshold(pic, c10, eighthSix, eighthSeven)\n            go Threshold(pic, c11, eighthSeven, bounds.Max.Y)\n</code></pre>\n\n<p>From which i then fire off Go routines one after another, how can i optimise this into a worker system? </p>\n\n<p>Thanks </p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 10538, "user_id": 547291, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f8103125d18da197ca654c5eed34bfcf?s=128&d=identicon&r=PG", "display_name": "Bjorn Roche", "link": "https://stackoverflow.com/users/547291/bjorn-roche"}, "edited": false, "score": 0, "creation_date": 1488294459, "post_id": 42512019, "comment_id": 72161613, "body": "This answer is a little better than mine, I think. In my playground I do a slightly more complex conversions to get an int, whereas converting to interface is, I think the right way to do it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10538, "user_id": 547291, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f8103125d18da197ca654c5eed34bfcf?s=128&d=identicon&r=PG", "display_name": "Bjorn Roche", "link": "https://stackoverflow.com/users/547291/bjorn-roche"}, "edited": false, "score": 1, "creation_date": 1488294593, "post_id": 42512019, "comment_id": 72161710, "body": "@BjornRoche If you plan to use the number, <code>Value.Int()</code> might be a better choice (as it handles more types while a type assertion only one), but for comparison I would avoid it, as it always returns the result as a value of type <code>int64</code>, even though the value wrapped in <code>Value</code> is of type <code>int</code>. And handing it over for comparison will implicitly pack it back to an <code>interface{}</code>, so no point..."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1488294662, "last_edit_date": 1488294662, "creation_date": 1488293811, "answer_id": 42512019, "question_id": 42511940, "link": "https://stackoverflow.com/questions/42511940/golang-deepequal-and-reflect-zero/42512019#42512019", "title": "golang DeepEqual and reflect.Zero", "body": "<p>Here:</p>\n\n<pre><code>reflect.DeepEqual(field.Interface(), reflect.Zero(field.Type()))\n</code></pre>\n\n<p>You are comparing an <code>int</code> value (wrapped in <code>interface{}</code>), to a value of type <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>. <a href=\"https://golang.org/pkg/reflect/#Zero\" rel=\"nofollow noreferrer\"><code>reflect.Zero()</code></a> returns a value of type <code>reflect.Value</code>, not <code>interface{}</code>.</p>\n\n<p>You forgot to call <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> on the 2nd argument:</p>\n\n<pre><code>reflect.DeepEqual(field.Interface(), reflect.Zero(field.Type()).Interface())\n</code></pre>\n\n<p>This prints <code>true</code>. Try it on the <a href=\"https://play.golang.org/p/fOYrAxsI1m\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 10538, "user_id": 547291, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f8103125d18da197ca654c5eed34bfcf?s=128&d=identicon&r=PG", "display_name": "Bjorn Roche", "link": "https://stackoverflow.com/users/547291/bjorn-roche"}, "is_accepted": false, "score": 1, "last_activity_date": 1488294356, "creation_date": 1488294356, "answer_id": 42512229, "question_id": 42511940, "link": "https://stackoverflow.com/questions/42511940/golang-deepequal-and-reflect-zero/42512229#42512229", "title": "golang DeepEqual and reflect.Zero", "body": "<p>The issue has to do with your use of the reflect package.</p>\n\n<pre><code>field.Interface()\n</code></pre>\n\n<p>Returns an int (wrapped in an <code>interface{}</code>), while</p>\n\n<pre><code>reflect.Zero(field.Type())\n</code></pre>\n\n<p>returns an object of type reflect.Value. fmt.Println prints them both out the same way, but that doesn't mean they are the same type.</p>\n\n<p>See this playground: <a href=\"https://play.golang.org/p/mLcLSV_0vA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mLcLSV_0vA</a></p>\n"}], "owner": {"reputation": 65, "user_id": 7636062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b462c3a7ef691579d6a666b0763780dc?s=128&d=identicon&r=PG&f=1", "display_name": "jaimelescornichons", "link": "https://stackoverflow.com/users/7636062/jaimelescornichons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1484, "favorite_count": 0, "accepted_answer_id": 42512019, "answer_count": 2, "score": 2, "last_activity_date": 1488294662, "creation_date": 1488293642, "last_edit_date": 1488294037, "question_id": 42511940, "link": "https://stackoverflow.com/questions/42511940/golang-deepequal-and-reflect-zero", "title": "golang DeepEqual and reflect.Zero", "body": "<p>I'm trying to check if a field in a struct is set to its zero value with <code>reflect.DeepEqual</code>. The idea is that if it is the case, I can change its value with a default one given as a struct tag like following :</p>\n\n<pre><code>type struct {\n    A int `default:\"42\"`\n}\n</code></pre>\n\n<p>My problem is the following : It looks like <code>reflect.DeepEqual</code> is always returning me <code>false</code>. I think I'm missing something. Here is a simple example of what I'm trying to do:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    s := struct{ A int }{0}\n    field := reflect.ValueOf(s).Field(0)\n\n    fmt.Println(field.Interface())\n    fmt.Println(reflect.Zero(field.Type()))\n\n    fmt.Println(reflect.DeepEqual(field.Interface(), reflect.Zero(field.Type())))\n}\n</code></pre>\n\n<p>And here is a go playground version of the code above : <a href=\"https://play.golang.org/p/k9VY-2Dc69\" rel=\"nofollow noreferrer\">https://play.golang.org/p/k9VY-2Dc69</a></p>\n\n<p>I would like to know why <code>DeepEqual</code> is returning <code>false</code> in this case.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "makefile", "continuous-integration"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 10, "last_activity_date": 1600950297, "last_edit_date": 1600950297, "creation_date": 1488289058, "answer_id": 42510278, "question_id": 42510140, "link": "https://stackoverflow.com/questions/42510140/check-format-for-continous-integration/42510278#42510278", "title": "Check format for Continous integration", "body": "<p>These days, I use <a href=\"https://github.com/golangci/golangci-lint\" rel=\"nofollow noreferrer\">golangci-lint</a>, which includes <code>gofmt</code> checking as an option.</p>\n<p>But if for some reason you want to do this yourself, the command I previously used for precisely that purpose is:</p>\n<pre><code>diff -u &lt;(echo -n) &lt;(gofmt -d ./)\n</code></pre>\n<p>See, for example, the <a href=\"https://github.com/flimzy/go-pouchdb/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">.travis.yml</a> files on one of my projects.</p>\n"}], "owner": {"reputation": 2437, "user_id": 4102515, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31b3a2bfa392f631bc24a7c1dce899b9?s=128&d=identicon&r=PG", "display_name": "snorberhuis", "link": "https://stackoverflow.com/users/4102515/snorberhuis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1964, "favorite_count": 1, "accepted_answer_id": 42510278, "answer_count": 1, "score": 6, "last_activity_date": 1600950297, "creation_date": 1488288635, "last_edit_date": 1569599196, "question_id": 42510140, "link": "https://stackoverflow.com/questions/42510140/check-format-for-continous-integration", "title": "Check format for Continous integration", "body": "<p>I am trying to write a Makefile command that will output an error if the Go code is not correctly formatted. This is for a CI step. I am struggling with how to get it working in the make file. This solution works on the bash command line:</p>\n\n<pre><code>! gofmt -l . 2&gt;&amp;1 | read\n</code></pre>\n\n<p>But copying this into the Makefile:</p>\n\n<pre><code>ci-format:\n    @echo \"$(OK_COLOR)==&gt; Checking formatting$(NO_COLOR)\"\n    @go fmt ./...\n    @! gofmt -l . 2&gt;&amp;1 | read\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>/bin/sh: 1: read: arg count\n</code></pre>\n"}, {"tags": ["performance", "go", "google-bigquery", "google-cloud-storage"], "answers": [{"comments": [{"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "edited": false, "score": 0, "creation_date": 1488293853, "post_id": 42510787, "comment_id": 72161153, "body": "You are correct, when I run it by the cli tool the Duration is much, much shorter than what I calculated so I expect it to be connected to the wait() call or similar."}], "tags": [], "owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "is_accepted": true, "score": 3, "last_activity_date": 1488290495, "creation_date": 1488290495, "answer_id": 42510787, "question_id": 42509768, "link": "https://stackoverflow.com/questions/42509768/bigquery-go-export-job-much-slower-than-webgui/42510787#42510787", "title": "Bigquery.go export job much slower than WebGUI", "body": "<p>The WEB UI usually has a polling mechanism to check when a job has finished, so you might see longer times. Usually the files exported to GCS appear sooner than the job actually finishes in the WebUI.</p>\n\n<p>To make sure and see exact timing, please use the <code>cli tool</code> to obtain the most recent jobs:</p>\n\n<pre><code>bq  ls -j -a --max_results=15\n</code></pre>\n\n<p>running this would display a table with job ids and the respective timing.</p>\n\n<pre><code>               jobId                Job Type    State      Start Time      Duration\n --------------------------------- ---------- --------- ----------------- ----------\n  bquijob_1864e679_15a84d8878a      query      SUCCESS   28 Feb 07:11:06   0:00:04\n  bquijob_770b512_15a84d8122c       query      FAILURE   28 Feb 07:10:35   0:00:00\n  bquijob_de0df03_15a84d6a4fa       query      FAILURE   28 Feb 07:09:02   0:00:00\n  bquijob_52c4f7d7_15a84d660e6      query      FAILURE   28 Feb 07:08:44   0:00:00\n  bquijob_76a2c1be_15a84d5e769      query      FAILURE   28 Feb 07:08:13   0:00:00\n  bquijob_7f51dde5_15a84d55afb      query      SUCCESS   28 Feb 07:07:41   0:00:08\n  bquijob_34f25864_15a84d50503      query      SUCCESS   28 Feb 07:07:18   0:00:08\n  job_Ca0cuRTAjY7MEHAs7vTJMxtVYTs   query      SUCCESS   28 Feb 07:00:47   0:00:09\n  job_hHfmcdwyBsPsYF5dDvvOdR1Rmd0   load       SUCCESS   28 Feb 07:00:26   0:00:20\n  job_mkiLf_mFHLKSplGJOtg-XDKzvv4   load       SUCCESS   28 Feb 02:52:50   0:00:02\n  job_3RsPvttxWwv3SzVoOI9Cv_2yWtA   query      SUCCESS   27 Feb 21:18:40   0:00:08\n  job_JLsqJO0NEIlKNac6jkDWbwneGMg   extract    SUCCESS   27 Feb 11:35:04   0:00:17\n  job_KOS7vKX4aX0FNbK6dibE7cxzcQA   query      SUCCESS   27 Feb 11:33:44   0:00:37\n  bquijob_44046bec_15a802f703a      query      SUCCESS   27 Feb 09:27:48   0:00:07\n  job_2qQ6YSWeXaP2y2doONQJsIoga3c   query      SUCCESS   27 Feb 08:53:20   0:00:06\n</code></pre>\n\n<p>You would be able this way to check the extract job DURATION. In case you validate indeed it's a problem, please post such a table back in your question as sooner/later a Google engineer will check it. But without proper details, we can just assume your measurement is wrong.</p>\n"}], "owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 42510787, "answer_count": 1, "score": 1, "last_activity_date": 1488290495, "creation_date": 1488287748, "question_id": 42509768, "link": "https://stackoverflow.com/questions/42509768/bigquery-go-export-job-much-slower-than-webgui", "title": "Bigquery.go export job much slower than WebGUI", "body": "<p>I'm using the bigquery.go library.</p>\n\n<p>While investigating some of the performance I have found that my export (.csv to GCS) job (and export job only) started from the client takes about 60seconds on average while the same job started from the WebGUI takes about 20seconds. What could be the reason for this?</p>\n\n<p>The code is the following:</p>\n\n<pre><code>time1 := time.Now()\njob_extract, err := extractor.Run(ctx)\nif err != nil {\n    return err\n}\n\nstatus, err = job_extract.Wait(ctx)\nif err != nil {\n    return err\n}\n\nif status.Err() != nil {\n    log.Fatalf(\"Job failed with error %v\", status.Err())\n    return status.Err()\n}\n\ntime2 := time.Since(time1)\n</code></pre>\n"}, {"tags": ["python", "sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1488283402, "post_id": 42508074, "comment_id": 72153857, "body": "Why are you ignoring connection errors if your goal is to detect connection errors?"}, {"owner": {"reputation": 809, "user_id": 2031060, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/74b9198b642d443dcfa94112a3777a90?s=128&d=identicon&r=PG", "display_name": "darthvading", "link": "https://stackoverflow.com/users/2031060/darthvading"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488283595, "post_id": 42508074, "comment_id": 72153964, "body": "I am not actually ignoring the connection errors, but that part isn&#39;t significant to the question I am having, is it? That was the reason, I didn&#39;t mention or handle that part. Anyways, do you think you have some solution to the problem I have?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1488284232, "post_id": 42508074, "comment_id": 72154373, "body": "No, I don&#39;t have a solution. Your question still doesn&#39;t make sense to me.  I guess you expect that in the milliseconds between <code>net.Dial</code>, and <code>conn.Read</code>, that the remote machine has been turned off?"}, {"owner": {"reputation": 809, "user_id": 2031060, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/74b9198b642d443dcfa94112a3777a90?s=128&d=identicon&r=PG", "display_name": "darthvading", "link": "https://stackoverflow.com/users/2031060/darthvading"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488284481, "post_id": 42508074, "comment_id": 72154541, "body": "No, I want to get some trigger in my code when the remote machine is powered off after a successful &#39;established&#39; connection, of course after conn.Read(). I can get the same if the python script is killed, which will internally trigger a signal to close the connection explicitly, which doesn&#39;t happen in real time I guess, where things might just go off all of a sudden. I apologise if I couldn&#39;t make this apparent in the question itself."}, {"owner": {"reputation": 809, "user_id": 2031060, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/74b9198b642d443dcfa94112a3777a90?s=128&d=identicon&r=PG", "display_name": "darthvading", "link": "https://stackoverflow.com/users/2031060/darthvading"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488284570, "post_id": 42508074, "comment_id": 72154599, "body": "To guys downvoting the question, can I expect the reason for that?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488284735, "post_id": 42508074, "comment_id": 72154725, "body": "Because your question is poorly worded and confusing"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488284793, "post_id": 42508074, "comment_id": 72154758, "body": "Also note that TCP is a terrible way to test whether the remote machine is powered off. An ICMP or possibly UDP packet would be better suited for this task."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488289967, "post_id": 42508604, "comment_id": 72158371, "body": "That article uses a <code>tcpkeepalive</code> package which has serious flaws. The std library provides the appropriate settings for most use cases."}], "tags": [], "owner": {"reputation": 105, "user_id": 7632514, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RlgrSx9rsMs/AAAAAAAAAAI/AAAAAAAAAYQ/Lptv3gq05_U/photo.jpg?sz=128", "display_name": "Leonel C&#226;mara", "link": "https://stackoverflow.com/users/7632514/leonel-c%c3%a2mara"}, "is_accepted": false, "score": 0, "last_activity_date": 1488284319, "creation_date": 1488284319, "answer_id": 42508604, "question_id": 42508074, "link": "https://stackoverflow.com/questions/42508074/how-to-know-if-the-remote-tcp-device-is-powered-off/42508604#42508604", "title": "How to know if the remote tcp device is powered off", "body": "<p>You need to add some kind of heartbeat message. Then, looking at GO documentation, you can use DialTimeout instead of Dial, each time you receive the heartbeat message or any other you can reset the timeout.  </p>\n\n<p>Another alternative is to use TCP keepalive. Which you can do in Python by using setsockopt, I can't really help you with GO but this link seems like a good description of how to enable keepalive with it: \n<a href=\"http://felixge.de/2014/08/26/tcp-keepalive-with-golang.html\" rel=\"nofollow noreferrer\">http://felixge.de/2014/08/26/tcp-keepalive-with-golang.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1488301843, "last_edit_date": 1488301843, "creation_date": 1488289797, "answer_id": 42510526, "question_id": 42508074, "link": "https://stackoverflow.com/questions/42508074/how-to-know-if-the-remote-tcp-device-is-powered-off/42510526#42510526", "title": "How to know if the remote tcp device is powered off", "body": "<p>There is no way to determine the difference between a host that is powered off and a connection that has been broken, so you treat them the same way. </p>\n\n<p>You can send a heartbeat message on your own, and close the connection when you reach some timeout period between heartbeat packets. The timeout can either be set manually by timing the packets, or you can use <a href=\"https://golang.org/pkg/net/#TCPConn.SetReadDeadline\" rel=\"nofollow noreferrer\"><code>SetReadDeadline</code></a> before each read to terminate the connection immediately when the deadline is reached. </p>\n\n<p>You can also use TCP Keepalive to do this for you, using <a href=\"https://golang.org/pkg/net/#TCPConn.SetKeepAlive\" rel=\"nofollow noreferrer\"><code>TCPConn.SetKeepAlive</code></a> to enable it and <a href=\"https://golang.org/pkg/net/#TCPConn.SetKeepAlivePeriod\" rel=\"nofollow noreferrer\"><code>TCPConn.SetKeepAlivePeriod</code></a> to set the interval between keepalive packets. The time it takes to actually close the connection will be system dependent.</p>\n\n<p>You should also set a timeout when dialing, since connecting to a down host isn't guaranteed to return an ICMP Host Unreachable response. You can use <a href=\"https://golang.org/pkg/net/#DialTimeout\" rel=\"nofollow noreferrer\"><code>DialTimeout</code></a>, a <a href=\"https://golang.org/pkg/net/#Dialer\" rel=\"nofollow noreferrer\"><code>net.Dialer</code></a> with the <code>Timeout</code> parameter set, or <a href=\"https://golang.org/pkg/net/#Dialer.DialContext\" rel=\"nofollow noreferrer\"><code>Dialer.DialContext</code></a>.</p>\n\n<p>Simply reading through the stdlib documentation should provide you with plenty of information: <a href=\"https://golang.org/pkg/net/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/</a></p>\n"}], "owner": {"reputation": 809, "user_id": 2031060, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/74b9198b642d443dcfa94112a3777a90?s=128&d=identicon&r=PG", "display_name": "darthvading", "link": "https://stackoverflow.com/users/2031060/darthvading"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1488301843, "creation_date": 1488282772, "last_edit_date": 1488283746, "question_id": 42508074, "link": "https://stackoverflow.com/questions/42508074/how-to-know-if-the-remote-tcp-device-is-powered-off", "title": "How to know if the remote tcp device is powered off", "body": "<p>In my GO code, I am establishing a TCP connection as below:</p>\n\n<pre><code>conn, err1 := net.Dial(\"tcp\", &lt;remote_address&gt;)\nif err1 == nil {\n    buf := make([]byte, 256)\n    text, err := conn.Read(buf[:])\n    if err == io.EOF {\n        //remote connection close handle\n        fmt.Println(\"connection got reset by peer\")\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>To simulate the other end, I am running a python script on a different computer, which opens a socket and sends some random data to the socket above lines of codes are listening to. Now my problem is, when I am killing this python code by pressing ctrl+C, the remote connection closed event is recognised finely by above code and I get a chance to handle that. </p>\n\n<p>However, if I simply turn off the remote computer (where the python script is running) my code doesn't get notified at all. </p>\n\n<p>In my case, the connection should always be opened and should be able to send the data randomly, and only if the remote machine gets powered off, my GO code should get notified.</p>\n\n<p>Can someone help me in this scenario, how would I get notification when the remote machine hosting the socket itself gets powered off? How would I get the trigger remotely in my GO code?</p>\n\n<p>PS - This seems to be a pretty common problem in real time, though not in the testing environment.</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488282990, "post_id": 42507958, "comment_id": 72153587, "body": "Roughly: The dot &#39;.&#39; is &quot;the current value. This might be a struct or something more complicated. If . is some struct, than .Name selects the name field of that struct. Without a dot you cold not handle primitive types like e.g. an int (what is the name of an int?). A pipeline is how a value flows through your code and functions. Pipeline <i>is</i> explained in the package doc. You may chain stuff together and this might modify what you stuff into the input of the pipeline."}, {"owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488283366, "post_id": 42507958, "comment_id": 72153828, "body": "@Volker So, by writing <code>{{template &quot;name&quot; . }}</code> I am binding this template to the current context?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488284764, "post_id": 42507958, "comment_id": 72154739, "body": "Well &quot;binding this template to the current context&quot; sound really strange. You execute the template with name &quot;name&quot; with the current value (the dot)."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 13, "last_activity_date": 1488284420, "last_edit_date": 1488284420, "creation_date": 1488283247, "answer_id": 42508255, "question_id": 42507958, "link": "https://stackoverflow.com/questions/42507958/golang-template-engine-pipelines/42508255#42508255", "title": "Golang template engine pipelines", "body": "<p>There are 2 <code>template</code> packages, <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\"><code>text/template</code></a> and <a href=\"https://golang.org/pkg/html/template/\" rel=\"noreferrer\"><code>html/template</code></a>.</p>\n\n<p>They have the same interface, but the <code>html/template</code> package is for generating HTML output safe against code injection, and should be used instead of <code>text/template</code> whenever the output is HTML.</p>\n\n<p>Since they have the same interface but the <code>html/template</code> provides some extra functionality (contextual escaping of the inserted data), the basics and principles are only documented at <code>text/html</code>, and the documentation of <code>html/template</code> mostly focuses on detailing the extra.</p>\n\n<p>That being said, \"pipeline\" belongs to the basics. It is documented in <code>text/template</code>, section <a href=\"https://golang.org/pkg/text/template/#hdr-Pipelines\" rel=\"noreferrer\">Pipelines</a>:</p>\n\n<blockquote>\n  <h3>Pipelines</h3>\n  \n  <p>A pipeline is a possibly chained sequence of \"commands\". A command is a simple value (argument) or a function or method call, possibly with multiple arguments:</p>\n\n<pre><code>Argument\n    The result is the value of evaluating the argument.\n.Method [Argument...]\n    The method can be alone or the last element of a chain but,\n    unlike methods in the middle of a chain, it can take arguments.\n    The result is the value of calling the method with the\n    arguments:\n        dot.Method(Argument1, etc.)\nfunctionName [Argument...]\n    The result is the value of calling the function associated\n    with the name:\n        function(Argument1, etc.)\n    Functions and function names are described below.\n</code></pre>\n  \n  <p>A pipeline may be \"chained\" by separating a sequence of commands with pipeline characters '|'. In a chained pipeline, the result of each command is passed as the last argument of the following command. The output of the final command in the pipeline is the value of the pipeline.</p>\n</blockquote>\n\n<p>\"Arguments\" and \"pipelines\" are evaluations of data.</p>\n\n<p>The \"dot\" <code>.</code> is basically a cursor, pointing to somewhere in the data structure you pass when executing the template. The starting value of the dot is the value you pass, but this dot is modified by many actions, such as <code>{{range}}</code> or <code>{{with}}</code>.</p>\n\n<blockquote>\n  <p>Execution of the template walks the structure and sets the cursor, represented by a period '.' and called \"dot\", to the value at the current location in the structure as execution proceeds.</p>\n</blockquote>\n\n<p>So when you write <code>.Name</code>, that means that the value where dot is pointing currently, you want to refer to its field or method or key called <code>Name</code>. For example if you pass a <code>struct</code>, at the beginning of your template <code>.Name</code> will denote the struct field <code>Name</code> if it exists, or its method named <code>Name()</code>.</p>\n\n<p>When you invoke / include another template, you have the possibility to tell what value you what to pass to its execution. When you write <code>{{template \"something\" .}}</code>, that means you want to pass the value currently pointed by dot to the template execution. If you want to pass only the <code>Name</code> field of the struct pointed by the dot, you may do it like <code>{{template \"something\" .Name}}</code>.</p>\n\n<p>The value you pass as the pipeline in <code>{{template}}</code> will become the dot inside the invoked other template.</p>\n\n<p>So as your template is being processed / rendered, the dot may be changed and point \"only\" to a part of the value originally passed to your template execution. Often it's handy or required to still reach the original value and not just the cursor. For this the template package provides the <code>$</code>:</p>\n\n<blockquote>\n  <p>When execution begins, $ is set to the data argument passed to Execute, that is, to the starting value of dot.</p>\n</blockquote>\n\n<p>So even if you're inside a <code>{{range}}</code> for example (which sets the dot to the successive elements of the array / slice / map you're ranging over), you can still reach out and refer to any other parts of the value passed to the template execution.</p>\n\n<p>So for example if you're ranging over a slice of books like <code>{{range .Books}}</code>, and if you need the <code>Name</code> field of the originally passed struct, you may do it inside <code>{{range}}</code> like this:</p>\n\n<pre><code>{{range .Books}}\n    Title: {{.Title}}\n    Original name: {{$.Name}}\n{{end}}\n</code></pre>\n"}], "owner": {"reputation": 1271, "user_id": 5554930, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/75ec5e8612e63e54af86d7a9a7ee1e44?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5554930/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5257, "favorite_count": 4, "accepted_answer_id": 42508255, "answer_count": 1, "score": 7, "last_activity_date": 1554155940, "creation_date": 1488282463, "last_edit_date": 1554155940, "question_id": 42507958, "link": "https://stackoverflow.com/questions/42507958/golang-template-engine-pipelines", "title": "Golang template engine pipelines", "body": "<p>I have a Golang template, defined like this</p>\n\n<pre><code>{{- define \"test\" -}}\n{{- printf \"%s\" .Name | trunc 24 -}}\n{{- end -}}\n</code></pre>\n\n<p>Then I use it in one of my files:</p>\n\n<pre><code>{{ template \"test\" . }}\n</code></pre>\n\n<p>What does the dot mean after \"test\"? Golang template docs say:</p>\n\n<pre><code>{{template \"name\" pipeline}}\nThe template with the specified name is executed with dot set\nto the value of the pipeline.\n</code></pre>\n\n<p>But I am not sure what pipeline is. Reading documentation gave no results, could anyone explain once again?</p>\n\n<p>Also, why do we have to start values beginning with dot? E.g. <code>{{ - printf \"%s\" .Name | trunc 24 -}}</code>. Is it also a kind of pipeline?</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["performance", "go", "hash"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282242, "post_id": 42507846, "comment_id": 72153066, "body": "Why not use Go benchmarks? <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#hdr-Benchmarks</a>"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282281, "post_id": 42507846, "comment_id": 72153090, "body": "@Grzegorz\u017bur simple because I was learning go for 1.5 days so far."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488282511, "post_id": 42507846, "comment_id": 72153259, "body": "Why are you using unsafe everywhere?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282532, "post_id": 42507846, "comment_id": 72153280, "body": "I would also advice using Go distribution 1.8 over gccgo. gccgo is behind."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1488282636, "post_id": 42507846, "comment_id": 72153358, "body": "All this unsafe.Pointer stuff is totally unnecessary. Write a function which takes 4 bytes and builds a uint32 from it and you&#39;r done."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282645, "post_id": 42507846, "comment_id": 72153369, "body": "It seem to be a good question for <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282696, "post_id": 42507846, "comment_id": 72153404, "body": "@Grzegorz\u017bur I used go 1.6.2, it is 3 times slower than gccgo (<code>go boud meiyan.go</code>), have they really improved that much in 1.8?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488282718, "post_id": 42507846, "comment_id": 72153422, "body": "The C const char* key and int count translates to slice of bytes in Go []byte."}], "answers": [{"comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488352877, "post_id": 42509428, "comment_id": 72186992, "body": "The problem with this implementation is the copyright. It states &quot;Copyright 2012 Apcera Inc. All rights reserved.&quot;"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1488353053, "post_id": 42509428, "comment_id": 72187093, "body": "I&#39;ve presented it as some source for ideas and the license for the package is MIT - on the bottom of the front page - and as far as I&#39;m aware it&#39;s one of the most liberal OSS licenses (<a href=\"https://github.com/nats-io/sublist\" rel=\"nofollow noreferrer\">github.com/nats-io/sublist</a>) and you can even use it in a commercial product."}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "edited": false, "score": 0, "creation_date": 1488378138, "post_id": 42509428, "comment_id": 72203994, "body": "@KavehShahbazian yesterday I benchmarked NATS version, it was slower than my straightforward port from C, I forgot the numbers already, I think it was 3 times slower or so. It uses slices heavily where it should use pointers, and each index dereference is a performance killer."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488391089, "post_id": 42509428, "comment_id": 72213177, "body": "Awesome! :) Looking forward to final version!"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1488316990, "last_edit_date": 1488316990, "creation_date": 1488286822, "answer_id": 42509428, "question_id": 42507846, "link": "https://stackoverflow.com/questions/42507846/porting-meiyan-hash-function-to-go/42509428#42509428", "title": "Porting MeiYan hash function to Go", "body": "<p>The implementation from <a href=\"https://github.com/nats-io/sublist/blob/master/hash/hash.go\" rel=\"nofollow noreferrer\">NATS</a> looks impressive! On my machine, for a data of length 30 (bytes) <strong>op/sec 157175656.56</strong> and <strong>nano-sec/op 6.36</strong>! Take a look at it. You might find some ideas.</p>\n"}, {"tags": [], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "is_accepted": false, "score": 3, "last_activity_date": 1488385817, "last_edit_date": 1488385817, "creation_date": 1488378079, "answer_id": 42534167, "question_id": 42507846, "link": "https://stackoverflow.com/questions/42507846/porting-meiyan-hash-function-to-go/42534167#42534167", "title": "Porting MeiYan hash function to Go", "body": "<p>After some careful research I found out why my code was slow, and improved it so it is now faster than the C version in my tests:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"unsafe\"\n)\n\nfunc meiyan(key *byte, count int) uint32 {\n    type un unsafe.Pointer\n    type p32 *uint32\n    type p16 *uint16\n    type p8 *byte\n    var h uint32 = 0x811c9dc5;\n    for ;count &gt;= 8; {\n        a := *p32(un(key)) &lt;&lt; 5\n        b := *p32(un(key)) &gt;&gt; 27\n        c := *p32(un(uintptr(un(key)) + 4))\n        h = (h ^ ((a | b) ^ c)) * 0xad3e7\n        count -= 8\n        key = p8(un(uintptr(un(key)) + 8))\n    }\n    if (count &amp; 4) != 0 {\n        h = (h ^ uint32(*p16(un(key)))) * 0xad3e7\n        key = p8(un(uintptr(un(key)) + 2))\n        h = (h ^ uint32(*p16(un(key)))) * 0xad3e7\n        key = p8(un(uintptr(un(key)) + 2))\n    }\n    if (count &amp; 2) != 0 {\n        h = (h ^ uint32(*p16(un(key)))) * 0xad3e7\n        key = p8(un(uintptr(un(key)) + 2))\n    }\n    if (count &amp; 1) != 0 {\n        h = h ^ uint32(*key)\n        h = h * 0xad3e7\n    }\n    return h ^ (h &gt;&gt; 16);\n}\n\nfunc main() {\n    T := time.Now().UnixNano()/1e6\n    buf := []byte(\"ABCDEFGHABCDEFGH\")\n    var controlSum uint64 = 0\n    start := &amp;buf[0]\n    size := len(buf)\n    for x := 123; x &lt; 1e8; x++ {\n        controlSum += uint64(meiyan(start, size))\n    }\n    fmt.Println(time.Now().UnixNano()/1e6 - T, \"ms\")\n    fmt.Println(\"controlSum:\", controlSum)\n}\n</code></pre>\n\n<p>The hash function itself was already fast, but dereferencing the array on each iteration is what made it slow: <code>&amp;buf[0]</code> was replaced with <code>start := &amp;buf[0]</code> and then use <code>start</code> on each iteration.</p>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1488385817, "creation_date": 1488282069, "last_edit_date": 1488282243, "question_id": 42507846, "link": "https://stackoverflow.com/questions/42507846/porting-meiyan-hash-function-to-go", "title": "Porting MeiYan hash function to Go", "body": "<p>I wanted to port a state-of-the-art hash function MeiYan from C to Go. (As far as I know this is one of the best if not just the best hash function for hash tables in terms of speed and collision rate, it beats MurMur at least.)</p>\n\n<p>I am new to Go, just spent one weekend with it, and came up with this version:</p>\n\n<pre><code>func meiyan(key *byte, count int) uint32 {\n    type P *uint32;\n    var h uint32 = 0x811c9dc5;\n    for ;count &gt;= 8; {\n        a := ((*(*uint32)(unsafe.Pointer(key))) &lt;&lt; 5)\n        b := ((*(*uint32)(unsafe.Pointer(key))) &gt;&gt; 27)\n        c := *(*uint32)(unsafe.Pointer(uintptr(unsafe.Pointer(key)) + 4))\n        h = (h ^ ((a | b) ^ c)) * 0xad3e7\n        count -= 8\n        key = (*byte)(unsafe.Pointer(uintptr(unsafe.Pointer(key)) + 8))\n    }\n    if (count &amp; 4) != 0 {\n        h = (h ^ uint32(*(*uint16)(unsafe.Pointer(key)))) * 0xad3e7\n        key = (*byte)(unsafe.Pointer(uintptr(unsafe.Pointer(key)) + 2))\n        h = (h ^ uint32(*(*uint16)(unsafe.Pointer(key)))) * 0xad3e7\n        key = (*byte)(unsafe.Pointer(uintptr(unsafe.Pointer(key)) + 2))\n    }\n    if (count &amp; 2) != 0 {\n        h = (h ^ uint32(*(*uint16)(unsafe.Pointer(key)))) * 0xad3e7\n        key = (*byte)(unsafe.Pointer(uintptr(unsafe.Pointer(key)) + 2))\n    }\n    if (count &amp; 1) != 0 {\n        h = (h ^ uint32(*key));\n        h = h * 0xad3e7\n    }\n    return h ^ (h &gt;&gt; 16);\n}\n</code></pre>\n\n<p>Looks messy, but I do not think I can make it look better. Now I measure the speed and it is frustratingly slow, 3 times slower than C/C++ when compiled with <code>gccgo -O3</code>. Can this be made faster? Is this just as good as compiler can make it or <code>unsafe.Pointer</code> conversion is just as slow as it gets? In fact this surprised me, because I have seen that some other number crunching style code was just as fast as C or even faster. Am I doing something inneficiently here?</p>\n\n<p>Here is the original C code I am porting from:</p>\n\n<pre><code>u32 meiyan(const char *key, int count) {\n    typedef u32* P;\n    u32 h = 0x811c9dc5;\n    while (count &gt;= 8) {\n        h = (h ^ ((((*(P)key) &lt;&lt; 5) | ((*(P)key) &gt;&gt; 27)) ^ *(P)(key + 4))) * 0xad3e7;\n        count -= 8;\n        key += 8;\n    }\n    #define tmp h = (h ^ *(u16*)key) * 0xad3e7; key += 2;\n    if (count &amp; 4) { tmp tmp }\n    if (count &amp; 2) { tmp }\n    if (count &amp; 1) { h = (h ^ *key) * 0xad3e7; }\n    #undef tmp\n    return h ^ (h &gt;&gt; 16);\n}\n</code></pre>\n\n<p>Here is how I measure speed:</p>\n\n<pre><code>func main(){\n    T := time.Now().UnixNano()/1e6\n    buf := []byte(\"Hello World!\")\n    var controlSum uint64 = 0\n    for x := 123; x &lt; 1e8; x++ {\n        controlSum += uint64(meiyan(&amp;buf[0], 12))\n    }\n    fmt.Println(time.Now().UnixNano()/1e6 - T, \"ms\")\n    fmt.Println(\"controlSum:\", controlSum)\n}\n</code></pre>\n"}, {"tags": ["go", "signals", "system-calls"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488290525, "post_id": 42505276, "comment_id": 72158752, "body": "You have a race condition on the command structure. You need to fix that first before you can define the behavior of this program."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488298017, "post_id": 42505276, "comment_id": 72164329, "body": "@JimB, Hi, could you please help me understand where is the race condition or how to test it? thanks in advance."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488299685, "post_id": 42505276, "comment_id": 72165464, "body": "The race is easy, run the race detector and it will tell you exactly where it is. I figured out what you&#39;re looking at though, it seems darwin returns from a first wait4 on SIGSTOP even though WEXITED is set, marking the process as done and preventing further signals. It will only happen if there is a concurrent Wait being called. I&#39;m not sure if Go can fix this is the darwin kernel isn&#39;t cooperating."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488299850, "post_id": 42505276, "comment_id": 72165592, "body": "@JimB many thanks, if I am right as a cross-platform solution by using <code>syscall.Kill(cmd.Process.Pid, syscall.SIGCONT)</code> should work right?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488300234, "post_id": 42505276, "comment_id": 72165817, "body": "Yes, that should work for most cases. It has the problem that always exists where the PID may not exist or belong to the correct process when you send the signal, but that&#39;s a general unix issue. Just make sure you synchronize the calls properly, and check with the race detector ;)"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488311338, "post_id": 42505276, "comment_id": 72171898, "body": "@JimB, Hi, I fixed the race condition, probably not in the best way but at leat hope it can help to demonstrate this issue."}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 1, "last_activity_date": 1488380885, "last_edit_date": 1488380885, "creation_date": 1488357430, "answer_id": 42526874, "question_id": 42505276, "link": "https://stackoverflow.com/questions/42505276/os-process-already-finished-when-sending-syscall-sigcont-possible-bug/42526874#42526874", "title": "os: process already finished when sending syscall.SIGCONT (possible bug?)", "body": "<p>This <a href=\"https://github.com/golang/go/issues/19314\" rel=\"nofollow noreferrer\">issue</a> seems to be only happening on Mac OS X, tested on \"Sierra\" and \"El Capitan\"  <a href=\"https://go-review.googlesource.com/#/c/37610/\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/#/c/37610/</a></p>\n\n<p>So, for now, to keep things cross-platform better user:</p>\n\n<pre><code>syscall.Kill(cmd.Process.Pid, syscall.SIGCONT))\n</code></pre>\n\n<p>Example code to test if your system has this issue:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"sleep\", \"10\")\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    // signal when wait4 will return immediately\n    go func() {\n        var siginfo [128]byte\n        psig := &amp;siginfo[0]\n        _, _, e := syscall.Syscall6(syscall.SYS_WAITID, 1, uintptr(cmd.Process.Pid), uintptr(unsafe.Pointer(psig)), syscall.WEXITED|syscall.WNOWAIT, 0, 0)\n        fmt.Println(\"WAITID RETURNED -- this shouldn't happen:\", e)\n    }()\n\n    err := cmd.Process.Signal(syscall.SIGSTOP)\n    if err != nil {\n        log.Fatal(err)\n    }\n    cmd.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 951, "favorite_count": 0, "accepted_answer_id": 42526874, "answer_count": 1, "score": 0, "last_activity_date": 1488380885, "creation_date": 1488275262, "last_edit_date": 1488311274, "question_id": 42505276, "link": "https://stackoverflow.com/questions/42505276/os-process-already-finished-when-sending-syscall-sigcont-possible-bug", "title": "os: process already finished when sending syscall.SIGCONT (possible bug?)", "body": "<p>When executing a process and sending signals to it using: <a href=\"https://golang.org/pkg/os/#Process.Signal\" rel=\"nofollow noreferrer\">Process.Signal</a> I notice that after sending the second signal <code>syscall.SIGCONT</code> I got a: <code>os: process already finished</code> but if using <a href=\"https://golang.org/pkg/syscall/#Kill\" rel=\"nofollow noreferrer\">syscall.Kill</a> everything works as expected.</p>\n\n<p>For demonstrative purposes I have created this naive example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n    exit := make(chan error, 1)\n    go run(exit)\n\n    for {\n        select {\n        case &lt;-exit:\n            println(\"fin, restarting\")\n            run(exit)\n        default:\n            time.Sleep(time.Second)\n            println(\"running...\")\n        }\n    }\n}\n\nfunc run(ch chan&lt;- error) {\n    cmd := exec.Command(\"sleep\", \"3\")\n    if err := cmd.Start(); err != nil {\n        print(err.Error())\n        os.Exit(1)\n    }\n    fmt.Printf(\"Pid: %d\\n\", cmd.Process.Pid)\n    go func() {\n        ch &lt;- cmd.Wait()\n    }()\n\n    time.Sleep(2 * time.Second)\n    fmt.Printf(\"%v\\n\", cmd.Process.Signal(syscall.SIGSTOP))\n\n    time.Sleep(2 * time.Second)\n\n    // Using this will return an os: process already finished  \n    fmt.Printf(\"%v\\n\", cmd.Process.Signal(syscall.SIGCONT)) \n\n    // This works as expected\n    //fmt.Printf(\"%v\\n\", syscall.Kill(cmd.Process.Pid, syscall.SIGCONT))\n}\n</code></pre>\n\n<p>So basically if using:</p>\n\n<pre><code>cmd.Process.Signal(syscall.SIGCONT)\n</code></pre>\n\n<p><code>os: process already finished</code> is returned</p>\n\n<p>But when using:</p>\n\n<pre><code>syscall.Kill(cmd.Process.Pid, syscall.SIGCONT)\n</code></pre>\n\n<p>It works as expected.</p>\n\n<p>Could this be a bug on <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">os.exec</a> or it the expected behavior?</p>\n\n<p><strong>UPDATE</strong>: seems to be happening only on mac os X</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1488274059, "post_id": 42504671, "comment_id": 72147408, "body": "These are normal method expressions as described in the language spec here <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_expressions</a>. Rule of thumb: Look it up in the spec first."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1488274141, "post_id": 42504671, "comment_id": 72147472, "body": "See more on this here: <a href=\"http://stackoverflow.com/questions/38897529/golang-pass-method-to-function/38897667#38897667\">golang - pass method to function</a>; and <a href=\"http://stackoverflow.com/questions/28251283/golang-function-alias-on-method-receiver/28252088#28252088\">golang function alias on method receiver</a>."}, {"owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1488307820, "post_id": 42504671, "comment_id": 72170044, "body": "Thanks for the tips and the links! You guys are awesome."}], "owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488273611, "creation_date": 1488273611, "question_id": 42504671, "link": "https://stackoverflow.com/questions/42504671/what-do-you-call-receivertype-methodreceiver", "title": "What do you call (*receiverType).method(receiver)?", "body": "<p>I recently learned that you can invoke a receiver's method by doing <code>(*receiverType).method(receiver)</code>, where the first parameter is always the receiver itself.</p>\n\n<pre><code>func main() {\n    c := &amp;Cool{}\n    c.say(\"Cool!\")\n    (*Cool).say(c, \"Hot!\") // &lt;-- this\n}\n\ntype Cool struct {\n}\n\nfunc (it *Cool) say(s string) {\n    fmt.Println(s)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/vVjr42ceqA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vVjr42ceqA</a></p>\n\n<p>Is there a name for this kind of syntax? Why does this compile?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1488272015, "post_id": 42503982, "comment_id": 72146077, "body": "Well, for server side problems you have the 5xy status codes. Regarding 404 if len(cities)==0: This seems wrong. 404 is &quot;resource not found&quot;, but the resource <i>was</i> <i>found</i>, it just happens that the resource does not contain cities. Think of the difference between &quot;There is no such file &#39;foobar&#39;.&quot; and &quot;Here is the content of file &#39;foobar&#39; (but foobar happens to be empty).&quot;"}, {"owner": {"reputation": 23612, "user_id": 147407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/65f858d8a973f4ee8d97517a21a17e7d?s=128&d=identicon&r=PG", "display_name": "Andrejs Cainikovs", "link": "https://stackoverflow.com/users/147407/andrejs-cainikovs"}, "edited": false, "score": 0, "creation_date": 1488272601, "post_id": 42503982, "comment_id": 72146438, "body": "You should use response code 204 in case if request was processed successfully, but response is empty: <a href=\"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#2xx_Success\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/List_of_HTTP_status_codes#2xx_Success</a>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1488272745, "post_id": 42503982, "comment_id": 72146516, "body": "You should use the <a href=\"https://golang.org/pkg/net/http/#pkg-constants\" rel=\"nofollow noreferrer\">http constants</a> instead of the return code. Example: <code>w.WriteHeader(http.StatusOK)</code>"}, {"owner": {"reputation": 593, "user_id": 3759301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2fdfbcb8aa9b2afa568bb8b62af05e8a?s=128&d=identicon&r=PG&f=1", "display_name": "Neeraj", "link": "https://stackoverflow.com/users/3759301/neeraj"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488273076, "post_id": 42503982, "comment_id": 72146746, "body": "Thanks everybody  @volker. Actually for 404 code. Just an extended question. Suppose if I search a city by its code and it is not found. Then what should be the return http code?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488273772, "post_id": 42503982, "comment_id": 72147215, "body": "@Neeraj Assuming you do a GET /api/cities/31022 and there is no Dudley than 404 is fine. If you do a GET /api/cities?filterByCode=31022 than 404 seems out of place."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1488282797, "creation_date": 1488282797, "answer_id": 42508085, "question_id": 42503982, "link": "https://stackoverflow.com/questions/42503982/http-status-code-in-get-method-of-rest-api-design/42508085#42508085", "title": "HTTP status code in GET Method of REST api design", "body": "<ol>\n<li>200 is correct</li>\n<li>404 is probably <em>not</em> correct; A list of cities can be empty, and still exist. (Think: A 0-length array is still an array.) You should probably return 200.  You would only return 404 if the list of cities doesn't exist on your server (in other words, that should probably never happen with your API).</li>\n<li>If you experience an internal server error, such as with marshaling JSON, you should return an Internal Server Error, status 500.</li>\n</ol>\n"}], "owner": {"reputation": 593, "user_id": 3759301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2fdfbcb8aa9b2afa568bb8b62af05e8a?s=128&d=identicon&r=PG&f=1", "display_name": "Neeraj", "link": "https://stackoverflow.com/users/3759301/neeraj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 0, "accepted_answer_id": 42508085, "answer_count": 1, "score": 0, "last_activity_date": 1488282797, "creation_date": 1488271640, "last_edit_date": 1488282652, "question_id": 42503982, "link": "https://stackoverflow.com/questions/42503982/http-status-code-in-get-method-of-rest-api-design", "title": "HTTP status code in GET Method of REST api design", "body": "<p>I am learning about the best practices involved in REST API design and wrote a function which handles the GET /cities HTTP/1.1 query.</p>\n\n<p>This function contains cities which is a struct array that holds the cityname, citycode of multiple cities.</p>\n\n<p>Below is the code</p>\n\n<pre><code>func FindCitiesHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json;charset=UTF-8\")\n\n    if len(cities) == 0 {\n            w.WriteHeader(404)\n            return\n    }\n\n    if err := json.NewEncoder(w).Encode(cities); err != nil {\n            /* what to do here? */\n    }\n\n    w.WriteHeader(200)    \n</code></pre>\n\n<p>}</p>\n\n<p>Now when I started thinking about  the possible outcomes of this function. I found these situations.</p>\n\n<ol>\n<li><p>It returns all the cities properly as JSON response successfully. So I return 200 http status.</p></li>\n<li><p>The list of cities is empty. So there is nothing to return. So I return 404 (resource not found)</p></li>\n<li><p>It is about to return JSON response of all cities, but something gone wrong during JSON encoding. Now I am confused here, how do I deal with this situation.</p></li>\n</ol>\n\n<p>I mean how do you convey message properly to user, if</p>\n\n<ol>\n<li>If your business/application logic had some error/exception.</li>\n<li>If data access logic found some issues. (say connection to database is not reachable)</li>\n</ol>\n\n<p>Could you guys please help me to suggest best practices you followed in these situations?</p>\n"}, {"tags": ["string", "pointers", "go"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1488271307, "post_id": 42503775, "comment_id": 72145630, "body": "You most likely have an xy problem. If you need to iterate through the bytes in a string, there are nice go-ways to do it than without using a pointer."}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1488271527, "post_id": 42503775, "comment_id": 72145770, "body": "@nos unfortunately not, there is a heavy pointer arithmetic that deals with the caracters in a string as bytes, words and dwords."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1488272096, "post_id": 42503775, "comment_id": 72146124, "body": "You cannot deal with &quot;characters&quot; in a string as bytes, at least not in the Unicode world."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1488282316, "post_id": 42503775, "comment_id": 72153115, "body": "@exebook Then that is of vital importance to your question, and you should mention explicitly what you need to do. There are ways to do what you need, but your question is too open ended. It&#39;s better that you give concrete problems or code snippets, so you can get concrete answers . You still might need to re-write the code and not do a 1:1 porting from C though."}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1488282461, "post_id": 42503775, "comment_id": 72153219, "body": "@nos thank you, created a specific question <a href=\"http://stackoverflow.com/questions/42507846/porting-meiyan-hash-function-to-go\" title=\"porting meiyan hash function to go\">stackoverflow.com/questions/42507846/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 74, "user_id": 7610172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HLe71_ipGe8/AAAAAAAAAAI/AAAAAAAACd8/NJ8zLQ8guDA/photo.jpg?sz=128", "display_name": "Igor Prozhoha", "link": "https://stackoverflow.com/users/7610172/igor-prozhoha"}, "is_accepted": false, "score": 1, "last_activity_date": 1488272076, "creation_date": 1488272076, "answer_id": 42504138, "question_id": 42503775, "link": "https://stackoverflow.com/questions/42503775/get-uint8-pointer-to-a-first-character-in-a-string/42504138#42504138", "title": "Get *uint8 pointer to a first character in a string", "body": "<p>In golang string it's a massive of bytes, need convert string to rune</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc test(r *rune) {\n    *r = rune('L')\n}\n\nfunc main() {\n    s := []rune(\"Hello\")\n    fmt.Println(string(s))\n    fmt.Println(&amp;s[0])\n    test(&amp;s[0])\n    fmt.Println(string(s))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zCLqEvBVZE\" rel=\"nofollow noreferrer\">Example playground golang</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1488272794, "last_edit_date": 1495541357, "creation_date": 1488272127, "answer_id": 42504152, "question_id": 42503775, "link": "https://stackoverflow.com/questions/42503775/get-uint8-pointer-to-a-first-character-in-a-string/42504152#42504152", "title": "Get *uint8 pointer to a first character in a string", "body": "<p><code>string</code> values in Go are immutable, and therefore not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>; so you cannot take the address of its runes or bytes. If you could, you could modify the pointed value and thus modify the content of the <code>string</code> value. In Go there is also <a href=\"https://stackoverflow.com/questions/41046389/incrementing-a-pointer-in-go/41046421#41046421\">no pointer arithmetic</a>.</p>\n\n<p>What you can do is simply <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">index</a> the <code>string</code>, indexing a <code>string</code> indexes its bytes (in UTF-8 encoded form, this is how Go stores <code>string</code> values in memory). You can \"mimic\" the pointer arithmetic with \"index arithmetic\".</p>\n\n<p>See this example:</p>\n\n<pre><code>s := \"Hello World\"\ni := 0\nfmt.Println(s[i], string(s[i]))\ni += 4\nfmt.Println(s[i], string(s[i]))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/oDLxVhGFks\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>72 H\n111 o\n</code></pre>\n\n<p>You may also convert the <code>string</code> to a <code>[]byte</code> or <code>[]rune</code>, should you have the need to do so (e.g. if you need to modify the bytes), and you can work with that. Slices are also addressable. Note that converting a <code>string</code> value to the mentioned slice types will make a copy of the <code>string</code> content (to preserve the immutability of the <code>string</code>).</p>\n\n<p>While it's the <code>rune</code> type that represents a Unicode character, if you're trying to reproduce a hash algorithm, you most likely want to work with bytes, so convert it to a byte slice (which is the UTF-8 encoded byte sequence of the <code>string</code>):</p>\n\n<pre><code>s := \"Hello World\"\nb := []byte(s)\n// Here you can work with b which is addressable\n</code></pre>\n\n<p>Note that in Go, the types <code>byte</code> and <code>uint8</code> are \"identical\", <code>byte</code> is an alias for <code>uint8</code>, you can also write:</p>\n\n<pre><code>s := \"Hello World\"\nb := []uint8(s)\n</code></pre>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1488278474, "creation_date": 1488270896, "last_edit_date": 1488278474, "question_id": 42503775, "link": "https://stackoverflow.com/questions/42503775/get-uint8-pointer-to-a-first-character-in-a-string", "title": "Get *uint8 pointer to a first character in a string", "body": "<p>I am trying to port a hash function from C to Go using <code>unsafe.Pointer</code>. I need to get the pointer to the first character of the key string.</p>\n\n<p>I tried <code>&amp;(hello[0])</code> and <code>&amp;hello[0]</code> and failed.</p>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 1893998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u6J4T.jpg?s=128&g=1", "display_name": "Agrim", "link": "https://stackoverflow.com/users/1893998/agrim"}, "edited": false, "score": 0, "creation_date": 1488270330, "post_id": 42503409, "comment_id": 72145083, "body": "Thanks for the explanation @icza So, could I say that the <code>struct</code> keyword is used to create a type (e.g. <code>struct {i int}</code> as in your example) but is not a type by itself?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 401, "user_id": 1893998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u6J4T.jpg?s=128&g=1", "display_name": "Agrim", "link": "https://stackoverflow.com/users/1893998/agrim"}, "edited": false, "score": 0, "creation_date": 1488270776, "post_id": 42503409, "comment_id": 72145337, "body": "@Agrim The <code>struct</code> word by itself is not a type, it&#39;s just a keyword, but <code>struct { i int }</code> is a <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">type literal</a>, it <i>is</i> a type."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1488270819, "last_edit_date": 1488270819, "creation_date": 1488269670, "answer_id": 42503409, "question_id": 42503378, "link": "https://stackoverflow.com/questions/42503378/checking-for-struct-type-in-a-type-switch-statement-in-go-results-in-syntax-er/42503409#42503409", "title": "Checking for &quot;struct&quot; type in a type switch statement in Go results in syntax error", "body": "<p><code>struct</code> is not a type, it's a <a href=\"https://golang.org/ref/spec#Keywords\" rel=\"nofollow noreferrer\">keyword</a>.</p>\n\n<p>This is a type for example (given using a <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">type literal</a>):</p>\n\n<pre><code>struct { i int }\n</code></pre>\n\n<p>Or <code>Point</code>:</p>\n\n<pre><code>type Point struct { X, Y int }\n</code></pre>\n\n<p>So the following code works:</p>\n\n<pre><code>switch v := i.(type) {\ncase struct{ i int }:\n    fmt.Printf(\"Life is complicated with %v \\n\", v)\ncase Point:\n    fmt.Printf(\"Point, X = %d, Y = %d \\n\", v.X, v.Y)\n}\n</code></pre>\n\n<p>You may look at <code>struct</code> as being a <em>kind</em> of type, which you can check using reflection, for example:</p>\n\n<pre><code>var p Point\nif reflect.TypeOf(p).Kind() == reflect.Struct {\n    fmt.Println(\"It's a struct\")\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/U8TUogdy6_\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 401, "user_id": 1893998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u6J4T.jpg?s=128&g=1", "display_name": "Agrim", "link": "https://stackoverflow.com/users/1893998/agrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1928, "favorite_count": 0, "accepted_answer_id": 42503409, "answer_count": 1, "score": 2, "last_activity_date": 1488270819, "creation_date": 1488269575, "question_id": 42503378, "link": "https://stackoverflow.com/questions/42503378/checking-for-struct-type-in-a-type-switch-statement-in-go-results-in-syntax-er", "title": "Checking for &quot;struct&quot; type in a type switch statement in Go results in syntax error", "body": "<p>While learning about the type switch statement in Go, I tried to check for the \"struct\" type as follows:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc moo(i interface{}) {\n    switch v := i.(type) {\n    case string:\n        fmt.Printf(\"Byte length of %T: %v \\n\", v, len(v))\n    case int:\n        fmt.Printf(\"Two times this %T: %v \\n\", v, v)\n    case bool:\n        fmt.Printf(\"Truthy guy is %v \\n\", v)\n    case struct:\n        fmt.Printf(\"Life is complicated with %v \\n\", v)\n    default:\n        fmt.Println(\"don't know\")\n    }\n}\n\nfunc main() {\n    moo(21)\n    moo(\"hello\")\n    moo(true)\n}\n</code></pre>\n\n<p>However, this resulted in a syntax error related to the <code>struct</code> type (not seen if the case statement checking for the <code>struct</code> type is removed:</p>\n\n<pre><code>tmp/sandbox396439025/main.go:13: syntax error: unexpected :, expecting {\ntmp/sandbox396439025/main.go:14: syntax error: unexpected (, expecting semicolon, newline, or }\ntmp/sandbox396439025/main.go:17: syntax error: unexpected semicolon or newline, expecting :\ntmp/sandbox396439025/main.go:20: syntax error: unexpected main, expecting (\ntmp/sandbox396439025/main.go:21: syntax error: unexpected moo\n</code></pre>\n\n<p>Is there a reason why the <code>struct</code> type cannot be checked for here? Note that the <code>func moo()</code> is checking for <code>i</code> of type <code>interface{}</code>, an empty interface which should supposedly be implemented by every type, including <code>struct</code></p>\n\n<p>Go Playground full code:</p>\n\n<p><a href=\"https://play.golang.org/p/F820vMJRum\" rel=\"nofollow noreferrer\">https://play.golang.org/p/F820vMJRum</a></p>\n"}, {"tags": ["mysql", "go", "connection-refused"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1488261558, "post_id": 42501182, "comment_id": 72140795, "body": "Code you must show."}, {"owner": {"reputation": 51, "user_id": 7633477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed74303d9a361c5c61acd9481f4b706a?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/7633477/gary"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488289915, "post_id": 42501182, "comment_id": 72158329, "body": "Added code below, thanks..."}], "answers": [{"tags": [], "owner": {"reputation": 824, "user_id": 4412661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aXJT6.jpg?s=128&g=1", "display_name": "Steve C", "link": "https://stackoverflow.com/users/4412661/steve-c"}, "is_accepted": false, "score": 1, "last_activity_date": 1488266274, "creation_date": 1488266274, "answer_id": 42502459, "question_id": 42501182, "link": "https://stackoverflow.com/questions/42501182/golang-mysql-connection-refused/42502459#42502459", "title": "golang MySQL &quot;connection refused&quot;", "body": "<p>I suppose you are calling sql.Open in each of your routine?</p>\n\n<p>The Open function should be called just once. You should share your opened DB connection between your routines. The DB returned by the Open function can be used concurrently and has its own pool</p>\n"}], "owner": {"reputation": 51, "user_id": 7633477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed74303d9a361c5c61acd9481f4b706a?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/7633477/gary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3008, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1501426194, "creation_date": 1488261150, "last_edit_date": 1501426194, "question_id": 42501182, "link": "https://stackoverflow.com/questions/42501182/golang-mysql-connection-refused", "title": "golang MySQL &quot;connection refused&quot;", "body": "<p>I'm new in Go (Golang). I wrote a simple benchmark program to test the concurrent processing with MySQL. Keep getting \"dial tcp 52.55.254.165:3306: getsockopt: connection refused\", \"unexpected EOF\" errors when I increase the number of concurrent channels. </p>\n\n<p>Each go routine is doing a batch insert of 1 to n number of row to a simple customer table. The program allows to set variable insert size (number of rows in a single statement) and number of parallel go routine (each go routine performs one insert above).  Program works fine with small numbers row&lt;100 and number go routines&lt;100. But start getting Unexpected EOF errors when the numbers increase, especially the number of parallel go routines.</p>\n\n<p>Did search for clues. Based on them, I've set the database max connection and 'max_allowed_packet' and 'max_connections'. I've also set the go program <code>db.db.SetMaxOpenConns(200)</code>, <code>db.SetConnMaxLifetime(200)</code>, <code>db.SetMaxIdleConns(10)</code>. I've experimented with big numbers and small (from 10 to 2000). Nothing seems to solve the program.</p>\n\n<p>I have one global db connection open. Code snippet below:</p>\n\n<pre><code>// main package\n\nfunc main() {\n\n    var err error\n    db, err = sql.Open(\"mysql\",\"usr:pwd@tcp(ip:3306)/gopoc\")\n    if err != nil {\n        log.Panic(err)\n    }\n    db.SetMaxOpenConns(1000)\n    db.SetConnMaxLifetime(1000)\n    db.SetMaxIdleConns(10)\n\n    // sql.DB should be long lived \"defer\" closes it once this function ends\n    defer db.Close()\n\n    if err = db.Ping(); err != nil {\n        log.Panic(err)\n    }\n\n    http.HandleFunc(\"/addCust/\", HFHandleFunc(addCustHandler))\n\n    http.ListenAndServe(\":8080\", nil)\n}\n\n// add customer handler\nfunc addCustHandler(w http.ResponseWriter, r *http.Request) {\n\n    // experected url: /addCust/?num=3$pcnt=1\n    num, _ := strconv.Atoi(r.URL.Query().Get(\"num\"))\n    pcnt, _ := strconv.Atoi(r.URL.Query().Get(\"pcnt\"))\n\n    ch := make([]chan string, pcnt) // initialize channel slice\n    for i := range ch {\n        ch[i] = make(chan string, 1)\n    }\n\n    var wg sync.WaitGroup\n\n    for i, chans := range ch {\n        wg.Add(1)\n        go func(cha chan string, ii int) {\n            defer wg.Done()\n            addCust(num)\n            cha &lt;- \"Channel[\" + strconv.Itoa(ii) + \"]\\n\"\n        }(chans, i)\n    }\n\n    wg.Wait()\n\n    var outputstring string\n\n    for i := 0; i &lt; pcnt; i++ {\n        outputstring = outputstring + &lt;-ch[i]\n    }\n\n    fmt.Fprintf(w, \"Output:\\n%s\", outputstring)\n}\n\nfunc addCust(cnt int) sql.Result {\n...\n    sqlStr := \"INSERT INTO CUST (idCUST, idFI, fName, state, country) VALUES \"\n\n    for i := 0; i &lt; cnt; i++ {\n\n        sqlStr += \"(\" + strconv.Itoa(FiIDpadding+r.Intn(CidMax)+1) + \", \" + strconv.Itoa(FiID) +\", 'fname', 'PA', 'USA), \" \n\n    }\n\n    //trim the last ,\n    sqlStr = sqlStr[0:len(sqlStr)-2] + \" on duplicate key update lname='dup';\"\n\n    res, err := db.Exec(sqlStr)\n    if err != nil {\n        panic(\"\\nInsert Statement error\\n\" + err.Error()) \n    }\n\n    return res\n}\n</code></pre>\n"}, {"tags": ["c", "go", "compilation", "zeromq", "alpine"], "comments": [{"owner": {"reputation": 890, "user_id": 3364249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hQltG.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3364249/marco"}, "edited": false, "score": 0, "creation_date": 1488262341, "post_id": 42500973, "comment_id": 72141093, "body": "Please clear up what you are trying to do. Do you have problem running or compiling the program?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "reply_to_user": {"reputation": 890, "user_id": 3364249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hQltG.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3364249/marco"}, "edited": false, "score": 0, "creation_date": 1488262659, "post_id": 42500973, "comment_id": 72141222, "body": "@Marco it&#39;s in the compiling, sorry. The first line was when I tried to run a binary with no compiling flags. The error is when I try to compile on Ubuntu with the flags"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488293130, "post_id": 42500973, "comment_id": 72160523, "body": "You can&#39;t link to a C library without CGO. That&#39;s specifically what CGO is for."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488293396, "post_id": 42500973, "comment_id": 72160770, "body": "@JimB but does CGO use libc for linking exclusively? Why muslc won&#39;t work if it&#39;s compatible?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488293973, "post_id": 42500973, "comment_id": 72161237, "body": "@GuerlandoOCs: I don&#39;t understand the question. musl is a libc implementation, but you&#39;re disabling cgo, so you&#39;re not going to use it. I would try to build both czmq and Go together with musl to ensure everything compiles and links correctly. You can probably just use the go alpine docker container for this."}], "answers": [{"comments": [{"owner": {"reputation": 326, "user_id": 2520472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gBvQQ.jpg?s=128&g=1", "display_name": "Travis DePrato", "link": "https://stackoverflow.com/users/2520472/travis-deprato"}, "edited": false, "score": 1, "creation_date": 1616777677, "post_id": 59632971, "comment_id": 118118389, "body": "In case it helps anyone else, I had to add <code>-lstdc++</code> to the <code>-extldflags</code> arguments to get goczmq to work (since ZMQ uses C++). I had to do this even despite having the <code>dummy.cc</code> file present."}], "tags": [], "owner": {"reputation": 72, "user_id": 12641379, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PCOuL.jpg?s=128&g=1", "display_name": "Tobias Pfandzelter", "link": "https://stackoverflow.com/users/12641379/tobias-pfandzelter"}, "is_accepted": false, "score": 2, "last_activity_date": 1578416755, "creation_date": 1578416755, "answer_id": 59632971, "question_id": 42500973, "link": "https://stackoverflow.com/questions/42500973/compiling-go-library-without-gco-to-run-on-alpine-error-in-libczmq/59632971#59632971", "title": "Compiling go library without GCO to run on alpine, error in libczmq", "body": "<p>I know this question is about three years old now but there is nothing on the Internet about this and I was facing the exact same problem and it took about two days before I finally found a proper solution.</p>\n\n<p>In short, I had a Go project that uses <code>goczmq</code> that I wanted to compile to a complete binary to put it into a <code>FROM scratch</code> Docker container (although in this case, an alpine container would work just as well). On the Internet, people now tend to tell you to set <code>CGO_ENABLED=0</code> and everything will work fine, which is true. This tells Go to not use CGO, which allows you to use C libraries in your Go code, but needs those C libraries to be available on the system when you run your code. As you have figured out, alpine does not have those C libraries (or, well, it has different ones in <code>muslc</code> instead of <code>glibc</code>).</p>\n\n<p>However, in our case, this is not helpful. We want our Go code to be able to use existing C libraries because we use <code>goczmq</code>, which, as you have identified, is a Go wrapper for <code>czmq</code> which itself is a C wrapper for <code>libzmq</code> (which is written in C++, which makes our life even harder).</p>\n\n<p>I solved this problem by using a static binary. Instead of linking to whatever C libraries are available on the target system (in this case <code>muslc</code> on alpine) dynamically, I compile my code AND all the libraries (<code>muslc</code>, <code>czmq</code> and <code>libzmq</code>) into one unified binary.</p>\n\n<p>I'm using <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"nofollow noreferrer\">Docker multi-stage builds</a> based on alpine here but in theory you could also do this directly on your computer.</p>\n\n<pre><code># stage 1: build the binary\n# we are using alpine Linux with the latest version of golang\nFROM golang:1.13-alpine as golang\n\n# first install some dependencies\n# (we are using the static versions for each for them as we want these libraries included statically, not dynamically!)\n# czmq requires libzmq which in turn requires libsodium\n# on alpine Linux we also need to install some specific tools to build C and C++ programs\n# libsodium also requires libuuid, which is included in util-linux-dev\nRUN apk add --no-cache libzmq-static czmq-dev libsodium-static build-base util-linux-dev\n\n# now we do the magic command mentioned here\n# https://stackoverflow.com/questions/34729748/installed-go-binary-not-found-in-path-on-alpine-linux-docker?noredirect=1&amp;lq=1\n# this fools the C compiler into thinking we have glibc installed while we are actually using musl\n# since we are compiling statically, it makes sense to use musl as it is smaller\n# (and it uses the more permissive MIT license if you want to distribute your binary in some form, but check your other libraries before!)\nRUN mkdir /lib64 &amp;&amp; ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2\n\n# create your project directory for the Go project\nWORKDIR /go/src/github.com/&lt;username&gt;/&lt;projectname&gt;/\n\n# copy in all your Go files, assuming these are in the same directory as your Dockerfile\nCOPY . .\n\n# here is the first hack: we need to tell CGO to use g++ instead of gcc or else it will struggle with libzmq, which is written in C++\n# creating and empty C++ file actually works for this\nRUN touch ./dummy.cc\n\n# now run go install (go build could also work here but your binary would end up in a different directory)\n# the -ldflags will be passed along the CGO toolchain\n# -extldflags is especially important here, it has two important flags that we need:\n# -static tells the compiler to use static linking, which does the actual magic of putting everything into one binary\n# -luuid is needed to correctly find the uuid library that czmq uses\nRUN go install -a -ldflags '-linkmode external -w -s -extldflags \"-static -luuid\" ' .\n\n# stage 2: here is your actual image that will later run on your Docker host\n# you can also use alpine here if you so choose\nFROM scratch\n\n# now we just copy over the completed binary from the old builder image\nCOPY --from=golang /go/bin/&lt;projectname&gt; bin\n\n# and we start our program\nENTRYPOINT [\"./bin\"]\n\n</code></pre>\n\n<p>Now this almost works! The only thing left is to add this statement to the beginning of your <code>main.go</code> file or else CGO is confused about what you are doing:</p>\n\n<pre><code>import \"C\"\n</code></pre>\n\n<p>This is important even if you don't directly use CGO in your program.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1578416755, "creation_date": 1488260238, "question_id": 42500973, "link": "https://stackoverflow.com/questions/42500973/compiling-go-library-without-gco-to-run-on-alpine-error-in-libczmq", "title": "Compiling go library without GCO to run on alpine, error in libczmq", "body": "<p>When trying to run my binary on <code>alpine</code>, I got the error:</p>\n\n<pre><code>... binary not found\n</code></pre>\n\n<p>which typically happens when there's a problem with architecture, or as I found, <code>glibc</code>. I searched and discovered that <code>alpine</code> instead uses <code>muslc</code>, an alternative <code>C</code> library. I then found this <a href=\"https://stackoverflow.com/questions/34729748/installed-go-binary-not-found-in-path-on-alpine-linux-docker\">Installed Go binary not found in path on Alpine Linux Docker</a> that teaches how to compile without <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\"><code>CGO</code></a>, which is the thing that permits loading <code>C</code> libraries from go:</p>\n\n<pre><code>GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o [name of binary]\n</code></pre>\n\n<p>When I run this, I get:</p>\n\n<pre><code>go build gopkg.in/zeromq/goczmq.v4: no buildable Go source files in /home/lucas/Go/src/gopkg.in/zeromq/goczmq.v4\n</code></pre>\n\n<p>I suspect that it's because <code>libczmq</code> is just a wrapper for the <code>C</code> written <code>libzmq</code>. In this case, how do I compile in a way that I can use <code>libczmq</code>? Why exactly <code>CGO</code> must be disabled in alpine?</p>\n\n<p>What's exactly <code>CGO</code>? Shouldn't it use <code>libc</code> when available but <code>muslc</code> when not? I'd like to know more about what's happening in the background.</p>\n\n<p>Note: I'm compiling outside alpine, in ubuntu, is that a problem? </p>\n"}, {"tags": ["windows", "go", "command-line", "system-calls"], "comments": [{"owner": {"reputation": 890, "user_id": 3364249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hQltG.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3364249/marco"}, "edited": false, "score": 0, "creation_date": 1488265355, "post_id": 42500570, "comment_id": 72142502, "body": "Can you please be more precise about which prompt you are trying to hide? You already stated the correct commands hide both, the Go command line window and the windows spawned by exec. My best guess at the moment is that the command you are executing spawns an additional window."}, {"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "reply_to_user": {"reputation": 890, "user_id": 3364249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hQltG.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3364249/marco"}, "edited": false, "score": 0, "creation_date": 1488331306, "post_id": 42500570, "comment_id": 72180032, "body": "It&#39;s possible too, I am going to check which command spawns the command prompt (disappears very soon though)"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1505138927, "post_id": 42500570, "comment_id": 79277306, "body": "@jm33_m0 I have just tried, the sysProcAttr method in your question and it is a vast improvement -windows only flash briefly. Did you ever find a solution to prevent the flash completely"}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1506870566, "post_id": 46233782, "comment_id": 79981601, "body": "I had only seen an issue on win 7, not 8 but I just retested this on a windows 7 machine and it does indeed work there as described - I&#39;m not sure why I got an error when i tried previously - comment removed to avoid confusion. answer upvoted as I will now be using this approach"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 5, "last_activity_date": 1616139823, "last_edit_date": 1616139823, "creation_date": 1505459553, "answer_id": 46233782, "question_id": 42500570, "link": "https://stackoverflow.com/questions/42500570/how-to-hide-command-prompt-window-when-using-exec-in-golang/46233782#46233782", "title": "How to hide command prompt window when using Exec in Golang?", "body": "<p>If you build with <code>-ldflags -H=windowsgui</code>, each exec.Command will spawn a new console window.</p>\n<p>If you build without the flag, you get <strong>one</strong> console window and all exec.Commands print into that one.</p>\n<p>My current solution is thus to build <strong>without</strong> the flag, i.e. have a console window on program start, then immediately hide the console window with this code at the start of my program:</p>\n<pre><code>import &quot;github.com/gonutz/w32/v2&quot;\n\nfunc hideConsole() {\n    console := w32.GetConsoleWindow()\n    if console == 0 {\n        return // no console attached\n    }\n    // If this application is the process that created the console window, then\n    // this program was not compiled with the -H=windowsgui flag and on start-up\n    // it created a console along with the main application window. In this case\n    // hide the console window.\n    // See\n    // http://stackoverflow.com/questions/9009333/how-to-check-if-the-program-is-run-from-a-console\n    _, consoleProcID := w32.GetWindowThreadProcessId(console)\n    if w32.GetCurrentProcessId() == consoleProcID {\n        w32.ShowWindowAsync(console, w32.SW_HIDE)\n    }\n}\n</code></pre>\n<p>See <a href=\"https://stackoverflow.com/a/9009783/6276385\">this thread</a> for the details about the process ID stuff.</p>\n<p>What happens is that all exec.Commands now print their output to the hidden console window instead of spawning their own.</p>\n<p>The compromise here is that your program will flash a console window once when you start it, but only for a brief moment before it goes into hiding.</p>\n"}, {"comments": [{"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1522595232, "post_id": 48365926, "comment_id": 86205977, "body": "This actually answers the question. Thanks!"}, {"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1522595713, "post_id": 48365926, "comment_id": 86206119, "body": "It is probably safer to use <code>os.Getenv(&quot;windir&quot;)</code> for the directory though."}, {"owner": {"reputation": 336, "user_id": 7893831, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-z9eiLy_c89g/AAAAAAAAAAI/AAAAAAAAACE/X-9unuGOp1o/photo.jpg?sz=128", "display_name": "Yu Chen", "link": "https://stackoverflow.com/users/7893831/yu-chen"}, "reply_to_user": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1523883574, "post_id": 48365926, "comment_id": 86730459, "body": "@KarelB&#237;lek Yeah, but I haven&#39;t seen that a cmd in  windows system doesn&#39;t locate in that place :) ."}, {"owner": {"reputation": 582, "user_id": 819866, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/f4972a60e72ce2f2252c6b1d644055bc?s=128&d=identicon&r=PG", "display_name": "Sunil Kumar", "link": "https://stackoverflow.com/users/819866/sunil-kumar"}, "edited": false, "score": 0, "creation_date": 1572934954, "post_id": 48365926, "comment_id": 103705805, "body": "I&#39;m not sure how should I thank you. Since yesterday I&#39;ve tried at least 50 ways of hiding this terminal window. I was frustrated with the terminal window and I was starting to hate black color in real life. Thanks again. You are a saviour."}], "tags": [], "owner": {"reputation": 336, "user_id": 7893831, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-z9eiLy_c89g/AAAAAAAAAAI/AAAAAAAAACE/X-9unuGOp1o/photo.jpg?sz=128", "display_name": "Yu Chen", "link": "https://stackoverflow.com/users/7893831/yu-chen"}, "is_accepted": true, "score": 22, "last_activity_date": 1516557087, "last_edit_date": 1516557087, "creation_date": 1516531470, "answer_id": 48365926, "question_id": 42500570, "link": "https://stackoverflow.com/questions/42500570/how-to-hide-command-prompt-window-when-using-exec-in-golang/48365926#48365926", "title": "How to hide command prompt window when using Exec in Golang?", "body": "<p><a href=\"https://www.reddit.com/r/golang/comments/2c1g3x/build_golang_app_reverse_shell_to_run_in_windows/\" rel=\"noreferrer\">There</a> is a better solution, which can run <code>exec.Command()</code> without spawn a visible window, ( \u0361\u00b0 \u035c\u0296 \u0361\u00b0).</p>\n\n<p>Here is my code:</p>\n\n<p>Firstly <code>import \"syscall\"</code></p>\n\n<pre><code>cmd_path := \"C:\\\\Windows\\\\system32\\\\cmd.exe\"\ncmd_instance := exec.Command(cmd_path, \"/c\", \"notepad\")\ncmd_instance.SysProcAttr = &amp;syscall.SysProcAttr{HideWindow: true}\ncmd_output, err := cmd_instance.Output()\n</code></pre>\n\n<p>Origin: \n<a href=\"https://www.reddit.com/r/golang/comments/2c1g3x/build_golang_app_reverse_shell_to_run_in_windows/\" rel=\"noreferrer\">https://www.reddit.com/r/golang/comments/2c1g3x/build_golang_app_reverse_shell_to_run_in_windows/</a></p>\n"}, {"tags": [], "owner": {"reputation": 2311, "user_id": 52687, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8003cec2ffaffe82adfe0a4440d02e9?s=128&d=identicon&r=PG", "display_name": "Andrew McKinlay", "link": "https://stackoverflow.com/users/52687/andrew-mckinlay"}, "is_accepted": false, "score": 2, "last_activity_date": 1576340007, "creation_date": 1576340007, "answer_id": 59336873, "question_id": 42500570, "link": "https://stackoverflow.com/questions/42500570/how-to-hide-command-prompt-window-when-using-exec-in-golang/59336873#59336873", "title": "How to hide command prompt window when using Exec in Golang?", "body": "<p>Instead of hiding the console window, you should be able to prevent it with:</p>\n\n<pre><code>cmd := exec.Command(...)\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{CreationFlags: 0x08000000} // CREATE_NO_WINDOW\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6469, "favorite_count": 3, "accepted_answer_id": 48365926, "answer_count": 3, "score": 12, "last_activity_date": 1616139823, "creation_date": 1488258149, "last_edit_date": 1571096383, "question_id": 42500570, "link": "https://stackoverflow.com/questions/42500570/how-to-hide-command-prompt-window-when-using-exec-in-golang", "title": "How to hide command prompt window when using Exec in Golang?", "body": "<p>say i have the following code, using <code>syscall</code> to hide command line window</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>process := exec.Command(name, args...)\nprocess.SysProcAttr = &amp;syscall.SysProcAttr{HideWindow: true}\nerr := process.Start()\nif err != nil {\n    log.Print(err)\n}\n</code></pre>\n\n<p>but when i compiled it and tried to run it in Windows, command line window showed up again</p>\n\n<p>what can i do to prevent command line window from appearing?</p>\n\n<p>PS i already know how to compile golang source into a Windows GUI executable using <code>go build -ldflags -H=windowsgui</code>, but doing so only ensures the program itself doesn't bring up a command line window, <code>Exec</code> will show those windows anyway</p>\n"}, {"tags": ["json", "mongodb", "postgresql", "go", "database"], "comments": [{"owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "edited": false, "score": 0, "creation_date": 1488254897, "post_id": 42500013, "comment_id": 72138635, "body": "What do the queries look like?"}, {"owner": {"reputation": 141, "user_id": 4143680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EZtiINlnyus/AAAAAAAAAAI/AAAAAAAABQc/se2NRS39sZw/photo.jpg?sz=128", "display_name": "Henry Henderson", "link": "https://stackoverflow.com/users/4143680/henry-henderson"}, "reply_to_user": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "edited": false, "score": 0, "creation_date": 1488255641, "post_id": 42500013, "comment_id": 72138830, "body": "I&#39;ll add that to my main post as well. As simple as you can get! <code>SELECT data FROM tblname WHERE id = $1</code>"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1488268606, "post_id": 42500013, "comment_id": 72144195, "body": "@HenryHenderson Can you share your Benchmarking Code ?"}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "edited": false, "score": 0, "creation_date": 1488278747, "post_id": 42500013, "comment_id": 72150733, "body": "Use a tool like <a href=\"http://dalibo.github.io/pgbadger/\" rel=\"nofollow noreferrer\">pgBadger</a> to see what queries the database gets and how they perform. PostgreSQL usually scales well, particularly for read-only queries. Since you say that <i>&quot;the slowness of Postgres in the console for printing was very noticeable&quot;</i>, are you sure where the time is spent? Some client applications like pgAdmin are known to be very slow when displaying large amounts of data."}], "owner": {"reputation": 141, "user_id": 4143680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EZtiINlnyus/AAAAAAAAAAI/AAAAAAAABQc/se2NRS39sZw/photo.jpg?sz=128", "display_name": "Henry Henderson", "link": "https://stackoverflow.com/users/4143680/henry-henderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500100242, "creation_date": 1488254664, "last_edit_date": 1506103077, "question_id": 42500013, "link": "https://stackoverflow.com/questions/42500013/postgresql-concurrency-with-selects", "title": "PostgreSQL concurrency with selects", "body": "<p>I have built two proof-of-concept projects for a RESTful API in Golang which will return a large amount of JSON data by querying for a specific ID. I built the first using MongoDB, and then a modified 2nd to support Postgres. The MongoDB version queries by the ID in the JSON itself, but Postgres I simply had two columns in a table, with a primary key on the ID and a jsonb column for all the JSON data. I assumed this was faster than indexing all of the json data and selecting that way. Since I am <em>always</em> returning all of the json data, it seemed unnecessary to query via json data.</p>\n\n<p>I heard a lot of positive things about Postgres being 2.8-3x faster than MongoDB for handling JSON data, and the initial results seemed to prove so. I built a tester which would sequentially perform GETs on the API for all (roughly 30k) objects in the database and print them out, and record the amount of time they took. Postgres finished all 30k in 1.5 minutes, with MongoDB finishing in 6. I decided to write a second test, performed the same way, but instead query 100 funds at the same time, wait for all 100 to be processed (printed), then feed in another set of 100 IDs to query the API for. This is repeated until all the funds have been queried for and returned. It's quite easy to do in Golang using goroutines. MongoDB finished in roughly 6 minutes again... with Postgres finishing in 45. The slowness of Postgres in the console for printing was very noticeable.</p>\n\n<p>How can sequential vs. concurrency in this test of simple SELECT statements be so incredibly slow? Is there some major thing I am missing? I increased buffer sized in the config for postgres, I tried using the <code>pg_prewarm</code> extension on the table to load it into memory so it would be faster, as well as a <code>CREATE INDEX CONCURRENTLY</code> index on the ID in the table. I am relatively new to Postgres, having primarily used MySQL in the past. The sequential tests showed Postgres was definitely a lot faster in handling the data, but when scaled up to high demand, its performance completely went out the window. This is a small microservice API to be used internally to request data for a website which can be under heavy load at times.</p>\n\n<p>Is there any things I could try to fix this, or does Postgres plateau this way? Thanks for any help!</p>\n\n<p>Here's the table creation code in Postgres if this helps diagnose anything:\n(The ID is a string, so <code>text</code> is intentional)</p>\n\n<pre><code>CREATE TABLE public.tblname\n(\n  id text NOT NULL,\n  data jsonb,\n  CONSTRAINT tblname_pkey PRIMARY KEY (id)\n)\nWITH (\n  OIDS=FALSE\n);\n\nCREATE INDEX idx_id\n  ON public.tblname\n  USING btree\n  (id COLLATE pg_catalog.\"default\");\n</code></pre>\n\n<p>Edit:\nThe query is a simple select that looks like:</p>\n\n<pre><code>SELECT data FROM tblname WHERE id= $1\n</code></pre>\n\n<p>$1 is where the string is passed in for the ID in Go. I am also using the pq Postgres driver library for the project. It mainly extends the native database/sql library built into Go already. <a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">https://github.com/lib/pq</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488253348, "post_id": 42499735, "comment_id": 72138225, "body": "I really asked a stupid question, but thank you for your answer. it helps me."}], "tags": [], "owner": {"reputation": 689, "user_id": 4350480, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x8Rq6.jpg?s=128&g=1", "display_name": "Hasan Aslam", "link": "https://stackoverflow.com/users/4350480/hasan-aslam"}, "is_accepted": true, "score": 1, "last_activity_date": 1488252984, "creation_date": 1488252984, "answer_id": 42499735, "question_id": 42499643, "link": "https://stackoverflow.com/questions/42499643/what-is-base-argument-used-for-in-parseint/42499735#42499735", "title": "What is base argument used for in ParseInt()?", "body": "<p>You are converting a string to an integer. The method is asking you for the base (number system) the string is in. You can learn more about number systems here: <a href=\"https://en.wikipedia.org/wiki/Radix\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Radix</a></p>\n\n<p>For example (using your code snippet provided <a href=\"https://play.golang.org/p/TfZApCpqfx\" rel=\"nofollow noreferrer\">here</a>): </p>\n\n<pre><code>var s string = \"1111\" // This string is in binary (Base 2)\ni, err := strconv.ParseInt(s, 2, 64) // Give the base as 2\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Hello, 15 with type int64!\n</code></pre>\n"}], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 42499735, "answer_count": 1, "score": -3, "last_activity_date": 1488266174, "creation_date": 1488252445, "last_edit_date": 1488266174, "question_id": 42499643, "link": "https://stackoverflow.com/questions/42499643/what-is-base-argument-used-for-in-parseint", "title": "What is base argument used for in ParseInt()?", "body": "<p>I have come across many sample code whenever we try to convert string to int we use : </p>\n\n<pre><code>parseValue, err := strconv.ParseInt(value, 10, 64)\n</code></pre>\n\n<p>So the code above <code>ParseInt()</code> has three arguments. from the documentation code : </p>\n\n<pre><code>func ParseInt(s string, base int, bitSize int) (i int64, err error) {\n</code></pre>\n\n<p>I tried to understand the <code>base int</code>here so I change the value from 0 to 16. <a href=\"https://play.golang.org/p/TfZApCpqfx\" rel=\"nofollow noreferrer\">PlayGolang</a>.</p>\n\n<p>The result is ok when the input are <code>0</code> and <code>10</code>. Number other that <code>0</code> and <code>10</code> are panic. I still confused and not understand. Can someone explain what <code>base</code> is used for in <code>ParseInt()</code>?</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488251348, "post_id": 42498743, "comment_id": 72137727, "body": "You use <code>recover</code> to recover from a <code>panic</code>. I&#39;m not sure what you&#39;re trying to do here."}, {"owner": {"reputation": 73, "user_id": 3273016, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f6631620bfd59200eff50b2173959876?s=128&d=identicon&r=PG&f=1", "display_name": "user3273016", "link": "https://stackoverflow.com/users/3273016/user3273016"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488253103, "post_id": 42498743, "comment_id": 72138163, "body": "recover is only used when there is a panic inside a goroutine, where as in my case app is long running message driven app and if there is a runtime panic we want to emit a message on logging pipeline to declare it is going down. Also i tried adding a defer function calling recover in my main function but that didnt help either."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488253464, "post_id": 42498743, "comment_id": 72138258, "body": "You can&#39;t globally catch panics, they are intended to crash the program as the program may be in an undefined state. A panic isn&#39;t a signal, so you can&#39;t catch it with a signal handler either if that&#39;s what you&#39;re trying to do."}, {"owner": {"reputation": 73, "user_id": 3273016, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f6631620bfd59200eff50b2173959876?s=128&d=identicon&r=PG&f=1", "display_name": "user3273016", "link": "https://stackoverflow.com/users/3273016/user3273016"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488254703, "post_id": 42498743, "comment_id": 72138599, "body": "yes i was thinking of trying to catch via signal handler. And my requirement is to emit a message on stderr before exiting, so state of the program does not matter much."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488326543, "post_id": 42498743, "comment_id": 72178795, "body": "if you need to be notified of the program crashing in all cases, you need to monitor the application from another process. You could try something like <a href=\"https://github.com/mitchellh/panicwrap\" rel=\"nofollow noreferrer\">github.com/mitchellh/panicwrap</a>"}, {"owner": {"reputation": 73, "user_id": 3273016, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f6631620bfd59200eff50b2173959876?s=128&d=identicon&r=PG&f=1", "display_name": "user3273016", "link": "https://stackoverflow.com/users/3273016/user3273016"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488354198, "post_id": 42498743, "comment_id": 72187677, "body": "Thanks Jim. That helps."}], "owner": {"reputation": 73, "user_id": 3273016, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f6631620bfd59200eff50b2173959876?s=128&d=identicon&r=PG&f=1", "display_name": "user3273016", "link": "https://stackoverflow.com/users/3273016/user3273016"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1177, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1488246413, "creation_date": 1488246413, "question_id": 42498743, "link": "https://stackoverflow.com/questions/42498743/handle-run-time-panic-gracefully-in-go", "title": "handle run-time panic gracefully in go", "body": "<p>my application uses a logging pipeline, so requirement is to handle runtime panic gracefully like sednding a message on logging pipeline to declare the app going down, so that rule engine can work on it.</p>\n\n<p>having said the goal, i followed go doc for signal (<a href=\"https://golang.org/src/os/signal/doc.go\" rel=\"nofollow noreferrer\">https://golang.org/src/os/signal/doc.go</a>) it mentions about SIGBUS, SIGFPE, and SIGSEGV but not clearly mention about how to catch them in code. So i tried with go test and signal handler in app but it does not get called. Is there  a way to achieve the goal.</p>\n\n<pre><code>func sigHandler1(exitChannel, syncChannel chan bool) {\n c := make(chan os.Signal, 1)\n signal.Notify(c)\n\n go func() {\n    for {\n        // Block until a signal is received.\n        s := &lt;-c\n        mlog.Info(\" got signal1: %+v\", s)\n        switch s {\n        // kill -SIGHUP XXXX\n        case syscall.SIGHUP, syscall.SIGQUIT,syscall.SIGINT, syscall.SIGTERM:\n            exitChannel &lt;- true\n        case syscall.SIGSEGV:\n            syncChannel &lt;-true   \n        default:\n            log.Println(\"Unknown signal.\")\n        }\n    }\n}()\n</code></pre>\n\n<p>}</p>\n\n<pre><code>func Test() {\n    var msgBuf []byte\n\n    log.Println(\"Test going to generate panic\")\n    msgBuf[0] = 1\n\n}\n</code></pre>\n\n<p>panic result are as follows.</p>\n\n<pre><code> panic: runtime error: index out of range [recovered]\n panic: runtime error: index out of range\n\ngoroutine 10 [running]:\npanic(0x515de0, 0xc420010150)\n    /usr/local/Cellar/go/1.7.5/libexec/src/runtime/panic.go:500 +0x1a1\ntesting.tRunner.func1(0xc420092300)\n    /usr/local/Cellar/go/1.7.5/libexec/src/testing/testing.go:579 +0x25d\npanic(0x515de0, 0xc420010150)\n    /usr/local/Cellar/go/1.7.5/libexec/src/runtime/panic.go:458 +0x243\napp.Test()\n    app/main.go:142 +0x56\napp.TestMHProcessDlAck_22(0xc420092300)\n    app.mh_test.go:946 +0x68\ntesting.tRunner(0xc420092300, 0x60bc90)\n    /usr/local/Cellar/go/1.7.5/libexec/src/testing/testing.go:610 +0x81\ncreated by testing.(*T).Run\n    /usr/local/Cellar/go/1.7.5/libexec/src/testing/testing.go:646 +0x2ec\nexit status 2\nFAIL    app 0.085s\n</code></pre>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "edited": false, "score": 0, "creation_date": 1488247622, "post_id": 42498555, "comment_id": 72136789, "body": "Did you see this? <a href=\"https://github.com/gin-gonic/gin/issues/75\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/issues/75</a>"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 6363142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44575e1c78190bb261b4c1d3d3343ce6?s=128&d=identicon&r=PG&f=1", "display_name": "YCSeattle", "link": "https://stackoverflow.com/users/6363142/ycseattle"}, "edited": false, "score": 2, "creation_date": 1488674079, "post_id": 42500582, "comment_id": 72336512, "body": "This doesn&#39;t work because I already have a path defined as router.GET(&quot;/:path1&quot;, getPath1), and router.GET(&quot;/:path1/:path2&quot;, getPath2), and gin will panic with error &quot;wildcard route &#39;:path1&#39; conflicts with existing children in path &#39;/:path1&#39; when I add the router.Static(&quot;/assets&quot;, &quot;./assets&quot;). That is, because I already have path segment defined as wildcards, I cannot use the router.Static without conflicts, a quirky decision GIN has designed for. I am hoping that I can find a way to serve each of the individual static files from the wildcard handler."}], "tags": [], "owner": {"reputation": 834, "user_id": 4596814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q7evG.jpg?s=128&g=1", "display_name": "Bhavana", "link": "https://stackoverflow.com/users/4596814/bhavana"}, "is_accepted": false, "score": 4, "last_activity_date": 1488258538, "last_edit_date": 1488258538, "creation_date": 1488258212, "answer_id": 42500582, "question_id": 42498555, "link": "https://stackoverflow.com/questions/42498555/golang-gin-serving-json-and-static-files-in-the-same-app/42500582#42500582", "title": "Golang gin: serving JSON and static files in the same app", "body": "<p>Place files in respective folder (e.g. <code>.css</code> files in css folder, <code>.js</code> files in js folder etc) and place all these folders in assets folder. And use</p>\n\n<pre><code>router := gin.Default()\nrouter.Static(\"/assets\", \"./assets\") \n</code></pre>\n\n<p>Your end points will be <code>http://myapp.com/assets/js/app.js</code>, or <code>http://myapp.com/assets/css/style.css</code>\n<a href=\"https://github.com/gin-gonic/gin#serving-static-files\" rel=\"nofollow noreferrer\">check documentation</a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 14132072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5249eb9914a07e54574dd378a166ea4?s=128&d=identicon&r=PG&f=1", "display_name": "Ante Zovko", "link": "https://stackoverflow.com/users/14132072/ante-zovko"}, "is_accepted": false, "score": 1, "last_activity_date": 1597876143, "last_edit_date": 1597876143, "creation_date": 1597875637, "answer_id": 63495717, "question_id": 42498555, "link": "https://stackoverflow.com/questions/42498555/golang-gin-serving-json-and-static-files-in-the-same-app/63495717#63495717", "title": "Golang gin: serving JSON and static files in the same app", "body": "<pre><code>go get https://github.com/gin-contrib/static\n</code></pre>\n<p>Then import it:</p>\n<pre><code>import (\n\n &quot;github.com/gin-contrib/static&quot;\n  \n )\n</code></pre>\n<p>Use this:</p>\n<pre><code>router.Use(static.Serve(&quot;/assets&quot;, static.LocalFile(&quot;./templates&quot;, false)))\n</code></pre>\n<p>Create a css and js folder inside templates and place the .css and .js files there</p>\n<pre><code>  &lt;link rel=&quot;stylesheet&quot; href=&quot;/assets/css/{FileName}.css&quot;&gt;\n</code></pre>\n<p>To load the .css file</p>\n<p>NOTE: It won't work without the &quot;/&quot; before &quot;assets&quot;</p>\n"}], "owner": {"reputation": 63, "user_id": 6363142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44575e1c78190bb261b4c1d3d3343ce6?s=128&d=identicon&r=PG&f=1", "display_name": "YCSeattle", "link": "https://stackoverflow.com/users/6363142/ycseattle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9089, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1597876143, "creation_date": 1488243536, "question_id": 42498555, "link": "https://stackoverflow.com/questions/42498555/golang-gin-serving-json-and-static-files-in-the-same-app", "title": "Golang gin: serving JSON and static files in the same app", "body": "<p>I am writing a golang gin app that serve both REST API and static files. Ideally I should separate the backend and front-end logic but for this case I have to put them together. For example, the top-level path of the API is wild-card, like <a href=\"http://myapp.com/\" rel=\"nofollow noreferrer\">http://myapp.com/</a>{username}/{topic}, and this same endpoint can also serve a few reserved static resources like <a href=\"http://myapp.com/js/app.js\" rel=\"nofollow noreferrer\">http://myapp.com/js/app.js</a>, or <a href=\"http://myapp.com/css/style.css\" rel=\"nofollow noreferrer\">http://myapp.com/css/style.css</a>.</p>\n\n<p>I understand this is not the best practice and I should separate the front-end code, but there are some other non-technical challenges in my case. Gin has a way to serve static files from a folder, but I would like to serve specific \"reserved\" path that point to a few known resources (JS, CSS, fonts, etc). How can I do that with GIN? </p>\n\n<p>I can use the Gin template to serve the index.html, but couldn't figure out how to do it with the rest of the resources.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 5672998, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/a4a74f22f8443f4b8dad6de6e2f413a9?s=128&d=identicon&r=PG&f=1", "display_name": "user5672998", "link": "https://stackoverflow.com/users/5672998/user5672998"}, "edited": false, "score": 0, "creation_date": 1488227684, "post_id": 42494926, "comment_id": 72129676, "body": "thanks; I read the doc again, just realized the <code>func (z *Float) SetInt(x *Int) *Float</code> is exactly what I need"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 1, "creation_date": 1488278377, "post_id": 42494926, "comment_id": 72150475, "body": "You can also use <code>big.Rat</code> to do the division by duration you mentioned, depending on how worried you are about accuracy."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 12, "last_activity_date": 1488226410, "creation_date": 1488226410, "answer_id": 42494926, "question_id": 42494690, "link": "https://stackoverflow.com/questions/42494690/how-to-convert-golang-math-big-int-to-float/42494926#42494926", "title": "how to convert golang math/big int to float?", "body": "<p>You can convert a <code>big.Int</code> to a <code>big.Float</code> using the <a href=\"https://golang.org/pkg/math/big/#Float.SetInt\" rel=\"noreferrer\"><code>Float.SetInt</code></a> method.</p>\n\n<pre><code>i := big.NewInt(12345)\nf := new(big.Float).SetInt(i)\n</code></pre>\n\n<p>Then you can either convert <code>f</code> as a float64 with the accepted accuracy, or use the <code>big.Float</code> methods to calculate the output with greater accuracy. </p>\n"}], "owner": {"reputation": 604, "user_id": 5672998, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/a4a74f22f8443f4b8dad6de6e2f413a9?s=128&d=identicon&r=PG&f=1", "display_name": "user5672998", "link": "https://stackoverflow.com/users/5672998/user5672998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6365, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1488226410, "creation_date": 1488225606, "question_id": 42494690, "link": "https://stackoverflow.com/questions/42494690/how-to-convert-golang-math-big-int-to-float", "title": "how to convert golang math/big int to float?", "body": "<p>I'm using the golang's bigint as counters for a long run service where the statistics counters might overflow a regular uint64 over long run; but occasionally I need to calculate something like what's the average rate since program beginning? need a division like <code>float(bigint) / time.Since(beginning).Seconds()</code>; the precision losing of conversion is acceptable in the rate calculation</p>\n\n<p><a href=\"https://golang.org/pkg/math/big/#Int.Uint64\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/big/#Int.Uint64</a></p>\n\n<p>but this kind of <code>float64(bigint)</code> doesn't work actually, I see the library has 'bigint.Uint64()' conversion but it's undefined if overflowed a regular uint64; I wonder why the standard library doesn't provide a to <code>.Float64()</code> method? and is there any workaround how to get a float</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 15, "last_activity_date": 1488224992, "last_edit_date": 1488224992, "creation_date": 1488224645, "answer_id": 42494434, "question_id": 42494333, "link": "https://stackoverflow.com/questions/42494333/appending-to-go-lang-slice-using-reflection/42494434#42494434", "title": "Appending to go lang slice using reflection", "body": "<p><code>reflect.Append</code> works like <code>append</code> in that it returns a new slice value.</p>\n\n<p>You are assigning this value to the <code>value</code> variable in the <code>appendToSlice</code> function, which replaces the previous <code>reflect.Value</code>, but does not update the original argument. </p>\n\n<p>To make it more clear what's happening, take the equivalent function to your example without reflection:</p>\n\n<pre><code>func appendToSlice(arrPtr *[]int) {\n    value := *arrPtr\n    value = append(value, 55)\n    fmt.Println(len(value))\n}\n</code></pre>\n\n<p>What you need to use is the <code>Value.Set</code> method to update the original value:</p>\n\n<pre><code>func appendToSlice(arrPtr interface{}) {\n    valuePtr := reflect.ValueOf(arrPtr)\n    value := valuePtr.Elem()\n\n    value.Set(reflect.Append(value, reflect.ValueOf(55)))\n\n    fmt.Println(value.Len())\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Nhabg31Sju\" rel=\"noreferrer\">https://play.golang.org/p/Nhabg31Sju</a></p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 6378104, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-M7JdNT488oQ/AAAAAAAAAAI/AAAAAAAAA-M/CR3Subj7QDQ/photo.jpg?sz=128", "display_name": "Rafael Reis", "link": "https://stackoverflow.com/users/6378104/rafael-reis"}, "is_accepted": false, "score": 2, "last_activity_date": 1551282619, "creation_date": 1551282619, "answer_id": 54909356, "question_id": 42494333, "link": "https://stackoverflow.com/questions/42494333/appending-to-go-lang-slice-using-reflection/54909356#54909356", "title": "Appending to go lang slice using reflection", "body": "<pre><code>    package main\n\n    import \"fmt\"\n    import \"reflect\"\n\n    type Foo struct {\n        Name string\n    }\n\n    func main() {\n        _type := []Foo{}\n\n        fmt.Printf(\"_type: v(%v) T(%T)\\n\", _type, _type)\n\n        reflection := reflect.MakeSlice(reflect.SliceOf(reflect.TypeOf(_type).Elem()), 0, 0)\n\n        reflectionValue := reflect.New(reflection.Type())\n        reflectionValue.Elem().Set(reflection)\n\n        slicePtr := reflect.ValueOf(reflectionValue.Interface())\n\n        sliceValuePtr := slicePtr.Elem()\n\n        sliceValuePtr.Set(reflect.Append(sliceValuePtr, reflect.ValueOf(Foo{\"a\"})))\n        sliceValuePtr.Set(reflect.Append(sliceValuePtr, reflect.ValueOf(Foo{\"b\"})))\n        sliceValuePtr.Set(reflect.Append(sliceValuePtr, reflect.ValueOf(Foo{\"c\"})))\n\n        values := []Foo{Foo{\"d\"}, Foo{\"e\"}}\n\n        for _, val := range values {\n            sliceValuePtr.Set(reflect.Append(sliceValuePtr, reflect.ValueOf(val)))\n        }\n\n        result := sliceValuePtr.Interface()\n\n        fmt.Printf(\"result: %T = (%v)\\n\", result, result)\n    }\n\n</code></pre>\n\n<p>take a look at: <a href=\"https://play.golang.org/p/vXOqTVSEleO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vXOqTVSEleO</a></p>\n"}], "owner": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6765, "favorite_count": 1, "accepted_answer_id": 42494434, "answer_count": 2, "score": 5, "last_activity_date": 1551282619, "creation_date": 1488224353, "question_id": 42494333, "link": "https://stackoverflow.com/questions/42494333/appending-to-go-lang-slice-using-reflection", "title": "Appending to go lang slice using reflection", "body": "<p>For some reason, it appears that adding new element to slice using reflection doesn't update slice itself. This is the code to demonstrate:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc appendToSlice(arrPtr interface{}) {\n    valuePtr := reflect.ValueOf(arrPtr)\n    value := valuePtr.Elem()\n    value = reflect.Append(value, reflect.ValueOf(55))\n\n    fmt.Println(value.Len()) // prints 1\n}\n\nfunc main() {\n    arr := []int{}\n    appendToSlice(&amp;arr)\n    fmt.Println(len(arr)) // prints 0\n}\n</code></pre>\n\n<p>Playground link : <a href=\"https://play.golang.org/p/j3532H_mUL\" rel=\"noreferrer\">https://play.golang.org/p/j3532H_mUL</a></p>\n\n<p>Is there something I'm missing here?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 364, "user_id": 802848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ipX9p.jpg?s=128&g=1", "display_name": "Elya Livshitz", "link": "https://stackoverflow.com/users/802848/elya-livshitz"}, "edited": false, "score": 2, "creation_date": 1540400481, "post_id": 42493010, "comment_id": 92855246, "body": "Or, even better: <code>go run *.go</code> to include all"}, {"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "reply_to_user": {"reputation": 364, "user_id": 802848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ipX9p.jpg?s=128&g=1", "display_name": "Elya Livshitz", "link": "https://stackoverflow.com/users/802848/elya-livshitz"}, "edited": false, "score": 0, "creation_date": 1544479656, "post_id": 42493010, "comment_id": 94283329, "body": "True, unless you have other go files with conflicting function names, typically, another file with a <code>main()</code> function"}], "tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": true, "score": 11, "last_activity_date": 1488219551, "creation_date": 1488219551, "answer_id": 42493010, "question_id": 42492891, "link": "https://stackoverflow.com/questions/42492891/call-function-from-another-file/42493010#42493010", "title": "Call function from another file", "body": "<p>You probably ran your code with <code>go run main.go</code> that only compiles and runs <code>main.go</code> try running <code>go run main.go uniqueElement.go</code> or building and running the binary generated</p>\n"}, {"comments": [{"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 3, "creation_date": 1488224239, "post_id": 42493967, "comment_id": 72127778, "body": "The files are in the same package, so he is able to access unexported functions"}], "tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 1, "last_activity_date": 1488222941, "creation_date": 1488222941, "answer_id": 42493967, "question_id": 42492891, "link": "https://stackoverflow.com/questions/42492891/call-function-from-another-file/42493967#42493967", "title": "Call function from another file", "body": "<p>Change the name from <code>unique</code> to <code>Unique</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1258, "user_id": 9744452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n38HV.jpg?s=128&g=1", "display_name": "Daria Yu", "link": "https://stackoverflow.com/users/9744452/daria-yu"}, "is_accepted": false, "score": 1, "last_activity_date": 1582433724, "creation_date": 1582433724, "answer_id": 60359305, "question_id": 42492891, "link": "https://stackoverflow.com/questions/42492891/call-function-from-another-file/60359305#60359305", "title": "Call function from another file", "body": "<p>The following codes work for me:</p>\n\n<pre><code>//module github.com/go-restful/article\n\npackage article\n\nfunc IndexPage(w http.ResponseWriter, r *http.Request) {}\n</code></pre>\n\n<blockquote>\n  <p>This func must be Exported, <strong>Capitalized</strong>, and Comment added</p>\n</blockquote>\n\n<p>The use in main.go</p>\n\n<pre><code>//module github.com/go-restful\n\npackage main\n\nimport (article \"github.com/go-restful/article\")\n\nfunc handleRequests() {\n    myRouter := mux.NewRouter().StrictSlash(true)\n    myRouter.HandleFunc(\"/\", article.IndexPage)\n}\n</code></pre>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7101, "favorite_count": 0, "accepted_answer_id": 42493010, "answer_count": 3, "score": 3, "last_activity_date": 1582433724, "creation_date": 1488219166, "question_id": 42492891, "link": "https://stackoverflow.com/questions/42492891/call-function-from-another-file", "title": "Call function from another file", "body": "<p>Inside my directory <code>/go/src/lodo</code> I have two files, main.go and uniqueElement.</p>\n\n<p>uniqueElement.go</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc unique(a []int) {\n    var value int\n\n    for i:= range a {\n        value = value ^ a[i]\n\n    }\n    fmt.Println(value)\n\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nfunc main() {\n    var a = []int{1, 4, 2, 1, 3, 4, 2}\n\n\n    unique(a[0:])\n}\n</code></pre>\n\n<p>I get an error </p>\n\n<pre><code>./main.go:7: undefined: unique\n</code></pre>\n\n<p>How can I correctly call unique from <code>main</code>?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1488220274, "post_id": 42492123, "comment_id": 72125591, "body": "Yes, but why would you need to/want to? Functions are first class, even though I should check the assembly, they probably behave more like reference types than data."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1488220702, "post_id": 42492123, "comment_id": 72125863, "body": "@EliasVanOotegem: you may want to be able to pass a function pointer as an argument to be set. It&#39;s a similar situation as when you need a pointer to a pointer."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488220794, "post_id": 42492123, "comment_id": 72125915, "body": "@JimB: Fair enough: setting a value on a pointer argument. But go has multiple return values, I hardly ever set values on arguments because I can just return 2 or 3 values if I really want/need to. And the OP is specifically asking about <i>returning</i> a pointer to a function"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1488217921, "creation_date": 1488217921, "answer_id": 42492519, "question_id": 42492123, "link": "https://stackoverflow.com/questions/42492123/go-is-it-possible-to-return-pointer-to-a-function/42492519#42492519", "title": "Go: is it possible to return pointer to a function", "body": "<p>Yes, as long as you convert the types correctly:</p>\n\n<p><a href=\"https://play.golang.org/p/3R5pPqr_nW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3R5pPqr_nW</a></p>\n\n<pre><code>type intFunc func(int) int\n\nvar t = func() *intFunc {\n    a := intFunc(func(b int) int { return b })\n    return &amp;a\n}\n\nfunc main() {\n    fmt.Println((*t())(2))\n}\n</code></pre>\n\n<p>And without the named type:</p>\n\n<p><a href=\"https://play.golang.org/p/-5fiMBa7e_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-5fiMBa7e_</a></p>\n\n<pre><code>var t = func() *func(int) int {\n    a := func(b int) int { return b }\n    return &amp;a\n}\n\nfunc main() {\n    fmt.Println((*t())(2))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 670354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd36f72799f7257883c0b4092bb10574?s=128&d=identicon&r=PG", "display_name": "Alec Missine", "link": "https://stackoverflow.com/users/670354/alec-missine"}, "is_accepted": false, "score": 1, "last_activity_date": 1581270332, "creation_date": 1581270332, "answer_id": 60139484, "question_id": 42492123, "link": "https://stackoverflow.com/questions/42492123/go-is-it-possible-to-return-pointer-to-a-function/60139484#60139484", "title": "Go: is it possible to return pointer to a function", "body": "<p>Accessing other packages:</p>\n\n<p><a href=\"https://play.golang.org/p/X20RtgpEzqL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/X20RtgpEzqL</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar f = fmt.Println\nvar p2f = &amp;f\n\nfunc main() {\n    (*p2f)(\"it works\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1183, "user_id": 1601963, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/3046b114b4e77be4f3b53f98cf124ce2?s=128&d=identicon&r=PG", "display_name": "pinker", "link": "https://stackoverflow.com/users/1601963/pinker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1262, "favorite_count": 0, "accepted_answer_id": 42492519, "answer_count": 2, "score": 2, "last_activity_date": 1581270332, "creation_date": 1488216658, "question_id": 42492123, "link": "https://stackoverflow.com/questions/42492123/go-is-it-possible-to-return-pointer-to-a-function", "title": "Go: is it possible to return pointer to a function", "body": "<p>For the following code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype intFunc func(int) int\n\nvar t = func() intFunc {\n        a := func(b int) int { return b}\n        return a\n    }\n\nfunc main() {\n    fmt.Println(t()(2))\n   }\n</code></pre>\n\n<p>Is there a way to return the pointer to the function instead of the function directly? (something like <code>return &amp;a</code>)?</p>\n\n<p>The playground is here: <a href=\"https://play.golang.org/p/IobCtRjVVX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IobCtRjVVX</a></p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "is_accepted": false, "score": 4, "last_activity_date": 1488222234, "last_edit_date": 1488222234, "creation_date": 1488221913, "answer_id": 42493679, "question_id": 42492020, "link": "https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go/42493679#42493679", "title": "Concurrency in gopkg.in/mgo.v2 (Mongo, Go)", "body": "<p>Calling <code>Dial</code> or <code>DialWithTimeout</code> or <code>DialWithInfo</code> will establish the connection pool. If you need more than one session then you need to call session.Copy() or session.New(), session.Copy() is preferred since it will retain the auth. Here is an example:</p>\n\n<p>Lets say you have a <code>UserService</code> struct to handle all your user db needs. Note this is from the top of my head so there might be a few syntax errors but the idea is there.</p>\n\n<pre><code>type Userservice struct {\n    DB *mgo.Session\n}\n\nfunc (s *Userservice) Create(u *User) error {\n    sessionCopy := s.DB.Copy()\n    defer sessionCopy.Close()\n\n    db := sessionCopy.DB(\"test_db\")\n    col := db.C(\"users\")\n\n    if err := col.Insert(u); err != nil {\n        return err\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1504688410, "last_edit_date": 1504688410, "creation_date": 1488228648, "answer_id": 42495522, "question_id": 42492020, "link": "https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go/42495522#42495522", "title": "Concurrency in gopkg.in/mgo.v2 (Mongo, Go)", "body": "<p>The <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session\" rel=\"nofollow noreferrer\"><code>mgo.Session</code></a> is safe for concurrent use. Quoting from its doc:</p>\n\n<blockquote>\n  <p>All Session methods are concurrency-safe and may be called from multiple goroutines.</p>\n</blockquote>\n\n<p>But this doesn't mean you should not create and use more of them in parallel, by calling <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Copy\" rel=\"nofollow noreferrer\"><code>Session.Copy()</code></a> or <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Clone\" rel=\"nofollow noreferrer\"><code>Session.Clone()</code></a>, on the initial session obtained at dial time.</p>\n\n<p>Being concurrency-safe and having benefit from using more of them do not exclude each other (they are not <em>mutually exclusive</em>). While you may use a single <code>mgo.Session</code> from arbitrary number of goroutines, that will not scale well, that will not scale <em>at all</em>. Sessions automatically manage a pool of connections, maybe even to multiple server nodes, but if you're using a single <code>Session</code>, you're not taking advantage of that. By creating a new <code>Session</code> at the start of each of your request (if needed), and properly closing it at the end (with <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Close\" rel=\"nofollow noreferrer\"><code>Session.Close()</code></a>; preferably called using <code>defer</code>), you are taking advantage of potentially using multiple connections at the same time, possibly to multiple server nodes (if available), and thus better utilizing server resources; and getting faster response times (both from the database, and ultimately to your HTTP end users). Calling <code>Session.Close()</code> does not close the underlying connection to the server, it will just put the connection back to the pool, ready to be picked up by  another session.</p>\n\n<p>Also see related question about the use of <code>Session</code>s: <a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a></p>\n"}], "owner": {"reputation": 5886, "user_id": 525454, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b7b15a5eff92731ac38f4c917d9d169d?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/525454/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1915, "favorite_count": 1, "accepted_answer_id": 42495522, "answer_count": 2, "score": 8, "last_activity_date": 1504688410, "creation_date": 1488216325, "last_edit_date": 1488228986, "question_id": 42492020, "link": "https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go", "title": "Concurrency in gopkg.in/mgo.v2 (Mongo, Go)", "body": "<p>I wish to use MongoDB in webapp written in Go.</p>\n\n<p>Can I have one <code>mgo.Session</code> and use it concurrently in web app. e.g. in <code>http.Handler</code> </p>\n\n<p>or should I call <code>Session.Copy</code> and <code>Session.Close</code> -> make pool of sessions.</p>\n\n<p>It sounds contradictory somewhere I read that pool is already implemented inside of <code>mgo.Session</code> and I can use session concurrently and in other places I read that I need <code>Copy</code> and <code>Close</code>.</p>\n"}, {"tags": ["xml", "go", "struct", "nested"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1488227521, "last_edit_date": 1488227521, "creation_date": 1488210013, "answer_id": 42489782, "question_id": 42489564, "link": "https://stackoverflow.com/questions/42489564/directly-vs-indirectly-nested-structs/42489782#42489782", "title": "Directly vs indirectly nested structs", "body": "<p>When you do this:</p>\n\n<pre><code>type C struct {\n    D\n}\n</code></pre>\n\n<p>This is called <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">embedding</a> (<code>D</code> is an <em>anonymous</em> field or <em>embedded</em> field). You may think of this as if the fields (and methods) of the embedded type become part of the embedder type (they get <em>promoted</em>). So in this case it's \"legal\" to write <code>C.E</code> and <code>C.F</code>.</p>\n\n<p>When you do:</p>\n\n<pre><code>type C struct {\n    D struct {\n      E string\n      F int\n    }\n}\n</code></pre>\n\n<p>This is <em>not</em> embedding (or \"nesting\"). Here <code>D</code> is a \"regular\", <em>named</em> field of the <code>C</code> type. <code>D</code> is the name of the field, which is followed by an anonymous <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">type literal</a>, the type of the field. Here it is not legal to write <code>C.E</code> nor <code>C.F</code>, only <code>C.D.E</code> and <code>C.D.F</code>. And this is the proper mapping of the XML structure you try to unmarshal, hence this works (try it on the <a href=\"https://play.golang.org/p/VNULprMYcW\" rel=\"nofollow noreferrer\">Go Playground</a>).</p>\n\n<p>Note that if you change the embedding to a regular field, it will also work (try it on the <a href=\"https://play.golang.org/p/RsIDF8sZic\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type C struct {\n    D D\n}\n</code></pre>\n\n<p>Also note that you can skip the whole <code>D</code> wrapper struct if you specify the XML element paths in the field tags:</p>\n\n<pre><code>type C struct {\n    E string `xml:\"D&gt;E\"`\n    F int    `xml:\"D&gt;F\"`\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/BMQIaNSMXA\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 42489782, "answer_count": 1, "score": 6, "last_activity_date": 1488227521, "creation_date": 1488209405, "last_edit_date": 1488210756, "question_id": 42489564, "link": "https://stackoverflow.com/questions/42489564/directly-vs-indirectly-nested-structs", "title": "Directly vs indirectly nested structs", "body": "<p>In the Go <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\">documentation for xml:Unmarshal</a> there is an example that unmarshals this xml</p>\n\n<pre><code>    &lt;Person&gt;\n        &lt;FullName&gt;Grace R. Emlin&lt;/FullName&gt;\n        &lt;Company&gt;Example Inc.&lt;/Company&gt;\n        &lt;Email where=\"home\"&gt;\n            &lt;Addr&gt;gre@example.com&lt;/Addr&gt;\n        &lt;/Email&gt;\n        &lt;Email where='work'&gt;\n            &lt;Addr&gt;gre@work.com&lt;/Addr&gt;\n        &lt;/Email&gt;\n        &lt;Group&gt;\n            &lt;Value&gt;Friends&lt;/Value&gt;\n            &lt;Value&gt;Squash&lt;/Value&gt;\n        &lt;/Group&gt;\n        &lt;City&gt;Hanga Roa&lt;/City&gt;\n        &lt;State&gt;Easter Island&lt;/State&gt;\n    &lt;/Person&gt;\n</code></pre>\n\n<p>using these structs</p>\n\n<pre><code>    type Address struct {\n        City, State string\n    }\n    type Result struct {\n        XMLName xml.Name `xml:\"Person\"`\n        Name    string   `xml:\"FullName\"`\n        Phone   string\n        Email   []Email\n        Groups  []string `xml:\"Group&gt;Value\"`\n        Address\n    }\n</code></pre>\n\n<p>Note that <code>Result</code> contains a reference to the separately defined <code>Address</code>. Obviously, this code works.</p>\n\n<hr>\n\n<p>When I try to unmarshal this xml</p>\n\n<pre><code>&lt;C&gt;\n  &lt;D&gt;\n    &lt;E&gt;Fred&lt;/E&gt;\n    &lt;F&gt;42&lt;/F&gt;\n  &lt;/D&gt;\n&lt;/C&gt;\n</code></pre>\n\n<p>using these structs</p>\n\n<pre><code>type D struct { \n  E string\n  F int\n}\ntype C struct {   // Compiles OK but result empty.\n  D \n} \n</code></pre>\n\n<p>I get empty results <code>{{ 0}}</code>. However the struct below works OK producing <code>{{Fred 42}}</code></p>\n\n<pre><code>type C struct {   // This works.\n  D struct { \n    E string\n    F int\n  }\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/acgMALHFrT\" rel=\"nofollow noreferrer\">Playground example</a>.</p>\n\n<p>Am I missing some subtle point about structs?</p>\n"}, {"tags": ["go", "cassandra", "gocql"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 2, "creation_date": 1488220518, "post_id": 42487166, "comment_id": 72125749, "body": "1) Why do you keep closing the session? 2) Have you tried upping the timeout by setting a higher timout value on the <code>gocql.ClusterConfig</code> (<code>cluster.Timeout</code>)? 3) <code>session, _ := cluser.CreateSession()</code> &lt;-- <i>use</i> the error value this returns to find out more. 4) Acutally: Why are you using the same <code>gocql.ClusterConfig</code> every time to create a new session? It&#39;s clear the session wasn&#39;t created, but because you don&#39;t check for errors, and just blindly <code>defer session.Close()</code> you end up calling <code>Close</code> on a <code>nil</code> pointer, resulting in a runtime panic"}, {"owner": {"reputation": 43, "user_id": 1745156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/391c900a94e6b499ccea0a749b98d5a2?s=128&d=identicon&r=PG", "display_name": "mdaliyan", "link": "https://stackoverflow.com/users/1745156/mdaliyan"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1488261240, "post_id": 42487166, "comment_id": 72140680, "body": "4) gocql.ClusterConfig is just a struct that keeps my clusterconfig, why should i bother create it every time ( correct me if I misunderstood it) 3) the error returns just the same error i pasted in question. 2) yes 1) I can&#39;t get it. examples keep doing that. is it possible not to close it? interesting idea. thanks. i&#39;ll give it a try"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1488286507, "post_id": 42487166, "comment_id": 72155917, "body": "4) Missed the fact that <code>cluster</code> was a global, my mistake. 3) I don&#39;t see any gocql errors in your question, just a runtime panic. 2) That closes down that route then :P, 1) All gocql examples basically give you an overview of the flow, but you can keep a session open as long as you want to/need to. Of course, connections can (and will) be lost, make sure to check for <code>session</code> to be still valid/connected. If you lose the connection, then make sure to reconnect or gracefully exit"}, {"owner": {"reputation": 43, "user_id": 1745156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/391c900a94e6b499ccea0a749b98d5a2?s=128&d=identicon&r=PG", "display_name": "mdaliyan", "link": "https://stackoverflow.com/users/1745156/mdaliyan"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1488606715, "post_id": 42487166, "comment_id": 72316890, "body": "yes, that was not an error. it was just a break point for the app under pressure. but that situation could not be avoided, even with some retry functionality. anyways... your suggestion worked well. I created a global session and stopped closing it and boom, I got no panic error. And wrk couldn&#39;t break anything down. thanks for your advice. @EliasVanOotegem"}], "owner": {"reputation": 43, "user_id": 1745156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/391c900a94e6b499ccea0a749b98d5a2?s=128&d=identicon&r=PG", "display_name": "mdaliyan", "link": "https://stackoverflow.com/users/1745156/mdaliyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 652, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488202552, "creation_date": 1488202552, "question_id": 42487166, "link": "https://stackoverflow.com/questions/42487166/gocql-gocql-fails-create-new-session-invalid-memory-address-or-nil-pointer-dere", "title": "gocql/gocql fails create new session: invalid memory address or nil pointer dereference", "body": "<p>I'm working on a api written with Go, that has a main goal that it should answer the request as fast as possible. I came up with using goroutines. </p>\n\n<p>I test it with wrk with this command:</p>\n\n<pre><code>$ wrk -t1 -c200 -d1s http://127.0.0.1:8080    \n// this passes\n...\n21efef3\n21efef3\n21efef3\n21efef3\n21efef3\n21efef3\n21efef3\n...\n\n$ wrk -t1 -c400 -d1s http://127.0.0.1:8080\n// this test fails with this error returned in go terminal\n...\n21efef3\n21efef3\n21efef3\n21efef3\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x6ada46]\n\ngoroutine 2325 [running]:\ngithub.com/gocql/gocql.(*Session).Close(0x0)\n/home/mda/.local/go/src/github.com/gocql/gocql/session.go:336 +0x26\npanic(0x707f40, 0x8ed650)\n/usr/lib/go-1.8/src/runtime/panic.go:489 +0x2cf\ngithub.com/gocql/gocql.(*Session).Query(0x0, 0x777d4c, 0x34, 0xc428cfd190, 0x1, 0x1, 0x0)\n/home/mda/.local/go/src/github.com/gocql/gocql/session.go:294 +0x26\nmain.getData()\n/home/mda/code/api-go/main2.go:45 +0x1f6\ncreated by main.main.func1\n/home/mda/code/api-go/main2.go:18 +0x39\nexit status 2\n\nProcess finished with exit code 1\n</code></pre>\n\n<p>Cassandra seems to work fine</p>\n\n<pre><code>$ cassandra-stress read n=200000 -pop seq=1..200000 -rate threads=200 -node 127.0.0.1\n\nResults:\nOp rate                   :   14,090 op/s  [READ: 14,090 op/s]\nPartition rate            :   14,090 pk/s  [READ: 14,090 pk/s]\nRow rate                  :   14,090 row/s [READ: 14,090 row/s]\nLatency mean              :   14.1 ms [READ: 14.1 ms]\nLatency median            :    9.7 ms [READ: 9.7 ms]\nLatency 95th percentile   :   39.4 ms [READ: 39.4 ms]\nLatency 99th percentile   :   72.1 ms [READ: 72.1 ms]\nLatency 99.9th percentile :  218.1 ms [READ: 218.1 ms]\nLatency max               :  346.8 ms [READ: 346.8 ms]\nTotal partitions          :    200,000 [READ: 200,000]\nTotal errors              :          0 [READ: 0]\nTotal GC count            : 14\nTotal GC memory           : 4.346 GiB\nTotal GC time             :    0.4 seconds\nAvg GC time               :   31.9 ms\nStdDev GC time            :    9.4 ms\nTotal operation time      : 00:00:14\n</code></pre>\n\n<p>This is a simplified version of my Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"github.com/buaazp/fasthttprouter\"\n    \"github.com/valyala/fasthttp\"\n    \"github.com/valyala/fasthttp/reuseport\"\n    \"github.com/gocql/gocql\"\n)\n\nvar cluster *gocql.ClusterConfig\n\nfunc main() {\n    router := fasthttprouter.New()\n\n    router.GET(\"/\", func(ctx *fasthttp.RequestCtx) {\n\n        // We need this goroutine\n        go getData()\n        fmt.Fprint(ctx, \"Welcome to home!\")\n        ctx.Response.Header.ConnectionClose()\n    })\n\n    ln, err := reuseport.Listen(\"tcp4\", \":8080\")\n    if err != nil {\n        log.Fatalf(\"error in reuseport listener: %s\", err)\n    }\n\n    if err = fasthttp.Serve(ln, router.Handler); err != nil {\n        log.Fatalf(\"error in fasthttp Server: %s\", err)\n    }\n}\n\nfunc setup_cluster() {\n    cluster = gocql.NewCluster(\"127.0.0.1:9042\")\n\n    cluster.Keyspace = \"myKeySpace\"\n    cluster.Consistency = gocql.One\n}\n\nfunc getData() {\n    if cluster == nil {\n        setup_cluster()\n    }\n    session, _ := cluster.CreateSession()\n    defer session.Close()\n\n    var id string\n    var value string\n\n    if err := session.Query(`SELECT id, ads FROM product_ads \n        WHERE id = ? LIMIT 1`,\n        \"213\").Consistency(gocql.One).Scan(&amp;id, &amp;value); err != nil {\n        log.Fatal(err)\n    }\n\n    // ... do some stuff with id &amp; value\n    fmt.Println(value)\n\n}\n</code></pre>\n\n<p>here is the process limits of my go code and cassandra, they have the same values set for different users:</p>\n\n<pre><code>Limit                     Soft Limit           Hard Limit           Units\nMax cpu time              unlimited            unlimited            seconds\nMax file size             unlimited            unlimited            bytes\nMax data size             unlimited            unlimited            bytes\nMax stack size            8388608              unlimited            bytes\nMax core file size        unlimited            unlimited            bytes\nMax resident set          unlimited            unlimited            bytes\nMax processes             32768                32768                processes\nMax open files            1000000              1000000              files\nMax locked memory         unlimited            unlimited            bytes\nMax address space         unlimited            unlimited            bytes\nMax file locks            unlimited            unlimited            locks\nMax pending signals       31265                31265                signals\nMax msgqueue size         819200               819200               bytes\nMax nice priority         0                    0\nMax realtime priority     0                    0\nMax realtime timeout      unlimited            unlimited            us\n</code></pre>\n\n<p>what do you suggest? why Go fails to create new session?</p>\n"}, {"tags": ["logging", "go", "panic"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488200328, "post_id": 42486194, "comment_id": 72112274, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/34772012/capturing-panic-in-golang\">Capturing panic() in golang</a>."}, {"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488200723, "post_id": 42486194, "comment_id": 72112522, "body": "I probably not explain myself right, I&#39;ve managed to capture the panic, my question is, is there an option to log the panic with a time stamp like in the expected result example, i can share my code if needed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1488201086, "post_id": 42486194, "comment_id": 72112783, "body": "If you used <code>recover()</code>, then you may execute a <code>print(time.Now().UTC().Format(&quot;2006-01-02T15:04:05.000Z - &quot;))</code> before logging the panic. Otherwise, I don&#39;t think so."}, {"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488202356, "post_id": 42486194, "comment_id": 72113706, "body": "I will try to use <code>recover()</code>, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1488223386, "post_id": 42491959, "comment_id": 72127317, "body": "better place your code above inside a recover() wrapper so that the OP can &quot;catch&quot; all the panics and log them to file.  Its a common pattern for web servers, but i&#39;m sure it will work here as well."}, {"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "edited": false, "score": 0, "creation_date": 1488361437, "post_id": 42491959, "comment_id": 72192278, "body": "How can i use the above example to catch all panics and log them to file with a time stamp?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1488382244, "post_id": 42491959, "comment_id": 72207106, "body": "I already had added a link to the go playground. This is the logic. Inside that logger a <code>bytes.Buffer</code> is used. Instead of printing you could write the output into a file. You could also use another <code>io.Writer</code> which writes direct into a file."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1488274004, "last_edit_date": 1488274004, "creation_date": 1488216129, "answer_id": 42491959, "question_id": 42486194, "link": "https://stackoverflow.com/questions/42486194/redirect-panic-output-to-a-file-with-timestamp-in-golang/42491959#42491959", "title": "Redirect panic output to a file with timestamp in golang", "body": "<p>It is possible to add a timestamp to your log file. </p>\n\n<p>Because the errors are also just values, you are able to do something before you panic.</p>\n\n<p>Just a simple example:</p>\n\n<pre><code>var buf bytes.Buffer\nlogger := log.New(&amp;buf, \"logger: \", log.Ldate|log.Ltime|log.Llongfile)\nlogger.Print(\"Error when calling that code\")\nfmt.Print(&amp;buf)\nlogger.Panic(\"Error\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/g4mweH4Dex\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g4mweH4Dex</a></p>\n\n<p>Here you should not panic as soon as your error occurs. You can write some more information inside your log. For example the parameters of your function or the values of the config file. </p>\n\n<p>With the correct flags inside your logger definition <code>log.Ldate|log.Ltime|log.Llongfile</code> you will also get a timestamp.</p>\n\n<p>Edited:\nThanks to reticentroot for the comment about the recover wrapper. The article <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">Defer, Panic and Recover</a> describes a way how to handle panicking. Here you can recover by using defer.</p>\n\n<pre><code>func main() {\n    myFunc()\n    fmt.Print(&amp;buf)\n}\n\nfunc myFunc() {\n    defer func() {\n        if r := recover(); r != nil {\n            logger.Println(\"Recovered from panic: \", r)\n        }\n    }()\n    myPanic()\n}\n\nfunc myPanic() {\n    panic(\"Panicking in myPanic\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8swGF1SoO_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8swGF1SoO_</a></p>\n"}], "owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1040, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488274004, "creation_date": 1488199665, "question_id": 42486194, "link": "https://stackoverflow.com/questions/42486194/redirect-panic-output-to-a-file-with-timestamp-in-golang", "title": "Redirect panic output to a file with timestamp in golang", "body": "<p>Is there any way to redirect output from panic to a file with a <strong>timestamp</strong> for each panic.</p>\n\n<p>Current example result of the panic log file:</p>\n\n<pre><code>goroutine 6 [running]:\n_/C_/....func\u00b7001(0x11691e80, 0x1a, 0x0, 0x0, 0x10d3550, 0x11691ec0, 0x0, 0x0)\nC:/.../Logger.go:309 +0x47\npath/filepath.Walk(0x11691e80, 0x1a, 0x1161defc, 0x0, 0x0)\nc:/...../path.go:392 +0x97\n_/C_/...../Logger.Sample(0x1168ac00, 0x59, 0x0, 0x0)\nC:/...../Logger.go:322 +0x1c5\nmain.handleFileActions()\nC:/...../main.go:453 +0x2ad\ncreated by main.main\nC:/..../main.go:278 +0x6ea\n</code></pre>\n\n<p>Expected result:</p>\n\n<pre><code>2017-02-27T14:24:22.627Z - goroutine 6 [running]:\n_/C_/....func\u00b7001(0x11691e80, 0x1a, 0x0, 0x0, 0x10d3550, 0x11691ec0, 0x0, 0x0)\nC:/.../Logger.go:309 +0x47\npath/filepath.Walk(0x11691e80, 0x1a, 0x1161defc, 0x0, 0x0)\nc:/...../path.go:392 +0x97\n_/C_/...../Logger.Sample(0x1168ac00, 0x59, 0x0, 0x0)\nC:/...../Logger.go:322 +0x1c5\nmain.handleFileActions()\nC:/...../main.go:453 +0x2ad\ncreated by main.main\nC:/..../main.go:278 +0x6ea\n</code></pre>\n"}, {"tags": ["sql", "validation", "go", "syntax"], "answers": [{"comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1572437747, "post_id": 42486344, "comment_id": 103557879, "body": "It only supports MySQL SQL"}], "tags": [], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "is_accepted": true, "score": 6, "last_activity_date": 1488200147, "creation_date": 1488200147, "answer_id": 42486344, "question_id": 42486032, "link": "https://stackoverflow.com/questions/42486032/golang-sql-query-syntax-validator/42486344#42486344", "title": "Golang SQL query syntax validator", "body": "<p>Finally, I found <a href=\"https://github.com/xwb1989/sqlparser\" rel=\"noreferrer\">this SQL parser</a> package. I colud use it for validate it.</p>\n\n<pre><code>func isSQLValid(sql string) (bool, error) {\n    _, err := sqlparser.Parse(sql)\n    if err != nil {\n        return false, err\n    }\n    return true, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1893, "favorite_count": 0, "closed_date": 1488208524, "accepted_answer_id": 42486344, "answer_count": 1, "score": 2, "last_activity_date": 1488200147, "creation_date": 1488199111, "question_id": 42486032, "link": "https://stackoverflow.com/questions/42486032/golang-sql-query-syntax-validator", "closed_reason": "Not suitable for this site", "title": "Golang SQL query syntax validator", "body": "<p>Is there any third-party tool for validate SQL query before I execute it with the database/sql pacakge or any way to check the SQL query is right without getting a panic from database/sql that the query is invalid? </p>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1488205888, "post_id": 42485404, "comment_id": 72116140, "body": "The fsnotify FAQ points to <a href=\"https://github.com/howeyc/fsnotify/issues/62\" rel=\"nofollow noreferrer\">github.com/howeyc/fsnotify/issues/62</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1844, "user_id": 929164, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nvMoW.jpg?s=128&g=1", "display_name": "Daniel Dubovski", "link": "https://stackoverflow.com/users/929164/daniel-dubovski"}, "is_accepted": true, "score": 0, "last_activity_date": 1488215873, "creation_date": 1488215873, "answer_id": 42491869, "question_id": 42485404, "link": "https://stackoverflow.com/questions/42485404/using-os-rename-to-move-file-triggers-create-then-chmod/42491869#42491869", "title": "using os.Rename to move file, triggers CREATE then CHMOD", "body": "<p>@JimB pointed me to the correct answer, this is a bug concerning with macOS spotlight indexing.</p>\n\n<p>If anyone want's to track this, <a href=\"https://github.com/fsnotify/fsnotify/issues/15#issuecomment-282775574\" rel=\"nofollow noreferrer\">reported bug</a></p>\n"}], "owner": {"reputation": 1844, "user_id": 929164, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nvMoW.jpg?s=128&g=1", "display_name": "Daniel Dubovski", "link": "https://stackoverflow.com/users/929164/daniel-dubovski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 42491869, "answer_count": 1, "score": 1, "last_activity_date": 1488215873, "creation_date": 1488197139, "last_edit_date": 1488197810, "question_id": 42485404, "link": "https://stackoverflow.com/questions/42485404/using-os-rename-to-move-file-triggers-create-then-chmod", "title": "using os.Rename to move file, triggers CREATE then CHMOD", "body": "<p>using go's os like so:</p>\n\n<pre><code>os.Rename(oldpath,newpath)\n</code></pre>\n\n<p>and watching the destination folder using <a href=\"https://github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">fsnotify</a></p>\n\n<p>causes 2 events to fire, <code>CREATE</code> and <code>CHMOD</code></p>\n\n<p>can't seem to understand why <code>CHMOD</code> is fired.</p>\n\n<ul>\n<li><p>tried listening with python's <a href=\"https://github.com/gorakhargosh/watchdog\" rel=\"nofollow noreferrer\">watchdog</a>\nshows 2 events as well, file creation and folder modification.</p></li>\n<li><p>parent folder perms are <code>0777</code> file perms are <code>0666</code> (default).</p></li>\n<li>I'm on macOS</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4332, "user_id": 900097, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ab2120ce9b4db5b17fe560affd85a612?s=128&d=identicon&r=PG", "display_name": "ekanna", "link": "https://stackoverflow.com/users/900097/ekanna"}, "edited": false, "score": 0, "creation_date": 1488209740, "post_id": 42485740, "comment_id": 72118844, "body": "These two meta tags does the trick.   &lt;meta name=&quot;go-import&quot; content=&quot;goji.io git <a href=\"https://github.com/goji/goji\" rel=\"nofollow noreferrer\">github.com/goji/goji</a>&quot;&gt;  &lt;meta name=&quot;go-source&quot; content=&quot;goji.io <a href=\"https://github.com/goji/goji/\" rel=\"nofollow noreferrer\">github.com/goji/goji</a> <a href=\"https://github.com/goji/goji/tree/master\" rel=\"nofollow noreferrer\">github.com/goji/goji/tree/master</a>{/dir} <a href=\"https://github.com/goji/goji/blob/master\" rel=\"nofollow noreferrer\">github.com/goji/goji/blob/master</a>{/dir}/{file}#L{line}&quot;&gt;   go-source tag is for GoDoc"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1488198146, "creation_date": 1488198146, "answer_id": 42485740, "question_id": 42485328, "link": "https://stackoverflow.com/questions/42485328/git-url-mapping-to-custom-domain/42485740#42485740", "title": "Git url mapping to custom domain", "body": "<p><a href=\"https://elithrar.github.io/article/custom-import-urls-github-pages-jekyll/\" rel=\"nofollow noreferrer\">This post</a> seems to explain the process.  The short version is:</p>\n\n<ol>\n<li>Set up a CNAME for your custom domain.</li>\n<li>Add special HTML markup to your web page.</li>\n</ol>\n"}], "owner": {"reputation": 4332, "user_id": 900097, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ab2120ce9b4db5b17fe560affd85a612?s=128&d=identicon&r=PG", "display_name": "ekanna", "link": "https://stackoverflow.com/users/900097/ekanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 1, "accepted_answer_id": 42485740, "answer_count": 1, "score": 3, "last_activity_date": 1488198644, "creation_date": 1488196930, "last_edit_date": 1488198644, "question_id": 42485328, "link": "https://stackoverflow.com/questions/42485328/git-url-mapping-to-custom-domain", "title": "Git url mapping to custom domain", "body": "<p>How to map github url to custom domain?</p>\n\n<p>Example:</p>\n\n<p>I saw below url mapping</p>\n\n<blockquote>\n  <p>go get github.com/goji/goji</p>\n</blockquote>\n\n<p>to this url?</p>\n\n<blockquote>\n  <p>go get goji.io</p>\n</blockquote>\n\n<p>Do they host a replica or DNS redirection?</p>\n\n<p>In golang, we import repositories using url path. If we use a custom domain,\nwe need not rewrite import paths when we change repository hosting, say from github.com to bitbucket or vice-versa</p>\n\n<p>So how to implement this?</p>\n"}, {"tags": ["java", "go", "jmx"], "answers": [{"comments": [{"owner": {"reputation": 397, "user_id": 1230410, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/186dada18b8cbe98d8d8d1a9ff299169?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#244;me B", "link": "https://stackoverflow.com/users/1230410/j%c3%a9r%c3%b4me-b"}, "edited": false, "score": 0, "creation_date": 1602060946, "post_id": 55162119, "comment_id": 113597516, "body": "This lib is a Jolokia wrapper, so it doesn&#39;t answer the question"}], "tags": [], "owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "is_accepted": false, "score": 1, "last_activity_date": 1552565108, "creation_date": 1552565108, "answer_id": 55162119, "question_id": 42483968, "link": "https://stackoverflow.com/questions/42483968/access-jmx-via-golang/55162119#55162119", "title": "Access JMX via Golang", "body": "<p>Don't know if there is a way to talk to JMX in golang without jolokia. I've done it using the golokia project which I forked and made some changes.</p>\n\n<p>Here it is, hope it helps.</p>\n\n<p><a href=\"https://github.com/joaoh82/golokia\" rel=\"nofollow noreferrer\">https://github.com/joaoh82/golokia</a></p>\n"}], "owner": {"reputation": 6535, "user_id": 67707, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/36b94c834b5153e693c17f13402f1123?s=128&d=identicon&r=PG", "display_name": "MrEvil", "link": "https://stackoverflow.com/users/67707/mrevil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2562, "favorite_count": 2, "answer_count": 1, "score": 8, "last_activity_date": 1552565108, "creation_date": 1488192946, "question_id": 42483968, "link": "https://stackoverflow.com/questions/42483968/access-jmx-via-golang", "title": "Access JMX via Golang", "body": "<p>I need to access JMX of a running process via TCP. I can't install third party utilities on the machine such as Jolokia to make JMX accessible via HTTP. Is there a library that will let Golang speak JMX or Java RMI? Has a JMX client been implemented in any non-JVM language that I can use as inspiration for a Golang port? Both read and write access would be preferable but I'll settle for read-only.</p>\n"}, {"tags": ["pointers", "go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1488188934, "post_id": 42480333, "comment_id": 72104571, "body": "Re your last statement - &quot;the overhead of calling into C is much bigger than allocating some memory and copying a string&quot; - do you have any benchmarks to back that up?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1488189627, "post_id": 42480333, "comment_id": 72105060, "body": "@Not_a_Golfer In fact, I do. From a year ago: <a href=\"https://github.com/art4711/cgo_overhead\" rel=\"nofollow noreferrer\">github.com/art4711/cgo_overhead</a>  If I get time I&#39;ll update it to 1.8."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1488190226, "post_id": 42480333, "comment_id": 72105470, "body": "Updated for 1.8. In 1.8 it&#39;s just 36 times slower instead of 92 times slower to make a cgo function call compared to a Go function call."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1488197826, "post_id": 42480333, "comment_id": 72110574, "body": "jesus! I wasn&#39;t aware it was so expensive. what causes this?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1488198781, "post_id": 42480333, "comment_id": 72111269, "body": "@Not_a_Golfer Many things. It needs to change the stack, many of the normal &quot;this function doesn&#39;t use stack&quot; optimizations are disabled, a bunch of stuff is run to make sure that we&#39;re not violating garbage collector rules (even when the C function takes no arguments), etc."}], "tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 2, "last_activity_date": 1488181771, "creation_date": 1488181771, "answer_id": 42480333, "question_id": 42479895, "link": "https://stackoverflow.com/questions/42479895/how-can-i-get-the-data-pointer-of-a-string-variable-in-go/42480333#42480333", "title": "how can I get the data pointer of a string variable in go?", "body": "<p>There are ways to get the underlying data from a Go string to C without copying it. It will not work as a C string because it is not a C string. Your printf will not work even if you manage to extract the pointer even if it happens to work sometimes. Go strings are not C strings. They used to be for compatibility when Go used more libc, they aren't anymore.</p>\n\n<p>Just follow the cgo manual and use <code>C.CString</code>. If you're fighting for efficiency you'll win much more by just not using cgo because the overhead of calling into C is much bigger than allocating some memory and copying a string.</p>\n"}], "owner": {"reputation": 21, "user_id": 949808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0e76e31e69e4fc46817922c474d6fd3?s=128&d=identicon&r=PG", "display_name": "Toby", "link": "https://stackoverflow.com/users/949808/toby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488192404, "creation_date": 1488180028, "last_edit_date": 1488192404, "question_id": 42479895, "link": "https://stackoverflow.com/questions/42479895/how-can-i-get-the-data-pointer-of-a-string-variable-in-go", "title": "how can I get the data pointer of a string variable in go?", "body": "<p>I want to get the data pointer of a string variable(like string::c_str() in c++) to pass to a c function and I found this doesn't work:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\nvoid Println(const char* str) {printf(\"%s\\n\", str);}\n*/\nimport \"C\"\n\nimport (\n    \"unsafe\"\n)\n\nfunc main() {\n    s := \"hello\"\n    C.Println((*C.char)(unsafe.Pointer(&amp;(s[0]))))\n}\n</code></pre>\n\n<p>Compile error info is: 'cannot take the address of s[0]'. \nThis will be OK I but I doubt it will cause unneccesary memory apllying. Is there a better way to get the data pointer?</p>\n\n<pre><code>C.Println((*C.char)(unsafe.Pointer(&amp;([]byte(s)[0]))))\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1488188270, "post_id": 42480523, "comment_id": 72104158, "body": "I&#39;d advise against using <code>net.LookupHost()</code> for verification purposes: this funciton is not pure: it has potentially extensive side-effects (imagine checking 100000 hostnames for validity in a tight loop). In fact, checking whether a hostname is valid is simple (a character-by-character iterator combined with a smlple state machine; I&#39;d say it will be under 100 lines of code)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1488188776, "post_id": 42480523, "comment_id": 72104474, "body": "Basically the hostname format defined by <a href=\"https://tools.ietf.org/html/rfc952\" rel=\"nofollow noreferrer\">RFC 952</a> and refined by <a href=\"https://tools.ietf.org/html/rfc1123#page-13\" rel=\"nofollow noreferrer\">RFC 1123</a> which laxed the definition a bit. The former defines the following grammar for hostnames: <code>&lt;hname&gt; ::= &lt;name&gt;*[&quot;.&quot;&lt;name&gt;]</code> and <code>&lt;name&gt;  ::= &lt;let&gt;[*[&lt;let-or-digit-or-hyphen&gt;]&lt;let-or-digit&gt;]</code> plus the size requirements of supporting hostnames from 63 to 255 octets in length. I&#39;d say implementing a parser for the two rules above is not hard."}, {"owner": {"reputation": 499, "user_id": 1308313, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8f9232f7a37c2d6736fd6a73c43fc46f?s=128&d=identicon&r=PG", "display_name": "brianSan", "link": "https://stackoverflow.com/users/1308313/briansan"}, "edited": false, "score": 0, "creation_date": 1520800030, "post_id": 42480523, "comment_id": 85453040, "body": "is an ip address not a valid hostname? why must the first character in <code>name</code> be <code>&lt;let&gt;</code>?"}, {"owner": {"reputation": 221, "user_id": 585109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e616f757388810c510eea4d9e4ab02fa?s=128&d=identicon&r=PG", "display_name": "piroux", "link": "https://stackoverflow.com/users/585109/piroux"}, "reply_to_user": {"reputation": 499, "user_id": 1308313, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8f9232f7a37c2d6736fd6a73c43fc46f?s=128&d=identicon&r=PG", "display_name": "brianSan", "link": "https://stackoverflow.com/users/1308313/briansan"}, "edited": false, "score": 0, "creation_date": 1529401726, "post_id": 42480523, "comment_id": 88849785, "body": "@brianSan An IP address is a represents a logical network location label which can be used in the TCP/IP layers. Whereas a hostname always has to be resolved as an IP from DNS Servers to establish an IP connection."}], "tags": [], "owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "is_accepted": false, "score": 14, "last_activity_date": 1596553888, "last_edit_date": 1596553888, "creation_date": 1488182541, "answer_id": 42480523, "question_id": 42479410, "link": "https://stackoverflow.com/questions/42479410/how-to-determine-if-given-string-is-a-hostname-or-an-ip-address/42480523#42480523", "title": "How to determine if given string is a hostname or an IP address", "body": "<p>An IP Address should be parsed as a string. I use the net package's ParseIP to determine whether a given string is an IP or a host</p>\n<pre><code>addr := net.ParseIP(host)\nif addr != nil {\n    hp.IPAddress = host\n} else {\n    hp.HostName = host\n}\n</code></pre>\n<p>however, this may set hostname with an invalid value. Check to make sure that host name is a valid host name if <code>net.ParseIP</code> returns an error. Would use</p>\n<pre><code>hostName, err := net.LookupHost(host)\nif len(hostName) &gt; 0{\n   if hostName[0] == hp.HostName{\n   }\n}\n</code></pre>\n<p>to determine if the host name is valid</p>\n<p>Like <a href=\"https://stackoverflow.com/users/720999/kostix\">Kosik</a> pointed out in the comments there are definitely better and faster ways to determine if a host name is valid. I recommend you do some research into how that can be achieved</p>\n"}], "owner": {"reputation": 31, "user_id": 7628214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75083b3ab2d5e6c1b3e8948e7d158da2?s=128&d=identicon&r=PG&f=1", "display_name": "Avishkar Pawar", "link": "https://stackoverflow.com/users/7628214/avishkar-pawar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6375, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1596553888, "creation_date": 1488178033, "last_edit_date": 1488192438, "question_id": 42479410, "link": "https://stackoverflow.com/questions/42479410/how-to-determine-if-given-string-is-a-hostname-or-an-ip-address", "title": "How to determine if given string is a hostname or an IP address", "body": "<pre><code>_, err := strconv.ParseInt(host, 10, 64)\nif err == nil {\n    hp.IpAddress = host           \n} else {            \n    hp.HostName = dbhost \n}      \n</code></pre>\n\n<p>With host = sealinuxvm11 I'm getting </p>\n\n<pre><code>error strconv.ParseInt: parsing \" sealinuxvm11 \": invalid syntax\n</code></pre>\n\n<p>and with host = 192.168.24.10   </p>\n\n<pre><code>strrconv.ParseInt: parsing \" 192.168.24.10\": invalid syntax\n</code></pre>\n"}, {"tags": ["linux", "go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "edited": false, "score": 0, "creation_date": 1488180256, "post_id": 42479866, "comment_id": 72099848, "body": "but I don&#39;t want to do this, it requires sudo password. May you please suggest some better alternatives ?"}, {"owner": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "edited": false, "score": 0, "creation_date": 1488180518, "post_id": 42479866, "comment_id": 72099967, "body": "Above line is self executing (on 90 seconds interval), so how we can provide sudo password at terminal ?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "edited": false, "score": 0, "creation_date": 1488180869, "post_id": 42479866, "comment_id": 72100142, "body": "Okaay, this kind of sounds like you need to learn Unix system administration. The easiest way to be root is to not give it up, so run as a system service."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "edited": false, "score": 0, "creation_date": 1488181136, "post_id": 42479866, "comment_id": 72100271, "body": "@PiyushSinha Or if you are in a desktop environment you might use Polkit: <a href=\"https://en.wikipedia.org/wiki/Polkit\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Polkit</a>"}, {"owner": {"reputation": 23612, "user_id": 147407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/65f858d8a973f4ee8d97517a21a17e7d?s=128&d=identicon&r=PG", "display_name": "Andrejs Cainikovs", "link": "https://stackoverflow.com/users/147407/andrejs-cainikovs"}, "edited": false, "score": 0, "creation_date": 1488188120, "post_id": 42479866, "comment_id": 72104076, "body": "Using <code>visudo</code> (or, to be more precise, <code>&#47;etc&#47;sudoers</code> file) you can specify users that will not be asked for password when running <code>sudo</code>: <a href=\"http://askubuntu.com/a/147265/2639\">askubuntu.com/a/147265/2639</a>"}, {"owner": {"reputation": 23612, "user_id": 147407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/65f858d8a973f4ee8d97517a21a17e7d?s=128&d=identicon&r=PG", "display_name": "Andrejs Cainikovs", "link": "https://stackoverflow.com/users/147407/andrejs-cainikovs"}, "edited": false, "score": 0, "creation_date": 1488188224, "post_id": 42479866, "comment_id": 72104127, "body": "Be aware, using <code>sudo</code> without password makes security flaw. I would run this program as a system service, as @ZanLynx suggested."}, {"owner": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "edited": false, "score": 0, "creation_date": 1488189542, "post_id": 42479866, "comment_id": 72105004, "body": "@Zan I am new in Linux &amp; Golang, so PLZ give me some suggestion about how to create System Service."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 3, "last_activity_date": 1488179937, "creation_date": 1488179937, "answer_id": 42479866, "question_id": 42479409, "link": "https://stackoverflow.com/questions/42479409/how-could-i-get-a-root-level-access-permission-in-runtime-golang-application/42479866#42479866", "title": "How could I get a root level access/permission in runtime golang application?", "body": "<p>Run your golang application with sudo.</p>\n"}], "owner": {"reputation": 13, "user_id": 7628270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be3b03dc68398f3d570011b7a6ff90f6?s=128&d=identicon&r=PG&f=1", "display_name": "Piyush Sinha", "link": "https://stackoverflow.com/users/7628270/piyush-sinha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1255, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488179937, "creation_date": 1488178031, "question_id": 42479409, "link": "https://stackoverflow.com/questions/42479409/how-could-i-get-a-root-level-access-permission-in-runtime-golang-application", "title": "How could I get a root level access/permission in runtime golang application?", "body": "<p>Below command will creates a user but it ask sudo password.</p>\n\n<pre><code>cmd := \"sudo /usr/sbin/useradd \"+ \n      \"-m -d \"+home_dir+                       \n      \" -s \"+preferredShell +\n      \" -g \"+usrLoginName+\n      \" \"+ usrLoginName\n</code></pre>\n\n<blockquote>\n  <p>cmdStatus,err := exec.Command(\"bash\",\"-c\",cmd).Output()</p>\n</blockquote>\n\n<p>How to execute above command without sudo or How to provide root level permission to my golang application? How to fix it ?</p>\n"}, {"tags": ["sql", "go", "controller", "beego"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 7545303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/283f28349591c1e1804f25551658c2bb?s=128&d=identicon&r=PG&f=1", "display_name": "gophervk", "link": "https://stackoverflow.com/users/7545303/gophervk"}, "edited": false, "score": 1, "creation_date": 1488192821, "post_id": 42483176, "comment_id": 72107258, "body": "exactly i was trying the same thing meanwhile you have posted what i was trying to do.....it is working for me"}], "tags": [], "owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "is_accepted": true, "score": 0, "last_activity_date": 1488190843, "creation_date": 1488190843, "answer_id": 42483176, "question_id": 42479117, "link": "https://stackoverflow.com/questions/42479117/can-we-pass-extra-parameter-to-a-beego-router/42483176#42483176", "title": "can we pass extra parameter to a beego router", "body": "<p>You can't do this in golang</p>\n\n<pre><code>type MainController struct {\n    beego.Controller }\n\nfunc (this *MainController,db *sql.DB) Post() {\n\n    fmt.Println(\"input value is\", datapoint.UserId)\n\n}\n</code></pre>\n\n<p>the declaration in the form</p>\n\n<pre><code>function (c *MainController)Post()\n</code></pre>\n\n<p>means that Post is a method for the <code>MainController</code> struct you can pass variable into it.</p>\n\n<p>My suggestion is you declare the db pointer as a global variable in your package like below then you will be able to use it inside the <code>Post</code> function</p>\n\n<pre><code>type MainController struct {\n    beego.Controller\n}\n\nvar db *sql.DB\n\nfunc (this *MainController) Post() {\n    //you can now use the variable db inside here\n    fmt.Println(\"input value is\", datapoint.UserId)\n\n}\n</code></pre>\n\n<p>but considering this is Beego which uses the MVC pattern you can do all this from within the model. I suggest you take a look at their awesome <a href=\"https://beego.me/docs/mvc/model/overview.md\" rel=\"nofollow noreferrer\">documentation here</a></p>\n"}], "owner": {"reputation": 67, "user_id": 7545303, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/283f28349591c1e1804f25551658c2bb?s=128&d=identicon&r=PG&f=1", "display_name": "gophervk", "link": "https://stackoverflow.com/users/7545303/gophervk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 42483176, "answer_count": 1, "score": 1, "last_activity_date": 1488198188, "creation_date": 1488176770, "last_edit_date": 1488198188, "question_id": 42479117, "link": "https://stackoverflow.com/questions/42479117/can-we-pass-extra-parameter-to-a-beego-router", "title": "can we pass extra parameter to a beego router", "body": "<pre><code>type MainController struct {\n    beego.Controller\n}\n\nfunc (this *MainController) Post() {\n    var datapoint User\n    req := this.Ctx.Input.RequestBody\n    json.Unmarshal([]byte(req), &amp;datapoint)\n    this.Ctx.WriteString(\"hello world\")\n    //  result := this.Input()\n    fmt.Println(\"input value is\", datapoint.UserId)\n\n}\n</code></pre>\n\n<p>this is normal beego router which executes on url occurrence. I want something like </p>\n\n<pre><code>type MainController struct {\n    beego.Controller\n}\n\nfunc (this *MainController,db *sql.DB) Post() {\n\n    fmt.Println(\"input value is\", datapoint.UserId)\n\n}\n</code></pre>\n\n<p>in order to use database connection pointer. is this possible to achieve this using go...if not please suggest  </p>\n"}, {"tags": ["go", "websocket", "response", "middleware"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1491932554, "post_id": 42478237, "comment_id": 73768744, "body": "Isn&#39;t the code that pulls the request id out of the request and sticks it into the response the same code? Like the http handler, or a middleware perhaps?"}, {"owner": {"reputation": 25546, "user_id": 658718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/661bb4dee881617e676c4d954ce97a70?s=128&d=identicon&r=PG", "display_name": "Konrad Reiche", "link": "https://stackoverflow.com/users/658718/konrad-reiche"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1491944980, "post_id": 42478237, "comment_id": 73775661, "body": "@Peter Yes, still\u2014if the context gets lost or altered while being passed through it would break."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1491989652, "post_id": 42478237, "comment_id": 73793045, "body": "Functions that are called by the handler cannot alter the context. They can only derive new contexts but those are invisible to the handler."}, {"owner": {"reputation": 25546, "user_id": 658718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/661bb4dee881617e676c4d954ce97a70?s=128&d=identicon&r=PG", "display_name": "Konrad Reiche", "link": "https://stackoverflow.com/users/658718/konrad-reiche"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1492030944, "post_id": 42478237, "comment_id": 73821307, "body": "@Peter Your point being? If you replace it with a new context it is effectively altered, also if it is not passed on."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1492084806, "post_id": 42478237, "comment_id": 73844258, "body": "My point is that there is no way for any function to change or remove the request id from the context the handler sees, so adding it to the response reliably should be a non-issue. Also, nothing is forcing you to call ctx.Value() at the bottom of the handler to retrieve the request id. It should be in a local variable anyway: <a href=\"https://play.golang.org/p/afhnQKY6E4\" rel=\"nofollow noreferrer\">play.golang.org/p/afhnQKY6E4</a>"}, {"owner": {"reputation": 498, "user_id": 2857738, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/88d78bddc283c7ad9fbbe5396bfb220d?s=128&d=identicon&r=PG&f=1", "display_name": "Hendra Huang", "link": "https://stackoverflow.com/users/2857738/hendra-huang"}, "edited": false, "score": 0, "creation_date": 1499610109, "post_id": 42478237, "comment_id": 76968697, "body": "In my opinion, injecting RequestID and SessionID to context is not a bad approach. RequestID and SessionID is just like an identity for the request. Same thing happens to opentracing. They inject unique id for each request through context. As long as the value injected to the context is about the request identity, i think it&#39;s okay. Francesc also describe it on his just for func video"}], "answers": [{"tags": [], "owner": {"reputation": 964, "user_id": 93276, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zMfFU.jpg?s=128&g=1", "display_name": "Puran", "link": "https://stackoverflow.com/users/93276/puran"}, "is_accepted": false, "score": 0, "last_activity_date": 1540946078, "creation_date": 1540946078, "answer_id": 53074695, "question_id": 42478237, "link": "https://stackoverflow.com/questions/42478237/storing-request-and-session-id-in-context-context-considered-bad/53074695#53074695", "title": "Storing request and session ID in context.Context considered bad?", "body": "<p>Based on my understanding context should be limited to passing things like request or session ID. In my application, I do something like below in one of my middleware. Helps with observability </p>\n\n<pre><code>if next != nil {\n   if requestID != \"\" {\n     b := context.WithValue(r.Context(), \"requestId\", requestID)\n     r = r.WithContext(b)\n   }\n   next.ServeHTTP(w, r)\n}\n</code></pre>\n"}], "owner": {"reputation": 25546, "user_id": 658718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/661bb4dee881617e676c4d954ce97a70?s=128&d=identicon&r=PG", "display_name": "Konrad Reiche", "link": "https://stackoverflow.com/users/658718/konrad-reiche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 857, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1540946078, "creation_date": 1488172445, "last_edit_date": 1488223437, "question_id": 42478237, "link": "https://stackoverflow.com/questions/42478237/storing-request-and-session-id-in-context-context-considered-bad", "title": "Storing request and session ID in context.Context considered bad?", "body": "<p>There is this excellent blog post by Jack Lindamood <a href=\"https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39\" rel=\"nofollow noreferrer\">How to correctly use context.Context in Go 1.7</a> which boils down to the following money quote:</p>\n\n<blockquote>\n  <p><strong>Context.Value should inform, not control.</strong> This is the primary mantra that I feel should guide if you are using context.Value correctly. The\n  content of context.Value is for maintainers not users. It should never\n  be required input for documented or expected results.</p>\n</blockquote>\n\n<p>Currently, I am using <code>Context</code> to transport the following information:</p>\n\n<ul>\n<li><p><code>RequestID</code> which is generated on the client-side passed to the Go backend and it solely travels through the command-chain and is then inserted in the response again. Without the <code>RequestID</code> in the response, the client-side would break though.</p></li>\n<li><p><code>SessionID</code> identifies the WebSocket session, this is important when certain responses are generated in asynchronous computations (e.g. worker queues) in order to identify on which WebSocket session the response should be send.</p></li>\n</ul>\n\n<p>When taking the definition very seriously I would say both violate the intention of <code>context.Context</code> but then again their values do not change any behavior while the whole request is made, it's only relevant when generating the response.</p>\n\n<p>What's the alternative? Having the <code>context.Context</code> for metadata in the server API actually helps to maintain lean method signatures because this data is really irrelevant to the API but only important for the transport layer which is why I am reluctant to create something like a request struct:</p>\n\n<pre><code>type Request struct {\n    RequestID string\n    SessionID string\n}\n</code></pre>\n\n<p>and make it part of every API method which solely exists to be passed through before sending a response. &nbsp;</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488185505, "post_id": 42477951, "comment_id": 72102471, "body": "A you&#39;r right.."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488189925, "post_id": 42477951, "comment_id": 72105279, "body": "I just realized I didn&#39;t read your question correctly."}], "answers": [{"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 2, "last_activity_date": 1488170887, "creation_date": 1488170887, "answer_id": 42478004, "question_id": 42477951, "link": "https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup/42478004#42478004", "title": "What is the method set of `sync.WaitGroup`?", "body": "<p>In your case you are modifying a global <code>wg</code> object, if you pass it to a function you have to use pointer because you need to modify the object itself. If you pass by value, inside your function you will be modifying a copy of it, not the object itself.</p>\n"}, {"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": false, "score": 1, "last_activity_date": 1488171772, "last_edit_date": 1488171772, "creation_date": 1488171198, "answer_id": 42478047, "question_id": 42477951, "link": "https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup/42478047#42478047", "title": "What is the method set of `sync.WaitGroup`?", "body": "<p>From the documentation <a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\">WaitGroup</a> : </p>\n\n<blockquote>\n  <p>A WaitGroup waits for a collection of goroutines to finish.  The main\n  goroutine calls Add to set the number of  goroutines to wait for. Then\n  each of the goroutines  runs and calls Done when finished. At the same\n  time,  Wait can be used to block until all goroutines have finished.</p>\n</blockquote>\n\n<p>From your Question</p>\n\n<blockquote>\n  <p>How does this work?</p>\n</blockquote>\n\n<p>So for <code>Add</code> method is set the number of goroutine your called. From your code you have only one : </p>\n\n<pre><code>func main() {\n    wg.Add(1)\n\n    go func() {\n        fmt.Println(\"starting...\")\n        time.Sleep(1 * time.Second)\n        fmt.Println(\"done....\")\n        wg.Done()\n    } ()\n\n    wg.Wait()\n\n}\n</code></pre>\n\n<p>so it will tells goroutine to wait and print the result.\nas for <code>wg.Done()</code> this is for telling the one gouroutine has finished to work. and it tells to the <code>add</code> to decrement to <code>-1</code>. You can see the code below How <code>Done</code>  method works : </p>\n\n<pre><code>// Done decrements the WaitGroup counter.\nfunc (wg *WaitGroup) Done() {\n    wg.Add(-1)\n}\n</code></pre>\n\n<p>and finally for the <code>Wait</code> method this is for blocking goroutine until the WaitGroup counter is zero.</p>\n\n<p>And another: </p>\n\n<blockquote>\n  <p>Why ?</p>\n</blockquote>\n\n<p>from your code above if you don't use <code>WaitGroup</code> you will not be able to print the result from the goroutine.</p>\n\n<p>All in all you can read it in the documentation. </p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1488183438, "last_edit_date": 1495540834, "creation_date": 1488183126, "answer_id": 42480671, "question_id": 42477951, "link": "https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup/42480671#42480671", "title": "What is the method set of `sync.WaitGroup`?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> is the empty method set:</p>\n\n<pre><code>wg := sync.WaitGroup{}\nfmt.Println(reflect.TypeOf(wg).NumMethod())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/k3Xqqd0TWx\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n</code></pre>\n\n<p>This is because all the methods of <code>sync.WaitGroup</code> have pointer receivers, so they are all part of the method set of the <code>*sync.WaitGroup</code> type.</p>\n\n<p>When you do:</p>\n\n<pre><code>var wg sync.WaitGroup\n\nwg.Add(1)\nwg.Done()\n// etc.\n</code></pre>\n\n<p>This is actually a shorthand for <code>(&amp;wg).Add(1)</code>, <code>(&amp;wg).Done()</code> etc.</p>\n\n<p>This is in <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">Spec: Calls:</a></p>\n\n<blockquote>\n  <p>If <code>x</code> is addressable and <code>&amp;x</code>'s method set contains <code>m</code>, <code>x.m()</code> is shorthand for <code>(&amp;x).m()</code>.</p>\n</blockquote>\n\n<p>So when you have a value that is addressable (a variable is addressable), you may call any methods that have pointer receiver on non-pointer values, and the compiler will automatically take the address and use that as the receiver value.</p>\n\n<p>See related question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/38481420/calling-a-method-with-a-pointer-receiver-by-an-object-instead-of-a-pointer-to-it/38481697#38481697\">Calling a method with a pointer receiver by an object instead of a pointer to it?</a></p>\n"}], "owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1065, "favorite_count": 3, "accepted_answer_id": 42480671, "answer_count": 3, "score": 4, "last_activity_date": 1488183438, "creation_date": 1488170477, "question_id": 42477951, "link": "https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup", "title": "What is the method set of `sync.WaitGroup`?", "body": "<p>I have this simple program below</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    wg.Add(1)\n\n    go func() {\n        fmt.Println(\"starting...\")\n        time.Sleep(1 * time.Second)\n        fmt.Println(\"done....\")\n        wg.Done()\n    } ()\n\n    wg.Wait()\n\n}\n</code></pre>\n\n<p>Notice that I use <code>var wg sync.WaitGroup</code> as a value, not a pointer. But the <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">page for the sync package</a> specifies that the <code>Add</code>, <code>Done</code> and <code>Wait</code> function take a <code>*sync.WaitGroup</code>. </p>\n\n<p>Why/How does this work?</p>\n"}, {"tags": ["python", "go", "swagger"], "answers": [{"tags": [], "owner": {"reputation": 1159, "user_id": 23418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39a948a58f4569c53d971c2e120920?s=128&d=identicon&r=PG", "display_name": "Casual Jim", "link": "https://stackoverflow.com/users/23418/casual-jim"}, "is_accepted": false, "score": 1, "last_activity_date": 1488169334, "creation_date": 1488169334, "answer_id": 42477806, "question_id": 42477734, "link": "https://stackoverflow.com/questions/42477734/golang-swagger-rest-api-documents-generator/42477806#42477806", "title": "golang: swagger REST api documents generator", "body": "<p>go-swagger does it based on doc comments: <a href=\"https://goswagger.io/generate/spec.html\" rel=\"nofollow noreferrer\">https://goswagger.io/generate/spec.html</a></p>\n\n<p>go-restful has a builder for creating swagger 2.0 documents: <a href=\"https://github.com/emicklei/go-restful-openapi\" rel=\"nofollow noreferrer\">https://github.com/emicklei/go-restful-openapi</a> </p>\n"}], "owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 627, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488169334, "creation_date": 1488168898, "question_id": 42477734, "link": "https://stackoverflow.com/questions/42477734/golang-swagger-rest-api-documents-generator", "title": "golang: swagger REST api documents generator", "body": "<p>I've searched internet but couldn't find a good solution. I'm looking for something that pretty specific - a golang copy of <code>aiohttp_swagger</code>.</p>\n\n<p>That is a Python package which does magical things. In the endpoint handler method, one write some comment code and it'll be automatically parsed and generates swagger documentation. When the server is up and running, a special URL <code>/api/doc</code> handler will be inserted into the server where people can see it live. </p>\n\n<p>I understand it's tied into the implementation of <code>aiohttp</code> framework and the way Go is used, web framework is not as popular (not using one myself), but I still like that solution very much and would like to find something in the Go land.</p>\n\n<p>So my question is a bit open I guess: is there an equivalent (or rough) of <code>aiohttp_swagger</code> package in Go? </p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1488162320, "post_id": 42476803, "comment_id": 72094194, "body": "I believe the local variable is required.  So that a space in memory is allocated for time.Now().  f.t is defined as a pointer, but it is nil and doesn&#39;t have a place in memory as it wasn&#39;t initialized.  Then you assign tmp by reference, which tells f.t to become tmp.  So you&#39;re not copying anything."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1488183674, "post_id": 42476803, "comment_id": 72101406, "body": "See possible duplicates for explanation and alternatives: <a href=\"http://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a>; and <a href=\"http://stackoverflow.com/questions/34197248/how-can-i-store-reference-to-the-result-of-an-operation-in-go/34197367#34197367\">How can I store reference to the result of an operation in Go?</a>; and <a href=\"http://stackoverflow.com/questions/30744965/how-to-get-the-pointer-of-return-value-from-function-call/30751102#30751102\">How to get the pointer of return value from function call?</a>"}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488191223, "post_id": 42476803, "comment_id": 72106143, "body": "Thanks @icza, I definitely spent time searching for this question but I was clearly wording it differently."}], "answers": [{"comments": [{"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1488584616, "post_id": 42476869, "comment_id": 72312740, "body": "Thanks for the note about the idiomatic usage of <code>time.Time</code> values (not pointers). The <code>go-gitlab</code> API I&#39;m using uses <a href=\"https://github.com/xanzy/go-gitlab/blob/442ae38dfd2f6a1e94d5f384bb6df1784395e732/builds.go#L46\" rel=\"nofollow noreferrer\"><code>*time.Time</code></a> so I thought that was the way to go."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1560263864, "post_id": 42476869, "comment_id": 99673950, "body": "The only reason to have a <code>*time.Time</code> is if you want to convey the fact that the time has not been set e.g. reading from a DB where that column can have a <code>NULL</code> value. As stated, this leads to cumbersome usage on the client end. So as a compromise, one can use the <code>IsZero()</code> method to test if a value is set or not. <code>go</code>&#39;s zero-time is <code>0001-01-01 00:00:00 +0000 UTC</code> - <i>NOT</i> epoch&#39;s 1970-01-01 - so that time is unlikely to appear in a DB."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1560299084, "last_edit_date": 1560299084, "creation_date": 1488162370, "answer_id": 42476869, "question_id": 42476803, "link": "https://stackoverflow.com/questions/42476803/assign-value-returned-from-function-to-pointer/42476869#42476869", "title": "Assign value returned from function to pointer", "body": "<p>The local variable is required <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">per the specification</a>.</p>\n\n<p>To get the address of a value, the calling function must copy the return value to addressable memory. There is a copy, but it's not extra.</p>\n\n<p>Go programs typically work with <code>time.Time</code> values. </p>\n\n<p>A <code>*time.Time</code> is sometimes used situations where the application wants to distinguish between no value and other time values. Distinguishing between a SQL NULL and a valid time is an example. Because the zero value for a <code>time.Time</code> is so far in the past, it's often practical to use the zero value to represent no value.  Use the <code>IsZero()</code> method to test for a zero value.  </p>\n"}], "owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "accepted_answer_id": 42476869, "answer_count": 1, "score": 0, "last_activity_date": 1560299084, "creation_date": 1488161753, "question_id": 42476803, "link": "https://stackoverflow.com/questions/42476803/assign-value-returned-from-function-to-pointer", "title": "Assign value returned from function to pointer", "body": "<p>In Go, how do you assign a value returned by a function call to a pointer?</p>\n\n<p>Consider this example, noting that <a href=\"https://golang.org/pkg/time/#Now\" rel=\"nofollow noreferrer\"><code>time.Now()</code></a> returns a <code>time.Time</code> value (not pointer):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype foo struct {\n    t *time.Time\n}\n\nfunc main() {\n    var f foo \n\n    f.t = time.Now()  // Fail line 15\n\n    f.t = &amp;time.Now() // Fail line 17\n\n    tmp := time.Now() // Workaround\n    f.t = &amp;tmp\n\n    fmt.Println(f.t)\n}\n</code></pre>\n\n<p>These both fail:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ go build\n# _/home/jreinhart/tmp/go_ptr_assign\n./test.go:15: cannot use time.Now() (type time.Time) as type *time.Time in assignment\n./test.go:17: cannot take the address of time.Now()\n</code></pre>\n\n<p>Is a local variable truly required? And doesn't that incur an unnecessary copy?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1488185626, "last_edit_date": 1488185626, "creation_date": 1488160029, "answer_id": 42476578, "question_id": 42475828, "link": "https://stackoverflow.com/questions/42475828/do-pointers-change-value-in-go-due-to-garbage-collection/42476578#42476578", "title": "Do pointers change value in Go due to garbage collection?", "body": "<p>These rules for passing pointer between Go code and C code are dynamically checked at runtime. So when you break them the error occur.</p>\n\n<p>And your guess is right. Addresses are allowed to change due to garbage collection (Pointers are updated).</p>\n\n<p>Note <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\">here from golang.org</a>:</p>\n\n<blockquote>\n  <p>Even if a uintptr holds the address of some object, the garbage\n  collector will not update that uintptr's value if the object moves,\n  nor will that uintptr keep the object from being reclaimed.</p>\n</blockquote>\n\n<p>So moving object due to gc is possible.</p>\n"}], "owner": {"reputation": 3589, "user_id": 70603, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7881f3cacd278fb65ca3342307e4275b?s=128&d=identicon&r=PG", "display_name": "jdizzle", "link": "https://stackoverflow.com/users/70603/jdizzle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "accepted_answer_id": 42476578, "answer_count": 1, "score": 3, "last_activity_date": 1497849422, "creation_date": 1488153850, "last_edit_date": 1497849422, "question_id": 42475828, "link": "https://stackoverflow.com/questions/42475828/do-pointers-change-value-in-go-due-to-garbage-collection", "title": "Do pointers change value in Go due to garbage collection?", "body": "<p>I'm a relative newbie to go.  I have been working a lot with cgo and building an interface to a C api.  The C api uses a registered callback and a <code>void*</code> cookie parameter to the callback.</p>\n\n<p>Here is some code exemplifying my problem:</p>\n\n<pre><code>/*\nvoid cb(void *cookie) {\n   callGo(cookie);\n}\n\ngo_register_cb(void *ptr) {\n   register_cb(&amp;cb, ptr);\n}\n*/\nimport \"C\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>import \"C\"\n\n//export callGo\ncallGo(ptr unsafe.Pointer) {\n    x := (*MyStruct)(ptr)\n    x.doSomething()\n}\n\nfunc (x *MyStruct) Start() {\n    C.go_register_cb(unsafe.Pointer(x))\n}\n</code></pre>\n\n<p>This code causes a runtime error about Go pointers to Go pointers.</p>\n\n<p>I think I understand the basic implications of keeping Go pointer inside C-land, which is that the C-land reference will not be accounted for in the go garbage collector so C may end up using a stale reference.</p>\n\n<p>The specific requirement that I cannot pass a Go pointer to a data-structure that itself contains a Go pointer is more puzzling. The only thing that makes sense to me is that pointers in Go may change value (that is, the address they point to) due to garbage collection. Is this the case?</p>\n"}, {"tags": ["go", "docker", "io", "stdout"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1488150151, "post_id": 42475239, "comment_id": 72091147, "body": "The lines are prefixed with a byte containing the count of the remaining bytes on the line.  The io.Copy function and os.Stdout don&#39;t do anything that will add these bytes."}, {"owner": {"reputation": 392, "user_id": 2929626, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1Y9Y5.png?s=128&g=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2929626/anton"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1488150990, "post_id": 42475239, "comment_id": 72091398, "body": "thanks @CeriseLim&#243;n but do you have any suggestions on a nice clean way to prevent that byte from being displayed in my output?"}], "answers": [{"tags": [], "owner": {"reputation": 392, "user_id": 2929626, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1Y9Y5.png?s=128&g=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2929626/anton"}, "is_accepted": true, "score": 1, "last_activity_date": 1488152740, "creation_date": 1488152740, "answer_id": 42475684, "question_id": 42475239, "link": "https://stackoverflow.com/questions/42475239/golang-weird-characters-using-io-copy-to-copy-from-bufio-reader-to-stdout/42475684#42475684", "title": "golang - weird characters using io.Copy to copy from bufio.Reader to STDOUT", "body": "<p>I found the problem - my <a href=\"https://godoc.org/github.com/docker/docker/api/types/container#Config\" rel=\"nofollow noreferrer\">containerConfig</a> needed to specify <code>Tty: true</code></p>\n"}], "owner": {"reputation": 392, "user_id": 2929626, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1Y9Y5.png?s=128&g=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2929626/anton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "accepted_answer_id": 42475684, "answer_count": 1, "score": 0, "last_activity_date": 1488152740, "creation_date": 1488149591, "question_id": 42475239, "link": "https://stackoverflow.com/questions/42475239/golang-weird-characters-using-io-copy-to-copy-from-bufio-reader-to-stdout", "title": "golang - weird characters using io.Copy to copy from bufio.Reader to STDOUT", "body": "<p>I have an application that attaches to a docker container to get its output using the <a href=\"https://godoc.org/github.com/docker/docker/client#Client.ContainerAttach\" rel=\"nofollow noreferrer\">containerAttach()</a> function provided by the docker library.\nThat function returns a <a href=\"https://godoc.org/github.com/docker/docker/api/types#HijackedResponse\" rel=\"nofollow noreferrer\">HijackedResponse</a> struct with a pointer to a bufio.Reader.</p>\n\n<p>I'm trying to stream text from the bufio.Reader to stdout and getting unexpected characters in the strings written to stdout.</p>\n\n<p>The code:</p>\n\n<pre><code>_, err := io.Copy(os.Stdout, hijackedResponse.Reader)\n</code></pre>\n\n<p>Expected output:</p>\n\n<pre><code>Refreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n</code></pre>\n\n<p>Actual output:</p>\n\n<pre><code>6Refreshing Terraform state in-memory prior to plan...\n=The refreshed state will be used to calculate this plan, but\n9will not be persisted to local or remote state storage.\n</code></pre>\n\n<p>I have no idea where the first character in each of those lines has come from. Any help would be much appreciated. If needed I can provide more details around the docker container &amp; attach options I'm using in my code although I'm assuming they're fine as I'm getting the output via the reader.</p>\n"}, {"tags": ["windows", "go", "winsock"], "answers": [{"comments": [{"owner": {"reputation": 452, "user_id": 5141875, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xJ1vr6IsVfo/AAAAAAAAAAI/AAAAAAAAACM/3h4GSMEpdlc/photo.jpg?sz=128", "display_name": "Tyler Kropp", "link": "https://stackoverflow.com/users/5141875/tyler-kropp"}, "edited": false, "score": 0, "creation_date": 1609267805, "post_id": 42483521, "comment_id": 115796552, "body": "The function now appears to have actual code in it."}], "tags": [], "owner": {"reputation": 890, "user_id": 3364249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hQltG.jpg?s=128&g=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/3364249/marco"}, "is_accepted": true, "score": 2, "last_activity_date": 1488191773, "creation_date": 1488191773, "answer_id": 42483521, "question_id": 42475093, "link": "https://stackoverflow.com/questions/42475093/go-raw-winsock/42483521#42483521", "title": "Go : Raw winsock", "body": "<p>In the current version of Go, the error message is</p>\n\n<blockquote>\n  <p>not supported by windows</p>\n</blockquote>\n\n<p>which is self-explanatory.</p>\n\n<p>If you follow your call to Recvfrom(), you will find</p>\n\n<pre><code>func Recvfrom(fd Handle, p []byte, flags int) (n int, from Sockaddr, err error) {\n    return 0, nil, syscall.EWINDOWS\n}\n</code></pre>\n\n<p>which is the return of a static error message above.</p>\n"}], "owner": {"reputation": 5609, "user_id": 1226748, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/RfDKy.jpg?s=128&g=1", "display_name": "Jimmy Obonyo Abor", "link": "https://stackoverflow.com/users/1226748/jimmy-obonyo-abor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 896, "favorite_count": 0, "accepted_answer_id": 42483521, "answer_count": 1, "score": 0, "last_activity_date": 1488210034, "creation_date": 1488148678, "last_edit_date": 1488210034, "question_id": 42475093, "link": "https://stackoverflow.com/questions/42475093/go-raw-winsock", "title": "Go : Raw winsock", "body": "<p>Am trying to create a simple tcp raw winsock but my <code>socket.Recvfrom</code> trows an error \"Not supported socket\", what am i doing wrong ?</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/sys/windows\"\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/layers\"\n    \"log\"\n    \"net\"\n    \"sync\"\n    \"os\"\n    //~ \"syscall\"\n    \"time\"\n    \"fmt\"\n    \"errors\"\n    \"unsafe\"\n)\n\nconst SIO_RCVALL = windows.IOC_IN | windows.IOC_VENDOR | 1\n\ntype Handle struct {\n    blockForever bool\n    device       string\n    deviceIndex  int\n    mu           sync.Mutex\n    socket       windows.Handle\n    timeout      time.Duration\n    snaplen      int32\n}\n\nconst BlockForever = -time.Millisecond * 10\n\nfunc main() {\n    var (\n        device    string        = \"eth0\"\n        Snaplen int32         = 65536\n        Timeout     time.Duration = 30 * time.Second\n    )\n\n    var (\n       ip4 layers.IPv4\n       tcp layers.TCP\n    )\n\n    parser := gopacket.NewDecodingLayerParser(layers.LayerTypeIPv4, &amp;ip4, &amp;tcp)\n    decoded := []gopacket.LayerType{}\n\n    hnd, err := OpenLive(device, Snaplen, Timeout)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer hnd.Close()\n\n    packetSource := gopacket.NewPacketSource(hnd, hnd.LinkType())\n\n    for packetData := range packetSource.Packets() {\n        err := parser.DecodeLayers(packetData.Data(), &amp;decoded)\n\n        if packetData == nil || err != nil {\n            continue\n        }\n\n        for _, layerType := range decoded {\n          switch layerType {\n            case layers.LayerTypeIPv4:\n                log.Println(\"    IP4 \", ip4.SrcIP, ip4.DstIP)\n            case layers.LayerTypeTCP:\n                log.Println(tcp.TransportFlow().Src().String())\n          }\n        }\n  }\n\n}\n\nfunc OpenLive(device string, snaplen int32, timeout time.Duration) (handle *Handle, err error) {\n    p := &amp;Handle{}\n    p.blockForever = timeout &lt; 0\n    p.timeout = timeout\n    p.snaplen = snaplen\n\n    var d windows.WSAData\n\n    log.Println(\"Initialising Winsock...\")\n    err = windows.WSAStartup(uint32(0x202), &amp;d)\n    if err != nil {\n        return nil, fmt.Errorf(\"Error: WSAStartup - %v\", err)\n    }\n    log.Println(\"Initialised\")\n\n    //Create a RAW Socket\n    log.Println(\"Creating RAW Socket...\");\n    fd, err := windows.Socket(windows.AF_INET, windows.SOCK_RAW, windows.IPPROTO_IP)\n    if err != nil {\n        return nil, fmt.Errorf(\"Error: socket - %v\", err)\n    }\n    p.socket = fd\n    log.Println(\"Created.\")\n\n    // Retrieve the local hostname\n    hostname, err := os.Hostname()\n\n    if err != nil {\n        return nil, fmt.Errorf(\"Error: Hostname() - %v\", err)\n    }\n    log.Printf(\"\\nHost name : %s \\n\",hostname)\n\n    //Retrieve the available IPs of the local host\n    log.Println(\"Available Network Interfaces : \\n\")\n    _ , err = windows.GetHostByName(hostname)\n\n    if err != nil {\n        return nil, fmt.Errorf(\"Error: GetHostByName() - %v\", err)\n    }\n\n    ip4 , iFcindex, err := externalIP()\n    if err != nil {\n        return nil, fmt.Errorf(\"Error: getIpv4() - %v\", err)\n    } \n    p.deviceIndex = iFcindex\n\n    la := new(windows.SockaddrInet4)\n    la.Port = int(0)\n\n    for i := 0; i &lt; net.IPv4len; i++ {\n        la.Addr[i] = ip4[i]\n    }\n\n    if err := windows.Bind(fd, la); err != nil {\n        return nil, fmt.Errorf (\"Error:Bind - %v\", err)\n    }\n\n    inbuf := uint32(1)\n    sizebuf := uint32(unsafe.Sizeof(inbuf))\n    ret := uint32(0)\n\n    err = windows.WSAIoctl(fd, SIO_RCVALL , (*byte)(unsafe.Pointer(&amp;inbuf)) ,sizebuf, nil ,0 ,&amp;ret , nil, 0); \n\n    if err != nil {\n        return nil, fmt.Errorf (\"Error:WSAIoctl() failed - %v\", err)\n    }\n\n    return p, nil\n\n}\n\n// Close closes the underlying socket handle.\nfunc (p *Handle) Close() {\n    p.mu.Lock()\n    defer p.mu.Unlock()\n\n    windows.Close(p.socket)\n}\n\nfunc (p *Handle) ReadPacketData() (data []byte, ci gopacket.CaptureInfo, err error) {\n    p.mu.Lock()\n    data = make([]byte, 65536)\n    n, _, err := windows.Recvfrom(p.socket, data, 0)\n    log.Println(n)\n    if err != nil {\n        log.Printf(\"Error:Recvfrom() - %v\", err)\n    }\n    ci = gopacket.CaptureInfo{Timestamp: time.Now(), CaptureLength: len(data), Length: n, InterfaceIndex: p.deviceIndex}\n\n    p.mu.Unlock()\n\n    return\n}\n\nfunc htons(n int) int {\n    return int(int16(byte(n))&lt;&lt;8 | int16(byte(n&gt;&gt;8)))\n}\n\nfunc externalIP() (IPBYTE []byte, ifaceIndex int ,err error) {\n\n    ifaces, err := net.Interfaces()\n    if err != nil {\n        return \n    }\n\n    IPBYTE = make([]byte, 4)\n    ifaceIndex =  0\n\n    for _, iface := range ifaces {\n        if iface.Flags&amp;net.FlagUp == 0 {\n            continue // interface down\n        }\n        if iface.Flags&amp;net.FlagLoopback != 0 {\n            continue // loopback interface\n        }\n        addrs, err := iface.Addrs()\n        if err != nil {\n            continue \n        }\n\n        for _, addr := range addrs {\n            var ip net.IP\n            switch v := addr.(type) {\n            case *net.IPNet:\n                ip = v.IP\n            case *net.IPAddr:\n                ip = v.IP\n            }\n            if ip == nil || ip.IsLoopback() {\n                continue\n            }\n            IPBYTE = ip.To4()\n            ifaceIndex = iface.Index\n            if IPBYTE == nil {\n                continue // not an ipv4 address\n            }\n            //~ err = nil\n\n            log.Printf(\"Active Network Interfaces %v : %v \" ,iface.Index , ip.String())\n            return IPBYTE ,ifaceIndex ,  nil \n        }\n    }\n\n    err = errors.New(\"are you connected to the network?\")\n    return \n}\n\n// LinkType returns pcap_datalink, as a layers.LinkType.\nfunc (p *Handle) LinkType() layers.LinkType {\n    return layers.LinkTypeIPv4\n}\n</code></pre>\n"}, {"tags": ["go", "installation", "glide-golang"], "answers": [{"comments": [{"owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1488148193, "post_id": 42474924, "comment_id": 72090480, "body": "weird for some reason the owner on the <code>GOPATH</code> folder was set to root instead of my user..."}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "reply_to_user": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1488148243, "post_id": 42474924, "comment_id": 72090500, "body": "Odd. Maybe you used a tool to set it up running under sudo?"}, {"owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1488148269, "post_id": 42474924, "comment_id": 72090512, "body": "I change it to readable/writable/exectuble by I still get this error when running glide install <code>Could not create vendor: mkdir vendor: permission denied</code>"}, {"owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1488148344, "post_id": 42474924, "comment_id": 72090539, "body": "Im not sure if this matter but here are the permissions on my GOROOT folder <code>drwxr-xr-x   20 root  wheel    680 Feb 16 10:01 go</code>"}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "reply_to_user": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 0, "creation_date": 1488148508, "post_id": 42474924, "comment_id": 72090598, "body": "can you run <code>mkdir vendor</code> in the directory where you are running <code>glide install</code>?"}, {"owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "edited": false, "score": 1, "creation_date": 1488148780, "post_id": 42474924, "comment_id": 72090685, "body": "ok I didnt use the -R option when I ran <code>chown yako go</code> to change the owner so it didn&#39;t change the owners of the folders inside. we good now thanks!"}], "tags": [], "owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "is_accepted": true, "score": 2, "last_activity_date": 1488147625, "creation_date": 1488147625, "answer_id": 42474924, "question_id": 42474874, "link": "https://stackoverflow.com/questions/42474874/the-glide-install-command-returns-errorgopath-is-not-set/42474924#42474924", "title": "The glide install command returns [ERROR]\t$GOPATH is not set", "body": "<p>It's probably failing when you run it as sudo, because sudo has a different environment than your user. So a) you need to set GOPATH for that command, and b) you shouldn't need sudo for glide's installation or using it as long as $GOPATH is readable, writeable and executable by you. I don't know why btcd says to use it</p>\n"}, {"tags": [], "owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "is_accepted": false, "score": 0, "last_activity_date": 1488147906, "creation_date": 1488147906, "answer_id": 42474969, "question_id": 42474874, "link": "https://stackoverflow.com/questions/42474874/the-glide-install-command-returns-errorgopath-is-not-set/42474969#42474969", "title": "The glide install command returns [ERROR]\t$GOPATH is not set", "body": "<p>You don't need the <code>sudo</code> part of the command. Glide will download your dependencies on ~/go/src/github.com/btcsuite/btcd/vendor, so you don't need superuser permissions for anything. Since you're running the command as <code>sudo</code> your environment variables are not set as If you're executing your command as <code>yako</code></p>\n"}], "owner": {"reputation": 7628, "user_id": 4885784, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9b10fe019f6c7800bef029835802cb38?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Kobe", "link": "https://stackoverflow.com/users/4885784/daniel-kobe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2536, "favorite_count": 0, "accepted_answer_id": 42474924, "answer_count": 2, "score": 1, "last_activity_date": 1498653897, "creation_date": 1488147249, "last_edit_date": 1498653897, "question_id": 42474874, "link": "https://stackoverflow.com/questions/42474874/the-glide-install-command-returns-errorgopath-is-not-set", "title": "The glide install command returns [ERROR]\t$GOPATH is not set", "body": "<p>Im trying to install <a href=\"https://github.com/btcsuite/btcd\" rel=\"nofollow noreferrer\">https://github.com/btcsuite/btcd</a> </p>\n\n<p>I followed the instructions (with the exception of adding sudo) by first installing glide like so</p>\n\n<p><code>sudo go get -u github.com/Masterminds/glide</code></p>\n\n<p>Then I cloned the repo to the appropriate folder like so</p>\n\n<p><code>git clone https://github.com/btcsuite/btcd $GOPATH/src/github.com/btcsuite/btcd</code></p>\n\n<p>Now the repo is located at this folder: <code>/Users/yako/go/src/github.com/btcsuite/btcd</code></p>\n\n<p>The problem occurs when I run <code>sudo glide install</code> in the folder. I get <code>[ERROR]    $GOPATH is not set.</code></p>\n\n<p>Im pretty sure I did set these correctly thought as the <code>go env GOROOT GOPATH</code> command returns</p>\n\n<p><code>/usr/local/go\n/Users/yako/go</code></p>\n\n<p>and <code>echo $GOROOT</code> returns <code>/usr/local/go</code> and <code>echo $GOPATH</code> returns <code>/Users/yako/go</code></p>\n"}, {"tags": ["go", "count", "readfile"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1488146886, "post_id": 42474806, "comment_id": 72090037, "body": "Add <code>fmt.Printf(&quot;%q\\n&quot;, dat)</code> to confirm that the paragraphs are separated by exactly two newlines.  Also, the application is counting separators, not paragraphs. The number of paragraphs is one plus the number of separators."}, {"owner": {"reputation": 11, "user_id": 7090146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4856843e24db9ce19b5fbbbfe855b835?s=128&d=identicon&r=PG&f=1", "display_name": "Burak &#199;ay\u0131r", "link": "https://stackoverflow.com/users/7090146/burak-%c3%87ay%c4%b1r"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1488147460, "post_id": 42474806, "comment_id": 72090229, "body": "@CeriseLim&#243;n thank you very much. Its working now. I changed &quot;\\n\\n&quot; &gt; &quot;\\n\\r\\n&quot;."}], "owner": {"reputation": 11, "user_id": 7090146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4856843e24db9ce19b5fbbbfe855b835?s=128&d=identicon&r=PG&f=1", "display_name": "Burak &#199;ay\u0131r", "link": "https://stackoverflow.com/users/7090146/burak-%c3%87ay%c4%b1r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 185, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488146776, "creation_date": 1488146776, "question_id": 42474806, "link": "https://stackoverflow.com/questions/42474806/counting-paragraphs-with-golang", "title": "Counting paragraphs with Golang?", "body": "<p><strong>However little known the feelings or views of such a man may be on his\nfirst entering a neighbourhood, this truth is so well fixed in the minds\nof the surrounding families, that he is considered the rightful property\nof some one or other of their daughters.</strong></p>\n\n<p><strong>My dear Mr. Bennet,\" said his lady to him one day, \"have you heard that\nNetherfield Park is let at last?</strong></p>\n\n<p><strong>Mr. Bennet replied that he had not.</strong></p>\n\n<pre><code>func readBook(filePath string) {\n     dat , err := ioutil.ReadFile(filePath)\n     check(err)\n     book := string(dat)\n     fmt.Print(\"paragraph : \",strings.Count(book,\"\\n\\n\"))\n}\n</code></pre>\n\n<p>I am trying but I cant .That is return '0'. I want '3'. How can I count paragraphs ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 876, "user_id": 137196, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/244e6196a79d2f18d873577f0d6459f7?s=128&d=identicon&r=PG", "display_name": "Louie Miranda", "link": "https://stackoverflow.com/users/137196/louie-miranda"}, "edited": false, "score": 0, "creation_date": 1603879549, "post_id": 42474385, "comment_id": 114173534, "body": "I tried this on echo labstack after initializing the server := app.Run(), ts := httptest.NewServer(server) works fine too."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 13, "last_activity_date": 1511253945, "last_edit_date": 1511253945, "creation_date": 1488144033, "answer_id": 42474385, "question_id": 42474259, "link": "https://stackoverflow.com/questions/42474259/golang-how-to-live-test-an-http-server/42474385#42474385", "title": "golang how to live test an http server?", "body": "<p>Use the <a href=\"https://godoc.org/net/http/httptest#Server\" rel=\"noreferrer\">net/http/httptest.Server</a> type to test with a live server. </p>\n\n<pre><code>func TestIndex(t *testing.T) {\n  // Create server using the a router initialized elsewhere. The router\n  // can be a Gorilla mux as in the question, a net/http ServeMux, \n  // http.DefaultServeMux or any value that statisfies the net/http\n  // Handler interface.\n  ts := httptest.NewServer(router)  \n  defer ts.Close()\n\n  newreq := func(method, url string, body io.Reader) *http.Request {\n    r, err := http.NewRequest(method, url, body)\n    if err != nil {\n        t.Fatal(err)\n    }\n    return r\n  }\n\n  tests := []struct {\n    name string\n    r    *http.Request\n  }{\n    {name: \"1: testing get\", r: newreq(\"GET\", ts.URL+\"/\", nil)},\n    {name: \"2: testing post\", r: newreq(\"POST\", ts.URL+\"/\", nil)}, // reader argument required for POST\n  }\n  for _, tt := range tests {\n    t.Run(tt.name, func(t *testing.T) {\n        resp, err := http.DefaultClient.Do(tt.r)\n        defer resp.Body.Close()\n        if err != nil {\n            t.Fatal(err)\n        }\n        // check for expected response here.\n    })\n  }\n}\n</code></pre>\n\n<p>Although the question uses Gorilla mux, the approach and details in this answer apply to any router that satisfies the http.Handler interface.</p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5854, "favorite_count": 1, "accepted_answer_id": 42474385, "answer_count": 1, "score": 8, "last_activity_date": 1511253945, "creation_date": 1488143144, "question_id": 42474259, "link": "https://stackoverflow.com/questions/42474259/golang-how-to-live-test-an-http-server", "title": "golang how to live test an http server?", "body": "<p>I use gotests, and gorilla mux and I can unit test my http handlefunc handlers, but they do not respond to the proper http request methods as they should under the gorilla mux. How I can do a \"live server\" version of the test?</p>\n\n<pre><code>func main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", views.Index).Methods(\"GET\")\n}\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n\n    fmt.Fprintf(w, \"INDEX\\n\")\n}\n\nfunc TestIndex(t *testing.T) {\n\n    req, _ := http.NewRequest(\"GET\", \"/\", nil)\n    req1, _ := http.NewRequest(\"POST\", \"/\", nil)\n    rr := httptest.NewRecorder()\n\n    handler := http.HandlerFunc(Index)\n\n    type args struct {\n        w http.ResponseWriter\n        r *http.Request\n    }\n    tests := []struct {\n        name string\n        args args\n    }{\n        {name: \"1: testing get\", args: args{w: rr, r: req}},\n        {name: \"2: testing post\", args: args{w: rr, r: req1}},\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            handler.ServeHTTP(tt.args.w, tt.args.r)\n            log.Println(tt.args.w)\n        })\n    }\n}\n</code></pre>\n\n<p>The problem here is that the function responds to both the get and post requests and\ndoens't take into account my main router. This is fine for unit testing the function,\nbut I think it would be better to just write an integrated test that tests the whole\nthing and gets everything out of the way in one go. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488142914, "post_id": 42473897, "comment_id": 72088785, "body": "Your JSON example doesn&#39;t export fields that start with lowercase letters. The exported fields are called <code>FieldA</code> and <code>FieldB</code> respective--clearly beginning with uppercase letters."}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488143508, "post_id": 42473897, "comment_id": 72088963, "body": "@Flimzy the output JSON will have the lowercase-started identifiers, that&#39;s what I need for my library as well. Isn&#39;t that obvious, why downvote for such an artificial complain?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488183797, "post_id": 42473897, "comment_id": 72101476, "body": "The output JSON has nothing to do with exported variables, except that the json Marshaler, for obvious reasons, can <i>only access exported variables</i>. So if anything, it&#39;s the exact opposite of what you claim."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 4, "last_activity_date": 1488141475, "last_edit_date": 1592644375, "creation_date": 1488141475, "answer_id": 42473964, "question_id": 42473897, "link": "https://stackoverflow.com/questions/42473897/exporting-a-function-whose-name-starts-with-a-lower-case-letter/42473964#42473964", "title": "Exporting a function whose name starts with a lower case letter", "body": "<p>No, there is not. The <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Go language specification</a> specifies this clearly:</p>\n<blockquote>\n<h3>Exported identifiers</h3>\n<p>An identifier may be exported to permit access to it from another package. An identifier is exported if both:</p>\n<ol>\n<li>the first character of the identifier's name is a Unicode upper case letter (Unicode class &quot;Lu&quot;); and</li>\n<li>the identifier is declared in the package block or it is a field name or method name.</li>\n</ol>\n<p>All other identifiers are not exported.</p>\n</blockquote>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1170, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1488141475, "creation_date": 1488141151, "question_id": 42473897, "link": "https://stackoverflow.com/questions/42473897/exporting-a-function-whose-name-starts-with-a-lower-case-letter", "title": "Exporting a function whose name starts with a lower case letter", "body": "<p>Just curious, is there a way to export a function whose name starts with a lower case character, like \"print\" or \"start\"?</p>\n\n<p>A side note: just like you do with JSON:</p>\n\n<pre><code>type T struct {\n    FieldA int    `json:\"field_a\"`\n    FieldB string `json:\"field_b,omitempty\"`\n}\n</code></pre>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488140958, "post_id": 42473834, "comment_id": 72088110, "body": "<a href=\"https://golang.org/\" rel=\"nofollow noreferrer\">golang.org</a> has download links and documentation"}, {"owner": {"reputation": 25, "user_id": 7464028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad327cde08f25cb7b41ccc24b4104e2?s=128&d=identicon&r=PG&f=1", "display_name": "Love Python", "link": "https://stackoverflow.com/users/7464028/love-python"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141113, "post_id": 42473834, "comment_id": 72088181, "body": "yes , but i want without go compilers. and just a main GO app."}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141283, "post_id": 42473834, "comment_id": 72088235, "body": "You need the go compilers to build a go app."}, {"owner": {"reputation": 25, "user_id": 7464028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad327cde08f25cb7b41ccc24b4104e2?s=128&d=identicon&r=PG&f=1", "display_name": "Love Python", "link": "https://stackoverflow.com/users/7464028/love-python"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141471, "post_id": 42473834, "comment_id": 72088309, "body": "so golang not have a pkg for build?"}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141558, "post_id": 42473834, "comment_id": 72088333, "body": "A pkg as in apt-get or yum or something similar? Yes, those usually exist too"}, {"owner": {"reputation": 25, "user_id": 7464028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad327cde08f25cb7b41ccc24b4104e2?s=128&d=identicon&r=PG&f=1", "display_name": "Love Python", "link": "https://stackoverflow.com/users/7464028/love-python"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141692, "post_id": 42473834, "comment_id": 72088381, "body": "example : <a href=\"https://github.com/caixw/gobuild\" rel=\"nofollow noreferrer\">github.com/caixw/gobuild</a> , <a href=\"https://github.com/ahmetb/govvv\" rel=\"nofollow noreferrer\">github.com/ahmetb/govvv</a> , <a href=\"https://github.com/songgao/colorgo\" rel=\"nofollow noreferrer\">github.com/songgao/colorgo</a>"}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141832, "post_id": 42473834, "comment_id": 72088427, "body": "Those need the core tools installed to use"}, {"owner": {"reputation": 25, "user_id": 7464028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad327cde08f25cb7b41ccc24b4104e2?s=128&d=identicon&r=PG&f=1", "display_name": "Love Python", "link": "https://stackoverflow.com/users/7464028/love-python"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488572607, "post_id": 42473834, "comment_id": 72307725, "body": "go have a portable version? mean not install go, but can use from go.(example <code>&#47;home&#47;guest&#47;go-portable&#47;go help</code>)"}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488581127, "post_id": 42473834, "comment_id": 72311684, "body": "go is a compiler toolchain. It compiles native executables, you don&#39;t need go installed to run a compiled go protram, only to compile or run a go file. However, to build an app you need to install the packages"}], "answers": [{"tags": [], "owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "is_accepted": false, "score": 0, "last_activity_date": 1527746300, "creation_date": 1527746300, "answer_id": 50617588, "question_id": 42473834, "link": "https://stackoverflow.com/questions/42473834/how-build-new-golang-console-app-in-a-main-go-app/50617588#50617588", "title": "How Build New Golang Console App in a Main Go App?", "body": "<p>If you don't have go on your system, you can use <a href=\"https://www.docker.com/\" rel=\"nofollow noreferrer\">docker</a> to build image with your program and run it in container</p>\n"}], "owner": {"reputation": 25, "user_id": 7464028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad327cde08f25cb7b41ccc24b4104e2?s=128&d=identicon&r=PG&f=1", "display_name": "Love Python", "link": "https://stackoverflow.com/users/7464028/love-python"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527746300, "creation_date": 1488140814, "last_edit_date": 1592644375, "question_id": 42473834, "link": "https://stackoverflow.com/questions/42473834/how-build-new-golang-console-app-in-a-main-go-app", "title": "How Build New Golang Console App in a Main Go App?", "body": "<p>How Build New Golang Console App in a Main Go App?\nmean on a system without go compilers with main app.</p>\n<p>example :</p>\n<blockquote>\n<p>$go build main.go//this is main app (<em><strong>i dont know how make this!</strong></em>)</p>\n<p>./main file.go</p>\n</blockquote>\n<p>and after this , build <code>file.go</code> and save as <code>file</code>.\nalso can change <code>OS,ARCH</code> in main.go..</p>\n<p>how can make this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "edited": false, "score": 1, "creation_date": 1488140461, "post_id": 42473739, "comment_id": 72087893, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/24822826/cant-i-get-rid-of-fmt-prefix-when-calling-println-in-golang\">Cant I get rid of fmt prefix when calling Println in Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 4, "last_activity_date": 1488141150, "last_edit_date": 1488141150, "creation_date": 1488140501, "answer_id": 42473772, "question_id": 42473739, "link": "https://stackoverflow.com/questions/42473739/how-to-export-a-name-so-that-it-becomes-globally-accessible/42473772#42473772", "title": "How to export a name so that it becomes globally accessible?", "body": "<p>You can use one of the followings:</p>\n\n<pre><code>import (  \n    .     \"mypackage\"                           // without a name  \n    mp    \"my/other/package\"                    // rename\n    _     \"my/totally/diffrent/package\"         // import a package solely for its side-effects (initialization)\n)\n</code></pre>\n\n<p>Obviously, this pattern is not recommended since it can cause name conflicts with other packages.</p>\n\n<p><a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow noreferrer\">Check out the dot imports bulletin</a></p>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488141150, "creation_date": 1488140312, "question_id": 42473739, "link": "https://stackoverflow.com/questions/42473739/how-to-export-a-name-so-that-it-becomes-globally-accessible", "title": "How to export a name so that it becomes globally accessible?", "body": "<p>I want to export a function from my package so that I can use it without typing a package name before it, how to do that?</p>\n\n<pre><code>import \"mypackage\"\n\nfunc main() {\n   mypackage.myfunc()    &lt;-- that's what I have already\n   myfunc()              &lt;-- that's what I need\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488139577, "post_id": 42473550, "comment_id": 72087572, "body": "Why not cast them to the Operable interface instead?"}, {"owner": {"reputation": 175, "user_id": 1743844, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f0b7f65a31f651365d53e05ea7e13e55?s=128&d=identicon&r=PG", "display_name": "stu", "link": "https://stackoverflow.com/users/1743844/stu"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488140086, "post_id": 42473550, "comment_id": 72087764, "body": "@JimDeville I&#39;ve tried that but then I can&#39;t access the field <code>Name</code> and I get the error <code>theOp.Name undefined (type Operable has no field or method Name)</code>"}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488140548, "post_id": 42473550, "comment_id": 72087938, "body": "Is that a field you could expect everywhere? Could you wrap it with a method in Operable?"}, {"owner": {"reputation": 175, "user_id": 1743844, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f0b7f65a31f651365d53e05ea7e13e55?s=128&d=identicon&r=PG", "display_name": "stu", "link": "https://stackoverflow.com/users/1743844/stu"}, "reply_to_user": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141375, "post_id": 42473550, "comment_id": 72088269, "body": "that&#39;s a good idea.  The only issue is that there will be other attributes that will be different, but I&#39;m thinking that I might just be approaching this in an anti-Go way."}, {"owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "edited": false, "score": 0, "creation_date": 1488141489, "post_id": 42473550, "comment_id": 72088316, "body": "The way I would approach it if I needed that kind of control is a type switch: <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#type_switch</a>"}], "owner": {"reputation": 175, "user_id": 1743844, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f0b7f65a31f651365d53e05ea7e13e55?s=128&d=identicon&r=PG", "display_name": "stu", "link": "https://stackoverflow.com/users/1743844/stu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488139323, "creation_date": 1488139323, "question_id": 42473550, "link": "https://stackoverflow.com/questions/42473550/how-to-instantiate-golang-struct-by-name-and-use-it-as-that-type-without-directl", "title": "How to instantiate golang struct by name and use it as that type without directly referencing the struct", "body": "<p>I've seen a very similar question to this one but it doesn't address one important detail.  How do you do this entirely through variables and without directly referencing the struct.</p>\n\n<p>For instance, given the following, I've tried a few variants of <code>main()</code> methods to test this out:</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"fmt\"\n)\n\ntype Operable interface {\n    compute() string\n}\n\ntype Operator struct {\n    Operable\n    Name string\n    Type string\n}\n\nfunc (o Operator) compute() string {\n    return \"operating\"\n}\n\ntype Read struct {\n    Operator\n}\n\nfunc (r Read) compute() string {\n    return \"reading\"\n}\n\nvar Operators = make(map[string]reflect.Type)\n\nfunc init() {\n    Operators[reflect.TypeOf(Read{}).Name()] = reflect.TypeOf(Read{})\n}\n</code></pre>\n\n<p>I want to instantiate a new <code>Read struct</code> (<code>Operator</code>) from a string.<br>\nIn the following, I get the error <code>theOp.Name undefined (type interface {} is interface with no methods)</code>.  Which is expected.</p>\n\n<pre><code>func main() {\n    nameOfOp := \"Read\"\n    typeOfOp := Operators[nameOfOp]\n\n    theOp := reflect.New(typeOfOp).Elem().Interface()\n\n    fmt.Println(theOp.Name)\n}\n</code></pre>\n\n<p>If I do the following, I get the error <code>typeOfOp is not a type</code>.</p>\n\n<pre><code>func main() {\n    nameOfOp := \"Read\"\n    typeOfOp := Operators[nameOfOp]\n\n    theOp := reflect.New(typeOfOp).Elem().Interface().(typeOfOp)\n\n    fmt.Println(theOp.Name)\n}\n</code></pre>\n\n<p>The only thing I have found to compile is to explicitly enter the struct type.  But I want this to be dynamic, any thoughts?</p>\n\n<pre><code>func main() {\n    nameOfOp := \"Read\"\n    typeOfOp := Operators[nameOfOp]\n\n    theOp := reflect.New(typeOfOp).Elem().Interface().(Read)\n\n    fmt.Println(theOp.Name)\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["string", "go", "decode"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 0, "last_activity_date": 1488137750, "creation_date": 1488137750, "answer_id": 42473216, "question_id": 42472754, "link": "https://stackoverflow.com/questions/42472754/golang-64decode-string-illegal-data-not-sure-why/42473216#42473216", "title": "GOLANG 64decode string illegal data, not sure why", "body": "<p>JWT's are base64 URL encoded and not padded.</p>\n\n<p><a href=\"https://play.golang.org/p/LlRf2Pr5-0\" rel=\"nofollow noreferrer\">Here's a fixed version on play</a></p>\n\n<p>Only difference is I used <a href=\"https://golang.org/pkg/encoding/base64/#pkg-variables\" rel=\"nofollow noreferrer\">base64.RawURLEncoding</a></p>\n"}], "owner": {"reputation": 1745, "user_id": 3888307, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/65d6a22ea2fb9fb7a3d78bd57b9d71ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3888307", "link": "https://stackoverflow.com/users/3888307/user3888307"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 42473216, "answer_count": 1, "score": 0, "last_activity_date": 1488137750, "creation_date": 1488135411, "question_id": 42472754, "link": "https://stackoverflow.com/questions/42472754/golang-64decode-string-illegal-data-not-sure-why", "title": "GOLANG 64decode string illegal data, not sure why", "body": "<p>Fellow Gophers:</p>\n\n<p>I'm stuck on something simple. I'm trying to convert decode a 64endoded string (OAUTH token to be exact).</p>\n\n<p>I split the string, and put one of the parts of the split to be 64decoded, and I always find an illegal character. When I put the same value into any web based 64decoder it works.</p>\n\n<p>I think that maybe there is a trailing null or something. Can anyone give me some advice. I put the code here: <a href=\"https://play.golang.org/p/cf-x6GgpEp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cf-x6GgpEp</a></p>\n\n<p>The exact error is: <code>illegal base64 data at input byte 408</code></p>\n\n<p>Below is the code as well, its pretty short:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    b64 \"encoding/base64\"\n)\n\nfunc main() {\n\n    fmt.Println(\"Hello, playground and stackover flow users\")\n\n\n    token := `eyJhbGciOiJSUzI1NiIsImtpZCI6IkNKc2hmNnhMOGVuODlhVVZVenJaX1JqMTJwS3pqZkFUdkNqcT    lNbUxGTlUifQ.eyJ2ZXIiO\njEsImp0aSI6IkFULlFxN21mck94RnhZaVFXZWpGQjczMTZnRXdQbWJBVGtsVzB6Sm1FWVRPU0UiLCJp    c3MiOiJodHRwczovL2Nvb\nXBhbnl4Lm9rdGEuY29tL29hdXRoMi9hdXMxYTRpYmRhdDBKWXc1czFkOCIsImF1ZCI6Imh0dHA6Ly9s    b2NhbGhvc3Q6MzAwMCIsI\nmlhdCI6MTQ4ODA2MDgxMywiZXhwIjoxNDg4MDY0NDEzLCJjaWQiOiIzam1OdlZDRlo1RjZsV096SU9O    TyIsInVpZCI6IjAwdTFhOXNrMXloenR3Y3FSMWQ4Iiwic2NwIjpbInJlYWQiLCJyZW1vdmUiLCJyZXN    lcnZlIl0sInN1YiI6InJlbW92ZUB3b3cuY29tIn0\n.XFGZoVv-w4kRgqMDB-Me1RM1aO5f5JH8W_fLFGnYzkLXGassbKMWafAfVx9j-    wzaWVFfHtsH4fiLjZZbCRYkWli0b6Q3VjdDPJq\nYcvhN_wQ9WTmqoJLNyY-    AA5o7yThL4Vz5ih7P_nJWMN7xEWUpWadeJbShvPNtdFHHPBFTAiDx0fXFs98vZHfeLEy2dnwYf4aY4p    w\njcfmhOZNaVahMtQh0dJVa0ai4KPMqQXDXMHDrbEwa2eWY_2pCPXUZekvC3DyRFeSfkRJ6fIe3d6XccDgAy_qzjBCjnutyezg7ZzV\nd866wkb2j2kJwyr0w3Q5iBBFgxEv6vpcpaM_KHSXTyA`\n\n\n// Spit the token to get the middle value xx.(we want this).xx\n\n\n\n fragments := strings.Split(token,\".\")\nfmt.Println ( \"Here is the value\\n\"+fragments[1])\n\njwtFragment, err := b64.StdEncoding.DecodeString(fragments[1])\n_=jwtFragment //\n\nfmt.Println (err)\n\nfmt.Println (\"any ideas\")\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "subprocess"], "comments": [{"owner": {"reputation": 3396, "user_id": 2586108, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b9bfe0d3e55c7d7a9693c713a67d8618?s=128&d=identicon&r=PG", "display_name": "John B", "link": "https://stackoverflow.com/users/2586108/john-b"}, "edited": false, "score": 0, "creation_date": 1488138319, "post_id": 42471349, "comment_id": 72087046, "body": "There seems to be a problem with how &quot;when main() exits, test.sh will stop running&quot; is being asserted and/or why the result isn&#39;t what you expect. How long of a run time is <code>test.sh</code> expected to have? How long after executing the go program have you checked to see if the <code>test.sh</code> process is still running?  Take the following <code>test.sh</code>: <code>for _ in $(seq 20); do sleep 1; done</code>. Now, run the go program and immediately run <code>pgrep -f test.sh</code>. It should return a process ID for approx. 19-20 sec. after the go program has exited. This is the expected behavior of <code>cmd.Start()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1488128800, "post_id": 42471465, "comment_id": 72083413, "body": "Thanks for your answer, but I want <code>test.sh</code> to keep running even if when the main program is dead, in which case the subprocess is totally independent of the go program"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1488128904, "post_id": 42471465, "comment_id": 72083459, "body": "what do you mean? Are you killing the main program.  In the example above the main program doesn&#39;t die until the sh program completes, likewise you are creating a subprocess above.  If you run the program above and then use something like ps aux | grep test.sh in a terminal, you&#39;ll see the script is running independently of the go program."}, {"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1488129121, "post_id": 42471465, "comment_id": 72083544, "body": "What if I add <code>&amp;</code> to my command?... I think it might be a solution"}, {"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1488129533, "post_id": 42471465, "comment_id": 72083685, "body": "Just want to make sure the subprocess is always running even when the main program is not, yes, <code>Run()</code> and <code>Wait()</code> will tell Golang to wait for my process to finish, but I don&#39;t need that"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1488129990, "last_edit_date": 1488129990, "creation_date": 1488128386, "answer_id": 42471465, "question_id": 42471349, "link": "https://stackoverflow.com/questions/42471349/how-to-keep-subprocess-running-after-program-exit-in-golang/42471465#42471465", "title": "how to keep subprocess running after program exit in golang?", "body": "<p>Try modding you program a to use Run instead of start.  In that way the Go program will wait for the sh script to finish before exiting.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"sh\", \"test.sh\")\n    err := cmd.Run()\n    if err != nil {\n        log.Fatalln(err)\n    }\n}\n</code></pre>\n\n<p>Likewise, you could always use a wait group but I think that's overkill here.</p>\n\n<p>You could also just a go routine with or without a wait group. Depends on if you want go to wait for the program the sh program to complete</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n)\n\nfunc runOffMainProgram() {\n    cmd := exec.Command(\"sh\", \"test.sh\")\n    cmd.Start()\n}\n\nfunc main() {\n    // This will start a go routine, but without a waitgroup this program will exit as soon as it runs\n    // regardless the sh program will be running in the background. Until the sh program completes\n    go runOffMainProgram()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 1, "creation_date": 1488130220, "post_id": 42471703, "comment_id": 72083939, "body": "Yeah now I understand that subprocess doesn&#39;t exit with main program, I am going to add <code>&amp;</code> to the shell command, ( dunno if <code>^C</code> kills subprocess too"}], "tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": true, "score": 2, "last_activity_date": 1558301027, "last_edit_date": 1558301027, "creation_date": 1488129690, "answer_id": 42471703, "question_id": 42471349, "link": "https://stackoverflow.com/questions/42471349/how-to-keep-subprocess-running-after-program-exit-in-golang/42471703#42471703", "title": "how to keep subprocess running after program exit in golang?", "body": "<p>The subprocess should continue to run after your process ends, as long as it ends cleanly, which won't happen if you hit <code>^C</code>.\nWhat you can do is intercept the signals sent to your process so you can end cleanly.</p>\n\n<pre><code>sigchan := make(chan os.Signal, 1)\nsignal.Notify(sigchan,\n    syscall.SIGINT,\n    syscall.SIGKILL,\n    syscall.SIGTERM,\n    syscall.SIGQUIT)\ngo func() {\n    s := &lt;-sigchan\n    // do anything you need to end program cleanly\n}()\n</code></pre>\n"}], "owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3157, "favorite_count": 1, "accepted_answer_id": 42471703, "answer_count": 2, "score": 1, "last_activity_date": 1558301027, "creation_date": 1488127829, "question_id": 42471349, "link": "https://stackoverflow.com/questions/42471349/how-to-keep-subprocess-running-after-program-exit-in-golang", "title": "how to keep subprocess running after program exit in golang?", "body": "<p>i noticed that subprocesses created using <code>Start()</code> will be terminated after program exit, for example:\n</p>\n\n<pre><code>package main\n\nimport \"os/exec\"\n\nfunc main() {\n    cmd := exec.Command(\"sh\", \"test.sh\")\n    cmd.Start()\n}\n</code></pre>\n\n<p>when <code>main()</code> exits, <code>test.sh</code> will stop running</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488120320, "post_id": 42469833, "comment_id": 72080514, "body": "the link you provided is different with your code, did you get from different commit ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535359302, "post_id": 42469833, "comment_id": 91021042, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45122905/how-do-struct-and-struct-work-in-go\">How do struct{} and struct{}{} work in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1467, "user_id": 517783, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9rdPU.jpg?s=128&g=1", "display_name": "Sameer Azazi", "link": "https://stackoverflow.com/users/517783/sameer-azazi"}, "edited": false, "score": 2, "creation_date": 1488121320, "post_id": 42470006, "comment_id": 72080879, "body": "There is a little inaccuracy in the last line of your answer. Non declared fields will have <code>zero value</code> (<code>nil</code> &amp; <code>zero value</code> are not same). <a href=\"https://tour.golang.org/basics/12\" rel=\"nofollow noreferrer\">tour.golang.org/basics/12</a>"}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "reply_to_user": {"reputation": 1467, "user_id": 517783, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9rdPU.jpg?s=128&g=1", "display_name": "Sameer Azazi", "link": "https://stackoverflow.com/users/517783/sameer-azazi"}, "edited": false, "score": 0, "creation_date": 1488121478, "post_id": 42470006, "comment_id": 72080923, "body": "@SameerAzazi Thanks for pointing out. please edit if you found some inaccuracy in the answer."}, {"owner": {"reputation": 74019, "user_id": 292291, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e31d9d39e9fb0ec4cc5573a5e5b01ce7?s=128&d=identicon&r=PG", "display_name": "Jiew Meng", "link": "https://stackoverflow.com/users/292291/jiew-meng"}, "edited": false, "score": 0, "creation_date": 1488187341, "post_id": 42470006, "comment_id": 72103553, "body": "@GujaratSantana, Thank you for your answer. But I still dont understand the &quot;* How does the OmitID part prevent id from being set?*&quot; part. It seems like if I pass an <code>id</code>, it will override the <code>id</code> field? How does having OmitID prevent this from happening?"}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488189391, "post_id": 42470006, "comment_id": 72104881, "body": "It is because of <code>tags</code> json at line <code>193</code> in the code. there is omitempty."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "reply_to_user": {"reputation": 74019, "user_id": 292291, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e31d9d39e9fb0ec4cc5573a5e5b01ce7?s=128&d=identicon&r=PG", "display_name": "Jiew Meng", "link": "https://stackoverflow.com/users/292291/jiew-meng"}, "edited": false, "score": 0, "creation_date": 1488189452, "post_id": 42470006, "comment_id": 72104923, "body": "@JiewMeng you can read more here <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a>. <code>The &quot;omitempty&quot; option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.</code>"}], "tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": false, "score": 6, "last_activity_date": 1488121709, "last_edit_date": 1488121709, "creation_date": 1488121040, "answer_id": 42470006, "question_id": 42469833, "link": "https://stackoverflow.com/questions/42469833/golang-struct-meaning/42470006#42470006", "title": "Golang struct {}{} meaning", "body": "<p>The first <code>{}</code> in the <code>struct</code> definition is for define the field or attribute of that struct. </p>\n\n<pre><code>data := struct {\n    *Article\n    OmitID interface{} `json:\"id,omitempty\"` // prevents 'id' from being overridden\n}\n</code></pre>\n\n<p>So the <code>data</code> is a struct that has fields <code>*Article</code> and <code>OmitID</code> with their respected type.</p>\n\n<blockquote>\n  <p>What does the {Article: article} part do?</p>\n</blockquote>\n\n<p>the second <code>{}</code> is for defining the value of that field. </p>\n\n<pre><code>{Article: article}\n</code></pre>\n\n<p>this part is defining the value of <code>Article</code> field.</p>\n\n<blockquote>\n  <p>How does the OmitID part prevent id from being set?</p>\n</blockquote>\n\n<p>In go you can define any number of field in the struct.\nAnd you can call define it by calling the field and the value with the respected type. for example if I have this struct : </p>\n\n<pre><code>type DriverData struct {\n    Name     string  `json:\"name\"`\n    Status   bool    `json:\"status\"`\n    Location GeoJson `json:\"location\"`\n}\n</code></pre>\n\n<p>I can call it like this : </p>\n\n<pre><code>example := DriverData{Name : \"SampleName\"}\n</code></pre>\n\n<p>the rest of the field will have <code>zero values</code> based on their respective data types.</p>\n\n<p>You can read about golang <code>Zero Values</code> <a href=\"https://tour.golang.org/basics/12\" rel=\"noreferrer\">here</a></p>\n"}], "owner": {"reputation": 74019, "user_id": 292291, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e31d9d39e9fb0ec4cc5573a5e5b01ce7?s=128&d=identicon&r=PG", "display_name": "Jiew Meng", "link": "https://stackoverflow.com/users/292291/jiew-meng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1488121709, "creation_date": 1488120027, "question_id": 42469833, "link": "https://stackoverflow.com/questions/42469833/golang-struct-meaning", "title": "Golang struct {}{} meaning", "body": "<p>I am looking at the docs for the chi package. I see something like: </p>\n\n<p><a href=\"https://github.com/pressly/chi/blob/master/_examples/rest/main.go#L154\" rel=\"nofollow noreferrer\">https://github.com/pressly/chi/blob/master/_examples/rest/main.go#L154</a></p>\n\n<pre><code>data := struct {\n    *Article\n    OmitID interface{} `json:\"id,omitempty\"` // prevents 'id' from being overridden\n}{Article: article}\n</code></pre>\n\n<p>How do I interpret this? 2 parts I don't fully understand</p>\n\n<ul>\n<li>How does the <code>OmitID</code> part prevent <code>id</code> from being set? </li>\n<li>What does the <code>{Article: article}</code> part do? </li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488206198, "post_id": 42469599, "comment_id": 72116365, "body": "If you want to find a binary in the PATH, you need to look for it in the PATH. You can use <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\"><code>exec.LookPath</code></a> or call out to a shell. Any other requirements would be system specific."}], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1488122654, "creation_date": 1488122654, "answer_id": 42470349, "question_id": 42469599, "link": "https://stackoverflow.com/questions/42469599/how-can-i-check-if-program-package-is-installed-on-os/42470349#42470349", "title": "How can I check if program/package is installed on OS?", "body": "<p>Do you mean a go <code>package</code> ?\nIf so, try to use <code>go list github.com/some/package</code></p>\n"}], "owner": {"reputation": 239, "user_id": 4015178, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100003976369429/picture?type=large", "display_name": "Raimondas Kazlauskas", "link": "https://stackoverflow.com/users/4015178/raimondas-kazlauskas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 684, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488122654, "creation_date": 1488118571, "last_edit_date": 1488119189, "question_id": 42469599, "link": "https://stackoverflow.com/questions/42469599/how-can-i-check-if-program-package-is-installed-on-os", "title": "How can I check if program/package is installed on OS?", "body": "<p>I want to check if <code>dot</code> package is installed and is executable on current <strong>OS</strong> with <strong>Go</strong>.</p>\n\n<p>My first idea was to check PATH variable for <code>/dot</code> string?\nAre there any better ways to get executable/installed packages using <strong>Go</strong>?</p>\n\n<p>Any advice will be helpful, thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 630, "user_id": 3375166, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-ueMaK6yqY_0/AAAAAAAAAAI/AAAAAAAAABM/bubjZpCCPLk/photo.jpg?sz=128", "display_name": "Charrette", "link": "https://stackoverflow.com/users/3375166/charrette"}, "is_accepted": true, "score": 4, "last_activity_date": 1488276487, "creation_date": 1488276487, "answer_id": 42505747, "question_id": 42468552, "link": "https://stackoverflow.com/questions/42468552/how-to-handle-proxying-to-multiple-services-with-golang-and-labstack-echo/42505747#42505747", "title": "How to handle proxying to multiple services with golang and labstack echo", "body": "<p>Thanks to an answer on an issue I posted on labstack/echo github, here is the solution:</p>\n\n<p><code>httputil.ReverseProxy</code> implements <code>http.Handler</code>, so you can do something like:</p>\n\n<pre><code>e := echo.New()\nproxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n    Scheme: \"http\",\n    Host:   \"localhost:8081\",\n})\ne.Any(\"/users\", echo.WrapHandler(proxy))\ne.Start(\":8080\")\n</code></pre>\n"}], "owner": {"reputation": 630, "user_id": 3375166, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-ueMaK6yqY_0/AAAAAAAAAAI/AAAAAAAAABM/bubjZpCCPLk/photo.jpg?sz=128", "display_name": "Charrette", "link": "https://stackoverflow.com/users/3375166/charrette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1489, "favorite_count": 0, "accepted_answer_id": 42505747, "answer_count": 1, "score": 5, "last_activity_date": 1488276487, "creation_date": 1488112461, "question_id": 42468552, "link": "https://stackoverflow.com/questions/42468552/how-to-handle-proxying-to-multiple-services-with-golang-and-labstack-echo", "title": "How to handle proxying to multiple services with golang and labstack echo", "body": "<p>I'm new to Go and Micro-services development, but I hope my question will make sense:</p>\n\n<p>Let's say I have a micro-service handling users actions such as creating, showing &amp; updating an user, available at <code>localhost:8081/users</code>.</p>\n\n<p>Beside that, I have a micro-service handlings events' creation, show &amp; update as well, available at <code>localhost:8082/events</code>.</p>\n\n<p>And, above that, there is a gateway, available at <code>localhost:8080</code> which is suppose to act as a proxy to dispatch the incoming request to the right service.</p>\n\n<p>I found this piece of code which is working well to redirect from my gateway to my user's service:</p>\n\n<pre><code>proxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n    Scheme: \"http\",\n    Host:   \"localhost:8081\",\n})\nhttp.ListenAndServe(\":8080\", proxy)\n</code></pre>\n\n<p>But two things are bothering me:</p>\n\n<ul>\n<li><p>How am I suppose to handle dispatching on multiple micro-services? I'd like to have a condition such as: \"If the client requests <code>localhost:8080/users</code> it should go to the user's service. If he requests <code>localhost:8080/events</code> it should go to the event's service. (Please feel free to tell me if this approach is just wrong)</p></li>\n<li><p>As I mentioned in the title, I'm using the labstack/echo Router, so I don't want to start my server with <code>http.ListenAndServe(\":8080\", proxy)</code>, but with something like</p>\n\n<p><code>e := echo.New()\n e.Start(\":8080\")</code></p>\n\n<p>But I can't find how to pass a proxy as parameter with this tool.</p></li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1488113429, "last_edit_date": 1488113429, "creation_date": 1488112903, "answer_id": 42468630, "question_id": 42467910, "link": "https://stackoverflow.com/questions/42467910/how-to-write-a-pop-function/42468630#42468630", "title": "How to write a pop() function", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc pop(a interface{}) interface{} {\n    v := reflect.ValueOf(a).Elem()\n    x := v.Index(v.Len() - 1)\n    v.SetLen(v.Len() - 1)\n    return x\n}\n\nfunc main() {\n    a := []int{1, 2, 3}\n    x := pop(&amp;a)\n    fmt.Println(a, x) // -&gt;  [1,2] 3\n}\n</code></pre>\n\n<hr>\n\n<p>Though this can be implemented, I still think that <code>x, a = a[len(a)-1], a[:len(a)-1]</code> should be better than a pop function.</p>\n"}, {"tags": [], "owner": {"reputation": 303, "user_id": 2977136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/275c4df9289839b46d76540fedc621ad?s=128&d=identicon&r=PG&f=1", "display_name": "Abex", "link": "https://stackoverflow.com/users/2977136/abex"}, "is_accepted": false, "score": 0, "last_activity_date": 1488113031, "creation_date": 1488113031, "answer_id": 42468654, "question_id": 42467910, "link": "https://stackoverflow.com/questions/42467910/how-to-write-a-pop-function/42468654#42468654", "title": "How to write a pop() function", "body": "<p>The go type system doesn't allow you to cast from <code>[]type1 -&gt; []type2</code>. Even if it did interfaces are a struct containing a type id and pointer to the object, where normally you would just have the object. Because of this you need to take a <code>interface{}</code> and use reflect to do the slicing.</p>\n\n<pre><code>func pop(slice interface{}) (interface{}, interface{}) {\n    v := reflect.ValueOf(slice)\n    return v.Slice(0,v.Len()-1).Interface(), v.Index(v.Len()-1).Interface()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jUMB3HyWC6\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>Note that this loses compile time type safety, because it must use an interface. Additionally, due to using interfaces the poped value may be allocated, creating extra GC pressure.</p>\n\n<p>Common Go style typically recommends not writing a function like this, and just inlining the small amount of code manually.</p>\n"}, {"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1488114708, "creation_date": 1488114708, "answer_id": 42468950, "question_id": 42467910, "link": "https://stackoverflow.com/questions/42467910/how-to-write-a-pop-function/42468950#42468950", "title": "How to write a pop() function", "body": "<p>After all that really good anwers using reflection I also want to add one answer which offers a more idiomatic Go solution. Like Rob Pike said in his great talk about <a href=\"http://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">Go Proverbs</a></p>\n\n<ul>\n<li>interface{} says nothing</li>\n<li>Reflection is never clear</li>\n</ul>\n\n<p>So there should be also one answer showing the idiomatic Go way. This solution does not work for slices of standard types. But there the answer of <em>cshu</em> shows the best solution: <code>x, a = a[len(a)-1], a[:len(a)-1]</code></p>\n\n<p>For own defined types we have to define a Poper interface and the Pop function takes that as input and returns an empty interface.</p>\n\n<pre><code>type Poper interface {\n    Pop() interface{}\n}\n\ntype MyType struct {\n    a []int\n}\n\nfunc (mt *MyType) Pop() interface{} {\n    x := mt.a[len(mt.a)-1]\n    mt.a = mt.a[:len(mt.a)-1]\n    return x\n}\n\nfunc Pop(p Poper) interface{} {\n    return p.Pop()\n}\n\nfunc main() {\n    a := &amp;MyType{[]int{1, 2, 3}}\n    fmt.Println(Pop(a), a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UbDkoVYSMA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UbDkoVYSMA</a></p>\n\n<p>At all it is not a good idea to return an empty interface, because all following code has to support the interface{}. </p>\n\n<p>The following code example does not work:</p>\n\n<pre><code>func main() {\n    a := &amp;MyType{[]int{1, 2, 3}}\n    fmt.Println(Pop(a), a)\n    var b int\n    b = Pop(a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wg9__O44A8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wg9__O44A8</a></p>\n\n<p>The error says everything about that problem: <em>cannot use Pop(a) (type interface {}) as type int in assignment: need type assertion</em></p>\n\n<p>So the Pop() function does work by returning interface{} but the rest of the code using the result of that function needs to make a type assertion. So if you can avoid it you should search for another solution using types.</p>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1488114708, "creation_date": 1488108635, "question_id": 42467910, "link": "https://stackoverflow.com/questions/42467910/how-to-write-a-pop-function", "title": "How to write a pop() function", "body": "<pre><code>a := []int{1,2,3}\nx, a := a[len(a)-1], a[:len(a)-1]\nfmt.Println(a,x)\n</code></pre>\n\n<p>How to create a <code>pop()</code> function that will do the same for any type of an array?</p>\n\n<p>Here is what I came up with so far:</p>\n\n<pre><code>func pop(a []*interface{}) interface{}{\n    x := a[len(a)-1]\n    a = a[:len(a)-1]\n    return x\n}\n\nfunc main(){\n    a := []int{1,2,3}\n    x = pop(a)\n    fmt.Println(a,x)  // -&gt;  [1,2] 3\n}\n</code></pre>\n\n<p>But I get <code>cannot use a (type []int) as type []interface {}</code>or other error messages if I try to tweak the code by trial and error.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1488108317, "last_edit_date": 1488108317, "creation_date": 1488105040, "answer_id": 42467350, "question_id": 42467324, "link": "https://stackoverflow.com/questions/42467324/how-to-write-a-wrapper-around-fmt-print/42467350#42467350", "title": "How to write a wrapper around fmt.Print", "body": "<p>Change <code>myPrint</code> to:</p>\n\n<pre><code>func myPrint(a ...interface{}) {\n    fmt.Print(a...)\n}\n</code></pre>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 42467350, "answer_count": 1, "score": 0, "last_activity_date": 1488108317, "creation_date": 1488104873, "question_id": 42467324, "link": "https://stackoverflow.com/questions/42467324/how-to-write-a-wrapper-around-fmt-print", "title": "How to write a wrapper around fmt.Print", "body": "<pre><code>func myPrint(a...fmt.Stringer) {\n    fmt.Print(a)\n}\n\nfunc main(){\n    myPrint(1,\"asd\")\n}\n</code></pre>\n\n<p>I get \"int does not implement String method\"</p>\n\n<p>How to write a wrapper around <code>fmt.Print()</code>?</p>\n"}, {"tags": ["mysql", "go", "docker", "google-cloud-sql"], "answers": [{"comments": [{"owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488102375, "post_id": 42466909, "comment_id": 72075217, "body": "Still got the same access denied."}, {"owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488103288, "post_id": 42466909, "comment_id": 72075447, "body": "I just used the exact same Dockerfile as you suggested, I still got the same access denied. I am thinking if there&#39;s something special for Docker container to authenticate google-cloud-sql."}, {"owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "reply_to_user": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488107001, "post_id": 42466909, "comment_id": 72076439, "body": "i don&#39;t know what to say, i haven&#39;t used google-cloud-sql before, but i used database on other host than docker host, and it my approach worked for me"}, {"owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488112063, "post_id": 42466909, "comment_id": 72077880, "body": "Maybe it&#39;s something special about google-cloud-sql authentication, I&#39;ve raised a support ticket and I will let u know when I get response from gcloud"}, {"owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488181842, "post_id": 42466909, "comment_id": 72100585, "body": "Thanks! The link helps, but my situation is a little different, I&#39;m still on my local dev env."}, {"owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "edited": false, "score": 0, "creation_date": 1488182639, "post_id": 42466909, "comment_id": 72100952, "body": "I found the issue, I&#39;ve changed the Dockerfile to fix it. CMD [&quot;gcloud-sql-test&quot;, &quot;-db=user:passwd@tcp(gcloud.sql.ip.address:3306)/database&quot;]"}], "tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": 0, "last_activity_date": 1488102861, "last_edit_date": 1488102861, "creation_date": 1488102112, "answer_id": 42466909, "question_id": 42466845, "link": "https://stackoverflow.com/questions/42466845/why-connect-to-google-cloud-sql-failed-inside-docker-container-but-success-outsi/42466909#42466909", "title": "Why connect to Google Cloud SQL failed inside Docker container but success outside Docker container?", "body": "<p>Try</p>\n\n<pre><code>FROM golang\n\nADD . $GOPATH/src/github.com/pdu/gcloud-sql-test\n\nRUN go install github.com/pdu/gcloud-sql-test\n\nCMD [\"gcloud-sql-test\",\"-db=\\\"user:passwd@tcp(gcloud.sql.ip.address:3306)/database\\\"\"]\n</code></pre>\n\n<p><a href=\"https://docs.docker.com/engine/reference/builder/#/cmd\" rel=\"nofollow noreferrer\">CMD</a> and <a href=\"https://docs.docker.com/engine/reference/builder/#entrypoint\" rel=\"nofollow noreferrer\">ENTRYPOINT</a> are different commands</p>\n"}, {"tags": [], "owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "is_accepted": false, "score": 0, "last_activity_date": 1488183041, "creation_date": 1488183041, "answer_id": 42480649, "question_id": 42466845, "link": "https://stackoverflow.com/questions/42466845/why-connect-to-google-cloud-sql-failed-inside-docker-container-but-success-outsi/42480649#42480649", "title": "Why connect to Google Cloud SQL failed inside Docker container but success outside Docker container?", "body": "<p>I've fixed the issue because of Dockerfile error</p>\n\n<pre><code>FROM golang\n\nADD . $GOPATH/src/github.com/pdu/gcloud-sql-test\n\nRUN go install github.com/pdu/gcloud-sql-test\n\nCMD [\"gcloud-sql-test\", \"-db=user:passwd@tcp(gcloud.sql.ip.address:3306)/database\"]\n</code></pre>\n\n<p>The main difference is to remove the <em>quotation mark</em> in the Dockerfile:CMD parameter, while you need the <em>quotation mark</em> when you execute the program from Terminal.</p>\n"}], "owner": {"reputation": 1231, "user_id": 637034, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/897e9fb520031c746853097fe3263c10?s=128&d=identicon&r=PG", "display_name": "pengdu", "link": "https://stackoverflow.com/users/637034/pengdu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1488183041, "creation_date": 1488101590, "last_edit_date": 1488182922, "question_id": 42466845, "link": "https://stackoverflow.com/questions/42466845/why-connect-to-google-cloud-sql-failed-inside-docker-container-but-success-outsi", "title": "Why connect to Google Cloud SQL failed inside Docker container but success outside Docker container?", "body": "<p>I've written a piece of code in Golang to test Google Cloud SQL:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar addr = flag.String(\"db\", \"\", \"The database address\")\n\nfunc main() {\n    flag.Parse()\n\n    db, err := sql.Open(\"mysql\", *addr)\n    if err != nil {\n        fmt.Println(\"mysql open failed: \", err)\n        return\n    }\n\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        fmt.Println(\"mysql ping failed: \", err)\n        return\n    }\n    fmt.Println(\"mysql ping success\")\n}\n</code></pre>\n\n<p>I've tested the above code, the output is <em>mysql ping success</em></p>\n\n<p>Then I want to test this function inside Docker container, the <strong>Dockerfile</strong> following:</p>\n\n<pre><code>FROM golang\n\nADD . $GOPATH/src/github.com/pdu/gcloud-sql-test\n\nRUN go install github.com/pdu/gcloud-sql-test\n\nENTRYPOINT [\"gcloud-sql-test\"]\nCMD [\"-db=\\\"user:passwd@tcp(gcloud.sql.ip.address:3306)/database\\\"\"]\n</code></pre>\n\n<p>After building the Docker image, and run the container, I got the following output:\n<em>mysql ping failed:  Error 1045: Access denied for user '\"user'@'my.local.ip.address' (using password: YES)</em></p>\n\n<p>I've already configured that my local IP can access Google Cloud SQL. I don't know why it doesn't work inside Docker container but works outside Docker container.</p>\n\n<p><strong>Updates, I've fixed the issue because of Dockerfile error</strong></p>\n\n<pre><code>FROM golang\n\nADD . $GOPATH/src/github.com/pdu/gcloud-sql-test\n\nRUN go install github.com/pdu/gcloud-sql-test\n\nCMD [\"gcloud-sql-test\", \"-db=user:passwd@tcp(gcloud.sql.ip.address:3306)/database\"]\n</code></pre>\n\n<p>The main difference is to remove the <em>quotation mark</em> in the Dockerfile:CMD parameter, while you need the <em>quotation mark</em> when you execute the program from Terminal.</p>\n"}, {"tags": ["networking", "nginx", "go", "reverse-proxy"], "answers": [{"comments": [{"owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "edited": false, "score": 0, "creation_date": 1488124058, "post_id": 42466693, "comment_id": 72081794, "body": "Hi @cshu, thanks for the prompt reply. I have remove the reassign code but the 404 error persists. In the Nginx log, there is a record for the access, so the proxy request can reach the target, however, the nginx log shows 404."}], "tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1488100442, "creation_date": 1488100442, "answer_id": 42466693, "question_id": 42466491, "link": "https://stackoverflow.com/questions/42466491/golang-reverse-proxy-to-app-behind-nginx/42466693#42466693", "title": "Golang reverse proxy to app behind nginx", "body": "<p>From <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httputil/#ReverseProxy</a>:</p>\n\n<pre><code>    // Director must be a function which modifies\n    // the request into a new request to be sent\n    // using Transport. Its response is then copied\n    // back to the original client unmodified.\n    // Director must not access the provided Request\n    // after returning.\n    Director func(*http.Request)\n</code></pre>\n\n<p>That is the function used to construct ReverseProxy in <code>&amp;httputil.ReverseProxy{Director: director}</code></p>\n\n<p>But your <code>director</code> <strong>never modifies</strong> the <code>http.Request</code> that original <code>req</code> points to. It reassigns the pointer with <code>req = r</code>. An irrelevant <code>http.Request</code> is modified instead.</p>\n"}, {"tags": [], "owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "is_accepted": false, "score": 0, "last_activity_date": 1495467592, "creation_date": 1495467592, "answer_id": 44116974, "question_id": 42466491, "link": "https://stackoverflow.com/questions/42466491/golang-reverse-proxy-to-app-behind-nginx/44116974#44116974", "title": "Golang reverse proxy to app behind nginx", "body": "<p>The issue is with request body. If you look into how <code>Gin</code> implement get parameter, you will find that it open, read it and close it. So when you forward the request, the request body is empty.</p>\n"}, {"tags": [], "owner": {"reputation": 86, "user_id": 467082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9aBYd.png?s=128&g=1", "display_name": "blackbox", "link": "https://stackoverflow.com/users/467082/blackbox"}, "is_accepted": false, "score": 0, "last_activity_date": 1505428862, "creation_date": 1505428862, "answer_id": 46229212, "question_id": 42466491, "link": "https://stackoverflow.com/questions/42466491/golang-reverse-proxy-to-app-behind-nginx/46229212#46229212", "title": "Golang reverse proxy to app behind nginx", "body": "<p>I just ran into this same issue. I solved it by setting the Host. nginx uses the host(server_name) to decide which server on port 80 to serve.</p>\n\n<pre><code>req.Host = target.Host\n// or\nreq.Host = \"\"\n</code></pre>\n\n<p>It can be set to an empty string because the url host was just set <code>req.URL.Host = target.Host</code>\n<a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request</a></p>\n\n<pre><code>    // For client requests Host optionally overrides the Host\n    // header to send. If empty, the Request.Write method uses\n    // the value of URL.Host. Host may contain an international\n    // domain name.\n    Host string\n</code></pre>\n\n<p>As a side note, you can create the proxy outside of the gin handler and call <code>proxy.ServeHTTP(c.Writer, c.Request)</code> in the gin handler. The final result would look like this:</p>\n\n<pre><code>func NewMultiHostProxy(target_urls []string) gin.HandlerFunc {\n    var urls []*url.URL\n    for i := 0; i &lt; len(target_urls); i++ {\n        target, err := url.Parse(target_urls[i])\n        if err != nil {\n            fmt.Errorf(\"Error parsing url\")\n            return nil\n        }\n        urls = append(urls, target)\n    }\n    director := func(req *http.Request) {\n        target := urls[rand.Int()%len(urls)]\n        req.URL.Scheme = target.Scheme\n        req.URL.Host = target.Host\n        req.URL.Path = target.Path\n        req.Host = \"\"\n        req.Header.Set(\"X-GoProxy\", \"GoProxy\")\n        if target.RawQuery == \"\" || req.URL.RawQuery == \"\" {\n            req.URL.RawQuery = target.RawQuery + req.URL.RawQuery\n        } else {\n            req.URL.RawQuery = target.RawQuery + \"&amp;\" + req.URL.RawQuery\n        }\n        log.Print(req.URL)\n    }\n    proxy := &amp;httputil.ReverseProxy{Director: director}\n    return func(c *gin.Context) {\n        proxy.ServeHTTP(c.Writer, c.Request)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1823, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1505428862, "creation_date": 1488098796, "question_id": 42466491, "link": "https://stackoverflow.com/questions/42466491/golang-reverse-proxy-to-app-behind-nginx", "title": "Golang reverse proxy to app behind nginx", "body": "<p>I am writing a simple reverse proxy with Golang. The code is listed below:</p>\n\n<pre><code>func NewMultiHostProxy(target_urls []string) gin.HandlerFunc {\n    var urls []*url.URL\n    for i := 0; i &lt; len(target_urls); i++ {\n        target, err := url.Parse(target_urls[i])\n        if err != nil {\n            fmt.Errorf(\"Error parsing url\")\n            return nil\n        }\n        urls = append(urls, target)\n    }\n    return func(c *gin.Context) {\n        director := func(req *http.Request) {\n            target := urls[rand.Int()%len(urls)]\n            r := c.Request\n            req = r\n            req.URL.Scheme = target.Scheme\n            req.URL.Host = target.Host\n            req.URL.Path = target.Path\n            req.Header.Set(\"X-GoProxy\", \"GoProxy\")\n            if target.RawQuery == \"\" || req.URL.RawQuery == \"\" {\n                req.URL.RawQuery = target.RawQuery + req.URL.RawQuery\n            } else {\n                req.URL.RawQuery = target.RawQuery + \"&amp;\" + req.URL.RawQuery\n            }\n            log.Print(req.URL)\n        }\n        proxy := &amp;httputil.ReverseProxy{Director: director}\n        proxy.ServeHTTP(c.Writer, c.Request)\n    }\n}\n</code></pre>\n\n<p>When I am trying to proxy one request to a REST api behind Nginx, Nginx always returns 404. However, if i directly access the REST api, it returns the result correctly. Here's my Nginx config:</p>\n\n<pre><code>server {\n    listen       80;\n    server_name  myservername;\n\n    location /api {\n        proxy_pass http://127.0.0.1:5000;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n</code></pre>\n\n<p>May I know how to debug this problem? Is it caused by Nginx configuration? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488079342, "post_id": 42464350, "comment_id": 72070619, "body": "are you trying to create a function that accept any kinds of struct? if that so simple use <code>[]interface</code>"}, {"owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "reply_to_user": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1488080812, "post_id": 42464350, "comment_id": 72070856, "body": "@GujaratSantana Yes. But <code>[] interface</code> cannot be accepted by <code>func(params ... interface{}</code>"}, {"owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1488081691, "post_id": 42464350, "comment_id": 72071007, "body": "what exacly do you mean by dynamic composition? <code>func boo(params ...interface{}){}</code> seems to solve your problem."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 5, "last_activity_date": 1488093398, "creation_date": 1488093398, "answer_id": 42465791, "question_id": 42464350, "link": "https://stackoverflow.com/questions/42464350/golang-dynamic-composition-of-variadic-function-parameter/42465791#42465791", "title": "golang: dynamic composition of variadic function parameter", "body": "<p>Use ellipsis operator</p>\n\n<pre><code>slice := []Type{Type{}, Type{}}\ncall(slice...)\n</code></pre>\n\n<p>for function</p>\n\n<pre><code>func(arg ...Type) {}\n</code></pre>\n"}], "owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 1, "accepted_answer_id": 42465791, "answer_count": 1, "score": 3, "last_activity_date": 1505371580, "creation_date": 1488078975, "last_edit_date": 1505371580, "question_id": 42464350, "link": "https://stackoverflow.com/questions/42464350/golang-dynamic-composition-of-variadic-function-parameter", "title": "golang: dynamic composition of variadic function parameter", "body": "<p>I'd like to call a variadic function and compose the parameter dynamically. Take <code>fmt.Printf()</code> for example. if I have a <code>struct</code>: </p>\n\n<pre><code>type Foo struct {\n   a int\n   b string\n}\n</code></pre>\n\n<p>I'd like to call <code>fmt.Printf(foo.a, foo.b).</code> But if I have another <code>Bar struct</code> with 3 fields, I'd like to call <code>fmt.Printf(bar.a, bar.b, bar.c)</code>.</p>\n\n<p>So I'd like to write a function like this:</p>\n\n<pre><code>func MyPrint(obj interface{})\n</code></pre>\n\n<p>and be able to call it with <code>MyPrint(foo)</code> or <code>MyPrint(bar)</code> and the code will automatically figure out that <code>foo</code> has 2 fields and do:</p>\n\n<pre><code>...\nfmt.Printf(foo.a, foo.b)\n</code></pre>\n\n<p><code>bar</code> has 3 fields and do </p>\n\n<pre><code>...\nfmt.Printf(bar.a, bar.b, bar.c)\n</code></pre>\n\n<p>In Python you can do something like <code>call(*list)</code>. How can I achieve this in Go?</p>\n"}, {"tags": ["android-studio", "go", "gomobile"], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1488073609, "post_id": 42463776, "comment_id": 72069626, "body": "Plus Go 1.8 might have fixed <a href=\"https://github.com/golang/go/issues/17996\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/17996</a>, with <a href=\"https://go-review.googlesource.com/#/c/33372/2//COMMIT_MSG\" rel=\"nofollow noreferrer\">go-review.googlesource.com/#/c/33372/2//COMMIT_MSG</a>"}, {"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "edited": false, "score": 0, "creation_date": 1488076234, "post_id": 42463776, "comment_id": 72070076, "body": "Thanks both. The GOPATH <i>should</i> be extracted from the org.golang.mobile.bind plugin, in fact when I remove my GOPATH from my profile, the terminal function still works as it is extracted."}, {"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "edited": false, "score": 0, "creation_date": 1488076307, "post_id": 42463776, "comment_id": 72070094, "body": "I believe that  change was focussed on correcting the incorrect example, not actual functionality. (i.e. The example does not have an &quot;=&quot;)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1488073356, "creation_date": 1488073356, "answer_id": 42463776, "question_id": 42463743, "link": "https://stackoverflow.com/questions/42463743/gomobile-toolchain-out-of-date-only-in-android-studio/42463776#42463776", "title": "Gomobile toolchain out of date, only in Android Studio", "body": "<p>This seems to be a gomobile error message, seen in <a href=\"https://github.com/xing/gomobile/blob/689a4dbed73dbaf25136ccda2ece3026acd2ac74/cmd/gomobile/env.go#L69-L83\" rel=\"nofollow noreferrer\"><code>cmd/gomobile/env.go#L69-L83</code></a>:</p>\n\n<pre><code>// Find gomobilepath.\ngopath := goEnv(\"GOPATH\")\nfor _, p := range filepath.SplitList(gopath) {\n    gomobilepath = filepath.Join(p, \"pkg\", \"gomobile\")\n    if _, err := os.Stat(gomobilepath); buildN || err == nil {\n        break\n    }\n}\n\nverpath := filepath.Join(gomobilepath, \"version\")\ninstalledVersion, err := ioutil.ReadFile(verpath)\nif !bytes.Equal(installedVersion, version) {\n    return nil, errors.New(\"toolchain out of date, run `gomobile init`\")\n}\n</code></pre>\n\n<p>So double-check the value of <code>GOPATH</code> between your local session and your Android Studio session.<br>\nSee for instance <a href=\"https://groups.google.com/forum/#!topic/go-mobile/ZstjAiIFrWY\" rel=\"nofollow noreferrer\">this old (2015) thread</a> to see if any of those comments still apply.</p>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1488107246, "post_id": 42464734, "comment_id": 72076496, "body": "Nice catch, and more precise than my answer. +1"}], "tags": [], "owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "is_accepted": true, "score": 1, "last_activity_date": 1488083105, "creation_date": 1488083105, "answer_id": 42464734, "question_id": 42463743, "link": "https://stackoverflow.com/questions/42463743/gomobile-toolchain-out-of-date-only-in-android-studio/42464734#42464734", "title": "Gomobile toolchain out of date, only in Android Studio", "body": "<p>I have gotten to the bottom of this in case anyone else has the issue;</p>\n\n<ol>\n<li><p>It appears, at least for me, the Gradle plugin wasn't respecting the location of the GO bin. Instead it looks up the gobin using;</p>\n\n<pre><code>        gobin, err := exec.LookPath(\"go\")\n</code></pre></li>\n</ol>\n\n<p>I have a number of Go versions installed (for various reasons) so my forcing the gobin was failing. To discover this I have added debug logs to the <code>env.go</code> file. In general the logging on the file is not the most clear when attempting to debug.</p>\n"}], "owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 1, "accepted_answer_id": 42464734, "answer_count": 2, "score": 1, "last_activity_date": 1496241867, "creation_date": 1488073058, "last_edit_date": 1496241867, "question_id": 42463743, "link": "https://stackoverflow.com/questions/42463743/gomobile-toolchain-out-of-date-only-in-android-studio", "title": "Gomobile toolchain out of date, only in Android Studio", "body": "<p>I am working with the latest gomobile, Go, and Android Studio builds.</p>\n\n<p>When I run the gradle tasks from the terminal they work as expected and build the correct binaries, however from within Android Studio I receive an error:</p>\n\n<pre><code>bin/gomobile: toolchain out of date, run `gomobile init`\n</code></pre>\n\n<p>Of course I have re run gomobile init many times and no change. My assumption is that Android Studio is using some config that I can not identify. </p>\n\n<p>I appreciate this is a somewhat edge case question, but if anyone can point me in the right direction it would be helpful.</p>\n\n<p>TLDR; ./gradlew myproj:bind works fine in terminal, fails in Android Studio.</p>\n"}, {"tags": ["go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 932, "user_id": 279183, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/5df43f2d159d197c4ae9dbd8d9280b3c?s=128&d=identicon&r=PG&f=1", "display_name": "adredx", "link": "https://stackoverflow.com/users/279183/adredx"}, "edited": false, "score": 0, "creation_date": 1488073600, "post_id": 42463771, "comment_id": 72069623, "body": "So that&#39;s just how it works and there&#39;s no workaround? <code>val</code> only does not work with <code>Scan()</code>, it needs <code>pointers</code>."}, {"owner": {"reputation": 337, "user_id": 1143475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da02acd639b93f74c77566a206a550b?s=128&d=identicon&r=PG", "display_name": "Kumar Sukhani", "link": "https://stackoverflow.com/users/1143475/kumar-sukhani"}, "edited": false, "score": 0, "creation_date": 1488104698, "post_id": 42463771, "comment_id": 72075822, "body": "I guess you don&#39;t need to initial the keys array. Just pass it as it is after you declare them."}], "tags": [], "owner": {"reputation": 10214, "user_id": 1591, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0a92aa779bf439fe972b2b9b46a289?s=128&d=identicon&r=PG", "display_name": "Jim Deville", "link": "https://stackoverflow.com/users/1591/jim-deville"}, "is_accepted": false, "score": 0, "last_activity_date": 1488073300, "creation_date": 1488073300, "answer_id": 42463771, "question_id": 42463720, "link": "https://stackoverflow.com/questions/42463720/two-strings-the-have-same-pointer-address/42463771#42463771", "title": "Two strings the have same pointer address", "body": "<p>You are assigning <code>keys[i] = &amp;val</code> in your loop, this is assigning the same address to each array element. This also means that you are only getting the last value. What you probably want is <code>keys[i] = val</code> (and set the map to use strings instead of *strings).</p>\n"}, {"tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1488076032, "creation_date": 1488076032, "answer_id": 42464039, "question_id": 42463720, "link": "https://stackoverflow.com/questions/42463720/two-strings-the-have-same-pointer-address/42464039#42464039", "title": "Two strings the have same pointer address", "body": "<p>Change <code>keys[i] = &amp;val</code> to <code>keys[i] = &amp;userLoginKeys[i]</code>, so you can get different addresses.</p>\n"}, {"tags": [], "owner": {"reputation": 337, "user_id": 1143475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0da02acd639b93f74c77566a206a550b?s=128&d=identicon&r=PG", "display_name": "Kumar Sukhani", "link": "https://stackoverflow.com/users/1143475/kumar-sukhani"}, "is_accepted": false, "score": 1, "last_activity_date": 1488104383, "creation_date": 1488104383, "answer_id": 42467257, "question_id": 42463720, "link": "https://stackoverflow.com/questions/42463720/two-strings-the-have-same-pointer-address/42467257#42467257", "title": "Two strings the have same pointer address", "body": "<pre><code>for i, val := range userLoginKeys {\n    keys[i] = &amp;val\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>here, val is an independent variable whose address you are assigning to keys[i]. So both time you are getting same address.</p>\n\n<p>Try this:</p>\n\n<pre><code>for i:=0; i&lt;len(userLoginKeys); i++ {\n    keys[i] = &amp;userLoginKeys[i]\n    fmt.Println(keys[i])\n}\n</code></pre>\n"}], "owner": {"reputation": 932, "user_id": 279183, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/5df43f2d159d197c4ae9dbd8d9280b3c?s=128&d=identicon&r=PG&f=1", "display_name": "adredx", "link": "https://stackoverflow.com/users/279183/adredx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 42464039, "answer_count": 3, "score": 0, "last_activity_date": 1488104383, "creation_date": 1488072820, "last_edit_date": 1488073305, "question_id": 42463720, "link": "https://stackoverflow.com/questions/42463720/two-strings-the-have-same-pointer-address", "title": "Two strings the have same pointer address", "body": "<p>Why is this so? Here's my code:</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"fmt\"\n    \"reflect\"        \n\n    \"github.com/fatih/structs\"\n)\n\ntype UserLogin struct {\n    Username string\n    Password string\n}\n\nfunc Login() {\n    row := sql.QueryRow(\"SELECT username, password FROM users WHERE username=?\", \"golang\")\n\n    userLoginKeys := structs.Names(UserLogin{})\n    keys := make([]interface{}, len(userLoginKeys), len(userLoginKeys))\n    for i, val := range userLoginKeys {\n        keys[i] = &amp;val\n        fmt.Println(val)\n    }\n\n    fmt.Println(keys)\n\n    _ := row.Scan(keys...)\n    v1 := reflect.ValueOf(keys[0]).Elem().String()\n    v2 := reflect.ValueOf(keys[1]).Elem().String()\n    fmt.Println(v1)\n    fmt.Println(v2)\n}\n</code></pre>\n\n<p>It prints</p>\n\n<pre><code>Username\nPassword\n[0xc4201ca2c0 0xc4201ca2c0] \n$2a$10$F6hR0scvtbFDx0l1GR.OX.ZweozUzwKVTG3H8GBQxpYCEdFifDrzy\n$2a$10$F6hR0scvtbFDx0l1GR.OX.ZweozUzwKVTG3H8GBQxpYCEdFifDrzy\n</code></pre>\n\n<p>As you can see, <code>keys</code> contains the same address to two different strings. As a result, their values are the same. </p>\n\n<p>My goal is to map <code>username</code> and <code>password</code> to <code>UserLogin</code> struct. </p>\n"}, {"tags": ["go", "benchmarking"], "answers": [{"comments": [{"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488081388, "post_id": 42463962, "comment_id": 72070953, "body": "How would you suggest resolving it? The function is designed to modify the input, so it would be wrong to include allocating memory in the benchmark. There should be a way to pause the timer without massive massive overhead."}, {"owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "reply_to_user": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488085938, "post_id": 42463962, "comment_id": 72071741, "body": "Try using a much more complicated and longer <code>testMessage</code>. Maybe that&#39;s what you&#39;d prefer."}, {"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488086060, "post_id": 42463962, "comment_id": 72071776, "body": "That won&#39;t make any difference, currently the function runs about 10 million times per second..."}, {"owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "reply_to_user": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488086475, "post_id": 42463962, "comment_id": 72071844, "body": "Or use two <code>for</code> blocks instead of one <code>for</code>. First block does all the allocation and store result in a slice. Second block just calls <code>splitMessageExtra(&amp;the_slice[msg_index])</code>. No need to <code>StopTimer</code> or <code>StartTimer</code> inside loop."}, {"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488086775, "post_id": 42463962, "comment_id": 72071899, "body": "Good timing on that last comment :) I just tried that a few minutes ago, and it reduced the run time to around 5 seconds. I was just about to comment that here."}], "tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1488075323, "creation_date": 1488075323, "answer_id": 42463962, "question_id": 42463174, "link": "https://stackoverflow.com/questions/42463174/how-do-i-benchmark-a-function-that-modifies-its-input/42463962#42463962", "title": "How do I benchmark a function that modifies its input?", "body": "<p>There is nothing wrong. <code>StopTimer</code> and <code>StartTimer</code> should be much more expensive than <code>splitMessageExtra</code>. Both of them call <code>runtime.ReadMemStats</code>. See <a href=\"https://github.com/golang/go/issues/13613\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488275228, "post_id": 42466741, "comment_id": 72148232, "body": "I might be misunderstanding your benchmark, but you are running the function repeatedly on the same input. Doesn&#39;t that mean that the first call of the function splits the string, and every following call just quickly checks that there is no line break and returns an empty string? The reason I did <code>string([]byte(testMessage))</code> in the test file was to deep copy the string, which is necessary since the function modifies its input."}, {"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1488277027, "post_id": 42466741, "comment_id": 72149538, "body": "Ok I see. I had some misapprehensions about strings in <code>go</code>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1488159520, "last_edit_date": 1488159520, "creation_date": 1488100803, "answer_id": 42466741, "question_id": 42463174, "link": "https://stackoverflow.com/questions/42463174/how-do-i-benchmark-a-function-that-modifies-its-input/42466741#42466741", "title": "How do I benchmark a function that modifies its input?", "body": "<p>Your code and benchmark do seem slow. Here's a faster version.</p>\n\n<pre><code>package main\n\nimport (\n    \"strings\"\n    \"testing\"\n)\n\n// Splits the main line from extra information\nfunc splitMessageExtra(line *string) string {\n    const newline = \"#012\"\n    i := strings.Index(*line, newline)\n    if i &lt; 0 {\n        return \"\"\n    }\n    extra := (*line)[i+len(newline):]\n    *line = (*line)[0:i]\n    return extra\n}\n\nvar testMessage = `Feb 10 15:16:20 foo_stats[-] (warning): [foo_stats.postfix, line 166, thread \"processor_mta03\"]: Skipped line because there is no context:#012Feb 10 15:16:20 mta03 postfix/qmgr[7419]: ABCDEF123: from=&lt;&gt;, size=24431, nrcpt=1 (queue active)`\n\nfunc BenchmarkSplitMessageExtra(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        msg := testMessage\n        splitMessageExtra(&amp;msg)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=.\ngoos: linux\ngoarch: amd64\npkg: extra\nBenchmarkSplitMessageExtra-4    50000000            32.2 ns/op\nPASS\nok      extra   1.647s\n</code></pre>\n\n<p>For comparison, here are the results from your code and benchmark. Your code and benchmark are slower than mine: 968 ns/op and 50.184s versus 32.2 ns/op and 1.647s respectively.</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\n// Splits the main line from extra information\nfunc splitMessageExtra(line *string) string {\n    var prev rune\n    for i, char := range *line {\n        if prev == 0 &amp;&amp; char == '#' {\n            prev = char\n            continue\n        }\n        if prev == '#' &amp;&amp; char == '0' {\n            prev = char\n            continue\n        }\n        if prev == '0' &amp;&amp; char == '1' {\n            prev = char\n            continue\n        }\n        if prev == '1' &amp;&amp; char == '2' {\n            extra := (*line)[i+1:]\n            *line = (*line)[0 : i-3]\n\n            return extra\n        }\n        prev = 0\n    }\n    return \"\"\n}\n\nvar testMessage = `Feb 10 15:16:20 foo_stats[-] (warning): [foo_stats.postfix, line 166, thread \"processor_mta03\"]: Skipped line because there is no context:#012Feb 10 15:16:20 mta03 postfix/qmgr[7419]: ABCDEF123: from=&lt;&gt;, size=24431, nrcpt=1 (queue active)`\n\nfunc BenchmarkSplitMessageExtra(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        b.StopTimer()\n        msg := string([]byte(testMessage))\n        b.StartTimer()\n        splitMessageExtra(&amp;msg)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=.\ngoos: linux\ngoarch: amd64\npkg: extra\nBenchmarkSplitMessageExtra-4     2000000           968 ns/op    \nPASS\nok      extra   50.184s\n</code></pre>\n\n<p>Some of your code is unnecessary; it uses CPU time and triggers allocations. For example, converting to utf-8 bytes to runes,<code>for i, char := range *line {}</code>, and converting <code>string</code> to <code>[]byte</code> to <code>string</code>, <code>string([]byte(testMessage))</code> . Some algorithms could be improved. For example, searching for a newline. </p>\n"}], "owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1488159520, "creation_date": 1488067583, "last_edit_date": 1488067891, "question_id": 42463174, "link": "https://stackoverflow.com/questions/42463174/how-do-i-benchmark-a-function-that-modifies-its-input", "title": "How do I benchmark a function that modifies its input?", "body": "<p>When I'm benchmarking a function that modifies its input, I have to copy the test data for each loop of the benchmark, and pause the timer while I'm doing so. This can mean that if I run <code>go test -bench MyTest -benchtime 1s</code> the test can take 2 full minutes rather than 1 second.</p>\n\n<p>Am I doing something wrong or will I just have to live with this?</p>\n\n<hr>\n\n<p>More context:</p>\n\n<p>I'm writing a program for reading syslog logs. Part of my logging paradigm is that the first line of a logged message contains readable text, and following lines contain \"extra information\", like a stack trace. My log reader therefore (among other things) splits the message on the first line break, which is escaped to <code>#012</code> by rsyslog.</p>\n\n<p>Here is the code for that:</p>\n\n<pre><code>// Splits the main line from extra information\nfunc splitMessageExtra(line *string) string {\n    var prev rune\n\n    for i, char := range *line {\n        if prev == 0 &amp;&amp; char == '#' {\n            prev = char\n            continue\n        }\n\n        if prev == '#' &amp;&amp; char == '0' {\n            prev = char\n            continue\n        }\n\n        if prev == '0' &amp;&amp; char == '1' {\n            prev = char\n            continue\n        }\n\n        if prev == '1' &amp;&amp; char == '2' {\n            extra := (*line)[i+1:]\n            *line = (*line)[0 : i-3]\n\n            return extra\n        }\n\n        prev = 0\n    }\n\n    return \"\"\n}\n</code></pre>\n\n<p>It originally used <code>strings.Split</code> and returned new strings, but cpu profiling showed that it was way too slow.</p>\n\n<p>Here is the benchmark function:</p>\n\n<pre><code>var testMessage = `Feb 10 15:16:20 foo_stats[-] (warning): [foo_stats.postfix, line 166, thread \"processor_mta03\"]: Skipped line because there is no context:#012Feb 10 15:16:20 mta03 postfix/qmgr[7419]: ABCDEF123: from=&lt;&gt;, size=24431, nrcpt=1 (queue active)`\n\nfunc BenchmarkSplitMessageExtra(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        b.StopTimer()\n        msg := string([]byte(testMessage))\n        b.StartTimer()\n\n        splitMessageExtra(&amp;msg)\n    }\n}\n</code></pre>\n\n<p>Here's a run without pausing the timer:</p>\n\n<pre>\n$ go test -bench SplitMessageExtra -benchtime 1s\nBenchmarkSplitMessageExtra-8     3000000           434 ns/op\nPASS\nok      github.com/Hubro/logreader  1.730s\n</pre>\n\n<p>And here's a run with the exact benchmark function above:</p>\n\n<pre>\n$ go test -bench SplitMessageExtra -benchtime 1s\nBenchmarkSplitMessageExtra-8     5000000           385 ns/op\nPASS\nok      github.com/Hubro/logreader  100.563s\n</pre>\n\n<p>Notice it takes AGES to run.</p>\n"}, {"tags": ["file", "go", "struct", "binary"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 7615848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/203f6271efa7a546f57ab83d75e0b2f8?s=128&d=identicon&r=PG&f=1", "display_name": "overboarded", "link": "https://stackoverflow.com/users/7615848/overboarded"}, "edited": false, "score": 0, "creation_date": 1488097032, "post_id": 42462920, "comment_id": 72073959, "body": "Thank you :) now i know the (un)exported message :) )"}], "tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": true, "score": 5, "last_activity_date": 1488065633, "creation_date": 1488065633, "answer_id": 42462920, "question_id": 42462869, "link": "https://stackoverflow.com/questions/42462869/go-reading-binary-file-with-struct/42462920#42462920", "title": "go - reading binary file with struct", "body": "<p><code>str1</code>, <code>str2</code>, and <code>str3</code> are unexported. That means other packages can't see them. To export them, capitalize the first letter.</p>\n\n<pre><code>type Header struct {\n    Str1 int32\n    Str2 [255]byte\n    Str3 float64\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7615848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/203f6271efa7a546f57ab83d75e0b2f8?s=128&d=identicon&r=PG&f=1", "display_name": "overboarded", "link": "https://stackoverflow.com/users/7615848/overboarded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4992, "favorite_count": 1, "accepted_answer_id": 42462920, "answer_count": 1, "score": 4, "last_activity_date": 1488065633, "creation_date": 1488065248, "question_id": 42462869, "link": "https://stackoverflow.com/questions/42462869/go-reading-binary-file-with-struct", "title": "go - reading binary file with struct", "body": "<p>I'm trying to reading binary files with golang, but have a question.</p>\n\n<p>If I read it this way, all will be fine</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"os\"\n)\n\ntype Header struct {\n    str1 int32\n    str2 [255]byte\n    str3 float64\n}\n\nfunc main() {\n\n    path := \"test.BIN\"\n\n    file, _ := os.Open(path)\n\n    defer file.Close()\n\n    thing := Header{}\n    binary.Read(file, binary.LittleEndian, &amp;thing.str1)\n    binary.Read(file, binary.LittleEndian, &amp;thing.str2)\n    binary.Read(file, binary.LittleEndian, &amp;thing.str3)\n\n    fmt.Println(thing)\n}\n</code></pre>\n\n<p>But if I optimize the .Read-Section to</p>\n\n<pre><code>binary.Read(file, binary.LittleEndian, &amp;thing)\n//binary.Read(file, binary.LittleEndian, &amp;thing.str1)\n//binary.Read(file, binary.LittleEndian, &amp;thing.str2)\n//binary.Read(file, binary.LittleEndian, &amp;thing.str3)\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>panic: reflect: reflect.Value.SetInt using value obtained using unexported field\n</code></pre>\n\n<p>Could anybody say me why?</p>\n\n<p>All examples are useing the \"optimized-way\"</p>\n\n<p>Thanks :)</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488065827, "post_id": 42462503, "comment_id": 72067949, "body": "Good question... You mention that the categories posted by the user already has an ID in the form? Where do that ID come from originally? Do you have a set of available categories to choose from, or can the user create a complete new category?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488065872, "post_id": 42462503, "comment_id": 72067956, "body": "@MichaelK I have a set to choose from, though it would be trivial to create a new category that can be added to that set. And yes, the ID&#39;s of the categories that the todo already has will be present in the form while editing, and you can either remove some categories or add more, which will send some more ID&#39;s back to the server upon submission of the form."}, {"owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488066087, "post_id": 42462503, "comment_id": 72068006, "body": "Does that mean that the submission from the form already contains ALL category-ID:s that should be connected to the todo?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488066229, "post_id": 42462503, "comment_id": 72068045, "body": "Yes, exactly. And depending on what a user does (remove a some categories, or add more new ones), the ID&#39;s sent back will be reflected as such. I updated my question with the code for example."}, {"owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488066236, "post_id": 42462503, "comment_id": 72068047, "body": "And step #2 could be excluded, because you probably already have the todo-ID when doing the update?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488066388, "post_id": 42462503, "comment_id": 72068085, "body": "Actually no, the sql-driver I&#39;m using does not return an ID on update, only rows affected and last insert ID, but in this case there is no insert going on so I have to query again."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "reply_to_user": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "edited": false, "score": 0, "creation_date": 1488067140, "post_id": 42462503, "comment_id": 72068277, "body": "More specifically on why not, I do the update using the slug, though I cannot use the slug to find the related categories because the <code>todo_category</code> table has a foreign key of the id, not slug. I could indeed probably exclude step 2 just by using the id instead of a slug for the update, good point there."}], "answers": [{"comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 1, "creation_date": 1488068319, "post_id": 42463244, "comment_id": 72068543, "body": "Ah, nice. I didn&#39;t think to just simply delete the rows and recreate them using the new category ID&#39;s from the request. Much simpler approach and gets the job done with less queries and less code. Plus, there won&#39;t be much overhead from deleting/recreating because there&#39;s so few categories attached to a todo to begin with; it generally will never exceed a hand full. Also, I am going to use the primary key instead of slug as that too will require one less query, but I need the user_id for verification (don&#39;t want someone else editing a todo that isn&#39;t theirs). Thanks!"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1488068651, "post_id": 42463244, "comment_id": 72068609, "body": "I&#39;d still like to know if there is a way to do it without deleting. This works great for my case, but what if a todo has 100000 categories in the normal case? Then I think something like this would be bad. What would the solution be then?"}, {"owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "reply_to_user": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1488070126, "post_id": 42463244, "comment_id": 72068931, "body": "Glad it helped. The steps in my answer are a bit simplified, but I generally use this approach in my projects to minimize complexity and number of queries that tend to follow updates of many-to-many relations. What did you mean with a todo having 10000 people? I assumed one todo belonged to one user only?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1488070693, "post_id": 42463244, "comment_id": 72069054, "body": "That was a bad example I guess. I can&#39;t really think of an example where you&#39;d have 100,000 rows of relationships of 1 table that all need to be deleted/re-created on an update, but hypothetically speaking what if you did need that kind of thing on every update? What kind of a workaround would you do then? Cause I imagine this solution would not be optimal in that case."}, {"owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "reply_to_user": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1488071787, "post_id": 42463244, "comment_id": 72069264, "body": "I would probably benchmark and test different solutions and scenarios as there are no given answers if an update or insert/delete approach is better than the other. The best solution depends on so many things... In my experience it&#39;s always best to keep the database happy with small, simple and optimized queries. To delete and insert 100000 rows may very well be more efficient than a complex update or procedure."}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1488072362, "post_id": 42463244, "comment_id": 72069380, "body": "Hmm, good advice. Thanks again! (I&#39;m a SQL noob, if you haven&#39;t noticed.) I come from the front-end world."}], "tags": [], "owner": {"reputation": 1937, "user_id": 1363190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSuCx.gif?s=128&g=1", "display_name": "Michael K", "link": "https://stackoverflow.com/users/1363190/michael-k"}, "is_accepted": true, "score": 1, "last_activity_date": 1488068681, "last_edit_date": 1488068681, "creation_date": 1488068087, "answer_id": 42463244, "question_id": 42462503, "link": "https://stackoverflow.com/questions/42462503/mysql-is-there-a-way-to-update-a-many-to-many-join-table-without-getting-really/42463244#42463244", "title": "MySQL: is there a way to update a many to many join table without getting really granular?", "body": "<p>It would be much easier if you used a primary key in your UPDATE statement instead of using <code>slug</code> and <code>user_id</code> </p>\n\n<p>The todo-ID could be sent on form submission. And since all category-ID:s also are available on form submission, I would probably do something like this:</p>\n\n<ol>\n<li><strong>UPDATE</strong> the table <code>todo</code> using the primary key instead of <code>slug</code> and <code>user_id</code></li>\n<li><strong>INSERT</strong> new categories in table <code>category</code> that do not already exist compared to the array of category-ID:s submitted in the form</li>\n<li><strong>DELETE</strong> ALL rows in table <code>todo_category</code> WHERE todo-ID = the submitted todo-ID</li>\n<li><strong>INSERT</strong> rows in table <code>todo_category</code> with ALL the category-ID:s submitted from the form, together with the todo-ID</li>\n</ol>\n\n<p>If you need to clean up and delete categories in table <code>categories</code> that do not have any relation to any <code>todo-ID</code>, you could finish of with a query to delete orphan categories.</p>\n"}], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 42463244, "answer_count": 1, "score": 1, "last_activity_date": 1488068681, "creation_date": 1488062828, "last_edit_date": 1488067579, "question_id": 42462503, "link": "https://stackoverflow.com/questions/42462503/mysql-is-there-a-way-to-update-a-many-to-many-join-table-without-getting-really", "title": "MySQL: is there a way to update a many to many join table without getting really granular?", "body": "<p>I have a problem in which I have a M:M relationship between two tables, with a join table storing each of their ids as a foreign key to the primary key in their respective tables.</p>\n\n<p>For example:</p>\n\n<pre><code> CREATE TABLE todo (\n    id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,\n\n    title TEXT NOT NULL,\n    slug TEXT NOT NULL,\n\n    description VARCHAR(100) NOT NULL,\n\n    user_id INT(10) UNSIGNED NOT NULL,\n\n    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,\n    deleted_at TIMESTAMP NULL DEFAULT NULL,\n\n    PRIMARY KEY (id)\n);\n\nCREATE TABLE category (\n    id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,\n\n    name TEXT,\n    slug TEXT,\n\n    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,\n    deleted_at TIMESTAMP NULL DEFAULT NULL,\n\n    PRIMARY KEY (id)\n);\n\nCREATE TABLE todo_category (\n    todo_id INT(10) UNSIGNED NOT NULL,\n    category_id INT(10) UNSIGNED NOT NULL,\n\n    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,\n    deleted_at TIMESTAMP NULL DEFAULT NULL,\n\n    PRIMARY KEY (`todo_id`, `category_id`),\n\n    CONSTRAINT `f_todo_category_todo` FOREIGN KEY (`todo_id`) REFERENCES `todo` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,\n    CONSTRAINT `f_todo_category_category` FOREIGN KEY (`category_id`) REFERENCES `category` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n);\n</code></pre>\n\n<p>I can create a todo which has many categories. I can also select that todo, or all todos along with all of their respective categories -- and I can do both rather cleanly with only 1-2 queries.</p>\n\n<p>When I try to <strong>UPDATE</strong> a <code>todo</code>, I can also update the categories using a <strong>REPLACE INTO</strong> query on the <code>todo_category</code> table. I know it will delete and create those rows again, but I think it is fine in this case because generally there won't be more than a hand full of categories. The problem with this approach, however, is that what if new categories weren't added, but were removed? This brings me to my question...</p>\n\n<p>Is there a standard query for doing something like this (update the <code>todo_category</code> table to delete id's that aren't present, and add id's that are new -- in one query), or is this where I have to just use code logic and do multiple queries for my own case scenario, such as my example below?</p>\n\n<p>How I'm currently attempting to do it is as follows (which I think is really bad because it requires many queries and many lines of code):</p>\n\n<ol>\n<li><strong>UPDATE</strong> the todo</li>\n<li><strong>SELECT</strong> the todo that we just updated in order to use its ID later</li>\n<li><strong>SELECT</strong> all the categories corresponding to the ID we got from #2 (we create an array of already existing category ID's from these results)</li>\n<li><strong>SELECT</strong> all categories with a matching <code>todo_id</code> from #2, as well as with matching category ID's from the ID's sent in the request (these would be the ID's sent by the form that is meant to update this todo and its categories)</li>\n<li>Do a diff on the category ID's from #3 and the category ID's from #4 to see what is new, what is no longer present (removed), and create two new arrays from those results</li>\n<li>Do an <strong>INSERT</strong> query to add the new categories in the <code>todo_category</code> table to reflect the new ID's</li>\n<li>Do a <strong>DELETE</strong> query to remove the categories that were no longer present in the request compared to the categories the <code>todo</code> currently has</li>\n</ol>\n\n<p>As you can see, that is very granular and requires many queries as well as makes the <code>Update</code> method in the code on that Todo model very much larger than all of the other methods, and it makes me feel like there's a better approach.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Here is my code, albeit incomplete (it's just for reference, though I don't think it matters much cause I explained what I'm doing above):</p>\n\n<pre><code>// Update makes changes to an existing item.\nfunc Update(db Connection, title string, description string, slug string, idsFromRequest category.IDList, userID string) (sql.Result, error) {\n    // Update the todo\n    newSlug := helper.StringToSlug(title, true)\n    result, err := db.Exec(fmt.Sprintf(`\n        UPDATE %v\n        SET title = ?,\n            slug = ?,\n            description = ?\n        WHERE slug = ?\n            AND user_id = ?;\n    `, table), title, newSlug, description, slug, userID)\n    if err != nil {\n        return result, err\n    }\n\n    // Get the todo to reference its ID\n    t, _, err := BySlug(db, newSlug)\n    if err != nil {\n        return result, err\n    }\n\n    // Get the categories the todo currently has\n    cats, _, err := category.ByTodoID(db, t.ID)\n    if err != nil {\n        return result, err\n    }\n\n    // Get the ids from all of the categories\n    var idsAlreadyExisting []string\n    for _, cat := range cats {\n        idsAlreadyExisting = append(idsAlreadyExisting, cat.ID)\n    }\n\n    // Get the ids to be added (don't yet exist) and the ids to be deleted (not present in the request)\n    idsToBeAdded, idsToBeDeleted := diff(idsAlreadyExisting, idsFromRequest)\n\n    // Create the query for adding the category ids for the todo in todo_category\n    query := `INSERT INTO todo_category (todo_id, category_id)`\n    for i, id := range idsToBeAdded {\n        if i == 0 {\n            query += ` VALUES`\n        }\n        query += fmt.Sprintf(` (%s, %s)`, fmt.Sprint(t.ID), id)\n        if i == len(idsToBeAdded) - 1 {\n            query += \";\"\n        } else {\n            query += \",\"\n        }\n    }\n    result, err = db.Exec(query)\n\n    // Delete query goes here...\n\n    return result, err\n}\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1488060838, "post_id": 42462128, "comment_id": 72066586, "body": "I wouldn&#39;t be incrementing per iteration of the for loop it would be for each binding variable used."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1488060900, "post_id": 42462128, "comment_id": 72066604, "body": "@Rodrigo: Well, my approach would be to increment a variable by 3 every time through the loop. If you prefer three separate iterations, that could work just as well. Take your pick."}, {"owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1488061368, "post_id": 42462128, "comment_id": 72066752, "body": "I&#39;m gonna mark your answer as correct since you answered my question. This whole method though feels very smelly. Is there a better way to go about this? Like overall not just trying to fix my hacky method?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1488114067, "post_id": 42462128, "comment_id": 72078500, "body": "Some backend drivers support using <code>?</code>, or even named parameters. But unfortunately, the <code>pq</code> driver does not appear to support this. Another alternative might be to use the <a href=\"https://github.com/pouchdb/pouchdb/blob/master/lib/deps/request-browser.js\" rel=\"nofollow noreferrer\">sqlx</a> library, which adds named parameter support on top of the <code>sql</code> package, so it works with any backend. Whether that would actually be easier for you, I&#39;m not sure."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1488061018, "last_edit_date": 1488061018, "creation_date": 1488060357, "answer_id": 42462128, "question_id": 42461941, "link": "https://stackoverflow.com/questions/42461941/postgresql-inserting-multiple-tables-and-rows/42462128#42462128", "title": "PostgreSQL inserting multiple tables and rows", "body": "<p>Just as your error message says, your SQL statement only uses 3 bind variables:</p>\n\n<pre><code>   WITH company as (INSERT INTO companies(id, name) VALUES ($1, $2)) INSERT INTO services(id, company_id, name) VALUES\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>    q += \"($1, $2, $3),\"\n</code></pre>\n\n<p>You're simply repeating <code>$1</code>, <code>$2</code>, and <code>$3</code> for each of your rows.  So your constructed query will look something like:</p>\n\n<pre><code>WITH company as (INSERT INTO companies(id, name) VALUES ($1, $2)) INSERT INTO services(id, company_id, name) VALUES\n($1, $2, $3),($1, $2, $3),($1, $2, $3),($1, $2, $3),\n</code></pre>\n\n<p>Clearly that's not what you want.  You need to increment your bind variable numbering with each iteration through the loop.</p>\n\n<p>My approach would probably be something like:</p>\n\n<pre><code>var i int = 3\nfor _, row := range c.Services {\n    q += fmt.Sprintf(\"($%d, $%d, $%d),\", i, i+1, i+2)\n    values = append(values, row.ID, row.CompanyID)\n    i += 3\n}\n</code></pre>\n"}], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1314, "favorite_count": 0, "accepted_answer_id": 42462128, "answer_count": 1, "score": 0, "last_activity_date": 1488061018, "creation_date": 1488058971, "last_edit_date": 1488060843, "question_id": 42461941, "link": "https://stackoverflow.com/questions/42461941/postgresql-inserting-multiple-tables-and-rows", "title": "PostgreSQL inserting multiple tables and rows", "body": "<p>I have 2 structs one Company the other Service. They have a <code>has-many</code> relationship company to service. I'm trying to write an SQL query that will insert a company and multiple services attached to that company in one query.</p>\n\n<p>RAW SQL:</p>\n\n<pre><code>WITH company AS ( INSERT INTO companies(id, name) VALUES('1', 'acme') RETURNING id)\nINSERT INTO services(id, company_id, name) VALUES\n('1', (select company.id from company), 'cool service'),\n('2', (select company.id from company), 'cooler service');\n</code></pre>\n\n<p>I'm trying to imitate this using go's sql package. This is my attempt thus far: I've added the structs at the top just for clarity</p>\n\n<pre><code>c := &amp;Company{\n    ID: uuid.NewV4().String(),\n    Name: \"test comp\",\n}\n\ns := []*Service{\n    &amp;Service{\n        ID: uuid.NewV4().String(),\n        CompanyID: c.ID,\n        Name: \"test svc\",\n    },\n}\n\nc.Service = s\n\nvalues := []interface{}{\n    c.ID,\n    c.Name,\n}\n\nq := `\n    WITH company as (INSERT INTO companies(id, name) VALUES ($1, $2)) INSERT INTO services(id, company_id, name) VALUES\n`\n\nfor _, row := range c.Services {\n    q += \"($1, $2, $3),\"\n    values = append(values, row.ID, row.CompanyID)\n}\n\nq = strings.TrimSuffix(q, \",\")\n\nstmt, err := s.DB.Prepare(q)\nif err != nil {\n    return err\n}\n\nif _, err := stmt.Exec(values...); err != nil {\n    return err\n}\n</code></pre>\n\n<p>I'm not sure how else to go about this but with this method I get this error:</p>\n\n<pre><code>ERROR #08P01 bind message supplies 5 parameters, but prepared statement \"1\" requires 3\n</code></pre>\n\n<p>Which makes sense I'm passing 5 parameters to exec when prepared statement \"1\" which I'm guessing is the second one only requires 3. But how can I perform my query without having to split it up into more than 1 query?</p>\n"}, {"tags": ["json", "go", "unmarshalling", "telegram", "telegram-bot"], "answers": [{"tags": [], "owner": {"reputation": 6470, "user_id": 25814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nDa7n.jpg?s=128&g=1", "display_name": "themue", "link": "https://stackoverflow.com/users/25814/themue"}, "is_accepted": true, "score": 6, "last_activity_date": 1488045761, "creation_date": 1488045761, "answer_id": 42459656, "question_id": 42459498, "link": "https://stackoverflow.com/questions/42459498/json-unmarshal-not-decoding-into-inner-interface-correctly/42459656#42459656", "title": "json.Unmarshal not decoding into inner interface{} correctly", "body": "<p>Make it a <code>json.RawMessage</code> and unmarshal it in a second step, when you're sure what type it is.</p>\n\n<p>Take a look at the examples at <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#RawMessage</a>.</p>\n"}], "owner": {"reputation": 437, "user_id": 5495101, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1b048d0ab898b4ef2a40fbac49b7f35?s=128&d=identicon&r=PG&f=1", "display_name": "altermetax", "link": "https://stackoverflow.com/users/5495101/altermetax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 42459656, "answer_count": 1, "score": 3, "last_activity_date": 1488049823, "creation_date": 1488044955, "last_edit_date": 1488049823, "question_id": 42459498, "link": "https://stackoverflow.com/questions/42459498/json-unmarshal-not-decoding-into-inner-interface-correctly", "title": "json.Unmarshal not decoding into inner interface{} correctly", "body": "<p>I'm developing a Telegram Bot API wrapper for Golang (I know there are already some but I'm doing this for learning). I have a Response struct:</p>\n\n<pre><code>type Response struct {\n  Ok bool `json:\"ok\"`\n  ErrorCode int64 `json:\"error_code\"`\n  Description string `json:\"description\"`\n  Result interface{} `json:\"result\"`\n}\n</code></pre>\n\n<p>I can't know the actual type of <code>Result</code>: a lot can be returned by Telegram servers; I made a struct for each one, but I don't know which one will be in <code>Result</code>.\nWhen <code>Unmarshal</code>ing a JSON from an HTTP response into the <code>Response</code> struct, everything is loaded correctly, except <code>Result</code>.</p>\n\n<p>In a function where I am sure Result will be an <code>User</code> (for example), I'm doing <code>user := resp.Result.(*User)</code>, but I get the following error <em>at runtime</em>:\n<code>panic: interface conversion: interface {} is map[string]interface {}, not *tgbot.User</code>. So, <code>Result</code> is a <code>map[string]interface{}</code>. How can I transform it into a <code>*User</code>?</p>\n\n<p>Thanks for any answers.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "edited": false, "score": 0, "creation_date": 1488044149, "post_id": 42459306, "comment_id": 72061063, "body": "@Flimzy I need something you can put between <code>if</code> and opening <code>{</code>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1488044208, "creation_date": 1488044208, "answer_id": 42459355, "question_id": 42459306, "link": "https://stackoverflow.com/questions/42459306/map-item-test-as-an-expression/42459355#42459355", "title": "Map item test as an expression", "body": "<p>I think you're trying not to assign to the <code>v</code> and <code>ok</code> variables?</p>\n\n<p>This is not possible. However, there is a short hand available:</p>\n\n<pre><code>if v, ok := m[\"Answer\"]; ok {\n    // Do something with `v` if set\n} else {\n    // Do something if not set, v will be the nil value\n}\n</code></pre>\n\n<p>If you don't care about the value, but only that it's set, replace <code>v</code> with <code>_</code>.</p>\n\n<pre><code>if _, ok := m[\"Answer\"]; ok {\n    // Do something if set\n} else {\n    // Do something if not set\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": false, "score": 2, "last_activity_date": 1488044268, "creation_date": 1488044268, "answer_id": 42459370, "question_id": 42459306, "link": "https://stackoverflow.com/questions/42459306/map-item-test-as-an-expression/42459370#42459370", "title": "Map item test as an expression", "body": "<p>You can use <code>_</code> as a placeholder if you don't care to store the value.</p>\n\n<p>eg.</p>\n\n<pre><code>_, ok := m[\"Answer\"]\nif !ok {\n  // do something\n} else {\n  // do something else\n}\n</code></pre>\n\n<p>Or, you can condense this a bit:</p>\n\n<pre><code>if _, ok := m[\"Answer\"]; ok {\n  // do something\n} else {\n  // do something else\n}\n</code></pre>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1488051258, "answer_count": 2, "score": -1, "last_activity_date": 1488044268, "creation_date": 1488043983, "question_id": 42459306, "link": "https://stackoverflow.com/questions/42459306/map-item-test-as-an-expression", "closed_reason": "Duplicate", "title": "Map item test as an expression", "body": "<p>A Tour of Go explains how to test that a key is present in the map:</p>\n\n<pre><code>m := make(map[string]int)\nm[\"Answer\"] = 42\nv, ok := m[\"Answer\"]\nif ok { Do Something if set }\nif !ok { Do Something if not set }\n</code></pre>\n\n<p>Is there a way to test it without the assignment, expression way, something similar to this:</p>\n\n<pre><code>if m[\"Answer\"] IS NOT NULL  { Do Something if set }\nif m[\"Answer\"] IS NULL  { Do Something if not set }\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>fmt.Println(m[\"Answer\"] == nil)\n</code></pre>\n"}, {"tags": ["windows", "go", "build"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1488029122, "post_id": 42456388, "comment_id": 72055785, "body": "By the way, are you aware that Go has its <code>regexp</code> package implemented that way <a href=\"https://swtch.com/~rsc/regexp/regexp1.html\" rel=\"nofollow noreferrer\">for a reason</a>? To have an idea about what problems could be caused by RE engines allowing nondetermenistic RE&#39;s execution time, start with <a href=\"http://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488030031, "post_id": 42456388, "comment_id": 72056114, "body": "Yes, i read this. but i don&#39;t care. i have used regex module in python for parsing web pages in my self-written &quot;spider&quot;-bot. all were ok =) sometimes crash, rarely hang - usual issues."}, {"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488030487, "post_id": 42456388, "comment_id": 72056276, "body": "on python i used multiprocessing, on go, i think i need something like aborting by timeout"}, {"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488030930, "post_id": 42456388, "comment_id": 72056442, "body": "by the way, regexp2 package from dlclark have timeout option. maybe it would be reasonable to ask dlclarck to fix recursion..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488033646, "post_id": 42456388, "comment_id": 72057385, "body": "&#171;sometimes crash, rarely hang - usual issues&#187; -- I sincerely hope you don&#39;t work at NASA or on other mission-crictical software. &quot;Let it crash early&quot; is a good paradigm, but only when it&#39;s supported by the runtime which expects this to happen, and is able to recover. But it&#39;s named Erlang, not Python."}, {"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488036038, "post_id": 42456388, "comment_id": 72058171, "body": "It happened quite rarely and was not critical, hung processes were terminated with error reporting. If 1 of 10K sites will not be processed - this is not so important. And yes, it was not NASA )"}, {"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488036436, "post_id": 42456388, "comment_id": 72058317, "body": "and process-based parallelism is quite a supports this paradigm &quot;let it crash&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "edited": false, "score": 0, "creation_date": 1488037418, "post_id": 42457321, "comment_id": 72058638, "body": "thx for the answer) but &quot;complicated regular expressions are likely to hurt readability of code&quot; - i use self-written regexp generator script for my tasks (for example, HTML parsing). it is easier to generate new than to edit existing."}, {"owner": {"reputation": 175, "user_id": 11472248, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-N-3i5dkuX8E/AAAAAAAAAAI/AAAAAAAAC4I/qzobng6WZQc/photo.jpg?sz=128", "display_name": "kendfss", "link": "https://stackoverflow.com/users/11472248/kendfss"}, "edited": false, "score": 0, "creation_date": 1616235724, "post_id": 42457321, "comment_id": 117942177, "body": "Hey, I have a similar error message but with python, setup.py, and build as missing files. I have gcc and can use <code>gcc -v hello.c</code>, and have compiled with it in the past. it doesn&#39;t say which files the errors are in though (I was trying to &quot;get&quot; directly from github). Do either of you have any ideas about what could help here?"}], "tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1488033035, "creation_date": 1488033035, "answer_id": 42457321, "question_id": 42456388, "link": "https://stackoverflow.com/questions/42456388/how-do-i-use-a-cgo-based-package-on-windows/42457321#42457321", "title": "How do I use a cgo-based package on Windows?", "body": "<p>You may consider using C++ standard library <code>std::regex</code> (no third-party library). Wrap the logic in <code>try</code> block, use <code>catch(...){return ERROR;}</code> to catch any error, and declare the C function <code>extern \"C\"</code> so you can call with cgo.</p>\n\n<hr>\n\n<p>From <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/cgo</a> (there is a part about Windows):</p>\n\n<blockquote>\n  <p>In order to use cgo on Windows, you'll also need to first install a\n  gcc compiler (for instance, mingw-w64) and have gcc.exe (etc.) in your\n  PATH environment variable before compiling with cgo will work.</p>\n</blockquote>\n\n<hr>\n\n<p>That being said, I still think you should consider sticking with the <code>regexp</code> package and try to make regular expressions as simple as possible. Because complicated regular expressions are likely to hurt readability of code. Another problem is sometimes they introduce subtle bugs which are difficult to spot and fix. So writing more code in Go instead of regex may actually make the life easier.</p>\n"}], "owner": {"reputation": 3, "user_id": 7621501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4de3daf8ecf0644d2e1a99f22b23191?s=128&d=identicon&r=PG&f=1", "display_name": "dif05g3n", "link": "https://stackoverflow.com/users/7621501/dif05g3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1876, "favorite_count": 0, "accepted_answer_id": 42457321, "answer_count": 1, "score": 0, "last_activity_date": 1488033035, "creation_date": 1488027672, "last_edit_date": 1488028832, "question_id": 42456388, "link": "https://stackoverflow.com/questions/42456388/how-do-i-use-a-cgo-based-package-on-windows", "title": "How do I use a cgo-based package on Windows?", "body": "<p>The <code>regexp</code> in the Go's standard library is quite poor, so I need a more powerful engine, like regex in Python (pip install regex), supporting recursion, backref, look-ahead/behind, etc... .</p>\n\n<p>I found:\n<a href=\"https://godoc.org/github.com/dlclark/regexp2\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/dlclark/regexp2</a>\n.NET compatible, which was quite fine; however, recursion is not working properly.</p>\n\n<p>and several bindings to PCRE, for example: \n<a href=\"https://godoc.org/github.com/glenn-brown/golang-pkg-pcre/src/pkg/pcre\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/glenn-brown/golang-pkg-pcre/src/pkg/pcre</a></p>\n\n<p>so, how can I use this binding on Win64?</p>\n"}, {"tags": ["linux", "go", "serial-port", "postfix"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 7589596, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xpOvZXISv4w/AAAAAAAAAAI/AAAAAAAAAjY/vF0Iyr4iAms/photo.jpg?sz=128", "display_name": "Jan Karda\u0161", "link": "https://stackoverflow.com/users/7589596/jan-karda%c5%a1"}, "edited": false, "score": 0, "creation_date": 1488128134, "post_id": 42467063, "comment_id": 72083147, "body": "Not true about the path because if you are chrooted in /dev directory then it should be reachable by relative path. Even though - I tried no chrooting (which shows current folder as /var/spool/postfix) and absolute path to /dev/ttyACM0 with same exact result. But if I think about it right - shouldn&#39;t I be able to see more devices in /dev folder while listing it&#39;s contents?"}], "tags": [], "owner": {"reputation": 1711, "user_id": 2420301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irQpr.jpg?s=128&g=1", "display_name": "Marc Balmer", "link": "https://stackoverflow.com/users/2420301/marc-balmer"}, "is_accepted": false, "score": 0, "last_activity_date": 1488103108, "creation_date": 1488103108, "answer_id": 42467063, "question_id": 42456328, "link": "https://stackoverflow.com/questions/42456328/dev-ttyacm0-file-does-not-exist-while-postfix-pipe/42467063#42467063", "title": "/dev/ttyACM0 File does not exist while Postfix pipe", "body": "<p>The correct path the ttyACM0 is /dev/ttyACM0.  You define a udev rules to set the file mode when it attaches.</p>\n\n<p>If that is not reachable from your program, it might be the case that your program runs chrooted().</p>\n"}, {"tags": [], "owner": {"reputation": 177, "user_id": 7589596, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xpOvZXISv4w/AAAAAAAAAAI/AAAAAAAAAjY/vF0Iyr4iAms/photo.jpg?sz=128", "display_name": "Jan Karda\u0161", "link": "https://stackoverflow.com/users/7589596/jan-karda%c5%a1"}, "is_accepted": true, "score": 0, "last_activity_date": 1488313592, "creation_date": 1488313592, "answer_id": 42518098, "question_id": 42456328, "link": "https://stackoverflow.com/questions/42456328/dev-ttyacm0-file-does-not-exist-while-postfix-pipe/42518098#42518098", "title": "/dev/ttyACM0 File does not exist while Postfix pipe", "body": "<p>It seems like it was truly Linux problem and some underlying fabrics of it which I do not understand. I was running Fedora25 but the problem does not occur on Debian8.</p>\n"}], "owner": {"reputation": 177, "user_id": 7589596, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xpOvZXISv4w/AAAAAAAAAAI/AAAAAAAAAjY/vF0Iyr4iAms/photo.jpg?sz=128", "display_name": "Jan Karda\u0161", "link": "https://stackoverflow.com/users/7589596/jan-karda%c5%a1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 42518098, "answer_count": 2, "score": 0, "last_activity_date": 1488313592, "creation_date": 1488027339, "question_id": 42456328, "link": "https://stackoverflow.com/questions/42456328/dev-ttyacm0-file-does-not-exist-while-postfix-pipe", "title": "/dev/ttyACM0 File does not exist while Postfix pipe", "body": "<p>When I run script as regular user manually, everything is OK. But if an email is received and piped into Go script, I can not open serial port because file does not exist.</p>\n\n<pre><code>postfix   1239  1025  0 13:20 ? 00:00:00 pipe -n watchParadox -t unix flags=F user=watch argv=/usr/local/bin/watch -paradox\nwatch     1240  1239  0 13:20 ? 00:00:00 /usr/local/bin/watch -paradox\n</code></pre>\n\n<p>Script is running under watch user who has been added to dialout group, postfix user, just to be sure, is in dialout also.</p>\n\n<p>In my script I ran ls -la command to find out which files do truly exist:</p>\n\n<pre><code>drwxr-xr-x   6 root root  380 Feb 25 13:19 .\ndr-xr-xr-x. 18 root root 4096 Feb 22 17:53 ..\nlrwxrwxrwx   1 root root   11 Feb 25 13:19 core -&gt; /proc/kcore\nlrwxrwxrwx   1 root root   13 Feb 25 13:19 fd -&gt; /proc/self/fd\ncrw-rw-rw-   1 root root 1, 7 Feb 25 13:19 full\ndrwxr-xr-x   2 root root    0 Feb 25 13:19 hugepages\nlrwxrwxrwx   1 root root   28 Feb 25 13:19 log -&gt; /run/systemd/journal/dev-log\ndrwxrwxrwt   2 root root   40 Feb 25 13:19 mqueue\ncrw-rw-rw-   1 root root 1, 3 Feb 25 13:19 null\nlrwxrwxrwx   1 root root    8 Feb 25 13:19 ptmx -&gt; pts/ptmx\ndrwxr-xr-x   2 root root    0 Feb 25 13:19 pts\ncrw-rw-rw-   1 root root 1, 8 Feb 25 13:19 random\ndrwxrwxrwt   2 root root   40 Feb 25 13:19 shm\nlrwxrwxrwx   1 root root   15 Feb 25 13:19 stderr -&gt; /proc/self/fd/2\nlrwxrwxrwx   1 root root   15 Feb 25 13:19 stdin -&gt; /proc/self/fd/0\nlrwxrwxrwx   1 root root   15 Feb 25 13:19 stdout -&gt; /proc/self/fd/1\ncrw-rw-rw-   1 root root 5, 0 Feb 25 13:19 tty\ncrw-rw-rw-   1 root root 1, 9 Feb 25 13:19 urandom \n</code></pre>\n\n<p>I am certain following file exists but is not shown when postfix pipe is executed.</p>\n\n<pre><code>crw-rw---- 1 root dialout 166, 0 25.\u00a0\u00fano 13.19 ttyACM0\n</code></pre>\n\n<p>I tried chmod 777 on the file but no luck in that department. Opening file via <a href=\"https://github.com/tarm/serial\" rel=\"nofollow noreferrer\">https://github.com/tarm/serial</a> library which uses Go function:</p>\n\n<pre><code>os.OpenFile(\"ttyACM0\", syscall.O_RDWR|syscall.O_NOCTTY|syscall.O_NONBLOCK, 0666)\n</code></pre>\n\n<p>results with</p>\n\n<blockquote>\n  <p>ttyACM0: no such file or directory</p>\n</blockquote>\n\n<p>The problem is not the path because I tried relative (using chdir) and absolute with same exact outcome.</p>\n\n<p>I even disabled SELinux which is not what I want to do but in search of solution I try anything.</p>\n\n<p>Code is OK because manual execution of the script passes through properly. I think there is something wrong with Linux settings.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 490, "user_id": 384602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1670975814e0789ccbaa9effcac34f46?s=128&d=identicon&r=PG", "display_name": "Bogolt", "link": "https://stackoverflow.com/users/384602/bogolt"}, "is_accepted": false, "score": 2, "last_activity_date": 1488015468, "creation_date": 1488015468, "answer_id": 42454356, "question_id": 42453442, "link": "https://stackoverflow.com/questions/42453442/concurrent-map-iteration-and-map-write-error-in-golang-1-8/42454356#42454356", "title": "concurrent map iteration and map write error in Golang 1.8", "body": "<p>It looks like <a href=\"https://beta.golang.org/doc/go1.8#mapiter\" rel=\"nofollow noreferrer\">Concurrent Map Misuse </a>. Probably your function invoked from different gorotines. Try to enclose function body in mutex.Lock()/Unlock() so that your map is safe for concurrent use.</p>\n"}, {"tags": [], "owner": {"reputation": 119, "user_id": 3917745, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NYWHr.jpg?s=128&g=1", "display_name": "Simon Jin", "link": "https://stackoverflow.com/users/3917745/simon-jin"}, "is_accepted": false, "score": 0, "last_activity_date": 1489565627, "creation_date": 1489565627, "answer_id": 42804248, "question_id": 42453442, "link": "https://stackoverflow.com/questions/42453442/concurrent-map-iteration-and-map-write-error-in-golang-1-8/42804248#42804248", "title": "concurrent map iteration and map write error in Golang 1.8", "body": "<p>There is a enhanced concurrent access check added in the Golang 1.8, and this is the source code in runtime/hashmap.go:736,</p>\n\n<pre><code>if h.flags&amp;hashWriting != 0 {\n    throw(\"concurrent map iteration and map write\")\n}\n</code></pre>\n"}], "owner": {"reputation": 731, "user_id": 1186597, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f5c0aa95365378937fad596ea49b2120?s=128&d=identicon&r=PG", "display_name": "user2315", "link": "https://stackoverflow.com/users/1186597/user2315"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6921, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1489565627, "creation_date": 1488009132, "last_edit_date": 1488009549, "question_id": 42453442, "link": "https://stackoverflow.com/questions/42453442/concurrent-map-iteration-and-map-write-error-in-golang-1-8", "title": "concurrent map iteration and map write error in Golang 1.8", "body": "<p>So I have this func.. </p>\n\n<pre><code>func Set(firstSet map[string][]App, store map[string]*Parsed) map[string][string]struct{} {\n    s := make(map[string]map[string]struct{})\n    for dmn, parsed := range store {\n        for cId, apps := range firstSet {\n            if _, ok := s[dmn]; !ok {\n                s[dmn] = make(map[string]struct{})\n            }\n            s[dmn][cId] = struct{}{}\n        }\n    }\n\n    return s\n}\n</code></pre>\n\n<p>Line 3 of that func (for dmn, parsed := range store) is giving me the error concurrent map iteration and map write error in Golang 1.8. any idea?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7617914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d4b213b07df8c0f24d3e858f4f9cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/7617914/alexander"}, "edited": false, "score": 0, "creation_date": 1488016275, "post_id": 42452605, "comment_id": 72051772, "body": "I got it. Thanks a lot."}], "tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 0, "last_activity_date": 1488002886, "creation_date": 1488002886, "answer_id": 42452605, "question_id": 42452520, "link": "https://stackoverflow.com/questions/42452520/weird-behavior-of-big-newint-anonymous-variable/42452605#42452605", "title": "Weird behavior of big.NewInt anonymous variable", "body": "<p><a href=\"https://golang.org/pkg/math/big/#NewInt\" rel=\"nofollow noreferrer\">math/big.NewInt</a> returns a <em>pointer</em> to an <code>Int</code>, so after your first iteration, both <code>c</code> and <code>d</code> point to the <strong>same</strong> object. This means, in your second iteration, when you add something to <code>d</code>, the same change will be reflected in <code>c</code>. Then you copy <code>c</code> to <code>b</code> so <code>b</code> will also point to the same object, and on the next iteration <code>b</code> to <code>a</code>, so after your third iteration, all 4 variables point to the same <code>Int</code>.</p>\n\n<p>Your second loop works because you create a new <code>Int</code> for <code>d</code> each time, so every time you shift the pointers, a <em>new</em> <code>Int</code> (the one which was created for <code>d</code>) gets moved to <code>c</code>, then to <code>b</code>, then to <code>a</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 7617914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29d4b213b07df8c0f24d3e858f4f9cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/7617914/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 42452605, "answer_count": 1, "score": 0, "last_activity_date": 1488014468, "creation_date": 1488002238, "last_edit_date": 1488014468, "question_id": 42452520, "link": "https://stackoverflow.com/questions/42452520/weird-behavior-of-big-newint-anonymous-variable", "title": "Weird behavior of big.NewInt anonymous variable", "body": "<p>In the code snippet below, I want to make a very simple calculation <code>d = a + b + c; a, b, c = b, c, d</code>. It iterates several times.</p>\n\n<p>In the first try, I make an anonymous variable <code>big.NewInt(0).Add(a, b)</code> to get the result of <code>a + b</code>, then add it and <code>c</code> to get the final result of <code>a + b + c</code>. But from the second iteration, <code>d.Add(big.NewInt(0).Add(a, b), c)</code> changed the value of <code>c</code>, then <code>b</code>, then <code>a</code>, and of course, the final result is wrong.</p>\n\n<p>However, the second try's method gave me the right answer. Can anyone tell me why, please?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    // first try\n    a := big.NewInt(1)\n    b := big.NewInt(2)\n    c := big.NewInt(3)\n    d := big.NewInt(0)\n    for i := 0; i &lt; 5; i++ {\n        // d = a + b + c\n        d.Add(big.NewInt(0).Add(a, b), c)\n        fmt.Println(a, b, c, d)\n        // a &lt;- b, b &lt;- c, c &lt;- d\n        a, b, c = b, c, d\n        fmt.Println(a, b, c, d)\n    }\n    fmt.Println(d)\n\n    // second try\n    a = big.NewInt(1)\n    b = big.NewInt(2)\n    c = big.NewInt(3)\n    d = big.NewInt(0)\n    for i := 0; i &lt; 5; i++ {\n        // d = a + b + c\n        d = big.NewInt(0).Add(big.NewInt(0).Add(a, b), c)\n        fmt.Println(a, b, c, d)\n        // a &lt;- b, b &lt;- c, c &lt;- d\n        a, b, c = b, c, d\n        fmt.Println(a, b, c, d)\n    }\n\n    fmt.Println(d)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "edited": false, "score": 0, "creation_date": 1488028332, "post_id": 42452465, "comment_id": 72055483, "body": "I know there is a way, and you show me the simple way."}, {"owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1488080762, "post_id": 42452465, "comment_id": 72070843, "body": "@Flimzy It is what I need. No more questions."}], "tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": false, "score": 5, "last_activity_date": 1488001758, "creation_date": 1488001758, "answer_id": 42452465, "question_id": 42452415, "link": "https://stackoverflow.com/questions/42452415/how-to-convert-string-to-string/42452465#42452465", "title": "How to convert []string to ...string", "body": "<p>You can append <code>...</code> to the variable-name when calling the function to allow the slices values to be used as varargs-parameters:</p>\n\n<pre><code>template.ParseFiles(tmplPathList...)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jEc4Bj8QzS\" rel=\"noreferrer\">Demo on play.golang.org</a></p>\n"}], "owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488039277, "creation_date": 1488001358, "last_edit_date": 1488039277, "question_id": 42452415, "link": "https://stackoverflow.com/questions/42452415/how-to-convert-string-to-string", "title": "How to convert []string to ...string", "body": "<p>I want to have a func to scan the folder and find all the template file. Then call template.ParseFiles to parse all the templates. I use the <code>var tmplPathList []string</code> to record all the templates, and pass <code>tmplPathList</code> to <code>template.ParseFiles()</code>. </p>\n\n<p>The <code>func ParseFiles(filenames ...string) (*Template, error)</code> use <code>... string</code> as parameter. The compile error <code>cannot use tmplPathList (type []string) as type string in argument to \"html/template\".ParseFiles</code></p>\n\n<p>How can I convert <code>[]string</code> to <code>... string</code>?</p>\n\n<pre><code>var tmplPathList []string\nfor _, file := range tmplList {\n    tmplPathList = append(tmplPathList, dir + file.Name())\n}\ntemplates = template.Must(template.ParseFiles(tmplPathList))\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": false, "score": 3, "last_activity_date": 1488000663, "creation_date": 1488000663, "answer_id": 42452337, "question_id": 42452096, "link": "https://stackoverflow.com/questions/42452096/explain-chan-stringnil/42452337#42452337", "title": "Explain &lt;-(chan string)(nil)", "body": "<p>The statement casts <code>nil</code> as type <code>chan string</code>, then reads from it.</p>\n\n<p>According to <a href=\"https://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow noreferrer\">Dave Cheney's Channel Axioms</a>:</p>\n\n<p><code>A receive from a nil channel blocks forever</code></p>\n"}], "owner": {"reputation": 4416, "user_id": 1224362, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/75a56d666b124dd741a2cfc0ff6ab9bb?s=128&d=identicon&r=PG&f=1", "display_name": "JAre", "link": "https://stackoverflow.com/users/1224362/jare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1488043156, "creation_date": 1487998289, "last_edit_date": 1488043156, "question_id": 42452096, "link": "https://stackoverflow.com/questions/42452096/explain-chan-stringnil", "title": "Explain &lt;-(chan string)(nil)", "body": "<p>I found <a href=\"https://github.com/yyyar/gobetween/blob/master/src/main.go#L79\" rel=\"nofollow noreferrer\">this <code>&lt;-(chan string)(nil)</code></a> strange construct in the <a href=\"http://gobetween.io/\" rel=\"nofollow noreferrer\">Gobetween</a> sources. </p>\n\n<ul>\n<li>Is it just a fancy way to block forever or it has some kind of advantage over <code>select{}</code>?</li>\n<li><s>How to parse this statement?</s></li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 2507054, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b93ba5c0e4829faafbf3c30389a8c6d2?s=128&d=identicon&r=PG", "display_name": "DavidBittner", "link": "https://stackoverflow.com/users/2507054/davidbittner"}, "edited": false, "score": 0, "creation_date": 1488000167, "post_id": 42452283, "comment_id": 72048107, "body": "Thanks for the quick reply, I use GLFW quite a bit with C++ so I&#39;m pretty used to it. Maybe that&#39;s the route I want to go."}], "tags": [], "owner": {"reputation": 964, "user_id": 3184079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819c77c230e755f43bfbbbb87429c046?s=128&d=identicon&r=PG&f=1", "display_name": "Omar", "link": "https://stackoverflow.com/users/3184079/omar"}, "is_accepted": true, "score": 1, "last_activity_date": 1488000033, "creation_date": 1488000033, "answer_id": 42452283, "question_id": 42451992, "link": "https://stackoverflow.com/questions/42451992/checking-keyboard-state/42452283#42452283", "title": "Checking keyboard state", "body": "<p>I found GLFW to be pretty straightforward to get set up.\n<a href=\"https://github.com/go-gl/glfw\" rel=\"nofollow noreferrer\">https://github.com/go-gl/glfw</a></p>\n\n<p>If you want something even more cross platform, try out\n<a href=\"https://github.com/goxjs/glfw\" rel=\"nofollow noreferrer\">https://github.com/goxjs/glfw</a></p>\n\n<p>It has conditional compilation which lets you compile on desktop platforms normally, but also to gopherjs so you can run the same code in a browser canvas.</p>\n\n<p>Here a keyboard handler package I made with it:\n<a href=\"https://github.com/Omustardo/gome/blob/master/input/keyboard/keyboard.go\" rel=\"nofollow noreferrer\">https://github.com/Omustardo/gome/blob/master/input/keyboard/keyboard.go</a></p>\n"}], "owner": {"reputation": 505, "user_id": 2507054, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b93ba5c0e4829faafbf3c30389a8c6d2?s=128&d=identicon&r=PG", "display_name": "DavidBittner", "link": "https://stackoverflow.com/users/2507054/davidbittner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 42452283, "answer_count": 1, "score": 0, "last_activity_date": 1497618768, "creation_date": 1487997274, "last_edit_date": 1497618768, "question_id": 42451992, "link": "https://stackoverflow.com/questions/42451992/checking-keyboard-state", "title": "Checking keyboard state", "body": "<p>I can't seem to find a cross-platform library with Go that supports checking the state of the keyboard.</p>\n\n<p>I'd rather not use something so heavy as Qt as it makes it quite hard to cross-compile and the GUI elements are very simple. If anybody could point me in the right direction, that would be amazing.</p>\n\n<p>Thanks a ton.</p>\n\n<p>Stuff I've tried:</p>\n\n<p><a href=\"https://mattn.github.io/go-gtk/\" rel=\"nofollow noreferrer\">https://mattn.github.io/go-gtk/</a></p>\n\n<p><a href=\"https://github.com/gotk3/gotk3\" rel=\"nofollow noreferrer\">https://github.com/gotk3/gotk3</a></p>\n\n<p><a href=\"https://github.com/andlabs/ui\" rel=\"nofollow noreferrer\">https://github.com/andlabs/ui</a> (My favorite thus far, very lightweight.)\nIf there is something I could use alongside this, that would be great as well.</p>\n\n<p>EDIT:</p>\n\n<p>Hey guys, a few months later just wanted to give an update. I ended up going the Qt route. Therecipe's bindings are pretty solid, aside from a few bugs. Getting proper keyboard input to put it short was nothing more than a pain in the ass.</p>\n"}]