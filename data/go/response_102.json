[{"tags": ["go"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1482386682, "post_id": 41272985, "comment_id": 69754885, "body": "You should make it clear you are using sqlx in your question, don&#39;t make people try to guess what is going on. Furthermore that&#39;s the way the API works. You need 3 fields, scans takes 3 values, period there is no way around it. If you need another behavior use another method, like Get or Select ."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1482389988, "post_id": 41272985, "comment_id": 69756296, "body": "I would sugest you may try an ORM like   <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm</a> ."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1482420536, "post_id": 41272985, "comment_id": 69774989, "body": "@mpm Get() and Select() run into the same problem. What do you mean &quot;there is no way around it&quot;? There is always a way around it. It might be implementing my own scan, but I cannot seems to figure out how."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1482420582, "post_id": 41272985, "comment_id": 69775007, "body": "@Sarathsp yeah, I considered gorm, but the more complex queries seem to be awkward to implement in it"}, {"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1482484693, "post_id": 41272985, "comment_id": 69799320, "body": "@MadWombat My point is that ultimately you are limited by sql/db API, that&#39;s how this API works. So no. Given a number of columns X you need to provide X arguments in Scan. Period ."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1482552984, "post_id": 41272985, "comment_id": 69823819, "body": "@mpm that is not true, I have found a solution. Going to post it next week. Basically, you can use rows.Columns() method to get the column names returned by he query and dynamically generate a structure to pass to Scan that contains some throwaway variables and some pointers to the structure fields you want to store"}], "answers": [{"comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1482941333, "post_id": 41310839, "comment_id": 69932805, "body": "Huh... exactly what I was looking for. This feature should be more prominent in the docs :)"}], "tags": [], "owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "is_accepted": true, "score": 0, "last_activity_date": 1482560016, "creation_date": 1482560016, "answer_id": 41310839, "question_id": 41272985, "link": "https://stackoverflow.com/questions/41272985/custom-scanner-for-structs-in-go/41310839#41310839", "title": "Custom scanner for structs in Go", "body": "<p>You are already using sqlx so just use *DB.Unsafe() before querying :</p>\n\n<pre><code>var db *sqlx.DB\n\n// exactly the same as the built-in\ndb = sqlx.Open(\"sqlite3\", \":memory:\")\nvar p Person\nudb := db.Unsafe()\nerr = udb.Get(&amp;p, \"SELECT * FROM person, place LIMIT 1;\")\n</code></pre>\n"}], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1632, "favorite_count": 1, "accepted_answer_id": 41310839, "answer_count": 1, "score": 2, "last_activity_date": 1482560016, "creation_date": 1482359360, "question_id": 41272985, "link": "https://stackoverflow.com/questions/41272985/custom-scanner-for-structs-in-go", "title": "Custom scanner for structs in Go", "body": "<p>I am writing a sort of a REST-like API in Go. The database I have is legacy, so I don't control the field names or the structure or for that matter anything. I am abstracting database access methods in a separate package called datastore. The code I have looks like this (skipping all the error handling etc.)</p>\n\n<pre>\ntype Datastore struct {}\n\ntype Object struct {\n  id uint\n  name string\n  ... zillion more fields here\n}\n\nfunc (Datastore) ObjectList() {\n  var objects *[]Object\n  db, _ := sqlx.Open(\"postgres\", conn_info)\n  rows, _ := sqlx.Queryx(\"SELECT * FROM object_table\")\n  defer rows.Close()\n  for rows.Next() {\n    var obj Object\n    rows.Scan(&obj.id, &obj.name)\n    objects = append(objects, obj)\n  }\n  return objects\n}\n</pre>\n\n<p>The problem I am currently having is that the object table has dozens and dozens of fields. Some I care about, but some I do not. Some are named the same as Object and some are not. Eventually, I will need to support most of them, but I am working on a proof of concept first. It seems that the Scan code fails if it finds more fields in the row than are present in the arguments for Scan(). I could list the fields I scan for in the query <code>select id, name from object_table</code>, but \n1. it makes the code extremely ugly (SQL doesn't get formatted right by gofmt)\n2. it adds another place I need to edit when I want to support another field</p>\n\n<p>Is there any way to implement a custom scanner interface that would take the rows object, load some data out of it into a struct and ignore the rest?</p>\n"}, {"tags": ["http", "go", "request", "recover", "panic"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1482359338, "post_id": 41272888, "comment_id": 69747408, "body": "Unless you specifically panic for some reason, a panic indicates an error in your program. Fix the errors so that you don&#39;t have any panics to recover from."}, {"owner": {"reputation": 293, "user_id": 5494985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9100b9db686b28ffe9637aa37a33f1?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan D.", "link": "https://stackoverflow.com/users/5494985/ryan-d"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482360897, "post_id": 41272888, "comment_id": 69748030, "body": "That logic helps, looks like in the case of an error I have nothing to put in &quot;ch&quot; for the resp.Status.  If I mod the error handling the panic stops and I can figure out how to address."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1482459941, "post_id": 41272888, "comment_id": 69791461, "body": "not only can resp come back nil if err is not nil, but beware that it is possible that if err is not nil, then resp might not be nil but will cause a panic if you try to dereference it!  it isn&#39;t specifically this way for this function call, but the file walker interface did have this behavior (at least in an older version of go) where when err not nil, the other value returned isn&#39;t nil, but it was a garbage value that can&#39;t be dereferenced."}, {"owner": {"reputation": 908, "user_id": 3649496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59c95010d46812ccabe7eea947a090ab?s=128&d=identicon&r=PG&f=1", "display_name": "infiniteLearner", "link": "https://stackoverflow.com/users/3649496/infinitelearner"}, "edited": false, "score": 0, "creation_date": 1589283307, "post_id": 41272888, "comment_id": 109225526, "body": "I tried using recover() , then returning from their but it didn&#39;t work out."}], "answers": [{"tags": [], "owner": {"reputation": 293, "user_id": 5494985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9100b9db686b28ffe9637aa37a33f1?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan D.", "link": "https://stackoverflow.com/users/5494985/ryan-d"}, "is_accepted": false, "score": 2, "last_activity_date": 1482361250, "creation_date": 1482361250, "answer_id": 41273371, "question_id": 41272888, "link": "https://stackoverflow.com/questions/41272888/golang-http-request-error-panic-recover/41273371#41273371", "title": "golang http request error panic recover", "body": "<p>Thanks Jim B. I assumed the panic was triggered by the request, but it was the attempt to use \"resp.Status\" for a failed request, since it doesn't exist.  I modified my error handling to only put a resp.Status in the \"ch\" if there is no error.  In the case of an error, I substitute a different response into the \"ch\" with the error value.  No need to recover since no panic was triggered.</p>\n\n<pre><code>func MakeRequest(url string, ch chan&lt;- string) {\n    resp, err := http.Get(url)\n    if err != nil {\n        ch &lt;- fmt.Sprintf(\"url: %s, err: %s \", url, err)\n    } else {\n        ch &lt;- fmt.Sprintf(\"url: %s, status: %s \", url, resp.Status) // put response into a channel\n        defer resp.Body.Close()\n    }\n}\n</code></pre>\n\n<p>Output is now:</p>\n\n<p>[url: <a href=\"http://www.google.com\" rel=\"nofollow noreferrer\">http://www.google.com</a>, status: 200 OK ]</p>\n\n<p>[url: <a href=\"http://www.googlegoogle.com/\" rel=\"nofollow noreferrer\">http://www.googlegoogle.com/</a>, err: Get <a href=\"http://www.googlegoogle.com/\" rel=\"nofollow noreferrer\">http://www.googlegoogle.com/</a>: dial tcp: lookup www.googlegoogle.com: no such host ]</p>\n\n<p>[url: <a href=\"http://www.zoogle.com\" rel=\"nofollow noreferrer\">http://www.zoogle.com</a>, status: 500 Internal Server Error ]</p>\n"}, {"tags": [], "owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "is_accepted": false, "score": 0, "last_activity_date": 1482459588, "creation_date": 1482459588, "answer_id": 41294376, "question_id": 41272888, "link": "https://stackoverflow.com/questions/41272888/golang-http-request-error-panic-recover/41294376#41294376", "title": "golang http request error panic recover", "body": "<p>The only place I would (and do) place recovers: in a \"fault barrier\". </p>\n\n<p>A \"fault barrier\" is the highest available place to centrally catch problems.  It is generally the place where a new goroutine got spawned (ie: per http accept).  In a ServeHTTP method, you may want to catch and log individual panics without restarting the server (usually such panics are trivial nil ptr derefs).  You might see recovers in places where you cannot otherwise check for a condition you need to know - like whether a filehandle is closed already. (just close and handle a possible panic).</p>\n\n<p>I have a large code base that only used recover 2 or 3 times.  They are only for the cases mentioned, and I only do it to ensure that the problem is specifically logged.  I would do a recover just to log the message even if I was still going to os.Exit and have the script that launched me restart me.</p>\n"}], "owner": {"reputation": 293, "user_id": 5494985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9100b9db686b28ffe9637aa37a33f1?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan D.", "link": "https://stackoverflow.com/users/5494985/ryan-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2556, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1482459588, "creation_date": 1482358854, "question_id": 41272888, "link": "https://stackoverflow.com/questions/41272888/golang-http-request-error-panic-recover", "title": "golang http request error panic recover", "body": "<p>I am fairly new to coding in golang and am struggling with the panic/recover process for a bad url request.  Below is a script which queries a list of URLs and outputs responses. Occasionally a bad url is entered or a server is down and the HTTP request fails which causes a panic.  I am not clear on how to recover from this and continue.  I want the program to recover from the panic, document the bad url and error, and continue down the list of urls outputting the failed url and error with the rest of the normal url response data.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nvar urls = []string{\n    \"http://www.google.com\",        //good url, 200\n    \"http://www.googlegoogle.com/\", //bad url\n    \"http://www.zoogle.com\",        //500 example\n}\n\n//CONCURRENT HTTP REQUESTS -------------------------------------------\nfunc MakeRequest(url string, ch chan&lt;- string) {\n    resp, err := http.Get(url)\n    if err != nil {\n        fmt.Println(\"Error Triggered\", err)\n        ch &lt;- fmt.Sprintf(\"err: %s\", err)\n    }\n    ch &lt;- fmt.Sprintf(\"url: %s, status: %s \", url, resp.Status) // put response into a channel\n    resp.Body.Close()\n}\n\nfunc main() {\n    output := make([][]string, 0) //define an array to hold responses\n\n    //PANIC RECOVER------------------------------\n    defer func() { //catch or finally\n        if r := recover(); r != nil { //catch\n            fmt.Println(\"Recover Triggered: \", r)\n        }\n    }()\n\n    //MAKE URL REQUESTS----------------------------------------------\n    for _, url := range urls {\n        ch := make(chan string)                 //create a channel for each request\n        go MakeRequest(url, ch)                 //make concurrent http request\n        output = append(output, []string{&lt;-ch}) //append output to an array\n    }\n\n    //PRINT OUTPUT ----------------------\n    for _, value := range output {\n        fmt.Println(value)\n    }\n}\n</code></pre>\n\n<p>I am looking for an output similar to:</p>\n\n<p>[url: <a href=\"http://www.google.com\" rel=\"nofollow noreferrer\">http://www.google.com</a>, status: 200 OK ]</p>\n\n<p>[url: <a href=\"http://www.googlegoogle.com\" rel=\"nofollow noreferrer\">http://www.googlegoogle.com</a>, err: no such host]</p>\n\n<p>[url: <a href=\"http://www.zoogle.com\" rel=\"nofollow noreferrer\">http://www.zoogle.com</a>, status: 500 Internal Server Error ]</p>\n"}, {"tags": ["go", "middleware"], "comments": [{"owner": {"reputation": 1648, "user_id": 9935654, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XdoefqMBYAQ/AAAAAAAAAAI/AAAAAAAAIfg/qFXt_RO4q5s/photo.jpg?sz=128", "display_name": "Carson", "link": "https://stackoverflow.com/users/9935654/carson"}, "edited": false, "score": 0, "creation_date": 1617266968, "post_id": 41272169, "comment_id": 118258566, "body": "This <a href=\"https://github.com/gorilla/mux/issues/360#issuecomment-584869714\" rel=\"nofollow noreferrer\">link</a> is helpful to me."}], "answers": [{"comments": [{"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1536771992, "post_id": 41272170, "comment_id": 91548236, "body": "A little late to the party, but this doesn&#39;t actually user the Subrouter from Gorilla Mux..."}], "tags": [], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "is_accepted": true, "score": 1, "last_activity_date": 1482355706, "creation_date": 1482355706, "answer_id": 41272170, "question_id": 41272169, "link": "https://stackoverflow.com/questions/41272169/using-middleware-with-golang-gorilla-mux-subrouters/41272170#41272170", "title": "Using middleware with Golang Gorilla mux subrouters", "body": "<p>The following seems to work:</p>\n\n<pre><code>apiRouter := mux.NewRouter()\n\nrouter.PathPrefix(\"/api/\").Handler(http.StripPrefix(\"/api\",\n    adapt(apiRouter, checkTokenHandler)))\n\napiRouter.Methods(http.MethodGet).\n    Path(\"/path/to/handler\").Handler(handleAPICall)\n// Note that `/api` has been removed from the path.\n</code></pre>\n\n<p>where</p>\n\n<pre><code>func adapt(h http.Handler, adapters ...func(http.Handler) http.Handler)\n    http.Handler {\n    for _, adapter := range adapters {\n        h = adapter(h)\n    }\n    return h\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>func checkTokenHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n        // Check the security cookie.\n        h.ServeHTTP(res, req)\n    })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 515, "user_id": 3522182, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5NJSp.jpg?s=128&g=1", "display_name": "ali-star", "link": "https://stackoverflow.com/users/3522182/ali-star"}, "is_accepted": false, "score": 0, "last_activity_date": 1584992332, "last_edit_date": 1584992332, "creation_date": 1584989820, "answer_id": 60819937, "question_id": 41272169, "link": "https://stackoverflow.com/questions/41272169/using-middleware-with-golang-gorilla-mux-subrouters/60819937#60819937", "title": "Using middleware with Golang Gorilla mux subrouters", "body": "<p>You can use this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>router := mux.NewRouter().StrictSlash(true)\n\napiRoutes := router.PathPrefix(\"/api\").Subrouter()\napiRoutes.Use(authMiddleware)\napiRoutes.HandleFunc(\"/postes\", getPostes).Methods(\"GET\")\napiRoutes.HandleFunc(\"/postes/new\", newPost).Methods(\"POST\")\n</code></pre>\n\n<p>this is my authMidelware:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func authMiddleware(next http.Handler) http.Handler {\n    if len(APP_KEY) == 0 {\n        log.Fatal(\"HTTP server unable to start, expected an APP_KEY for JWT auth\")\n    }\n    jwtMiddleware := jwtmiddleware.New(jwtmiddleware.Options{\n        ValidationKeyGetter: func(token *jwt.Token) (interface{}, error) {\n            return []byte(APP_KEY), nil\n        },\n        SigningMethod: jwt.SigningMethodHS256,\n    })\n    return jwtMiddleware.Handler(next)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10041874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6jrRq.jpg?s=128&g=1", "display_name": "\u65e7\u65f6\u5149\u5370\u8bb0", "link": "https://stackoverflow.com/users/10041874/%e6%97%a7%e6%97%b6%e5%85%89%e5%8d%b0%e8%ae%b0"}, "is_accepted": false, "score": 0, "last_activity_date": 1616661586, "creation_date": 1616661586, "answer_id": 66795822, "question_id": 41272169, "link": "https://stackoverflow.com/questions/41272169/using-middleware-with-golang-gorilla-mux-subrouters/66795822#66795822", "title": "Using middleware with Golang Gorilla mux subrouters", "body": "<p>use these code ,should work fine \ud83d\ude04</p>\n<pre><code>    r := mux.NewRouter()\n    api := r.PathPrefix(&quot;/api&quot;).Subrouter()\n    routes.InitRouteV1(api)\n\n    // handle 404\n    r.NotFoundHandler = http.HandlerFunc(func (w http.ResponseWriter, req *http.Request) {\n        w.Header().Set(&quot;Content-type&quot;, &quot;application/json&quot;)\n        json.NewEncoder(w).Encode(&amp;response.Rsp{Code: http.StatusNotFound,Message: http.StatusText(http.StatusNotFound) })\n    })\n     // handle method\n    r.MethodNotAllowedHandler = http.HandlerFunc(func (w http.ResponseWriter, req *http.Request) {\n        w.Header().Set(&quot;Content-type&quot;, &quot;application/json&quot;)\n        json.NewEncoder(w).Encode(&amp;response.Rsp{Code: http.StatusMethodNotAllowed,Message: http.StatusText(http.StatusMethodNotAllowed) })\n    })\n</code></pre>\n<pre><code>package routes\n\nfunc InitRouteV1(r *mux.Router){\n    r.Use(middleware.ResponseJsonMiddleware)\n    r.HandleFunc(&quot;/user&quot;, controller.User).Methods(&quot;GET&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3991, "favorite_count": 1, "accepted_answer_id": 41272170, "answer_count": 3, "score": 1, "last_activity_date": 1616661586, "creation_date": 1482355706, "question_id": 41272169, "link": "https://stackoverflow.com/questions/41272169/using-middleware-with-golang-gorilla-mux-subrouters", "title": "Using middleware with Golang Gorilla mux subrouters", "body": "<p>How can I apply middleware to a Go <a href=\"http://www.gorillatoolkit.org/\" rel=\"nofollow noreferrer\">Gorilla Toolkit</a> mux subrouter?</p>\n\n<p>I have the following code:</p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(true)\napiRouter := router.PathPrefix(\"/api/\").Subrouter()\n\napiRouter.Methods(http.MethodGet).\n    Path(\"/api/path/to/handler\").Handler(handleAPICall)\n</code></pre>\n\n<p>I want to apply a middleware handler that checks a security token, but only on those paths that start with <code>/api</code>.</p>\n"}, {"tags": ["go", "hyperledger-fabric"], "comments": [{"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1482353569, "post_id": 41271614, "comment_id": 69744667, "body": "Did you checked your <code>$GOPATH</code> ?"}, {"owner": {"reputation": 608, "user_id": 988394, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/W8i5j.jpg?s=128&g=1", "display_name": "gvlax", "link": "https://stackoverflow.com/users/988394/gvlax"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1482353950, "post_id": 41271614, "comment_id": 69744871, "body": "I have it set in my .profile. I added it to my post at the end."}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1482354044, "post_id": 41271614, "comment_id": 69744916, "body": "in the <code>example02</code>, the code will try to import <code>shim</code> from <code>&quot;github.com&#47;hyperledger&#47;fabric&#47;core&#47;chaincode&#47;shim&quot;</code> which is not in your <code>$GOPATH</code>. This is why you got this error."}, {"owner": {"reputation": 608, "user_id": 988394, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/W8i5j.jpg?s=128&g=1", "display_name": "gvlax", "link": "https://stackoverflow.com/users/988394/gvlax"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1482355455, "post_id": 41271614, "comment_id": 69745638, "body": "I think I have it: <code>&#47;Users&#47;hyper&#47;Projects&#47;blockchain&#47;src&#47;github.com&#47;hyperledger&#47;&zwnj;&#8203;fabric&#47;core&#47;chaincod&zwnj;&#8203;e&#47;shim</code> but what worries me is <code>cannot find package &quot;hyperledger&#47;cci&#47;appinit&quot;</code>. Should I clone additional repo from github beforehand?"}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1482355702, "post_id": 41271614, "comment_id": 69745759, "body": "I din&#39;t use this package. So, maybe you&#39;ve to clone some additional packages. Try it and leave your feedbacks."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1483433559, "post_id": 41271614, "comment_id": 70085264, "body": "congrats on the fix and welcome to smart contracts! if you like you can check out a totally different stack called Eris at <a href=\"https://monax.io\" rel=\"nofollow noreferrer\">monax.io</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 2, "last_activity_date": 1482369032, "creation_date": 1482369032, "answer_id": 41274384, "question_id": 41271614, "link": "https://stackoverflow.com/questions/41271614/cannot-build-chaintool-example02/41274384#41274384", "title": "Cannot build &quot;chaintool/example02&quot;", "body": "<p><code>github.com/hyperledger/fabric</code> should have included all these dependencies in its <code>vendor/</code> folder or put the examples in their own repo with a vendor folder, so this looks like their problem not yours.</p>\n\n<p>You can fix it by running  <code>go get x y z</code> for all missing packages, or try using a vendoring tool to get them.</p>\n\n<p>There are many options for vendoring but no \"official\" option until next year. I prefer <code>govendor</code>. i havent tried it with this particular repo but you can try with:</p>\n\n<pre><code>go get -u github.com/kardianos/govendor\ncd /Users/hyper/Projects/blockchain/src/github.com/hyperledger/fabric/\ngovendor fetch -v +missing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 487, "user_id": 4432079, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/03991c2a9b10630fa26639ffee5d8ae5?s=128&d=identicon&r=PG&f=1", "display_name": "Randy Leonard", "link": "https://stackoverflow.com/users/4432079/randy-leonard"}, "is_accepted": false, "score": 2, "last_activity_date": 1482384916, "last_edit_date": 1482384916, "creation_date": 1482384552, "answer_id": 41276335, "question_id": 41271614, "link": "https://stackoverflow.com/questions/41271614/cannot-build-chaintool-example02/41276335#41276335", "title": "Cannot build &quot;chaintool/example02&quot;", "body": "<p>The HyperLedger team has provided very good documentation on how to use chaintool in a manner that allows users to document APIs (via Chain Code Interface, or CCI).  Without this, consumers of a chaincode must inspect source code to understand how to compose a REST invocation.  Great idea.</p>\n\n<p>This approach to building chaincode requires you download github.com/hyperledger/cci and github.com/hyperledger/ccs to reside next to github.com/hyperledger/fabric within your $GOPATH.  Unfortunately, I don't see any repository (on either github or gerrit) where this can be downloaded.</p>\n\n<p>Further, I've only seen one example (thus far) of how to use chaintool with cci and ccs, which is chaintool/example02... and it does not compile due to these missing hyperledger packages.</p>\n\n<p>There is documentation on chaintool with cci/ccs support at the following location:</p>\n\n<ul>\n<li><a href=\"https://github.com/hyperledger/fabric-chaintool\" rel=\"nofollow noreferrer\">https://github.com/hyperledger/fabric-chaintool</a></li>\n</ul>\n\n<p>But it seems this documentation has been copied to the following location and renamed from 'chaintool' to 'openblockchain compiler' (or OBCC) and labeled as a 'work in progress':</p>\n\n<ul>\n<li><a href=\"https://libraries.io/github/hyperledger/fabric-chaintool\" rel=\"nofollow noreferrer\">https://libraries.io/github/hyperledger/fabric-chaintool</a></li>\n</ul>\n\n<p>As such, I am inclined to believe the chaintool/example02 is not a currently supported approach to building chaincode... at least until OBCC becomes officially available.</p>\n"}], "owner": {"reputation": 608, "user_id": 988394, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/W8i5j.jpg?s=128&g=1", "display_name": "gvlax", "link": "https://stackoverflow.com/users/988394/gvlax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1483360971, "creation_date": 1482353202, "last_edit_date": 1483360971, "question_id": 41271614, "link": "https://stackoverflow.com/questions/41271614/cannot-build-chaintool-example02", "title": "Cannot build &quot;chaintool/example02&quot;", "body": "<p>I am trying to follow instructions on <a href=\"https://github.com/IBM-Blockchain/learn-chaincode/blob/master/docs/setup.md\" rel=\"nofollow noreferrer\">Chaincode Development Environment</a> to setup hyperledger in my local environment. </p>\n\n<p>Unfortunately, I am completely new to <em>golang</em>. When I come across an error trying to build \"<em>chaintool/example02</em>\" I have no idea how to proceed further - should I ignore the issue or first I should fix something? For example, to run make with some options, etc ... How can I get missing imports ?</p>\n\n<p>The output looks as follows:</p>\n\n<pre><code>hyper-00:chaincode hyper$ pwd\n /Users/hyper/Projects/blockchain/src/github.com/hyperledger/fabric/examples/chaincode/chaintool/example02/src/chaincode\n\nhyper-00:chaincode hyper$ go build ./\n    chaincode_example02.go:24:2: cannot find package \"hyperledger/cci/appinit\" in any of:\n        /Users/hyper/Projects/blockchain/src/github.com/hyperledger/fabric/vendor/hyperledger/cci/appinit (vendor tree)\n        /usr/local/go/src/hyperledger/cci/appinit (from $GOROOT)\n        /Users/hyper/Projects/blockchain/src/hyperledger/cci/appinit (from $GOPATH)\n    chaincode_example02.go:25:2: cannot find package \"hyperledger/cci/org/hyperledger/chaincode/example02\" in any of:\n        /Users/hyper/Projects/blockchain/src/github.com/hyperledger/fabric/vendor/hyperledger/cci/org/hyperledger/chaincode/example02 (vendor tree)\n        /usr/local/go/src/hyperledger/cci/org/hyperledger/chaincode/example02 (from $GOROOT)\n        /Users/hyper/Projects/blockchain/src/hyperledger/cci/org/hyperledger/chaincode/example02 (from $GOPATH)\n    chaincode_example02.go:26:2: cannot find package \"hyperledger/ccs\" in any of:\n        /Users/hyper/Projects/blockchain/src/github.com/hyperledger/fabric/vendor/hyperledger/ccs (vendor tree)\n        /usr/local/go/src/hyperledger/ccs (from $GOROOT)\n        /Users/hyper/Projects/blockchain/src/hyperledger/ccs (from $GOPATH)\nhyper-00:chaincode hyper$ \n</code></pre>\n\n<p>My $GOPATH gives:</p>\n\n<pre><code>hyper-00:~ hyper$ echo $GOPATH \n/Users/hyper/Projects/blockchain\n</code></pre>\n\n<p><hr>\n<strong>[EDITED on 2017-01-02]</strong></p>\n\n<p>I repeated the repo cloning procedure again. \nI think my mistake was I pulled a wrong source from GitHub - probably \"<em>master</em>\", not \"<em>v0.6</em>\".</p>\n\n<p>What I did and the compilation works now is:</p>\n\n<pre><code>$ sudo apt install golang-go\n\n$ gedit .profile\n\nexport PATH=$PATH:/usr/local/go/bin\nexport GOPATH=$HOME/Projects/blockchain    \n\n$ . ~/.profile\n\n$ mkdir -p $GOPATH/src/github.com/hyperledger/\n\n$ cd $GOPATH/src/github.com/hyperledger\n\n$ git clone -b v0.6 http://gerrit.hyperledger.org/r/fabric\n\n$ cd ~/Projects/blockchain/src/github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 \n\n$ go build\n</code></pre>\n"}, {"tags": ["pointers", "go", "literals"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1482351688, "post_id": 41271087, "comment_id": 69743628, "body": "And a comment on your design. If you want to hide your struct members behind functions like <code>SetName</code> then you should make them lower-case. If you make them UpperCase then they are public to everyone for use directly. And I&#39;d do it that way because I consider function-hiding to be silly, although you need it for Go interfaces, but whatever."}, {"owner": {"reputation": 57, "user_id": 7327423, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/888d4baca61ac4b4e439760360acc399?s=128&d=identicon&r=PG&f=1", "display_name": "RedBloodMage", "link": "https://stackoverflow.com/users/7327423/redbloodmage"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1482352302, "post_id": 41271087, "comment_id": 69743985, "body": "OK I will mess around with it some more and let you guys know what I come up with or if I am still struggling.  I had no idea helpful folks would reply to me so soon wow!  Thanks guys"}], "answers": [{"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 1, "last_activity_date": 1482351570, "creation_date": 1482351570, "answer_id": 41271252, "question_id": 41271087, "link": "https://stackoverflow.com/questions/41271087/return-literal-vs-pointer/41271252#41271252", "title": "Return Literal vs Pointer", "body": "<p>Go hides the difference between values and pointers in several places, but not everywhere.</p>\n\n<p>In this situation you will have to dereference <code>Sand</code> and write <code>compSlice = append(compSlice, SpringWater, *Sand)</code></p>\n"}, {"tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 1, "last_activity_date": 1482351587, "creation_date": 1482351587, "answer_id": 41271256, "question_id": 41271087, "link": "https://stackoverflow.com/questions/41271087/return-literal-vs-pointer/41271256#41271256", "title": "Return Literal vs Pointer", "body": "<p><code>component.Component</code> and <code>*component.Component</code> are different types in Go.  You're gonna want that slice to be <code>compSlice := make([]*component.Component, 5)</code> or <code>append(compSlice, *SpringWater)</code>.</p>\n\n<p>The methods you defined all deal with <code>*component.Component</code> not <code>component.Component</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "is_accepted": false, "score": 1, "last_activity_date": 1482359785, "last_edit_date": 1482359785, "creation_date": 1482353272, "answer_id": 41271638, "question_id": 41271087, "link": "https://stackoverflow.com/questions/41271087/return-literal-vs-pointer/41271638#41271638", "title": "Return Literal vs Pointer", "body": "<p>Both previous answers are correct.</p>\n\n<p>In my answer, i've added your code to the <code>main</code> package and i've added some comments in the <code>main function</code> to help you understanding what is going in your code.</p>\n\n<p>Here is the code with comments: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Component struct {\n    Name    string\n    Element string\n    Color   string\n}\n\nfunc (c *Component) SetName(name string) {\n    c.Name = name\n}\n\nfunc (c *Component) SetElement(element string) {\n    c.Element = element\n}\n\nfunc (c *Component) SetColor(color string) {\n    c.Color = color\n}\n\nfunc (c *Component) GetName() string {\n    return c.Name\n}\n\nfunc (c *Component) GetColor() string {\n    return c.Color\n}\n\nfunc (c *Component) GetElement() string {\n    return c.Element\n}\n\nfunc NewComponent(name string, color string, element string) *Component {\n    c := &amp;Component{}\n    c.SetName(name)\n    c.SetColor(color)\n    c.SetElement(element)\n    return c\n}\n\nfunc main() {\n\n    // NewComponent will return a *Component type\n    // So Sand will we a *Component type\n    Sand := NewComponent(\"Sand\", \"Red\", \"Earth\")\n    // You can create a slice of []*Component\n    compSlice := make([]*Component, 5)\n    // Then append Sand which is a *Component Slice\n    compSlice = append(compSlice, Sand)\n    // Result: Will be the reference of Sand which is a reference of Component struct\n    // [&lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; 0xc8200121b0]\n    fmt.Println(compSlice)\n    // Or, you can create a lice of []Component\n    newCompSlice := make([]Component, 5)\n    // Then append the reference of Sand which is *Sand\n    newCompSlice = append(newCompSlice, *Sand)\n    // Result: will be the literal Component struct\n    // [{  } {  } {  } {  } {  } {Sand Earth Red}]\n    fmt.Println(newCompSlice)\n}\n</code></pre>\n\n<p>Also, you can run it in: <a href=\"https://repl.it/EvLP/0\" rel=\"nofollow noreferrer\">repl.it</a></p>\n"}], "owner": {"reputation": 57, "user_id": 7327423, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/888d4baca61ac4b4e439760360acc399?s=128&d=identicon&r=PG&f=1", "display_name": "RedBloodMage", "link": "https://stackoverflow.com/users/7327423/redbloodmage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1482359785, "creation_date": 1482350896, "question_id": 41271087, "link": "https://stackoverflow.com/questions/41271087/return-literal-vs-pointer", "title": "Return Literal vs Pointer", "body": "<p>Trying to make a slice and having problems with literals and pointers.  It looks like when appending onto my slice it does not like the fact of being handed a pointer.  For instance I have a package type I made called components and holds type Component.  See below.</p>\n\n<pre><code>package components\n\nimport ()\n\ntype Component struct {\nName    string\nElement string\nColor   string\n}\n\nfunc (c *Component) SetName(name string) {\n    c.Name = name\n}\n\nfunc (c *Component) SetElement(element string) {\nc.Element = element\n}\n\nfunc (c *Component) SetColor(color string) {\n    c.Color = color\n}\n\nfunc (c *Component) GetName() string {\n    return c.Name\n}\n\nfunc (c *Component) GetColor() string {\n    return c.Color\n}\n\nfunc (c *Component) GetElement() string {\n    return c.Element\n}\n\nfunc NewComponent(name string, color string, element string) *Component {\n    c := &amp;Component{}\n    c.SetName(name)\n    c.SetColor(color)\n    c.SetElement(element)\n    return c\n}\n</code></pre>\n\n<p>Now I am attempting to make a slice to put all my components into I am making spellcasting components like Snow,Sand,Sunbeam,Springwater etc.</p>\n\n<pre><code>    //Creating SpringWater Component with Setters\n    SpringWater := components.Component{}\n    SpringWater.SetName(\"SpringWater\")\n    SpringWater.SetColor(\"Blue\")\n    SpringWater.SetElement(\"Water\")\n\n    //Creating Sand Component using the Constructor\n    Sand := components.NewComponent(\"Sand\", \"Red\", \"Earth\")\n</code></pre>\n\n<p><strong>ERROR HAPPENS HERE ON COMPLILE:</strong>\n    compSlice := make([]components.Component, 5)\n    compSlice = append(compSlice, SpringWater, Sand)</p>\n\n<p><strong>ERROR: Cannot use Sand as type (*components.Component) as type components.Component in append.</strong></p>\n\n<p>Now using the Setters and Setting the Fields DIRECT I can add it to a slice however using the method it returns a *pointer and the Slice will not comply.  I am just not understanding and having a difficult issue.  Keep in mind I am new to programming and basically come from scripting so forgive me on this and have seen similar questions but do not understand in this context.</p>\n"}, {"tags": ["http", "curl", "post", "go"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 1, "creation_date": 1482385978, "post_id": 41270458, "comment_id": 69754626, "body": "Can you try <code>-H &#39;Transfer-Encoding: chunked&#39; --upload-file race.mov</code>?"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1482430981, "post_id": 41270458, "comment_id": 69781342, "body": "wow, --upload-file works perfect. Didn&#39;t even need transfer-encoding. Well done."}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482350725, "creation_date": 1482348282, "last_edit_date": 1482350725, "question_id": 41270458, "link": "https://stackoverflow.com/questions/41270458/what-would-cause-curl-post-with-data-and-filename-to-only-send-46-of-the-dat", "title": "What would cause curl POST with --data and @filename to only send 46% of the data?", "body": "<p>I run:</p>\n\n<p><code>curl -i -X POST -H \"Content-Type: application/octet-stream\" --data @race.mov \"http://127.0.0.1:8080/api/v1/put_file\"</code></p>\n\n<p>where race.mov is 4134329 bytes. But only 1931871 are received by the program listening on port 8080.</p>\n\n<p>so I try another file that's 2482905 bytes. But only 1150635 are received. Isn't that weird?</p>\n\n<p><code>irb(main):002:0&gt; 1931871.0 / 4134329.0\n=&gt; 0.4672755845023461\nirb(main):003:0&gt; 1150635.0 / 2482905.0\n=&gt; 0.4634228856923644\n</code></p>\n\n<p>What's going on to make curl only send 46% of the binary data?</p>\n\n<p>Update this same go program:</p>\n\n<pre><code>  dat, err := ioutil.ReadFile(\"/Users/aa/Movies/race.mov\")\n  fmt.Println(err)\n\n  endpoint := fmt.Sprintf(\"http://127.0.0.1:8080/api/v1/put_file\")\n  fmt.Println(endpoint)\n  buffer_reader := bytes.NewReader(dat)\n  resp, err := http.Post(endpoint, \"application/octet-stream\", buffer_reader)\n  fmt.Println(resp, err)\n</code></pre>\n\n<p>makes the correct length happen so it MUST be curl</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1482347864, "post_id": 41270276, "comment_id": 69741557, "body": "No, that&#39;s valid: <a href=\"https://play.golang.org/p/WFHSrsjISC\" rel=\"nofollow noreferrer\">play.golang.org/p/WFHSrsjISC</a> Please show an example with the error your&#39;e seeing"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1482348034, "post_id": 41270327, "comment_id": 69741656, "body": "You don&#39;t need the <code>_</code>, just use <code>for range []int{1, 2, 3}</code>"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1482348067, "post_id": 41270327, "comment_id": 69741676, "body": "Awesome! Learnt one more thing. Thanks!"}], "tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": true, "score": 1, "last_activity_date": 1482348416, "last_edit_date": 1482348416, "creation_date": 1482347808, "answer_id": 41270327, "question_id": 41270276, "link": "https://stackoverflow.com/questions/41270276/how-to-loop-in-golang-without-using-the-iterator/41270327#41270327", "title": "How to loop in Golang without using the iterator?", "body": "<p>You can ignore such things by using the <a href=\"https://golang.org/doc/effective_go.html#blank\" rel=\"nofollow noreferrer\">blank identifier</a>: <code>_</code></p>\n\n<pre><code>for _ := range []int{1, 2, 3} {\n    code = GenNewCode()\n    Insert(code)\n}\n</code></pre>\n\n<p>Or one can use (via JimB's comment)</p>\n\n<pre><code>for range []int{1, 2, 3}{\ncode = GenNewCode()\n    Insert(code)\n}\n</code></pre>\n"}], "owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 41270327, "answer_count": 1, "score": 0, "last_activity_date": 1482348416, "creation_date": 1482347622, "last_edit_date": 1482348232, "question_id": 41270276, "link": "https://stackoverflow.com/questions/41270276/how-to-loop-in-golang-without-using-the-iterator", "title": "How to loop in Golang without using the iterator?", "body": "<p>I know this works. </p>\n\n<pre><code>for i :=range []int{1, 2, 3....} {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>But If I want to do something like:</p>\n\n<pre><code>for i :=range []int{1, 2, 3....} {\n    code = GenNewCode()\n    Insert(code)\n}\n</code></pre>\n\n<p>I get an error that <code>i</code> was not used.\nIs there a way I can do it without getting the above error?\n(Pardon me if this is a silly question, I am just learning Golang a bit.)</p>\n"}, {"tags": ["go", "orm", "beego"], "comments": [{"owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "edited": false, "score": 0, "creation_date": 1482357550, "post_id": 41267931, "comment_id": 69746627, "body": "Related: <a href=\"http://stackoverflow.com/questions/27894796/beego-must-have-one-register-database-alias-named-default\" title=\"beego must have one register database alias named default\">stackoverflow.com/questions/27894796/&hellip;</a>"}, {"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 0, "creation_date": 1482608512, "post_id": 41267931, "comment_id": 69836394, "body": "same issue myself. trying to follow the docs to a t but still wont work."}], "owner": {"reputation": 46, "user_id": 6882114, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YxH-NmrJZdE/AAAAAAAAAAI/AAAAAAAAABI/aUiJgfFRDTw/photo.jpg?sz=128", "display_name": "Zeyit Ba\u015far", "link": "https://stackoverflow.com/users/6882114/zeyit-ba%c5%9far"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 393, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482339118, "creation_date": 1482339118, "question_id": 41267931, "link": "https://stackoverflow.com/questions/41267931/beego-orm-mysql-connection-error", "title": "Beego ORM MySql Connection Error", "body": "<p>I am use beego framework. I am getting the error \"Must have one register DataBase alias nameddefault \"in ORM mysql connection</p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1482348944, "post_id": 41267069, "comment_id": 69742181, "body": "I don&#39;t <i>think</i> there&#39;s an easy way other than CGO without doing something hacky. You don&#39;t need gcc for CGO, you can set CGO&#39;s compiler by setting the env var <code>CC=&lt;desired compiler&gt;</code>.  I don&#39;t know much about windows&#39; c compiler though, or env vars in windows for that matter."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482349086, "post_id": 41267069, "comment_id": 69742269, "body": "You can certainly convert the strings, but the problem is that LPCTSTR is conditionally a typedef for LPCSTR or LPCWSTR. Do you have any way to ensure the type?"}, {"owner": {"reputation": 3436, "user_id": 1520878, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/6822b07182b8c0ae366325f2ae4fab4f?s=128&d=identicon&r=PG", "display_name": "brooks94", "link": "https://stackoverflow.com/users/1520878/brooks94"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482355619, "post_id": 41267069, "comment_id": 69745733, "body": "@JimB, yes, I think the type of the string is implied by the function I&#39;m calling that has either an &quot;A&quot; or &quot;W&quot; suffix for the two types of data."}], "answers": [{"tags": [], "owner": {"reputation": 2400, "user_id": 1103700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365175c40356861c03385615db1adfdd?s=128&d=identicon&r=PG", "display_name": "WeakPointer", "link": "https://stackoverflow.com/users/1103700/weakpointer"}, "is_accepted": false, "score": 1, "last_activity_date": 1482356957, "creation_date": 1482356957, "answer_id": 41272464, "question_id": 41267069, "link": "https://stackoverflow.com/questions/41267069/convert-c-string-to-go-string-without-cgo/41272464#41272464", "title": "Convert C string to Go string without CGO", "body": "<p>If you can get a pointer to a cstring without CGO, and you can get the length of the string too, then perhaps you should create a byte slice from the cstring first.  </p>\n\n<pre><code>import (\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc ToByteSlice() []byte {\n    var bytes []byte\n\n    shdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;bytes))\n    shdr.Cap = int(stringlen)\n    shdr.Len = int(stringlen)\n    shdr.Data = uintptr(unsafe.Pointer(cpointer))\n\n    return bytes\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1482358347, "post_id": 41272645, "comment_id": 69746995, "body": "nice. Why might copy be needed unless you just want a string?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1482358461, "post_id": 41272645, "comment_id": 69747053, "body": "@Mark: converting it to a string implicitly makes a copy of the bytes. If you return a slice directly from the array, it will point to the original memory location which may or may not be safe to access later."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1482358566, "last_edit_date": 1482358566, "creation_date": 1482357721, "answer_id": 41272645, "question_id": 41267069, "link": "https://stackoverflow.com/questions/41267069/convert-c-string-to-go-string-without-cgo/41272645#41272645", "title": "Convert C string to Go string without CGO", "body": "<p>If you have an 8 bit string, you can convert the LPCTSTR pointer to a <code>[]byte</code> of the proper size, and copy it to a new string or slice.</p>\n\n<pre><code>a := (*[1 &lt;&lt; 30-1]byte)(unsafe.Pointer(lpctstr))\nsize := bytes.IndexByte(a[:], 0)\n// if you just want a string\n// goString := string(a[:size:size])\n\n// if you want a slice pointing to the original memory location without a copy\n// goBytes := a[:size:size]\n\ngoBytes := make([]byte, size)\ncopy(goBytes, a)\n</code></pre>\n\n<p>If the LPCTSTR points to an LPCWSTR which contains 16bit unicode characters, you can convert that with the utf16 package.</p>\n\n<pre><code>a := (*[1 &lt;&lt; 30-1]uint16)(unsafe.Pointer(lpctstr))\nsize := 0\nfor ; size &lt; len(a); size++ {\n    if a[size] == uint16(0) {\n        break\n    }\n}   \nrunes := utf16.Decode(a[:size:size])\ngoString := string(runes)\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 1520878, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/6822b07182b8c0ae366325f2ae4fab4f?s=128&d=identicon&r=PG", "display_name": "brooks94", "link": "https://stackoverflow.com/users/1520878/brooks94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 1, "accepted_answer_id": 41272645, "answer_count": 2, "score": 2, "last_activity_date": 1482358566, "creation_date": 1482336191, "question_id": 41267069, "link": "https://stackoverflow.com/questions/41267069/convert-c-string-to-go-string-without-cgo", "title": "Convert C string to Go string without CGO", "body": "<p>I'm using the Go Windows syscall libraries to get data out of a function in a DLL.  This all works great, but I can't figure out a way to convert a LPCTSTR (pointer to C String) into a proper Go string <em>without using CGO</em>.</p>\n\n<p>I'd like to avoid CGO if at all possible, because the two options for CGO code on Windows (cross-compiling, and installing gcc on windows) are still fairly complex.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 7297164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vSPLm.gif?s=128&g=1", "display_name": "Rocky", "link": "https://stackoverflow.com/users/7297164/rocky"}, "is_accepted": true, "score": 0, "last_activity_date": 1482409623, "creation_date": 1482409623, "answer_id": 41283177, "question_id": 41267046, "link": "https://stackoverflow.com/questions/41267046/golang-how-to-fetch-specific-key-from-multistructure-from-the-rest-api-json-re/41283177#41283177", "title": "Golang how to fetch specific key (from multistructure) from the rest api json response", "body": "<pre><code>jsonDataSrc, errrr := ioutil.ReadAll(respTransitionID.Body)\n\n                        if errrr != nil {\n                            fmt.Println(\"Error reading JSON data:\", errrr)\n                            return\n                        }\n\n                        type Status struct {\n                            Name string `json:\"name\"`\n                            Id   string `json:\"id\"`\n                        }\n\n                        type Fields struct {\n                            Status Status `json:\"status\"`\n                        }\n\n                        type JsonResponse struct {\n                            Fields Fields `json:\"fields\"`\n                        }\n\n                        res := JsonResponse{}\n                        json.Unmarshal([]byte(jsonDataSrc), &amp;res)\n\n                        fmt.Println(res.Fields.Status.Id)\n                        fmt.Println(res.Fields.Status.Name)\n</code></pre>\n\n<p>output - 6\n         Closed</p>\n"}], "owner": {"reputation": 29, "user_id": 7297164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vSPLm.gif?s=128&g=1", "display_name": "Rocky", "link": "https://stackoverflow.com/users/7297164/rocky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 964, "favorite_count": 0, "accepted_answer_id": 41283177, "answer_count": 1, "score": -1, "last_activity_date": 1482409623, "creation_date": 1482336118, "last_edit_date": 1482360431, "question_id": 41267046, "link": "https://stackoverflow.com/questions/41267046/golang-how-to-fetch-specific-key-from-multistructure-from-the-rest-api-json-re", "title": "Golang how to fetch specific key (from multistructure) from the rest api json response", "body": "<p>Required json specific key: <code>status -&gt; name</code> and <code>id</code> values only</p>\n\n<pre><code>getUrl := \"https://www.test.com\" \n\nreqTransitionID, err := http.NewRequest(\"GET\", getUrl, nil)\n\nrespTransitionID, err := client.Do(reqTransitionID)\n\nif err != nil {\n    log.Fatal(err)\n}\ndefer respTransitionID.Body.Close()\n\ntype Statuskey struct {\n    Id   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\ntype TransitionID struct {\n    Status Statuskey `json:\"status\"`\n}\n\njsonData, errrr := ioutil.ReadAll(respTransitionID.Body)\nif errrr != nil {\n    fmt.Println(\"Error reading JSON data:\", errrr)\n    return\n}\n\nfmt.Println(string(jsonData))\nvar ss TransitionID\njson.Unmarshal(jsonData, &amp;ss)\nfmt.Println(ss.Status)\nfmt.Println(ss.Status.Id)\nfmt.Println(ss.Status.Name)\n</code></pre>\n\n<p>My Json response is :</p>\n\n<pre><code>{  \n   \"expand\":\"demo\",\n   \"id\":\"825\",\n   \"self\":\"TEST\",\n   \"key\":\"TEST\",\n   \"fields\":{  \n      \"status\":{  \n         \"self\":\"tst\",\n         \"description\":\"test\",\n         \"iconUrl\":\"test\",\n         \"name\":\"Closed\",\n         \"id\":\"6\",\n         \"statusCategory\":{  \n            \"self\":\"test\",\n            \"id\":3,\n            \"key\":\"done\",\n            \"colorName\":\"green\",\n            \"name\":\"Done\"\n         }\n      }\n   }\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482351676, "post_id": 41267002, "comment_id": 69743623, "body": "What have you tried? There are countless examples of unmarshaling JSON in Go."}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 0, "last_activity_date": 1482728266, "creation_date": 1482728266, "answer_id": 41326582, "question_id": 41267002, "link": "https://stackoverflow.com/questions/41267002/get-property-from-reader-io-object-in-golang/41326582#41326582", "title": "Get property from reader.io object in golang", "body": "<p>Something like this should work:</p>\n\n<pre><code>var s struct {\n    A string\n}\nerr := json.NewDecoder(response.Body).Decode(&amp;s)\n// check err\nresult := s.A\n</code></pre>\n\n<p>Also please note that your JSON response example is not valid JSON (single quotes instead of double quotes, field names are not quoted, field separators missing) and will not be parsed successfully as such.</p>\n"}], "owner": {"reputation": 143, "user_id": 5053840, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/4cb19df22047fe6f8fdc632f906e85ee?s=128&d=identicon&r=PG&f=1", "display_name": "Chenko47", "link": "https://stackoverflow.com/users/5053840/chenko47"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1482728266, "creation_date": 1482335986, "last_edit_date": 1482336755, "question_id": 41267002, "link": "https://stackoverflow.com/questions/41267002/get-property-from-reader-io-object-in-golang", "title": "Get property from reader.io object in golang", "body": "<p>I'm new at golang and got some little problem:</p>\n\n<p>I got remoteApi that give me some response when I'm making http request like here:</p>\n\n<pre><code>res, err := http.DefaultClient.Do(req)\n</code></pre>\n\n<p>the body of the response contains some json such as :</p>\n\n<pre><code>{\na: 'hello'\nb: 5\nc:[1,2,3]\n}\n</code></pre>\n\n<p>I need to assign the value of \"a\" to other variable .\nWhat is the best way to access one of res.Body properties? Ive tried to convert to json / string and so but no success</p>\n\n<p>thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1482335362, "post_id": 41266630, "comment_id": 69734274, "body": "if you have a string pointer that&#39;s already not very idiomatic... but no, there&#39;s no way to do that better than how you did it."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482335937, "post_id": 41266630, "comment_id": 69734669, "body": "Well, you could write a function for this..."}, {"owner": {"reputation": 33, "user_id": 7326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9364d2bc2f92b4f8154ac98efbb1e038?s=128&d=identicon&r=PG&f=1", "display_name": "New Sance", "link": "https://stackoverflow.com/users/7326452/new-sance"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1482337518, "post_id": 41266630, "comment_id": 69735739, "body": "@Not_a_Golfer One of example of why I have string pointers is unmarshalling json data with optional string fields.  Another is the aws-sdk-go library, which makes extensive use of pointers (probably also because of json under the hood; I haven&#39;t looked).  Either way, &quot;stop using pointers&quot; is not an available choice."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9364d2bc2f92b4f8154ac98efbb1e038?s=128&d=identicon&r=PG&f=1", "display_name": "New Sance", "link": "https://stackoverflow.com/users/7326452/new-sance"}, "edited": false, "score": 0, "creation_date": 1482337576, "post_id": 41267045, "comment_id": 69735783, "body": "Not exactly what I was looking for, but it does appear to be the best available option.  Thanks."}, {"owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "edited": false, "score": 2, "creation_date": 1482406490, "post_id": 41267045, "comment_id": 69766000, "body": "If your rename the <code>Print</code> method to <code>String</code> and make it return a string instead of writing to stdout, you&#39;ll implement the <code>Stringer</code> interface, which might be more useful."}], "tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": true, "score": 4, "last_activity_date": 1482339223, "last_edit_date": 1482339223, "creation_date": 1482336114, "answer_id": 41267045, "question_id": 41266630, "link": "https://stackoverflow.com/questions/41266630/is-there-an-idiomatic-go-way-to-print-string-pointer-contents-or-nil/41267045#41267045", "title": "Is there an idiomatic go way to print string pointer contents or nil?", "body": "<p>You could do something like this: </p>\n\n<pre><code>func main() {\n    var hello SmartString = \"hello\"\n\n    p := &amp;hello\n    p.Print()\n    p = nil\n    p.Print()\n\n}\n\ntype SmartString string\n\nfunc (p *SmartString) Print() {\n    if p == nil {\n        fmt.Println(p)\n    } else {\n        fmt.Println(*p)\n    }\n}\n</code></pre>\n\n<p>Whether it's a good idea or not is up to you.</p>\n\n<p>You can even use the String interface to make it work with <code>fmt.Println</code></p>\n\n<pre><code>func main() {\n    var hello SmartString = \"hello\"\n\n    p := &amp;hello\n    fmt.Println(p)\n    p = nil\n    fmt.Println(p)\n\n}\n\ntype SmartString string\n\nfunc (p *SmartString) String() string {\n    if p == nil {\n        return \"&lt;nil&gt;\"\n    }\n    return string(*p)\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7326452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9364d2bc2f92b4f8154ac98efbb1e038?s=128&d=identicon&r=PG&f=1", "display_name": "New Sance", "link": "https://stackoverflow.com/users/7326452/new-sance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2849, "favorite_count": 0, "accepted_answer_id": 41267045, "answer_count": 1, "score": 2, "last_activity_date": 1551378022, "creation_date": 1482334928, "question_id": 41266630, "link": "https://stackoverflow.com/questions/41266630/is-there-an-idiomatic-go-way-to-print-string-pointer-contents-or-nil", "title": "Is there an idiomatic go way to print string pointer contents or nil?", "body": "<p>I have a string pointer that may or may not be nil, and I want to print out either the contents of the string if contents exist, or indicate that the pointer is nil if it is nil.  Is there a clever way to do this that doesn't involve either an if check or a temporary variable (preferably a single line)?</p>\n\n<p>Right now I'm using something like this:</p>\n\n<pre><code>if p == nil {\n    fmt.Print(p)\n} else {\n    fmt.Print(*p)\n}\n</code></pre>\n\n<p>But this is particularly awkward and verbose when there is other formatting and other variables that are intended to be printed before and/or after that value.</p>\n"}, {"tags": ["go", "graphql"], "owner": {"reputation": 240, "user_id": 450040, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8c545473cc4f7bcd3f427285edda885?s=128&d=identicon&r=PG", "display_name": "jami", "link": "https://stackoverflow.com/users/450040/jami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 308, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482335493, "creation_date": 1482334445, "last_edit_date": 1482335493, "question_id": 41266472, "link": "https://stackoverflow.com/questions/41266472/how-to-transform-an-ast-document-to-a-graphql-schema", "title": "How to transform an ast.Document to a graphql.Schema", "body": "<p>I want to use the graphql type system language to create a schema that I can use for my application. In the application itself I want to hook into the resolver. The parsing of the type system files to a valid ast.Document is no problem</p>\n\n<pre><code>func parseSchemaToAST(t *testing.T, globalSchemaFile string) *ast.Document {\n    buffer, err := ioutil.ReadFile(globalSchemaFile)\n    if err != nil {\n        t.Fatalf(\"Error loading global schema file %v\", err)\n    }\n\n    astDoc, err := parser.Parse(parser.ParseParams{\n        Source: string(buffer),\n        Options: parser.ParseOptions{\n            NoLocation: true,\n        },\n    })\n\n    if err != nil {\n        t.Fatalf(\"Parse failed: %v\", err)\n    }\n\n    return astDoc\n}\n</code></pre>\n\n<p>I also can transform this ast.Document back to the type system language. (via graphql/language/printer) But how should I do the transformation from ast.Document to graphql.Schema? In the graphql-js implementation I found a freaking useful function with the signature </p>\n\n<pre><code>function buildASTSchema(ast: Document): GraphQLSchema\n</code></pre>\n\n<p>What would be the graphql-go counterpart for that. I want to avoid a custom implementation </p>\n"}, {"tags": ["macos", "go", "frameworks", "mac-frameworks"], "answers": [{"tags": [], "owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "is_accepted": true, "score": 8, "last_activity_date": 1482329962, "creation_date": 1482329962, "answer_id": 41264946, "question_id": 41264945, "link": "https://stackoverflow.com/questions/41264945/how-to-use-macos-os-x-frameworks-in-go/41264946#41264946", "title": "How to use macOS/OS X Frameworks in go", "body": "<p>Let's say we want to use CoreGraphics and CoreFoundation to capture the screen and get the image data:</p>\n\n<pre><code>package main\n\n// To use the two libraries we need to define the respective flags, include the required header files and import \"C\" immediately after\nimport (\n    // #cgo LDFLAGS: -framework CoreGraphics\n    // #cgo LDFLAGS: -framework CoreFoundation\n    // #include &lt;CoreGraphics/CoreGraphics.h&gt;\n    // #include &lt;CoreFoundation/CoreFoundation.h&gt;\n    \"C\"\n    \"image\"\n    \"reflect\"\n    \"unsafe\"\n    // other packages...\n)\n\nfunc main() {\n    displayID := C.CGMainDisplayID()\n    width := int(C.CGDisplayPixelsWide(displayID))\n    height := int(C.CGDisplayPixelsHigh(displayID))\n    rawData := C.CGDataProviderCopyData(C.CGImageGetDataProvider(C.CGDisplayCreateImage(displayID)))\n\n    length := int(C.CFDataGetLength(rawData))\n    ptr := unsafe.Pointer(C.CFDataGetBytePtr(rawData))\n\n    var slice []byte\n    hdrp := (*reflect.SliceHeader)(unsafe.Pointer(&amp;slice))\n    hdrp.Data = uintptr(ptr)\n    hdrp.Len = length\n    hdrp.Cap = length\n\n    imageBytes := make([]byte, length)\n\n    for i := 0; i &lt; length; i += 4 {\n    imageBytes[i], imageBytes[i+2], imageBytes[i+1], imageBytes[i+3] = slice[i+2], slice[i], slice[i+1], slice[i+3]\n        }\n\n    C.CFRelease(rawData)\n\n    img := &amp;image.RGBA{Pix: imageBytes, Stride: 4 * width, Rect: image.Rect(0, 0, width, height)}\n\n    // There we go, we can now save or process the image further\n    }\n</code></pre>\n"}], "owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 805, "favorite_count": 0, "accepted_answer_id": 41264946, "answer_count": 1, "score": 3, "last_activity_date": 1482329962, "creation_date": 1482329962, "question_id": 41264945, "link": "https://stackoverflow.com/questions/41264945/how-to-use-macos-os-x-frameworks-in-go", "title": "How to use macOS/OS X Frameworks in go", "body": "<p>For example, how to use CoreGraphics and CoreFoundation to manipulate the screen and process data on macOS.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1482328495, "post_id": 41264255, "comment_id": 69729540, "body": "Can you try adding <code>ON DELETE CASCADE</code> to your foreign key definition?"}, {"owner": {"reputation": 410, "user_id": 3338740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wHA9F.jpg?s=128&g=1", "display_name": "ellimist", "link": "https://stackoverflow.com/users/3338740/ellimist"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1482328612, "post_id": 41264255, "comment_id": 69729627, "body": "That&#39;s not what I&#39;m looking for. I want the default <code>ON DELETE RESTRICT</code> where if something references a row, I shouldn&#39;t be able to delete it."}], "owner": {"reputation": 410, "user_id": 3338740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wHA9F.jpg?s=128&g=1", "display_name": "ellimist", "link": "https://stackoverflow.com/users/3338740/ellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1482327939, "creation_date": 1482327939, "question_id": 41264255, "link": "https://stackoverflow.com/questions/41264255/mysql-foreign-key-violation-20-of-the-time", "title": "MySQL foreign key violation 20% of the time", "body": "<p>I have one of those, \"it happens sometimes\" problems, and I don't know where to begin even.</p>\n\n<p>I have the following database structure:</p>\n\n<pre><code>CREATE TABLE `group` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `name` varchar(255) NOT NULL,\n\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8;\n\nCREATE TABLE `person` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `group_id` int(11) DEFAULT NULL,\n\n  PRIMARY KEY (`id`),\n  KEY `user_group` (`group_id`),\n  CONSTRAINT `user_ibfk_2` FOREIGN KEY (`group_id`) REFERENCES `group` (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=utf8;\n</code></pre>\n\n<p>So, I have a group table, and a person table. The person can only belong to one group, so it has a foreign key called group_id;</p>\n\n<p>If I try to delete a group which has a person referencing to it, I usually get a foreign key error, could not delete group. BUT, sometimes, mysql happily removes the group, leaving me with a person referencing a non-existent group.</p>\n\n<ul>\n<li>MySQL version is 5.7.10, running the official Docker image </li>\n<li>Tables are InnoDB </li>\n<li>FOREIGN_KEY_CHECKS is set to 1</li>\n</ul>\n\n<p>Now, before actually trying to delete a group, I'm running a select on both tables to see their content; maybe that helps.</p>\n\n<p>I have something like this:</p>\n\n<pre><code>### Groups ####\nid: 1, name: My group!\nid: 2, name: Hello!\nid: 3, name: Wat!\nid: 22, name: My Group!\nid: 23, name: My Other Group!\nid: 24, name: Completely Different Group!\n\n### People ####\nid: 26, group_id: 1\nid: 28, group_id: 3\nid: 25, group_id: 23\n</code></pre>\n\n<p>Then the DELETE comes in... and I end up with the following:</p>\n\n<pre><code>### Groups ####\nid: 1, name: My group!\nid: 2, name: Hello!\nid: 3, name: Wat!\nid: 22, name: My Group!\nid: 24, name: Completely Different Group!\n\n### People ####\nid: 26, group_id: 1\nid: 28, group_id: 3\nid: 25, group_id: 23\n</code></pre>\n\n<p>The Group with the id: 23 was deleted even though the person:25 is still referencing it.</p>\n\n<p>MySQL logs look like this in both cases (when a foreign key constraint error is thrown, or not):</p>\n\n<pre><code>....\n114 Query  SELECT id, name FROM group\n113 Query  SELECT id, group_id FROM person\n114 Prepare        DELETE FROM group WHERE id = ?\n114 Execute        DELETE FROM group WHERE id = 23\n114 Close stmt\n</code></pre>\n\n<p>As I said already multiple times, this only happens ~20% of the case. I'm using the <code>go-sql-driver/mysql</code> to access the database.</p>\n\n<p>Sample code that does all this:</p>\n\n<pre><code>getAllGroups := \"SELECT id, name FROM group\"\ngetAllUsers  := \"SELECT id, group_id FROM person\"\n\nrows, err := DB.Query(getAllGroups)\ncheckErr(err)\ndefer rows.Close()\n\n// Print all the groups\n\nrows, err = DB.Query(getAllUsers)\ncheckErr(err)\ndefer rows.Close()\n\n// Print all the users\n// Each group is referenced by a user\n\nquery := \"DELETE FROM group WHERE id = ?\"\n_, err = DB.Exec(query, groupID)\n// Detect if the deletion failed\nif err != nil {\n  if strings.Contains(err.Error(), \"a foreign key constraint fails\") {\n    // FOREIGN KEY CONSTRAINT FAILED\n  }\n  // SOMETHING ELSE FAILED\n}\n// EVERYTHING WORKED... even though it shouldn't have\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "edited": false, "score": 0, "creation_date": 1482333246, "post_id": 41264392, "comment_id": 69732801, "body": "Thanks a lot. Did not check the order of return values, wasted a lot of time."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1482352992, "last_edit_date": 1482352992, "creation_date": 1482328361, "answer_id": 41264392, "question_id": 41263834, "link": "https://stackoverflow.com/questions/41263834/using-io-pipes-for-sending-and-receiving-message/41264392#41264392", "title": "using io.Pipes() for sending and receiving message", "body": "<p>You are using an <a href=\"https://golang.org/pkg/os/#Pipe\" rel=\"nofollow noreferrer\"><code>os.Pipe</code></a>, which returns  a pair of FIFO connected files from the os. This is different than an <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\"><code>io.Pipe</code></a> which is implemented in Go. </p>\n\n<p>The <code>invalid argument</code> errors are because you are reading and writing to the wrong files. The signature of <code>os.Pipe</code> is</p>\n\n<pre><code>func Pipe() (r *File, w *File, err error)\n</code></pre>\n\n<p>which shows that the returns values are in the order \"reader, writer, error\".</p>\n\n<p>and <code>io.Pipe</code>:</p>\n\n<pre><code>func Pipe() (*PipeReader, *PipeWriter)\n</code></pre>\n\n<p>Also returning in the order \"reader, writer\"</p>\n\n<p>When you check the error from the <code>os.Pipe</code> function, you are only printing the value. If there was an error, the files are invalid. You need to return or exit on that error. </p>\n\n<p>Pipes are also blocking (though an os.Pipe has a small, hard coded buffer), so you need to read and write asynchronously. If you swapped this for an <code>io.Pipe</code> it would deadlock immediately. Dispatch the Read method inside a goroutine and wait for it to complete.</p>\n\n<p>Finally, you are reading into a <code>nil</code> slice, which will read nothing. You need to allocate space to read into, and you need to record the number of bytes read to know how much of the buffer is used. </p>\n\n<p>A more correct version of your example would look like:</p>\n\n<pre><code>reader, writer, err := os.Pipe()\nif err != nil {\n    log.Fatal(err)\n}\n\nvar wg sync.WaitGroup\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    data := make([]byte, 1024)\n\n    n, err = reader.Read(data)\n    if n &gt; 0 {\n        fmt.Println(string(data[:n]))\n    }\n\n    if err != nil &amp;&amp; err != io.EOF {\n        fmt.Println(err)\n    }\n}()\n\n_, err = writer.Write([]byte(\"hello\"))\nif err != nil {\n    fmt.Println(err)\n}\n\nwg.Wait()\n</code></pre>\n"}], "owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1292, "favorite_count": 0, "accepted_answer_id": 41264392, "answer_count": 1, "score": 0, "last_activity_date": 1482352992, "creation_date": 1482326665, "last_edit_date": 1482333571, "question_id": 41263834, "link": "https://stackoverflow.com/questions/41263834/using-io-pipes-for-sending-and-receiving-message", "title": "using io.Pipes() for sending and receiving message", "body": "<p>I am using os.Pipes() in my program, but for some reason it gives a bad file descriptor error each time i try to write or read data from it.</p>\n\n<p>Is there some thing I am doing wrong?</p>\n\n<p>Below is the code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n\n    writer, reader, err := os.Pipe()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n\n    _,err= writer.Write([]byte(\"hello\"))\n\n\n    if err != nil {\n        fmt.Println(err)\n    }\n    var data []byte\n\n    _, err = reader.Read(data)\n\n\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(data))\n}\n</code></pre>\n\n<p>output :\nwrite |0: Invalid argument\nread |1: Invalid argument</p>\n"}, {"tags": ["go", "filesystems"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1482328002, "post_id": 41263783, "comment_id": 69729176, "body": "I always used os.Chtimes() and that worked fine and I always used the time of last modification, when working with timestamps of files. The timestamps of files are also related to the filesystem. So why is it not possible for you to use mtime?"}, {"owner": {"reputation": 1152, "user_id": 3972493, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/978efb2e5d7edf9d5bfb54741b27a2fe?s=128&d=identicon&r=PG&f=1", "display_name": "vvye", "link": "https://stackoverflow.com/users/3972493/vvye"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1482328424, "post_id": 41263783, "comment_id": 69729488, "body": "@apxp I guess using mtime is an option, it&#39;s just not my preferred one - mtime and btime mean different things after all, and I&#39;d like to keep them separate."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482329795, "post_id": 41263783, "comment_id": 69730406, "body": "You can&#39;t really have a general solution since most OSes don&#39;t have a concept of &quot;btime&quot;. Windows just calls it &quot;creation time&quot; in the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724933(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>SetFileTime</code> function</a>, which is available in the syscall package."}], "owner": {"reputation": 1152, "user_id": 3972493, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/978efb2e5d7edf9d5bfb54741b27a2fe?s=128&d=identicon&r=PG&f=1", "display_name": "vvye", "link": "https://stackoverflow.com/users/3972493/vvye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 833, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1482326527, "creation_date": 1482326527, "question_id": 41263783, "link": "https://stackoverflow.com/questions/41263783/how-can-i-change-a-files-creation-date-in-go", "title": "How can I change a file&#39;s creation date in Go?", "body": "<p>Can I change a file's creation time (apparently also known as <em>birth time</em> or <em>btime</em>) in Go, and if so, how?</p>\n\n<p>I've found a couple of ways to deal with file times in Go, including <code>os.Chtimes</code> and <a href=\"https://github.com/djherbis/times\" rel=\"nofollow noreferrer\">this package</a> &mdash; however, the former does not support btime, and the latter seems to deal only with reading the dates, not changing them.</p>\n\n<p>I'm looking for a Windows solution, though a general answer won't hurt either.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 233, "user_id": 551932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Os9to.jpg?s=128&g=1", "display_name": "avelino", "link": "https://stackoverflow.com/users/551932/avelino"}, "is_accepted": true, "score": 2, "last_activity_date": 1482326060, "creation_date": 1482326060, "answer_id": 41263640, "question_id": 41262973, "link": "https://stackoverflow.com/questions/41262973/how-to-get-description-of-mysql-table-in-golang/41263640#41263640", "title": "How to get Description of MySQL Table in GoLang", "body": "<p>With <strong>gorm</strong> you can perform a custom query and get her return in a <strong>struct</strong>, the following is an example of how to show the description of table:</p>\n\n<pre><code>type Result struct {\n    Field    string\n    Type     string\n    Null     string\n    Key      string\n    Default  string\n    Extra    string\n}\n\ndb.Raw(\"DESCRIBE TABLE_NAME\").Scan(&amp;result)\n</code></pre>\n\n<p>View more by gorm:\n<a href=\"http://jinzhu.me/gorm/advanced.html#sql-builder\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/advanced.html#sql-builder</a></p>\n"}], "owner": {"reputation": 95, "user_id": 5449397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7CJrP.jpg?s=128&g=1", "display_name": "Vicky", "link": "https://stackoverflow.com/users/5449397/vicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1978, "favorite_count": 0, "accepted_answer_id": 41263640, "answer_count": 1, "score": 0, "last_activity_date": 1604975714, "creation_date": 1482323777, "question_id": 41262973, "link": "https://stackoverflow.com/questions/41262973/how-to-get-description-of-mysql-table-in-golang", "title": "How to get Description of MySQL Table in GoLang", "body": "<p>com/jinzhu/gorm\" and \"github.com/go-sql-driver/mysql\" package to interact with my database and trying to get the description of table but didn't found the function. Please help  </p>\n"}, {"tags": ["go", "base64"], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 5, "last_activity_date": 1482320690, "creation_date": 1482320690, "answer_id": 41262067, "question_id": 41261877, "link": "https://stackoverflow.com/questions/41261877/decode-a-base64-string-in-golang/41262067#41262067", "title": "Decode a base64 string in golang", "body": "<p>It will be very hard:</p>\n\n<pre><code>Info.Println(string(sDec))\n</code></pre>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1376, "favorite_count": 0, "accepted_answer_id": 41262067, "answer_count": 1, "score": -3, "last_activity_date": 1482320690, "creation_date": 1482320087, "question_id": 41261877, "link": "https://stackoverflow.com/questions/41261877/decode-a-base64-string-in-golang", "title": "Decode a base64 string in golang", "body": "<p>I have this string  :</p>\n\n<pre><code>MTk6MTQ4MjMxOTY0MDo1NDU=\n</code></pre>\n\n<p>And i tried to decode it :</p>\n\n<pre><code>cookie_value = \"MTk6MTQ4MjMxOTY0MDo1NDU=\"\nsDec, _  := base64.StdEncoding.DecodeString(cookie_value)\nInfo.Println(sDec)\n</code></pre>\n\n<p>but it gives me that :</p>\n\n<pre><code>INFO: 2016/12/21 12:27:20 ApiRender.go:158: [49 57 58 49 52 56 50 51 49 57 54 52 48 58 53 52 53]\n</code></pre>\n\n<p>if you have any idea how to decode it properly</p>\n\n<p>thanks and regards</p>\n"}, {"tags": ["php", "laravel", "go", "grpc"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1482319975, "post_id": 41261773, "comment_id": 69724005, "body": "yes, one approach is to make users <i>feel</i> it loads faster without actually speeding up anything. Just split the loading. Load <i>something</i> quickly, and then populate it with content."}, {"owner": {"reputation": 5038, "user_id": 436754, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/40s9Q.jpg?s=128&g=1", "display_name": "Pawe\u0142 Szczur", "link": "https://stackoverflow.com/users/436754/pawe%c5%82-szczur"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1482320148, "post_id": 41261773, "comment_id": 69724085, "body": "The site is bloated with some 3rd party enhancing solutions. A long way to make it work fast. Theoretically there are parts loaded quickly, in practice I as a user feel it&#39;s slow."}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1482330567, "post_id": 41261773, "comment_id": 69730958, "body": "You can setup Varnish as a caching and failover layer between the store and additional APIs. As an added bonus, you can use Varnish to load-balance API requests and act as a traffic manager/router.  In general (and a little off-topic, sorry): - For a PHP-based store, there&#39;s almost nothing you can do on PHP level except for (obviously) using opcache, removing unnecessary .so modules, cutting logging to minimum and using latest version possible. - In my experience with Magento for example, easy performance wins were achieved by FPC with hole-punching + , doh, fine-tuning MySQL."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1482377125, "post_id": 41261773, "comment_id": 69752085, "body": "to call RPC methods asynchronously you can just create a goroutine, with <code>go method()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 5038, "user_id": 436754, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/40s9Q.jpg?s=128&g=1", "display_name": "Pawe\u0142 Szczur", "link": "https://stackoverflow.com/users/436754/pawe%c5%82-szczur"}, "edited": false, "score": 0, "creation_date": 1485421977, "post_id": 41867255, "comment_id": 70922234, "body": "Thanks. I was aware of it, I was wondering if anyone found some workarounds."}], "tags": [], "owner": {"reputation": 261, "user_id": 4593359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2ecdcf0041a68637d15e149fbbc619c?s=128&d=identicon&r=PG", "display_name": "Stanley Cheung", "link": "https://stackoverflow.com/users/4593359/stanley-cheung"}, "is_accepted": false, "score": 1, "last_activity_date": 1485407404, "creation_date": 1485407404, "answer_id": 41867255, "question_id": 41261773, "link": "https://stackoverflow.com/questions/41261773/how-to-call-microservice-without-slowing-down-the-response/41867255#41867255", "title": "How to call microservice without slowing down the response?", "body": "<ul>\n<li><p>The connection should be re-used if you are using the same Client. On the other hand, there is an option to pre-create a Grpc\\Channel object first and then pass it to the your service client as an optional 3rd parameter: <a href=\"https://github.com/grpc/grpc/blob/master/src/php/lib/Grpc/BaseStub.php#L58\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/blob/master/src/php/lib/Grpc/BaseStub.php#L58</a>. That way you should be able to re-use the same connection across services.</p></li>\n<li><p>Currently we don't provide an async API for PHP. We did have a tracking issue <a href=\"https://github.com/grpc/grpc/issues/6654\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/issues/6654</a> which we may consider in the future</p></li>\n</ul>\n"}], "owner": {"reputation": 5038, "user_id": 436754, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/40s9Q.jpg?s=128&g=1", "display_name": "Pawe\u0142 Szczur", "link": "https://stackoverflow.com/users/436754/pawe%c5%82-szczur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1485407404, "creation_date": 1482319769, "question_id": 41261773, "link": "https://stackoverflow.com/questions/41261773/how-to-call-microservice-without-slowing-down-the-response", "title": "How to call microservice without slowing down the response?", "body": "<p>I want to integrate a new functionality with a Laravel based ecommerce solution. At this point the main scripts takes around 2.7s to run. The whole site loads in above 6s and we've just started to monitor it. The goal is to get below 2s with script and 4s with everything.</p>\n\n<p>The microservice and the functionality is exposed through a gRPC.</p>\n\n<p>There is a TLS based client-server authentication in place (ecommerce instances and my service can prove who they are). This eats few milliseconds.</p>\n\n<p>When testing Go-client and Go-server, with a pool of 20 connections, it achieved below 35ms per requests. \nIn PHP each request takes above 200ms.</p>\n\n<p>Is it possible to:</p>\n\n<ol>\n<li>cache the connection to service between requests?</li>\n<li>call RPC methods asynchronously?</li>\n</ol>\n\n<p>Among other solutions I'm considering:</p>\n\n<ol>\n<li>Setting up a local gRPC proxy which will accept only localhost GET requests made by PHP script and make them a secure gRPC calls.</li>\n<li>Setting up a proxy in front of PHP application to call microservice.</li>\n<li>Calling a service directly from website with JavaScript (puts a burden on a users browser, need to maintain JavaScript).</li>\n</ol>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["pointers", "go", "segmentation-fault"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482319112, "post_id": 41261284, "comment_id": 69723511, "body": "In addition to what Ainar-G said: all pointers are equal and point the same variable. You should really get your logic straight."}, {"owner": {"reputation": 353, "user_id": 7084531, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/YcySo.jpg?s=128&g=1", "display_name": "Leylandski", "link": "https://stackoverflow.com/users/7084531/leylandski"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482319805, "post_id": 41261284, "comment_id": 69723918, "body": "Initially <code>now</code> was declared inside the loop, so that would be an entirely different pointer yes? I moved it outside while trying other ways, but didn&#39;t realise the issue was with the loop copying the value it was working with."}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 7084531, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/YcySo.jpg?s=128&g=1", "display_name": "Leylandski", "link": "https://stackoverflow.com/users/7084531/leylandski"}, "edited": false, "score": 0, "creation_date": 1482319672, "post_id": 41261465, "comment_id": 69723838, "body": "This seems to be a mistake I keep making, then fixing, then making again a month later. Annoyingly I can&#39;t post a fixed version because <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a> thinks it&#39;s 10/11/09."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 5, "last_activity_date": 1482318772, "creation_date": 1482318772, "answer_id": 41261465, "question_id": 41261284, "link": "https://stackoverflow.com/questions/41261284/what-is-causing-this-segfault-in-go/41261465#41261465", "title": "What is causing this segfault in Go?", "body": "<p>In your loop you copy every <code>Timekeeper</code> value. Do this instead:</p>\n\n<pre><code>for i := range t {\n    now = time.Now()\n    t[i].myTime = &amp;now\n}\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 7084531, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/YcySo.jpg?s=128&g=1", "display_name": "Leylandski", "link": "https://stackoverflow.com/users/7084531/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3828, "favorite_count": 0, "accepted_answer_id": 41261465, "answer_count": 1, "score": 2, "last_activity_date": 1482318772, "creation_date": 1482318264, "question_id": 41261284, "link": "https://stackoverflow.com/questions/41261284/what-is-causing-this-segfault-in-go", "title": "What is causing this segfault in Go?", "body": "<p><strong>Background:</strong> Because Go's inbuilt JSON marshaller doesn't check for zero values when given the <code>omitempty</code> flag, we're trying using <code>*time.Time</code> rather than <code>time.Time</code> in structs that need to be marshalled cleanly to JSON. The problem with this is obviously we need to be very careful to always check it is not nil when using it. One thing we did notice was in a function that sets a creation time on the encompassing struct, when we checked the JSON in the database all of the times were exactly the same, down to the nanosecond.</p>\n\n<p>To check whether this was something to do with the pointer or just because the system was performing very well, I made <a href=\"https://play.golang.org/p/Fq_3984pZ4\" rel=\"nofollow noreferrer\">this test</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Timekeeper struct {\n    myTime *time.Time\n}\n\nfunc main() {\n\n    t := make([]Timekeeper, 100)\n    var now time.Time\n    for _, v := range t {\n        now = time.Now()\n        v.myTime = &amp;now\n        time.Sleep(1 * time.Second)\n    }\n\n    for i, times := range t {\n        fmt.Printf(\"Timekeeper %s time: %s.\", i, times.myTime.Format(time.RFC3339Nano))\n    }\n\n}\n</code></pre>\n\n<p>but it keeps producing this panic:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0xffffffff addr=0x0 pc=0x20314]\n\ngoroutine 1 [running]:\npanic(0x112c00, 0x1040a038)\n    /usr/local/go/src/runtime/panic.go:500 +0x720\nmain.main()\n    /tmp/sandbox675251439/main.go:23 +0x314\n\nProgram exited.\n</code></pre>\n\n<p>I'm assuming this is <em>something</em> to do with the pointer being constantly reassigned to, but I've got a mental block going on and I can't figure out exactly what the issue is. Can someone please explain what is happening here?</p>\n"}, {"tags": ["go", "formatting", "int", "file-permissions"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1482313515, "last_edit_date": 1482313515, "creation_date": 1482313198, "answer_id": 41259532, "question_id": 41259439, "link": "https://stackoverflow.com/questions/41259439/how-to-convert-filemode-to-int/41259532#41259532", "title": "How to convert filemode to int?", "body": "<p>The value <code>509</code> is the decimal (base 10) representation of the permission bits.</p>\n\n<p>The form <code>0775</code> is the octal representation (base 8). You can print a number in octal representation using the <code>%o</code> verb:</p>\n\n<pre><code>perm := 509\nfmt.Printf(\"%o\", perm)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/AtpmdVgz6q\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>775\n</code></pre>\n\n<p>If you want the output to be 4 digits (with a leading <code>0</code> in this case), use the format string <code>\"%04o\"</code>:</p>\n\n<pre><code>fmt.Printf(\"%04o\", perm) // Output: 0775\n</code></pre>\n"}], "owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1411, "favorite_count": 1, "accepted_answer_id": 41259532, "answer_count": 1, "score": 2, "last_activity_date": 1589276253, "creation_date": 1482312973, "last_edit_date": 1482331165, "question_id": 41259439, "link": "https://stackoverflow.com/questions/41259439/how-to-convert-filemode-to-int", "title": "How to convert filemode to int?", "body": "<p>Sample code:</p>\n\n<pre><code>func main() {\n    p, _ := os.Open(os.Args[1])\n    m, _ := p.Stat()\n    println(m.Mode().Perm())\n}\n</code></pre>\n\n<p>File has mode <code>0775</code> (<code>-rwxrwxr-x</code>). Running it like:</p>\n\n<blockquote>\n  <p>./main main</p>\n</blockquote>\n\n<p>Prints <code>509</code></p>\n\n<p>And second:</p>\n\n<pre><code>func main() {\n    p, _ := os.Open(os.Args[1])\n    m, _ := p.Stat()\n    println(m.Mode().Perm().String())\n}\n</code></pre>\n\n<p>This code prints <code>-rwxrwxr-x</code>.</p>\n\n<p>How I can get mode in format <code>0775</code>?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 3, "last_activity_date": 1482317867, "creation_date": 1482317867, "answer_id": 41261128, "question_id": 41259191, "link": "https://stackoverflow.com/questions/41259191/golang-periodically-checking-open-tcp-connections-at-a-port/41261128#41261128", "title": "Golang periodically checking open TCP connections at a port", "body": "<p>Here the issue is not with the <code>Ticker</code>\ntry </p>\n\n<pre><code>for t := range ticker.C {\n        fmt.Println(\"Tick at\", t)\n        // connectionsCount()\n    }\n</code></pre>\n\n<p>You shall not pass <code>WaitGroup</code> by value . Passing <code>wg</code> as pointer will solve the issue. The fuction was waiting for ever</p>\n\n<p>update it to</p>\n\n<pre><code>    .....\n    func connectionsCount() {\n        var wg = &amp;sync.WaitGroup{}\n        wg.Add(len(ports))\n        for _, v := range ports {\n            go count(v, wg)\n        }\n        wg.Wait()\n    }\n   func count(port int, wg *sync.WaitGroup) {\n   .......\n</code></pre>\n\n<p>Here is the play <a href=\"https://play.golang.org/p/70Ssb1sRUT\" rel=\"nofollow noreferrer\">link</a></p>\n"}], "owner": {"reputation": 4123, "user_id": 785523, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b51864374e248ee87686628bc8528677?s=128&d=identicon&r=PG", "display_name": "tuk", "link": "https://stackoverflow.com/users/785523/tuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1665, "favorite_count": 1, "accepted_answer_id": 41261128, "answer_count": 1, "score": 1, "last_activity_date": 1482317867, "creation_date": 1482312331, "question_id": 41259191, "link": "https://stackoverflow.com/questions/41259191/golang-periodically-checking-open-tcp-connections-at-a-port", "title": "Golang periodically checking open TCP connections at a port", "body": "<p>I am trying write a small golang program which will periodically execute <code>lsof -i:&lt;port&gt;</code> to check number of open TCP connections at a port. Code looks like below:-</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"strings\"\n    \"sync\"\n    \"time\"\n)\n\ntype Lsof struct {\n    Command  string\n    Pid      string\n    User     string\n    Fd       string\n    Type     string\n    Device   string\n    SizeOff  string\n    Node     string\n    Name     string\n    TCPState string\n}\n\n//var result = make([]*Lsof, 0)\nvar ports = []int{30001, 30002}\n\nfunc main() {\n    done := make(chan bool)\n    ticker := time.NewTicker(5 * time.Millisecond)\n    go func() {\n        for t := range ticker.C {\n            fmt.Println(\"Tick at\", t)\n            connectionsCount()\n        }\n    }()\n    &lt;-done\n}\n\nfunc connectionsCount() {\n    var wg sync.WaitGroup\n    wg.Add(len(ports))\n    for _, v := range ports {\n        go count(v, wg)\n    }\n    wg.Wait()\n}\n\nfunc count(port int, wg sync.WaitGroup) {\n    defer wg.Done()\n    var tcpState = make(map[string]int)\n    out, err := exec.Command(\"/bin/sh\", \"-c\", fmt.Sprintf(\"lsof -i:%d\", port)).Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    //fmt.Println(string(out))\n    num := strings.Split(string(out), \"\\n\")\n    for no, n := range num {\n        if no == 0 {\n            continue\n        }\n        n = strings.TrimSpace(n)\n        if len(n) &lt;= 0 {\n            continue\n        }\n        i := 0\n        temp := strings.Split(n, \" \")\n        cleanedVal := make([]string, 10)\n        for _, v := range temp {\n            v = strings.TrimSpace(v)\n            if len(v) &lt;= 0 {\n                continue\n            }\n            cleanedVal[i] = v\n            i++\n        }\n        if len(cleanedVal) &lt; 8 {\n            //log.Println(n)\n            continue\n        }\n        l := new(Lsof)\n        l.Command = cleanedVal[0]\n        l.Pid = cleanedVal[1]\n        l.User = cleanedVal[2]\n        l.Fd = cleanedVal[3]\n        l.Type = cleanedVal[4]\n        l.Device = cleanedVal[5]\n        l.SizeOff = cleanedVal[6]\n        l.Node = cleanedVal[7]\n        l.Name = cleanedVal[8]\n        if l.Node == \"TCP\" {\n            l.TCPState = cleanedVal[9]\n            count, ok := tcpState[l.TCPState]\n            if !ok {\n                tcpState[l.TCPState] = 1\n            } else {\n                tcpState[l.TCPState] = count + 1\n            }\n        }\n        //fmt.Printf(\"\\n%+v\", *l)\n        //result = append(result, l)\n    }\n    fmt.Printf(\"Port=%d \", port)\n    for k, v := range tcpState {\n        fmt.Printf(\"{TCP State=%s,Value=%d},\", k, v)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>But on running the program I am seeing the ticker is not ticking periodically.</p>\n\n<pre><code>Tick at 2016-12-21 14:37:03.847694697 +0530 IST\nPort=30002 {TCP State=(LISTEN),Value=2},\nPort=30001 {TCP State=(LISTEN),Value=2},\n</code></pre>\n\n<p>Can someone let me know what is going wrong?</p>\n\n<ul>\n<li>Go Version - 1.7.3</li>\n</ul>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 45, "user_id": 7169905, "user_type": "registered", "profile_image": "https://graph.facebook.com/1881269332105064/picture?type=large", "display_name": "Sabri Boughanmi", "link": "https://stackoverflow.com/users/7169905/sabri-boughanmi"}, "edited": false, "score": 0, "creation_date": 1534849648, "post_id": 41258268, "comment_id": 96257044, "body": "<a href=\"https://goroutines.com/10m\" rel=\"nofollow noreferrer\">goroutines.com/10m</a> You Can handle 10M sockets within a single Server."}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532374528, "post_id": 51483405, "comment_id": 89941135, "body": "No single server will handle 1M connections anyway (at least not in 2018). You&#39;ll have multiple (many!) instances handling this level of traffic."}, {"owner": {"reputation": 103, "user_id": 2653362, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f67fc82e7016715bd125c662844fe08?s=128&d=identicon&r=PG&f=1", "display_name": "dgierejkiewicz", "link": "https://stackoverflow.com/users/2653362/dgierejkiewicz"}, "edited": false, "score": 0, "creation_date": 1577136235, "post_id": 51483405, "comment_id": 105103827, "body": "<a href=\"https://github.com/eranyanay/1m-go-websockets\" rel=\"nofollow noreferrer\">github.com/eranyanay/1m-go-websockets</a>, go can handle, erlang can handle.."}], "tags": [], "owner": {"reputation": 30, "user_id": 10123587, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7TbJboUTtE4/AAAAAAAAAAI/AAAAAAAAAg0/_hAZMav3Y74/photo.jpg?sz=128", "display_name": "Prakhar Agnihotri", "link": "https://stackoverflow.com/users/10123587/prakhar-agnihotri"}, "is_accepted": false, "score": 2, "last_activity_date": 1538334336, "last_edit_date": 1538334336, "creation_date": 1532363250, "answer_id": 51483405, "question_id": 41258268, "link": "https://stackoverflow.com/questions/41258268/scaling-webscocket-connections-using-golang/51483405#51483405", "title": "Scaling webscocket connections using golang", "body": "<p>Lets do some mathematics:</p>\n\n<p>Theoretically:\nEach go-routine consumes 8KB of memory.\nSo, for a million sockets, 8GB of ram is required.</p>\n\n<p>Now, let's shift the paradigm towards practicality.\nSince, you are using web socket, you are looking for two way channel communication. So, you would have to reserve a buffer for reading data from each socket.\nSo, another 8 GB of RAM gone just for listening the data from socket. \nThese figures just denotes the resource, required to spin and spawn a million connections, and doesn't include other important factors (resource reserved for other tasks, kernel reserved space, OS reserved space, etc.) </p>\n\n<p>Conclusion: This approach is simple, but not scalable beyond a certain limit.</p>\n\n<p>You would definitely need much more RAM, to scale at the proposed figure.</p>\n\n<p>You can minimise the memory consumption by implementing something like kQueue/ePoll. Via this approach, instead of constantly waiting for data to be consumed, and wasting the buffer memory, you would implement a callback, which gets informed if the socket is ready to read/write data, and then you can create a buffer and do read/write operations over the file descriptor. This would help you reuse the buffer, and thereby reduce resource consumption.</p>\n\n<p>Hope that helps!</p>\n"}], "owner": {"reputation": 5814, "user_id": 1449101, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/v4w0y.png?s=128&g=1", "display_name": "kannanrbk", "link": "https://stackoverflow.com/users/1449101/kannanrbk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1450, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1538334336, "creation_date": 1482308887, "last_edit_date": 1482309422, "question_id": 41258268, "link": "https://stackoverflow.com/questions/41258268/scaling-webscocket-connections-using-golang", "title": "Scaling webscocket connections using golang", "body": "<pre><code>   func handleConn(w http.ResponseWriter, r *http.Request) {\n        ws, err := upgrader.Upgrade(w, r, nil)\n        if err != nil {\n            if _, ok := err.(websocket.HandshakeError); !ok {\n                log.Println(err)\n            }\n            return\n       }\n\n        go writer(ws)\n        reader(r, ws)\n    }\n\n    func main() {\n       http.HandleFunc(\"/\", handleConn)\n    }\n</code></pre>\n\n<p>I am trying to build a high scaling websocket server using golang. Since there is lack of support in native go websocket package, i am using <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket</a>. </p>\n\n<p>For every connection, a goroutine will be spawned to take care of writes to it. For scaling huge number of connections. Let's say if I have 1M concurrent connections then there should be 1M goroutines will be running on the server.</p>\n\n<p><strong>Hardware Specification:</strong></p>\n\n<p>16 GB Ram</p>\n\n<p>4 Core CPU</p>\n\n<p>2.5 GHz Intel Core i5</p>\n\n<p>will it work for large number of connections without affecting the performance?</p>\n"}, {"tags": ["go", "singleton", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 0, "creation_date": 1482308423, "post_id": 41258099, "comment_id": 69716343, "body": "from where this init method is getting called?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 2, "creation_date": 1482308623, "post_id": 41258099, "comment_id": 69716445, "body": "@sector11 Package <code>init()</code> functions are executed once automatically, by the runtime, before you could refer to anything from the package. See edited answer."}, {"owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 0, "creation_date": 1482309117, "post_id": 41258099, "comment_id": 69716728, "body": "Getting cannot use localDbRef (type *gorm.DB) as type gorm.DB in field value"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 0, "creation_date": 1482309188, "post_id": 41258099, "comment_id": 69716769, "body": "@sector11 Edited code a couple of times, make sure you use the current version. If still doesn&#39;t work, please post your version."}, {"owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 0, "creation_date": 1482309490, "post_id": 41258099, "comment_id": 69716934, "body": "have updated  my question with you answer ontl thing i wish to know now is how to get error from Create function if it fails."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "edited": false, "score": 0, "creation_date": 1482310623, "post_id": 41258099, "comment_id": 69717628, "body": "@sector11 My answer already contains error handling. After calling <code>DB.Create()</code>, the <code>DB.GetErrors()</code> is called to check for errors, and if there were any, the first is returned, which must be checked at the caller (where <code>Manager.AddArticle()</code> is called)."}, {"owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482310916, "post_id": 41258099, "comment_id": 69717813, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/131130/discussion-between-sector11-and-icza\">continue this discussion in chat</a>."}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1515468480, "post_id": 41258099, "comment_id": 83301588, "body": "What&#39;s difference between this way and this: <a href=\"http://marcio.io/2015/07/singleton-pattern-in-go/\" rel=\"nofollow noreferrer\">marcio.io/2015/07/singleton-pattern-in-go</a> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1515483011, "post_id": 41258099, "comment_id": 83305643, "body": "@TomSawyer The difference is that in the example you liked, the library only creates the singleton when first needed. In my example I create it during package init which is only run once, so the initialization and access to this variable later on does not introduce data race."}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1515486194, "post_id": 41258099, "comment_id": 83307072, "body": "@icza i see he said: <code>The reason this is bad is that if references to the singleton instance are being held around through the code, there could be potentially multiple instances of the type with different states, generating potential different code behaviours</code> I&#39;m not sure about thread-safe with Go with it seems the way you&#39;re doing here make no difference?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1515486286, "post_id": 41258099, "comment_id": 83307119, "body": "@TomSawyer My singleton instance has no mutable state, so what you quoted does not apply here (&quot;with different states&quot;)."}, {"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1521697182, "post_id": 41258099, "comment_id": 85843519, "body": "@icza Is there a way to not have <code>func (mgr *manager) AddArticle(...</code> in the dbprovider package but instead import the dbprovider package in a models package and add that function and others there?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1521705308, "post_id": 41258099, "comment_id": 85847180, "body": "@drack Yes, you could embed the <code>Manager</code> type in your model types, that way your model types would have all the methods as well. You could also embed an interface type having only the relevant subset of the <code>Manager</code> type, relevant to the embedder model type."}, {"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1521751539, "post_id": 41258099, "comment_id": 85878284, "body": "@icza thanks, the latter is what I think I&#39;m trying to do. I just asked a new question more specific to what I&#39;m trying to do. <a href=\"https://stackoverflow.com/questions/49438104/using-a-singleton-database-class-with-separate-models-and-services-packages\" title=\"using a singleton database class with separate models and services packages\">stackoverflow.com/questions/49438104/&hellip;</a>"}, {"owner": {"reputation": 3060, "user_id": 6516044, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uL1tn.jpg?s=128&g=1", "display_name": "Yago Azedias", "link": "https://stackoverflow.com/users/6516044/yago-azedias"}, "edited": false, "score": 0, "creation_date": 1541301743, "post_id": 41258099, "comment_id": 93167872, "body": "This solution could bring troubles with go routines trying to use the same singleton at the same moment?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3060, "user_id": 6516044, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uL1tn.jpg?s=128&g=1", "display_name": "Yago Azedias", "link": "https://stackoverflow.com/users/6516044/yago-azedias"}, "edited": false, "score": 0, "creation_date": 1541370311, "post_id": 41258099, "comment_id": 93183466, "body": "@YagoAzedias Accessing the singleton is safe because package init runs in a single goroutine. And if <code>gorm.DB</code> is safe for concurrent access (to my knowledge it is), so will the singleton manager."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 18, "last_activity_date": 1482309310, "last_edit_date": 1482309310, "creation_date": 1482308259, "answer_id": 41258099, "question_id": 41257847, "link": "https://stackoverflow.com/questions/41257847/how-to-create-singleton-db-instance/41258099#41258099", "title": "How to create singleton DB instance", "body": "<p>One way is to create an exported interface with the methods, and make the implementing type unexported. Create a global variable of the interface type, and initialize it with a package <code>init()</code> function. You don't need any synchronization as the package <code>init()</code> function will run only once, safely.</p>\n\n<p>Package <code>init()</code> functions are executed once, automatically, by the runtime, before you could refer to anything from the package. For details, see <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"noreferrer\">Spec: Package initialization</a>.</p>\n\n<p>For example:</p>\n\n<pre><code>package dbprovider\n\ntype Manager interface {\n    AddArticle(article *article.Article) error\n    // Add other methods\n}\n\ntype manager struct {\n    db *gorm.DB\n}\n\nvar Mgr Manager\n\nfunc init() {\n    db, err := gorm.Open(\"sqlite3\", \"../articles.db\")\n    if err != nil {\n        log.Fatal(\"Failed to init db:\", err)\n    }\n    Mgr = &amp;manager{db: db}\n}\n\nfunc (mgr *manager) AddArticle(article *article.Article) (err error) {\n    mgr.db.Create(article)\n    if errs := mgr.db.GetErrors(); len(errs) &gt; 0 {\n        err = errs[0]\n    }\n    return\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>import \"dbprovider\"\n\nif err := dbprovider.Mgr.AddArticle(someArticle); err != nil {\n    // Handle error\n}\n</code></pre>\n\n<p>You could also do it without an <code>init()</code> function, e.g.:</p>\n\n<pre><code>var Mgr = newManager()\n\nfunc newManager() Manager {\n    db, err := gorm.Open(\"sqlite3\", \"../articles.db\")\n    if err != nil {\n        log.Fatal(\"Failed to init db:\", err)\n    }\n    return &amp;manager{db: db}\n}\n</code></pre>\n\n<p>With this you may decide to make <code>newManager()</code> exported and users of your package could decide to use the shared <code>Mgr</code> instance, or they could create another <code>Manager</code>, e.g. for testing purposes.</p>\n\n<p><strong>Notes:</strong> <code>Mgr</code> is an exported global variable, and it is possible to assign a new value to it by other packages (e.g. <code>dbprovider.Mgr = nil</code>). If you want to avoid this, you have to make it unexported, and provide a \"getter\" function for it, e.g.:</p>\n\n<pre><code>var mgr = newManager()\n\nfunc Mgr() Manager { return mgr }\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>err := dbprovider.Mgr().AddArticle(someArticle)\n</code></pre>\n"}], "owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7600, "favorite_count": 4, "accepted_answer_id": 41258099, "answer_count": 1, "score": 10, "last_activity_date": 1612099959, "creation_date": 1482307286, "last_edit_date": 1612099959, "question_id": 41257847, "link": "https://stackoverflow.com/questions/41257847/how-to-create-singleton-db-instance", "title": "How to create singleton DB instance", "body": "<p>I referred a few code samples of how to create go singleton but I wish to have methods in those and call them on their singleton reference. My Code is as follows</p>\n<pre><code>package dbprovider\n\nimport (\n    &quot;github.com/jinzhu/gorm&quot;\n    _&quot;github.com/jinzhu/gorm/dialects/sqlite&quot;\n    &quot;rest/article&quot;\n    &quot;log&quot;\n)\n\ntype DBOperations interface {\n    AddArticle(article *article.Article)\n}\n\ntype DBManager struct {\n    db            *gorm.DB\n    isInitialized bool\n}\n\nvar dbManagerInstance = new()\n\nfunc GetDBManager() DBManager {\n    return dbManagerInstance\n}\n\nfunc new() DBManager {\n    localDbRef, err := gorm.Open(&quot;sqlite3&quot;, &quot;../articles.db&quot;)\n    if (err != nil) {\n        panic(&quot;Error initializing db&quot;)\n    } else {\n        log.Print(&quot;DB Initialized successfully&quot;)\n    }\n    return DBManager{db:localDbRef, isInitialized:true}\n}\n\nfunc (dbManager DBManager)  AddArticle(article article.Article) (err error) {\n    if (dbManager.isInitialized) {\n        tx := dbManager.db.Begin()\n        //dbManager.db.NewRecord(article)\n        //dbManager.db.Commit()\n        tx.NewRecord(article)\n        tx.Commit()\n        errs := dbManager.db.GetErrors()\n        if (len(errs) &gt; 0) {\n            err = errs[0]\n        } else {\n            log.Print(&quot;No error in this transactions&quot;)\n        }\n\n    }\n    return\n}\n</code></pre>\n<p><strong>With a new answer I have updated this question including answer. But I have a few queries. How to cathc and return exception from gorm.Create(..)</strong></p>\n"}, {"tags": ["json", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 941, "user_id": 1091289, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/02e96838bf54281ce6ef0dbbe77b74a2?s=128&d=identicon&r=PG", "display_name": "King Jk", "link": "https://stackoverflow.com/users/1091289/king-jk"}, "is_accepted": false, "score": 1, "last_activity_date": 1482312494, "creation_date": 1482312494, "answer_id": 41259248, "question_id": 41257525, "link": "https://stackoverflow.com/questions/41257525/how-to-add-auto-increment-to-go-struct-with-json/41259248#41259248", "title": "How to add auto increment to Go struct with json", "body": "<p>First. According to Office Guideline\n<code>gorm:\"default:'galeone'\"</code> is your field default value </p>\n\n<p>Refer : <a href=\"http://jinzhu.me/gorm/crud.html#create\" rel=\"nofollow noreferrer\">gormDefaultValue</a>\nwhen you not give the value.\nso  your ID field need to be change . because your default value is string \nbut the field is int</p>\n\n<pre><code>Id    int    `json:\"id\" gorm:\"default:1\"`\n</code></pre>\n\n<p>and on func InitDb. you redefinition a variable db.Will occur error when you compiler or run go program. you need change two line \n 1. var db gorm.DB -> var db *gorm.DB\n 2.  func InitDb</p>\n\n<pre><code>func InitDb() {\nisInitialized = false\n//Change below code \nvar err interface{}\ndb, err = gorm.Open(\"sqlite3\", \"../../articles.db\")\n\nif (db != nil &amp;&amp; err == nil) {\n    log.Print(\"Db Initialized\")\n    isInitialized = true\n} else {\n    isInitialized = false\n    defer db.Close()\n    log.Panic(\"DB not initialized\")\n}\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 5473, "user_id": 1752366, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/HoNYQ.jpg?s=128&g=1", "display_name": "silentsudo", "link": "https://stackoverflow.com/users/1752366/silentsudo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3925, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1602859515, "creation_date": 1482306098, "last_edit_date": 1602859515, "question_id": 41257525, "link": "https://stackoverflow.com/questions/41257525/how-to-add-auto-increment-to-go-struct-with-json", "title": "How to add auto increment to Go struct with json", "body": "<p>I want to override Id value field in GORM with since I am using json also to marchal and unmarshall.</p>\n<pre><code>package article\n\nimport &quot;github.com/jinzhu/gorm&quot;\n\ntype Article struct {\n    gorm.Model\n    Id          int    `json:&quot;id&quot;`\n    Title       string `json:&quot;title&quot;`\n    Description string `json:&quot;description&quot;`\n    Content     string `json:&quot;content&quot;`\n}\n</code></pre>\n<p>I wish to add gorm property like this</p>\n<pre><code>`gorm:&quot;default:'galeone'&quot;`\n</code></pre>\n<p>But it is not compiling</p>\n<pre><code>package article\n\nimport &quot;github.com/jinzhu/gorm&quot;\n\ntype Article struct {\n    gorm.Model\n    Id          uint    `json:&quot;id&quot; sql:&quot;AUTO_INCREMENT&quot; gorm:&quot;primary_key&quot;`\n    Title       string `json:&quot;title&quot;`\n    Description string `json:&quot;description&quot;`\n    Content     string `json:&quot;content&quot;`\n}\n</code></pre>\n<p>I am using Gorm from here <code>[https://github.com/jinzhu/gorm][1]</code></p>\n<p>I am getting</p>\n<pre><code>2016/12/21 15:17:48 DB Initialized successfully\n\n(duplicate column name: id) \n[2016-12-21 15:17:48]  \n\n(no such table: articles) \n[2016-12-21 15:17:48]  \n</code></pre>\n<p>This is how i am creating DB it is working fine just want auto increment on Article struct</p>\n<pre><code>package dbprovider\n\nimport (\n    &quot;github.com/jinzhu/gorm&quot;\n    _&quot;github.com/jinzhu/gorm/dialects/sqlite&quot;\n    &quot;rest/article&quot;\n    &quot;log&quot;\n)\n\nvar db gorm.DB\n\nvar isInitialized bool\n\nfunc InitDb() {\n    isInitialized = false\n    db, err := gorm.Open(&quot;sqlite3&quot;, &quot;../../articles.db&quot;)\n\n    if (db != nil &amp;&amp; err == nil) {\n        log.Print(&quot;Db Initialized&quot;)\n        isInitialized = true\n    } else {\n        isInitialized = false\n        defer db.Close()\n        log.Panic(&quot;DB not initialized&quot;)\n    }\n}\n\nfunc AddArticle(article *article.Article) {\n    if (isInitialized) {\n        db.Create(&amp;article)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "templating"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482296803, "post_id": 41255403, "comment_id": 69711368, "body": "The images and particularly the second are difficult to read. Please paste the text into the question.  Also, what library are you using to render the template?"}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482297098, "post_id": 41255403, "comment_id": 69711458, "body": "@MellowMarmot just updated"}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482374569, "post_id": 41255403, "comment_id": 69751477, "body": "the smart people of the galaxy who voted negative would you please share your incredible knowledge with us why you think this is a stupid question"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1482298478, "creation_date": 1482298478, "answer_id": 41255821, "question_id": 41255403, "link": "https://stackoverflow.com/questions/41255403/golang-templating-does-not-work-properly/41255821#41255821", "title": "Golang templating does not work properly", "body": "<p>If you print the error from executing the template, you will find that the template cannot evaluate the field <code>PassChange</code>.  One possible fix is to add a PassChange field to the struct.</p>\n\n<pre><code>tpl.ExecResponse(w, struct{PassChange bool; Lang map[string]string ; UserExists bool}{Lang:lang.GetLang(r),UserExists:true})\n</code></pre>\n"}], "owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 41255821, "answer_count": 1, "score": -1, "last_activity_date": 1482298478, "creation_date": 1482296431, "last_edit_date": 1482297079, "question_id": 41255403, "link": "https://stackoverflow.com/questions/41255403/golang-templating-does-not-work-properly", "title": "Golang templating does not work properly", "body": "<p>I have an if else block in my template. when <code>else if</code> is true it is rendered always empty as if <code>else</code> or <code>else if</code> is not there \n<img src=\"https://i.imgur.com/4IM4HSm.png\" alt=\"\"></p>\n\n<p>here is my template</p>\n\n<p><a href=\"https://i.stack.imgur.com/hdW2B.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hdW2B.png\" alt=\"in this case\"></a>\nin this case, it renders nothing \n<a href=\"https://i.imgur.com/5BlEReS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.imgur.com/5BlEReS.png\" alt=\"enter image description here\"></a></p>\n\n<p>And also I am using <code>text/template</code> because <code>html/template</code>  send the page completely empty </p>\n\n<pre><code>//the template\n    &lt;script&gt;\n                  {{if.PassChange}}\n                  swal(\"{{.Lang.Success}}\", \"{{.Lang.PleaseLogin}}\", \"success\")\n                  {{end}}\n                  {{if.UserExists}}\n                  swal(\"{{.Lang.Fail}}\", \"{{.Lang.AlreadyMember}}\", \"error\")\n                  {{end}}\n    &lt;/script&gt;\n\n\n\n\n//rendering part\n    BasePath.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        tpl.ExecResponse(w, struct{Lang map[string]string ; UserExists bool}{Lang:lang.GetLang(r),UserExists:true})\n    })\n</code></pre>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 4408058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a4300b86cc9f7d6dc07088d24d95e3b?s=128&d=identicon&r=PG&f=1", "display_name": "m1cha3l", "link": "https://stackoverflow.com/users/4408058/m1cha3l"}, "is_accepted": true, "score": 1, "last_activity_date": 1482305864, "creation_date": 1482305864, "answer_id": 41257479, "question_id": 41254719, "link": "https://stackoverflow.com/questions/41254719/whats-the-different-between-redis-v4-and-redis-v5-in-golang-package/41257479#41257479", "title": "what&#39;s the different between redis.v4 and redis.v5 in golang package", "body": "<p>It seems that there is no official changelog, but on github you can use the compare function to see at least high-level what changed. In this case it was not much as far as i see.</p>\n\n<p><a href=\"https://github.com/go-redis/redis/compare/v4...v5\" rel=\"nofollow noreferrer\">https://github.com/go-redis/redis/compare/v4...v5</a></p>\n\n<p>On my own tests i have not seen any non-working functions to v4.</p>\n"}], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 41257479, "answer_count": 1, "score": 1, "last_activity_date": 1482305864, "creation_date": 1482291663, "question_id": 41254719, "link": "https://stackoverflow.com/questions/41254719/whats-the-different-between-redis-v4-and-redis-v5-in-golang-package", "title": "what&#39;s the different between redis.v4 and redis.v5 in golang package", "body": "<p>Currently I'm doing some project to build cache data using Redis using Go language.\nI'm using Redis version 4 from <a href=\"https://gopkg.in/redis.v4\" rel=\"nofollow noreferrer\">gopkg.in/redis.v4</a>. We have the plan to upgrade it to <a href=\"https://gopkg.in/redis.v5\" rel=\"nofollow noreferrer\">redis version 5</a>. </p>\n\n<p>But I've the following issue before attempt to update version : </p>\n\n<ul>\n<li>What is the good thing about redis 5 compare to redis 4</li>\n<li>I tried to find the changelog but I could not, any changelog for this update?</li>\n<li>any changes to make after updating the redis 4 to redis 5 ? like function ?</li>\n</ul>\n\n<p>Hopefully someone could help me regarding this issue. Any help would be appreciate.</p>\n"}, {"tags": ["windows", "go"], "answers": [{"tags": [], "owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1482291758, "creation_date": 1482291758, "answer_id": 41254741, "question_id": 41254463, "link": "https://stackoverflow.com/questions/41254463/how-to-get-system-root-directory-for-windows-in-google-golang/41254741#41254741", "title": "How to get system root directory for Windows in Google Golang?", "body": "<p>You may use os.Getenv to get the value for \"environment\" variable windir. An example is below:</p>\n\n<pre><code>package main\nimport \"os\"\nimport \"fmt\"\n\n\nfunc main() {\n\n    fmt.Println(\"system dir: \", os.Getenv(\"windir\"))\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": true, "score": 3, "last_activity_date": 1482291973, "last_edit_date": 1490004260, "creation_date": 1482291973, "answer_id": 41254775, "question_id": 41254463, "link": "https://stackoverflow.com/questions/41254463/how-to-get-system-root-directory-for-windows-in-google-golang/41254775#41254775", "title": "How to get system root directory for Windows in Google Golang?", "body": "<p>You could use <code>filepath.VolumeName(os.GetEnv(\"SYSTEMROOT\")) + \"\\\\\"</code> or the shorter <code>os.GetEnv(\"SYSTEMDRIVE\") + \"\\\\\"</code>. The <code>windir</code> environment variable probably shouldn't be used anymore honestly since it is not a system-controlled environment variable.</p>\n\n<p><a href=\"https://superuser.com/a/638335/135137\">Source for the mentioned environment variables</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1613241557, "last_edit_date": 1613241557, "creation_date": 1613227266, "answer_id": 66186317, "question_id": 41254463, "link": "https://stackoverflow.com/questions/41254463/how-to-get-system-root-directory-for-windows-in-google-golang/66186317#66186317", "title": "How to get system root directory for Windows in Google Golang?", "body": "<p>Here are some options that work with Windows or Unix.</p>\n<pre><code>import &quot;os&quot;\n\nfunc root() string {\n   return os.Getenv(&quot;SystemDrive&quot;) + string(os.PathSeparator)\n}\n</code></pre>\n<pre><code>import (\n   &quot;os&quot;\n   &quot;path/filepath&quot;\n)\n\nfunc root() string {\n   s := os.TempDir()\n   return filepath.Join(s, &quot;..&quot;, &quot;..&quot;)\n}\n</code></pre>\n<pre><code>import (\n   &quot;os&quot;\n   &quot;strings&quot;\n)\n\nfunc root() string {\n   s := os.TempDir()\n   return s[:strings.IndexRune(s, os.PathSeparator) + 1]\n}\n</code></pre>\n<pre><code>import (\n   &quot;os&quot;\n   &quot;path/filepath&quot;\n)\n\nfunc root() string {\n   s := os.TempDir()\n   return filepath.VolumeName(s) + string(os.PathSeparator)\n}\n</code></pre>\n<pre><code>import (\n   &quot;os&quot;\n   &quot;strings&quot;\n)\n\nfunc root() string {\n   s := os.TempDir()\n   return strings.SplitAfterN(s, string(os.PathSeparator), 2)[0]\n}\n</code></pre>\n<ul>\n<li><a href=\"https://golang.org/pkg/os#Getenv\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os#Getenv</a></li>\n<li><a href=\"https://golang.org/pkg/path/filepath#Join\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path/filepath#Join</a></li>\n<li><a href=\"https://golang.org/pkg/path/filepath#VolumeName\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path/filepath#VolumeName</a></li>\n<li><a href=\"https://golang.org/pkg/strings#IndexRune\" rel=\"nofollow noreferrer\">https://golang.org/pkg/strings#IndexRune</a></li>\n<li><a href=\"https://golang.org/pkg/strings#SplitAfterN\" rel=\"nofollow noreferrer\">https://golang.org/pkg/strings#SplitAfterN</a></li>\n</ul>\n"}], "owner": {"reputation": 1239, "user_id": 5421426, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/96a1eeb26ff88da78645596f42df3735?s=128&d=identicon&r=PG", "display_name": "Dr.Nemo", "link": "https://stackoverflow.com/users/5421426/dr-nemo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2028, "favorite_count": 0, "accepted_answer_id": 41254775, "answer_count": 3, "score": 4, "last_activity_date": 1613241557, "creation_date": 1482289622, "last_edit_date": 1482290028, "question_id": 41254463, "link": "https://stackoverflow.com/questions/41254463/how-to-get-system-root-directory-for-windows-in-google-golang", "title": "How to get system root directory for Windows in Google Golang?", "body": "<p>Under Windows, the system root directory could be like <code>C://</code> or <code>D://</code> (when the OS is installed in driver <code>D:/</code>). How to get this folder in Go?</p>\n"}, {"tags": ["go", "tcp"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1482274802, "last_edit_date": 1482274802, "creation_date": 1482274172, "answer_id": 41252447, "question_id": 41252089, "link": "https://stackoverflow.com/questions/41252089/golang-read-bytes-from-net-tcpconn-with-4-bytes-as-message-separation/41252447#41252447", "title": "golang read bytes from net.TCPConn with 4 bytes as message separation", "body": "<p>You can either choose to buffer the reads up yourself and split on the  <code>\\r\\n\\r\\n</code> delimiter, or let a <code>bufio.Scanner</code> do it for you. There's nothing onerous about implementing a <a href=\"https://golang.org/pkg/bufio/#SplitFunc\" rel=\"nofollow noreferrer\"><code>scanner.SplitFunc</code></a>, and it's definitely simpler than the alternative. Using <code>bufio.ScanLines</code> as an example, you could use:</p>\n\n<pre><code>scanner.Split(func(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    delim := []byte{'\\r', '\\n', '\\r', '\\n'}\n    if atEOF &amp;&amp; len(data) == 0 {\n        return 0, nil, nil\n    }\n    if i := bytes.Index(data, delim); i &gt;= 0 {\n        return i + len(delim), data[0:i], nil\n    }\n    if atEOF {\n        return len(data), data, nil\n    }\n    return 0, nil, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4640361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd65f8f6b29330c41259210bb59edc84?s=128&d=identicon&r=PG&f=1", "display_name": "Vincent Chang", "link": "https://stackoverflow.com/users/4640361/vincent-chang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 41252447, "answer_count": 1, "score": 0, "last_activity_date": 1482274802, "creation_date": 1482272028, "question_id": 41252089, "link": "https://stackoverflow.com/questions/41252089/golang-read-bytes-from-net-tcpconn-with-4-bytes-as-message-separation", "title": "golang read bytes from net.TCPConn with 4 bytes as message separation", "body": "<p>I am working on SIP over TCP mock service in golang. Incoming SIP messages are separated by '\\r\\n\\r\\n' sequence (I do not care about SDP for now). I want to extract message based on that delimiter and send it over to the processing goroutine. Looking through golang standard libraries I see no trivial way of achieving it. There seems to be no one shop stop in <code>io</code> and <code>bufio</code> packages. Currently I see two options of going forward (bufio):</p>\n\n<ol>\n<li><p>*Reader.ReadBytes function with '/r' set as the delimiter. Further processing is done by using ReadByte function and comparing it sequentially with each byte of the delimiter and unreading them if necessary (which looks quite tedious)</p></li>\n<li><p>Using Scanner with a custom split function, which does not look too trivial as well.</p></li>\n</ol>\n\n<p>I wonder whether there are any other better options, functionality seems so common that it is hard to believe that it is not possible to just define delimiter for tcp stream and extract messages from it.</p>\n"}, {"tags": ["ssl", "go", "https", "tls1.2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1482265862, "post_id": 41250665, "comment_id": 69701861, "body": "What version of Go are you using? What is the server, and can you get any logs describing why the connection might have failed?"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482266743, "post_id": 41250665, "comment_id": 69702306, "body": "go version go1.7.4 linux/386, server is Cisco APIC, have not found its logging related to HTTPS yet."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1482267307, "post_id": 41250665, "comment_id": 69702614, "body": "you could try running <code>github.com&#47;jbardin&#47;gotlsscan</code> against the host (requires &gt;go1.8beta, or build Go from master). It will run through all tls   versions and ciphersuites and list what&#39;s compatible. It&#39;s possible that the server is doing something incorrectly, but a different suite or tls version might still work (IIS used to break the handshake with tls1.2 too)"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482268107, "post_id": 41250665, "comment_id": 69703063, "body": "@JimB I have added result from gotlsscan into the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1482268571, "post_id": 41250665, "comment_id": 69703269, "body": "That shows it does get a successful handshake with <code>VersionTLS11</code> and <code>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</code>, so I would configure the client to use those settings."}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482269483, "post_id": 41250665, "comment_id": 69703677, "body": "@JimB Great! This is working: <a href=\"https://play.golang.org/p/oMrFigx-PT\" rel=\"nofollow noreferrer\">play.golang.org/p/oMrFigx-PT</a> Post it as an answe so I can accept it! :-)"}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 4548383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/981c3ef52cef1b7a7574a1209da356a8?s=128&d=identicon&r=PG", "display_name": "Alan Corey", "link": "https://stackoverflow.com/users/4548383/alan-corey"}, "edited": false, "score": 0, "creation_date": 1565353841, "post_id": 41251633, "comment_id": 101338043, "body": "If you&#39;re using a router or WiFi AP, reboot it.  There can be many causes of problems, that was it in my case."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1482269790, "creation_date": 1482269790, "answer_id": 41251633, "question_id": 41250665, "link": "https://stackoverflow.com/questions/41250665/go-https-client-issue-remote-error-tls-handshake-failure/41251633#41251633", "title": "Go https client issue - remote error: tls: handshake failure", "body": "<p>The server for some reason doesn't accept the TLS1.2 handshake, nor does it properly fall back to TLS1.1. You can force the client to use only TLS1.1 and the compatible cipher suites with</p>\n\n<pre><code>cfg := &amp;tls.Config{\n    CipherSuites: []uint16{\n        tls.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,\n        tls.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,\n    },\n    PreferServerCipherSuites: true,\n    InsecureSkipVerify:       true,\n    MinVersion:               tls.VersionTLS11,\n    MaxVersion:               tls.VersionTLS11,\n}\n</code></pre>\n"}], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9354, "favorite_count": 4, "accepted_answer_id": 41251633, "answer_count": 1, "score": 7, "last_activity_date": 1482277424, "creation_date": 1482265356, "last_edit_date": 1482277424, "question_id": 41250665, "link": "https://stackoverflow.com/questions/41250665/go-https-client-issue-remote-error-tls-handshake-failure", "title": "Go https client issue - remote error: tls: handshake failure", "body": "<p>I am hitting this error 'remote error: tls: handshake failure':</p>\n\n<pre><code>~/go/bin/aci-tls 10.0.0.201 user pass\n2016/12/20 18:12:04 post error: Post https://10.0.0.201/api/aaaLogin.json: remote error: tls: handshake failure\n</code></pre>\n\n<p>Code is basic HTTPS client: <a href=\"https://play.golang.org/p/cqPT0oR__q\" rel=\"noreferrer\">https://play.golang.org/p/cqPT0oR__q</a></p>\n\n<p>OpenSSL is happy with this https server:</p>\n\n<pre><code>$ openssl s_client -connect 10.0.0.201:443\n\n(snip)\nSSL handshake has read 1383 bytes and written 431 bytes\n---\nNew, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES256-GCM-SHA384\nServer public key is 2048 bit\nSecure Renegotiation IS supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : ECDHE-RSA-AES256-GCM-SHA384\n(snip)\n</code></pre>\n\n<p>Tested on:</p>\n\n<pre><code>$ go version\ngo version go1.7.4 linux/386\n\nC:\\&gt;go version\ngo version go1.7.4 windows/amd64\n</code></pre>\n\n<p>gotlsscan says:</p>\n\n<pre><code>lab@ubu:~$ go version\ngo version go1.8beta2 linux/386\nlab@ubu:~$ ~/go/bin/gotlsscan -host 10.0.0.201 | grep -v NOT\nTesting SSL30 (DISABLED)\nTesting TLS1.0\nTesting TLS1.1\nTesting TLS1.2\nlab@ubu:~$\nlab@ubu:~$ ~/go/bin/gotlsscan -insecure -host 10.0.0.201 | grep -v NOT\nTesting SSL30 (DISABLED)\nTesting TLS1.0\nTesting TLS1.1\n        TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA            [OK]\n        TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA            [OK]\nTesting TLS1.2\n</code></pre>\n\n<p>How can I further troubleshoot this issue?</p>\n"}, {"tags": ["go", "cassandra"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1482264270, "post_id": 41250225, "comment_id": 69701049, "body": "maybe something like this: <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">github.com/Jeffail/gabs</a>"}], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 1, "last_activity_date": 1482265838, "creation_date": 1482265838, "answer_id": 41250786, "question_id": 41250225, "link": "https://stackoverflow.com/questions/41250225/create-json-fro-cassandra-in-go/41250786#41250786", "title": "Create json fro Cassandra in go", "body": "<p>@Michael,</p>\n\n<p>You may want to use MapScan: <a href=\"https://godoc.org/github.com/gocql/gocql#Iter.MapScan\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/gocql/gocql#Iter.MapScan</a>\nThis is as abstract as it can get.\nFrom <a href=\"https://github.com/gocql/gocql/blob/master/cassandra_test.go\" rel=\"nofollow noreferrer\">https://github.com/gocql/gocql/blob/master/cassandra_test.go</a>:</p>\n\n<pre><code>...\ntestMap := make(map[string]interface{})\nif !session.Query(`SELECT * FROM slice_map_table`).Iter().MapScan(testMap) {\n        t.Fatal(\"MapScan failed to work with one row\")\n}\n...\n</code></pre>\n\n<p>And after that you'll need to reflect/explore map content, but that's a different topic.</p>\n"}], "owner": {"reputation": 43, "user_id": 7318353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/267488f21f6ac970c58ace9ae052d068?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/7318353/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 41250786, "answer_count": 1, "score": 0, "last_activity_date": 1482270707, "creation_date": 1482263514, "last_edit_date": 1482270707, "question_id": 41250225, "link": "https://stackoverflow.com/questions/41250225/create-json-fro-cassandra-in-go", "title": "Create json fro Cassandra in go", "body": "<p>I have a table in Cassandra defined as the following :</p>\n\n<pre><code>CREATE TABLE book.book \n(\n    title text PRIMARY KEY,\n    amount decimal,\n    available int,\n    createdon timestamp\n) \n</code></pre>\n\n<p>I am trying to select * from that table and return the values in json format. I am able to achieve that using </p>\n\n<pre><code>type Book struct {\n       Title       string       `json:\"title\"`\n       Amount      inf.Dec      `json:\"amount\"`\n       CreatedOn   time.Time    `json:\"createdon\"`\n       Available   int          `json:\"available\"`\n    }\n</code></pre>\n\n<p>with </p>\n\n<pre><code> func cassandraDisplay(query string, w http.ResponseWriter) {\n    cluster := gocql.NewCluster(\"xxxxxxxx:xxxx\")\n    session, _ := cluster.CreateSession()\n    defer session.Close()\n    iter := session.Query(\"SELECT * FROM book.book\").Iter()\n    var book Book\n    for iter.Scan(&amp;book.Title ,&amp;book.Amount ,&amp;book.CreatedOn,&amp;book.Available{\n           fmt.Println(book.Title , book.Amount,book.CreatedO,book.Available)\n           j, ERR:= json.Marshal(&amp;iter)\n           if ERR != nil {panic(ERR)}\n           //do things with j \n    }\n   if err := iter.Close(); err != nil {log.Fatal(err)}\n}\n</code></pre>\n\n<p>but the requirement require a dynamic and no hard coding any info; since it is http service and the query will be passed through the url. </p>\n\n<p>Any idea how to get this to work?</p>\n"}, {"tags": ["go", "slice", "race-condition", "channel"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6808610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/139553519cc6fa7d00f9164e7aef9b7b?s=128&d=identicon&r=PG&f=1", "display_name": "Ety", "link": "https://stackoverflow.com/users/6808610/ety"}, "edited": false, "score": 0, "creation_date": 1482299257, "post_id": 41250437, "comment_id": 69712210, "body": "Thank you Jim, it worked. By the way, may be you know why the stream was always divided into first byte + rest? It doesn&#39;t seem effective.."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 43, "user_id": 6808610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/139553519cc6fa7d00f9164e7aef9b7b?s=128&d=identicon&r=PG&f=1", "display_name": "Ety", "link": "https://stackoverflow.com/users/6808610/ety"}, "edited": false, "score": 0, "creation_date": 1482328878, "post_id": 41250437, "comment_id": 69729805, "body": "@Ety: TeeReader writes exactly what was read from the reader, so if a single byte was read from the <code>request.Body</code>, a single byte will be written to <code>writerToHash</code>. If small read write operations were going to be a problem (it doesn&#39;t matter in your case), you use bufio to batch them up into larger operations."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1482264342, "creation_date": 1482264342, "answer_id": 41250437, "question_id": 41250130, "link": "https://stackoverflow.com/questions/41250130/byte-channel-usage/41250437#41250437", "title": "byte[] channel usage", "body": "<p>From the <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code> documentation</a>:</p>\n\n<blockquote>\n  <p>Write must not modify the slice data, even temporarily. Implementations must not retain p</p>\n</blockquote>\n\n<p>You can't store or reuse the slice being passed to your Write method. If you want to use that data elsewhere, you need to make a copy of it</p>\n\n<pre><code>func (self *WriterToHash) Write(p []byte) (n int, err error) {\n    b := make([]byte, len(p))\n    copy(b, p)\n    fmt.println(\"WriterToHash  len=%d, buff=%v\", len(p), b)\n    self.BodyChannel &lt;- b\n    return len(p), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6808610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/139553519cc6fa7d00f9164e7aef9b7b?s=128&d=identicon&r=PG&f=1", "display_name": "Ety", "link": "https://stackoverflow.com/users/6808610/ety"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5847, "favorite_count": 0, "accepted_answer_id": 41250437, "answer_count": 1, "score": 2, "last_activity_date": 1577576260, "creation_date": 1482263165, "last_edit_date": 1577576260, "question_id": 41250130, "link": "https://stackoverflow.com/questions/41250130/byte-channel-usage", "title": "byte[] channel usage", "body": "<p>I am getting a REST command, and want to calculate hash function on it's body.\nTo do so I read the body using <code>io.TeeReader(request.Body, &amp;writerToHash)</code> where I pass my own class that implements io.Writer:</p>\n\n<pre><code>func (self *WriterToHash) Write(p []byte) (n int, err error) {\n    n=len(p)\n    fmt.println(\"WriterToHash  len=%v, buff=%v\", n, p)  //PRINT 1\n    self.BodyChannel &lt;- p\n    return n, nil\n}\n</code></pre>\n\n<p>The <code>BodyChannel</code> is defined: <code>BodyChannel chan []byte</code></p>\n\n<p>I use this class as follows:</p>\n\n<pre><code>    writerToHash := sisutils.WriterToHash{\n        BodyChannel:make(chan []byte, 1024)\n    }\n    writerToHash.StartListen()\n    reqnew, _ := http.NewRequest(\"PUT\", url, io.TeeReader(request.Body, &amp;writerToHash))\n</code></pre>\n\n<p>Listening part:</p>\n\n<pre><code>func (wth *WriterToHash) StartListen() {\n    wth.OutChannel = make(chan []byte, 1000)\n    go func (self *WriterToHash) {\n        done := int64(0)\n        h := sha1.New()\n        for done &lt; MessageSize{\n            buff := &lt;- self.BodyChannel\n\n            done += int64(len(buff))\n            DPrint(5, \"AccamulateSha1 Done=: %v, buff=%v\", done, buff)  //PRINT 2\n\n            actually_write, err := h.Write(buff)\n            if err != nil ||  actually_write != len(buff) {\n                log.Println(\"Error in sha write:\" + err.Error())\n                break\n            }\n        }\n        bs := h.Sum(nil)\n        self.OutChannel &lt;- bs\n    }(wth)\n }\n</code></pre>\n\n<p>I send messages of 1000 bytes. In debug mode the message is always split in the same way: 1 byte, 999 bytes - I see it using PRINT 1. In this case everythong works fine.\nThe problem is that when the message is split to more parts in the Write function. In this case I see in PRINT1:</p>\n\n<p>[first byte] : a</p>\n\n<p>[next ~450 bytes] : b,c,d,...</p>\n\n<p>[last ~550 bytes] : w,x,y,...</p>\n\n<p>but in PRINT 2 I see different picture:</p>\n\n<p>[first byte] : a</p>\n\n<p>[ ~450 bytes but starting where last part starts] : w,x,y...</p>\n\n<p>[last ~550 bytes] : w,x,y,...</p>\n\n<p>I actually get the last past twice but not in the same size.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1791, "user_id": 363243, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5527ddcd6dfc9e1df739c2aa0c8daa20?s=128&d=identicon&r=PG", "display_name": "dingalingchickenwiing", "link": "https://stackoverflow.com/users/363243/dingalingchickenwiing"}, "edited": false, "score": 0, "creation_date": 1482271941, "post_id": 41249729, "comment_id": 69704762, "body": "I tried to add this to my example app, but I&#39;m not sure where certain components go (such as the struct.)  Would you mind posting the file name for each section so I can see how to reproduce this?  I&#39;m very new to Go!"}, {"owner": {"reputation": 1791, "user_id": 363243, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5527ddcd6dfc9e1df739c2aa0c8daa20?s=128&d=identicon&r=PG", "display_name": "dingalingchickenwiing", "link": "https://stackoverflow.com/users/363243/dingalingchickenwiing"}, "edited": false, "score": 0, "creation_date": 1482272447, "post_id": 41249729, "comment_id": 69704951, "body": "Thank you very much for the revision - I see how this works now!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1482272455, "last_edit_date": 1482272455, "creation_date": 1482261630, "answer_id": 41249729, "question_id": 41249519, "link": "https://stackoverflow.com/questions/41249519/passing-values-to-html-template-outside-of-handler/41249729#41249729", "title": "Passing values to html/template outside of handler", "body": "<p>It is not possible for the template to access the admin/system struct without the application passing the value to the template. A convenient way to to pass the value is through an anonymous field in each view type. Here's an example:</p>\n\n<p>Assuming that <code>AdminStuff</code> is the struct containing your admin and system data and <code>getAdminSystemStuff(*http.Request)</code> is a function that gets a pointer to the struct from a request, define the view data like this:</p>\n\n<pre><code>func myHandler(w http.Response, r *http.Request) {\n  var data = struct {\n    *AdminSystemStuff\n    AFieldSpecificToThisView string\n    AnotherViewField string\n  }{\n    getAdminSystemStuff(r),\n    \"hello\",\n    \"world\"\n  }\n  err := t.Execute(w, &amp;data)  // t is the compiled template.\n  if err != nil {\n     // handle error\n  }\n}\n</code></pre>\n\n<p>You can use this in a template like this:</p>\n\n<pre><code>&lt;html&gt;\n&lt;body&gt;\nHere are some fields: {{.AFieldSpecificToThisView}} {{.AnotherViewField}}\n{{if .IsAuthenticated}}The user is authenticated{{end}}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 1791, "user_id": 363243, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5527ddcd6dfc9e1df739c2aa0c8daa20?s=128&d=identicon&r=PG", "display_name": "dingalingchickenwiing", "link": "https://stackoverflow.com/users/363243/dingalingchickenwiing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 41249729, "answer_count": 1, "score": 1, "last_activity_date": 1482272455, "creation_date": 1482260794, "question_id": 41249519, "link": "https://stackoverflow.com/questions/41249519/passing-values-to-html-template-outside-of-handler", "title": "Passing values to html/template outside of handler", "body": "<p>I would like to pass a struct which contains all of my admin/system values to my view, which is parsed using html/template in Go.  For example, I would like to give .IsAuthenticated and .IsAdmin to my view by default, without explicitly passing it through the handler.</p>\n\n<p>Is it possible to make these values always available by default, without passing through a handler?  I would like to pass form values and other user generated content through the handler.</p>\n"}, {"tags": ["security", "go", "setuid"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1482258172, "post_id": 41248866, "comment_id": 69697799, "body": "The preferred method is to use linux capabilities to only allow your program to bind to the correct port without having full root capabilities."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1482258523, "post_id": 41248866, "comment_id": 69697987, "body": "That issue you link to actually has a number of possible workarounds/solutions IIRC."}, {"owner": {"reputation": 1034, "user_id": 2089648, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b29d87d89de9c1abac217464e57b191?s=128&d=identicon&r=PG", "display_name": "user2089648", "link": "https://stackoverflow.com/users/2089648/user2089648"}, "edited": false, "score": 0, "creation_date": 1482258786, "post_id": 41248866, "comment_id": 69698141, "body": "Setuid did not work as expected for golang. Those workarounds were to make it&#39;s behaviour more consistent. However in the end they did not guarantee success, meaning you could still end up being root after a call to setuid. That&#39;s why the decision was made to disable the function altogether. About the linux-capabilities: What exactly would you suggest here?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1482259694, "post_id": 41248866, "comment_id": 69698610, "body": "@user2089648: What do you mean regarding capabilities? The idea is that you shouldn&#39;t rely on setuid at all (regardless of it being a Go program), and you should set CAP_NET_BIND_SERVICE for the application using <code>setcap</code>."}, {"owner": {"reputation": 91, "user_id": 5739452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cacdf39dca26d5f1e7e13f96e76ba59?s=128&d=identicon&r=PG&f=1", "display_name": "Tinkerer", "link": "https://stackoverflow.com/users/5739452/tinkerer"}, "edited": false, "score": 0, "creation_date": 1618842084, "post_id": 41248866, "comment_id": 118718047, "body": "There is a fully worked example of successfully doing this in go in the <a href=\"https://git.kernel.org/pub/scm/libs/libcap/libcap.git/tree/goapps/web\" rel=\"nofollow noreferrer\">libcap tree</a>."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1482301847, "creation_date": 1482301847, "answer_id": 41256482, "question_id": 41248866, "link": "https://stackoverflow.com/questions/41248866/golang-dropping-privileges-v1-7/41256482#41256482", "title": "Golang dropping privileges (v1.7)", "body": "<p>I'd do what @JimB suggested.</p>\n\n<p>On the other hand, on Linux there's another trick: you can use <code>os/exec.Command()</code> to execute <code>/proc/self/exe</code> while telling it to use alternative credentials in the <code>SysProcAttr.Credential</code> field of the <code>os/exec.Cmd</code> instance it generates.</p>\n\n<p>See <code>go doc os/exec.Cmd</code>, <code>go doc syscall.SysProcAttr</code> and <code>go doc syscall.Credential</code>.</p>\n\n<p>Make sure that when you make your program re-execute itself, you need to make sure the spawned one has its standard I/O streams connected to those of its parent, and all the necessary opened files are inherited as well.</p>\n\n<hr>\n\n<p>Another alternatve worth mentioning is to not attempt to bind to port 80 at all and have a proper web server hanging there, and then reverse-proxy either a hostname-based virtual host or a particular URL path prefix (or prefixes) to your Go process listening on any TCP or Unix socket.  Both Apache (2.4 at least) and Nginx can do that easily.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 8803296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zyg8T.jpg?s=128&g=1", "display_name": "Jon Jenkins", "link": "https://stackoverflow.com/users/8803296/jon-jenkins"}, "is_accepted": false, "score": 3, "last_activity_date": 1519658763, "creation_date": 1519658763, "answer_id": 48991783, "question_id": 41248866, "link": "https://stackoverflow.com/questions/41248866/golang-dropping-privileges-v1-7/48991783#48991783", "title": "Golang dropping privileges (v1.7)", "body": "<p>I recently worked through this problem, and Go has all of the pieces you need. In this sample, I went one step further and implemented SSL. Essentially, you open the port, detect the UID, and if it's 0, look for the desired user, get the UID, and then use glibc calls to set the UID and GID of the process. I might emphasize that it's best to call your setuid code right after binding the port. The biggest difference when dropping privileges is that you can't use the http.ListenAndServe(TLS)? helper function - you have to manually set up your net.Listener separately, and then call setuid after the port is bound, but before calling http.Serve.</p>\n\n<p>This way of doing it works well because you can, for example, run as UID != 0 in \"development\" mode on a high port without further considerations. Remember that this is just a stub - I recommend setting address, port, user, group, and TLS file names in a config file.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"log\"\n    \"net/http\"\n    \"os/user\"\n    \"strconv\"\n    \"syscall\"\n)\n\nimport (\n    //#include &lt;unistd.h&gt;\n    //#include &lt;errno.h&gt;\n    \"C\"\n)\n\nfunc main() {\n    cert, err := tls.LoadX509KeyPair(\"cert.pem\", \"key.pem\")\n    if err != nil {\n        log.Fatalln(\"Can't load certificates!\", err)\n    }\n    var tlsconf tls.Config\n    tlsconf.Certificates = make([]tls.Certificate, 1)\n    tlsconf.Certificates[0] = cert\n    listener, err := tls.Listen(\"tcp4\", \"127.0.0.1:445\", &amp;tlsconf)\n    if err != nil {\n        log.Fatalln(\"Error opening port:\", err)\n    }\n    if syscall.Getuid() == 0 {\n        log.Println(\"Running as root, downgrading to user www-data\")\n        user, err := user.Lookup(\"www-data\")\n        if err != nil {\n            log.Fatalln(\"User not found or other error:\", err)\n        }\n        // TODO: Write error handling for int from string parsing\n        uid, _ := strconv.ParseInt(user.Uid, 10, 32)\n        gid, _ := strconv.ParseInt(user.Gid, 10, 32)\n        cerr, errno := C.setgid(C.__gid_t(gid))\n        if cerr != 0 {\n            log.Fatalln(\"Unable to set GID due to error:\", errno)\n        }\n        cerr, errno = C.setuid(C.__uid_t(uid))\n        if cerr != 0 {\n            log.Fatalln(\"Unable to set UID due to error:\", errno)\n        }\n    }\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        w.Write([]byte(\"Hello, world!\"))\n    })\n    err = http.Serve(listener, nil)\n    log.Fatalln(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1034, "user_id": 2089648, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b29d87d89de9c1abac217464e57b191?s=128&d=identicon&r=PG", "display_name": "user2089648", "link": "https://stackoverflow.com/users/2089648/user2089648"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3702, "favorite_count": 2, "accepted_answer_id": 41256482, "answer_count": 2, "score": 4, "last_activity_date": 1519658763, "creation_date": 1482258040, "last_edit_date": 1482258407, "question_id": 41248866, "link": "https://stackoverflow.com/questions/41248866/golang-dropping-privileges-v1-7", "title": "Golang dropping privileges (v1.7)", "body": "<p>I want to make a custom webserver via golang.\nIt needs root to bind to port 80.\nHowever I want to drop root as soon as possible.\n    <code>syscall.SetUid()</code> returns \"Not supported\" as per <a href=\"https://github.com/golang/go/issues/1435\" rel=\"nofollow noreferrer\">ticket #1435</a>.</p>\n\n<p>I could always reroute port 80 to something else via iptables, however this opens up any non-root process to pose as my webserver - which I'd prefer not to be possible.</p>\n\n<p>How do I drop privileges for my application (or alternatively solve this cleanly).</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482255123, "post_id": 41247206, "comment_id": 69696219, "body": "The glog output (if you&#39;re referring to <a href=\"https://godoc.org/github.com/golang/glog\" rel=\"nofollow noreferrer\"><code>github.com&#47;golang&#47;glog</code></a>) is configurable. Could you output to files rather than stderr?"}, {"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "edited": false, "score": 1, "creation_date": 1482266217, "post_id": 41247206, "comment_id": 69702052, "body": "you could capture stderr in test like stdout is captured in this <a href=\"http://stackoverflow.com/a/10476304/1024794\">answer</a>"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482486433, "post_id": 41247206, "comment_id": 69800237, "body": "@JimB that would work. But, but it would be difficult to test what has been output by each call of my wrapper methods."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "edited": false, "score": 0, "creation_date": 1482486633, "post_id": 41247206, "comment_id": 69800349, "body": "The suggestion of @Maxim Yefremov is what I was looking for. It&#39;s looking great. Please write an answer so I can assign you the asnswer."}], "answers": [{"comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 1, "creation_date": 1482486132, "post_id": 41248359, "comment_id": 69800097, "body": "I already did that. This will allow to test use of my wrapper. Perfect suggestion. The question is how to test the wrapper itself."}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 0, "last_activity_date": 1482256108, "creation_date": 1482256108, "answer_id": 41248359, "question_id": 41247206, "link": "https://stackoverflow.com/questions/41247206/how-to-test-code-using-the-go-logging-package-glog/41248359#41248359", "title": "How to test code using the Go logging package glog ?", "body": "<p>Write an interface that describes your usage. This won't be very pretty if you use the <code>V</code> method, but you have a wrapper so you've already done the hard work that fixing that would entail.</p>\n\n<p>For each package you need to test, define</p>\n\n<pre><code>type Logger interface {\n    Infoln(...interface{}) // the methods you actually use in this package\n}\n</code></pre>\n\n<p>And then you can easily swap it out by not referring to glog types directly in your code.</p>\n"}, {"tags": [], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "is_accepted": true, "score": 3, "last_activity_date": 1482552578, "creation_date": 1482552578, "answer_id": 41310246, "question_id": 41247206, "link": "https://stackoverflow.com/questions/41247206/how-to-test-code-using-the-go-logging-package-glog/41310246#41310246", "title": "How to test code using the Go logging package glog ?", "body": "<p>Test which captures stderr:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"os\"\n    \"testing\"\n\n    \"github.com/golang/glog\"\n    \"strings\"\n)\n\nfunc captureStderr(f func()) (string, error) {\n    old := os.Stderr // keep backup of the real stderr\n    r, w, err := os.Pipe()\n    if err != nil {\n        return \"\", err\n    }\n    os.Stderr = w\n\n    outC := make(chan string)\n    // copy the output in a separate goroutine so printing can't block indefinitely\n    go func() {\n        var buf bytes.Buffer\n        io.Copy(&amp;buf, r)\n        outC &lt;- buf.String()\n    }()\n\n    // calling function which stderr we are going to capture:\n    f()\n\n    // back to normal state\n    w.Close()\n    os.Stderr = old // restoring the real stderr\n    return &lt;-outC, nil\n}\n\nfunc TestGlogError(t *testing.T) {\n    stdErr, err := captureStderr(func() {\n        glog.Error(\"Test error\")\n    })\n    if err != nil {\n        t.Errorf(\"should not be error, instead: %+v\", err)\n    }\n    if !strings.HasSuffix(strings.TrimSpace(stdErr), \"Test error\") {\n        t.Errorf(\"stderr should end by 'Test error' but it doesn't: %s\", stdErr)\n    }\n}\n</code></pre>\n\n<p>running test:</p>\n\n<pre><code>go test -v\n=== RUN   TestGlogError\n--- PASS: TestGlogError (0.00s)\nPASS\nok      command-line-arguments  0.007s\n</code></pre>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 0, "accepted_answer_id": 41310246, "answer_count": 2, "score": 1, "last_activity_date": 1482552578, "creation_date": 1482252084, "question_id": 41247206, "link": "https://stackoverflow.com/questions/41247206/how-to-test-code-using-the-go-logging-package-glog", "title": "How to test code using the Go logging package glog ?", "body": "<p>I have implemented a type wrapping glog so that I can add a prefix to log message identifying the emitter of the log in my program and I can change the log level per emitter.</p>\n\n<p>How could I implement the unit tests ? The problem is that glog outputs text to stdErr. </p>\n\n<p>The code is trivial but I would like the have the unit test and 100% coverage like the rest of the code. This programming effort already payed.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 762, "user_id": 766584, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Itlls.png?s=128&g=1", "display_name": "djneely", "link": "https://stackoverflow.com/users/766584/djneely"}, "edited": false, "score": 0, "creation_date": 1486480906, "post_id": 41245998, "comment_id": 71357363, "body": "Have you made any progress with this? I&#39;m currently running into the same issue."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "reply_to_user": {"reputation": 762, "user_id": 766584, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Itlls.png?s=128&g=1", "display_name": "djneely", "link": "https://stackoverflow.com/users/766584/djneely"}, "edited": false, "score": 0, "creation_date": 1486485644, "post_id": 41245998, "comment_id": 71360923, "body": "No progress, I switched back to using the appengine datastore packages."}, {"owner": {"reputation": 762, "user_id": 766584, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Itlls.png?s=128&g=1", "display_name": "djneely", "link": "https://stackoverflow.com/users/766584/djneely"}, "edited": false, "score": 1, "creation_date": 1486663219, "post_id": 41245998, "comment_id": 71453656, "body": "Thanks. I wound up just removing all of my packages from /src and any others that had been built and re-fetched them and seemed to resolve my issue."}], "owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1482248171, "creation_date": 1482248171, "question_id": 41245998, "link": "https://stackoverflow.com/questions/41245998/broken-dependency-in-golang-cloud-packages", "title": "Broken dependency in Golang Cloud packages", "body": "<p>I'm attempting to import \"cloud.google.com/go/datastore\" into my package but am recieveing the following error:</p>\n\n<pre><code># github.com/AndyNortrup/baby-namer/vendor/google.golang.org/genproto/googleapis/api/annotations\n\n../vendor/google.golang.org/genproto/googleapis/api/annotations/annotations.pb.go:41: unknown \"github.com/AndyNortrup/baby-namer/vendor/github.com/golang/protobuf/proto\".ExtensionDesc field 'Filename' in struct literal\n</code></pre>\n\n<p>The file <code>annotations.pb.go</code> has: </p>\n\n<pre><code>var E_Http = &amp;proto.ExtensionDesc{\n    ExtendedType:  (*google_protobuf.MethodOptions)(nil),\n    ExtensionType: (*HttpRule)(nil),\n    Field:         72295728,\n    Name:          \"google.api.http\",\n    Tag:           \"bytes,72295728,opt,name=http\",\n    Filename:      \"google/api/annotations.proto\",\n}\n</code></pre>\n\n<p>The file <code>/vendor/github.com/golang/protobuf/proto/extensions.go</code> doesn't include Filename:</p>\n\n<pre><code>// ExtensionDesc represents an extension specification.\n// Used in generated code from the protocol compiler.\ntype ExtensionDesc struct {\n    ExtendedType  Message     // nil pointer to the type that is being extended\n    ExtensionType interface{} // nil pointer to the extension type\n    Field         int32       // field number\n    Name          string      // fully-qualified name of extension, for text formatting\n    Tag           string      // protobuf tag style\n}\n</code></pre>\n\n<p>I've pulled in all of the dependencies with govendor so I'm inclined to say that everything I have is everything I need.  But I can see in the file <a href=\"https://github.com/golang/protobuf/blob/master/proto/extensions.go\" rel=\"nofollow noreferrer\">here</a>, that there are versions with the Filename attribute, so it appears I could substitue one for the other, but I'm not sure how to go about that.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["go", "struct", "interface"], "answers": [{"tags": [], "owner": {"reputation": 11272, "user_id": 4954970, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cd55f03cb2048a05411472dd6ac1eab8?s=128&d=identicon&r=PG&f=1", "display_name": "kpimov", "link": "https://stackoverflow.com/users/4954970/kpimov"}, "is_accepted": false, "score": 0, "last_activity_date": 1482254812, "last_edit_date": 1482254812, "creation_date": 1482249410, "answer_id": 41246373, "question_id": 41245811, "link": "https://stackoverflow.com/questions/41245811/implementing-sets-of-structs-within-a-map-of-structs/41246373#41246373", "title": "Implementing sets of structs within a map of structs", "body": "<p>Never mind, answer ended up being simple:</p>\n\n<pre><code>struct Channel {\n    sync.Mutex\n    sockets     map[SocketID]Socket\n    subchannels map[SocketID]SubchannelID\n}\n\nfunc (c Channel) Remove(sid SocketID) {\n    c.Lock()\n    defer c.Unlock()\n\n    if _, ok := c.sockets[sid]; ok {\n        delete(c.sockets, sid)\n    }\n    if _, ok := c.subchannels[sid]; ok {\n        delete(c.subchannels, sid)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11272, "user_id": 4954970, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cd55f03cb2048a05411472dd6ac1eab8?s=128&d=identicon&r=PG&f=1", "display_name": "kpimov", "link": "https://stackoverflow.com/users/4954970/kpimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1482254812, "creation_date": 1482247622, "question_id": 41245811, "link": "https://stackoverflow.com/questions/41245811/implementing-sets-of-structs-within-a-map-of-structs", "title": "Implementing sets of structs within a map of structs", "body": "<p>I have a map of structs as follows:</p>\n\n<pre><code>type SocketID string\ntype Socket struct {\n    socket //...\n    id     string\n}\n\ntype Channel struct {\n    sync.Mutex\n    sockets map[SocketID]Socket\n}\n</code></pre>\n\n<p>I want to be able to add subchannels to it, where each <code>Socket</code> belongs to one subchannel. I tried changing the channel struct to this:</p>\n\n<pre><code>type SubchannelID string\ntype Channel struct {\n    sync.Mutex\n    sockets     map[SocketID]Socket\n    subchannels map[SubchannelID]map[SocketID]Socket\n}\n</code></pre>\n\n<p>But the problem I have with this is removing a <code>Socket</code> from the <code>Channel</code> becomes an O(n^2) operation, and each socket is duplicated between the <code>sockets</code> and <code>subchannels</code> maps. How would I optimize this while keeping the channels and subchannels abstracted away from the sockets?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1482245336, "post_id": 41244629, "comment_id": 69689825, "body": "you missed <code>map</code> here: <code>MDevs: []string*DDescr {</code>"}, {"owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1482264372, "post_id": 41244629, "comment_id": 69701110, "body": "yes, I have several mistakes - incorrect usage map notation (it should looks like this  MDevs: map[string]*DDescr  instead of  MDevs: []string*DDescr  and also missing data for the key-value syntax."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "edited": false, "score": 0, "creation_date": 1482264192, "post_id": 41246140, "comment_id": 69701004, "body": "Thanks a lot! Your example was very helpful. It solved my problem."}], "tags": [], "owner": {"reputation": 905, "user_id": 3781709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4fa60c6b287ee4f006d6c4e320daf5?s=128&d=identicon&r=PG", "display_name": "Pradip Patil", "link": "https://stackoverflow.com/users/3781709/pradip-patil"}, "is_accepted": true, "score": 1, "last_activity_date": 1482248625, "last_edit_date": 1592644375, "creation_date": 1482248625, "answer_id": 41246140, "question_id": 41244629, "link": "https://stackoverflow.com/questions/41244629/how-initialize-nested-complex-structure/41246140#41246140", "title": "How initialize nested complex structure", "body": "<p>There are couple of syntax errors in code you provided, not sure if it's because you tried to give shorter version to give an example.</p>\n<p>Also, you are missing to initialize <code>key</code> for nested maps.</p>\n<blockquote>\n<p>Example : <code>MDevs: map[string]*DDescr</code></p>\n<p>So <code>MDevs</code> is <code>map</code> with\n<code>string</code> keys and <code>*DDescr</code> values, which can be initialized like</p>\n<pre><code>MDevs: map[string]*DDescr{\n              &quot;first&quot;: &amp;DDescr{ `fields from this struct` }\n}\n</code></pre>\n</blockquote>\n<p>I tried to re-produce your example here, which is working fine: <a href=\"https://play.golang.org/p/Zn8u0f92Xn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Zn8u0f92Xn</a></p>\n"}], "owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 41246140, "answer_count": 1, "score": 1, "last_activity_date": 1482248625, "creation_date": 1482244134, "question_id": 41244629, "link": "https://stackoverflow.com/questions/41244629/how-initialize-nested-complex-structure", "title": "How initialize nested complex structure", "body": "<p>I have following nested structures:</p>\n\n<pre><code>type PDescr struct {\n    Name      string \n    Dir       int32  \n}\n\n\ntype DDescr struct {\n    MPins map[string]*PDescr \n\n\ntype P_DB struct {\n    MId   int32                   \n    MDevs map[string]*DDescr \n}\n\ntype S_DB struct {\n    TId int32 \n}\n\ntype Main_DB struct {\n    FId int32 \n    Path string \n    PDb *P_DB \n    SDb *S_DB \n}\n</code></pre>\n\n<p>My main structure is Main_DB.</p>\n\n<p>In Go I started generate structure initialization and can't understand how to do this:</p>\n\n<p>My latest version of sach initialization is the following which is not compiled:</p>\n\n<pre><code>book=&amp;pb.Main_DB{\nFId: 666,\nPath: \"my_path\",\nPDb: &amp;pb.P_DB{\n        MId: 5,\n        MDevs: []string*DDescr {\n              MPins: map[string]*PDescr {\n                  Name: \"aa\",\n                  Dir: 7,\n                  },\n                  },\n\n                },\nSDb: &amp;pb.S_DB{\n            TId: 777,\n          },\n}\n</code></pre>\n\n<p>I'm stuck with <code>MDevs map[string]*DDescr</code> initialization. I don't know how correct propogate values.</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1482244289, "post_id": 41244172, "comment_id": 69689097, "body": "Thanks for the note  but IdCookie is not _id"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1482244478, "post_id": 41244172, "comment_id": 69689205, "body": "@user462794 Please see edited answer. If you use <code>FindId()</code>, you only have to pass the id value (and not wrapped in a <code>bson.M</code>). Or use <code>Find()</code> and then you can pass id wrapped in <code>bson.M</code>."}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1482245015, "post_id": 41244172, "comment_id": 69689578, "body": "I still have 0 :   INFO: 2016/12/20 15:42:08 Cookie_Id.go:147: 1 INFO: 2016/12/20 15:42:08 Cookie_Id.go:149: 2 INFO: 2016/12/20 15:42:18 Cookie_Id.go:87: data INFO: 2016/12/20 15:42:18 Cookie_Id.go:88: {0} INFO: 2016/12/20 15:42:18 Cookie_Id.go:89: 0 INFO: 2016/12/20 15:42:18 Cookie_Id.go:118: 0 INFO: 2016/12/20 15:42:18 Cookie_Id.go:128: OK"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1482245676, "post_id": 41244172, "comment_id": 69690071, "body": "@user462794 The code I posted works (verified). There must be something else you&#39;ve not showed us and is different."}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1482246050, "post_id": 41244172, "comment_id": 69690369, "body": "it was the :   IdCookie int <code>bson:&quot;IdCookie&quot;</code> thanks a lot"}, {"owner": {"reputation": 293, "user_id": 4238871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8501da9d1ac8e3b50519bf42399385b2?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/4238871/mike"}, "edited": false, "score": 0, "creation_date": 1515536116, "post_id": 41244172, "comment_id": 83334989, "body": "it does not work I am guessing something is wrong with the insert, I cannot select it via _id"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1482244383, "last_edit_date": 1495540510, "creation_date": 1482242658, "answer_id": 41244172, "question_id": 41244024, "link": "https://stackoverflow.com/questions/41244024/find-by-id-with-mgo/41244172#41244172", "title": "Find by id with mgo", "body": "<p>You either use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.FindId\" rel=\"noreferrer\"><code>Collection.FindId()</code></a> and then you pass only the id value, or you use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Find\" rel=\"noreferrer\"><code>Collection.Find()</code></a> and then you have to specify a value with the field name too:</p>\n\n<pre><code>err2 := c.FindId(bson.ObjectIdHex(\"58593d1d6aace357b32bb3a1\")).One(&amp;data)\n\n// OR\nerr2 := c.Find(bson.M{\"_id\": bson.ObjectIdHex(\"58593d1d6aace357b32bb3a1\")}).\n    One(&amp;data)\n</code></pre>\n\n<p>If you get no errors, that means the document is found.</p>\n\n<p>If you always see <code>0</code> printed (as the value of the <code>id_cookie.IdCookie</code> field), that means the field in the document holding this id has a different name.</p>\n\n<p>Use <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">struct tags</a> to tell how it is stored in your MongoDB. E.g. if in your MongoDB it is called <code>\"myid\"</code>, you can map it like this:</p>\n\n<pre><code>type id_cookie struct {\n    IdCookie int `bson:\"myid\"`\n}\n</code></pre>\n\n<p>Also note that you should not connect to the MongoDB server every time you want to query some data, instead connect once, and just reuse the session. for details see: <a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a></p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10660, "favorite_count": 2, "accepted_answer_id": 41244172, "answer_count": 1, "score": 11, "last_activity_date": 1482245115, "creation_date": 1482242163, "last_edit_date": 1482245115, "question_id": 41244024, "link": "https://stackoverflow.com/questions/41244024/find-by-id-with-mgo", "title": "Find by id with mgo", "body": "<p>I would like to find a data by <code>_id</code>. I know that this data exists and that this <code>_id</code> exist (I've tested it with pymongo).</p>\n\n<p>But the code below doesn't find it:</p>\n\n<pre><code>type id_cookie struct {\n    IdCookie int\n}\n\nfunc get_id_mongo() int {\n    session, err := mgo.Dial(\"127.0.0.1\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n\n    // Optional. Switch the session to a monotonic behavior.\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(\"id_bag\").C(\"id_cookie\")\n    data := id_cookie{}\n    err2 := c.FindId(bson.M{\"_id\": bson.ObjectIdHex(\"58593d1d6aace357b32bb3a1\")}).One(&amp;data)\n    if (err2 != nil){\n        Info.Println(\"error\")\n        Info.Println(err2)\n    }\n    Info.Println(data)\n    return data.IdCookie\n}\n</code></pre>\n\n<p>It just returns me a <code>0</code>.</p>\n\n<p>But I can find it using pytmongo and python.</p>\n\n<pre><code>import requests\nimport pymongo \nfrom pymongo import MongoClient\nfrom bson.objectid import ObjectId\nfrom pprint import pprint\nclient = MongoClient('127.0.0.1', 27017)\n\nimport base64\n\n\n\ndb = client.id_bag\npprint(db.collection_names())\nresult = db.id_cookie.insert_one(\n    { 'IdCookie': 1\n    })\nprint(result.inserted_id)\n\ndata = db.id_cookie.find_one({\"_id\": ObjectId(\"58593d1d6aace357b32bb3a1\")})\nprint(data)\n</code></pre>\n\n<p>here are the result :</p>\n\n<pre><code>['id_cookie', 'system.indexes']\n58593d2d6aace357b32bb3a3\n{'IdCookie': 1, '_id': ObjectId('58593d1d6aace357b32bb3a1')}\n</code></pre>\n\n<p>Does anyone have any idea?</p>\n\n<p>Edit :\ni've try with :</p>\n\n<pre><code>err2 := c.FindId(bson.ObjectIdHex(\"58593d1d6aace357b32bb3a1\")).One(&amp;data)\n</code></pre>\n\n<p>but i still have 0 :</p>\n\n<pre><code>INFO: 2016/12/20 15:42:08 Cookie_Id.go:147: 1\nINFO: 2016/12/20 15:42:08 Cookie_Id.go:149: 2\nINFO: 2016/12/20 15:42:18 Cookie_Id.go:87: data\nINFO: 2016/12/20 15:42:18 Cookie_Id.go:88: {0}\nINFO: 2016/12/20 15:42:18 Cookie_Id.go:89: 0\nINFO: 2016/12/20 15:42:18 Cookie_Id.go:118: 0\nINFO: 2016/12/20 15:42:18 Cookie_Id.go:128: OK\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 0, "creation_date": 1482295465, "post_id": 41243206, "comment_id": 69710951, "body": "You should always run your code through <code>go fmt</code> before posting it here, since that increases your chances of getting answers."}], "answers": [{"comments": [{"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482323396, "post_id": 41253482, "comment_id": 69726183, "body": "beside documentation, do u have any good link where I can learn more about routines and channels ? I covered the docs but it&#39;s not enough for me to get this to work, since here I&#39;m dealing with 2 different not official libraries."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482337642, "post_id": 41253482, "comment_id": 69735815, "body": "<a href=\"https://divan.github.io/posts/go_concurrency_visualize/\" rel=\"nofollow noreferrer\">link</a>, <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">link</a> and this <a href=\"https://github.com/golang/go/wiki/CommonMistakes\" rel=\"nofollow noreferrer\">link</a> hit everybody playing with concurrency. All together with docs. Golang is really well documented. Also code of others can inspire alot."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482338396, "post_id": 41253482, "comment_id": 69736265, "body": "Atm look at channels. Why to close them, when to use blocking channel and when buffered one. It also introduces you how to stop your taillog."}], "tags": [], "owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "is_accepted": false, "score": 0, "last_activity_date": 1482281080, "creation_date": 1482281080, "answer_id": 41253482, "question_id": 41243206, "link": "https://stackoverflow.com/questions/41243206/interrupt-current-tail-and-start-new-one/41253482#41253482", "title": "Interrupt current tail and start new one", "body": "<p>Consider this:</p>\n\n<blockquote>\n  <p>When the function main returns, the program exits. It does not wait\n  for other (non-main) goroutines to complete.</p>\n</blockquote>\n\n<p>And look at this block of your code:</p>\n\n<pre><code>func main() {\n    newFileName = \"mylog_0000.log.txt\"\n\n    fmt.Println(\"Processing log: \",newFileName)\n\n    newFilenameChan, err := newFileCheck()\n    if err != nil {\n        fmt.Println(\"ERR: \",err)\n    }\n\n    t := tailLog(newFileName)\n\n    go func() {\n        for {\n            select {\n                case name := &lt;-newFilenameChan:\n                    fmt.Println(\"New file created: \",name) //this will be printed only once and then on new events nothing is printed ?\n\n                //NONE of the lines abowe doesn't work\n                t.Stop()\n                t.Dead()\n                t.Done()\n\n                t = tailLog(name)\n            }\n        }\n    }()\n}\n</code></pre>\n\n<p>To handle this job with grace, you should learn more about concurrency in Golang. Use channels to control goroutines like stopping/starting/etc and WaitGroup if you are interested in order of executing/finishing tasks. When there is no control over your program flow, goroutines can lives their own lives and that is bad practice.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7167150, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqiqq7KN49U/AAAAAAAAAAI/AAAAAAAACm0/yidtwq5V4IQ/photo.jpg?sz=128", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/7167150/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b0%d0%bd%d0%b4%d1%80%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1571214590, "creation_date": 1571214590, "answer_id": 58408960, "question_id": 41243206, "link": "https://stackoverflow.com/questions/41243206/interrupt-current-tail-and-start-new-one/58408960#58408960", "title": "Interrupt current tail and start new one", "body": "<p>If you about this package <a href=\"https://github.com/hpcloud/tail\" rel=\"nofollow noreferrer\">https://github.com/hpcloud/tail</a></p>\n\n<p>You need to create one goroutine after you are open file, then you need to check a new file.</p>\n\n<p>I make it for checking a new logfile of SoftetherVPN-Server:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/hpcloud/tail\"\n    \"log\"\n    \"time\"\n)\n\nfunc CheckFileName(filename string, f chan&lt;- string) {\n    for {\n        newFilename := fmt.Sprintf(\"%v\", time.Now().Format(\"vpn_20060102.log\"))\n\n        // We have a new filename, that send it into channel\n        if newFilename != filename {\n            log.Println(\"A new logfile\", newFilename)\n            f &lt;- newFilename\n            return\n        }\n    }\n}\n\nfunc main() {\n\n    filenameChan := make(chan string)\n\n    for {\n        filename = fmt.Sprintf(\"%v\", time.Now().Format(\"vpn_20060102.log\"))\n\n        t, err := tail.TailFile(filename, tail.Config{Follow: true, ReOpen: true, MustExist: true})\n        if err != nil {\n            log.Println(\"No log file\", filename, \". Waiting for 10 minute\")\n            time.Sleep(time.Minute * 10)\n            continue\n        }\n\n        // Send goroutine for checking filename in loop\n        go CheckFileName(filename, filenameChan)\n\n        // Send goroutine that stops lines read in range\n        go func() {\n            for {\n                select {\n                case name := &lt;-filenameChan:\n                    log.Println(\"Received a new name for log:\", name)\n                    t.Stop()\n                    return\n                }\n            }\n        }()\n\n        if err != nil {\n            log.Fatalln(err)\n        }\n        for line := range t.Lines {\n            fmt.Println(line)\n        }\n    }\n}\n\n</code></pre>\n\n<p>So, that works for me</p>\n"}], "owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 428, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1571214590, "creation_date": 1482239574, "last_edit_date": 1482244050, "question_id": 41243206, "link": "https://stackoverflow.com/questions/41243206/interrupt-current-tail-and-start-new-one", "title": "Interrupt current tail and start new one", "body": "<p>So I am creating some log analyzer in golang and what I need is real-time tail -f of newly created files.</p>\n\n<p>I am using tail package together with fsnotify package but I'm not very familiar with channels and routines in go so I need some assistance.</p>\n\n<p>Currently program looks like this:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"github.com/hpcloud/tail\"\n    \"strings\"\n    \"log\"\n    \"net/smtp\"\n    \"time\"\n    \"github.com/fsnotify/fsnotify\"\n)\n\n//this function needs to monitor for new files in directory\nfunc newFileCheck() (newFilename chan string, err error) {\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        return\n    }\n\n    err = watcher.Add(\"myDir\")\n    if err != nil {\n        return\n    }\n\n    newFilename = make(chan string)\n\n    // Process events\n    go func() {\n        for {\n            select {\n            case ev := &lt;-watcher.Events:\n                log.Println(\"event:\", ev)\n                newFilename &lt;- ev.Name // Relative path to the file\n                //t.Stop() //if I pass reference to t THIS IS NOT HAPPENING ?\n            case err := &lt;-watcher.Errors:\n                log.Println(\"error:\", err)\n            }\n        }\n    }()\n\n    return\n}\n\nfunc main() {\n    newFileName = \"mylog_0000.log.txt\"\n\n    fmt.Println(\"Processing log: \",newFileName)\n\n    newFilenameChan, err := newFileCheck()\n    if err != nil {\n        fmt.Println(\"ERR: \",err)\n    }\n\n    t := tailLog(newFileName)\n\n    go func() {\n        for {\n            select {\n                case name := &lt;-newFilenameChan:\n                    fmt.Println(\"New file created: \",name) //this will be printed only once and then on new events nothing is printed ?\n\n                //NONE of the lines abowe doesn't work\n                t.Stop()\n                t.Dead()\n                t.Done()\n\n                t = tailLog(name)\n            }\n        }\n    }()\n}\n\nfunc tailLog(fileName string) *tail.Tail{\n    var count = 0\n    // close the old one and read new file\n    t, err := tail.TailFile(\"/mydir/\"+fileName, tail.Config{Follow: true, ReOpen: true})\n\n    for line := range t.Lines {\n        //fmt.Println(\"Line is:\", line.Text)\n\n        //check do we have what we need\n        if strings.Contains(strings.ToLower(line.Text), \"mfc\"){\n\n            count++\n            //do other stuff\n        }\n    }\n\n    fmt.Println(err)\n\n    return t\n}\n</code></pre>\n\n<p>So I can't figure out why newFileCheck functions prints event only for the fist time, and also I'm not able to figure out how to cancel active tail when new event happens, and then start tail again after that event ?</p>\n"}, {"tags": ["go", "toml"], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 5, "last_activity_date": 1482730173, "last_edit_date": 1482730173, "creation_date": 1482729587, "answer_id": 41326728, "question_id": 41242836, "link": "https://stackoverflow.com/questions/41242836/how-to-define-a-map-in-toml/41326728#41326728", "title": "How to define a map in TOML?", "body": "<p>This works using <a href=\"https://github.com/BurntSushi/toml\" rel=\"noreferrer\">github.com/BurntSushi/toml</a> (does not support <a href=\"https://github.com/toml-lang/toml#user-content-inline-table\" rel=\"noreferrer\">inline tables</a>):</p>\n\n<pre><code>d := `\n    [FOO.Usernames_Passwords]\n    a=\"foo\"\n    b=\"bar\"\n    `\nvar s struct {\n    FOO struct {\n        Usernames_Passwords map[string]string\n    }\n}\n_, err := toml.Decode(d, &amp;s)\n// check err!\nfmt.Printf(\"%+v\", s)\n</code></pre>\n\n<p>Using <a href=\"https://github.com/naoina/toml\" rel=\"noreferrer\">github.com/naoina/toml</a> this works (using inline tables):</p>\n\n<pre><code>d := `\n    [FOO]\n    Usernames_Passwords = { a = \"foo\" , b = \"bar\" }\n    `\nvar s struct {\n    FOO struct {\n        Usernames_Passwords map[string]string\n    }\n}\nerr := toml.Unmarshal([]byte(d), &amp;s)\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"%+v\", s)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2418, "user_id": 1232832, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c492983af89b49d44250c79579a2641?s=128&d=identicon&r=PG", "display_name": "Shou Ya", "link": "https://stackoverflow.com/users/1232832/shou-ya"}, "is_accepted": true, "score": 5, "last_activity_date": 1482730182, "last_edit_date": 1482730182, "creation_date": 1482729833, "answer_id": 41326744, "question_id": 41242836, "link": "https://stackoverflow.com/questions/41242836/how-to-define-a-map-in-toml/41326744#41326744", "title": "How to define a map in TOML?", "body": "<p>You can have maps like this:</p>\n\n<pre><code>name = { first = \"Tom\", last = \"Preston-Werner\" }\npoint = { x = 1, y = 2 }\n</code></pre>\n\n<p>See: <a href=\"https://github.com/toml-lang/toml#user-content-inline-table\" rel=\"noreferrer\">https://github.com/toml-lang/toml#user-content-inline-table</a></p>\n\n<p>In your case, it looks like you want a password table, or an array of maps. You can make it like this:</p>\n\n<pre><code>[[user_entry]]\nname = \"user1\"\npass = \"pass1\"\n\n[[user_entry]]\nname = \"user2\"\npass = \"pass2\"\n</code></pre>\n\n<p>Or more concisely:</p>\n\n<pre><code>user_entry = [{ name = \"user1\", pass = \"pass1\" },\n              { name = \"user2\", pass = \"pass2\" }]\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8494, "favorite_count": 1, "accepted_answer_id": 41326744, "answer_count": 2, "score": 8, "last_activity_date": 1605454298, "creation_date": 1482238365, "last_edit_date": 1605454298, "question_id": 41242836, "link": "https://stackoverflow.com/questions/41242836/how-to-define-a-map-in-toml", "title": "How to define a map in TOML?", "body": "<p>How to define a map in TOML?</p>\n<p>For example, I want to define something like:</p>\n<pre><code>[FOO]\n\nUsernames_Passwords='{&quot;user1&quot;:&quot;pass1&quot;,&quot;user2&quot;:&quot;pass2&quot;}'\n</code></pre>\n<p>and then in go convert them to a map[string]string</p>\n"}, {"tags": ["go", "network-programming", "ip"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1482231892, "post_id": 41240761, "comment_id": 69681159, "body": "What is &quot;private network space&quot;? The RFC1918 networks?"}, {"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 1, "creation_date": 1482232016, "post_id": 41240761, "comment_id": 69681233, "body": "I ran into exactly this and found: no there is no better alternative. See <a href=\"https://github.com/mhausenblas/clump/blob/master/main.go#L83\" rel=\"nofollow noreferrer\">github.com/mhausenblas/clump/blob/master/main.go#L83</a>"}, {"owner": {"reputation": 2458, "user_id": 426485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f7126decb1b139cf2c3b669a58ac58?s=128&d=identicon&r=PG", "display_name": "StefanOS", "link": "https://stackoverflow.com/users/426485/stefanos"}, "edited": false, "score": 0, "creation_date": 1482232026, "post_id": 41240761, "comment_id": 69681243, "body": "Sorry, yes, the RFC1918 networks. I updated the question to state this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 3, "creation_date": 1482251911, "post_id": 41240761, "comment_id": 69694250, "body": "What exactly do you want to do? Do you just want to log if the host is in a private network, or is there something else you need to do before making the request? @MichaelHausenblas: FYI a <code>net.IPNet</code> has a <a href=\"https://golang.org/pkg/net/#IPNet.Contains\" rel=\"nofollow noreferrer\"><code>Contains</code> method</a>"}, {"owner": {"reputation": 2458, "user_id": 426485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f7126decb1b139cf2c3b669a58ac58?s=128&d=identicon&r=PG", "display_name": "StefanOS", "link": "https://stackoverflow.com/users/426485/stefanos"}, "edited": false, "score": 0, "creation_date": 1482261678, "post_id": 41240761, "comment_id": 69699678, "body": "For one use case I want to abort the GET request for RFC1918 networks. For another case I would just log the IP address and whether it&#39;s private or public."}], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 685587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7602f2751868682b296171f58589c851?s=128&d=identicon&r=PG", "display_name": "lyrixx", "link": "https://stackoverflow.com/users/685587/lyrixx"}, "edited": false, "score": 0, "creation_date": 1575044788, "post_id": 41273687, "comment_id": 104447984, "body": "Something is missing here. You check for the IP, but I can create a DNS that will answer a public IP on the first call, then 127.0.0.1 on the second call. This is called DNS rebind <a href=\"https://en.wikipedia.org/wiki/DNS_rebinding\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/DNS_rebinding</a>  How did you protect for this?"}, {"owner": {"reputation": 2458, "user_id": 426485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f7126decb1b139cf2c3b669a58ac58?s=128&d=identicon&r=PG", "display_name": "StefanOS", "link": "https://stackoverflow.com/users/426485/stefanos"}, "reply_to_user": {"reputation": 190, "user_id": 685587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7602f2751868682b296171f58589c851?s=128&d=identicon&r=PG", "display_name": "lyrixx", "link": "https://stackoverflow.com/users/685587/lyrixx"}, "edited": false, "score": 0, "creation_date": 1575969191, "post_id": 41273687, "comment_id": 104735528, "body": "I agree that could be an issue depending on what your use case, and as far as I know there&#39;s no possibility to guard against this using http.Client."}, {"owner": {"reputation": 190, "user_id": 685587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7602f2751868682b296171f58589c851?s=128&d=identicon&r=PG", "display_name": "lyrixx", "link": "https://stackoverflow.com/users/685587/lyrixx"}, "edited": false, "score": 2, "creation_date": 1575984626, "post_id": 41273687, "comment_id": 104743980, "body": "I found a way :) This article explain it very well: <a href=\"https://linkai.io/blog/securely-issuing-http-requests-from-the-cloud/\" rel=\"nofollow noreferrer\">linkai.io/blog/securely-issuing-http-requests-from-the-cloud</a> I tried (and applied) it and I have no issue :+1:"}, {"owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1611915374, "post_id": 41273687, "comment_id": 116608768, "body": "@StefanOS To summarize from the linkai.io article lyrixx mentioned: You restrict the http.Clients underlying TCP and TLS mechanisms itself to not issue requests to some IPs when constructing it. This way, the actual request or even redirect is checked the moment it is done and there are no timing issues. At least when disallowing requests, I guess you could also change the domain for the resolved IP address (that is checked) and make a request to that checked IP, but I&#39;m not sure this is enough. The other method with the http.Client seems way cleaner and easier to reason about for me."}], "tags": [], "owner": {"reputation": 2458, "user_id": 426485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f7126decb1b139cf2c3b669a58ac58?s=128&d=identicon&r=PG", "display_name": "StefanOS", "link": "https://stackoverflow.com/users/426485/stefanos"}, "is_accepted": false, "score": 2, "last_activity_date": 1482363437, "creation_date": 1482363437, "answer_id": 41273687, "question_id": 41240761, "link": "https://stackoverflow.com/questions/41240761/check-if-ip-address-is-in-private-network-space/41273687#41273687", "title": "Check if IP address is in private network space", "body": "<p>It seems there's no better way to accomplish than the one I described. Combining code from @MichaelHausenblas with the suggestion from @JimB, my code ended up kind of like this.</p>\n\n<pre><code>func privateIP(ip string) (bool, error) {\n    var err error\n    private := false\n    IP := net.ParseIP(ip)\n    if IP == nil {\n        err = errors.New(\"Invalid IP\")\n    } else {\n        _, private24BitBlock, _ := net.ParseCIDR(\"10.0.0.0/8\")\n        _, private20BitBlock, _ := net.ParseCIDR(\"172.16.0.0/12\")\n        _, private16BitBlock, _ := net.ParseCIDR(\"192.168.0.0/16\")\n        private = private24BitBlock.Contains(IP) || private20BitBlock.Contains(IP) || private16BitBlock.Contains(IP)\n    }\n    return private, err\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1354, "user_id": 645755, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cbd603044ab96572516f1651dd06428c?s=128&d=identicon&r=PG", "display_name": "dtoux", "link": "https://stackoverflow.com/users/645755/dtoux"}, "edited": false, "score": 2, "creation_date": 1542313543, "post_id": 50825191, "comment_id": 93535158, "body": "Also <code>fc00::&#47;7</code>"}, {"owner": {"reputation": 14031, "user_id": 98050, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f9f53917b48e19f8fad3daad45d7d91b?s=128&d=identicon&r=PG", "display_name": "Dougnukem", "link": "https://stackoverflow.com/users/98050/dougnukem"}, "edited": false, "score": 0, "creation_date": 1572225486, "post_id": 50825191, "comment_id": 103483593, "body": "missing IPv4  linkLocal: <code>&quot;169.254.0.0&#47;16&quot; &#47;&#47; RFC3927 - https:&#47;&#47;en.wikipedia.org&#47;wiki&#47;Link-local_address</code>   Or in addition:  <code>ip.IsLoopback() || ip.IsLinkLocalUnicast() || ip.IsLinkLocalMulticast()</code>"}, {"owner": {"reputation": 127, "user_id": 4288004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c71a13ea10117773c01ac54bd2ca2a57?s=128&d=identicon&r=PG&f=1", "display_name": "xuiqzy", "link": "https://stackoverflow.com/users/4288004/xuiqzy"}, "edited": false, "score": 0, "creation_date": 1611919959, "post_id": 50825191, "comment_id": 116610792, "body": "more complete lists: <a href=\"https://github.com/letsencrypt/boulder/blob/master/bdns/dns.go\" rel=\"nofollow noreferrer\">github.com/letsencrypt/boulder/blob/master/bdns/dns.go</a> and adapted in different way: <a href=\"https://github.com/wader/filtertransport/blob/master/filter.go\" rel=\"nofollow noreferrer\">github.com/wader/filtertransport/blob/master/filter.go</a>"}], "tags": [], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "is_accepted": true, "score": 27, "last_activity_date": 1572225762, "last_edit_date": 1572225762, "creation_date": 1528834447, "answer_id": 50825191, "question_id": 41240761, "link": "https://stackoverflow.com/questions/41240761/check-if-ip-address-is-in-private-network-space/50825191#50825191", "title": "Check if IP address is in private network space", "body": "<p>You might also want to include checks for loopback (IPv4 or IPv6) and/or IPv6 link-local or unique-local addresses.  Here is an example with a list of RFC1918 address plus these others and a simple check against them as <code>isPrivateIP(ip net.IP)</code>:</p>\n\n<pre><code>var privateIPBlocks []*net.IPNet\n\nfunc init() {\n    for _, cidr := range []string{\n        \"127.0.0.0/8\",    // IPv4 loopback\n        \"10.0.0.0/8\",     // RFC1918\n        \"172.16.0.0/12\",  // RFC1918\n        \"192.168.0.0/16\", // RFC1918\n        \"169.254.0.0/16\", // RFC3927 link-local\n        \"::1/128\",        // IPv6 loopback\n        \"fe80::/10\",      // IPv6 link-local\n        \"fc00::/7\",       // IPv6 unique local addr\n    } {\n        _, block, err := net.ParseCIDR(cidr)\n        if err != nil {\n            panic(fmt.Errorf(\"parse error on %q: %v\", cidr, err))\n        }\n        privateIPBlocks = append(privateIPBlocks, block)\n    }\n}\n\nfunc isPrivateIP(ip net.IP) bool {\n    if ip.IsLoopback() || ip.IsLinkLocalUnicast() || ip.IsLinkLocalMulticast() {\n        return true\n    }\n\n    for _, block := range privateIPBlocks {\n        if block.Contains(ip) {\n            return true\n        }\n    }\n    return false\n  }\n</code></pre>\n"}], "owner": {"reputation": 2458, "user_id": 426485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4f7126decb1b139cf2c3b669a58ac58?s=128&d=identicon&r=PG", "display_name": "StefanOS", "link": "https://stackoverflow.com/users/426485/stefanos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6872, "favorite_count": 3, "accepted_answer_id": 50825191, "answer_count": 2, "score": 9, "last_activity_date": 1593981041, "creation_date": 1482231692, "last_edit_date": 1593981041, "question_id": 41240761, "link": "https://stackoverflow.com/questions/41240761/check-if-ip-address-is-in-private-network-space", "title": "Check if IP address is in private network space", "body": "<p>I have a program in go which accepts URLs from clients and gets them using the net/http package. Before doing further processing, I would like to check if the URL maps to private (non-routable / RFC1918 networks) address space.</p>\n\n<p>The straight-forward way would be to perform an explicit DNS request and check the address for the known private ranges. After that, perform the HTTP GET request for the URL.</p>\n\n<p>Is there a better way to accomplish this? Preferably integrating with http.Client so it can be performed as a part of the GET request.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 5718313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d286566ae49e8f2fc502f731501954f9?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Krivokhizhin", "link": "https://stackoverflow.com/users/5718313/anton-krivokhizhin"}, "edited": false, "score": 0, "creation_date": 1482230114, "post_id": 41240000, "comment_id": 69679950, "body": "Unfortunately, it did not help. The first inserted document is selected"}, {"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "reply_to_user": {"reputation": 35, "user_id": 5718313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d286566ae49e8f2fc502f731501954f9?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Krivokhizhin", "link": "https://stackoverflow.com/users/5718313/anton-krivokhizhin"}, "edited": false, "score": 0, "creation_date": 1482231807, "post_id": 41240000, "comment_id": 69681099, "body": "Is it because <code>limit(1)</code> ?  @AntonKrovokhizhin"}, {"owner": {"reputation": 35, "user_id": 5718313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d286566ae49e8f2fc502f731501954f9?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Krivokhizhin", "link": "https://stackoverflow.com/users/5718313/anton-krivokhizhin"}, "edited": false, "score": 0, "creation_date": 1482233833, "post_id": 41240000, "comment_id": 69682287, "body": "No, I need to take only the first document after a query. But I tried to remove limit(1) and it didn&#39;t help me."}], "tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1482229350, "creation_date": 1482229350, "answer_id": 41240000, "question_id": 41238921, "link": "https://stackoverflow.com/questions/41238921/golang-and-mgo-sort-by-natural-1/41240000#41240000", "title": "Golang and Mgo sort by $natural: -1", "body": "<p>use </p>\n\n<pre><code>db.C(\"plays\").Find(nil).Select(bson.M{\"numbers\": 1}).Sort(\"$-natural\").Limit(1).One(&amp;numbs)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 5718313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d286566ae49e8f2fc502f731501954f9?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Krivokhizhin", "link": "https://stackoverflow.com/users/5718313/anton-krivokhizhin"}, "edited": false, "score": 0, "creation_date": 1482240142, "post_id": 41243196, "comment_id": 69686178, "body": "Thank you very much! This is the only one combination that i haven&#39;t tried:)"}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": true, "score": 5, "last_activity_date": 1482240061, "last_edit_date": 1482240061, "creation_date": 1482239549, "answer_id": 41243196, "question_id": 41238921, "link": "https://stackoverflow.com/questions/41238921/golang-and-mgo-sort-by-natural-1/41243196#41243196", "title": "Golang and Mgo sort by $natural: -1", "body": "<p>Looking at the <a href=\"http://bazaar.launchpad.net/+branch/mgo/v2/view/head:/session.go#L2130\" rel=\"nofollow noreferrer\">code</a> I guess it should be <code>-$natural</code> for the reverse sort:</p>\n\n<pre><code>err := db.C(\"plays\")\n  .Find(nil)\n  .Select(bson.M{\"numbers\": 1})\n  .Sort(\"-$natural\")\n  .Limit(1)\n  .One(&amp;numbs)\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 5718313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d286566ae49e8f2fc502f731501954f9?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Krivokhizhin", "link": "https://stackoverflow.com/users/5718313/anton-krivokhizhin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5777, "favorite_count": 1, "accepted_answer_id": 41243196, "answer_count": 2, "score": 1, "last_activity_date": 1482240061, "creation_date": 1482226258, "last_edit_date": 1482226676, "question_id": 41238921, "link": "https://stackoverflow.com/questions/41238921/golang-and-mgo-sort-by-natural-1", "title": "Golang and Mgo sort by $natural: -1", "body": "<p>I'm just trying to get the latest document in my collection in MongoDB with Golang and Mgo.</p>\n\n<p>Document in my collection: </p>\n\n<pre><code>{\n    \"_id\",\n    \"numbers\" : {\n        \"fst\",\n        \"snd\",\n        \"thd\"\n    },\n    \"none\" : [ \n        {\n            \"fst\",\n            \"snd\",\n            \"thd\",\n            \"email\"\n        }\n    ],\n    \"twoNums\" : [ \n        {\n            \"fst\",\n            \"snd\",\n            \"thd\",\n            \"email\"\n        }\n    ],\n    \"threeNums\" : [ \n        {\n            \"fst\",\n            \"snd\",\n            \"thd\",\n            \"email\"\n        }\n    ]\n}\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>err := db.C(\"plays\").Find(nil).Select(bson.M{\"numbers\": 1}).Sort(\"$natural:-1\").Limit(1).One(&amp;numbs)\n</code></pre>\n\n<p>And with space between $natural and \"-1\"</p>\n\n<pre><code>err := db.C(\"plays\").Find(nil).Select(bson.M{\"numbers\": 1}).Sort(\"$natural: -1\").Limit(1).One(&amp;numbs)\n</code></pre>\n\n<p>In MongoDB shell it works perfect</p>\n\n<pre><code>db.getCollection('plays').find({}, {numbers: 1}).sort({$natural: -1}).limit(1)\n</code></pre>\n"}, {"tags": ["string", "parsing", "go", "strconv"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 0, "creation_date": 1482226426, "post_id": 41238879, "comment_id": 69677520, "body": "could you please paste the defination of <code>Matrix</code>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1482227736, "last_edit_date": 1482227736, "creation_date": 1482227013, "answer_id": 41239174, "question_id": 41238879, "link": "https://stackoverflow.com/questions/41238879/strconv-parseint-gives-0/41239174#41239174", "title": "strconv.ParseInt gives 0", "body": "<p>Know that <a href=\"https://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"noreferrer\"><code>Reader.ReadString()</code></a> returns you a <code>string</code> value with the delimieter. So <code>r.ReadString('\\n')</code> will return you a string with the trailing newline character.</p>\n\n<p>And when you split the string at the commas, the last part will contain the newline character, and attempting to parse the number from it will fail, as shown in this example:</p>\n\n<pre><code>line := \"0,1,2\\n\"\nfor _, ele := range strings.Split(line, \",\") {\n    fmt.Println(strconv.ParseInt(ele, 10, 64))\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/tR_Ef0c2qo\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0 &lt;nil&gt;\n1 &lt;nil&gt;\n0 strconv.ParseInt: parsing \"2\\n\": invalid syntax\n</code></pre>\n\n<p>You religiously omit error checks, don't do that! As you can see in the above example, checking and printing the error returned by <code>strconv.ParseInt()</code> immediately revealed the error and what's going wrong.</p>\n\n<p>What you may do is cut the trailing newline character before attempting to parse any number from it, e.g.:</p>\n\n<pre><code>strconv.ParseInt(strings.TrimSpace(ele), 10, 64)\n</code></pre>\n\n<p>Or use the <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> which can scan lines and it cuts trailing newlines automatically.</p>\n"}], "owner": {"reputation": 983, "user_id": 6300710, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/767e076c216bb4a53b8046bbd1caf31c?s=128&d=identicon&r=PG&f=1", "display_name": "hallow_me", "link": "https://stackoverflow.com/users/6300710/hallow-me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "accepted_answer_id": 41239174, "answer_count": 1, "score": 1, "last_activity_date": 1533057537, "creation_date": 1482226144, "last_edit_date": 1533057537, "question_id": 41238879, "link": "https://stackoverflow.com/questions/41238879/strconv-parseint-gives-0", "title": "strconv.ParseInt gives 0", "body": "<p>I'm trying to parse a file of this forme:</p>\n\n<pre><code>12\n0,1,2,3,1,2,3,4,2,3,4,5\n1,0,1,2,2,1,2,3,3,2,3,4\n2,1,0,1,3,2,1,2,4,3,2,3\n3,2,1,0,4,3,2,1,5,4,3,2\n1,2,3,4,0,1,2,3,1,2,3,4\n2,1,2,3,1,0,1,2,2,1,2,3\n3,2,1,2,2,1,0,1,3,2,1,2\n4,3,2,1,3,2,1,0,4,3,2,1\n2,3,4,5,1,2,3,4,0,1,2,3\n3,2,3,4,2,1,2,3,1,0,1,2\n4,3,2,3,3,2,1,2,2,1,0,1\n5,4,3,2,4,3,2,1,3,2,1,0\n0,5,2,4,1,0,0,6,2,1,1,1\n5,0,3,0,2,2,2,0,4,5,0,0\n2,3,0,0,0,0,0,5,5,2,2,2\n4,0,0,0,5,2,2,10,0,0,5,5\n1,2,0,5,0,10,0,0,0,5,1,1\n0,2,0,2,10,0,5,1,1,5,4,0\n0,2,0,2,0,5,0,10,5,2,3,3\n6,0,5,10,0,1,10,0,0,0,5,0\n2,4,5,0,0,1,5,0,0,0,10,10\n1,5,2,0,5,5,2,0,0,0,5,0\n1,0,2,5,1,4,3,5,10,5,0,2\n1,0,2,5,1,0,3,0,10,0,2,0\n</code></pre>\n\n<p>Where the first line give us the size of the matrix: <code>n x n</code>\nThe n-following lines are the matrix D. Then the n-following lines are the matrix W. So there is <code>2n + 1</code> lines.</p>\n\n<p>Here is the code to parse it and put it in variables.</p>\n\n<pre><code>func readFile(path string) (int64, Matrix, Matrix) {\n    // open the file\n    f, _ := os.Open(path)\n    defer f.Close()\n\n    // init the new reader on the opened file\n    r := bufio.NewReader(f)\n\n    // we get the n value\n    line, _ := r.ReadString('\\n')\n    splitedLine := strings.Fields(line)\n    tmp, _ := strconv.ParseInt(splitedLine[0], 10, 64)\n    n := int64(tmp)\n\n    // we init the matrix W and D\n    D := Matrix{}\n    D.matrix = make([][]int64, n)\n    for i, _ := range D.matrix {\n        D.matrix[i] = make([]int64, n)\n    }\n\n    W := Matrix{}\n    W.matrix = make([][]int64, n)\n    for i, _ := range W.matrix {\n        W.matrix[i] = make([]int64, n)\n    }\n\n    // loop on the n first element\n    iter := int64(0)\n    for iter &lt; n {\n        // we get the n following elements\n        line, _ = r.ReadString('\\n')\n        for index, ele := range strings.Split(line, \",\") {\n            D.matrix[iter][index], _ = strconv.ParseInt(ele, 10, 64)\n        }\n        iter++\n    }\n\n    iter = 0\n    for iter &lt; n {\n        // we get the n following elements\n        line, _ = r.ReadString('\\n')\n        for index, ele := range strings.Split(line, \",\") {\n            W.matrix[iter][index], _ = strconv.ParseInt(ele, 10, 64)\n        }\n        iter++\n    }\n\n    return n, W, D\n\n}\n</code></pre>\n\n<p>The resultat for W should be like:</p>\n\n<pre><code>[ 0.,  1.,  2.,  3.,  1.,  2.,  3.,  4.,  2.,  3.,  4.,  5.],\n[ 1.,  0.,  1.,  2.,  2.,  1.,  2.,  3.,  3.,  2.,  3.,  4.],\n[ 2.,  1.,  0.,  1.,  3.,  2.,  1.,  2.,  4.,  3.,  2.,  3.],\n[ 3.,  2.,  1.,  0.,  4.,  3.,  2.,  1.,  5.,  4.,  3.,  2.],\n[ 1.,  2.,  3.,  4.,  0.,  1.,  2.,  3.,  1.,  2.,  3.,  4.],\n[ 2.,  1.,  2.,  3.,  1.,  0.,  1.,  2.,  2.,  1.,  2.,  3.],\n[ 3.,  2.,  1.,  2.,  2.,  1.,  0.,  1.,  3.,  2.,  1.,  2.],\n[ 4.,  3.,  2.,  1.,  3.,  2.,  1.,  0.,  4.,  3.,  2.,  1.],\n[ 2.,  3.,  4.,  5.,  1.,  2.,  3.,  4.,  0.,  1.,  2.,  3.],\n[ 3.,  2.,  3.,  4.,  2.,  1.,  2.,  3.,  1.,  0.,  1.,  2.],\n[ 4.,  3.,  2.,  3.,  3.,  2.,  1.,  2.,  2.,  1.,  0.,  1.],\n[ 5.,  4.,  3.,  2.,  4.,  3.,  2.,  1.,  3.,  2.,  1.,  0.]\n</code></pre>\n\n<p>But when I print it; it gives me :</p>\n\n<pre><code>[0 1 2 3 1 2 3 4 2 3 4 0]\n[1 0 1 2 2 1 2 3 3 2 3 0]\n[2 1 0 1 3 2 1 2 4 3 2 0]\n[3 2 1 0 4 3 2 1 5 4 3 0]\n[1 2 3 4 0 1 2 3 1 2 3 0]\n[2 1 2 3 1 0 1 2 2 1 2 0]\n[3 2 1 2 2 1 0 1 3 2 1 0]\n[4 3 2 1 3 2 1 0 4 3 2 0]\n[2 3 4 5 1 2 3 4 0 1 2 0]\n[3 2 3 4 2 1 2 3 1 0 1 0]\n[4 3 2 3 3 2 1 2 2 1 0 0]\n[5 4 3 2 4 3 2 1 3 2 1 0]\n</code></pre>\n\n<p>I don't know why.\nThanks for your reply.</p>\n"}, {"tags": ["http", "go", "http-headers", "server-side"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482225379, "post_id": 41238407, "comment_id": 69676838, "body": "There is no guarantee that the URL you call will set the <code>Content-Length</code>, and so you should only set it in your response if it&#39;s non-zero."}], "answers": [{"comments": [{"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482227342, "post_id": 41239018, "comment_id": 69678173, "body": "r.Header.Get(&quot;Content-Length&quot;) is not empty it gives value 434 in my case"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482227403, "post_id": 41239018, "comment_id": 69678218, "body": "@SandunPriyanka Then it looks like your query returns an error page, which is not PDF. You should check that first."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482228106, "post_id": 41239018, "comment_id": 69678729, "body": "In my case resp.StatusCode == http.StatusOK but when running th io.copy there is happen above error &quot;http: wrote more than the declared Content-Length 2016/12/20 15:29:02 http: multiple response.WriteHeader calls&quot;"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 1, "creation_date": 1482228468, "post_id": 41239018, "comment_id": 69678958, "body": "@SandunPriyanka See edited answer. You used <code>r.Header.Get(&quot;Content-Type&quot;)</code>, but you should&#39;ve <code>resp.Header.Get(&quot;Content-Type&quot;)</code>."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482229749, "post_id": 41239018, "comment_id": 69679713, "body": "that error is fixed but generated pdf is blank page."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482229833, "post_id": 41239018, "comment_id": 69679771, "body": "@SandunPriyanka I&#39;m not surprised the PDF is blank. A PDF has a header, and if the complete PDF is only 434 bytes, there isn&#39;t really much room for content. Your PDF source does not generate content."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "edited": false, "score": 0, "creation_date": 1482230298, "post_id": 41239018, "comment_id": 69680084, "body": "appreciate your help."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1482256895, "last_edit_date": 1482256895, "creation_date": 1482226552, "answer_id": 41239018, "question_id": 41238407, "link": "https://stackoverflow.com/questions/41238407/pdf-download-is-not-working-from-serverside-in-golang/41239018#41239018", "title": "PDF download is not working from serverside in golang", "body": "<p>Look at these 2 lines:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", r.Header.Get(\"Content-Type\"))\nw.Header().Set(\"Content-Length\", r.Header.Get(\"Content-Length\"))\n</code></pre>\n\n<p>You want to set the same content type and length you get when getting the PDF, but the <code>r</code> request is the one associated with the request you <em>serve</em>! It should be:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", resp.Header.Get(\"Content-Type\"))\nw.Header().Set(\"Content-Length\", resp.Header.Get(\"Content-Length\"))\n</code></pre>\n\n<p>And also note that there is no guarantee that the URL you call will set the <code>Content-Length</code>, and so you should only set it in your response if it's non-zero. Also note that there is also no guarantee that the content length it sends is correct, so you should handle that with care. Also note that the content length header is automatically parsed by the <code>net/http</code> package and is stored in the response, you can use just that: <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow noreferrer\"><code>Response.ContentLength</code></a>.</p>\n\n<p>If you set the content length, the <code>net/http</code> package will not allow you to send more bytes than indicated. Attempting to write more gives you the error:</p>\n\n<blockquote>\n  <p>http: wrote more than the declared Content-Length</p>\n</blockquote>\n\n<p>This little example proves / verifies it:</p>\n\n<pre><code>func h(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Length\", \"1\")\n    fmt.Println(w.Write([]byte(\"hi\")))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", h)\n    panic(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>The handler <code>h()</code> writes 2 bytes, but indicates only 1 in content length. If you change that to <code>2</code>, everything works.</p>\n\n<p>So what you should do is first check <code>r.Header.Get(\"Content-Length\")</code> if it's not the empty <code>string</code> and is a number greater than <code>0</code>; and only set it if so.</p>\n\n<p>If the received content length is missing and you still want to indicate it in your response, then you have no other choice but to first read the content into a buffer, whose length you can check and set prior to sending it.</p>\n\n<p>Also you omit checking if the <code>HTTP GET</code> request succeeded. Your comment indicates that it was an error page. Check that first:</p>\n\n<pre><code>resp, err := client.Get(url)\nif err != nil {\n    fmt.Println(err)\n    http.Error(w, \"Can't serve PDF.\", http.StatusInternalServerError)\n    return\n}\ndefer resp.Body.Close()\n\nif resp.StatusCode != http.StatusOK {\n    http.Error(w, \"Can't serve PDF.\", http.StatusInternalServerError)\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "edited": false, "score": 1, "creation_date": 1552023776, "post_id": 55057157, "comment_id": 96863378, "body": "Welcome to SO! Will you like to improve the answer by adding some explanation as well?"}, {"owner": {"reputation": 11, "user_id": 9086636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cyjKhuFrjaA/AAAAAAAAAAI/AAAAAAAAABo/_dVmulNg_mk/photo.jpg?sz=128", "display_name": "\u5434\u6c9b\u6797", "link": "https://stackoverflow.com/users/9086636/%e5%90%b4%e6%b2%9b%e6%9e%97"}, "reply_to_user": {"reputation": 1886, "user_id": 1698143, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5bd39afbb0ffd37a0ad4aaa51002370e?s=128&d=identicon&r=PG", "display_name": "Failed Scientist", "link": "https://stackoverflow.com/users/1698143/failed-scientist"}, "edited": false, "score": 0, "creation_date": 1552026290, "post_id": 55057157, "comment_id": 96864183, "body": "@FailedScientist you can build and run it at terminal to start server"}], "tags": [], "owner": {"reputation": 11, "user_id": 9086636, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cyjKhuFrjaA/AAAAAAAAAAI/AAAAAAAAABo/_dVmulNg_mk/photo.jpg?sz=128", "display_name": "\u5434\u6c9b\u6797", "link": "https://stackoverflow.com/users/9086636/%e5%90%b4%e6%b2%9b%e6%9e%97"}, "is_accepted": false, "score": 1, "last_activity_date": 1552026094, "last_edit_date": 1552026094, "creation_date": 1552022428, "answer_id": 55057157, "question_id": 41238407, "link": "https://stackoverflow.com/questions/41238407/pdf-download-is-not-working-from-serverside-in-golang/55057157#55057157", "title": "PDF download is not working from serverside in golang", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"net/url\"\n    \"path\"\n)\n\nfunc main() {\n    fmt.Println(\"Starting transform download sever at http://127.0.0.1:2333\")\n    http.HandleFunc(\"/\", HandleClient)\n    err := http.ListenAndServe(\":2333\", nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n\nfunc HandleClient(writer http.ResponseWriter, request *http.Request) {\n    //First of check if Get is set in the URL\n    encoded := request.URL.Query().Get(\"url\")\n    if encoded == \"\" {\n        //Get not set, send a 400 bad request\n        http.Error(writer, \"Get 'url' not specified in url.\", 500)\n        return\n    }\n    decoded, err  := base64.StdEncoding.DecodeString(encoded)\n    if err != nil {\n        http.Error(writer, \"base64 decode error\", 501)\n        return\n    }\n    fileUrl := string(decoded)\n    filename, err := GetFilename(fileUrl)\n    if err != nil {\n        http.Error(writer, \"error url\", 502)\n        return\n    }\n    resp, err := http.Get(fileUrl)\n    if err != nil {\n        http.Error(writer, \"error url\", 502)\n        return\n    }\n    defer resp.Body.Close()\n    writer.Header().Set(\"Content-Disposition\", \"attachment; filename=\"+filename)\n    writer.Header().Set(\"Content-Type\", resp.Header.Get(\"Content-Type\"))\n    writer.Header().Set(\"Content-Length\", resp.Header.Get(\"Content-Length\"))\n    _, err = io.Copy(writer, resp.Body)\n    if err != nil {\n        http.Error(writer, \"Remote server error\", 503)\n        return\n    }\n    return\n}\n\nfunc GetFilename(inputUrl string) (string, error) {\n    u, err := url.Parse(inputUrl)\n    if err != nil {\n        return \"\", err\n    }\n    u.RawQuery = \"\"\n    return path.Base(u.String()), nil\n}\n\n\n\n</code></pre>\n\n<p>Use like <a href=\"http://127.0.0.1:2333/?url=\" rel=\"nofollow noreferrer\">http://127.0.0.1:2333/?url=</a><code>base64encoded(url)</code> </p>\n"}], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2647, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1552026094, "creation_date": 1482224752, "last_edit_date": 1482225169, "question_id": 41238407, "link": "https://stackoverflow.com/questions/41238407/pdf-download-is-not-working-from-serverside-in-golang", "title": "PDF download is not working from serverside in golang", "body": "<p>I have created pdf in serverside(golang) then I want to download that pdf thorugh the api call.I have used ajax post request. that request direct into following <code>ExportReport</code> handlder. but my downloaded pdf document is blank page.\nThere is error happen because of the Content-Length setting on request header\nError is :</p>\n\n<pre><code> http: wrote more than the declared Content-Length\n2016/12/20 14:37:39 http: multiple response.WriteHeader calls\n</code></pre>\n\n<p>This error broken down pdf download.please go though my code snippets.</p>\n\n<pre><code>func ExportReport(w http.ResponseWriter, r *http.Request) *core_commons.AppError {\n\n    url := \"https://mydomainname/reporting/repository/dashboard.pdf\"\n\n    timeout := time.Duration(5) * time.Second\n    cfg := &amp;tls.Config{\n        InsecureSkipVerify: true,\n    }\n    transport := &amp;http.Transport{\n        TLSClientConfig:       cfg,\n        ResponseHeaderTimeout: timeout,\n        Dial: func(network, addr string) (net.Conn, error) {\n            return net.DialTimeout(network, addr, timeout)\n        },\n        DisableKeepAlives: true,\n    }\n\n    client := &amp;http.Client{\n        Transport: transport,\n    }\n    resp, err := client.Get(url)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer resp.Body.Close()\n\n    w.Header().Set(\"Content-Disposition\", \"attachment; filename=dashboard.pdf\")\n    w.Header().Set(\"Content-Type\", r.Header.Get(\"Content-Type\"))\n    w.Header().Set(\"Content-Length\", r.Header.Get(\"Content-Length\"))\n\n    _, err = io.Copy(w, resp.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n    return nil\n}\n</code></pre>\n\n<p>Following are the how to invoke ajax request.</p>\n\n<pre><code>$.ajax({\n    type: \"POST\",\n    url: '/reporting/api/report/export',\n    data: JSON.stringify(payload),\n    contentType: 'application/pdf',\n    success: function(response, status, xhr) {\n        // check for a filename\n        var filename = \"\";\n        var disposition = xhr.getResponseHeader('Content-Disposition');\n        if (disposition &amp;&amp; disposition.indexOf('attachment') !== -1) {\n            var filenameRegex = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\n            var matches = filenameRegex.exec(disposition);\n            if (matches != null &amp;&amp; matches[1]) filename = matches[1].replace(/['\"]/g, '');\n        }\n\n        var type = xhr.getResponseHeader('Content-Type');\n        var blob = new Blob([response], { type: type });\n\n        if (typeof window.navigator.msSaveBlob !== 'undefined') {\n            // IE workaround for \"HTML7007: One or more blob URLs were revoked by closing the blob for which they were created. These URLs will no longer resolve as the data backing the URL has been freed.\"\n            window.navigator.msSaveBlob(blob, filename);\n        } else {\n            var URL = window.URL || window.webkitURL;\n            var downloadUrl = URL.createObjectURL(blob);\n\n            if (filename) {\n                // use HTML5 a[download] attribute to specify filename\n                var a = document.createElement(\"a\");\n                // safari doesn't support this yet\n                if (typeof a.download === 'undefined') {\n                    window.location = downloadUrl;\n                } else {\n                    a.href = downloadUrl;\n                    a.download = filename;\n                    document.body.appendChild(a);\n                    a.click();\n                }\n            } else {\n                window.location = downloadUrl;\n            }\n\n            setTimeout(function () { URL.revokeObjectURL(downloadUrl); }, 100); // cleanup\n        }\n    }\n});\n</code></pre>\n"}, {"tags": ["arrays", "elasticsearch", "go"], "comments": [{"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1482215109, "post_id": 41235843, "comment_id": 69671802, "body": "In order to achieve what you want, you need a script like this one: <a href=\"http://stackoverflow.com/questions/33303836/converting-elastic-search-field-to-array/33304787#33304787\" title=\"converting elastic search field to array\">stackoverflow.com/questions/33303836/&hellip;</a>"}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1482215122, "post_id": 41235843, "comment_id": 69671805, "body": "Can you show the full error you get from your ES logs?"}], "owner": {"reputation": 666, "user_id": 1819852, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/da91c0f9296f7029e059362ea5809af6?s=128&d=identicon&r=PG", "display_name": "souravlahoti", "link": "https://stackoverflow.com/users/1819852/souravlahoti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 451, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482213727, "creation_date": 1482213727, "question_id": 41235843, "link": "https://stackoverflow.com/questions/41235843/append-unique-item-to-an-array-in-elasticsearch-in-go", "title": "Append unique item to an array in ElasticSearch in Go", "body": "<p><strong>UseCase</strong> </p>\n\n<ul>\n<li>Add an object item in field of type array in elastic search</li>\n<li>If the field does not exist create one and add the item to the field</li>\n<li>If the field exists the item should only be added/append if the item is not present in the array i.e no duplicates in the array.</li>\n</ul>\n\n<p><strong>Code</strong></p>\n\n<pre><code>func (elasticSearchClient *ElasticSearchClient) Upsert(index string, indextype string, id string, jobApplication models.JobApplication) {\n\nclient := elasticSearchClient.GetClient()\nupsert, err := client.Update().\n    Index(index).Type(indextype).Id(id).\n    Script(elastic.NewScript(\"if(! ctx._source.jobApplications.contains(application)){ ctx._source.jobApplications += application }\").\n        Params(map[string]interface{}{\"application\": jobApplication})).\n    Upsert(map[string]interface{}{\"jobApplications\": jobApplication}).\n    Do()\n\nif err != nil {\n    fmt.Println(\"Error , got: %v\", err.Error())\n}\n\nfmt.Println(upsert)\n}\n</code></pre>\n\n<p><strong>Note</strong></p>\n\n<ul>\n<li>jobApplication is a struct type</li>\n</ul>\n\n<p><strong>Error</strong>:</p>\n\n<blockquote>\n  <p>Error 400 (Bad Request): failed to execute script\n  [type=illegal_argument_exception]</p>\n</blockquote>\n"}, {"tags": ["javascript", "html", "web", "go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1482209645, "post_id": 41234547, "comment_id": 69669751, "body": "If you are sending a 20mb from Chrome, then you are probably bumping into <a href=\"https://github.com/golang/go/issues/7632\" rel=\"nofollow noreferrer\">a bug in the x/net/websocket package</a>.  Consider using the gorilla package as <a href=\"https://godoc.org/golang.org/x/net/websocket\" rel=\"nofollow noreferrer\">suggested by the x/net/websocket documentation</a>."}, {"owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482210620, "post_id": 41234547, "comment_id": 69670068, "body": "@MellowMarmot Thanks first.I think not because this reason,my package x/net/websocket is lasest.When I increase <b>slicesize</b> to 104857600(100mb), it run well."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482212690, "post_id": 41234547, "comment_id": 69670805, "body": "The bug is not fixed in x/net/websocket including the most recent version of the package.  The most recent change to the package is an update to the documentation that recommends gorilla."}, {"owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482245021, "post_id": 41234547, "comment_id": 69689582, "body": "@MellowMarmot thank you again ! The problem really beacuse the &quot;x/net/websocket&quot; package.I have replaced it with gorilla.It could run well ."}], "owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482207623, "creation_date": 1482205231, "last_edit_date": 1482207623, "question_id": 41234547, "link": "https://stackoverflow.com/questions/41234547/files-md5-was-changed-when-i-use-websocket-to-upload-it", "title": "File&#39;s md5 was changed when I use websocket to upload it", "body": "<p>I tried to use HTML5's method file.slice to cut a file, and then to upload using websocket.Below is my js code:</p>\n\n<pre><code>function upload() {\n    var slicesize = 1024 * 1024 * 5;\n    var file = document.getElementById(\"file\").files[0];\n    var ws = new WebSocket(\"ws://127.0.0.1:8080/file\");\n    var startsize = 0;\n    var endsize = 0;\n    var count = 0;\n    ws.onopen = function () {\n        console.log(\"connected to server.\");\n        ws.send(file.name);\n        console.log(\"size : \", file.size);\n        console.log(\"name size : \", file.name.length)\n    };\n    ws.onmessage = function (resp) {\n        //console.log(\"received from server: \", resp.data);\n        if (resp.data) {\n            var sent = parseInt(resp.data);\n            var percent = sent / file.size * 100;\n            //console.log(\"percent:\", percent, \"%\");\n            $('#progress').attr(\"style\", \"width: \" + (percent).toFixed(2) + \"%\");\n            $('#progress').text(percent.toFixed(2) + \"%\");\n            //console.log(sent, file.size);\n            if (sent == file.size) {\n                $('#progress').text(\"finish\");\n            }\n            if (count == 0) {\n                ws.send(file.size);\n                count++;\n            } else if (endsize &lt; file.size) {\n                console.log(\"test\");\n                startsize = endsize;\n                endsize += slicesize;\n                if (endsize &gt; file.size) {\n                    console.log(\"endsize &gt; file.size\");\n                    endsize = file.size\n                }\n                console.log(\"endsize:\", endsize);\n                var blob = file.slice(startsize, endsize);\n                var reader = new FileReader();\n                reader.readAsArrayBuffer(blob);\n                reader.onloadend = function loaded(event) {\n                    var arrayBuffer = event.target.result;\n                    ws.send(arrayBuffer);\n                    console.log(\"sent slice, length is:\", blob.size);\n                    reader = null;\n                }\n\n            } else {\n                startSize = endSize = 0;\n\n            }\n        }\n    };\n    ws.onclose = function () {\n        console.log(\"closed websocket\");\n        loadMovie()\n    }\n}\n</code></pre>\n\n<p>and below is my server code, I use golang:</p>\n\n<pre><code>func UploadFile(ws *websocket.Conn) {\nvar err error\nvar count int\nvar filename string\nvar filesize int\nvar savepath string\nrecData := bytes.NewBuffer([]byte{})\nfor {\n    var receive []byte\n    if err = websocket.Message.Receive(ws, &amp;receive); err != nil {\n        log.Fatal(err)\n        break\n    }\n    if count == 0 {\n        filename = string(receive)\n    } else if count == 1 {\n        filesize, err = strconv.Atoi(string(receive))\n    } else {\n        recData.Write(receive)\n    }\n    count++\n    sent := strconv.Itoa(len(recData.Bytes()))\n\n    if err = websocket.Message.Send(ws, sent); err != nil {\n        log.Fatal(err)\n        break\n    }\n    if len(recData.Bytes()) == filesize &amp;&amp; sent != \"0\" {\n        break\n    }\n}\nwd, err := os.Getwd()\nif err != nil {\n    log.Fatal(err)\n}\nsavepath = path.Join(wd, \"static\", \"upload\")\nmovie := Movie{\n    Name: filename,\n    Path: savepath,\n    Size: filesize,\n    Time: time.Now().Format(\"2006-01-02 15:04:05\"),\n}\nfp, err := os.Create(path.Join(savepath, movie.Time + movie.Name))\nif err != nil {\n    log.Fatal(err)\n}\ndefer fp.Close()\n\nrecData.WriteTo(fp)\n\n}\n</code></pre>\n\n<p>When I upload a file which bigger than slicesize, such as 20MB, the file's md5 will be change when it saved to server's disk, but number of byte not be changed.</p>\n\n<p>Why, and how to solve it ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 905, "user_id": 3781709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4fa60c6b287ee4f006d6c4e320daf5?s=128&d=identicon&r=PG", "display_name": "Pradip Patil", "link": "https://stackoverflow.com/users/3781709/pradip-patil"}, "is_accepted": true, "score": 4, "last_activity_date": 1482201194, "last_edit_date": 1482201194, "creation_date": 1482200785, "answer_id": 41233963, "question_id": 41233835, "link": "https://stackoverflow.com/questions/41233835/anonymous-function-doesnt-seem-to-execute-in-go-routine/41233963#41233963", "title": "Anonymous function doesn&#39;t seem to execute in Go routine", "body": "<p>I think this behaviour is because function never yields back to main thread ( After you launch goroutines, there is no construct in program to wait for them to finish their work). \nUse of channels, IO operations, sync.WaitGroup etc can yield control back to the main thread.</p>\n\n<p>You may want to try sync.WaitGroup</p>\n\n<p>Example: <a href=\"https://play.golang.org/p/Zwn0YBynl2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Zwn0YBynl2</a></p>\n"}], "owner": {"reputation": 1187, "user_id": 1044083, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/547896085/picture?type=large", "display_name": "Dean", "link": "https://stackoverflow.com/users/1044083/dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3894, "favorite_count": 0, "accepted_answer_id": 41233963, "answer_count": 1, "score": -1, "last_activity_date": 1482201194, "creation_date": 1482199461, "last_edit_date": 1482200405, "question_id": 41233835, "link": "https://stackoverflow.com/questions/41233835/anonymous-function-doesnt-seem-to-execute-in-go-routine", "title": "Anonymous function doesn&#39;t seem to execute in Go routine", "body": "<p>I have the following code. Pay special attention to the anonymous function:</p>\n\n<pre><code>func saveMatterNodes(matterId int, nodes []doculaw.LitigationNode) (bool, error) {\n\n    var (\n        err  error\n        resp *http.Response\n    )\n\n    // Do this in multiple threads\n    for _, node := range nodes {\n        fmt.Println(\"in loops\")\n        go func() {\n            postValues := doculaw.LitigationNode{\n                Name:        node.Name,\n                Description: node.Description,\n                Days:        node.Days,\n                Date:        node.Date,\n                IsFinalStep: false,\n                Completed:   false,\n                Matter:      matterId}\n\n            b := new(bytes.Buffer)\n            json.NewEncoder(b).Encode(postValues)\n            resp, err = http.Post(\"http://127.0.0.1:8001/matterNode/\", \"application/json\", b)\n            io.Copy(os.Stdout, resp.Body)\n\n            fmt.Println(\"Respone from http post\", resp)\n            if err != nil {\n                fmt.Println(err)\n            }\n        }()\n\n    }\n\n    if err != nil {\n        return false, err\n    } else {\n        return true, nil\n    }\n\n}\n</code></pre>\n\n<p>If I remove the <code>go func() {}()</code> part and just leave the code in between it seems to execute fine but the moment I add it back it does not execute. Any idea why that is? I initially thought maybe because it's executing on a different thread but this doesn't seem to be the case as I can see on my webservice access logs that it is not executing.</p>\n"}, {"tags": ["go", "escaping", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1482224239, "last_edit_date": 1482224239, "creation_date": 1482223912, "answer_id": 41238160, "question_id": 41233066, "link": "https://stackoverflow.com/questions/41233066/how-can-i-escape-the-output-of-a-template/41238160#41238160", "title": "How can I escape the output of a template?", "body": "<p>You may register a function which executes the includable template and returns the result as a <code>string</code>. That <code>string</code> can then be inserted into the other template, proper context-sensitive escaping applied automatically:</p>\n\n<pre><code>var tmpl = `{{define \"main\"}}&lt;script&gt;var xx = {{exect \"html-snippet\" .}};&lt;/script&gt;{{end}}{{define \"html-snippet\"}}&lt;div&gt;\n    &lt;img src=\"{{.}}\"&gt;\n&lt;/div&gt;{{end}}`\n\nvar t *template.Template\n\nfunc exect(name string, data interface{}) string {\n    buf := &amp;bytes.Buffer{}\n    if err := t.ExecuteTemplate(buf, name, data); err != nil {\n        fmt.Println(\"Error:\", err)\n    }\n    return buf.String()\n}\n\nfunc main() {\n    t = template.Must(template.New(\"fo\").Funcs(template.FuncMap{\n        \"exect\": exect,\n    }).Parse(tmpl))\n    if err := t.ExecuteTemplate(os.Stdout, \"main\", \"some.jpg\"); err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/05XBgk1CO8\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;script&gt;var xx = \"\\u003cdiv\\u003e\\n\\t\\u003cimg src=\\\"some.jpg\\\"\\u003e\\n\\u003c/div\\u003e\";&lt;/script&gt;\n</code></pre>\n\n<p>Or even better: the template engine allows you to register functions that return 2 values (second of which must be an error), so our <code>exect()</code> function may look like this:</p>\n\n<pre><code>func exect(name string, data interface{}) (string, error) {\n    buf := &amp;bytes.Buffer{}\n    err := t.ExecuteTemplate(buf, name, data)\n    return buf.String(), err\n}\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/DrgTOHty2T\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 313, "user_id": 6650701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26fbd263ecf4554fd90857ecd55d207?s=128&d=identicon&r=PG&f=1", "display_name": "stef", "link": "https://stackoverflow.com/users/6650701/stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 1, "accepted_answer_id": 41238160, "answer_count": 1, "score": 3, "last_activity_date": 1482224239, "creation_date": 1482193130, "last_edit_date": 1482224203, "question_id": 41233066, "link": "https://stackoverflow.com/questions/41233066/how-can-i-escape-the-output-of-a-template", "title": "How can I escape the output of a template?", "body": "<p>How do I escape an HTML snippet generated by a template? Like in this example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"os\"\n)\n\n// I want to escape a html snippet which is then stored as a \n// javascript variable. how can I do that? the second output \n// is the one i would like to generate with a template.\n\nvar tmpl = `{{define \"main\"}}&lt;script&gt;var xx = \"{{template \"html-snippet\" .}}\";&lt;/script&gt;{{end}}{{define \"html-snippet\"}}&lt;div&gt;\n    &lt;img src=\"{{.}}\"&gt;\n&lt;/div&gt;{{end}}`\n\nfunc main() {\n    t, err := template.New(\"fo\").Parse(tmpl)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    t.ExecuteTemplate(os.Stdout, \"main\", \"some.jpg\")\n    fmt.Println(\"\")\n    fmt.Println(template.JSEscapeString(`&lt;div&gt;\n        &lt;img src=\"some.jpg\"&gt;\n    &lt;/div`))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TBJxYqokkU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TBJxYqokkU</a></p>\n\n<p><code>html/template</code> does <em>not</em> do it automatically in my case. <code>JSEscapeString</code> through a func map also does not work (or I don\u2019t know how), because I cannot call it like this <code>{{jsescape (template \"html-snippet\" .)}}</code>, since this is not a string.</p>\n\n<p>Many thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 5, "last_activity_date": 1482192749, "last_edit_date": 1482192749, "creation_date": 1482192334, "answer_id": 41232957, "question_id": 41232904, "link": "https://stackoverflow.com/questions/41232904/is-there-a-go-equivalent-of-tostring-that-fmt-print-will-use/41232957#41232957", "title": "Is there a Go equivalent of `ToString()` that `fmt.Print` will use?", "body": "<p>Yes, it's called <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\"><code>fmt.Stringer()</code></a></p>\n\n<blockquote>\n  <p>Stringer is implemented by any value that has a String method, which defines the \u201cnative\u201d format for that value. The String method is used to print values passed as an operand to any format that accepts a string or to an unformatted printer such as Print.</p>\n\n<pre><code>type Stringer interface {\n    String() string\n}\n</code></pre>\n</blockquote>\n\n<p>The <code>*print*</code> functions don't accept a <code>Stringer()</code> interface themselves because <code>fmt.Println(\"foo\")</code> and <code>fmt.Println(someStringer)</code> are equally valid. I recommend you go through the <a href=\"https://golang.org/src/fmt/print.go\" rel=\"nofollow noreferrer\"><code>print.go</code> source code</a> to see <em>exactly</em> how this works, but in brief the <code>*print*</code> functions:</p>\n\n<ul>\n<li>accept an <code>interface{}</code>;</li>\n<li>check if it's a built-in type (e.g. <code>string</code>, <code>int</code>, etc.) and format it accordingly if it is;</li>\n<li>check if the type has a <code>.String()</code> method and use that if it exists.</li>\n</ul>\n\n<p>The precise logic is a bit more involved. As mentioned, I encourage you to go through the source code yourself. It's all just plain readable Go.</p>\n"}], "owner": {"reputation": 1991, "user_id": 734860, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/eb3a1b815b40406a661df2e7d07c1289?s=128&d=identicon&r=PG", "display_name": "entonio", "link": "https://stackoverflow.com/users/734860/entonio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2102, "favorite_count": 0, "accepted_answer_id": 41232957, "answer_count": 1, "score": 1, "last_activity_date": 1482192749, "creation_date": 1482191991, "question_id": 41232904, "link": "https://stackoverflow.com/questions/41232904/is-there-a-go-equivalent-of-tostring-that-fmt-print-will-use", "title": "Is there a Go equivalent of `ToString()` that `fmt.Print` will use?", "body": "<p>I've looked in the documentation and couldn't find this info.\nGiven a struct, is it possible to implement a method (say, <code>func (k Koala) String() string</code>) that will automatically be used by the <code>fmt.Print</code> family when printing a struct?\nMaybe there's an interface somewhere, but I didn't find it.</p>\n"}, {"tags": ["go", "tcp", "net-http"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186141, "post_id": 41231872, "comment_id": 69663452, "body": "It looks like you&#39;re making up to 10 concurrent calls to the server. Since you can&#39;t make simultaneous requests on the same connection, it&#39;s going to make multiple connections."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186240, "post_id": 41231872, "comment_id": 69663496, "body": "oh could you please recommend any better way to GET or POST faster with multiple thread."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186290, "post_id": 41231872, "comment_id": 69663522, "body": "What&#39;s wrong with using multiple connections? That&#39;s the only way to send more than 1 request at a time."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186299, "post_id": 41231872, "comment_id": 69663528, "body": "as per the docs <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a>,   Clients and Transports are safe for concurrent use by multiple goroutines and for efficiency should only be created once and re-used."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186342, "post_id": 41231872, "comment_id": 69663547, "body": "When i have 100k docs to post, and it creates 100K session which is not possible."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186536, "post_id": 41231872, "comment_id": 69663629, "body": "btw this is working in python to reuse session."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186668, "post_id": 41231872, "comment_id": 69663675, "body": "If you send these serially it <i>will</i> work exactly like it would in python. If you want concurrent connections you need to limit concurrency to a reasonable level, and be able to maintain that many connections in the Transport. Maybe this will help: <a href=\"https://stackoverflow.com/questions/39813587/go-client-program-generates-a-lot-a-sockets-in-time-wait-state/39834253#39834253\" title=\"go client program generates a lot a sockets in time wait state\">stackoverflow.com/questions/39813587/&hellip;</a>"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482186922, "post_id": 41231872, "comment_id": 69663756, "body": "Let me read, thank you so much."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482188644, "post_id": 41231872, "comment_id": 69664374, "body": "@jimB That works after tweaking MaxIdleConnsPerHost and MaxIdleConns. Hope you may write few words in the answer, so i can mark as answer and who ever come across can get it easily."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482194800, "post_id": 41231872, "comment_id": 69666123, "body": "@jimB it works for GET request but not with POST request. Got, panic: runtime error: invalid memory address or nil pointer dereference"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482195650, "post_id": 41231872, "comment_id": 69666317, "body": "a nil pointer deterrence is an error in your code. Please show the code and where the panic happens."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482210545, "post_id": 41231872, "comment_id": 69670031, "body": "Here is the one  for get request, it works intermittently <a href=\"https://play.golang.org/p/7oqInVO0XR\" rel=\"nofollow noreferrer\">play.golang.org/p/7oqInVO0XR</a>   and throwing this <code>error  [Get : unsupported protocol scheme &quot;&quot;] panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x28b7]  goroutine 11 [running]:</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1482249717, "post_id": 41231872, "comment_id": 69692883, "body": "it would really help if you show where the actual panic occurred, but it&#39;s probably from your Execute method, where you continue executing after an error and <code>res</code> is probably <code>nil</code>."}], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1482188851, "answer_count": 0, "score": 0, "last_activity_date": 1482186227, "creation_date": 1482185619, "last_edit_date": 1482186227, "question_id": 41231872, "link": "https://stackoverflow.com/questions/41231872/golang-net-http-spawn-multiple-tcp-session", "closed_reason": "Duplicate", "title": "Golang net-http spawn multiple tcp session", "body": "<p>In the below <a href=\"https://play.golang.org/p/8gTnmoTBnr\" rel=\"nofollow noreferrer\">snippet</a> I tried to perform GET request using POOL of worker.</p>\n\n<p>I thought it will reuse the TCP session instead of creating new one for every worker, but it creates multiple session.</p>\n\n<p>Could someone please help in validating the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n)\n\n//var URL = \"http://localhost:8181/api/v1/resources\"\nvar URL = \"http://httpbin.org/ip\"\n\n// Task interface\ntype Task interface {\n    Execute(p *Pool)\n}\n\n// JobDesc struct\ntype JobDesc struct {\n    Client *http.Client\n}\n\n// Pool struct\ntype Pool struct {\n    mu      sync.Mutex\n    size    int\n    tasks   chan Task\n    kill    chan struct{}\n    wg      sync.WaitGroup\n    Results chan interface{}\n}\n\n// Methods for Pool struct.\nfunc (p *Pool) worker() {\n    defer p.wg.Done()\n    for {\n        select {\n        case task, ok := &lt;-p.tasks:\n            if !ok {\n                return\n            }\n            task.Execute(p)\n\n        case &lt;-p.kill:\n            return\n        }\n    }\n}\n\n// Resize methods update the number of goroutine in the pool, to execute the task.\nfunc (p *Pool) Resize(n int) {\n    p.mu.Lock()\n    defer p.mu.Unlock()\n    for p.size &lt; n {\n        p.size++\n        p.wg.Add(1)\n        go p.worker()\n    }\n    for p.size &gt; n {\n        p.size--\n        p.kill &lt;- struct{}{}\n    }\n}\n\n// CloseJobChannel method close the jobs channel,\n// once all the jobs are sending to the channel.\nfunc (p *Pool) CloseJobChannel() {\n    close(p.tasks)\n}\n\n// CloseResultChannel method close the results channel,\n// once all the jobs are completed and results are collected.\nfunc (p *Pool) CloseResultChannel() {\n    close(p.Results)\n}\n\n// Wait Method of Pool struct\nfunc (p *Pool) Wait() {\n    p.wg.Wait()\n}\n\n// AddJob Method add task to the task channel\nfunc (p *Pool) AddJob(task Task) {\n    p.tasks &lt;- task\n}\n\n// NewPool function create pool of task base on the size\n// provided.\nfunc NewPool(size int) *Pool {\n    pool := &amp;Pool{\n        tasks:   make(chan Task, 10000),\n        kill:    make(chan struct{}),\n        Results: make(chan interface{}, 10000),\n    }\n    pool.Resize(size)\n    return pool\n}\n\n// Execute to execute\nfunc (job *JobDesc) Execute(p *Pool) {\n    res, err := job.Client.Get(URL)\n    if err != nil {\n        fmt.Println(err)\n    }\n    //body, _ := ioutil.ReadAll(res.Body)\n    fmt.Println(res.Body)\n    //defer res.Body.Close()\n}\n\nfunc main() {\n    pool := NewPool(10)\n    tr := &amp;http.Transport{DisableKeepAlives: false}\n    client := &amp;http.Client{Transport: tr}\n\n    for i := 1; i &lt;= 50; i++ {\n        job := JobDesc{Client: client}\n        pool.AddJob(&amp;job)\n    }\n    pool.CloseJobChannel()\n    pool.Wait()\n    pool.CloseResultChannel()\n    i := 1\n    for k := range pool.Results {\n        fmt.Printf(\"%d, %d\", i, k)\n        i++\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "is_accepted": false, "score": 0, "last_activity_date": 1482185092, "creation_date": 1482185092, "answer_id": 41231768, "question_id": 41231767, "link": "https://stackoverflow.com/questions/41231767/golang-deepequal-interface-to-integer/41231768#41231768", "title": "golang deepEqual interface{} to integer", "body": "<pre><code>fmt.Printf(\"ret type: %T, ret: %v\\n\", resp, resp)\n</code></pre>\n\n<p>when I did check the type of the <code>resp</code> interface, i found that it is <code>int64</code>, so casting the <code>0</code> appropriately, like below, helped.</p>\n\n<pre><code>reflect.DeepEqual(resp, int64(0))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "is_accepted": true, "score": 1, "last_activity_date": 1482187547, "creation_date": 1482187547, "answer_id": 41232215, "question_id": 41231767, "link": "https://stackoverflow.com/questions/41231767/golang-deepequal-interface-to-integer/41232215#41232215", "title": "golang deepEqual interface{} to integer", "body": "<p>Instead of over complicate your code, you can use some build-in functions of redigo to convert the response to <code>int</code> and afterward check if the key is or is not in redis.</p>\n\n<pre><code>resp, err := redis.Int(conn.Do(\"SISMEMBER\", \"mySet\", \"Hello\"))\nif err != nil {\n    // some error handler\n}\nif resp == 0 {\n    fmt.Println(\"record doesn't exist\")\n}\n</code></pre>\n"}], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "accepted_answer_id": 41232215, "answer_count": 2, "score": 0, "last_activity_date": 1482263268, "creation_date": 1482185092, "last_edit_date": 1482263268, "question_id": 41231767, "link": "https://stackoverflow.com/questions/41231767/golang-deepequal-interface-to-integer", "title": "golang deepEqual interface{} to integer", "body": "<p>I'm using the <code>redigo</code> redis library, and checking if a key is already present in a <code>redis set</code>. I'm using the redis command <code>SISMEMBER</code> via the redigo's <code>Do</code> method which returns an interface. It is the response of the command being executed using <code>Do</code>. In case of <code>SISMEMBER</code> command, the response in a <code>1</code> or <code>0</code>. and in this particular case, the response is <code>0</code> as the given key is not present in this set. however <code>reflect.DeepEqual(resp, 0)</code> is returning <code>false</code> when <code>true</code> is expected. Is this not the correct way to use <code>DeepEqual</code> function?</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"reflect\"\n\n    \"github.com/garyburd/redigo/redis\"\n)\n\nfunc main() {\n    conn, err := redis.Dial(\"tcp\", \"127.0.0.1:6379\")\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    defer conn.Close()\n\n    resp, err := conn.Do(\"SISMEMBER\", \"mySet\", \"Hello\")\n    if reflect.DeepEqual(resp, 0) {\n        fmt.Println(\"record doesn't exist\")\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "net-http", "transport"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482176060, "post_id": 41229694, "comment_id": 69658589, "body": "You don&#39;t. The Headers are taken from the <code>*http.Request</code>. The default for DisableKeepAlives is false, which means connections will be reused whenever possible ."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482176447, "post_id": 41229694, "comment_id": 69658780, "body": "So, looks like i don&#39;t need to create Transport as its <code>DisableKeepAlives</code> is false by default."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482176454, "post_id": 41229694, "comment_id": 69658786, "body": "Also, If you&#39;re going to override the <code>DefaultTransport</code>, you should still make sure you copy all the important settings, i.e. you almost always want a DialContext with a Timeout.  (and your first 3 fields are the zero value, so setting those doesn&#39;t do anything)"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482178771, "post_id": 41229694, "comment_id": 69659981, "body": "@JimB  tried using go-routine but the number of TCP connection is piling up."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482179109, "post_id": 41229694, "comment_id": 69660125, "body": "What are you using a goroutine for? You should have a single Transport, probably the DefaultTransport, regardless of any goroutines."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482183821, "post_id": 41229694, "comment_id": 69662400, "body": "I am trying to do parallel get request from a pool of worker."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482185427, "post_id": 41229694, "comment_id": 69663161, "body": "Here is the snippet i am trying: <a href=\"https://play.golang.org/p/O2nYhbhgyI\" rel=\"nofollow noreferrer\">play.golang.org/p/O2nYhbhgyI</a> it creates lots of tcp session."}], "answers": [{"comments": [{"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482176475, "post_id": 41229784, "comment_id": 69658805, "body": "Ok let me try. So, how should i do if i want to customize the transport struct."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482176517, "post_id": 41229784, "comment_id": 69658827, "body": "@James What you are already doing. The headers though are set on the request."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482176699, "post_id": 41229784, "comment_id": 69658909, "body": "Here, I am trying to use by multiple goroutine. So, thought of creating only once and reuse it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482176817, "post_id": 41229784, "comment_id": 69658984, "body": "@James: yes, you <i>should</i> only use 1 Transport, but that still has nothing to do with setting the headers in each Request."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482176853, "post_id": 41229784, "comment_id": 69659003, "body": "@James What headers do you want to set? Depending on your protocol, you might need them only on the first write, like in grpc: <a href=\"https://github.com/grpc/grpc-go/blob/8712952b7d646dbbbc6fb73a782174f3115060f3/transport/handler_server.go#L218-L241\" rel=\"nofollow noreferrer\">github.com/grpc/grpc-go/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1482176224, "creation_date": 1482176224, "answer_id": 41229784, "question_id": 41229694, "link": "https://stackoverflow.com/questions/41229694/how-to-add-headers-info-using-transport-in-golang-net-http/41229784#41229784", "title": "How to add headers info using Transport in golang net/http", "body": "<p>Don't mix the <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">Client</a> from the Request.<br>\nThe client uses a <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">Transport</a> and run the request: <code>client.Do(req)</code></p>\n\n<p>You set header on the <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\"><code>http.Request</code></a> with <a href=\"https://golang.org/pkg/net/http/#Header.Set\" rel=\"nofollow noreferrer\"><code>(h Header) Set(key, value string)</code></a>:</p>\n\n<pre><code>req.Header.Set(\"name\", \"value\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 2, "creation_date": 1482211945, "post_id": 41232253, "comment_id": 69670527, "body": "That seems in line with what I recommended in my answer. +1"}], "tags": [], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "is_accepted": false, "score": 0, "last_activity_date": 1482187721, "creation_date": 1482187721, "answer_id": 41232253, "question_id": 41229694, "link": "https://stackoverflow.com/questions/41229694/how-to-add-headers-info-using-transport-in-golang-net-http/41232253#41232253", "title": "How to add headers info using Transport in golang net/http", "body": "<p>This is what I found:</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"io/ioutil\"\n        \"net/http\"\n    )\n\n    var URL = \"http://httpbin.org/ip\"\n\n    func main() {\n        tr := &amp;http.Transport{DisableKeepAlives: false}\n        req, _ := http.NewRequest(\"GET\", URL, nil)\n        req.Header.Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", \"Token\"))\n        req.Close = false\n\n        res, err := tr.RoundTrip(req)\n        if err != nil {\n            fmt.Println(err)\n        }\n        body, _ := ioutil.ReadAll(res.Body)\n        fmt.Println(string(body))\n    }\n</code></pre>\n\n<p>And it works.</p>\n"}, {"tags": [], "owner": {"reputation": 3279, "user_id": 1493534, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WIQKD.jpg?s=128&g=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/1493534/rakesh"}, "is_accepted": false, "score": 3, "last_activity_date": 1605564205, "last_edit_date": 1605564205, "creation_date": 1584026249, "answer_id": 60657018, "question_id": 41229694, "link": "https://stackoverflow.com/questions/41229694/how-to-add-headers-info-using-transport-in-golang-net-http/60657018#60657018", "title": "How to add headers info using Transport in golang net/http", "body": "<p>This may not be what you want for your specific question - setting it in the request makes more sense in your case, but to answer your question directly, you should be able to add a default header to all the requests going through the transport by using a custom <code>RoundTrip</code> method for your Transport.</p>\n<p>Check out <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#RoundTripper</a></p>\n<p>Something like :</p>\n<pre><code>type CustomTransport struct {\n  http.RoundTripper\n}\n\nfunc (ct *CustomTransport) RoundTrip(req *http.Request) (*http.Response, error) {\n    req.Header.Add(&quot;header-key&quot;, &quot;header-value&quot;)\n    return ct.RoundTripper.RoundTrip(req)\n}\n\nurl := &quot;http://localhost:8181/api/v1/resource&quot;\ntr := &amp;CustomTransport{\n    DisableKeepAlives:   false,\n    MaxIdleConns:        0,\n    MaxIdleConnsPerHost: 0,\n    IdleConnTimeout:     time.Second * 10,\n}\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Get(url)\n</code></pre>\n<p>I found this useful when I didn't have direct access to the <code>http</code> Client used by an API client library (or each request object directly), but it allowed me to pass in a transport.</p>\n"}], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4899, "favorite_count": 1, "accepted_answer_id": 41229784, "answer_count": 3, "score": 4, "last_activity_date": 1605564205, "creation_date": 1482175854, "question_id": 41229694, "link": "https://stackoverflow.com/questions/41229694/how-to-add-headers-info-using-transport-in-golang-net-http", "title": "How to add headers info using Transport in golang net/http", "body": "<p>I am trying to control keep-alives session to reuse the tcp connection by creating a Trasport.</p>\n\n<p>Here is my snippet and I am not sure how to add headers info for authentication.</p>\n\n<pre><code>url := \"http://localhost:8181/api/v1/resource\"\ntr := &amp;http.Transport{\n    DisableKeepAlives:   false,\n    MaxIdleConns:        0,\n    MaxIdleConnsPerHost: 0,\n    IdleConnTimeout:     time.Second * 10,\n}\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Get(url)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1482162879, "post_id": 41226376, "comment_id": 69651592, "body": "Check out this blog post: <a href=\"https://blog.golang.org/http-tracing\" rel=\"nofollow noreferrer\">The Go Blog: Introducing HTTP Tracing</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482162881, "post_id": 41226376, "comment_id": 69651593, "body": "What makes you think that this is a &quot;leak&quot;? What is the problem you&#39;re trying to solve?"}, {"owner": {"reputation": 37807, "user_id": 293686, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1426a9fd5267e73d9e30ebaac1bde144?s=128&d=identicon&r=PG", "display_name": "Maur&#237;cio Linhares", "link": "https://stackoverflow.com/users/293686/maur%c3%adcio-linhares"}, "edited": false, "score": 0, "creation_date": 1482162918, "post_id": 41226376, "comment_id": 69651622, "body": "Why would it be logging this if it wasn&#39;t a leak? For some reason this app is also going out of file handles every once in a while."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1482163073, "post_id": 41226376, "comment_id": 69651709, "body": "Seeing unexpected EOFs doesn&#39;t indicate a leak, but running out of resources like file descriptors does. Do you have timeouts around <i>everything</i>? You can&#39;t ever count on remote clients and servers responding in a specific timeframe."}, {"owner": {"reputation": 37807, "user_id": 293686, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1426a9fd5267e73d9e30ebaac1bde144?s=128&d=identicon&r=PG", "display_name": "Maur&#237;cio Linhares", "link": "https://stackoverflow.com/users/293686/maur%c3%adcio-linhares"}, "edited": false, "score": 0, "creation_date": 1482177675, "post_id": 41226376, "comment_id": 69659453, "body": "This actually points out to there being stuff being leaked: <a href=\"https://github.com/grpc/grpc-go/issues/954\" rel=\"nofollow noreferrer\">github.com/grpc/grpc-go/issues/954</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482181084, "post_id": 41226376, "comment_id": 69661033, "body": "@Maur&#237;cioLinhares: that looks suspicious, but that doesn&#39;t necessarily look like it would leak connections. A good starting point is to look at the open file descriptors for the process and see what connections are being left open -- should you be looking at GRPC at all, or is this an http server issue?"}], "owner": {"reputation": 37807, "user_id": 293686, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1426a9fd5267e73d9e30ebaac1bde144?s=128&d=identicon&r=PG", "display_name": "Maur&#237;cio Linhares", "link": "https://stackoverflow.com/users/293686/maur%c3%adcio-linhares"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 407, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482162651, "creation_date": 1482162651, "question_id": 41226376, "link": "https://stackoverflow.com/questions/41226376/how-to-track-down-a-leak-in-go", "title": "How to track down a leak in Go?", "body": "<p>My project prints a lot of:</p>\n\n<pre><code>transport: http2Client.notifyError got notified that the client transport was broken EOF.\n</code></pre>\n\n<p>The project itself is an HTTP proxy using Go's standard HTTP server and client and calls other services over GRPC. Is there any way I can figure out which piece is leaking?</p>\n"}, {"tags": ["go", "atom-editor"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1482162463, "post_id": 41226103, "comment_id": 69651299, "body": "You must set your <code>GOPATH</code> environment variable to point to your go workspace. Have you set it? You can check it by clicking on the <code>go-plus</code> icon at the bottom of Atom. You can also run <code>go env</code> in your command line."}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482162535, "post_id": 41226103, "comment_id": 69651354, "body": "<code>set GOARCH=amd64 set GOBIN= set GOEXE=.exe set GOHOSTARCH=amd64 set GOHOSTOS=windows set GOOS=windows set GOPATH=C:\\Users\\Frynio\\AppData\\Local\\atom\\app-1.12.7\\&quot;C:\\wor&zwnj;&#8203;k&quot; set GORACE= set GOROOT=C:\\Go set GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64 set CC=gcc set GOGCCFLAGS=-m64 -mthreads -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\Frynio\\AppData\\Local\\Temp\\go-bui&zwnj;&#8203;ld503348538=&#47;tmp&#47;go-&zwnj;&#8203;build -gno-record-gcc-switches set CXX=g++ set CGO_ENABLED=1</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482162668, "post_id": 41226103, "comment_id": 69651455, "body": "Looks like your <code>GOPATH</code> variable contains an invalid path. Set it to point to the folder which contains your <code>src</code>, <code>pkg</code> and <code>bin</code> folders."}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482162705, "post_id": 41226103, "comment_id": 69651483, "body": "I mean, in env variables its set to C:\\work, but Atom sets it to a different path"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482162750, "post_id": 41226103, "comment_id": 69651513, "body": "Doesn&#39;t look like it is... Run <code>go env</code>, and show only the line which contains <code>GOPATH</code>. You should not use <code>C:</code>, as that is the <i>working directory</i> on drive <code>C</code>, which may change. Use an absolute path."}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482163296, "post_id": 41226103, "comment_id": 69651849, "body": "<code>set GOPATH=C:\\work</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482163568, "post_id": 41226103, "comment_id": 69652013, "body": "The <code>set</code> command only sets the environment variable in the current shell (command line). Please restart Atom and verify by clicking on the <code>go-plus</code> icon at the bottom."}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1482163700, "post_id": 41226103, "comment_id": 69652105, "body": "Okay, I fixed it. Atom doesn&#39;t accept the path with &quot;&quot;, so I just removed them and it works. Thanks for your help!"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1482164768, "last_edit_date": 1482164768, "creation_date": 1482163835, "answer_id": 41226718, "question_id": 41226103, "link": "https://stackoverflow.com/questions/41226103/go-get-not-working-in-atom/41226718#41226718", "title": "Go get not working in Atom", "body": "<p>The <code>go get</code> command downloads and installs packages in your go workspace, as denoted by the <code>GOPATH</code> environment variable. You must set this first for Atom to be able to download utilities.</p>\n\n<p>You may use the <code>go env</code> command to verify, also you can click on the <code>go-plus</code> icon at the bottom of Atom to see the <code>GOPATH</code> value visible to Atom.</p>\n\n<p>Your screenshots and comments indicate you have an invalid folder value in your <code>GOPATH</code>. Easiest is to set it to a single, absolute folder. You can read more about it here:</p>\n\n<p><a href=\"https://golang.org/doc/code.html#GOPATH\" rel=\"nofollow noreferrer\">How to Write Go Code: The <code>GOPATH</code> environment variable</a></p>\n"}], "owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 41226718, "answer_count": 1, "score": 1, "last_activity_date": 1484699992, "creation_date": 1482161703, "last_edit_date": 1484699992, "question_id": 41226103, "link": "https://stackoverflow.com/questions/41226103/go-get-not-working-in-atom", "title": "Go get not working in Atom", "body": "<p>So I've installed Atom on Windows 7 and I wanted to try out Go language in that. I installed a package called <code>go-plus</code>, but it needed 2 more things to install:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Ijs7G.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ijs7G.png\" alt=\"enter image description here\"></a></p>\n\n<p>So I clicked Run Go Get, but I get this error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/P3HBt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P3HBt.png\" alt=\"enter image description here\"></a></p>\n\n<p>I tried it on Debian and on Manjaro and after runing Run Go Get it just works. So I thought about running <code>go get -u ...</code> in my cmd, it worked, but still when I open Atom those 2 messages pop out. How can I deal with it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2783, "user_id": 7234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e56a1b2b3064b7b91628435d9375d0a1?s=128&d=identicon&r=PG", "display_name": "HidekiAI", "link": "https://stackoverflow.com/users/7234/hidekiai"}, "edited": false, "score": 0, "creation_date": 1482166091, "post_id": 41225759, "comment_id": 69653440, "body": "Try setting Poll=true as suggested by <a href=\"https://github.com/hpcloud/tail/issues/90\" rel=\"nofollow noreferrer\">github.com/hpcloud/tail/issues/90</a>"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "reply_to_user": {"reputation": 2783, "user_id": 7234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e56a1b2b3064b7b91628435d9375d0a1?s=128&d=identicon&r=PG", "display_name": "HidekiAI", "link": "https://stackoverflow.com/users/7234/hidekiai"}, "edited": false, "score": 0, "creation_date": 1482235554, "post_id": 41225759, "comment_id": 69683346, "body": "@HidekiAI how is that relevant, when I need to open an new file and close the old tail ?"}, {"owner": {"reputation": 2783, "user_id": 7234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e56a1b2b3064b7b91628435d9375d0a1?s=128&d=identicon&r=PG", "display_name": "HidekiAI", "link": "https://stackoverflow.com/users/7234/hidekiai"}, "edited": false, "score": 0, "creation_date": 1482245308, "post_id": 41225759, "comment_id": 69689799, "body": "So are you referring to &#39;tail -F&#39; or &#39;tail -f&#39;?"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "reply_to_user": {"reputation": 2783, "user_id": 7234, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e56a1b2b3064b7b91628435d9375d0a1?s=128&d=identicon&r=PG", "display_name": "HidekiAI", "link": "https://stackoverflow.com/users/7234/hidekiai"}, "edited": false, "score": 0, "creation_date": 1482245455, "post_id": 41225759, "comment_id": 69689909, "body": "@HidekiAl &#39;tail -f&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1482161896, "post_id": 41226128, "comment_id": 69650967, "body": "Don&#39;t use that fork. It specifically says that active development has moved to <code>github.com&#47;fsnotify&#47;fsnotify</code>"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482162664, "post_id": 41226128, "comment_id": 69651451, "body": "I did, but since this process in a loop, I&#39;m not sure how to integrate my logic into it. Unfortunately there isnt enough doc in my opinion for this package."}, {"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "reply_to_user": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482162840, "post_id": 41226128, "comment_id": 69651573, "body": "use a channel to notify your application @Splendid"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482172794, "post_id": 41226128, "comment_id": 69656969, "body": "@simon_xia can u tell me then where to inject the channel within fsnotify function, I am not sure since if I get it correctly fsnotify is not closing it&#39;s own channel at all"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "edited": false, "score": 0, "creation_date": 1482228173, "post_id": 41226128, "comment_id": 69678759, "body": "@simon_xia thanks, but tail loop incorporated with &quot;close the old one and read new file&quot; will not work, since program will exit without tail loop."}], "tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 3, "last_activity_date": 1482200317, "last_edit_date": 1482200317, "creation_date": 1482161805, "answer_id": 41226128, "question_id": 41225759, "link": "https://stackoverflow.com/questions/41225759/golang-replace-previously-opened-file-when-new-file-is-created/41226128#41226128", "title": "Golang replace previously opened file when new file is created", "body": "<p>have a try with <a href=\"https://godoc.org/github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">github.com/fsnotify/fsnotify</a></p>\n\n<p>a simple example:</p>\n\n<pre><code>func newFileCheck() (newFilename chan string, err error) {\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        // do some log\n        return\n    }\n\n    err = watcher.Watch(\"testDir\")\n    if err != nil {\n        // do some log\n        return\n    }\n\n    newFilename = make(chan string)\n\n    // Process events\n    go func() {\n        for {\n            select {\n            case ev := &lt;-watcher.Event:\n                log.Println(\"event:\", ev)\n                newFilename &lt;- ev.Name // Relative path to the file\n            case err := &lt;-watcher.Error:\n                log.Println(\"error:\", err)\n            }\n        }\n    }()\n\n    return\n}\n\nfunc yourApp() {\n\n    newFilenameChan, err := newFileCheck()\n    if err != nil {\n        // err check\n    }\n\n\n    go func() {\n        for {\n            select {\n            case name := &lt;-newFilenameChan:\n                // close the old one and read new file\n            }\n        }\n    }()\n}\n</code></pre>\n\n<p>more details, see the doc</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 1, "last_activity_date": 1482394422, "last_edit_date": 1482394422, "creation_date": 1482394101, "answer_id": 41278464, "question_id": 41225759, "link": "https://stackoverflow.com/questions/41225759/golang-replace-previously-opened-file-when-new-file-is-created/41278464#41278464", "title": "Golang replace previously opened file when new file is created", "body": "<p>Treat the following as a hacked up example.</p>\n\n<p>I'm not sure about the procedure to close a <code>tail.Tail</code> properly, assuming you call <code>Stop</code> or <code>StopAtEOF</code> and then <code>Cleanup</code>.</p>\n\n<p>Also the concurrency aspects need to be refined. Goroutines need to be gracefully shut down.</p>\n\n<p>Imports :</p>\n\n<ul>\n<li>github.com/fsnotify/fsnotify</li>\n<li>github.com/hpcloud/tail</li>\n</ul>\n\n<p>Function to check for New Files :</p>\n\n<pre><code>func newFileCheck(dir string) (newFileAlert &lt;-chan string, err error) {\n\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        return\n    }\n\n    err = watcher.Add(dir)\n    if err != nil {\n        return\n    }\n\n    newFileAlertSender := make(chan string)\n    newFileAlert = newFileAlertSender\n\n    go func() {\n        for {\n            select {\n            case ev.Op := &lt;-watcher.Events:\n                log.Println(\"Event : \", ev)\n                if ev == fsnotify.Create {\n                    newFileAlertSender &lt;- ev.Name\n                }\n            case err := &lt;-watcher.Errors:\n                log.Println(\"Watcher Error : \", err)\n            }\n        }\n    }()\n\n    return\n}\n</code></pre>\n\n<p>Function to Tail a file :</p>\n\n<pre><code>func tailFile(dir, newFileName string, cfg tail.Config, stop &lt;-chan struct{}) {\n\n    t, err := tail.TailFile(dir+newFileName, cfg)\n    if err != nil {\n        log.Fatalln(\"TailFile failed - \", err)\n    }\n\n    for line := range t.Lines {\n\n        if strings.Contains(strings.ToLower(line.Text), \"mfc\") {\n            fmt.Println(\"MFC located: \", line.Text)\n            //sendEmail(line.Text)\n        }\n\n        select {\n        case &lt;-stop:\n            t.StopAtEOF()\n        default:\n        }\n\n    }\n\n    t.Cleanup()\n}\n</code></pre>\n\n<p>Main :</p>\n\n<pre><code>func main() {\n\n    dir := \"/var/log/\"\n\n    currentTime := time.Now().Local()\n    currentFileName := currentTime.Format(\"20060102\")\n    newFileName := currentFileName + \"_1111.log.txt\"\n\n    newFileAlert, err := newFileCheck(dir)\n    if err != nil {\n        log.Fatalln(\"File watching failed - \", err)\n    }\n\n    stop := make(chan struct{})\n\n    cfg := tail.Config{Follow: true, ReOpen: true}\n\n    go tailFile(dir, newFileName, cfg, stop)\n\n    for fileName := range newFileAlert {\n        stop &lt;- struct{}{}\n        go tailFile(dir, fileName, cfg, stop)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 927, "favorite_count": 2, "answer_count": 2, "score": 6, "last_activity_date": 1482394422, "creation_date": 1482160713, "question_id": 41225759, "link": "https://stackoverflow.com/questions/41225759/golang-replace-previously-opened-file-when-new-file-is-created", "title": "Golang replace previously opened file when new file is created", "body": "<p>Ok so I am monitoring certain file and doing some tail -f analysis of that file. \nHowever another application has specific logic and it will create a new file on next date or even before.</p>\n\n<p>I'm looking for a way to detect newly created file (host is linux machine) and then without restart of my current go service to start tailing newly created file.</p>\n\n<p>Here is my current logic for tailing \"current file\":</p>\n\n<pre><code>func main(){\n\n    currentTime := time.Now().Local()\n    currentFileName := strings.Replace(currentTime.Format(\"2006-01-02\"), \"-\",\"\",2)\n    newFileName := currentFileName + \"_1111.log.txt\"\n\n    //using github.com/hpcloud/tail for tail\n    t, err := tail.TailFile(\"/var/log/\"+newFileName, tail.Config{Follow: true, ReOpen: true})\n    for line := range t.Lines {\n        //fmt.Println(\"Line is:\", line.Text)\n\n        //check do we have error inside new line\n        if strings.Contains(strings.ToLower(line.Text), \"mfc\"){\n            fmt.Println(\"MFC located: \", line.Text)\n\n            //now send e-mail to all interested parties\n            //sendEmail(line.Text)\n        }\n\n    }\n\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Well current file instead 20161219_1111.log can be 20161219_2222.log or similar, and on next day it starts from 20161220_1111.log etc.</p>\n\n<p>Any hints are welcome.</p>\n"}, {"tags": ["postgresql", "go", "docker", "docker-compose"], "comments": [{"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1482157789, "post_id": 41224582, "comment_id": 69648169, "body": "Don&#39;t you need to map port 53 in your docker images?"}], "answers": [{"tags": [], "owner": {"reputation": 3548, "user_id": 2318810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34138f17ed66a94d22d50402d3ee71d2?s=128&d=identicon&r=PG", "display_name": "Lauri", "link": "https://stackoverflow.com/users/2318810/lauri"}, "is_accepted": true, "score": 4, "last_activity_date": 1482157816, "creation_date": 1482157816, "answer_id": 41224800, "question_id": 41224582, "link": "https://stackoverflow.com/questions/41224582/can-not-connect-to-postgresql-which-is-inside-of-a-docker-container/41224800#41224800", "title": "Can not connect to postgresql which is inside of a docker container", "body": "<p>You can connect to database with the service name (or alias name given in links options), in your case it's <code>db</code>. Hostname option sets the hostname by which the container knows itself. But  it will not appear in docker ps nor in the /etc/hosts file of any other container. (<a href=\"https://docs.docker.com/engine/userguide/networking/default_network/configure-dns/\" rel=\"nofollow noreferrer\">https://docs.docker.com/engine/userguide/networking/default_network/configure-dns/</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 2047665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08d49fad6bbc5432e11bed015eeb5ce5?s=128&d=identicon&r=PG", "display_name": "user2047665", "link": "https://stackoverflow.com/users/2047665/user2047665"}, "is_accepted": false, "score": 0, "last_activity_date": 1610297661, "creation_date": 1610297661, "answer_id": 65655886, "question_id": 41224582, "link": "https://stackoverflow.com/questions/41224582/can-not-connect-to-postgresql-which-is-inside-of-a-docker-container/65655886#65655886", "title": "Can not connect to postgresql which is inside of a docker container", "body": "<p>In my case, I was using <code>container_name</code> in my post-gres service and thats what was required to be set as hostname while connecting to db in application</p>\n"}], "owner": {"reputation": 155, "user_id": 1544258, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PR4kJ.jpg?s=128&g=1", "display_name": "hustas88", "link": "https://stackoverflow.com/users/1544258/hustas88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2157, "favorite_count": 0, "accepted_answer_id": 41224800, "answer_count": 2, "score": 4, "last_activity_date": 1610297661, "creation_date": 1482157118, "question_id": 41224582, "link": "https://stackoverflow.com/questions/41224582/can-not-connect-to-postgresql-which-is-inside-of-a-docker-container", "title": "Can not connect to postgresql which is inside of a docker container", "body": "<p>I'm writing a go app which is dockerized in 2 containers: db and app.</p>\n\n<p>while starting containers 'docker-compose up' I see the message: <em>dial tcp: lookup dbpgsql on 127.0.0.11:53: no such host</em></p>\n\n<pre><code>DB_ENV_DB=cldb\nDB_ENV_USER=cldb\nDB_ENV_PASS=cldb\nDB_PORT_5432_TCP_ADDR=dbpgsql\nDB_PORT_5432_TCP_PORT=5432\n</code></pre>\n\n<p>here is my docker-compose.yml</p>\n\n<pre><code>version: '2'\nservices:\n  server:\n    hostname: app\n    image: golang:1.7.3-alpine\n    build: ./server/\n    privileged: true\n    container_name: server\n    command: go run server.go\n    volumes:\n      - ../src/:/go/src/\n      - ../server.go:/go/server.go\n    links:\n      - db:db\n    ports:\n     - '8080:8080'\n   env_file: environment\n\n db:\n   hostname: dbpgsql\n   image: postgres:latest\n   container_name: db\n   environment:\n      POSTGRES_USER: cldb\n      POSTGRES_PASSWORD: cldb\n      POSTGRES_DB: cldb\n    ports:\n      - '5432:5432'\n   volumes:\n     - ./data:/docker-entrypoint-initdb.d\n</code></pre>\n\n<p>The app fails here when DB.Ping() is executed:</p>\n\n<pre><code>func InitDB(dataSourceName string) {\n    var err error\n    DB, err = sql.Open(\"postgres\", dataSourceName)\n    if err != nil {\n       log.Panic(err)\n    }\n\n    if err = DB.Ping(); err != nil {\n       log.Panic(err)\n    }\n\n    DB.SetMaxIdleConns(100)\n}\n</code></pre>\n"}, {"tags": ["go", "synchronization", "mutex"], "answers": [{"tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": true, "score": 4, "last_activity_date": 1482145857, "last_edit_date": 1482145857, "creation_date": 1482144396, "answer_id": 41220859, "question_id": 41220596, "link": "https://stackoverflow.com/questions/41220596/golang-values-containing-the-types-defined-in-this-package-should-not-be-copied/41220859#41220859", "title": "Golang: Values containing the types defined in this package should not be copied", "body": "<p>It would simply not work as a synchronization primitive anymore. At best you would get unpredictable behavior.\nThink of a lock (for instance) as a flag. If it is locked, the flag is set. If you copy that lock (you copy the flag's state), the copy would behave as if it was locked while it\u2019s not. If you unlock the copy, the original won\u2019t change so it will behave as if it was locked while it\u2019s not supposed to be locked anymore.</p>\n"}], "owner": {"reputation": 513, "user_id": 5673789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ade403dabcac1cdd5cd25bbd600f7ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jsmith", "link": "https://stackoverflow.com/users/5673789/jsmith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 41220859, "answer_count": 1, "score": 3, "last_activity_date": 1482145857, "creation_date": 1482143533, "question_id": 41220596, "link": "https://stackoverflow.com/questions/41220596/golang-values-containing-the-types-defined-in-this-package-should-not-be-copied", "title": "Golang: Values containing the types defined in this package should not be copied", "body": "<p>The link <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/</a> states \"Values containing the types defined in this package should not be copied.\"</p>\n\n<p>Why is it so? What would happen if I ignore the advice ?</p>\n"}, {"tags": ["windows", "memory", "go", "bmp", "dib"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482154912, "post_id": 41220587, "comment_id": 69646356, "body": "You need to know how big <code>CF_BITMAP</code> data is. What does <code>getClipboardData</code> do?"}, {"owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482158247, "post_id": 41220587, "comment_id": 69648483, "body": "Well, CF_BITMAP is just telling the call what type of data we&#39;re requesting, it&#39;s equal to 2. The size of the image/bitmap will be related to the resolution, but I couldn&#39;t come up with a number if that&#39;s what you mean. getClipboardData returns a uintptr, which is supposed to be a pointer to the image data. I just don&#39;t know the proper way to access it. I don&#39;t quite understand how the text string version works, perhaps you or someone else here knows how it works and what a buffer version might look like."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482160512, "post_id": 41220587, "comment_id": 69650024, "body": "From a quick glance at <code>github.com&#47;atotto&#47;clipboard</code>, your example would <i>not</i> work for text, because <code>handle</code> isn&#39;t a pointer to a null terminated string, it&#39;s a WINAPI HANDLE. The same goes for the bitmap, a pointer is different than a HANDLE.  This isn&#39;t really just about &quot;retrieving&quot; some memory via a pointer, you should use the windows APIs to access the bitmap through the given handle."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1482228041, "last_edit_date": 1495542824, "creation_date": 1482214266, "answer_id": 41235940, "question_id": 41220587, "link": "https://stackoverflow.com/questions/41220587/how-can-i-retrieve-an-image-data-buffer-from-clipboard-memory-uintptr/41235940#41235940", "title": "How can I retrieve an image data buffer from clipboard memory (uintptr)?", "body": "<p>@JimB is correct: <code>user32!GetClipboardData()</code> returns a <code>HGLOBAL</code>, and a comment example <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms649039\" rel=\"nofollow noreferrer\">over there</a> suggests using <code>kernel32!GlobalLock()</code> to a) globally lock that handle, and b) yield a proper pointer to the memory referred to by it.</p>\n\n<p>You will need to <code>kernel32!GlobalUnlock()</code> the handle after you're done with it.</p>\n\n<p>As to converting pointers obtained from Win32 API functions to something readable by Go, the usual trick is casting the pointer to an insanely large slice. To cite the \"Turning C arrays into Go slices\" of <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">\"the Go wiki article on <code>cgo</code>\"</a>:</p>\n\n<blockquote>\n  <p>To create a Go slice backed by a C array (without copying the original\n  data), one needs to acquire this length at runtime and use a type\n  conversion to a pointer to a very big array and then slice it to the\n  length that you want (also remember to set the cap if you're using Go 1.2 > or later), for example (see <a href=\"http://play.golang.org/p/XuC0xqtAIC\" rel=\"nofollow noreferrer\">http://play.golang.org/p/XuC0xqtAIC</a> for a\n  runnable example):</p>\n\n<pre><code>import \"C\"\nimport \"unsafe\"\n...\nvar theCArray *C.YourType = C.getTheArray()\nlength := C.getTheArrayLength()\nslice := (*[1 &lt;&lt; 30]C.YourType)(unsafe.Pointer(theCArray))[:length:length]\n</code></pre>\n  \n  <p>It is important to keep in mind that the Go garbage collector will not\n  interact with this data, and that if it is freed from the C side of\n  things, the behavior of any Go code using the slice is nondeterministic.</p>\n</blockquote>\n\n<p>In your case it will be simpler:</p>\n\n<pre><code>h := GlobalLock()\ndefer GlobalUnlock(h)\nlength := somehowGetLengthOfImageInTheClipboard()\nslice := (*[1 &lt;&lt; 30]byte)(unsafe.Pointer((uintptr(h)))[:length:length]\n</code></pre>\n\n<p>Then you need to actually read the bitmap.</p>\n\n<p>This depends on the format of the Device-Independent Bitmap (DIB) available for export from the clipboard.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/30552856/720999\">this</a> and <a href=\"https://stackoverflow.com/a/38176167/720999\">this</a> for a start.</p>\n\n<p>As usually, definitions of <code>BITMAPINFOHEADER</code> etc are easily available online in the MSDN site.</p>\n"}], "owner": {"reputation": 2459, "user_id": 439745, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/16a8ca59efba12bdd0fb9b484ea82833?s=128&d=identicon&r=PG", "display_name": "Kesarion", "link": "https://stackoverflow.com/users/439745/kesarion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 1, "accepted_answer_id": 41235940, "answer_count": 1, "score": 0, "last_activity_date": 1482233158, "creation_date": 1482143494, "last_edit_date": 1482233158, "question_id": 41220587, "link": "https://stackoverflow.com/questions/41220587/how-can-i-retrieve-an-image-data-buffer-from-clipboard-memory-uintptr", "title": "How can I retrieve an image data buffer from clipboard memory (uintptr)?", "body": "<p>I'm trying to use syscall with user32.dll to get the contents of the clipboard. I expect it to be image data from a Print Screen.</p>\n\n<p>Right now I've got this:</p>\n\n<pre><code>if opened := openClipboard(0); !opened {\n    fmt.Println(\"Failed to open Clipboard\")\n}\n\nhandle := getClipboardData(CF_BITMAP)\n\n// get buffer\n\nimg, _, err := Decode(buffer)\n</code></pre>\n\n<p>I need to get the data into a readable buffer using the handle.</p>\n\n<p>I've had some inspiration from AllenDang/w32 and atotto/clipboard on github. The following would work for text, based on atotto's implementation:</p>\n\n<pre><code>text := syscall.UTF16ToString((*[1 &lt;&lt; 20]uint16)(unsafe.Pointer(handle))[:])\n</code></pre>\n\n<p>But how can I get a buffer containing image data I can decode?</p>\n\n<p>[Update]</p>\n\n<p>Going by the solution @kostix provided, I hacked together a half working example:</p>\n\n<pre><code>image.RegisterFormat(\"bmp\", \"bmp\", bmp.Decode, bmp.DecodeConfig)\n\nif opened := w32.OpenClipboard(0); opened == false {\n    fmt.Println(\"Error: Failed to open Clipboard\")\n}\n\n//fmt.Printf(\"Format: %d\\n\", w32.EnumClipboardFormats(w32.CF_BITMAP))\nhandle := w32.GetClipboardData(w32.CF_DIB)\nsize := globalSize(w32.HGLOBAL(handle))\nif handle != 0 {\n    pData := w32.GlobalLock(w32.HGLOBAL(handle))\n    if pData != nil {\n        data := (*[1 &lt;&lt; 25]byte)(pData)[:size]\n        // The data is either in DIB format and missing the BITMAPFILEHEADER\n        // or there are other issues since it can't be decoded at this point\n        buffer := bytes.NewBuffer(data)\n        img, _, err := image.Decode(buffer)\n        if err != nil {\n            fmt.Printf(\"Failed decoding: %s\", err)\n            os.Exit(1)\n        }\n\n        fmt.Println(img.At(0, 0).RGBA())\n    }\n\n    w32.GlobalUnlock(w32.HGLOBAL(pData))\n}\nw32.CloseClipboard()\n</code></pre>\n\n<p>AllenDang/w32 contains most of what you'd need, but sometimes you need to implement something yourself, like globalSize():</p>\n\n<pre><code>var (\n    modkernel32    = syscall.NewLazyDLL(\"kernel32.dll\")\n    procGlobalSize = modkernel32.NewProc(\"GlobalSize\")\n)\n\nfunc globalSize(hMem w32.HGLOBAL) uint {\n    ret, _, _ := procGlobalSize.Call(uintptr(hMem))\n\n    if ret == 0 {\n        panic(\"GlobalSize failed\")\n    }\n\n    return uint(ret)\n}\n</code></pre>\n\n<p>Maybe someone will come up with a solution to get the BMP data. In the meantime I'll be taking a different route.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482145003, "post_id": 41220586, "comment_id": 69640622, "body": "You cannot do this in Go as Go is not C."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 1, "creation_date": 1482145005, "post_id": 41220586, "comment_id": 69640623, "body": "I don&#39;t think your C code works. It simply cast a pointer to a float into a pointer to an int which means you are misleading the runtime into thinking than an int is stored at that address (ints and floats have very different binary formats). Go prevent you from making that sort of mistake (despite supporting the concept of pointer)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482165640, "post_id": 41220586, "comment_id": 69653225, "body": "Do you <i>really</i> want the float value read directly as an int, or are you trying to convert the float32 value to an int32 value?"}, {"owner": {"reputation": 287, "user_id": 7315901, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6bd8ea5e6e6148618ca4e817956b2258?s=128&d=identicon&r=PG&f=1", "display_name": "Kiochan", "link": "https://stackoverflow.com/users/7315901/kiochan"}, "edited": false, "score": 0, "creation_date": 1482242579, "post_id": 41220586, "comment_id": 69687928, "body": "I don&#39;t want convert something like &quot;3.0&quot; to &quot;3&quot;. I want get the data on bit-level."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 11, "last_activity_date": 1482147896, "creation_date": 1482147896, "answer_id": 41221876, "question_id": 41220586, "link": "https://stackoverflow.com/questions/41220586/how-can-i-convert-pointer-type-in-golang/41221876#41221876", "title": "How can I convert pointer type in golang", "body": "<p>You absolutely can do this in Go. There are two ways. One safe and one unsafe:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"math\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var f float32\n    var i int32\n\n    // unsafe\n    f = 1.234\n    i = *((*int32)(unsafe.Pointer(&amp;f)))\n    fmt.Println(f, i)\n\n    // safe\n    var tmp [4]byte\n    f = 1.234\n    binary.LittleEndian.PutUint32(tmp[:], math.Float32bits(f))\n    i = int32(binary.LittleEndian.Uint32(tmp[:]))\n    fmt.Println(f, i)\n}\n</code></pre>\n"}], "owner": {"reputation": 287, "user_id": 7315901, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6bd8ea5e6e6148618ca4e817956b2258?s=128&d=identicon&r=PG&f=1", "display_name": "Kiochan", "link": "https://stackoverflow.com/users/7315901/kiochan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6593, "favorite_count": 2, "accepted_answer_id": 41221876, "answer_count": 1, "score": 6, "last_activity_date": 1482147896, "creation_date": 1482143488, "question_id": 41220586, "link": "https://stackoverflow.com/questions/41220586/how-can-i-convert-pointer-type-in-golang", "title": "How can I convert pointer type in golang", "body": "<p>I want convert something like (*float32) to (*int32)</p>\n\n<p>I do this</p>\n\n<pre><code>var f float32 = 0.0\nvar p *int32 = (*int32)(&amp;f) // error!\n// cannot convert &amp;f (type *float32) to type *int32\n</code></pre>\n\n<p>How can I do this like what I'm done in C</p>\n\n<pre><code>float f = 0.0;\nint *ip = (*int) &amp;fp;\n</code></pre>\n"}, {"tags": ["go", "git-bash"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1482130841, "post_id": 41217290, "comment_id": 69633068, "body": "If you build it to <code>exe</code> - why don&#39;t you run it directly?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1482137016, "post_id": 41217290, "comment_id": 69635748, "body": "you need to add $GOPATH/bin to your system PATH"}, {"owner": {"reputation": 9, "user_id": 7315271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba4be03b247a75a54254a5692a1cade4?s=128&d=identicon&r=PG&f=1", "display_name": "Yash Chetnani", "link": "https://stackoverflow.com/users/7315271/yash-chetnani"}, "edited": false, "score": 0, "creation_date": 1482168770, "post_id": 41217290, "comment_id": 69654951, "body": "I&#39;ve already set the Path variable to my current working directory"}], "answers": [{"tags": [], "owner": {"reputation": 416, "user_id": 2560234, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7c16c1eaf4106951c072f9514228410f?s=128&d=identicon&r=PG&f=1", "display_name": "jste89", "link": "https://stackoverflow.com/users/2560234/jste89"}, "is_accepted": false, "score": 0, "last_activity_date": 1482334751, "creation_date": 1482334751, "answer_id": 41266576, "question_id": 41217290, "link": "https://stackoverflow.com/questions/41217290/installing-and-building-go/41266576#41266576", "title": "installing and building Go", "body": "<p>The problem you're facing is due to the way you're referencing the GOPATH. In Bash (and every shell I've used), variables are accessed by preceding the variable name with a dollar ($) symbol, like so:</p>\n\n<pre><code>echo $GOPATH\n</code></pre>\n\n<p>so what you should be using to run your program is:</p>\n\n<pre><code>$GOPATH/bin/hello\n</code></pre>\n\n<p>(Note: in Bash paths are separated with forward slashes, rather than the back slashes used in Windows)</p>\n\n<h2>An explanation of the error message</h2>\n\n<p>In bash and other shells, the percentage (%) symbol is used to reference stopped jobs. For example, we could do:</p>\n\n<pre><code>vim\n</code></pre>\n\n<p>(vim opens)</p>\n\n<p>pressing ctrl + z will then send a stop signal to vim and return you to the shell. typing\n    jobs\nwill then give you a list of stopped jobs:</p>\n\n<pre><code>jobs\n[1]+  Stopped                 vim  (wd: ~)\n</code></pre>\n\n<p>you can then re-start the job, bringing it back to the foreground using </p>\n\n<pre><code>%1\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fg %1\n</code></pre>\n\n<p>(one being the number of the stopped job),</p>\n"}], "owner": {"reputation": 9, "user_id": 7315271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba4be03b247a75a54254a5692a1cade4?s=128&d=identicon&r=PG&f=1", "display_name": "Yash Chetnani", "link": "https://stackoverflow.com/users/7315271/yash-chetnani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 422, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1482334751, "creation_date": 1482130740, "question_id": 41217290, "link": "https://stackoverflow.com/questions/41217290/installing-and-building-go", "title": "installing and building Go", "body": "<p>after installing go and setting the GOPATH value while trying to execute a file present in bin(hello.exe) as %GOPATH%\\bin\\hello,the error shows bash:fg: no such job(used gitbash)</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1482122972, "post_id": 41215720, "comment_id": 69630566, "body": "While I tend to agree with Yandry here in that I&#39;d also let proto create the Go stubs for me rather than trying to do it manually (that&#39;s one big point for it) I&#39;d also be interested in doing it manually. At the end of the day the code must be there, since the automagic generation uses it, maybe based on reflection? I guess it&#39;s Star Wars time \u2026 use the source :)"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "reply_to_user": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 1, "creation_date": 1482124641, "post_id": 41215720, "comment_id": 69630961, "body": "there is an example here <a href=\"https://jacobmartins.com/2016/05/24/practical-golang-using-protobuffs/\" rel=\"nofollow noreferrer\">jacobmartins.com/2016/05/24/practical-golang-using-protobuff&zwnj;&#8203;s</a> you can check the generated code"}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1482125631, "post_id": 41215720, "comment_id": 69631254, "body": "For a map named children with key and value of type string, the generated tags look like this: <code>protobuf:&quot;bytes,1,rep,name=children&quot; json:&quot;children,omitempty&quot; protobuf_key:&quot;bytes,1,opt,name=key&quot; protobuf_val:&quot;bytes,2,opt,name=value&quot;</code>."}, {"owner": {"reputation": 305, "user_id": 382775, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a05c691ed1349d80fbd2aed10a043d9a?s=128&d=identicon&r=PG", "display_name": "dmikalova", "link": "https://stackoverflow.com/users/382775/dmikalova"}, "edited": false, "score": 0, "creation_date": 1482128648, "post_id": 41215720, "comment_id": 69632214, "body": "Ah, thanks. The example I was following for some reason does a manual marshal and unmarshal. I&#39;ll be able to test this out tomorrow.  What&#39;s the semantic difference between protocol buffer and protobuf? The page you linked me to says protocol buffer all over it."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1482131558, "post_id": 41215720, "comment_id": 69633388, "body": "Ops my bad I thought you were referring to a generic protocol buffer after read <i>a protocol buffer</i>, but yes Protocol Buffer == protobuf :)"}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": true, "score": 3, "last_activity_date": 1482131306, "last_edit_date": 1482131306, "creation_date": 1482121368, "answer_id": 41215720, "question_id": 41215340, "link": "https://stackoverflow.com/questions/41215340/how-to-serialize-a-go-map-into-a-protobuff/41215720#41215720", "title": "How to serialize a Go map into a protobuff", "body": "<p><a href=\"https://developers.google.com/protocol-buffers/docs/gotutorial\" rel=\"nofollow noreferrer\">protobuf</a> is a well defined searlization format and one of the benefits of use it, it generates all the data structures for you(on your favorite language) just using the protobuf schema, e.i. you don't have to do a manual marshal or unmarshal</p>\n"}], "owner": {"reputation": 305, "user_id": 382775, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a05c691ed1349d80fbd2aed10a043d9a?s=128&d=identicon&r=PG", "display_name": "dmikalova", "link": "https://stackoverflow.com/users/382775/dmikalova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2759, "favorite_count": 1, "accepted_answer_id": 41215720, "answer_count": 1, "score": 5, "last_activity_date": 1482131306, "creation_date": 1482117726, "question_id": 41215340, "link": "https://stackoverflow.com/questions/41215340/how-to-serialize-a-go-map-into-a-protobuff", "title": "How to serialize a Go map into a protobuff", "body": "<p>I'm following <a href=\"https://medium.com/wtf-dial/wtf-dial-boltdb-a62af02b8955#.ubbug64d7\" rel=\"noreferrer\">this</a> tutorial and got to the part on serializing/marshaling Go structs into a protocol buffer. My struct has a map and I can't find any documentation on how to handle marshaling a map.</p>\n\n<p>In the following I want to serialize <code>Fields map[string]string</code>:</p>\n\n<p>Go struct:</p>\n\n<pre><code>type Note struct {\n    ID     NoteID\n    Fields map[string]string\n}\n</code></pre>\n\n<p>protobuf schema:</p>\n\n<pre><code>package internal;\n\nmessage Note {\n    optional int64 ID = 1;\n    optional map&lt;string, string&gt; Fields = 2;\n}\n</code></pre>\n\n<p>Go marshal:</p>\n\n<pre><code>func MarshalNote(n *remember.Note) ([]byte, error) {\n    return proto.Marshal(&amp;Note{\n        ID: proto.Int64(int64(n.ID))\n        Fields: proto.???\n    })\n}\n</code></pre>\n\n<p>I have no idea what to do for the last line and anything I search for talks about mapping a field to a protobuf scheme, and not about mapping a map to a protobuf scheme.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1482107621, "post_id": 41214278, "comment_id": 69627534, "body": "I&#39;m not sure I completely understand your question, but if you want to implement a priority queue and have control over the API, you should create your own type and expose whatever you want to the outside world. Internally, you can use <code>PriorityQueue</code> if that does what you want it to do. Can you post some code to indicate what it is you want to implement?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1482108682, "post_id": 41214278, "comment_id": 69627754, "body": "<code>heap.Interface</code> docs: <i>... <code>Push</code> and <code>Pop</code> in this interface are for package <code>heap</code>&#39;s implementation to call. To add and remove things from the heap, use <code>heap.Push</code> and <code>heap.Pop</code>.</i> It makes sense if you think about it. If you don&#39;t want to make use of package <code>heap</code>&#39;s benefits, there&#39;s nothing wrong with implementing a priority queue yourself. As far as I can tell, it only provides efficient insertion/lookup due to its tree-based functionality. For example, it essentially takes your simple <code>Push</code> method and inserts it where it&#39;s necessary, so you need not do the same."}, {"owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "edited": false, "score": 0, "creation_date": 1482108771, "post_id": 41214278, "comment_id": 69627765, "body": "I think I managed to answer my own question. I created another type, RunePriorityQueue, which is a struct whos only member is a PriorityQueue. It also has Push and Pop, which just call heap.Push and heap.Pop on its memper PriorityQueue."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1482108804, "post_id": 41214278, "comment_id": 69627773, "body": "You&#39;re free to wrap the functionality using your own methods of course. You might have a private <code>priorityQueue</code> that does the work with <code>PriorityQueue</code> being the user-facing implementation with appropriate <code>Push</code> and <code>Pop</code> methods that call <code>heap.Push</code> and <code>heap.Pop</code> respectively."}, {"owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "edited": false, "score": 0, "creation_date": 1482109285, "post_id": 41214278, "comment_id": 69627866, "body": "Thank you all for the help."}], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "is_accepted": true, "score": 1, "last_activity_date": 1482108846, "creation_date": 1482108846, "answer_id": 41214468, "question_id": 41214278, "link": "https://stackoverflow.com/questions/41214278/how-do-i-hide-the-heap-methods-from-the-user-when-writing-a-priority-queue/41214468#41214468", "title": "How do I hide the heap methods from the user when writing a priority queue?", "body": "<p>I created a wrapper class which calls heap.Push and heap.Pop.</p>\n\n<pre><code>package huffman\n\nimport \"container/heap\"\n\ntype RunePriorityQueue struct {\n    queue PriorityQueue\n}\n\nfunc (RunePriorityQueue) NewRunePriorityQueue() *RunePriorityQueue {\n    newRPQ := new(RunePriorityQueue)\n    heap.Init(&amp;newRPQ.queue)\n    return newRPQ\n}\n\nfunc (rpq *RunePriorityQueue) Push(item *Item) {\n    heap.Push(&amp;rpq.queue, item)\n}\n\nfunc (rpq *RunePriorityQueue) Pop() *Item {\n    return heap.Pop(&amp;rpq.queue).(*Item)\n}\n</code></pre>\n"}], "owner": {"reputation": 1041, "user_id": 2577326, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a271c324eda7467ebd83e03b290eb671?s=128&d=identicon&r=PG", "display_name": "michaelAdam", "link": "https://stackoverflow.com/users/2577326/michaeladam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 41214468, "answer_count": 1, "score": -2, "last_activity_date": 1482108846, "creation_date": 1482106541, "question_id": 41214278, "link": "https://stackoverflow.com/questions/41214278/how-do-i-hide-the-heap-methods-from-the-user-when-writing-a-priority-queue", "title": "How do I hide the heap methods from the user when writing a priority queue?", "body": "<p>I'm following <a href=\"https://golang.org/pkg/container/heap/\" rel=\"nofollow noreferrer\">this code</a> to implement a priority queue. The thing I don't like is that when using it in the main method, the user has to call heap.Push and heap.Pop. It would make more sense to me to have my Priority queue contain a heap, rather than wrapping it in a heap. Am I thinking about this wrong, or does the example code show the right way to do it in Golang?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 1, "last_activity_date": 1482092739, "creation_date": 1482092739, "answer_id": 41212530, "question_id": 41212445, "link": "https://stackoverflow.com/questions/41212445/how-to-read-float-notation-in-golang/41212530#41212530", "title": "How to read float notation in golang?", "body": "<p>It is the same number. You can use <code>fmt.Printf(\"My Float: %.6f\\n\",f)</code> if you don't like the scientific notation. (This format requests that 6 digits will be printed after the decimal point.)</p>\n"}, {"tags": [], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "is_accepted": false, "score": 3, "last_activity_date": 1482092922, "creation_date": 1482092922, "answer_id": 41212553, "question_id": 41212445, "link": "https://stackoverflow.com/questions/41212445/how-to-read-float-notation-in-golang/41212553#41212553", "title": "How to read float notation in golang?", "body": "<p>In order to print your floats in a regular way you can do something like this example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\n\nfunc main() {\n    a, _ := strconv.ParseFloat(\"0.000004\", 64)\n    b, _ := strconv.ParseFloat(\"0.0000000004\", 64)\n    c := fmt.Sprintf(\"10.0004\")\n    cc, _ := strconv.ParseFloat(c, 64)\n    fmt.Printf(\"%.6f\\n\", a)     // 6 numbers after the point\n    fmt.Printf(\"%.10f\\n\", b)    // 10 numbers afer the point\n    fmt.Printf(\"%.4f\\n\", cc)    // 4 numbers after the point\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0.000004\n0.0000000004\n10.0004\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1509215324, "last_edit_date": 1509215324, "creation_date": 1482139064, "answer_id": 41219253, "question_id": 41212445, "link": "https://stackoverflow.com/questions/41212445/how-to-read-float-notation-in-golang/41219253#41219253", "title": "How to read float notation in golang?", "body": "<p>The notation is called <a href=\"https://en.wikipedia.org/wiki/Scientific_notation\" rel=\"nofollow noreferrer\">Scientific notation</a>, and it is a convenient way to print very small or very large numbers in compact, short form.</p>\n\n<p>It has the form of</p>\n\n<blockquote>\n  <p><em>m</em> \u00d7 10<sup><em>n</em></sup></p>\n</blockquote>\n\n<p>(<em>m</em> times ten raised to the power of <em>n</em>)</p>\n\n<p>In programming languages it is written / printed as:</p>\n\n<blockquote>\n  <p><em>m</em><code>e</code><em>n</em></p>\n</blockquote>\n\n<p>See <a href=\"https://golang.org/ref/spec#Floating-point_literals\" rel=\"nofollow noreferrer\">Spec: Floating-point literals</a>.</p>\n\n<p>Your number: <code>4e-06</code>, where <code>m=4</code> and <code>n=-6</code>, which means <code>4*10</code><sup><code>-6</code></sup> which equals to <code>0.000004</code>.</p>\n"}], "owner": {"reputation": 721, "user_id": 2108258, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/7b01fe08a510994b22f4c9d976d66bda?s=128&d=identicon&r=PG", "display_name": "user2108258", "link": "https://stackoverflow.com/users/2108258/user2108258"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7686, "favorite_count": 0, "accepted_answer_id": 41219253, "answer_count": 3, "score": 6, "last_activity_date": 1509215324, "creation_date": 1482092208, "question_id": 41212445, "link": "https://stackoverflow.com/questions/41212445/how-to-read-float-notation-in-golang", "title": "How to read float notation in golang?", "body": "<p>When printing out some values from a map of structs. I see certain float64 values with alternative notation. The test passes but how do you read this notation (4e-06).  Is this value indeed the same as \"0.000004\"?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"testing\"\n)\n\nfunc TestXxx(t *testing.T) {\n\n    num := fmt.Sprintf(\"%f\", float64(1.225788)-float64(1.225784)) // 0.000004  \n    f, _ := strconv.ParseFloat(num, 64)\n    if f == 0.000004 {\n        t.Log(\"Success\")\n    } else {\n        t.Error(\"Not Equal\", num)\n    }\n\n    if getFloat(f) == 0.000004 {\n        t.Log(\"Success\")\n    }else{\n        t.Error(\"Fail\", getFloat(f))\n    }\n}\n\nfunc getFloat(f float64) float64 {\n    fmt.Println(\"My Float:\",f) //  4e-06\n    return f\n}\n</code></pre>\n"}, {"tags": ["go", "net-http", "gorequest"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1482089077, "post_id": 41211527, "comment_id": 69622809, "body": "The underlying Transport should try to reuse connections when possible. Are you using a current version of Go? Does the same thing happen if you use only a standard <code>http.Client</code>?"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482091287, "post_id": 41211527, "comment_id": 69623402, "body": "I am using go version 1.7, ya it happens the same when i used http.Client."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482091713, "post_id": 41211527, "comment_id": 69623521, "body": "Are you certain the server isn&#39;t closing the connection or sending a <code>Connection: close</code> header? Is it responding with http/1.1? Does it work with another client like curl?"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482092589, "post_id": 41211527, "comment_id": 69623772, "body": "Sever is closing the conneciton after sometime, but when i do <code>netstat -an | grep PORT</code> show up all the connection. Ya it return <code>Proto:&quot;HTTP&#47;1.1.</code>"}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482093298, "post_id": 41211527, "comment_id": 69623975, "body": "Yes i tried curl and it create new TCP connection for every curl."}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 2, "creation_date": 1482131560, "post_id": 41211527, "comment_id": 69633390, "body": "It&#39;s a bug in Gorequest where it creates a new Transport for every request. See the open issue here <a href=\"https://github.com/parnurzeal/gorequest/issues/75#issuecomment-231979117\" rel=\"nofollow noreferrer\">github.com/parnurzeal/gorequest/issues/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482155195, "post_id": 41211527, "comment_id": 69646510, "body": "@James: First, I would reevaluate your choice of using <code>gorequest</code> at all (if it can&#39;t handle a basic concept of not discarding Transports and leaking connections, I question the overall quality), since the http package itself is not difficult to use. If you can&#39;t solve your issue that way, we need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to try and diagnose the actual problem here."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1482171658, "post_id": 41211527, "comment_id": 69656500, "body": "@nadh ya it works for sequential post after setting <code>request.Transport.DisableKeepAlives = false</code>  but not for parallel goroutine. I need to check out more."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482171700, "post_id": 41211527, "comment_id": 69656512, "body": "@JimB Thank you so much for your effort and tips. Let me try using native net/http library and will let you know."}], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 888, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482092888, "creation_date": 1482085932, "last_edit_date": 1482092888, "question_id": 41211527, "link": "https://stackoverflow.com/questions/41211527/reuse-same-tcp-connection-in-golang-using-gorequest", "title": "Reuse same TCP connection in Golang using gorequest", "body": "<p>Here I am trying to POST 20 docs to my webservice using <a href=\"https://github.com/parnurzeal/gorequest\" rel=\"nofollow noreferrer\">gorequest</a>, but it creates 20 different TCP connection. </p>\n\n<p>How can I make sure it use only one TCP connection instead of 20 or reuse the same connection.</p>\n\n<p>Snippets:</p>\n\n<pre><code>request := gorequest.New()\nfor i := 1; i &lt;= 20; i++ {\n    jsonH := `{\"hostname\": \"node1\"}`\n    req := request.Post(url).\n        Set(\"Content-Type\", \"application/json\").\n        Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", RWToken)).\n        Send(jsonH)\n\n    resp, _, _ := req.End()\n    fmt.Printf(\"%T\", req)\n\n    logs.Info(resp.StatusCode)\n}\n</code></pre>\n\n<p>When i do <code>netstat -an | grep 8181</code></p>\n\n<pre><code>tcp        0      0 192.168.0.1:8181         0.0.0.0:*                   LISTEN\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60929        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60928        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60945        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60944        TIME_WAIT\ntcp        0      0 192.168.0.1:60927        192.168.0.1:8181         TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60946        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60943        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60947        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60934        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60936        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60935        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60940        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60932        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60939        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60941        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60930        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60937        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60933        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60938        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60931        TIME_WAIT\ntcp        0      0 192.168.0.1:8181         192.168.0.1:60942        TIME_WAIT\n</code></pre>\n"}, {"tags": ["performance", "go", "goroutine"], "comments": [{"owner": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "edited": false, "score": 0, "creation_date": 1482076047, "post_id": 41209838, "comment_id": 69618711, "body": "for ns/op it looks like when the number is big the performance dips fast. Goroutines are maintained over small amount of threads and should be very fast as there is no context switch. But, may be, when the number is really big the performance starts to fall. At least your data says so. What about you make a more sophisticated divide and conquer? Instead of the naive version that you are using right now? However, kudos to you for doing such an effort."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1482077510, "post_id": 41209838, "comment_id": 69619188, "body": "Maybe you are not CPU-bound but memory bound? If access to memory is the slowest part, than throwing more CPU and more cache misses on the problem is not helpful."}, {"owner": {"reputation": 31, "user_id": 7313157, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-blsvOPoiLv8/AAAAAAAAAAI/AAAAAAAAAv4/ufhzn3g_lQA/photo.jpg?sz=128", "display_name": "Alex S&#225;nchez", "link": "https://stackoverflow.com/users/7313157/alex-s%c3%a1nchez"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482145237, "post_id": 41209838, "comment_id": 69640754, "body": "@Volker I think you are right, after all <code>Series.Subset</code> has a part where the indexes are parsed and then it&#39;s pretty much copying the data according to the indexes. That would explain why the performance gains we observe when the length of the indexes is big is not very significative. There is not a way to perform copies concurrently then?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1482146163, "post_id": 41209838, "comment_id": 69641241, "body": "I doubt I could give a definitive answer here, it really depends. Probably there is room for improvement but finding ways to do it would require deep understanding of your workload and profiling the app in detail."}, {"owner": {"reputation": 1230, "user_id": 965724, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5395c41b2ec6b180a1e28193596b9f49?s=128&d=identicon&r=PG", "display_name": "mlg", "link": "https://stackoverflow.com/users/965724/mlg"}, "edited": false, "score": 0, "creation_date": 1483075968, "post_id": 41209838, "comment_id": 69984350, "body": "Did you try 2 goroutines rather than n? I usually get benefits by parallelising when the process is lengthy. Also, you might want to have a real-time CPU monitor to see what the binary is actually doing from beginning to end; you don&#39;t get that from pprof. You could try this as well: <a href=\"https://github.com/uber/go-torch\" rel=\"nofollow noreferrer\">github.com/uber/go-torch</a>"}], "answers": [{"tags": [], "owner": {"reputation": 256, "user_id": 8247959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fef982df359995ae04d20a971787ec41?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Novgorodov", "link": "https://stackoverflow.com/users/8247959/igor-novgorodov"}, "is_accepted": false, "score": 1, "last_activity_date": 1501769835, "creation_date": 1501769835, "answer_id": 45486858, "question_id": 41209838, "link": "https://stackoverflow.com/questions/41209838/goroutines-overhead-and-performance-analysis-when-subsetting-dataframes-gota/45486858#45486858", "title": "Goroutines overhead and performance analysis when subsetting DataFrames (Gota)", "body": "<p>Goroutines are cheap, but not free.</p>\n\n<p>I didn't read your code, but if you are spawning NCOLS_INDEXSIZE goroutines for <em>each</em> row you process, then it's a very bad practice.</p>\n\n<p>This can be seen in your benchmark where you have 2k columns and only 1k rows - you get very big improvement. But in all other cases, when number of columns &lt;&lt; number of rows, goroutine spawning becomes a bottleneck.</p>\n\n<p>Instead you should spawn a pool of goroutines (close to your CPU count) and distribute work between them through channels - it's the canonical way. You may want to read <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n"}], "owner": {"reputation": 31, "user_id": 7313157, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-blsvOPoiLv8/AAAAAAAAAAI/AAAAAAAAAv4/ufhzn3g_lQA/photo.jpg?sz=128", "display_name": "Alex S&#225;nchez", "link": "https://stackoverflow.com/users/7313157/alex-s%c3%a1nchez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 963, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1501769835, "creation_date": 1482074627, "question_id": 41209838, "link": "https://stackoverflow.com/questions/41209838/goroutines-overhead-and-performance-analysis-when-subsetting-dataframes-gota", "title": "Goroutines overhead and performance analysis when subsetting DataFrames (Gota)", "body": "<p>I've been working since the beginning of 2016 on implementing a Pandas/R DataFrame implementation for Go: <a href=\"https://github.com/kniren/gota\" rel=\"nofollow noreferrer\">https://github.com/kniren/gota</a>.</p>\n\n<p>Recently, I've been focusing on improving the performance of the library to try to match that of Pandas/Dplyr. You can follow the progress so far here: <a href=\"https://github.com/kniren/gota/issues/16\" rel=\"nofollow noreferrer\">https://github.com/kniren/gota/issues/16</a></p>\n\n<p>Since one of the more frequently used operations is the DataFrame subsetting, I thought it could be a good idea to introduce concurrency to try to increase the performance of the system.</p>\n\n<p>Before:</p>\n\n<pre><code>columns := make([]series.Series, df.ncols)\nfor i, column := range df.columns {\n    s := column.Subset(indexes)\n    columns[i] = s\n}\n</code></pre>\n\n<p>After:</p>\n\n<pre><code>columns := make([]series.Series, df.ncols)\nvar wg sync.WaitGroup\nwg.Add(df.ncols)\nfor i := range df.columns {\n    go func(i int) {\n        columns[i] = df.columns[i].Subset(indexes)\n        wg.Done()\n    }(i)\n}\nwg.Wait()\n</code></pre>\n\n<p>As far as I understand, creating a goroutine for each of the columns of a DataFrame should not introduce much overhead, so I was expecting to achieve at least a x2 speedup with respect to the serial version (At least for large datasets). However, when benchmarking this change with datasets and indexes of different sizes the results are very disappointing (NROWSxNCOLS_INDEXSIZE-CPUCORES):</p>\n\n<pre><code>benchmark                                          old ns/op      new ns/op      delta\nBenchmarkDataFrame_Subset/1000000x20_100           55230          109349         +97.99%\nBenchmarkDataFrame_Subset/1000000x20_100-2         51457          67714          +31.59%\nBenchmarkDataFrame_Subset/1000000x20_100-4         49845          70141          +40.72%\nBenchmarkDataFrame_Subset/1000000x20_1000          518506         518085         -0.08%\nBenchmarkDataFrame_Subset/1000000x20_1000-2        476661         311379         -34.67%\nBenchmarkDataFrame_Subset/1000000x20_1000-4        505023         316583         -37.31%\nBenchmarkDataFrame_Subset/1000000x20_10000         6621116        6314112        -4.64%\nBenchmarkDataFrame_Subset/1000000x20_10000-2       7316062        4509601        -38.36%\nBenchmarkDataFrame_Subset/1000000x20_10000-4       6483812        8394113        +29.46%\nBenchmarkDataFrame_Subset/1000000x20_100000        105341711      106427967      +1.03%\nBenchmarkDataFrame_Subset/1000000x20_100000-2      94567729       56778647       -39.96%\nBenchmarkDataFrame_Subset/1000000x20_100000-4      91896690       60971444       -33.65%\nBenchmarkDataFrame_Subset/1000000x20_1000000       1538680081     1632044752     +6.07%\nBenchmarkDataFrame_Subset/1000000x20_1000000-2     1292113119     1100075806     -14.86%\nBenchmarkDataFrame_Subset/1000000x20_1000000-4     1282367864     949615298      -25.95%\nBenchmarkDataFrame_Subset/100000x20_100            50286          106850         +112.48%\nBenchmarkDataFrame_Subset/100000x20_100-2          54537          70492          +29.26%\nBenchmarkDataFrame_Subset/100000x20_100-4          58024          76617          +32.04%\nBenchmarkDataFrame_Subset/100000x20_1000           541600         625967         +15.58%\nBenchmarkDataFrame_Subset/100000x20_1000-2         493894         362894         -26.52%\nBenchmarkDataFrame_Subset/100000x20_1000-4         535373         349211         -34.77%\nBenchmarkDataFrame_Subset/100000x20_10000          6298063        7678499        +21.92%\nBenchmarkDataFrame_Subset/100000x20_10000-2        5827185        4832560        -17.07%\nBenchmarkDataFrame_Subset/100000x20_10000-4        8195048        3660077        -55.34%\nBenchmarkDataFrame_Subset/100000x20_100000         105108807      82976477       -21.06%\nBenchmarkDataFrame_Subset/100000x20_100000-2       92112736       58317114       -36.69%\nBenchmarkDataFrame_Subset/100000x20_100000-4       92044966       63469935       -31.04%\nBenchmarkDataFrame_Subset/1000x20_10               9741           53365          +447.84%\nBenchmarkDataFrame_Subset/1000x20_10-2             9366           36457          +289.25%\nBenchmarkDataFrame_Subset/1000x20_10-4             9463           46682          +393.31%\nBenchmarkDataFrame_Subset/1000x20_100              50841          103523         +103.62%\nBenchmarkDataFrame_Subset/1000x20_100-2            49972          62344          +24.76%\nBenchmarkDataFrame_Subset/1000x20_100-4            72014          81808          +13.60%\nBenchmarkDataFrame_Subset/1000x20_1000             457799         571292         +24.79%\nBenchmarkDataFrame_Subset/1000x20_1000-2           460551         405116         -12.04%\nBenchmarkDataFrame_Subset/1000x20_1000-4           462928         416522         -10.02%\nBenchmarkDataFrame_Subset/1000x200_10              90125          688443         +663.88%\nBenchmarkDataFrame_Subset/1000x200_10-2            85259          392705         +360.60%\nBenchmarkDataFrame_Subset/1000x200_10-4            87412          387509         +343.31%\nBenchmarkDataFrame_Subset/1000x200_100             486600         1082901        +122.54%\nBenchmarkDataFrame_Subset/1000x200_100-2           471154         732304         +55.43%\nBenchmarkDataFrame_Subset/1000x200_100-4           542846         659571         +21.50%\nBenchmarkDataFrame_Subset/1000x200_1000            5926086        6686480        +12.83%\nBenchmarkDataFrame_Subset/1000x200_1000-2          5364091        3986970        -25.67%\nBenchmarkDataFrame_Subset/1000x200_1000-4          5904977        4504084        -23.72%\nBenchmarkDataFrame_Subset/1000x2000_10             1187297        7800052        +556.96%\nBenchmarkDataFrame_Subset/1000x2000_10-2           1217022        3930742        +222.98%\nBenchmarkDataFrame_Subset/1000x2000_10-4           1301666        3617871        +177.94%\nBenchmarkDataFrame_Subset/1000x2000_100            6942015        10790196       +55.43%\nBenchmarkDataFrame_Subset/1000x2000_100-2          6588351        7592847        +15.25%\nBenchmarkDataFrame_Subset/1000x2000_100-4          7067226        14391327       +103.63%\nBenchmarkDataFrame_Subset/1000x2000_1000           62392457       69560711       +11.49%\nBenchmarkDataFrame_Subset/1000x2000_1000-2         57793006       37416703       -35.26%\nBenchmarkDataFrame_Subset/1000x2000_1000-4         59572261       58398203       -1.97%\n\nbenchmark                                          old allocs     new allocs     delta\nBenchmarkDataFrame_Subset/1000000x20_100           41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_100-2         41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_100-4         41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_1000          41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_1000-2        41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_1000-4        41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_10000         41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_10000-2       41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_10000-4       41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_100000        41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_100000-2      41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_100000-4      41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_1000000       41             42             +2.44%\nBenchmarkDataFrame_Subset/1000000x20_1000000-2     41             43             +4.88%\nBenchmarkDataFrame_Subset/1000000x20_1000000-4     41             46             +12.20%\nBenchmarkDataFrame_Subset/100000x20_100            41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_100-2          41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_100-4          41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_1000           41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_1000-2         41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_1000-4         41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_10000          41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_10000-2        41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_10000-4        41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_100000         41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_100000-2       41             42             +2.44%\nBenchmarkDataFrame_Subset/100000x20_100000-4       41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_10               41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_10-2             41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_10-4             41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_100              41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_100-2            41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_100-4            41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_1000             41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_1000-2           41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x20_1000-4           41             42             +2.44%\nBenchmarkDataFrame_Subset/1000x200_10              401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_10-2            401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_10-4            401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_100             401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_100-2           401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_100-4           401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_1000            401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_1000-2          401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x200_1000-4          401            402            +0.25%\nBenchmarkDataFrame_Subset/1000x2000_10             4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_10-2           4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_10-4           4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_100            4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_100-2          4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_100-4          4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_1000           4001           4002           +0.02%\nBenchmarkDataFrame_Subset/1000x2000_1000-2         4001           4010           +0.22%\nBenchmarkDataFrame_Subset/1000x2000_1000-4         4001           4003           +0.05%\n\nbenchmark                                          old bytes     new bytes     delta\nBenchmarkDataFrame_Subset/1000000x20_100           32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000000x20_100-2         32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000000x20_100-4         32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000000x20_1000          298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000000x20_1000-2        298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000000x20_1000-4        298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000000x20_10000         2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/1000000x20_10000-2       2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/1000000x20_10000-4       2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/1000000x20_100000        29083520      29083536      +0.00%\nBenchmarkDataFrame_Subset/1000000x20_100000-2      29083520      29083547      +0.00%\nBenchmarkDataFrame_Subset/1000000x20_100000-4      29083542      29083563      +0.00%\nBenchmarkDataFrame_Subset/1000000x20_1000000       290121600     290121616     +0.00%\nBenchmarkDataFrame_Subset/1000000x20_1000000-2     290121600     290121696     +0.00%\nBenchmarkDataFrame_Subset/1000000x20_1000000-4     290121600     290121840     +0.00%\nBenchmarkDataFrame_Subset/100000x20_100            32400         32416         +0.05%\nBenchmarkDataFrame_Subset/100000x20_100-2          32400         32416         +0.05%\nBenchmarkDataFrame_Subset/100000x20_100-4          32400         32416         +0.05%\nBenchmarkDataFrame_Subset/100000x20_1000           298880        298896        +0.01%\nBenchmarkDataFrame_Subset/100000x20_1000-2         298880        298896        +0.01%\nBenchmarkDataFrame_Subset/100000x20_1000-4         298880        298896        +0.01%\nBenchmarkDataFrame_Subset/100000x20_10000          2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/100000x20_10000-2        2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/100000x20_10000-4        2971520       2971536       +0.00%\nBenchmarkDataFrame_Subset/100000x20_100000         29083520      29083536      +0.00%\nBenchmarkDataFrame_Subset/100000x20_100000-2       29083520      29083536      +0.00%\nBenchmarkDataFrame_Subset/100000x20_100000-4       29083542      29083553      +0.00%\nBenchmarkDataFrame_Subset/1000x20_10               4880          4896          +0.33%\nBenchmarkDataFrame_Subset/1000x20_10-2             4880          4896          +0.33%\nBenchmarkDataFrame_Subset/1000x20_10-4             4880          4896          +0.33%\nBenchmarkDataFrame_Subset/1000x20_100              32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000x20_100-2            32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000x20_100-4            32400         32416         +0.05%\nBenchmarkDataFrame_Subset/1000x20_1000             298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000x20_1000-2           298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000x20_1000-4           298880        298896        +0.01%\nBenchmarkDataFrame_Subset/1000x200_10              49568         49584         +0.03%\nBenchmarkDataFrame_Subset/1000x200_10-2            49568         49584         +0.03%\nBenchmarkDataFrame_Subset/1000x200_10-4            49568         49585         +0.03%\nBenchmarkDataFrame_Subset/1000x200_100             324768        324784        +0.00%\nBenchmarkDataFrame_Subset/1000x200_100-2           324768        324784        +0.00%\nBenchmarkDataFrame_Subset/1000x200_100-4           324768        324784        +0.00%\nBenchmarkDataFrame_Subset/1000x200_1000            2989568       2989584       +0.00%\nBenchmarkDataFrame_Subset/1000x200_1000-2          2989568       2989584       +0.00%\nBenchmarkDataFrame_Subset/1000x200_1000-4          2989569       2989588       +0.00%\nBenchmarkDataFrame_Subset/1000x2000_10             491072        491088        +0.00%\nBenchmarkDataFrame_Subset/1000x2000_10-2           491072        491133        +0.01%\nBenchmarkDataFrame_Subset/1000x2000_10-4           491072        491088        +0.00%\nBenchmarkDataFrame_Subset/1000x2000_100            3243072       3243088       +0.00%\nBenchmarkDataFrame_Subset/1000x2000_100-2          3243074       3243102       +0.00%\nBenchmarkDataFrame_Subset/1000x2000_100-4          3243076       3243100       +0.00%\nBenchmarkDataFrame_Subset/1000x2000_1000           29891072      29891088      +0.00%\nBenchmarkDataFrame_Subset/1000x2000_1000-2         29891086      29891797      +0.00%\nBenchmarkDataFrame_Subset/1000x2000_1000-4         29891115      29891167      +0.00%\n</code></pre>\n\n<p>Running the profiler (cpu/mem) over this benchmark didn't seem to reveal nothing significant. The concurrent version seem to spend some time on <code>rumtime.match_semaphore_signal</code> but I guess this is to be expected when waiting for the goroutines to finish.</p>\n\n<p>I've tried limiting the number of goroutines launched to the maximum number of cores as reported by <code>runtime.GOMAXPROCS(0)</code> but the results are somewhat even worse. Am I doing something horribly wrong here or is the goroutines overhead so big that it has such a significant effect on the performance?</p>\n"}, {"tags": ["file", "go", "io", "eof"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1482066762, "post_id": 41208359, "comment_id": 69616054, "body": "not AFAIK. you can maybe use seek or something to get the current position but since it will require way more syscalls it will be slower."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1482066861, "post_id": 41208359, "comment_id": 69616081, "body": "Why not make a type that <i>always</i> reads some bytes and returns EOF?"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1482077813, "post_id": 41208359, "comment_id": 69619279, "body": "@JimB That&#39;s an amazing trick. I&#39;ll adopt that solution. But instead of the read ahead, I&#39;ll keep track of the bytes remaining to read so I can return io.EOF just in time. The reason I like it most is that I don&#39;t need to modify code anywhere in my program. I only need to provide a wrapper to File.  If you write a nice answer with the two options, I&#39;ll grant it to you."}], "answers": [{"tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": true, "score": 1, "last_activity_date": 1482115918, "creation_date": 1482115918, "answer_id": 41215144, "question_id": 41208359, "link": "https://stackoverflow.com/questions/41208359/how-to-test-eof-on-io-reader-in-go/41215144#41215144", "title": "How to test EOF on io.Reader in Go?", "body": "<p>You could create a new type, that keeps track of the number of bytes read so far. Then, at EOF check time, you could compare the expected number of bytes read with the actual number of bytes read. Here is a sample implementation. The <code>eofReader</code> keeps track of the number of bytes read and compares it to the file size, in case the underlying type is a file:</p>\n\n<pre><code>package main\n\n// ... imports \n\n// eofReader can be checked for EOF, without a Read. \ntype eofReader struct {\n    r     io.Reader\n    count uint64\n}\n\n// AtEOF returns true, if the number of bytes read equals the file size.\nfunc (r *eofReader) AtEOF() (bool, error) {\n    f, ok := r.r.(*os.File)\n    if !ok {\n        return false, nil\n    }\n    fi, err := f.Stat()\n    if err != nil {\n        return false, err\n    }\n    return r.Count() == uint64(fi.Size()), nil\n}\n\n// Read reads and counts.\nfunc (r *eofReader) Read(buf []byte) (int, error) {\n    n, err := r.r.Read(buf)\n    atomic.AddUint64(&amp;r.count, uint64(n))\n    return n, err\n}\n\n// Count returns the count.\nfunc (r *eofReader) Count() uint64 {\n    return atomic.LoadUint64(&amp;r.count)\n}\n</code></pre>\n\n<p>You could use this type by wrapping any reader in an eofReader:</p>\n\n<pre><code>func main() {\n    f, err := os.Open(\"main.go\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    r := &amp;eofReader{r: f}\n    log.Println(r.AtEOF())\n\n    if _, err = ioutil.ReadAll(r); err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(r.AtEOF())\n}\n\n// 2016/12/19 03:49:35 false &lt;nil&gt;\n// 2016/12/19 03:49:35 true &lt;nil&gt;\n</code></pre>\n\n<p>Code as <a href=\"https://gist.github.com/miku/6e9cdb5225a1814f1758d3b6793ae423\" rel=\"nofollow noreferrer\">gist</a>.</p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3090, "favorite_count": 1, "accepted_answer_id": 41215144, "answer_count": 1, "score": 4, "last_activity_date": 1482116958, "creation_date": 1482064410, "last_edit_date": 1482116958, "question_id": 41208359, "link": "https://stackoverflow.com/questions/41208359/how-to-test-eof-on-io-reader-in-go", "title": "How to test EOF on io.Reader in Go?", "body": "<p>The Go's <code>io.Reader</code> documentation states that a <code>Read()</code> may return a non zero <code>n</code> value and an <code>io.EOF</code> at the same time. Unfortunately, the <code>Read()</code> method of a <code>File</code> doesn't do that. </p>\n\n<p>When the EOF is reached and some bytes could still be read, the Read method of file returns non zero <code>n</code> and <code>nil</code> error. It is only when we try to read when already at the end of the file that we get back zero <code>n</code> and <code>io.EOF</code> as error. </p>\n\n<p>I couldn't find a simple method to test if the EOF is reached without trying to read data from the file. If we perform a Read() with a buffer of 0 byte, we get back zero <code>n</code> and <code>nil</code> error although we are at the end of file. </p>\n\n<p>To avoid this last read, the only solution I have found is to keep track myself of the number of bytes remaining to read in the file. Is there a simpler solution ?</p>\n"}, {"tags": ["recursion", "go", "tree", "garbage-collection"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 2, "creation_date": 1482050789, "post_id": 41206744, "comment_id": 69612548, "body": "&quot;Go compiler&quot; - garbage collection is not the compiler&#39;s job. The compiler doesn&#39;t have the information needed to make GC decisions."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1482050897, "post_id": 41206744, "comment_id": 69612566, "body": "sorry about the inaccurate description, I will revise the description."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1482051092, "post_id": 41206744, "comment_id": 69612597, "body": "<a href=\"https://blog.golang.org/go15gc\" rel=\"nofollow noreferrer\">blog.golang.org/go15gc</a>"}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1482052041, "post_id": 41206744, "comment_id": 69612788, "body": "@YandryPozo thanks, after reading that blog post, I think it is not necessary to write such a recursive procedure. Go will take care of the garbage provided there are no &quot;global&quot; pointers to the sub-tree items."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1482124859, "post_id": 41206744, "comment_id": 69631019, "body": "for the new version 1.8 the time of scanning will be super reduced <a href=\"https://groups.google.com/forum/?fromgroups#!topic/golang-dev/Ab1sFeoZg_8\" rel=\"nofollow noreferrer\">groups.google.com/forum/?fromgroups#!topic/golang-dev/&hellip;</a>"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1482144354, "post_id": 41206744, "comment_id": 69640212, "body": "@user2357112 Compilers can make some decisions ahead of time when the lifetime of some data can be determined statically."}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1482050927, "creation_date": 1482050585, "last_edit_date": 1482050927, "question_id": 41206744, "link": "https://stackoverflow.com/questions/41206744/golang-garbage-collection-of-tree-structure", "title": "golang: garbage collection of tree structure", "body": "<p>I have a data structure similar to a recursive directory tree, e.g.:</p>\n\n<pre><code>type tree struct {\n    name string\n    subs []*tree\n}\n</code></pre>\n\n<p>This data structure is recursive, which means subs can contain tree structures which themselves contains subs, so on and so forth.</p>\n\n<p>Now, with R represents such a tree structure, if I do this: <code>R.subs = nil</code>, will the sub-tree items get garbage collected, or I have to write something like this:</p>\n\n<pre><code>func (t *tree) Truncate() {\n    for _, s := range t.subs {\n        s.Truncate()\n    }\n    t.subs = nil\n}\n</code></pre>\n\n<p>In general, my question is how Go knows that some objects are no longer needed and eligible for garbage collection?</p>\n\n<p>thanks a lot.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": true, "score": 3, "last_activity_date": 1482048391, "creation_date": 1482048391, "answer_id": 41206536, "question_id": 41206370, "link": "https://stackoverflow.com/questions/41206370/convert-string-to-function-name-in-go/41206536#41206536", "title": "Convert String to Function name in GO?", "body": "<p>As far as I know it's not possible to enumerate the functions of a package using the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflection api</a>, but see <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/9Di5eHK2eQ0\" rel=\"nofollow noreferrer\">this mailing list discussion</a> for some ideas involving parsing the source files. Enumerating methods of an object <a href=\"https://stackoverflow.com/questions/21397653/how-to-dump-methods-of-structs-in-golang\">is possible</a>, which is actually more to what you describe in python.</p>\n\n<p>However, I would recommend using a simple dispatch table instead of introspection, you can populate a <code>map[string]func()</code>, though I suspect you might want to pass some arguments to your function, e.g. the request to be handled:</p>\n\n<pre><code>var dispatch map[string]http.HandlerFunc\n\nfunc init() {\n    dispatch = make(map[string]http.HandlerFunc)\n    dispatch[\"json_server\"] = json_server\n    dispatch[\"foo\"] = func(w http.ResponseWriter, r *http.Request) {\n        ...\n    }\n}\n\nfunc ServeHTTP (w http.ResponseWriter, r *http.Request) {\n    if handler, exists := dispatch[req.URL.Path]; exists {\n        handler(w, r)\n    } else {\n        ... // fallback\n    }\n}\n</code></pre>\n\n<p>Or better yet, just use an existing HTTP router, such as <a href=\"https://godoc.org/github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">httprouter</a> or <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow noreferrer\">gorilla/mux</a>. There are many alternatives to choose from.</p>\n"}], "owner": {"reputation": 1676, "user_id": 4796134, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh6.googleusercontent.com/-Errc8LWZKd4/AAAAAAAAAAI/AAAAAAAAJn4/NtmG4oUBCow/photo.jpg?sz=128", "display_name": "Sijan Shrestha", "link": "https://stackoverflow.com/users/4796134/sijan-shrestha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1984, "favorite_count": 0, "closed_date": 1482048382, "accepted_answer_id": 41206536, "answer_count": 1, "score": -1, "last_activity_date": 1482048391, "creation_date": 1482046642, "question_id": 41206370, "link": "https://stackoverflow.com/questions/41206370/convert-string-to-function-name-in-go", "closed_reason": "Duplicate", "title": "Convert String to Function name in GO?", "body": "<p>I am creating a Restful API.</p>\n\n<p>I am passing function name and arguments in JSON</p>\n\n<p>eg. <code>\"localhost/json_server?method=foo&amp;id=1\"</code></p>\n\n<p>Lets say, i have a simple go server running</p>\n\n<pre><code> http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {                                                                             \n     fmt.Println(\"path\",r.URL.Path )                                                                                                             \n     fmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))                                                                                  \n }) \n.........\nfunction json_server(){\n....\n}\n</code></pre>\n\n<p>The <code>r.url.Path</code> will give me \"<em><code>json_server</code></em>\" in <strong>string</strong>. Now i want to first check if the function exists , if exists call the function as defined else throw some exception.</p>\n\n<p>Is this possible to do ?</p>\n\n<p>When i am doing <strong>python</strong> and  i use <code>getattr(method,args)</code> to call the method and arguments which are in string. </p>\n\n<p>I have developed interest in Go after using Docker. Any help will be appreciated.</p>\n"}, {"tags": ["go", "orm"], "answers": [{"comments": [{"owner": {"reputation": 629, "user_id": 4131783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f0675c1b419b60cdc44f009459d2a79?s=128&d=identicon&r=PG&f=1", "display_name": "machinezhou", "link": "https://stackoverflow.com/users/4131783/machinezhou"}, "edited": false, "score": 0, "creation_date": 1482289359, "post_id": 41233584, "comment_id": 69709456, "body": "thanks for your help. I&#39;m confused about the &quot;time&quot; type, does it support nullable or just because I add this &quot;<code>orm:&quot;index&quot;</code>&quot; to the value."}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 0, "last_activity_date": 1482197192, "creation_date": 1482197192, "answer_id": 41233584, "question_id": 41205355, "link": "https://stackoverflow.com/questions/41205355/not-null-constraint-failed-in-go-orm/41233584#41233584", "title": "NOT NULL constraint failed in go orm", "body": "<blockquote>\n  <p>So how can I set this value to be nullable or a default value?</p>\n</blockquote>\n\n<p>You can either:</p>\n\n<ol>\n<li>Remove the <code>not null</code> constraint from the database and change the type to something that accepts null values. Go includes a few of those in the standard library (e.g. <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\"><code>sql.Null*</code></a>) but doesn't have one for <code>time.Time</code>. Write your own or use something like <a href=\"https://github.com/guregu/null\" rel=\"nofollow noreferrer\"><code>github.com/guregu/null</code></a> which adds support for this.</li>\n<li>Make sure you always set the <code>ReplyTime</code> field before inserting it in the database.</li>\n</ol>\n\n<p>The \"best\" solution will depend on your application and what this data signifies. Should it be logically possible for <code>ReplyTime</code> to have \"no value\" (e.g. user never replied)? If so, then use option 1. If it should always have a value, then use option 2.</p>\n"}], "owner": {"reputation": 629, "user_id": 4131783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f0675c1b419b60cdc44f009459d2a79?s=128&d=identicon&r=PG&f=1", "display_name": "machinezhou", "link": "https://stackoverflow.com/users/4131783/machinezhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "accepted_answer_id": 41233584, "answer_count": 1, "score": 0, "last_activity_date": 1482197259, "creation_date": 1482033888, "last_edit_date": 1482197259, "question_id": 41205355, "link": "https://stackoverflow.com/questions/41205355/not-null-constraint-failed-in-go-orm", "title": "NOT NULL constraint failed in go orm", "body": "<p>I'm trying to execute operation insert with orm in go.</p>\n\n<p>I do insert and not assign value to time type value like the field:</p>\n\n<pre><code>ReplyTime       time.Time `orm:\"index\"`\n</code></pre>\n\n<p>it will throw error: <code>NOT NULL constraint failed: topic.reply_time</code>.</p>\n\n<p>So how can I set this value to be nullable or a default value?</p>\n\n<pre><code>type Topic struct {\n    Id              int64\n    UId             int64\n    Title           string\n    Content         string `orm:\"size(5000)\"`\n    Attachment      string\n    Created         time.Time `orm:\"index\"`\n    Updated         time.Time `orm:\"index\"`\n    Views           int64 `orm:\"index\"`\n    Author          string\n    ReplyTime       time.Time `orm:\"index\"`\n    ReplyCount      int64\n    ReplyLastUserId int64\n}\n\nfunc AddTopic(title, content string) error {\n    o := orm.NewOrm()\n    t := time.Now()\n\n    topic := &amp;Topic{Title:title, Content:content, Created:t, Updated:t}\n    _, err := o.Insert(topic)\n    return err\n}\n</code></pre>\n"}, {"tags": ["audio", "go", "wav", "pcm"], "comments": [{"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 1, "creation_date": 1482049837, "post_id": 41205337, "comment_id": 69612381, "body": "PCM represents the audio waveform in terms of amplitude. <code>PC32Samples</code> is just an alias for <code>[]int32</code>, in other words it&#39;s already describing the audio level, as an integer. You can simply read off every nth sample where n is the sample rate times 0.05. Are you trying to draw a waveform? Note that analyzing perceived loudness is a bit move involved than simply taking the level."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "reply_to_user": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1482158608, "post_id": 41205337, "comment_id": 69648728, "body": "@nothingmuch makes sense. Where did you come up with the 0.05 number since audio could be 44100Hz or 48000Hz or any other number?"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1482209455, "post_id": 41205337, "comment_id": 69669702, "body": "You said you wanted to sample every 50ms, which is 0.05 seconds, i.e. at 44100 samples per second every 2205th sample"}], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1193, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482033639, "creation_date": 1482033639, "question_id": 41205337, "link": "https://stackoverflow.com/questions/41205337/how-do-you-read-the-audio-level-of-a-wav-flac-file-in-golang", "title": "How do you read the audio level of a wav/flac file in golang?", "body": "<p>I would like to read the audio level of a wav/flac/mp3 file (mono/stereo) every 50 milliseconds (or about). I assume that I need to open the file, load the samples, and then process them using PCM to get the audio level at any given time. How can I do this in Golang?</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"azul3d.org/audio.v1\"\n    _ \"azul3d.org/audio/flac.v0\" // Add FLAC decoding support.\n)\n\nfunc main() {\n    flag.Parse()\n    for _, path := range flag.Args() {\n        err := parseFLAC(path)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n\nfunc parseFLAC(path string) error {\n    // Open file.\n    f, err := os.Open(path)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n\n    // Create decoder.\n    dec, _, err := audio.NewDecoder(f)\n    if err != nil {\n        return err\n    }\n\n    // Decode audio stream.\n    for {\n        samples := make(audio.PCM32Samples, 1024)\n        n, err := dec.Read(samples)\n        if err != nil {\n            if err == audio.EOS {\n                return nil\n            }\n            return err\n        }\n        fmt.Println(samples[:n])\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "printf"], "comments": [{"owner": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 2, "creation_date": 1482020824, "post_id": 41204322, "comment_id": 69608132, "body": "See <a href=\"http://stackoverflow.com/questions/35043202/how-to-ignore-extra-fields-for-fmt-sprintf\">How to ignore extra fields for fmt.Sprintf</a>, which uses <code>fmt.Sprintf()</code>, but is similar. It tries to count the verbs and truncate the arguments with a slice. It also argues against using dynamic format strings."}, {"owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "reply_to_user": {"reputation": 6196, "user_id": 5822075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ba9afcd0c36d9685e3e1b5f2f82be2?s=128&d=identicon&r=PG&f=1", "display_name": "e0k", "link": "https://stackoverflow.com/users/5822075/e0k"}, "edited": false, "score": 0, "creation_date": 1482072706, "post_id": 41204322, "comment_id": 69617688, "body": "karmakaze&#39;s answer inspired my to try fmt&#39;s explicit argument indexes. If you refer to one value by index, then fmt no longer complains about extra values. So if you supply multiple values to printf and require that format strings represent at least one of them, then the format string can refer to that mandatory value by index (e.g. <code>%[1]d</code>) and doesn&#39;t have to worry about the other values."}], "answers": [{"comments": [{"owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "edited": false, "score": 0, "creation_date": 1482071844, "post_id": 41204976, "comment_id": 69617488, "body": "A better alternative to format crossed my mind but I thought I&#39;d stick to a simple question to begin with. But this sure is one I didn&#39;t know. I worked it down to <a href=\"https://play.golang.org/p/jppr5Ew-xj\" rel=\"nofollow noreferrer\">this playground example</a>. The struct FooTalk can be inlined away, but I&#39;d prefer callers to have a clear view of the interface they can access, even though there is no static type checking."}], "tags": [], "owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "is_accepted": false, "score": 2, "last_activity_date": 1482028631, "creation_date": 1482028631, "answer_id": 41204976, "question_id": 41204322, "link": "https://stackoverflow.com/questions/41204322/ignoring-printf-values-in-go/41204976#41204976", "title": "Ignoring printf values in Go", "body": "<p>This may not be exactly what you're looking for but it's worth looking at the <code>text/template</code> package. Then you could define a template with <code>Parse(\"{{.Name}} items are made of {{.Material}}\")</code> and pass in to <code>Execute</code> a <code>map[string]string</code> containing keys <code>\"Name\"</code> and <code>\"Material\"</code>. This has the added advantage that the format string can also arrange the output order of values.</p>\n"}], "owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1482028631, "creation_date": 1482019980, "last_edit_date": 1495539943, "question_id": 41204322, "link": "https://stackoverflow.com/questions/41204322/ignoring-printf-values-in-go", "title": "Ignoring printf values in Go", "body": "<p>Is there a way to write a verb in a format string that outputs nothing, even though some values are supplied to Printf/Sprintf/Fprintf? In other words, is there a value of <code>s</code> for which this code outputs nothing?</p>\n\n<pre><code>fmt.Printf(s, 42)\n</code></pre>\n\n<p>In C, the answer is easy: the empty string, because <a href=\"https://stackoverflow.com/questions/21659175/can-there-be-less-number-of-fomat-specifier-than-the-number-of-variables-in-a-pr/\">the superfluous value is ignored</a>. In Go, an empty format string leads to the output <code>%!(EXTRA int=42)</code>. Which I consider a good thing, because the format string is most likely wrong. Python even throws \"TypeError: not all arguments converted during string formatting\" in that situation. But if we truly want to gobble up, ignore, skip, cancel the values, how could we convince Printf of our good intentions?</p>\n\n<p>If the value is a string, it's easy: truncate to zero:</p>\n\n<pre><code>    fmt.Printf(\"nothing%.0s here\", \"foul\")\n</code></pre>\n\n<p>You could even omit the 0 in that verb, I realised after digging up <a href=\"https://stackoverflow.com/questions/13581484/bash-printf-ignore-parameters-or-access-by-index\">a bash version of my question</a>. But what if the value is a number?</p>\n\n<p>If you wonder, why not simply omit superfluous values: the context is that only the format string can be touched, being the parameter of a function. The function body feeds the format some value(s) of predetermined types, such as in <a href=\"http://play.golang.org/p/_JX66_IGs1\" rel=\"nofollow noreferrer\">this simplified playground example</a>. Usually, the format passed in wants to represent the value, but sometimes you may want to ignore it. Of course the function could grow up and accept an interface instead of a format string, but I'm just wondering if Printf could pull it off on its own like it can in C.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 2, "creation_date": 1482000420, "post_id": 41201918, "comment_id": 69603030, "body": "Compiler tells you that <b>yes</b>, there&#39;s a difference."}, {"owner": {"reputation": 1523, "user_id": 1293924, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7f97d549d99808cc655cd916f392aa04?s=128&d=identicon&r=PG", "display_name": "nomel7", "link": "https://stackoverflow.com/users/1293924/nomel7"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1482000519, "post_id": 41201918, "comment_id": 69603064, "body": "How do I transform one to another? Why does it work if I use a magic constant but it doesn&#39;t work when using a variable as the parameter?"}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 2, "creation_date": 1482000572, "post_id": 41201918, "comment_id": 69603082, "body": "Maybe it&#39;s time to read Go tutorials?"}, {"owner": {"reputation": 1523, "user_id": 1293924, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7f97d549d99808cc655cd916f392aa04?s=128&d=identicon&r=PG", "display_name": "nomel7", "link": "https://stackoverflow.com/users/1293924/nomel7"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1482000698, "post_id": 41201918, "comment_id": 69603118, "body": "I cannot find anything for the difference between the types int and uint8. Is uint8 not the standard int type?"}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 1, "creation_date": 1482000817, "post_id": 41201918, "comment_id": 69603144, "body": "<code>u</code> in <code>uint</code> means <code>unsigned</code>. So you cant assign <code>-23</code> to <code>uint</code> type. But can assign to <code>int</code>."}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 1, "creation_date": 1482000862, "post_id": 41201918, "comment_id": 69603150, "body": "As for type conversions - <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">tour.golang.org/basics/13</a>"}, {"owner": {"reputation": 1523, "user_id": 1293924, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7f97d549d99808cc655cd916f392aa04?s=128&d=identicon&r=PG", "display_name": "nomel7", "link": "https://stackoverflow.com/users/1293924/nomel7"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1482001320, "post_id": 41201918, "comment_id": 69603283, "body": "Thanks. The value in number in question though <code>colorIndex</code> is defined to <code>2</code>. So how is is not a valid parameter? Is there some weird type introspection going on here? I am very new to Go :)"}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1482001563, "post_id": 41201918, "comment_id": 69603343, "body": "It&#39;s not a valid parameter becuase it has type that is not supported."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1568478708, "last_edit_date": 1568478708, "creation_date": 1482002186, "answer_id": 41202171, "question_id": 41201918, "link": "https://stackoverflow.com/questions/41201918/why-am-i-getting-a-compile-error-cannot-use-as-type-uint8-in-argument-to/41202171#41202171", "title": "Why am I getting a compile error &#39;cannot use ... as type uint8 in argument to ...&#39; when the parameter is an int", "body": "<p>The type of <code>colorIndex</code> is <code>int</code>.  The argument type is <code>uint8</code>. An <code>int</code> cannot be <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assigned</a> to a <code>uint8</code>.  Here are some options for fixing the program:</p>\n\n<ul>\n<li><p>Declare <code>colorIndex</code> as an <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">untyped constant</a>.</p>\n\n<pre><code>const colorIndex = 2\n</code></pre></li>\n<li><p>Declare <code>colorIndex</code> as uint8 type:</p>\n\n<pre><code>colorIndex := uint8(3)\n</code></pre></li>\n<li><p>Convert the value at the call:</p>\n\n<pre><code>img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5), uint8(colorIndex))\n</code></pre></li>\n</ul>\n\n<p>You can replace all uses of <code>uint8</code> in this answer with <code>byte</code> because <code>byte</code> is an <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"nofollow noreferrer\">alias</a> for <code>uint8</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": false, "score": 1, "last_activity_date": 1482002207, "creation_date": 1482002207, "answer_id": 41202176, "question_id": 41201918, "link": "https://stackoverflow.com/questions/41201918/why-am-i-getting-a-compile-error-cannot-use-as-type-uint8-in-argument-to/41202176#41202176", "title": "Why am I getting a compile error &#39;cannot use ... as type uint8 in argument to ...&#39; when the parameter is an int", "body": "<p>In variable declarations, a default type is used, and in your case, <code>colorIndex := 2</code>, i.e. colorIndex becomes int, not uint8.</p>\n\n<p>From the docs ( <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Short_variable_declarations</a> ): \n<em>\"If a type is present, each variable is given that type. Otherwise, each variable is given the type of the corresponding initialization value in the assignment. If that value is an untyped constant, it is first converted to its default type;...\"</em></p>\n\n<p><em>\"var i = 42             // i is int\"</em></p>\n\n<p>and then</p>\n\n<p><em>\"An untyped constant has a default type which is the type to which the constant is implicitly converted in contexts where a typed value is required, for instance, in a short variable declaration such as i := 0 where there is no explicit type. The default type of an untyped constant is bool, rune, int, float64, complex128 or string respectively, depending on whether it is a boolean, rune, integer, floating-point, complex, or string constant.\"</em></p>\n\n<p>So to get uint8, you should either explicitly declare colorIndex as uint8 <code>var colorIndex uint8 = 2</code> or cast uint8 in img.SetColorIndex as : \n<code>img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5), uint8(colorIndex))</code></p>\n"}], "owner": {"reputation": 1523, "user_id": 1293924, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7f97d549d99808cc655cd916f392aa04?s=128&d=identicon&r=PG", "display_name": "nomel7", "link": "https://stackoverflow.com/users/1293924/nomel7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7201, "favorite_count": 0, "accepted_answer_id": 41202171, "answer_count": 2, "score": 11, "last_activity_date": 1568478708, "creation_date": 1482000325, "question_id": 41201918, "link": "https://stackoverflow.com/questions/41201918/why-am-i-getting-a-compile-error-cannot-use-as-type-uint8-in-argument-to", "title": "Why am I getting a compile error &#39;cannot use ... as type uint8 in argument to ...&#39; when the parameter is an int", "body": "<p>I am new to Go and was working through a problem in The Go Programming Language. The code should create GIF animations out of random Lissajous figures with the images being produced in the different colors from <code>palate</code>:</p>\n\n<pre><code>// Copyright \u00a9 2016 Alan A. A. Donovan &amp; Brian W. Kernighan.\n// License: https://creativecommons.org/licenses/by-nc-sa/4.0/\n\n// Run with \"web\" command-line argument for web server.\n// See page 13.\n//!+main\n\n// Lissajous generates GIF animations of random Lissajous figures.\npackage main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/gif\"\n    \"io\"\n    \"math\"\n    \"math/rand\"\n    \"os\"\n)\n\n//!-main\n// Packages not needed by version in book.\nimport (\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\n//!+main\n// #00ff55\nvar palette = []color.Color{color.RGBA{0x00, 0xff, 0x55, 0xFF}, color.Black, color.RGBA{0x00, 0x00, 0xff, 0xFF}, color.RGBA{0xff, 0x00, 0xff, 0xFF}}\n\nconst (\n    whiteIndex = 0 // first color in palette\n)\n\nfunc main() {\n    //!-main\n    // The sequence of images is deterministic unless we seed\n    // the pseudo-random number generator using the current time.\n    // Thanks to Randall McPherson for pointing out the omission.\n    rand.Seed(time.Now().UTC().UnixNano())\n\n    if len(os.Args) &gt; 1 &amp;&amp; os.Args[1] == \"web\" {\n        //!+http\n        handler := func(w http.ResponseWriter, r *http.Request) {\n            lissajous(w)\n        }\n        http.HandleFunc(\"/\", handler)\n        //!-http\n        log.Fatal(http.ListenAndServe(\"localhost:8000\", nil))\n        return\n    }\n    //!+main\n    lissajous(os.Stdout)\n}\n\nfunc lissajous(out io.Writer) {\n    const (\n        cycles  = 5     // number of complete x oscillator revolutions\n        res     = 0.001 // angular resolution\n        size    = 100   // image canvas covers [-size..+size]\n        nframes = 64    // number of animation frames\n        delay   = 8     // delay between frames in 10ms units\n    )\n    freq := rand.Float64() * 3.0 // relative frequency of y oscillator\n    anim := gif.GIF{LoopCount: nframes}\n    phase := 0.0 // phase difference\n  colorIndex := 2\n  for i := 0; i &lt; nframes; i++ {\n    rect := image.Rect(0, 0, 2*size+1, 2*size+1)\n        img := image.NewPaletted(rect, palette)\n        for t := 0.0; t &lt; cycles*2*math.Pi; t += res {\n            x := math.Sin(t)\n            y := math.Sin(t*freq + phase)\n      img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5), colorIndex)\n      colorIndex++\n        }\n        phase += 0.1\n        anim.Delay = append(anim.Delay, delay)\n        anim.Image = append(anim.Image, img)\n    }\n    gif.EncodeAll(out, &amp;anim) // NOTE: ignoring encoding errors\n}\n\n//!-main\n</code></pre>\n\n<p>Here is the error I am getting</p>\n\n<pre><code>lissajous/main.go:76: cannot use colorIndex (type int) as type uint8 in argument to img.SetColorIndex\n</code></pre>\n\n<p>Is there a difference between int and uint8 types or something?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 2, "last_activity_date": 1481995475, "last_edit_date": 1481995475, "creation_date": 1481992440, "answer_id": 41200724, "question_id": 41200505, "link": "https://stackoverflow.com/questions/41200505/whats-the-best-practice-to-synchronise-channels-and-wait-groups/41200724#41200724", "title": "What&#39;s the best practice to synchronise channels and wait groups?", "body": "<p>Using a separate 'closer' go-routine prevents a deadlock. </p>\n\n<p>If the wait/close operation were in the main go-routine before the for-range loop, it would never end, because all of the 'worker' go-routines would block in the absence of a receiver on the channel. And if it were placed in the main go-routine after the for-range loop, it would be unreachable, because the loop would block with no-one to close the channel. </p>\n\n<p>This explanation was borrowed from 'The Go Programming Language' book (8.5 Looping in parallel).</p>\n"}, {"tags": [], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "is_accepted": true, "score": 4, "last_activity_date": 1618529959, "last_edit_date": 1618529959, "creation_date": 1481994716, "answer_id": 41201050, "question_id": 41200505, "link": "https://stackoverflow.com/questions/41200505/whats-the-best-practice-to-synchronise-channels-and-wait-groups/41201050#41201050", "title": "What&#39;s the best practice to synchronise channels and wait groups?", "body": "<p>As an alternative to using a waitgroup and extra goroutine, you can use a <strong>separate channel for ending goroutines</strong>.</p>\n<p>This is (also) idiomatic in Go. It involves <em>blocking using a <code>select</code> control group</em>.</p>\n<p>So you'd have to <code>make</code> a new channel, typically with an empty struct as it's value (eg <code>closeChan := make(chan struct{})</code> which, when closed (<code>close(closeChan)</code>) would end the goroutine itself.</p>\n<p>Instead of <em>ranging over a <code>chan</code></em>, you can use a <strong>select</strong> to block until either fed data or closed.</p>\n<p>The code in <code>Crawl</code> could look something like this:</p>\n<pre><code>for { // instead of ranging over a to-be closed chan\n    select {\n    case message := &lt;-ch:\n        // handle message\n    case &lt;-closeChan:\n        break // exit goroutine, can use return instead\n    }\n}\n</code></pre>\n<p>And then in <code>crawlTask</code>, you could close the <code>closeChan</code> (passed in as another parameter, like <code>ch</code> when you return (I figure that's when you want the other goroutine to end, and stop handling messages?)</p>\n<pre><code>if depth &lt;= 0 {\n    close(closeChan)\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 5076225, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f51749961a6a3233df8063d13375492c?s=128&d=identicon&r=PG&f=1", "display_name": "gauge", "link": "https://stackoverflow.com/users/5076225/gauge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2554, "favorite_count": 2, "accepted_answer_id": 41201050, "answer_count": 2, "score": 5, "last_activity_date": 1618529959, "creation_date": 1481990944, "question_id": 41200505, "link": "https://stackoverflow.com/questions/41200505/whats-the-best-practice-to-synchronise-channels-and-wait-groups", "title": "What&#39;s the best practice to synchronise channels and wait groups?", "body": "<p>What's the best practice to synchronise wait groups and channels? I want to handle messages and block on a loop, and it appears that delegating the closing of the channel to another go routine seems to be a weird solution?</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    ch := make(chan string)\n\n    var waitGroup sync.WaitGroup\n    waitGroup.Add(1)\n    go crawlTask(&amp;waitGroup, ch, url, depth, fetcher)\n\n    go func() {\n        waitGroup.Wait()\n        close(ch)\n    }()\n\n    for message := range ch {\n        // I want to handle the messages here\n        fmt.Println(message)\n    }\n}\n\nfunc crawlTask(waitGroup *sync.WaitGroup, ch chan string, url string, depth int, fetcher Fetcher) {\n    defer waitGroup.Done()\n\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n\n    if err != nil {\n        ch &lt;- err.Error()\n        return\n    }\n    ch &lt;- fmt.Sprintf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        waitGroup.Add(1)\n        go crawlTask(waitGroup, ch, u, depth-1, fetcher)\n    }\n}\nfunc main() {\n    Crawl(\"http://golang.org/\", 4, fetcher)\n}\n\n// truncated from https://tour.golang.org/concurrency/10 webCrawler\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1482039145, "post_id": 41199258, "comment_id": 69610730, "body": "Any other issues with mgo but release date?"}], "answers": [{"tags": [], "owner": {"reputation": 233, "user_id": 551932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Os9to.jpg?s=128&g=1", "display_name": "avelino", "link": "https://stackoverflow.com/users/551932/avelino"}, "is_accepted": false, "score": 2, "last_activity_date": 1482040257, "creation_date": 1482040257, "answer_id": 41205868, "question_id": 41199258, "link": "https://stackoverflow.com/questions/41199258/mongodb-golang-library/41205868#41205868", "title": "MongoDB - Golang Library", "body": "<p>mgo is the driver developed by Community (maintained by Gustavo Niemeyer, an engineer at Canonical), mgo is quoted in the official documentation of mongodb:\n<a href=\"https://docs.mongodb.com/ecosystem/drivers/#community-supported-drivers\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/ecosystem/drivers/#community-supported-drivers</a></p>\n\n<p>Last update was August/2016 (this year):\n<a href=\"https://github.com/go-mgo/mgo\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo</a></p>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 2, "last_activity_date": 1523780135, "creation_date": 1523780135, "answer_id": 49839854, "question_id": 41199258, "link": "https://stackoverflow.com/questions/41199258/mongodb-golang-library/49839854#49839854", "title": "MongoDB - Golang Library", "body": "<blockquote>\n  <p>Is there an official golang library for MongoDB</p>\n</blockquote>\n\n<p>Yes, there is: <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo\" rel=\"nofollow noreferrer\">GoDoc: mongo-go-driver</a> or see <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">Github: mongodb/mongo-go-driver</a>. </p>\n\n<p>The new MongoDB official driver was released on 19th Feb 2018. Currently still in alpha version. \nFor more information see also <a href=\"https://engineering.mongodb.com/post/considering-the-community-effects-of-introducing-an-official-golang-mongodb-driver\" rel=\"nofollow noreferrer\">Blog: Considering The Community Effects of Introducing An Official Golang MongoDB Driver</a></p>\n"}, {"tags": [], "owner": {"reputation": 2400, "user_id": 6112685, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RAHsYhTeNC0/AAAAAAAAAAI/AAAAAAAAAsc/A5bLML9T638/photo.jpg?sz=128", "display_name": "Abhay", "link": "https://stackoverflow.com/users/6112685/abhay"}, "is_accepted": false, "score": 0, "last_activity_date": 1552656585, "creation_date": 1552656585, "answer_id": 55183728, "question_id": 41199258, "link": "https://stackoverflow.com/questions/41199258/mongodb-golang-library/55183728#55183728", "title": "MongoDB - Golang Library", "body": "<p><strong>Latest answer to your question is 'Yes'.</strong></p>\n\n<p>MongoDB official driver for Golang is released its v1.0.0 in 13th March 2019</p>\n\n<p>You can see the steps to use it on <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">github</a> as well as in <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">godoc</a></p>\n"}], "owner": {"reputation": 933, "user_id": 6837947, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/05ba42aca0fbd8bf2f2902f73dd60a99?s=128&d=identicon&r=PG&f=1", "display_name": "Kurt Maile", "link": "https://stackoverflow.com/users/6837947/kurt-maile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1976, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1552656585, "creation_date": 1481982516, "last_edit_date": 1482038980, "question_id": 41199258, "link": "https://stackoverflow.com/questions/41199258/mongodb-golang-library", "title": "MongoDB - Golang Library", "body": "<p>Is there an official golang library for MongoDB?  I am using the latest version of Mongo just released - 3.4.</p>\n\n<p>Best I can find is:</p>\n\n<p><a href=\"https://labix.org/mgo\" rel=\"nofollow noreferrer\">https://labix.org/mgo</a></p>\n\n<p>However this hasnt had a release since late 2015?</p>\n\n<p>Thanks! </p>\n"}, {"tags": ["rest", "go", "gorilla"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1481992822, "post_id": 41198483, "comment_id": 69600807, "body": "Well, if (and that I&#39;m not sure) I understand your problem, then <code>func init()</code> is what you are looking for."}], "answers": [{"tags": [], "owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "is_accepted": true, "score": 8, "last_activity_date": 1482012509, "creation_date": 1482012509, "answer_id": 41203541, "question_id": 41198483, "link": "https://stackoverflow.com/questions/41198483/registering-routes-to-central-object-in-go/41203541#41203541", "title": "Registering Routes to Central Object in Go", "body": "<p>You can use <code>func init()</code>. It is a special function which is called right before program execution, during package initialization.</p>\n\n<p>Here is an example of how to achieve what you want using gorilla/mux router, though it can be achieved with any other mux library.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\n// main.go\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\nvar routes []Route\n\nfunc registerRoute(route Route) {\n    routes = append(routes, route)\n}\n\nfunc main() {\n    router := mux.NewRouter().StrictSlash(false)\n    for _, route := range routes {\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(route.HandlerFunc)\n    }\n\n    if err := http.ListenAndServe(\":8080\", router); err != nil {\n        log.Fatalln(err)\n    }\n}\n\n// index.go\nfunc init() {\n    registerRoute(Route{\n        \"index\",\n        \"GET\",\n        \"/\",\n        func(w http.ResponseWriter, r *http.Request) {\n            fmt.Fprintf(w, \"welcome\")\n        },\n    })\n}\n\n// users.go\nfunc init() {\n    registerRoute(Route{\n        \"listUsers\",\n        \"GET\",\n        \"/users\",\n        listUsers,\n    })\n}\n\nfunc listUsers(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"users list\")\n}\n\n// products.go\nfunc init() {\n    registerRoute(Route{\n        \"listProducts\",\n        \"GET\",\n        \"/products\",\n        listProducts,\n    })\n}\n\nfunc listProducts(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"products list\")\n}\n</code></pre>\n\n<p>This pattern is used by golang for example by <code>database/sql</code> and <code>image</code> packages. You can read a little bit more about this here: <a href=\"https://www.calhoun.io/why-we-import-packages-we-dont-actually-use-in-golang/\" rel=\"noreferrer\">https://www.calhoun.io/why-we-import-packages-we-dont-actually-use-in-golang/</a></p>\n"}], "owner": {"reputation": 104, "user_id": 2466340, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7i5Vb.png?s=128&g=1", "display_name": "Noamyoungerm", "link": "https://stackoverflow.com/users/2466340/noamyoungerm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 1, "accepted_answer_id": 41203541, "answer_count": 1, "score": 1, "last_activity_date": 1482012509, "creation_date": 1481976928, "question_id": 41198483, "link": "https://stackoverflow.com/questions/41198483/registering-routes-to-central-object-in-go", "title": "Registering Routes to Central Object in Go", "body": "<p>I'm working on a simple Go REST API, using Mux. Most of the tutorials I've found suggested creating the router as follows:</p>\n\n<ul>\n<li>A <code>routes.go</code> file which contains a global array of all routes and all route handlers.</li>\n<li>A <code>router.go</code> file which creates a router object and loops over the global array and registers everything to the router.</li>\n</ul>\n\n<p>I'd rather use a different model:</p>\n\n<ul>\n<li>A <code>router.go</code> file instantiates a router object and has a <code>RegisterRoute</code> function</li>\n<li>Each file, representing a different object or component of the API, can call <code>RegisterRoute</code> and add additional routes to the router.</li>\n</ul>\n\n<p>I have no idea how to do this, because it seems to require creating an initialization function for each file and calling it from <code>main()</code> (which defeats the purpose). Is there any accepted way to do this?</p>\n"}, {"tags": ["web", "go", "server", "webpage", "interactive"], "comments": [{"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1481968738, "post_id": 41197376, "comment_id": 69594305, "body": "You have to use JavaScript, or a transpile-to-JavaScript language to create interactive web pages. TMK, Go does not have any transpilers to turn it into JS."}, {"owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1481970553, "post_id": 41197376, "comment_id": 69594776, "body": "Thanks for your answer. Is it possible to use GO to manage the data and JS to display them and interact with GO to get new data if needed ?"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1481971533, "post_id": 41197376, "comment_id": 69594998, "body": "Yes of course, you can write a web server with Golang which can serve JSON and/or HTML to the web client. There is the big choice between &quot;server rendered apps&quot; and SPA architecture. So you have a server written in Golang and the web client in JS."}, {"owner": {"reputation": 950, "user_id": 4955829, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5774190157eeea1436c4b5f70565ffc0?s=128&d=identicon&r=PG&f=1", "display_name": "silvergasp", "link": "https://stackoverflow.com/users/4955829/silvergasp"}, "edited": false, "score": 3, "creation_date": 1481974155, "post_id": 41197376, "comment_id": 69595628, "body": "<a href=\"http://www.gopherjs.org/\" rel=\"nofollow noreferrer\">Gopherjs</a> is a possible solution, it transpiles go to javascript. Otherwise you could perhaps use something like <a href=\"https://fragmenta.eu/\" rel=\"nofollow noreferrer\">fragmenta</a> if your looking for a cms."}, {"owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "edited": false, "score": 0, "creation_date": 1481975933, "post_id": 41197376, "comment_id": 69596020, "body": "Thanks, I&#39;ll take a look at Gopherjs and Fragmenta"}], "answers": [{"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": 0, "last_activity_date": 1481971331, "creation_date": 1481971331, "answer_id": 41197723, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/41197723#41197723", "title": "Interactive web pages in Go", "body": "<p>No, you cannot program interactive web pages in Go. This is because Go programs run on the server, not in the web browser.</p>\n\n<p>To do something interactive, you have to write JavaScript programs that <em>communicate</em> with the Go program on the server.</p>\n\n<p>The Go program is somehow involved with the interactive web app, but the interactivity comes from the JavaScript part.</p>\n"}, {"comments": [{"owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "edited": false, "score": 0, "creation_date": 1481994029, "post_id": 41198615, "comment_id": 69601071, "body": "Thanks for your answer, I have started using Gowut. Could you advise me about which function to use to store data in a 2-dimensional array - like with Excel/Calc (I&#39;m trying to present data in this kind of structure and update it according to how I use some filters that I will add on the web page) ? Thanks in advance."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "edited": false, "score": 0, "creation_date": 1481994807, "post_id": 41198615, "comment_id": 69601283, "body": "@azekirel555 For a 2 dimensional array I&#39;d use a <a href=\"https://godoc.org/github.com/icza/gowut/gwu#Table\" rel=\"nofollow noreferrer\"><code>gwu.Table</code></a>."}, {"owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "edited": false, "score": 0, "creation_date": 1481995081, "post_id": 41198615, "comment_id": 69601380, "body": "Thanks a lot, I&#39;m going to take a look at this."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1553768041, "last_edit_date": 1553768041, "creation_date": 1481978020, "answer_id": 41198615, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/41198615#41198615", "title": "Interactive web pages in Go", "body": "<p>Browsers are not capable of running Go code directly. Interactive web pages at the client side use different technologies, such as HTML, Javascript and CSS.</p>\n\n<p>However, it is a viable technology stack to use the above mentioned languages at the client side, and do everything in Go at the server side.</p>\n\n<p>That being said, there are still some frameworks that allow you to write everything in Go, and they transform your Go code to languages understood / supported by the client side, or they generate code for the client side that interact with the server-side Go code.</p>\n\n<p>For the latter, there is <a href=\"https://github.com/icza/gowut\" rel=\"nofollow noreferrer\"><strong>Gowut</strong> (Go Web UI Toolkit)</a> (<em>disclosure: I'm the author</em>). With Gowut, you can write everything in Go (both the client and the server side), and Gowut generates the necessary client code on-the-fly, and it takes care of the communication between the generated client code and the Go server code. There is a live demo of Gowut, you can check it out and see what it is capabe of here: <a href=\"https://gowut-demo.herokuapp.com/show\" rel=\"nofollow noreferrer\">Gowut - Showcase of Features</a></p>\n\n<p>Gowut creates completely dynamic webpages, the content is rendered and can change without page reload. And still, everything can be done simply using Go code, but you have the possibility to use HTML / JS / CSS code to spice things up \u2013 should you have the urge or need to do so.</p>\n\n<p>For the former, there's <a href=\"https://github.com/gopherjs/gopherjs\" rel=\"nofollow noreferrer\">GopherJS</a> and <a href=\"https://github.com/golang/go/wiki/WebAssembly\" rel=\"nofollow noreferrer\">Go's WebAssembly target</a> added in Go 1.11. GopherJS compiles Go code to pure Javascript code, so it's not really a web framework, but you can write client side code in Go with that. You still have to take care of server-side code and the communication between them. The WebAssembly target works similarly to GopherJS: you write Go code which will be compiled to a form that is capable running in the browser (run by the browser). The linked wiki page holds all the details how this can be achieved / used.</p>\n\n<p>There is also a powerful template engine in the standard library: <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html/template</code></a>. Although templates are executed exclusively at the server side, with the help of some basic Javascript code and AJAX calls (or websockets), you can make your client side dynamic and interactive. For examples, see these questions and answers:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/41136000/creating-load-more-button-in-golang-with-templates/41138344#41138344\">Creating load more button in Golang with templates</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/37118281/dynamically-refresh-a-part-of-the-template-when-a-variable-is-updated-golang/37119014#37119014\">Dynamically refresh a part of the template when a variable is updated golang</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/28751637/referencing-go-array-in-javascript/28753476#28753476\">Referencing Go array in Javascript</a></p>\n"}, {"tags": [], "owner": {"reputation": 1093, "user_id": 493216, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d43c4a0e2c0f7a33375393cc1b371453?s=128&d=identicon&r=PG", "display_name": "BigGinDaHouse", "link": "https://stackoverflow.com/users/493216/biggindahouse"}, "is_accepted": false, "score": 0, "last_activity_date": 1534872541, "creation_date": 1534872541, "answer_id": 51953892, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/51953892#51953892", "title": "Interactive web pages in Go", "body": "<p>You can do that, using power of Go and Gin Gonic framework - check simple and handy article here: <a href=\"https://semaphoreci.com/community/tutorials/building-go-web-applications-and-microservices-using-gin\" rel=\"nofollow noreferrer\">https://semaphoreci.com/community/tutorials/building-go-web-applications-and-microservices-using-gin</a></p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10082203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8d928a320c34c231f0d3ab306a46656?s=128&d=identicon&r=PG", "display_name": "GoPher9", "link": "https://stackoverflow.com/users/10082203/gopher9"}, "is_accepted": false, "score": 0, "last_activity_date": 1535640944, "creation_date": 1535640944, "answer_id": 52100067, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/52100067#52100067", "title": "Interactive web pages in Go", "body": "<p>\"\"No, you cannot program interactive web pages in Go. This is because Go programs run on the server, not in the web browser.</p>\n\n<p>To do something interactive, you have to write JavaScript programs that communicate with the Go program on the server.</p>\n\n<p>The Go program is somehow involved with the interactive web app, but the interactivity comes from the JavaScript part. \"\"</p>\n\n<p>I believe the answer is actually yes Go is capable of creating interactive websites, go is capable of reading from the http.Request so from this input you are able to define through your Go Code what will happen next with some Advanced Go programing.Go itself in theory was designed to be a web server side programming language but of course its output medium is the Web.  </p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10082203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8d928a320c34c231f0d3ab306a46656?s=128&d=identicon&r=PG", "display_name": "GoPher9", "link": "https://stackoverflow.com/users/10082203/gopher9"}, "is_accepted": false, "score": 0, "last_activity_date": 1537875661, "last_edit_date": 1537875661, "creation_date": 1537870711, "answer_id": 52495804, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/52495804#52495804", "title": "Interactive web pages in Go", "body": "<p>I found the long answer to my own question. It is not possible to directly program an interactive website with only Go BUT using GopherJS(<a href=\"https://github.com/gopherjs/gopherjs\" rel=\"nofollow noreferrer\">https://github.com/gopherjs/gopherjs</a>) (its a compiler from Go to JS) and Go it is very possible to create fully interactive websites. \nAlthough this undertaking is advanced and there is not allot of information available at this moment(2018/09/25)</p>\n\n<p>I thank you all for your efforts (good and bad).</p>\n\n<p>thank you for this part \"For the former, there's GopherJS. GopherJS compiles Go code to pure Javascript code, so it's not really a web framework, but you can write client side code in Go with that. You still have to take care of server-side code and the communication between them.\" Helped allot,</p>\n"}], "owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4632, "favorite_count": 2, "accepted_answer_id": 41198615, "answer_count": 5, "score": -1, "last_activity_date": 1553768041, "creation_date": 1481968594, "last_edit_date": 1481983280, "question_id": 41197376, "link": "https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go", "title": "Interactive web pages in Go", "body": "<p>Do you know if it's possible to create interactive web pages in Go?\nFor example, having one or multiple buttons, or a combo box that refreshes the page with the data being filtered according to the choice?\nI've tried to look for it but didn't find anything relevant.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "redis", "node-redis", "go-gin"], "comments": [{"owner": {"reputation": 5167, "user_id": 1392658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79f883869af02b3cc622773c00e5a83a?s=128&d=identicon&r=PG", "display_name": "Pascal Le Merrer", "link": "https://stackoverflow.com/users/1392658/pascal-le-merrer"}, "edited": false, "score": 1, "creation_date": 1481972467, "post_id": 41197200, "comment_id": 69595243, "body": "For the first question, the answer is no : <a href=\"http://stackoverflow.com/questions/23675394/redis-publish-subscribe-is-redis-guaranteed-to-deliver-the-message-even-under-m\" title=\"redis publish subscribe is redis guaranteed to deliver the message even under m\">stackoverflow.com/questions/23675394/&hellip;</a>. Look at antirez&#39;s comment for a possible solution"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7309727"}, "reply_to_user": {"reputation": 5167, "user_id": 1392658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79f883869af02b3cc622773c00e5a83a?s=128&d=identicon&r=PG", "display_name": "Pascal Le Merrer", "link": "https://stackoverflow.com/users/1392658/pascal-le-merrer"}, "edited": false, "score": 0, "creation_date": 1481973657, "post_id": 41197200, "comment_id": 69595521, "body": "Thanks for the answer. Looking for ACK maybe another solution for me. Because i&#39;m waiting for the second question&#39;s answer Hehe :D"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7309727"}, "edited": false, "score": 0, "creation_date": 1482029839, "post_id": 41199908, "comment_id": 69609447, "body": "Thanks for the answer. The fastest way to do for me is by doing select on channel."}], "tags": [], "owner": {"reputation": 12725, "user_id": 125913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69dc00171d2344fb0be796ddb7994541?s=128&d=identicon&r=PG", "display_name": "The Real Bill", "link": "https://stackoverflow.com/users/125913/the-real-bill"}, "is_accepted": true, "score": 1, "last_activity_date": 1481986944, "last_edit_date": 1495540427, "creation_date": 1481986944, "answer_id": 41199908, "question_id": 41197200, "link": "https://stackoverflow.com/questions/41197200/how-to-ensure-redis-subscriber-receive-message-in-go-golang/41199908#41199908", "title": "How to ensure redis subscriber receive message in Go (Golang)?", "body": "<p>1) There are no callbacks in Redis. </p>\n\n<p>2) The usual way to implement a timeout in Go is to use channels and select - where one is a channel where you do the blocking and another channel receives a message on timeout. Examples of that can be found <a href=\"https://stackoverflow.com/questions/23582143/golang-using-timeouts-with-channels\">here</a> and <a href=\"https://blog.golang.org/go-concurrency-patterns-timing-out-and\" rel=\"nofollow noreferrer\">here for the docs</a></p>\n\n<p>Now for (3), you have some options on methods. The first is to use a list, pushing from one side (publishing) and popping from another (subscribing). For the receiver you wild use <code>BRPOP</code> of <code>BLPOP</code> - blocking pop from right or left respectively. You can combine the two to have persistent messaging. </p>\n\n<p>Now part of PUBSUB also depends on what you are publishing to. If you are publishing to a channel that would have a subscriber <em>if and only if</em> there is a user connected to receive it (and thus one and only one subscriber to that channel), you can check the response from your publish command. It will tell you how many clients it was published to. If the channel is only subscribed to by an online receiver you would get a '1' back, and a '0' if the user was offline.</p>\n\n<p>A third example is to store the messages in a sorted set, with the timestamp as the score. This would allow the receiver to connect and get messages from the last time it was connected - but that assumes some persistence of that somewhere - usually the client. You would also need some cleanup activity on the sorted sets.</p>\n\n<p>Some other things to consider in this scenario is whether you eventually use replication, in which case you have to explicitly account for failovers - though really in the scenario you describe you'd want to account for disconnects and reconnects. There are specific examples of this at <a href=\"https://objectrocket.com/blog/how-to/reliable-pubsub-and-blocking-commands-during-redis-failovers\" rel=\"nofollow noreferrer\">my post on reliable PUBSUB</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5761434, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LIPKBXYePIY/AAAAAAAAAAI/AAAAAAAAAFI/MKsQEoGdf34/photo.jpg?sz=128", "display_name": "\u866b\u5b50\u6a31\u6843", "link": "https://stackoverflow.com/users/5761434/%e8%99%ab%e5%ad%90%e6%a8%b1%e6%a1%83"}, "is_accepted": false, "score": 0, "last_activity_date": 1609904284, "creation_date": 1609904284, "answer_id": 65589876, "question_id": 41197200, "link": "https://stackoverflow.com/questions/41197200/how-to-ensure-redis-subscriber-receive-message-in-go-golang/65589876#65589876", "title": "How to ensure redis subscriber receive message in Go (Golang)?", "body": "<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;fmt&quot;\n    &quot;time&quot;\n\n    &quot;github.com/go-redis/redis/v8&quot;\n)\n\nvar ctx = context.Background()\n\nfunc main() {\n    rdb := redis.NewClient(&amp;redis.Options{\n        Addr:     &quot;localhost:6379&quot;,\n        Password: &quot;&quot;, // no password set\n        DB:       0,  // use default DB\n    })\n\n    subscribe := rdb.Subscribe(ctx, &quot;hello&quot;)\n    subscriptions := subscribe.ChannelWithSubscriptions(ctx, 1)\n    go func() {\n        var sentCount = 0\n        for  {\n            rdb.Publish(ctx,&quot;hello&quot;,time.Now().UnixNano())\n            sentCount++\n            if sentCount &gt;300{\n                break\n            }\n        }\n    }()\n    for  {\n        select {\n        case sub:=&lt;-subscriptions:\n            fmt.Println(sub)\n        }\n    }\n\n\n\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7309727"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4216, "favorite_count": 1, "accepted_answer_id": 41199908, "answer_count": 2, "score": 2, "last_activity_date": 1609904284, "creation_date": 1481967056, "last_edit_date": 1489445698, "question_id": 41197200, "link": "https://stackoverflow.com/questions/41197200/how-to-ensure-redis-subscriber-receive-message-in-go-golang", "title": "How to ensure redis subscriber receive message in Go (Golang)?", "body": "<p>I'm using gin framework to build an API server. In General, I'm build 2 projects. Project <code>'API'</code> and Project <code>'SOCKET'</code>. Project <code>'API'</code> is the main REST API that will used in Android, developed using <code>gin</code> framework (golang). And Project <code>'SOCKET'</code> is the socket server for client that will use socket connection , using node.js (<code>Socket.IO</code>) </p>\n\n<p>The process begin like this : <br>\nUser A : as the requester ; A connect to <code>\"API\"</code> <br>\nUser B : as the responder ; B connect to <code>\"SOCKET\"</code></p>\n\n<p><code>User A</code> call API <code>requestData</code> from android, the request will handled by <code>\"API\"</code>'s project. And Project <code>\"API\"</code> will record the request, and publish on redis \nas <code>new_request</code> using pubsub </p>\n\n<p>this is the code for example : </p>\n\n<pre><code>client := redis.NewClient(&amp;redis.Options{\n    Addr:     \"localhost:6379\",\n    Password: \"\", // no password set\n    DB:       0,  // use default DB\n})\n\npong, err := client.Ping().Result()\n\nfmt.Println(pong, err)\n\n if err !=nil {\n    fmt.Println(\"err\",err);\n }\n\n\npubsub, err := client.Subscribe(\"responseclient\")\nif err !=nil {\n    panic(err)\n}\ndefer pubsub.Close()\n\nerr = client.Publish(\"new_request\", \"Example New Request\").Err()\n\nif err !=nil {\n    panic(err)\n}\nmsg, err :=pubsub.ReceiveMessage()\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(msg.Channel, msg.Payload)\n</code></pre>\n\n<p>}</p>\n\n<p>In Project <code>\"SOCKET\"</code> there is a subscriber that will listen every publish that occured, and publish new message to channel <code>responseclient</code>\nthis is for the example code : </p>\n\n<pre><code>ioApp.on ('connection' , function(socket) {\nredisSub.on('new_request', function (channel, message) {\n    console.log(channel + ':' + message);\n\n    redisPub.publish(\"responseclient\", JSON.stringify(res));    \n\n}); \n</code></pre>\n\n<p>})</p>\n\n<p>This work smoothly, if <strong>User B is Connected to Socket.IO</strong>. But if <strong>User B</strong> was offline, or not connected to socket.io, this will waiting for long, until we kill manually or until User B is online</p>\n\n<p>What i am asking for , are : </p>\n\n<ol>\n<li>Can we create something like a <code>callback</code> on redis pub/sub ? If the subscriber doesn't accept the message, due to off line, or something else , we close the connection. Is this possible ?</li>\n<li>In Node.Js i know i can use timeout function, that will close the subscribe or emit any event if on certain time, there was no message received, how to do this on golang ?  I need to inform the <code>User A</code> if <code>User B</code> is active or offline, so he can wait for a another time to create request. </li>\n<li>If nothing can, what is your suggestion for me to do this ? </li>\n</ol>\n\n<p>I hope my question , understandable, and can answered well.\n<br>*Some code maybe, missing variable. <br>\n** I'm using this library for golang redis : <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis</a></p>\n"}, {"tags": ["post", "go", "http-post"], "answers": [{"comments": [{"owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "edited": false, "score": 0, "creation_date": 1482000630, "post_id": 41196005, "comment_id": 69603102, "body": "This will not work because I am encoding it into JSON format. Fprintf does not accept JSON formats"}, {"owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "edited": false, "score": 0, "creation_date": 1482001014, "post_id": 41196005, "comment_id": 69603195, "body": "The proper way to do it was encode it into JSON, then use <code>rw.Write</code>"}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "reply_to_user": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "edited": false, "score": 0, "creation_date": 1482124649, "post_id": 41196005, "comment_id": 69630963, "body": "@Bolboa, marshalled JSON is a byte array, which should work with Fprintf."}], "tags": [], "owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "is_accepted": true, "score": 1, "last_activity_date": 1481956359, "creation_date": 1481956359, "answer_id": 41196005, "question_id": 41195935, "link": "https://stackoverflow.com/questions/41195935/how-to-send-response-to-fetch-api/41196005#41196005", "title": "How to send response to fetch API", "body": "<p>You write your response to to the <code>http.ResponseWriter</code>. For example:</p>\n\n<pre><code>func Validate(rw http.ResponseWriter, req *http.Request, _ httprouter.Params) {\n\n    decoder := json.NewDecoder(req.Body)\n\n    var creds credentials\n\n    err := decoder.Decode(&amp;creds)\n\n    if err != nil {\n        panic(err)\n    }\n\n    // rw is the HTTP response writer.\n    fmt.Fprintf(rw, \"success\")\n}\n</code></pre>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 41196005, "answer_count": 1, "score": 0, "last_activity_date": 1481956359, "creation_date": 1481955686, "question_id": 41195935, "link": "https://stackoverflow.com/questions/41195935/how-to-send-response-to-fetch-api", "title": "How to send response to fetch API", "body": "<p>I am using <code>fetch</code> API to send data to my <code>POST</code> request...</p>\n\n<pre><code>fetch('http://localhost:8080/validation', {\n    method:'POST',\n    headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n        email:this.state.email,\n        password:this.state.password\n    })\n})\n.then((response) =&gt; response.json())\n.then((responseJson) =&gt; {\n    console.log(\"response\");\n})\n.catch(function(error) {\n    console.log(error);\n})\n</code></pre>\n\n<p>Simple enough, just sending <code>email</code> and <code>password</code> to <code>POST</code> handler. It is received and saved without error, but now I want to send back a custom response.</p>\n\n<p>At the moment, my response throws an error. My <code>Post</code> handler looks as follows...</p>\n\n<pre><code>func Validate(rw http.ResponseWriter, req *http.Request, _ httprouter.Params) {\n\n    decoder := json.NewDecoder(req.Body)\n\n    var creds credentials\n\n    err := decoder.Decode(&amp;creds)\n\n    if err != nil {\n        panic(err)\n    }\n    ...\n</code></pre>\n\n<p>I do not know how to send a response. I'm assuming I need to encode to <code>json</code> first and then send it. But how exactly do I send it?</p>\n\n<p>Let's say I want to return a string <code>\"success\"</code>, do I need to <code>return</code> it? Or use <code>fmt.Println()</code>?</p>\n"}, {"tags": ["post", "go"], "answers": [{"comments": [{"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1482027099, "post_id": 41195681, "comment_id": 69609117, "body": "Fwiw, the other answer is superior, I misunderstood the part about not being sure what the structure is, the original question clearly specified that the client side code is under the author&#39;s control."}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 2, "last_activity_date": 1481952827, "creation_date": 1481952827, "answer_id": 41195681, "question_id": 41195596, "link": "https://stackoverflow.com/questions/41195596/parse-req-body-in-post-request/41195681#41195681", "title": "Parse req.body in POST request", "body": "<p><code>req.Body</code> is an <code>io.Reader</code>, and you can get use <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll</code></a> to drain it:</p>\n\n<pre><code>data, err := ioutil.ReadAll(req.Body)\nasString := string(data) // you can convert to a string with a typecast\n</code></pre>\n\n<p>But I'm not sure if that's what you meant by trying to save <code>req.Body</code> as a string.</p>\n\n<p>To parse the response into a data structure, you can unmarshal it into a variable of type <code>*interface{}</code>:</p>\n\n<pre><code>var creds interface{}\ndecoder.Decode(&amp;creds)\n</code></pre>\n\n<p>And then examine the value:</p>\n\n<pre><code>fmt.Printf(\"%#v\\n\", creds)\n</code></pre>\n\n<p>Or perhaps using <a href=\"https://github.com/k0kubun/pp\" rel=\"nofollow noreferrer\"><code>pp.Println(creds)</code></a> which I find easier to read.</p>\n\n<p>The <code>creds</code> variable will represent the JSON object found in the body, for your example input this will be a <code>map[string]interface{}</code> with two entries, presumably both of them strings. Something like:</p>\n\n<pre><code>map[string]interface{}{\n    \"email\": email_value,\n    \"password\": password_value,\n}\n</code></pre>\n\n<p>and you check the values with:</p>\n\n<pre><code>email, ok := creds[\"email\"].(string)\nif ok {\n    // email will contain the value because creds[\"email\"] passed the type check\n    fmt.Printf(\"submitted email is %#v\\n\", email)\n} else {\n    // \"email\" property was a string (may be missing, may be something else)\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">documentation of <code>json.Unmarshal</code></a> explains the semantics of how arbitrary JSON strings can be parsed without knowing their structure in advance in the discussion about unmarshalling to interface values.</p>\n"}, {"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 5, "last_activity_date": 1481953302, "creation_date": 1481953302, "answer_id": 41195725, "question_id": 41195596, "link": "https://stackoverflow.com/questions/41195596/parse-req-body-in-post-request/41195725#41195725", "title": "Parse req.body in POST request", "body": "<p>Try with </p>\n\n<pre><code>type credentials struct {\n    Email string `json:\"email\"`\n    Password string `json:\"password\"`\n}\n</code></pre>\n\n<p>You are receiving a JSON with two values. Receiving struct should have a structure matching your request. Otherwise, there are no placeholders to decode the JSON into, as in your case - email and password do not have matching struct fields. Btw. if you send <code>\"Test\"</code> in your JSON, this would work, as you have a Test field in your struct!</p>\n\n<p>Regarding field names. If fields in JSON do not start with a capital letter or even have different names, then you should use so called tags. \nMore on tags: <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<p>In my example I used them to match struct field names to your json fields, i.e. to make <code>email</code> from json match <code>Email</code> field of the <code>credentials</code> struct.</p>\n"}], "owner": {"reputation": 7204, "user_id": 4333347, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b091d5e3973e6f65ec16442c3b1b16b?s=128&d=identicon&r=PG", "display_name": "buydadip", "link": "https://stackoverflow.com/users/4333347/buydadip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3765, "favorite_count": 0, "accepted_answer_id": 41195725, "answer_count": 2, "score": 4, "last_activity_date": 1481953302, "creation_date": 1481951917, "question_id": 41195596, "link": "https://stackoverflow.com/questions/41195596/parse-req-body-in-post-request", "title": "Parse req.body in POST request", "body": "<p>I am using <code>fetch</code> API to send two values to my <code>POST</code> request handler...</p>\n\n<pre><code>fetch('http://localhost:8080/validation', {\n        method:'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            email:this.state.email,\n            password:this.state.password\n        })\n</code></pre>\n\n<p>I want to save both <code>email</code> and <code>password</code> as strings on the server side. Here is my attempt...</p>\n\n<pre><code>type credentials struct {\n    Test string\n}\n\nfunc Validate(rw http.ResponseWriter, req *http.Request, _ httprouter.Params) {\n\n    decoder := json.NewDecoder(req.Body)\n\n    var creds credentials\n\n    err := decoder.Decode(&amp;creds)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(creds.Test)\n}\n</code></pre>\n\n<p>The problem is I do not know how exactly the format of the structure being sent to the <code>POST</code>. I am attempting to save <code>req.Body</code> as a string but this yields nothing.</p>\n\n<p>When I print <code>fmt.Println</code> I get a blank space. What is the proper way of parsing it?</p>\n"}, {"tags": ["file-upload", "go", "amazon-s3"], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 2, "last_activity_date": 1491838141, "last_edit_date": 1491838141, "creation_date": 1481951110, "answer_id": 41195541, "question_id": 41195209, "link": "https://stackoverflow.com/questions/41195209/golang-file-upload-to-s3-using-os-open/41195541#41195541", "title": "Golang file upload to s3 using OS Open", "body": "<p>After POST to your API, images are temporarily saved in a OS's temp directory (different for different OS's) by default. To get this directory you can use, for example:</p>\n\n<pre><code>func GetTempLoc(filename string) string {\n    return strings.TrimRight(os.TempDir(), \"/\") + \"/\" + filename\n}\n</code></pre>\n\n<p>Where:</p>\n\n<ul>\n<li>filename is a header.Filename, i.e. file name received in your POST request. In Gin-Gonic framework you get it in your request handler as:</li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>file, header, err := c.Request.FormFile(\"file\")\nif err != nil {\n    return out, err\n}\ndefer file.Close()\n</code></pre>\n\n<p>Example: <a href=\"https://github.com/gin-gonic/gin#another-example-upload-file\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#another-example-upload-file</a>.</p>\n\n<p>I'm sure in your framework there will be an analogue.</p>\n\n<ul>\n<li>os.TempDir() is a function go give you a temp folder (details: <a href=\"https://golang.org/pkg/os/#TempDir\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#TempDir</a>).</li>\n<li>TrimRight is used to ensure result of os.TempDir is consistent on different OSs</li>\n</ul>\n\n<p>And then you use it as </p>\n\n<pre><code>file, err := os.Open(GetTempLoc(fileName))\n...\n</code></pre>\n"}], "owner": {"reputation": 913, "user_id": 5551912, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ed9452605a562b6865a5527f92173a0?s=128&d=identicon&r=PG&f=1", "display_name": "Rome Torres", "link": "https://stackoverflow.com/users/5551912/rome-torres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1545, "favorite_count": 2, "accepted_answer_id": 41195541, "answer_count": 1, "score": 0, "last_activity_date": 1491838141, "creation_date": 1481946810, "question_id": 41195209, "link": "https://stackoverflow.com/questions/41195209/golang-file-upload-to-s3-using-os-open", "title": "Golang file upload to s3 using OS Open", "body": "<p>I am trying to upload an Image to my s3 account using Golang and the amazon s3 api . I can get the imagine uploaded if I hard code the direct path such as </p>\n\n<pre><code>file, err :=  os.Open(\"/Users/JohnSmith/Documents/pictures/cars.jpg\")\n    defer file.Close()\n    if err != nil {\n        fmt.Printf(\"err opening file: %s\", err)\n    }\n</code></pre>\n\n<p>if I hard code the file path like that then the picture will be uploaded to my s3 account . However that approach is not good as I can't obviously hard code the direct image path to every image that I want to upload . My question is how can I upload images without having to Hardcode the path . This will be apart of an API where users will upload images so I clearly can not have a hard coded path . This is my code first the HTML</p>\n\n<pre><code>&lt;form method=\"post\" enctype=\"multipart/form-data\"  action=\"profile_image\"&gt;\n    &lt;h2&gt;Image Upload&lt;/h2&gt;\n    &lt;p&gt;&lt;input type=\"file\" name=\"file\" id=\"file\"/&gt; &lt;/p&gt;\n       &lt;p&gt; &lt;input type=\"submit\" value=\"Upload Image\"&gt;&lt;/p&gt;\n\n&lt;/form&gt;\n</code></pre>\n\n<p>then this is my HTTP Post function method</p>\n\n<pre><code>func UploadProfile(w http.ResponseWriter, r *http.Request) {\n\n    r.ParseForm()\n      var resultt string\n    resultt = \"Hi\"\n\n    sess, _ := session.NewSession(&amp;aws.Config{\n        Region:      aws.String(\"us-west-2\"),\n        Credentials: credentials.NewStaticCredentials(aws_access_key_id,aws_secret_access_key, \"\"),\n\n\n    })\n    svc := s3.New(sess)\n\nfile, err :=  os.Open(\"Users/JohnSmith/Documents/pictures/cars.jpg\")\ndefer file.Close()\nif err != nil {\n    fmt.Printf(\"err opening file: %s\", err)\n}\n\n\n\nfileInfo, _ := file.Stat()\nsize := fileInfo.Size()\nbuffer := make([]byte, size) // read file content to buffer\n\nfile.Read(buffer)\nfileBytes := bytes.NewReader(buffer)\nfileType := http.DetectContentType(buffer)\npath := file.Name()\nparams := &amp;s3.PutObjectInput{\n    Bucket: aws.String(\"my-bucket\"),\n    Key: aws.String(path),\n    Body: fileBytes,\n    ContentLength: aws.Int64(size),\n    ContentType: aws.String(fileType),\n}\nresp, err := svc.PutObject(params)\nif err != nil {\n    fmt.Printf(\"bad response: %s\", err)\n}\nfmt.Printf(\"response %s\", awsutil.StringValue(resp))\n\n}\n</code></pre>\n\n<p>That is my full code above however when I try to do something such as</p>\n\n<pre><code>file, err :=  os.Open(\"file\")\n    defer file.Close()\n    if err != nil {\n        fmt.Printf(\"err opening file: %s\", err)\n    }\n</code></pre>\n\n<p>I get the following error</p>\n\n<pre><code>http: panic serving [::1]:55454: runtime error: invalid memory address or nil pointer dereference\ngoroutine 7 [running]:\nerr opening file: open file: no such file or directorynet/http.(*conn).serve.func1(0xc420076e80)\n</code></pre>\n\n<p>I can't use absolute path <em>(filepath.Abs())</em> because some of the files will be outside of the GoPath and as stated other users will be uploading. Is there anyway that I can get a relative path ..</p>\n"}, {"tags": ["go", "concourse"], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 835293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce2de98e308a7989b05a1e082607217b?s=128&d=identicon&r=PG", "display_name": "pns", "link": "https://stackoverflow.com/users/835293/pns"}, "is_accepted": false, "score": 0, "last_activity_date": 1488455971, "creation_date": 1488455971, "answer_id": 42554937, "question_id": 41190828, "link": "https://stackoverflow.com/questions/41190828/go-binaries-for-concourse-ci-tasks/42554937#42554937", "title": "Go binaries for concourse ci tasks", "body": "<p>The way I see it there are currently 3 options for handling go builds:</p>\n\n<ol>\n<li>Use vendoring</li>\n<li>Explicitly declare the dependencies as concourse resources</li>\n<li>Maintain a docker image with the required dependencies already included</li>\n</ol>\n\n<p>All options have pros and cons. The first option is currently my favorite since the responsibility for handling dependencies is up to the project maintainers and there is a very clear way to see which versions/revisions of the dependencies are being used - i.e. just check the vendoring tool config - but it does force you to have all dependency code in the project's repo.</p>\n\n<p>The second option follows the go \"philosophy\" of always tracking master, but it may lead to slower builds (concourse will need to check every single resource regularly) and may lead to sudden breakage because of changes in dependencies.</p>\n\n<p>The third option allows you to implicitly fix the revision of the dependencies in the docker image, in that respect it's similar to the first, however it requires maintaining docker images (doesn't necessarily mean 1 per project, but it might mean more than one depending on the number of projects that use this option and if there are conflicting dependency versions between them)</p>\n"}], "owner": {"reputation": 36176, "user_id": 46460, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/ded01cdab114abe4ec13511e4c25b9bb?s=128&d=identicon&r=PG", "display_name": "Andy Hume", "link": "https://stackoverflow.com/users/46460/andy-hume"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488455971, "creation_date": 1481914825, "last_edit_date": 1481916415, "question_id": 41190828, "link": "https://stackoverflow.com/questions/41190828/go-binaries-for-concourse-ci-tasks", "title": "Go binaries for concourse ci tasks", "body": "<p>What are some good patterns for using go in concourse-ci tasks. For example, should I build files locally with all dependencies and check-in cross-compiled binaries to the repo? Should I build on concourse prior to running the task?</p>\n\n<p>Examples of what people do here would be great. Public repos of pipelines/tasks even better.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1481911782, "post_id": 41190032, "comment_id": 69579992, "body": "Obviously it should be in <code>&#47;usr&#47;local&#47;go&#47;src&#47;github.com&#47;googollee&#47;go-socket.io</code> or <code>&#47;Users&#47;YoungHoonKim&#47;Documents&#47;chat&#47;src&#47;github.com&#47;googollee&#47;&zwnj;&#8203;go-socket.io</code> but seems like it isn&#39;t. Try running <code>go get github.com&#47;googollee&#47;go-socket.io</code>"}, {"owner": {"reputation": 137, "user_id": 6637753, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1e7c4ff91105b598d78aa83c18ce9fa?s=128&d=identicon&r=PG&f=1", "display_name": "Hoon", "link": "https://stackoverflow.com/users/6637753/hoon"}, "reply_to_user": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "edited": false, "score": 0, "creation_date": 1482156341, "post_id": 41190032, "comment_id": 69647234, "body": "Thanks. googollee obviously needed to be downloaded by hand. solved it."}], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 4, "last_activity_date": 1481915605, "creation_date": 1481915605, "answer_id": 41191027, "question_id": 41190032, "link": "https://stackoverflow.com/questions/41190032/golang-import-package-error/41191027#41191027", "title": "Golang import package error", "body": "<p>Double-check your actual go work directory with <code>echo $GOPATH</code> in your terminal.\nThis will be your starting point to identify if you have this package at all, for example you should be able to see this package doing <code>cd $GOPATH/src/github.com/googollee/go-socket.io</code>.</p>\n\n<p>For more details on correct directory location (workspace in general) please check <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n"}], "owner": {"reputation": 137, "user_id": 6637753, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b1e7c4ff91105b598d78aa83c18ce9fa?s=128&d=identicon&r=PG&f=1", "display_name": "Hoon", "link": "https://stackoverflow.com/users/6637753/hoon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1087, "favorite_count": 1, "accepted_answer_id": 41191027, "answer_count": 1, "score": 2, "last_activity_date": 1481992595, "creation_date": 1481911443, "last_edit_date": 1481992595, "question_id": 41190032, "link": "https://stackoverflow.com/questions/41190032/golang-import-package-error", "title": "Golang import package error", "body": "<blockquote>\n  <p>go:5:2: cannot find package \"github.com/googollee/go-socket.io\" in any of:\n      /usr/local/go/src/github.com/googollee/go-socket.io (from $GOROOT)\n      /Users/YoungHoonKim/Documents/chat/src/github.com/googollee/go-socket.io (from $GOPATH)</p>\n</blockquote>\n\n<p>I'm getting this error while trying to compile my <code>chat.go</code> file with LiteIDE. I'm following a guide to build a chatserver, so I don't know where this package should be. any help?</p>\n"}, {"tags": ["go", "pipe", "system-calls"], "answers": [{"comments": [{"owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "edited": false, "score": 0, "creation_date": 1481905964, "post_id": 41188538, "comment_id": 69577191, "body": "Thanks, I&#39;m aware of <code>os&#47;exec</code> <i>et al</i>, but it won&#39;t solve my problem at all. I want to pipe data to pager-like environment (<code>less</code>), not to process it with some text utilities and deal with the output."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "edited": false, "score": 0, "creation_date": 1481906923, "post_id": 41188538, "comment_id": 69577714, "body": "@PetrShevtsov: I misunderstood, because you can&#39;t directly pipe to a process you&#39;re going to exec. A pipe is blocking and the data has to be buffered somewhere. It&#39;s not a Go problem per say, because you can&#39;t do that in general. If you&#39;re on a posix system (which I assume with the syscall.Exec and <code>less</code> calls), you can just remove the tmp file."}, {"owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "edited": false, "score": 0, "creation_date": 1481908629, "post_id": 41188538, "comment_id": 69578574, "body": "thank you, it works! But can I get rid of temp file and write directly to <code>syscall.Stdin</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "edited": false, "score": 0, "creation_date": 1481909948, "post_id": 41188538, "comment_id": 69579268, "body": "@PetrShevtsov: no, for the reason I stated earlier, the data needs to be buffered somewhere and your original process no longer exists to write to the stdin after the Exec call. Some programs may do this by forking too, and having the child continue to write to FD 0, but you can&#39;t fork in Go."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1481914890, "last_edit_date": 1481914890, "creation_date": 1481905416, "answer_id": 41188538, "question_id": 41188453, "link": "https://stackoverflow.com/questions/41188453/pipe-to-execed-process/41188538#41188538", "title": "Pipe to exec&#39;ed process", "body": "<p>You should be using <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\"><code>os/exec</code></a> to build an <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\"><code>exec.Cmd</code></a> to execute, then you could supply any <code>io.Reader</code> you want as the stdin for the command.</p>\n\n<p>From the example in the documentation:</p>\n\n<pre><code>cmd := exec.Command(\"tr\", \"a-z\", \"A-Z\")\ncmd.Stdin = strings.NewReader(\"some input\")\nvar out bytes.Buffer\ncmd.Stdout = &amp;out\nerr := cmd.Run()\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"in all caps: %q\\n\", out.String())\n</code></pre>\n\n<p>If you want to write directly to the command's stdin, then you call <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow noreferrer\"><code>cmd.StdInPipe</code></a> to get an <code>io.WriteCloser</code> you can write to. </p>\n\n<p>If you really need to <code>exec</code> the process in place of your current one, you can simply remove the file before exec'ing, and provide that file descriptor as stdin for the program.</p>\n\n<pre><code>content := []byte(\"temporary file's content\")\ntmpfile, err := ioutil.TempFile(\"\", \"example\")\nif err != nil {\n    log.Fatal(err)\n}\nos.Remove(tmpfile.Name())\n\nif _, err := tmpfile.Write(content); err != nil {\n    log.Fatal(err)\n}\n\ntmpfile.Seek(0, 0)\n\nerr = syscall.Dup2(int(tmpfile.Fd()), syscall.Stdin)\nif err != nil {\n    log.Fatal(err)\n}\n\nbinary, err := exec.LookPath(\"less\")\nif err != nil {\n    log.Fatal(err)\n}\n\nargs := []string{\"less\"}\n\nif err := syscall.Exec(binary, args, os.Environ()); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 41188538, "answer_count": 1, "score": 1, "last_activity_date": 1481914890, "creation_date": 1481905092, "question_id": 41188453, "link": "https://stackoverflow.com/questions/41188453/pipe-to-execed-process", "title": "Pipe to exec&#39;ed process", "body": "<p>My Go application outputs some amounts of text data and I need to pipe it to some external command (e.g. <code>less</code>). I haven't find any way to pipe this data to <code>syscall.Exec</code>'ed process.</p>\n\n<p>As a workaround I write that text data to a temporary file and then use that file as an argument to <code>less</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"syscall\"\n)\n\nfunc main() {\n    content := []byte(\"temporary file's content\")\n    tmpfile, err := ioutil.TempFile(\"\", \"example\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer os.Remove(tmpfile.Name()) // Never going to happen!\n\n    if _, err := tmpfile.Write(content); err != nil {\n        log.Fatal(err)\n    }\n    if err := tmpfile.Close(); err != nil {\n        log.Fatal(err)\n    }\n\n    binary, err := exec.LookPath(\"less\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    args := []string{\"less\", tmpfile.Name()}\n\n    if err := syscall.Exec(binary, args, os.Environ()); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>It works but leaves a temporary file on a file system, because <code>syscall.Exec</code> replaces the current Go process with another (<code>less</code>) one and deferred <code>os.Remove</code> won't run. Such behaviour is not desirable.</p>\n\n<p>Is there any way to pipe some data to an external process without leaving any artefacts?</p>\n"}, {"tags": ["rest", "generics", "go"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1481899818, "post_id": 41186856, "comment_id": 69573575, "body": "You said, &quot;Currently, I need to write on handler per action per object.&quot; That&#39;s what i use <code>go generate</code> for.  You dont need generics!"}, {"owner": {"reputation": 1271, "user_id": 277874, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7011a7637837c4f0871d069b7661cfe4?s=128&d=identicon&r=PG", "display_name": "Kedare", "link": "https://stackoverflow.com/users/277874/kedare"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1481900363, "post_id": 41186856, "comment_id": 69573933, "body": "Is this a good practice ? Because basically, by doing this I will still have duplicated code everywhere, that would be harder to maintain than having a generic code handling most of the cases."}], "answers": [{"comments": [{"owner": {"reputation": 1271, "user_id": 277874, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7011a7637837c4f0871d069b7661cfe4?s=128&d=identicon&r=PG", "display_name": "Kedare", "link": "https://stackoverflow.com/users/277874/kedare"}, "edited": false, "score": 0, "creation_date": 1481904845, "post_id": 41187366, "comment_id": 69576562, "body": "Awesome, that&#39;s exactly what I was looking for, thank you ! :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1481903308, "last_edit_date": 1481903308, "creation_date": 1481901251, "answer_id": 41187366, "question_id": 41186856, "link": "https://stackoverflow.com/questions/41186856/how-to-write-a-generic-handler-in-go/41187366#41187366", "title": "How to write a generic handler in Go?", "body": "<p>Use the reflect package to create a new container on each invocation:</p>\n\n<pre><code>func ObjectIndex(collection string, container interface{}) func(http.ResponseWriter, *http.Request) {\n  t := reflect.TypeOf(container)\n  return func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    db := r.Context().Value(\"Database\").(*mgo.Database)\n    objects := reflect.New(t).Interface()\n    err := db.C(collection).Find(bson.M{}).All(objects)\n    if err != nil {\n        panic(err)\n    }\n    json.NewEncoder(w).Encode(objects)\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>h := ObjectIndex(\"ingredients\", data.Ingredient{})\n</code></pre>\n\n<p>assuming that <code>data.Indgredient</code> is a slice type.</p>\n"}], "owner": {"reputation": 1271, "user_id": 277874, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7011a7637837c4f0871d069b7661cfe4?s=128&d=identicon&r=PG", "display_name": "Kedare", "link": "https://stackoverflow.com/users/277874/kedare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 0, "accepted_answer_id": 41187366, "answer_count": 1, "score": 1, "last_activity_date": 1481903308, "creation_date": 1481899567, "last_edit_date": 1481900291, "question_id": 41186856, "link": "https://stackoverflow.com/questions/41186856/how-to-write-a-generic-handler-in-go", "title": "How to write a generic handler in Go?", "body": "<p>I need to create a HTTP Handler for a REST API.</p>\n\n<p>This REST API have many different objects that are stored in a database (MongoDB in my case).</p>\n\n<p>Currently, I need to write one handler per action per object.</p>\n\n<p>I would like to find a way like it's possible with Generics to write a generic handler that could handle a specific action but for any kind of object (As basically it's just CRUD in most of the case)</p>\n\n<p>How can I do this ?</p>\n\n<p>Here is examples of Handlers I would like to transform into a generic one :</p>\n\n<pre><code>func IngredientIndex(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    db := r.Context().Value(\"Database\").(*mgo.Database)\n    ingredients := []data.Ingredient{}\n    err := db.C(\"ingredients\").Find(bson.M{}).All(&amp;ingredients)\n    if err != nil {\n        panic(err)\n    }\n    json.NewEncoder(w).Encode(ingredients)\n}\n\nfunc IngredientGet(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    vars := mux.Vars(r)\n    logger := r.Context().Value(\"Logger\").(zap.Logger)\n    db := r.Context().Value(\"Database\").(*mgo.Database)\n    ingredient := data.Ingredient{}\n    err := db.C(\"ingredients\").Find(bson.M{\"_id\": bson.ObjectIdHex(vars[\"id\"])}).One(&amp;ingredient)\n    if err != nil {\n        w.WriteHeader(404)\n        logger.Info(\"Fail to find entity\", zap.Error(err))\n    } else {\n        json.NewEncoder(w).Encode(ingredient)\n    }\n}\n</code></pre>\n\n<p>Basically I would need a handler like this (This is my tentative that doesn't work) :</p>\n\n<pre><code>func ObjectIndex(collection string, container interface{}) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        db := r.Context().Value(\"Database\").(*mgo.Database)\n        objects := container\n        err := db.C(collection).Find(bson.M{}).All(&amp;objects)\n        if err != nil {\n            panic(err)\n        }\n        json.NewEncoder(w).Encode(objects)\n    }\n</code></pre>\n\n<p>How can I do that ?</p>\n"}, {"tags": ["go", "concurrency", "deadlock"], "comments": [{"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1481896188, "post_id": 41185542, "comment_id": 69571361, "body": "You should probably not be mixing locks with channels if you want idiomatic Go. <i>Do not communicate by sharing memory; instead, share memory by communicating.</i> <a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow noreferrer\">blog.golang.org/share-memory-by-communicating</a>"}, {"owner": {"reputation": 43, "user_id": 6077334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EgItGk9emug/AAAAAAAAAAI/AAAAAAAAAqg/XoIBMsSAYGg/photo.jpg?sz=128", "display_name": "Lupo Dharkael", "link": "https://stackoverflow.com/users/6077334/lupo-dharkael"}, "reply_to_user": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1481896853, "post_id": 41185542, "comment_id": 69571755, "body": "But I need locks for thread safety while accesing the slice. I need a non blocking channel because of the nature of the service so I decides to use an slice as a buffer for the data."}], "answers": [{"tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": true, "score": 0, "last_activity_date": 1481898312, "last_edit_date": 1481898312, "creation_date": 1481897069, "answer_id": 41186127, "question_id": 41185542, "link": "https://stackoverflow.com/questions/41185542/why-does-this-deadlock-happen-when-i-move-a-condition-outside-the-select-stateme/41186127#41186127", "title": "Why does this deadlock happen when I move a condition outside the select statement in Go", "body": "<p>Imagine this scenario for example:</p>\n\n<p>five \"bye\" has been send by the main, two of them has been print by</p>\n\n<pre><code>for data := range recv.Chan {\n      println(data)\n}\n</code></pre>\n\n<p>three has been left in <code>list</code> (this is because three times enter <code>for</code> loop, the condition <code>len(recv) == 0 &amp;&amp; len(list) &gt; 0</code> is false, so it just meet the <code>case s := &lt;-send</code>, and do <code>list = append(list, s)</code> three times)</p>\n\n<p>and the goroutine started by <code>NewNonBlockingChannel</code> is waiting on the statment <code>s := &lt;-send</code>. no more staff to be receive, so it will wait forever</p>\n\n<p>when you move the code</p>\n\n<pre><code>if len(recv) == 0 &amp;&amp; len(list) &gt; 0 {\n    r.mutex.Lock()\n    recv &lt;- list[len(list)-1]\n    list = list[:len(list)-1]\n    r.mutex.Unlock()\n}\n</code></pre>\n\n<p>into the <code>select</code>, things are different:</p>\n\n<p>the waiting gorountine will wake up, and the condition <code>if len(recv) == 0 &amp;&amp; len(list) &gt; 0</code> is ture just in time. things goes well. </p>\n"}], "owner": {"reputation": 43, "user_id": 6077334, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EgItGk9emug/AAAAAAAAAAI/AAAAAAAAAqg/XoIBMsSAYGg/photo.jpg?sz=128", "display_name": "Lupo Dharkael", "link": "https://stackoverflow.com/users/6077334/lupo-dharkael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 41186127, "answer_count": 1, "score": 1, "last_activity_date": 1481898312, "creation_date": 1481895000, "question_id": 41185542, "link": "https://stackoverflow.com/questions/41185542/why-does-this-deadlock-happen-when-i-move-a-condition-outside-the-select-stateme", "title": "Why does this deadlock happen when I move a condition outside the select statement in Go", "body": "<p>I need a non blocking channel with dynamic buffer for a project so I wrote this code.</p>\n\n<p>Here is the type declaration:</p>\n\n<pre><code>//receiver is the receiver of the non blocking channel\ntype receiver struct {\n    Chan  &lt;-chan string\n    list  *[]string\n    mutex sync.RWMutex\n}\n\n//Clear sets the buffer to 0 elements\nfunc (r *receiver) Clear() {\n    r.mutex.Lock()\n    *r.list = (*r.list)[:0]\n    r.mutex.Unlock()\n    //Discards residual content\n    if len(r.Chan) == 1 {\n        &lt;-r.Chan\n    }\n}\n</code></pre>\n\n<p>Constructor:</p>\n\n<pre><code>//NewNonBlockingChannel returns the receiver &amp; sender of a non blocking channel\nfunc NewNonBlockingChannel() (*receiver, chan&lt;- string) {\n    //Creates the send and receiver channels and the buffer\n    send := make(chan string)\n    recv := make(chan string, 1)\n    list := make([]string, 0, 20)\n\n    r := &amp;receiver{Chan: recv, list: &amp;list}\n\n    go func() {\n\n        for {\n            //When the receiver is empty sends the next element from the buffer\n            if len(recv) == 0 &amp;&amp; len(list) &gt; 0 {\n                r.mutex.Lock()\n                recv &lt;- list[len(list)-1]\n                list = list[:len(list)-1]\n                r.mutex.Unlock()\n            }\n\n            select {\n            //Adds the incoming elements to the buffer\n            case s := &lt;-send:\n                r.mutex.Lock()\n                list = append(list, s)\n                r.mutex.Unlock()\n                //default:\n\n            }\n        }\n    }()\n\n    return r, send\n}\n</code></pre>\n\n<p>And the toy test in the main:</p>\n\n<pre><code>func main() {\n    recv, sender := NewNonBlockingChannel()\n\n    //send data to the channel\n    go func() {\n        for i := 0; i &lt; 5; i++ {\n            sender &lt;- \"Hi\"\n        }\n        time.Sleep(time.Second)\n        for i := 0; i &lt; 5; i++ {\n            sender &lt;- \"Bye\"\n        }\n    }()\n    time.Sleep(time.Millisecond * 70) //waits to receive every \"Hi\"\n    recv.Clear()\n    for data := range recv.Chan {\n        println(data)\n    }\n\n}\n</code></pre>\n\n<p>When I tested it and a deadlock happened in the select statement when I receive from the sender \"<strong>case s := &lt;-send:</strong>\" but when I move the conditional block which sends the next buffered string into the select statement everything works perfectly:</p>\n\n<pre><code>go func() {\n\n    for {\n        select {\n        //Adds the incoming elements to the buffer\n        case s := &lt;-send:\n            r.mutex.Lock()\n            list = append(list, s)\n            r.mutex.Unlock()\n        default:\n            //When the receiver is empty sends the next element from the buffer\n            if len(recv) == 0 &amp;&amp; len(list) &gt; 0 {\n                r.mutex.Lock()\n                recv &lt;- list[len(list)-1]\n                list = list[:len(list)-1]\n                r.mutex.Unlock()\n            }\n        }\n    }\n}()\n</code></pre>\n\n<p>I'd like to know why.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1481889414, "post_id": 41183865, "comment_id": 69567357, "body": "Why should it return no match? It finds <code>s</code>. Add anchors to enforce the entire string match, <code>`^[a-z][0-9a-zA-Z_$]*$`</code>."}, {"owner": {"reputation": 306, "user_id": 2334224, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a4b6100f651b0ae634a498d88ebdb58d?s=128&d=identicon&r=PG", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2334224/simon-c"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1481889645, "post_id": 41183865, "comment_id": 69567507, "body": "I think its too late for me. Exhaustion is setting in for me. Thanks."}, {"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 0, "creation_date": 1481901792, "post_id": 41183865, "comment_id": 69574797, "body": "maybe you expecting what <a href=\"https://golang.org/pkg/regexp/#Regexp.FindString\" rel=\"nofollow noreferrer\">FindString</a> does?"}], "owner": {"reputation": 306, "user_id": 2334224, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a4b6100f651b0ae634a498d88ebdb58d?s=128&d=identicon&r=PG", "display_name": "Simon C", "link": "https://stackoverflow.com/users/2334224/simon-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1481889437, "answer_count": 0, "score": 0, "last_activity_date": 1481889362, "creation_date": 1481889362, "question_id": 41183865, "link": "https://stackoverflow.com/questions/41183865/go-lang-simple-regexp-matchstring-not-working-returns-true-when-expecting-false", "closed_reason": "Duplicate", "title": "Go Lang simple regexp MatchString not working? Returns true when expecting false. Why?", "body": "<p>The following code prints true. It should return false shouldn't it?</p>\n\n<pre><code>package main\n\nimport \"regexp\"\nimport \"fmt\"\n\nfunc main() {\n  res, _ := regexp.MatchString(\"[a-z][0-9a-zA-Z_$]*\", \"%s\")\n  fmt.Println(res)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/A_x5WID9wl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A_x5WID9wl</a></p>\n"}, {"tags": ["pointers", "go", "types", "interface"], "answers": [{"comments": [{"owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "edited": false, "score": 0, "creation_date": 1481891381, "post_id": 41183899, "comment_id": 69568535, "body": "Like I say, the unmarshall function does return raw structs, not pointers: <a href=\"https://play.golang.org/p/RC-Jqs6a8W\" rel=\"nofollow noreferrer\">play.golang.org/p/RC-Jqs6a8W</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "edited": false, "score": 0, "creation_date": 1481891907, "post_id": 41183899, "comment_id": 69568871, "body": "@StevenRoose See edited answer. Added examples and code to get a pointer to the dynamic value."}, {"owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "edited": false, "score": 0, "creation_date": 1481891981, "post_id": 41183899, "comment_id": 69568926, "body": "Aha, Indirect what the method that I did not know of. Thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1481891763, "last_edit_date": 1481891763, "creation_date": 1481889478, "answer_id": 41183899, "question_id": 41183561, "link": "https://stackoverflow.com/questions/41183561/how-to-get-a-pointer-to-a-variable-thats-masked-as-an-interface/41183899#41183899", "title": "How to get a pointer to a variable that&#39;s masked as an interface?", "body": "<p>To tell if a value wrapped in an <code>interface{}</code> implements some other interface (<code>I</code>), you may simply use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>.</p>\n\n<p>Note that you must pass the address of the variable you want results unmarshaled to.</p>\n\n<p>For demonstration purposes, let's use the following <code>magicUnmarshal()</code> function:</p>\n\n<pre><code>func magicUnmarshal(what int, obj interface{}) {\n    v := reflect.ValueOf(obj).Elem()\n    switch what {\n    case 0:\n        v.Set(reflect.ValueOf(&amp;someI{}))\n    case 1:\n        v.Set(reflect.ValueOf(&amp;otherI{}))\n    case 2:\n        v.Set(reflect.ValueOf(\"just a string\"))\n    case 3:\n        v.Set(reflect.ValueOf(someI{}))\n    case 4:\n        v.Set(reflect.ValueOf(otherI{}))\n    }\n}\n</code></pre>\n\n<p>Note that <code>case 3</code> and <code>case 4</code> are returning non-pointers.</p>\n\n<p>Your <code>GetSomeI()</code> implementation can be:</p>\n\n<pre><code>func GetSomeI(what int) (I, error) {\n    var obj interface{}\n    magicUnmarshal(what, &amp;obj)\n\n    // Try the value as-is:\n    if i, ok := obj.(I); ok {\n        return i, nil\n    }\n\n    // No success. Try a pointer to the value:\n    v := reflect.Indirect(reflect.New(reflect.TypeOf(obj)))\n    v.Set(reflect.ValueOf(obj))\n    pobj := v.Addr().Interface()\n    if i, ok := pobj.(I); ok {\n        return i, nil\n    }\n\n    return nil, fmt.Errorf(\"%T does not implement I!\", obj)\n}\n</code></pre>\n\n<p>First <code>GeSomeI()</code> tests if the value got form <code>magicUnmarshal()</code> implements <code>I</code>, and if so, it is used as-is. If not, we construct a new using reflection, and get its address (a pointer to a value), and we test that. If that pointer implements <code>I</code>, we return it.</p>\n\n<p>Testing it:</p>\n\n<pre><code>func main() {\n    for what := 0; what &lt; 5; what++ {\n        i, err := GetSomeI(what)\n        fmt.Printf(\"%T %v\\n\", i, err)\n    }\n}\n</code></pre>\n\n<p>And the output is (try it on the <a href=\"https://play.golang.org/p/dRJv6_Wlzu\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>*main.someI &lt;nil&gt;\n*main.otherI &lt;nil&gt;\n&lt;nil&gt; string does not implement I!\n*main.someI &lt;nil&gt;\n*main.otherI &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 41183899, "answer_count": 1, "score": 3, "last_activity_date": 1481891763, "creation_date": 1481888306, "last_edit_date": 1481889633, "question_id": 41183561, "link": "https://stackoverflow.com/questions/41183561/how-to-get-a-pointer-to-a-variable-thats-masked-as-an-interface", "title": "How to get a pointer to a variable that&#39;s masked as an interface?", "body": "<p>I prefer not to dive into the rationale of the situation below. It has to do with unmarshaling an serialized object that can be any of a fixed set of types, but you don't know which type.</p>\n\n<p>I have the following types:\n</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type I interface {\n    Do()\n}\n\ntype someI struct {}\nfunc (i *someI) Do() {}\n\ntype otherI struct {}\nfunc (i *otherI) Do() {}\n</code></pre>\n\n<p>So, two structs <strong>of which the pointers implement interface <code>I</code></strong>.</p>\n\n<p>Now I have this method that wants to return a value of type <code>I</code>:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func GetSomeI(marshalled []byte) (I, error) {\n    var obj interface{}\n    // The following method magically puts an instance\n    // of either someI or otherI into obj.\n    magicUnmarshall(marshalled, obj)\n    // The problem now is that we cannot return obj,\n    // because the raw structs don't implement I.\n\n    // One solution would be to do a type switch like this:\n    switch obj.(type) {\n    case someI:\n        i := obj.(someI)\n        return &amp;i, nil\n    case otherI:\n        i := obj.(otherI)\n        return &amp;i, nil\n    default:\n        return nil, errors.New(\"marschalled object was not of type I\")\n    }\n\n    // But now consider the case that there are quite some\n    // different implementations of I.\n    // We would prefer to have a general way of getting\n    // a reference to obj.\n}\n</code></pre>\n"}, {"tags": ["go", "gopacket"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888032, "post_id": 41183466, "comment_id": 69566570, "body": "If you see the modified packet going out again, what is your issue/question ?"}, {"owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888468, "post_id": 41183466, "comment_id": 69566776, "body": "Sorry, I will clarify this in the question. I&#39;m running a HTTP server on port 8000. If I connect from the browser to port 8888, the connection times out."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888530, "post_id": 41183466, "comment_id": 69566816, "body": "You have to rewrite the packets going in the other direction too. (Note that you don&#39;t need any code to really do this, you can do it with iptables as show e.g. <a href=\"https://www.cyberciti.biz/faq/linux-port-redirection-with-iptables/\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888650, "post_id": 41183466, "comment_id": 69566913, "body": "So changing the src port on the response from 8000 to 8888?"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888780, "post_id": 41183466, "comment_id": 69566989, "body": "Yes. But not for INPUT packets, you need to somehow hook into the packets going out, and the source port on those."}, {"owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481888965, "post_id": 41183466, "comment_id": 69567094, "body": "Sure, I can add an iptables rule to also queue messages going out."}, {"owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1481889173, "post_id": 41183466, "comment_id": 69567209, "body": "Actually I never see the request arriving at the HTTP server."}], "answers": [{"tags": [], "owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "is_accepted": true, "score": 0, "last_activity_date": 1486028607, "creation_date": 1486028607, "answer_id": 41998773, "question_id": 41183466, "link": "https://stackoverflow.com/questions/41183466/changing-destination-port-using-gopacket/41998773#41998773", "title": "Changing destination port using gopacket", "body": "<p>In case you are interested in the solution, code can be found here: <a href=\"https://github.com/kung-foo/freki\" rel=\"nofollow noreferrer\">https://github.com/kung-foo/freki</a></p>\n"}], "owner": {"reputation": 2698, "user_id": 948369, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4ef98bb6b9fa36ebde9b7fc2b333bbb?s=128&d=identicon&r=PG", "display_name": "Glaslos", "link": "https://stackoverflow.com/users/948369/glaslos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1127, "favorite_count": 3, "accepted_answer_id": 41998773, "answer_count": 1, "score": 9, "last_activity_date": 1486028607, "creation_date": 1481887902, "last_edit_date": 1482834250, "question_id": 41183466, "link": "https://stackoverflow.com/questions/41183466/changing-destination-port-using-gopacket", "title": "Changing destination port using gopacket", "body": "<p>I'm currently playing around with reading packages from <a href=\"https://www.netfilter.org/projects/libnetfilter_queue/doxygen/group__Queue.html\" rel=\"noreferrer\">nfqueue</a> and modifying them.Unfortunately, I'm a bit stuck at changing the destination port of a package. See the code snippet below. Idea is to rewrite dest port <strong>8888</strong> to <strong>8000</strong>.\nI do see the modified package going out from the queue, but if I want to connect to an HTTP server listening on port 8000 by connecting to port 8888, the connection times out. I assume something mal-formed in the package.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n\n    \"github.com/chifflier/nfqueue-go/nfqueue\"\n    \"github.com/coreos/go-iptables/iptables\"\n\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/layers\"\n)\n\nfunc sendNewPacket(payload *nfqueue.Payload, layers ...gopacket.SerializableLayer) {\n    buffer := gopacket.NewSerializeBuffer()\n    gopacket.SerializeLayers(buffer, gopacket.SerializeOptions{FixLengths: true, ComputeChecksums: true}, layers...)\n    outgoingPacket := buffer.Bytes()\n    payload.SetVerdictModified(nfqueue.NF_ACCEPT, outgoingPacket)\n}\n\nfunc realCallback(payload *nfqueue.Payload) int {\n    packet := gopacket.NewPacket(payload.Data, layers.LayerTypeIPv4, gopacket.Default)\n    ethLayer := packet.Layer(layers.LayerTypeEthernet)\n    eth, _ := ethLayer.(*layers.Ethernet)\n    if ipLayer := packet.Layer(layers.LayerTypeIPv4); ipLayer != nil {\n        ip, _ := ipLayer.(*layers.IPv4)\n        if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n            tcp, _ := tcpLayer.(*layers.TCP)\n            if tcp.DstPort == 8888 {\n                tcp.DstPort = 8000\n                sendNewPacket(payload, eth, ip, tcp)\n                return 0\n            }\n            if tcp.SrcPort == 8000 {\n                tcp.SrcPort = 8888\n                sendNewPacket(payload, eth, ip, tcp)\n                return 0\n            }\n        }\n    }\n    payload.SetVerdict(nfqueue.NF_ACCEPT)\n    return 0\n}\n\nfunc main() {\n    ipt, err := iptables.New()\n    if err != nil {\n        panic(err)\n    }\n    ipt.Append(\"filter\", \"INPUT\", \"-p\", \"tcp\", \"-j\", \"NFQUEUE\", \"--queue-num\", \"0\")\n    ipt.Append(\"filter\", \"OUTPUT\", \"-p\", \"tcp\", \"-j\", \"NFQUEUE\", \"--queue-num\", \"0\")\n    q := new(nfqueue.Queue)\n    q.SetCallback(realCallback)\n\n    q.Init()\n    defer q.Close()\n\n    q.Unbind(syscall.AF_INET)\n    q.Bind(syscall.AF_INET)\n    q.CreateQueue(0)\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    go func() {\n        for sig := range c {\n            _ = sig\n            q.Close()\n            err = ipt.ClearChain(\"filter\", \"INPUT\")\n            err = ipt.ClearChain(\"filter\", \"OUTPUT\")\n            if err != nil {\n                panic(err)\n            }\n            os.Exit(0)\n        }\n    }()\n    q.TryRun()\n}\n</code></pre>\n"}, {"tags": ["go", "profiler", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481896201, "post_id": 41181961, "comment_id": 69571368, "body": "You need to call pprof with the binary as the first argument"}], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481890669, "post_id": 41183646, "comment_id": 69568123, "body": "i&#39;m not getting any error messages, the output in the question is all i get"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "reply_to_user": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481893910, "post_id": 41183646, "comment_id": 69570015, "body": "What&#39;s the result of <code>go version</code>?"}, {"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481894179, "post_id": 41183646, "comment_id": 69570157, "body": "i&#39;m running 1.6.2 linux/amd"}, {"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481895587, "post_id": 41183646, "comment_id": 69571023, "body": "i have also tried running it in 1.7.4 on windows with the same results as in 1.6.2"}], "tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": false, "score": 0, "last_activity_date": 1481888907, "last_edit_date": 1481888907, "creation_date": 1481888598, "answer_id": 41183646, "question_id": 41181961, "link": "https://stackoverflow.com/questions/41181961/profiler-not-showing-function-calls-pgk-profile-with-pprof/41183646#41183646", "title": "profiler not showing function calls (/pgk/profile with pprof)", "body": "<p>Are you getting an error like:</p>\n\n<blockquote>\n  <p>Local symbolization failed for tmp: open /tmp/go-build594370835/command-line-arguments/_obj/exe/tmp: no such file or directory</p>\n</blockquote>\n\n<p>If so; in the directory of the source, try:</p>\n\n<pre><code>go build tmp.go\n</code></pre>\n\n<p>Re-running <code>go tool pprof -text ...</code> then results in:</p>\n\n<pre><code>go tool pprof -text /tmp/profile668503934/cpu.pprof\n5040ms of 5040ms total (  100%)\n      flat  flat%   sum%        cum   cum%\n    4560ms 90.48% 90.48%     4560ms 90.48%  main.t1\n     480ms  9.52%   100%      480ms  9.52%  main.t2\n         0     0%   100%     5040ms   100%  main.main\n         0     0%   100%     5040ms   100%  runtime.goexit\n         0     0%   100%     5040ms   100%  runtime.main\n</code></pre>\n\n<p>It's now using the symbols contained in the <code>./tmp</code> binary.</p>\n\n<p>I'm using <code>go version go1.7.3 linux/amd64</code></p>\n"}], "owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1008, "favorite_count": 0, "closed_date": 1481896299, "answer_count": 1, "score": 0, "last_activity_date": 1481897011, "creation_date": 1481883121, "last_edit_date": 1481897011, "question_id": 41181961, "link": "https://stackoverflow.com/questions/41181961/profiler-not-showing-function-calls-pgk-profile-with-pprof", "closed_reason": "Duplicate", "title": "profiler not showing function calls (/pgk/profile with pprof)", "body": "<p>Edit: worked when i added the the executable to the pprof call</p>\n\n<p>I'm trying to profile a simple program with the profiler from <a href=\"https://github.com/pkg/profile\" rel=\"nofollow noreferrer\">https://github.com/pkg/profile</a>: and go tool pprof.</p>\n\n<pre><code>package main\n\nimport \"github.com/pkg/profile\"\n\nfunc main() {\n    defer profile.Start().Stop()\n    t1()\n    t2()\n}\n\nfunc t1() {\n    for i := 0; i &lt; 9000000000; i++ {\n        x := i * 2\n        x += x\n    }\n}\n\nfunc t2() {\n    for i := 0; i &lt; 1000000000; i++ {\n        x := i * 2\n        x += x\n    }\n}\n</code></pre>\n\n<p>The examples shows a nice table with all the functions that have been called and how long time was spent in each one of them, but i'm only seeing 100% usage for a few seconds with no more information</p>\n\n<p>what can i do to make it output the functions? does it have anything to do with the \"cpu profiling disabled\" line that is outputted when the code is done?</p>\n\n<p>this is what I used to generate the output:</p>\n\n<pre><code>./test \n2016/12/16 11:04:39 profile: cpu profiling enabled, /tmp/profile176930291/cpu.pprof\n2016/12/16 11:04:44 profile: cpu profiling disabled, /tmp/profile176930291/cpu.pprof\nmartin@martin-laptop:~/work/bin$ go tool pprof -text /tmp/profile176930291/cpu.pprof \n4.90s of 4.90s total (  100%)                                                                                                                                                                                                                       \n      flat  flat%   sum%        cum   cum%\n     4.90s   100%   100%      4.90s   100%  \n</code></pre>\n"}, {"tags": ["image-processing", "go", "imagemagick", "metadata", "steganography"], "comments": [{"owner": {"reputation": 4806, "user_id": 1321848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a4c3440c2ba5bf423de629c26bbc7c8?s=128&d=identicon&r=PG", "display_name": "Bonzo", "link": "https://stackoverflow.com/users/1321848/bonzo"}, "edited": false, "score": 0, "creation_date": 1481885144, "post_id": 41181909, "comment_id": 69564882, "body": "A couple of things to remember with -stegeno is if the image is cropped or resized you will not be able to retrieve the image. From memory jpg can be a problem as when it is saved it is compressed again and that may be why you are getting garbage. To test you could try with a ping output and see if that is the problem. You could look at -comment <a href=\"https://www.imagemagick.org/script/command-line-options.php#comment\" rel=\"nofollow noreferrer\">imagemagick.org/script/command-line-options.php#comment</a> although I have not tried it and I am not sure how to read it back easily."}, {"owner": {"reputation": 7187, "user_id": 2243104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47daacd71b7294e97d5ef36ba029a95c?s=128&d=identicon&r=PG&f=1", "display_name": "Reti43", "link": "https://stackoverflow.com/users/2243104/reti43"}, "edited": false, "score": 0, "creation_date": 1481892232, "post_id": 41181909, "comment_id": 69569075, "body": "How about <a href=\"https://stackoverflow.com/questions/35396977/lsb-dct-based-image-steganography/35398127#35398127\">modifying the JPEG encoding process</a> with a <a href=\"https://golang.org/pkg/image/jpeg/\" rel=\"nofollow noreferrer\">Golang library</a>?"}], "owner": {"reputation": 143, "user_id": 2061202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/647ca4f150d64c0bf32d3c26cd83e90f?s=128&d=identicon&r=PG", "display_name": "fvm", "link": "https://stackoverflow.com/users/2061202/fvm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 923, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1481882965, "creation_date": 1481882965, "question_id": 41181909, "link": "https://stackoverflow.com/questions/41181909/adding-a-digital-signature-to-an-image-using-golang-or-imagemagick", "title": "Adding a Digital Signature to an Image using Golang or ImageMagick", "body": "<p>I'm trying to embed a sort of digital signature, either in the form of text or a composite image into an existing image (JPEG at present, possibly others in the futere), such that the origin of the original image can be determined at a later time based on the content of the message.</p>\n\n<p>Now, the main requirement of this is that it has to be done using an existing Golang library or through ImageMagick, which itself is well supported in Golang. </p>\n\n<p>Thus far, the options I've considered are:</p>\n\n<ul>\n<li>Through metadata, e.g. XMP, IPTC, EXIF, etc.</li>\n<li>Through <a href=\"https://en.wikipedia.org/wiki/Steganography\" rel=\"nofollow noreferrer\">steganography</a></li>\n</ul>\n\n<p>Unfortunately, none of these methods seem well supported in Go or ImageMagick. For example, I've come across some libraries which allow you to <em>read</em> metadata, but not write them. Others rely on the use of exiftool by executing a command in the shell, which also isn't a viable approach. And with regard to steganography, I've seen some libraries which allow you to embed messages, but only in PNG images or ones which are lacking in other regards.</p>\n\n<p>In the end the only viable approach I've got left is to use ImageMagick, but that also doesn't seem to work, or, I'm overlooking something. I've tried it using the command line tools, but the only result was a garbage image. What I did was (following the <a href=\"http://www.imagemagick.org/Usage/transform/#stegano\" rel=\"nofollow noreferrer\">documentation</a>):</p>\n\n<ul>\n<li>Given an existing JPEG</li>\n<li><p>Create a new watermark image:</p>\n\n<pre><code>convert -gravity center -size 50x40 label:\"SECRET\" message.gif\n</code></pre></li>\n<li><p>Composite the image with the existing image, making sure to note the offset and dimensions, as described:</p>\n\n<pre><code>composite message.gif input.jpg -stegano +0+0  output.png\n</code></pre></li>\n<li><p>This yields a new image containing the embedded data, which I can verify through a difference metric. Then, taking this new image, again following the documenation:</p>\n\n<pre><code>convert -size 50x40+0+0 stegano:output.png message_recovered.gif\n</code></pre></li>\n<li>And hey presto, garbage...</li>\n</ul>\n\n<p>Now, given all the above, my questions are:</p>\n\n<ul>\n<li>Are there native Golang libraries out there which allow me to either use metadata or steganography for this purpose?</li>\n<li>Are there perhaps other avenues to doing this which are more viable?</li>\n<li>What am I missing in the ImageMagick example I followed?</li>\n</ul>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "lua", "redis", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "is_accepted": false, "score": 0, "last_activity_date": 1481876264, "creation_date": 1481876264, "answer_id": 41179997, "question_id": 41179478, "link": "https://stackoverflow.com/questions/41179478/calling-lua-script-from-redigo-throwing-error-wrong-number-of-args/41179997#41179997", "title": "Calling lua script from redigo throwing error wrong number of args", "body": "<p>You should begin use </p>\n\n<p><code>args[1],args[2],args[3],args[4],args[5]</code> </p>\n\n<p>instead of </p>\n\n<pre><code>args[0],args[1],args[2],args[3],args[4]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1482003079, "post_id": 41180701, "comment_id": 69603749, "body": "To fix compilation error, change <code>argv := make([]string, 6)</code> to <code>argv := make([]interface{}, 6)</code>."}], "tags": [], "owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "is_accepted": false, "score": 1, "last_activity_date": 1481879838, "last_edit_date": 1481879838, "creation_date": 1481879170, "answer_id": 41180701, "question_id": 41179478, "link": "https://stackoverflow.com/questions/41179478/calling-lua-script-from-redigo-throwing-error-wrong-number-of-args/41180701#41180701", "title": "Calling lua script from redigo throwing error wrong number of args", "body": "<p>You're not using <code>Do</code> method correctly, you must to give it every variable separately if you want to use them in the script:</p>\n\n<pre><code>rScript := redis.NewScript(1, script)\nargv := make([]string, 6)\nargv[0] = \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\" // the key\nargv[1] = \"30000\"\nargv[2] = \"SSF_lastAccessedDate\"\nargv[3] = \"1481627386\"\nargv[4] = \"SSF_expiryDate\"\nargv[5] = \"2481657386\"\nreply, err := rScript.Do(con, argv...)\nif err != nil {\n    log.Println(\"Error in executing script \" + err.Error())\n} else {\n    log.Printf(\"Result %v\\n\", reply)\n    // error if not return a map\n    if data, err := redis.StringMap(reply, nil); err != nil {\n        // error if not return an int\n        if val, err := redis.Int64(reply, nil); err != nil {\n            log.Printf(\"Error %v\\n\", err)\n        } else {\n            log.Printf(\"Result %v\\n\", val)\n        }\n    } else {\n        log.Printf(\"Result %v\\n\", data)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4123, "user_id": 785523, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b51864374e248ee87686628bc8528677?s=128&d=identicon&r=PG", "display_name": "tuk", "link": "https://stackoverflow.com/users/785523/tuk"}, "edited": false, "score": 0, "creation_date": 1481905251, "post_id": 41186742, "comment_id": 69576783, "body": "I modified the call to <code>rScript.Do</code> as you suggested but it is displaying the output as <code>2016&#47;12&#47;16 21:50:08 Result [[116 121 112 101] [50] [100 97 116 97] [72 101 108 108 111] [120] [50] [83 83 70 95 99 114 101 97 116 105 111 110 68 97 116 101] [49 52 56 49 56 55 49 55 56 56] [83 83 70 95 108 97 115 116 77 111 100 105 102 105 101 100 68 97 116 101] [49 52 56 49 56 55 49 55 56 56] [83 83 70 95 101 120 112 105 114 121 68 97 116 101] [50 52 56 49 54 53 55 51 56 54] [83 83 70 95 108 97 115 116 65 99 99 101 115 115 101 100 68 97 116 101] [49 52 56 49 54 50 55 51 56 54]]</code>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1481905934, "last_edit_date": 1481905934, "creation_date": 1481899165, "answer_id": 41186742, "question_id": 41179478, "link": "https://stackoverflow.com/questions/41179478/calling-lua-script-from-redigo-throwing-error-wrong-number-of-args/41186742#41186742", "title": "Calling lua script from redigo throwing error wrong number of args", "body": "<p>According to the error message, the error is on this line:</p>\n\n<pre><code>local res = redis.call(\"HMSET\", KEYS[1], unpack(a))\n</code></pre>\n\n<p>The issue is that the application is passing two arguments to the script, the key and <code>argv</code> converted to a string. The call <code>unpack(a)</code> yields a single value.</p>\n\n<p>The fix is to pass each argument separately to the script:</p>\n\n<pre><code>reply, errS := rScript.Do(retryConn,\n   \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\",\n   \"30000\",\n   \"SSF_lastAccessedDate\", \"1481627386\",\n   \"SSF_expiryDate\", \"2481657386\")\n</code></pre>\n\n<p>I recommend initializing a package level variable with the script so the hash of the script text is computed once instead of on every use of the script:</p>\n\n<pre><code>var rScript = redis.NewScript(1, `if redis.call(\"EXISTS\", KEYS[1]) == 1 then\n    local keyvalues = redis.call(\"HGETALL\", KEYS[1])\n    local a = {}\n    for i=2, table.getn(ARGV) do\n      a[i-1] = ARGV[i]\n    end\n    local res = redis.call(\"HMSET\", KEYS[1], unpack(a))\n    redis.call(\"EXPIRE\", KEYS[1], ARGV[1])  \n    return keyvalues\nelse\n    return 2 -- \"Key doesn't exists\"\nend`)\n</code></pre>\n\n<p>and use this script in <code>main()</code>:</p>\n\n<pre><code>func main() {\n  ...\n  reply, errS := rScript.Do(retryConn,\n   \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\",\n   \"30000\",\n   \"SSF_lastAccessedDate\", \"1481627386\",\n   \"SSF_expiryDate\", \"2481657386\")\n\n  ...\n}\n</code></pre>\n\n<p>Also, use table.remove to simplify the script:</p>\n\n<pre><code>var rScript = redis.NewScript(1, `if redis.call(\"EXISTS\", KEYS[1]) == 1 then\n    local keyvalues = redis.call(\"HGETALL\", KEYS[1])\n    local expires = table.remove(ARGV, 1)\n    local res = redis.call(\"HMSET\", KEYS[1], unpack(ARGV))\n    redis.call(\"EXPIRE\", KEYS[1], expires)  \n    return keyvalues\nelse\n    return 2 -- \"Key doesn't exists\"\nend`)\n</code></pre>\n\n<p>Use <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Strings\" rel=\"nofollow noreferrer\">redis.Strings</a> to convert the slice of []byte returned from the server to a slice of strings:</p>\n\n<pre><code>  reply, errS := redis.Strings(rScript.Do(retryConn,\n   \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\",\n   \"30000\",\n   \"SSF_lastAccessedDate\", \"1481627386\",\n   \"SSF_expiryDate\", \"2481657386\"))\n</code></pre>\n\n<p>Printing this <code>reply</code> will give the result you are expecting.</p>\n"}], "owner": {"reputation": 4123, "user_id": 785523, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b51864374e248ee87686628bc8528677?s=128&d=identicon&r=PG", "display_name": "tuk", "link": "https://stackoverflow.com/users/785523/tuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1505, "favorite_count": 0, "accepted_answer_id": 41186742, "answer_count": 3, "score": 2, "last_activity_date": 1485647642, "creation_date": 1481874113, "last_edit_date": 1485647642, "question_id": 41179478, "link": "https://stackoverflow.com/questions/41179478/calling-lua-script-from-redigo-throwing-error-wrong-number-of-args", "title": "Calling lua script from redigo throwing error wrong number of args", "body": "<p>I am trying to use <a href=\"https://github.com/garyburd/redigo\" rel=\"nofollow noreferrer\">redigo</a> to execute a lua script on redis. My code looks like below:-</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/PuerkitoBio/redisc\"\n    \"github.com/garyburd/redigo/redis\"\n    \"log\"\n    \"time\"\n)\n\nconst script = `if redis.call(\"EXISTS\", KEYS[1]) == 1 then\n    local keyvalues = redis.call(\"HGETALL\", KEYS[1])\n    local a = {}\n    for i=2, table.getn(ARGV) do\n      a[i-1] = ARGV[i]\n    end\n    local res = redis.call(\"HMSET\", KEYS[1], unpack(a))\n    redis.call(\"EXPIRE\", KEYS[1], ARGV[1])  \n    return keyvalues\nelse\n    return 2 -- \"Key doesn't exists\"\nend`\n\nfunc main() {\n    cluster := redisc.Cluster{\n        StartupNodes: []string{\":30001\", \":30002\", \":30003\", \":30004\", \":30005\", \":30006\"},\n        DialOptions:  []redis.DialOption{redis.DialConnectTimeout(5 * time.Second)},\n        CreatePool:   createPool,\n    }\n    defer cluster.Close()\n\n    // initialize its mapping\n    if err := cluster.Refresh(); err != nil {\n        log.Fatalf(\"Refresh failed: %v\", err)\n    }\n\n    // grab a connection from the pool\n    conn := cluster.Get()\n    defer cluster.Close()\n    retryConn, errRe := redisc.RetryConn(conn, 3, 1*time.Millisecond)\n    if errRe != nil {\n        log.Println(\"Failed to get retry connection \" + errRe.Error())\n        return\n    }\n    rScript := redis.NewScript(1, script)\n    argv := make([]string, 5)\n    argv[0] = \"30000\"\n    argv[1] = \"SSF_lastAccessedDate\"\n    argv[2] = \"1481627386\"\n    argv[3] = \"SSF_expiryDate\"\n    argv[4] = \"2481657386\"\n    reply, errS := rScript.Do(retryConn, \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\", argv)\n    if errS != nil {\n        log.Println(\"Error in executing script \" + errS.Error())\n    } else {\n        log.Printf(\"Result %+v\", reply)\n    }\n}\n\nfunc createPool(addr string, opts ...redis.DialOption) (*redis.Pool, error) {\n    return &amp;redis.Pool{\n        MaxIdle:     100,\n        MaxActive:   4000,\n        IdleTimeout: time.Minute,\n        Dial: func() (redis.Conn, error) {\n            return redis.Dial(\"tcp\", addr, opts...)\n        },\n        TestOnBorrow: func(c redis.Conn, t time.Time) error {\n            if time.Since(t) &lt; time.Minute {\n                return nil\n            }\n            _, err := c.Do(\"PING\")\n            return err\n        },\n    }, nil\n}\n</code></pre>\n\n<p>But on executing the code it is throwing the error:-</p>\n\n<pre><code>2016/12/16 12:52:32 Error in executing script ERR Error running script (call to f_5a127779e5c1c2daa0b636d9b02f6b570a9f7f13): @user_script:7: @user_script: 7: Wrong number of args calling Redis command From Lua script \n</code></pre>\n\n<p>Can someone let me know what is going wrong &amp; how to make this work?</p>\n\n<p>Environment:-</p>\n\n<ul>\n<li>Go - 1.7.4</li>\n</ul>\n\n<p><strong>EDIT</strong></p>\n\n<p>As suggested in the answers I modified the call as:-</p>\n\n<pre><code>rScript.Do(retryConn, \"JJNb324a680c35d11e6a1123c15c2d271f21481871788G\", argv[0], argv[1], argv[2], argv[3], argv[4])\n</code></pre>\n\n<p>But it is giving the output as:-</p>\n\n<pre><code>2016/12/16 21:39:51 Result [[116 121 112 101] [50] [100 97 116 97] [72 101 108 108 111] [120] [50] [83 83 70 95 99 114 101 97 116 105 111 110 68 97 116 101] [49 52 56 49 56 55 49 55 56 56] [83 83 70 95 108 97 115 116 77 111 100 105 102 105 101 100 68 97 116 101] [49 52 56 49 56 55 49 55 56 56] [83 83 70 95 101 120 112 105 114 121 68 97 116 101] [50 52 56 49 54 53 55 51 56 54] [83 83 70 95 108 97 115 116 65 99 99 101 115 115 101 100 68 97 116 101] [49 52 56 49 54 50 55 51 56 54]]\n</code></pre>\n\n<p>But from <code>redis-cli</code> I am getting the output as:-</p>\n\n<pre><code>1) \"type\"\n 2) \"2\"\n 3) \"data\"\n 4) \"Hello\"\n 5) \"x\"\n 6) \"2\"\n 7) \"SSF_creationDate\"\n 8) \"1481871788\"\n 9) \"SSF_lastModifiedDate\"\n10) \"1481871788\"\n11) \"SSF_expiryDate\"\n12) \"2481657386\"\n13) \"SSF_lastAccessedDate\"\n14) \"1481627386\"\n</code></pre>\n"}, {"tags": ["json", "go", "encoding", "gob"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1481890239, "post_id": 41179453, "comment_id": 69567871, "body": "An example when <code>gob</code> &quot;wins&quot; over <code>json</code>: <a href=\"http://stackoverflow.com/a/40823362/1705598\">How to unmarshal from interface{} to interface{} in Go</a>. Also see interesting / related questions: <a href=\"http://stackoverflow.com/questions/33228700/is-encoding-gob-deterministic/33228913#33228913\">Is encoding/gob deterministic?</a>; and <a href=\"http://stackoverflow.com/questions/37618399/efficient-go-serialization-of-struct-to-disk/37620399#37620399\">Efficient Go serialization of struct to disk</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 11, "last_activity_date": 1481878918, "creation_date": 1481878918, "answer_id": 41180616, "question_id": 41179453, "link": "https://stackoverflow.com/questions/41179453/difference-between-encoding-gob-and-encoding-json/41180616#41180616", "title": "difference between encoding/gob and encoding/json", "body": "<p>Package encoding/gob is basically Go specific and unusable with other languages but it is very efficient (fast and generates small data) and can properly marshal and unmarshal more data structures. Interfacing with other tools is often easier via JSON.</p>\n"}, {"tags": [], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "is_accepted": true, "score": 20, "last_activity_date": 1481879098, "creation_date": 1481879098, "answer_id": 41180680, "question_id": 41179453, "link": "https://stackoverflow.com/questions/41179453/difference-between-encoding-gob-and-encoding-json/41180680#41180680", "title": "difference between encoding/gob and encoding/json", "body": "<p>Gob is much more preferred when communicating between Go programs. However, gob is currently supported only in Go and, well, <a href=\"https://code.google.com/archive/p/libgob/\" rel=\"noreferrer\">C</a>, so only ever use that when you're sure no program written in any other programming language will try to decode the values.</p>\n\n<p>When it comes to performance, at least on my machine, Gob outperforms JSON by a long shot. <a href=\"https://gist.github.com/thehowl/85057ad21697160e81ac42bf358a322a\" rel=\"noreferrer\">Test file</a> (put in a folder on its own under your GOPATH)</p>\n\n<pre><code>$ go test -bench=.        \ntesting: warning: no tests to run\nBenchmarkGobEncoding-4           1000000              1172 ns/op\nBenchmarkJSONEncoding-4           500000              2322 ns/op\nBenchmarkGobDecoding-4           5000000               486 ns/op\nBenchmarkJSONDecoding-4           500000              3228 ns/op\nPASS\nok      testencoding    6.814s\n</code></pre>\n"}], "owner": {"reputation": 340, "user_id": 6919159, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/sV3Ek.jpg?s=128&g=1", "display_name": "Anu", "link": "https://stackoverflow.com/users/6919159/anu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5518, "favorite_count": 4, "accepted_answer_id": 41180680, "answer_count": 2, "score": 14, "last_activity_date": 1579162483, "creation_date": 1481873995, "last_edit_date": 1579162483, "question_id": 41179453, "link": "https://stackoverflow.com/questions/41179453/difference-between-encoding-gob-and-encoding-json", "title": "difference between encoding/gob and encoding/json", "body": "<p>I am writing an application in Go which uses encoding/gob to send structures and slices over UDP between nodes. It works fine but I notice that encoding/json also has the similar API. Searched and found this information(<a href=\"https://golang.org/pkg/encoding/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/</a>):</p>\n\n<blockquote>\n  <p>gob   Package gob manages streams of gobs - binary values exchanged\n  between an Encoder (transmitter) and a Decoder (receiver).<br>\n  json   Package json implements encoding and decoding of JSON as defined in\n  RFC 4627.</p>\n</blockquote>\n\n<p>Can someone explain to me whether one is more efficient than the other and in general compare when to choose what? Also if I need to interface with a non-Go application, I guess json would be preferred?</p>\n"}, {"tags": ["pointers", "go", "channel"], "comments": [{"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 1, "creation_date": 1481878071, "post_id": 41178729, "comment_id": 69560661, "body": "How did you calculate? And ho define &quot;performance drop&quot;? I&#39;m a little confused about the relation between the values 4000, 8000, and 30%."}, {"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1481881066, "post_id": 41178729, "comment_id": 69562340, "body": "The problem is not the performance of a channel, because it&#39;s the same, instead the question should be <code>Why is the performance impacted when I get a pointer from a local variable?</code> and Martin gave a good example about that."}], "answers": [{"comments": [{"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 0, "creation_date": 1481877320, "post_id": 41179423, "comment_id": 69560257, "body": "Would you expect a 30% percent performance drop or a fixed value per passing operation?"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "reply_to_user": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 1, "creation_date": 1481878501, "post_id": 41179423, "comment_id": 69560900, "body": "In most cases no, but the above code is a contrived example where the heap allocations and additional assembly instructions are a large proportion of the programs&#39; execution."}, {"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 0, "creation_date": 1481878843, "post_id": 41179423, "comment_id": 69561102, "body": "I&#39;d expect the heap operations to be much more expansive then the referencing and dereferencing instructions, but since you have had the look into the code you maybe know better..."}, {"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "edited": false, "score": 1, "creation_date": 1481886679, "post_id": 41179423, "comment_id": 69565774, "body": "Good analysis, hope this answer will be the accepted one. And it shows some really interesting applications of the go tools <i><code>go run -gcflags &#39;-m&#39;</code></i> and <i><code>go run -gcflags &#39;-S</code></i>"}], "tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": true, "score": 14, "last_activity_date": 1481878418, "last_edit_date": 1481878418, "creation_date": 1481873883, "answer_id": 41179423, "question_id": 41178729, "link": "https://stackoverflow.com/questions/41178729/why-passing-pointers-to-channel-is-slower/41179423#41179423", "title": "Why passing pointers to channel is slower", "body": "<p>As a value it can be stack allocated:</p>\n\n<pre><code>go run -gcflags '-m' tmp.go\n# command-line-arguments\n./tmp.go:18: inlining call to time.Time.Nanosecond\n./tmp.go:24: inlining call to time.Time.Nanosecond\n./tmp.go:25: t2 escapes to heap\n./tmp.go:25: main ... argument does not escape\n63613\n</code></pre>\n\n<p>As a pointer, it escapes to the heap:</p>\n\n<pre><code>go run -gcflags '-m' tmp.go\n# command-line-arguments\n./tmp.go:18: inlining call to time.Time.Nanosecond\n./tmp.go:24: inlining call to time.Time.Nanosecond\n./tmp.go:21: &amp;b escapes to heap &lt;-- Additional GC pressure\n./tmp.go:20: moved to heap: b   &lt;-- \n./tmp.go:25: t2 escapes to heap\n./tmp.go:25: main ... argument does not escape\n122513\n</code></pre>\n\n<p>Escaping to the heap introduces some overhead / GC pressure.</p>\n\n<p>Looking at the assembly, the pointer version also introduces additional instructions, including:</p>\n\n<pre><code>go run -gcflags '-S' tmp.go\n0x0055 00085 (...tmp.go:18) CALL    runtime.newobject(SB)\n</code></pre>\n\n<p>The non-pointer variant doesn't incur this overhead before calling <code>runtime.chansend1</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 1, "creation_date": 1481888837, "post_id": 41182935, "comment_id": 69567025, "body": "Regarding Go Playground issues; that&#39;s because <code>time.Now()</code> always returns <code>2009-11-10 23:00:00 +0000 UTC</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 1, "creation_date": 1481890059, "post_id": 41182935, "comment_id": 69567759, "body": "@MartinGallagher On the Go Playground time always starts at <code>2009-11-10 23:00:00</code>, but the time is not frozen, if you call <code>time.Now()</code> at a later time, it returns a different value: <a href=\"https://play.golang.org/p/pvk_vw5Hfm\" rel=\"nofollow noreferrer\">time test</a>."}, {"owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481893284, "post_id": 41182935, "comment_id": 69569668, "body": "@icza maybe you need to sleep for that? My performance test obviously absolutely consumed no time in Go. But in reality it does, you wait longer with bigger values for <code>chan_size</code> or <code>cycle_count</code>"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481893835, "post_id": 41182935, "comment_id": 69569976, "body": "@icza; sorry I forgot to add context: <a href=\"https://play.golang.org/p/yi_2L6g0C3\" rel=\"nofollow noreferrer\">play.golang.org/p/yi_2L6g0C3</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 2, "creation_date": 1481894122, "post_id": 41182935, "comment_id": 69570138, "body": "@MartinGallagher Yes, the Playground uses &quot;fake timing&quot;. It doesn&#39;t advance by itself, and sleeps are just simulated by &quot;jumps&quot; in time. You can read more about it here: <a href=\"https://blog.golang.org/playground#TOC_3.1.\" rel=\"nofollow noreferrer\"><b>Inside the Go Playground: Faking time</b></a>"}], "tags": [], "owner": {"reputation": 8296, "user_id": 2932052, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/63b8d6f5ce8e33b6953812ce8f5b2d40?s=128&d=identicon&r=PG", "display_name": "Wolf", "link": "https://stackoverflow.com/users/2932052/wolf"}, "is_accepted": false, "score": 1, "last_activity_date": 1481886104, "last_edit_date": 1495540458, "creation_date": 1481886104, "answer_id": 41182935, "question_id": 41178729, "link": "https://stackoverflow.com/questions/41178729/why-passing-pointers-to-channel-is-slower/41182935#41182935", "title": "Why passing pointers to channel is slower", "body": "<p>As a supplement to the <a href=\"https://stackoverflow.com/a/41179423/2932052\">good analysis of Martin Gallagher</a>, it must be added that the way you are measuring is suspicious. The performance of such tiny programs varies a lot, so measuring should be done repeatedly. There are also some mistakes in your example.</p>\n\n<p>First: it doesn't compile because the package statement is missing.</p>\n\n<p>Second: there is an important difference between <code>Nanoseconds</code> and <code>Nanosecond</code></p>\n\n<p>I tried to evaluate your observation this way<sup>*</sup>:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n)\n\nconst (\n    chan_size = 1000\n    cycle_count = 1000\n)\n\nvar (\n    v_ch = make(chan t, chan_size)\n    p_ch = make(chan *t, chan_size)\n)\n\ntype t struct {\n    a uint\n    b uint\n}\n\nfunc fill_v() {\n    for i := 0; i &lt; chan_size; i++ {\n        b := t{a:3, b:5}\n        v_ch &lt;- b\n    }\n}\n\nfunc fill_p() {\n    for i := 0; i &lt; chan_size; i++ {\n        b := t{a:3, b:5}\n        p_ch &lt;- &amp;b\n    }\n}\n\nfunc measure_f(f func()) int64 {\n    start := time.Now()\n    f();\n    elapsed := time.Since(start)\n    return elapsed.Nanoseconds()\n}\n\nfunc main() {\n\n    var v_nanos int64 = 0\n    var p_nanos int64 = 0\n    for i := 0; i&lt;cycle_count; i++ {\n        v_nanos += measure_f(fill_v);\n        for i := 0; i &lt; chan_size; i++ {\n            _ = &lt;- v_ch\n        }\n    }\n    for i := 0; i&lt;cycle_count; i++ {\n        p_nanos += measure_f(fill_p);\n        for i := 0; i &lt; chan_size; i++ {\n            _ = &lt;- p_ch\n        }\n    }\n    fmt.Println(\n        \"v:\",v_nanos/cycle_count, \n        \" p:\", p_nanos/cycle_count, \n        \"ratio (v/p):\", float64(v_nanos)/float64(p_nanos))\n}\n</code></pre>\n\n<p>There is indeed <strong>a measurable performance drop</strong> (I define drop like this <code>drop=1-(candidate/optimum)</code>), but although I repeat the code 1000 times, it varies between 25% and 50%, I'm not even sure how the heap is recycled and when, so it maybe <strong>hard to quantify</strong> at all.</p>\n\n<hr>\n\n<p><sup>*</sup>see a \"running\" demo on <a href=\"https://ideone.com/vzIiTK\" rel=\"nofollow noreferrer\">ideone</a> </p>\n\n<p>...note that stdout is frozen: <code>v: 34875  p: 59420 ratio (v/p)0.586923845267128</code></p>\n\n<p>For some reason, it was not possible to run <a href=\"https://play.golang.org/p/U8DdLr2kpB\" rel=\"nofollow noreferrer\">this code in the Go Playground</a></p>\n"}], "owner": {"reputation": 91, "user_id": 7305404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4aa8db192c93c36aa7c6af56b47bcd?s=128&d=identicon&r=PG&f=1", "display_name": "user7305404", "link": "https://stackoverflow.com/users/7305404/user7305404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1268, "favorite_count": 4, "accepted_answer_id": 41179423, "answer_count": 2, "score": 8, "last_activity_date": 1481888152, "creation_date": 1481870814, "last_edit_date": 1481888152, "question_id": 41178729, "link": "https://stackoverflow.com/questions/41178729/why-passing-pointers-to-channel-is-slower", "title": "Why passing pointers to channel is slower", "body": "<p>I'm a newbie to golang, trying to rewrite my java server project in golang.</p>\n\n<p>I found, passing pointers into channel cause almost 30% performance drop compared to passing values.</p>\n\n<p>Here is a sample snippet:\n    package main\n    import (\n        \"time\"\n        \"fmt\"\n    )</p>\n\n<pre><code>var c = make(chan t, 1024)\n// var c = make(chan *t, 1024)\ntype t struct {\n    a uint\n    b uint\n}\n\nfunc main() {\n\n    start := time.Now()\n    for i := 0; i &lt; 1000; i++ {\n        b := t{a:3, b:5}\n        // c &lt;- &amp;b\n        c &lt;- b\n    }\n    elapsed := time.Since(start)\n    fmt.Println(t2)\n}\n</code></pre>\n\n<h1>update. fix the package missing</h1>\n"}, {"tags": ["go", "intellij-idea", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "is_accepted": false, "score": 1, "last_activity_date": 1490790675, "last_edit_date": 1490790675, "creation_date": 1481870000, "answer_id": 41178554, "question_id": 41177788, "link": "https://stackoverflow.com/questions/41177788/from-goroot-gopath-not-set-in-intellij-idea/41178554#41178554", "title": "(from $GOROOT) ($GOPATH not set) in IntelliJ idea", "body": "<p>First, you need to remove slash at start of \"<code>/github.com/zzz/stringutil</code>\". It should be \"<code>github.com/zzz/stringutil</code>\".</p>\n\n<p>Then, you need to define environment variable <strong>GOPATH</strong> and set it to some writeable directory.</p>\n\n<p>You can see this guide for setting up GOPATH on windows: <a href=\"http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/\" rel=\"nofollow noreferrer\">http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/</a> </p>\n\n<p>From above:</p>\n\n<ol>\n<li><p>create a <code>C:\\Projects\\Go</code> folder as my root Go workspace</p></li>\n<li><p>Create the GOPATH environment variable and reference your Go\n    workspace path. To add, click <code>System-&gt; Advanced system settings-&gt; Environment Variables</code>... and click New... under System variables</p></li>\n<li>Set the variable name to <code>GOPATH</code> and value to your <code>Go workspace path</code>\n    (e.g. <code>C:\\Projects\\Go</code>)</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 5273494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbfbf892bbb5a830f7e7a1ff1f3ce79?s=128&d=identicon&r=PG&f=1", "display_name": "ohko", "link": "https://stackoverflow.com/users/5273494/ohko"}, "is_accepted": false, "score": 1, "last_activity_date": 1482033688, "creation_date": 1482033688, "answer_id": 41205342, "question_id": 41177788, "link": "https://stackoverflow.com/questions/41177788/from-goroot-gopath-not-set-in-intellij-idea/41205342#41205342", "title": "(from $GOROOT) ($GOPATH not set) in IntelliJ idea", "body": "<p>Yes, remove the slash of \"/github.com/zzz/stringutil\", like this \"github.com/zzz/stringutil\",\nyou can use idea or vscode, it can auto add to imports, new golanger. ^_^'</p>\n"}, {"tags": [], "owner": {"reputation": 3151, "user_id": 2119946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cae444ffe4d22b6b3bffb9114405f41d?s=128&d=identicon&r=PG", "display_name": "Faris Rayhan", "link": "https://stackoverflow.com/users/2119946/faris-rayhan"}, "is_accepted": false, "score": 7, "last_activity_date": 1517641839, "creation_date": 1517641839, "answer_id": 48594902, "question_id": 41177788, "link": "https://stackoverflow.com/questions/41177788/from-goroot-gopath-not-set-in-intellij-idea/48594902#48594902", "title": "(from $GOROOT) ($GOPATH not set) in IntelliJ idea", "body": "<p>This is the quick fix for this issue. I am using inttelliJ idea as my editor. I am using MAC</p>\n\n<ol>\n<li>Go to preferences  </li>\n<li>Search for GO under language &amp; frameworks </li>\n<li><p>If your look for <strong>GOROOT</strong> it should be like screen shot below</p>\n\n<p><a href=\"https://i.stack.imgur.com/m9HJA.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/m9HJA.png\" alt=\"enter image description here\"></a></p></li>\n<li><p>If you look for GOPATH the setting should be like screen shoot below</p></li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/UhE3j.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/UhE3j.png\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"5\">\n<li>And this is my full path of the project. You can customize it to\nfollow your needs. My project name is <strong>adit</strong> <em>/Users/mmdc/Documents/mataharimall-development/www/go/src/github.com/mataharimall/adit</em></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "is_accepted": false, "score": 0, "last_activity_date": 1539848658, "creation_date": 1539848658, "answer_id": 52869259, "question_id": 41177788, "link": "https://stackoverflow.com/questions/41177788/from-goroot-gopath-not-set-in-intellij-idea/52869259#52869259", "title": "(from $GOROOT) ($GOPATH not set) in IntelliJ idea", "body": "<p>If you installed via homebrew, just do:</p>\n\n<pre><code>brew info go\n</code></pre>\n\n<p>And it gives indications for your $GOROOT. Mine is:</p>\n\n<pre><code>You may wish to add the GOROOT-based install location to your PATH:  \n    export PATH=$PATH:/usr/local/opt/go/libexec/bin\n</code></pre>\n\n<p>Also, don't forget to source your bash profile! It should work now. If not, try to do <code>File/ Invalidate Caches/ Restart...</code> in IntelliJ Idea.</p>\n"}], "owner": {"reputation": 9029, "user_id": 2663692, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/LOx4z.png?s=128&g=1", "display_name": "Tal Avissar", "link": "https://stackoverflow.com/users/2663692/tal-avissar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5812, "favorite_count": 0, "answer_count": 4, "score": 6, "last_activity_date": 1539848658, "creation_date": 1481866036, "question_id": 41177788, "link": "https://stackoverflow.com/questions/41177788/from-goroot-gopath-not-set-in-intellij-idea", "title": "(from $GOROOT) ($GOPATH not set) in IntelliJ idea", "body": "<p>I've started using the golang in IntelliJ Idea.</p>\n\n<p>I have the following code</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"/github.com/zzz/stringutil\"\n)\n\nfunc main() {\n    fmt.Printf(stringutil.Reverse(\"!oG ,olleH\"))\n}\n</code></pre>\n\n<p>and also I have the following stringutil.go file</p>\n\n<pre><code>// Package stringutil contains utility functions for working with strings.\npackage stringutil\n\n// Reverse returns its argument string reversed rune-wise left to right.\nfunc Reverse(s string) string {\n    r := []rune(s)\n    for i, j := 0, len(r)-1; i &lt; len(r)/2; i, j = i+1, j-1 {\n        r[i], r[j] = r[j], r[i]\n    }\n    return string(r)\n}\n</code></pre>\n\n<p>I'm receiving the following error:</p>\n\n<pre><code>src\\github.com\\zzz\\hello\\hello.go:5:2: cannot find package \"src/github.com/zzz/stringutil\" in any of:\n    C:\\Go\\src\\src\\github.com\\zzz\\stringutil (from $GOROOT)\n    ($GOPATH not set)\n</code></pre>\n\n<p>How can I configure the env variables through Intellij so I can run the program?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 1, "creation_date": 1481871448, "post_id": 41177475, "comment_id": 69557771, "body": "Actually the output is correct, you&#39;re running your server with ipv4 and ipv6 support. If you only want to run your server with ipv4, you can check <a href=\"http://stackoverflow.com/questions/38592064/go-lang-go-gin-listen-on-tcp4-not-tcp6\">here</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481898889, "post_id": 41177475, "comment_id": 69572956, "body": "To state it another way, the client isn&#39;t connecting with IPv4, so there&#39;s no IPv4 address to get."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481898589, "post_id": 41180066, "comment_id": 69572776, "body": "<code>X-Forwarded-For</code> is the old header used by proxies to store a client&#39;s IP. It doesn&#39;t exist if there was no proxy, the proxy doesn&#39;t use the old header format, or the proxy simply doesn&#39;t include a Forwarded header at all."}], "tags": [], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "is_accepted": false, "score": 0, "last_activity_date": 1481876507, "creation_date": 1481876507, "answer_id": 41180066, "question_id": 41177475, "link": "https://stackoverflow.com/questions/41177475/how-to-get-remote-clients-ipv4-address-from-request-object/41180066#41180066", "title": "How to get remote client&#39;s IPV4 address from request object", "body": "<p>you can use this function to get the ip and user agent, but it will give a bracket character if you are trying from localhost but if you try from somewhere else it will work.</p>\n\n<pre><code>func GetIPAndUserAgent(r *http.Request) (ip string, user_agent string) {\n        ip = r.Header.Get(\"X-Forwarded-For\")\n        if ip == \"\" {\n            ip = strings.Split(r.RemoteAddr, \":\")[0]\n        }\n\n        user_agent = r.UserAgent()\n        return ip, user_agent\n\n    }\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2849, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1481876507, "creation_date": 1481863930, "last_edit_date": 1495542819, "question_id": 41177475, "link": "https://stackoverflow.com/questions/41177475/how-to-get-remote-clients-ipv4-address-from-request-object", "title": "How to get remote client&#39;s IPV4 address from request object", "body": "<p>I am using go-gin as server and rendering an html using the code like the following</p>\n\n<pre><code>func dashboardHandler(c *gin.Context) {\n    c.HTML(200, \"dashboard\", gin.H{\n        \"title\": \"Dashboard\"\n})\n</code></pre>\n\n<p>Along with title I want to pass the remote client's IPV4 address as well. I tried using the following code to get the IP address but for localhost it gives me <code>::1:56797</code> as output. My server is running on <code>localhost:8080</code></p>\n\n<pre><code>ip, port, err := net.SplitHostPort(c.Request.RemoteAddr)\nfmt.Println(ip + \":\" + port)\nif err != nil {\n    fmt.Println(err.Error())\n}\n</code></pre>\n\n<p>I followed <a href=\"https://stackoverflow.com/questions/27234861/correct-way-of-getting-clients-ip-addresses-from-http-request-golang\">Correct way of getting Client&#39;s IP Addresses from http.Request (Golang)</a> for reference. Is there any way I get the IPV4 address from the request?</p>\n"}, {"tags": ["forms", "go"], "comments": [{"owner": {"reputation": 48, "user_id": 777086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032379a9e4ea45514585e1c3d124b48?s=128&d=identicon&r=PG", "display_name": "Caffeine Borg", "link": "https://stackoverflow.com/users/777086/caffeine-borg"}, "edited": false, "score": 0, "creation_date": 1481864456, "post_id": 41177449, "comment_id": 69555332, "body": "small update -- using"}, {"owner": {"reputation": 48, "user_id": 777086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032379a9e4ea45514585e1c3d124b48?s=128&d=identicon&r=PG", "display_name": "Caffeine Borg", "link": "https://stackoverflow.com/users/777086/caffeine-borg"}, "reply_to_user": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1481907371, "post_id": 41177449, "comment_id": 69577925, "body": "@Motakjuq -- Thanks for clean up on the text."}], "answers": [{"comments": [{"owner": {"reputation": 48, "user_id": 777086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032379a9e4ea45514585e1c3d124b48?s=128&d=identicon&r=PG", "display_name": "Caffeine Borg", "link": "https://stackoverflow.com/users/777086/caffeine-borg"}, "edited": false, "score": 0, "creation_date": 1481907234, "post_id": 41178789, "comment_id": 69577856, "body": "Thanks!  I dug into the source mediatype.go, to find that string.  Your note helped isolate the issue, there was a proxy that was modifying the Content-Type Header.   I moved the server and was able to confirm that the form post was working.     I appreciate your time."}], "tags": [], "owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "is_accepted": true, "score": 0, "last_activity_date": 1481876776, "last_edit_date": 1481876776, "creation_date": 1481871048, "answer_id": 41178789, "question_id": 41177449, "link": "https://stackoverflow.com/questions/41177449/golang-parseform-err-mime-expected-slash-after-first-token/41178789#41178789", "title": "Golang - ParseForm ; err = mime: expected slash after first token", "body": "<p>This error comes from line 85 of <a href=\"https://golang.org/src/mime/mediatype.go\" rel=\"nofollow noreferrer\">mediatype.go</a>.  You're probably getting this error from a call to ParseMediaType method internally. From there it seems like your static form or curl is not setting some value of Content-Type or Content-Disposition correctly. Please check these headers for any problematic values.</p>\n\n<p>From docs:</p>\n\n<pre><code>// ParseMediaType parses a media type value and any optional\n// parameters, per RFC 1521.  Media types are the values in\n// Content-Type and Content-Disposition headers (RFC 2183).\n// On success, ParseMediaType returns the media type converted\n// to lowercase and trimmed of white space and a non-nil map.\n// The returned map, params, maps from the lowercase\n// attribute to the attribute value with its case preserved.\n</code></pre>\n"}], "owner": {"reputation": 48, "user_id": 777086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9032379a9e4ea45514585e1c3d124b48?s=128&d=identicon&r=PG", "display_name": "Caffeine Borg", "link": "https://stackoverflow.com/users/777086/caffeine-borg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 41178789, "answer_count": 1, "score": 0, "last_activity_date": 1481876776, "creation_date": 1481863776, "last_edit_date": 1481873256, "question_id": 41177449, "link": "https://stackoverflow.com/questions/41177449/golang-parseform-err-mime-expected-slash-after-first-token", "title": "Golang - ParseForm ; err = mime: expected slash after first token", "body": "<p>Am getting this <code>Error = mime: expected slash after first token</code>\n Some details below.  </p>\n\n<p>The goal is a login form that the username and password \ncan be extracted from the POST.</p>\n\n<p>I also tested a curl post and a static html form --> same issue = <code>mime: expected slash after first token</code></p>\n\n<p>Snippet of the  go code:</p>\n\n<pre><code>log.Printf(\"\\n\\n\\t[loginH()] - POST method ...\\n\")\nerr := r.ParseForm()\nif err != nil {\n        // Handle error here via logging and then return\n        DebugLog.Printf(\"[loginH()] - ERROR: with r.ParseForm. (err=%v)\\n\", err)\n        log.Printf(\"[loginH()] - ERROR: with r.ParseForm. (err=%v)\\n\", err)\n}\nusername := r.Form[\"username\"]\npasswd := r.Form[\"passwd\"]\nlog.Printf(\"[loginH()] - r.Form ... username=%s and passwd=%s\\n\",username,passwd)\n</code></pre>\n\n<p>The html/form is:</p>\n\n<pre><code>&lt;form method=\"POST\" action=\"/login\"&gt;\n    &lt;input type=\"text\" name=\"username\" placeholder=\"Email Address\"/&gt;\n    &lt;input type=\"password\" name=\"passwd\" placeholder=\"Password\"/&gt;\n    &lt;input type=\"submit\"  id=\"loginBtn\" name=\"login\" value=\"Logon\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>2016/12/15 21:36:07 [loginH()] - POST method ...\n2016/12/15 21:36:07 [loginH()] - ERROR: with r.ParseForm. (err=mime: expected slash after first token)\n2016/12/15 21:36:07 [loginH()] - r.Form ... username= and passwd=\n</code></pre>\n\n<p>Thanks in advance for any pointers/information/enlightenment.</p>\n\n<p>r.Form is empty</p>\n"}, {"tags": ["javascript", "node.js", "sockets", "go", "unix-socket"], "comments": [{"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1481868934, "post_id": 41177350, "comment_id": 69556726, "body": "<a href=\"https://nodejs.org/api/net.html#net_server_listen_path_backlog_callback\" rel=\"nofollow noreferrer\">nodejs.org/api/net.html#net_server_listen_path_backlog_callb&zwnj;&#8203;ack</a>"}, {"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1481868962, "post_id": 41177350, "comment_id": 69556737, "body": "see this also <a href=\"http://stackoverflow.com/questions/7045614/can-node-js-listen-on-unix-socket\" title=\"can node js listen on unix socket\">stackoverflow.com/questions/7045614/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 4218797, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-fuq3VMG3aHQ/AAAAAAAAAAI/AAAAAAAAAdU/pnIiHy12NvU/photo.jpg?sz=128", "display_name": "Nikita Kodkani", "link": "https://stackoverflow.com/users/4218797/nikita-kodkani"}, "edited": false, "score": 1, "creation_date": 1490078312, "post_id": 42388725, "comment_id": 72938031, "body": "const options = {   socketPath: &#39;/tmp/static0.sock&#39;,   path: &#39;/volumes/list&#39;, }; this was the crucial part which i had missed"}, {"owner": {"reputation": 233, "user_id": 4220575, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-V7Ha1Ae-Ff8/AAAAAAAAAAI/AAAAAAAAEBo/qWcesCv7RjQ/photo.jpg?sz=128", "display_name": "Luis Contreras", "link": "https://stackoverflow.com/users/4220575/luis-contreras"}, "edited": false, "score": 0, "creation_date": 1573938353, "post_id": 42388725, "comment_id": 104055133, "body": "How to get the data from within the success response ?"}], "tags": [], "owner": {"reputation": 1109, "user_id": 7125925, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-koYfigssJBw/AAAAAAAAAAI/AAAAAAAAAC0/naTVX_rR2oM/photo.jpg?sz=128", "display_name": "Geige V", "link": "https://stackoverflow.com/users/7125925/geige-v"}, "is_accepted": true, "score": 14, "last_activity_date": 1487759579, "creation_date": 1487759579, "answer_id": 42388725, "question_id": 41177350, "link": "https://stackoverflow.com/questions/41177350/node-js-send-get-request-via-unix-socket/42388725#42388725", "title": "Node.js: Send GET request via unix socket", "body": "<p>To accomplish this without using the request module, try the following:</p>\n\n<pre><code>const http = require('http');\n\nconst options = {\n  socketPath: '/tmp/static0.sock',\n  path: '/volumes/list',\n};\n\nconst callback = res =&gt; {\n  console.log(`STATUS: ${res.statusCode}`);\n  res.setEncoding('utf8');\n  res.on('data', data =&gt; console.log(data));\n  res.on('error', data =&gt; console.error(data));\n};\n\nconst clientRequest = http.request(options, callback);\nclientRequest.end();\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 508, "user_id": 7342110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739c664c3535444ddbe5b91d974b7924?s=128&d=identicon&r=PG&f=1", "display_name": "Rupali Pemare", "link": "https://stackoverflow.com/users/7342110/rupali-pemare"}, "is_accepted": false, "score": -4, "last_activity_date": 1487763159, "creation_date": 1487763159, "answer_id": 42390153, "question_id": 41177350, "link": "https://stackoverflow.com/questions/41177350/node-js-send-get-request-via-unix-socket/42390153#42390153", "title": "Node.js: Send GET request via unix socket", "body": "<p>Consider the following example :</p>\n\n<p>client side code : \nAlso you can do socket connection in some code :\n<div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>&lt;script src=\"https://cdn.socket.io/socket.io-1.4.5.js\"&gt;&lt;/script&gt;\r\n&lt;script&gt;\r\n  socket = io.connect('http://www.example.com' , {'force new connection':true});\r\n  socket.on('event', function(){\r\n    // code to execute\r\n  });\r\n&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>server side code in nodejs : \nFor this install npm, then \n1)npm init \n2)npm install --save express\n3)npm insatll --save socket</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var express = require('express');\r\nvar app = express();\r\nvar http = require('http');\r\nvar server = http.createServer();\r\nvar io = require('socket.io').listen(server);\r\nvar socket = null;\r\n\r\nio.sockets.on('connection', function(soc) {\r\n  socket = soc;\r\n  console.log('socket connected');\r\n});\r\n\r\n\r\napp.get('/test', function(request, response) {\r\n  var message = \"Hello world\";\r\n  socket.emit('event', message);\r\n  response.writeHead(200);\r\n  reponse.write(message);\r\n  reponse.end();\r\n});\r\n\r\nvar server = app.listen(8080, '0.0.0.0');</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>You can hit this from browser a check </p>\n"}], "owner": {"reputation": 135, "user_id": 4218797, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-fuq3VMG3aHQ/AAAAAAAAAAI/AAAAAAAAAdU/pnIiHy12NvU/photo.jpg?sz=128", "display_name": "Nikita Kodkani", "link": "https://stackoverflow.com/users/4218797/nikita-kodkani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6709, "favorite_count": 2, "accepted_answer_id": 42388725, "answer_count": 2, "score": 8, "last_activity_date": 1487763159, "creation_date": 1481863008, "last_edit_date": 1481868178, "question_id": 41177350, "link": "https://stackoverflow.com/questions/41177350/node-js-send-get-request-via-unix-socket", "title": "Node.js: Send GET request via unix socket", "body": "<p>I am new to the <em>node.js</em>. I am trying to setup the client server connection using unix socket, where my client request would be in <em>node.js</em> and server running in the background would be in go.</p>\n\n<p>Client side Code:</p>\n\n<pre><code>    var request = require('request');\n\n    request('http://unix:/tmp/static0.sock:/volumes/list', function (error, response, body) {\n        if (!error &amp;&amp; response.statusCode == 200) {\n            console.log(body)\n        } else {\n            console.log(\"In else part of the receiver\" + response.statusCode + body)\n        }\n    }\n\n\n})\n</code></pre>\n\n<p>When I try to communicate with the server written in go it is shows the <code>HTTP  error: 400 Bad Request: malformed Host header'</code></p>\n\n<p>The same works with:</p>\n\n<pre><code>curl -X GET --unix-socket /tmp/static0.sock http://:/volumes/list\n</code></pre>\n\n<p>Not sure what is wrong with my request. Do we need to send the headers? I expecting the JSON response.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1481859879, "last_edit_date": 1481859879, "creation_date": 1481859429, "answer_id": 41176896, "question_id": 41176862, "link": "https://stackoverflow.com/questions/41176862/golang-grammar-questions-about-struct/41176896#41176896", "title": "golang grammar questions about struct", "body": "<p>golang's struct inherit will help this</p>\n\n<pre><code>type Base struct {\n    Id int\n    Name String\n    Status bool\n    ...\n    Created time.Time\n}\n\ntype One struct{\n    Base\n    Devtype string\n}\n\ntype Two struct{\n    Base\n    Devtype string\n}\n\ntype Three struct{\n    Base\n    Devtype string\n}\n\nfunc Insert(devtype string, base Base){\n    switch devtype {\n        case \"one\"\n            var value One\n            value.Base = base\n            value.Devtype = devtype //only here is different\n        case \"two\"\n            var value Two\n            value.Base = base\n            value.Devtype = devtype //only here is different\n        case \"three\"\n            var value Three\n            value.Base = base\n            value.Devtype = devtype //only here is different\n    }\n}\n</code></pre>\n\n<p>PS: since there is noly one field different, it is not a good practice to create three type</p>\n"}], "owner": {"reputation": 145, "user_id": 7004844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/13debc3965e74232e3500042265051d3?s=128&d=identicon&r=PG&f=1", "display_name": "haroldT", "link": "https://stackoverflow.com/users/7004844/haroldt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 41176896, "answer_count": 1, "score": 0, "last_activity_date": 1481859879, "creation_date": 1481859175, "question_id": 41176862, "link": "https://stackoverflow.com/questions/41176862/golang-grammar-questions-about-struct", "title": "golang grammar questions about struct", "body": "<p>here is some codes, but it is so long and unnecessary.\nSometimes I need to write somethings to mysql,\nthere is some kind of tables like that.</p>\n\n<p>I have been try to use interface{}, but it is more complex.</p>\n\n<p>Is there any way to make it shorter?</p>\n\n<pre><code>type One struct{\n    Id int\n    Name String\n    Status bool\n    Devtype string\n    ...\n    Created time.Time\n}\n\ntype Two struct{\n    Id int\n    Name String\n    Status bool\n    Devtype string\n    ...\n    Created time.Time\n}\n\ntype Three struct{\n    Id int\n    Name String\n    Status bool\n    Devtype string\n    ...\n    Created time.Time\n}\n\nfunc Insert(devtype string){\n    if devtype == \"one\"{\n        var value One\n        value.Id = 1\n        value.Name = \"device\"\n        value.Status = false\n        value.Devtype = devtype //only here is different\n        value.Created = time.Now()\n        fmt.Println(value)\n    }else if devtype == \"two\"{\n        var value Two\n        value.Id = 1\n        value.Name = \"device\"\n        value.Status = false\n        value.Devtype = devtype //only here is different\n        value.Created = time.Now()\n        fmt.Println(value)\n    }else if devtype == \"three\"{\n        var value Three\n        value.Id = 1\n        value.Name = \"device\"\n        value.Status = false\n        value.Devtype = devtype //only here is different\n        value.Created = time.Now()\n        fmt.Println(value)\n    }\n}\n</code></pre>\n"}]