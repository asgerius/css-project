[{"tags": ["http", "go", "webserver", "csrf", "mux"], "comments": [{"owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "edited": false, "score": 0, "creation_date": 1525900775, "post_id": 50262104, "comment_id": 87542533, "body": "Change csrf.TemplateTag to csrfField. Make sure csrf.TemplateField(req) is type template.HTML"}, {"owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "reply_to_user": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "edited": false, "score": 0, "creation_date": 1525900996, "post_id": 50262104, "comment_id": 87542617, "body": "@Godfrey Thank you I changed csrf.Template Tag to CSRFField and in the struc I changed csrfField to CSRFField"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1525900887, "last_edit_date": 1525900887, "creation_date": 1525900608, "answer_id": 50262185, "question_id": 50262104, "link": "https://stackoverflow.com/questions/50262104/golang-csrf-save-template-field-in-struct/50262185#50262185", "title": "Golang CSRF save template field in struct", "body": "<p>The <code>HTML</code> type is declared in \"html/template\" . Import \"html/template\" instead of \"text/template\".</p>\n\n<p>The template engine ignores unexported fields. <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Export</a> the field name by starting the name with an uppercase character.</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"net/http\"\n    \"html/template\"\n\n    \"github.com/go-zoo/bone\"\n    \"github.com/gorilla/csrf\"\n)\nStruc:\n\ntype Input struct {\n    Title     string\n    Name      string\n    CSRFField template.HTML \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67, "user_id": 5973071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb64015516c086679cf825e5873dbc80?s=128&d=identicon&r=PG&f=1", "display_name": "kbar", "link": "https://stackoverflow.com/users/5973071/kbar"}, "is_accepted": false, "score": 2, "last_activity_date": 1542029140, "last_edit_date": 1542029140, "creation_date": 1525900779, "answer_id": 50262227, "question_id": 50262104, "link": "https://stackoverflow.com/questions/50262104/golang-csrf-save-template-field-in-struct/50262227#50262227", "title": "Golang CSRF save template field in struct", "body": "<p>From the second sentence of text/template documentation:</p>\n\n<pre><code>To generate HTML output, see package html/template, which has the same \ninterface as this package but automatically secures HTML output against \ncertain attacks.\n</code></pre>\n\n<p>text/template does not have an HTML method, thus you are receiving an undefined error.</p>\n\n<p>Happy coding.</p>\n"}], "owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 50262185, "answer_count": 2, "score": 0, "last_activity_date": 1542029140, "creation_date": 1525900204, "question_id": 50262104, "link": "https://stackoverflow.com/questions/50262104/golang-csrf-save-template-field-in-struct", "title": "Golang CSRF save template field in struct", "body": "<p>I am trying to make a simple webserver an decided to use <a href=\"https://github.com/go-zoo/bone\" rel=\"nofollow noreferrer\">bone</a> for my routes and <a href=\"https://github.com/gorilla/csrf\" rel=\"nofollow noreferrer\">Gorilla csrf</a> for csrf. The problem I am having is that I cannot save the csrf.TemplateField(req) in a struct to use in a template.</p>\n\n<p>Imports:</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"net/http\"\n    \"text/template\"\n\n    \"github.com/go-zoo/bone\"\n    \"github.com/gorilla/csrf\"\n)\n</code></pre>\n\n<p>Struc:</p>\n\n<pre><code>type Input struct {\n    Title     string\n    Name      string\n    csrfField template.HTML // Error here: Undefined \"text/template\".HTML\n}\n</code></pre>\n\n<p>Handler Code:</p>\n\n<pre><code>func RootHandler(rw http.ResponseWriter, req *http.Request) {\n    temp, _ := template.ParseFiles(\"site/index.html\")\n    head := Input{Title: \"test\", csrf.TemplateTag: csrf.TemplateField(req)}\n    temp.Execute(rw, head)\n}\n</code></pre>\n\n<p>I have tried changing the template.HTML type to string and then I got an error with csrf.TemplateField(req): </p>\n\n<blockquote>\n  <p>unknown field 'csrf.TemplateTag' in struct literal of type Input</p>\n</blockquote>\n\n<p>So can anybody help? Am I using the wrong type?</p>\n"}, {"tags": ["asynchronous", "go", "dispatcher", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525898843, "post_id": 50261750, "comment_id": 87541670, "body": "the optimal values are completely dependent on your system and requirements. As for making them &quot;independent from the physical set-up&quot;, can you explain what you mean? You can certainly make the values configurable."}, {"owner": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525899034, "post_id": 50261750, "comment_id": 87541771, "body": "I mean is there some sort of a formula that I can implement as code with input values to give me the optimal size and workers number"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525956447, "post_id": 50261750, "comment_id": 87563374, "body": "In something close to 99.999% of cases, what is &quot;optimal&quot; is whatever you can release soonest. In other words: Optimizing for, say, 1% faster throughput, might cost 2 weeks of additional man hours. That&#39;s a pretty expensive improvement, for most applications. Put yet another way: Don&#39;t forget the time it takes to measure performance when optimizing. Your developer time is often better spent elsewhere."}], "answers": [{"comments": [{"owner": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "edited": false, "score": 1, "creation_date": 1525899423, "post_id": 50261833, "comment_id": 87541962, "body": "that is true but as a codec i only depend on CPU and memory (not using any IO, or network). with that in mind is it possible to find the right channel size for any machine x"}, {"owner": {"reputation": 5782, "user_id": 2832398, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/356c99a077310a35816f852423859f4c?s=128&d=identicon&r=PG&f=1", "display_name": "lilezek", "link": "https://stackoverflow.com/users/2832398/lilezek"}, "reply_to_user": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "edited": false, "score": 0, "creation_date": 1525899521, "post_id": 50261833, "comment_id": 87542002, "body": "Then still you have memory access, L1 and L2 caches, and the number of physical cores."}], "tags": [], "owner": {"reputation": 5782, "user_id": 2832398, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/356c99a077310a35816f852423859f4c?s=128&d=identicon&r=PG&f=1", "display_name": "lilezek", "link": "https://stackoverflow.com/users/2832398/lilezek"}, "is_accepted": false, "score": 0, "last_activity_date": 1525899030, "creation_date": 1525899030, "answer_id": 50261833, "question_id": 50261750, "link": "https://stackoverflow.com/questions/50261750/whats-the-ideal-size-of-buffered-channel-and-number-of-workers/50261833#50261833", "title": "What&#39;s the ideal size of buffered channel and number of workers?", "body": "<p>The answer is no. The optimal setup will be dependent not only on the software you run in <code>doWork</code> (how much CPU intensive and IO that function will depend) but also on how much instructions can your hardware execute and how much IO can your system deal with. </p>\n\n<p>Meaning that it could depend on what your system has or has not an SSD installed or even your bandwidth if your system performs activities involving internet access, how much physical cores your CPU(s) have, etc... </p>\n"}, {"comments": [{"owner": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "edited": false, "score": 0, "creation_date": 1525899697, "post_id": 50261948, "comment_id": 87542087, "body": "so the answer would be to just manually test multiple combinations of the two variables and stick to the one that works the best?"}, {"owner": {"reputation": 5782, "user_id": 2832398, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/356c99a077310a35816f852423859f4c?s=128&d=identicon&r=PG&f=1", "display_name": "lilezek", "link": "https://stackoverflow.com/users/2832398/lilezek"}, "reply_to_user": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "edited": false, "score": 1, "creation_date": 1525899778, "post_id": 50261948, "comment_id": 87542114, "body": "@Mheni but the best for one specific CPU won&#39;t likely be the best for other CPUs, and I&#39;m even not taking into account the memory system."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "edited": false, "score": 0, "creation_date": 1525899898, "post_id": 50261948, "comment_id": 87542173, "body": "@Mheni, I would automate the tests, and remember that the results are only valid for the system you tested as a whole."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1525899973, "last_edit_date": 1525899973, "creation_date": 1525899507, "answer_id": 50261948, "question_id": 50261750, "link": "https://stackoverflow.com/questions/50261750/whats-the-ideal-size-of-buffered-channel-and-number-of-workers/50261948#50261948", "title": "What&#39;s the ideal size of buffered channel and number of workers?", "body": "<p>You always need to measure to determine how the system will perform under load. The good news here is that you only have 2 variables, which are mostly independent, so it's fairly easy to reason about.</p>\n\n<p>The number of workers determines your concurrency, so benchmark the processing to see what the optimal concurrency is. There is usually a number of concurrent processes above which the returns drop off dramatically.</p>\n\n<p>The size of the channel is just like any other \"buffer\" in a system. A larger buffer can handle larger spikes in input, at the expense of possibly inducing larger latencies and memory usage.</p>\n"}, {"comments": [{"owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "edited": false, "score": 1, "creation_date": 1525905221, "post_id": 50262979, "comment_id": 87544038, "body": "As an aside, I find that a semaphore is usually preferable to a worker pool: that simplifies cleanup and allows you to write synchronous functions with less risk of leaking goroutines.  See <a href=\"https://godoc.org/golang.org/x/sync/semaphore#example-package--WorkerPool\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/sync/&hellip;</a> for an example."}, {"owner": {"reputation": 20379, "user_id": 497934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba65fe61781731f1b551098a887b4212?s=128&d=identicon&r=PG", "display_name": "Maxpm", "link": "https://stackoverflow.com/users/497934/maxpm"}, "edited": false, "score": 0, "creation_date": 1608828587, "post_id": 50262979, "comment_id": 115696947, "body": "Could you clarify what you mean by &quot;1 gives asynchronous behavior&quot;?"}, {"owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "reply_to_user": {"reputation": 20379, "user_id": 497934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba65fe61781731f1b551098a887b4212?s=128&d=identicon&r=PG", "display_name": "Maxpm", "link": "https://stackoverflow.com/users/497934/maxpm"}, "edited": false, "score": 1, "creation_date": 1613159407, "post_id": 50262979, "comment_id": 117000034, "body": "I mean that with a buffer size of 1, the sender can place an item in the buffer and resume execution, and the receiver can later remove an item from the buffer and resume execution. Neither side of the channel necessarily needs to block on the other, especially if a <code>select</code> with a <code>default</code> case is used."}], "tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 2, "last_activity_date": 1525905127, "creation_date": 1525905127, "answer_id": 50262979, "question_id": 50261750, "link": "https://stackoverflow.com/questions/50261750/whats-the-ideal-size-of-buffered-channel-and-number-of-workers/50262979#50262979", "title": "What&#39;s the ideal size of buffered channel and number of workers?", "body": "<p>In practice, I find that there are three buffer sizes that matter: 0, 1, and \u201can upper bound on the total number of sends\u201d.</p>\n\n<p>0 gives synchronous behavior.</p>\n\n<p>1 gives asynchronous behavior: it's useful in a <code>select</code> statement with a <code>default</code> case.</p>\n\n<p>An upper bound on the total number of sends gives guaranteed-non-blocking behavior: you can send to it without a <code>select</code> without risking a goroutine leak.</p>\n\n<p>Other numbers may provide marginally better throughput, but at scale they're still going to contend on the cache line containing the channel's internal mutex, and they'll be more likely to mask potential deadlocks and goroutine leaks.</p>\n"}], "owner": {"reputation": 178, "user_id": 7438208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BprTn.png?s=128&g=1", "display_name": "Mheni", "link": "https://stackoverflow.com/users/7438208/mheni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1635, "favorite_count": 0, "accepted_answer_id": 50261948, "answer_count": 3, "score": 0, "last_activity_date": 1525956288, "creation_date": 1525898664, "last_edit_date": 1525956288, "question_id": 50261750, "link": "https://stackoverflow.com/questions/50261750/whats-the-ideal-size-of-buffered-channel-and-number-of-workers", "title": "What&#39;s the ideal size of buffered channel and number of workers?", "body": "<p>I'm trying to build an asynchronous codec. I have implemented a job dispatcher that has access to a buffered channel of jobs</p>\n\n<pre><code>var JobChannel chan Job = make(chan Job, 100000)\n</code></pre>\n\n<p>the dispatcher takes as input the number of workers and assigns work to them</p>\n\n<pre><code>func StartDispacher(numberOfWorkers int){\n    // start workers\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(numberOfWorkers)\n    for i := int(1); i &lt;= numberOfWorkers; i++ {\n        go func(i int) {\n            defer wg.Done()\n            for j := range JobChannel {\n                doWork(i, j)\n            }\n        }(i)\n    }\n}\n</code></pre>\n\n<p>my main function starts the dispatcher and keeps giving it jobs to do (in this case 200000 jobs)</p>\n\n<pre><code>workDispatcher.StartDispacher(2*runtime.NumCPU())\nfor i := 0; i &lt; 200000; i++ {\n    j := workDispatcher.Job{\n        BytePacket: d,\n        JobType:    workDispatcher.DECODE_JOB,\n    }\n    workDispatcher.JobChannel &lt;- j\n}\n</code></pre>\n\n<p>after experimenting: turns out there are 2 factors that affect the performance of this code</p>\n\n<ul>\n<li>the size of the buffered channel <code>JobChannel</code></li>\n<li>the number of workers there are <code>func StartDispacher(numberOfWorkers int)</code></li>\n</ul>\n\n<p>Is there a standard way to find the optimal values for these parameters, and is it possible to make these values independent from the physical set-up of the machine running the code?</p>\n"}, {"tags": ["go", "io", "file-permissions"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1525894978, "post_id": 50260848, "comment_id": 87539875, "body": "Windows file permissions are complicated and cannot be represented by three bytes as they can in Unix. <a href=\"https://stackoverflow.com/questions/33445727/how-to-control-file-access-in-windows\">See this related question</a>"}, {"owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1525895159, "post_id": 50260848, "comment_id": 87539965, "body": "@Adrian, thanks for the link. Understood about the complications. I guess I\u2019m used to how in NodeJS for example I can just ask \u201cdo I have access to this folder\u201d; I don\u2019t really care about the whole ACL. I assume based on that post and your response there\u2019s no similarly simple way to do this in Go?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1525895361, "post_id": 50260848, "comment_id": 87540052, "body": "You&#39;d have to look at the NodeJS source to be sure, but it&#39;s either using Windows syscalls to check the ACL, or it&#39;s just attempting a read or something and seeing if it succeeds."}, {"owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1525898202, "post_id": 50260848, "comment_id": 87541343, "body": "@Adrian, good call. Thanks for your pointers."}], "owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1525895225, "creation_date": 1525894581, "last_edit_date": 1525895225, "question_id": 50260848, "link": "https://stackoverflow.com/questions/50260848/reading-file-permissions-in-windows", "title": "Reading file permissions in Windows", "body": "<p>I have a scenario where I need to check permissions of files (and folders) in Windows, without attempting to read them. </p>\n\n<p>As a further complication, these files are on a network share. </p>\n\n<p>To do so, I run <code>os.Stat()</code> on the file and then check <code>f.Mode().Perm()</code>. The issue is, even for files that I do not have access, this API call shows that I do indeed have access. </p>\n\n<p>During testing of this error, I logged the permissions, then I tried to read the file (in production this program will not be reading the file). I get an error stating that I don\u2019t have access to read the file, as I expect. </p>\n\n<p>My question is, other than attempting to read/write a file and checking the error, is there a reliable way to check real permissions in Go under Windows? </p>\n\n<p>Thanks for your time! </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "edited": false, "score": 0, "creation_date": 1525896875, "post_id": 50259982, "comment_id": 87540753, "body": "so I need to remove shopspring/decimal from leekchan/accounting?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "edited": false, "score": 0, "creation_date": 1525898168, "post_id": 50259982, "comment_id": 87541326, "body": "Yeah, when you copy leekchan into you vendor directory flatten out the nested vendor directory by putting it&#39;s contents into your packages vendor directory"}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 2, "last_activity_date": 1525890828, "creation_date": 1525890828, "answer_id": 50259982, "question_id": 50259822, "link": "https://stackoverflow.com/questions/50259822/leekchan-accounting-conflicting-with-shopspring-decimal/50259982#50259982", "title": "Leekchan Accounting conflicting with ShopSpring Decimal", "body": "<p>This is because they have a checked in vendor directory that contains github.com/shopspring/decimal which it appears you already have on your path. You are best having a single vendor directory inside your project that contains both github.com/shopspring/decimal and github.com/leekchan/accounting so that you directory structure will look like:</p>\n\n<pre><code>- main.go\n| - vendor\n  | - github.com/leekchan/accounting\n  | - github.com/shopspring/decimal\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525890828, "creation_date": 1525890123, "question_id": 50259822, "link": "https://stackoverflow.com/questions/50259822/leekchan-accounting-conflicting-with-shopspring-decimal", "title": "Leekchan Accounting conflicting with ShopSpring Decimal", "body": "<p>I'm trying out the samples at <a href=\"https://github.com/leekchan/accounting\" rel=\"nofollow noreferrer\">https://github.com/leekchan/accounting</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n    \"github.com/shopspring/decimal\"\n    \"github.com/leekchan/accounting\"\n)\n\nfunc main() {\n    ac := accounting.Accounting{Symbol: \"$\", Precision: 2}\n    fmt.Println(ac.FormatMoney(123456789.213123))\n}\n</code></pre>\n\n<p>and using them exactly as showing on Github I'm getting the following error:</p>\n\n<blockquote>\n  <p>Failed parsing input: package \"github.com/shopspring/decimal\" is imported from multiple locations: \"/users/dev/go/src/github.com/shopspring/decimal\" and \"/users/dev/go/src/github.com/leekchan/accounting/vendor/github.com/shopspring/decimal\"</p>\n</blockquote>\n\n<p>I can't leave out:</p>\n\n<pre><code>github.com/shopspring/decimal\n</code></pre>\n\n<p>or I'll get another error. I tried:</p>\n\n<pre><code>\"dec\" github.com/shopspring/decimal\n</code></pre>\n\n<p>but that doesn't change anything. Shouldn't it?</p>\n\n<p>Weird thing is I can't find any details about this anywhere. Am I really the only person getting this, or am I missing something completely obvious?</p>\n"}, {"tags": ["go", "nats.io"], "comments": [{"owner": {"reputation": 141, "user_id": 9464830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b1a2971cb4839bf3b702bb918e2f4b8?s=128&d=identicon&r=PG&f=1", "display_name": "blonc", "link": "https://stackoverflow.com/users/9464830/blonc"}, "edited": false, "score": 0, "creation_date": 1525890480, "post_id": 50259732, "comment_id": 87537647, "body": "btw. i have ruled out that the servers / key / or subscribe part are incorrect because I have ran similar scripts in python, a language i am much more knowledgeable on and used all the same criteria."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 9464830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b1a2971cb4839bf3b702bb918e2f4b8?s=128&d=identicon&r=PG&f=1", "display_name": "blonc", "link": "https://stackoverflow.com/users/9464830/blonc"}, "edited": false, "score": 0, "creation_date": 1525959478, "post_id": 50260202, "comment_id": 87565198, "body": "thank you, i added a wait, and the problem was fixed."}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 3, "last_activity_date": 1525891771, "creation_date": 1525891771, "answer_id": 50260202, "question_id": 50259732, "link": "https://stackoverflow.com/questions/50259732/nats-client-in-golang-wont-subscribe/50260202#50260202", "title": "NATS Client in GoLang wont subscribe", "body": "<p>Subscribe create an asynchronous listener for events on that channel. As your main function exits straight after the call to subscribe there program will edit before the asynchronous process has finished. There is also synchronised subscribe function:</p>\n\n<p><a href=\"https://godoc.org/github.com/nats-io/go-nats#Conn.SubscribeSync\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/nats-io/go-nats#Conn.SubscribeSync</a></p>\n\n<p>Or you can add a wait into your main method so that it doesn't exit straight away.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 276354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea379ae84d8493303e3fb77d2017d724?s=128&d=identicon&r=PG", "display_name": "derek", "link": "https://stackoverflow.com/users/276354/derek"}, "is_accepted": false, "score": 0, "last_activity_date": 1538340590, "creation_date": 1538340590, "answer_id": 52582041, "question_id": 50259732, "link": "https://stackoverflow.com/questions/50259732/nats-client-in-golang-wont-subscribe/52582041#52582041", "title": "NATS Client in GoLang wont subscribe", "body": "<p>Assuming you are connecting ok (best to capture error on connect and check it) you are exiting the program since it does not wait to exit main since Subscribe creates async subscribers in their own Go routines. Use runtime.Goexit() to have the program wait. Similar to this <a href=\"https://github.com/nats-io/go-nats/blob/master/examples/nats-sub.go#L70\" rel=\"nofollow noreferrer\">example</a>.</p>\n"}], "owner": {"reputation": 141, "user_id": 9464830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b1a2971cb4839bf3b702bb918e2f4b8?s=128&d=identicon&r=PG&f=1", "display_name": "blonc", "link": "https://stackoverflow.com/users/9464830/blonc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "accepted_answer_id": 50260202, "answer_count": 2, "score": 1, "last_activity_date": 1538340590, "creation_date": 1525889772, "question_id": 50259732, "link": "https://stackoverflow.com/questions/50259732/nats-client-in-golang-wont-subscribe", "title": "NATS Client in GoLang wont subscribe", "body": "<p>I have a very generic connection scrip to connect a nats server and just blindly print the message to the command line.</p>\n\n<pre><code>package main\nimport (\n    \"github.com/nats-io/go-nats\"\n    \"fmt\"\n)\n\n\nfunc main(){\n\n    servers := \"nats://URL:30401, nats://URL:30402, nats://URL:30403\"\n    nc, _ := nats.Connect(servers, nats.Token(\"TOKEN_KEY\"))\n\n    // Subscribe to AAPL trades\n    nc.Subscribe(\"T.AAPL\", func(m *nats.Msg){\n        fmt.Printf(\"[TRADE] Received: %s\\n\", string(m.Data))\n    })\n\n}\n</code></pre>\n\n<p>it builds fine and runs with out error, but wont actually subscribe.  is the <code>fmt.Printf</code> the proper way to have the message print to terminal?  or is there a bigger issue at hand here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525887717, "post_id": 50259154, "comment_id": 87536225, "body": "It is different every time, unless <code>time.Now()</code> is the same every time you run it."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1525887744, "post_id": 50259154, "comment_id": 87536241, "body": "<a href=\"https://stackoverflow.com/a/33994791/594589\">stackoverflow.com/a/33994791/594589</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525888347, "post_id": 50259154, "comment_id": 87536588, "body": "Note that running this multiple times within a second will produce the same results, since <code>time.Now().Unix()</code> is measured in whole seconds. If you want a more fine grained timestamp, use <code>UnixNano()</code>"}, {"owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525888457, "post_id": 50259154, "comment_id": 87536638, "body": "@JimB in my computer return 09 09 09, ---- 01 01 01"}, {"owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525888530, "post_id": 50259154, "comment_id": 87536675, "body": "@JimB with .UnixNano() i have same problem, return same number for all 3 random try"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525888770, "post_id": 50259154, "comment_id": 87536783, "body": "@StefanoConte: that&#39;s different than what you state in the question, where it&#39;s 3 different indexes, but the same result on subsequent runs. Which is it? 09, 09, 09 is unlikely, but still possible. Is that the exact code you&#39;re executing?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1525894393, "post_id": 50259154, "comment_id": 87539605, "body": "If you want 3 random <i>distinct</i> elements, you should look at <a href=\"https://golang.org/pkg/math/rand/#Shuffle\" rel=\"nofollow noreferrer\">rand.Shuffle</a> and/or <a href=\"https://golang.org/pkg/math/rand/#Perm\" rel=\"nofollow noreferrer\">rand.Perm</a>."}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": false, "score": 0, "last_activity_date": 1525959216, "creation_date": 1525959216, "answer_id": 50274174, "question_id": 50259154, "link": "https://stackoverflow.com/questions/50259154/multiple-random-element-from-list-in-same-time/50274174#50274174", "title": "multiple random element from list in same time", "body": "<p>To get a unique answer all you have to do is remove the existing answer from the slice. I have knocked something together which does that using a function. There are more efficient ways to do it, but this is simple to see what is happening.</p>\n\n<pre><code>func main() {\n    rand.Seed(time.Now().Unix())\n    reasons := []string{\n        \"01\", \"02\", \"03\", \"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10\",\n    }\n\n    n, reasons := getRandom(reasons)\n    n1, reasons := getRandom(reasons)\n    n2, reasons := getRandom(reasons)\n    fmt.Println(\"\", n)\n    fmt.Println(\"\", n1)\n    fmt.Println(\"\", n2)\n}\n\nfunc getRandom(reasons []string) (string, []string) {\n    n := rand.Int() % len(reasons)\n    switch n {\n    case 0:\n        return reasons[0], reasons[1:]\n    case len(reasons) - 1:\n        return reasons[n], reasons[:n]\n    }\n    newSlice := []string{}\n    for i, item := range reasons {\n        if i != n {\n            newSlice = append(newSlice, item)\n        }\n    }\n    return reasons[n], newSlice\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525959216, "creation_date": 1525887570, "last_edit_date": 1525887794, "question_id": 50259154, "link": "https://stackoverflow.com/questions/50259154/multiple-random-element-from-list-in-same-time", "title": "multiple random element from list in same time", "body": "<p>I want to get multiple random elements from list in same time, but need to be real random not every time same elements.</p>\n\n<p>Second problem is : i want to get uniq element from the list, example if i get 08, this code need to be removed from list and get net random exclude 08 string.</p>\n\n<p>this is my actual code :</p>\n\n<pre><code>    package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    // Won't work on the Playground since the time is frozen.\n    rand.Seed(time.Now().Unix())\n    reasons := []string{\n        \"01\",\"02\",\"03\",\"04\", \"05\", \"06\", \"07\", \"08\", \"09\", \"10\",\n    }\n    n := rand.Int() % len(reasons)\n    n1 := rand.Int() % len(reasons)\n    n2 := rand.Int() % len(reasons)\n    fmt.Println(\"\", reasons[n])\n    fmt.Println(\"\", reasons[n1])\n    fmt.Println(\"\", reasons[n2])\n}\n</code></pre>\n\n<p>my output is this :</p>\n\n<pre><code> 07\n 02\n 06\n</code></pre>\n\n<p>every time return me same output, i want to be random and unique</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1525887318, "post_id": 50258955, "comment_id": 87536034, "body": "You&#39;re not exiting the shell or closing the connection, why do you expect <code>stdout.Read</code> to return?"}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525887780, "post_id": 50258955, "comment_id": 87536270, "body": "When I ran it against my freeNAS machine it reads from it twice then the third time it locks. I expect it to return because it worked twice prior."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525888035, "post_id": 50258955, "comment_id": 87536414, "body": "If there&#39;s no data, <code>Read</code> needs to block until there&#39;s something to read. That&#39;s how any <code>io.Reader</code> typically works."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525888213, "post_id": 50258955, "comment_id": 87536513, "body": "Okay, I figured it was something like that. Is there a way to check if it is blocked?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525888273, "post_id": 50258955, "comment_id": 87536541, "body": "No, you just block until it returns. What is the problem you&#39;re trying to solve?"}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525890187, "post_id": 50258955, "comment_id": 87537478, "body": "I&#39;m trying to use go&#39;s SSH package to interact with a switch. I am able to log in, send commands, and read output. I have a function that checks for the prompt in the return data before moving on. I have run into a situation where the prompt isn&#39;t seen so I check stdout again to see if there is more data. If there is data in the buffer great, it comes back and I do my check again. If it&#39;s empty it freezes and as far as I know there is no way to tell the buffer is empty."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525891343, "post_id": 50258955, "comment_id": 87538091, "body": "How are you missing the prompt? It seems that if you never get back to a prompt when you expect there to be one, something has gone wrong and you&#39;re not in an expected state, so you should abort."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525891770, "post_id": 50258955, "comment_id": 87538315, "body": "I don&#39;t disagree, but the problem I&#39;m having is I don&#39;t know when to abort as I don&#39;t know if I&#39;ve exhausted stdout."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525892113, "post_id": 50258955, "comment_id": 87538505, "body": "I assume the expectation is that you always get back to a prompt after a command. If the command never returns, then you timeout and close the connection. There is never a way to know if you&#39;ve exhausted stdout, because you never will -- it&#39;s an interactive shell that continues until you exit. The only way to can detect a &quot;break&quot; in the output stream, is to detect the same command prompt that you would use for visual indication when running the shell interactively."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525893482, "post_id": 50258955, "comment_id": 87539147, "body": "Is there a better/different way to accomplish this? This method worked with telnet reading/writing to the socket."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525893945, "post_id": 50258955, "comment_id": 87539374, "body": "Not really if the switch limits you to an interactive shell which isn&#39;t intended for scripted access. How did it work in telnet? Reading and writing to a socket has the same implications as through an ssh session (though you do have the benefit of setting deadlines on the individual calls). There&#39;s no reason you can&#39;t make it work -- you need to figure out why you&#39;re not getting to a prompt when you expect, and have some mechanism for timing out."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525894088, "post_id": 50258955, "comment_id": 87539455, "body": "With telnet when I read from the socket, if there is nothing there it returns with n = 0 so I know that there was nothing new. With ssh it never returns so I don&#39;t know if there is data to read."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525894335, "post_id": 50258955, "comment_id": 87539583, "body": "What package is that with? A reader should not return <code>n == 0</code> without an error. It&#39;s not strictly forbidden, but it&#39;s not something that should be relied on, and if it did that in subsequent calls it would cause a busy loop over the Read call."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525894432, "post_id": 50258955, "comment_id": 87539626, "body": "It uses the net package. I use the net.Conn to read/write from the socket."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525894829, "post_id": 50258955, "comment_id": 87539803, "body": "reading from a <code>net.Conn</code> only returns <code>n == 0</code> with an <code>io.EOF</code>. You should <i>always</i> be checking your errors. It seems the telnet server was closing the connection for some reason at that point. that doesn&#39;t change the statements I made above, you need to find the end of the output by reading the output (maybe the prompt changes in some situations?), and you need a way to timeout."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525896834, "post_id": 50258955, "comment_id": 87540744, "body": "It seems odd that locks indefinitely. Is there a timeout or something like that I can set for the read?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525897115, "post_id": 50258955, "comment_id": 87540843, "body": "Reads are blocking, so I don&#39;t know why that seems odd. There nothing stopping you from timing out on your own, either closing the session, or the entire connection if you wish."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525897445, "post_id": 50258955, "comment_id": 87540989, "body": "I am admittedly new to Go, but I&#39;m not sure how I can stop when the read function never returns. So even if I had a timer or something going I would never get to the code to check it.  Is there some Go functionality that I don&#39;t know of that allows this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525897785, "post_id": 50258955, "comment_id": 87541142, "body": "&quot;goroutines&quot; are pretty fundamental to the language, you can&#39;t really work without them, so I would investigate that ASAP. That said, a simple timer setup with <code>time.AfterFunc</code> handles this easily and even hides the goroutine from you."}], "owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525886753, "creation_date": 1525886753, "question_id": 50258955, "link": "https://stackoverflow.com/questions/50258955/read-from-stdout-never-returns-golang", "title": "Read from stdout never returns golang", "body": "<p>I am trying to read from the stdoutpipe of an SSH connection. I am able to read it when there is data in the buffer, but when I try to read later after it's empty the read hangs.</p>\n\n<p>Is there a way I can check if there is data in the buffer before reading it? or is something else going on here entirely?</p>\n\n<p>I made a quick example to show what I'm seeing.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc main() {\n    var user = \"&lt;user&gt;\"\n    var passwd = \"&lt;password&gt;\"\n    var ip = \"&lt;ip&gt;\"\n\n    sshConfig := &amp;ssh.ClientConfig{\n        User:            user,\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n        Auth: []ssh.AuthMethod{\n            ssh.Password(passwd),\n        },\n    }\n\n    var conn, _ = ssh.Dial(\"tcp\", ip + \":22\", sshConfig)\n\n    var sess, _ = conn.NewSession()\n\n    var stdin, _ = sess.StdinPipe()\n    var stdout, _ = sess.StdoutPipe()\n    sess.Shell()\n\n    stdin.Write([]byte(\"ls\\n\"))\n\n    var numBytes = 1\n    var readCount = 0\n\n    for numBytes &gt; 0 {\n        fmt.Println(\"Read count: \" + strconv.Itoa(readCount))\n        var recvData = make([]byte, 1024)\n        numBytes, _ = stdout.Read(recvData)\n        fmt.Println(string(recvData[:numBytes]))\n        readCount++\n    }\n}\n</code></pre>\n\n<p>You'll need to update the user, passwd, and ip vars, but after that you should see the program freeze after stdout is empty.</p>\n"}, {"tags": ["sqlite", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 392974, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45613a9be1f81519a0f62541006f4884?s=128&d=identicon&r=PG", "display_name": "tiagodll", "link": "https://stackoverflow.com/users/392974/tiagodll"}, "edited": false, "score": 0, "creation_date": 1525903440, "post_id": 50260882, "comment_id": 87543422, "body": "this is so weird, I ran the CreateTable, and it sets as datetime   and somehow it works (even though it is not a valid sqlite data type)  thank you (Y)"}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 3, "last_activity_date": 1525894744, "creation_date": 1525894744, "answer_id": 50260882, "question_id": 50258820, "link": "https://stackoverflow.com/questions/50258820/time-column-in-sqlite-using-gorm/50260882#50260882", "title": "time column in sqlite using gorm", "body": "<p>I am not familiar with gorm, but should not the definition of timestamp of type <code>datetime</code> instead of <code>text</code>? Also: when you tag <code>gorm:\"time\"</code> the column name should be <code>time</code> and not <code>timestamp</code>, or the tag <code>gorm:\"timestamp\"</code>. But you can leave out the gorm tag.</p>\n\n<p>To make it simple, you can let gorm create the table:</p>\n\n<pre><code>db, err := gorm.Open(\"sqlite3\", \"test.db\")\ndb.CreateTable(&amp;Timeline{})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1986, "user_id": 422131, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1d46192872b1cab3ef46da47bdd56e12?s=128&d=identicon&r=PG", "display_name": "CppNoob", "link": "https://stackoverflow.com/users/422131/cppnoob"}, "is_accepted": false, "score": 3, "last_activity_date": 1535998932, "creation_date": 1535998932, "answer_id": 52154656, "question_id": 50258820, "link": "https://stackoverflow.com/questions/50258820/time-column-in-sqlite-using-gorm/52154656#52154656", "title": "time column in sqlite using gorm", "body": "<p>Using this would take care of it:</p>\n\n<pre><code>type Timeline struct {\n    ID        string     `json:\"id\"`\n    Timestamp *time.Time `json:\"timestamp\" gorm:\"type:datetime\"`\n}\n</code></pre>\n\n<p>You could even change the declared type of the <code>Timestamp</code> field to something else, say <code>int64</code> to represent Unix times. Then you could write a Scanner to read the datetime field into the int64 field.</p>\n\n<pre><code>type TimeStampUnix int64\ntype Timeline struct {\n    ID        string        `json:\"id\"`\n    TimeStamp TimeStampUnix `json:\"timestamp\" gorm:\"type:datetime\"`\n}\n\nfunc (t *TimeStampUnix) Scan(src interface{}) error {\n    switch src.(type) {\n    case time.Time:\n        *t = TimeStampUnix(src.(time.Time).Unix())\n        return nil\n    case []byte:\n        // bonus code to read text field of format '2014-12-31 14:21:01-0400'\n        //\n        str := string(src.([]byte))\n        var y, m, d, hr, min, s, tzh, tzm int\n        var sign rune\n        _, e := fmt.Sscanf(str, \"%d-%d-%d %d:%d:%d%c%d:%d\",\n            &amp;y, &amp;m, &amp;d, &amp;hr, &amp;min, &amp;s, &amp;sign, &amp;tzh, &amp;tzm)\n        if e != nil {\n            return e\n        }\n\n        offset := 60 * (tzh*60 + tzm)\n        if sign == '-' {\n            offset = -1 * offset\n        }\n\n        loc := time.FixedZone(\"local-tz\", offset)\n        t1 := time.Date(y, time.Month(m), d, hr, min, s, 0, loc)\n        *t = TimeStampUnix(t1.Unix())\n        return nil\n    default:\n        return fmt.Errorf(\"Value '%s' of incompatible type '%T' found\", string(src.([]byte)), src)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 392974, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45613a9be1f81519a0f62541006f4884?s=128&d=identicon&r=PG", "display_name": "tiagodll", "link": "https://stackoverflow.com/users/392974/tiagodll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2673, "favorite_count": 1, "accepted_answer_id": 50260882, "answer_count": 2, "score": 2, "last_activity_date": 1535998932, "creation_date": 1525886242, "last_edit_date": 1527756345, "question_id": 50258820, "link": "https://stackoverflow.com/questions/50258820/time-column-in-sqlite-using-gorm", "title": "time column in sqlite using gorm", "body": "<p>I am trying to query objects from sqlite but getting this error because of the type time:</p>\n\n<pre><code>(sql: Scan error on column index 1: unsupported Scan, storing driver.Value type []uint8 into type *time.Time)\n</code></pre>\n\n<p>my struct is:</p>\n\n<pre><code>type Timeline struct {\nID        string     `json:\"id\"`\nTimestamp *time.Time `json:\"timestamp\"`\n</code></pre>\n\n<p>and my database is like this:</p>\n\n<pre><code>CREATE TABLE timelines (id text, timestamp text, ...\n</code></pre>\n\n<p>and one of the sample rows is:</p>\n\n<pre><code>('Locked in VR', '2018-03-17 10:50:59.548+01:00',...\n</code></pre>\n\n<p>any ideas?\nshould I have something in the struct like?</p>\n\n<pre><code>Timestamp *time.Time `json:\"timestamp\" gorm:\"time\"`\n</code></pre>\n"}, {"tags": ["go", "file-permissions"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 8, "creation_date": 1525883369, "post_id": 50257981, "comment_id": 87534010, "body": "This is unrelated to Go or <code>ioutil.WriteFile</code> specifically: see <a href=\"https://en.wikipedia.org/wiki/Umask\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Umask</a>"}, {"owner": {"reputation": 8322, "user_id": 465738, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tSedM.jpg?s=128&g=1", "display_name": "Edson Medina", "link": "https://stackoverflow.com/users/465738/edson-medina"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525968141, "post_id": 50257981, "comment_id": 87570553, "body": "@JimB If you write that as an answer I&#39;ll mark it as the chosen answer."}], "answers": [{"tags": [], "owner": {"reputation": 605, "user_id": 4156975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c000f292a92b894afabbb352e8709667?s=128&d=identicon&r=PG", "display_name": "Toshinori Sugita", "link": "https://stackoverflow.com/users/4156975/toshinori-sugita"}, "is_accepted": false, "score": 1, "last_activity_date": 1576915124, "last_edit_date": 1576915124, "creation_date": 1576914379, "answer_id": 59434424, "question_id": 50257981, "link": "https://stackoverflow.com/questions/50257981/ioutils-writefile-not-respecting-permissions/59434424#59434424", "title": "ioutils.WriteFile() not respecting permissions", "body": "<p>As the comment on this question says, this is because <a href=\"https://en.wikipedia.org/wiki/Umask\" rel=\"nofollow noreferrer\">umask</a> worked. unmask controls how file permissions are set for newly created files. When umask is 022, a file you want to create as 666 will be 644 (removes a write permission from group and other permissions). You can check your directory's umask with <code>umask</code> command.</p>\n"}], "owner": {"reputation": 8322, "user_id": 465738, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tSedM.jpg?s=128&g=1", "display_name": "Edson Medina", "link": "https://stackoverflow.com/users/465738/edson-medina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3516, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1576915124, "creation_date": 1525882985, "question_id": 50257981, "link": "https://stackoverflow.com/questions/50257981/ioutils-writefile-not-respecting-permissions", "title": "ioutils.WriteFile() not respecting permissions", "body": "<p>I'm trying to use ioutils.WriteFile() but for some reason it's ignoring the 0777 permissions I'm giving it.</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n\n    // normal permissions\n    if err := ioutil.WriteFile(\"cant-touch-this-0644\", []byte{}, 0644); err != nil {\n            panic(err)\n    }\n\n\n    // full permissions\n    if err := ioutil.WriteFile(\"cant-touch-this-0777\", []byte{}, 0777); err != nil {\n            panic(err)\n    }\n\n\n    // normal permissions + chmod to full\n    if err := ioutil.WriteFile(\"cant-touch-this-mixed\", []byte{}, 0755); err != nil {\n            panic(err)\n    }\n\n    if err := os.Chmod(\"cant-touch-this-mixed\", 0777); err != nil {\n            panic(err)\n    }\n}\n</code></pre>\n\n<p>The output I get from this is:</p>\n\n<pre><code>$ ls -l\n-rw-r--r--  1 edson edson    0 May  9 17:19  cant-touch-this-0644\n-rwxr-xr-x  1 edson edson    0 May  9 17:19  cant-touch-this-0777\n-rwxrwxrwx  1 edson edson    0 May  9 17:19  cant-touch-this-mixed\n</code></pre>\n\n<p>Which means:</p>\n\n<ul>\n<li>The first scenario (0644) worked</li>\n<li>The second (0777) was ignored</li>\n<li>The only way I can get full 0777 permissions is by using a <code>os.Chmod</code> (like in the third scenario)</li>\n</ul>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go", "protocol-buffers-3"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1525880436, "post_id": 50256916, "comment_id": 87532308, "body": "See <a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a>. You may only pass a slice value of type <code>[]proto.Message</code> to <code>TransformArray</code>. You cannot pass slice value whose element type implements <code>proto.Message</code> (but is not <code>proto.Message</code>)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525881021, "post_id": 50256916, "comment_id": 87532684, "body": "Your code appears to be incomplete. The error message does not appear to correspond to any included code, as none of the code you have included attempts to call <code>TransformArray</code>."}], "owner": {"reputation": 659, "user_id": 4064365, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/e368a21c4727abdbfffb71bf734e04b0?s=128&d=identicon&r=PG&f=1", "display_name": "andthereitgoes", "link": "https://stackoverflow.com/users/4064365/andthereitgoes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1407, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525881256, "creation_date": 1525879365, "last_edit_date": 1525881256, "question_id": 50256916, "link": "https://stackoverflow.com/questions/50256916/how-to-use-proto-message-type-in-a-function", "title": "How to use proto.Message type in a function?", "body": "<p>I am using golang and protocolbuffers. I have two proto messages where one imports the other. I would like to do some processing using <code>proto.Message</code> type but I get an error. </p>\n\n<p>This is <code>foo.proto</code></p>\n\n<pre><code>syntax = \"proto3\";\npackage foo;\n\nmessage Page {\n    string id = 1;\n    string title = 2;\n}\n</code></pre>\n\n<p>This is <code>bar.proto</code> where I am importing <code>foo.proto</code></p>\n\n<pre><code>syntax = \"proto3\";\npackage bar;\n\nimport \"foo.proto\";\n\nmessage Book {\n    string id = 1;\n    string title = 2;\n    repeated foo.Page pages = 3;\n}\n</code></pre>\n\n<p>I am using the following function to process <code>Book</code>. I want to keep it generic as my usecase requires to transform other proto messages as well.</p>\n\n<pre><code>func TransformArray (arrObj []proto.Message) {\n    if len(proto) &gt; 0 &amp;&amp; !reflect.ValueOf(proto[0]).IsNil() {\n        ...\n    } \n}\n</code></pre>\n\n<p>When I use the above function in my go file as follows</p>\n\n<pre><code>package main\n\nimport (\n    book_proto \"book\"\n)\n\nfunc main() {\n    book = *book_proto.Book{Pages: ... }\n    TransformArray(book.Pages)\n}\n</code></pre>\n\n<p>I get a syntax error as follows</p>\n\n<pre><code>cannot use book.Pages (type []*\"foo\".Page) as type []proto.Message in argument to TransformArray \n</code></pre>\n\n<p>What am I doing wrong? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1662, "user_id": 786821, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f73f56fed713342efd1038eba8b1f05e?s=128&d=identicon&r=PG", "display_name": "SunSparc", "link": "https://stackoverflow.com/users/786821/sunsparc"}, "edited": false, "score": 0, "creation_date": 1525899374, "post_id": 50255087, "comment_id": 87541945, "body": "The use of reflection is, in my mind, and indication of an opportunity to re-evaluate my design. Perhaps there is a better way to achieve your end goal."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1525875290, "last_edit_date": 1525875290, "creation_date": 1525874493, "answer_id": 50255353, "question_id": 50255087, "link": "https://stackoverflow.com/questions/50255087/modify-struct-value-given-map-of-field-names-and-values/50255353#50255353", "title": "Modify struct value given map of field names and values", "body": "<p>Here's a function that updates string fields by name:</p>\n\n<pre><code>func update(v interface{}, updates map[string]string) {\n    rv := reflect.ValueOf(v).Elem()\n    for key, val := range updates {\n        fv := rv.FieldByName(key)\n        fv.SetString(val)\n    }\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>updates := map[string]string{\"Family\": \"yamie\"}\nsample := TableFields{\n    Name:   \"bill\",\n    Family: \"yami\",\n    Age:    25,\n}\nupdate(&amp;sample, updates)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wEZ1AwMhqkO\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>Some notes about the function:</p>\n\n<ul>\n<li>The <code>update</code> function expects a pointer value so it can update the original value.</li>\n<li>The function will panic if the field is not found or the field is not a string type.  Depending on how the function is used, it may be helpful to add checks for <code>fv.IsValid()</code> and <code>fv.Kind() == reflect.String</code>.</li>\n</ul>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1104, "favorite_count": 0, "accepted_answer_id": 50255353, "answer_count": 1, "score": 0, "last_activity_date": 1525925793, "creation_date": 1525873806, "last_edit_date": 1525925793, "question_id": 50255087, "link": "https://stackoverflow.com/questions/50255087/modify-struct-value-given-map-of-field-names-and-values", "title": "Modify struct value given map of field names and values", "body": "<p>This is my struct:</p>\n\n<pre><code>type TableFields struct {\n    Name   string\n    Family string\n    Age    int\n}\n\nsample := TableFields{\n    Name:   \"bill\",\n    Family: \"yami\",\n    Age:    25,\n}\n</code></pre>\n\n<p>This is a very simple sample that I am using to describe my problem.</p>\n\n<p>I want to change values in the <code>sample</code> struct using keys and values in a <code>map</code> that I receive. Each time I receive the <code>map</code> the keys and values will be different. How can I use the <code>map</code> to edit the <code>sample</code> struct?</p>\n\n<p>For example:</p>\n\n<pre><code>updateTheseFieldsWithTheseVals := make(map[string]string)\nupdateTheseFieldsWithTheseVals[\"family\"] = \"yamie\"\n// this is my way\nfor key,val := range updateTheseFieldsWithTheseVals {\n    // sample.Family=yamie works, but is not the answer I am looking for\n    // sample.key = val  *This solution is not possible*\n    oldValue := reflect.Indirect(reflect.ValueOf(get)).FieldByName(key).String()\n    fmt.Println(oldValue) // result is yami\n\n    oldValue = val\n    fmt.Println(oldValue) //result is yamie\n}\nfmt.Println(updateTheseFieldsWithTheseVals)\n// result :\n// {bill yami 25}\n</code></pre>\n\n<p>This runs but does not change the values in <code>sample</code>.</p>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525870068, "post_id": 50253605, "comment_id": 87524858, "body": "Not sure offhand, but you can see exactly how every build command is run with the <code>-x</code> flag."}, {"owner": {"reputation": 903, "user_id": 1328968, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/XZafu.jpg?s=128&g=1", "display_name": "nilleb", "link": "https://stackoverflow.com/users/1328968/nilleb"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525939505, "post_id": 50253605, "comment_id": 87554216, "body": "thanks JimB, now I have a clearer view of the command being issued (and potentially I can change it -- since it is one of the latest being issued). It would be interesting to know how the command is being assembled...  ``` clang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -fno-common -o $WORK/b001/_cgo_.o $WORK/b001/_cgo_main.o $WORK/b001/_x001.o $WORK/b001/_x002.o $WORK/b001/_x003.o -g -O2 -L/usr/local/opt/python@2/Frameworks/Python.framework/Versio&zwnj;&#8203;ns/2.7/lib -lpython2.7 ```"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525958905, "post_id": 50253605, "comment_id": 87564820, "body": "That package is using pkg-config to specifically find python-2.7"}], "owner": {"reputation": 903, "user_id": 1328968, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/XZafu.jpg?s=128&g=1", "display_name": "nilleb", "link": "https://stackoverflow.com/users/1328968/nilleb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525869373, "creation_date": 1525869373, "question_id": 50253605, "link": "https://stackoverflow.com/questions/50253605/how-does-the-golang-cgo-linker-work-on-macos", "title": "How does the golang cgo linker work on macos?", "body": "<p>On some systems, the project <a href=\"https://github.com/nilleb/fsevents-watcher\" rel=\"nofollow noreferrer\">https://github.com/nilleb/fsevents-watcher</a>\nproduces a <code>fsevents_watcher.so</code> linked to the HomeBrew python. While on other systems it is linked to the system Python.</p>\n\n<p>Which environment variables/configuration elements influence the cgo linker on MacOSX?</p>\n\n<p>I am asking this question for a user who has the homebrew python as the first in his $PATH, but obtains a <code>.so</code> linked against the system python.</p>\n"}, {"tags": ["go", "networking", "tcp"], "answers": [{"comments": [{"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525864065, "post_id": 50251802, "comment_id": 87520794, "body": "Thanks. Let me provide more details. The endpoint I am dialing to is running mysql server. And I can successfully connect to it with command line. The endpoint is host in a NAS."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 1, "creation_date": 1525864374, "post_id": 50251802, "comment_id": 87520988, "body": "@MortyChoi: What is working command line you use to connect to the server? Are you sure that you are using the same port when connecting to it on the command line, since mysql usually uses port  3306 and not 3000. 3000 is instead typically used for some web servers which should only be accessible on the local machine because there is some real web server in front of these which just proxies the requests."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525864798, "post_id": 50251802, "comment_id": 87521319, "body": "I am using <code>mysql -u username -h host -p</code> to connect to the server. For the port I just customised it to use 3000."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865363, "post_id": 50251802, "comment_id": 87521706, "body": "@MortyChoi: I don&#39;t see you specifying a port. Option &#39;-p&#39; sets the password, option &#39;-P&#39; instead sets the port."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865503, "post_id": 50251802, "comment_id": 87521806, "body": "Ya I am using <code>mysql -u username -h host -P port -p</code>. Sorry for not double checking before commenting."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865742, "post_id": 50251802, "comment_id": 87521972, "body": "@MortyChoi: if you are using the mysql command and the go program both from the same machine to the same machine and port and one works while the other not then something is really strange. I recommend to make a packet capture (wireshark, tcpdump or similar) for both connections to see the difference."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865805, "post_id": 50251802, "comment_id": 87522016, "body": "Will there be any chance that the golang tcp implementation has bug?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865858, "post_id": 50251802, "comment_id": 87522052, "body": "@MortyChoi: very very unlikely since this code is used heavily. It is more likely that you think that you connect to port 3000 from the same machine with mysql but actually did not."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 0, "creation_date": 1525865929, "post_id": 50251802, "comment_id": 87522118, "body": "Okay I will further investigte."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 2, "last_activity_date": 1525865788, "last_edit_date": 1525865788, "creation_date": 1525863730, "answer_id": 50251802, "question_id": 50251495, "link": "https://stackoverflow.com/questions/50251495/golang-tcp-dial-error-host-is-down/50251802#50251802", "title": "Golang TCP dial error: host is down", "body": "<p>The error message means that no TCP connection can not be created to the given IP address at the given port. Your check with ping does not help much since ping does use ICMP to reach the host contrary to your use of TCP. A successful ping just means that the host is reachable in general but not that a TCP connection to the host on the given port will succeed. It might even be that such a connection succeeds but ping fails since it is blocked by a firewall rule.</p>\n\n<p>Typical causes for the problem you see are:</p>\n\n<ul>\n<li>You've used the wrong target IP and/or port.</li>\n<li>There is no application listening at this port at the target machine at all, i.e. maybe you forgot to start the server or it crashed or it was configured wrongly. </li>\n<li>The application is only listening on localhost and is thus not reachable from outside the machine.</li>\n<li>Firewall rules either at the server machine or between client and server block access.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "is_accepted": true, "score": 3, "last_activity_date": 1526023010, "last_edit_date": 1526023010, "creation_date": 1526022139, "answer_id": 50286787, "question_id": 50251495, "link": "https://stackoverflow.com/questions/50251495/golang-tcp-dial-error-host-is-down/50286787#50286787", "title": "Golang TCP dial error: host is down", "body": "<p>I have found out why. This is because of firewall settings. This situation is caused by using Little Snitch which will check executable has valid code signature or not. If the executable does not have valid code signature, the request is filtered and Little Snitch will return error number 64 which mean host is down in Mac.</p>\n"}], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1206, "favorite_count": 0, "accepted_answer_id": 50286787, "answer_count": 2, "score": 1, "last_activity_date": 1526023010, "creation_date": 1525862728, "last_edit_date": 1525868711, "question_id": 50251495, "link": "https://stackoverflow.com/questions/50251495/golang-tcp-dial-error-host-is-down", "title": "Golang TCP dial error: host is down", "body": "<pre><code>net.Dial(\"tcp\", \"192.168.1.100:3000\")\n</code></pre>\n\n<p>The above call give me <code>dial tcp 192.168.1.100:3000: connect: host is down</code>. </p>\n\n<p>I can successfully ping the endpoint. I wonder what will be the cause of this error. What will be the possible causes of <code>host is down</code>?</p>\n\n<p>Let me provide more details. The endpoint I am dialing to is running mysql server. And I can successfully connect to it with command line. The endpoint is host in a NAS.</p>\n\n<p>Further investigation, I believe the error message is from <a href=\"https://github.com/golang/go/blob/60e3ebb9cba900f7b2f559b472726cee47e823c0/src/net/fd_unix.go#L94\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/60e3ebb9cba900f7b2f559b472726cee47e823c0/src/net/fd_unix.go#L94</a></p>\n"}, {"tags": ["go", "apache-kafka", "sarama"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5769668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BaUe3.jpg?s=128&g=1", "display_name": "Muhammad Sohaib", "link": "https://stackoverflow.com/users/5769668/muhammad-sohaib"}, "edited": false, "score": 0, "creation_date": 1525869109, "post_id": 50252380, "comment_id": 87524141, "body": "I did this step too but it gives me a &quot;panic kafka, partitioner returns an invalid partition index&quot;"}, {"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "reply_to_user": {"reputation": 11, "user_id": 5769668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BaUe3.jpg?s=128&g=1", "display_name": "Muhammad Sohaib", "link": "https://stackoverflow.com/users/5769668/muhammad-sohaib"}, "edited": false, "score": 0, "creation_date": 1525869224, "post_id": 50252380, "comment_id": 87524216, "body": "Partitions are zero based as I recall, 12 partitions being 0-11, I&#39;d have to double check the documentation again - you mentioned 12 partitions in the question, so set it to partition 11 for a quick retest"}, {"owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "edited": false, "score": 0, "creation_date": 1614593668, "post_id": 50252380, "comment_id": 117422957, "body": "This is the latest link : <a href=\"https://pkg.go.dev/github.com/Shopify/sarama#example-Partitioner-Manual\" rel=\"nofollow noreferrer\">pkg.go.dev/github.com/Shopify/sarama#example-Partitioner-Man&zwnj;&#8203;ual</a>"}], "tags": [], "owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "is_accepted": false, "score": 3, "last_activity_date": 1525865663, "creation_date": 1525865663, "answer_id": 50252380, "question_id": 50251277, "link": "https://stackoverflow.com/questions/50251277/i-always-get-0-partitions-when-i-call-sendmessagemsg-i-am-specifying-12-via-c/50252380#50252380", "title": "I always get 0 partitions when I call SendMessage(msg). I am specifying 12 via command line", "body": "<p>You have not specified the <code>ManualPartitioner</code> in your config, so it will be using the default instead of obeying what you have told it in the partition field.</p>\n\n<p>Add to your config</p>\n\n<pre><code>config.Producer.Partitioner = NewManualPartitioner \n</code></pre>\n\n<p>Your partition value should now be obeyed</p>\n\n<p>(Docs : <a href=\"https://godoc.org/github.com/Shopify/sarama#example-Partitioner--Manual\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/Shopify/sarama#example-Partitioner--Manual</a>)</p>\n"}], "owner": {"reputation": 11, "user_id": 5769668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BaUe3.jpg?s=128&g=1", "display_name": "Muhammad Sohaib", "link": "https://stackoverflow.com/users/5769668/muhammad-sohaib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1525869598, "creation_date": 1525862068, "last_edit_date": 1525866096, "question_id": 50251277, "link": "https://stackoverflow.com/questions/50251277/i-always-get-0-partitions-when-i-call-sendmessagemsg-i-am-specifying-12-via-c", "title": "I always get 0 partitions when I call SendMessage(msg). I am specifying 12 via command line", "body": "<h2>What configuration values are you using for Sarama and Kafka?</h2>\n\n<p>Kafka Version: kafka_2.12-1.1.0.tgz\nGo Version: 1.9.1</p>\n\n<pre><code>package kafka\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    \"github.com/Shopify/sarama\"\n)\n\nvar partition = flag.Int(\"partition\", 12, \"The partition to produce to.\")\n\nfunc Start_producer(payload []byte) {\n    flag.Parse()\n    s := \"mydata\"\n    topic := &amp;s\n    // brokers := &amp;[]string{\"172.25.33.175:9092,172.25.33.176:9092,172.25.33.177:9092\"}\n    // brokers := []string{\"172.25.33.175:9092,172.25.33.176:9092,172.25.33.177:9092\"}\n\n    config := sarama.NewConfig()\n    config.Producer.RequiredAcks = sarama.WaitForAll\n    config.Producer.Retry.Max = 5\n    config.Producer.Return.Successes = true\n    producer, err := sarama.NewSyncProducer(strings.Split(\"172.25.33.175:9092,172.25.33.176:9092,172.25.33.177:9092\", \",\"), config) //default port\n\n    if err != nil {\n        log.Println(\"ERRR\")\n        panic(err)\n    }\n    defer func() {\n        if err := producer.Close(); err != nil {\n            panic(err)\n        }\n    }()\n    msg := &amp;sarama.ProducerMessage{\n        Topic:     *topic,\n        Value:     sarama.StringEncoder(payload),\n        Partition: int32(*partition),\n    }\n    fmt.Println(\"XXXX: \", msg.Partition)\n    partition, offset, err := producer.SendMessage(msg)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println()\n    fmt.Printf(\"Message is stored in topic(%s)/partition(%d)/offset(%d)\\n\", *topic, partition, offset)\n    fmt.Println(\"--------------------------------------------------\")\n    fmt.Println(partition)\n\n}\n</code></pre>\n\n<h2>Problem Description</h2>\n\n<p>I am trying to send a stream of messages on to my Kafka broker, I have 3 nodes as specified and I want the messages to be in 12 partitions, but when I call the SendMessage(msg) it returns 0 partitions. Why is that? Why can I not send my messages in partitions?</p>\n"}, {"tags": ["string", "mongodb", "go", "bson", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "edited": false, "score": 0, "creation_date": 1525873738, "post_id": 50254525, "comment_id": 87527578, "body": "please the <code>oneEntry</code> is for what?? i didn&#39; t understand"}, {"owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "reply_to_user": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "edited": false, "score": 0, "creation_date": 1525876244, "post_id": 50254525, "comment_id": 87529400, "body": "Now fixed, my mistake, the StackOverflow linter wasn&#39;t working properly, or at all."}], "tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": true, "score": 0, "last_activity_date": 1525876187, "last_edit_date": 1525876187, "creation_date": 1525872198, "answer_id": 50254525, "question_id": 50250351, "link": "https://stackoverflow.com/questions/50250351/insert-a-mgo-query-m-bson-result-into-a-file-txt-as-a-string/50254525#50254525", "title": "Insert a mgo query []M.bson result into a file.txt as a string", "body": "<p>You could declare a simple struct eg</p>\n\n<pre><code>simple struct {\n  ID    idtype `bson:\"_id\"`\n  Image int    `bson:\"images\"`\n}\n</code></pre>\n\n<p>The function to put the image ids into the file would be</p>\n\n<pre><code>open file stuff\u2026\n\nresult := simple{}\niter := collection.Find(nil).Iter()\nfor iter.Next(&amp;result){\n file.WriteString(fmt.Sprintf(\"%d\\n\",result.Image))\n}\niter.Close()\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 50254525, "answer_count": 1, "score": 0, "last_activity_date": 1525876187, "creation_date": 1525859406, "last_edit_date": 1525875323, "question_id": 50250351, "link": "https://stackoverflow.com/questions/50250351/insert-a-mgo-query-m-bson-result-into-a-file-txt-as-a-string", "title": "Insert a mgo query []M.bson result into a file.txt as a string", "body": "<p>i have to insert into a file the result of a <code>mgo query MongoDB</code> converted in <code>Go</code> to get <code>the id of images</code></p>\n\n<pre><code> var path=\"/home/Medo/text.txt\"\n\n   pipe := cc.Pipe([]bson.M{\n              {\"$unwind\": \"$images\"}, \n              {\"$group\": bson.M{\"_id\": \"null\", \"images\":bson.M{\"$push\": \"$images\"}}},\n\n              {\"$project\": bson.M{\"_id\": 0}}})\n\n    response := []bson.M{}\n    errResponse := pipe.All(&amp;response)\n    if errResponse != nil {\n        fmt.Println(\"error Response: \",errResponse)\n    }\n    fmt.Println(response) // to print for making sure that it is working \n\n    data, err := bson.Marshal(&amp;response)\n    s:=string(data)\n\n    if err22 != nil {\n        fmt.Println(\"error insertion \", err22)\n    } \n</code></pre>\n\n<p>Here is the part where I have to create a file and write on it.</p>\n\n<p>The problem is when I got the result of the query in the text file I got an enumeration values in the last of each value for example:</p>\n\n<pre><code>id of images \n23456678`0`\n24578689`1`\n23678654`2`\n12890762`3`\n76543890`4`\n64744848`5`\n</code></pre>\n\n<p>so for each value i got a number sorted in the last , and i can't figure out how , after getting the reponse from the query i converted the <code>Bson</code> to <code>[]Byte</code> and then to <code>String</code>but it keeps me getting that enumeration sorted values in the last of each results</p>\n\n<p>I'd like to drop those <code>0</code> <code>1</code> <code>2</code> <code>3</code> <code>4</code> <code>5</code></p>\n\n<pre><code>    var _, errExistFile = os.Stat(path)\n\n    if os.IsNotExist(errExistFile) {\n        var file, errCreateFile = os.Create(path)\n        if isError(erro) {\n            return\n        }\n        defer file.Close()\n    }\n\n    fmt.Println(\"==&gt; done creating file\", path)\n    var file, errii = os.OpenFile(path, os.O_RDWR, 0644)\n    if isError(errii) {\n        return\n    }\n    defer file.Close()\n\n    // write some text line-by-line to file\n    _, erri := file.WriteString(s)\n    if isError(erri) {\n        return\n    }\n\n    erri = file.Sync()\n    if isError(erri) {\n        return\n    }\n\n    fmt.Println(\"==&gt; done writing to file\")\n</code></pre>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525858818, "post_id": 50249999, "comment_id": 87517505, "body": "you&#39;re creating a new map each time found is false, don&#39;t do that, check if m[sess] is nil and only then create it, if it&#39;s not nil just set m[sess][Reqno] to true. <a href=\"https://play.golang.org/p/VlPY8UmRU-5\" rel=\"nofollow noreferrer\">play.golang.org/p/VlPY8UmRU-5</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1525858830, "post_id": 50249999, "comment_id": 87517514, "body": "You&#39;re not using <code>val</code> variable anywhere"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525858996, "post_id": 50249999, "comment_id": 87517626, "body": "This code will not work as expected since you are creating a new map for <code>req</code> every time you check for duplicates."}], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 8451486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3WNzH.jpg?s=128&g=1", "display_name": "Deepak Kumar", "link": "https://stackoverflow.com/users/8451486/deepak-kumar"}, "edited": false, "score": 0, "creation_date": 1525859969, "post_id": 50250178, "comment_id": 87518239, "body": "I am looking for something that is similar to Perl Hash of Hash. So variable mySessionData should be able to return value true when I access mySessionData[&quot;session1&quot;][&quot;2&quot;] but return nil when say mySessionData[&quot;session1&quot;][&quot;6&quot;]"}], "tags": [], "owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "is_accepted": false, "score": 0, "last_activity_date": 1525859351, "last_edit_date": 1525859351, "creation_date": 1525858869, "answer_id": 50250178, "question_id": 50249999, "link": "https://stackoverflow.com/questions/50249999/golang-creating-multi-level-string-map/50250178#50250178", "title": "golang creating multi level string map", "body": "<p>sess variable always equals session1, so you just override value for key session1. You have to have indistinguishable keys.</p>\n\n<p>If you want just check duplicates, just to this:</p>\n\n<pre><code>package main \n\nimport \"fmt\"\n\nfunc main() {\n    mySessionData := make(map[string]bool)\n\n    chkDuplicate(mySessionData, \"session1\", \"1\")\n    chkDuplicate(mySessionData, \"session1\", \"1\")\n    chkDuplicate(mySessionData, \"session2\", \"1\")\n    fmt.Println(mySessionData) # two keys printed\n}\n\nfunc chkDuplicate(m map[string]bool, sess string, Reqno string) bool {\n    key := fmt.Sprintf(\"%s-%s\", sess, Reqno)\n    _, found := m[key]\n    if !found {\n       m[key] = true    \n    }\n   return !found\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1525859624, "creation_date": 1525859624, "answer_id": 50250438, "question_id": 50249999, "link": "https://stackoverflow.com/questions/50249999/golang-creating-multi-level-string-map/50250438#50250438", "title": "golang creating multi level string map", "body": "<p>You only have to create a value of the inner map (the session map) if a map for the given session ID does not yet exists (and <em>not</em> if the given request number is not in it), else you clear any previously stored request numbers from it.</p>\n\n<p>Since you are using <code>bool</code> as the value type for the inner map (session map), you can exploit this to write simpler code (indexing a map with a key that is not in it will yield the zero value of the value type, which is <code>false</code> for the <code>bool</code> type, properly telling the key is not in it):</p>\n\n<pre><code>func chkDuplicate(m map[string]map[string]bool, sess string, Reqno string) bool {\n    sessMap := m[sess]\n    if sessMap == nil {\n        m[sess] = map[string]bool{Reqno: true}\n        return false\n    }\n\n    if sessMap[Reqno] {\n        return true\n    }\n    sessMap[Reqno] = true\n    return false\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>func main() {\n    mySessionData := make(map[string]map[string]bool)\n\n    for _, reqNo := range []string{\"1\", \"2\", \"3\", \"2\", \"4\"} {\n        ret := chkDuplicate(mySessionData, \"session1\", reqNo)\n        fmt.Println(ret, mySessionData)\n    }\n\n    delete(mySessionData, \"session1\")\n    fmt.Println(mySessionData)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/2yniNYuILlW\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>false map[session1:map[1:true]]\nfalse map[session1:map[1:true 2:true]]\nfalse map[session1:map[1:true 2:true 3:true]]\ntrue map[session1:map[2:true 3:true 1:true]]\nfalse map[session1:map[2:true 3:true 4:true 1:true]]\nmap[]\n</code></pre>\n\n<p>Note that <code>bool</code> \u2013although may be small\u2013does require memory. Since we can query if a key is in the map, we may opt to use a value type that requires no memory, such as an empty struct (<code>struct{}</code>). With that, it may look like this:</p>\n\n<pre><code>func chkDuplicate(m map[string]map[string]struct{}, sess string, Reqno string) bool {\n    sessMap := m[sess]\n    if sessMap == nil {\n        m[sess] = map[string]struct{}{Reqno: struct{}{}}\n        return false\n    }\n\n    if _, ok := sessMap[Reqno]; ok {\n        return true\n    }\n    sessMap[Reqno] = struct{}{}\n    return false\n}\n</code></pre>\n\n<p>Testing and result is (almost) the same, try it on the <a href=\"https://play.golang.org/p/M6fRiPiM0g_-\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>A word of warning: judging from the example, it looks you want to use this to track if a (web) request has been served previously, where usually multiple goroutines are involved. This solution is <strong>not safe for concurrent use</strong>.</p>\n"}, {"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": true, "score": 1, "last_activity_date": 1525905462, "creation_date": 1525905462, "answer_id": 50263017, "question_id": 50249999, "link": "https://stackoverflow.com/questions/50249999/golang-creating-multi-level-string-map/50263017#50263017", "title": "golang creating multi level string map", "body": "<p>It's often simpler to use a struct key instead of a multi-level map:\n<a href=\"https://play.golang.org/p/WFlGi1rrVOm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WFlGi1rrVOm</a></p>\n"}], "owner": {"reputation": 136, "user_id": 8451486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3WNzH.jpg?s=128&g=1", "display_name": "Deepak Kumar", "link": "https://stackoverflow.com/users/8451486/deepak-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 50263017, "answer_count": 3, "score": 0, "last_activity_date": 1525905462, "creation_date": 1525858343, "last_edit_date": 1525859806, "question_id": 50249999, "link": "https://stackoverflow.com/questions/50249999/golang-creating-multi-level-string-map", "title": "golang creating multi level string map", "body": "<p>I am very new to Go language. I am struggling with following usecase. </p>\n\n<p>I want to store session id (string) and reqeust No (string) in a map for duplicate checking. When there is no entry in the map, it should create one, else it should return a flag saying the entry already exists.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    mySessionData := make(map[string]map[string]bool)\n\n    var ret bool\n    ret = chkDuplicate(mySessionData, \"session1\", \"1\")\n    fmt.Println(mySessionData)\n    ret = chkDuplicate(mySessionData, \"session1\", \"2\")\n    fmt.Println(mySessionData)\n    ret = chkDuplicate(mySessionData, \"session1\", \"3\")\n    fmt.Println(mySessionData)\n    ret = chkDuplicate(mySessionData, \"session1\", \"2\")\n    fmt.Println(mySessionData)\n    ret = chkDuplicate(mySessionData, \"session1\", \"4\")\n    fmt.Println(mySessionData)\n    fmt.Println(ret)\n\n    delete(mySessionData, \"session1\")\n    fmt.Println(mySessionData)\n\n}\n\nfunc chkDuplicate(m map[string]map[string]bool, sess string, Reqno string) bool {\n    var found bool\n    val, found := m[sess][Reqno]\n    if !found {\n        fmt.Println(val)\n        valu := make(map[string]bool)\n        valu[Reqno] = true\n        m[sess] = valu\n        return !found\n\n    }\n    return !found\n}\n</code></pre>\n\n<p>The problem I am facing is that the value is over written every time the function is called. \nWhat am I doing wrong here?</p>\n"}, {"tags": ["go", "packages"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1525855102, "creation_date": 1525855102, "answer_id": 50248958, "question_id": 50248884, "link": "https://stackoverflow.com/questions/50248884/compile-error-when-using-echo/50248958#50248958", "title": "Compile error when using Echo", "body": "<p>This issue is addressed in <a href=\"https://github.com/labstack/echo/issues/1082\" rel=\"nofollow noreferrer\">issue #1082</a>:</p>\n\n<blockquote>\n  <p>You seem to have a stale acme/autocert library. autocert.Manager DOES currently have that method: <a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert#Manager.HTTPHandler\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/crypto/acme/autocert#Manager.HTTPHandler</a> I suggest a <code>go get -u golang.org/x/crypto/acme/...</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 21, "user_id": 9763491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc8de724eb60ef602e038be278ffa65a?s=128&d=identicon&r=PG&f=1", "display_name": "Taj", "link": "https://stackoverflow.com/users/9763491/taj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1525855102, "creation_date": 1525854868, "question_id": 50248884, "link": "https://stackoverflow.com/questions/50248884/compile-error-when-using-echo", "title": "Compile error when using Echo", "body": "<p>I made a simple work using github.com/labstack/echo package while running I got this error.</p>\n\n<blockquote>\n  <p>github.com\\labstack\\echo\\echo.go:624: e.AutoTLSManager.HTTPHandler\n  undefined (type autocert.Manager has no field or method HTTPHandler</p>\n</blockquote>\n\n<pre><code>package main\n\nimport \"github.com/labstack/echo\"\n\nfunc main() {\n    e := echo.New()\n\n    e.Start(\":\")\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525853972, "post_id": 50248471, "comment_id": 87514547, "body": "I can&#39;t reproduce the error. It works for me. What MongoDB version are you using? And which <code>mgo</code> package?"}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525854258, "post_id": 50248471, "comment_id": 87514712, "body": "using v3.6.4 with mgo.v2"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525854313, "post_id": 50248471, "comment_id": 87514741, "body": "Which <code>mgo</code>? Use <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">github.com/globalsign/mgo</a>."}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525854632, "post_id": 50248471, "comment_id": 87514922, "body": "gopkg.in/mgo.v2"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525855287, "post_id": 50248471, "comment_id": 87515293, "body": "That <code>mgo</code> package is unmaintained. Please try with the one I posted."}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525856091, "post_id": 50248471, "comment_id": 87515788, "body": "ok, thanks for your help"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525857615, "post_id": 50248471, "comment_id": 87516738, "body": "I think if you are using interface you have to type assert its underlying to fetch exact value."}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "edited": false, "score": 0, "creation_date": 1525859332, "post_id": 50248471, "comment_id": 87517847, "body": "mgo should do it"}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "edited": false, "score": 0, "creation_date": 1525860289, "post_id": 50248471, "comment_id": 87518463, "body": "oh no~, my db value &quot;_id&quot; type int64,when i use string to find it, can not found any result! this is MongoDB  requirements\uff1f"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "edited": false, "score": 0, "creation_date": 1526365662, "post_id": 50253633, "comment_id": 87703008, "body": "if type id is string, i get &#39;not found&#39;"}, {"owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "reply_to_user": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "edited": false, "score": 0, "creation_date": 1526473668, "post_id": 50253633, "comment_id": 87757726, "body": "I use strings as ids all the time and if you are getting not found error then the string isn&#39;t being used as an id. Confirm with an app like MongoDB Compass or MongoHub etc. If you want to use the Mongo javascript engine try: use &lt;collection&gt; then: db.user.find({&quot;_id&quot;: &quot;&lt;string&gt;&quot;})"}], "tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": false, "score": 0, "last_activity_date": 1525869437, "creation_date": 1525869437, "answer_id": 50253633, "question_id": 50248471, "link": "https://stackoverflow.com/questions/50248471/bson-interface-has-some-problems/50253633#50253633", "title": "Bson interface has some problems", "body": "<p>You are putting an unnecessary &amp; in front of the bson.M{\u2026</p>\n\n<pre><code>err := session.DB.C(\"user\").Find(bson.M{\"_id\": id}).One(&amp;m)\n</code></pre>\n\n<p>The use of bson.M in the find is also unnecessary, mgo has a call of FindId specifically for the search you are doing.</p>\n\n<pre><code>err := session.DB.C(\"user\").FindId(id).One(&amp;m)\n</code></pre>\n\n<p>gopkg.in/mgo.v2 is now marked as unmaintained. github.com/globalsign/mgo and github.com/globalsign/mgo/bson are the two maintained forked libraries. I have found no problems using them instead pf gopkg.in</p>\n"}], "owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 166, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1572514370, "creation_date": 1525853298, "last_edit_date": 1572514370, "question_id": 50248471, "link": "https://stackoverflow.com/questions/50248471/bson-interface-has-some-problems", "title": "Bson interface has some problems", "body": "<p>I uesd MongoDB v3.6.4 with mgo(gopkg.in/mgo.v2) package</p>\n\n<p>Bson   </p>\n\n<pre><code>var id interface{}  \nid = 249678041972736  \nbson.M{\"_id\": id}  \nvar id int64  \nid = 249678041972736  \nbson.M{\"_id\": id}\n</code></pre>\n\n<p>Tow bsons are not same?<br>\neg:  </p>\n\n<pre><code>func GetUser(id interface{}) (*User, error) {  \n    session := MongoDB()  \n    defer session.Close()  \n    var m *User  \n    err := session.DB.C(\"user\").Find(&amp;bson.M{\"_id\": id}).One(&amp;m)  \n    // \uff01\uff01\uff01err: not found  \n    if err != nil {  \n        return nil, err  \n    } else {  \n        return m, nil  \n    }\n}  \n</code></pre>\n\n<p>but:  </p>\n\n<pre><code>func GetUser(id int64) (*User, error) {  \n    session := MongoDB()  \n    defer session.Close()  \n    var m *User  \n    err := session.DB.C(\"user\").Find(&amp;bson.M{\"_id\": id}).One(&amp;m)  \n    // !!! err == nil \n    if err != nil {  \n        return nil, err  \n    } else {  \n        return m, nil  \n    }\n}  \n\nGetUser(id interface{}) can get err (not found)  \nGetUser(id int64) can get nil err \n</code></pre>\n\n<p>Pay attention to error   </p>\n\n<p>I used function GetUser and import same value 249678041972736 \nbut different parameter type get different result</p>\n\n<p>Why?</p>\n"}, {"tags": ["go", "ftp"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1525851875, "post_id": 50247865, "comment_id": 87513393, "body": "Take a debugger and debug your code perhaps."}], "answers": [{"tags": [], "owner": {"reputation": 144837, "user_id": 850848, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c287735beca76400cb9b6d08bf591cb9?s=128&d=identicon&r=PG", "display_name": "Martin Prikryl", "link": "https://stackoverflow.com/users/850848/martin-prikryl"}, "is_accepted": true, "score": 2, "last_activity_date": 1525852506, "creation_date": 1525852506, "answer_id": 50248265, "question_id": 50247865, "link": "https://stackoverflow.com/questions/50247865/trying-to-upload-a-file-using-goftp-library-gives-a-502-rfc-2228-authentication/50248265#50248265", "title": "Trying to upload a file using goftp library gives a &quot;502 RFC 2228 authentication not implemented.&quot; error", "body": "<p>Your FTP server does not support TLS/SSL encryption. So you cannot use it.</p>\n\n<p>Remove the <code>AuthTLS</code> call.</p>\n"}], "owner": {"reputation": 16720, "user_id": 340554, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7332c248b2542b58427e9717962549d9?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/340554/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "accepted_answer_id": 50248265, "answer_count": 1, "score": 0, "last_activity_date": 1525852506, "creation_date": 1525851123, "question_id": 50247865, "link": "https://stackoverflow.com/questions/50247865/trying-to-upload-a-file-using-goftp-library-gives-a-502-rfc-2228-authentication", "title": "Trying to upload a file using goftp library gives a &quot;502 RFC 2228 authentication not implemented.&quot; error", "body": "<p>I am trying to upload a file to a server using FTP (using <a href=\"https://github.com/dutchcoders/goftp\" rel=\"nofollow noreferrer\">goftp</a> library). Here is my current code:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"github.com/dutchcoders/goftp\"\n    \"fmt\"\n    \"strings\"\n    \"path/filepath\"\n    \"os\"\n)\n\nvar client *goftp.FTP\n\nfunc main() {\n    // connect to FTP\n    client, err := goftp.ConnectDbg(\"192.168.206.226:21\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    defer client.Close()\n\n    config := tls.Config{\n        InsecureSkipVerify: true,\n        ClientAuth:         tls.RequestClientCert,\n    }\n\n    if err = client.AuthTLS(&amp;config); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    if err := client.Login(\"aaa\", \"bbbb\"); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    // upload new S10 file using FTP\n    err = filepath.Walk(\"c:\\\\Temp\", upload)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}\n\nfunc upload(path string, f os.FileInfo, err error) error {\n    if strings.Compare(f.Name(), \"S10\") == 0 {\n        path := strings.TrimSuffix(path, f.Name())\n\n        var file *os.File\n        if file, err = os.Open(path); err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n\n        defer file.Close()\n        if err := client.Stor(\"/sd1/myFile\", file); err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I followed the code available on <a href=\"https://github.com/dutchcoders/goftp\" rel=\"nofollow noreferrer\">goftp</a> github page, but it is not working for me. I always get this error:</p>\n\n<pre><code>go : 2018/05/09 10:23:28 &lt; 220 192.168.206.226 FTP server (QNXNTO-ftpd 20081216) ready.\nAt line:1 char:1\n+ go run main.go\n+ ~~~~~~~~~~~~~~\n    + CategoryInfo          : NotSpecified: (2018/05/09 10:2...0081216) ready.:String) [], RemoteException\n    + FullyQualifiedErrorId : NativeCommandError\n\n2018/05/09 10:23:28 220 192.168.206.226 FTP server (QNXNTO-ftpd 20081216) ready.\n2018/05/09 10:23:28 &gt; AUTH TLS\n502 RFC 2228 authentication not implemented.\n\n2018/05/09 10:23:28 &lt; 502 RFC 2228 authentication not implemented.\nexit status 1\n</code></pre>\n\n<p>Am I doing something wrong ? Can't seem to understand what the issue is.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1525852793, "post_id": 50247048, "comment_id": 87513917, "body": "You need to use type assertion."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1525853150, "post_id": 50247048, "comment_id": 87514132, "body": "Read the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">docs on unmarshaling</a> mainly the rules specified after the line <i>&quot;To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:&quot;</i>. Here&#39;s an example of type assertion: <a href=\"https://play.golang.org/p/kC1OPzLewS_6\" rel=\"nofollow noreferrer\">play.golang.org/p/kC1OPzLewS_6</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1525854710, "post_id": 50247048, "comment_id": 87514973, "body": "You say it&#39;s not working, but you don&#39;t say what error you get. What is the error? It probably gives you a clue as to how to fix it."}], "answers": [{"comments": [{"owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1525851813, "post_id": 50247139, "comment_id": 87513359, "body": "Thanks for your answer. But If i need unmarshal array for example <code>str := </code>[{&quot;page&quot;: 1, &quot;fruits&quot;: [&quot;apple&quot;, &quot;peach&quot;]}]`` In this case how it work?"}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "reply_to_user": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "edited": false, "score": 0, "creation_date": 1525863833, "post_id": 50247139, "comment_id": 87520644, "body": "@Testadmin <a href=\"https://play.golang.org/p/RcDy2uSZf5Y\" rel=\"nofollow noreferrer\">play.golang.org/p/RcDy2uSZf5Y</a> better to define a new type. Although Go has something &quot;dynamic&quot; like empty interface, it a type-safe language."}], "tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": true, "score": 4, "last_activity_date": 1525848560, "creation_date": 1525848560, "answer_id": 50247139, "question_id": 50247048, "link": "https://stackoverflow.com/questions/50247048/trying-to-unmarshal-data-into-interface-in-golang/50247139#50247139", "title": "Trying to unmarshal data into interface in golang", "body": "<p><strong>interface{}</strong> specifies zero methods (and ofc zero fields).<br>\nWhat you need is a <strong>map[string]interface{}</strong></p>\n\n<p>Try this <a href=\"https://play.golang.org/p/WBwXKob4zdA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WBwXKob4zdA</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var res map[string]interface{}\n    str := `{\"page\": 1, \"fruits\": [\"apple\", \"peach\"]}`\n    json.Unmarshal([]byte(str), &amp;res)\n    fmt.Println(res[\"page\"])\n}\n</code></pre>\n\n<p>You may want to check:</p>\n\n<ul>\n<li><a href=\"https://tour.golang.org/methods/14\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/14</a></li>\n<li><a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/15</a></li>\n</ul>\n"}], "owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 50247139, "answer_count": 1, "score": -4, "last_activity_date": 1525848560, "creation_date": 1525848217, "question_id": 50247048, "link": "https://stackoverflow.com/questions/50247048/trying-to-unmarshal-data-into-interface-in-golang", "title": "Trying to unmarshal data into interface in golang", "body": "<p>Trying to unmarshal data into interface. It is working fine. But If i access res.page or res.Page not working</p>\n\n<p>I got the below error:</p>\n\n<pre><code>res.Page undefined (type interface {} is interface with no methods)\n</code></pre>\n\n<p>Below is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var res interface{}\n    str := `{\"page\": 1, \"fruits\": [\"apple\", \"peach\"]}`\n    json.Unmarshal([]byte(str), &amp;res)\n    fmt.Println(res.Page)\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "synchronization", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525834188, "post_id": 50244690, "comment_id": 87507119, "body": "Channels are kind of awkward for this pattern. This looks like the perfect candidate to use a <a href=\"https://golang.org/pkg/sync/#Cond\" rel=\"nofollow noreferrer\"><code>sync.Condition</code></a> instead."}, {"owner": {"reputation": 310996, "user_id": 908494, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7e41acaa8f6a0e0f5a7c645e93add55a?s=128&d=identicon&r=PG", "display_name": "abarnert", "link": "https://stackoverflow.com/users/908494/abarnert"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525834609, "post_id": 50244690, "comment_id": 87507224, "body": "@JimB Unless Go conditions are very different from POSIX/etc. conditions, they&#39;re also pretty awkward for a try-wait scenario, where you can&#39;t just block in <code>for !ready { c.Wait() }</code>. Also, in my real code that <code>case &lt;-l.pause:</code> would be inside a <code>select</code> that I already need for other reasons, so to use a <code>Condition</code>, wouldn&#39;t I have to have a goroutine that waits on the condition and sends on a channel anyway?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525835580, "post_id": 50244690, "comment_id": 87507423, "body": "yeah, the <code>sync.Cond</code> doesn&#39;t work as well if you need to select against that logical condition. I saw the repeating broadcast pattern and immediately jumped to a condition variable, but in practice I rarely use them either ;)"}, {"owner": {"reputation": 310996, "user_id": 908494, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7e41acaa8f6a0e0f5a7c645e93add55a?s=128&d=identicon&r=PG", "display_name": "abarnert", "link": "https://stackoverflow.com/users/908494/abarnert"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525843170, "post_id": 50244690, "comment_id": 87509378, "body": "@JimB My first thought was a condition as well, but that\u2019s because I\u2019m more used to a C-style threadpool with a queue of task structs (or a Python/C#/etc. executor, where I\u2019d just throw in a pause task with the resuming on a future callback). I\u2019m sure there is a better channel-based idiom for what I\u2019m trying to do, I\u2019m just not sure what it is. (The fact that my WaitGroup has to know how many goroutines I have seems clunky\u2026)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525870746, "post_id": 50244690, "comment_id": 87525350, "body": "It&#39;s hard to make a recommendation without the full context of course, but you might try and rethink the overall pattern you&#39;re using here. A common pitfall is to treat goroutines like threads. Dispatching goroutines is quite fast, and there are often simpler patterns available when you treat them as being disposable, creating and destroying them on demand."}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 3038863, "user_type": "registered", "profile_image": "https://graph.facebook.com/685535147/picture?type=large", "display_name": "Nikunj Yadav", "link": "https://stackoverflow.com/users/3038863/nikunj-yadav"}, "is_accepted": true, "score": 4, "last_activity_date": 1525834043, "creation_date": 1525834043, "answer_id": 50244811, "question_id": 50244690, "link": "https://stackoverflow.com/questions/50244690/race-pausing-a-group-of-goroutines/50244811#50244811", "title": "Race pausing a group of goroutines", "body": "<p>This is because after the thread does l.paused.Done(), the other thread is able to go around the loop and assign l.resume again </p>\n\n<p>Here is sequence of operations</p>\n\n<pre><code>Looper thread    |    Pauser thread\n------------------------------------\nl.paused.Done()  |   \n                 |   l.paused.Wait()\n                 |   l.pause = make(chan struct{})\n                 |   round the loop\n                 |   l.paused.Add(numThreads)\n&lt;- l.resume      |   l.resume = make(chan struct{})   !!!RACE!!\n</code></pre>\n"}], "owner": {"reputation": 310996, "user_id": 908494, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7e41acaa8f6a0e0f5a7c645e93add55a?s=128&d=identicon&r=PG", "display_name": "abarnert", "link": "https://stackoverflow.com/users/908494/abarnert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 50244811, "answer_count": 1, "score": 2, "last_activity_date": 1525834106, "creation_date": 1525833052, "last_edit_date": 1525834106, "question_id": 50244690, "link": "https://stackoverflow.com/questions/50244690/race-pausing-a-group-of-goroutines", "title": "Race pausing a group of goroutines", "body": "<p>I have a bunch of goroutines doing something in a loop. I want to be able to pause all of them, run some arbitrary code, then resume them. The way I attempted to do this is probably not idiomatic (and I'd appreciate a better solution), but I can't understand why it doesn't work.</p>\n\n<p>Stripped down to the essentials (driver code at the bottom):</p>\n\n<pre><code>type looper struct {\n    pause  chan struct{}\n    paused sync.WaitGroup\n    resume chan struct{}\n}\n\nfunc (l *looper) loop() {\n    for {\n        select {\n        case &lt;-l.pause:\n            l.paused.Done()\n            &lt;-l.resume\n        default:\n            dostuff()\n        }\n    }\n}\n\nfunc (l *looper) whilePaused(fn func()) {\n    l.paused.Add(32)\n    l.resume = make(chan struct{})\n    close(l.pause)\n    l.paused.Wait()\n    fn()\n    l.pause = make(chan struct{})\n    close(l.resume)\n}\n</code></pre>\n\n<p>I spin up 32 goroutines all running <code>loop()</code>, then call <code>whilePaused</code> 100 times in a row, and everything seems to work\u2026 but if I run it with <code>-race</code>, it tells me that there's a race on <code>l.resume</code> between writing it in <code>whilePaused</code> (<code>l.resume = make(chan struct{})</code>) and reading it in <code>loop</code> (<code>&lt;-l.resume</code>).</p>\n\n<p>I don't understand why this happens. According to <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">The Go Memory Model</a>, that <code>close(l.pause)</code> should happen before the <code>&lt;-l.pause</code> in every <code>loop</code> goroutine. This should mean the <code>make(chan struct{})</code> value is visible as the value of <code>l.resume</code> in all of those <code>loop</code> goroutines, in the same way the string <code>\"hello world\"</code> is visible as the value of <code>a</code> in the <code>f</code> goroutine in the docs example.</p>\n\n<hr>\n\n<p>Some additional information that might be relevant:</p>\n\n<ul>\n<li><p>If I replace <code>l.resume</code> with an <code>unsafe.Pointer</code> and access the <code>chan struct{}</code> value with <code>atomic.LoadPointer</code> in <code>loop</code> and <code>atomic.StorePointer</code> in <code>whilePaused</code>, the race goes away. This seems to be providing the exact same acquire-release ordering that the channel is already supposed to provide?</p></li>\n<li><p>If I add a <code>time.Sleep(10 * time.Microsecond)</code> between the <code>l.paused.Done()</code> and <code>&lt;-l.resume</code>, the program usually deadlocks after calling <code>fn</code> one or two times.</p></li>\n<li><p>If I add a <code>fmt.Printf(\".\")</code> instead, the program prints 28 <code>.</code>s, calls the first function, prints another 32 <code>.</code>s, then hangs (or, occasionally, calls the second function, then prints another 32 <code>.</code>s and hangs).</p></li>\n</ul>\n\n<hr>\n\n<p>Here's the rest of my code, in case you want to run the whole thing:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"sync/atomic\"\n)\n\n// looper code from above\n\nvar n int64    \nfunc dostuff() {\n    atomic.AddInt64(&amp;n, 1)\n}\n\nfunc main() {\n    l := &amp;looper{\n        pause: make(chan struct{}),\n    }\n    var init sync.WaitGroup\n    init.Add(32)\n    for i := 0; i &lt; 32; i++ {\n        go func() {\n            init.Done()\n            l.loop()\n        }()\n    }\n    init.Wait()\n    for i := 0; i &lt; 100; i++ {\n        l.whilePaused(func() { fmt.Printf(\"%d \", i) })\n    }\n    fmt.Printf(\"\\n%d\\n\", atomic.LoadInt64(&amp;n))\n}\n</code></pre>\n"}, {"tags": ["variables", "go", "reference"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1525817064, "creation_date": 1525817064, "answer_id": 50242889, "question_id": 50242872, "link": "https://stackoverflow.com/questions/50242872/increment-a-struct-var-in-a-range-loop/50242889#50242889", "title": "increment a struct var in a range loop", "body": "<p>All assignments in Go are a copy. Use a pointer to modify the original value:</p>\n\n<pre><code>var es = []*A{\n    &amp;A{\n        a: 0,\n        s: \"test\",\n    },\n    &amp;A{\n        a: 1,\n        s: \"test1\",\n    },\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pz8PwEviMwm\" rel=\"noreferrer\">https://play.golang.org/p/pz8PwEviMwm</a></p>\n\n<p>Or alternatively, don't copy the value at all</p>\n\n<pre><code>for i := range es {\n    fmt.Printf(\"%v\\n\", es[i])\n    es[i].a++\n}\nfor i := range es {\n    fmt.Printf(\"%v\\n\", es[i])\n    es[i].a++\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/EGl1INcBaTI\" rel=\"noreferrer\">https://play.golang.org/p/EGl1INcBaTI</a></p>\n"}], "owner": {"reputation": 452, "user_id": 3366355, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8db57c6e8aadb203088ef7c450e1ff61?s=128&d=identicon&r=PG&f=1", "display_name": "martin", "link": "https://stackoverflow.com/users/3366355/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "closed_date": 1525849372, "accepted_answer_id": 50242889, "answer_count": 1, "score": 0, "last_activity_date": 1525817064, "creation_date": 1525816938, "question_id": 50242872, "link": "https://stackoverflow.com/questions/50242872/increment-a-struct-var-in-a-range-loop", "closed_reason": "Duplicate", "title": "increment a struct var in a range loop", "body": "<p>This must be a noob question. I was trying to increment a var inside a struct/instance (A.a) after getting the element from a range loop. Looks like I get a copy of the element, how can I reference the element itself on a range loop?</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype A struct {\n  a int\n  s string\n} \n\nfunc main() {\n  var es = []A {\n     A{\n       a:0,\n       s:\"test\",\n     },\n     A{\n       a:1,\n       s:\"test1\",\n     },\n  }\n  for _,e:=range es {\n    fmt.Printf(\"%v\\n\", e)\n    e.a++\n  }\n  for _,e:=range es {\n    fmt.Printf(\"%v\\n\", e)\n    e.a++\n  }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{0 test}\n{1 test1}\n{0 test}\n{1 test1}\n</code></pre>\n\n<p>Desired output:</p>\n\n<pre><code>{0 test}\n{1 test1}\n{1 test}\n{2 test1}\n</code></pre>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "ibm-cloud-infrastructure"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1525816832, "post_id": 50241215, "comment_id": 87503372, "body": "The example API call that is working just had <code>itemCategory</code> whereas the go code has nested attributes, have you tried it with just <code>itemCategory</code>?"}, {"owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 1, "creation_date": 1525817296, "post_id": 50241215, "comment_id": 87503531, "body": "Good point Iain. Yes I have tried that as well, to no avail. The output is the same. No itemCategory. I have changed the mask in my post to just itemCategory."}, {"owner": {"reputation": 668, "user_id": 9426033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497a5abd02ca5ab68b84c07a1d084cd?s=128&d=identicon&r=PG&f=1", "display_name": "F.Ojeda", "link": "https://stackoverflow.com/users/9426033/f-ojeda"}, "edited": false, "score": 0, "creation_date": 1525872270, "post_id": 50241215, "comment_id": 87526448, "body": "Are you using the linux operating system."}, {"owner": {"reputation": 668, "user_id": 9426033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497a5abd02ca5ab68b84c07a1d084cd?s=128&d=identicon&r=PG&f=1", "display_name": "F.Ojeda", "link": "https://stackoverflow.com/users/9426033/f-ojeda"}, "edited": false, "score": 0, "creation_date": 1525873902, "post_id": 50241215, "comment_id": 87527716, "body": "To know what is happening you have to enable the debug. To enable the debug you have to add this line of code &quot;sess.Debug = true&quot; after creating the session, like this example: sess: = session.New (username, apikey) sess.Debug = true  Run the code and send the result."}, {"owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "edited": false, "score": 0, "creation_date": 1525877135, "post_id": 50241215, "comment_id": 87530119, "body": "I am running this code on my mac. I have edited my original post with your request."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "edited": false, "score": 0, "creation_date": 1525879610, "post_id": 50256657, "comment_id": 87531791, "body": "Thanks Ojeda, raised issue: <a href=\"https://github.com/softlayer/softlayer-go/issues/100\" rel=\"nofollow noreferrer\">github.com/softlayer/softlayer-go/issues/100</a> I also posted your response in <a href=\"https://stackoverflow.com/questions/47641717/how-to-add-object-mask-to-call-getnetworkvlans-using-golang/50256921#50256921\" title=\"how to add object mask to call getnetworkvlans using golang\">stackoverflow.com/questions/47641717/&hellip;</a> I had the same issue here."}], "tags": [], "owner": {"reputation": 668, "user_id": 9426033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497a5abd02ca5ab68b84c07a1d084cd?s=128&d=identicon&r=PG&f=1", "display_name": "F.Ojeda", "link": "https://stackoverflow.com/users/9426033/f-ojeda"}, "is_accepted": true, "score": 1, "last_activity_date": 1525878569, "creation_date": 1525878569, "answer_id": 50256657, "question_id": 50241215, "link": "https://stackoverflow.com/questions/50241215/unable-to-get-itemcategory-info-from-call-getconfiguration-when-called-from-gola/50256657#50256657", "title": "Unable to get itemCategory info from call GetConfiguration when called from golang", "body": "<p>The default endpoint is REST but in your environment you are using xmlrpc, which is probably due to the existence of the ~ / .softlayer file and in this it is configured as an XMLRPC enpoint.</p>\n\n<p>For more information you can see the following documentation:\n<a href=\"https://github.com/softlayer/softlayer-go\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go</a></p>\n\n<p>This issue happens for the XMLRPC enpoint and you can report it in the go GitHub.\n<a href=\"https://github.com/softlayer/softlayer-go/issues/\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go/issues/</a></p>\n\n<p>Try in your code with the REST endpoint, like this example:</p>\n\n<pre><code>endpoint := \"https://api.softlayer.com/rest/v3\"\n\n// Create a session\nsess := session.New(username, apikey, endpoint)\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 50256657, "answer_count": 1, "score": 1, "last_activity_date": 1525878569, "creation_date": 1525808668, "last_edit_date": 1525877011, "question_id": 50241215, "link": "https://stackoverflow.com/questions/50241215/unable-to-get-itemcategory-info-from-call-getconfiguration-when-called-from-gola", "title": "Unable to get itemCategory info from call GetConfiguration when called from golang", "body": "<p>The api call </p>\n\n<pre><code>GET https://api.softlayer.com/rest/v3/SoftLayer_Product_Package/257/getConfiguration?objectMask=mask[itemCategory]\n</code></pre>\n\n<p>returns an object, <code>[]datatypes.Product_Package_Order_Configuration</code> where <code>ItemCategory</code> is populated. \nsample output:</p>\n\n<pre><code>{\n\"id\": 7167,\n\"isRequired\": 0,\n\"itemCategoryId\": 390,\n\"orderStepId\": 1,\n\"packageId\": 257,\n\"sort\": 0,\n\"itemCategory\": {\n\"categoryCode\": \"trusted_platform_module\",\n\"id\": 390,\n\"name\": \"Server Security\",\n\"quantityLimit\": 1,\n\"sortOrder\": 0\n}\n},\n</code></pre>\n\n<p>When I attempt the same call in go, <code>itemCategory</code> is not populated, even though I declare it in the mask. Please advise.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"github.com/softlayer/softlayer-go/services\"\n\"github.com/softlayer/softlayer-go/session\"\n\"encoding/json\"\n)\n\nfunc main() {\n    // SoftLayer API username and key\n    username := \"set-me\"\n    apikey   := \"set-me\"\n\n    // Create a session\n    sess := session.New(username, apikey)\n\n    // Enable debug\n    sess.Debug = true\n\n    // Get SoftLayer_Account service\n    service := services.GetProductPackageService(sess)\n\n    // Object-Mask to get specific Vlan's information\n    mask := \"itemCategory\"\n\n    // Call to getNetworkVlans in order to retrieve vlans according to filter.\n    result, err := service.Mask(mask).Id(257).GetConfiguration()\n    if err != nil {\n        fmt.Printf(\"\\n Unable to retrieve config:\\n - %s\\n\", err)\n        return\n    }\n\n    // Following helps to print the result in json format.\n    jsonFormat, jsonErr := json.MarshalIndent(result,\"\",\"     \")\n    if jsonErr != nil {\n        fmt.Println(jsonErr)\n        return\n    }\n    fmt.Println(string(jsonFormat))\n}\n</code></pre>\n\n<p>sample output:</p>\n\n<pre><code>-&gt;&gt;&gt;Request:\n2018/05/09 09:24:36 POST /xmlrpc/v3.1/SoftLayer_Product_Package HTTP/1.1\nHost: api.softlayer.com\nUser-Agent: Go-http-client/1.1\nContent-Length: 1055\nContent-Type: text/xml\nAccept-Encoding: gzip\n\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;methodCall&gt;&lt;methodName&gt;getConfiguration&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;headers&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;User-Agent&lt;/name&gt;&lt;value&gt;&lt;string&gt;softlayer-go/v0.1.0-alpha (go1.9.2;amd64;darwin)&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;authenticate&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;username&lt;/name&gt;&lt;value&gt;&lt;string&gt;[[SL_USER]]&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;apiKey&lt;/name&gt;&lt;value&gt;&lt;string&gt;[[SL_APIKEY]]&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;SoftLayer_Product_PackageInitParameters&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;id&lt;/name&gt;&lt;value&gt;&lt;int&gt;257&lt;/int&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;SoftLayer_Product_PackageObjectMask&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;mask&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;itemCategory&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;\n2018/05/09 09:24:36 \n\n\n&lt;&lt;&lt;-Response:\n2018/05/09 09:24:36 HTTP/1.1 200 OK\nConnection: close\nTransfer-Encoding: chunked\nCache-Control: private\nContent-Type: text/xml\nDate: Wed, 09 May 2018 14:24:36 GMT\nServer: Apache\nSoftlayer-Total-Items: 39\nStrict-Transport-Security: max-age=31536000\nVary: Accept-Encoding\nX-Frame-Options: SAMEORIGIN\n</code></pre>\n\n<p>Then a string of html with the same data as below is returned\nSample entry:</p>\n\n<pre><code>{\n          \"id\": 7167,\n          \"isRequired\": 0,\n          \"itemCategoryId\": 390,\n          \"orderStepId\": 1,\n          \"packageId\": 257,\n          \"sort\": 0\n     },\n</code></pre>\n"}, {"tags": ["go", "goquery"], "answers": [{"tags": [], "owner": {"reputation": 7985, "user_id": 3918577, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/cfZLg.jpg?s=128&g=1", "display_name": "Belmin Bedak", "link": "https://stackoverflow.com/users/3918577/belmin-bedak"}, "is_accepted": false, "score": 0, "last_activity_date": 1525807190, "last_edit_date": 1525807190, "creation_date": 1525806330, "answer_id": 50240696, "question_id": 50239543, "link": "https://stackoverflow.com/questions/50239543/split-element-on-line-break-with-goquery/50240696#50240696", "title": "Split element on line break with GoQuery", "body": "<p>Okay, I managed to find one solution.Not sure If It's right way to go, so If someone have something better - please share It.</p>\n\n<p>So I basically, store value of <code>li p</code> as HTML, and then use <code>strings.Split</code> to break on each <code>br</code> tag, and since <code>strings.Split</code> returns slice of strings, I just loop over It.</p>\n\n<pre><code>title, err := s.Find(\"li p\").Next().Html()\nif err != nil {\n    panic(err)\n}\n\nsplittedTitles := strings.Split(title, \"&lt;br/&gt;\")\n\nfor _, str := range splittedTitles {\n    fmt.Println(str, \"--\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7985, "user_id": 3918577, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/cfZLg.jpg?s=128&g=1", "display_name": "Belmin Bedak", "link": "https://stackoverflow.com/users/3918577/belmin-bedak"}, "edited": false, "score": 0, "creation_date": 1525806923, "post_id": 50240715, "comment_id": 87498999, "body": "Thanks Dave for response, I tried your solution and I got error <code>multiple-value p.Html() in single-value context</code>.Probably because <code>p.Html()</code> has multiple return arguments, I guess ? Btw what do you think about solution I found in meanwhile ?"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1525806399, "creation_date": 1525806399, "answer_id": 50240715, "question_id": 50239543, "link": "https://stackoverflow.com/questions/50239543/split-element-on-line-break-with-goquery/50240715#50240715", "title": "Split element on line break with GoQuery", "body": "<p>I ran the code you showed, and I am getting newlines in the string.  Assuming you are on the latest version of goquery you should be as well, <em>unless</em> your html is not</p>\n\n<pre><code>&lt;p&gt;\n    Line 1&lt;br /&gt;\n    Line 2&lt;br /&gt;\n    Line 3&lt;br /&gt;\n    Line 4&lt;br /&gt;\n    Line N\n&lt;/p&gt;\n</code></pre>\n\n<p>but is actually something like:</p>\n\n<pre><code>&lt;p&gt;\n    Line 1&lt;br /&gt;Line 2&lt;br /&gt;Line 3&lt;br /&gt;Line 4&lt;br /&gt;Line N\n&lt;/p&gt;\n</code></pre>\n\n<p>(keeping in mind that when you open chrome dev tools, for example, it is probably <em>displaying it</em> as the former, even if the actual source is that latter)</p>\n\n<p>in which case, this is expected behaviour:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>let html_1 = $(`&lt;p&gt;\r\n        Line 1&lt;br /&gt;\r\n        Line 2&lt;br /&gt;\r\n        Line 3&lt;br /&gt;\r\n        Line 4&lt;br /&gt;\r\n        Line N\r\n    &lt;/p&gt;`);\r\n\r\nlet html_2 = $(`&lt;p&gt;\r\n        Line 1&lt;br /&gt;Line 2&lt;br /&gt;Line 3&lt;br /&gt;Line 4&lt;br /&gt;Line N\r\n    &lt;/p&gt;`);\r\n    \r\nconsole.log({html1: html_1.text(), html2: html_2.text()});</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"&gt;&lt;/script&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>To resolve, you could probably just do:  </p>\n\n<pre><code>p := s.Find(\"li p\").Next()\np.SetHtml(strings.Replace(p.Html(), \"&lt;br /&gt;\", \"&lt;br /&gt;\\n\", -1)).Text()\n</code></pre>\n\n<p>although, you may have to play with whether to use <code>&lt;br/&gt;</code> or <code>&lt;br /&gt;</code> or <code>&lt;br&gt;</code> as I'm not sure how it will render it.</p>\n"}, {"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 1, "last_activity_date": 1525808436, "creation_date": 1525808436, "answer_id": 50241166, "question_id": 50239543, "link": "https://stackoverflow.com/questions/50239543/split-element-on-line-break-with-goquery/50241166#50241166", "title": "Split element on line break with GoQuery", "body": "<p><code>.Text()</code> will:</p>\n\n<blockquote>\n  <p>Text gets the combined text contents of each element in the set of\n  matched elements, including their descendants.</p>\n</blockquote>\n\n<p>So what you actually want to do is get the contents and the filter out any br tags.  As dave's answer states there is new line characters in there so I've also trimmed those:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/PuerkitoBio/goquery\"\n    \"strings\"\n)\n\nvar input string = `\n&lt;ul&gt;\n    &lt;li&gt;I'm skipped&lt;/li&gt;\n\n    &lt;li&gt; \n        Text Into  - &lt;p&gt;Whatever&lt;/p&gt;\n        &lt;p&gt;\n            Line 1&lt;br /&gt;\n            Line 2&lt;br /&gt;\n            Line 3&lt;br /&gt;\n            Line 4&lt;br /&gt;\n            Line N\n        &lt;/p&gt;\n    &lt;/li&gt; \n&lt;/ul&gt;\n`\n\nfunc main() {\n    doc, err := goquery.NewDocumentFromReader(strings.NewReader(input))\n    if err != nil {\n        panic(err)\n    }\n\n    doc.Find(\"ul\").Each(func(i int, s *goquery.Selection) {\n\n        p := s.Find(\"li p\").Next()\n        p.Contents().Each(func(i int, s *goquery.Selection) {\n            if !s.Is(\"br\") {\n                fmt.Println(strings.TrimSpace(s.Text()), \"--\")\n            }\n\n        })\n\n    })\n}\n</code></pre>\n\n<p>Produces:</p>\n\n<pre><code>Line 1 --\nLine 2 --\nLine 3 --\nLine 4 --\nLine N --\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 5938316, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-U6WkdZKODP0/AAAAAAAAAAI/AAAAAAAAAC4/aWt9RrsdDfs/photo.jpg?sz=128", "display_name": "khanh tran", "link": "https://stackoverflow.com/users/5938316/khanh-tran"}, "is_accepted": false, "score": 0, "last_activity_date": 1559615960, "creation_date": 1559615960, "answer_id": 56436702, "question_id": 50239543, "link": "https://stackoverflow.com/questions/50239543/split-element-on-line-break-with-goquery/56436702#56436702", "title": "Split element on line break with GoQuery", "body": "<p>I think it could be better if you just replace <code>&lt;br/&gt;</code> with '\\n' or '--' before your call <code>.Text()</code> method.</p>\n\n<pre><code>    // html is the result of `.Html()` method\n    str := strings.Replace(html, \"&lt;br/&gt;\", \"\\\\n\", -1)\n    doc, err := goquery.NewDocumentFromReader(strings.NewReader(str))\n    if err != nil {\n        return \"\"\n    }\n    return doc.Text()\n</code></pre>\n"}], "owner": {"reputation": 7985, "user_id": 3918577, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/cfZLg.jpg?s=128&g=1", "display_name": "Belmin Bedak", "link": "https://stackoverflow.com/users/3918577/belmin-bedak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 0, "accepted_answer_id": 50241166, "answer_count": 4, "score": 0, "last_activity_date": 1559615960, "creation_date": 1525801900, "question_id": 50239543, "link": "https://stackoverflow.com/questions/50239543/split-element-on-line-break-with-goquery", "title": "Split element on line break with GoQuery", "body": "<p>I'm trying to get content from page with GoQuery, but for some reasons I can't do split on line break (br).</p>\n\n<p>The HTML, looks like this:</p>\n\n<pre><code>&lt;ul&gt;\n    &lt;li&gt;I'm skipped&lt;/li&gt;\n\n    &lt;li&gt; \n        Text Into  - &lt;p&gt;Whatever&lt;/p&gt;\n        &lt;p&gt;\n            Line 1&lt;br /&gt;\n            Line 2&lt;br /&gt;\n            Line 3&lt;br /&gt;\n            Line 4&lt;br /&gt;\n            Line N\n        &lt;/p&gt;\n    &lt;/li&gt; \n&lt;/ul&gt;\n</code></pre>\n\n<p>Go code:</p>\n\n<pre><code>doc, err := goquery.NewDocumentFromReader(res.Body)\nif err != nil {\n    panic(err)\n}\n\ndoc.Find(\"ul\").Each(func(i int, s *goquery.Selection) {\n\n    str := s.Find(\"li p\").Next().Text()\n\n    fmt.Println(str, \"--\")\n\n})\n</code></pre>\n\n<p>For some reason I'm not able to get each line, separated by break in p tag, as single item.Output of code above is:</p>\n\n<pre><code>Line1Line2Line3Line4LineN--\n</code></pre>\n\n<p>But the output I'm trying to achieve should looks like this:</p>\n\n<pre><code>Line1--\nLine2--\nLine3--\nLine4--\nLineN--\n</code></pre>\n\n<p>Since I'm Go newbie, please let me know in comment If something is not clear, so I will try to explain It as much as I know.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525798415, "post_id": 50238439, "comment_id": 87494641, "body": "Not sure as I&#39;m not a user of pgx, but looking at the docs I think you can use <a href=\"https://godoc.org/github.com/jackc/pgx#FieldDescription.Type\" rel=\"nofollow noreferrer\">godoc.org/github.com/jackc/pgx#FieldDescription.Type</a> with <a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#New</a> and <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Value.Interface</a> to populate <code>valuePtrs</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525799050, "post_id": 50238439, "comment_id": 87494944, "body": "... here&#39;s an untested example so I&#39;m unsure if it will work or not: <a href=\"https://play.golang.org/p/q21zjeCaYh9\" rel=\"nofollow noreferrer\">play.golang.org/p/q21zjeCaYh9</a>"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1525800255, "post_id": 50238439, "comment_id": 87495580, "body": "Maybe you can find some clues here (not pqx) <a href=\"https://stackoverflow.com/questions/50075134/how-to-append-last-sql-row-to-a-list-without-replacing-previous-rows-in-golang\" title=\"how to append last sql row to a list without replacing previous rows in golang\">stackoverflow.com/questions/50075134/&hellip;</a>"}, {"owner": {"reputation": 1223, "user_id": 912604, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f33f1893b99937cce85350420d921cd4?s=128&d=identicon&r=PG&f=1", "display_name": "Sviatoslav", "link": "https://stackoverflow.com/users/912604/sviatoslav"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525804222, "post_id": 50238439, "comment_id": 87497581, "body": "@mkopriva, it works! Thanks a lot! Add an answer and I&#39;ll approve it."}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552683581, "post_id": 50240425, "comment_id": 97119577, "body": "This doesn&#39;t seem to work for any extended types, like UUID or datetime?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552684155, "post_id": 50240425, "comment_id": 97119796, "body": "@BZapper What types are you referring to? Do you mean this <a href=\"https://godoc.org/github.com/jackc/pgx/pgtype#UUID\" rel=\"nofollow noreferrer\">UUID</a> type? And what about datetime? There does not seem to be such a type in the pgx package..."}, {"owner": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552684439, "post_id": 50240425, "comment_id": 97119901, "body": "sorry, meant timestamptz and UUID. They seem to get ignored and return nil value per my test."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552686223, "post_id": 50240425, "comment_id": 97120495, "body": "@BZapper I don&#39;t have pgx installed so I cannot debug this myself. You&#39;ll have to play around with it a bit to find the problem. If you haven&#39;t tried yet, start by looking at what the <code>fieldDescriptions[i].Type()</code> expression returns. I believe it should return a <code>reflect.Type</code> representation of <code>pgtype.UUID</code> and <code>pgtype.Timestamptz</code>, that is if the respecitve columns have those types of course... If it doesn&#39;t return that then the cause of your problem will be in pgx&#39;s source. If it does return that then the problem might be in the <code>range columns</code> loop..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552686238, "post_id": 50240425, "comment_id": 97120499, "body": "Looking at the source of the <code>Type</code> method it does seem like it&#39;s not checking for UUID, so that could be the reasonn why that doesn&#39;t work as expected, however it does seem to check for Timestamptz so I&#39;m not sure what&#39;s going on. But you can try to handle the two types yourself if you want by extending the above snippet by a few lines."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552686242, "post_id": 50240425, "comment_id": 97120501, "body": "First you&#39;ll need to inspect the <code>fieldDescription</code> datatype to allocate the correct type for scanning, then, you need to choose the correct way how you want those types to be marshaled into json, this is because pgtype.UUID and pgtype.Timestamptz do not implement the json.Marshaler interface so you will have to decide for yourself how to marshal values of those type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1552686378, "post_id": 50240425, "comment_id": 97120548, "body": "@BZapper here&#39;s an example <a href=\"https://play.golang.com/p/RbKe7DZWStq\" rel=\"nofollow noreferrer\">play.golang.com/p/RbKe7DZWStq</a> but keep in mind that I haven&#39;t tested the code, there may be logical errors there, so go through it carefully and if it compiles then just modify it to fit your solution. If this doesn&#39;t help then unfortunately I don&#39;t know what else could. I&#39;m too lazy to install the package and debug it myself."}, {"owner": {"reputation": 393, "user_id": 1427944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/EbLj0.jpg?s=128&g=1", "display_name": "Abhijit Gujar", "link": "https://stackoverflow.com/users/1427944/abhijit-gujar"}, "edited": false, "score": 0, "creation_date": 1611735258, "post_id": 50240425, "comment_id": 116543037, "body": "I cannot resolve this error &quot;fieldDescriptions[i].Type undefined (type pgproto3.FieldDescription has no field or method Type)&quot; version compatibility  issues ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 393, "user_id": 1427944, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/EbLj0.jpg?s=128&g=1", "display_name": "Abhijit Gujar", "link": "https://stackoverflow.com/users/1427944/abhijit-gujar"}, "edited": false, "score": 0, "creation_date": 1611819874, "post_id": 50240425, "comment_id": 116574090, "body": "@AbhijitGujar if you want to use the above approach you&#39;ll have to switch to <code>pgx&#47;v3</code> or lower. <code>pgx&#47;v4</code> uses the new <code>pgproto3.FieldDescription</code> which does not have the <code>Type() reflect.Type</code> method anymore."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1525805372, "creation_date": 1525805372, "answer_id": 50240425, "question_id": 50238439, "link": "https://stackoverflow.com/questions/50238439/how-to-convert-pgx-rows-from-query-to-json-array/50240425#50240425", "title": "How to convert pgx.Rows from Query() to json array?", "body": "<p>You can use the <a href=\"https://godoc.org/github.com/jackc/pgx#FieldDescription\" rel=\"nofollow noreferrer\"><code>pgx.FieldDescription</code></a>'s <a href=\"https://godoc.org/github.com/jackc/pgx#FieldDescription.Type\" rel=\"nofollow noreferrer\"><code>Type</code></a> method to retrieve a column's expected type. Passing that to <a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\"><code>reflect.New</code></a> you can then allocate a pointer to a value of that type, and with these newly allocated values you can then make a slice of non-nil <code>interface{}s</code> whose underlying values have the expected type.</p>\n\n<p>For example:</p>\n\n<pre><code>func PgSqlRowsToJson(rows *pgx.Rows) []byte {\n    fieldDescriptions := rows.FieldDescriptions()\n    var columns []string\n    for _, col := range fieldDescriptions {\n        columns = append(columns, col.Name)\n    }\n\n    count := len(columns)\n    tableData := make([]map[string]interface{}, 0)\n\n    valuePtrs := make([]interface{}, count)\n    for rows.Next() {\n        for i := 0; i &lt; count; i++ {\n            valuePtrs[i] = reflect.New(fieldDescriptions[i].Type()).Interface() // allocate pointer to type\n        }\n        rows.Scan(valuePtrs...)\n\n        entry := make(map[string]interface{})\n        for i, col := range columns {\n            var v interface{}\n            val := reflect.ValueOf(valuePtrs[i]).Elem().Interface() // dereference pointer\n            b, ok := val.([]byte)\n            if ok {\n                v = string(b)\n            } else {\n                v = val\n            }\n            entry[col] = v\n        }\n        tableData = append(tableData, entry)\n    }\n    jsonData, _ := json.Marshal(tableData)\n\n    return jsonData\n}\n</code></pre>\n"}], "owner": {"reputation": 1223, "user_id": 912604, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f33f1893b99937cce85350420d921cd4?s=128&d=identicon&r=PG&f=1", "display_name": "Sviatoslav", "link": "https://stackoverflow.com/users/912604/sviatoslav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1693, "favorite_count": 1, "accepted_answer_id": 50240425, "answer_count": 1, "score": 2, "last_activity_date": 1525805372, "creation_date": 1525797398, "question_id": 50238439, "link": "https://stackoverflow.com/questions/50238439/how-to-convert-pgx-rows-from-query-to-json-array", "title": "How to convert pgx.Rows from Query() to json array?", "body": "<p>I'm using <code>github.com/jackc/pgx</code> for work with postgreSQL.\nNoq I want to convert pgx.Rows from Query() to json array.\nI tried func for <code>*sql.Rows</code>, but it doesn't work for <code>*pgx.Rows</code></p>\n\n<pre><code>func PgSqlRowsToJson(rows *pgx.Rows) []byte {\n   fieldDescriptions := rows.FieldDescriptions()\n   var columns []string\n   for _, col := range fieldDescriptions {\n    columns = append(columns, col.Name)\n   }\n\n   count := len(columns)\n   tableData := make([]map[string]interface{}, 0)\n   values := make([]interface{}, count)\n   valuePtrs := make([]interface{}, count)\n   for rows.Next() {\n    for i := 0; i &lt; count; i++ {\n        valuePtrs[i] = &amp;values[i]\n    }\n    rows.Scan(valuePtrs...)\n    entry := make(map[string]interface{})\n    for i, col := range columns {\n        var v interface{}\n        val := values[i]\n        b, ok := val.([]byte)\n        if ok {\n            v = string(b)\n        } else {\n            v = val\n        }\n        entry[col] = v\n    }\n    tableData = append(tableData, entry)\n   }\n   jsonData, _ := json.Marshal(tableData)\n\n   return jsonData\n}\n</code></pre>\n\n<p>The problem is that <code>Scan()</code> doesn't work with <code>interface{}</code> and it works with explicitly defined types only.\nCan you help me how to fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1525799154, "post_id": 50238388, "comment_id": 87494998, "body": "I don&#39;t think it&#39;s specified, but you can see the implementation in <code>runtime&#47;chan.go</code>, senders and receivers are queued in a linked list. Servicing the senders in order is logical, but the order that your goroutines are queued up is almost always non-deterministic, so reasoning about this isn&#39;t usually useful. What problem are you trying to solve?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1525802267, "post_id": 50238388, "comment_id": 87496512, "body": "Asking this question at all is somewhat worrisome - code should not depend on the order of execution of concurrent operations. If the order of operation is important, the code should be synchronized."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525803398, "post_id": 50238388, "comment_id": 87497108, "body": "awesome @JimB I would be happy to accept your comment as an answer if you feel like posting it? I couldn&#39;t imagine a better answer! it&#39;s exactly what i was wondering, thank you"}, {"owner": {"reputation": 5205, "user_id": 118201, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3332136bbcc2736f3d2118dfd7d98a15?s=128&d=identicon&r=PG", "display_name": "eSniff", "link": "https://stackoverflow.com/users/118201/esniff"}, "edited": false, "score": 0, "creation_date": 1525918801, "post_id": 50238388, "comment_id": 87547093, "body": "I played around with this a while back, it may be of interest to you: <a href=\"https://github.com/lytics/toolbucket/tree/master/orderedtask\" rel=\"nofollow noreferrer\">github.com/lytics/toolbucket/tree/master/orderedtask</a>  I don&#39;t maintain it, so take it as an example only."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1525805089, "last_edit_date": 1525805089, "creation_date": 1525804329, "answer_id": 50240158, "question_id": 50238388, "link": "https://stackoverflow.com/questions/50238388/golang-multiple-channel-write-receive-ordering/50240158#50240158", "title": "Golang Multiple Channel Write/Receive Ordering", "body": "<p>The order that goroutines blocked on a send operation are serviced is not defined, but it's implemented as a FIFO. You can see the implementation in <a href=\"https://golang.org/src/runtime/chan.go\" rel=\"nofollow noreferrer\">runtime/chan.go</a>, which uses a linked list to track the channel's senders and receivers.</p>\n\n<p>We can try to make an example showing the effective ordering like so:</p>\n\n<pre><code>func main() {\n    ch := make(chan int)\n    ready := make(chan int)\n\n    for i := 0; i &lt; 10; i++ {\n        i := i\n        go func() {\n            ready &lt;- 1\n            ch &lt;- i\n        }()\n        &lt;-ready\n        runtime.Gosched()\n    }\n\n    for i := 0; i &lt; 10; i++ {\n        v := &lt;-ch\n        if i != v {\n            panic(\"out of order!\")\n        }\n        fmt.Println(v)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/u0ukR-5Ptw4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/u0ukR-5Ptw4</a></p>\n\n<p>This still isn't technically correct, because there's no way to observe blocking on a send operation, so there's still a race between the <code>ready</code> send and the send to <code>ch</code> on the next line. We can try to eliminate that with the <code>runtime.Gosched</code> call here, or even a <code>time.Sleep</code>, but without explicit synchronization there's no guarantee of a <a href=\"https://golang.org/ref/mem#tmp_2\" rel=\"nofollow noreferrer\">\"happens before\"</a> relationship.</p>\n\n<p>Regardless, this queues up the goroutines and shows the expected output order, and if they weren't queued up already, it would be more likely to process the values out of order.</p>\n\n<p>You can see by this example that we can't truly determine the order that the goroutines are queued up, it is almost always non-deterministic, and therefore reasoning about this isn't usually useful in practice.</p>\n"}], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 0, "accepted_answer_id": 50240158, "answer_count": 1, "score": 1, "last_activity_date": 1525805089, "creation_date": 1525797226, "last_edit_date": 1525798352, "question_id": 50238388, "link": "https://stackoverflow.com/questions/50238388/golang-multiple-channel-write-receive-ordering", "title": "Golang Multiple Channel Write/Receive Ordering", "body": "<p>My specific issue is that I have an unbuffered channel and am spawning multiple goroutines bounded with a semaphore to perform work:</p>\n\n<pre><code>func main() {\n    sem := make(chan struct{}, 10) // allow ten concurrent parsers\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    DoSomething(\"http://example.com\", sem, wg)\n\n    wg.Wait()\n    // all done\n}\n\nfunc DoSomething(u string, sem chan struct{}, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    sem &lt;- struct{}{}        // grab\n    defer func() { &lt;-sem }() // release\n\n\n    var newSomethings []string\n\n    // ...\n\n    for u := range newSomethings {\n        wg.Add(1)\n        go DoSomething(u)\n    }\n}\n</code></pre>\n\n<p>If there are multiple <code>DoSomething</code> goroutines on the stack, blocked on the <code>sem</code> write (or inversely on a read) When a write happens is there any ordering to which go routine gets through with the write?? I would guess it were random but I could imagine:</p>\n\n<ul>\n<li>it is random</li>\n<li>writes/receives happen in the order they are registered</li>\n<li>implementation dependent</li>\n</ul>\n\n<p>I looked at a couple of resources and was unable to find a solution:</p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/247\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/247</a></li>\n<li><a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Receive_operator</a></li>\n<li><a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Channel_types</a></li>\n</ul>\n\n<p>I'm wondering if this is undefined and/or implementation dependent, or if this logic is located and defined somewhere within go core?</p>\n"}, {"tags": ["go", "protocol-buffers", "dialogflow-es"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787142, "post_id": 50235049, "comment_id": 87487672, "body": "implement unmarshaler interface to fetch the data from json you need"}, {"owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787217, "post_id": 50235049, "comment_id": 87487730, "body": "data returned could be in any format there is no structure"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787336, "post_id": 50235049, "comment_id": 87487817, "body": "<code>message</code> key and <code>StringValue</code> key will not going to change right ?"}, {"owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787466, "post_id": 50235049, "comment_id": 87487914, "body": "<code>messages</code> will not change it will always contain a list of unknown objects"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787583, "post_id": 50235049, "comment_id": 87487990, "body": "use interface{} for that and get the value from deep until string not found"}, {"owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787634, "post_id": 50235049, "comment_id": 87488016, "body": "sorry I don&#39;t understand what I should do"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525787783, "post_id": 50235049, "comment_id": 87488124, "body": "This link <a href=\"https://stackoverflow.com/questions/48167286/golang-json-and-slices-of-interface/48169341#48169341\" title=\"golang json and slices of interface\">stackoverflow.com/questions/48167286/&hellip;</a> might help to get the value from nested json with unknown objects."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "edited": false, "score": 0, "creation_date": 1525787963, "post_id": 50235049, "comment_id": 87488258, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/170623/discussion-between-himanshu-and-kskyriacou\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "is_accepted": false, "score": 1, "last_activity_date": 1525931828, "last_edit_date": 1525931828, "creation_date": 1525789493, "answer_id": 50235989, "question_id": 50235049, "link": "https://stackoverflow.com/questions/50235049/protocol-buffer-serialization-golang/50235989#50235989", "title": "Protocol buffer serialization Golang", "body": "<p>This can be solved using <a href=\"https://godoc.org/github.com/golang/protobuf/jsonpb\" rel=\"nofollow noreferrer\">jsonpb</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n\n    \"github.com/golang/protobuf/jsonpb\"\n)\n\nfunc main() {\n    ...\n\n    payload := qr.GetWebhookPayload()\n    b, marshaler := bytes.Buffer{}, jsonpb.Marshaler{}\n    if err := marshaler.Marshal(&amp;b, payload.GetFields()[\"messages\"]); err != nil {\n        // handle err\n    }\n\n    msgs := []interface{}{}\n    if err := json.Unmarshal(b.Bytes(), &amp;msgs); err != nil {\n        // handle err\n    }\n\n    // msgs now populated\n}\n</code></pre>\n"}], "owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1226, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1525931828, "creation_date": 1525786768, "question_id": 50235049, "link": "https://stackoverflow.com/questions/50235049/protocol-buffer-serialization-golang", "title": "Protocol buffer serialization Golang", "body": "<p>I am using <a href=\"https://godoc.org/google.golang.org/genproto/googleapis/cloud/dialogflow/v2\" rel=\"nofollow noreferrer\">DialogFlow V2 official GoLang SDK</a>. In my webhook, I am returning a payload, which I'm obtaining using the function <a href=\"https://godoc.org/google.golang.org/genproto/googleapis/cloud/dialogflow/v2#QueryResult.GetWebhookPayload\" rel=\"nofollow noreferrer\">GetWebhookPayload()</a>.</p>\n\n<p>This returns <a href=\"https://godoc.org/github.com/golang/protobuf/ptypes/struct#Struct\" rel=\"nofollow noreferrer\">*google_protobuf4.Struct</a>. I would like to turn this struct into a <code>map[string]interface{}</code>. How is this possible?</p>\n\n<p>This is what the struct looks like when serialized:</p>\n\n<pre><code>\"payload\": {\n        \"fields\": {\n            \"messages\": {\n                \"Kind\": {\n                    \"ListValue\": {\n                        \"values\": [\n                            {\n                                \"Kind\": {\n                                    \"StructValue\": {\n                                        \"fields\": {\n                                            \"title\": {\n                                                \"Kind\": {\n                                                    \"StringValue\": \"Hi! How can I help?\"\n                                                }\n                                            },\n                                            \"type\": {\n                                                \"Kind\": {\n                                                    \"StringValue\": \"message\"\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        ]\n                    }\n                }\n            }\n        }\n</code></pre>\n\n<p>What I essentially need is for it to be serialized as such:</p>\n\n<pre><code>\"payload\": {\n    \"messages\": [\n        {\n            \"title\": \"Hi! How can I help?\",\n            \"type\": \"message\"\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1525782144, "post_id": 50233487, "comment_id": 87484402, "body": "I don&#39;t believe this is defined in the spec, so the technical answer would be &quot;it&#39;s implementation-dependent.&quot;"}, {"owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 1, "creation_date": 1525782695, "post_id": 50233487, "comment_id": 87484769, "body": "Are you sure you provided correct example? Both print 32 for me. What is printing 0 i \t<code>s := make([]byte, 0)</code>"}, {"owner": {"reputation": 7, "user_id": 7270463, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4lnWg.jpg?s=128&g=1", "display_name": "liyuan35023", "link": "https://stackoverflow.com/users/7270463/liyuan35023"}, "reply_to_user": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 0, "creation_date": 1525783558, "post_id": 50233487, "comment_id": 87485297, "body": "@jedruniu yeah,i&#39;m sure. I tried in the golang playground. <a href=\"http://play.golang.org/p/pl_BwZTBTS_H\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 1, "creation_date": 1525784687, "post_id": 50233487, "comment_id": 87485990, "body": "Sure, but where do you see in this particular playground <code>32</code>?"}, {"owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 0, "creation_date": 1525784737, "post_id": 50233487, "comment_id": 87486020, "body": "Ok, now i Can see it."}, {"owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 0, "creation_date": 1525785135, "post_id": 50233487, "comment_id": 87486289, "body": "Maybe it&#39;s just some shortcut, or bug, look here, for sure this slice has 0 capacity: <a href=\"https://play.golang.org/p/LGp8vpV1_ms\" rel=\"nofollow noreferrer\">play.golang.org/p/LGp8vpV1_ms</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1525785592, "post_id": 50233487, "comment_id": 87486571, "body": "yes, the go compiler definitely does a lot of optimizations: <a href=\"https://github.com/golang/go/wiki/CompilerOptimizations\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/CompilerOptimizations</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1525785926, "post_id": 50234619, "comment_id": 87486794, "body": "it is not an issue, it is an compiler optimization."}], "tags": [], "owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "is_accepted": false, "score": 0, "last_activity_date": 1525785484, "creation_date": 1525785484, "answer_id": 50234619, "question_id": 50233487, "link": "https://stackoverflow.com/questions/50233487/what-is-the-byte-default-capacity/50234619#50234619", "title": "What is the []byte(&quot;&quot;) default capacity?", "body": "<p>It is 0, you have found something peculiar, maybe worth reporting as an issue,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc main() {\n    s := []byte{}\n    hdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s))\n    fmt.Printf(\"%#v\\n\", hdr)\n\n    d := make([]byte, 0)\n    hdr = (*reflect.SliceHeader)(unsafe.Pointer(&amp;d))\n    fmt.Printf(\"%#v\\n\", hdr)\n\n    a := []byte(\"\")\n    hdr = (*reflect.SliceHeader)(unsafe.Pointer(&amp;a))\n    fmt.Printf(\"%#v\\n\", hdr)    \n}\n</code></pre>\n\n<p>This always show that capacity is 0. </p>\n"}], "owner": {"reputation": 7, "user_id": 7270463, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4lnWg.jpg?s=128&g=1", "display_name": "liyuan35023", "link": "https://stackoverflow.com/users/7270463/liyuan35023"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "closed_date": 1525787507, "answer_count": 1, "score": -1, "last_activity_date": 1525785484, "creation_date": 1525781974, "question_id": 50233487, "link": "https://stackoverflow.com/questions/50233487/what-is-the-byte-default-capacity", "closed_reason": "Duplicate", "title": "What is the []byte(&quot;&quot;) default capacity?", "body": "<pre><code>s := []byte(\"\")\nfmt.Println(cap(s))  //32\n</code></pre>\n\n<p>but</p>\n\n<pre><code>s := []byte(\"\")\nfmt.Println(cap(s))  //0\nfmt.Println(s)\n</code></pre>\n\n<p>Is the compiler does some optimizations?</p>\n"}, {"tags": ["json", "go", "reflection"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1525781750, "post_id": 50233285, "comment_id": 87484142, "body": "Why not just use the standard <code>json</code> package, and unmarshal into a struct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525782646, "post_id": 50233285, "comment_id": 87484735, "body": "There&#39;s nothing in Go that would allow you to do what you want and how you want because Go is a statically typed langauge, <code>myType</code> has to be known at compile time. The most &quot;dynamic&quot; version you can get is to use <code>interface{}</code>, otherwise you&#39;ll have to know the type beforehand and allocate a map from that. If you want jsoncpp like functionality, Go may not be the language for that... The next best thing is to implement getter methods on a custom map type, e.g. MyMap.GetString(&quot;key.subKey1[0].subKey2&quot;), you can find such implementations on github."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525787783, "post_id": 50233285, "comment_id": 87488123, "body": "@TTKDroid, just to add a bit of clarification to my previous comment, you <i>can</i> use <code>reflect</code> to create a map of any given type, nested to whatever depth. But to be able to use it how you want will not be possible, you&#39;ll always have to do type assertion on the map value. That is, you can create <code>myMap</code> with <code>reflect</code> but you cannot do this <code>myMap[&quot;KEY&quot;] = i</code> nor this <code>myMap[&quot;key&quot;][&quot;subKey1&quot;][0][&quot;subKey2&quot;]</code> without first doing <code>myMap.(T)</code>."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1525816419, "post_id": 50233285, "comment_id": 87503223, "body": "It is possible to create a map dynamically of any key/value type dynamically"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525818393, "post_id": 50233285, "comment_id": 87503808, "body": "As @mkopriva stated in order to make a dynamic map usable, you would still need to build a wrapper around it  i.e: <a href=\"https://github.com/viant/toolbox/tree/master/data\" rel=\"nofollow noreferrer\">github.com/viant/toolbox/tree/master/data</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1525817453, "creation_date": 1525817453, "answer_id": 50242960, "question_id": 50233285, "link": "https://stackoverflow.com/questions/50233285/create-a-map-in-go-using-reflection/50242960#50242960", "title": "create a map in Go using reflection", "body": "<p>Here is example to how to create dynamic map.</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    var key = \"key1\"\n    var value = 123\n\n    var keyType = reflect.TypeOf(key)\n    var valueType = reflect.TypeOf(value)\n    var aMapType = reflect.MapOf(keyType, valueType)\n    aMap := reflect.MakeMapWithSize(aMapType, 0)\n    aMap.SetMapIndex(reflect.ValueOf(key), reflect.ValueOf(value))\n    fmt.Printf(\"%T:  %v\\n\", aMap.Interface(), aMap.Interface())\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "edited": false, "score": 0, "creation_date": 1525881663, "post_id": 50244556, "comment_id": 87533061, "body": "Thanks mate! Will try that one as well!"}], "tags": [], "owner": {"reputation": 175, "user_id": 6249688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/465ae66ea36ea277d33528789e9cab3d?s=128&d=identicon&r=PG&f=1", "display_name": "Blue Joy", "link": "https://stackoverflow.com/users/6249688/blue-joy"}, "is_accepted": false, "score": 3, "last_activity_date": 1525831916, "creation_date": 1525831916, "answer_id": 50244556, "question_id": 50233285, "link": "https://stackoverflow.com/questions/50233285/create-a-map-in-go-using-reflection/50244556#50244556", "title": "create a map in Go using reflection", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\n\n\nfunc main() {\n    key := 1\n    value := \"abc\"\n\n    mapType := reflect.MapOf(reflect.TypeOf(key), reflect.TypeOf(value))\n\n    mapValue := reflect.MakeMap(mapType)\n    mapValue.SetMapIndex(reflect.ValueOf(key), reflect.ValueOf(value))\n    mapValue.SetMapIndex(reflect.ValueOf(2), reflect.ValueOf(\"def\"))\n    mapValue.SetMapIndex(reflect.ValueOf(3), reflect.ValueOf(\"gh\"))\n\n    keys := mapValue.MapKeys()\n    for _, k := range keys {\n        c_key := k.Convert(mapValue.Type().Key())\n        c_value := mapValue.MapIndex(c_key)\n        fmt.Println(\"key :\", c_key, \" value:\", c_value)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2862, "favorite_count": 0, "accepted_answer_id": 50242960, "answer_count": 2, "score": 0, "last_activity_date": 1525831916, "creation_date": 1525781407, "question_id": 50233285, "link": "https://stackoverflow.com/questions/50233285/create-a-map-in-go-using-reflection", "title": "create a map in Go using reflection", "body": "<p>I'm just playing around trying to write a JSON reader wrapper in Golang that is pleasant to use like jsoncpp. Is it possible to create a map with a dynamic type in Golang?</p>\n\n<p>For instance:</p>\n\n<pre><code>package main\n\nimport  \"reflect\"\n\nfunc main() {\n    i := 1                       // type int\n    myType := reflect.TypeOf(i)  // type Type\n    a := make(map[string]myType) // make a map of Type\n    a[\"KEY\"] = i                 // Assign an int to the map\n}\n</code></pre>\n\n<p>Am I dreaming? </p>\n\n<p>Some people would say \"That's why Go have the type <code>interface{}</code>\", however, I don't want be doing something like this:</p>\n\n<pre><code>myMap[\"key\"].(map[string]string)[\"subKey1\"].([]map[string]interface)[\"subKey2\"].(int)\n</code></pre>\n\n<p>I want to do something like this:</p>\n\n<pre><code>myMap[\"key\"][\"subKey1\"][0][\"subKey2\"]\n</code></pre>\n\n<p>Perhaps a good soul have already coded a wrapper like this before but I couldn't find it anywhere</p>\n"}, {"tags": ["go", "tfs", "continuous-integration", "azure-devops", "tfsbuild"], "answers": [{"comments": [{"owner": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "edited": false, "score": 0, "creation_date": 1525843531, "post_id": 50245244, "comment_id": 87509501, "body": "Is there a way we can build using Command Line in build steps?"}, {"owner": {"reputation": 25359, "user_id": 5425825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb2be754626c633f6062ef8b9b0952f?s=128&d=identicon&r=PG&f=1", "display_name": "Cece Dong - MSFT", "link": "https://stackoverflow.com/users/5425825/cece-dong-msft"}, "reply_to_user": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "edited": false, "score": 0, "creation_date": 1525858596, "post_id": 50245244, "comment_id": 87517377, "body": "Yes, you need to have Go installed on the agent machine."}, {"owner": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "edited": false, "score": 0, "creation_date": 1525859853, "post_id": 50245244, "comment_id": 87518157, "body": "Yes I did install but I am unable to understand which &quot;Tool&quot; and &quot;Arguments&quot; to pass to command line to build Go app."}, {"owner": {"reputation": 25359, "user_id": 5425825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb2be754626c633f6062ef8b9b0952f?s=128&d=identicon&r=PG&f=1", "display_name": "Cece Dong - MSFT", "link": "https://stackoverflow.com/users/5425825/cece-dong-msft"}, "reply_to_user": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "edited": false, "score": 0, "creation_date": 1525937739, "post_id": 50245244, "comment_id": 87553387, "body": "You could refer to the VSTS build process template. It needs to run <code>go get</code> and <code>go build</code> commands."}], "tags": [], "owner": {"reputation": 25359, "user_id": 5425825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cb2be754626c633f6062ef8b9b0952f?s=128&d=identicon&r=PG&f=1", "display_name": "Cece Dong - MSFT", "link": "https://stackoverflow.com/users/5425825/cece-dong-msft"}, "is_accepted": false, "score": 1, "last_activity_date": 1525937692, "last_edit_date": 1525937692, "creation_date": 1525837739, "answer_id": 50245244, "question_id": 50231615, "link": "https://stackoverflow.com/questions/50231615/go-language-template-not-found-in-tfs-build-creation/50245244#50245244", "title": "Go Language template not found in TFS Build creation", "body": "<p>Go(preview) build template only exists in VSTS currently. You could test in VSTS by <a href=\"https://go.microsoft.com/fwlink/?LinkId=307137\" rel=\"nofollow noreferrer\">creating a VSTS account for free</a> temporarily. </p>\n\n<hr>\n\n<p>Add screenshots:</p>\n\n<p><a href=\"https://i.stack.imgur.com/5ddP1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5ddP1.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/TkEmE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TkEmE.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "is_accepted": true, "score": 1, "last_activity_date": 1527273260, "creation_date": 1527273260, "answer_id": 50535055, "question_id": 50231615, "link": "https://stackoverflow.com/questions/50231615/go-language-template-not-found-in-tfs-build-creation/50535055#50535055", "title": "Go Language template not found in TFS Build creation", "body": "<p>(Just in case you happen to stuck on same problem) I have managed to build Go App on my On-Premise TFS using Command line. Screen shot is below: (Add an empty process while setting up new build and then add command line in build step.)\n<a href=\"https://i.stack.imgur.com/mrzZz.jpg\" rel=\"nofollow noreferrer\">Click for the image</a></p>\n"}], "owner": {"reputation": 253, "user_id": 4296577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8Y8Ll.jpg?s=128&g=1", "display_name": "Meta-Coder", "link": "https://stackoverflow.com/users/4296577/meta-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 50535055, "answer_count": 2, "score": 1, "last_activity_date": 1527273260, "creation_date": 1525775957, "question_id": 50231615, "link": "https://stackoverflow.com/questions/50231615/go-language-template-not-found-in-tfs-build-creation", "title": "Go Language template not found in TFS Build creation", "body": "<p>As per microsoft <a href=\"https://docs.microsoft.com/en-us/vsts/build-release/apps/go/go?view=vsts&amp;tabs=github\" rel=\"nofollow noreferrer\" title=\"Microsoft guide for Build and Release for Go App\">documentation</a>, while creating a new build, a Go(Preview) template should be there. But no such template found for Go. I am using Microsoft Team Foundation Server (On-Premises) 2018. Please guide me what steps I need to perform to build my Go App using TFS on-premise?</p>\n\n<p><a href=\"https://i.stack.imgur.com/nI0Hc.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nI0Hc.jpg\" alt=\"No Template Found for GO\"></a></p>\n"}, {"tags": ["json", "mongodb", "go", "slice", "mgo"], "comments": [{"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525773470, "post_id": 50230483, "comment_id": 87478880, "body": "does <code>GetUsers</code> return <code>[]Users, error</code>?"}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525773657, "post_id": 50230483, "comment_id": 87479031, "body": "yes @Hadi , it returns an <code>array of Users</code> with an <code>error</code> to check , my problem is when inserting this <code>slice: UsersTotal</code> into my <code>mongoDB</code>"}, {"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525773751, "post_id": 50230483, "comment_id": 87479097, "body": "Hmm, please iterate over your array and then insert each of them. I think it&#39;ll work."}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525773848, "post_id": 50230483, "comment_id": 87479170, "body": "@Hadi you mean  like doing a range on the slice and try to iterate  on each row, it sounds to will effect on the runtime , i am handling with a huge result here"}, {"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525773989, "post_id": 50230483, "comment_id": 87479250, "body": "did that work for you @Data_Geek ?"}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1525774079, "post_id": 50230483, "comment_id": 87479314, "body": "@icza could you please give a help here ??"}, {"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525774203, "post_id": 50230483, "comment_id": 87479392, "body": "<code>MongoDB</code> is a document-oriented database which simply means you have to provide a document. What you are trying to do here is to insert an array of documents(<a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/method/&hellip;</a>). Maybe <code>mgo</code> has an api for dealing with this situation."}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525774486, "post_id": 50230483, "comment_id": 87479546, "body": "@Hadi yes i tried it , it works but here i meant to find a better why in using the package not a hard coded  looping"}, {"owner": {"reputation": 272, "user_id": 479736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71f5d13ef3d9ec2208d41df3415b9f34?s=128&d=identicon&r=PG", "display_name": "Andrei Simionescu", "link": "https://stackoverflow.com/users/479736/andrei-simionescu"}, "edited": false, "score": 0, "creation_date": 1525774536, "post_id": 50230483, "comment_id": 87479577, "body": "Additionally <code>mgo</code> is unmaintained <a href=\"https://github.com/go-mgo/mgo#this-is-unmaintained\" rel=\"nofollow noreferrer\">github.com/go-mgo/mgo#this-is-unmaintained</a>"}, {"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 1, "creation_date": 1525774784, "post_id": 50230483, "comment_id": 87479720, "body": "try this <code>cc.Insert(UsersTotal...)</code> @Data_Geek"}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 272, "user_id": 479736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71f5d13ef3d9ec2208d41df3415b9f34?s=128&d=identicon&r=PG", "display_name": "Andrei Simionescu", "link": "https://stackoverflow.com/users/479736/andrei-simionescu"}, "edited": false, "score": 0, "creation_date": 1525774810, "post_id": 50230483, "comment_id": 87479743, "body": "@AndreiSimionescu , clearly  i am trying to move on into golabsign as an updated mgo <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">globalsign</a>"}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "reply_to_user": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525774952, "post_id": 50230483, "comment_id": 87479822, "body": "@Hadi aleardy done  i got this error : ` cannot use UsersTotal (type []Users) as type []interface {} in argument to cc.Insert`"}, {"owner": {"reputation": 4120, "user_id": 760948, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/u7eow.jpg?s=128&g=1", "display_name": "Hadi", "link": "https://stackoverflow.com/users/760948/hadi"}, "edited": false, "score": 0, "creation_date": 1525775844, "post_id": 50230483, "comment_id": 87480354, "body": "@Data_Geek see <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "edited": false, "score": 0, "creation_date": 1525777669, "post_id": 50231566, "comment_id": 87481452, "body": "@Data_Geek If there is no error, then either you pass 0 documents to insert, or you look for the inserted documents in the wrong place (e.g. another db, another collection etc.). If everything seems to match, please edit the question and post the code you tried (including the error handling)."}, {"owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "edited": false, "score": 0, "creation_date": 1525778293, "post_id": 50231566, "comment_id": 87481855, "body": ",It was an error database switch , perfectly working thanks for the help :-)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1525776277, "last_edit_date": 1525776277, "creation_date": 1525775798, "answer_id": 50231566, "question_id": 50230483, "link": "https://stackoverflow.com/questions/50230483/insert-a-slice-result-json-into-mongodb/50231566#50231566", "title": "Insert a slice result JSON into MongoDB", "body": "<p>Inserting multiple documents is the same as inserting a single one because the <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Insert\" rel=\"nofollow noreferrer\"><code>Collection.Insert()</code></a> method has a variadic parameter:</p>\n\n<pre><code>func (c *Collection) Insert(docs ...interface{}) error\n</code></pre>\n\n<p>One thing you should note is that it expects <code>interface{}</code> values. Value of any type qualifies \"to be\" an <code>interface{}</code>. Another thing you should note is that only the slice type <code>[]interface{}</code> qualifies to be <code>[]interface{}</code>, a user slice <code>[]User</code> does not. For details, see <a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a></p>\n\n<p>So simply create a copy of your users slice where the copy has a type of <code>[]interface{}</code>, and that you can directly pass to <code>Collection.Insert()</code>:</p>\n\n<pre><code>docs := make([]interface{}, len(UsersTotal))\nfor i, u := range UsersTotal {\n    docs[i] = u\n}\n\nerr := cc.Insert(docs...)\n// Handle error\n</code></pre>\n\n<p>Also please do not connect to MongodB in your handler. Do it once, on app startup, store the global connection / session, and clone / copy it when needed. For details see <a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a>; and <a href=\"https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server/47180097#47180097\">too many open files in mgo go server</a>.</p>\n"}], "owner": {"reputation": 55, "user_id": 9720571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e8325675328aec44b7097ce088b0e5e?s=128&d=identicon&r=PG&f=1", "display_name": "Medo", "link": "https://stackoverflow.com/users/9720571/medo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 50231566, "answer_count": 1, "score": 1, "last_activity_date": 1525798526, "creation_date": 1525772221, "last_edit_date": 1525798526, "question_id": 50230483, "link": "https://stackoverflow.com/questions/50230483/insert-a-slice-result-json-into-mongodb", "title": "Insert a slice result JSON into MongoDB", "body": "<p>I'm using the <code>mgo</code> driver for MongoDB, with the Gin framework.</p>\n\n<pre><code>type  Users struct {\n    User_id *string  `json:\"id user\" bson:\"id user\"`\n    Images  []string `json:\"images\" bson:\"images\"`\n}\n</code></pre>\n\n<p>I have this function which tries to convert the slice into JSON.</p>\n\n<p>The slice here is <code>UsersTotal</code></p>\n\n<pre><code>func GetUsersApi(c *gin.Context) {\n\n    UsersTotal, err := GetUsers()\n\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        \"Count Users\": len(UsersTotal),\n        \"Users Found \": UsersTotal,\n    })\n\n\n    session, err := mgo.Dial(URL)\n    if err == nil {\n        fmt.Println(\"Connection to mongodb established ok!!\")\n        cc := session.DB(\"UsersDB\").C(\"results\")\n\n        err22 := cc.Insert(&amp;UsersTotal)\n        if err22 != nil {\n            fmt.Println(\"error insertion \", err22)\n        }\n    }\n    session.Close()\n   }\n</code></pre>\n\n<p>Running it I get the following error:</p>\n\n<p><code>error insertion  Wrong type for documents[0]. Expected a object, got a array.</code> </p>\n"}, {"tags": ["unit-testing", "go", "code-coverage"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1525775833, "post_id": 50229028, "comment_id": 87480348, "body": "No there is not. You need an external tool."}, {"owner": {"reputation": 2192, "user_id": 1107595, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9f43c090c500a639bdd28c090f573159?s=128&d=identicon&r=PG", "display_name": "BlueMagma", "link": "https://stackoverflow.com/users/1107595/bluemagma"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1525777549, "post_id": 50229028, "comment_id": 87481374, "body": "@Volker: Do you know of any external tool for that ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525780444, "post_id": 50229028, "comment_id": 87483226, "body": "Tool requests are off-topic. But I&#39;m not aware of any command-line tools that do that, but codecov.io will do that, but it&#39;s probably overkill for what you&#39;re seeking."}, {"owner": {"reputation": 2192, "user_id": 1107595, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9f43c090c500a639bdd28c090f573159?s=128&d=identicon&r=PG", "display_name": "BlueMagma", "link": "https://stackoverflow.com/users/1107595/bluemagma"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1525796815, "post_id": 50229028, "comment_id": 87493737, "body": "@volker : I&#39;d like to point out that &quot;no there is not&quot; is not an answer, as a matter of fact I did found a way to do it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525855299, "post_id": 50229028, "comment_id": 87515305, "body": "@BlueMagma: The answer you provide actually proves Volker&#39;s point. You had to build your own, external tool."}], "answers": [{"comments": [{"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 0, "creation_date": 1526273967, "post_id": 50238242, "comment_id": 87662269, "body": "Have you try <i>go test --coverprofile=coverage.out -coverpkg=./your/package/... ./your/package</i>. Notice that you need to specific the test run for just your root package not all (./...)"}], "tags": [], "owner": {"reputation": 2192, "user_id": 1107595, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9f43c090c500a639bdd28c090f573159?s=128&d=identicon&r=PG", "display_name": "BlueMagma", "link": "https://stackoverflow.com/users/1107595/bluemagma"}, "is_accepted": true, "score": 2, "last_activity_date": 1525796724, "creation_date": 1525796724, "answer_id": 50238242, "question_id": 50229028, "link": "https://stackoverflow.com/questions/50229028/how-to-get-a-global-test-coverage-for-a-folder/50238242#50238242", "title": "How to get a global test coverage for a folder?", "body": "<p>I found a solution to my problem.</p>\n\n<p>I first run the test on all package and store the test result in a file :</p>\n\n<pre><code>go test --coverprofile=coverage.out ./...\n</code></pre>\n\n<p>I then run a bash script to calculate my result</p>\n\n<pre><code>#!/usr/bin/env bash\n\ncovered=0\ntotal=0\nwhile IFS='' read -r line || [[ -n \"$line\" ]]; do\n    IFS=' ' read -r -a array &lt;&lt;&lt; \"$line\"\n    total=$(($total+${array[1]}))\n    if [ \"${array[2]}\" = \"1\" ]; then\n        covered=$(($covered+${array[1]}))\n    fi \ndone &lt; \"$1\"\necho $(awk \"BEGIN { pc=100*${covered}/${total}; i=int(pc); print (pc-i&lt;0.5)?i:i+1 }\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": false, "score": -1, "last_activity_date": 1526273763, "last_edit_date": 1526273763, "creation_date": 1525843376, "answer_id": 50246042, "question_id": 50229028, "link": "https://stackoverflow.com/questions/50229028/how-to-get-a-global-test-coverage-for-a-folder/50246042#50246042", "title": "How to get a global test coverage for a folder?", "body": "<p>You can have the coverage of all sub-packages without any external tools/ with:</p>\n\n<pre><code>go test --coverprofile=coverage.out -coverpkg=./your/package/... ./your/package\n</code></pre>\n\n<blockquote>\n<pre><code>-coverpkg pattern1,pattern2,pattern3\n    Apply coverage analysis in each test to packages matching the patterns.\n    The default is for each test to analyze only the package being tested.\n    See 'go help packages' for a description of package patterns.\n    Sets -cover.\n</code></pre>\n</blockquote>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Testing_flags</a></p>\n"}, {"comments": [{"owner": {"reputation": 395, "user_id": 1836683, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/gTIiy.jpg?s=128&g=1", "display_name": "Totalys", "link": "https://stackoverflow.com/users/1836683/totalys"}, "edited": false, "score": 1, "creation_date": 1595957960, "post_id": 61477358, "comment_id": 111652249, "body": "you got to create a ***_test.go file for each ***.go file you have with the package declaration even if you don&#39;t have any tests for that given file. Otherwise your metrics will not consider the file with no test and the cover percentage will not reflect your project."}], "tags": [], "owner": {"reputation": 1772, "user_id": 4706119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e597fc1530bb59898a572f5625417851?s=128&d=identicon&r=PG&f=1", "display_name": "hutabalian", "link": "https://stackoverflow.com/users/4706119/hutabalian"}, "is_accepted": false, "score": 3, "last_activity_date": 1588067546, "creation_date": 1588067546, "answer_id": 61477358, "question_id": 50229028, "link": "https://stackoverflow.com/questions/50229028/how-to-get-a-global-test-coverage-for-a-folder/61477358#61477358", "title": "How to get a global test coverage for a folder?", "body": "<p>After running: </p>\n\n<pre><code>go test --coverprofile=coverage.out ./...\n</code></pre>\n\n<p>Run: </p>\n\n<pre><code>go tool cover -func=coverage.out\n</code></pre>\n\n<p>You will see the total percentage at the end of the result</p>\n"}], "owner": {"reputation": 2192, "user_id": 1107595, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9f43c090c500a639bdd28c090f573159?s=128&d=identicon&r=PG", "display_name": "BlueMagma", "link": "https://stackoverflow.com/users/1107595/bluemagma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2046, "favorite_count": 0, "accepted_answer_id": 50238242, "answer_count": 3, "score": 1, "last_activity_date": 1588067546, "creation_date": 1525767333, "last_edit_date": 1525775113, "question_id": 50229028, "link": "https://stackoverflow.com/questions/50229028/how-to-get-a-global-test-coverage-for-a-folder", "title": "How to get a global test coverage for a folder?", "body": "<p>When showing code coverage, go test show code coverage for each package (in percentage).</p>\n\n<p>Is there a way to show a summary for a folder that is taking all subfolder (subpackage) into account? </p>\n\n<p>What I want is a global code coverage percentage for the full project, one number that show code coverage of the folder and all subfolders.</p>\n"}, {"tags": ["go", "proxy", "socks"], "comments": [{"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "edited": false, "score": 0, "creation_date": 1525808492, "post_id": 50229024, "comment_id": 87499803, "body": "a cool guy on #go-nuts in freenode showed me a solution to the deprecated Dial. still doesn&#39;t resolve the IKEv2 issue. <a href=\"https://play.golang.org/p/NfXO9STkFin\" rel=\"nofollow noreferrer\">play.golang.org/p/NfXO9STkFin</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526276263, "post_id": 50229024, "comment_id": 87662964, "body": "Are you absolutely 100% sure that you have an &quot;IKEv2&quot; certificate? You need to go triple check this. IKEv2 certificates are used to set up IPSec, which is something the OS does, in conjunction with an IPSec daemon such as strongswan. In no case would you put an IKEv2 certificate into your own application."}, {"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526312408, "post_id": 50229024, "comment_id": 87684549, "body": "@MichaelHampton - i&#39;m trying to connect to a paid ipsec vpn called nordvpn that uses IKEv2 certificate."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526319068, "post_id": 50229024, "comment_id": 87688041, "body": "OK, then you need to set up IPSec on your computer first."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1526335593, "post_id": 50229024, "comment_id": 87695574, "body": "@ufk what operating system are you on? Also can you post the actual error you get?"}, {"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "reply_to_user": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1526416654, "post_id": 50229024, "comment_id": 87734229, "body": "@voutasaurus - updated main post"}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1527622846, "post_id": 50229024, "comment_id": 88192865, "body": "On the context subquestion, the field Dial on http.Transport is deprecated in favor of DialContext but DialContext is not supported by golang.org/x/net/proxy. This seems like a problem that would be best addressed by the maintainers of golang.org/x/net/proxy by filing a bug report here: <a href=\"https://github.com/golang/go/issues\" rel=\"nofollow noreferrer\">github.com/golang/go/issues</a>"}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1527623776, "post_id": 50229024, "comment_id": 88193309, "body": "This isn&#39;t an answer but you might want to use the Proxy field on <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Transport</a> instead of the golang.org/x/net/proxy package. Here&#39;s an example: <a href=\"https://sourcegraph.com/github.com/golang/go@23b687eccbcc68f44acf34fd5971f0f5c04d90de/-/blob/src/net/http/transport_test.go#L962:1\" rel=\"nofollow noreferrer\">sourcegraph.com/github.com/golang/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "edited": false, "score": 0, "creation_date": 1526938118, "post_id": 50438076, "comment_id": 87927160, "body": "thank you for your answer. so even if I set the initial configuration there is no way to start and stop it programatically and to also decide which requests will go though the vpn and which won&#39;&#39;t ?"}], "tags": [], "owner": {"reputation": 1037, "user_id": 7081655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YuhOB.jpg?s=128&g=1", "display_name": "MK Vimalan", "link": "https://stackoverflow.com/users/7081655/mk-vimalan"}, "is_accepted": true, "score": 1, "last_activity_date": 1526840621, "creation_date": 1526840621, "answer_id": 50438076, "question_id": 50229024, "link": "https://stackoverflow.com/questions/50229024/connect-to-socks5-proxy-with-ikev2-certificate-using-golang-1-10-2/50438076#50438076", "title": "connect to socks5 proxy with IKEv2 certificate using golang 1.10.2", "body": "<p>I think you need to set up IPSec on your computer first.</p>\n\n<p><strong>The steps to setup IPSec</strong> </p>\n\n<ol>\n<li>Initial configurations (only once at the first time)</li>\n<li>Start a VPN connection</li>\n</ol>\n\n<p>Follow <a href=\"https://www.softether.org/4-docs/2-howto/9.L2TPIPsec_Setup_Guide_for_SoftEther_VPN_Server/5.Mac_OS_X_L2TP_Client_Setup\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 762, "favorite_count": 1, "accepted_answer_id": 50438076, "answer_count": 1, "score": 3, "last_activity_date": 1526840621, "creation_date": 1525767323, "last_edit_date": 1592644375, "question_id": 50229024, "link": "https://stackoverflow.com/questions/50229024/connect-to-socks5-proxy-with-ikev2-certificate-using-golang-1-10-2", "title": "connect to socks5 proxy with IKEv2 certificate using golang 1.10.2", "body": "<p>I use Go 1.10.2 for my client application.</p>\n<p>I'm trying to connect to a socks5 proxy that requires username, password and IKEv2 certificate file.</p>\n<p>this is what I've got so far:</p>\n<pre><code> func socks5(proxyAdress string, url string, user string, password string) {\n        auth := proxy.Auth{User: user, Password: password}\n        if proxy, err := proxy.SOCKS5(&quot;tcp&quot;, proxyAdress, &amp;auth, proxy.Direct);  err != nil {\n            log.Fatalf(&quot;error: %v&quot;, proxy)\n        } else {\n            tr := &amp;http.Transport{Dial: proxy.Dial}\n\n            // Create client\n            myClient := &amp;http.Client{\n                Transport: tr,\n            }\n\n            if resp, err2 := myClient.Get(url); err2 != nil {\n                log.Fatalf(&quot;error: %v&quot;, err2)\n            } else {\n                if bodyBytes, err3 := ioutil.ReadAll(resp.Body); err3 != nil {\n                    log.Fatalf(&quot;error: %v&quot;, err3)\n                } else {\n                    str := string(bodyBytes)\n                    log.Printf(str)\n                }\n\n            }\n        }\n    }\n</code></pre>\n<p>when I execute this function with the proper parameters</p>\n<p>I get an error from the server that I don't have permissions to access the web page I requested. that's because I didn't specify the IKEv2 key file.</p>\n<p>so.. first.. how do I do that ?</p>\n<p>and 2nd... <code>Dial</code> is deprecated.. I'm supposed to use <code>DialContext</code> but has no idea how</p>\n<p>thanks ! :)</p>\n<h1>update</h1>\n<p>the OS that I use is MacOS High Sierra 10.13.4</p>\n<p>the problem is that for example when I execute</p>\n<pre><code>socks5(&quot;il7.nordvpn.com:1080&quot;, &quot;http://ifconfig.me/ip&quot;,&quot;MY_USER&quot;,&quot;MY_PASS&quot;)\n</code></pre>\n<p>the error that I get is</p>\n<pre><code>2018/05/15 23:34:49 error: Get http://ifconfig.me/ip: socks connect tcp ifconfig.me:80-&gt;ifconfig.me:80: EOF\n</code></pre>\n<p>I don't know where to provide the IKEv2 certificate</p>\n"}, {"tags": ["go", "concurrency", "mutex", "race-condition"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1525760261, "post_id": 50225601, "comment_id": 87471333, "body": "Consider using <code>sync.Pool</code>"}], "answers": [{"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 2, "last_activity_date": 1525754676, "creation_date": 1525754676, "answer_id": 50225971, "question_id": 50225601, "link": "https://stackoverflow.com/questions/50225601/go-race-detector-error/50225971#50225971", "title": "Go race detector error", "body": "<p>maps require synchronization, in particular you <a href=\"https://golang.org/doc/faq#atomic_maps\" rel=\"nofollow noreferrer\">can not read it while writing to it</a>, regardless of if it's the same or distinct keys, so you need your lock around the meno map.</p>\n"}], "owner": {"reputation": 927, "user_id": 2419669, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/kuQAn.jpg?s=128&g=1", "display_name": "yangmillstheory", "link": "https://stackoverflow.com/users/2419669/yangmillstheory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "accepted_answer_id": 50225971, "answer_count": 1, "score": 0, "last_activity_date": 1525754676, "creation_date": 1525751872, "question_id": 50225601, "link": "https://stackoverflow.com/questions/50225601/go-race-detector-error", "title": "Go race detector error", "body": "<p>Here's my code for a concurrent cache:</p>\n\n<pre><code>package cache\n\nimport (\n    \"sync\"\n)\n\n// Func represents a memoizable function, operating on a string key, to use with a Cache\ntype Func func(key string) (interface{}, error)\n\n// FuncResult stores the value of a Func call\ntype FuncResult struct {\n    val interface{}\n    err error\n}\n\n// Cache is a cache that memoizes results of an expensive computation\n//\n// It has a traditional implementation using mutexes.\ntype Cache struct {\n    // guards done\n    mu   sync.RWMutex\n    done map[string]chan bool\n    memo map[string]*FuncResult\n    f    Func\n}\n\n// New creates a new Cache and returns its pointer\nfunc New(f Func) *Cache {\n    return &amp;Cache{\n        memo: make(map[string]*FuncResult),\n        done: make(map[string]chan bool),\n        f:    f,\n    }\n}\n\n// Get a string key if it exists, otherwise computes the value and caches it.\n//\n// Returns the value and whether or not the key existed.\nfunc (c *Cache) Get(key string) (*FuncResult, bool) {\n    c.mu.RLock()\n    _, ok := c.done[key]\n    c.mu.RUnlock()\n    if ok {\n        return c.get(key), true\n    }\n\n    c.mu.Lock()\n    _, ok = c.done[key]\n    if ok {\n        c.mu.Unlock()\n    } else {\n        c.done[key] = make(chan bool)\n        c.mu.Unlock()\n\n        v, err := c.f(key)\n        c.memo[key] = &amp;FuncResult{v, err}\n\n        close(c.done[key])\n    }\n    return c.get(key), ok\n}\n\n// get returns the value of key, blocking on an existing computation\nfunc (c *Cache) get(key string) *FuncResult {\n    &lt;-c.done[key]\n    fresult, _ := c.memo[key]\n    return fresult\n}\n</code></pre>\n\n<p>When I run this program with the race detector, I get no errors:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/yangmillstheory/go-cache/cache\"\n)\n\nvar f = func(key string) (interface{}, error) {\n    log.Printf(\"Computing value for key %s\\n\", key)\n    time.Sleep(1000 * time.Millisecond)\n    return fmt.Sprintf(\"value for %s\", key), nil\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    c := cache.New(f)\n    n := 10\n    k := \"key1\"\n\n    start := time.Now()\n    for i := 0; i &lt; n; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            c.Get(k)\n        }()\n    }\n\n    wg.Wait()\n    log.Printf(\"Elapsed: %s\\n\", time.Since(start))\n}\n</code></pre>\n\n<p>However, when I launch <em>two</em> different goroutines within the loop body each getting a different keys, I get an error:</p>\n\n<p>The way to fix this is to add another mutex <code>c.nu</code> to guard <code>memo</code>, but it makes the program a bit slower, and more complex</p>\n\n<pre><code>func (c *Cache) Get(key string) (*FuncResult, bool) {\n    c.mu.RLock()\n    _, ok := c.done[key]\n    c.mu.RUnlock()\n    if ok {\n        return c.get(key), true\n    }\n\n    c.mu.Lock()\n    _, ok = c.done[key]\n    if ok {\n        c.mu.Unlock()\n    } else {\n        c.done[key] = make(chan bool)\n        c.mu.Unlock()\n\n        v, err := c.f(key)\n        c.nu.Lock()\n        c.memo[key] = &amp;FuncResult{v, err}\n        c.nu.Unlock()\n\n        close(c.done[key])\n    }\n    return c.get(key), ok\n}\n\n// get returns the value of key, blocking on an existing computation\nfunc (c *Cache) get(key string) *FuncResult {\n    &lt;-c.done[key]\n    c.nu.RLock()\n    fresult, _ := c.memo[key]\n    c.nu.RUnlock()\n    return fresult\n}\n</code></pre>\n\n<p>Is there in fact a race condition here to worry about? If different goroutines are accessing different keys in the same data structure concurrently, it doesn't seem like it should be an issue as long as synchronization happens within an access for a given key?</p>\n\n<p>Put another way, do you have to synchronization across all keys, or just across the same key? The use case for a concurrent memo seems to suggest the latter would suffice?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 9307, "user_id": 705086, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fbeee3d76a35f9de8847f36ee51c28a2?s=128&d=identicon&r=PG", "display_name": "Dima Tisnek", "link": "https://stackoverflow.com/users/705086/dima-tisnek"}, "edited": false, "score": 1, "creation_date": 1525750099, "post_id": 50223771, "comment_id": 87468056, "body": "Please describe the high level problem you are trying to solve."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1525752798, "post_id": 50223771, "comment_id": 87468729, "body": "Can you elaborate your question?"}, {"owner": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1525760126, "post_id": 50223771, "comment_id": 87471274, "body": "@aerokite When timeout, switch to next state. when receive request, keep the state and start a new timer."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1525763812, "post_id": 50223771, "comment_id": 87473095, "body": "@lxyscls what <b>real problem</b> do you have with this code though? The 100ms timer is not stopped. So what?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1525765354, "post_id": 50223771, "comment_id": 87473981, "body": "Just use a cancellation channel and select on both"}, {"owner": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1525773846, "post_id": 50223771, "comment_id": 87479167, "body": "@zerkms When timeout, application will change state, just like in some consensus protocol. Say follower to candidate."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1525774909, "post_id": 50223771, "comment_id": 87479803, "body": "@lxyscls you need to have 2 branches in <code>select</code>. Select with 1 branch makes no sense. As soon as you add something in the other - your question would not be actual anymore."}], "answers": [{"comments": [{"owner": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "edited": false, "score": 1, "creation_date": 1525772403, "post_id": 50229137, "comment_id": 87478238, "body": "I&#39;am doubt that &quot;canceled &lt;- struct{}{}&quot; can &quot;cancel all current Bs\u201d. Not a random B?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "edited": false, "score": 1, "creation_date": 1525773414, "post_id": 50229137, "comment_id": 87478847, "body": "@lxyscls if you close the cancel channel instead of pushing to it, every goroutine will exit."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "edited": false, "score": 0, "creation_date": 1525775079, "post_id": 50229137, "comment_id": 87479894, "body": "@lxyscls, you are right. Not sure what I was thinking. However closing the channel will also abort all future B&#39;s."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1525767791, "creation_date": 1525767791, "answer_id": 50229137, "question_id": 50223771, "link": "https://stackoverflow.com/questions/50223771/how-to-stop-a-timer-correctly/50229137#50229137", "title": "How to stop a timer correctly?", "body": "<p>Use an additional, independent cancellation signal. Since you already have a select statement in place, another channel is an obvious choice:</p>\n\n<pre><code>import \"time\"\n\nvar timer *time.Timer\nvar canceled = make(chan struct{})\n\nfunc A() {\n    // cancel all current Bs\n    select {\n    case canceled &lt;- struct{}{}:\n    default:\n    }   \n\n    timer.Stop()\n\n    go B()       // new timer\n}\n\nfunc B() {\n    timer = time.NewTimer(100 * time.Millisecond)\n    select {\n    case &lt;-timer.C:\n        // do something for timeout, like change state\n    case &lt;-canceled:\n        // timer aborted\n    }\n}\n</code></pre>\n\n<p>Note that all As and Bs race against each other for the timer value. With the code above it is not necessary to have A stop the timer, so you don't need a global timer, eliminating the race:</p>\n\n<pre><code>import \"time\"\n\nvar canceled = make(chan struct{})\n\nfunc A() {\n    // cancel all current Bs\n    select {\n    case canceled &lt;- struct{}{}:\n    default:\n    }\n\n    go B()\n}\n\nfunc B() {\n    select {\n    case &lt;-time.After(100 * time.Millisecond):\n        // do something for timeout, like change state\n    case &lt;-canceled:\n        // aborted\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 2, "last_activity_date": 1525774540, "creation_date": 1525774540, "answer_id": 50231213, "question_id": 50223771, "link": "https://stackoverflow.com/questions/50223771/how-to-stop-a-timer-correctly/50231213#50231213", "title": "How to stop a timer correctly?", "body": "<p>Adding to the above answer, if you want to cancel all waiters at once, you can encapsulate the behavior using your own timer mechanism that can be cancelled, that sends true or false in an <code>After</code> channel to tell you whether you are waking from a cancellation or a time out, for all waiters. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype CancellableTimer struct {\n    cancel chan bool\n}\n\nfunc NewCancellableTimer() *CancellableTimer {\n    return &amp;CancellableTimer{\n        cancel: make(chan bool),\n    }\n}\n\n// internal wait goroutine wrapping time.After\nfunc (c *CancellableTimer) wait(d time.Duration, ch chan bool) {\n    select {\n    case &lt;-time.After(d):\n        ch &lt;- true\n    case &lt;-c.cancel:\n        ch &lt;- false\n    }\n}\n\n// After mimics time.After but returns bool to signify whether we timed out or cancelled\nfunc (c *CancellableTimer) After(d time.Duration) chan bool {\n    ch := make(chan bool)\n    go c.wait(d, ch)\n    return ch\n}\n\n// Cancel makes all the waiters receive false\nfunc (c *CancellableTimer) Cancel() {\n    close(c.cancel)\n\n}\n\n// a goroutine waiting for cancellation\nfunc B(t *CancellableTimer) {\n    select {\n    // timedOut will signify a timeout or cancellation\n    case timedOut := &lt;-t.After(time.Second):\n        if timedOut {\n            fmt.Println(\"Time out!\")\n        } else {\n            fmt.Println(\"Cancelled!\")\n        }\n    }\n}\n\nfunc main() {\n    t := NewCancellableTimer()\n    // Start 3 goroutines that wait for different timeouts on the same timer\n    go B(t)\n    go B(t)\n    go B(t)\n\n    // sleep a bit before cancelling\n    time.Sleep(100 * time.Millisecond)\n\n    // cancel the timer and all its waiters\n    t.Cancel()\n\n    // this is just to collect the output\n    time.Sleep(time.Second)\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Cancelled!\nCancelled!\nCancelled!\n</code></pre>\n\n<p>playground link: </p>\n\n<p><a href=\"https://play.golang.org/p/z8OscJCXTvD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/z8OscJCXTvD</a></p>\n"}], "owner": {"reputation": 243, "user_id": 6037259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863d4c594db3291ff11890a07540d521?s=128&d=identicon&r=PG&f=1", "display_name": "lxyscls", "link": "https://stackoverflow.com/users/6037259/lxyscls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7384, "favorite_count": 1, "accepted_answer_id": 50229137, "answer_count": 2, "score": 2, "last_activity_date": 1525774540, "creation_date": 1525735631, "last_edit_date": 1525759968, "question_id": 50223771, "link": "https://stackoverflow.com/questions/50223771/how-to-stop-a-timer-correctly", "title": "How to stop a timer correctly?", "body": "<pre><code>var timer *time.Timer\n\nfunc A() {\n    timer.Stop() // cancel old timer\n    go B() // new timer\n}\n\nfunc B() {\n    timer = time.NewTimer(100 * time.Millisecond)\n    select {\n    case &lt;- timer.C:\n    // do something for timeout, like change state\n    }\n}\n</code></pre>\n\n<p>Function A and B are all in different goroutines. </p>\n\n<p>Say A is in a RPC goroutine. When application receives RPC request, it will cancel the old timer in B, and start a new timer in another goroutine.</p>\n\n<p>The doc say: </p>\n\n<blockquote>\n  <p>Stop does not close the channel, to prevent a read from the channel\n  succeeding incorrectly.</p>\n</blockquote>\n\n<p>So how to break the select in B to avoid goroutine leak?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1525734497, "post_id": 50223341, "comment_id": 87464772, "body": "You can&#39;t use a buffer in one place and concurrently write to it in another without making a copy. There&#39;s no magic way to send a single buffer to multiple workers and have it contain different data. You can help make the <i>allocations</i> more efficient with a free list or a <code>sync.Pool</code>, but there will always need to be a copy."}, {"owner": {"reputation": 976, "user_id": 833915, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/61d006ce1c4e7b86fa6de027f64cc67e?s=128&d=identicon&r=PG", "display_name": "SteveK", "link": "https://stackoverflow.com/users/833915/stevek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525747871, "post_id": 50223341, "comment_id": 87467545, "body": "Thanks @JimB - I was not aware of sync.Pool, but I&#39;ve tried it out and it&#39;s a pretty clever way to avoid extra allocations!  In my application, the copy() method was reducing performance from 450k lines/sec to 285k/s, but after testing these methods, I think it was simply due to resource contention during allocation."}], "owner": {"reputation": 976, "user_id": 833915, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/61d006ce1c4e7b86fa6de027f64cc67e?s=128&d=identicon&r=PG", "display_name": "SteveK", "link": "https://stackoverflow.com/users/833915/stevek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 512, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525741674, "creation_date": 1525732066, "last_edit_date": 1525741674, "question_id": 50223341, "link": "https://stackoverflow.com/questions/50223341/feeding-scanner-bytes-to-a-channel-in-go", "title": "Feeding Scanner.Bytes() to a channel in Go", "body": "<p>Please consider this script:\n<a href=\"https://play.golang.org/p/o4ZhuB3GJ0s\" rel=\"nofollow noreferrer\">https://play.golang.org/p/o4ZhuB3GJ0s</a> (important part below)</p>\n\n<p>It's creating random(ish) strings that look like \"foo|foo\" (where \"foo\" is random, but repeated).</p>\n\n<p>I read them with <code>Scanner.Bytes()</code> into an input channel, then 16 worker threads convert them to strings and put them into an output channel.</p>\n\n<p>In the output channel, I split the strings on <code>|</code> to make sure both sides are the same (no data corruption).</p>\n\n<p>Here's the part of the code that scans the input buffer:</p>\n\n<pre><code>// Send input into channel\ngo func() {\n    // Normally os.Stdin\n    s := bufio.NewScanner(simulatedStdin)\n    start = time.Now()\n    for s.Scan() {\n        thisLine := s.Bytes()\n        line := make([]byte, len(thisLine))\n        // Copy the slice so it's not changed on the next iteration\n        copy(line, thisLine)\n        lines &lt;- line\n\n        // Works, but perhaps the least efficient way to do it\n        // lines &lt;- []byte(string(s.Bytes()))\n        // lines &lt;- []byte(s.Text())\n\n        // Fails\n        // lines &lt;- []byte(s.Bytes())\n        // lines &lt;- s.Bytes()[:]\n        // lines &lt;- s.Bytes()\n    }\n    close(lines)\n}()\n</code></pre>\n\n<p>The version above works properly, but if I just do <code>lines &lt;- s.Bytes()</code> (or the other ones I tested), the data gets corrupted because Scanner.Bytes() is always returning the same slice, and I'm passing that slice through the channel, but it's being mutated while the workers are reading it.</p>\n\n<p>My question is, what is the correct/idiomatic way to put <code>Scanner.Bytes()</code> on a channel to prevent this corruption?  The way I've posted above works, but it's fairly ugly IMHO, and the string hack is short, but it's really a terrible way to copy data.</p>\n\n<p>Ultimately, I am using this method to read billions of lines of data, so if an extra <code>[]byte</code> copy can be removed, I'm all for it.  The work being done in the workers is slow (JSON Unmarshaling, etc), but the input scanner is a single thread, so I'm trying to get it to split lines as quickly as possible.</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 359, "user_id": 9538400, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JVbWw.jpg?s=128&g=1", "display_name": "INVOKE Cloud", "link": "https://stackoverflow.com/users/9538400/invoke-cloud"}, "edited": false, "score": 0, "creation_date": 1525729420, "post_id": 50222478, "comment_id": 87463305, "body": "Unless your app is &quot;mission critical&quot; (very few fall into this category), I wouldn&#39;t go for such optimization because, you will be spending lot of time writing code someone already did in form of SDK. Remember, though you got REST API access, you still need to parse this and covert into your objects, you may be able to save VERY LITTLE on compute (unless you are master programmer)."}, {"owner": {"reputation": 359, "user_id": 9538400, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JVbWw.jpg?s=128&g=1", "display_name": "INVOKE Cloud", "link": "https://stackoverflow.com/users/9538400/invoke-cloud"}, "edited": false, "score": 0, "creation_date": 1525729487, "post_id": 50222478, "comment_id": 87463334, "body": "To answer your other question, can we use REST API instead of SDK, yes and I am 95% confident that SDK internally does the REST call for us. Reviewing some of the open source SDK could reveal these details."}, {"owner": {"reputation": 45894, "user_id": 271415, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8648256cc53b261c5e1d266380a256fc?s=128&d=identicon&r=PG", "display_name": "jarmod", "link": "https://stackoverflow.com/users/271415/jarmod"}, "edited": false, "score": 1, "creation_date": 1525730550, "post_id": 50222478, "comment_id": 87463668, "body": "There&#39;s no requirement to use an AWS SDK. Everything&#39;s available via underlying API. Having said that, you might want to do some work to validate the advantages that you think you will get from bypassing the SDK."}, {"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 1, "creation_date": 1525734822, "post_id": 50222478, "comment_id": 87464841, "body": "As an employer I would question your allocation of time/effort. The SDKs are maintained by AWS, whereas your code would need to be maintained internally, probably for years after you have left the company. Given that most of the time is spent waiting for a network response, the tiny potential speed improvement would be negligible."}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1525738013, "post_id": 50222478, "comment_id": 87465592, "body": "It&#39;s easy enough to try it and see what you find.  I recently wrote my own implementation of <code>aws rds generate-db-auth-token</code> that runs 9x faster than aws-cli on the same task. I expect that the cli may be an outlier, but there are probably opportunities for performance gains elsewhere.  You will definitely gain improved troubleshooting skills that come in handy when the SDK&#39;s behavior perplexes you, by learning the underlying APIs."}], "answers": [{"tags": [], "owner": {"reputation": 33116, "user_id": 4782, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/850aa09e891970d0d3c126146dd23cb6?s=128&d=identicon&r=PG", "display_name": "chris", "link": "https://stackoverflow.com/users/4782/chris"}, "is_accepted": false, "score": 2, "last_activity_date": 1525730510, "creation_date": 1525730510, "answer_id": 50223080, "question_id": 50222478, "link": "https://stackoverflow.com/questions/50222478/is-it-ok-to-use-api-instead-of-sdk/50223080#50223080", "title": "Is it ok to use API instead of SDK?", "body": "<p>Anything you do with AWS is the result of an API call, whether executed by CLI, Web console, or SDK.</p>\n\n<p>The SDKs make it easier to interact with those APIs.  While you may be able to come up with some minor improvements for some calls, overall you will spend a lot of time doing it to very little benefit.</p>\n"}, {"tags": [], "owner": {"reputation": 9307, "user_id": 705086, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fbeee3d76a35f9de8847f36ee51c28a2?s=128&d=identicon&r=PG", "display_name": "Dima Tisnek", "link": "https://stackoverflow.com/users/705086/dima-tisnek"}, "is_accepted": true, "score": 0, "last_activity_date": 1525749658, "creation_date": 1525749658, "answer_id": 50225318, "question_id": 50222478, "link": "https://stackoverflow.com/questions/50222478/is-it-ok-to-use-api-instead-of-sdk/50225318#50225318", "title": "Is it ok to use API instead of SDK?", "body": "<p>I think the stated focus on performance belies real trade-offs.</p>\n\n<p>Consider that someone will have to maintain your code -- if you use an API, the test area is small, but AWS APIs might change or be deprecated; if you an SDK, next programmer will plug in new SDK version and hope that it works, but if it doesn't they'd be bogged down by sheer weight of the SDK.</p>\n\n<p>Likewise, imagine someone needs to do a security review of this app, or to introduce something not yet covered by SDK (let's imagine propagating accounting group from caller role to underlying storage).</p>\n\n<p>I don't think there is a clear answer.</p>\n\n<p>Here are my <strong>suggestions</strong>:</p>\n\n<ul>\n<li>keep it consistent -- either API or SDK (within given app)</li>\n<li>consider the bigger picture (how many apps do you plan to write?)</li>\n<li>don't be afraid to switch to the other approach later</li>\n</ul>\n\n<p>I've had to decide on something similar <strong>in the past</strong>, with Docker (much nicer APIs and SDKs/libs). Here's how it played out:</p>\n\n<p>For testing, we ended up using beta version of Docker Python bindings: prod version was not enough, and bindings (your SDK) were overall pretty good and clear.</p>\n\n<p>For log scraping, I used HTTP calls (your API), \"because performance\", in reality comparative mental load using API vs SDK, and because bindings (SDK) did not support asyncio.</p>\n"}], "owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50225318, "answer_count": 2, "score": 0, "last_activity_date": 1525766044, "creation_date": 1525727434, "last_edit_date": 1525766044, "question_id": 50222478, "link": "https://stackoverflow.com/questions/50222478/is-it-ok-to-use-api-instead-of-sdk", "title": "Is it ok to use API instead of SDK?", "body": "<p>I like fast code execution (because of that I switched from Python to Go) and I do not like dependencies. Amazon recommends using SDK for simpler authentication (but in Lambda I can get tokens from IAM from environment variables) and because of built into SDK retry on errors (few lines of code, as I think). Yes it is faster to write my code using SDK, but what additional caveats about using pure HTTP API instead of SDK? Am I too crazy about milliseconds? Such optimizations worth it?</p>\n"}, {"tags": ["go", "twitter-oauth"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1525724925, "post_id": 50221812, "comment_id": 87461312, "body": "One issue is that OAuth 1 uses standard base 64 encoding, not URL encoding as written in the question.  I suggest using a package like <a href=\"https://godoc.org/github.com/gomodule/oauth1/oauth\" rel=\"nofollow noreferrer\">godoc.org/github.com/gomodule/oauth1/oauth</a> or <a href=\"https://godoc.org/github.com/mrjones/oauth\" rel=\"nofollow noreferrer\">godoc.org/github.com/mrjones/oauth</a>.  If you want to implement your own signature method, then run your code against the test cases in those packages."}, {"owner": {"reputation": 11, "user_id": 9754888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hSy2.jpg?s=128&g=1", "display_name": "Samuel Palmeira", "link": "https://stackoverflow.com/users/9754888/samuel-palmeira"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1525780955, "post_id": 50221812, "comment_id": 87483574, "body": "I tried to use standard and didn&#39;t work."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1525786389, "post_id": 50221812, "comment_id": 87487146, "body": "There are many details to get exactly right. I am not surprised that there&#39;s another thing to fix.  I doubt you will get someone to debug the code here.  Use an existing package."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9754888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hSy2.jpg?s=128&g=1", "display_name": "Samuel Palmeira", "link": "https://stackoverflow.com/users/9754888/samuel-palmeira"}, "is_accepted": false, "score": 0, "last_activity_date": 1526090840, "creation_date": 1526090840, "answer_id": 50302265, "question_id": 50221812, "link": "https://stackoverflow.com/questions/50221812/twitter-oauth-with-golang/50302265#50302265", "title": "twitter oauth with golang", "body": "<p>Well the main problem really was with my <strong>signature</strong> although the code had other problems, even then I managed to solve the problem and if someone ever had the same problem I'll left my code solution on <a href=\"https://github.com/sampalm/golangWebTraining/blob/master/00_hands-on/10_oauth/04_twitter/oauth.go\" rel=\"nofollow noreferrer\">github</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 9754888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hSy2.jpg?s=128&g=1", "display_name": "Samuel Palmeira", "link": "https://stackoverflow.com/users/9754888/samuel-palmeira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 960, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1592309029, "creation_date": 1525724252, "question_id": 50221812, "link": "https://stackoverflow.com/questions/50221812/twitter-oauth-with-golang", "title": "twitter oauth with golang", "body": "<p>I'm trying to make this request \"oauth/request_token\" using this code in Go:</p>\n\n<pre><code>// GET PARAMS TO REQUEST\nt := time.Now().UTC()\nvalues := make(url.Values)\nvalues.Add(\"oauth_nonce\", auth.ANonce)\nvalues.Add(\"oauth_callback\", auth.Path) //http://localhost:8080/oauth\nvalues.Add(\"oauth_signature_method\", \"HMAC-SHA1\")\nvalues.Add(\"oauth_timestamp\", t.String())\nvalues.Add(\"oauth_consumer_key\", auth.ClientID)\n\n// GET SIGNATURE\nbaseString := fmt.Sprintf(\"POST&amp;%s&amp;%s\", auth.Path, values.Encode())\nkey := fmt.Sprintf(\"%s&amp;\", auth.SecretID)\n\n// GENERATE HASH\nmac := hmac.New(sha1.New, []byte(key))\nmac.Write([]byte(baseString))\nsignature := base64.URLEncoding.EncodeToString(mac.Sum(nil))\n\n// MAKE THE REQUEST\nvalues.Add(\"oauth_version\", \"1.0\")\nvalues.Add(\"oauth_signature\", signature)\nclient := urlfetch.Client(ctx)\nreq, err := http.NewRequest(\"POST\", auth.RequestToken, nil)\nif err != nil {\n    return fmt.Errorf(\"getOAuthToken Request Error: %v\", err)\n}\n// SET HEADER\nreq.Header.Set(\"Authorization\", fmt.Sprintf(\"OAuth oauth_nonce=\\\"%s\\\", oauth_callback=\\\"%s\\\", oauth_signature_method=\\\"HMAC-SHA1\\\", oauth_timestamp=\\\"%s\\\", oauth_consumer_key=\\\"%s\\\", oauth_signature=\\\"%s\\\", oauth_version=\\\"1.0\\\"\", auth.ANonce, auth.Path, t.String(), auth.ClientID, signature))\nres, err := client.Do(req)\nif err != nil {\n    return fmt.Errorf(\"getOAuthToken Client Error: %v\", err)\n}\ndefer res.Body.Close()\n\nbs, err := ioutil.ReadAll(res.Body)\nif err != nil {\n    return fmt.Errorf(\"getOAuthToken Error: %v\", err)\n}\n\nlog.Printf(\"getOAuthToken Response: %s\\n\", string(bs))\n</code></pre>\n\n<p>Problem is that I always receive this error as a response: \"getOAuthToken Response: </p>\n\n<blockquote>\n  <p>{\"errors\":[{\"code\":215,\"message\":\"Bad Authentication data.\"}]}</p>\n</blockquote>\n\n<p>I believe that the main problem is with my signature, am I doing something wrong?</p>\n"}, {"tags": ["go", "gomock"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1525727285, "post_id": 50221555, "comment_id": 87462330, "body": "Have you tried updating gomock and context?  Because as far as I can tell, the current version of the x/net/context package does not import gomock."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525727309, "post_id": 50221555, "comment_id": 87462344, "body": "Those import don&#39;t produce a cycle. Something is out of date on your system, or you&#39;ve modified one of those packages."}, {"owner": {"reputation": 9, "user_id": 9754829, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Arnav Sankaran", "link": "https://stackoverflow.com/users/9754829/arnav-sankaran"}, "edited": false, "score": 0, "creation_date": 1525731072, "post_id": 50221555, "comment_id": 87463852, "body": "I&#39;ve tried running <code>go get -u github.com&#47;golang&#47;mock&#47;gomock</code> and <code>go get -u github.com&#47;golang&#47;mock&#47;gomock</code> and then <code>go install</code> on both packages. Still getting the same cycle issue though."}, {"owner": {"reputation": 9, "user_id": 9754829, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Arnav Sankaran", "link": "https://stackoverflow.com/users/9754829/arnav-sankaran"}, "edited": false, "score": 0, "creation_date": 1525731377, "post_id": 50221555, "comment_id": 87463931, "body": "Interestingly grepping the <code>$GOPATH&#47;src&#47;golang.org&#47;x&#47;net&#47;</code> folder for <code>gomock</code> finds no matches."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1525790326, "post_id": 50221555, "comment_id": 87489804, "body": "Do you have gomock or context vendored?"}], "owner": {"reputation": 9, "user_id": 9754829, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Arnav Sankaran", "link": "https://stackoverflow.com/users/9754829/arnav-sankaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 760, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525723094, "creation_date": 1525723094, "question_id": 50221555, "link": "https://stackoverflow.com/questions/50221555/resolving-gomock-import-cycle", "title": "Resolving gomock import cycle", "body": "<p>How do I go about resolving an import cycle between <code>github.com/golang/mock/gomock</code> and <code>golang.org/x/net/context</code>? As far as I can tell this cycle exists internally between the two package and I can't modify either of them internally.</p>\n\n<p>Currently these are my imports:</p>\n\n<pre><code>import (\n    \"testing\"\n    \"github.com/golang/mock/gomock\"\n    \"gopkg.in/mgo.v2\" //mock\n    \"gopkg.in/mgo.v2/bson\"\n)\n</code></pre>\n\n<p>And this is the exact error message I am receiving when running <code>withmock go test</code>:</p>\n\n<pre><code>ERROR: Failed to install 'gopkg.in/mgo.v2': exit status 1\noutput:\nimport cycle not allowed\npackage gopkg.in/mgo.v2\n    imports github.com/golang/mock/gomock\n    imports golang.org/x/net/context\n    imports github.com/golang/mock/gomock\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "edited": false, "score": 0, "creation_date": 1525723186, "post_id": 50221461, "comment_id": 87460520, "body": "a.B is map as such you can not reference a field of it. If you want to access a field of an object in the map you will need to use a key like you do above a.B[&quot;two&quot;].A.B = a.CB. If you want to do this to every member of the map you should use a loop"}, {"owner": {"reputation": 23, "user_id": 9138749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ko7Nm9QwG1E/AAAAAAAAAAI/AAAAAAAAAFs/IYvxr_yVtZc/photo.jpg?sz=128", "display_name": "Bo\u0161tjan Bele", "link": "https://stackoverflow.com/users/9138749/bo%c5%a1tjan-bele"}, "reply_to_user": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "edited": false, "score": 0, "creation_date": 1525723691, "post_id": 50221461, "comment_id": 87460746, "body": "Thank you, Benjamin! I&#39;ve corrected the code in the question as this was a typo in writing this simple code. Still need help!"}, {"owner": {"reputation": 2281, "user_id": 1914005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ab75a260af6eefb1b37b89115f01774a?s=128&d=identicon&r=PG&f=1", "display_name": "Vitruvie", "link": "https://stackoverflow.com/users/1914005/vitruvie"}, "edited": false, "score": 0, "creation_date": 1525724384, "post_id": 50221461, "comment_id": 87461076, "body": "Where are you getting the error? <code>a.C.A = &quot;Test A (Epyt)&quot;</code> is definitely wrong, but doesn&#39;t have anything to do with maps."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525724490, "post_id": 50221461, "comment_id": 87461122, "body": "@Bo\u0161tjanBele What makes you think you cannot unmarshal into a map of pointers? Did you try it?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1525724517, "post_id": 50221461, "comment_id": 87461138, "body": "This is a duplicate of <a href=\"https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i\" title=\"why do i get a cannot assign error when setting value to a struct as a value i\">stackoverflow.com/questions/32751537/&hellip;</a> and others.  These other questions can also be made to work by using pointers. There is not a bug to correct in Go.  Map values are not addressable."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525724700, "post_id": 50221461, "comment_id": 87461217, "body": "@Bo\u0161tjanBele is see no problem here <a href=\"https://play.golang.org/p/sWeiGlMfQn_3\" rel=\"nofollow noreferrer\">play.golang.org/p/sWeiGlMfQn_3</a> although you haven&#39;t shared what data type you&#39;re unmarshaling with viper, so maybe it doesn&#39;t work with your case and if that&#39;s the case then you should share that information."}, {"owner": {"reputation": 23, "user_id": 9138749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ko7Nm9QwG1E/AAAAAAAAAAI/AAAAAAAAAFs/IYvxr_yVtZc/photo.jpg?sz=128", "display_name": "Bo\u0161tjan Bele", "link": "https://stackoverflow.com/users/9138749/bo%c5%a1tjan-bele"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525767531, "post_id": 50221461, "comment_id": 87475198, "body": "@mkopriva I have tried it with pointers and got an error (memory issue - usually when pointer is lost)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525768016, "post_id": 50221461, "comment_id": 87475459, "body": "@Bo\u0161tjanBele A pointer doesn&#39;t just get lost unless you set it to <code>nil</code>. You still haven&#39;t shared what the config file type is, and how exactly you&#39;re unmarshaling that config. Also I would like to know where you read that this is an old bug? As far as I know this isn&#39;t a bug but I may be wrong and would like to read more about it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525768233, "post_id": 50221461, "comment_id": 87475585, "body": "@Bo\u0161tjanBele basically your code is invalid because you&#39;re trying to set values on a non-pointer struct inside a map. That&#39;s just not allowed. You should use pointers to structs if you want to set the fields directly from the map. That&#39;s one option. The only other option you have is to retrieve the whole struct from the map into a variable, set its fields using the variable and then reinsert the struct back into the map using the same key that you&#39;ve used to retrieve the struct."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525768393, "post_id": 50221461, "comment_id": 87475674, "body": "@Bo\u0161tjanBele if you have trouble using maps of pointers you should share the code that is casuing the problem. E.g. how the map is filled with data, how your trying to access that data, and what errors are you getting when accessing that data. Provide the error message, the stack trace, etc."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1525785322, "post_id": 50221461, "comment_id": 87486420, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17438253/access-struct-in-map-without-copying\">Access Struct in Map (without copying)</a>"}, {"owner": {"reputation": 23, "user_id": 9138749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ko7Nm9QwG1E/AAAAAAAAAAI/AAAAAAAAAFs/IYvxr_yVtZc/photo.jpg?sz=128", "display_name": "Bo\u0161tjan Bele", "link": "https://stackoverflow.com/users/9138749/bo%c5%a1tjan-bele"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525787342, "post_id": 50221461, "comment_id": 87487820, "body": "@mkopriva I played around a bit and got it working! I thought there is an error, because if I use printf over the whole structure, I get the address instead of the value back. Sorry for the inconvenience!"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 9138749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ko7Nm9QwG1E/AAAAAAAAAAI/AAAAAAAAAFs/IYvxr_yVtZc/photo.jpg?sz=128", "display_name": "Bo\u0161tjan Bele", "link": "https://stackoverflow.com/users/9138749/bo%c5%a1tjan-bele"}, "is_accepted": false, "score": 1, "last_activity_date": 1525787684, "creation_date": 1525787684, "answer_id": 50235382, "question_id": 50221461, "link": "https://stackoverflow.com/questions/50221461/cannot-assign-to-struct-field-in-map/50235382#50235382", "title": "cannot assign to struct field in map", "body": "<p>I played around a bit and got it working! I thought there is an error, because if I use printf over the whole structure, I get the address instead of the value back. Sorry for the inconvenience!</p>\n\n<p>As @mkopriva told me, I tried to use pointers. After some errors I got it to work so far! Sorted out this brain bug ;)</p>\n\n<p>Thank you again!</p>\n"}, {"tags": [], "owner": {"reputation": 8322, "user_id": 465738, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/tSedM.jpg?s=128&g=1", "display_name": "Edson Medina", "link": "https://stackoverflow.com/users/465738/edson-medina"}, "is_accepted": false, "score": 1, "last_activity_date": 1525804261, "last_edit_date": 1525804261, "creation_date": 1525803958, "answer_id": 50240048, "question_id": 50221461, "link": "https://stackoverflow.com/questions/50221461/cannot-assign-to-struct-field-in-map/50240048#50240048", "title": "cannot assign to struct field in map", "body": "<p>You haven't initialised the map.</p>\n\n<p>Try</p>\n\n<pre><code>var a Something\na.B = make(map[string]Type)\n</code></pre>\n\n<p>Also, none of the structures you're referring to exist.</p>\n\n<p>Ie, instead of:</p>\n\n<pre><code>a.B[\"one\"].A.A = ...\n</code></pre>\n\n<p>You should do:</p>\n\n<pre><code>a.B[\"one\"] = Type{\n    A: Epyt{\n        A: \"test\",\n        B: \"foo\",\n    },\n    B: \"something\",\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9138749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ko7Nm9QwG1E/AAAAAAAAAAI/AAAAAAAAAFs/IYvxr_yVtZc/photo.jpg?sz=128", "display_name": "Bo\u0161tjan Bele", "link": "https://stackoverflow.com/users/9138749/bo%c5%a1tjan-bele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4958, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1525804261, "creation_date": 1525722702, "last_edit_date": 1525723637, "question_id": 50221461, "link": "https://stackoverflow.com/questions/50221461/cannot-assign-to-struct-field-in-map", "title": "cannot assign to struct field in map", "body": "<p>I would like to set a default value and if this is not set in a structure, I would like to set it. It's a bit confusing, but please take a look to the (simplified) code:</p>\n\n<pre><code>package main\n\nimport \"log\"\n\ntype Something struct {\n    A string\n    B map[string]Type\n    C Epyt\n}\ntype Type struct {\n    A Epyt\n    B string\n}\n\ntype Epyt struct {\n    A string\n    B string\n}\n\nfunc main() {\n    var a Something\n    a.A = \"Test A (Something)\"\n//  var a.B[\"one\"] Type\n    a.B[\"one\"].A.A = a.B[\"one\"].A.A\n    a.B[\"one\"].A.A = \"Test A ([one]Type.Epyt)\"\n    a.B[\"two\"].A.A = \"Test A ([two]Type.Epyt)\"  \n    a.C.A = \"Test A (Epyt)\"\n    a.C.B = \"Test B (Epyt)\"\n\n    for i := range a.B {\n        if a.B[i].A.B == \"\" {\n            a.B[i].A.B = a.C.B\n        }\n    }\n    log.Printf(\"%+v\", a)\n}\n</code></pre>\n\n<p>I'm working with viper to unmarshal a config file, therefor I'm not able to use pointers (or am I wrong?).</p>\n\n<p>The error I'm getting, is cannot assign to struct field *** in map.</p>\n\n<p>I found that this is an old bug in go lang still not corrected.</p>\n\n<p>I've read <a href=\"https://stackoverflow.com/questions/32751537\">Why do I get a &quot;cannot assign&quot; error when setting value to a struct as a value in a map?</a> and <a href=\"https://stackoverflow.com/questions/40578646\">Golang: I have a map of structs. Why can&#39;t I directly modify a field in a struct value?</a> but as I said, I can't operate with pointers (or?), therefor please don't mark this as duplicate as it is not!</p>\n\n<p>If someone has an idea on how to do this right, please help!</p>\n"}, {"tags": ["mysql", "go", "gitlab-ci-runner"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525717245, "post_id": 50220089, "comment_id": 87457563, "body": "Did you <a href=\"https://docs.gitlab.com/ee/ci/services/mysql.html\" rel=\"nofollow noreferrer\">read this</a>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525718564, "post_id": 50220089, "comment_id": 87458228, "body": "I expect the root of your problem is that you&#39;re setting <code>MYSQL_ADDRESS</code>, and you shouldn&#39;t be."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525718577, "post_id": 50220089, "comment_id": 87458237, "body": "Also, you misspelled <code>MYSQL_TRANSPORT</code>"}, {"owner": {"reputation": 21, "user_id": 4572345, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ByCN7GHegpA/AAAAAAAAAAI/AAAAAAAAANE/ed259FCYKzQ/photo.jpg?sz=128", "display_name": "Nderim Xhemajli", "link": "https://stackoverflow.com/users/4572345/nderim-xhemajli"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525761530, "post_id": 50220089, "comment_id": 87471911, "body": "Yeah I&#39;ve read that one."}, {"owner": {"reputation": 21, "user_id": 4572345, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ByCN7GHegpA/AAAAAAAAAAI/AAAAAAAAANE/ed259FCYKzQ/photo.jpg?sz=128", "display_name": "Nderim Xhemajli", "link": "https://stackoverflow.com/users/4572345/nderim-xhemajli"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525761737, "post_id": 50220089, "comment_id": 87472028, "body": "The mysql command proves that the installation works fine, since it outputs the correct port: 3306. And the environment variables, besides the password and databse variables, serve only to configure the go app."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525765743, "post_id": 50220089, "comment_id": 87474192, "body": "That proves that the mysql <i>client</i> is installed correctly. It also proves that there&#39;s no server running on that host/port."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525765772, "post_id": 50220089, "comment_id": 87474210, "body": "I suggest following the directions in that document precisely, rather than adding your own config variables."}], "owner": {"reputation": 21, "user_id": 4572345, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ByCN7GHegpA/AAAAAAAAAAI/AAAAAAAAANE/ed259FCYKzQ/photo.jpg?sz=128", "display_name": "Nderim Xhemajli", "link": "https://stackoverflow.com/users/4572345/nderim-xhemajli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 465, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525716801, "creation_date": 1525716474, "last_edit_date": 1525716801, "question_id": 50220089, "link": "https://stackoverflow.com/questions/50220089/cant-connect-a-go-app-to-mysql-both-inside-a-gitlab-runner", "title": "Can&#39;t connect a go app to mysql (both inside a gitlab runner)", "body": "<p>The go app simply inserts a harcoded value in a mysql table and spits it back out. This is done using <a href=\"http://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">this database driver</a>. It works fine on linux servers, but during gitlab's CI this returns:</p>\n\n<pre><code>dial tcp 127.0.0.1:3306: connect: connection refused\n</code></pre>\n\n<p>This is the .gitlab-ci.yml</p>\n\n<pre><code>image: mysql\nservices:\n  - mysql:latest\nvariables:\n  MYSQL_DATABASE: storage\n  MYSQL_ROOT_PASSWORD: root\n  MYSQL_HOST: mysql\n  MYSQL_USER: root\n  MYSQL_TRANSAPORT: tcp\n  MYSQL_ADDRESS: \"127.0.0.1:3306\"\njob:\n  script:\n    - apt-get update -qq &amp;&amp; apt-get install -qq curl &amp;&amp; apt-get install -qq git\n    - echo \"SHOW GLOBAL VARIABLES LIKE 'PORT';\" | mysql --user=\"$MYSQL_USER\" --password=\"$MYSQL_ROOT_PASSWORD\" --host=\"$MYSQL_HOST\" \"$MYSQL_DATABASE\"\n    - curl -O https://dl.google.com/go/go1.10.1.linux-amd64.tar.gz\n    - tar -C /usr/local -xzf go1.10.1.linux-amd64.tar.gz\n    - rm go1.10.1.linux-amd64.tar.gz\n    - echo \"export PATH=\\$PATH:/usr/local/go/bin\" &gt;&gt; ~/.bashrc\n    - echo \"export GOPATH=\\$HOME/go\" &gt;&gt; ~/.bashrc\n    - echo \"export PATH=\\$PATH:\\$GOPATH/bin\" &gt;&gt; ~/.bashrc\n    - source ~/.bashrc\n    - go get github.com/go-sql-driver/mysql\n    - go build main.go\n    - ./main\n</code></pre>\n\n<p>Is there a standard way to use mysql from golang during CI?</p>\n"}, {"tags": ["go", "hashicorp-vault", "hcl"], "comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1532650374, "post_id": 50219689, "comment_id": 90065783, "body": "You need to use <a href=\"https://godoc.org/github.com/hashicorp/hcl/hcl/ast#WalkFunc\" rel=\"nofollow noreferrer\">godoc.org/github.com/hashicorp/hcl/hcl/ast#WalkFunc</a>"}], "owner": {"reputation": 6959, "user_id": 411141, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/R4sK6.png?s=128&g=1", "display_name": "ehime", "link": "https://stackoverflow.com/users/411141/ehime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1525714755, "creation_date": 1525714755, "question_id": 50219689, "link": "https://stackoverflow.com/questions/50219689/searching-and-updating-hcl-for-strings-in-go", "title": "Searching and updating HCL for strings in Go", "body": "<p>Hey guys I ran into a road block trying to figure out how to search all our <code>service/policy_names</code> to ensure that they have certain capabilities.</p>\n\n<p>Lets say I have a vault policy like the following</p>\n\n<pre><code>bash-4.4$ vault policy read service/admin\n# Token policies\npath \"/auth/token/create\" {\n    capabilities = [\"create\", \"update\", \"sudo\"]\n}\n\npath \"/auth/token/lookup\" {\n    capabilities = [\"create\", \"update\"]\n}\n\npath \"/auth/token/renew\" {\n    capabilities = [\"create\", \"update\"]\n}\n\npath \"/auth/token/revoke\" {\n    capabilities = [\"create\", \"update\"]\n}\n\n# View system policies\npath \"/sys/policy\" {\n    capabilities = [\"read\"]\n}\n\n# Allow full access to interact with all secrets\npath \"secret/*\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n</code></pre>\n\n<p>I'm attempting to scan through each policy and if the path does not have the correct capabilities, create a new file with the correct capabilities and save it. I got stuck at trying to scan each path and am a bit put out. Hopefully someone can help or recommend a saner method. The above would be save to a new file <code>service_admin.hcl</code> and look like the following</p>\n\n<pre><code>bash-4.4$ less service_admin.hcl\n# Token policies\npath \"/auth/token/create\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n\npath \"/auth/token/lookup\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n\npath \"/auth/token/renew\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n\npath \"/auth/token/revoke\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n\n# View system policies\npath \"/sys/policy\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n\n# Allow full access to interact with all secrets\npath \"secret/*\" {\n    capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]\n}\n</code></pre>\n\n<p>The code that I have so far is below, i chose go because I thought the HCL library would help me but I'm struggling to use it.</p>\n\n<pre><code>package main\n\nimport (\n   \"github.com/hashicorp/vault/api\"\n   \"log\"\n   \"regexp\"\n)\n\nfunc main() {\n   cfg := api.DefaultConfig()\n   cfg.Address = \"http://localhost:8200\"\n\n   client, err := api.NewClient(cfg)\n   if err != nil {\n      log.Fatal(err)\n   }\n\n   client.SetToken(\"xxx\")\n\n   policies, err := client.Sys().ListPolicies()\n   if err != nil {\n      log.Fatal(err)\n   }\n\n\n   var listPolicies []string\n   for _, policy := range policies {\n      matched, _ := regexp.MatchString(\"^service\", policy)\n      if matched {\n         listPolicies = append(listPolicies, policy)\n      }\n   }\n\n   for _, policy := range listPolicies {\n      policyContents, _ := client.Sys().GetPolicy(policy)\n\n      // parse := hcl.Parse(policyContents) // ????\n      // Does each `path` have `capabilities = [\"create\", \"read\", \"update\", \"delete\", \"list\"]`\n      log.Println(policyContents)\n\n      break\n   }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525715075, "post_id": 50219670, "comment_id": 87456485, "body": "Need to assert underlying value of interface to fetch the value and assign to <code>OrderBookResult</code>. Please post the json that you wants to convert."}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1525715092, "post_id": 50219670, "comment_id": 87456492, "body": "why use <code>interface{}</code> instead of just using <code>OrderBook</code> in the event struct? I assume it could maybe contain other kinds of objects?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525715234, "post_id": 50219670, "comment_id": 87456556, "body": "When you say <code>Data</code> is a JSON object, what does this mean? Is it a string containing JSON? Is it a <code>map[string]interface{}</code> containing an unmarshaled JSON object? Is it actually an <code>OrderBook</code> value?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525715249, "post_id": 50219670, "comment_id": 87456563, "body": "@Tino <code>Data</code> if decoded from json is going to be of type <code>map[string]interface{}</code> which means you&#39;ll have to manually create <code>OrderBookResult</code> from it. It may be better to change <code>Data</code>&#39;s type into <code>json.RawMessage</code> and do the decoding after you know the type."}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1525715545, "post_id": 50219670, "comment_id": 87456716, "body": "When decoding a JSON object into an interface{}, you will get a map. See this example: <a href=\"https://play.golang.org/p/OE9ebKR0L85\" rel=\"nofollow noreferrer\">play.golang.org/p/OE9ebKR0L85</a> The resulting map is <b>not</b> type-assertable to a struct."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1525715682, "post_id": 50219670, "comment_id": 87456795, "body": "Show more of your code.  This is a possible duplicate of <a href=\"https://stackoverflow.com/questions/41111932/go-websocket-serialization-deserialization-json\" title=\"go websocket serialization deserialization json\">stackoverflow.com/questions/41111932/&hellip;</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525715861, "post_id": 50219670, "comment_id": 87456886, "body": "Please post minimal question which contains the json that you wants to unmarshal into struct <code>OrderBook</code>"}], "answers": [{"tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1525724881, "creation_date": 1525724881, "answer_id": 50221936, "question_id": 50219670, "link": "https://stackoverflow.com/questions/50219670/getting-interface-into-struct/50221936#50221936", "title": "Getting interface into struct", "body": "<p>As others have noted type assertions would be the answer to solve your immediate error given the interface contains the right type of struct. </p>\n\n<p>But if your interface comes from JSON parsing, it will likely contain a <code>map[string]interface{}</code> and not a <code>OrderBookResult</code>. See <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">here</a> for why that is the case. </p>\n\n<p>To solve that please read up on how to create a custom JSON marshaller. For example in <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">this blog.</a> Below I have also included a way of processing a <code>map[string]interface{}</code> to get to your data in the publish function.</p>\n\n<p>So you can either type assert before you call:</p>\n\n<pre><code>....\ncase \"data\":\n\n    // Assert that e.Data is in fact a struct of type OrderBookResult\n    if dataAsOrderBookResult, ok := e.Data.(OrderBookResult); ok {\n        publish(dataAsOrderBookResult)\n    } else {\n        // handle error etc\n        ...\n    }\n\n....\n</code></pre>\n\n<p>Or change the signature of your publish function and type assert the parameter inside:</p>\n\n<pre><code>func publish(data interface{}) {\n    log.Println(\"Publishing trade data...\", data)\n\n    o := &amp;OrderBook{}\n    // Type switch\n    switch v := data.(type) {\n    case OrderBookResult:\n        o.Pair = \"BTCEUR\"\n        o.Timestamp = v.Timestamp\n        o.Broker = \"Bitstamp\"\n        o.Asks = v.Asks\n        o.Bids = v.Bids\n    case map[string]interface{}:\n        o.Pair = \"BTCEUR\"\n        o.Timestamp = v[\"Timestamp\"].(string)\n        o.Broker = \"Bitstamp\"\n        // here again you need to type assert correctly and it may be a map again\n        //o.Asks = v[\"Asks\"].(OrderBookItem)\n        //o.Bids = v[\"Bids\"].(OrderBookItem)\n    default:\n        // error handling etc.\n        ...\n    } \n...    \n}\n</code></pre>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1525724881, "creation_date": 1525714658, "question_id": 50219670, "link": "https://stackoverflow.com/questions/50219670/getting-interface-into-struct", "title": "Getting interface into struct", "body": "<p>I'm a little new to golang and trying to process some websocket data.</p>\n\n<p>I get data in the form of:</p>\n\n<pre><code>type Event struct {\n    Event string      `json:\"event\"`\n    Data  interface{} `json:\"data\"`\n}\n</code></pre>\n\n<p>And the <code>Data</code> field is a json object that I want to process and get into the following struct:</p>\n\n<pre><code>type OrderBook struct {\n    Pair      string          `json:\"pair\"`\n    Timestamp string          `json:\"timestamp\"`\n    Broker    string          `json:\"broker\"`\n    Bids      []OrderBookItem `json:\"bids\"`\n    Asks      []OrderBookItem `json:\"asks\"`\n}\n\ntype OrderBookItem struct {\n    Price  float64\n    Amount float64\n}\n</code></pre>\n\n<p>from the websocket function:</p>\n\n<pre><code>....\ncase \"data\":\n    publish(e.Data) &lt;--- this is where the error occurs\n....\n</code></pre>\n\n<p>which calls:</p>\n\n<pre><code>func publish(data OrderBookResult) {\n    log.Println(\"Publishing trade data...\", data)\n\n    o := &amp;OrderBook{}\n    o.Pair = \"BTCEUR\"\n    o.Timestamp = data.Timestamp\n    o.Broker = \"Bitstamp\"\n    o.Asks = data.Asks\n    o.Bids = data.Bids\n\n}\n</code></pre>\n\n<p>The error in the websocket function I get is the following:</p>\n\n<pre><code>cannot use e.Data (type interface {}) as type OrderBookResult in argument to publish: need type assertion\n</code></pre>\n\n<p>How can I \"cast\" the websocket struct into the new struct and reference fields, that are not defined on the websocket struct. I have a <code>node.js</code> background and I haven't gotten my head around the strictness of go yet.</p>\n\n<p>Thx</p>\n"}, {"tags": ["mysql", "amazon-web-services", "go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1525714952, "creation_date": 1525714952, "answer_id": 50219736, "question_id": 50219395, "link": "https://stackoverflow.com/questions/50219395/golang-aws-xray-sql-error/50219736#50219736", "title": "Golang aws xray.sql error", "body": "<p>The problem is that you're using a nil context. This can be inferred from the stack trace, since the panic happens in a function called <code>getTraceHeaderFromContext</code>, and confirmed by looking at the location of the panic in the <a href=\"https://github.com/aws/aws-xray-sdk-go/blob/master/xray/lambda.go#L35\" rel=\"nofollow noreferrer\">aws library line 35</a> where the panic occurred:</p>\n\n<pre><code>    if traceHeaderValue := ctx.Value(LambdaTraceHeaderKey); traceHeaderValue != nil {\n</code></pre>\n\n<p>Never do this. Always instantiate your context properly:</p>\n\n<pre><code>ctx := context.Background()\n</code></pre>\n\n<p>Although in your case, the best option is to use the context that already exists in the HTTP request:</p>\n\n<pre><code>ctx := r.Context()\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 50219736, "answer_count": 1, "score": 0, "last_activity_date": 1525714952, "creation_date": 1525713455, "question_id": 50219395, "link": "https://stackoverflow.com/questions/50219395/golang-aws-xray-sql-error", "title": "Golang aws xray.sql error", "body": "<p>I am getting error on mysql query using aws xras.sql.\nI get doc fro implementation from link below\n<a href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-sqlclients.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-sqlclients.html</a></p>\n\n<p>Here is my code for route and database query</p>\n\n<pre><code>http.Handle(\"/\", xray.Handler(xray.NewDynamicSegmentNamer(\"MyApp\", \"*.example.com\"), http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    db , _ := xray.SQL(\"mysql\", \"golang:root@localhost:3306/bonusapi\")\n    defer db.Close()\n\n    var ctx context.Context\n    db.QueryRow(ctx, \"SELECT * FROM user\")\n    w.Write([]byte(\"Allah Hoo\"))\n})))\n</code></pre>\n\n<p>Here is error log</p>\n\n<pre><code>    2018/05/07 21:30:22 http: panic serving 127.0.0.1:46921: runtime error: invalid memory address or nil pointer dereference\ngoroutine 33 [running]:\nnet/http.(*conn).serve.func1(0xc0421c4000)\n    C:/Go/src/net/http/server.go:1726 +0xd7\npanic(0x7896a0, 0xa0e460)\n    C:/Go/src/runtime/panic.go:502 +0x237\ngithub.com/aws/aws-xray-sdk-go/xray.getTraceHeaderFromContext(0x0, 0x0, 0x78fd60)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/lambda.go:35 +0x2d\ngithub.com/aws/aws-xray-sdk-go/xray.BeginSubsegment(0x0, 0x0, 0x7f8f47, 0x7, 0x0, 0x0, 0x0)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/segment.go:160 +0x98\ngithub.com/aws/aws-xray-sdk-go/xray.Capture(0x0, 0x0, 0x7f8f47, 0x7, 0xc042035a88, 0x0, 0x0)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/capture.go:19 +0x62\ngithub.com/aws/aws-xray-sdk-go/xray.(*DB).QueryRow(0xc0421d6200, 0x0, 0x0, 0x7fd9e7, 0x12, 0x0, 0x0, 0x0, 0xc042199b50)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/sql_go18.go:75 +0xf4\nmain.main.func1(0x87d400, 0xc042002140, 0xc0421d4100)\n    D:/PROJECTS/cProject/tom-berger/eon-bone-api/src/main/application.go:45 +0xbe\nnet/http.HandlerFunc.ServeHTTP(0x8135b8, 0x87d400, 0xc042002140, 0xc0421d4100)\n    C:/Go/src/net/http/server.go:1947 +0x4b\ngithub.com/aws/aws-xray-sdk-go/xray.httpTrace(0xc042026a80, 0x87aa80, 0x8135b8, 0x87d7c0, 0xc0421de000, 0xc0421d4100, 0xc04203c280)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/handler.go:150 +0x5a4\ngithub.com/aws/aws-xray-sdk-go/xray.Handler.func1(0x87d7c0, 0xc0421de000, 0xc0421d4000)\n    C:/Go/src/github.com/aws/aws-xray-sdk-go/xray/handler.go:115 +0x191\nnet/http.HandlerFunc.ServeHTTP(0xc0421806f0, 0x87d7c0, 0xc0421de000, 0xc0421d4000)\n    C:/Go/src/net/http/server.go:1947 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0xa1ad40, 0x87d7c0, 0xc0421de000, 0xc0421d4000)\n    C:/Go/src/net/http/server.go:2337 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04217ea90, 0x87d7c0, 0xc0421de000, 0xc0421d4000)\n    C:/Go/src/net/http/server.go:2694 +0xc3\nnet/http.(*conn).serve(0xc0421c4000, 0x87db40, 0xc04203c080)\n    C:/Go/src/net/http/server.go:1830 +0x658\ncreated by net/http.(*Server).Serve\n    C:/Go/src/net/http/server.go:2795 +0x282\n</code></pre>\n"}, {"tags": ["go", "ssh", "network-programming", "cisco"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525712645, "post_id": 50219120, "comment_id": 87455328, "body": "<code>ssh user@ap_ip</code> and <code>ssh user@ap_ip &#39;command&#39;</code> are different things.  Running ssh with <code>-vvv</code> will give you more information about how the commands are executed."}], "answers": [{"tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 0, "last_activity_date": 1525713675, "creation_date": 1525713675, "answer_id": 50219445, "question_id": 50219120, "link": "https://stackoverflow.com/questions/50219120/ssh-unknown-tty-error-message/50219445#50219445", "title": "SSH Unknown TTY Error Message", "body": "<p>ssh without explicit command given will allocate a terminal while ssh with a command given will by default not. It looks like the command you execute needs a terminal. In this case use the <code>-t</code> option, i.e. <code>ssh -t user@ip command</code>. From <a href=\"https://man.openbsd.org/ssh\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n\n<pre><code>-t      Force pseudo-terminal allocation.  This can be used to execute \n        arbitrary screen-based programs on a remote machine, which can be\n        very useful, e.g. when implementing menu services. Multiple -t \n        options force tty allocation, even if ssh has no local tty.\n</code></pre>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 0, "accepted_answer_id": 50219445, "answer_count": 1, "score": -3, "last_activity_date": 1525713675, "creation_date": 1525712331, "question_id": 50219120, "link": "https://stackoverflow.com/questions/50219120/ssh-unknown-tty-error-message", "title": "SSH Unknown TTY Error Message", "body": "<p>When trying to run the command <code>ssh user@ip 'command'</code>, I keep receiving this error: <code>can't get tty settingscan't set orig mode</code>. I have tried googling this and searching here but have not found anything referring to this message. I am trying to automate connecting to a Cisco wireless access point (2800 model) using Golang to run a command then exit, but this message pops up each time. I can log in normally using <code>ssh user@ap_ip</code>, but using the shorthand <code>ssh user@ap_ip 'command'</code> or trying the equivalent in Golang gives the error message above. Anyone know what's going on?</p>\n"}, {"tags": ["go", "reflection", "interface"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1525708911, "last_edit_date": 1525708911, "creation_date": 1525707911, "answer_id": 50217967, "question_id": 50217748, "link": "https://stackoverflow.com/questions/50217748/reflect-on-list-of-interfaces/50217967#50217967", "title": "Reflect on list of interfaces", "body": "<p>There are a couple of issues here.  First, it's not possible to set an <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">unexported</a> field. Here's a change to make the field exported:</p>\n\n<pre><code>type Foo interface {\n    // Rename Value to GetValue to avoid clash with Value field in bar\n    GetValue() int\n}\n\ntype bar struct {\n    // export the field by capitalizing the name\n    Value int\n}\n\nfunc (b bar) GetValue() int {\n    return b.Value\n}\n\ntype baz struct{}\n\nfunc (b baz) GetValue() int {\n    return 42\n}\n</code></pre>\n\n<p>The next issue is a <code>bar</code> interface value is not addressable. To fix this, use a <code>*bar</code> in the slice instead instead of a <code>bar</code>:</p>\n\n<pre><code>func (b *bar) GetValue() int {\n    return b.Value\n}\n\n...\n\nvar foos = Foos{\n    &amp;bar{},\n    baz{},\n}\n</code></pre>\n\n<p>With these changes, we can write the function to set the value:</p>\n\n<pre><code>func change(g Foo) {\n    v := reflect.ValueOf(g)\n\n    // Return if not a pointer to a struct.\n\n    if v.Kind() != reflect.Ptr {\n        return\n    }\n    v = v.Elem()\n    if v.Kind() != reflect.Struct {\n        return\n    }\n\n    // Set the field Value if found.\n\n    v = v.FieldByName(\"Value\")\n    if !v.IsValid() {\n        return\n    }\n    v.SetInt(31)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uQZGq8a5nAd\" rel=\"nofollow noreferrer\">Run it on the playground</a></p>\n\n<p>The above answers the question, but it may not be the best solution to the actual problem.  A better solution may be to define a setter interface:</p>\n\n<pre><code>type ValueSetter interface {\n    SetValue(i int)\n}\n\nfunc (b *bar) Value() int {\n    return b.value\n}\n\nfunc (b *bar) SetValue(i int) {\n    b.value = i\n}\n\nfunc change(g Foo) {\n    if vs, ok := g.(ValueSetter); ok {\n        vs.SetValue(31)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MgA5YHf_LiW\" rel=\"nofollow noreferrer\">Run it on the playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 6840, "user_id": 1353549, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/413d2645039577214eb6382b3166e1c4?s=128&d=identicon&r=PG", "display_name": "akim", "link": "https://stackoverflow.com/users/1353549/akim"}, "edited": false, "score": 0, "creation_date": 1525859893, "post_id": 50219021, "comment_id": 87518185, "body": "I am not the author of the types and interfaces that I have to deal with, and can&#39;t change them.  Otherwise doing this upstream, as you did, is of course the approach, no doubt about that.   Thanks!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1525711992, "creation_date": 1525711992, "answer_id": 50219021, "question_id": 50217748, "link": "https://stackoverflow.com/questions/50217748/reflect-on-list-of-interfaces/50219021#50219021", "title": "Reflect on list of interfaces", "body": "<p>Please don't use your current approach. It has several drawbacks.</p>\n\n<ol>\n<li>It's confusing (as you've discovered)</li>\n<li>It's slow. Reflection is always slow.</li>\n<li>It's inflexible. Your loop, not the type itself, must understand the capabilities of each type implementation.</li>\n</ol>\n\n<p>Instead, just expand your interface to include a setter method--possibly an optional setter method.  Then you can loop through the items and set the value for those that support it.  Example:</p>\n\n<pre><code>// FooSetter is an optional interface which allows a Foo to set its value.\ntype FooSetter interface {\n    SetValue(int)\n}\n\n// SetValue implements the optional FooSetter interface for type bar.\nfunc (b *bar) SetValue(v int) {\n    b.value = v\n}\n</code></pre>\n\n<p>Then make your loop look like this:</p>\n\n<pre><code>for _, v := range foos {\n    if setter, ok := v.(FooSetter); ok {\n        setter.SetValue(51)\n    }\n}\n</code></pre>\n\n<p>Now when you (or a third party user of your library) adds a type <code>Baz</code> that satisfies the <code>FooSetter</code> interface, you don't have to modify your loop at all.</p>\n"}], "owner": {"reputation": 6840, "user_id": 1353549, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/413d2645039577214eb6382b3166e1c4?s=128&d=identicon&r=PG", "display_name": "akim", "link": "https://stackoverflow.com/users/1353549/akim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 1, "accepted_answer_id": 50217967, "answer_count": 2, "score": 1, "last_activity_date": 1525711992, "creation_date": 1525707127, "question_id": 50217748, "link": "https://stackoverflow.com/questions/50217748/reflect-on-list-of-interfaces", "title": "Reflect on list of interfaces", "body": "<p>I have read several examples/questions about reflection in Go, but I'm still unable to understand what I'm supposed to do with my list of interfaces.</p>\n\n<p>Below is a stripped down version of the real use case.</p>\n\n<p>I have several types complying with a given interface:</p>\n\n<pre><code>type Foo interface {\n    Value() int\n}\n\ntype bar struct {\n    value int\n}\n\nfunc (b bar) Value() int {\n    return b.value\n}\n\ntype baz struct{}\n\nfunc (b baz) Value() int {\n    return 42\n}\n</code></pre>\n\n<p>I have a list of such guys</p>\n\n<pre><code>type Foos []Foo\nvar foos = Foos{\n    bar{},\n    baz{},\n}\n</code></pre>\n\n<p>and I would like to traverse this list by changing the value of the members that have a <code>value</code> field.</p>\n\n<pre><code>    for k := range foos {\n        change(&amp;foos[k])\n    }\n</code></pre>\n\n<p>But I'm unable to find the right path</p>\n\n<pre><code>func change(g *Foo) {\n    t := reflect.TypeOf(g).Elem()\n    fmt.Printf(\"t: Kind %v, %#v\\n\", t.Kind(), t)\n    v := reflect.ValueOf(g).Elem()\n    fmt.Printf(\"v: Kind %v, %#v, %v\\n\", v.Kind(), v, v.CanAddr())\n    if f, ok := t.FieldByName(\"value\"); ok {\n        fmt.Printf(\"f: %#v, OK: %v\\n\", f, ok)\n        vf := v.FieldByName(\"value\")\n        fmt.Printf(\"vf: %#v: %v\\n\", vf, vf.CanAddr())\n        vf.SetInt(51)\n    }\n}\n</code></pre>\n\n<p>As you can see, I'm not sure how to glue together the TypeOf and ValueOf bits...</p>\n\n<p>The <a href=\"https://play.golang.org/p/VMzQ6cGtLRD\" rel=\"nofollow noreferrer\" title=\"Full Example on Go Playground\">full example is on Go Playground</a>.</p>\n"}, {"tags": ["go", "google-admin-sdk", "google-directory-api", "google-reseller-api"], "answers": [{"tags": [], "owner": {"reputation": 190, "user_id": 6135889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hVeBA.png?s=128&g=1", "display_name": "kwiesmueller", "link": "https://stackoverflow.com/users/6135889/kwiesmueller"}, "is_accepted": false, "score": 0, "last_activity_date": 1525707426, "creation_date": 1525707426, "answer_id": 50217845, "question_id": 50217655, "link": "https://stackoverflow.com/questions/50217655/adding-first-user-to-newly-provisioned-customer-through-reseller-api-not-allowed/50217845#50217845", "title": "Adding first user to newly provisioned customer through reseller API not allowed", "body": "<p>Keeping the question open in case others stumble about this too.\nThe issue was, that in our own project the Admin SDK API got/was disabled.</p>\n\n<p>Slipped through the setup process so if you encounter this issue, try enabling the Admin SDK API (which is different from the Reseller API).</p>\n"}], "owner": {"reputation": 190, "user_id": 6135889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hVeBA.png?s=128&g=1", "display_name": "kwiesmueller", "link": "https://stackoverflow.com/users/6135889/kwiesmueller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525707426, "creation_date": 1525706804, "question_id": 50217655, "link": "https://stackoverflow.com/questions/50217655/adding-first-user-to-newly-provisioned-customer-through-reseller-api-not-allowed", "title": "Adding first user to newly provisioned customer through reseller API not allowed", "body": "<p>We are setting up an easy way to provision new G Suite customers and our project is already capable of creating customers and the respective subscriptions.\nBut users only get some welcome mail from Google and are being told to login.\nWhen trying to create the first user through the admin directory api all we get is this:</p>\n\n<pre><code>googleapi: Error 403: Access Not Configured. Admin Directory API has not been used in project xxx before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/admin.googleapis.com/overview?project=xxx then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry., accessNotConfigured\"\n</code></pre>\n\n<p>(sensitive information marked with xxx)</p>\n\n<p>The API client is built using the same method as the reseller client and all this is done through our domain-wide delegated service account with the required scopes set in (our) G Suite.</p>\n\n<p>When using the Reseller Console to jump into the new customers admin interface, the API's there are enabled (default).</p>\n\n<p>The docs online don't really tell something about this and just describe how to create the user but no limitations are listed.</p>\n\n<p>We are using the Golang libraries, the user insert looks like this:</p>\n\n<pre><code>...\nusr, err := adm.Users.Insert(trial.User).Do()\nif err != nil {\n    ...\n}\n\n...\nerr = adm.Users.MakeAdmin(usr.PrimaryEmail, &amp;admin.UserMakeAdmin{\n    Status: true,\n}).Do()\nif err != nil {\n    ...\n}\n...\n</code></pre>\n\n<p>The API client is build like this:</p>\n\n<pre><code>    const envVar = \"GOOGLE_APPLICATION_CREDENTIALS\"\n    if filename := os.Getenv(envVar); filename != \"\" {\n        serviceAccountJSON, err := ioutil.ReadFile(filename)\n        if err != nil {\n            log.Fatal(\"creating oauth client failed\", zap.Error(err))\n        }\n        config, err := google.JWTConfigFromJSON(serviceAccountJSON,\n            reseller.AppsOrderScope,\n            admin.AdminDirectoryUserScope,\n        )\n\n        adminClient = config.Client(ctx)\n        config.Subject = *impersonationUser\n        resellerClient = config.Client(ctx)\n    }\n    res, _ := reseller.New(resellerClient)\n    adm, _ := admin.New(adminClient)\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1525704683, "post_id": 50216961, "comment_id": 87450896, "body": "<code>a = append(a, myValue)</code>"}, {"owner": {"reputation": 295, "user_id": 1176154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bGOB6.jpg?s=128&g=1", "display_name": "RAFJR", "link": "https://stackoverflow.com/users/1176154/rafjr"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1525706095, "post_id": 50216961, "comment_id": 87451747, "body": "that didn&#39;t work as expected: <a href=\"https://play.golang.org/p/dHDwTlbRLDu\" rel=\"nofollow noreferrer\">play.golang.org/p/dHDwTlbRLDu</a>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1525706173, "post_id": 50216961, "comment_id": 87451792, "body": "That&#39;s because you&#39;re not doing exactly what you requested in your question. Create a <code>[]interface{}</code> variable, add your variables to that, then unpack it (<code>...</code>) when calling Sprintf."}, {"owner": {"reputation": 295, "user_id": 1176154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bGOB6.jpg?s=128&g=1", "display_name": "RAFJR", "link": "https://stackoverflow.com/users/1176154/rafjr"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1525706333, "post_id": 50216961, "comment_id": 87451888, "body": "Edits made. That did it. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1525706762, "creation_date": 1525706762, "answer_id": 50217642, "question_id": 50216961, "link": "https://stackoverflow.com/questions/50216961/how-do-i-append-values-to-a-interface/50217642#50217642", "title": "How do I append values to a ...interface{}?", "body": "<p>You need to first append your new value to the <code>a</code> slice, and then unpack the slice when calling <code>fmt.Sprintf</code>:</p>\n\n<pre><code>func Sprintf2(format string, a ...interface{}) string {\n    a = append(a, 5)\n    return fmt.Sprintf(format+\" and %d cats\", a...)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YRWzAT2Yxm_q\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YRWzAT2Yxm_q</a></p>\n"}], "owner": {"reputation": 295, "user_id": 1176154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bGOB6.jpg?s=128&g=1", "display_name": "RAFJR", "link": "https://stackoverflow.com/users/1176154/rafjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1666, "favorite_count": 0, "accepted_answer_id": 50217642, "answer_count": 1, "score": -2, "last_activity_date": 1525767965, "creation_date": 1525704461, "last_edit_date": 1525767965, "question_id": 50216961, "link": "https://stackoverflow.com/questions/50216961/how-do-i-append-values-to-a-interface", "title": "How do I append values to a ...interface{}?", "body": "<p>Here's a sample function I want to emulate:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(fmt.Sprintf(\"Initially I want %d %s\", 2, \"dogs\"))\n    fmt.Println(Sprintf2(\"Now I want %d %s\", 2, \"dogs\"))\n}\n\nfunc Sprintf2(format string, a ...interface{}) string {\n\nreturn fmt.Sprintf(format + \" and %d cats\", append(a, 5))\n}\n</code></pre>\n\n<p>here's a link in playground: <a href=\"https://play.golang.org/p/dHDwTlbRLDu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dHDwTlbRLDu</a></p>\n\n<p>expected output:</p>\n\n<blockquote>\n  <p>Initially I want 2 dogs<br/>\n  Now I want 2 dogs and 5 cats</p>\n</blockquote>\n\n<p>actual output:</p>\n\n<blockquote>\n  <p>Initially I want 2 dogs <br/>\n  Now I want [2 %!d(string=dogs) 5] %!s(MISSING) and %!d(MISSING) cats</p>\n</blockquote>\n"}, {"tags": ["go", "concurrency", "threadpool", "goroutine"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1525704069, "post_id": 50216602, "comment_id": 87450521, "body": "I&#39;m not sure the design of your channels are optimal.  For example, if <code>links</code> in unbuffered and there is only one worker go routine running <code>Parse</code>, then you&#39;d get a deadlock when a new URL is found."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 3, "last_activity_date": 1525721517, "creation_date": 1525721517, "answer_id": 50221214, "question_id": 50216602, "link": "https://stackoverflow.com/questions/50216602/closing-channel-when-all-workers-have-finished/50221214#50221214", "title": "Closing channel when all workers have finished", "body": "<p>As Tim already commented, don't use the same channel for reading and writing in a worker. This will deadlock eventually (even if buffered, because Murphy).</p>\n\n<p>A far simpler design is simply launching one goroutine per URL. A buffered channel can serve as a simple semaphore to limit the number of concurrent parsers (goroutines that don't do anything because they are blocked are usually negligible). Use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a> to wait until all work is done.</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n)\n\nfunc main() {\n    sem := make(chan struct{}, 10) // allow ten concurrent parsers\n    wg := &amp;sync.WaitGroup{}\n\n    wg.Add(1)\n    Parse(\"http://example.com\", sem, wg)\n\n    wg.Wait()\n    // all done\n}\n\nfunc Parse(u string, sem chan struct{}, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    sem &lt;- struct{}{}        // grab\n    defer func() { &lt;-sem }() // release\n\n    // If URL already parsed, return.\n\n    var newURLs []string\n\n    // ...\n\n    for u := range newURLs {\n        wg.Add(1)\n        go Parse(u)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 9720263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6fUu.png?s=128&g=1", "display_name": "pp492", "link": "https://stackoverflow.com/users/9720263/pp492"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1525721517, "creation_date": 1525703249, "question_id": 50216602, "link": "https://stackoverflow.com/questions/50216602/closing-channel-when-all-workers-have-finished", "title": "Closing channel when all workers have finished", "body": "<p>I am implementing a web crawler and I have a <code>Parse</code> function that takes an link as an input and should return all links contained in the page. </p>\n\n<p>I would like to make the most of go routines to make it as fast as possible. To do so, I want to create a pool of workers. </p>\n\n<p>I set up a channel of strings representing the links <code>links := make(chan string)</code> and pass it as an argument to the <code>Parse</code> function. I want the workers to communicate through a unique channel. When the function starts, it takes a link from <code>links</code>, parse it and **for each valid link found in the page, add the link to <code>links</code>. </p>\n\n<pre><code>func Parse(links chan string) {\n  l := &lt;- links\n  // If link already parsed, return\n  for url := newUrlFounds {\n    links &lt;- url\n  }\n}\n</code></pre>\n\n<p>However, the main issue here is to indicate when no more links have been found. One way I thought of doing it was to wait before all workers have completed. But I don't know how to do so in Go. </p>\n"}, {"tags": ["validation", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525703553, "post_id": 50215564, "comment_id": 87450155, "body": "Did you consider using embedding and constructors? Something like this: <a href=\"https://play.golang.org/p/-F0QEt1gHB_9\" rel=\"nofollow noreferrer\">play.golang.org/p/-F0QEt1gHB_9</a>"}, {"owner": {"reputation": 2826, "user_id": 1021714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/20c881547bd75073cbf61987251b7625?s=128&d=identicon&r=PG", "display_name": "braza", "link": "https://stackoverflow.com/users/1021714/braza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525708039, "post_id": 50215564, "comment_id": 87452943, "body": "@mkopriva Thanks, that looks like an improvement! Is there anyway to shorten or remove the <code>UserModelFromRegistration</code> function? Otherwise I have to create one of the functions for every type of form."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525708551, "post_id": 50215564, "comment_id": 87453254, "body": "For the cases where you have only one type of validation you can use the model. For the case where you have more than one custom validation, such as your example of login vs register, you&#39;ll need a separate struct and then manually create a model from that. Or you can write your own struct to struct binder using the reflect package, but I assume the number of cases where you have multiple custom validations is small compared to those where you have one validation per type... So use model wherever possible, otherwise use one of the two other options."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525708915, "post_id": 50215564, "comment_id": 87453460, "body": "Another option would be to redefine the whole struct with different tags and then just convert a value from one type to another. E.g. <a href=\"https://play.golang.org/p/OvuCKsUsyD7\" rel=\"nofollow noreferrer\">play.golang.org/p/OvuCKsUsyD7</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525709892, "post_id": 50215564, "comment_id": 87453928, "body": "One more idea: <a href=\"https://play.golang.org/p/3cSSWKR_TrI\" rel=\"nofollow noreferrer\">play.golang.org/p/3cSSWKR_TrI</a> but I&#39;m not sure whether echo&#39;s validation will skip an embedded field if the embedding struct has the same field with <code>validation:&quot;-&quot;</code>."}, {"owner": {"reputation": 2826, "user_id": 1021714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/20c881547bd75073cbf61987251b7625?s=128&d=identicon&r=PG", "display_name": "braza", "link": "https://stackoverflow.com/users/1021714/braza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525711152, "post_id": 50215564, "comment_id": 87454516, "body": "Thanks, I&#39;ll have a play and see what method works best!"}], "owner": {"reputation": 2826, "user_id": 1021714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/20c881547bd75073cbf61987251b7625?s=128&d=identicon&r=PG", "display_name": "braza", "link": "https://stackoverflow.com/users/1021714/braza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1525700054, "creation_date": 1525700054, "question_id": 50215564, "link": "https://stackoverflow.com/questions/50215564/reuse-or-cast-structs-for-validation-api-results-and-db-saves-in-go", "title": "Reuse or cast structs for validation, API results, and DB saves in Go", "body": "<p>I'm trying to write an API that will do different things with the data depending on its purpose.</p>\n\n<ul>\n<li>API results - The API should expose certain fields to the user</li>\n<li>Validation - Validation should handle different schemas e.g. login form doesn't require Name, but register does</li>\n<li>Database - The database should save everything, including password etc. - if I try using the same struct for the API and DB with <code>json:\"-\"</code> or un-exporting the field the database save also ignores the field</li>\n</ul>\n\n<p>Some sample code is below with a couple of comments in capitals to show where I ideally need to type cast to change the data. As they are different structs, they cannot be type cast, so I get an error. How can I fix this?</p>\n\n<p>Alternatively, what is a better way of doing different things with the data without having lots of similar structs?</p>\n\n\n\n<pre class=\"lang-golang prettyprint-override\"><code>// IDValidation for uuids\ntype IDValidation struct {\n    ID string `json:\"id\" validate:\"required,uuid\"`\n}\n\n\n// RegisterValidation for register form\ntype RegisterValidation struct {\n    Name     string `json:\"name\" validate:\"required\"`\n    Email    string `json:\"email\" validate:\"required,email\"`\n    Password string `json:\"password\" validate:\"required,min=8\"`\n}\n\n// UserModel to save in DB\ntype UserModel struct {\n    ID        string `json:\"id,omitempty\"`\n    Name      string `json:\"name\"`\n    Email     string `json:\"email\"`\n    Password  string `json:\"password,omitempty\"`\n    Active    bool   `json:\"active,omitempty\"`\n    CreatedAt int64  `json:\"created_at,omitempty\"`\n    UpdatedAt int64  `json:\"updated_at,omitempty\"`\n    jwt.StandardClaims\n}\n\n// UserAPI data to display to user\ntype UserAPI struct {\n    ID        string `json:\"id,omitempty\"`\n    Name      string `json:\"name\"`\n    Email     string `json:\"email\"`\n    Active    bool   `json:\"active,omitempty\"`\n}\n\n// register a user\nfunc register(c echo.Context) error {\n    u := new(UserModel)\n    if err := c.Bind(u); err != nil {\n        return err\n    }\n    // NEED TO CAST TO RegisterValidation HERE?\n    if err := c.Validate(u); err != nil {\n        return err\n    }\n    token, err := u.Register()\n    if err != nil {\n        return err\n    }\n    return c.JSON(http.StatusOK, lib.JSON{\"token\": token})\n}\n\n// retrieve a user\nfunc retrieve(c echo.Context) error {\n    u := IDValidation{\n        ID: c.Param(\"id\"),\n    }\n    if err := c.Validate(u); err != nil {\n        return echo.NewHTTPError(http.StatusBadRequest, err.Error())\n    }\n    // NEED TO CAST USER TO UserAPI?\n    user, err := userModel.GetByID(u.ID)\n    if err != nil {\n        return err\n    }\n    return c.JSON(200, lib.JSON{\"message\": \"User found\", \"user\": user})\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3037, "user_id": 1113913, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Kw2Ev.jpg?s=128&g=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/1113913/jason"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525691554, "post_id": 50212303, "comment_id": 87442480, "body": "@mkopriva I updated it. It was supposed to be an example of the structure that I am after. I realize the code works, but I am not writing to <code>os.Stdout</code> in my implementation, but to a file. My question is whether a streamed .json file can be created with the example hierarchy displayed above. As it stands, I am only able to generate a flat file containing the contents of  the <code>members</code> key. Perhaps I am trying to do something that is not idiomatic at all?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525691902, "post_id": 50212303, "comment_id": 87442683, "body": "<code>os.Stdout</code> or <code>os.File</code>, to the encoder it doesn&#39;t matter, it&#39;s all <code>io.Writer</code>. What you can do is to write to the <code>io.Writer</code> the enclosing braces and the <code>&quot;info&quot;: </code> key, then using the encoder write the info object, then again manually writing <code>, &quot;members&quot;: [ </code>to the <code>io.Writer</code> and back to the encoder writing the stream of members + a comma after each but the last, and finally closing it with <code>]}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1525693123, "last_edit_date": 1525693123, "creation_date": 1525692678, "answer_id": 50213203, "question_id": 50212303, "link": "https://stackoverflow.com/questions/50212303/nested-json-stream-using-newencoder/50213203#50213203", "title": "Nested JSON stream using NewEncoder", "body": "<p>Something similar is possible, but it's not especially simple.  I have done something similar in one of my open-source projects in a PR that I have not yet merged. But you can see my example <a href=\"https://github.com/go-kivik/couchdb/pull/59/files#diff-7a117cbfd5485ed35efcbb2995c37aa0R306\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>The interface I expose is to take in an <code>io.ReadCloser</code> and return a (possibly manipulated) <code>io.ReadCloser</code>.  Internally, it uses a <code>json.Decoder</code> to parse the JSON, possibly adding new data to the stream.  I'm not sure how a <code>json.Encoder</code> would fit into this (as asked in your question).</p>\n\n<p>Producing a complete working example for you would be a pretty big task for an SO answer, but I hope the link I provided can point you in the right direction.</p>\n\n<p>This is a case where good unit tests, and a TDD approach, would be well advised!</p>\n"}], "owner": {"reputation": 3037, "user_id": 1113913, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Kw2Ev.jpg?s=128&g=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/1113913/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1525693123, "creation_date": 1525689745, "last_edit_date": 1525691883, "question_id": 50212303, "link": "https://stackoverflow.com/questions/50212303/nested-json-stream-using-newencoder", "title": "Nested JSON stream using NewEncoder", "body": "<p>I am wondering whether it is possible to stream JSON and include other (sibling) keys besides the stream itself? I would like to include some extra data about the generated file. Something like the following:</p>\n\n<pre><code>{\n    \"info\": {\n        \"department\": \"a\",\n        \"id\": \"1\",\n    },\n    \"members\": [\n        { \"name\": \"a\", \"age\": \"1\" },\n        { \"name\": \"b\", \"age\": \"2\" },\n        { \"name\": \"c\", \"age\": \"3\" },\n        ...stream\n    ]\n}\n</code></pre>\n\n<p>Currently, I stream JSON to a flat file like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"os\"\n)\n\ntype Member struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n\nfunc main() {\n    enc := json.NewEncoder(os.Stdout)\n\n    letters := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"}\n\n    for i, letter := range letters {\n        key := Member{letter, i}\n\n        var err = enc.Encode(&amp;key)\n        if err != nil {\n            // handle err\n        }\n    }\n}\n</code></pre>\n\n<p>But as indicated above I would like to add another key such as \"info\" and contain the stream in a key such as \"members\"</p>\n\n<p>I can think of a solution to the problem, which would store them as separate files in a directory, e.g.</p>\n\n<pre><code>directory\n\u251c\u2500 members.json\n\u2514\u2500 info.json\n</code></pre>\n\n<p>But could other (sibling) keys be added or am I limited to a flat file?</p>\n"}, {"tags": ["http", "asynchronous", "go", "apache-kafka", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1525685904, "post_id": 50210857, "comment_id": 87439194, "body": "There&#39;s nothing inherently wrong with using a goroutine to log--that&#39;s actually a good use of a goroutine. You just need to be careful with data races--make sure your <code>log</code> and <code>r</code> variables are not simultaneously updated. It&#39;s impossible from the code you&#39;ve shown to tell whether there is a problem here. You should run tests with the race detector to help find such problems."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1525688129, "post_id": 50210857, "comment_id": 87440519, "body": "Still, please consider <a href=\"https://stackoverflow.com/a/50018458/720999\">this</a> when working on your design."}, {"owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525688263, "post_id": 50210857, "comment_id": 87440608, "body": "Thank you for reply. Both variables are being used only inside their gouroutines(reading from <code>r</code>, writing to <code>log</code>) and there is no outside changes to them. If I understand correctly - there shouldn&#39;t be race conditions? <code>-race</code> flag shows no errors."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525693421, "post_id": 50210857, "comment_id": 87443610, "body": "Well, <code>r</code> absolutely is not only being used within that goroutine. That variable is passed in from the http Server. But unless you&#39;re using middleware or other handlers that keep that request around longer, and modify it, it should be safe."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525693540, "post_id": 50210857, "comment_id": 87443678, "body": "<code>-race</code> showing no errors is good. But it&#39;s not fool-proof. Not all races will be triggered under test conditions, especially depending on how your tests are written. Consider <code>-race</code> to be a vital first step, but not the final word."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525718129, "post_id": 50216173, "comment_id": 87458022, "body": "Valid point about pointer on request, thank you. However i ran some load testing using yandex-tank, featuring two approaches - with and without goroutine for async logging. To my surprise, &#39;with goroutine&#39; variation doesn&#39;t end up with latency benefit. Both variantion were nearly the same, except that &#39;with goroutine&#39; spawned more goroutines. Metrics were done using prometheus. I understand that there are a lot of factors, but could it be because of native async of golang, so that any blocking operation return control to scheduler and there is no need for separate goroutine?"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "reply_to_user": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525747884, "post_id": 50216173, "comment_id": 87467546, "body": "I think, it&#39;s the nature of http redirects, the server sends the headers right away, there is no delay. In fact, I edited my version to make the redirect the very first thing, perhaps, it may shave off some milliseconds."}, {"owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525790168, "post_id": 50216173, "comment_id": 87489702, "body": "Tested code called redirect after logging. Farther investigation on your comment showed that position of redirect call doesn&#39;t affect latency. I also tried to add sleep after redirect and get response from the server after timeout that was set. Am I doing something wrong?"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "reply_to_user": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525823915, "post_id": 50216173, "comment_id": 87505135, "body": "I see your point, it&#39;s true the header hasn&#39;t been sent till the return. I changed it to defer and it seems that the redirect happens immediately now."}, {"owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525858020, "post_id": 50216173, "comment_id": 87517019, "body": "Direct usage of your code would never execute defer part, because return already happened. Even if return is placed after - defer is still will be executed before function returns, if I understand correctly. Some improvised <a href=\"http://play.golang.org/p/JVM__vaSMBs\" rel=\"nofollow noreferrer\">test</a>"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "reply_to_user": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525858768, "post_id": 50216173, "comment_id": 87517472, "body": "no, sorry, return wasn&#39;t needed there, but defer will be executed after the redirect"}, {"owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "edited": false, "score": 0, "creation_date": 1525950657, "post_id": 50216173, "comment_id": 87560153, "body": "You are right. Go playground forcefully use only 1 thread, so my example was incorrect."}], "tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": true, "score": 0, "last_activity_date": 1525858710, "last_edit_date": 1525858710, "creation_date": 1525701803, "answer_id": 50216173, "question_id": 50210857, "link": "https://stackoverflow.com/questions/50210857/async-work-after-response/50216173#50216173", "title": "Async work after response", "body": "<ol>\n<li>Yes, this is correct and efficient use of a goroutine (as <a href=\"https://stackoverflow.com/users/13860/flimzy\">Flimzy</a> pointed in the comments). I couldn't agree more, this is a good approach. </li>\n</ol>\n\n<p>The problem is that the handler may finish executing before the goroutine started processing everything and the request (which is a pointer) may be gone or you may have some races down the middleware stack. I read your comments, that it isn't your case, but in general, you shouldn't pass a request to a goroutine. As I can see from your code, you're really using only <code>RemoteAddr</code> from the request and why not to redirect straight away and put logging in the defer statement? So, I'd rewrite your handler a bit:</p>\n\n<pre><code>func httpHandler(w http.ResponseWriter, r *http.Request) {\n    http.Redirect(w, r, \"http://google.com\", 301)\n    defer func(runtimeDataString, RemoteAddr string) {\n            handlerLog := new(log)\n            handlerLog.RuntimeParam = runtimeDataString\n            handlerLog.AsyncParam = \"asyncDataString\"\n            handlerLog.RemoteAddress = RemoteAddr\n            jsonLog, err := json.Marshal(handlerLog)\n            if err == nil {\n                producer.ProduceChannel() &lt;- &amp;kafka.Message{\n                    TopicPartition: kafka.TopicPartition{Topic: &amp;topicName, Partition: kafka.PartitionAny},\n                    Value:          jsonLog,\n                }\n            }\n        }(\"runtimeDataString\", r.RemoteAddr)\n}  \n</code></pre>\n\n<ol start=\"2\">\n<li>The goroutines unlikely improve performance of your server as you just send the response earlier and those kafka connections could pile up in the background and slow down the whole server. If you find this as the bottleneck, you may consider saving logs locally and sending them to kafka in another process (or pool of workers) outside of your server. This may spread the workload over time (like sending fewer logs when you have more requests and vice versa).</li>\n</ol>\n"}], "owner": {"reputation": 13, "user_id": 9751358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a19cac7d50c9e845a95f006d3b685a?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Rin", "link": "https://stackoverflow.com/users/9751358/alex-rin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 892, "favorite_count": 1, "accepted_answer_id": 50216173, "answer_count": 1, "score": 1, "last_activity_date": 1525858710, "creation_date": 1525684965, "last_edit_date": 1525685697, "question_id": 50210857, "link": "https://stackoverflow.com/questions/50210857/async-work-after-response", "title": "Async work after response", "body": "<p>I am trying to implement http server that:</p>\n\n<ul>\n<li>Calculate farther redirect using some logic</li>\n<li>Redirect user</li>\n<li>Log user data</li>\n</ul>\n\n<p>The goal is to achieve maximum throughput (at least 15k rps). In order to do this, I want to save log asynchronously. I'm using kafka as logging system and separate logging block of code into separate goroutine. Overall example of current implementation:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/confluentinc/confluent-kafka-go/kafka\"\n    \"net/http\"\n    \"time\"\n    \"encoding/json\"\n)\n\ntype log struct {\n    RuntimeParam  string `json:\"runtime_param\"`\n    AsyncParam    string `json:\"async_param\"`\n    RemoteAddress string `json:\"remote_address\"`\n}\n\nvar (\n    producer, _ = kafka.NewProducer(&amp;kafka.ConfigMap{\n        \"bootstrap.servers\": \"localhost:9092,localhost:9093\",\n        \"queue.buffering.max.ms\": 1 * 1000,\n        \"go.delivery.reports\": false,\n        \"client.id\": 1,\n    })\n    topicName = \"log\"\n)\n\nfunc main() {\n    siteMux := http.NewServeMux()\n    siteMux.HandleFunc(\"/\", httpHandler)\n    srv := &amp;http.Server{\n        Addr: \":8080\",\n        Handler: siteMux,\n        ReadTimeout:  2 * time.Second,\n        WriteTimeout: 5 * time.Second,\n        IdleTimeout:  10 * time.Second,\n    }\n    if err := srv.ListenAndServe(); err != nil {\n        panic(err)\n    }\n}\n\nfunc httpHandler(w http.ResponseWriter, r *http.Request) {\n    handlerLog := new(log)\n    handlerLog.RuntimeParam = \"runtimeDataString\"\n    http.Redirect(w, r, \"http://google.com\", 301)\n    go func(goroutineLog *log, request *http.Request) {\n        goroutineLog.AsyncParam = \"asyncDataString\"\n        goroutineLog.RemoteAddress = r.RemoteAddr\n        jsonLog, err := json.Marshal(goroutineLog)\n        if err == nil {\n            producer.ProduceChannel() &lt;- &amp;kafka.Message{\n                TopicPartition: kafka.TopicPartition{Topic: &amp;topicName, Partition: kafka.PartitionAny},\n                Value:          jsonLog,\n            }\n        }\n    }(handlerLog, r)\n}\n</code></pre>\n\n<p>The questions are: </p>\n\n<ol>\n<li>Is it correct/efficient to use separate goroutine to implement async logging or should I use a different approach? (workers and channels for example)</li>\n<li>Maybe there is a way to further improve performance of server, that I'm missing?</li>\n</ol>\n"}, {"tags": ["caching", "go", "concurrency", "channel", "memoization"], "answers": [{"tags": [], "owner": {"reputation": 563, "user_id": 4539721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d6650d3a6a89e08bd747a07fd06989a?s=128&d=identicon&r=PG", "display_name": "Soham Kamani", "link": "https://stackoverflow.com/users/4539721/soham-kamani"}, "is_accepted": false, "score": 1, "last_activity_date": 1525684817, "creation_date": 1525684817, "answer_id": 50210817, "question_id": 50207652, "link": "https://stackoverflow.com/questions/50207652/channel-concurrency-guarantees/50210817#50210817", "title": "Channel concurrency guarantees", "body": "<p>The short answer is <strong>yes</strong>.</p>\n\n<p>We can simplify some of the code to get to the essence of why. Consider your <code>Mu</code> struct:</p>\n\n<pre><code>type Mu struct {\n    memo int\n    done chan bool\n}\n</code></pre>\n\n<p>We can now define 2 functions, <code>compute</code> and <code>read</code></p>\n\n<pre><code>func compute(r *Mu) {\n    time.Sleep(2 * time.Second)\n    r.memo = 42\n    close(r.done)\n}\n\nfunc read(r *Mu) {\n    &lt;-r.done\n    fmt.Println(\"Read value: \", r.memo)\n}\n</code></pre>\n\n<p>Here, <code>compute</code> is a computationally heavy task (which we can simulate by sleeping for some time)</p>\n\n<p>Now, in the main function, we start a new <code>compute</code> go routine, along with starting some <code>read</code> go routines at regular intervals:</p>\n\n<pre><code>func main() {\n    r := &amp;Mu{}\n    r.done = make(chan bool)\n    go compute(r)\n\n    // this one starts immediately\n    go read(r)\n    time.Sleep(time.Second)\n\n    // this one starts in the middle of computation\n    go read(r)\n    time.Sleep(2*time.Second)\n\n    // this one starts after the computation is complete\n    go read(r)\n\n    // This is to prevent the program from terminating immediately\n    time.Sleep(3 * time.Second)\n}\n</code></pre>\n\n<p>In all three cases, we print out the result of the compute task.</p>\n\n<blockquote>\n  <p>Working code <a href=\"https://play.golang.org/p/kgeje7s_6MB\" rel=\"nofollow noreferrer\">here</a></p>\n</blockquote>\n\n<p>When you \"close\" a channel in go, all statements which wait for the result of the channel (including statements that are executed after it's closed) will block. So provided that the <em>only</em> place that the channel is being closed from is the place where the memo value is computed, you will have that guarantee.</p>\n\n<p>The only place where you should be careful, is to make sure that this channel isn't closed anywhere else in your code.</p>\n"}], "owner": {"reputation": 927, "user_id": 2419669, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/kuQAn.jpg?s=128&g=1", "display_name": "yangmillstheory", "link": "https://stackoverflow.com/users/2419669/yangmillstheory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525684817, "creation_date": 1525671463, "last_edit_date": 1525676692, "question_id": 50207652, "link": "https://stackoverflow.com/questions/50207652/channel-concurrency-guarantees", "title": "Channel concurrency guarantees", "body": "<p>I'm writing a concurrency-safe memo:</p>\n\n<pre><code>package mu\n\nimport (\n    \"sync\"\n)\n\n// Func represents a memoizable function, operating on a string key, to use with a Mu\ntype Func func(key string) interface{}\n\n// Mu is a cache that memoizes results of an expensive computation\n//\n// It has a traditional implementation using mutexes.\ntype Mu struct {\n    // guards done\n    mu   sync.RWMutex\n    done map[string]chan bool\n    memo map[string]interface{}\n    f    Func\n}\n\n// Get a string key if it exists, otherwise computes the value and caches it.\n//\n// Returns the value and whether or not the key existed.\nfunc (c *Mu) Get(key string) (interface{}, bool) {\n    c.mu.RLock()\n    _, ok := c.done[key]\n    c.mu.RUnlock()\n    if ok {\n        return c.get(key), true\n    }\n\n    c.mu.Lock()\n    _, ok = c.done[key]\n    if ok {\n        c.mu.Unlock()\n    } else {\n        c.done[key] = make(chan bool)\n        c.mu.Unlock()\n\n        v := c.f(key)\n        c.memo[key] = v\n\n        close(c.done[key])\n    }\n    return c.get(key), ok\n}\n\n// get returns the value of key, blocking on an existing computation\nfunc (c *Mu) get(key string) interface{} {\n    &lt;-c.done[key]\n    v, _ := c.memo[key]\n    return v\n}\n</code></pre>\n\n<p>As you can see, there's a mutex guarding the <code>done</code> field, which is used\nto signal to other goroutines that a computation for a key is pending or done. This avoids duplicate computations (calls to <code>c.f(key)</code>) for the same key.</p>\n\n<p>My question is around the guarantees of this code; by ensuring that the computing goroutine closes the channel after it writes to <code>c.memo</code>, does this guarantee that other goroutines that access <code>c.memo[key]</code> after a  blocking call to <code>&lt;-c.done[key]</code> are guaranteed to see the result of the computation?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1525672942, "post_id": 50207643, "comment_id": 87432659, "body": "I can&#39;t find that busboy library, is it public? It looks like your functions don&#39;t have the right signature, can you include the type definition of busboy.MessageHandler"}, {"owner": {"reputation": 87, "user_id": 6582712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c874ea468cd513ec09233bb8474bb7ef?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/6582712/vinay-sawant"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1525673044, "post_id": 50207643, "comment_id": 87432688, "body": "type MessageHandler func(MessageDelivery) (interface{}, error)"}], "answers": [{"comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 87, "user_id": 6582712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c874ea468cd513ec09233bb8474bb7ef?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/6582712/vinay-sawant"}, "edited": false, "score": 0, "creation_date": 1525674087, "post_id": 50207952, "comment_id": 87433070, "body": "<code>too many arguments to return have (nil, nil) want ()</code> suggests that you have added the <code>return nil, nil</code> but not updated the function signature to include <code>(interface{}, error}</code> (which would also explain why you still can&#39;t use it as a MessageHandler).  This worked in a simpler example: <a href=\"https://play.golang.org/p/fP1dQa-cfmC\" rel=\"nofollow noreferrer\">play.golang.org/p/fP1dQa-cfmC</a>"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 87, "user_id": 6582712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c874ea468cd513ec09233bb8474bb7ef?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/6582712/vinay-sawant"}, "edited": false, "score": 0, "creation_date": 1525675512, "post_id": 50207952, "comment_id": 87433731, "body": "That was just an example without the required dependencies to show the principles work, not something to include in your code. What is the function signature for your functions now? Have you added the <code>(interface {}, error)</code> part?"}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 2, "last_activity_date": 1525673225, "creation_date": 1525673225, "answer_id": 50207952, "question_id": 50207643, "link": "https://stackoverflow.com/questions/50207643/cannot-use-function-type-func-as-type-in-argument/50207952#50207952", "title": "cannot use function (type func()) as type in argument", "body": "<p>You are passing the function as an argument correctly but they do not match the expected signature.  Change your functions to:</p>\n\n<pre><code>func UpperCaseHandler(md busboy.MessageDelivery) (interface{}, error} {\n     s.Reply(MessageTest{strings.ToUpper(md.Message.(string))}, md.Delivery)\n     return nil, nil\n}\n\nfunc RepeatHandler(md busboy.MessageDelivery) (interface{}, error} {\n     s.Reply(MessageTest{strings.Repeat(md.Message.(string), 5)}, md.Delivery)\n     return nil, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 6582712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c874ea468cd513ec09233bb8474bb7ef?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/6582712/vinay-sawant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7392, "favorite_count": 0, "accepted_answer_id": 50207952, "answer_count": 1, "score": -2, "last_activity_date": 1567235033, "creation_date": 1525671428, "last_edit_date": 1567235033, "question_id": 50207643, "link": "https://stackoverflow.com/questions/50207643/cannot-use-function-type-func-as-type-in-argument", "title": "cannot use function (type func()) as type in argument", "body": "<pre><code>package main\n\nimport (\n    \"log\"\n    \"strings\"\n\n    \"asl.com/asl\"\n)\n\n/*\nTrivial service to demonstrate chaining service together\nMessage starts in originator, travels through a couple formatters, and then gets back to originator\n*/\n\ntype MessageTest struct {\n    Body string `json:\"body\"`\n}\nvar s *asl.Service\nfunc main() {\n    var (\n        err error\n        cid string\n    )\n    //var m MessageDelivery\n       var g asl.MessageHandler\n       g = UpperCaseHandler\n\n    //  UpperCaser := asl.NewService(\"UpperCaser\", \"\", false)\n    UpperCaser := asl.NewService(\"UpperCaser\")\n    if err = UpperCaser.ConsumeFunc(\"asl-service-uc\", []string{\"asl-service-uc\"},func() interface{} {\n        return \"\"\n    },g); err != nil {\n        log.Fatalf(\"Error starting consumer: %v\", err)\n    }\n    //  Repeater := asl.NewService(\"Repeater\", \"\", false)\n    Repeater := asl.NewService(\"Repeater\")\n    if err = Repeater.ConsumeFunc(\"asl-service-repeat\", []string{\"asl-service-repeat\"}, func() interface{} {\n        return \"\"\n    }, RepeatHandler); err != nil {\n        //if err = Repeater.ConsumeFunc(\"asl-service-repeat\", []string{\"asl-service-repeat\"}, mg asl.MessageGenerator, mh asl.MessageHandler); err != nil {\n        log.Fatalf(\"Error starting consumer: %v\", err)\n    }\n\n    //  originator := asl.NewService(\"Originator\", \"\", false)\n    originator := asl.NewService(\"Originator\")\n\n    deliveryChan := make(chan asl.MessageDelivery)\n    m := asl.MessagePublishing{\n        Message:     MessageTest{\"this is a test\"},\n        RoutingKeys: []string{\"asl-service-uc\", \"asl-service-repeat\"},\n    }\n    if cid, err = originator.RPCPublish(m, deliveryChan); err != nil {\n        log.Fatalf(\"Failed to publish: %v\", err)\n    }\n\n    message := &lt;-deliveryChan\n    log.Printf(\"Originator Got: %+v\", message.Message)\n    originator.RemoveQueue(cid)\n    UpperCaser.Wait()\n}\n\nfunc UpperCaseHandler(md asl.MessageDelivery) {\n     s.Reply(MessageTest{strings.ToUpper(md.Message.(string))}, md.Delivery)\n}\n\nfunc RepeatHandler(md asl.MessageDelivery) {\n     s.Reply(MessageTest{strings.Repeat(md.Message.(string), 5)}, md.Delivery)\n}\n\n\npackage asl\n</code></pre>\n\n<blockquote>\n<pre><code>Error \n</code></pre>\n  \n  <p>./chains.go:26:10: cannot use UpperCaseHandler      (typefunc(asl.MessageDelivery)) as type asl.MessageHandler in\n  assignment\n  ./chains.go:37:86: cannot use RepeatHandler (type func(asl.MessageDelivery)) as type asl.MessageHandler in\n  argument to Repeater.ConsumeFunc</p>\n</blockquote>\n\n<pre><code>type MessageDelivery struct {\n    Delivery amqp.Delivery\n    Message  interface{}\n    Error    error\n    Context  *Context\n}    \ntype MessageGenerator func() interface{}\n\ntype MessageHandler func(MessageDelivery) (interface{}, error)\n</code></pre>\n\n<p>I tried running the code,where am i going wrong,how do i right pass function as argument to another function. The function returns\ninterface and error. Though function is taking MessageDelivery Struct as argument,function signature is same.where am i going wrong</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": true, "score": 1, "last_activity_date": 1525686425, "last_edit_date": 1525686425, "creation_date": 1525674399, "answer_id": 50208201, "question_id": 50207120, "link": "https://stackoverflow.com/questions/50207120/why-changing-the-traversal-from-in-order-to-pre-post-order-makes-the-answer-wron/50208201#50208201", "title": "Why changing the traversal from In-order to Pre/Post-order makes the answer wrong in &quot;Exercise: Equivalent Binary Trees&quot;?", "body": "<p>The answer for this one is rather related to data structures rather than Golang syntax and has to do with Binary Search Tree properties.</p>\n\n<p>As the documentation states <code>tree.New</code> func returns a random constructed key:</p>\n\n<blockquote>\n  <p>New returns a new, random binary tree holding the values k, 2k, ..., 10k.</p>\n</blockquote>\n\n<p>An inorder traversal promises the output to be sorted, but it isn't the case for preorder and postorder traversal and therefore the output would not be equal for these traversals.</p>\n\n<p>Consider the following tree:</p>\n\n<pre><code>       4\n      / \\\n     2   5\n    / \\\n   1   3\n</code></pre>\n\n<p>InOrder traverse: 1, 2, 3, 4, 5</p>\n\n<p>PostOrder traverse: 1 3 2 5 4</p>\n\n<p>For more information: <a href=\"http://cslibrary.stanford.edu/110/BinaryTrees.html\" rel=\"nofollow noreferrer\">Binary Trees</a></p>\n"}], "owner": {"reputation": 739, "user_id": 7559012, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/695e8ec49e5dae82f56dd6874ff187a0?s=128&d=identicon&r=PG&f=1", "display_name": "Bonje Fir", "link": "https://stackoverflow.com/users/7559012/bonje-fir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 50208201, "answer_count": 1, "score": 0, "last_activity_date": 1525686425, "creation_date": 1525667412, "last_edit_date": 1525668533, "question_id": 50207120, "link": "https://stackoverflow.com/questions/50207120/why-changing-the-traversal-from-in-order-to-pre-post-order-makes-the-answer-wron", "title": "Why changing the traversal from In-order to Pre/Post-order makes the answer wrong in &quot;Exercise: Equivalent Binary Trees&quot;?", "body": "<p>In the concurrency section of <a href=\"https://tour.golang.org/list\" rel=\"nofollow noreferrer\">Golang tour</a> there is an exercise as follows. The <a href=\"https://tour.golang.org/concurrency/8\" rel=\"nofollow noreferrer\">problem statement</a> wants to verify that two input trees are as the same or not.</p>\n\n<p>The problem here is when we changing the traversal order from in-order to pre/post-order it fails. i.e the bellow code works correctly</p>\n\n<pre><code>if t != nil {\n    traverse(t.Left, ch)\n    ch &lt;- t.Value\n    traverse(t.Right, ch)\n}\n</code></pre>\n\n<p>but if we first put the value to channel and then went to node's children its answer became wrong(run <a href=\"https://play.golang.org/p/6s047Bl14Ui\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://play.golang.org/p/6U1Yik1K6Xr\" rel=\"nofollow noreferrer\">this</a> for same input which output is difference).</p>\n\n<p>Since we used the same code for traversing its expected that the order should not matter(i.e values goes to the channel in the same order...).</p>\n\n<p><strong>PS:</strong> You can find more answers to this exercise <a href=\"https://stackoverflow.com/questions/12224042/go-tour-exercise-equivalent-binary-trees\">here</a>.</p>\n"}, {"tags": ["postgresql", "go", "jsonb", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 1213174, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5QTy2.jpg?s=128&g=1", "display_name": "Igor Khristenko", "link": "https://stackoverflow.com/users/1213174/igor-khristenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1525670040, "creation_date": 1525670040, "answer_id": 50207443, "question_id": 50207054, "link": "https://stackoverflow.com/questions/50207054/converting-exec-argument-2-type-invalid-character-b-looking-for-beginning-of/50207443#50207443", "title": "Converting Exec argument $2 type: invalid character \u2018b\u2019 looking for beginning of value", "body": "<p>I have decided it like this, just add quotes.\nJSON requires double quotes for all strings</p>\n\n<pre><code>params[\"imei_json\"] = types.JSONText(`\"` + params[\"imei\"].(string) + `\"`)\nparams[\"device_unique_id_json\"] = types.JSONText(`\"` + params[\"device_unique_id\"].(string) + `\"`)\n</code></pre>\n"}], "owner": {"reputation": 36, "user_id": 1213174, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5QTy2.jpg?s=128&g=1", "display_name": "Igor Khristenko", "link": "https://stackoverflow.com/users/1213174/igor-khristenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525676709, "creation_date": 1525666841, "last_edit_date": 1525676709, "question_id": 50207054, "link": "https://stackoverflow.com/questions/50207054/converting-exec-argument-2-type-invalid-character-b-looking-for-beginning-of", "title": "Converting Exec argument $2 type: invalid character \u2018b\u2019 looking for beginning of value", "body": "<p>I have a error when I try to update filed in JSONB with any letter, but if I update same filed with numbers it's work perfect. sql: converting Exec argument $2 type: invalid character \u2018b\u2019 looking for beginning of value. Example of insert type: <code>params[\"imei_json\"] = types.JSONText(params[\"imei\"].(string))</code></p>\n\n<pre><code>//Update User Information\nfunc (metadata *accountPhoneNumberMetadata) UpdateUserInfo(params map[string]interface{}) error {\n\n    params[\"imei_json\"] = types.JSONText(params[\"imei\"].(string))\n    params[\"device_unique_id_json\"] = types.JSONText(params[\"device_unique_id\"].(string))\n\n    tx := metadata.client.MustBegin()\n\n    if _, err := tx.NamedExec(metadata.sqlMetadataUpdate(), params); err != nil {\n        tx.Rollback()\n        return err\n    }\n\n    if _, err := tx.NamedExec(metadata.sqlPhoneNumbers(), params); err != nil {\n        tx.Rollback()\n        return err\n    }\n\n    if _, err := tx.NamedExec(metadata.sqlUpdateRegistrationMetadata(), params); err != nil {\n        tx.Rollback()\n        return err\n    }\n\n    if err := tx.Commit(); err != nil {\n        tx.Rollback()\n        return err\n    }\n    return nil\n}\nfunc (metadata *accountPhoneNumberMetadata) sqlUpdateRegistrationMetadata() string {\n    return `UPDATE registrations.metadata\n             SET \n                metadata = \n                    jsonb_set(jsonb_set(metadata, '{react_native_imei, device_imei}', :imei_json),\n                    '{react_native_device_info, device_unique_id}', :device_unique_id_json )\n             WHERE \n                metadata_id = (SELECT metadata_id FROM registrations.metadata WHERE registration_id = :registration_id               LIMIT 1)`\n}\n</code></pre>\n"}, {"tags": ["go", "mariadb"], "answers": [{"tags": [], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "is_accepted": true, "score": 0, "last_activity_date": 1525662950, "creation_date": 1525662950, "answer_id": 50206623, "question_id": 50206617, "link": "https://stackoverflow.com/questions/50206617/db-exec-args-always-results-in-an-error-for-my-placeholder/50206623#50206623", "title": "DB.Exec args always results in an error for my placeholder", "body": "<p>The answer was to set interpolate params to true. <a href=\"https://github.com/go-sql-driver/mysql#interpolateparams\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql#interpolateparams</a></p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 50206623, "answer_count": 1, "score": 0, "last_activity_date": 1525662950, "creation_date": 1525662907, "question_id": 50206617, "link": "https://stackoverflow.com/questions/50206617/db-exec-args-always-results-in-an-error-for-my-placeholder", "title": "DB.Exec args always results in an error for my placeholder", "body": "<p>I have an SQL script with a variable I want to set from Golang.</p>\n\n<pre><code>SET @foo_bar_invitation_id = ?;\nSELECT @foo_bar_invitation_id;\n</code></pre>\n\n<p>I.e. I want to set ? to \"foobar\". My code:</p>\n\n<pre><code>package main\n\nimport (\n        \"io/ioutil\"\n        \"log\"\n\n        \"database/sql\"\n\n        _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype handler struct{ db *sql.DB }\n\nfunc (h handler) runsql() (err error) {\n        sqlscript, err := ioutil.ReadFile(\"script.sql\")\n        if err != nil {\n                return\n        }\n        _, err = h.db.Exec(string(sqlscript), \"foobar\")\n        if err != nil {\n                log.Println(err)\n        }\n        return\n}\n</code></pre>\n\n<p>Always results in <code>Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'SELECT @foo_bar_invitation_id' at line 2</code></p>\n\n<p>I test via code generated by <code>gotests</code>:</p>\n\n<pre><code>import (\n        \"database/sql\"\n        \"os\"\n        \"testing\"\n\n        _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar db *sql.DB\n\nfunc TestMain(m *testing.M) {\n        db, _ = sql.Open(\"mysql\", os.Getenv(\"DSN\"))\n        defer db.Close()\n        os.Exit(m.Run())\n}\n\nfunc Test_handler_runsql(t *testing.T) {\n        type fields struct {\n                db *sql.DB\n        }\n        tests := []struct {\n                name    string\n                fields  fields\n                wantErr bool\n        }{{\n                \"Check ID can be set\",\n                fields{db: db},\n                false,\n        }}\n        for _, tt := range tests {\n                t.Run(tt.name, func(t *testing.T) {\n                        h := handler{\n                                db: tt.fields.db,\n                        }\n                        if err := h.runsql(); (err != nil) != tt.wantErr {\n                                t.Errorf(\"handler.step2runsql() error = %v, wantErr %v\", err, tt.wantErr)\n                        }\n                })\n        }\n}\n</code></pre>\n\n<p>My <strong>DSN</strong> connection string includes <code>?multiStatements=true&amp;sql_mode=TRADITIONAL</code>.</p>\n\n<p>I'm hoping I just do not understand how <a href=\"https://godoc.org/database/sql#DB.Exec\" rel=\"nofollow noreferrer\">DB.Exec args interpolation / placeholder</a> works, but I am finding it difficult to find <a href=\"https://godoc.org/database/sql#pkg-examples\" rel=\"nofollow noreferrer\">examples</a>.</p>\n"}, {"tags": ["macos", "go", "homebrew", "zsh", "delve"], "answers": [{"tags": [], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "is_accepted": true, "score": 0, "last_activity_date": 1525660167, "creation_date": 1525660167, "answer_id": 50206351, "question_id": 50206350, "link": "https://stackoverflow.com/questions/50206350/security-seckeychainsearchcopynext-error-unable-to-install-delve-on-macos/50206351#50206351", "title": "security: SecKeychainSearchCopyNext Error - Unable to Install Delve on MacOS", "body": "<p>I resolved this issue by following these steps:</p>\n\n<pre><code>cd $HOME/Library/Caches/Homebrew\ntar xf delve-*.gz\nGo into the new directory (mine is delve-1.0.0)\nsh scripts/gencert.sh and enter your password\nbrew install go-delve/delve/delve\n</code></pre>\n"}], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "accepted_answer_id": 50206351, "answer_count": 1, "score": 0, "last_activity_date": 1525660167, "creation_date": 1525660167, "question_id": 50206350, "link": "https://stackoverflow.com/questions/50206350/security-seckeychainsearchcopynext-error-unable-to-install-delve-on-macos", "title": "security: SecKeychainSearchCopyNext Error - Unable to Install Delve on MacOS", "body": "<p>I installed Delve using:</p>\n\n<pre><code>brew install delve\n</code></pre>\n\n<p>The log shows some issues:</p>\n\n<pre><code>brew install go-delve/delve/delve\nUpdating Homebrew...\n==&gt; Installing delve from go-delve/delve\n==&gt; Downloading https://github.com/derekparker/delve/archive/v1.0.0.tar.gz\nAlready downloaded: /Users/user/Library/Caches/Homebrew/delve-1.0.0.tar.gz\nsecurity: SecKeychainSearchCopyNext: The specified item could not be found in the keychain.\n==&gt; Generating dlv-cert\n==&gt; openssl req -new -newkey rsa:2048 -x509 -days 3650 -nodes -config dlv-cert.cfg -extensions codesign_reqext -batch -out dlv-cert.cer -keyout dlv-cert.key\n==&gt; [SUDO] Installing dlv-cert as root\n==&gt; sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain dlv-cert.cer\n</code></pre>\n\n<p>It didn't install since when running the command <code>dlv</code>  I get the error:</p>\n\n<blockquote>\n  <p>zsh: command not found: dlv</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 3, "last_activity_date": 1525658952, "last_edit_date": 1525658952, "creation_date": 1525657988, "answer_id": 50206149, "question_id": 50205448, "link": "https://stackoverflow.com/questions/50205448/whats-the-difference-between-os-o-append-and-os-modeappend/50206149#50206149", "title": "What&#39;s the difference between `os.O_APPEND` and `os.ModeAppend`?", "body": "<p>The <code>flag</code> specify the flags used on the system call to open the file while <code>perm</code> sets the File mode on the file. The file mode includes the permissions and type of file eg. symlink, directory, etc...</p>\n\n<p><code>os.O_APPEND</code> tells the underlying OS that all the write calls you do on that file handler should always append to the file so you don't need to set the offset to write on the correct part of the file.</p>\n\n<p><code>ModeAppend</code> sets the file mode to be append. This means that the this file can only be modified by appending to it, not by rewriting the file contents. The specifics of this depends on the OS and file system you are using. I believe Plan 9, implements it by ignoring the offset on any write call to the file and always appending to it, while in linux it means that the file can only be open for writing in append mode. I think that on most linux distros you need to be root to set the file mode to append.</p>\n\n<p>In 99.99% of cases you just want to use <code>perm</code> to set the file permissions <code>rwx</code>. In your case if you want to open a file and append to it you should use: </p>\n\n<pre><code>// os.O_WRONLY tells the computer you are only going to writo to the file, not read\n// os.O_CREATE tells the computer to create the file if it doesn't exist\n// os.O_APPEND tells the computer to append to the end of the file instead of overwritting or truncating it\nf, err := os.OpenFile(\"access.log\", os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0644)\n</code></pre>\n\n<p>You might have only ignore the return error on <code>os.OpenFile</code> to put the example online, but you should get used to always checking for errors. You have no idea how many users ran into trouble when starting with go because they ignore the errors. Sometimes is something stupid and easy to fix like a typo, but if you ignore the error you don't know what the issue is.</p>\n\n<p>You can read more about the append file mode <a href=\"https://unix.stackexchange.com/questions/3634/what-does-the-a-in-chattr-ia-do\">here</a>.</p>\n"}], "owner": {"reputation": 132, "user_id": 8182174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iQlnR3_9N6M/AAAAAAAAAAI/AAAAAAAAQiQ/ZM0EfkRuhUo/photo.jpg?sz=128", "display_name": "Yuki Ito", "link": "https://stackoverflow.com/users/8182174/yuki-ito"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1642, "favorite_count": 0, "accepted_answer_id": 50206149, "answer_count": 1, "score": 1, "last_activity_date": 1525658952, "creation_date": 1525649551, "question_id": 50205448, "link": "https://stackoverflow.com/questions/50205448/whats-the-difference-between-os-o-append-and-os-modeappend", "title": "What&#39;s the difference between `os.O_APPEND` and `os.ModeAppend`?", "body": "<p>We can specify both of <code>flag</code> and <code>perm</code> at <a href=\"https://godoc.org/os#OpenFile\" rel=\"nofollow noreferrer\"><code>os.OpenFile</code></a>.</p>\n\n<p>They have really similar options, <a href=\"https://godoc.org/os#O_APPEND\" rel=\"nofollow noreferrer\"><code>O_APPEND</code></a> and <a href=\"https://godoc.org/os#ModeAppend\" rel=\"nofollow noreferrer\"><code>ModeAppend</code></a>. What's the difference between them?</p>\n\n<pre><code>f, _ := os.OpenFile(\"access.log\", os.O_APPEND|os.O_CREATE, os.ModeAppend|0644)\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "owner": {"reputation": 5438, "user_id": 1944335, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/8675e8c601fc98c0ad3a8272b417d0de?s=128&d=identicon&r=PG&f=1", "display_name": "James Taylor", "link": "https://stackoverflow.com/users/1944335/james-taylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 721, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1525648686, "creation_date": 1525648686, "question_id": 50205368, "link": "https://stackoverflow.com/questions/50205368/gorm-find-by-foreign-key-association", "title": "GORM Find By Foreign Key Association", "body": "<p>I have the following <code>struct</code>:</p>\n\n<pre><code>type Relation struct {\n    Metric *Metric `gorm:\"foreignkey:MetricID\"`\n    MetricID uint\n    ...\n}\n</code></pre>\n\n<p><code>Metric</code> is defined as:</p>\n\n<pre><code>type DatabaseMeta struct {\n    Id uint `json:\"-\" gorm:\"primary_key\"`\n}\n\ntype Metric struct {\n    DatabaseMeta\n    Name string `json:\"name\"`\n    Medium string `json:\"medium\"`\n}\n</code></pre>\n\n<p>I'd like to find a <code>Relation</code> from a value set in <code>Metric</code> using GORM, which has a FK association.</p>\n\n<p>I tried:</p>\n\n<pre><code>var relation common.Relation\ndatabase.Preload(\"Relation.Metric\").Where(&amp;Relation{\n    Metric: &amp;Metric{\n        Name: \"temperature\",\n        Medium: \"water\",\n    },\n}).First(&amp;relation)\n</code></pre>\n\n<p>Despite <code>Preload</code> and trying combinations of <code>Association</code> and <code>Preload</code> arguments, the following SQL is actually generated by GORM:</p>\n\n<pre><code>[2018-05-06 18:47:37]  sql: converting argument $1 type: unsupported type common.Metric, a struct\n[2018-05-06 18:47:37]  [0.14ms]  SELECT * FROM \"relations\"  WHERE (\"relations\".\"metric\" = '{{0} temperature water}') LIMIT 1\n[0 rows affected or returned ]\n</code></pre>\n\n<p>This works and is conceptually what I'm looking for:</p>\n\n<pre><code>// Look up the metric from `Name` and `Medium` fields\nvar metric Metric\ndatabase.Where(&amp;Metric{\n    Name: \"temperature\",\n    Medium: \"water\",\n}).First(&amp;metric)\n\n// Use the `metric` FK directly to search for the `relation`\nvar relation Relation\ndatabase.Where(&amp;Relation{\n    MetricID: metric.DatabaseMeta.Id,\n}).First(&amp;relation)\n</code></pre>\n\n<p>How can I use GORM to find a <code>struct</code> by a field set in its foreign key relation? Is this possible?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1525659227, "post_id": 50205506, "comment_id": 87429630, "body": "but if I set my http.Dir to /assets, will this work since my html file has /statics/assets/js/bundle.js ?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1525659855, "post_id": 50205506, "comment_id": 87429759, "body": "@Blankman I&#39;m a little confused now. Could you let me know the path to the assets directory in your computer?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 1, "creation_date": 1525660535, "post_id": 50205506, "comment_id": 87429895, "body": "@Blankman You should use the complete path in your computer for <code>http.Dir</code> eg. &quot;/my_directory/assets&quot;, and for the html files you should treat <code>&#47;static</code> as a synonim for &quot;/my_directory/assets&quot;"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1525663394, "post_id": 50205506, "comment_id": 87430397, "body": "It works.  My js file is very large, looks like there is a max file size as the js file is getting cut off."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 2, "last_activity_date": 1525650442, "creation_date": 1525650442, "answer_id": 50205506, "question_id": 50205200, "link": "https://stackoverflow.com/questions/50205200/my-static-files-are-not-rending-correctly/50205506#50205506", "title": "My static files are not rending correctly", "body": "<p>The problem is with your call to <code>http.Dir(\"/assets\")</code> in this line:</p>\n\n<pre><code>app.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/assets\"))))\n</code></pre>\n\n<p><code>http.Dir</code> takes the path to the folder either in absolute form or relative to where the go executable is. Using <code>\"/assets\"</code> tells it that the absolute path to the assets folder is on the root of the file system, where in reality I'm guessing the assets folder is in something like <code>/home/YOUR_USER_FOLDER/code/this_project/assets</code>.</p>\n\n<p>Just change the code to use the absolute path:</p>\n\n<pre><code>app.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/home/YOUR_USER_FOLDER/code/this_project/assets\"))))\n</code></pre>\n\n<p>If the <code>assets</code> folder is in the same location as the go executable, you can just use <code>\"assets\"</code> as the file path, but I will recommend using the absolute path to avoid any confusion.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 50205506, "answer_count": 1, "score": -1, "last_activity_date": 1525650442, "creation_date": 1525646774, "question_id": 50205200, "link": "https://stackoverflow.com/questions/50205200/my-static-files-are-not-rending-correctly", "title": "My static files are not rending correctly", "body": "<p>In my html page I am referencing static assets like:</p>\n\n<pre><code> &lt;script src=\"/static/assets/js/bundle.js\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>and </p>\n\n<pre><code>   &lt;link rel=\"stylesheet\" href=\"/static/assets/css/style.css\"&gt;\n</code></pre>\n\n<p>These files are stored in:</p>\n\n<pre><code>/assets/js/bundle.js\n/assets/css/style.css\n</code></pre>\n\n<p>Currently my route looks like this:</p>\n\n<pre><code>app.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/assets\"))))\n</code></pre>\n\n<p>Currently it is not working and returning a 404 not found error when I look at chrome console.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["go", "websocket"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1527054476, "post_id": 50205071, "comment_id": 87974436, "body": "I have a couple follow-up questions. Is WriteBufferSize measured in bytes or number of messages? How does memory allocation work for these buffers? For example if I open 1000 connections with a WriteBufferSize of 1024, will there be a large amount of memory taken up even if the buffers aren&#39;t used?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 1, "creation_date": 1527059027, "post_id": 50205071, "comment_id": 87976666, "body": "Size is in bytes. I think there&#39;s one buffer per connection."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 11, "last_activity_date": 1525656499, "last_edit_date": 1525656499, "creation_date": 1525645456, "answer_id": 50205071, "question_id": 50204967, "link": "https://stackoverflow.com/questions/50204967/what-is-websocket-upgrader-exactly/50205071#50205071", "title": "What is websocket.Upgrader exactly?", "body": "<p>The <a href=\"https://godoc.org/github.com/gorilla/websocket#Upgrader.Upgrade\" rel=\"noreferrer\">Upgrader.Upgrade</a> method upgrades the HTTP server connection to the WebSocket protocol as described in the <a href=\"https://tools.ietf.org/html/rfc6455#section-1.3\" rel=\"noreferrer\">WebSocket RFC</a>. A summary of the process is this:  The client sends an HTTP request requesting that the server upgrade the connection used for the HTTP request to the WebSocket protocol.  The server inspects the request and if all is good the server sends an HTTP response agreeing to upgrade the connection.  From that point on, the client and server use the WebSocket protocol over the network connection. </p>\n\n<p>Applications use <a href=\"https://godoc.org/github.com/gorilla/websocket#Upgrader\" rel=\"noreferrer\">Upgrader</a> fields to specify options for the upgrade operation.</p>\n\n<p>The WebSocket connection buffers reads and writes to the underlying network connection.  The ReadBufferSize and WriteBufferSize specifies the size of these buffers.  It's usually best to use the default size by setting ReadBufferSize and WriteBufferSize to zero. Larger buffer sizes take more memory.  Smaller buffer sizes can result in more calls to the underlying network connection.  The buffer sizes do not limit the size of a message that can be read. </p>\n"}], "owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2494, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1525656499, "creation_date": 1525644357, "question_id": 50204967, "link": "https://stackoverflow.com/questions/50204967/what-is-websocket-upgrader-exactly", "title": "What is websocket.Upgrader exactly?", "body": "<p>I am trying to learn about websockets, and I am not sure I understand what exactly Upgrader does in gorilla/websockets.</p>\n\n<p><a href=\"http://www.gorillatoolkit.org/pkg/websocket#Upgrader\" rel=\"noreferrer\">http://www.gorillatoolkit.org/pkg/websocket#Upgrader</a></p>\n\n<p>Can someone please explain in simple terms what exactly the buffer sizes mean?</p>\n"}, {"tags": ["go", "graphql", "apollo"], "comments": [{"owner": {"reputation": 854, "user_id": 363470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f873fe9068de71459ec6b3c9b947dec?s=128&d=identicon&r=PG", "display_name": "Matt Lavin", "link": "https://stackoverflow.com/users/363470/matt-lavin"}, "edited": false, "score": 0, "creation_date": 1540298226, "post_id": 50204685, "comment_id": 92806362, "body": "Did you ever figure this out? I ran into a similar error and mine turned out to be caused by a different error hidden in the query. Using your query as a start, my mistake was that the <code>id</code> argument was actually named something else. Once I fixed my query so that other mistakes were gone, the error about Int was also gone"}, {"owner": {"reputation": 83, "user_id": 1499081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38262c8446f7adf4bd2f0bebe3d13d56?s=128&d=identicon&r=PG", "display_name": "slowcode", "link": "https://stackoverflow.com/users/1499081/slowcode"}, "reply_to_user": {"reputation": 854, "user_id": 363470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f873fe9068de71459ec6b3c9b947dec?s=128&d=identicon&r=PG", "display_name": "Matt Lavin", "link": "https://stackoverflow.com/users/363470/matt-lavin"}, "edited": false, "score": 0, "creation_date": 1543543629, "post_id": 50204685, "comment_id": 93966814, "body": "I never did figure it out, but I&#39;ll try this, thank you for the ping."}, {"owner": {"reputation": 854, "user_id": 363470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f873fe9068de71459ec6b3c9b947dec?s=128&d=identicon&r=PG", "display_name": "Matt Lavin", "link": "https://stackoverflow.com/users/363470/matt-lavin"}, "edited": false, "score": 1, "creation_date": 1543673876, "post_id": 50204685, "comment_id": 94007746, "body": "I&#39;ve hit this a couple of times since commenting. In every case, my query was wrong in some other way. I think it&#39;s just bad error reporting in the graphql tools"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 14470335, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhSmuaaTmuqZFlaKbayqduw9WNNIt9mdsSQdBC0=k-s128", "display_name": "Adeolu Asenuga", "link": "https://stackoverflow.com/users/14470335/adeolu-asenuga"}, "is_accepted": false, "score": 0, "last_activity_date": 1602983938, "creation_date": 1602983938, "answer_id": 64408830, "question_id": 50204685, "link": "https://stackoverflow.com/questions/50204685/graphql-query-erroring-with-unknown-type-int-with-apollo-client-and-graphql-go/64408830#64408830", "title": "Graphql query erroring with &#39;Unknown type Int&#39; with Apollo Client and graphql-go", "body": "<p>I fixed this by changing the variable type of ID from <code>Int</code> to <code>Float</code></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 13160162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ed1fb0c07e35f87aabe0d85d97752db?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony S", "link": "https://stackoverflow.com/users/13160162/anthony-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1609910453, "last_edit_date": 1609910453, "creation_date": 1609909655, "answer_id": 65590507, "question_id": 50204685, "link": "https://stackoverflow.com/questions/50204685/graphql-query-erroring-with-unknown-type-int-with-apollo-client-and-graphql-go/65590507#65590507", "title": "Graphql query erroring with &#39;Unknown type Int&#39; with Apollo Client and graphql-go", "body": "<p>As the other post that mentioned having to go from int to float, this error occurs because the types set up in your graphQL schema are conflicting with the types you are trying to use when querying.</p>\n<p>It's saying: 'Unknown type Int'</p>\n<p>But what it really means is: 'Expected type Float but got Int' then you'd go change it where it is wrong.</p>\n"}], "owner": {"reputation": 83, "user_id": 1499081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38262c8446f7adf4bd2f0bebe3d13d56?s=128&d=identicon&r=PG", "display_name": "slowcode", "link": "https://stackoverflow.com/users/1499081/slowcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4044, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1609910453, "creation_date": 1525642131, "question_id": 50204685, "link": "https://stackoverflow.com/questions/50204685/graphql-query-erroring-with-unknown-type-int-with-apollo-client-and-graphql-go", "title": "Graphql query erroring with &#39;Unknown type Int&#39; with Apollo Client and graphql-go", "body": "<p>I've got a graphql server implemented with <a href=\"https://github.com/graphql-go\" rel=\"nofollow noreferrer\">graphql-go</a>, and I'm using Apollo on the front end. Simple queries without arguments, and mutations using input object types work fine, but for some reason passing a scalar type argument in a query returns the error:</p>\n\n<pre><code>[{\"message\":\"Unknown type \\\"Int\\\".\",\"locations\":[{\"line\":1,\"column\":19}]}]\n</code></pre>\n\n<p>My use could not be simpler; on the client side, my query is:</p>\n\n<pre><code>export const GET_CLIENT = gql`\n  query client($id: Int) {\n  client(id: $id) {\n    id\n    name\n  }\n}`\n</code></pre>\n\n<p>which is used in a component like so:</p>\n\n<pre><code>&lt;Query\n  query={GET_CLIENT}\n  variables={{\n    id: 1\n  }} /&gt;\n</code></pre>\n\n<p>which resolves to this field on the backend:</p>\n\n<pre><code>// ClientQuery takes an ID and returns one client or nil\nvar ClientQuery = &amp;graphql.Field{\nType: ClientType,\nArgs: graphql.FieldConfigArgument{\n    \"id\": &amp;graphql.ArgumentConfig{\n        Type: graphql.Int,\n    },\n},\nResolve: func(p graphql.ResolveParams) (interface{}, error) {\n    return p.Context.Value(\"service\").(*model.Service).FindClientByID(id)\n},\n}\n</code></pre>\n\n<p>I've tried passing input objects, strings, etc. but it seems that no query arguments, scalar or otherwise are ever satisfied on the backend. I've tried both master and v0.7.5 of graphql-go. Am I missing something? Help very much appreciated, it feels weird for something this basic to be such a huge blocker.</p>\n"}, {"tags": ["go", "gonum"], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": true, "score": 4, "last_activity_date": 1525638026, "creation_date": 1525638026, "answer_id": 50204178, "question_id": 50204118, "link": "https://stackoverflow.com/questions/50204118/declaring-types-in-go-for-a-sample-gonum-application/50204178#50204178", "title": "Declaring types in Go for a sample gonum application", "body": "<p><code>stat.Variance</code> expects two parameters of type <code>[]float64</code> of the same length:</p>\n\n<pre><code>func Variance(x, weights []float64) float64\n</code></pre>\n\n<p>You are missing the <code>weights</code> parameter. \nYou can pass <code>nil</code> as the second parameter of <code>stat.Variance</code> function if you wants to set all the weights of the random variables to 1.</p>\n\n<p><a href=\"https://godoc.org/github.com/gonum/stat#Variance\" rel=\"nofollow noreferrer\">stat Package Documentation</a></p>\n"}], "owner": {"reputation": 1655, "user_id": 1136670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d039c79ebf6f79c06418ac31453992f6?s=128&d=identicon&r=PG", "display_name": "CaitlinG", "link": "https://stackoverflow.com/users/1136670/caitling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 50204178, "answer_count": 1, "score": 0, "last_activity_date": 1525638026, "creation_date": 1525637680, "question_id": 50204118, "link": "https://stackoverflow.com/questions/50204118/declaring-types-in-go-for-a-sample-gonum-application", "title": "Declaring types in Go for a sample gonum application", "body": "<p>Being an ardent fan of numpy, I was pleased to discover that a library for golang was in progress. I wrote a small test program, based heavily on the documentation, that looks like the following:</p>\n\n<pre><code>package main\n\nimport (\n\n    \"fmt\"\n    \"math\"\n    \"gonum.org/v1/gonum/stat\"\n)\n\nfunc main() {\n\n    xs := []float64 {\n\n        23.32, 44.32, 100.12, 191.90,\n        23.22, 90.21, 12.22, 191.21,\n        1.21, 12.21, 34.23, 91.02,\n    }\n\n    variance := stat.Variance(xs)\n    fmt.Printf(\"Data: %v\\n\", xs)\n\n    stddev := math.Sqrt(variance)\n\n    fmt.Printf(\"Standard deviation: %d\\n\\n\", stddev)\n}\n</code></pre>\n\n<p>When I attempted to build the program, I noticed the following compiler error:</p>\n\n<pre><code>C:\\&gt;go build hello.go\n# command-line-arguments\n.hello.go:19:30: not enough arguments in call to stat.Variance\n        have ([]float64)\n        want ([]float64, []float64)\n</code></pre>\n\n<p>Any advice would be most appreciated.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525632768, "post_id": 50203310, "comment_id": 87423634, "body": "Your code is not valid Go. Please paste your actual, working code. Follow <a href=\"https://stackoverflow.com/help/mcve\">this guide</a> for producing a minimal, complete, verifiable example, so we can help y ou."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "edited": false, "score": 0, "creation_date": 1525632866, "post_id": 50203310, "comment_id": 87423669, "body": "And the JSON is not valid JSON, too."}, {"owner": {"reputation": 567, "user_id": 9652562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7179b8082590d9450b7783721493cb?s=128&d=identicon&r=PG&f=1", "display_name": "jsor", "link": "https://stackoverflow.com/users/9652562/jsor"}, "edited": false, "score": 0, "creation_date": 1525635490, "post_id": 50203310, "comment_id": 87424485, "body": "i edited the question, i am sorry for the bad code , i am new to go"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1525642491, "post_id": 50203310, "comment_id": 87426489, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21268000/unmarshaling-nested-json-objects-in-golang\">Unmarshaling nested JSON objects in Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 2, "last_activity_date": 1525644276, "last_edit_date": 1525644276, "creation_date": 1525642302, "answer_id": 50204703, "question_id": 50203310, "link": "https://stackoverflow.com/questions/50203310/parsing-nested-json-with-go/50204703#50204703", "title": "parsing nested JSON with go", "body": "<p>You need to use another type to store the nested data rather than a slice of strings like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nvar contents string = `{\n    \"id\"   : 12345656,\n    \"date\" : \"2018-05-02-18-16-17\",\n    \"lists\" : [\n     {\n          \"empoyee_id\": \"12343\",\n          \"name\": \"User1\"\n\n      },\n      {\n          \"contractor_id\" : \"12343\",\n          \"name\":  \"User1\"\n       }, \n       {\n          \"contractor_id\" : \"12343\",\n          \"name\":  \"User1\"\n       }\n    ]\n}`\n\ntype Result struct {\n    ID    int64         `json:\"id\"`\n    Date  string       `json:\"date\"`\n    Lists []Contractor `json:\"lists\"`\n}\n\ntype Contractor struct {\n    ContractorID string `json:\"contractor_id\"`\n    EmployeeID   string `json:\"employee_id\"`\n    Name         string `json:\"name\"`\n}\n\nfunc main() {\n    var result Result\n    err := json.Unmarshal([]byte(contents), &amp;result)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>Executable:</p>\n\n<p><a href=\"https://play.golang.org/p/7dYArgz1V8y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7dYArgz1V8y</a></p>\n\n<p>If you just want a single ID field on the nested object then you will need to do a custom unmarshal function on the result to work out which ID is present.</p>\n"}], "owner": {"reputation": 567, "user_id": 9652562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7179b8082590d9450b7783721493cb?s=128&d=identicon&r=PG&f=1", "display_name": "jsor", "link": "https://stackoverflow.com/users/9652562/jsor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3412, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1525645535, "creation_date": 1525632259, "last_edit_date": 1525645535, "question_id": 50203310, "link": "https://stackoverflow.com/questions/50203310/parsing-nested-json-with-go", "title": "parsing nested JSON with go", "body": "<p>I am trying to parse a nested json on GO ,</p>\n\n<p>the json looks like this:</p>\n\n<pre><code>{\n    \"id\"   : 12345656,\n    \"date\" : \"2018-05-02-18-16-17\",\n    \"lists\" : [\n     {\n          \"empoyee_id\": \"12343\",\n          \"name\": \"User1\"\n\n      },\n      {\n          \"contractor_id\" : \"12343\",\n          \"name\":  \"User1\"\n       }, \n       {\n          \"contractor_id\" : \"12343\",\n          \"name\":  \"User1\"\n       }\n    ]\n}\n</code></pre>\n\n<p>My struct </p>\n\n<pre><code>type Result struct {\n  id    int64    `json:\"id\"`\n  Date  string   `json:\"date\"`\n  Lists []string `json:\"lists\"`\n}\n</code></pre>\n\n<p>I am trying to access it using the following:</p>\n\n<pre><code>var result Result\njson.Unmarshal(contents, &amp;result)\n</code></pre>\n\n<p>How can I change the above to access to the employee_id or the contractor_id fields ?</p>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 31386, "user_id": 9661424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rnnvz.png?s=128&g=1", "display_name": "sticky bit", "link": "https://stackoverflow.com/users/9661424/sticky-bit"}, "edited": false, "score": 0, "creation_date": 1525629323, "post_id": 50202694, "comment_id": 87422385, "body": "In <code>WHERE LK = &quot;+reglicenceEntry.Text()+&quot;)</code>, there are no single quotes around the value. But i assume <code>LK</code> is some <code>char</code>variant, as you use single quotes in the insert. But you should use parametrized queries anyway, to prevent SQL injection and other benefits."}, {"owner": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "reply_to_user": {"reputation": 31386, "user_id": 9661424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rnnvz.png?s=128&g=1", "display_name": "sticky bit", "link": "https://stackoverflow.com/users/9661424/sticky-bit"}, "edited": false, "score": 0, "creation_date": 1525629530, "post_id": 50202694, "comment_id": 87422471, "body": "@stickybit LK is the licence key vaue in my database. I have it set as a text value. Thanks for the suggestion!"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "edited": false, "score": 0, "creation_date": 1525630639, "post_id": 50203014, "comment_id": 87422870, "body": "Ok, Thanks for the suggestion, do I replace my current code with this? What are the question marks for? I get the following error: Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;?, ?, &#39;&#39;FROM <code>login</code>WHERE <code>LK</code> = ? LIMIT 1&#39; at line 1"}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "edited": false, "score": 0, "creation_date": 1525631726, "post_id": 50203014, "comment_id": 87423275, "body": "You need to use prepared statements to use parameters. I gave a link at the end of my answer. Please go read it."}, {"owner": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "edited": false, "score": 0, "creation_date": 1525632003, "post_id": 50203014, "comment_id": 87423385, "body": "I don&#39;t understand. I have to specify my username, password, and lk parameters. Do I replace the question marks with those parameters. You didn&#39;t ever mention my regusernameEntry.text() etc. I read the article but don&#39;t understand. Thanks"}, {"owner": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "edited": false, "score": 0, "creation_date": 1525637163, "post_id": 50203014, "comment_id": 87425002, "body": "Wow, great explanation and fixed my issue. Thanks so much!"}], "tags": [], "owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "is_accepted": true, "score": 1, "last_activity_date": 1525635064, "last_edit_date": 1525635064, "creation_date": 1525630272, "answer_id": 50203014, "question_id": 50202694, "link": "https://stackoverflow.com/questions/50202694/mysql-code-to-insert-a-username-and-password-into-a-table-if-a-licencing-key-exi/50203014#50203014", "title": "MySQL code to insert a username and password into a table if a licencing key exists in that table", "body": "<p>MySQL syntax doesn't support <code>IF...THEN</code> constructs except within stored routines and triggers and events. See <a href=\"https://dev.mysql.com/doc/refman/8.0/en/sql-syntax-compound-statements.html\" rel=\"nofollow noreferrer\">https://dev.mysql.com/doc/refman/8.0/en/sql-syntax-compound-statements.html</a></p>\n\n<p>I suggest an alternative solution for your code: </p>\n\n<pre><code>INSERT INTO `login` (`Username`, `Password`, `LK`)\nSELECT ?, ?, ''\nFROM `login`\nWHERE `LK` = ?\nLIMIT 1\n</code></pre>\n\n<p>If your login table does not have the LK value, the SELECT above will return 0 rows, therefore it will not insert anything.</p>\n\n<p>If your login table has the LK value, the SELECT above will return at least 1 row (and I limit it to 1), therefore it will insert a row. The row it inserts is comprised of your username and password, and a blank string for the LK.</p>\n\n<p>I showed use of parameter placeholders. You should use parameters in SQL instead of concatenating variables into your query. This is good practice to avoid accidental SQL injection. See <a href=\"http://go-database-sql.org/prepared.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/prepared.html</a> for examples.</p>\n\n<hr>\n\n<p>The purpose of using parameters is to avoid SQL injection problems. See my answer to <a href=\"https://stackoverflow.com/questions/601300/what-is-sql-injection/601524#601524\">What is SQL injection?</a> for an explanation of SQL injection. </p>\n\n<p>Or my presentation <a href=\"https://www.slideshare.net/billkarwin/sql-injection-myths-and-fallacies\" rel=\"nofollow noreferrer\">SQL Injection Myths and Fallacies</a> (or <a href=\"https://www.youtube.com/watch?v=VldxqTejybk\" rel=\"nofollow noreferrer\">youtube video</a>).</p>\n\n<p>When using parameters, you do two steps. </p>\n\n<ul>\n<li>The first step to prepare a query with placeholders (<code>?</code>) where you would otherwise concatenate variables into your SQL query. </li>\n<li>The second step is to execute the prepared query, and this is the time you pass the variables to fill in the placeholders.</li>\n</ul>\n\n<p>The point is to keep variables separate from your query, so if there's anything in the variable that could unintentionally change your SQL syntax (like imbalanced quotes), it is never combined with the SQL. After you do the prepare, the SQL has already been parsed by the MySQL server, and there's no way to change the syntax after that. </p>\n\n<p>MySQL remembers which parts of the query need to be filled in, and when you pass variables during the execute step, MySQL fills in the missing parts of the query using your values \u2014 but this happens within the MySQL server, not in your application. </p>\n\n<p>Thus the dynamic parts of the query \u2014 your variables \u2014\u00a0are kept separate from the SQL syntax and you avoid SQL injection problems.</p>\n\n<p>For your task described in your question, it would look something like this (I have not tested this Go code, but it should put you on the right path).</p>\n\n<pre><code>stmt, err := tx.Prepare(\"INSERT INTO `login` (`Username`, `Password`, `LK`) SELECT ?, ?, '' FROM `login` WHERE `LK` = ? LIMIT 1\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer stmt.Close()\n\n_, err = stmt.Exec(regusernameEntry.Text(), regpasswordEntry.Text(), reglicenceEntry.Text())\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>The order of parameters is important. The variables you pass to <code>Exec()</code> must be in the same order that the <code>?</code> placeholders appear in your prepared SQL statement. They are matched up, one for one, in the same order, by the MySQL server.</p>\n\n<p>Do not put quotes around the placeholders in your prepared SQL statement. That will work as a literal string <code>'?'</code> in SQL. Use an unquoted <code>?</code> character for a placeholder. When it gets combined by MySQL in the server, it will work as if you had put quotes around the value like a string \u2014 but with no risk of SQL injection even if that string value containing special characters.</p>\n\n<p>Here's another site that gives more code examples: <a href=\"https://github.com/go-sql-driver/mysql/wiki/Examples\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql/wiki/Examples</a></p>\n\n<p>The <code>Exec()</code> function is for executing SQL that has no result set, like INSERT, UPDATE, DELETE. There are other functions in the Go SQL driver like <code>Query()</code> and <code>QueryRow()</code> that also accept parameter arguments.  You'd use these if your SQL returns a result set.</p>\n"}], "owner": {"reputation": 13, "user_id": 9532075, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "David Vega", "link": "https://stackoverflow.com/users/9532075/david-vega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 50203014, "answer_count": 1, "score": 1, "last_activity_date": 1525635064, "creation_date": 1525628259, "last_edit_date": 1525630297, "question_id": 50202694, "link": "https://stackoverflow.com/questions/50202694/mysql-code-to-insert-a-username-and-password-into-a-table-if-a-licencing-key-exi", "title": "MySQL code to insert a username and password into a table if a licencing key exists in that table", "body": "<p>I am trying to accomplish a simple licensing system in golang and have tried numerous ways to get it to work. Basically, I have input a couple of random licensing keys into my database and my golang program should check to see if the user-input key exists and if it does then add the user specified username and password into the database to login later.</p>\n\n<p>This is the code that I have that hasn't been working: </p>\n\n<pre><code>\"IF EXISTS (SELECT * FROM login WHERE LK = \"+reglicenceEntry.Text()+\") THEN \n INSERT INTO `login` (`Username`, `Password`, `LK`) VALUES \n ('\"+regusernameEntry.Text()+\"', '\"+regpasswordEntry.Text()+\"', ''); \"\n</code></pre>\n\n<p>This is the golang error:</p>\n\n<blockquote>\n  <p>Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'IF EXISTS (SELECT * FROM login WHERE LK = '5qp515YHXEmSDzwqgoJh') THEN INSERT IN' at line 1</p>\n</blockquote>\n\n<p>Thanks so much!</p>\n"}, {"tags": ["go", "ipv6"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525620722, "post_id": 50201401, "comment_id": 87419418, "body": "Deal with what situation? What problem are you facing?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9748987, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Stefan Beyer", "link": "https://stackoverflow.com/users/9748987/stefan-beyer"}, "edited": false, "score": 1, "creation_date": 1525621356, "post_id": 50201505, "comment_id": 87419636, "body": "Oooops, i might be missing some basic understanding:  is   ::ffff:0100:000   really the same as   ::ffff:1.0.0.0 ? I am aware of the notation using &#39;.&#39;, but I am not sure if it is a IPv4-mapped IPv6 address when there are &#39;:&#39;?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 13, "user_id": 9748987, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Stefan Beyer", "link": "https://stackoverflow.com/users/9748987/stefan-beyer"}, "edited": false, "score": 0, "creation_date": 1525621703, "post_id": 50201505, "comment_id": 87419775, "body": "@StefanBeyer: yes, <code>::ffff:0100:0000</code> is the same as <code>::ffff:1.0.0.0</code>. All <code>::ffff:0:0</code> are IPv4-mapped IPv6 and in this case the last 4 bytes (i.e. the IPv4 address) are commonly written as IPv4 syntax to make this mapping more obvious. To also cite from the Wikipedia article I&#39;ve linked to: <i>&quot;These addresses are typically written with a 96-bit prefix in the standard IPv6 format, and the remaining 32 bits written in the customary dot-decimal notation of IPv4.&quot;</i>"}, {"owner": {"reputation": 13, "user_id": 9748987, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Stefan Beyer", "link": "https://stackoverflow.com/users/9748987/stefan-beyer"}, "edited": false, "score": 0, "creation_date": 1525622325, "post_id": 50201505, "comment_id": 87419961, "body": "Ok, I see.   You are right, the first sentence clearly states &quot;These addresses consist of an 80-bit prefix of zeros, the next 16 bits are ones, and the remaining, least-significant 32 bits contain the IPv4 address&quot; - it does  not mention . or :   Thank you so much for your help!! Highly appreciated!"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 5, "last_activity_date": 1525621595, "last_edit_date": 1525621595, "creation_date": 1525621097, "answer_id": 50201505, "question_id": 50201401, "link": "https://stackoverflow.com/questions/50201401/golang-net-parseip/50201505#50201505", "title": "Golang: net.ParseIP()", "body": "<p>What you consider perfectly valid IPv6 addresses like <code>::ffff:0100:0000</code> are in fact IPv4 addresses mapped into the IPv6 space, commonly written as <code>::ffff:1.0.0.0</code>. Thus essentially it is an IPv4 address. See section about <a href=\"https://en.wikipedia.org/wiki/IPv6#Transition_mechanisms\" rel=\"nofollow noreferrer\">IPv4-mapped IPv6 addresses in Wikipedia:IPv6</a> for more information.</p>\n"}], "owner": {"reputation": 13, "user_id": 9748987, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Stefan Beyer", "link": "https://stackoverflow.com/users/9748987/stefan-beyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1054, "favorite_count": 0, "accepted_answer_id": 50201505, "answer_count": 1, "score": 0, "last_activity_date": 1525621595, "creation_date": 1525620452, "question_id": 50201401, "link": "https://stackoverflow.com/questions/50201401/golang-net-parseip", "title": "Golang: net.ParseIP()", "body": "<p>some perfectly valid IPv6 addresses are considered IPv4 by net.ParseIP(), e.g. 0000:0000:0000:0000:0000:ffff:0100:0000 / ::ffff:0100:0. (please see <a href=\"https://play.golang.org/p/57jAJVSIrHF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/57jAJVSIrHF</a> for a simple example)</p>\n\n<p>What would be the most idiomatic way to deal with this situation? The net package does not export most of the functionality, so rewriting net.Parse would result in a lot of code duplication.</p>\n\n<p>Thank you in advance for your help!</p>\n\n<p>best regards,</p>\n\n<p>Stefan</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1525622397, "last_edit_date": 1525622397, "creation_date": 1525620273, "answer_id": 50201376, "question_id": 50201366, "link": "https://stackoverflow.com/questions/50201366/what-is-the-difference-between-type-and-type-in-go/50201376#50201376", "title": "what is the difference between *[]Type and []*Type in go", "body": "<ul>\n<li><code>[]*Type</code> is a slice of pointers to <code>Type</code>.</li>\n<li><code>*[]Type</code> is a pointer to a slice of <code>Type</code>.</li>\n</ul>\n\n<p>To deference an individual element from a slice of pointers:</p>\n\n<pre><code>var x []*Type\ny := *x[0]\n</code></pre>\n\n<p>To dereference an individual element from a pointer to a slice:</p>\n\n<pre><code>var x *[]Type\ny := (*x)[0]\n</code></pre>\n\n<p>And for bonus points, to deference an individual element from a pointer to a slice of pointers:</p>\n\n<pre><code>var x *[]*Type\ny := *(*x)[0]\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/720n0lHvJmx\" rel=\"nofollow noreferrer\">playground</a>.</p>\n"}], "owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 50201376, "answer_count": 1, "score": 0, "last_activity_date": 1525622397, "creation_date": 1525620198, "question_id": 50201366, "link": "https://stackoverflow.com/questions/50201366/what-is-the-difference-between-type-and-type-in-go", "title": "what is the difference between *[]Type and []*Type in go", "body": "<p>Let's say we have a struct named <code>Person</code> and it's held by a struct named <code>People</code>.</p>\n\n<pre><code>type Person {\n    Name string\n    age  int\n}\n\ntype People {\n    City string\n    List []*Person //check this out\n}\n\ntype People2 {\n    City string\n    List *[]Person //What's the difference?\n}\n</code></pre>\n\n<ol>\n<li><p>What's exactly is the meaning of <code>[]*Person</code> and <code>*[]Person</code>?</p></li>\n<li><p>How can I retrieve the element's value of these slice?</p></li>\n</ol>\n\n<p>I'm more familiar with C so it's appreciated if you can explain this in C</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525618638, "post_id": 50200937, "comment_id": 87418665, "body": "You&#39;re reversing the bytes, not the characters. The <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow noreferrer\">utf8</a> package should help you here. Although there are still many corner cases when reversing Unicode. Generally speaking, this cannot be done safely."}], "answers": [{"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": true, "score": 6, "last_activity_date": 1525619065, "last_edit_date": 1525619065, "creation_date": 1525618729, "answer_id": 50201095, "question_id": 50200937, "link": "https://stackoverflow.com/questions/50200937/safetly-write-bytes-as-utf-8-characters-using-strings-builder/50201095#50201095", "title": "Safetly write bytes as UTF-8 characters using strings.Builder?", "body": "<p>While it is possible - and the default - to access a string's individual bytes by index, a Go string is also convertible to an array of runes, which represent individual Unicode code points.</p>\n\n<p>First of all you need to cast your string into a []rune, and iterate on that:</p>\n\n<pre><code>func String(toReverse string) string {\n    var reversedString strings.Builder\n    runes := []rune(toReverse)\n\n    for i := len(runes) - 1; i &gt;= 0; i-- {\n        reversedString.WriteRune(runes[i])\n    }\n\n    return reversedString.String()\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/WYn_MGAGw_x\" rel=\"noreferrer\">https://play.golang.org/p/WYn_MGAGw_x</a> for a live demo.</p>\n"}], "owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 50201095, "answer_count": 1, "score": 0, "last_activity_date": 1525619065, "creation_date": 1525617832, "last_edit_date": 1525618510, "question_id": 50200937, "link": "https://stackoverflow.com/questions/50200937/safetly-write-bytes-as-utf-8-characters-using-strings-builder", "title": "Safetly write bytes as UTF-8 characters using strings.Builder?", "body": "<p>I'm trying to do an exercise where I have to reverse some strings. I heard that Go strings.Builder is the fastest way to create strings at the moment, so I did the following:</p>\n\n<pre><code>func String(toReverse string) string {\n    var reversedString strings.Builder\n\n    for i := len(toReverse) - 1; i &gt;= 0; i-- {\n        reversedString.WriteByte(toReverse[i])\n    }\n\n    return reversedString.String()\n}\n</code></pre>\n\n<p>The problem is that this doesn't work with multibyte test cases like this: </p>\n\n<blockquote>\n  <p>Hello, \u4e16\u754c</p>\n</blockquote>\n\n<p>becomes </p>\n\n<blockquote>\n  <p>\"\\u008c\\u0095\u00e7\\u0096\u00b8\u00e4 ,olleH\"</p>\n</blockquote>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "testify"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525620658, "post_id": 50200933, "comment_id": 87419386, "body": "Just as you said--one runs before the entire suite of tests, the other before an individual test. I&#39;m not sure what further clarification is possible or desired."}, {"owner": {"reputation": 504, "user_id": 2720202, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/784398396c7981c9e034c38e5c683adb?s=128&d=identicon&r=PG&f=1", "display_name": "Mohit Jain", "link": "https://stackoverflow.com/users/2720202/mohit-jain"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525667954, "post_id": 50200933, "comment_id": 87431285, "body": "Any practical example where anyone is preferred over other?"}], "answers": [{"tags": [], "owner": {"reputation": 848, "user_id": 384162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d8600ea9d02baf8c84503b9410598ac?s=128&d=identicon&r=PG", "display_name": "phiggy", "link": "https://stackoverflow.com/users/384162/phiggy"}, "is_accepted": true, "score": 1, "last_activity_date": 1529962532, "creation_date": 1529962532, "answer_id": 51032098, "question_id": 50200933, "link": "https://stackoverflow.com/questions/50200933/difference-between-setupsuite-setuptest-in-testify-suites/51032098#51032098", "title": "Difference between SetupSuite &amp; SetupTest in Testify Suites", "body": "<p>Generally you want to use <code>SetupTest</code> so that each individual test function runs with a clean environment. <code>SetupSuite</code> is useful in cases where the setup code is time consuming and isn't modified in any of the tests. An example of when this could be useful is if you were testing code that reads from a database, and all the tests used the same data and only ran <code>SELECT</code> statements. In this scenario, <code>SetupSuite</code> could be used once to load the database with data.</p>\n"}], "owner": {"reputation": 504, "user_id": 2720202, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/784398396c7981c9e034c38e5c683adb?s=128&d=identicon&r=PG&f=1", "display_name": "Mohit Jain", "link": "https://stackoverflow.com/users/2720202/mohit-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1696, "favorite_count": 0, "accepted_answer_id": 51032098, "answer_count": 1, "score": 0, "last_activity_date": 1529962532, "creation_date": 1525617815, "question_id": 50200933, "link": "https://stackoverflow.com/questions/50200933/difference-between-setupsuite-setuptest-in-testify-suites", "title": "Difference between SetupSuite &amp; SetupTest in Testify Suites", "body": "<p>I am trying to figure out difference between <code>SetupSuite</code> and <code>SetupTest</code> for quite some time now. Based on information on blogs I have understood that <code>SetupSuite</code> is run before entire suite and <code>SetupTest</code> runs before each test case. But what could be practical example in such a case? And how does dependency injection differ in both the cases? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1525616445, "last_edit_date": 1525616445, "creation_date": 1525616134, "answer_id": 50200667, "question_id": 50200492, "link": "https://stackoverflow.com/questions/50200492/is-it-possible-to-develop-go-on-a-project-basis-without-a-gopath/50200667#50200667", "title": "Is it possible to develop Go on a project basis? (without a gopath)", "body": "<p>As I illustrated in <a href=\"https://stackoverflow.com/a/28394596/6309\">Automatically defining GOPATH on a per project basis</a>, it depends on your IDE.</p>\n\n<p><a href=\"https://code.visualstudio.com/\" rel=\"nofollow noreferrer\">Visual Studio Code</a> will detect automatically a Go project structure (<code>myProject/src</code>) and set a <code>GOPATH</code> just for that project.</p>\n\n<p>See \"<a href=\"https://github.com/Microsoft/vscode-go/wiki/GOPATH-in-the-VS-Code-Go-extension\" rel=\"nofollow noreferrer\">GOPATH in the VS Code Go extension</a>\"</p>\n\n<p>You would find the same feature in GoLand, the IntelliJ editor (not free).<br>\nSee <a href=\"https://www.reddit.com/r/golang/comments/7iro00/using_goland_fairly_new_to_go_where_do_i_set_the/\" rel=\"nofollow noreferrer\">this thread</a>.</p>\n\n<blockquote>\n  <ul>\n  <li><strong>Global GOPATH</strong>: this allows you to configure a GOPATH (which can have multiple values, of course) for all the projects you are using the IDE with. You'll configure it once and reuse it across the projects</li>\n  <li><strong>Project GOPATH</strong>: has the same properties as the Global GOPATH but this one applies only to the current project. This means you can configure different GOPATH values for different projects.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 1, "accepted_answer_id": 50200667, "answer_count": 1, "score": 0, "last_activity_date": 1525616445, "creation_date": 1525615070, "question_id": 50200492, "link": "https://stackoverflow.com/questions/50200492/is-it-possible-to-develop-go-on-a-project-basis-without-a-gopath", "title": "Is it possible to develop Go on a project basis? (without a gopath)", "body": "<p>Say I wanted to integrate a go project into another repo, or wanted to develop a temporary project on my desktop. My current understanding is that in order to develop anything, it must be within my gopath.</p>\n\n<p>Is this unique to Go?\nIs there a way to, for example, <code>go init</code> a folder and use that as a self contained project folder?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525613706, "post_id": 50200279, "comment_id": 87417105, "body": "no, one gopath for all of your projects. All of you projects should live somewhere in <code>$GOPATH&#47;src</code>. E.g. <code>$GOPATH&#47;src&#47;project_foo</code> is ok, and <code>$GOPATH&#47;src&#47;github.com&#47;davidalsh&#47;project_bar</code> is ok also."}, {"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525613853, "post_id": 50200279, "comment_id": 87417156, "body": "I have a monorepo with a couple of nested go projects. Would I have to ferry them back and forth to ensure they build correctly?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525613956, "post_id": 50200279, "comment_id": 87417179, "body": "ferry them to where? You mean import them into other projects?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614078, "post_id": 50200279, "comment_id": 87417213, "body": "Just import them using the path starting after <code>src</code> i.e. <code>import &quot;project_foo&quot;</code> and <code>import &quot;github.com&#47;davidalsh&#47;project_bar&quot;</code> for importing the example packages from the first comment"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614212, "post_id": 50200279, "comment_id": 87417254, "body": "When eventually you deploy your package you should vendor any packages that live outside of the one you&#39;re deploying. If <code>project_bar</code> imports <code>project_foo</code>, you need to vendor <code>project_foo</code>. You do this with a dependency manager like <code>govendor</code> or <code>dep</code>"}, {"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614280, "post_id": 50200279, "comment_id": 87417275, "body": "Sorry, that was unclear. my gopath is <code>~&#47;go</code> and I have a large repo which has multiple projects (clients, and other servers), that lives in <code>~&#47;development&#47;large-repo</code>. If I want to work on the go projects inside the large-repo, would I need to copy/paste them into my gopath, then back when I want to commit my changes?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614424, "post_id": 50200279, "comment_id": 87417317, "body": "You should move <code>large-repo</code> somewhere into <code>~&#47;go&#47;src&#47;</code> and work from there. No need to have it also in <code>~&#47;development&#47;</code>, that is, unless you have some other constraints which require that the <code>large-repo</code> lives in <code>~&#47;development</code>."}, {"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614606, "post_id": 50200279, "comment_id": 87417357, "body": "But then I would also have separate project types/languages in there. Like unrelated web client files (JavaScript and such)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525614677, "post_id": 50200279, "comment_id": 87417389, "body": "What would be the problem with that?"}, {"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525615453, "post_id": 50200279, "comment_id": 87417649, "body": "Nothing majorly, I suppose. Feels a bit messy to fracture my development folder organisation based on language. Thanks for the answers though. Is the gopath pattern unique to Go?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525616318, "post_id": 50200279, "comment_id": 87417906, "body": "Not sure if it&#39;s unique, but it&#39;s definitely something you can get used to however unusual it may seem at first. Also it&#39;s possible that the feeling of messiness is caused more by the original structure of the <i>large</i> repo than by the gopath constraint... so maybe, just maybe, it&#39;s an indicator that the large repo is a bit too large."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1525659406, "post_id": 50200279, "comment_id": 87429661, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24306183/can-someone-explain-why-gopath-is-convenient-and-how-it-should-be-used-in-genera\">Can someone explain why GOPATH is convenient and how it should be used in general?</a>"}], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1525613604, "creation_date": 1525613604, "question_id": 50200279, "link": "https://stackoverflow.com/questions/50200279/is-it-one-project-per-gopath", "title": "Is it one project per gopath?", "body": "<p>I am really enjoying the Go language but I'm having trouble wrapping my head around the gopath rules and constraints.</p>\n\n<p>I spun up a project on my desktop as a non-committal experiment, wanting to pull in a few dependencies. Quickly learned that it didn't work that way. Even when working on a project within my GOPATH, all of my paths must be absolutes from the gopath /src.</p>\n\n<p>Does this mean the gopath is for one project? Should I be changing my gopath frequently (when moving between projects)?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525609223, "post_id": 50198697, "comment_id": 87415764, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/170462/discussion-between-ufk-and-flimzy\">continue this discussion in chat</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525612795, "post_id": 50198697, "comment_id": 87416811, "body": "@Flimzy apparently the error message is using the tag or json key: <a href=\"https://play.golang.org/p/FhS6ekOdxiS\" rel=\"nofollow noreferrer\">play.golang.org/p/FhS6ekOdxiS</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525616903, "post_id": 50198697, "comment_id": 87418105, "body": "@mkopriva: Fascinating. And misleading. But good to know."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1525612725, "creation_date": 1525612725, "answer_id": 50200155, "question_id": 50198697, "link": "https://stackoverflow.com/questions/50198697/cannot-unmarshal-array-into-go-struct-when-decoding-array/50200155#50200155", "title": "cannot unmarshal array into Go struct when decoding array", "body": "<p>In the <code>json</code> the <code>data</code> structure is <code>object[key]array</code>, while in Go <code>Data</code> is <code>map[key]struct.slice</code>. Change <code>Data</code> to be <code>map[key]slice</code> instead.</p>\n\n<p>E.g.</p>\n\n<pre><code>type AjaxModels struct {\n    Status bool                      `json:\"status\"`\n    Data   map[string][]AjaxModelsList `json:\"data\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Sh_vKVL-D--\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Sh_vKVL-D--</a></p>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5988, "favorite_count": 0, "accepted_answer_id": 50200155, "answer_count": 1, "score": 1, "last_activity_date": 1525612725, "creation_date": 1525602724, "last_edit_date": 1525609068, "question_id": 50198697, "link": "https://stackoverflow.com/questions/50198697/cannot-unmarshal-array-into-go-struct-when-decoding-array", "title": "cannot unmarshal array into Go struct when decoding array", "body": "<p>I'm trying to properly decode JSON String to an object.</p>\n\n<p>I defined the following structs:</p>\n\n<pre><code>type AjaxModelsList struct {\n    Id float64 `json:\"Id\"`\n    Name string `json:\"Name\"`\n    CarId float64 `json:\"CarId\"`\n    EngName string `json:\"EngName\"`\n}\n\ntype AjaxModelsData struct {\n    ModelList []AjaxModelsList `json:\"ModelList\"`\n}\n\ntype AjaxModels struct {\n    Status bool `json:\"status\"`\n    Data map[string]AjaxModelsData `json:\"data\"`\n\n}\n</code></pre>\n\n<p>the defined object is </p>\n\n<pre><code>{\n \"status\": true,\n \"data\": {\n \"ModelList\": [{\n   \"Id\": 1,\n   \"Name\": \"foo\",\n   \"CarId\": 1,\n   \"EngName\": \"bar\"\n  }]\n }\n}\n</code></pre>\n\n<p>and I unmarshall using the following code:</p>\n\n<pre><code>c :=AjaxModels{}\nif err := json.Unmarshal(body_byte,&amp;c); err != nil {\n    log.Fatalf(\"an error occured: %v\",err)\n}\n</code></pre>\n\n<p>and I get the following output:</p>\n\n<pre><code>an error occured: json: cannot unmarshal array into Go struct field AjaxModels.data of type main.AjaxModelsData\n</code></pre>\n\n<p>since I used <code>[]AjaxModelsList</code> it's a slice so I shouldn't be getting this error. I probably missed something, but what ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525598440, "post_id": 50197961, "comment_id": 87413005, "body": "I&#39;ve copied and run your code, both return false (not true and false like your output), which is correct since context.Context is not pkg1.Arg. Please provide the exact code you&#39;re running or else we can&#39;t tell what you&#39;re doing wrong."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525598581, "post_id": 50197961, "comment_id": 87413032, "body": "To clarify, impl1 and impl2 both <i>do not</i> implement pkg1.Interface because their argument type to the Method method is different from the one specified in the Interface."}, {"owner": {"reputation": 21, "user_id": 408753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef38a88adcf317bdb7b465e8b29d0a27?s=128&d=identicon&r=PG", "display_name": "Denis Cheremisov", "link": "https://stackoverflow.com/users/408753/denis-cheremisov"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525606209, "post_id": 50197961, "comment_id": 87414929, "body": "@mkopriva I am sorry, I got this behaviour from another example but then found the same behaviour with imported types. Fixed example."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1525611819, "creation_date": 1525611819, "answer_id": 50200026, "question_id": 50197961, "link": "https://stackoverflow.com/questions/50197961/how-to-make-types-implements-work-properly-with-the-signature-that-uses-imported/50200026#50200026", "title": "How to make types.Implements work properly with the signature that uses imported types?", "body": "<p>I'm not sure if this is intended behaviour or if it's a bug but, if you dig through the source you'll find that the <code>types.Implements</code> \"fails\" here: <a href=\"https://github.com/golang/go/blob/master/src/go/types/predicates.go#L282-L287\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/go/types/predicates.go#L282-L287</a></p>\n\n<p>As you can see from the comment the comparison will return true only if the </p>\n\n<blockquote>\n  <p>type names originate in the same type declaration</p>\n</blockquote>\n\n<p>but if you add print statements there to check the x, y values you'll see that it compares two <em>different pointers</em> to <code>types.Named</code> value of the same type <code>context.Context</code>. The fact that the type info is allocated twice is equivalent to the named types <em>not</em> originating in the same declaration. The reason that you have two instances of the same named type is becuase you're parsing and checking the two packages separately.</p>\n\n<p>So the solution is to parse and check both of the packages together. I'm not sure if this is a viable solution for you or not but one thing you can do is to declare a third package that imports the two packages and parse and check this third package.</p>\n\n<p>For example:</p>\n\n<pre><code>awesome\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 pkg1\n\u2502   \u2514\u2500\u2500 file.go\n\u251c\u2500\u2500 pkg2\n\u2502   \u2514\u2500\u2500 file.go\n\u2514\u2500\u2500 pkg3\n    \u2514\u2500\u2500 file.go\n</code></pre>\n\n<p>Then the pkg3 contents would look like this:</p>\n\n<p><strong><code>awesome/pkg3/file.go</code></strong></p>\n\n<pre><code>package pkg3\n\nimport (\n    _ \"awesome/pkg1\"\n    _ \"awesome/pkg2\"\n)\n</code></pre>\n\n<p>And your main like this:</p>\n\n<p><strong><code>awesome/main.go</code></strong> (I've added only the changes that need to be made to the original)</p>\n\n<pre><code>func getTypes(path string) *types.Package {\n\n    // ...\n\n    for _, pkg := range pkgs {\n        config := &amp;types.Config{\n            Importer: importer.For(\"source\", nil),\n        }\n\n        // ...\n    }\n    return nil\n}\n\n// ...\n\nfunc main() {\n    p3 := getTypes(\"awesome/pkg3\")\n\n    p1 := p3.Imports()[0]\n    p2 := p3.Imports()[1]\n\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 408753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef38a88adcf317bdb7b465e8b29d0a27?s=128&d=identicon&r=PG", "display_name": "Denis Cheremisov", "link": "https://stackoverflow.com/users/408753/denis-cheremisov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1525673366, "creation_date": 1525597092, "last_edit_date": 1525673366, "question_id": 50197961, "link": "https://stackoverflow.com/questions/50197961/how-to-make-types-implements-work-properly-with-the-signature-that-uses-imported", "title": "How to make types.Implements work properly with the signature that uses imported types?", "body": "<p><code>types.Implements(impl1, iface)</code> returns <code>false</code>, when interface definition signature uses some type, and possible implementation lies in another package and needs to import that type.</p>\n\n<p>Project structure</p>\n\n<pre><code>awesome\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 pkg1\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 file.go\n\u2514\u2500\u2500 pkg2\n    \u2514\u2500\u2500 file.go\n</code></pre>\n\n<p>i.e., there's package <code>main</code> in the <code>awesome</code> folder.</p>\n\n<p><strong><code>awesome/pkg1/file.go</code></strong></p>\n\n<pre><code>package pkg1\n\nimport (\n    \"context\"\n)\n\n// Interface generic object\ntype Interface interface {\n    Method(context.Context) string\n}\n\n// Implementation1 implementation of Interface\ntype Implementation1 struct{}\n\n// Method ...\nfunc (Implementation1) Method(context.Context) string {\n    return \"\"\n}\n</code></pre>\n\n<p><strong><code>awesome/pkg2/file.go</code></strong> looks like</p>\n\n<pre><code>package pkg2\n\nimport (\n    \"context\"\n)\n\n// Implementation2 implementation for pkg1.Interface\ntype Implementation2 struct{}\n\n// Method ...\nfunc (Implementation2) Method(context.Context) string {\n    return \"\"\n}\n</code></pre>\n\n<p>And now <strong><code>awesome/main.go</code></strong></p>\n\n<pre><code>package main\n\nimport (\n    \"go/ast\"\n    \"go/importer\"\n    \"go/parser\"\n    \"go/token\"\n    \"go/types\"\n    \"os\"\n    \"os/user\"\n    \"path/filepath\"\n    \"fmt\"\n)\n\nvar fset = token.NewFileSet()\n\nfunc getPath() string {\n    gopath := os.Getenv(\"GOPATH\")\n    if len(gopath) == 0 {\n        usr, err := user.Current()\n        if err != nil {\n            panic(err)\n        }\n        gopath = filepath.Join(usr.HomeDir, \"go\")\n    }\n    return filepath.Join(gopath, \"src\")\n}\n\nfunc getTypes(path string) *types.Package {\n    fullpath := filepath.Join(getPath(), path)\n    pkgs, err := parser.ParseDir(fset, fullpath, nil, parser.ParseComments)\n    if err != nil {\n        panic(err)\n    }\n    for _, pkg := range pkgs {\n        config := &amp;types.Config{\n            Importer: importer.Default(),\n        }\n        info := types.Info{\n            Types: map[ast.Expr]types.TypeAndValue{},\n        }\n        var files []*ast.File\n        for _, file := range pkg.Files {\n            files = append(files, file)\n        }\n        typeInfo, err := config.Check(path, fset, files, &amp;info)\n        if err != nil {\n            panic(err)\n        }\n        return typeInfo\n    }\n    return nil\n}\n\nfunc main() {\n    p1 := getTypes(\"awesome/pkg1\")\n    p2 := getTypes(\"awesome/pkg2\")\n\n    iface := p1.Scope().Lookup(\"Interface\").(*types.TypeName).Type().(*types.Named).Underlying().(*types.Interface)\n    impl1 := p1.Scope().Lookup(\"Implementation1\").Type()\n    impl2 := p2.Scope().Lookup(\"Implementation2\").Type()\n    fmt.Println(\"Implementation1 implements Interface\", types.Implements(impl1, iface))\n    fmt.Println(\"Implementation2 implements Interface\", types.Implements(impl2, iface))\n}\n</code></pre>\n\n<p>Program output:</p>\n\n<pre><code>$ go install awesome\n$ awesome\nImplementation1 implements Interface true\nImplementation2 implements Interface false\n</code></pre>\n\n<p>It happens because of imported type <code>context.Context</code>. It works fine and returns <code>true</code> in the second case when I change <code>Method</code>'s argument type to <code>string</code>, <code>int</code>, <code>byte</code>, whatever or just remove it. What am I doing wrong?</p>\n\n<p>@mkopriva answer actually put me into right direction: different types checking produces different types, that's why <code>Implements</code> fails on non-basic types. We just need to reuse objects for type checking: this <code>main.go</code> actually works.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/ast\"\n    \"go/importer\"\n    \"go/parser\"\n    \"go/token\"\n    \"go/types\"\n    \"os\"\n    \"os/user\"\n    \"path/filepath\"\n)\n\nvar fset = token.NewFileSet()\nvar config = &amp;types.Config{\n    Importer: importer.Default(),\n}\nvar typeInfo = &amp;types.Info{    \n    Types:      map[ast.Expr]types.TypeAndValue{},\n    Defs:       nil,\n    Uses:       nil,\n    Implicits:  nil,\n    Selections: nil,\n    Scopes:     nil,\n    InitOrder:  nil,\n}\n\nfunc getPath() string {\n    gopath := os.Getenv(\"GOPATH\")\n    if len(gopath) == 0 {\n        usr, err := user.Current()\n        if err != nil {\n            panic(err)\n        }\n        gopath = filepath.Join(usr.HomeDir, \"go\")\n    }\n    return filepath.Join(gopath, \"src\")\n}\n\nfunc getTree(path string) *ast.Package {\n    fullpath := filepath.Join(getPath(), path)\n    pkgs, err := parser.ParseDir(fset, fullpath, nil, parser.ParseComments)\n    if err != nil {\n        panic(err)\n    }\n    for _, pkg := range pkgs {\n        return pkg\n    }\n    return nil\n}\n\nfunc getTypes(pkg *ast.Package, path string) *types.Package {\n\n    var files []*ast.File\n    for _, file := range pkg.Files {\n        files = append(files, file)\n    }\n    typeInfo, err := config.Check(path, fset, files, typeInfo)\n    if err != nil {\n        panic(err)\n    }\n    return typeInfo\n}\n\nfunc main() {\n    const pkg1Path = \"awesome/pkg1\"\n    t1 := getTree(pkg1Path)\n    p1 := getTypes(t1, pkg1Path)\n    const pkg2Path = \"awesome/pkg2\"\n    t2 := getTree(pkg2Path)\n    p2 := getTypes(t2, pkg2Path)\n\n    iface := p1.Scope().Lookup(\"Interface\").(*types.TypeName).Type().(*types.Named).Underlying().(*types.Interface)\n    impl1 := p1.Scope().Lookup(\"Implementation1\").Type()\n    fmt.Printf(\"%s\\n\", impl1.(*types.Named).Method(0).Name())\n    impl2 := p2.Scope().Lookup(\"Implementation2\").Type()\n    fmt.Println(\"Implementation1 implements Interface\", types.Implements(impl1, iface))\n    fmt.Println(\"Implementation2 implements Interface\", types.Implements(impl2, iface))\n}\n</code></pre>\n\n<p>We just need to share <code>*types.Config</code> and <code>*types.Info</code> in order for the checking procedure to deal with once imported type (which is represented as an object) rather than to register it again as a new object.</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine", "indexoutofrangeexception"], "answers": [{"comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 1, "creation_date": 1525590876, "post_id": 50196828, "comment_id": 87411173, "body": "Nice answer!  I like the explanation of the goroutine in loop problem here: <a href=\"https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "edited": false, "score": 0, "creation_date": 1525607483, "post_id": 50196828, "comment_id": 87415283, "body": "I think your answer is partially correct. Because i am using defer at the of main. Defer will run at end of main when all threads have finish. correct me if i am wrong. But hats-of for figuring out the first part"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "edited": false, "score": 2, "creation_date": 1525626490, "post_id": 50196828, "comment_id": 87421445, "body": "@drainzerrr: That&#39;s not how <code>defer</code> works, please see my updated answer."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1525626613, "post_id": 50196828, "comment_id": 87421489, "body": "@IainDuncan Thanks. I know the closure problem from JavaScript and anonymous event handlers inside loops."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 2, "last_activity_date": 1525626467, "last_edit_date": 1525626467, "creation_date": 1525587853, "answer_id": 50196828, "question_id": 50196257, "link": "https://stackoverflow.com/questions/50196257/go-routines-matrix-multiplication-error/50196828#50196828", "title": "Go routines Matrix multiplication error", "body": "<p>I see two problems:</p>\n\n<ol>\n<li>You have a classic closure problem in <code>multiply</code> with <code>i</code> and <code>j</code>.</li>\n<li>There's no guarantee that <code>matrix_c</code> will be computed before you return it in <code>multiply</code>.</li>\n</ol>\n\n<p>The first one is right here:</p>\n\n<pre><code>for i := 0; i &lt; 3; i++ {\n    for j := 0; j &lt; 3; j++ {\n        go func(){\n            matrix_c[i][j] = pmultiply(matrix_a,matrix_b,i,j);\n        }()\n    }   \n}\n</code></pre>\n\n<p>The anonymous function is keeping a reference to <code>i</code> and <code>j</code> not the actual values of <code>i</code> and <code>j</code> when you <code>go func() { ... }()</code> so when the goroutine executes, <code>i</code> and <code>j</code> could be any values between zero and three (<strong>inclusive</strong>). That's where the error you know about comes from: <code>i</code> or <code>j</code> is three because the goroutine is executing <em>after</em> the loops have completed. The easiest solution is to force <code>i</code> and <code>j</code> to be evaluated at the right time:</p>\n\n<pre><code>go func(i, j int) {\n    matrix_c[i][j] = pmultiply(matrix_a, matrix_b, i, j)\n}(i, j)\n</code></pre>\n\n<p>The second problem is that the goroutines won't necessarily all finish before you <code>return matrix_c</code>, there's not even a guarantee that any of of them will finish. The easiest solution would be to use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> to wait for them to finish. First you'd <code>import \"sync\"</code>, then adjust the loops:</p>\n\n<pre><code>var wg sync.WaitGroup\nfor i := 0; i &lt; 3; i++ {\n    for j := 0; j &lt; 3; j++ {\n        wg.Add(1) // Tell the WaitGroup to wait for another thing.\n        go func(i, j int) {\n            matrix_c[i][j] = pmultiply(matrix_a, matrix_b, i, j)\n            wg.Done() // Tell it that we're done.\n        }(i, j)\n    }\n}\n</code></pre>\n\n<p>and then wait before returning:</p>\n\n<pre><code>wg.Wait()\nreturn matrix_c\n</code></pre>\n\n<hr>\n\n<p><strong>Response to Comments:</strong> <code>defer</code> doesn't work like that, <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">the specification only says</a>:</p>\n\n<blockquote>\n  <p>A \"defer\" statement invokes a function whose execution is deferred to the moment the surrounding function returns, either because the surrounding function executed a return statement, reached the end of its function body, or because the corresponding goroutine is panicking.</p>\n</blockquote>\n\n<p>That's it, it arranges for something to be executed when execution leaves the surrounding function. <code>defer</code> doesn't have anything to do with waiting for threads/goroutines nor does it know anything about goroutines that the deferred function may create.</p>\n"}], "owner": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 0, "accepted_answer_id": 50196828, "answer_count": 1, "score": 0, "last_activity_date": 1525626467, "creation_date": 1525581250, "question_id": 50196257, "link": "https://stackoverflow.com/questions/50196257/go-routines-matrix-multiplication-error", "title": "Go routines Matrix multiplication error", "body": "<p>I am multiplying matrix in parallel using go routines. I am getting index out of range, but when i run the same code sequential it works. (by sequential i mean commenting go line). I am using defer so i do not have to wait for my routines to end as it will be the last thing called</p>\n\n<p>Error \n    D:\\0000>go run Ap.go\n    panic: runtime error: index out of range</p>\n\n<pre><code>goroutine 5 [running]:\nmain.pmultiply(0xc04206c000, 0x3, 0x3, 0xc04206c050, 0x3, 0x3, 0x1, 0x3, 0x0)\n        D:/0000/Ap.go:48 +0x95\nmain.multiply.func1(0xc04206c0a0, 0x3, 0x3, 0xc04200e090, 0xc04200e098, 0xc04206\nc000, 0x3, 0x3, 0xc04206c050, 0x3, ...)\n        D:/0000/Ap.go:64 +0x94\ncreated by main.multiply\n        D:/0000/Ap.go:63 +0x1d7\nexit status 2\n</code></pre>\n\n<p>CODE</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main(){\n\n    matrix_a := make([][]int,3);\n\n    for i:=0;i&lt;len(matrix_a);i++{\n\n        matrix_a[i]=make([]int,3);\n\n    }\n\n\n    for i:=0;i&lt;len(matrix_a);i++{\n\n        for j:=0;j&lt;len(matrix_a[0]);j++{\n            matrix_a[i][j] = 2;\n        }\n    }\n\n    matrix_b := make([][]int,3);\n\n    for i:=0;i&lt;len(matrix_b);i++{\n\n        matrix_b[i]=make([]int,3);\n\n    }\n\n\n    for i:=0;i&lt;len(matrix_b);i++{\n\n        for j:=0;j&lt;len(matrix_b[0]);j++{\n            matrix_b[i][j] = 2;\n        }\n    }\n\n    defer fmt.Println(multiply(matrix_a,matrix_b));\n\n}\n\nfunc pmultiply(matrix_a [][] int,matrix_b [][] int,row int,col int) int{\n\n    sum := 0;\n\n    for z:=0;z&lt;len(matrix_a[0]);z++{\n        sum = sum + matrix_a[row][z] *  matrix_b[z][col];\n    }\n    return sum;\n}\n\nfunc multiply(matrix_a [][] int,matrix_b [][] int) ([][] int){\n\n    matrix_c := make([][]int,3);\n\n    for i:=0;i&lt;len(matrix_c);i++{\n        matrix_c[i]=make([]int,3);\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        for j := 0; j &lt; 3; j++ {\n            go func(){\n                matrix_c[i][j] = pmultiply(matrix_a,matrix_b,i,j);\n            }()\n        }   \n    }\n\n    return matrix_c;\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 9747069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7a3fcd090751ff8abe69fe1280a03dd?s=128&d=identicon&r=PG&f=1", "display_name": "R Sharma", "link": "https://stackoverflow.com/users/9747069/r-sharma"}, "edited": false, "score": 0, "creation_date": 1525585510, "post_id": 50195378, "comment_id": 87410146, "body": "Got it. Thanks for sharing knowledge (y)"}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 2, "last_activity_date": 1525568703, "creation_date": 1525568703, "answer_id": 50195378, "question_id": 50195273, "link": "https://stackoverflow.com/questions/50195273/looping-struct-inside-struct/50195378#50195378", "title": "Looping struct inside struct", "body": "<p>To initialize a variable to an empty slice, you want <code>[]Tag{}</code>, not <code>[]Tag</code>. You can also range over the list of words which is a bit easier, and then you just need to construct your Tag from the word, e.g.</p>\n\n<pre><code>words := []string{\"one\", \"two\", \"three\", \"four\"}\n\ntagsList := []Tag{}\nfor _, word := range words {\n    tagsList = append(tagsList, Tag{Name: word})\n}\n</code></pre>\n\n<p>Full <a href=\"https://play.golang.org/p/CfIa0S_QcrU\" rel=\"nofollow noreferrer\">example on playground</a></p>\n"}], "owner": {"reputation": 35, "user_id": 9747069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7a3fcd090751ff8abe69fe1280a03dd?s=128&d=identicon&r=PG&f=1", "display_name": "R Sharma", "link": "https://stackoverflow.com/users/9747069/r-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 50195378, "answer_count": 1, "score": 1, "last_activity_date": 1525584303, "creation_date": 1525567361, "last_edit_date": 1525584303, "question_id": 50195273, "link": "https://stackoverflow.com/questions/50195273/looping-struct-inside-struct", "title": "Looping struct inside struct", "body": "<p>I am trying to save form data in graph database (dgraph ) for which I need to iterate another struct inside parent struct.</p>\n\n<p>I have couple of struct with name <code>Tag</code> and <code>Question</code> and I have array with name <code>words</code>.</p>\n\n<p>I have to fill the <code>Question</code>struct with <code>words</code> array as array <code>Tag</code> struct</p>\n\n<p>This is what I am trying to do:</p>\n\n<pre><code>type Tag struct {\n    Name string\n    Count string\n}\n\ntype Question struct {\n    Title string\n    Tags []Tag\n}\n\nwords := []string{\"one\", \"two\", \"three\", \"four\"}\n\ntagsList := []Tag\nfor i=0;i&lt;len(words);i++ {\n    tagsList = append(tagsList, words[i])\n}\n\nq := Question {\n    Title: \"Kickstart Business with Corporate Leadership\",\n    Tags: tagsList,\n}\n</code></pre>\n\n<p>I am getting error: \"type []Tag is not an expression\"</p>\n\n<p>I need help in putting \"tallest\" in \"Question\" struct value.</p>\n"}, {"tags": ["go", "import", "package"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1525566057, "post_id": 50195171, "comment_id": 87407317, "body": "In which folder is <code>image.go</code>?"}, {"owner": {"reputation": 53, "user_id": 9746532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "leme", "link": "https://stackoverflow.com/users/9746532/leme"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1525566731, "post_id": 50195171, "comment_id": 87407407, "body": "in the src folder I have a folder called image"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 9746532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "leme", "link": "https://stackoverflow.com/users/9746532/leme"}, "edited": false, "score": 0, "creation_date": 1525567513, "post_id": 50195223, "comment_id": 87407517, "body": "Would the proper way to import packages be hosting a repository and importing from the repository?  For example, creating a github repo for the project and calling the package from the github url"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 53, "user_id": 9746532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "leme", "link": "https://stackoverflow.com/users/9746532/leme"}, "edited": false, "score": 0, "creation_date": 1525567777, "post_id": 50195223, "comment_id": 87407550, "body": "@leme without hosting the repo, simply having a <i>local</i> folder <i>structure</i> different from just &quot;<code>image</code>&quot; (like <code>GOPATH&#47;src&#47;myproject&#47;image</code>) would allow your code to reference <code>myproject.image.New()</code>. You don&#39;t have to create a remote repo for that."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1525566951, "last_edit_date": 1592644375, "creation_date": 1525566633, "answer_id": 50195223, "question_id": 50195171, "link": "https://stackoverflow.com/questions/50195171/go-package-not-exporting-function-with-capital-letter/50195223#50195223", "title": "Go package not exporting function with capital letter", "body": "<p>The native library <a href=\"https://golang.org/pkg/image/\" rel=\"nofollow noreferrer\">Go &quot;image&quot; package</a> does not have any New method.</p>\n<p>You would need to prefix your own image package with the name of your project/path within <code>$GOPATH</code> in order to make Go chose your own package, and not the native one.</p>\n<p>See &quot;<a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">Package names</a>&quot;</p>\n<blockquote>\n<p>A Go package has both a name and a path.</p>\n<p>The package name is specified in the package statement of its source files; client code uses it as the prefix for the package's exported names. Client code uses the package path when importing the package.<br />\nBy convention, the last element of the package path is the package name:</p>\n</blockquote>\n<pre><code>import (\n    &quot;context&quot;                // package context\n    &quot;fmt&quot;                    // package fmt\n    &quot;golang.org/x/time/rate&quot; // package rate\n    &quot;os/exec&quot;                // package exec\n)\n</code></pre>\n<p>The OP adds:</p>\n<blockquote>\n<p><code>image</code> is in the <code>src</code> folder: I have a folder called <code>image</code>.</p>\n</blockquote>\n<p>See &quot;<a href=\"https://blog.golang.org/organizing-go-code\" rel=\"nofollow noreferrer\">Organizing Go code</a>&quot;:</p>\n<blockquote>\n<p>Sometimes people set <code>GOPATH</code> to the root of their source repository and put their packages in directories relative to the repository root, such as &quot;<code>src/my/package</code>&quot;.</p>\n<p>On one hand, this keeps the import paths short (&quot;<code>my/package</code>&quot; instead of &quot;<code>github.com/me/project/my/package</code>&quot;), but on the other it breaks go get and forces users to re-set their <code>GOPATH</code> to use the package.<br />\nDon't do this.</p>\n</blockquote>\n"}], "owner": {"reputation": 53, "user_id": 9746532, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "leme", "link": "https://stackoverflow.com/users/9746532/leme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4075, "favorite_count": 1, "accepted_answer_id": 50195223, "answer_count": 1, "score": 2, "last_activity_date": 1529941833, "creation_date": 1525565927, "last_edit_date": 1529941833, "question_id": 50195171, "link": "https://stackoverflow.com/questions/50195171/go-package-not-exporting-function-with-capital-letter", "title": "Go package not exporting function with capital letter", "body": "<p>I am trying to import a package in Golang, however I am unable to refrence a function declared within the package. </p>\n\n<p>The following code is for the package i'm trying to import.</p>\n\n<pre><code>//image.go\npacakage image\nimport \"pixel\"\n\ntype Image struct {\n    Matrix [][]pixel.Pixel\n}\n\nfunc New(width, height int) *Image{\n     //Code\n}\n</code></pre>\n\n<p>The following code is for the main file</p>\n\n<pre><code>//main.go\npacakage main\nimport (\n    \"image\"\n    \"fmt\"\n)\n\nfunc main(){\n    img := image.New(10,4)\n    fmt.Println(img)\n}\n</code></pre>\n\n<p>When I run the main.go with go run main.go I get an error that says</p>\n\n<pre><code>undefined: image.New\n</code></pre>\n\n<p>I have ensured that my function is defined with an uppercase letter so i'm unsure why I'm able to call the New function. I am however able to declare a new image.Image variable.</p>\n\n<p>Edit:</p>\n\n<p>The problem was that I was developing outside the designated GOPATH/src. I was creating a file outside the GOPATH and resetting my GOPATH to my work file. This prevented me from properly importing and compiling my packages.</p>\n"}, {"tags": ["go", "plugins"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1527157721, "last_edit_date": 1527157721, "creation_date": 1527100529, "answer_id": 50495240, "question_id": 50194888, "link": "https://stackoverflow.com/questions/50194888/is-it-possible-to-share-a-custom-data-type-between-a-go-plugin-and-an-applicatio/50495240#50495240", "title": "Is it possible to share a custom data type between a go plugin and an application?", "body": "<p>Identifiers defined in the <code>main</code> package cannot be referred to from other packages, so an exported identifier from a plugin cannot be the same type what you have in your main app. Even if you would duplicate the <code>Person</code> type both in the plugin's file and in your main app, type assertion would fail because they are not the same type!</p>\n\n<p>But it is possible to define the type in a separate package, and use this same package in the plugin and in the main app. And then you can type assert this type from a symbol you lookup from the plugin.</p>\n\n<p>See this example:</p>\n\n<p>The separate type defined in its own package:</p>\n\n<pre><code>package filter\n\ntype Filter struct {\n    Name string\n    Age  int\n}\n</code></pre>\n\n<p>Plugin code:</p>\n\n<pre><code>package main\n\nimport (\n    \"play/filter\"\n)\n\nvar MyFilter = filter.Filter{\n    Name: \"Bob\",\n    Age:  21,\n}\n\nfunc CreateFilter() filter.Filter {\n    return filter.Filter{\n        Name: \"Bob\",\n        Age:  21,\n    }\n}\n</code></pre>\n\n<p>The main app:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"play/filter\"\n    \"plugin\"\n)\n\nfunc main() {\n    p, err := plugin.Open(\"plugin.so\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    mf, err := p.Lookup(\"MyFilter\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    f, ok := mf.(*filter.Filter)\n    if !ok {\n        log.Fatal(\"Wrong symbol type\")\n    }\n\n    fmt.Printf(\"%+v\\n\", f)\n}\n</code></pre>\n\n<p>Running the main app, the output is:</p>\n\n<pre><code>&amp;{Name:Bob Age:21}\n</code></pre>\n\n<p>What you may notice is that the exported identifier in the plugin <code>MyFilter</code> is a variable of non-pointer type, yet we type-asserted a pointer type from the exported symbol. This is because if you lookup a <em>variable</em>, you will get a pointer to it, else you could not modify the value of the variable, you could only modify the copy. This is detailed in this answer: <a href=\"https://stackoverflow.com/questions/49656283/plugin-symbol-as-function-return/49668505#49668505\">Plugin symbol as function return</a></p>\n\n<p>This is not the case if we lookup the other symbol our plugin exports: the <code>CreateFilter()</code> function which returns a value of non-pointer type <code>filter.Filter</code>:</p>\n\n<pre><code>cf, err := p.Lookup(\"CreateFilter\")\nif err != nil {\n    log.Fatal(err)\n}\n\ncreateFilter, ok := cf.(func() filter.Filter)\nif !ok {\n    log.Fatal(\"Wrong function type\")\n}\nf2 := createFilter()\nfmt.Printf(\"%+v\\n\", f2)\n</code></pre>\n\n<p>Running this code, the output will be:</p>\n\n<pre><code>{Name:Bob Age:21}\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/42388090/go-1-8-plugin-use-custom-interface/42389345#42389345\">go 1.8 plugin use custom interface</a></p>\n\n<p>Also note that if you change the <code>filter</code> package used commonly by the plugin and the main app, you also have to rebuild the plugin. Attempting to run the app without rebuilding the plugin will result in an error during the <code>plugin.Open()</code> call. For details, see <a href=\"https://stackoverflow.com/questions/42218472/how-do-go-plugin-dependencies-work/42220856#42220856\">How do Go plugin dependencies work?</a></p>\n"}], "owner": {"reputation": 1104, "user_id": 3513453, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4a7f4865f48c8e1e971070379460b257?s=128&d=identicon&r=PG&f=1", "display_name": "felipeek", "link": "https://stackoverflow.com/users/3513453/felipeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 1, "accepted_answer_id": 50495240, "answer_count": 1, "score": 4, "last_activity_date": 1527157721, "creation_date": 1525562514, "question_id": 50194888, "link": "https://stackoverflow.com/questions/50194888/is-it-possible-to-share-a-custom-data-type-between-a-go-plugin-and-an-applicatio", "title": "Is it possible to share a custom data type between a go plugin and an application?", "body": "<p>I know that it is possible to look up for go-plugin symbols that were exported and type assert them into an <em>interface</em>. However, I wonder if is there a way to type assert them into a struct, for example. Is there a way to do it?</p>\n\n<p>For example:</p>\n\n<p><em>plugin.go</em></p>\n\n<pre><code>package main\n\ntype Person struct {\n    Name string\n}\n\nvar (\n    P = Person{\n        Name: \"Emma\",\n    }\n)\n</code></pre>\n\n<p><em>app.go</em></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"plugin\"\n    \"os\"\n)\n\nfunc main() {\n    plug, err := plugin.Open(\"./plugin.so\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    sym, err := plug.Lookup(\"P\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    var p Person\n    p, ok := sym.(Person)\n    if !ok {\n        fmt.Println(\"Wrong symbol type\")\n        os.Exit(1)\n    }\n\n    fmt.Println(p.Name) \n}\n</code></pre>\n\n<p>The symbol P, which is a <em>Person</em>, is found when <em>plug.Lookup</em> is called. However, I can't type-assert P into <em>Person</em>, I get an execution time error. In this example, <em>\"Wrong symbol type\"</em>.</p>\n\n<p>Is there a way to achieve this or the only way to share data between the plugin and the application is using interfaces?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9746488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4bd1567cfb6c9a92910703c52eee5db?s=128&d=identicon&r=PG&f=1", "display_name": "Ribinhead", "link": "https://stackoverflow.com/users/9746488/ribinhead"}, "edited": false, "score": 0, "creation_date": 1525548465, "post_id": 50193185, "comment_id": 87403595, "body": "That makes sense.  I agree with adding the SubLabel declared type.  I can see how this could go multiple layers down and that would make it a lot easier to read and better code re-usability.  Thanks!"}, {"owner": {"reputation": 26649, "user_id": 188702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9257dbb2fdd9d164711aa191420ef621?s=128&d=identicon&r=PG", "display_name": "Dominic Barnes", "link": "https://stackoverflow.com/users/188702/dominic-barnes"}, "reply_to_user": {"reputation": 1, "user_id": 9746488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4bd1567cfb6c9a92910703c52eee5db?s=128&d=identicon&r=PG&f=1", "display_name": "Ribinhead", "link": "https://stackoverflow.com/users/9746488/ribinhead"}, "edited": false, "score": 0, "creation_date": 1525549046, "post_id": 50193185, "comment_id": 87403757, "body": "Glad I could help, don&#39;t forget to mark my answer as the answer to your question. :)"}], "tags": [], "owner": {"reputation": 26649, "user_id": 188702, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9257dbb2fdd9d164711aa191420ef621?s=128&d=identicon&r=PG", "display_name": "Dominic Barnes", "link": "https://stackoverflow.com/users/188702/dominic-barnes"}, "is_accepted": true, "score": 1, "last_activity_date": 1525662780, "last_edit_date": 1525662780, "creation_date": 1525547858, "answer_id": 50193185, "question_id": 50193147, "link": "https://stackoverflow.com/questions/50193147/error-assigning-values-to-struct-within-a-struct-golang/50193185#50193185", "title": "error assigning values to struct within a struct golang", "body": "<p>The default value for a slice is <code>nil</code> so it has no elements, and you cannot assign to index 0 because it doesn't exist yet.</p>\n\n<p>You can use append to add a new element to that slice using:</p>\n\n<pre><code>l.Labels = append(l.Labels, struct{\n    ID   int\n    Name string\n}{\n    ID:   200,\n    Name: \"me\",\n})\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uAWdQdh0Ov7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uAWdQdh0Ov7</a></p>\n\n<p>In addition, your use of an inline/anonymous struct here means you'll need to redeclare the type when you <code>append</code>. Consider adding another declared type:</p>\n\n<pre><code>type SubLabel struct {\n    ID   int\n    Name string\n}\n\ntype Label struct {\n    ID     int\n    Labels []SubLabel\n}\n\n// ...\n\nl.Labels = append(l.Labels, SubLabel{\n    ID:   200,\n    Name: \"me\",\n})\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4idibGH6Wzd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4idibGH6Wzd</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9746488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4bd1567cfb6c9a92910703c52eee5db?s=128&d=identicon&r=PG&f=1", "display_name": "Ribinhead", "link": "https://stackoverflow.com/users/9746488/ribinhead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 1, "accepted_answer_id": 50193185, "answer_count": 1, "score": -2, "last_activity_date": 1525662780, "creation_date": 1525547661, "question_id": 50193147, "link": "https://stackoverflow.com/questions/50193147/error-assigning-values-to-struct-within-a-struct-golang", "title": "error assigning values to struct within a struct golang", "body": "<p>I came across this situation where I was trying to assign values to a struct within a struct.  There is no compiler error, but it does panic when you run it.  Does Go have a different way to handle this data structure? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Label struct {\n    ID     int\n    Labels []struct {\n        ID   int\n        Name string\n    }\n}\n\nfunc main() {\n    l := Label{}\n    l.ID = 100\n\n    l.Labels[0].ID = 200\n    l.Labels[0].Name = \"me\"\n\n    fmt.Println(l.ID)\n    fmt.Println(l.Labels[0].ID)\n    fmt.Println(l.Labels[0].Name)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IiuXpaDvF1W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IiuXpaDvF1W</a></p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "slice", "padding"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1525557002, "post_id": 50192467, "comment_id": 87405733, "body": "Why do you think it should be 24 bytes? Your assumptions are a) wrong and b) not justified by the language spec."}], "answers": [{"comments": [{"owner": {"reputation": 275, "user_id": 2256235, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/0eNyM.jpg?s=128&g=1", "display_name": "user2256235", "link": "https://stackoverflow.com/users/2256235/user2256235"}, "edited": false, "score": 0, "creation_date": 1525870938, "post_id": 50195388, "comment_id": 87525502, "body": "<a href=\"http://golang-sizeof.tips/?t=Ly8gU2FtcGxlIGNvZGUKc3RydWN0IHsKCXNsMiBbXWludAp9Cg==\" rel=\"nofollow noreferrer\">golang-sizeof.tips/&hellip;</a> the size of slice is 24B and it seems there is no padding. I try to print the last 8B and get empty just like question&#39;s update. So what last 8B is used for?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 275, "user_id": 2256235, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/0eNyM.jpg?s=128&g=1", "display_name": "user2256235", "link": "https://stackoverflow.com/users/2256235/user2256235"}, "edited": false, "score": 0, "creation_date": 1525874254, "post_id": 50195388, "comment_id": 87528011, "body": "@user2256235 there might not be alignment within the same structure (although <a href=\"https://github.com/golang/go/issues/19057\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/19057</a> advocate for a more visible alignment), but there could be still alignments between tow variables allocated on the head."}, {"owner": {"reputation": 275, "user_id": 2256235, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/0eNyM.jpg?s=128&g=1", "display_name": "user2256235", "link": "https://stackoverflow.com/users/2256235/user2256235"}, "edited": false, "score": 0, "creation_date": 1525876461, "post_id": 50195388, "comment_id": 87529586, "body": "Is there any introduction about alignments between variables? I just search on google but did found few related things."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1525568928, "creation_date": 1525568928, "answer_id": 50195388, "question_id": 50192467, "link": "https://stackoverflow.com/questions/50192467/go-slice-address-in-memory/50195388#50195388", "title": "go slice address in memory", "body": "<p>You can validate your assumptions with the project <a href=\"https://github.com/tyranron/golang-sizeof.tips\" rel=\"nofollow noreferrer\"><code>tyranron/golang-sizeof.tips</code></a> and its online page <a href=\"http://golang-sizeof.tips/\" rel=\"nofollow noreferrer\"><strong>golang-sizeof.tips</strong></a></p>\n\n<p><a href=\"http://golang-sizeof.tips/?t=Ly8gU2FtcGxlIGNvZGUKc3RydWN0IHsKCWEgaW50CgliIGludAoJc2wxIFtdaW50CglzbDIgW11pbnQKfQo=\" rel=\"nofollow noreferrer\">Example</a></p>\n\n<p>The size is as expected.<br>\nBut the <a href=\"https://golang.org/pkg/sync/atomic/#pkg-note-BUG\" rel=\"nofollow noreferrer\"><code>atomic</code> package does mention</a>:</p>\n\n<blockquote>\n  <p>The first word in a variable or in an allocated struct, array, or slice can be relied upon to be 64-bit aligned.</p>\n</blockquote>\n\n<p>See <a href=\"http://grokbase.com/t/gg/golang-nuts/157skxmvep/go-nuts-sync-atomic-64-bit-alignment\" rel=\"nofollow noreferrer\">this thread</a>:</p>\n\n<blockquote>\n  <p>The quote is \"The first word in a global variable or in an allocated\n  struct or slice can be relied upon to be 64-bit aligned.\"<br>\n  The key phrase there is \"<strong>allocated</strong>\", not \"struct or slice.\" </p>\n  \n  <p>The first word in a struct or slice that is allocated via new or via a composite literal will be 64-bit aligned.<br>\n  A struct inside a slice or array is not allocated by itself, and no particular alignment is guaranteed beyond that of <code>unsafe.AlignOf</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 275, "user_id": 2256235, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/0eNyM.jpg?s=128&g=1", "display_name": "user2256235", "link": "https://stackoverflow.com/users/2256235/user2256235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1525704657, "creation_date": 1525543011, "last_edit_date": 1525704657, "question_id": 50192467, "link": "https://stackoverflow.com/questions/50192467/go-slice-address-in-memory", "title": "go slice address in memory", "body": "<p>I ran the following code on 64-bits OS and got the result that the difference between each slice's address is 32Byte(<code>0xc42008a060 - 0xc42008a040</code> <code>0xc42008a040 - 0xc42008a020</code>). I guess it should be 24Byte, because the size of slice is 24B and the align is 8. Just like the example of int64.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\nfunc main() {\n    var sl1 []int\n    var sl2 []int\n    var sl3 []int\n    fmt.Printf(\"slice:\\n\")\n    fmt.Printf(\"sl1 addr %p, align %d, size %d\\n\", &amp;sl1, unsafe.Alignof(sl1), unsafe.Sizeof(sl1))\n    fmt.Printf(\"sl1 addr %p, align %d, size %d\\n\", &amp;sl2, unsafe.Alignof(sl2), unsafe.Sizeof(sl2))\n    fmt.Printf(\"sl1 addr %p, align %d, size %d\\n\", &amp;sl3, unsafe.Alignof(sl3), unsafe.Sizeof(sl3))\n\n    var i1 int\n    var i2 int\n    var i3 int\n    fmt.Printf(\"int:\\n\")\n    fmt.Printf(\"i1 addr %p, align %d, size %d\\n\", &amp;i1, unsafe.Alignof(i1), unsafe.Sizeof(i1))\n    fmt.Printf(\"i2 addr %p, align %d, size %d\\n\", &amp;i2, unsafe.Alignof(i2), unsafe.Sizeof(i2))\n    fmt.Printf(\"i3 addr %p, align %d, size %d\\n\", &amp;i3, unsafe.Alignof(i3), unsafe.Sizeof(i3))\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>slice:\nslice:\nsl1 addr 0xc42008a020, align 8, size 24\nsl1 addr 0xc42008a040, align 8, size 24\nsl1 addr 0xc42008a060, align 8, size 24\nint:\ni1 addr 0xc42007c020, align 8, size 8\ni2 addr 0xc42007c028, align 8, size 8\ni3 addr 0xc42007c030, align 8, size 8\n</code></pre>\n\n<p>At first I guess there might be something else occupied the extra 8B, and  then I rerun it many time and the addresses are changed sometime when I modify a few codes, but I always found the difference was 32B or bigger. I just know a little about slice and struct padding and very confused about it. Can anyone help me. Many thanks</p>\n\n<p>-------update another test-----</p>\n\n<p>I print the value via point just like</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n\n    arr := [5]int{1, 2, 3, 4, 5}\n    s1 := arr[0:1]\n    s2 := arr[0:2]\n\n    fmt.Printf(\"arr addr %p\\n\", &amp;arr)\n    fmt.Printf(\"s1 addr %p, align %d, size %d\\n\", &amp;s1, unsafe.Alignof(s1), unsafe.Sizeof(s1))\n    fmt.Printf(\"s2 addr %p, align %d, size %d\\n\", &amp;s2, unsafe.Alignof(s2), unsafe.Sizeof(s2))\n\n    //var spInt *int64 = (*int64)(unsafe.Pointer(sp))\n    fmt.Printf(\"\\ns1:\\n\")\n    sp := &amp;s1\n    fmt.Printf(\"address: %v\\n\",     unsafe.Pointer(uintptr(unsafe.Pointer(sp))))\n    fmt.Println(fmt.Sprintf(\"+ 0(arr): 0x%x\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp))))))\n    fmt.Printf(\"+ 8(len): %d\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(8))))\n    fmt.Printf(\"+16(cap): %d\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(16))))\n    fmt.Printf(\"+24(unknow): %d\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(24))))\n\n    fmt.Printf(\"\\ns2:\\n\")\n    sp = &amp;s2\n    fmt.Printf(\"address: %v\\n\", unsafe.Pointer(uintptr(unsafe.Pointer(sp))))\n    fmt.Println(fmt.Sprintf(\"+ 0(arr): 0x%x\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp))))))\n    fmt.Printf(\"+ 8(len): %d\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(8))))\n    fmt.Printf(\"+16(cap): %d\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(16))))\n    fmt.Printf(\"+24(unknow): %d\\n\\n\", *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(sp)) + uintptr(24))))\n}\n</code></pre>\n\n<p>and I get the result:</p>\n\n<pre><code>arr addr 0xc420018150\ns1 addr 0xc42000a060, align 8, size 24\ns2 addr 0xc42000a080, align 8, size 24\n\ns1:\naddress: 0xc42000a060\n+ 0(arr): 0xc420018150\n+ 8(len): 1\n+16(cap): 5\n+24(unknow): 0\n\ns2:\naddress: 0xc42000a080\n+ 0(arr): 0xc420018150\n+ 8(len): 2\n+16(cap): 5\n+24(unknow): 0\n</code></pre>\n\n<p>The first 8B is the address of data array, the second is the length of slice and the third is capacity of slice. But the last 8B seems to be empty. What the last 8B is used for? For padding?</p>\n"}, {"tags": ["http", "go", "encoding", "uri", "go-templates"], "comments": [{"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "edited": false, "score": 0, "creation_date": 1525546325, "post_id": 50192433, "comment_id": 87402880, "body": "Can you provide the HTML template?"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1525590495, "post_id": 50193096, "comment_id": 87411094, "body": "Note that you can just as easily use <code>w.Write(page)</code>. For differences and more options, see <a href=\"https://stackoverflow.com/questions/37863374/whats-the-difference-between-responsewriter-write-and-io-writestring/37872799#37872799\">What&#39;s the difference between ResponseWriter.Write and io.WriteString?</a>"}], "tags": [], "owner": {"reputation": 51, "user_id": 9746261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a20e8acbf1bb1e01e71113a7492c5fc5?s=128&d=identicon&r=PG&f=1", "display_name": "Elvis", "link": "https://stackoverflow.com/users/9746261/elvis"}, "is_accepted": true, "score": 1, "last_activity_date": 1525547346, "creation_date": 1525547346, "answer_id": 50193096, "question_id": 50192433, "link": "https://stackoverflow.com/questions/50192433/my-string-has-special-characters-and-the-output-of-http-template-adds-missing/50193096#50193096", "title": "My string has special characters and the output of http/template adds &quot;(MISSING)&quot; to it", "body": "<p>@ Moshe Revah\nthanks for the help, in the meantime I found the error</p>\n\n<p>Later in the code I send my generated page to the http client with </p>\n\n<pre><code>fmt.Fprintf(w, page) // Here was the error b/c of the % symbols\n</code></pre>\n\n<p>I just changed it to</p>\n\n<pre><code>fmt.Fprint(w, page)\n</code></pre>\n\n<p>and it works perfect </p>\n"}], "owner": {"reputation": 51, "user_id": 9746261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a20e8acbf1bb1e01e71113a7492c5fc5?s=128&d=identicon&r=PG&f=1", "display_name": "Elvis", "link": "https://stackoverflow.com/users/9746261/elvis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 0, "accepted_answer_id": 50193096, "answer_count": 1, "score": 0, "last_activity_date": 1525602767, "creation_date": 1525542830, "last_edit_date": 1525602767, "question_id": 50192433, "link": "https://stackoverflow.com/questions/50192433/my-string-has-special-characters-and-the-output-of-http-template-adds-missing", "title": "My string has special characters and the output of http/template adds &quot;(MISSING)&quot; to it", "body": "<p>Im trying to build a small website, I use the html/template to create dynamic pages. One thing on the pages is a list of URL's inside those urls sometimes I need character encoding. for special characters like \u00f4 (%C3%B4).</p>\n\n<p>When i try to parse the variables into a page using html/template i get the following as a result: %!c(MISSING)3%!b(MISSING)4. I have no clue what is wrong here</p>\n\n<pre><code>type Search_list struct {\n    Search_name  string\n    Search_url   string\n    Search_price float64\n}\n\nfunc generateSearchPage(language int, q string) (string, error) {\n    /* ommited, fetshing data from elasticsrearch*/\n\n    sl := []Search_list{}\n\n    var urle *url.URL\n\n    //looping through ES results and putting them in a custom List\n    for _, res := range data.Hits.Hits {\n\n        //\n        //Encode Url\n        var err error\n\n        urle, err = url.Parse(res.Source.URL)\n\n        if err != nil {\n            continue\n            // TODO: add log\n        }\n\n        //I've tried already the following:\n        fmt.Println(res.Source.URL)                     //\u00f4\n        fmt.Println(url.QueryUnescape(res.Source.URL))  //\u00f4\n        fmt.Println(urle.String())                      //%C3%B4\n        u, _ := url.QueryUnescape(res.Source.URL)\n\n\n        sl = append(sl, Search_list{res.Source.Name, u, res.Source.Price})\n    }\n\n    var buffer bytes.Buffer\n    t := template.New(\"Index template\")\n    t, err = t.Parse(page_layout[language][PageTypeSearch])\n    if err != nil {\n        panic(err)\n    }\n    err = t.Execute(&amp;buffer, Search_data{\n        Title:        translations[language][\"homepage\"],\n        Page_title:   WebSiteName,\n        Listed_items: sl,\n    })\n\n    if err != nil {\n        panic(err)\n    }\n\n    return buffer.String(), nil  // %!c(MISSING)3%!b(MISSING)4\n}\n</code></pre>\n"}, {"tags": ["go", "wxwidgets", "wxgo"], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1526066811, "post_id": 50275800, "comment_id": 87614713, "body": "Thank you for the detailed response. I&#39;m rebuilding my workstation right now. I&#39;ll test early next week!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 1, "creation_date": 1526312617, "post_id": 50275800, "comment_id": 87684685, "body": "@Chemdream I&#39;m glad. Then you should accept and upvote the answer."}, {"owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1526320209, "post_id": 50275800, "comment_id": 87688589, "body": "Sorry, thought I did."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1525964071, "creation_date": 1525964071, "answer_id": 50275800, "question_id": 50192405, "link": "https://stackoverflow.com/questions/50192405/wxgo-grid-cell-renderer/50275800#50275800", "title": "WxGo Grid Cell renderer", "body": "<p>The error hints you are using a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>, which can be used to create values of struts, slices, arrays, maps or derivatives of these.</p>\n\n<p>This:</p>\n\n<pre><code>wx.SwigIsGridCellBoolRenderer{}\n</code></pre>\n\n<p>Would be an empty composite literal of the type <code>wx.SwigIsGridCellBoolRenderer</code>, but that type is nether of the types you may use with a composite literal. It is an interface type:</p>\n\n<pre><code>type SwigIsGridCellBoolRenderer interface {\n    SwigGetGridCellBoolRenderer() GridCellBoolRenderer\n}\n</code></pre>\n\n<p><code>wx.NewGrid()</code> returns a type of <code>wx.Grid</code> which is an interface with a method:</p>\n\n<pre><code>SetCellEditor(arg2 int, arg3 int, arg4 SwigIsGridCellEditor)\n</code></pre>\n\n<p>So you have to pass a value to it that satisfies / implements the <code>wx.SwigIsGridCellEditor</code> interface.</p>\n\n<p>This interface has a single method:</p>\n\n<pre><code>type SwigIsGridCellEditor interface {\n    SwigGetGridCellEditor() GridCellEditor\n}\n</code></pre>\n\n<p>So any type that has such <code>SwigGetGridCellEditor()</code> method may be used here. Such types are:</p>\n\n<ul>\n<li><code>wx.SwigClassGridCellTextEditor</code></li>\n<li><code>wx.SwigClassGridCellAutoWrapStringEditor</code></li>\n<li><code>wx.SwigClassGridCellBoolEditor</code></li>\n<li><code>wx.SwigClassGridCellChoiceEditor</code></li>\n<li><code>wx.SwigClassGridCellEnumEditor</code></li>\n<li>etc.</li>\n</ul>\n\n<p>So create an instance of one of the above, that you can pass to <code>table.SetCellEditor()</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>editor := wx.NewGridCellTextEditor()\ntable.SetCellEditor(0, 0, editor)\n</code></pre>\n"}], "owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 1, "accepted_answer_id": 50275800, "answer_count": 1, "score": 2, "last_activity_date": 1525964071, "creation_date": 1525542583, "last_edit_date": 1525543068, "question_id": 50192405, "link": "https://stackoverflow.com/questions/50192405/wxgo-grid-cell-renderer", "title": "WxGo Grid Cell renderer", "body": "<p>I'm obviously missing some basic understanding of either Go or Wx Widgets.</p>\n\n<p>I'm trying to create a very basic table with checkboxes in the first column.</p>\n\n<pre><code>table := wx.NewGrid(w, wx.ID_ANY)\ntable.CreateGrid(4, 2)\ntable.SetCellEditor(0, 0, wx.SwigIsGridCellBoolRenderer{})\n</code></pre>\n\n<p>That code gives me this error:</p>\n\n<pre><code>invalid type for composite literal: wx.SwigIsGridCellBoolRenderer\n</code></pre>\n\n<p>I know I also have to set the editor. But I'm not even that far. The more detailed the answer, the better. Thank you!</p>\n"}, {"tags": ["macos", "go", "visual-studio-code", "vscode-settings", "beego"], "comments": [{"owner": {"reputation": 6154, "user_id": 3447502, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5H93.png?s=128&g=1", "display_name": "MatthewG", "link": "https://stackoverflow.com/users/3447502/matthewg"}, "edited": false, "score": 0, "creation_date": 1525541256, "post_id": 50191515, "comment_id": 87401235, "body": "Are you using the vscode-go extension?  You can set the path in ways other than the environment variable, see <a href=\"https://github.com/Microsoft/vscode-go/wiki/GOPATH-in-the-VS-Code-Go-extension\" rel=\"nofollow noreferrer\">github.com/Microsoft/vscode-go/wiki/&hellip;</a>"}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "reply_to_user": {"reputation": 6154, "user_id": 3447502, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5H93.png?s=128&g=1", "display_name": "MatthewG", "link": "https://stackoverflow.com/users/3447502/matthewg"}, "edited": false, "score": 0, "creation_date": 1525574194, "post_id": 50191515, "comment_id": 87408545, "body": "I&#39;ve tried <code>go.gopath</code> also, terminal does not honor that. I do <code>go get</code> and see gopath is set to default."}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "reply_to_user": {"reputation": 6154, "user_id": 3447502, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5H93.png?s=128&g=1", "display_name": "MatthewG", "link": "https://stackoverflow.com/users/3447502/matthewg"}, "edited": false, "score": 0, "creation_date": 1525574265, "post_id": 50191515, "comment_id": 87408562, "body": "Or if I could get to see the built in <code>go install</code> command, which works, I can reverse it to run my command."}], "owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 519, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1552315436, "creation_date": 1525536981, "last_edit_date": 1552315436, "question_id": 50191515, "link": "https://stackoverflow.com/questions/50191515/integrated-terminal-update-environment-variable", "title": "Integrated terminal: update environment variable", "body": "<p>This is my first day using vscode with beego. \nI used IntelliJ otherwise, which has a setting to specify custom paths for GOPATH.</p>\n\n<p>Vscode does not seem to have this option of allowing multiple GOPATHs, and I thought I could try to append <code>GOPATH</code> variable for all integrated terminal sessions.</p>\n\n<p>I've added following to <code>settings.json</code></p>\n\n<pre><code>\"terminal.integrated.env.osx\": {\n    \"GOPATH\": \"/Users/hk/go:/Users/hk/Documents/code/go/go-beego\"\n}\n</code></pre>\n\n<p>However, it has no effect on <code>tasks.json</code></p>\n\n<pre><code>{\n// See https://go.microsoft.com/fwlink/?LinkId=733558\n// for the documentation about the tasks.json format\n\"version\": \"2.0.0\",\n\"tasks\": [\n    {\n        \"label\": \"go: run beego\",\n        \"type\": \"shell\",\n        \"command\": \"echo \\\"gopath is $GOPATH\\\" | bee run portal\"\n    }\n]\n}\n</code></pre>\n\n<p>Output of tasks</p>\n\n<pre><code>gopath is /Users/hk/go\nFATAL    \u25b6 0001 No application 'portal'\nfound in your GOPATH. \nThe terminal process terminated with exit code: 255\n</code></pre>\n\n<p>EDIT: The integrated terminal does not honour the following:\n<code>\"go.gopath\": \"/Users/hk/go:/Users/hk/Documents/code/go/go-beego\",</code></p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "edited": false, "score": 0, "creation_date": 1525538367, "post_id": 50191373, "comment_id": 87400372, "body": "Maybe paste here output from <code>--verbose</code> log as well."}, {"owner": {"reputation": 3697, "user_id": 5484067, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lSbcB.jpg?s=128&g=1", "display_name": "Mohsin Mehmood", "link": "https://stackoverflow.com/users/5484067/mohsin-mehmood"}, "edited": false, "score": 0, "creation_date": 1525539136, "post_id": 50191373, "comment_id": 87400601, "body": "1. run command &quot;docker ps -a&quot; to get a list of all containers 2. From this list get the container id of your exited container 3. Run the command &quot;docker logs -f {container id from step 2} Check if you get any useful troubleshooting information from logs"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1525545186, "post_id": 50191373, "comment_id": 87402536, "body": "It&#39;s better to build the Go binary elsewhere (like CI/CD if you have any) and then copy it into your container, rather than trying to build it in the Dockerfile."}, {"owner": {"reputation": 2728, "user_id": 761035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/326ac920e6a668887ffffd4e7a569a0d?s=128&d=identicon&r=PG", "display_name": "Shiraaz.M", "link": "https://stackoverflow.com/users/761035/shiraaz-m"}, "edited": false, "score": 0, "creation_date": 1525555672, "post_id": 50191373, "comment_id": 87405459, "body": "Stupid question, but why are you using the iron/go version image of golang instead of the official repo <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">hub.docker.com/_/golang</a>"}, {"owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "edited": false, "score": 0, "creation_date": 1525580804, "post_id": 50191373, "comment_id": 87409434, "body": "Any logs? the exit code 0 comes from the main.go check the code maybe different config out of the container. btw use multi stage builds to improve the process"}], "answers": [{"tags": [], "owner": {"reputation": 1030, "user_id": 451904, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/l2Raf.jpg?s=128&g=1", "display_name": "ChrisAdkin", "link": "https://stackoverflow.com/users/451904/chrisadkin"}, "is_accepted": false, "score": 2, "last_activity_date": 1525858573, "creation_date": 1525858573, "answer_id": 50250066, "question_id": 50191373, "link": "https://stackoverflow.com/questions/50191373/golang-program-running-fine-outside-of-docker-but-exiting-with-0-when-dockerize/50250066#50250066", "title": "golang program running fine outside of docker, but exiting with 0 when dockerized", "body": "<p>I finally managed to get to the bottom of this, in my code which worked outside of a container I had:</p>\n\n<pre><code>http.ListenAndServe(\"localhost:8080\", mux)\n</code></pre>\n\n<p>the fix was to simply remove localhost such that I now have:</p>\n\n<pre><code>http.ListenAndServe(\":8080\", mux)\n</code></pre>\n"}], "owner": {"reputation": 1030, "user_id": 451904, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/l2Raf.jpg?s=128&g=1", "display_name": "ChrisAdkin", "link": "https://stackoverflow.com/users/451904/chrisadkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525858573, "creation_date": 1525535926, "last_edit_date": 1525536850, "question_id": 50191373, "link": "https://stackoverflow.com/questions/50191373/golang-program-running-fine-outside-of-docker-but-exiting-with-0-when-dockerize", "title": "golang program running fine outside of docker, but exiting with 0 when dockerized", "body": "<p>I have the following docker-compose.yml file:</p>\n\n<pre><code>version: \"3.3\"\n\nservices:\n  api:\n    build: ./api\n    expose:\n      - '8080'\n    container_name: 'api'\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      - db\n    stdin_open: true\n    tty: true    \n    networks:\n      - api-net\n\n  db:\n    build: ./db\n    expose:\n      - '27017'\n    container_name: 'mongo'\n    ports:\n      - \"27017:27017\"\n    networks:\n      - api-net\n\nnetworks:\n  api-net:\n    driver: bridge\n</code></pre>\n\n<p>and the Dockerfile for the api container is as follows:</p>\n\n<pre><code>FROM iron/go:dev\nRUN mkdir /app\nCOPY src/main/main.go /app/\nENV SRC_DIR=/app\nADD . $SRC_DIR\nRUN go get goji.io\nRUN go get gopkg.in/mgo.v2\n# RUN cd $SRC_DIR; go build -o main\nCMD [\"go\", \"run\", \"/app/main.go\"]\n</code></pre>\n\n<p>If I run the code for main.go outside of a container it runs as expected, however if I try to run the container as part of docker-compose I get an exit 0. I have seen other threads on stackoverflow that have suggested using stdin_open and tty, but these have not helped. I have also tried creating an .env file in the same directory I issue docker-compose up from with <code>COMPOSE_HTTP_TIMEOUT=8000</code> in it and this has not worked either. I am looking for helped and suggestions as to what I need to do in order for my api container to stay up.</p>\n\n<p>I know that <code>--verbose</code> can be issued with docker-compose, however I'm not sure what I should be looking for in the output that this produces.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1525531849, "creation_date": 1525531849, "answer_id": 50190716, "question_id": 50190594, "link": "https://stackoverflow.com/questions/50190594/why-am-i-getting-negative-integer-after-adding-two-positive-16-bit-integers/50190716#50190716", "title": "Why am I getting negative integer after adding two positive 16 bit integers?", "body": "<p>This is the result of <a href=\"https://golang.org/ref/spec#Integer_overflow\" rel=\"noreferrer\">Integer Overflow</a> behaving as defined in the specification.</p>\n\n<p>You don't see your expected results, because</p>\n\n<ol>\n<li>Overflow happens at runtime, not compile time.</li>\n<li>Go is statically typed. </li>\n<li>32,894 is greater than the max value representable by an int16.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 356, "user_id": 1814177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ae1a7180cd2e23e378f26213c6cdc6a?s=128&d=identicon&r=PG", "display_name": "Linefinc", "link": "https://stackoverflow.com/users/1814177/linefinc"}, "is_accepted": false, "score": 4, "last_activity_date": 1525533765, "last_edit_date": 1525533765, "creation_date": 1525532357, "answer_id": 50190800, "question_id": 50190594, "link": "https://stackoverflow.com/questions/50190594/why-am-i-getting-negative-integer-after-adding-two-positive-16-bit-integers/50190800#50190800", "title": "Why am I getting negative integer after adding two positive 16 bit integers?", "body": "<p>It\u2019s very simple.\nThe 16 bit integer maps the positive part I  0 - 32767 (<code>0x0000</code>, <code>0x7FFF</code>) and the negative part from <code>0x8000</code> (\u221232768) to <code>0xFFFF</code> (-1). </p>\n\n<p>For example 0 - 1 = -1 and it\u2019s store as <code>0xFFFF</code>.</p>\n\n<p>Now in your specific case: 32767 + 127.</p>\n\n<p>You overflow because 32767 is the max value for a signed 16 bit integer, but, if you force the addition <code>0x7FFF</code> + <code>7F</code> = <code>807E</code> and convert <code>807E</code> to signed 16 bit integer you obtain -32642.</p>\n\n<p>You can better understand here: <a href=\"https://en.wikipedia.org/wiki/Signed_number_representations\" rel=\"nofollow noreferrer\">Signed number representations</a></p>\n"}, {"tags": [], "owner": {"reputation": 95, "user_id": 1301019, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6d7123605e98385e64c994489c7f2480?s=128&d=identicon&r=PG", "display_name": "Miguel Pragier", "link": "https://stackoverflow.com/users/1301019/miguel-pragier"}, "is_accepted": false, "score": 0, "last_activity_date": 1525535939, "creation_date": 1525535939, "answer_id": 50191374, "question_id": 50190594, "link": "https://stackoverflow.com/questions/50190594/why-am-i-getting-negative-integer-after-adding-two-positive-16-bit-integers/50191374#50191374", "title": "Why am I getting negative integer after adding two positive 16 bit integers?", "body": "<p>Aditionally, check these <a href=\"https://golang.org/pkg/math/#pkg-constants\" rel=\"nofollow noreferrer\">Math Constants</a>:</p>\n\n<pre><code>const (\n    MaxInt8   = 1&lt;&lt;7 - 1\n    MinInt8   = -1 &lt;&lt; 7\n    MaxInt16  = 1&lt;&lt;15 - 1\n    MinInt16  = -1 &lt;&lt; 15\n    MaxInt32  = 1&lt;&lt;31 - 1\n    MinInt32  = -1 &lt;&lt; 31\n    MaxInt64  = 1&lt;&lt;63 - 1\n    MinInt64  = -1 &lt;&lt; 63\n    MaxUint8  = 1&lt;&lt;8 - 1\n    MaxUint16 = 1&lt;&lt;16 - 1\n    MaxUint32 = 1&lt;&lt;32 - 1\n    MaxUint64 = 1&lt;&lt;64 - 1\n)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YQvM7kaizO8\" rel=\"nofollow noreferrer\">And check the human version of these values here</a></p>\n"}], "owner": {"reputation": 1502, "user_id": 2685083, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Afo3M.jpg?s=128&g=1", "display_name": "Sathish", "link": "https://stackoverflow.com/users/2685083/sathish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 50190716, "answer_count": 3, "score": -3, "last_activity_date": 1525602840, "creation_date": 1525531084, "last_edit_date": 1525602840, "question_id": 50190594, "link": "https://stackoverflow.com/questions/50190594/why-am-i-getting-negative-integer-after-adding-two-positive-16-bit-integers", "title": "Why am I getting negative integer after adding two positive 16 bit integers?", "body": "<p>I am a newbie to golang, actually, I am new to type based programming. I have only knowledge of JS.</p>\n\n<p>While going through simple examples in golang tutorials. I found that adding a1 + a2 provides a negative integer value? </p>\n\n<pre><code>var a1 int16 = 127\nvar a2 int16 = 32767\n\nvar rr int16 = a1 + a2\n\nfmt.Println(rr)\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>-32642\n</code></pre>\n\n<p>Excepted: </p>\n\n<ol>\n<li>The compiler will throw an error as a exceeded the int16 max. </li>\n<li>( OR ) GO automatically convert the int16 to int32.</li>\n<li>32,894</li>\n</ol>\n\n<p>Can you guys explain why it is showing -32642.</p>\n"}, {"tags": ["mongodb", "go", "marshalling", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1525527395, "post_id": 50189376, "comment_id": 87396871, "body": "Implement the <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Setter\" rel=\"nofollow noreferrer\">Setter</a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Getter\" rel=\"nofollow noreferrer\">Getter</a> interfaces on the <code>trxStatus</code> type. As an aside, <code>trxStatus</code> is not a <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"nofollow noreferrer\">type alias</a>.  It&#39;s just a type."}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1525529500, "post_id": 50189376, "comment_id": 87397500, "body": "@ThunderCat thanks for the tip. it&#39;s true that it&#39;s a type, forgive an old fashion C programmer:)"}], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525522860, "creation_date": 1525522860, "question_id": 50189376, "link": "https://stackoverflow.com/questions/50189376/marshal-unmarshal-a-type-alias-in-bson", "title": "Marshal/Unmarshal a type alias in bson", "body": "<p>Upon my last <a href=\"https://stackoverflow.com/questions/50187325/marshal-unmarshal-a-type-alias\">question</a>, I want to convert a eunm(type alias) to string when I write it to mongodb with mgo. I know I need add rules for the bson Marshal/Unmarshal, but it's different with json which I need implement <code>UnmarshalJSON</code> and <code>MarshalJSON</code>, so what should I do with bson? The code below write a number to field <code>S</code>, but I want the corresponding string</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n\n    mgo \"gopkg.in/mgo.v2\"\n)\n\ntype trxStatus int\n\ntype test struct {\n    S trxStatus\n    A string\n}\n\nconst (\n    buySubmitted trxStatus = iota\n    buyFilled\n    sellSubmiited\n    sellFilled\n    finished\n)\n\nvar ss = [...]string{\"buySubmitted\", \"buyFilled\", \"sellSubmiited\", \"sellFilled\", \"Finished\"}\n\n// that's what I do for json\nfunc (s *trxStatus) UnmarshalJSON(bytes []byte) error {\n    var status string\n    json.Unmarshal(bytes, &amp;status)\n    // unknown\n    for i, v := range ss {\n        if v == status {\n            tttt := trxStatus(i)\n            *s = tttt\n            break\n        }\n    }\n    return nil\n}\n\nfunc (s trxStatus) MarshalJSON() ([]byte, error) {\n    return json.Marshal(s.String())\n}\n\nfunc (s trxStatus) String() string {\n\n    if s &lt; buySubmitted || s &gt; finished {\n        return \"Unknown\"\n    }\n\n    return ss[s]\n}\n\nfunc main() {\n    db, _ := mgo.Dial(\"localhost\")\n\n    s := test{S: buyFilled, A: \"hello\"}\n    c := db.DB(\"test\").C(\"test\")\n    c.Insert(s)\n}\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525519092, "post_id": 50188780, "comment_id": 87394403, "body": "custom unmarshaler is your only option i believe <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshaler</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525520671, "post_id": 50188780, "comment_id": 87394885, "body": "implement unmarshaler interface for custom unmarshal"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1525521441, "creation_date": 1525521441, "answer_id": 50189167, "question_id": 50188780, "link": "https://stackoverflow.com/questions/50188780/unmarshalling-a-single-element-in-an-array/50189167#50189167", "title": "Unmarshalling a single element in an array", "body": "<p>Implement unmarshaler interface to convert array of object to object. Fetch the value for key and then unmarshal your json as</p>\n\n<pre><code>package main\n\nimport(\n  \"fmt\"\n  \"encoding/json\"\n)\n\ntype Object struct {\n  Key string `json:\"key\"`\n}\n\nfunc (obj *Object) UnmarshalJSON(data []byte) error {\n  var v map[string]interface{}\n  if err := json.Unmarshal(data, &amp;v); err != nil {\n      fmt.Printf(\"Error whilde decoding %v\\n\", err)\n      return err\n  }\n  obj.Key =  v[\"results\"].(interface{}).([]interface{})[0].(interface{}).(map[string]interface{})[\"key\"].(interface{}).(string)\n  return nil\n}\n\n\nfunc main(){\n  var obj Object\n  data := []byte(`{\n    \"results\": [\n      {\n          \"key\": \"value\"\n      }\n    ]\n  }`)\n  if err := json.Unmarshal(data, &amp;obj); err!=nil{\n    fmt.Println(err)\n  }\n  fmt.Printf(\"%#v\", obj) \n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qTzl6rTr4Ko\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": true, "score": 2, "last_activity_date": 1525521773, "creation_date": 1525521773, "answer_id": 50189213, "question_id": 50188780, "link": "https://stackoverflow.com/questions/50188780/unmarshalling-a-single-element-in-an-array/50189213#50189213", "title": "Unmarshalling a single element in an array", "body": "<p>To does this you need to customize unmarshalling.\nAn way is create a ResponseCustom like:</p>\n\n<pre><code>//Response json (customized) that match with Unmarshaler interface\ntype ResponseCustom struct {\n    Object\n}\n\nfunc (r *ResponseCustom) UnmarshalJSON(b []byte) error{\n    rsp := &amp;Response{}\n    err := json.Unmarshal(b, rsp)\n    if err != nil {\n        log.Fatalln(\"error:\", err)\n    } else {\n        r.Object = rsp.Objects[0]\n    }\n    //\n    return err\n}\n</code></pre>\n\n<p>So you can use ResponseCustom instead of you Response for get Object value.\nLook:</p>\n\n<pre><code>func main() {\n    //\n    data := []byte(jsondata)\n    resp := &amp;ResponseCustom{}\n    //\n    json.Unmarshal(data, resp)\n    //\n    fmt.Println(\"My Object.value is: \" + resp.Object.Key)\n}\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>    My Object.value is: value\n</code></pre>\n\n<p>In playground: <a href=\"https://play.golang.org/p/zo7wOSacA4w\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zo7wOSacA4w</a></p>\n"}], "owner": {"reputation": 204, "user_id": 6542409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce631663759114e4920a2e1886a6ad9d?s=128&d=identicon&r=PG", "display_name": "sbaildon", "link": "https://stackoverflow.com/users/6542409/sbaildon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "accepted_answer_id": 50189213, "answer_count": 2, "score": -1, "last_activity_date": 1525521773, "creation_date": 1525518791, "question_id": 50188780, "link": "https://stackoverflow.com/questions/50188780/unmarshalling-a-single-element-in-an-array", "title": "Unmarshalling a single element in an array", "body": "<p>Is there a way to unmarshall JSON arrays into single objects in Go?</p>\n\n<p>I have a json response from an endpoint:</p>\n\n<pre><code>{\n  \"results\": [\n    {\n        \"key\": \"value\"\n    }\n  ]\n}\n</code></pre>\n\n<p>I have a Go struct for the object inside the array:</p>\n\n<pre><code>type Object struct {\n    Key string `json:\"key\"`\n}\n</code></pre>\n\n<p>...and a struct for the response object:</p>\n\n<pre><code>type Response struct {\n    Objects []Object `json:\"results\"`\n}\n</code></pre>\n\n<p><code>results</code> is an array of objects, but I know that the endpoint will only ever return an array with 1 object. Is there a way to unmarshall the data and avoid having reference the object by an index? I was hoping I could use something like <code>json:\"results[0]\"</code> as a field tag.</p>\n\n<p>I'd prefer to be able to:</p>\n\n<pre><code>decoder.Decode(&amp;response)\nresponse.Object.Key\n</code></pre>\n\n<p>Rather than</p>\n\n<pre><code>decoder.Decode(&amp;response)\nresponse.Objects[0].Key\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubectl"], "answers": [{"comments": [{"owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "edited": false, "score": 0, "creation_date": 1525768749, "post_id": 50192389, "comment_id": 87475915, "body": "Thanks, will use kube-applier, also submitted feature request for webhook support: <a href=\"https://github.com/box/kube-applier/issues/29\" rel=\"nofollow noreferrer\">github.com/box/kube-applier/issues/29</a>"}], "tags": [], "owner": {"reputation": 22353, "user_id": 225016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77d3c3ab5ddcf93a8ca1bfe1b481be1c?s=128&d=identicon&r=PG", "display_name": "mdaniel", "link": "https://stackoverflow.com/users/225016/mdaniel"}, "is_accepted": true, "score": 2, "last_activity_date": 1525542484, "creation_date": 1525542484, "answer_id": 50192389, "question_id": 50188746, "link": "https://stackoverflow.com/questions/50188746/apply-configuration-yaml-file-via-api-or-sdk/50192389#50192389", "title": "Apply configuration yaml file via API or SDK", "body": "<p>As yaml directly: no, not that I'm aware of. But if you increase the <code>kubectl</code> verbosity (<code>--v=100</code> or such), you'll see that the first thing <code>kubectl</code> does to your yaml file is convert it to json, and then <code>POST</code> <em>that</em> content to the API. So the spirit of the answer to your question is \"yes.\"</p>\n\n<p>This <a href=\"https://github.com/box/kube-applier#readme\" rel=\"nofollow noreferrer\">box/kube-applier</a> project may interest you. While it does not appear to be webhook aware, I am sure they would welcome a PR teaching it to do that. Using their existing project also means you benefit from all the bugs they have already squashed, as well as their nifty prometheus metrics integration.</p>\n"}], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 0, "accepted_answer_id": 50192389, "answer_count": 1, "score": 1, "last_activity_date": 1525542484, "creation_date": 1525518521, "question_id": 50188746, "link": "https://stackoverflow.com/questions/50188746/apply-configuration-yaml-file-via-api-or-sdk", "title": "Apply configuration yaml file via API or SDK", "body": "<p>I started a pod in kubernetes cluster which can call kubernetes api via go-sdk (like in this example: <a href=\"https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration</a>). I want to listen some external events in this pod (e.g. GitHub web-hooks), fetch <code>yaml</code> configuration files from repository and apply them to this cluster.</p>\n\n<p>Is it possible to call <code>kubectl apply -f &lt;config-file&gt;</code> via kubernetes API (or better via golang SDK)?</p>\n"}, {"tags": ["sockets", "go", "nonblocking", "channel", "goroutine"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525514369, "post_id": 50187876, "comment_id": 87392954, "body": "You want to return a connection to the pool as soon as there&#39;s no immediate read possible? That&#39;s very unusual, especially for TCP. What kind of connection is that, where you don&#39;t expect any network delays?"}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525514685, "post_id": 50187876, "comment_id": 87393045, "body": "@Peter To be specific this is a redis connection. I subscribe for multiple channels on the same connection. I manually keep track of the channels subscribed on the redis connection. If the subscription count becomes 0, then i want to return the connection to the connection pool."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525515694, "post_id": 50187876, "comment_id": 87393375, "body": "Hi! You could say, please: 1) why infinite loop without stop condition, known you that exists EAGAN? if is using connection pool why don&#39;t is getting of pool instead of conn direct in goroutine?"}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525516081, "post_id": 50187876, "comment_id": 87393510, "body": "@AristofanioGarcia 1) Yeah my bad ! I should have put return conditions in the for loop 2) I am just omitting extra details."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525516315, "post_id": 50187876, "comment_id": 87393572, "body": "I need of more details for help you! But first, you need of EAGAN-based stop condition for exit of goroutine without to close connection. After, if this connection backs to pool, the best way is pass pool to goroutine and to check connection."}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525516744, "post_id": 50187876, "comment_id": 87393710, "body": "@AristofanioGarcia For the <code>EAGAIN</code> based condition, I need to use the lower level <code>syscall.Read</code> and it won&#39;t be scalable to have so many for loops reading using <code>syscall.Read</code> if I do it without a polling mechanism like <code>epoll</code> with a level-triggered approach which I want to avoid here."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525517549, "post_id": 50187876, "comment_id": 87393939, "body": "Oh! I understood what you want to avoid! But in this limited context I dont known as help you! Sorry!"}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525517829, "post_id": 50187876, "comment_id": 87394017, "body": "@AristofanioGarcia thanks, not a problem."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1525518424, "post_id": 50187876, "comment_id": 87394214, "body": "Have you seen this: <a href=\"https://github.com/golang/go/issues/15735\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/15735</a>?"}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "edited": false, "score": 0, "creation_date": 1525527584, "post_id": 50187876, "comment_id": 87396920, "body": "Yes I have gone through it, the epoll approach is described over there which I want to avoid."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1525589278, "post_id": 50187876, "comment_id": 87410845, "body": "@dartrix, that sounds like you can get away with an appropriate ReadDeadline. Every time that deadline is reached, just check if anyone is still subscribed on that connection."}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525595402, "post_id": 50187876, "comment_id": 87412246, "body": "@Peter Thanks for the suggestion let me try it, so I have to use <code>ReadFrom</code> instead of <code>Read</code>."}, {"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525624135, "post_id": 50187876, "comment_id": 87420597, "body": "@Peter Thanks the approach worked !"}], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "edited": false, "score": 0, "creation_date": 1525565800, "post_id": 50193023, "comment_id": 87407278, "body": "Thanks a lot for the answer, yeah this won&#39;t do any good in my case as when I reuse the connection, the data will be read in some other buffer which i can&#39;t access, for eg. <code>data</code> here."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "edited": false, "score": 0, "creation_date": 1525641784, "post_id": 50193023, "comment_id": 87426297, "body": "@darxtrix Why not stash the connection back to the pool together with it&#39;s data &amp; readErr channels? This way you can check for the <code>Read</code> result once you get the connection back from the pool, and not miss anything."}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 1, "last_activity_date": 1525548416, "last_edit_date": 1525548416, "creation_date": 1525546699, "answer_id": 50193023, "question_id": 50187876, "link": "https://stackoverflow.com/questions/50187876/close-the-goroutine-reading-from-a-tcp-connection-without-closing-connection/50193023#50193023", "title": "Close the goroutine reading from a TCP connection without closing connection", "body": "<pre><code>func receive(conn net.TCPConn, kill &lt;-chan struct{}) error {\n    // Spawn a goroutine to read from the connection.\n    data := make(chan []byte)\n    readErr := make(chan error)\n    go func() {\n        for {\n            b := make([]byte, 255)\n            _, err := conn.Read(b)\n            if err != nil {\n                readErr &lt;- err\n                break\n            }\n            data &lt;- b\n        }\n    }()\n\n\n    for {\n        select {\n        case b := &lt;-data:\n            // Do something with `b`.\n        case err := &lt;-readErr:\n            // Handle the error.\n            return err\n        case &lt;-kill:\n            // Received kill signal, returning without closing the connection.\n            return nil\n        }\n    }\n}\n</code></pre>\n\n<p>Send an empty struct to <code>kill</code> from another goroutine to stop receiving from the connection. Here's a program that stops receiving after a second:</p>\n\n<pre><code>kill := make(chan struct{})\ngo func() {\n    if err := receive(conn, kill); err != nil {\n        log.Fatal(err)\n    }\n}()\ntime.Sleep(time.Second)\nkill &lt;- struct{}{}\n</code></pre>\n\n<p>This might not be exactly what you're looking for, because the reading goroutine would still be blocked on <code>Read</code> even after you send to <code>kill</code>. However, the goroutine that handles incoming reads would terminate.</p>\n"}], "owner": {"reputation": 1756, "user_id": 2679770, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cJ5uH.jpg?s=128&g=1", "display_name": "darxtrix", "link": "https://stackoverflow.com/users/2679770/darxtrix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1394, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1525548416, "creation_date": 1525512630, "last_edit_date": 1525516108, "question_id": 50187876, "link": "https://stackoverflow.com/questions/50187876/close-the-goroutine-reading-from-a-tcp-connection-without-closing-connection", "title": "Close the goroutine reading from a TCP connection without closing connection", "body": "<p>I love the way Go handles I/O multiplexing internally which <code>epoll</code> and another mechanisms and schedules green threads (go-routine here) on its own giving the freedom to write synchronous code. </p>\n\n<p>I know TCP sockets are <code>non-blocking</code> and <code>read</code> will give <code>EAGAIN</code> when no data is available. Given that, <code>conn.Read(buffer)</code> will detect this and <strong>blocks the go routine doing a connection read with no data available in the socket buffer</strong>. Is there a way to stop such go routine without closing the underlying connection. I am using a connection pool so closing the TCP connection won't make sense for me and want to return that connection back to the pool.</p>\n\n<p>Here is the code to simulate such scenario:</p>\n\n<pre><code>func main() {\n    conn, _ := net.Dial(\"tcp\", \"127.0.0.1:9090\")\n    // Spawning a go routine\n    go func(conn net.Conn) {\n        var message bytes.Buffer\n        for {\n            k := make([]byte, 255) // buffer\n            m, err := conn.Read(k) // blocks here \n            if err != nil {\n                if err != io.EOF {\n                    fmt.Println(\"Read error : \", err)\n                } else {\n                    fmt.Println(\"End of the file\")\n                }\n                break // terminate loop if error\n            }\n            // converting bytes to string for printing\n            if m &gt; 0 {\n                for _, b := range k {\n                    message.WriteByte(b)\n                }\n                fmt.Println(message.String())\n            }\n\n        }\n    }(conn)\n\n    // prevent main from exiting\n    select {}\n}\n</code></pre>\n\n<p>What are the other approaches can I take if it's not possible:</p>\n\n<p>1) Call <code>syscall.Read</code> and handle this manually. In this case, I need a way to check if the socket is <strong>readable</strong> before calling <code>syscall.Read</code>otherwise I will end up wasting unnecessary CPU cycles. For my scenario, I think I can skip the event based polling thing and keep on calling <code>syscall.Read</code> as there always be data in my use case.</p>\n\n<p>2) Any suggestions :)</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525509650, "post_id": 50187325, "comment_id": 87391514, "body": "1. check error of json.Marshal, 2. export test&#39;s Field, else marshaling won&#39;t work. 3. Your MarshalJSON does not return json strings, i.e. missing quotes. 4. <a href=\"https://play.golang.org/p/ROjER5DhsjI\" rel=\"nofollow noreferrer\">woking example</a>"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525510008, "post_id": 50187325, "comment_id": 87391613, "body": "@mkopriva Thanks for the tip, see my edit."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525510045, "post_id": 50187325, "comment_id": 87391628, "body": "it&#39;s the missing quotes mentioned in the updated comment."}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525510233, "post_id": 50187325, "comment_id": 87391686, "body": "I&#39;ve add the the quotes, but the Unmarshal doesn&#39;t work"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525510398, "post_id": 50187325, "comment_id": 87391734, "body": "You&#39;re right the quotes need to be handled in both cases, Unmarshal as well. The <code>bytes</code> value is <code>&quot;buyFilled&quot;</code> not <code>buyFilled</code> matching simply against <code>v</code> will return false. updated example <a href=\"https://play.golang.org/p/KOZ37cgaYbj\" rel=\"nofollow noreferrer\">play.golang.org/p/KOZ37cgaYbj</a> (an ugly way of handling the quotes i must say, you can do better than me if you put some thougth in it)"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525510560, "post_id": 50187325, "comment_id": 87391789, "body": "@mkopriva got it! Thanks. You should write it as an answer and I&#39;ll accept it gladly!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1525512931, "post_id": 50187325, "comment_id": 87392502, "body": "Note that building JSON strings manually is risky in general because escaping is tricky. A more robust implementation of MarshalJSON would <code>return json.Marshal(s.String())</code>."}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "edited": false, "score": 0, "creation_date": 1525513752, "post_id": 50187325, "comment_id": 87392755, "body": "Indeed. I&#39;ll let <code>json.Marshal</code> and <code>json.Unmarshal</code> do the tricky work."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1525510874, "creation_date": 1525510874, "answer_id": 50187635, "question_id": 50187325, "link": "https://stackoverflow.com/questions/50187325/marshal-unmarshal-int-type/50187635#50187635", "title": "Marshal/Unmarshal int type", "body": "<p>When writing your custom Marshaler and Unmarshaler implementations make sure to include or trim the surrounding double quotes of json strings.</p>\n\n<pre><code>func (s *trxStatus) UnmarshalJSON(bytes []byte) error {\n    status := string(bytes)\n    if n := len(status); n &gt; 1 &amp;&amp; status[0] == '\"' &amp;&amp; status[n-1] == '\"' {\n        status = status[1:n-1] // trim surrounding quotes\n    }\n    // unknown\n    for i, v := range ss {\n        if v == status {\n            tttt := trxStatus(i)\n            *s = tttt\n            break\n        }\n    }\n    return nil\n}\n\nfunc (s trxStatus) MarshalJSON() ([]byte, error) {\n    return []byte(`\"` + s.String() + `\"`), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 0, "accepted_answer_id": 50187635, "answer_count": 1, "score": 0, "last_activity_date": 1525726582, "creation_date": 1525508540, "last_edit_date": 1525726582, "question_id": 50187325, "link": "https://stackoverflow.com/questions/50187325/marshal-unmarshal-int-type", "title": "Marshal/Unmarshal int type", "body": "<p>I use an <code>int</code> type to represent an enum.  I want to convert it to string when I marshal it to JSON, AFAIK, I should implement <code>UnmarshalJSON</code> and <code>MarshalJSON</code>, but it complains: </p>\n\n<blockquote>\n  <p>marshal error: json: error calling MarshalJSON for type\n  main.trxStatus: invalid character 'b' looking for beginning of\n  valueunexpected end of JSON input</p>\n</blockquote>\n\n<p>when marshalling. Then I've add the quotes to the marshalled string:</p>\n\n<pre><code>func (s trxStatus) MarshalJSON() ([]byte, error) {\n    return []byte(\"\\\"\" + s.String() + \"\\\"\"), nil\n}\n</code></pre>\n\n<p>the <code>Marshal</code> works now but it can't <code>Unmarshal</code> from the marshalled byte stream correctly.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype trxStatus int\n\ntype test struct {\n    S trxStatus\n    A string\n}\n\nconst (\n    buySubmitted trxStatus = iota\n    buyFilled\n    sellSubmiited\n    sellFilled\n    finished\n)\n\nvar ss = [...]string{\"buySubmitted\", \"buyFilled\", \"sellSubmiited\", \"sellFilled\", \"Finished\"}\n\nfunc (s *trxStatus) UnmarshalJSON(bytes []byte) error {\n    status := string(bytes)\n    // unknown\n    for i, v := range ss {\n        if v == status {\n            tttt := trxStatus(i)\n            *s = tttt\n            break\n        }\n    }\n    return nil\n}\n\nfunc (s trxStatus) MarshalJSON() ([]byte, error) {\n    return []byte(s.String()), nil\n}\n\nfunc (s trxStatus) String() string {\n\n    if s &lt; buySubmitted || s &gt; finished {\n        return \"Unknown\"\n    }\n\n    return ss[s]\n}\n\nfunc main() {\n    s := test{S: buyFilled, A: \"hello\"}\n    j, err := json.Marshal(s)\n    if err != nil {\n        fmt.Printf(\"marshal error: %v\", err)\n    }\n    var tt test\n    fmt.Println(json.Unmarshal(j, &amp;tt))\n    fmt.Println(tt)\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "sqlx"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1525507354, "post_id": 50187083, "comment_id": 87390938, "body": "run the query in prepare directly in pgadmin. Check how many rows it returns or it returns a single row. Because Get is used to select single record."}], "answers": [{"comments": [{"owner": {"reputation": 3799, "user_id": 1092133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4763af25f1f5ab27a6420c794344905c?s=128&d=identicon&r=PG&f=1", "display_name": "Bajal", "link": "https://stackoverflow.com/users/1092133/bajal"}, "edited": false, "score": 0, "creation_date": 1611952598, "post_id": 50187183, "comment_id": 116624742, "body": "It worked for us, but we used <code>:</code> instead of <code>$</code>"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1525770417, "last_edit_date": 1525770417, "creation_date": 1525507554, "answer_id": 50187183, "question_id": 50187083, "link": "https://stackoverflow.com/questions/50187083/sqlx-get-with-prepared-statements/50187183#50187183", "title": "Sqlx Get with prepared statements", "body": "<p>Documentation for sqlx described <a href=\"http://jmoiron.github.io/sqlx/\" rel=\"nofollow noreferrer\">Get and Select</a> as:</p>\n\n<blockquote>\n  <p><code>Get</code> and <code>Select</code> use rows.Scan on scannable types and rows.StructScan on\n  non-scannable types. They are roughly analagous to QueryRow and Query,\n  where Get is useful for fetching a single result and scanning it, and\n  Select is useful for fetching a slice of results:</p>\n</blockquote>\n\n<p>For fetching a single record use <code>Get</code>.</p>\n\n<pre><code>stmt, err := database.Preparex(`SELECT * FROM accounts where identificator = $1 and type = $2`)\nvar account Account\nerr = stmt.Get(&amp;account, \"asd\", 123)\n</code></pre>\n\n<p>If your query returns more than a single record use <code>Select</code> with statement as:</p>\n\n<pre><code>stmt, err := database.Preparex(`SELECT * FROM accounts where identificator = $1 and type = $2`)\nvar accounts []Account\nerr = stmt.Select(&amp;accounts, \"asd\", 123)\n</code></pre>\n\n<p>In your case if you use <code>stmt.Select</code> instead if <code>stmt.Get</code>. It will work.</p>\n"}], "owner": {"reputation": 101, "user_id": 7473136, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7e0c6a6a7a8149c86db1cac1d2f0683b?s=128&d=identicon&r=PG", "display_name": "user93466", "link": "https://stackoverflow.com/users/7473136/user93466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2698, "favorite_count": 0, "accepted_answer_id": 50187183, "answer_count": 1, "score": 1, "last_activity_date": 1525770417, "creation_date": 1525506776, "last_edit_date": 1525511037, "question_id": 50187083, "link": "https://stackoverflow.com/questions/50187083/sqlx-get-with-prepared-statements", "title": "Sqlx Get with prepared statements", "body": "<p>I am trying to fetch some data from postgress table using prepared statements</p>\n\n<p>If I try with database.Get() everything is returned.</p>\n\n<p>Table:</p>\n\n<pre><code>create table accounts\n(\n  id            bigserial not null\n    constraint accounts_pkey\n    primary key,\n  identificator text      not null,\n  password      text      not null,\n  salt          text      not null,\n  type          smallint  not null,\n  level         smallint  not null,\n  created_at    timestamp not null,\n  updated       timestamp not null,\n  expiry_date   timestamp,\n  qr_key        text\n);\n</code></pre>\n\n<p>Account struct:</p>\n\n<pre><code>type Account struct {\n    ID            string `db:\"id\"`\n    Identificator string `db:\"identificator\"`\n\n    Password   string         `db:\"password\"`\n    Salt       string         `db:\"salt\"`\n    Type       int            `db:\"type\"`\n    Level      int            `db:\"level\"`\n    ExpiryDate time.Time      `db:\"expiry_date\"`\n    CreatedAt  time.Time      `db:\"created_at\"`\n    UpdateAt   time.Time      `db:\"updated_at\"`\n    QrKey      sql.NullString `db:\"qr_key\"`\n}\n</code></pre>\n\n<p>BTW i tried using ? instead of $1 &amp; $2</p>\n\n<pre><code>stmt, err := database.Preparex(`SELECT * FROM accounts where identificator = $1 and type = $2`)\n\nif err != nil {\n    panic(err)\n}\naccounts := []account.Account{}\nerr = stmt.Get(&amp;accounts, \"asd\", 123)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>The error I get is</p>\n\n<blockquote>\n  <p>\"errorMessage\": \"scannable dest type slice with \\u003e1 columns (10) in result\",</p>\n</blockquote>\n\n<p>In the table there are no records I tried to remove all fields except the ID from Account (struct), however it does not work.</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine", "locks"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1525505096, "post_id": 50186225, "comment_id": 87390394, "body": "Do not use sync.Mutex but a pointer to it. Copying a sync.Mutex is forbidden."}, {"owner": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1525516034, "post_id": 50186225, "comment_id": 87393496, "body": "but isn&#39;t slice already PASS by reference?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1525551637, "post_id": 50186225, "comment_id": 87404485, "body": "Go has no &quot;pass by reference&quot; (for whatever that is). In your case: It just is too dangerous. Do as everybody else."}, {"owner": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1525580456, "post_id": 50186225, "comment_id": 87409382, "body": "So u are saying Example 1 is better?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1525663747, "post_id": 50186225, "comment_id": 87430448, "body": "No. I say the locks_block should contain a <code>*sync.Mutex</code>."}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 5129446, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F9GFT.jpg?s=128&g=1", "display_name": "aerth", "link": "https://stackoverflow.com/users/5129446/aerth"}, "is_accepted": true, "score": 1, "last_activity_date": 1529924041, "last_edit_date": 1529924041, "creation_date": 1525501338, "answer_id": 50186395, "question_id": 50186225, "link": "https://stackoverflow.com/questions/50186225/go-locks-in-a-slice-of-struct/50186395#50186395", "title": "Go Locks in a slice of struct", "body": "<p>It appears you are using the lock correctly, but are not waiting for the goroutines to \"finish\" before printing <code>arr</code>. Try adding a small <code>&lt;-time.After(time.Second)</code>, or using WaitGroup, or using <code>select</code> to wait for all goroutines to finish, or placing the <code>fmt.Println(ar[i].population)</code> inside the goroutines to see the results you want to see!</p>\n\n<p>Same thing happens if you just start a bunch of goroutines without waiting for them to finish.</p>\n\n<p>Here is a complete working example, with an extra 'id' for each goroutine, for clarity. Notice that the ordering of goroutines is not consistent!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\ntype locks_block struct {\n    population int\n    mux        sync.Mutex\n}\n\nfunc incr(id int, ar []locks_block) {\n    for i := 0; i &lt; len(ar); i++ {\n        ar[i].mux.Lock()\n        ar[i].population = ar[i].population + 1\n        fmt.Printf(\"goroutine #%v, population   %v\\n\", id, ar[i].population)\n        ar[i].mux.Unlock()\n    }\n}\n\nfunc main() {\n    arr := make([]locks_block, 5)\n    go incr(1, arr)\n    go incr(2, arr)\n    go incr(3, arr)\n    go incr(4, arr)\n\n    // this should give the goroutines enough time\n    &lt;-time.After(time.Millisecond * 500)\n    fmt.Println(arr)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8612814, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xWA2YJfpD0Q/AAAAAAAAAAI/AAAAAAAAADQ/Q6DHwC6C2yo/photo.jpg?sz=128", "display_name": "drainzerrr", "link": "https://stackoverflow.com/users/8612814/drainzerrr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1333, "favorite_count": 3, "accepted_answer_id": 50186395, "answer_count": 1, "score": 0, "last_activity_date": 1529924041, "creation_date": 1525499798, "last_edit_date": 1525500801, "question_id": 50186225, "link": "https://stackoverflow.com/questions/50186225/go-locks-in-a-slice-of-struct", "title": "Go Locks in a slice of struct", "body": "<p>I am new to GO. I am specifically trying to add values to an array in parallel using locks (i  do not want to use channels). But somehow my answer is not correct. I have tried both approaches. Passing a pointer to slice and Passing the slice itself. I am not looking for a global lock variable.</p>\n\n<p>Method 1 (Passing pointer)</p>\n\n<pre><code>type locks_block struct {\n    population int\n    mux sync.Mutex\n}\n\nfunc incr(ar *[] locks_block){\n\n    for i:=0;i&lt;len(*ar);i++ {\n\n        (*ar)[i].mux.Lock()\n        (*ar)[i].population = (*ar)[i].population+1;\n        (*ar)[i].mux.Unlock()\n\n    }\n}\n\nfunc main() {\n\n    arr := make([]locks_block,5);\n\n    go incr(&amp;arr);\n    go incr(&amp;arr);\n    go incr(&amp;arr);\n    go incr(&amp;arr);\n\n\n    fmt.Println(arr);\n}\n</code></pre>\n\n<p>Method 2 (Passing slice)</p>\n\n<pre><code>type locks_block struct {\n    population int\n    mux sync.Mutex\n}\n\nfunc incr(ar [] locks_block){\n\n    for i:=0;i&lt;len(ar);i++ {\n\n        ar[i].mux.Lock()\n        ar[i].population = ar[i].population+1;\n        ar[i].mux.Unlock()\n\n    }\n}\n\nfunc main() {\n\n    arr := make([]locks_block,5);\n\n    go incr(arr);\n    go incr(arr);\n    go incr(arr);\n    go incr(arr);\n\n\n    fmt.Println(arr);\n}\n</code></pre>\n\n<p>The output is not correct in either case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1525504985, "post_id": 50186147, "comment_id": 87390375, "body": "How do you measure that your code is leaking memory? Most probably your measurements will be wrong."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1525513323, "post_id": 50186147, "comment_id": 87392624, "body": "You are aware that you are trying to slurp all the files into memory concurrently? I&#39;m not surprised this consumes huge amounts of memory (and it&#39;s not a leak). Also, it seems you are re-inventing <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">filepath.Walk</a>."}, {"owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "edited": false, "score": 0, "creation_date": 1525525742, "post_id": 50186147, "comment_id": 87396362, "body": "I am aware that I am sleeping entire files into memory, but I thought that I would only be sleeping 100 files at a time due to the buffer on grepFilesChan. Then I expected the memory to be freed after the respective go routine finishes. And I was reinventing filepath.Walk because I wanted to filter out directories with certain names from being walked and didn&#39;t see that functionality in filepath.Walk."}, {"owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "edited": false, "score": 0, "creation_date": 1525526115, "post_id": 50186147, "comment_id": 87396490, "body": "I am measuring by watching top as my program runs. The memory in use constantly grows and never goes down until the program consumes all memory and crashes. Open to other suggestions to actually pinpoint the problem, but that&#39;s not the behavior that I would expect from this program. I&#39;m guessing that the program is not ever GC the byte slices from reading the full files in the go routine that calls grepOverChan. I just can&#39;t confirm that and don&#39;t know what I&#39;m doing wrong to cause that to happen."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525530971, "post_id": 50186147, "comment_id": 87397951, "body": "There is no memory leak here. You&#39;re trying concurrently process files with no limit. You attempt to read every single file concurrently, in its entirety, then send those huge blobs to a regex. Once you have any backlog, everything is going to get slower and the issue compounds itself. You need to limit concurrency, and don&#39;t read the entire contents of every file at once."}, {"owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "edited": false, "score": 0, "creation_date": 1525537476, "post_id": 50186147, "comment_id": 87400090, "body": "Thanks JimB. For limiting the concurrency, would you suggest the semaphore channel approach in <a href=\"http://jmoiron.net/blog/limiting-concurrency-in-go/\" rel=\"nofollow noreferrer\">jmoiron.net/blog/limiting-concurrency-in-go</a>? It seems easy enough to add to my program around the grep goroutine. What is another way to read and grep the files without reading the entire contents (keeping in mind that in the real program vs this simple example, I need to grep both text and binary files)?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525700523, "post_id": 50186147, "comment_id": 87448056, "body": "@Kris: yes a semaphore is as easy way to limit concurrency. Scanning by lines is simple, but there is no easy way to make a function to &quot;grep&quot; large binary files -- you always have to check if there might be a match between buffered chunks. Think carefully if that is something you actually want to do, since it&#39;s really of limited usefulness."}, {"owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525706250, "post_id": 50186147, "comment_id": 87451842, "body": "@JimB: Thanks again. I implemented the semaphore limiting channel this morning and this allowed my process to complete against the large file structure that it needs to run against. The memory use is still high because it still loads in the whole files, but it does grow to a certain point and then tops out (once it hits the limit). I made the limit configurable with a runtime flag. I will include my new code as an answer to this question in case anyone else runs across it in the future."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "is_accepted": true, "score": 0, "last_activity_date": 1525706720, "creation_date": 1525706720, "answer_id": 50217635, "question_id": 50186147, "link": "https://stackoverflow.com/questions/50186147/golang-program-leaking-memory/50217635#50217635", "title": "Golang Program leaking memory", "body": "<p>Based on the comments by @JimB to my question, I was able to figure out that this was not a memory leak per say, but a problem of unlimited concurrency. My original code was kicking off a grep for every file as it was encountered without limit.</p>\n\n<p>I was able to resolve this problem by limiting the number of files opened to grep at any one time. Using the example provided by <a href=\"http://jmoiron.net/blog/limiting-concurrency-in-go/\" rel=\"nofollow noreferrer\">http://jmoiron.net/blog/limiting-concurrency-in-go/</a>. In this link, they create a semaphoreChannel that will only accept the limit number of messages. Write a value to this channel before opening a file, and read a value from this channel after finished searching the file. At the end wait for the semaphoreChannel to fill up again.</p>\n\n<p>Here is the working code that corresponds to my broken original code (see <code>grepConcurrencyLimit</code> and <code>semaphoreChan</code> for the relevant portions):</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"regexp\"\n    \"runtime/pprof\"\n    \"strings\"\n    \"sync\"\n)\n\nvar (\n    topDir               string\n    cProf                bool\n    mProf                bool\n    cProfFile            *os.File\n    mProfFile            *os.File\n    fileNames            []string\n    fileTypes            []string\n    fileLists            map[string][]string\n    grepConcurrencyLimit int\n    cMatch               = regexp.MustCompile(`(?i)^.*\\.(?:c|h|cc|cpp|c\\+\\+|hpp)$`)\n    javaMatch            = regexp.MustCompile(`(?i)^.*\\.(?:java|js)$`)\n    goMatch              = regexp.MustCompile(`(?i)^.*\\.(?:go)$`)\n    buildMatch           = regexp.MustCompile(`(?i)^.*\\.(?:gradle|mk|mka)$`)\n    buildMatch2          = regexp.MustCompile(`^.*/(?:Makefile[^/\\\\]*)$`)\n    regMatch             = regexp.MustCompile(`(?i)(?:test|debug)`)\n)\n\nfunc init() {\n    fileLists = make(map[string][]string)\n}\n\nfunc main() {\n    flag.StringVar(&amp;topDir, \"d\", \".\", \"The top level directory to process (default is current directory)\")\n    flag.IntVar(&amp;grepConcurrencyLimit, \"l\", 50, \"The limit of number of files to grep at any one time\")\n    flag.BoolVar(&amp;cProf, \"c\", false, \"Include if you want to save the CPU profile\")\n    flag.BoolVar(&amp;mProf, \"m\", false, \"Include if you want to save the MEM profile\")\n    flag.Parse()\n\n    cProfFunc()\n\n    getFilesChan := make(chan string, 1000)\n    grepFilesChan := make(chan string, 100)\n\n    // This channel is to ensure that only grepConcurrencyLimit files are ever grepped at any one time\n    semaphoreChan := make(chan bool, grepConcurrencyLimit)\n\n    go getFileNamesOverChan(topDir, getFilesChan)\n\n    var fileResult string\n\n    var grepWg sync.WaitGroup\n    var categorizeWg sync.WaitGroup\n\n    fileTypes = append(fileTypes, \"C\", \"Java\", \"Go\", \"Build\", \"Uncategorized\")\n\n    categorizeWg.Add(1)\n    go func(chan string) {\n        var grepResult string\n        for grepResult = range grepFilesChan {\n            if grepResult != \"\" {\n                fmt.Printf(\"Found file %s with text\\n\", grepResult)\n                var fileType = getFileCategory(grepResult)\n                fileLists[fileType] = append(fileLists[fileType], grepResult)\n            }\n        }\n        categorizeWg.Done()\n    }(grepFilesChan)\n\n    for fileResult = range getFilesChan {\n        if fileResult != \"\" {\n            fileNames = append(fileNames, fileResult)\n            grepWg.Add(1)\n            // write a boolean to semaphoreChan to take up one of the concurrency limit spots\n            semaphoreChan &lt;- true\n            go func(file string, ch chan string) {\n                fmt.Printf(\"Grepping file %s\\n\", file)\n                //run the function to read a boolean from semaphoreChan to release one of the concurrency limit spots\n                defer func() { &lt;-semaphoreChan }()\n                grepOverChan(file, ch)\n                grepWg.Done()\n            }(fileResult, grepFilesChan)\n        }\n\n    }\n\n    // refill semaphoreChan to capacity to wait until all of the final go routines have completed.\n    for i := 0; i &lt; cap(semaphoreChan); i++ {\n        semaphoreChan &lt;- true\n    }\n\n    grepWg.Wait()\n    close(grepFilesChan)\n    categorizeWg.Wait()\n\n    printSummary()\n    mProfFunc()\n\n    defer pprof.StopCPUProfile()\n    defer cProfFile.Close()\n}\n\nfunc cProfFunc() {\n    if cProf {\n        cProfFile, _ = os.Create(\"cpu_profile.pprof\")\n        //handle err\n        _ = pprof.StartCPUProfile(cProfFile)\n        //handle err\n    }\n\n}\n\nfunc mProfFunc() {\n    if mProf {\n        mProfFile, _ = os.Create(\"mem_profile.pprof\")\n        //handle err\n        _ = pprof.WriteHeapProfile(mProfFile)\n        //handle err\n        defer mProfFile.Close()\n    }\n}\n\nfunc printSummary() {\n    fmt.Printf(\"\\n\\nProcessed %d Files\\n\\n\", len(fileNames))\n\n    fmt.Println(\"\")\n    fmt.Println(\"Found text in the following files:\")\n\n    for _, fType := range fileTypes {\n        fmt.Printf(\"Found text in %d %s Files\\n\", len(fileLists[fType]), fType)\n    }\n    /*\n        for _, fType := range fileTypes {\n            if len(fileLists[fType]) &gt; 0 {\n                fmt.Println(\"\")\n                fmt.Printf(\"\\t%s Files:\\n\", fType)\n            }\n\n            for _, fileName := range fileLists[fType] {\n                fmt.Printf(\"\\t\\t%s\\n\", fileName)\n            }\n        }\n    */\n}\n\nfunc getFileNamesOverChan(directory string, ch chan string) {\n    fmt.Printf(\"Finding files in directory %s\\n\", directory)\n    var err error\n    var dirInfo os.FileInfo\n\n    dirInfo, err = os.Lstat(directory)\n    if err != nil {\n        close(ch)\n        return\n    }\n\n    if !dirInfo.IsDir() {\n        close(ch)\n        return\n    }\n\n    recursiveGetFilesOverChan(directory, ch)\n\n    close(ch)\n}\n\nfunc recursiveGetFilesOverChan(dir string, ch chan string) {\n    dirFile, _ := os.Open(dir)\n    //handle err\n    defer dirFile.Close()\n\n    dirFileInfo, _ := dirFile.Readdir(0)\n    //handle err\n\n    for _, file := range dirFileInfo {\n        filePath := fmt.Sprintf(\"%s%c%s\", dir, os.PathSeparator, file.Name())\n        switch mode := file.Mode(); {\n        case mode.IsDir():\n            //is a directory ... recurse\n            recursiveGetFilesOverChan(filePath, ch)\n        case mode.IsRegular():\n            //is a regular file ... send it if it is not a CVS or GIT file\n            if !strings.Contains(filePath, \"/CVS/\") &amp;&amp; !strings.Contains(filePath, \"/.git/\") {\n                fmt.Printf(\"Found File %s\\n\", filePath)\n                ch &lt;- filePath\n            }\n        case mode&amp;os.ModeSymlink != 0:\n            //is a symbolic link ... skip it\n            continue\n        case mode&amp;os.ModeNamedPipe != 0:\n            //is a Named Pipe ... skip it\n            continue\n        }\n    }\n}\n\nfunc getFileCategory(file string) string {\n    var fileType string\n\n    switch {\n    case cMatch.MatchString(file):\n        fileType = \"C\"\n    case javaMatch.MatchString(file):\n        fileType = \"Java\"\n    case goMatch.MatchString(file):\n        fileType = \"Go\"\n    case buildMatch.MatchString(file):\n        fileType = \"Build\"\n    case buildMatch2.MatchString(file):\n        fileType = \"Build\"\n    default:\n        fileType = \"Uncategorized\"\n    }\n    return fileType\n}\n\nfunc grepOverChan(f string, ch chan string) {\n    fileBytes, _ := ioutil.ReadFile(f)\n    if regMatch.Match(fileBytes) {\n        ch &lt;- f\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9744341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ca98074d2c94443f9cdcf70f2e189d9?s=128&d=identicon&r=PG&f=1", "display_name": "Kris", "link": "https://stackoverflow.com/users/9744341/kris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1053, "favorite_count": 0, "accepted_answer_id": 50217635, "answer_count": 1, "score": -2, "last_activity_date": 1525706720, "creation_date": 1525499097, "question_id": 50186147, "link": "https://stackoverflow.com/questions/50186147/golang-program-leaking-memory", "title": "Golang Program leaking memory", "body": "<p>I am trying to write a simple program that behaves like find | grep in golang. I have the program all working using goroutines using the following pattern:</p>\n\n<p>goroutine (filech &lt;- each file as found)\ngoroutine (store files in extension based category &lt;- grepch)</p>\n\n<p>goroutine for each filech file (grepch &lt;- if file contains string)</p>\n\n<p>This all works as expected, but when presented with a large number of files, the memory just keeps growing and growing. I have looked into some of the profiling tools offered by Go, but I couldn't figure out how to find my memory leak. I can say that the memory is being used up mostly by bytes.makeSlice.</p>\n\n<p>Can anyone look at the code below and see what I am doing wrong? Also, I would like to know what is wrong with my code, but I would also like to learn how to debug this on my own in the future, so if you could give detailed profiling instructions for a problem such as this, that would be greatly appreciated.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"regexp\"\n    \"runtime/pprof\"\n    \"strings\"\n    \"sync\"\n)\n\nvar (\n    topDir      string\n    cProf       bool\n    mProf       bool\n    cProfFile   *os.File\n    mProfFile   *os.File\n    fileNames   []string\n    fileTypes   []string\n    fileLists   map[string][]string\n    cMatch      = regexp.MustCompile(`(?i)^.*\\.(?:c|h|cc|cpp|c\\+\\+|hpp)$`)\n    javaMatch   = regexp.MustCompile(`(?i)^.*\\.(?:java|js)$`)\n    goMatch     = regexp.MustCompile(`(?i)^.*\\.(?:go)$`)\n    buildMatch  = regexp.MustCompile(`(?i)^.*\\.(?:gradle|mk|mka)$`)\n    buildMatch2 = regexp.MustCompile(`^.*/(?:Makefile[^/\\\\]*)$`)\n    regMatch    = regexp.MustCompile(`(?i)(?:test|debug)`)\n)\n\nfunc init() {\n    fileLists = make(map[string][]string)\n}\n\nfunc main() {\n    flag.StringVar(&amp;topDir, \"d\", \".\", \"The top level directory to process (default is current directory)\")\n    flag.BoolVar(&amp;cProf, \"c\", false, \"Include if you want to save the CPU profile\")\n    flag.BoolVar(&amp;mProf, \"m\", false, \"Include if you want to save the MEM profile\")\n    flag.Parse()\n\n    cProfFunc()\n\n    getFilesChan := make(chan string, 1000)\n    grepFilesChan := make(chan string, 100)\n\n    go getFileNamesOverChan(topDir, getFilesChan)\n\n    var fileResult string\n\n    var grepWg sync.WaitGroup\n    var categorizeWg sync.WaitGroup\n\n    fileTypes = append(fileTypes, \"C\", \"Java\", \"Go\", \"Build\", \"Uncategorized\")\n\n    categorizeWg.Add(1)\n    go func(chan string) {\n        var grepResult string\n        for grepResult = range grepFilesChan {\n            if grepResult != \"\" {\n                fmt.Printf(\"Found file %s with text\\n\", grepResult)\n                var fileType = getFileCategory(grepResult)\n                fileLists[fileType] = append(fileLists[fileType], grepResult)\n            }\n        }\n        categorizeWg.Done()\n    }(grepFilesChan)\n\n    for fileResult = range getFilesChan {\n        if fileResult != \"\" {\n            fileNames = append(fileNames, fileResult)\n            grepWg.Add(1)\n            go func(file string, ch chan string) {\n                fmt.Printf(\"Grepping file %s\\n\", file)\n                grepOverChan(file, ch)\n                grepWg.Done()\n            }(fileResult, grepFilesChan)\n        }\n\n    }\n\n    grepWg.Wait()\n    close(grepFilesChan)\n    categorizeWg.Wait()\n\n    printSummary()\n    mProfFunc()\n\n    defer pprof.StopCPUProfile()\n    defer cProfFile.Close()\n}\n\nfunc cProfFunc() {\n    if cProf {\n        cProfFile, _ = os.Create(\"cpu_profile.pprof\")\n        //handle err\n        _ = pprof.StartCPUProfile(cProfFile)\n        //handle err\n    }\n\n}\n\nfunc mProfFunc() {\n    if mProf {\n        mProfFile, _ = os.Create(\"mem_profile.pprof\")\n        //handle err\n        _ = pprof.WriteHeapProfile(mProfFile)\n        //handle err\n        defer mProfFile.Close()\n    }\n}\n\nfunc printSummary() {\n    fmt.Printf(\"\\n\\nProcessed %d Files\\n\\n\", len(fileNames))\n\n    fmt.Println(\"\")\n    fmt.Println(\"Found text in the following files:\")\n\n    for _, fType := range fileTypes {\n        fmt.Printf(\"Found text in %d %s Files\\n\", len(fileLists[fType]), fType)\n    }\n    /*\n        for _, fType := range fileTypes {\n            if len(fileLists[fType]) &gt; 0 {\n                fmt.Println(\"\")\n                fmt.Printf(\"\\t%s Files:\\n\", fType)\n            }\n\n            for _, fileName := range fileLists[fType] {\n                fmt.Printf(\"\\t\\t%s\\n\", fileName)\n            }\n        }\n    */\n}\n\nfunc getFileNamesOverChan(directory string, ch chan string) {\n    fmt.Printf(\"Finding files in directory %s\\n\", directory)\n    var err error\n    var dirInfo os.FileInfo\n\n    dirInfo, err = os.Lstat(directory)\n    if err != nil {\n        close(ch)\n        return\n    }\n\n    if !dirInfo.IsDir() {\n        close(ch)\n        return\n    }\n\n    recursiveGetFilesOverChan(directory, ch)\n\n    close(ch)\n}\n\nfunc recursiveGetFilesOverChan(dir string, ch chan string) {\n    dirFile, _ := os.Open(dir)\n    //handle err\n    defer dirFile.Close()\n\n    dirFileInfo, _ := dirFile.Readdir(0)\n    //handle err\n\n    for _, file := range dirFileInfo {\n        filePath := fmt.Sprintf(\"%s%c%s\", dir, os.PathSeparator, file.Name())\n        switch mode := file.Mode(); {\n        case mode.IsDir():\n            //is a directory ... recurse\n            recursiveGetFilesOverChan(filePath, ch)\n        case mode.IsRegular():\n            //is a regular file ... send it if it is not a CVS or GIT file\n            if !strings.Contains(filePath, \"/CVS/\") &amp;&amp; !strings.Contains(filePath, \"/.git/\") {\n                fmt.Printf(\"Found File %s\\n\", filePath)\n                ch &lt;- filePath\n            }\n        case mode&amp;os.ModeSymlink != 0:\n            //is a symbolic link ... skip it\n            continue\n        case mode&amp;os.ModeNamedPipe != 0:\n            //is a Named Pipe ... skip it\n            continue\n        }\n    }\n}\n\nfunc getFileCategory(file string) string {\n    var fileType string\n\n    switch {\n    case cMatch.MatchString(file):\n        fileType = \"C\"\n    case javaMatch.MatchString(file):\n        fileType = \"Java\"\n    case goMatch.MatchString(file):\n        fileType = \"Go\"\n    case buildMatch.MatchString(file):\n        fileType = \"Build\"\n    case buildMatch2.MatchString(file):\n        fileType = \"Build\"\n    default:\n        fileType = \"Uncategorized\"\n    }\n    return fileType\n}\n\nfunc grepOverChan(f string, ch chan string) {\n    fileBytes, _ := ioutil.ReadFile(f)\n    if regMatch.Match(fileBytes) {\n        ch &lt;- f\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 768, "user_id": 4623259, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/sNAyd.png?s=128&g=1", "display_name": "iPherian", "link": "https://stackoverflow.com/users/4623259/ipherian"}, "edited": false, "score": 1, "creation_date": 1525500578, "post_id": 50186132, "comment_id": 87389360, "body": "If you&#39;re concerned about repetition, the only option I can think of that is less verbose than an error handling func is <code>panic</code>-ing, otherwise known as an exception."}, {"owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "reply_to_user": {"reputation": 768, "user_id": 4623259, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/sNAyd.png?s=128&g=1", "display_name": "iPherian", "link": "https://stackoverflow.com/users/4623259/ipherian"}, "edited": false, "score": 0, "creation_date": 1525501325, "post_id": 50186132, "comment_id": 87389536, "body": "@iPherian Thanks. I will take a look at it."}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "reply_to_user": {"reputation": 768, "user_id": 4623259, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/sNAyd.png?s=128&g=1", "display_name": "iPherian", "link": "https://stackoverflow.com/users/4623259/ipherian"}, "edited": false, "score": 2, "creation_date": 1525504016, "post_id": 50186132, "comment_id": 87390126, "body": "@iPherian Please don&#39;t suggest <code>panic</code>ing for a normal error handling situation. <code>panic</code>ing should only be used in situations where there is a fundamentally broken piece of logic in the code and the panic could have been avoided. A great example is the <code>reflect</code> package. In the case of errors in a web application (like it seems to be the case here), errors should be handled gracefully with the classic <code>if err != nil</code> over and over."}, {"owner": {"reputation": 844, "user_id": 2459515, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SkRr0.jpg?s=128&g=1", "display_name": "StevieB", "link": "https://stackoverflow.com/users/2459515/stevieb"}, "edited": false, "score": 0, "creation_date": 1525508725, "post_id": 50186132, "comment_id": 87391250, "body": "You could handle this error type in the calling function. Then it will only need handling once. For web applications I usually let the errors percolate up to the top level and have a few response encoders to deal with the various error and success scenarios. It helps to have defined an appropriate error type for the application - os.PathError is a good source of inspiration."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1525503875, "last_edit_date": 1525503875, "creation_date": 1525503320, "answer_id": 50186650, "question_id": 50186132, "link": "https://stackoverflow.com/questions/50186132/how-to-avoid-repeating-myself-in-consecutive-error-handling/50186650#50186650", "title": "how to avoid repeating myself in consecutive error handling", "body": "<p>If you are repeating a number of steps in multiple places the correct approach would be to abstract away those steps into a procedure, which is what programming is about. This applies to error handling just as well as to any other parts of your program.</p>\n\n<p>One option:</p>\n\n<pre><code>func allNodesAndLinks() ([]*Node, []*Link, error) {\n    nodes, err := model.AllNodes()\n    if err != nil {\n        return nil, nil, err\n    }\n    links, err := model.AllLinks()\n    if err != nil {\n        return nil, nil, err\n    }\n    return nodes, links, nil\n}\n\n// ...\n\nnodes, links, err := allNodesAndLinks()\nif err != nil {\n    pr := progressRes{\n        Type:        progressResponse,\n        Message:     err.Error(),\n        MessageType: errorMessage,\n        Progress:    100,\n    }\n    go response(ws, pr.json())\n    return\n}\n</code></pre>\n\n<p>Another option:</p>\n\n<pre><code>func respondWithError(ws io.Writer, err error) {\n    pr := progressRes{\n        Type:        progressResponse,\n        Message:     err.Error(),\n        MessageType: errorMessage,\n        Progress:    100,\n    }\n    response(ws, pr.json())\n}\n\n// ...\n\nnodes, err := model.AllNodes()\nif err != nil {\n    go respondWithError(ws, err)\n    return\n}\nlinks, err := model.AllLinks()\nif err != nil {\n    go respondWithError(ws, err)\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "edited": false, "score": 1, "creation_date": 1525514477, "post_id": 50186887, "comment_id": 87392990, "body": "Thanks. I wish I could accept more than one answer."}], "tags": [], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1525505196, "creation_date": 1525505196, "answer_id": 50186887, "question_id": 50186132, "link": "https://stackoverflow.com/questions/50186132/how-to-avoid-repeating-myself-in-consecutive-error-handling/50186887#50186887", "title": "how to avoid repeating myself in consecutive error handling", "body": "<p>There are probably two different approaches you can use; either <code>defer</code> or, as you suggested, using another function.</p>\n\n<p>Defer would work like this:</p>\n\n<pre><code>// All of these must be defined before we call defer.\nvar err error\nvar progressResponse string\nvar errorMessage string\ndefer func() {\n    // Since the deferred function will be called even if\n    // the function has completed successfully, we need to\n    // check that there actually has been an error before we\n    // create the error response.\n    if err == nil {\n        return\n    }\n    pr := progressRes{\n        Type:        progressResponse,\n        Message:     err.Error(),\n        MessageType: errorMessage,\n        Progress:    100,\n    }\n    go response(ws, pr.json())\n}()\nnodes, err := model.AllNodes()\nif err != nil {\n    // The deferred function will automatically be called here.\n    return\n}\nlinks, err := model.AllLinks()\nif err != nil {\n    // And in every other place where the function returns.\n    return\n}\n</code></pre>\n\n<p>The problem here is that there can be some pitfalls related to variable shadowing. Take this example:</p>\n\n<pre><code>var err error\ndefer func() {\n    if err != nil {\n        handleError(err)\n    }\n}()\nif a, err := doSomething(); err != nil {\n    return\n}\n</code></pre>\n\n<p>Here's a proof of concept <a href=\"https://play.golang.org/p/ga8VdR9T8Ib\" rel=\"nofollow noreferrer\">on the playground</a>.</p>\n\n<p>The problem here is that the <code>err</code> inside of the <code>if</code> clause is not the same as the one in the upper scope; if you declare <code>a</code> in the upper scope as well, and use a single assignment <code>=</code> instead of a declaration <code>:=</code>, then it <a href=\"https://play.golang.org/p/RRU7wN4eIMc\" rel=\"nofollow noreferrer\">works as expected</a>. Variable shadowing is a common pitfall, especially for beginners; <a href=\"https://blog.charmes.net/post/scope-shadowing-go/\" rel=\"nofollow noreferrer\">further reading</a>.</p>\n\n<p>Thus, the approach I generally use and recommend, is that of having another function. The caller generally only needs one actual return argument anyway, so it usually doesn't become very complex.</p>\n\n<pre><code>func a() {\n    links, err := b()\n    if err != nil {\n        pr := progressRes{\n            Type:        progressResponse,\n            Message:     err.Error(),\n            MessageType: errorMessage,\n            Progress:    100,\n        }\n        go response(ws, pr.json())\n        return\n    }\n}\n\nfunc b() ([]Link, error) {\n    nodes, err := model.AllNodes()\n    if err != nil {\n        return nil, err\n    }\n    links, err := model.AllLinks()\n    if err != nil {\n        return nil, err\n    }\n    // you probably then do something with nodes and links?\n    return resolveLinks(nodes, links)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1525603289, "creation_date": 1525603289, "answer_id": 50198780, "question_id": 50186132, "link": "https://stackoverflow.com/questions/50186132/how-to-avoid-repeating-myself-in-consecutive-error-handling/50198780#50198780", "title": "how to avoid repeating myself in consecutive error handling", "body": "<p>My preferred approach, because it makes unit testing much easier than the other suggestions, would be:</p>\n\n<pre><code>func doStuff() {\n    if err := doStuffWithError(); err != nil {\n        pr := progressRes{\n            Type:        progressResponse,\n            Message:     err.Error(),\n            MessageType: errorMessage,\n            Progress:    100,\n        }\n        go response(ws, pr.json())\n        return\n    }\n}\n\nfunc doStuffWithError() error {\n    nodes, err := model.AllNodes()\n    if err != nil {\n        return err\n    }\n    links, err := model.AllLinks()\n    if err != nil {\n        return err\n    }\n    // Do something with nodes and links\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 50186650, "answer_count": 3, "score": 1, "last_activity_date": 1525603289, "creation_date": 1525498938, "question_id": 50186132, "link": "https://stackoverflow.com/questions/50186132/how-to-avoid-repeating-myself-in-consecutive-error-handling", "title": "how to avoid repeating myself in consecutive error handling", "body": "<p>I have the following handling of consecutive errors:</p>\n\n<pre><code>nodes, err := model.AllNodes()\nif err != nil {                           // This error handling  \n    pr := progressRes{                    // is Just a copy of\n        Type:        progressResponse,    // error handling\n        Message:     err.Error(),         // for the next error,\n        MessageType: errorMessage,        // what is the\n        Progress:    100,                 // best practice\n    }                                     // to avoid\n    go response(ws, pr.json())            // repeating myself here\n    return                                // without making the code\n}                                         // complicated\nlinks, err := model.AllLinks()\nif err != nil {\n    pr := progressRes{\n        Type:        progressResponse,\n        Message:     err.Error(),\n        MessageType: errorMessage,\n        Progress:    100,\n    }\n    go response(ws, pr.json())\n    return\n}\n</code></pre>\n\n<p>What is the best practice to avoid repeating myself in the above code without making the code complex? I can think of adding a new <code>func</code>, however I just thought there might be a better idea which I'm not aware of.</p>\n"}, {"tags": ["go", "nested", "maps"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525467269, "post_id": 50182880, "comment_id": 87383294, "body": "duplicate <a href=\"https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i\" title=\"why do i get a cannot assign error when setting value to a struct as a value i\">stackoverflow.com/questions/32751537/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/40578646/golang-i-have-a-map-of-structs-why-cant-i-directly-modify-a-field-in-a-struct\" title=\"golang i have a map of structs why cant i directly modify a field in a struct\">stackoverflow.com/questions/40578646/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1525467573, "post_id": 50182880, "comment_id": 87383394, "body": "<a href=\"https://play.golang.org/p/kYoiZdwpXyK\" rel=\"nofollow noreferrer\">what you should do</a>"}, {"owner": {"reputation": 13, "user_id": 9743305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e3795acad24e7b37293c1418c0121f?s=128&d=identicon&r=PG&f=1", "display_name": "Valdemore", "link": "https://stackoverflow.com/users/9743305/valdemore"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1525467905, "post_id": 50182880, "comment_id": 87383501, "body": "Very thanks mkopriva and very fast!"}], "owner": {"reputation": 13, "user_id": 9743305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e3795acad24e7b37293c1418c0121f?s=128&d=identicon&r=PG&f=1", "display_name": "Valdemore", "link": "https://stackoverflow.com/users/9743305/valdemore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2174, "favorite_count": 0, "closed_date": 1525485982, "answer_count": 0, "score": 0, "last_activity_date": 1525486113, "creation_date": 1525467081, "last_edit_date": 1525467290, "question_id": 50182880, "link": "https://stackoverflow.com/questions/50182880/cannot-assign-struct-field-in-nested-map-golang", "closed_reason": "Duplicate", "title": "Cannot assign struct field in nested map Golang", "body": "<p>I have the next structure:</p>\n\n<pre><code>type filesDB struct {\n    Name    string\n    Content []byte\n}\n\ntype fileDB struct {\n  Files map[string]filesDB\n}\n</code></pre>\n\n<p>Well, when I try to save data in JSON format with the maps, I try this:</p>\n\n<p>First, I make a map var:</p>\n\n<pre><code>var filesDatabase = map[string]fileDB{}\n</code></pre>\n\n<p>Then, i try to insert data:</p>\n\n<pre><code>    var f filesDB\n    fidb := map[string]filesDB{}\n    f.Name= filename\n    f.Content= encrypt(b, sUser[user].Cipher)\n    fidb[filename] = f\n    filesDatabase[user].Files = fidb\n    jsonDB, err := json.Marshal(filesDatabase)\n</code></pre>\n\n<p>So, when I try to run the script, I get the next error:</p>\n\n<blockquote>\n  <p>cannot assign to struct field filesDatabase[user].Files in map</p>\n</blockquote>\n\n<p>How can I resolve this error? Thanks!</p>\n"}, {"tags": ["go", "concurrency", "synchronisation"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1525462688, "post_id": 50182009, "comment_id": 87381315, "body": "If you don&#39;t think mutexes are the way to do things in go, you should <a href=\"https://golang.org/src/sync/once.go?s=260:305#L2\" rel=\"nofollow noreferrer\">have a look at the source of <code>sync.Once</code></a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525462701, "post_id": 50182009, "comment_id": 87381322, "body": "<code>sync.Once</code> is how you typically ensure something is only done once. What problem did you have actually using it?"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "edited": false, "score": 0, "creation_date": 1525464302, "post_id": 50182280, "comment_id": 87382046, "body": "How to check if the value has already been fetched, then? I know I can use a bool, but is that safe? What if one goroutine reads from that bool while another one writes to it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "edited": false, "score": 1, "creation_date": 1525464439, "post_id": 50182280, "comment_id": 87382107, "body": "You don&#39;t need to check. That check is done by <code>Once.Do()</code>. If your function is called, it has not yet been set."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525498590, "post_id": 50182280, "comment_id": 87388958, "body": "total may have already been set by an earlier call to GetPage though and in that case GetTotal shouldn&#39;t do anything. I don&#39;t think sync.Once is the solution here. Just use a mutex."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525499259, "post_id": 50182280, "comment_id": 87389086, "body": "@Peter A mutex is slower than using <code>sync.Once</code>. And the result is the same."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525505582, "post_id": 50182280, "comment_id": 87390508, "body": "@Peter If <code>GetPage()</code> has been called before, the example above will not do anything but return the previously calculated value. That&#39;s what <code>Once.Do()</code> does / ensures."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525511639, "post_id": 50182280, "comment_id": 87392136, "body": "@icza, you may want to add your implementation of GetPage then. I don&#39;t see GetPage invoking the Once."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1525521780, "post_id": 50182280, "comment_id": 87395210, "body": "@Peter You&#39;re right, the answer wasn&#39;t covering the asker&#39;s need entirely. Added explicit solution / explanation to the asker&#39;s specific case."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1525528709, "post_id": 50182280, "comment_id": 87397282, "body": "I only just now realized that you can pass different functions to Do. I always assumed you have to pass the same function at every call site. Makes sense now, thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1525538455, "last_edit_date": 1525538455, "creation_date": 1525463960, "answer_id": 50182280, "question_id": 50182009, "link": "https://stackoverflow.com/questions/50182009/ensuring-a-value-is-retrieved-only-once/50182280#50182280", "title": "Ensuring a value is retrieved only once", "body": "<h2>General \"init-once\" solution</h2>\n\n<p>In the general / usual case, the easiest solution to only init once, only when it's actually needed is to use <a href=\"https://golang.org/pkg/sync/#Once\" rel=\"nofollow noreferrer\"><code>sync.Once</code></a> and its <a href=\"https://golang.org/pkg/sync/#Once.Do\" rel=\"nofollow noreferrer\"><code>Once.Do()</code></a> method.</p>\n\n<p>You don't actually need to return any value from the function passed to <code>Once.Do()</code>, because you can store values to e.g. global variables in that function.</p>\n\n<p>See this simple example:</p>\n\n<pre><code>var (\n    total         int\n    calcTotalOnce sync.Once\n)\n\nfunc GetTotal() int {\n    // Init / calc total once:\n    calcTotalOnce.Do(func() {\n        fmt.Println(\"Fetching total...\")\n        // Do some heavy work, make HTTP calls, whatever you want:\n        total++ // This will set total to 1 (once and for all)\n    })\n\n    // Here you can safely use total:\n    return total\n}\n\nfunc main() {\n    fmt.Println(GetTotal())\n    fmt.Println(GetTotal())\n}\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/hxZE8YskmDV\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Fetching total...\n1\n1\n</code></pre>\n\n<p>Some notes:</p>\n\n<ul>\n<li>You can achieve the same using a mutex or <code>sync.Once</code>, but the latter is actually faster than using a mutex.</li>\n<li>If <code>GetTotal()</code> has been called before, subsequent calls to <code>GetTotal()</code> will not do anything but return the previously calculated value, this is what <code>Once.Do()</code> does / ensures. <code>sync.Once</code> \"tracks\" if its <code>Do()</code> method has been called before, and if so, the passed function value will not be called anymore.</li>\n<li><code>sync.Once</code> provides all the needs for this solution to be safe for concurrent use from multiple goroutines, given that you don't modify or access the <code>total</code> variable directly from anywhere else.</li>\n</ul>\n\n<h2>Solution to your \"unusal\" case</h2>\n\n<p>The general case assumes the <code>total</code> is only accessed via the <code>GetTotal()</code> function.</p>\n\n<p>In your case this does not hold: you want to access it via the <code>GetTotal()</code> function <strong>and</strong> you want to set it after a <code>GetPage()</code> call (if it has not yet been set).</p>\n\n<p>We may solve this with <code>sync.Once</code> too. We would need the above <code>GetTotal()</code> function; and when a <code>GetPage()</code> call is performed, it may use the same <code>calcTotalOnce</code> to attempt to set its value from the received page.</p>\n\n<p>It could look something like this:</p>\n\n<pre><code>var (\n    total         int\n    calcTotalOnce sync.Once\n)\n\nfunc GetTotal() int {\n    calcTotalOnce.Do(func() {\n        // total is not yet initialized: get page and store total number\n        page := getPageImpl()\n        total = page.Total\n    })\n\n    // Here you can safely use total:\n    return total\n}\n\ntype Page struct {\n    Total int\n}\n\nfunc GetPage() *Page {\n    page := getPageImpl()\n\n    calcTotalOnce.Do(func() {\n        // total is not yet initialized, store the value we have:\n        total = page.Total\n    })\n\n    return page\n}\n\nfunc getPageImpl() *Page {\n    // Do HTTP call or whatever\n    page := &amp;Page{}\n    // Set page.Total from the response body\n    return page\n}\n</code></pre>\n\n<p>How does this work? We create and use a single <code>sync.Once</code> in the variable <code>calcTotalOnce</code>. This ensures that its <code>Do()</code> method may only call the function passed to it <em>once</em>, no matter where / how this <code>Do()</code> method is called.</p>\n\n<p>If someone calls the <code>GetTotal()</code> function first, then the function literal inside it will run, which calls <code>getPageImpl()</code> to fetch the page and initialize the <code>total</code> variable from the <code>Page.Total</code> field.</p>\n\n<p>If <code>GetPage()</code> function would be called first, that will also call <code>calcTotalOnce.Do()</code> which simply sets the <code>Page.Total</code> value to the <code>total</code> variable.</p>\n\n<p>Whichever route is walked first, that will alter the internal state of <code>calcTotalOnce</code>, which will remember the <code>total</code> calculation has already been run, and further calls to <code>calcTotalOnce.Do()</code> will never call the function value passed to it.</p>\n\n<h2>Or just use \"eager\" initialization</h2>\n\n<p>Also note that if it is likely that this total number have to be fetched during the lifetime of your program, it might not worth the above complexity, as you may just as easily initialize the variable once, when it's created.</p>\n\n<pre><code>var Total = getPageImpl().Total\n</code></pre>\n\n<p>Or if the initialization is a little more complex (e.g. needs error handling), use a package <code>init()</code> function:</p>\n\n<pre><code>var Total int\n\nfunc init() {\n    page := getPageImpl()\n    // Other logic, e.g. error handling\n    Total = page.Total\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "accepted_answer_id": 50182280, "answer_count": 1, "score": 2, "last_activity_date": 1525538455, "creation_date": 1525462521, "last_edit_date": 1525521960, "question_id": 50182009, "link": "https://stackoverflow.com/questions/50182009/ensuring-a-value-is-retrieved-only-once", "title": "Ensuring a value is retrieved only once", "body": "<p>I'm developing a Go package to access a web service (via HTTP). Every time I retrieve a page of data from that service, I also get the total of pages available. The only way to get this total is by getting one of the pages (usually the first one). However, requests to this service take time and I need to do the following:</p>\n\n<p>When the <code>GetPage</code> method is called on a <code>Client</code> and the page is retrieved for the first time, the retrieved total should be stored somewhere in that client. When the <code>Total</code> method is called and the total hasn't yet been retrieved, the first page should be fetched and the total returned. If the total was retrieved before, either by a call to <code>GetPage</code> or <code>Total</code>, it should be returned immediately, without any HTTP requests at all. This needs to be safe for use by multiple goroutines. My idea is something along the lines of <code>sync.Once</code> but with the function passed to <code>Do</code> returning a value, which is then cached and automatically returned whenever <code>Do</code> is called.</p>\n\n<p>I remember seeing something like this before, but I can't find it now even though I tried. Searching for <code>sync.Once</code> with value and similar terms didn't yield any useful results. I know I could probably do that with a mutex and a lot of locking, but mutexes and a lot of locking don't seem to be the recommended way to do stuff in go.</p>\n"}, {"tags": ["go", "ipfs"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1525463814, "post_id": 50181585, "comment_id": 87381812, "body": "Isn&#39;t the <a href=\"https://godoc.org/github.com/ipfs/go-ipfs-api#Shell.Cat\" rel=\"nofollow noreferrer\">godoc.org/github.com/ipfs/go-ipfs-api#Shell.Cat</a> what you want?"}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1525465170, "post_id": 50181585, "comment_id": 87382419, "body": "@ain Almost... I actually need to be able to seek as well so basically I need a ReadSeeker. I&#39;ve just edited the question."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1525481077, "post_id": 50181585, "comment_id": 87386543, "body": "I don&#39;t think IPFS is seekable. I could be wrong, but I didn&#39;t see anything applicable from a few quick looks around."}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1525465137, "creation_date": 1525460453, "last_edit_date": 1525465137, "question_id": 50181585, "link": "https://stackoverflow.com/questions/50181585/how-can-i-get-a-file-and-seek-through-ipfs", "title": "How can I get a file and Seek through ipfs?", "body": "<p>I'm developing a specialised browser and part of that I would like to support the ipfs protocol. Thus this simple question:</p>\n\n<ul>\n<li>How can I get a file through the ipfs protocol using Go? The browser I'm building specialised in streaming media so I need an io.ReadSeeker.</li>\n</ul>\n\n<p>What I've tried so far:\n I read the documentation... All I could find is the command line(which is useless to me as I'm considering a tighter integration/a Go API) and the <a href=\"https://godoc.org/github.com/ipfs/go-ipfs-api#Shell.Get\" rel=\"nofollow noreferrer\">shell.Get method</a> which is undocumented and seems to require an \"outdir\" instead to return an io.ReadSeeker/ReadSeekCloser</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525454908, "post_id": 50180231, "comment_id": 87377626, "body": "And the DB schema shouldn&#39;t matter at all."}, {"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525455674, "post_id": 50180231, "comment_id": 87378005, "body": "I edited the post and added the strack trace"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525455859, "post_id": 50180231, "comment_id": 87378099, "body": "What&#39;s on line 106 of your main.go?"}, {"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1525456054, "post_id": 50180231, "comment_id": 87378190, "body": "it is the query"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1525456390, "post_id": 50180231, "comment_id": 87378365, "body": "<code>db</code> is probably <code>nil</code>.  Show the code used to connect to the database."}, {"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 0, "creation_date": 1525456687, "post_id": 50180231, "comment_id": 87378495, "body": "It has been added. Db connection function is declared inside the function main"}, {"owner": {"reputation": 23488, "user_id": 6296561, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/zgIdn.png?s=128&g=1", "display_name": "Zoe", "link": "https://stackoverflow.com/users/6296561/zoe"}, "edited": false, "score": 1, "creation_date": 1525456819, "post_id": 50180231, "comment_id": 87378553, "body": "Please don&#39;t add stuff like &quot;Spamspamspamspam...&quot; to your post to bypass the length limit."}, {"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 0, "creation_date": 1525456868, "post_id": 50180231, "comment_id": 87378575, "body": "I&#39;m sorry but it won&#39;t let me post it otherwise because it says there is too much code"}, {"owner": {"reputation": 385, "user_id": 5664615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/422e978aea3f810747af5ee27fd7b9e4?s=128&d=identicon&r=PG&f=1", "display_name": "user5664615", "link": "https://stackoverflow.com/users/5664615/user5664615"}, "edited": false, "score": 3, "creation_date": 1525457033, "post_id": 50180231, "comment_id": 87378643, "body": "@user9522829 That&#39;s because <i>there is actually too much code</i>. You should add some explanation of your code and what you want it to do rather than hacking the length requirements"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1525457210, "post_id": 50180231, "comment_id": 87378730, "body": "Check <i>every single error</i>. You&#39;re currently ignoring db connection errors."}, {"owner": {"reputation": 2864, "user_id": 1196369, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/16777b8b25858df69e496a07abfab395?s=128&d=identicon&r=PG", "display_name": "mickadoo", "link": "https://stackoverflow.com/users/1196369/mickadoo"}, "edited": false, "score": 0, "creation_date": 1525457504, "post_id": 50180231, "comment_id": 87378888, "body": "Follow the stack trace, it looks like it&#39;s an error in sql.go, after looking at the file I&#39;d guess your connection isn&#39;t set up right"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525457668, "post_id": 50180231, "comment_id": 87378980, "body": "<code>fetchInstances</code> is using a nil <code>db</code> global variable."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1525457837, "post_id": 50180231, "comment_id": 87379062, "body": "Many duplicates, like <a href=\"https://stackoverflow.com/questions/31467498/why-does-gorm-db-first-panic-with-invalid-memory-address-or-nil-pointer-deref\" title=\"why does gorm db first panic with invalid memory address or nil pointer deref\">stackoverflow.com/questions/31467498/&hellip;</a> for example"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 0, "creation_date": 1525457058, "post_id": 50180612, "comment_id": 87378657, "body": "Just tried it and still get the same error. I opened the db connection in main, ping the db to check for connection and close it after that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 0, "creation_date": 1525457147, "post_id": 50180612, "comment_id": 87378698, "body": "Also, why are you closing the db connection? You need it to remain open."}, {"owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 0, "creation_date": 1525458549, "post_id": 50180612, "comment_id": 87379437, "body": "Thanks for your answer. I update the code as suggested (in the post as well) but I still get the same error"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "edited": false, "score": 1, "creation_date": 1525458902, "post_id": 50180612, "comment_id": 87379632, "body": "I really doubt that. If you&#39;ve done what I suggested, and you&#39;re still getting an error, it&#39;s almost certainly a different error."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1525457878, "last_edit_date": 1525457878, "creation_date": 1525456388, "answer_id": 50180612, "question_id": 50180231, "link": "https://stackoverflow.com/questions/50180231/sql-query-results-to-go-inside-a-nested-struct-using-golang/50180612#50180612", "title": "SQL query results to go inside a nested struct, using Golang", "body": "<p>You are attempting to connect to an uninitiated database connection. This is due to variable shadowing.</p>\n\n<p>Although you've defined a global <code>db</code> variable:</p>\n\n<pre><code>var db *sql.DB\n</code></pre>\n\n<p>Your <code>main()</code> method creates a new one when it connects:</p>\n\n<pre><code>db, err := sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp(db:3306)/\"+dbName)\n</code></pre>\n\n<p>So then when you call <code>fetchInstances</code>, which uses the global variable, the global one is still unset.</p>\n\n<p>The easiest solution is to change your code in <code>main()</code> as follows:</p>\n\n<pre><code>var err error\ndb, err = sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp(db:3306)/\"+dbName)\n</code></pre>\n\n<p>But the better solution is to never use a global variable. Use the locally-defined variable in <code>main</code>, then pass that to <code>fetchInstances</code>.</p>\n\n<hr>\n\n<p>As a side note: <em>ALWAYS, ALWAYS</em> check your errors. Twice in your code, you fail to check db connection errors, as in:</p>\n\n<pre><code>db, err := sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp(db:3306)/\"+dbName)\nerr = db.Ping()\n\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>If the connection fails, your <code>db.Ping()</code> call will likely panic. Instead, you should do:</p>\n\n<pre><code>db, err := sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp(db:3306)/\"+dbName)\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n\nerr = db.Ping()\n\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9522829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff331671b1d3a0f844a88249b99ac9e5?s=128&d=identicon&r=PG&f=1", "display_name": "user9522829", "link": "https://stackoverflow.com/users/9522829/user9522829"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1263, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1525461271, "creation_date": 1525454734, "last_edit_date": 1525461271, "question_id": 50180231, "link": "https://stackoverflow.com/questions/50180231/sql-query-results-to-go-inside-a-nested-struct-using-golang", "title": "SQL query results to go inside a nested struct, using Golang", "body": "<p>Below is the whole code of the program. It is a service that forwards requests. Currently working. What I am trying to do is get rid of the yml file that is currently storing all configs and move them to db. I don't want to mess with the code much, so my idea was to simply store the db data in the same structs.</p>\n\n<pre><code>    // Config contains configuration for this service\ntype Instance struct {\n    User         string `json:\"user\"`\n    Password     string `json:\"password\"`\n    InstanceId   string `json:\"instance_id\"`\n    InstanceType string `json:\"instance_type\"`\n    InstanceMode string `json:\"instance_mode\"`\n    ClientId     string `json:\"client_id\"`\n    ClientSecret string `json:\"client_secret\"`\n    PublicKey    string `json:\"pubkey\"`\n    Apis         Api    `json:\"apis\"`\n}\n\n// API struct\ntype Api struct {\n    Name    string `json:\"name\"`\n    Url     string `json:\"url\"`\n    Version string `json:\"version\"`\n    IsBhdGw bool   `json:\"isBhdGw\"`\n    Key     string `json:\"key\"`\n}\n\n\n// API struc\ntype InfoResponse struct {\n    InstanceId   string `json:\"instance_id\"`\n    InstanceType string `json:\"instance_type\"`\n    InstanceMode string `json:\"instance_mode\"`\n    ClientId     string `json:\"client_id\"`\n    ClientSecret string `json:\"client_secret\"`\n    PublicKey    string `json:\"pubkey\"`\n    Apis         Api    `json:\"apis\"`\n}\n\ntype Settings struct {\n    Port   int    `json:\"port\"`\n    User   string `json:\"user\"`\n    Secret string `json:\"secret\"`\n    Mode   string `json:\"mode\"`\n}\n\ntype Instances struct {\n    Instances []Instance\n}\n\nvar payloadLength int = 3\nvar instances Instances\nvar settings Settings\nvar db *sql.DB\n\n\n\nfunc fetchInstances() []Instance {\n\n    rows, err := db.Query(\"SELECT Instances.InstanceId, Instances.User, Instances.Password, Instances.InstanceType, Instances.InstanceMode, Instances.ClientId,  Instances.ClientSecret, Instances.PublicKey, Api.Name, Api.Url, Api.Version, Api.IsBhdGw, Api.Key FROM Instances, Api\")\n\n    if err != nil {\n        panic(err.Error())\n    }\n\n    defer rows.Close()\n\n    instances := []Instance{}\n\n\n    for rows.Next() {\n        var instance Instance\n        var apis Api\n\n        err := rows.Scan(&amp;instance.InstanceId, &amp;instance.User, &amp;instance.Password,\n            &amp;instance.InstanceType, &amp;instance.InstanceMode, &amp;instance.ClientId, &amp;instance.ClientSecret, &amp;instance.PublicKey,\n            &amp;apis.Name, &amp;apis.Url, &amp;apis.Version, &amp;apis.IsBhdGw, &amp;apis.Key)\n\n        if err != nil {\n            panic(err.Error())\n        }\n\n        instance.Apis = apis\n\n        instances = append(instances, instance)\n    }\n\n    return instances\n}\n</code></pre>\n\n<p>When I run this I get a \"panic: runtime error: invalid memory address or nil pointer dereference\"</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 120, "user_id": 4699276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962656f439a1d7a9c8854ced59253285?s=128&d=identicon&r=PG", "display_name": "user4699276", "link": "https://stackoverflow.com/users/4699276/user4699276"}, "edited": false, "score": 0, "creation_date": 1525476793, "post_id": 50179815, "comment_id": 87385898, "body": "Have you tried running the image you&#39;ve built with the Dockerfile you provided without using the <code>docker-compose</code> for that?"}], "answers": [{"comments": [{"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1525697528, "post_id": 50185024, "comment_id": 87446066, "body": "Would you edit your question to state your version of Docker you were using, and then the answer to state the version you upgraded to? That might prompt someone to suggest what bug/issue was fixed."}], "tags": [], "owner": {"reputation": 1030, "user_id": 451904, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/l2Raf.jpg?s=128&g=1", "display_name": "ChrisAdkin", "link": "https://stackoverflow.com/users/451904/chrisadkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1525858466, "last_edit_date": 1525858466, "creation_date": 1525485876, "answer_id": 50185024, "question_id": 50179815, "link": "https://stackoverflow.com/questions/50179815/image-building-fine-with-docker-build-but-stat-go-src-main-no-such-file-or-di/50185024#50185024", "title": "image building fine with docker build, but stat /GO/src/main: no such file or directory encountered with docker-compose", "body": "<p>I've upgraded to the latest version of Docker CE (18.03.1-ce, build 9ee9f40) and this appears to have resolved the issue.</p>\n"}], "owner": {"reputation": 1030, "user_id": 451904, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/l2Raf.jpg?s=128&g=1", "display_name": "ChrisAdkin", "link": "https://stackoverflow.com/users/451904/chrisadkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525858466, "creation_date": 1525452882, "last_edit_date": 1525462957, "question_id": 50179815, "link": "https://stackoverflow.com/questions/50179815/image-building-fine-with-docker-build-but-stat-go-src-main-no-such-file-or-di", "title": "image building fine with docker build, but stat /GO/src/main: no such file or directory encountered with docker-compose", "body": "<p>I have a Dockerfile which I can successfully build an image from:</p>\n\n<pre><code>FROM iron/go:dev\nRUN mkdir /app\nCOPY src/main/main.go /app/.\n# Set an env var that matches your github repo name, replace treeder/dockergo here with your repo name\nENV SRC_DIR=/app\n# Add the source code:\nADD . $SRC_DIR\n# Build it:\nRUN go get goji.io\nRUN go get gopkg.in/mgo.v2\nRUN cd $SRC_DIR; go build -o main\nENTRYPOINT [\"/app/main\"]\n</code></pre>\n\n<p>However, when I attempt to build the following docker-compose.yml file:</p>\n\n<pre><code>version: \"3.3\"\n\nservices:\n  api:\n    build: ./api\n    expose:\n      - '8080'\n    container_name: 'api'\n    ports:\n      - \"8082:8080\"\n    depends_on:\n      - db\n    networks:\n      - api-net\n\n  db:\n    build: ./db\n    expose:\n      - '27017'\n    container_name: 'mongo'\n    ports:\n      - \"27017:27017\"\n    networks:\n      - api-net\n\nnetworks:\n  api-net:\n    driver: bridge\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>Removing api mongo is up-to-date Recreating</p>\n  \n  <p>532e3cf66460_carsupermarket_api_1 ... error</p>\n  \n  <p>ERROR: for 532e3cf66460_carsupermarket_api_1  Cannot start service\n  api: OCI runtime create failed: container_linux.go:348: starting\n  container process caused \"exec: \\\"/GO/src/main\\\": stat /GO/src/main:\n  no such file or directory\": unknown</p>\n  \n  <p>ERROR: for api  Cannot start service api: OCI runtime create failed:\n  container_linux.go:348: starting container process caused \"exec:\n  \\\"/GO/src/main\\\": stat /GO/src/main: no such file or directory\":\n  unknown ERROR: Encountered errors while bringing up the project.</p>\n</blockquote>\n\n<p>I suspect that docker-compose is introducing some nuance when it comes to directory build paths, however, I'm at a loss as to why my image is building from the docker file when using <code>docker build .</code>, but failing when I try to incorporate this into docker-compose.</p>\n\n<p>Can someone point me in the right direction as to what I am doing wrong?</p>\n"}, {"tags": ["go", "concurrency", "goroutine", "gonum"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1525450870, "post_id": 50179290, "comment_id": 87375750, "body": "If you&#39;re just asking how to execute <code>eg.Done()</code> last in a function, that&#39;s what <code>defer</code> is for."}, {"owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "edited": false, "score": 1, "creation_date": 1525451939, "post_id": 50179290, "comment_id": 87376281, "body": "how big are these vectors?"}, {"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1527749505, "post_id": 50179290, "comment_id": 88246332, "body": "The cost of starting your goroutines will not be paid back; the sigmoid function is cheap."}], "answers": [{"comments": [{"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1527749652, "post_id": 50179617, "comment_id": 88246396, "body": "SetVec and AtVec <i>are</i> safe to use concurrently provided that they are not indexing the same element; the backing data for a <code>mat.VecDense</code> is a <code>blas64.Vector</code> in which the data elements are store in a <code>[]float64</code>. Indexing distinct elements in a slice is not a data race."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1527752204, "post_id": 50179617, "comment_id": 88247730, "body": "@kortschak Thanks for the clarification."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1525457121, "last_edit_date": 1525457121, "creation_date": 1525452023, "answer_id": 50179617, "question_id": 50179290, "link": "https://stackoverflow.com/questions/50179290/vectorise-a-function-taking-advantage-of-concurrency/50179617#50179617", "title": "Vectorise a function taking advantage of concurrency", "body": "<p>First note that this attempt to do computation concurrenty assumes that the <code>SetVec()</code> and <code>AtVec()</code> methods are safe for concurrent use with distinct indices. If this is not the case, the attempted solution is inherently unsafe and may result in data races and undefined behavior.</p>\n\n<hr>\n\n<p><code>wg.Done()</code> should be called to signal that the \"worker\" goroutine finished its work. But <em>only</em> when the goroutine finished its work.</p>\n\n<p>In your case it is not (only) the <code>sigmoid()</code> function that is run in the worker goroutine, but rather <code>zs.SetVec()</code>. So you should call <code>wg.Done()</code> when <code>zs.SetVec()</code> has returned, not sooner.</p>\n\n<p>One way would be to add a <code>wg.Done()</code> to the end of the <code>SetVec()</code> method (it could also be a <code>defer wg.Done()</code> at its beginning), but it wouldn't be feasible to introduce this dependency (<code>SetVec()</code> should not know about any wait groups and goroutines, this would seriously limit its usability).</p>\n\n<p>The easiest and cleanest way in this case would be to launch an anonymous function (a function literal) as the worker goroutine, in which you may call <code>zs.SetVec()</code>, and in which you may call <code>wg.Defer()</code> once the above mentioned function has returned.</p>\n\n<p>Something like this:</p>\n\n<pre><code>for i := 0; i &lt; zs.Len(); i++ {\n    wg.Add(1)\n    go func() {\n        zs.SetVec(i, sigmoid(zs.AtVec(i)))\n        wg.Done()\n    }()\n}\nwg.Wait()\n</code></pre>\n\n<p>But this alone <strong>won't</strong> work, as the function literal (closure) refers to the loop variable which is modified concurrently, so the function literal should work with its own copy, e.g.:</p>\n\n<pre><code>for i := 0; i &lt; zs.Len(); i++ {\n    wg.Add(1)\n    go func(i int) {\n        zs.SetVec(i, sigmoid(zs.AtVec(i)))\n        wg.Done()\n    }(i)\n}\nwg.Wait()\n</code></pre>\n\n<p>Also note that goroutines (although may be lightweight) do have overhead. If the work they do is \"small\", the overhead may outweight the performance gain of utilizing multiple cores / threads, and overall you might not gain performance by executing such small tasks concurrently (hell, you may even do worse than without using goroutines). Measure.</p>\n\n<p>Also you are using goroutines to do minimal work, you may improve performance by not \"throwing\" away goroutines once they're done with their \"tiny\" work, but you may \"reuse\" them. See related question: <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}], "owner": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 50179617, "answer_count": 1, "score": 0, "last_activity_date": 1525460589, "creation_date": 1525450736, "last_edit_date": 1525460589, "question_id": 50179290, "link": "https://stackoverflow.com/questions/50179290/vectorise-a-function-taking-advantage-of-concurrency", "title": "Vectorise a function taking advantage of concurrency", "body": "<p>For a simple neural network I want to apply a function to all the values of a gonum <code>VecDense</code>.</p>\n\n<p>Gonum has an <code>Apply</code> method for Dense matrices, but not for vectors, so I am doing this by hand: </p>\n\n<pre><code>func sigmoid(z float64) float64 {                                           \n    return 1.0 / (1.0 + math.Exp(-z))\n}\n\nfunc vSigmoid(zs *mat.VecDense) {\n    for i := 0; i &lt; zs.Len(); i++ {\n        zs.SetVec(i, sigmoid(zs.AtVec(i)))\n    }\n}\n</code></pre>\n\n<p>This seems to be an obvious target for concurrent execution, so I tried</p>\n\n<pre><code>var wg sync.WaitGroup\n\nfunc sigmoid(z float64) float64 {                                           \n    wg.Done()\n    return 1.0 / (1.0 + math.Exp(-z))\n}\n\nfunc vSigmoid(zs *mat.VecDense) {\n    for i := 0; i &lt; zs.Len(); i++ {\n        wg.Add(1)\n        go zs.SetVec(i, sigmoid(zs.AtVec(i)))\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>This doesn't work, perhaps not unexpectedly, as <code>Sigmoid()</code> doesn't end with <code>wg.Done()</code>, as the return statement (which does all the work) comes after it.</p>\n\n<p>My question is: How can I use concurrency to apply a function to each element of a gonum vector?</p>\n"}]