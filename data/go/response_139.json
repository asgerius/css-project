[{"tags": ["json", "amazon-web-services", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1504738772, "post_id": 46085404, "comment_id": 79133022, "body": "Besides the fact that there is already a multitude of sources for learning how to use the json package, why not just use the sdk that aws provides?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504747047, "post_id": 46085404, "comment_id": 79134838, "body": "create struct from that json object <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a> and unmarshal to that struct.  <a href=\"https://goplay.space/#fT1k1kJ96Q\" rel=\"nofollow noreferrer\">goplay.space/#fT1k1kJ96Q</a>"}], "answers": [{"tags": [], "owner": {"reputation": 144, "user_id": 8075949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeTbN.png?s=128&g=1", "display_name": "nk2ge5k", "link": "https://stackoverflow.com/users/8075949/nk2ge5k"}, "is_accepted": true, "score": 1, "last_activity_date": 1504796195, "last_edit_date": 1504796195, "creation_date": 1504738855, "answer_id": 46085497, "question_id": 46085404, "link": "https://stackoverflow.com/questions/46085404/parse-json-in-go/46085497#46085497", "title": "Parse JSON in Go", "body": "<p>It is something like this </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nvar jsonData = []byte(`\n{\n    \"Contents\": [{\n        \"ETag\": \"9e2bc2894b23742b7bb688c646c6fee9\",\n        \"Key\": \"DSC-0237.jpg\",\n        \"LastModified\": \"2017-09-06 21:53:15 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }, {\n        \"ETag\": \"\\\"9e2bc2894b23742b7bb688c646c6fee9\\\"\",\n        \"Key\": \"DSC-0238.jpg\",\n        \"LastModified\": \"2017-09-06 21:52:24 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }, {\n        \"ETag\": \"\\\"9e2bc2894b23742b7bb688c646c6fee9\\\"\",\n        \"Key\": \"DSC-0239.jpg\",\n        \"LastModified\": \"2017-09-06 21:53:01 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }],\n    \"IsTruncated\": false,\n    \"Marker\": \"\",\n    \"MaxKeys\": 5,\n    \"Name\": \"test-bucket-x011pp3\",\n    \"Prefix\": \"\"\n}`,\n)\n\ntype Response struct {\n    Contents    []*Content\n    IsTruncated bool\n    Marker      string\n    MaxKeys     int\n    Name        string\n    Prefix      string\n}\n\ntype Content struct {\n    ETag         string\n    Key          string\n    LastModified string\n    Owner        *Owner\n    Size         int\n    StroageClass string\n}\n\ntype Owner struct {\n    DisplayName string\n    ID          string\n}\n\nfunc main() {\n    resp := &amp;Response{}\n\n    if err := json.NewDecoder(bytes.NewBuffer(jsonData)).Decode(resp); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\", resp)\n}\n</code></pre>\n\n<p>Try it in the <a href=\"https://play.golang.org/p/7VCbWx9Fxz\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>And you should read this <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/</a></p>\n"}, {"tags": [], "owner": {"reputation": 236, "user_id": 1952208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3169d2b713b97c21d864ed1734d6852?s=128&d=identicon&r=PG", "display_name": "Adam Liechty", "link": "https://stackoverflow.com/users/1952208/adam-liechty"}, "is_accepted": false, "score": 1, "last_activity_date": 1504740324, "creation_date": 1504740324, "answer_id": 46085694, "question_id": 46085404, "link": "https://stackoverflow.com/questions/46085404/parse-json-in-go/46085694#46085694", "title": "Parse JSON in Go", "body": "<p>See <a href=\"https://golang.org/pkg/encoding/json\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json</a></p>\n\n<p>You annotate a struct with JSON fields that should be unmarshalled from the buffer of JSON, something like this:</p>\n\n<pre><code>type AWSObject struct {\n    Size  int            `json:\"Size\"`\n    Key   string         `json:\"key\"`\n    Owner AWSObjectOwner `json:\"Owner\"`\n}\n\ntype AWSObjectOwner struct {\n    DisplayName          `json:\"DisplayName\"`\n}\n\nvar awsObjects []AWSObject\nerr = json.Unmarshal(jsonBuffer, &amp;awsObjects)\nif err != nil {\n    fmt.Printf(\"Error unmarshaling objects: \" + err.Error() + \"\\n\")\n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1456, "user_id": 372047, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b6fc2723c333f224b2e3119516cfe88a?s=128&d=identicon&r=PG", "display_name": "David Siegel", "link": "https://stackoverflow.com/users/372047/david-siegel"}, "is_accepted": false, "score": 1, "last_activity_date": 1508524764, "creation_date": 1508524764, "answer_id": 46855366, "question_id": 46085404, "link": "https://stackoverflow.com/questions/46085404/parse-json-in-go/46855366#46855366", "title": "Parse JSON in Go", "body": "<p>Using <a href=\"https://quicktype.io?l=go\" rel=\"nofollow noreferrer\">quicktype</a>, I generated your model, marshaling code, and usage instructions:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// To parse this JSON data, add this code to your project and do:\n//\n//    r, err := UnmarshalListObjectsResponse(bytes)\n//    bytes, err = r.Marshal()\n\npackage main\n\nimport \"encoding/json\"\n\nfunc UnmarshalListObjectsResponse(data []byte) (ListObjectsResponse, error) {\n    var r ListObjectsResponse\n    err := json.Unmarshal(data, &amp;r)\n    return r, err\n}\n\nfunc (r *ListObjectsResponse) Marshal() ([]byte, error) {\n    return json.Marshal(r)\n}\n\ntype ListObjectsResponse struct {\n    Contents    []Content `json:\"Contents\"`\n    IsTruncated bool      `json:\"IsTruncated\"`\n    Marker      string    `json:\"Marker\"`\n    MaxKeys     int64     `json:\"MaxKeys\"`\n    Name        string    `json:\"Name\"`\n    Prefix      string    `json:\"Prefix\"`\n}\n\ntype Content struct {\n    ETag         string `json:\"ETag\"`\n    Key          string `json:\"Key\"`\n    LastModified string `json:\"LastModified\"`\n    Owner        Owner  `json:\"Owner\"`\n    Size         int64  `json:\"Size\"`\n    StorageClass string `json:\"StorageClass\"`\n}\n\ntype Owner struct {\n    DisplayName string `json:\"DisplayName\"`\n    ID          string `json:\"ID\"`\n}\n</code></pre>\n\n<p>As others suggested, it's probably best to use the <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">AWS SDK for Go</a>, but this method may be useful in general the next time you need to parse arbitrary JSON.</p>\n"}], "owner": {"reputation": 461, "user_id": 5253539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-9q1xBp-smn8/AAAAAAAAAAI/AAAAAAAAAtE/49pv4N4bqSQ/photo.jpg?sz=128", "display_name": "Shawn", "link": "https://stackoverflow.com/users/5253539/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 0, "accepted_answer_id": 46085497, "answer_count": 3, "score": -4, "last_activity_date": 1508524764, "creation_date": 1504738141, "question_id": 46085404, "link": "https://stackoverflow.com/questions/46085404/parse-json-in-go", "title": "Parse JSON in Go", "body": "<p>This is an example of JSON output when calling 'ListObjects' for AWS S3</p>\n\n<pre><code>{\n    \"Contents\": [{\n        \"ETag\": \"9e2bc2894b23742b7bb688c646c6fee9\",\n        \"Key\": \"DSC-0237.jpg\",\n        \"LastModified\": \"2017-09-06 21:53:15 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }, {\n        \"ETag\": \"\\\"9e2bc2894b23742b7bb688c646c6fee9\\\"\",\n        \"Key\": \"DSC-0238.jpg\",\n        \"LastModified\": \"2017-09-06 21:52:24 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }, {\n        \"ETag\": \"\\\"9e2bc2894b23742b7bb688c646c6fee9\\\"\",\n        \"Key\": \"DSC-0239.jpg\",\n        \"LastModified\": \"2017-09-06 21:53:01 +0000 UTC\",\n        \"Owner\": {\n            \"DisplayName\": \"demo-user\",\n            \"ID\": \"a9e2f170a6880f1d61852df8e523e88ca2a2b7abd093476cc93f1239ab5063c6\"\n        },\n        \"Size\": 117904,\n        \"StorageClass\": \"STANDARD\"\n    }],\n    \"IsTruncated\": false,\n    \"Marker\": \"\",\n    \"MaxKeys\": 5,\n    \"Name\": \"test-bucket-x011pp3\",\n    \"Prefix\": \"\"\n}\n</code></pre>\n\n<p>How do I parse this in Go? Chiefly I am interested in collecting:</p>\n\n<ul>\n<li>Bucket Name </li>\n<li>Key</li>\n<li>Size</li>\n<li>Owner's DisplayName</li>\n<li>LastModified</li>\n</ul>\n\n<p>I am coming from Python and in Python it would be something really simple like:</p>\n\n<pre><code>json_result = json.loads(json_string)\nbucket_name = json_result['Name']\nfor idx, obj in enumerate(json_result['Contents']):\n    key = obj['Key']\n    size = obj['Size']\n    lastmod = obj['LastModified']\n    owner= obj['Owner']['DisplayName']\n</code></pre>\n\n<p>Thank you for the help!</p>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1504739174, "post_id": 46085245, "comment_id": 79133133, "body": "The import path is the path to the package code. That is the convention the go tool follows."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 4, "creation_date": 1504739681, "post_id": 46085245, "comment_id": 79133254, "body": "Consider making the Go package (and any other stand-alone parts) their own project and repo. It will avoid many problems. Make another repo to pull them all together, if necessary, with <a href=\"http://www.nytimes.com/2009/01/11/us/11kinnard.html\" rel=\"nofollow noreferrer\">submodules</a>. Or even better, use a packaging tool to bring the pieces together."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1504800219, "post_id": 46085245, "comment_id": 79164084, "body": "There is no reason that libraries for multiple languages should all be in the same repo. They should each be in their own repositories."}, {"owner": {"reputation": 7266, "user_id": 136928, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3b45a5cf8cd1ab3fabb3de8a80fbc1a7?s=128&d=identicon&r=PG", "display_name": "sjlee", "link": "https://stackoverflow.com/users/136928/sjlee"}, "edited": false, "score": 0, "creation_date": 1504802719, "post_id": 46085245, "comment_id": 79165439, "body": "I agree normally you want to have a repo for each language. In this specific case, the repo is primarily a protobuf-based API. Obviously we have the proto files for the message definitions. And we have code-gen&#39;ed source for the languages we support. If we support, let&#39;s say, N languages, then we would need to create N+1 repos (one for the proto files, N for all the languages). Thus the question on how we can organize this into a single repo still."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504824142, "post_id": 46085245, "comment_id": 79175249, "body": "The fact that the path in the repo and the import path are the same is strictly a convention that the tools follow. Being able to <code>go get</code> from github is a convenience, and if you want that convenience you have to follow the convention. You can change that more or less transparently by inserting an intermediary server like gopkg.in, but that doesn&#39;t change how import paths work. You are free to move the code anywhere you want and rewrite the imports, which of course break other users of that code, but so would your hypothetical <code>go get</code> example which would require different imports."}], "answers": [{"tags": [], "owner": {"reputation": 39247, "user_id": 13760, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/d7951e5f68ad9562c47212f4e651edda?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/13760/carl"}, "is_accepted": false, "score": 2, "last_activity_date": 1594674253, "creation_date": 1594674253, "answer_id": 62884229, "question_id": 46085245, "link": "https://stackoverflow.com/questions/46085245/go-get-package-in-a-subdirectory-of-a-github-repo/62884229#62884229", "title": "go get package in a subdirectory of a github repo", "body": "<p>You've already answered the question yourself, so I'm just confirming that it is how you would do it.</p>\n<p>In your example, you would use: <code>go get -u github.com/foo/bar/src/main/go</code></p>\n<p>Sure, it doesn't look pretty, but keep in mind that most of the yuckiness comes from paths in your control.</p>\n<p>For example, it could be: <code>go get -u github.com/foo/bar/go</code></p>\n<p>I can confirm this works since this is what we use in production.</p>\n<p>By design, the go get path is where you would get it from. You do have another option - to use redirection (like <a href=\"https://labix.org/gopkg.in\" rel=\"nofollow noreferrer\">gopkg.in</a>). However, that comes with its own added complexity.</p>\n"}], "owner": {"reputation": 7266, "user_id": 136928, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3b45a5cf8cd1ab3fabb3de8a80fbc1a7?s=128&d=identicon&r=PG", "display_name": "sjlee", "link": "https://stackoverflow.com/users/136928/sjlee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2028, "favorite_count": 5, "answer_count": 1, "score": 8, "last_activity_date": 1594674253, "creation_date": 1504737162, "question_id": 46085245, "link": "https://stackoverflow.com/questions/46085245/go-get-package-in-a-subdirectory-of-a-github-repo", "title": "go get package in a subdirectory of a github repo", "body": "<p>If you have a go-only repo (let's say it's <a href=\"https://github.com/foo/bar\" rel=\"noreferrer\">https://github.com/foo/bar</a>), you can put your code right at the root level, and have others import using the following command:</p>\n\n<pre><code>go get -u github.com/foo/bar\n</code></pre>\n\n<p>Directories and subdirectories therein would be recognized as packages.</p>\n\n<p>But suppose you are creating a multi-language repo on github (e.g. one that has java code, go code, javascript code, etc.). And you want to make your go code available for others to use. Usually putting the go code right at the root level would be a no-no from the code organization standpoint. What might be more common may be</p>\n\n<pre><code>(root)\n  |-- src\n       |-- main\n            |-- go\n            |-- java\n            |-- javascript\n            |-- proto\n</code></pre>\n\n<p>The root level of your go code is now at <a href=\"https://github.com/foo/bar/src/main/go\" rel=\"noreferrer\">https://github.com/foo/bar/src/main/go</a>. But you can no longer use the previous <code>go get</code> command as it would look at the top level. You don't really want to use <code>go get -u github.com/foo/bar/src/main/go</code> either as all those would now become part of the package names which is real yucky.</p>\n\n<p>Question is, is there a way to specify an exact URL so that you can separate the package names and the URL? In other words, I'm looking for something like</p>\n\n<pre><code>go get -u github.com/foo/bar https://github.com/foo/bar/src/main/go\n</code></pre>\n\n<p>(of course the package names should match those that are actually in the source, otherwise it won't compile).</p>\n\n<p>I looked at the go documentation, but it isn't clear to me whether this is doable.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1504732353, "post_id": 46084388, "comment_id": 79130826, "body": "You cannot scan 16 columns into a single <code>name</code> string. You need to pass 16 pointer arguments to the <code>Scan</code> call. If you&#39;re interested only in the <code>name</code> instead of <code>SELECT * ...</code> do <code>SELECT name ...</code> or whatever the name of the column you want is."}], "answers": [{"comments": [{"owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "edited": false, "score": 0, "creation_date": 1504737749, "post_id": 46084566, "comment_id": 79132741, "body": "I&#39;m not sure I follow. Could you explain how do go about implementing a holder variable for each column?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "edited": false, "score": 0, "creation_date": 1504740023, "post_id": 46084566, "comment_id": 79133339, "body": "Updated with an example"}], "tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 3, "last_activity_date": 1504740510, "last_edit_date": 1504740510, "creation_date": 1504733141, "answer_id": 46084566, "question_id": 46084388, "link": "https://stackoverflow.com/questions/46084388/how-do-you-select-the-whole-table-in-postgres-using-golang-sql/46084566#46084566", "title": "How do you select the whole table in postgres using golang sql?", "body": "<p>Looks like your query is working just fine, you are returning 16 columns of data and trying to scan them all into a single string variable, you will need to provide a holder variable for each column:</p>\n\n<pre><code>var name string\n// vars to hold other column values go here\n\n// then reference vars in table order as args to row.Scan below\nif err := rows.Scan(&amp;name); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>if you have not used sql/go before you may also want to look into the special types provided for coping with nullable values as you will likely need these as well:</p>\n\n<p><a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">NullString example</a></p>\n\n<p><strong>Update:</strong></p>\n\n<p>To further illustrate, say you had a three column table which consisted of the following fields:</p>\n\n<ul>\n<li>id (int)</li>\n<li>name (string)</li>\n<li>optional_data (string, nullable)</li>\n</ul>\n\n<p>You might read the row as follows (not tested):</p>\n\n<pre><code>var (\n    id int \n    name string\n    optionalData sql.NullString\n)\n\nif err := rows.Scan(&amp;id, &amp;name, &amp;optionalData); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11596901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2df1855b25240579c581fa7baf3a46?s=128&d=identicon&r=PG&f=1", "display_name": "Frankstyl", "link": "https://stackoverflow.com/users/11596901/frankstyl"}, "is_accepted": false, "score": 1, "last_activity_date": 1561874347, "creation_date": 1561874347, "answer_id": 56822750, "question_id": 46084388, "link": "https://stackoverflow.com/questions/46084388/how-do-you-select-the-whole-table-in-postgres-using-golang-sql/56822750#56822750", "title": "How do you select the whole table in postgres using golang sql?", "body": "<p>Thanks a lot it was useful for me. but I would like to add a little bit more of information.\nwell I don't know what is your goalng's version but I'm using version  1.11.2 on windows/386 but when I added the parentheses this not worked. but without them it run perfect. </p>\n\n<p>use this:\n            rows, err := a.DB.Query(\"SELECT * FROM mytable\")\ninstead of :\n            rows, err := a.DB.Query(\"SELECT ( * ) FROM mytable\")</p>\n\n<p>and here is my example:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT * FROM words\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n    println(rows)\n    for rows.Next() {\n        var word, exa1, exa2, mean string\n        var id int\n        if err := rows.Scan(&amp;id, &amp;word, &amp;exa1, &amp;exa2, &amp;mean); err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"id: %d\\n word: %s \\n example1: %s \\n example2: %s \\n meaning: %s\\n---\\n\\n\", id, word, exa1, exa2, mean)\n    } \n\n  I hope this will be useful.\n</code></pre>\n"}], "owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2008, "favorite_count": 0, "accepted_answer_id": 46084566, "answer_count": 2, "score": 2, "last_activity_date": 1561874347, "creation_date": 1504732231, "question_id": 46084388, "link": "https://stackoverflow.com/questions/46084388/how-do-you-select-the-whole-table-in-postgres-using-golang-sql", "title": "How do you select the whole table in postgres using golang sql?", "body": "<p>I'm fairly new to posgres and Go, but have been struggling for a while on this. I'm currently trying to send a query to retrieve everything from a table.\nWhen I try to use</p>\n\n<pre><code>SELECT * FROM land_registry_price_paid_uk\n</code></pre>\n\n<p>within postgres, it shows everything, but when I do the same using Query, I get.</p>\n\n<pre><code>sql: expected 16  destination arguments in Scan, not 1\n</code></pre>\n\n<p>This is the current code that I have.</p>\n\n<pre><code>fmt.Printf(\"user: %s, password: %s, dbName: %s\", user, password, dbName)\nconnectionString := fmt.Sprintf(\"user=%s password=%s dbname=%s sslmode=%s\", user, password, dbName, \"disable\")\nvar err error\na.DB, err = sql.Open(\"postgres\", connectionString)\nif err != nil {\n    log.Fatal(err)\n}\nrows, err := a.DB.Query(\"SELECT ( * ) FROM land_registry_price_paid_uk\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer rows.Close()\nprintln(rows)\nfor rows.Next() {\n    var name string\n    if err := rows.Scan(&amp;name); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"this is something: %s\\n\", name)\n</code></pre>\n\n<p>Any help is appreciated. </p>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 5163, "user_id": 1435461, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/05f6236ee5ec04b27e27f504ebdd3744?s=128&d=identicon&r=PG", "display_name": "rcorre", "link": "https://stackoverflow.com/users/1435461/rcorre"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504725693, "post_id": 46082687, "comment_id": 79127566, "body": "I see, thanks. I guess that&#39;s the answer, then?"}, {"owner": {"reputation": 5163, "user_id": 1435461, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/05f6236ee5ec04b27e27f504ebdd3744?s=128&d=identicon&r=PG", "display_name": "rcorre", "link": "https://stackoverflow.com/users/1435461/rcorre"}, "edited": false, "score": 1, "creation_date": 1504802669, "post_id": 46082687, "comment_id": 79165405, "body": "Anyone care to explain the downvotes? Are spec-related questions off-topic? Or did I just not do enough research? I did read what I thought were the relevant sections of the spec, but missed the connection between <code>type identity</code> and <code>Selectors</code>. Nonetheless I learned something about go, so thanks for the answers."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 6, "last_activity_date": 1504725905, "creation_date": 1504725905, "answer_id": 46082914, "question_id": 46082687, "link": "https://stackoverflow.com/questions/46082687/why-cant-a-struct-be-converted-to-an-embedded-type/46082914#46082914", "title": "Why can&#39;t a struct be converted to an embedded type", "body": "<p><code>Outer</code> does not have a field <code>x</code>. It has a field <code>Inner</code>, which has a field <code>x</code>. When accessing <code>.x</code>, the selector (<code>.</code>) will automatically promote an embedded field from the shallowest depth where there is such an <code>x</code>.</p>\n\n<p>See the spec on <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"noreferrer\">Selectors</a></p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1587432373, "post_id": 46083771, "comment_id": 108503962, "body": "To compile <code>inner</code> needs to be <code>Inner</code> and <code>outer</code> needs to be <code>Outer</code>."}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 1, "last_activity_date": 1587447166, "last_edit_date": 1587447166, "creation_date": 1504729451, "answer_id": 46083771, "question_id": 46082687, "link": "https://stackoverflow.com/questions/46082687/why-cant-a-struct-be-converted-to-an-embedded-type/46083771#46083771", "title": "Why can&#39;t a struct be converted to an embedded type", "body": "<p>The following code snippet is used to support JimB's answer - <code>Inner</code> and <code>Outer</code> doesn't share the same sequence of fields and therefore aren't eligible for conversion. </p>\n\n<p>It will help you to literally see the difference between the <code>Inner</code> and <code>Outer</code> types:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype inner struct {\n    x int\n}\n\ntype outer struct {\n    inner\n}\n\nfunc main() {\n    in := inner{x: 1}\n    fmt.Printf(\"inner: %+v\\n\", in)\n    fmt.Println()\n    out := outer{in}\n    fmt.Printf(\"outer: %+v\\n\", out)\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 5163, "user_id": 1435461, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/05f6236ee5ec04b27e27f504ebdd3744?s=128&d=identicon&r=PG", "display_name": "rcorre", "link": "https://stackoverflow.com/users/1435461/rcorre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1012, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1587447166, "creation_date": 1504725010, "question_id": 46082687, "link": "https://stackoverflow.com/questions/46082687/why-cant-a-struct-be-converted-to-an-embedded-type", "title": "Why can&#39;t a struct be converted to an embedded type", "body": "<pre><code>package main\n\ntype Inner struct {\n    x int\n}\n\ntype Outer struct {\n    Inner\n}\n\nfunc main() {\n    x := Inner{1}\n    y := (Outer)(x) // cannot convert x (type Inner) to type Outer\n}\n</code></pre>\n\n<p>The go spec section on <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversions</a> claims that</p>\n\n<blockquote>\n  <p>A non-constant value x can be converted to type T in any of these cases:\n  ...\n  Ignoring struct tags (see below), x's type and T have identical underlying types.\n  ...</p>\n</blockquote>\n\n<p>The section on <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">type identity</a> says:</p>\n\n<blockquote>\n  <p>Two struct types are identical if they have the same sequence of fields, and if corresponding fields have the same names, and identical types, and identical tags.</p>\n</blockquote>\n\n<p>It is my understanding that both <code>Inner</code> and <code>Outer</code> have a single field <code>x</code> which is an <code>int</code>. So why can't I convert an <code>Outer</code> to an <code>Inner</code>?</p>\n\n<p>I eventually figured out that I can use <code>x.Inner</code>, but it took me a while, so I'm curious why the (in my opinion) more obvious approach is disallowed.</p>\n"}, {"tags": ["go", "twilio", "twilio-api"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1504723161, "post_id": 46082157, "comment_id": 79126228, "body": "Seems like you need Twilio tech support, not Stack Overflow..."}, {"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 1, "creation_date": 1504724574, "post_id": 46082157, "comment_id": 79127002, "body": "Did you code in a retry mechanism? You will have to be able to handle connectivity issues potentially, and 500 return codes may be resolved by a retry."}, {"owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "edited": false, "score": 0, "creation_date": 1504729119, "post_id": 46082157, "comment_id": 79129300, "body": "No. 500 status code is way too broad to trust a retry this early. I honestly think their hypermedia <code>next_page_uri</code> doesn&#39;t work as expected."}, {"owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504729201, "post_id": 46082157, "comment_id": 79129335, "body": "@Adrian I have a ticket open, but I thought stackoverflow was a place to ask about previous experiences with the API."}], "owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1504722911, "creation_date": 1504722911, "question_id": 46082157, "link": "https://stackoverflow.com/questions/46082157/obtaining-calls-for-entire-month", "title": "Obtaining Calls for Entire Month", "body": "<p>I want to page through an entire month's worth of Calls usage in a report. Unfortunately, I'm experiencing random 500 errors from the API.</p>\n\n<p>First I initialize the first page call to /Calls.json</p>\n\n<pre><code>// Set initial baseUrl\nurlStr := \"https://api.twilio.com/2010-04-01/Accounts/\" + accountSid + \"/Calls.json\"\nbaseUrl, err := url.Parse(urlStr)\nif err != nil {\n    panic(err)\n}\n\n// Build query parameters and URL\nv := url.Values{}\nv.Set(\"StartTime&gt;\", \"2017-08-01\")\nv.Set(\"StartTime&lt;\", \"2017-08-02\")\nv.Set(\"To\", os.Args[1])\nv.Set(\"PageSize\", \"1000\")\nv.Set(\"Page\", \"0\")\nbaseUrl.RawQuery = v.Encode()\n\n// Begin recursive call\npageNext(baseUrl)\n</code></pre>\n\n<p>I then determine if there is a \"next page\" by checking the response property <code>next_page_uri</code>, if the property is not blank then I proceed to recursively call the API with the previous calls <code>next_page_uri</code> query.</p>\n\n<p>Each time I end up with a 500 error, sometimes within the first call and sometimes it is after 100-ish calls.</p>\n\n<p>Is this really the best way to obtain such a report?</p>\n"}, {"tags": ["http", "go", "connection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1504722923, "post_id": 46082079, "comment_id": 79126092, "body": "You&#39;re not measuring what you think you are. Not only does your first example open a new connection every time, but it leaks the connections after returning. Never discard an <code>http.Transport</code>, or you will leak connections. What is the actual problem you&#39;re trying to solve?"}, {"owner": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504726329, "post_id": 46082079, "comment_id": 79127887, "body": "I&#39;m trying to get consistent results from the page load for stress-testing purposes (this is a simplified version - ultimately will be from multiple processes), so I am trying to simulate/create a new connection every time (and close it properly). Clearly something is being maintained in the pageload measurements #2-#5 within the loop. I&#39;m assuming it is using the same connection... but can&#39;t tell."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504726619, "post_id": 46082079, "comment_id": 79128035, "body": "It can&#39;t possibly be using the same connection, because you&#39;re using a new Transport every time. I would guess it&#39;s your resolver cache making the difference. Rather than guessing, inspect the actual connections being made. There is also <code>Request.Close</code> field to set the header automatically."}, {"owner": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504728418, "post_id": 46082079, "comment_id": 79128940, "body": "Yes, that&#39;s why I had put the Transport in the function, thinking it would create a new one each call (new to this) to recreate the overhead from zero. The resolver cache is something to explore, although I get similar results if I execute the code over and over, so whatever is being cached is being released after each execution, and it seems like any kind of DNS caching would be maintained beyond execution of the code. Hmmm......"}, {"owner": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504728603, "post_id": 46082079, "comment_id": 79129035, "body": "One other note...same results on both Windows &amp; Ubuntu."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504728795, "post_id": 46082079, "comment_id": 79129138, "body": "and from a macOS system: <code>0.105452258 0.103022324 0.237812677 0.107968977 0.094626029</code>. Don&#39;t guess, make sure you&#39;re measuring exactly what you want to measure."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "edited": false, "score": 0, "creation_date": 1504733913, "post_id": 46083701, "comment_id": 79131506, "body": "I did try this.... same results though, the first measurement is substantially longer."}, {"owner": {"reputation": 346, "user_id": 1372414, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qURMu.jpg?s=128&g=1", "display_name": "Juan Leung", "link": "https://stackoverflow.com/users/1372414/juan-leung"}, "reply_to_user": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "edited": false, "score": 0, "creation_date": 1504744735, "post_id": 46083701, "comment_id": 79134343, "body": "Oh ok, know I get it, could be resolving the hostname the cause for the first one to take longer? You can test it with a IP address and see if the first one still taking more time"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504793667, "post_id": 46083701, "comment_id": 79159316, "body": "If you&#39;re going to do it correctly, you need to check the error first, and you should attempt to consume the response body before closing it. This also has the same problem as the original where it will leak connections in from the <code>http.Transport</code>"}], "tags": [], "owner": {"reputation": 346, "user_id": 1372414, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qURMu.jpg?s=128&g=1", "display_name": "Juan Leung", "link": "https://stackoverflow.com/users/1372414/juan-leung"}, "is_accepted": false, "score": -1, "last_activity_date": 1504729956, "last_edit_date": 1504729956, "creation_date": 1504729115, "answer_id": 46083701, "question_id": 46082079, "link": "https://stackoverflow.com/questions/46082079/golang-cant-seem-to-drop-http-connections/46083701#46083701", "title": "golang - can&#39;t seem to drop http connections", "body": "<p>I think you need to assign the response from the GET to a variable and then close the connection with <code>response.Body.Close()</code></p>\n\n<pre><code>func getloadtime (url string) float64 {\n\n    // setup client\n    tr := &amp;http.Transport{\n        DisableKeepAlives: true}\n    client := &amp;http.Client{Transport:tr}\n\n    // page load and measure\n    start := time.Now()\n    response, _ := client.Get(url)\n    response.Body.Close()\n\n    return(time.Since(start).Seconds())\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 3075582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b325166527d04ed5c21aec9b0409a776?s=128&d=identicon&r=PG&f=1", "display_name": "Silver Bullet", "link": "https://stackoverflow.com/users/3075582/silver-bullet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 978, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504729956, "creation_date": 1504722602, "question_id": 46082079, "link": "https://stackoverflow.com/questions/46082079/golang-cant-seem-to-drop-http-connections", "title": "golang - can&#39;t seem to drop http connections", "body": "<p>I'm trying to measure successive load times of a URL, but have been unable to drop an http connection and start fresh with each measurement. With this code...</p>\n\n<pre><code>func getloadtime (url string) float64 {\n\n    // setup client\n    tr := &amp;http.Transport{\n        DisableKeepAlives: true}\n    client := &amp;http.Client{Transport:tr}\n\n    // page load and measure\n    start := time.Now()\n    _, _ = client.Get(url)\n\n    return(time.Since(start).Seconds())\n}\n\nfunc main () {\n    for i := 0; i &lt; 5; i++ {\n        fmt.Println(getloadtime(\"http://www.google.com\"))\n    }\n}\n</code></pre>\n\n<p>I get measurements like this:</p>\n\n<pre><code>2.75\n0.13\n0.09\n0.12\n0.115\n</code></pre>\n\n<p>So it appears the http connection is being maintained from the initial load since the subsequent loads are much faster. I have also tried setting \"Connection\" to \"Close\" in the header, but get the same results:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\nreq.Header.Set(\"Connection\", \"close\")\n_, _ := client.Do(req)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1504722272, "post_id": 46081919, "comment_id": 79125777, "body": "You can do that by making the <code>id</code> field of the <code>struct</code> have a custom type and  have that type implement the <code>json.Unmarshaler</code> interface. Just make sure the <code>id</code> field is actually exported or else it won&#39;t get decoded."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1504722299, "post_id": 46081919, "comment_id": 79125791, "body": "Postprocess. basically undoable during unmarshaling if you do not provid your own unmarshaler (too much)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504723566, "post_id": 46081919, "comment_id": 79126439, "body": "If you&#39;re looking into customizing unmarshalling, you must already know it&#39;s possible, so... what exactly is your question?"}, {"owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504724014, "post_id": 46081919, "comment_id": 79126693, "body": "I&#39;m having some problems actually implementing the custom unmarshalling. I was trying to do it on the whole struct itself. But it as @mkopriva mentioned, its supposed to be done on the id field itself."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504725424, "post_id": 46081919, "comment_id": 79127409, "body": "@Sakib something like this <a href=\"https://play.golang.org/p/J6iadpsTgO\" rel=\"nofollow noreferrer\">play.golang.org/p/J6iadpsTgO</a>"}, {"owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "edited": false, "score": 0, "creation_date": 1504736372, "post_id": 46081919, "comment_id": 79132345, "body": "yeah that is what I am looking for, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 3, "last_activity_date": 1504735576, "last_edit_date": 1504735576, "creation_date": 1504725561, "answer_id": 46082820, "question_id": 46081919, "link": "https://stackoverflow.com/questions/46081919/golang-remove-string-prefix-when-unmarshalling-json/46082820#46082820", "title": "Golang remove string prefix when unmarshalling JSON", "body": "<p>You can provide a custom UnmarshalJSON method on the data you need to trim, here is an example implementation, you may need to extend if you have to regex match the start rather than match hard string (or byte array in this case):</p>\n\n<p><a href=\"https://play.golang.org/p/-pK3LHdTss\" rel=\"nofollow noreferrer\">go playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"log\"\n)\n\nvar (\n    sampleJSON   = []byte(`{\"id\": \"urn:uuid:1234567890\"}`)\n    prefixToTrim = []byte(`urn:uuid:`)\n)\n\ntype IDField string\n\ntype Data struct {\n    ID IDField `json:\"id\"`\n}\n\nfunc main() {\n    d := &amp;Data{}\n    err := json.Unmarshal(sampleJSON, d)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(d.ID)\n}\n\n// UnmarshalJSON provides custom unmarshalling to trim `urn:uuid:` prefix from IDField\nfunc (id *IDField) UnmarshalJSON(rawIDBytes []byte) error {\n\n    // trim quotes and prefix\n    trimmedID := bytes.TrimPrefix(bytes.Trim(rawIDBytes, `\"`), prefixToTrim)\n\n    // convert back to id field &amp; assign\n    *id = IDField(trimmedID)\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1539, "favorite_count": 0, "accepted_answer_id": 46082820, "answer_count": 1, "score": 0, "last_activity_date": 1504735576, "creation_date": 1504722017, "last_edit_date": 1504722122, "question_id": 46081919, "link": "https://stackoverflow.com/questions/46081919/golang-remove-string-prefix-when-unmarshalling-json", "title": "Golang remove string prefix when unmarshalling JSON", "body": "<p>In my json data structure I have a string that can have a prefix. When unmarshalling JSON, is it possible to have a function to remove that prefix? I am looking into custom JSON unmarshalling in golang and trying to leverage that.</p>\n\n<p>For example. The payload can be either of the following</p>\n\n<pre><code>{\n  \"id\": \"urn:uuid:1234567890\"\n}\n\n{\n  \"id\": \"1234567890\"\n}\n</code></pre>\n\n<p>When I do <code>JSON.unmarshall(data, &amp;struct)</code> I'd like the unmarshall function to handle removing the <code>urn:uuid</code> prefix from the string if it is there so the struct will always have the value <code>1234567890</code> for <code>id</code>.</p>\n"}, {"tags": ["arrays", "function", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504719906, "post_id": 46081296, "comment_id": 79124463, "body": "@CeriseLim&#243;n per the question &quot;I want to feed different kinds of slices&quot;."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1504719923, "post_id": 46081296, "comment_id": 79124472, "body": "If the argument is an empty interface, you&#39;ll have to use the <code>reflect</code>  package to do what you want. See <a href=\"https://golang.org/pkg/reflect\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect</a>. You might want to think about defining a specific interface that defines methods that perform whatever operations you need to perform on the objects you&#39;re passing in."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504720121, "post_id": 46081296, "comment_id": 79124594, "body": "If you&#39;re working with different kinds of slices, you must already be using reflection or asserting them to concrete types. How are you using <code>data</code> already that you can&#39;t get the length?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504721776, "post_id": 46081296, "comment_id": 79125501, "body": "Wouldn&#39;t it just be easier to pass the length in <code>func plot (data interface{}, length int)</code>?  Assuming it&#39;s not an <code>interface{}</code> type before passing it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504722108, "post_id": 46081296, "comment_id": 79125691, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14025833/range-over-interface-which-stores-a-slice\" title=\"range over interface which stores a slice\">stackoverflow.com/questions/14025833/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1504720706, "creation_date": 1504720706, "answer_id": 46081591, "question_id": 46081296, "link": "https://stackoverflow.com/questions/46081296/go-how-to-get-length-of-slice-in-function/46081591#46081591", "title": "Go: How to get length of slice in function?", "body": "<p>You should try to avoid using interface{} whenever possible. What you want to do can be done with reflection, but reflection is a necessary evil. It is really good for marshalling, but should be used sparingly. If you still want to use reflect, you can do something like this:</p>\n\n<pre><code>func plot(data interface{}) {\n    s := reflect.ValueOf(data)\n    if s.Kind() != reflect.Slice {\n        panic(\"plot() given a non-slice type\")\n    }\n\n    for i := 0; i &lt; s.Len(); i++ {\n        v := s.Index(i)\n        ...\n    }\n}\n</code></pre>\n\n<p>Even after doing this, v is a <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\">reflect.Value</a>. You will then need to somehow convert that to something useful. Luckily, Value has many methods that can be used to convert it. In this case, <code>v.Int()</code> would return the value as an int64.</p>\n"}, {"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": false, "score": 1, "last_activity_date": 1504720733, "creation_date": 1504720733, "answer_id": 46081599, "question_id": 46081296, "link": "https://stackoverflow.com/questions/46081296/go-how-to-get-length-of-slice-in-function/46081599#46081599", "title": "Go: How to get length of slice in function?", "body": "<p>As hinted in comments you would have to use reflection to do this, something like the following:</p>\n\n<pre><code>var sliceLen int\n\nswitch reflect.TypeOf(data).Kind() {\n\n    case reflect.Slice:\n        sliceLen = s.Len();\n    default:\n        //error here, unexpected\n    }\n}\n</code></pre>\n\n<p>Although go provides reflection to do these little tricks when you need to (as well as many other uses), it is often better to avoid wherever possible to maintain compiler type safety and performance, consider the pros/cons of having separate functions for different data types over this approach</p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1343, "favorite_count": 1, "accepted_answer_id": 46081591, "answer_count": 2, "score": -1, "last_activity_date": 1504720733, "creation_date": 1504719498, "question_id": 46081296, "link": "https://stackoverflow.com/questions/46081296/go-how-to-get-length-of-slice-in-function", "title": "Go: How to get length of slice in function?", "body": "<p>I've got a function to which I want to feed different kinds of slices after which I want to loop over them and print their contents. The following code works:</p>\n\n<pre><code>func plot(data interface{}){\n    fmt.Println(data)\n    //fmt.Println(len(data))\n}\n\nfunc main() {\n    l := []int{1, 4, 3}\n    plot(l)\n}\n</code></pre>\n\n<p>But when I uncomment the line in which I print the length of the slice, I get an error saying <code>invalid argument data (type interface {}) for len</code>.</p>\n\n<p>Any idea how I would be able to get the length of the slice so that I can loop over it?</p>\n"}, {"tags": ["class", "go", "data-structures", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504712165, "post_id": 46079222, "comment_id": 79119894, "body": "Don&#39;t use <code>self</code>; use a descriptive name instead."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1504712186, "post_id": 46079222, "comment_id": 79119908, "body": "You&#39;re missing pointers. Maybe start with the <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Tour of Go</a>, which covers all the basics, including <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">pointers</a>"}, {"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1504712254, "post_id": 46079222, "comment_id": 79119949, "body": "Do you really have to downvote this one?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1504712314, "post_id": 46079222, "comment_id": 79119988, "body": "Duplicate, the 20ths."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 1, "creation_date": 1504712389, "post_id": 46079222, "comment_id": 79120030, "body": "@akond: downvote = &quot;This question does not show any research effort.&quot; Asking this question for the Nth time doesn&#39;t show research effort."}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1504712467, "post_id": 46079271, "comment_id": 79120093, "body": "To whomever downvoted this question; why did you downvote? The solution seems to work perfect."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 1, "last_activity_date": 1504712499, "last_edit_date": 1504712499, "creation_date": 1504712157, "answer_id": 46079271, "question_id": 46079222, "link": "https://stackoverflow.com/questions/46079222/how-to-save-data-in-go-struct-from-function-method/46079271#46079271", "title": "How to save data in Go struct from function/method?", "body": "<p>You should use pointer in struct method <code>func (self *MyStruct) add(another_number int) int</code> as without the <code>*</code> variable (self) is passed by value, not by references. E.g. you are updating a copy of an original object and this changes are discarded.</p>\n\n<p>It's a basic stuff and well covered in <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Tour of Go</a> - everyone should take it before starting coding in Go.</p>\n\n<p>Another option would be return the <code>self</code> from the method - it would follow \"immutable\" style so you can write code like: <code>my_struct = my_struct.add(1).add(2)</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyStruct struct {\n    the_number int\n}\nfunc (self *MyStruct) add(another_number int) int {\n    self.the_number += another_number\n    return self.the_number\n}\n\nfunc main() {\n    my_struct := MyStruct{1}\n    result := my_struct.add(2)\n    fmt.Println(result)               // prints out 3 as expected\n    fmt.Println(my_struct.the_number) // prints out 1. Why not also 3?\n}\n</code></pre>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1740, "favorite_count": 0, "closed_date": 1504712879, "accepted_answer_id": 46079271, "answer_count": 1, "score": -1, "last_activity_date": 1504713274, "creation_date": 1504712016, "question_id": 46079222, "link": "https://stackoverflow.com/questions/46079222/how-to-save-data-in-go-struct-from-function-method", "closed_reason": "Duplicate", "title": "How to save data in Go struct from function/method?", "body": "<p>I'm just starting out with Go and I'm having a hard time saving data in a <code>struct</code>. Coming from other languages I learned there is no such thing as a <code>class</code> in Go. For similar purposes, the <code>struct</code> can be used, and functions can be \"added\" to the struct. So I wrote the following simple program:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyStruct struct {\n    the_number int\n}\nfunc (self MyStruct) add(another_number int) int {\n    self.the_number += another_number  // I save the result to the struct the_number\n    return self.the_number\n}\n\nfunc main() {\n    my_struct := MyStruct{1}\n    result := my_struct.add(2)\n    fmt.Println(result)               // prints out 3 as expected\n    fmt.Println(my_struct.the_number) // prints out 1. Why not also 3?\n}\n</code></pre>\n\n<p>As you can see from the comments I'm puzzled by the fact that the result is not saved in <code>self.the_number</code> in the instantiated <code>my_struct</code>.</p>\n\n<p>So I found out I can get around this by doing</p>\n\n<pre><code>my_struct.the_number = my_struct.add(2)\n</code></pre>\n\n<p>But I methods/functions can sometimes become complex in which I want to save a lot of data to the <code>my_struct</code> from within the function.</p>\n\n<p>Could any smarter soul than me give me a tip on what I'm missing here?</p>\n\n<p>How can I save data to an instantiated <code>struct</code> from within a function?</p>\n"}, {"tags": ["go", "wget"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1504710542, "post_id": 46078685, "comment_id": 79118824, "body": "I&#39;m not sure what &quot;bug&quot; you&#39;re referring to. In one case you&#39;re executing <code>wget</code> through a shell, which will interpret quotes for you, and in the other you are executing a binary directly, which doesn&#39;t lex the arguments like a shell. These are two different things, so you&#39;re essentially asking &quot;why does a shell parse quotes like a shell?"}, {"owner": {"reputation": 639, "user_id": 2062073, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93d988e82aa789487c174bb4d31ff350?s=128&d=identicon&r=PG", "display_name": "Ahti Ahde", "link": "https://stackoverflow.com/users/2062073/ahti-ahde"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507283503, "post_id": 46078685, "comment_id": 80157767, "body": "Yes, that is the case; edited the question so that it doesn&#39;t suggest this is a Golang feature or a bug. Considered deleting the question, but then again someone might end up with similar misconsideration as I did. In case people think, that this is not helpful question-answer, maybe we should delete it."}], "answers": [{"comments": [{"owner": {"reputation": 639, "user_id": 2062073, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93d988e82aa789487c174bb4d31ff350?s=128&d=identicon&r=PG", "display_name": "Ahti Ahde", "link": "https://stackoverflow.com/users/2062073/ahti-ahde"}, "edited": false, "score": 0, "creation_date": 1504713719, "post_id": 46078762, "comment_id": 79120868, "body": "Thanks; didn&#39;t think about &quot;not having a shell in-between&quot; thing.  I was using wget, since the performance is not that important in many cases, as websites have requests per second limits. Instead by building &quot;wget scripts&quot; I can share them with people, who are not using Golang. So in a sense I am experimenting with a programming language agnostic scraping process: wget (uri + params) -&gt; jQuery like HTML processor -&gt; json.  Depending on wget and jQuery style configuration and a declarative program to interpret those, would allow wider reusability. But in the end I am just coding for fun."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1504710561, "creation_date": 1504710561, "answer_id": 46078762, "question_id": 46078685, "link": "https://stackoverflow.com/questions/46078685/what-causes-this-golang-os-exec-behavior-escaped-double-quotes/46078762#46078762", "title": "What causes this golang os.Exec behavior (escaped double quotes)?", "body": "<p>When you execute the command in your shell, the shell processes the quotes <em>and they aren't passed to the program you're executing</em>. When you execute a command in Go, there is no shell processing involved, so the quotes are passed through. Since the program isn't expecting them, they get passed through directly in the request body, and the server responds with an error.</p>\n\n<p>Unrelated to your issue, but if you don't have a specific reason to use wget, you'd get far better performance using the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">built-in HTTP client</a> than forking out to wget for every request.</p>\n"}], "owner": {"reputation": 639, "user_id": 2062073, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/93d988e82aa789487c174bb4d31ff350?s=128&d=identicon&r=PG", "display_name": "Ahti Ahde", "link": "https://stackoverflow.com/users/2062073/ahti-ahde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 46078762, "answer_count": 1, "score": -1, "last_activity_date": 1507283190, "creation_date": 1504710310, "last_edit_date": 1507283190, "question_id": 46078685, "link": "https://stackoverflow.com/questions/46078685/what-causes-this-golang-os-exec-behavior-escaped-double-quotes", "title": "What causes this golang os.Exec behavior (escaped double quotes)?", "body": "<p>I have the following code:</p>\n\n<pre><code>for i := 0; i &lt; 1; i++ {\n    wait := rand.Int63n(150) + 300\n    time.Sleep(time.Millisecond * time.Duration(wait))\n    //\n    useragent := \"--user-agent='Mozilla/5.0 (X11; CrOS armv7l 8872.76.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.105 Safari/537.36'\"\n    outDirectory := \"--output-document=temp/review-\" + strconv.Itoa(i) + \".html\"\n    header := \"--header=\\\"Content-Type: application/x-www-form-urlencoded;charset=utf-8\\\"\"\n    uri := \"https://play.google.com/store/getreviews\"\n    payload := \"--post-data=id=fi.danskebank.mobilepay&amp;reviewSortOrder=2&amp;xhr=1&amp;reviewType=0&amp;pageNum=\" + strconv.Itoa(i)\n    cmd := exec.Command(\"wget\", useragent, outDirectory, header, uri, payload)\n    fmt.Println(strings.Join(cmd.Args, \" \"))\n    bytes, _ := cmd.CombinedOutput()\n    fmt.Println(string(bytes))\n}\nfmt.Println(\"Finished crawling\")\n</code></pre>\n\n<p>If I change the payload line from</p>\n\n<pre><code>payload := \"--post-data=id=fi.danskebank.mobilepay&amp;reviewSortOrder=2&amp;xhr=1&amp;reviewType=0&amp;pageNum=\" + strconv.Itoa(i)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>payload := \"--post-data=\\\"id=fi.danskebank.mobilepay&amp;reviewSortOrder=2&amp;xhr=1&amp;reviewType=0&amp;pageNum=\" + strconv.Itoa(i) + \"\\\"\"\n</code></pre>\n\n<p>It will return Server Error 500, even though when running the corresponding <code>wget</code>:</p>\n\n<pre><code>wget --user-agent='Mozilla/5.0 (X11; CrOS armv7l 8872.76.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.105 Safari/537.36' --output-document=temp/review-0.html --header=\"Content-Type: application/x-www-form-urlencoded;charset=utf-8\" https://play.google.com/store/getreviews --post-data=\"id=fi.danskebank.mobilepay&amp;reviewSortOrder=2&amp;xhr=1&amp;reviewType=0&amp;pageNum=0\"\n</code></pre>\n\n<p>It will have same response as the post-data without escaped quotes.</p>\n\n<p>Why does Golang os.Exec result in this behavior?</p>\n"}, {"tags": ["python", "ssl", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1504698348, "post_id": 46071843, "comment_id": 79109441, "body": "Why not just <code>tls.Dial</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 80, "user_id": 2595249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c75d437b144e242d4a6c487b351376f6?s=128&d=identicon&r=PG", "display_name": "sirackh", "link": "https://stackoverflow.com/users/2595249/sirackh"}, "is_accepted": false, "score": 0, "last_activity_date": 1504707301, "creation_date": 1504707301, "answer_id": 46077571, "question_id": 46071843, "link": "https://stackoverflow.com/questions/46071843/ssl-wrap-socket-implementation-in-go/46077571#46077571", "title": "ssl.wrap_socket implementation in go", "body": "<p>Wrong question to ask.</p>\n\n<p>A simple tls.Dial will do!</p>\n"}], "owner": {"reputation": 80, "user_id": 2595249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c75d437b144e242d4a6c487b351376f6?s=128&d=identicon&r=PG", "display_name": "sirackh", "link": "https://stackoverflow.com/users/2595249/sirackh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1504707301, "creation_date": 1504690871, "question_id": 46071843, "link": "https://stackoverflow.com/questions/46071843/ssl-wrap-socket-implementation-in-go", "title": "ssl.wrap_socket implementation in go", "body": "<p>In python you can wrap a standard socket with ssl. Detailed doc can be found here, <a href=\"https://docs.python.org/2/library/ssl.html\" rel=\"nofollow noreferrer\">https://docs.python.org/2/library/ssl.html</a></p>\n\n<p>I want something similar in go. Here is my attempt.</p>\n\n<pre><code>func GetSSLWrappedConnection() (SSLWrappedConnection net.Conn, err error){\n\nfmt.Println(\"Initialiazing proxy connection\")\nrawConn, er_ := net.Dial(\"tcp\", \"127.0.0.1:8080\")\nif  er_ != nil {\n    return nil, fmt.Errorf(\"Can't establish connection with remote server!\")\n} else {\n    // now we need to wrap the connection (SSL Wrap)\n    var TLSconfig *tls.Config\n    TLSconfig = &amp;tls.Config{\n                InsecureSkipVerify: true}\n\n    ssl_wrapped_connection := tls.Client(rawConn, TLSconfig)\n    err = ssl_wrapped_connection.Handshake()\n\n    if err != nil {\n        fmt.Println(err)\n        rawConn.Close()\n        return nil, err\n    }\n    return ssl_wrapped_connection, nil\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Is this the correct implementation?</p>\n"}, {"tags": ["go", "web", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 713, "user_id": 2509009, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/fSGP4.jpg?s=128&g=1", "display_name": "asadnwfp", "link": "https://stackoverflow.com/users/2509009/asadnwfp"}, "is_accepted": false, "score": 0, "last_activity_date": 1505141636, "creation_date": 1505141636, "answer_id": 46158644, "question_id": 46071453, "link": "https://stackoverflow.com/questions/46071453/grpc-and-http-1-call-on-single-port-with-out-using-tls-in-golang/46158644#46158644", "title": "gRPC and HTTP 1 call on single port, with out using TLS in goLang", "body": "<p><code>gRPC Service</code> can be achieved with out the implementation of <code>TLS</code> by using go routines.<br /><br />\n<b>Create a Function, Serving your gRPC</b></p>\n\n<pre><code>func RunGRPC()  {\n    grpcServer := grpc.NewServer()\n    pb.RegisterGlassInfoServer(grpcServer,&amp;GlassApkBean{})\n    pb.RegisterDeviceInfoServer(grpcServer, &amp;DeviceInfoBean{}) // for multiple services\n    lis, err := net.Listen(\"tcp\", \":50051\")\n    if err !=nil{\n        log.Fatalf(\"Error: %v\\n\" , err.Error())\n    }\n    grpcServer.Serve(lis)\n}\n</code></pre>\n\n<p><b> use this function, to recive client request</b></p>\n\n<pre><code>func main(){\n    .\n    . // Your Code\n    .\n    go RunGRPC() // code to run grpc server in go routine. \n    serverWeb := http.Server{\n        Addr:   \"localhost:8080\",\n        Handler: mux,\n}\n\nserverWeb.ListenAndServe()\n}\n</code></pre>\n"}], "owner": {"reputation": 713, "user_id": 2509009, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/fSGP4.jpg?s=128&g=1", "display_name": "asadnwfp", "link": "https://stackoverflow.com/users/2509009/asadnwfp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1032, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1505141636, "creation_date": 1504689856, "question_id": 46071453, "link": "https://stackoverflow.com/questions/46071453/grpc-and-http-1-call-on-single-port-with-out-using-tls-in-golang", "title": "gRPC and HTTP 1 call on single port, with out using TLS in goLang", "body": "<p>i am new to <b>web development</b>, I have recently started working in <b>golang</b> for a project, where I have to use gRPC for push notification on my server to connect to an Android device.\nI have created a simple multiplexer <code>mux := http.NewServeMux()</code> which is working fine with my server code:</p>\n\n<pre><code>  serverWeb := http.Server{\n    Addr:   constants.ServerIPWeb,\n    //Handler: grpcHandlerFunc(grpcServer, mux),\n    Handler: mux,\n}\n\nserverWeb.ListenAndServe()\n</code></pre>\n\n<p>As from the examples on <a href=\"https://grpc.io/\" rel=\"nofollow noreferrer\">gRPC.io</a> I have also created a simple gRPC client/server as a standalone project connected to my android device, with out any <code>TLS</code> configuration and its working fine.</p>\n\n<pre><code>type server struct{}\n\nfunc (s *server) DeviceData(ctx context.Context,req *pb.GetDeviceRequest) (*pb.SetDeviceResponse, error){\n    util.P(\"Device is: \",req) // simple fmt.PrintF(a ... interface)\n    return  &amp;pb.SetDeviceResponse{Message:\"Success\"}, nil\n}\n\nfunc main(){\n    lis, err := net.Listen(\"tcp\", \":8080\")\n    if err!=nil{\n    log.Fatalf(\"Failed to listen: %v\", err)\n    }\n    s := grpc.NewServer()\n    pb.RegisterDeviceInfoServer(s,&amp;server{})\n    reflection.Register(s)\n    if err := s.Serve(lis); err != nil{\n        log.Fatalf(\"Falied to server: %v\", err)\n    }\n}\n</code></pre>\n\n<p>The <b>problem</b> is I could not connect my current gRPC server to my serverStruct above. I have tried to add <code>Handler: grpcHandlerFunc(grpcServer, mux)</code> that will connect my server to the following code, as explained here (<a href=\"https://grpc.io/blog/coreos\" rel=\"nofollow noreferrer\"> gRPC with open API </a>)</p>\n\n<pre><code>func grpcHandlerFunc(grpcServer *grpc.Server, otherHandler http.Handler) http.Handler {\nreturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    // TODO(tamird): point to merged gRPC code rather than a PR.\n    // This is a partial recreation of gRPC's internal checks https://github.com/grpc/grpc-go/pull/514/files#diff-95e9a25b738459a2d3030e1e6fa2a718R61\n    util.P(\"ResponseFunction: GRPC: \",r.URL) // simple fmt.PrintF(a ... interface)\n    if r.ProtoMajor == 2 &amp;&amp; strings.Contains(r.Header.Get(\"Content-Type\"), \"application/grpc\") {\n        grpcServer.ServeHTTP(w, r)\n    } else {\n        otherHandler.ServeHTTP(w, r)\n    }\n})\n}\n</code></pre>\n\n<p>The above code will run my Service running from my <code>mux</code> i.e connecting to http, but it won't run services from gRPC, i.e is connecting to my Android Device.</p>\n\n<p>I believe it requires, <code>TLS</code> connection, but I don't want to get into the implementation of securing my web and Android side code, as that would require me to change all the code at my Android Side and Web, which I want to avoid.</p>\n\n<p>So I am looking for a way to connect this <code>grpcServer</code> to my current <code>serverStruct</code> without using any <code>TLS</code> configuration.</p>\n\n<p><b>More Over myResearcH:</b>\nI have also searched there is a <code>repo</code> called <code>cmux</code> (<a href=\"https://github.com/soheilhy/cmux\" rel=\"nofollow noreferrer\">Connection Mux</a>) which will do the same job, but I don't understand how would I use it with my current <code>serverStruct</code>, as I have a fully functional web app running on  this, and I just need to add <code>gRPC</code> with my current code.</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1504689099, "post_id": 46069871, "comment_id": 79102900, "body": "Please read how <code>$graphLookup</code> works: <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/operator/aggregation/&hellip;</a>  If <code>&quot;connectToField&quot;:   &quot;ch._id&quot;</code> then <code>as</code> should really be &quot;children&quot;, not &quot;parents&quot;. The second <code>$match</code> filters the top-level documents only, not all children/parents. Besides, all of the documents in the example have <code>&quot;ch.trashed&quot;: false</code>."}], "answers": [{"tags": [], "owner": {"reputation": 614, "user_id": 6424168, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh6.googleusercontent.com/-Ma90L9K1ny8/AAAAAAAAAAI/AAAAAAAAABI/9ZMB4GR_z0M/photo.jpg?sz=128", "display_name": "Yur Gasparyan", "link": "https://stackoverflow.com/users/6424168/yur-gasparyan"}, "is_accepted": false, "score": 1, "last_activity_date": 1504687825, "creation_date": 1504687825, "answer_id": 46070706, "question_id": 46069871, "link": "https://stackoverflow.com/questions/46069871/mongodb-recursive-search-for-array-of-objects/46070706#46070706", "title": "Mongodb recursive search for array of objects", "body": "<p>I think you need to use <code>$unwind</code> for first, than <code>$graphLookup</code>, so you need to do a recursive search look like this</p>\n\n<pre><code>var tData struct {\n        Id    bson.ObjectId     `bson:\"_id\"`\n        Child [][]bson.ObjectId `bson:\"child\"`\n    }\n\npipeline := []bson.M{\n        {\"$unwind\": bson.M{\n            \"path\": \"$pr\",\n            \"preserveNullAndEmptyArrays\": true,\n        }},\n        {\"$graphLookup\": bson.M{\n            \"from\":             \"tree\",\n            \"startWith\":        \"$fid\",\n            \"connectFromField\": \"fid\",\n            \"connectToField\":   \"pr._id\",\n            \"as\":               \"child\",\n        }},\n        {\"$match\": bson.M{\"fid\": id}},\n        {\"$group\": bson.M{\"_id\": id, \"child\": bson.M{\"$addToSet\": \"$child.fid\"}}},\n    }\nConnection.Session.DB(\"cctv_storage\").C(\"tree\").Pipe(pipeline).One(&amp;tData)\n</code></pre>\n\n<p>So as a result you will get the <strong>id</strong> of the root folder and the ids of <strong>children</strong></p>\n"}], "owner": {"reputation": 77, "user_id": 8375461, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1107778f0c7e4e33c27b8d8ffe358b0?s=128&d=identicon&r=PG&f=1", "display_name": "Khazar Amjer", "link": "https://stackoverflow.com/users/8375461/khazar-amjer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504687825, "creation_date": 1504685038, "question_id": 46069871, "link": "https://stackoverflow.com/questions/46069871/mongodb-recursive-search-for-array-of-objects", "title": "Mongodb recursive search for array of objects", "body": "<p>I have a tree structure look like this </p>\n\n<pre><code>{ \n    \"_id\" : ObjectId(\"59aebe21f002a8556ca78310\"), \n    \"fid\" : ObjectId(\"59aebe216b96002252a89d7b\"), \n    \"pr\" : [\n\n    ], \n    \"ch\" : [\n        {\n            \"_id\" : ObjectId(\"59aebe326b96002252a89d7d\"), \n            \"trashed\" : false\n        }, \n        {\n            \"_id\" : ObjectId(\"59aebe376b96002252a89d7f\"), \n            \"trashed\" : false\n        }\n    ]\n}\n{ \n    \"_id\" : ObjectId(\"59aebe33f002a8556ca78347\"), \n    \"fid\" : ObjectId(\"59aebe326b96002252a89d7d\"), \n    \"pr\" : [\n        {\n            \"_id\" : ObjectId(\"59aebe216b96002252a89d7b\"), \n            \"trashed\" : false\n        }\n    ], \n    \"ch\" : [\n        {\n            \"_id\" : ObjectId(\"59aebe3b6b96002252a89d81\"), \n            \"trashed\" : false\n        }\n    ]\n}\n</code></pre>\n\n<p>the <strong>fid</strong> is a folder id and the <strong>ch</strong> is the children of folder , so I want to do a recursive search to get tree of the folders and files.\nIn my case I have a used <code>$graphLookup</code> to do a recursive search but as a result I am getting other folders too</p>\n\n<pre><code>pipeline := []bson.M{\n        {\"$match\": bson.M{\"fid\": id}},\n        {\"$graphLookup\": bson.M{\n            \"from\":             \"tree\",\n            \"startWith\":        \"$fid\",\n            \"connectFromField\": \"fid\",\n            \"connectToField\":   \"ch._id\",\n            \"as\":               \"parents\",\n        }},\n        {\"$match\": bson.M{\"ch.trashed\": false}},\n    }\n\n    Connection.Session.DB(\"cctv_storage\").C(\"tree\").Pipe(pipeline).All(&amp;tData)\n</code></pre>\n\n<p>My project based on Golang.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1504689017, "post_id": 46069792, "comment_id": 79102825, "body": "This is not a duplicate. It is asking about fractional seconds."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1504688680, "last_edit_date": 1504688680, "creation_date": 1504685136, "answer_id": 46069893, "question_id": 46069792, "link": "https://stackoverflow.com/questions/46069792/how-to-convert-a-string-time-with-milliseconds-hhmmss-xxx-to-time-time/46069893#46069893", "title": "How to convert a string time with milliseconds (hh:mm:ss.xxx) to time.Time?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n  \n  <p>Format Reference Time</p>\n  \n  <p>A decimal point followed by one or more zeros represents a fractional\n  second, printed to the given number of decimal places. A decimal point\n  followed by one or more nines represents a fractional second, printed\n  to the given number of decimal places, with trailing zeros removed.\n  When parsing (only), the input may contain a fractional second field\n  immediately after the seconds field, even if the layout does not\n  signify its presence. In that case a decimal point followed by a\n  maximal series of digits is parsed as a fractional second.</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t, err := time.Parse(\"15:04:05\", \"15:56:36.113\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(t)\n\n    fmt.Println(t.Format(\"15:04:05.000\"))\n\n    h, m, s := t.Clock()\n    ms := t.Nanosecond() / int(time.Millisecond)\n    fmt.Printf(\"%02d:%02d:%02d.%03d\\n\", h, m, s, ms)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0000-01-01 15:56:36.113 +0000 UTC\n15:56:36.113\n15:56:36.113\n</code></pre>\n\n<p>Note: The zero value of type Time is <code>0000-01-01 00:00:00.000000000 UTC</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 1, "last_activity_date": 1504685414, "creation_date": 1504685414, "answer_id": 46069976, "question_id": 46069792, "link": "https://stackoverflow.com/questions/46069792/how-to-convert-a-string-time-with-milliseconds-hhmmss-xxx-to-time-time/46069976#46069976", "title": "How to convert a string time with milliseconds (hh:mm:ss.xxx) to time.Time?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    s := \"15:56:36.113\"\n    t,_ := time.Parse(\"15:04:05.000\", s)\n\n    fmt.Print(t)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0000-01-01 15:56:36.113 +0000 UTC\n</code></pre>\n\n<p>You can play with it more here: <a href=\"https://play.golang.org/p/3A3e8zHQ8r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3A3e8zHQ8r</a></p>\n"}], "owner": {"reputation": 16720, "user_id": 340554, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7332c248b2542b58427e9717962549d9?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/340554/adrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2308, "favorite_count": 1, "accepted_answer_id": 46069893, "answer_count": 2, "score": 1, "last_activity_date": 1504689147, "creation_date": 1504684843, "last_edit_date": 1504689147, "question_id": 46069792, "link": "https://stackoverflow.com/questions/46069792/how-to-convert-a-string-time-with-milliseconds-hhmmss-xxx-to-time-time", "title": "How to convert a string time with milliseconds (hh:mm:ss.xxx) to time.Time?", "body": "<p>Basically I have times like this one as a string:</p>\n\n<pre><code>15:56:36.113\n</code></pre>\n\n<p>I want to convert it to <code>time.Time</code>.</p>\n\n<p>From what I am reading I cannot use milliseconds when using <code>time.Parse()</code>.  </p>\n\n<p>Is there another way to convert my string to <code>time.Time</code> ?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "edited": false, "score": 3, "creation_date": 1504672579, "post_id": 46066204, "comment_id": 79094217, "body": "Go&#39;s philosophy is kind of minimalistic, and is happy to leave the coding of simple constructs like <code>range</code> up to the programmer rather than adding complexity / syntactic sugars to the language itself. It&#39;s just their design choice. Milo&#39;s answer is a good solution."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1504669569, "last_edit_date": 1504669569, "creation_date": 1504668861, "answer_id": 46066366, "question_id": 46066204, "link": "https://stackoverflow.com/questions/46066204/create-slice-of-range-with-large-intervals-in-go/46066366#46066366", "title": "Create slice of range with large intervals in Go", "body": "<p>Do it the same way Python does:</p>\n\n<pre><code>func pyrange(start, end, step int) []int {\n    // TODO: Error checking to make sure parameters are all valid,\n    // else you could get divide by zero in make and other errors.\n\n    rtn := make([]int, 0, (end-start)/step)\n    for i := start; i &lt; end; i += step {\n        rtn = append(rtn, i)\n    }\n    return rtn\n}\n</code></pre>\n\n<p>With a function.</p>\n\n<p>Obviously only worth the time if you need to do this often. By default Go does not include a function like this, so you need to write your own (or find a third party library) if you want one.</p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 46066366, "answer_count": 1, "score": -2, "last_activity_date": 1504669569, "creation_date": 1504667615, "last_edit_date": 1504669487, "question_id": 46066204, "link": "https://stackoverflow.com/questions/46066204/create-slice-of-range-with-large-intervals-in-go", "title": "Create slice of range with large intervals in Go", "body": "<p>I want to get a slice in Go which looks like this:</p>\n\n<pre><code>[100, 200, 300, 400, 500]\n</code></pre>\n\n<p>In Python I would do this:</p>\n\n<pre><code>l = range(100, 600, 100)\n</code></pre>\n\n<p>I know I can do this in Go:</p>\n\n<pre><code>l := []int{}\nfor i:=100; i&lt;600; i+=100{\n    l = append(l, i)\n}\n</code></pre>\n\n<p>but isn't there anything simpler to create this slice?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "edited": false, "score": 0, "creation_date": 1504666948, "post_id": 46065978, "comment_id": 79092905, "body": "I have used a channel to guarantee output order, and the output is not as expected."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 2, "creation_date": 1504669341, "post_id": 46065978, "comment_id": 79093432, "body": "Your go routine #1 reads the channel but before it could print it go routine #2 is scheduled and prints the next set of numbers so you see 3456 in the output."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "edited": false, "score": 0, "creation_date": 1504671239, "post_id": 46066542, "comment_id": 79093901, "body": "It really works,and I just find it can be done by two channel.thanks a lot!"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "edited": false, "score": 0, "creation_date": 1504672069, "post_id": 46066542, "comment_id": 79094106, "body": "Yes, reading the second channel after the print in the first go routine. However you may want to keep the code easy to read and understand, so using a mutex may be a better choice."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1504713812, "post_id": 46066542, "comment_id": 79120925, "body": "Good one, gave +1 for this :)"}], "tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 1, "last_activity_date": 1504670015, "creation_date": 1504670015, "answer_id": 46066542, "question_id": 46065978, "link": "https://stackoverflow.com/questions/46065978/go-use-channel-to-alternated-print/46066542#46066542", "title": "Go use channel to alternated print", "body": "<p>Please read my comment above. To synchronize, just use a mutex and it'll work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar mu sync.Mutex\n\nfunc main() {\n    numdone := make(chan int)\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        data := []byte(\"ABCDEFGHIJ\")\n        for i := 0; i &lt; 10; i = i + 2 {\n            &lt;-numdone\n            fmt.Printf(\"%c\", data[i])\n            fmt.Printf(\"%c\", data[i+1])\n            mu.Unlock()\n        }\n    }()\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for i := 1; i &lt; 11; i = i + 2 {\n            mu.Lock()\n            fmt.Printf(\"%d\", i)\n            fmt.Printf(\"%d\", i+1)\n            numdone &lt;- i\n        }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Playground : <a href=\"https://play.golang.org/p/71Dv0iKTy_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/71Dv0iKTy_</a></p>\n"}], "owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1504670015, "creation_date": 1504665762, "last_edit_date": 1504666246, "question_id": 46065978, "link": "https://stackoverflow.com/questions/46065978/go-use-channel-to-alternated-print", "title": "Go use channel to alternated print", "body": "<p>I want my code to print:</p>\n\n<pre><code>12AB34CD56EF78GH910IJ\n</code></pre>\n\n<p>but it prints:</p>\n\n<pre><code>12AB3456CDEF78910GHIJ\n</code></pre>\n\n<p>I am so confused and I think it is strange.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    numdone := make(chan int)\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go func() {\n            defer wg.Done()\n            data := []byte(\"ABCDEFGHIJ\")\n            for i := 0; i &lt; 10; i = i + 2 {\n                    &lt;-numdone\n                    fmt.Printf(\"%c\", data[i])\n                    fmt.Printf(\"%c\", data[i+1])\n            }\n    }()\n\n    wg.Add(1)\n    go func() {\n            defer wg.Done()\n            for i := 1; i &lt; 11; i = i + 2 {\n                    fmt.Printf(\"%d\", i)\n                    fmt.Printf(\"%d\", i+1)\n                    numdone &lt;- i\n            }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1504648332, "post_id": 46063746, "comment_id": 79088547, "body": "You can slice a pointer to an array directly, you have a pointer to a slice. Just add parens: <code>(*a)[:0]</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504648501, "post_id": 46063746, "comment_id": 79088613, "body": "Hah, I typo&#39;d my test and jumped straight to a two line answer. Silly me"}, {"owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504648809, "post_id": 46063746, "comment_id": 79088722, "body": "@JimB Did you meant *a =(*a)[:0] ? It doesn&#39;t work for me. :s"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1504648946, "post_id": 46063746, "comment_id": 79088766, "body": "@Mac: what do you expect to happen? <a href=\"https://play.golang.org/p/wBDVivZNAw\" rel=\"nofollow noreferrer\">play.golang.org/p/wBDVivZNAw</a>"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1504649884, "post_id": 46063746, "comment_id": 79089051, "body": "@Mac Are you getting an error or just not getting your expected result? Because It&#39;s working for us."}, {"owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "edited": false, "score": 0, "creation_date": 1504679017, "post_id": 46063746, "comment_id": 79096602, "body": "It worked in example given by JimB. Maybe I kept compiling old code by mistake on my machine."}], "answers": [{"comments": [{"owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "edited": false, "score": 0, "creation_date": 1504648944, "post_id": 46063883, "comment_id": 79088765, "body": "*a = (*a)[:0] Doesn&#39;t really seem to work."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 3, "last_activity_date": 1504648485, "creation_date": 1504648485, "answer_id": 46063883, "question_id": 46063746, "link": "https://stackoverflow.com/questions/46063746/passing-pointer-to-string-array-in-golang/46063883#46063883", "title": "Passing pointer to string array in Golang", "body": "<p>To fix the error, just change <code>*a[:0]</code> to <code>(*a)[:0]</code> to get the object the pointer is pointing to, and then slice that object, instead of trying to slice the pointer.</p>\n\n<p>The next is just my opinion:</p>\n\n<p>However you don't need the <code>*</code> on the parameter, slices contain a pointer to the underlying array, so a copy of the slice points to the same array. And if you are going to assign another thing to the slice variable I recommend returning the new slice, like this:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc SendData(a []string) []string {\n    fmt.Println(a)\n    a = a[:0]\n    return a\n}\nfunc main() {\n    var s []string\n    s = append(s, \"dat\",\"boi\")\n    s = SendData(s)\n    fmt.Println(s)\n}\n</code></pre>\n"}], "owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3031, "favorite_count": 0, "closed_date": 1504648509, "accepted_answer_id": 46063883, "answer_count": 1, "score": -2, "last_activity_date": 1504648485, "creation_date": 1504647703, "last_edit_date": 1504648188, "question_id": 46063746, "link": "https://stackoverflow.com/questions/46063746/passing-pointer-to-string-array-in-golang", "closed_reason": "Duplicate", "title": "Passing pointer to string array in Golang", "body": "<p>I am trying to pass string array to the function, print values, modify it and then as the function is finished print value of the string array.</p>\n\n<p>Here is my sample code which does not work but present what i want to achive:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc SendData(a *[]string) {\n    fmt.Println(*a)\n    *a = *a[:0]\n}\nfunc main() {\n    var s []string\n    s = append(s, \"dat\",\"boi\")\n    SendData(&amp;s)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>This is the error at compilation: <code>cannot slice a (type *[]string)</code></p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1504651926, "post_id": 46063413, "comment_id": 79089601, "body": "Note that golang.org/x/net/websocket is not actively maintained. Consider using github.com/gorilla/websocket instead. The <a href=\"https://godoc.org/github.com/gorilla/websocket#Conn.ReadJSON\" rel=\"nofollow noreferrer\">ReadJSON</a> method will do what you need."}], "answers": [{"comments": [{"owner": {"reputation": 499, "user_id": 1956588, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lNmYZ.jpg?s=128&g=1", "display_name": "continuousqa", "link": "https://stackoverflow.com/users/1956588/continuousqa"}, "edited": false, "score": 0, "creation_date": 1504648066, "post_id": 46063702, "comment_id": 79088468, "body": "Thanks!  this looks very promising. I&#39;m going to try it right now."}, {"owner": {"reputation": 499, "user_id": 1956588, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lNmYZ.jpg?s=128&g=1", "display_name": "continuousqa", "link": "https://stackoverflow.com/users/1956588/continuousqa"}, "edited": false, "score": 3, "creation_date": 1504648517, "post_id": 46063702, "comment_id": 79088628, "body": "Shmulik, you&#39;re awesome. Thanks so much it certainly works. I tried to figure out a JSON mechanism and it was right there.  Thanks for pointing me in the right direction!!"}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "reply_to_user": {"reputation": 499, "user_id": 1956588, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lNmYZ.jpg?s=128&g=1", "display_name": "continuousqa", "link": "https://stackoverflow.com/users/1956588/continuousqa"}, "edited": false, "score": 1, "creation_date": 1504648644, "post_id": 46063702, "comment_id": 79088667, "body": "Thanks @continuousqa for the warm words, I glad it helped!"}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": true, "score": 6, "last_activity_date": 1504650754, "last_edit_date": 1504650754, "creation_date": 1504647374, "answer_id": 46063702, "question_id": 46063413, "link": "https://stackoverflow.com/questions/46063413/best-way-to-read-data-from-websockets/46063702#46063702", "title": "Best way to read data from Websockets", "body": "<p>First, don't use <code>websocket.Read</code> and <code>websocket.Write</code> to read/write from/to a websocket - better use the convenience <code>websocket.Message</code> object and its corresponding <code>websocket.Message.Receive()</code> and <code>websocket.Message.Send()</code> functions. Both of them are used to send strings in UTF-8 encoding or a sequence of bytes.</p>\n\n<p>If you are expecting JSON objects to be sent on the socket, you better use <code>websocket.JSON.Receive()</code> instead of <code>websocket.Message.Receive</code>.</p>\n\n<p>Use it as follows:</p>\n\n<pre><code>    ...    \n    type Person struct {\n      Name string\n      Emails []string\n    }\n\n    func ReceivePerson(ws *websocket.Conn) {\n      var person Person\n      err := websocket.JSON.Receive(ws, &amp;person)\n      if err != nil {\n         log.Fatal(err)\n      }\n    ...\n</code></pre>\n"}], "owner": {"reputation": 499, "user_id": 1956588, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lNmYZ.jpg?s=128&g=1", "display_name": "continuousqa", "link": "https://stackoverflow.com/users/1956588/continuousqa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1912, "favorite_count": 0, "accepted_answer_id": 46063702, "answer_count": 1, "score": 5, "last_activity_date": 1504713719, "creation_date": 1504645940, "last_edit_date": 1504713719, "question_id": 46063413, "link": "https://stackoverflow.com/questions/46063413/best-way-to-read-data-from-websockets", "title": "Best way to read data from Websockets", "body": "<p>I'm learning Go (Golang) and had a project in mind.  The project would be a web app that pulls in a data stream from a 3rd party websocket.  At this point, I'm trying to get my Go project to read the web socket data so I can parse it.</p>\n\n<p>The 3rd party websocket is a data stream of JSON objects.  </p>\n\n<p>So far I've been able to successfully listen to the websocket. However, I'm confused on how to best deal with this.  Namely, the read method I'm using on the Websocket library is getting a slice of bytes.  Which seems challenging to turn into JSON objects.  Is there a better way to read the websocket - collecting the JSON objects?  </p>\n\n<p><strong>Goal</strong></p>\n\n<p>My goal is to listen to this public web socket, get json objects - which I can parse for a field of my desire which would then be pulled into a view (dynamically updating with the data stream.)</p>\n\n<p>If not, how can I convert the slice of bytes back to a JSON object?  </p>\n\n<p><strong>Code</strong></p>\n\n<p>Here's my code:</p>\n\n<pre><code>    package main\n\nimport (\n    \"golang.org/x/net/websocket\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main(){\n\n    origin := \"http://localhost/\"\n    url := \"wss://ws-feed.gdax.com\"\n    ws, err := websocket.Dial(url, \"\", origin)\n    if err != nil {\n        log.Fatal(err)\n    }\n    if _, err := ws.Write([]byte(`{\"type\":\"subscribe\", \"product_ids\":[\"LTC-USD\"]}`)); err != nil {\n        log.Fatal(err)\n    }\n    var msg = make([]byte, 512)\n    var n int\n    for 1&gt;0{\n        if n, err = ws.Read(msg); err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"Received: %s.\\n\", msg[:n])\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "cidr"], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 4, "last_activity_date": 1504645648, "creation_date": 1504645648, "answer_id": 46063359, "question_id": 46063228, "link": "https://stackoverflow.com/questions/46063228/golang-cidr-prefix-notation-to-ip-address-subnet-mask-dot-decimal/46063359#46063359", "title": "golang CIDR prefix notation to IP address/subnet mask (dot-decimal)", "body": "<p>The go standard library does not have a function to create that representation. That being said, it is not difficult to do yourself:</p>\n\n<p><a href=\"https://play.golang.org/p/XT_UXoy6ra\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XT_UXoy6ra</a></p>\n\n<pre><code>func main() {\n    _, ipv4Net, err := net.ParseCIDR(\"10.0.0.0/8\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(ipv4MaskString(ipv4Net.Mask))\n}\n\nfunc ipv4MaskString(m []byte) string {\n    if len(m) != 4 {\n        panic(\"ipv4Mask: len must be 4 bytes\")\n    }\n\n    return fmt.Sprintf(\"%d.%d.%d.%d\", m[0], m[1], m[2], m[3])\n}\n</code></pre>\n\n<p>Keep in mind this format only works for ipv4 masks. If you were to pass an ipv6 mask, this would panic.</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3718, "favorite_count": 1, "accepted_answer_id": 46063359, "answer_count": 1, "score": 1, "last_activity_date": 1504645648, "creation_date": 1504644934, "question_id": 46063228, "link": "https://stackoverflow.com/questions/46063228/golang-cidr-prefix-notation-to-ip-address-subnet-mask-dot-decimal", "title": "golang CIDR prefix notation to IP address/subnet mask (dot-decimal)", "body": "<p>Is there something similar to '<strong><em>npm netmask</em></strong>' in golang ? I need to convert i.e. 10.0.0.0/<strong>8</strong> to 10.0.0.0/<strong>255.0.0.0</strong> so basically netmask in CIDR format to dot-decimal. </p>\n\n<pre><code>var Netmask = require('netmask').Netmask\nvar block = new Netmask('10.0.0.0/8');\nblock.mask; // 255.0.0.0\n</code></pre>\n\n<p>I can't find it in /golang.org/src/net/ip.go</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504636604, "post_id": 46060765, "comment_id": 79083043, "body": "I&#39;ve not used <code>protobuf</code> myself, but wouldn&#39;t it work to implement the <code>Unmarshaler</code> and <code>Marshaler</code> interfaces for your structs and handle the absence of values there? Unfortunately the docs don&#39;t contain examples. <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Unmarshaler\" rel=\"nofollow noreferrer\">godoc.org/github.com/golang/protobuf/proto#Unmarshaler</a> EDIT: You&#39;d have to do this on both ends obviously because Go probably sends the <code>zero</code> values of your struct."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 4, "creation_date": 1504649648, "post_id": 46060765, "comment_id": 79088989, "body": "Check out protobufs field masks, they help to specify what&#39;s changed. <a href=\"https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.FieldMask\" rel=\"nofollow noreferrer\">developers.google.com/protocol-buffers/docs/reference/&hellip;</a> <a href=\"https://github.com/golang/protobuf/issues/225\" rel=\"nofollow noreferrer\">github.com/golang/protobuf/issues/225</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1504684504, "post_id": 46060765, "comment_id": 79099926, "body": "The naive solution would be to also send a list (derived at the json2proto conversion) that tells you what fields have been supplied in the json."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1504684762, "post_id": 46060765, "comment_id": 79100086, "body": "Or you can introduce values that indicate that the value has been set, but is empty: {&quot;user&quot;:{&quot;email&quot;:&quot;&quot;}} -&gt; User.Email = &quot;EMPTY&quot;. This however tends to bite you in the tail very quickly."}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1504692016, "post_id": 46060765, "comment_id": 79105076, "body": "Thanks for your input, guys! @Zak, FieldMaps definitely seems to be the right way to go. I&#39;ll start by reading up on that and get back to you when I understand them better. Thanks!"}, {"owner": {"reputation": 622, "user_id": 1224002, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f4dcddce38402fb5ef2c2cf390ee82a4?s=128&d=identicon&r=PG", "display_name": "Ted Pudlik", "link": "https://stackoverflow.com/users/1224002/ted-pudlik"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1510868842, "post_id": 46060765, "comment_id": 81631576, "body": "@Zak, could you promote your comment to an answer?  It is definitely the correct way to go."}], "answers": [{"comments": [{"owner": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 0, "creation_date": 1519241253, "post_id": 47382034, "comment_id": 84834105, "body": "not sure why this was downvoted... it seems like the google WKT <code>*Value</code> fields are the proper way to address this. Any reason why this shouldn&#39;t be so?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 0, "creation_date": 1519306974, "post_id": 47382034, "comment_id": 84864213, "body": "was downvoted before the post was properly worded / filled out. Originally just contained links to issues."}, {"owner": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 2, "creation_date": 1519323700, "post_id": 47382034, "comment_id": 84875775, "body": "gotcha... you were squatting! I&#39;m going to upvote this despite your insidious behavior, because I think it&#39;s the proper answer ;)"}, {"owner": {"reputation": 18637, "user_id": 8799, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/18e8e5cf629cace8465683d4f41d87c0?s=128&d=identicon&r=PG", "display_name": "Nathan Baulch", "link": "https://stackoverflow.com/users/8799/nathan-baulch"}, "edited": false, "score": 0, "creation_date": 1607425631, "post_id": 47382034, "comment_id": 115262512, "body": "Unfortunately this strategy doesn&#39;t work for repeated (slice) fields OOTB. You have to create new wrapper types as needed."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 9, "last_activity_date": 1513874451, "last_edit_date": 1513874451, "creation_date": 1511125821, "answer_id": 47382034, "question_id": 46060765, "link": "https://stackoverflow.com/questions/46060765/updating-data-from-protobuf/47382034#47382034", "title": "Updating data from protobuf", "body": "<p>Protobufs field masks are one way. </p>\n\n<p><a href=\"https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.FieldMask\" rel=\"noreferrer\">https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.FieldMask</a></p>\n\n<p><a href=\"https://github.com/golang/protobuf/issues/225\" rel=\"noreferrer\">https://github.com/golang/protobuf/issues/225</a></p>\n\n<p>But if you are using <a href=\"https://grpc.io/\" rel=\"noreferrer\">grpc</a> then there's a (sort of) built in way.</p>\n\n<h2>Grpc wrappers</h2>\n\n<p>Since proto3 (protobufs v3) there's been no distinction between a primitive that is not set, and a primitive that's been set to the \"zero value\" (false, 0, \"\", etc).</p>\n\n<p>Instead you can use objects or in protobufs language a \"message\", as objects can be nil / null. You've not mentioned what language you are working in but hopefully these examples make sense.</p>\n\n<p>Given an RPC service such as:</p>\n\n<pre><code>import \"google/protobuf/wrappers.proto\";\n\nservice Users {\n    rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse)\n}\n\nmessage UpdateUserRequest {\n    int32 user_id = 1;\n    google.protobuf.StringValue email = 2;\n}\n\nmessage UpdateUserResponse {}\n</code></pre>\n\n<p><strong>Note</strong> the <code>import \"google/protobuf/wrappers.proto\";</code> is important.\nIt given you access to the google protobufs wrappers <a href=\"https://github.com/google/protobuf/blob/master/src/google/protobuf/wrappers.proto\" rel=\"noreferrer\">source code here</a>. These are not objects that have methods that allow you to test for presence.</p>\n\n<p>Grpc generated code in java gives you methods such as <code>.hasEmail()</code> which returns <code>true</code> if the value is present. The getter on an unset value will still return you the zero value. I think the golang version uses pointers that you can test for nil instead of an explicit <code>hasX()</code> method.</p>\n\n<p>More info / discussion in this <a href=\"https://github.com/google/protobuf/issues/359\" rel=\"noreferrer\">github issue</a></p>\n"}], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5443, "favorite_count": 3, "answer_count": 1, "score": 8, "last_activity_date": 1513874451, "creation_date": 1504634045, "last_edit_date": 1513591245, "question_id": 46060765, "link": "https://stackoverflow.com/questions/46060765/updating-data-from-protobuf", "title": "Updating data from protobuf", "body": "<p>I'm building a microservice system with multiple disconnected components, and I'm currently trying to find out how to implement knowing which fields on an object should be updated based on the <code>protobuf</code> data provided.</p>\n\n<p>The flow is this:</p>\n\n<ol>\n<li>The client sends a JSON-request to an API.</li>\n<li>The API translates the JSON-data into a <code>protobuf</code> struct, which is then sent along to the microservice responsible for handling it.</li>\n<li>The microservice receives the data from the API and performs any action on it, in this case, I'm trying to change a single value in a MySQL table, such as a client's email address.</li>\n</ol>\n\n<p>Now, the problem I have is that since <code>protobuf</code> (understandably) doesn't allow pointers, the <code>protobuf</code> object will contain zero-values for everything not provided. This means that if a customer wants to update their email address, I can't know if they also set <code>IncludeInMailLists</code> to <code>false</code> - or if it was simply not provided (having its zero-value) and shouldn't change.</p>\n\n<p>The question is: how will I - from the protobuf object - know if a value is expressively set to 0, or just not provided?</p>\n\n<p>My current solution is pretty much having a special <code>UpdateCustomer</code>-object which also has an array of <code>Fields</code> specifying which fields the microservice should care about, but it feels like bad solution.</p>\n\n<p>Someone must have solved this better already. How should I implement it?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504639624, "post_id": 46060677, "comment_id": 79084636, "body": "Send messages to channel <code>client.send</code> instead of writing directly to connection to avoid data race on webscoket write.  Confirm that pairing code is executing using debugger or by sprinkling in some logging code."}, {"owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504640168, "post_id": 46060677, "comment_id": 79084927, "body": "<code>c.send &lt;- dat</code> and <code>client.send &lt;- dat</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504642234, "post_id": 46060677, "comment_id": 79085986, "body": "Yes, that will fix the data race.  Although the data race is something that you should fix, that&#39;s probably not the issue here.  Add some log statements to confirm that pairing is happening."}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504766029, "creation_date": 1504633691, "last_edit_date": 1504635981, "question_id": 46060677, "link": "https://stackoverflow.com/questions/46060677/send-websocket-message-to-two-clients", "title": "send websocket message to two clients", "body": "<p>I started a personal project from gorilla chat example. Every time a client calls \"register\" I check if it has an opponent. Suppose clients are game players. What I am trying to do is to couple clients two per two.</p>\n\n<p>Clients are:</p>\n\n<pre><code>type Client struct {\n    hub      *Hub\n    opponent *Client\n    conn     *websocket.Conn\n    send     chan []byte\n}\n</code></pre>\n\n<p>So when I client call register, if exists one client with opponent nil, I tie two clients with</p>\n\n<pre><code>c.opponent = client\nclient.opponent = c\n</code></pre>\n\n<p>And then, I send together a message:</p>\n\n<pre><code>c.conn.WriteMessage(websocket.TextMessage, dat)\nclient.conn.WriteMessage(websocket.TextMessage, dat)\n</code></pre>\n\n<p>but no one receive the message. How can I send a message to just two clients?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/websocket\"\n    \"log\"\n)\n\nfunc newHub() *Hub {\n    return &amp;Hub{\n        broadcast:  make(chan []byte),\n        register:   make(chan *Client),\n        unregister: make(chan *Client),\n        clients:    make(map[*Client]bool),\n    }\n}\n\nfunc (h *Hub) run() {\n    for {\n        select {\n\n        // register new client\n        case client := &lt;-h.register:\n            log.Println(\"register\")\n            h.clients[client] = true\n            for c := range h.clients {\n                if c != client {\n                    if c.opponent == nil {\n                        c.opponent = client\n                        client.opponent = c\n                        dat := []byte(`{\"foo\":\"bar\"}`)\n                        c.conn.WriteMessage(websocket.TextMessage, dat)\n                        client.conn.WriteMessage(websocket.TextMessage, dat)\n                    }\n                }\n            }\n\n        case client := &lt;-h.unregister:\n            log.Println(\"unregister\")\n            if _, ok := h.clients[client]; ok {\n                delete(h.clients, client)\n                close(client.send)\n            }\n\n        case message := &lt;-h.broadcast:\n            for client := range h.clients {\n                select {\n                case client.send &lt;- message:\n                default:\n                    close(client.send)\n                    delete(h.clients, client)\n                }\n            }\n\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["python", "dictionary", "go", "struct"], "comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 5, "creation_date": 1504631769, "post_id": 46060238, "comment_id": 79080786, "body": "Check out Go&#39;s <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">maps</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 5, "creation_date": 1504631880, "post_id": 46060238, "comment_id": 79080846, "body": "Also, do the tour <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">tour.golang.org</a>"}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "reply_to_user": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1504632242, "post_id": 46060238, "comment_id": 79081003, "body": "@CoreyOgburn - but maps don&#39;t accept multiple value types (both strings and ints)."}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 2, "creation_date": 1504632282, "post_id": 46060238, "comment_id": 79081023, "body": "You can use <code>map[string]interface{}</code> so that they&#39;ll take anything."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 4, "creation_date": 1504632748, "post_id": 46060238, "comment_id": 79081271, "body": "It sounds like you&#39;re trying to use dicts and maps as Javascript-style objects. What you need is a struct, not a map."}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 2, "creation_date": 1504661413, "post_id": 46060238, "comment_id": 79091631, "body": "I don&#39;t understand high negative vote count on this question, the OP basically answered the question themselves. Yes, <code>struct</code> is the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 1, "creation_date": 1504632163, "post_id": 46060321, "comment_id": 79080964, "body": "Why would this not be a good decision? If this works I would love the flexibility."}, {"owner": {"reputation": 6388, "user_id": 847552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc674fd2cf824532531bd2b193bdc920?s=128&d=identicon&r=PG", "display_name": "skovorodkin", "link": "https://stackoverflow.com/users/847552/skovorodkin"}, "reply_to_user": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1504632217, "post_id": 46060321, "comment_id": 79080985, "body": "Well, if you really need flexibility, go for it!"}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1504632396, "post_id": 46060321, "comment_id": 79081078, "body": "So what if I would like to initiate an array of maps? Any idea how I would do that?"}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 2, "creation_date": 1504632442, "post_id": 46060321, "comment_id": 79081107, "body": "<code>arrayOfMaps := make([]map[interface{}]interface{}, 10)</code> will make an array with 10 elements. You really should take <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">golang&#39;s tour</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 6, "creation_date": 1504632973, "post_id": 46060321, "comment_id": 79081382, "body": "@kramer65 This is not a good idea because trying to use such a map requires enormous effort. Type assertions and type switches galore."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 4, "creation_date": 1504684182, "post_id": 46060321, "comment_id": 79099751, "body": "&quot;Well, if you really need flexibility, go for it!&quot; -&gt; If you really need the flexibility, Go is not the right tool for the job. Try Python."}], "tags": [], "owner": {"reputation": 6388, "user_id": 847552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc674fd2cf824532531bd2b193bdc920?s=128&d=identicon&r=PG", "display_name": "skovorodkin", "link": "https://stackoverflow.com/users/847552/skovorodkin"}, "is_accepted": false, "score": 5, "last_activity_date": 1504632087, "creation_date": 1504632087, "answer_id": 46060321, "question_id": 46060238, "link": "https://stackoverflow.com/questions/46060238/dictionary-in-go/46060321#46060321", "title": "Dictionary in Go", "body": "<p>That's probably not the best decision, but you can use <code>interface{}</code> to make your map accept any types:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    dict := map[interface{}]interface{} {\n        1: \"hello\",\n        \"hey\": 2,\n    }\n    fmt.Println(dict) // map[1:hello hey:2]\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 1, "creation_date": 1504690955, "post_id": 46069510, "comment_id": 79104338, "body": "Thank you! I guess I just have to get used to defining every structure which I use, instead of creating them on the fly like in all the other languages which I&#39;m used to (Python/php/js/Ruby). Thanks again for your sane answer, instead of all the rather annoyed messages I get on this question.. :-)"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 20, "last_activity_date": 1593957470, "last_edit_date": 1593957470, "creation_date": 1504683829, "answer_id": 46069510, "question_id": 46060238, "link": "https://stackoverflow.com/questions/46060238/dictionary-in-go/46069510#46069510", "title": "Dictionary in Go", "body": "<p>Basically the problem is that it's hard to encounter a requirement to store values of different types in the same map instance <em>in real code.</em></p>\n<p>In your particular case, you should just use a struct type, like this:</p>\n<pre><code>type person struct {\n  name string\n  age  int\n}\n</code></pre>\n<p>Initializing them is no harder than maps thanks to so-called &quot;literals&quot;:</p>\n<pre><code>joe := person{\n  name: &quot;Doe, John&quot;,\n  age:  32,\n}\n</code></pre>\n<p>Accessing individual fields is no harder than with a map:</p>\n<pre><code>joe[&quot;name&quot;] // a map\n</code></pre>\n<p>versus</p>\n<pre><code>joe.name // a struct type\n</code></pre>\n<hr />\n<p>All in all, please consider reading an introductory book on Go\n<em>along</em> with your attemps to solve problems with Go,\nas you inevitably are trying to apply your working knowledge\nof a dynamically-typed language to a strictly-typed one,\nso you're basically trying to write Python in Go, and that's\ncounter-productive.</p>\n<p>I'd recommend starting with\n<a href=\"http://www.gopl.io\" rel=\"noreferrer\">The Go Programming Language</a>.</p>\n<p>There are also <a href=\"https://github.com/golang/go/wiki/Books\" rel=\"noreferrer\">free books on Go</a>.</p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23432, "favorite_count": 2, "accepted_answer_id": 46069510, "answer_count": 2, "score": 13, "last_activity_date": 1607755984, "creation_date": 1504631697, "last_edit_date": 1607755984, "question_id": 46060238, "link": "https://stackoverflow.com/questions/46060238/dictionary-in-go", "title": "Dictionary in Go", "body": "<p>I'm just starting out with Go, and coming from Python I'm trying to find the equivalent of a dict in Python. In Python I would do this:</p>\n<pre><code>d = {\n    'name': 'Kramer',  # string\n    'age': 25          # int\n}\n</code></pre>\n<p>I first found the <code>map</code> type, but that only allows for one type of value (it can't handle both <code>ints</code> and <code>strings</code>. Do I really need to create a <code>struct</code> whenever I want to do something like this? Or is there a type I'm missing?</p>\n"}, {"tags": ["regex", "go", "regex-group"], "answers": [{"comments": [{"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1504683167, "post_id": 46058782, "comment_id": 79099155, "body": "Thank you for your simplification, but this is not what I asked. I edited my question to be more specific about the expected result"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "reply_to_user": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1504699617, "post_id": 46058782, "comment_id": 79110302, "body": "@GwydionFR - It may not be the answer you wanted to hear, but it is telling you why you never get more than  1 value in <code>point</code>. This <code>(?P&lt;point&gt;(\\d \\d), ){3,}</code> is a quantified capture group. This group will only contain the last <code>\\d \\d</code> it finds. Also, you have duplicate capture group names, likewise for that."}, {"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1504700476, "post_id": 46058782, "comment_id": 79111017, "body": "So it means it is impossible to get the result I want ? If it&#39;s a language limitation, then I&#39;m fine with that and I can close this topic"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "reply_to_user": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1504713638, "post_id": 46058782, "comment_id": 79120825, "body": "@GwydionFR - I added a possible solution for you. Although, it&#39;s more a regex limitation than a <i>language</i> one. This problem of not creating <i>group sets</i> is common in most regex engines (Not Dot-Net, which does this in CaptureCollections)."}, {"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1505140672, "post_id": 46058782, "comment_id": 79278506, "body": "I&#39;ve done something similar, but still I am not very happy with this. Btw your answer will probably help a lot of folks out there. Thank you"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "is_accepted": true, "score": 2, "last_activity_date": 1504714085, "last_edit_date": 1504714085, "creation_date": 1504625870, "answer_id": 46058782, "question_id": 46058388, "link": "https://stackoverflow.com/questions/46058388/get-named-list-of-subgroup-in-golang-regex/46058782#46058782", "title": "Get named list of subgroup in golang regex", "body": "<p>Try to add some whitespace to the regex.  </p>\n\n<p>Also note that this engine won't retain all capture group values that are<br>\nwithin a quantified outer grouping like <code>(a|b|c)+</code> where this group will only contain the last a or b or c it finds.  </p>\n\n<p>And, your regex can be reduced to this  </p>\n\n<p><code>(POLYGON\\s*\\((?P&lt;polygons&gt;\\(\\s*(?P&lt;points&gt;(?P&lt;point&gt;\\s*(\\d+\\s+\\d+)\\s*,){3,})\\s*(?P&lt;last_point&gt;\\d+\\s+\\d+)\\s*\\)(?:\\s*,\\s*|\\s*\\)))+)</code>  </p>\n\n<p><a href=\"https://play.golang.org/p/rLaaEa_7GX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rLaaEa_7GX</a></p>\n\n<hr>\n\n<p>The original:</p>\n\n<p><code>(POLYGON\\s*\\((?P&lt;polygons&gt;\\(\\s*(?P&lt;points&gt;(?P&lt;point&gt;\\s*(\\d+\\s+\\d+)\\s*,){3,})\\s*(?P&lt;last_point&gt;\\d+\\s+\\d+)\\s*\\),)*(?P&lt;last_polygon&gt;\\(\\s*(?P&lt;points&gt;(?P&lt;point&gt;\\s*(\\d+\\s+\\d+)\\s*,){3,})\\s*(?P&lt;last_point&gt;\\d+\\s+\\d+)\\s*\\))\\s*\\))</code>  </p>\n\n<p><a href=\"https://play.golang.org/p/rZgJYPDMzl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rZgJYPDMzl</a></p>\n\n<p>See below for what the groups contain.</p>\n\n<pre><code> (                             # (1 start)\n      POLYGON \\s* \\(\n      (?P&lt;polygons&gt;                 # (2 start)\n           \\( \\s* \n           (?P&lt;points&gt;                   # (3 start)\n                (?P&lt;point&gt;                    # (4 start)\n                     \\s* \n                     ( \\d+ \\s+ \\d+ )               # (5)\n                     \\s* \n                     , \n                ){3,}                         # (4 end)\n           )                             # (3 end)\n           \\s*            \n           (?P&lt;last_point&gt; \\d+ \\s+ \\d+ )  # (6)\n           \\s* \\),\n      )*                            # (2 end)\n      (?P&lt;last_polygon&gt;             # (7 start)\n           \\( \\s* \n           (?P&lt;points&gt;                   # (8 start)\n                (?P&lt;point&gt;                    # (9 start)\n                     \\s* \n                     ( \\d+ \\s+ \\d+ )               # (10)\n                     \\s* \n                     , \n                ){3,}                         # (9 end)\n           )                             # (8 end)\n           \\s* \n           (?P&lt;last_point&gt; \\d+ \\s+ \\d+ )  # (11)\n           \\s* \\)\n      )                             # (7 end)\n      \\s* \\)\n )                             # (1 end)\n</code></pre>\n\n<p>Input  </p>\n\n<pre><code>POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3))\n</code></pre>\n\n<p>Output  </p>\n\n<pre><code> **  Grp 0                -  ( pos 0 , len 65 ) \nPOLYGON ((0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3))  \n **  Grp 1                -  ( pos 0 , len 65 ) \nPOLYGON ((0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3))  \n **  Grp 2 [polygons]     -  ( pos 9 , len 30 ) \n(0 0, 0 10, 10 10, 10 0, 0 0),  \n **  Grp 3 [points]       -  ( pos 10 , len 23 ) \n0 0, 0 10, 10 10, 10 0,  \n **  Grp 4 [point]        -  ( pos 27 , len 6 ) \n 10 0,  \n **  Grp 5                -  ( pos 28 , len 4 ) \n10 0  \n **  Grp 6 [last_point]   -  ( pos 34 , len 3 ) \n0 0  \n **  Grp 7 [last_polygon] -  ( pos 39 , len 25 ) \n(3 3, 3 7, 7 7, 7 3, 3 3)  \n **  Grp 8 [points]       -  ( pos 40 , len 19 ) \n3 3, 3 7, 7 7, 7 3,  \n **  Grp 9 [point]        -  ( pos 54 , len 5 ) \n 7 3,  \n **  Grp 10                -  ( pos 55 , len 3 ) \n7 3  \n **  Grp 11 [last_point]   -  ( pos 60 , len 3 ) \n3 3  \n</code></pre>\n\n<hr>\n\n<p><em><strong>Possible Solution</strong></em>  </p>\n\n<p>It's not impossible. It just takes a few extra steps.<br>\n(As an aside, isn't there a library for WKT that can parse this for you ?)  </p>\n\n<p>Now, I don't know your language capabilities, so this is just a general approach.  </p>\n\n<p><strong>1. Validate the form you're parsing.</strong><br>\nThis will validate and return <em>all polygon sets</em> as a single string in <code>All_Polygons</code> group.  </p>\n\n<p>Target <code>POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3))</code>  </p>\n\n<p><code>POLYGON\\s*\\((?P&lt;All_Polygons&gt;(?:\\(\\s*\\d+\\s+\\d+(?:\\s*,\\s*\\d+\\s+\\d+){2,}\\s*\\))(?:\\s*,\\(\\s*\\d+\\s+\\d+(?:\\s*,\\s*\\d+\\s+\\d+){2,}\\s*\\))*)\\s*\\)</code>  </p>\n\n<pre><code> **  Grp 1 [All_Polygons] -  ( pos 9 , len 55 ) \n(0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3)\n</code></pre>\n\n<p><strong>2. If 1 was successful, set up a loop match using the output of <code>All_Polygons</code> string.</strong>  </p>\n\n<p>Target <code>(0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3)</code>  </p>\n\n<p><code>(?:\\(\\s*(?P&lt;Single_Poly_All_Pts&gt;\\d+\\s+\\d+(?:\\s*,\\s*\\d+\\s+\\d+){2,})\\s*\\))</code>  </p>\n\n<p>This step is equivalent of a find all type of match. It should match successive values of all the points of a single polygon, returned in <code>Single_Poly_All_Pts</code> group string.  </p>\n\n<p>This will give you these 2 separate matches, which can be put into a temp array having 2 value strings:  </p>\n\n<pre><code> **  Grp 1 [Single_Poly_All_Pts] -  ( pos 1 , len 27 ) \n0 0, 0 10, 10 10, 10 0, 0 0  \n\n **  Grp 1 [Single_Poly_All_Pts] -  ( pos 31 , len 23 ) \n3 3, 3 7, 7 7, 7 3, 3 3  \n</code></pre>\n\n<p><strong>3. If 2 was successful, set up a loop match using the temp array output of step 2.</strong><br>\nThis will give you the <em>individual</em> points of each polygon.   </p>\n\n<p><code>(?P&lt;Single_Point&gt;\\d+\\s+\\d+)</code>  </p>\n\n<p>Again this is a loop match (or a find all type of match). For each array element<br>\n(Polygon), this will produce the individual points.  </p>\n\n<p>Target[element 1]  <code>0 0, 0 10, 10 10, 10 0, 0 0</code>  </p>\n\n<pre><code> **  Grp 1 [Single_Point] -  ( pos 0 , len 3 ) \n0 0  \n **  Grp 1 [Single_Point] -  ( pos 5 , len 4 ) \n0 10  \n **  Grp 1 [Single_Point] -  ( pos 11 , len 5 ) \n10 10  \n **  Grp 1 [Single_Point] -  ( pos 18 , len 4 ) \n10 0  \n **  Grp 1 [Single_Point] -  ( pos 24 , len 3 ) \n0 0  \n</code></pre>\n\n<p>And,  </p>\n\n<p>Target[element 2]  <code>3 3, 3 7, 7 7, 7 3, 3 3</code>  </p>\n\n<pre><code> **  Grp 1 [Single_Point] -  ( pos 0 , len 3 ) \n3 3  \n **  Grp 1 [Single_Point] -  ( pos 5 , len 3 ) \n3 7  \n **  Grp 1 [Single_Point] -  ( pos 10 , len 3 ) \n7 7  \n **  Grp 1 [Single_Point] -  ( pos 15 , len 3 ) \n7 3  \n **  Grp 1 [Single_Point] -  ( pos 20 , len 3 ) \n3 3  \n</code></pre>\n"}], "owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 46058782, "answer_count": 1, "score": 0, "last_activity_date": 1504714085, "creation_date": 1504624578, "last_edit_date": 1504686652, "question_id": 46058388, "link": "https://stackoverflow.com/questions/46058388/get-named-list-of-subgroup-in-golang-regex", "title": "Get named list of subgroup in golang regex", "body": "<p>I'm looking for a function that returns a <code>map[string]interface{}</code> where <code>interface{}</code> can be a slice, a a <code>map[string]interface{}</code> or a value.</p>\n\n<p>My use case is to parse WKT geometry like the following and retrieves point values; Example for a donut polygon:</p>\n\n<p><code>POLYGON ((0 0, 0 10, 10 10, 10 0, 0 0),(3 3, 3 7, 7 7, 7 3, 3 3))</code></p>\n\n<p>The regex (I voluntary set \\d that matches only integers for readability purpose):</p>\n\n<pre><code>(POLYGON \\(\n    (?P&lt;polygons&gt;\\(\n        (?P&lt;points&gt;(?P&lt;point&gt;(\\d \\d), ){3,})\n        (?P&lt;last_point&gt;\\d \\d )\\),)*\n    (?P&lt;last_polygon&gt;\\(\n        (?P&lt;points&gt;(?P&lt;point&gt;(\\d \\d), ){3,})\n        (?P&lt;last_point&gt;\\d \\d)\\))\\)\n)\n</code></pre>\n\n<p>I have a function (copied from SO) that retrieves some informations but it's not that good for nested groups and list of groups:</p>\n\n<pre><code>func getRegexMatchParams(reg *regexp.Regexp, url string) (paramsMap map[string]string) {\n    match := reg.FindStringSubmatch(url)\n    paramsMap = make(map[string]string)\n    for i, name := range reg.SubexpNames() {\n        if i &gt; 0 &amp;&amp; i &lt;= len(match) {\n            paramsMap[name] = match[i]\n        }\n    }\n    return match\n}\n</code></pre>\n\n<p>It seems that the group <code>point</code> gets only 1 point.\n<a href=\"https://play.golang.org/p/OMAxKmp2tI\" rel=\"nofollow noreferrer\">example on playground</a></p>\n\n<p>[EDIT] The result I want is something like this:</p>\n\n<pre><code>map[string]interface{}{\n    \"polygons\": map[string]interface{} {\n        \"points\": []interface{}{\n            {map[string]string{\"point\": \"0 0\"}},     \n            {map[string]string{\"point\": \"0 10\"}},        \n            {map[string]string{\"point\": \"10 10\"}},        \n            {map[string]string{\"point\": \"10 0\"}},\n        },\n        \"last_point\": \"0 0\",\n    },\n    \"last_polygon\": map[string]interface{} {\n        \"points\": []interface{}{\n            {map[string]string{\"point\": \"3 3\"}},     \n            {map[string]string{\"point\": \"3 7\"}},        \n            {map[string]string{\"point\": \"7 7\"}},        \n            {map[string]string{\"point\": \"7 3\"}},\n        },\n        \"last_point\": \"3 3\",\n    }\n}\n</code></pre>\n\n<p>So I can use it further for different purposes like querying databases and validate that last_point = points[0] for each polygon.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2319, "user_id": 405861, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68ac212db6abbb7f228d54dca9f613f0?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/405861/abel"}, "edited": false, "score": 0, "creation_date": 1504624415, "post_id": 46058282, "comment_id": 79076713, "body": "In the example above, how do I get the current URL entered by the user to access the page?"}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "reply_to_user": {"reputation": 2319, "user_id": 405861, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68ac212db6abbb7f228d54dca9f613f0?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/405861/abel"}, "edited": false, "score": 0, "creation_date": 1504624603, "post_id": 46058282, "comment_id": 79076823, "body": "This depends on how you wrote your server.  But probably this answer can help you: <a href=\"https://stackoverflow.com/a/24519179/170961\">stackoverflow.com/a/24519179/170961</a>"}], "tags": [], "owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "is_accepted": false, "score": 1, "last_activity_date": 1504624271, "creation_date": 1504624271, "answer_id": 46058282, "question_id": 46058142, "link": "https://stackoverflow.com/questions/46058142/how-to-get-the-url-in-go/46058282#46058282", "title": "How to get the URL in Go", "body": "<p>Go has built in library that can do it for you.</p>\n\n<pre><code>package main\nimport \"fmt\"\nimport \"net\"\nimport \"net/url\"\nfunc main() {\n    s := \"http://localhost:8080\"\n\n    u, err := url.Parse(s)\n    if err != nil {\n        panic(err)\n    }\n\n    host, _, _ := net.SplitHostPort(u.Host)\n    fmt.Println(host)\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/url/#\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url/#</a></p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 7738801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/363b8868efcc8afa9859628b55ebaaa2?s=128&d=identicon&r=PG", "display_name": "Mustafa Gezen", "link": "https://stackoverflow.com/users/7738801/mustafa-gezen"}, "is_accepted": true, "score": 2, "last_activity_date": 1504624637, "creation_date": 1504624637, "answer_id": 46058410, "question_id": 46058142, "link": "https://stackoverflow.com/questions/46058142/how-to-get-the-url-in-go/46058410#46058410", "title": "How to get the URL in Go", "body": "<p>If you are talking about extracting the host from a <code>*http.Request</code> you can do the following:</p>\n\n<p><code>func ExampleHander(w http.ResponseWriter, r *http.Request) {\n    host := r.Host // This is your host (and will include port if specified)\n}\n</code></p>\n\n<p>If you just want to access the host part without the port part you can do the following:</p>\n\n<p><code>func ExampleHandler(w http.ResponseWriter, r *http.Request) {\n    host, port, _ := net.SplitHostPort(r.Host)\n}\n</code></p>\n\n<p>For the last one to work you also have to import <code>net</code></p>\n\n<p>Go has wonderful documentation, I would also recommend taking a look at that: <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">net/http</a></p>\n"}], "owner": {"reputation": 2319, "user_id": 405861, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68ac212db6abbb7f228d54dca9f613f0?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/405861/abel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 46058410, "answer_count": 2, "score": 1, "last_activity_date": 1504624637, "creation_date": 1504623760, "question_id": 46058142, "link": "https://stackoverflow.com/questions/46058142/how-to-get-the-url-in-go", "title": "How to get the URL in Go", "body": "<p>I tried looking it up, but couldn't find an already answered question. </p>\n\n<p>How do I get the host part of the URL in Go?</p>\n\n<p>For eg.</p>\n\n<p>if the user enters <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">http://localhost:8080</a> in the address bar, I wanted to extract \"localhost\" from the URL.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504616239, "post_id": 46054094, "comment_id": 79070596, "body": "How is the filename provided to you?"}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 0, "creation_date": 1504614955, "post_id": 46054809, "comment_id": 79069637, "body": "how i can update in my situation ? because need create the file first to do request"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 0, "creation_date": 1504630088, "post_id": 46054809, "comment_id": 79079997, "body": "In your example I cant see any reason why you couldn&#39;t move file creation down below the request, if you need the filename you can return from the download function. If you really need to get it up front I think http.Head() will work - not 100% sure if this follows redirects without testing though, you may need to explicitly tell it to do so"}], "tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 2, "last_activity_date": 1504613882, "creation_date": 1504613882, "answer_id": 46054809, "question_id": 46054094, "link": "https://stackoverflow.com/questions/46054094/golang-download-file-and-follow-redirects/46054809#46054809", "title": "golang download file and follow redirects", "body": "<p>Redirects should be followed by default. You can get the final url visited to aquire the download using </p>\n\n<p><code>finalURL := resp.Request.URL.String()</code></p>\n\n<p>The last part of the url is your filename on the remote so something like this should work</p>\n\n<p><code>\nparts := strings.Split(finalURL, \"/\")\nfilename := parts[len(parts)-1]\n</code></p>\n"}], "owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 996, "favorite_count": 0, "accepted_answer_id": 46054809, "answer_count": 1, "score": -1, "last_activity_date": 1504613882, "creation_date": 1504611511, "last_edit_date": 1504612798, "question_id": 46054094, "link": "https://stackoverflow.com/questions/46054094/golang-download-file-and-follow-redirects", "title": "golang download file and follow redirects", "body": "<p>i want to download file from redirect url, and return filename in variable filename, my actual code is : </p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"net/http\"\n    \"io\"\n)\n\nfunc downloadFile(filepath string, url string) (err error) {\n\n  // Create the file\n  out, err := os.Create(filepath)\n  if err != nil  {\n    return err\n  }\n  defer out.Close()\n\n  // Get the data\n  resp, err := http.Get(url)\n  if err != nil {\n    return err\n  }\n  defer resp.Body.Close()\n\n  // Writer the body to file\n  _, err = io.Copy(out, resp.Body)\n  if err != nil  {\n    return err\n  }\n\n  return nil\n}\n\nfunc main() {\n\n  var filename string = \"urls.txt\"\n  var url1 string = \"http://94.177.247.162:5000/random\"\n\n  downloadFile(filename, url1)\n\n}\n</code></pre>\n\n<p>how i can change my code to return real name of file downloaded in variable filename.</p>\n\n<p>example output :</p>\n\n<pre><code>urlix.txt\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 1133, "user_id": 102674, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/zNUye.jpg?s=128&g=1", "display_name": "Maciej A. Bednarz", "link": "https://stackoverflow.com/users/102674/maciej-a-bednarz"}, "is_accepted": false, "score": 0, "last_activity_date": 1504611822, "creation_date": 1504611822, "answer_id": 46054181, "question_id": 46053767, "link": "https://stackoverflow.com/questions/46053767/how-to-parse-invariant-json-var-names/46054181#46054181", "title": "How to parse invariant json var names", "body": "<p>Solution:</p>\n\n<pre><code>type JSONTag struct {\n    ValueName string `json:\"valueName\"`\n    Value     string `json:\"value\"`\n}\n\ntype JSONMessage struct {\n    Value float64           `json:\"value\"`\n    Time  string            `json:\"time\"`\n    Tags  map[string]string `json:\"tags\"`\n}\n... \n\n// usage: \ngroup := JSONMessage{\n    Value: 123,\n    Time:  \"2017-09-01T14:26:33.773Z\",\n    Tags:  map[string]string{\"foo\": \"aaa\", \"bar\": \"aaa\"},\n}\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>{\n  \"value\": 123,\n  \"time\": \"2017-09-01T14:26:33.773Z\",\n  \"tags\": {\n    \"bar\": \"aaa\",\n    \"foo\": \"aaa\"\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1133, "user_id": 102674, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/zNUye.jpg?s=128&g=1", "display_name": "Maciej A. Bednarz", "link": "https://stackoverflow.com/users/102674/maciej-a-bednarz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504611822, "creation_date": 1504610620, "question_id": 46053767, "link": "https://stackoverflow.com/questions/46053767/how-to-parse-invariant-json-var-names", "title": "How to parse invariant json var names", "body": "<p>Could anyone help me parse the following JSON? The tags do not contain \"[\"/\"]\" brackets, but the left-hand variable names there are indefinite:</p>\n\n<p>Example 1:</p>\n\n<pre><code>{\n    \"value\": 569000000,\n    \"tags\": {\n        \"importerId\": \"catchacar\",\n        \"jvmProcess\": \"12367A\"\n    }\n}\n</code></pre>\n\n<p>Example 2:</p>\n\n<pre><code>{\n    \"value\": 519,\n    \"tags\": {\n        \"cluster\": \"cluster-29042\",\n        \"valueName\": \"open-files\"\n    },\n    \"time\": \"2017-09-05T11:03:57.877Z\"\n}\n</code></pre>\n\n<p>etc</p>\n\n<p>How can I define a struct which catches arbitrary left-hand values  ? I have found the following:</p>\n\n<pre><code>type JSONTag struct {\n    ValueName string `json:\"valueName\"`   &lt;--- what to write here ????\n    Value     string `json:\"value\"`\n}\n\ntype JSONMessage struct {\n    Value float64   `json:\"value\"`\n    Time  string    `json:\"time\"`\n    Tags  []JSONTag `json:\"tags\"`\n}\n\ngroup := JSONMessage{\n    Value: 123,\n    Time:  \"2017-09-01T14:26:33.773Z\",\n    Tags:  []JSONTag{JSONTag{\"valName1\", \"val1\"}},\n}\n</code></pre>\n\n<p>But this produces and needs brackets. Example:</p>\n\n<pre><code>{\n  \"value\": 123,\n  \"time\": \"2017-09-01T14:26:33.773Z\",\n  \"tags\": [\n    {\n      \"valueName\": \"valName1\",\n      \"value\": \"val1\"\n    }\n  ]\n}   \n</code></pre>\n\n<p>Thank you very much !</p>\n"}, {"tags": ["windows", "go", "console"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504620130, "post_id": 46053124, "comment_id": 79073616, "body": "Windows 10 provides a console API which can probably do what you want: <a href=\"https://docs.microsoft.com/en-us/windows/console/\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/console</a>"}, {"owner": {"reputation": 81, "user_id": 6739429, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BJPtc.jpg?s=128&g=1", "display_name": "J.Joe", "link": "https://stackoverflow.com/users/6739429/j-joe"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504668540, "post_id": 46053124, "comment_id": 79093216, "body": "I find the API but always get incorrect parameters , i don&#39;t know how to use , i code like this :  <code>type coord struct { \tx, y int16 }  func resizeConsoleBuffer() { \tkernel32 := syscall.NewLazyDLL(&quot;kernel32.dll&quot;) \tproc := kernel32.NewProc(&quot;SetConsoleScreenBufferSize&quot;) \tc := &amp;coord{x:int16(100), y:int16(500)} \tproc.Call(uintptr(syscall.Stdout), uintptr(unsafe.Pointer(c))) }</code>@JimB"}], "owner": {"reputation": 81, "user_id": 6739429, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BJPtc.jpg?s=128&g=1", "display_name": "J.Joe", "link": "https://stackoverflow.com/users/6739429/j-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 203, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504608554, "creation_date": 1504608554, "question_id": 46053124, "link": "https://stackoverflow.com/questions/46053124/how-to-set-windows-console-buffer-size-use-golang", "title": "How to set windows console buffer size use golang?", "body": "<p>I'm code a project , but the windows console buffer size is not enough to dispaly the data . how to fix it ?</p>\n\n<p>I'm try to do this:</p>\n\n<pre><code>cmd:=exec.Command(\"cmd\", \"-c\", \"mode con cols=100 lines=500\")\n</code></pre>\n\n<p>but it not work .</p>\n"}, {"tags": ["templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1504621203, "post_id": 46053571, "comment_id": 79074364, "body": "But I want this as part of a HTTP handler where the input will be coming from other languages too. So I need a JSON-able struct with no interfaces or maps."}, {"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "reply_to_user": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1504639057, "post_id": 46053571, "comment_id": 79084330, "body": "@SankarP I&#39;m not sure if I understand your comment, but in my updated answer you can handle any incoming json, no matter what the structure, and use it in your templates. The only requirement is that the data contains the fields that you want to use in your template, but one cannot avoid that anyway."}], "tags": [], "owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "is_accepted": true, "score": 0, "last_activity_date": 1504638965, "last_edit_date": 1592644375, "creation_date": 1504610012, "answer_id": 46053571, "question_id": 46052395, "link": "https://stackoverflow.com/questions/46052395/golang-templates-processing-and-generics/46053571#46053571", "title": "golang templates processing and generics", "body": "<p>Neither <code>json.Unmarshal</code> nor <code>template.Execute</code> cares about the actual type of the data, this will all be handled at runtime. So you can just parse the json to an <code>interface{}</code> and pass that to your templates. Provided that the json data contains the fields that are expected by the template to which you pass the data, this will just work fine.</p>\n<p><a href=\"https://play.golang.com/p/99GmCMdr3K\" rel=\"nofollow noreferrer\">Playground link</a></p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;html/template&quot;\n)\n\nvar templates = map[string]*template.Template{\n    &quot;A&quot;: template.Must(template.New(&quot;A&quot;).Parse(&quot;{{ .A }}&quot;)),\n    &quot;B&quot;: template.Must(template.New(&quot;B&quot;).Parse(&quot;{{ .B }} and {{ .C.D }}&quot;)),\n}\n\ntype tmplReceiver struct {\n    TmplName string\n    TmplArgs string\n}\n\nfunc main() {\n    receivers := []tmplReceiver{\n        tmplReceiver{&quot;A&quot;, `{&quot;A&quot;: &quot;Value for A&quot;}`},\n        tmplReceiver{&quot;B&quot;, `{&quot;B&quot;: &quot;Value for B&quot;, &quot;C&quot;: { &quot;D&quot;: &quot;Value for D&quot; }}`},\n    }\n\n    for _, receiver := range receivers {\n        var data interface{}\n        json.Unmarshal([]byte(receiver.TmplArgs), &amp;data)\n\n        var buffer bytes.Buffer\n        templates[receiver.TmplName].Execute(&amp;buffer, data)\n        fmt.Println(buffer.String())\n    }\n}\n</code></pre>\n<p>Which prints</p>\n<blockquote>\n<p>Value for A</p>\n<p>Value for B and Value for D</p>\n</blockquote>\n"}], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 0, "accepted_answer_id": 46053571, "answer_count": 1, "score": 0, "last_activity_date": 1504638965, "creation_date": 1504606230, "question_id": 46052395, "link": "https://stackoverflow.com/questions/46052395/golang-templates-processing-and-generics", "title": "golang templates processing and generics", "body": "<p>I have two golang html templates, as follows:</p>\n\n<pre><code>var m map[string]string\nm = make(map[string]string)\n\nm[\"First\"] = `&lt;html&gt;\n&lt;body&gt;First template type {{.First}}\n&lt;/html&gt;`\n\nm[\"Second\"] = `&lt;html&gt;\n&lt;body&gt;Second template type {{.SecondF1}} {{.SecondF2}}\n&lt;/html&gt;`\n</code></pre>\n\n<p>The first html template takes only one argument, named <code>First</code> whereas the second template needs two arguments, named <code>SecondF1</code> and <code>SecondF2</code>.</p>\n\n<p>Now I have a struct which has two fields, one for receiving a template name and another for receiving the template arguments.</p>\n\n<pre><code>type tmplReceiver struct {\n    TmplName string\n    TmplArgs string // Receives JSON string\n}\n</code></pre>\n\n<p>Now, examples of instances for the above structs could be:</p>\n\n<pre><code>var i, j tmplReceiver\n\ni.TmplName = \"First\"\ni.TmplArgs = `{\"Field1\": \"First Template Argument\"}`\n\nj.TmplName = \"Second\"\nj.TmplArgs = `{\n  \"SecondF1\": \"Second template First Argument\", \n  \"SecondF2\": \"Second template Second Argument\"\n}`\n</code></pre>\n\n<p>Now I can get the Template string by using the map, for example:</p>\n\n<pre><code>tmplStr := m[i.TmplName] (or)\ntmplStr := m[j.TmplName]\n\ntmpl, _ = template.New(\"email\").Parse(tmplStr)\n</code></pre>\n\n<p>However, how do I get the template to be executed for all the possible template types, with a single <code>tmpl.Execute</code> statement. In other words, if I want to have the following code:</p>\n\n<pre><code>var buff bytes.Buffer\nif err := tmpl.Execute(&amp;buff, tmplPtr); err != nil {\n    log.Fatal(err)\n}\nlog.Println(buff.String())\n</code></pre>\n\n<p>How do I get the <code>tmplPtr</code> to be valid, irrespective of how many templates I have (<code>First</code>, <code>Second</code>, etc.) and each of these templates can have a variable number of arguments (<code>First</code> has only one arg, whereas <code>Second</code> has two args, etc.)</p>\n\n<p>I do not want to write N different <code>tmpl.Execute</code> statements with an <code>if</code> block for each template name. Is there any other alternative approach to solve this ? Thanks.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504602989, "post_id": 46051085, "comment_id": 79061835, "body": "So what&#39;s the problem?"}, {"owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504603163, "post_id": 46051085, "comment_id": 79061942, "body": "I can see Golang handling GET requests even as function is not defined to do so. Whenever i go to the port of my program i can see memory being allocated which increases memory usage. I would like to avoid this behavior ."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1504603570, "post_id": 46051085, "comment_id": 79062206, "body": "&quot;i can see memory being allocated which increases memory usage&quot; Probably not. Finding leaked memory is hard. Looking at the process monitor or top is not helpful. So what&#39;s the problem?"}, {"owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "edited": false, "score": 0, "creation_date": 1504603805, "post_id": 46051085, "comment_id": 79062374, "body": "By default all kinds of requests are being handled in   http.HandleFunc(&quot;/&quot;, handlePOST). Can i turn it off in some easy way?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1504608877, "post_id": 46051085, "comment_id": 79065624, "body": "@Mac No, you can&#39;t. What you&#39;re doing is the best way: do nothing in the handler if HTTP method is not <code>POST</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504622087, "post_id": 46051085, "comment_id": 79075046, "body": "Technically it should respond with <code>http.StatusMethodNotAllowed</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1504610904, "last_edit_date": 1504610904, "creation_date": 1504610101, "answer_id": 46053613, "question_id": 46051085, "link": "https://stackoverflow.com/questions/46051085/not-handling-get-in-net-http-golang/46053613#46053613", "title": "Not handling GET in net/http golang", "body": "<p>You cannot not handle <code>GET</code> requests, Go's HTTP server (or rather its <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\"><code>http.ServeMux</code></a>) only allows you to specify a path pattern before dispatching the request to your handler. HTTP method related routing can only happen at the handler level.</p>\n\n<p>Note that some external mux libraries allow you to register handlers to specific HTTP methods only, but the decision and routing based on that also happens in \"hidden\" handlers of those libraries.</p>\n\n<p>What you're doing is the best: simply do nothing in the handler if the HTTP method is not the one you intend to handle, or even better: send back a <code>http.StatusMethodNotAllowed</code> error response:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n    if r.Method != http.MethodPost {\n        http.Error(w, \"Only POST is allowed\", http.StatusMethodNotAllowed)\n        return\n    }\n\n    var t test_struct // Use local var not global, else it's a data race\n    decoder := json.NewDecoder(r.Body)\n    if err := decoder.Decode(&amp;t); err != nil {\n        fmt.Println(\"Error decoding:\", err)\n    }\n    fmt.Println(t.Test)\n}\n</code></pre>\n"}], "owner": {"reputation": 227, "user_id": 5639673, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/83faac5b32ff2f170b8924c36a40f560?s=128&d=identicon&r=PG&f=1", "display_name": "Mac", "link": "https://stackoverflow.com/users/5639673/mac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 46053613, "answer_count": 1, "score": 0, "last_activity_date": 1504611119, "creation_date": 1504602377, "last_edit_date": 1504611119, "question_id": 46051085, "link": "https://stackoverflow.com/questions/46051085/not-handling-get-in-net-http-golang", "title": "Not handling GET in net/http golang", "body": "<p>I am trying to turn off handling GET requests in golang.\nI just want to handle POST.</p>\n\n<p>Is it possible to do?</p>\n\n<p>Reason for doing so is that i can see more and more memory being allocated by golang whenever i go to localhost:8080 and refresh page multiple times.</p>\n\n<p>Here is my test code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n  \"encoding/json\"\n)\ntype test_struct struct {\n    Test string \n}\nvar t test_struct\n\nfunc handlePOST(rw http.ResponseWriter, req *http.Request) {\n    switch req.Method {\n    case \"POST\":\n    decoder := json.NewDecoder(req.Body)\n    decoder.Decode(&amp;t)\n    defer req.Body.Close()\n    fmt.Println(t.Test)\n    }\n}\nfunc main() {\n    http.HandleFunc(\"/\", handlePOST)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1504602899, "post_id": 46051039, "comment_id": 79061764, "body": "Thanks Florine :). I disabled it and the build time was back to normal."}, {"owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1504602965, "post_id": 46051039, "comment_id": 79061814, "body": "How will it affect me for my particular case where I need to debug only my Go code? No changes ever made to external imports nor do I need to debug them."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1504608054, "post_id": 46051039, "comment_id": 79065177, "body": "The problem is that the Go tool currently doesn&#39;t understand not to recompile CGO dependencies when -a is used, and it tries to recompile everything. While you can use the debugger without the -a flag, if you do have a problem with the debugger, then you need to turn that back on. Think of the case where you jump from pkgA to pkgB and pkgB has the optimizations enabled code. In that case, Delve will have a harder time debugging the code, which can result in bugs (hence the need for -a). I know it&#39;s less ideal but hopefully in Go 1.10 things will improve."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1504602276, "creation_date": 1504602276, "answer_id": 46051039, "question_id": 46050568, "link": "https://stackoverflow.com/questions/46050568/why-is-a-added-when-debugging/46051039#46051039", "title": "Why is &quot;-a&quot; added when debugging", "body": "<p>Gogland will build the debug binary with \"go build -a .... package/name ....\" in order to debug it. If you want the old behavior, then you need to go in Settings | Build, Execution, Deployment | Debugger | Delve and toggle Rebuild transitive dependencies. However, this is discouraged and for any debugging issue you have you'll need to first turn that back on and then report the issue. This is because Gogland will bypass what Delve would otherwise do when running \"dlv debug package/name\". There are plans to have better support in Go 1.10, hopefully, but this depends on work from the Go team as well.</p>\n\n<p>Now for the longer version:</p>\n\n<p>You are correct, the compilation speed has degraded a bit when using the EAP 12+ because of improved debugging support.</p>\n\n<p>What happened is that Go 1.9 can now do a better job at compiling the transitive dependencies with all the optimizations turned off which means Delve can work better on your application.</p>\n\n<p>This means everything in GOPATH/pkg and GOROOT/pkg is recompiled for debugging in order to ensure that there's no package that has been included accidentally with the optimizations on.</p>\n\n<p>If that would happen, then you could potentially end up with a package that does not debug as well, and sometimes that could even be one of your packages.</p>\n\n<p>Unfortunately, for now, optimizations off builds are not cacheable, due to how \"-a\" works. This means \"go build -i -a -gcflags '-N -l' ... package/name ... \" is not possible at the moment.</p>\n\n<p>Delve itself would apply the \"-a\" flag when running \"dlv debug ... package/name .... \" so, while you can turn the \"-a\" flag off in Gogland, I would advise against it (or you'd have to redo the debugging session using it in case you encounter any bugs since this is not a mode supported by Delve officially).</p>\n\n<p>For a link to the original issue, please see: <a href=\"https://youtrack.jetbrains.com/issue/GO-4249\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-4249</a></p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 46051039, "answer_count": 1, "score": 0, "last_activity_date": 1504602276, "creation_date": 1504600725, "question_id": 46050568, "link": "https://stackoverflow.com/questions/46050568/why-is-a-added-when-debugging", "title": "Why is &quot;-a&quot; added when debugging", "body": "<p>I have a project with a CGO import (sqlite3). When I am running a Go application configuration with debugging the IDE adds the -a flag which causes everything to be rebuilt. In my case it takes above 40 seconds for it to start running.</p>\n\n<p>I am using EAP 172.3968.42 (Sep 4th) with Go 1.9 Release</p>\n\n<p><strong>Is there a way to tell it not to add the -a flag?</strong></p>\n\n<p>When I am running without debugging and the flag is not added it takes 3 seconds to compile.\nI don't need to debug any imports, only my code which is in pure Go.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["json", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1504591373, "post_id": 46047136, "comment_id": 79055257, "body": "Why does it matter what name a structure has in protobuf?"}, {"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "reply_to_user": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1504607578, "post_id": 46047136, "comment_id": 79064872, "body": "I&#39;m trying to unmarshal a JSON document into Go structs. But since I&#39;m using Protocol Buffers as the serialization format I need to match the JSON names that get generated by them."}], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1504607624, "post_id": 46048759, "comment_id": 79064896, "body": "Thanks, but this is exactly the same as the second example that I gave."}], "tags": [], "owner": {"reputation": 1242, "user_id": 3873424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9NddA.jpg?s=128&g=1", "display_name": "Ottovsky", "link": "https://stackoverflow.com/users/3873424/ottovsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1504594749, "creation_date": 1504594749, "answer_id": 46048759, "question_id": 46047136, "link": "https://stackoverflow.com/questions/46047136/anonymous-struct-in-protocol-buffer-format/46048759#46048759", "title": "Anonymous struct in Protocol Buffer format", "body": "<p>In order to achieve what you want and get rid of anonymous structs, I think you should declare room message within House and then assign it as repeated, something like this: </p>\n\n<pre><code>message House {\n  message room {\n    string name = 1;\n    int32 windows = 2;\n    int32 doors = 3;        \n  }\n  string address = 1;\n  repeated room rooms = 2;\n}\n</code></pre>\n\n<p>It will correspond to the following structs in go:</p>\n\n<pre><code>type House struct {\n    name         string                     \n    rooms       []*room\n}\n\ntype room struct {\n    name string\n    windows int32\n    doors int32\n}\n</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 954, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504611827, "creation_date": 1504586560, "last_edit_date": 1504611827, "question_id": 46047136, "link": "https://stackoverflow.com/questions/46047136/anonymous-struct-in-protocol-buffer-format", "title": "Anonymous struct in Protocol Buffer format", "body": "<p>Given a Go struct like this:</p>\n\n<pre><code>type House struct {\n    Address string\n    Rooms []struct {\n        Name string\n        Windows int\n        Doors int\n    }\n}\n</code></pre>\n\n<p>Or an equivalent JSON representation:</p>\n\n<pre><code>{\n    \"address\": \"\"\n    \"rooms\": [\n        {\n            \"name\": \"\"\n            \"windows\": 0\n            \"doors\": 0\n        }\n    ]\n}\n</code></pre>\n\n<p>What would the equivalent Protocol Buffer representation be?</p>\n\n<p>This is more or less what I would like to do (althought not a valid Proto syntax):</p>\n\n<pre><code>message House {\n    string address = 1;\n    repeated message {\n        string name = 3;\n        int32 windows = 4;\n        int32 doors = 5;\n    } rooms = 2;\n}\n</code></pre>\n\n<p>Instead, doing it like this is valid, but doesn't represent the data accurately since the original <code>rooms</code> slice contains anonymous objects:</p>\n\n<pre><code>message House {\n    string address = 1;\n    repeated room rooms = 2;\n}\n\nmessage room {\n    string name = 1;\n    int32 windows = 2;\n    int32 doors = 3;\n}\n</code></pre>\n\n<p><strong>Update:</strong> I think I misunderstood how the message declaration works. The second example I gave should be sufficient and actually does not interfere with JSON unmarshalling.</p>\n"}, {"tags": ["go", "tree"], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 4, "last_activity_date": 1504585121, "last_edit_date": 1504585121, "creation_date": 1504584456, "answer_id": 46046886, "question_id": 46046800, "link": "https://stackoverflow.com/questions/46046800/how-to-create-a-binary-tree-use-struct-in-golang/46046886#46046886", "title": "How to create a binary tree use struct in golang?", "body": "<p><code>tree</code> is only a copy of the pointer. Assigning to the variable is useless. Instead, you need to assign to an already existing node. For example:</p>\n\n<p><a href=\"https://play.golang.org/p/Agzby-Yinq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Agzby-Yinq</a></p>\n\n<pre><code>func InsertNodeToTree(tree *TreeNode, node *TreeNode) {\n    if tree == nil {\n        panic(\"cannot insert into nil root\")\n    }\n\n    if node.Value &gt; tree.Value {\n        if tree.Right == nil {\n            tree.Right = node\n        } else {\n            InsertNodeToTree(tree.Right, node)\n        }\n    }\n    if node.Value &lt; tree.Value {\n        if tree.Left == nil {\n            tree.Left = node\n        } else {\n            InsertNodeToTree(tree.Left, node)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2100, "user_id": 2351411, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/CH50M.png?s=128&g=1", "display_name": "Karl Doenitz", "link": "https://stackoverflow.com/users/2351411/karl-doenitz"}, "is_accepted": true, "score": 3, "last_activity_date": 1505992953, "creation_date": 1505992953, "answer_id": 46342649, "question_id": 46046800, "link": "https://stackoverflow.com/questions/46046800/how-to-create-a-binary-tree-use-struct-in-golang/46342649#46342649", "title": "How to create a binary tree use struct in golang?", "body": "<p>In C/C++ programming language, you can use <code>TreeNode *&amp;tree</code>.<br/>\nBut in golang programming language, you can not use <code>*&amp;</code>.<br/>\n<code>tree</code> is just a copy of the pointer, so you can't point the value to another TreeNode.<br/>\nI modified your program, and it can run successfully now.<br/>\nMaybe these codes you need:</p>\n\n<pre><code>package Tree\n\ntype TreeNode struct {\n    Left  *TreeNode\n    Right *TreeNode\n    Value int\n}\n\n\nvar DefaultValue int = -1024\n\n\nfunc InsertNodeToTree(tree *TreeNode, node *TreeNode)(){\n    if tree == nil {\n        return\n    }\n    if tree.Value == DefaultValue {\n        tree.Value = node.Value\n        return\n    }\n    if node.Value &gt; tree.Value {\n        if tree.Right == nil {\n            tree.Right = &amp;TreeNode{Value: DefaultValue}\n        }\n        InsertNodeToTree(tree.Right, node)\n    }\n    if node.Value &lt; tree.Value {\n        if tree.Left == nil {\n            tree.Left = &amp;TreeNode{Value: DefaultValue}\n        }\n        InsertNodeToTree(tree.Left, node)\n    }\n}\n\nfunc InitTree(values ...int) (root *TreeNode) {\n    rootNode := TreeNode{Value: DefaultValue, Right: nil, Left: nil}\n    for _, value := range values {\n        node := TreeNode{Value:value}\n        InsertNodeToTree(&amp;rootNode, &amp;node)\n    }\n    return &amp;rootNode\n}\n</code></pre>\n"}], "owner": {"reputation": 413, "user_id": 3410960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5dcb826a2c8a50f2734fd0559c96ee43?s=128&d=identicon&r=PG&f=1", "display_name": "user3410960", "link": "https://stackoverflow.com/users/3410960/user3410960"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1637, "favorite_count": 0, "accepted_answer_id": 46342649, "answer_count": 2, "score": 3, "last_activity_date": 1505992953, "creation_date": 1504583810, "question_id": 46046800, "link": "https://stackoverflow.com/questions/46046800/how-to-create-a-binary-tree-use-struct-in-golang", "title": "How to create a binary tree use struct in golang?", "body": "<p>I want to create a binary tree and initialize the tree use golang.\nAnd the codes like these:</p>\n\n<pre><code>package Tree\n\nimport \"fmt\"\n\ntype TreeNode struct {\n    Left  *TreeNode\n    Right *TreeNode\n    Value int\n}\n\n\nfunc InsertNodeToTree(tree *TreeNode, node *TreeNode)(){\n    if tree == nil {\n        tree = node\n    }\n    if node.Value &gt; tree.Value {\n        InsertNodeToTree(tree.Right, node)\n    }\n    if node.Value &lt; tree.Value {\n        InsertNodeToTree(tree.Left, node)\n    }\n}\n\nfunc InitTree(values ...int) (root *TreeNode) {\n    rootNode := TreeNode{Value: values[0]}\n    for _, value := range values {\n        node := TreeNode{Value:value}\n        InsertNodeToTree(&amp;rootNode, &amp;node)\n    }\n    return &amp;rootNode\n}\n\nfunc main() {\n    treeNode := InitTree(5, 4, 6, 8, 9, 7, 1, 3, 2)\n    fmt.Println(treeNode)\n}\n</code></pre>\n\n<p>Why the tree's left and right are nil?\nI pass the reference of the tree node, why not work?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 5, "creation_date": 1504583276, "post_id": 46046551, "comment_id": 79052965, "body": "Actually, &quot;A&quot;[0] is a byte, not a rune."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1504588647, "post_id": 46046551, "comment_id": 79054337, "body": "Omg that was embarrassing. Thanks. Fixed the answer."}], "tags": [], "owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "is_accepted": true, "score": 4, "last_activity_date": 1504588618, "last_edit_date": 1504588618, "creation_date": 1504581733, "answer_id": 46046551, "question_id": 46046506, "link": "https://stackoverflow.com/questions/46046506/the-difference-between-a-and-a0/46046551#46046551", "title": "The difference between &quot;A&quot; and &quot;A&quot;[0]", "body": "<p>Golang differentiates strings from bytes.</p>\n\n<p><code>\"A\"</code> is a string, technically <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">a read-only slice of bytes</a>. <code>\"A\"[0]</code> is the first byte in this sequence, whose value is 0x41.</p>\n\n<p>You asked to print first a string (<code>\"A\"</code>), then secondly a byte (<code>\"A\"[0]</code>), in a field of eight characters using binary digits. Your first output was funny because you tried to print a string as if it were some kind of byte value. But a sequence of one byte is not the same as a single byte. Your second output was more natural, since you grabbed the first byte of the string (at index 0), obtaining 0x41.</p>\n"}], "owner": {"reputation": 790, "user_id": 1198482, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/YmbJH.png?s=128&g=1", "display_name": "Baba", "link": "https://stackoverflow.com/users/1198482/baba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 46046551, "answer_count": 1, "score": 1, "last_activity_date": 1504588618, "creation_date": 1504581475, "question_id": 46046506, "link": "https://stackoverflow.com/questions/46046506/the-difference-between-a-and-a0", "title": "The difference between &quot;A&quot; and &quot;A&quot;[0]", "body": "<p>I write this code for convert <code>TEXT</code> to <code>BINARY</code></p>\n\n<pre><code>fmt.Printf(\"%s\\n\", fmt.Sprintf(\"%08b\", \"A\"))\n</code></pre>\n\n<p>and not work, print message: <code>%!b(string=0000000A)</code></p>\n\n<p>but when i changed <code>\"A\"</code> to <code>\"A\"[0]</code> work fine:</p>\n\n<pre><code>fmt.Printf(\"%s\\n\", fmt.Sprintf(\"%08b\", \"A\"[0]))\n</code></pre>\n\n<p>output is <code>01000001</code></p>\n\n<p>what is difference between above statements?</p>\n"}, {"tags": ["algorithm", "go"], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 3, "last_activity_date": 1504587287, "creation_date": 1504587287, "answer_id": 46047238, "question_id": 46046491, "link": "https://stackoverflow.com/questions/46046491/how-to-implement-variable-byte-encoding-algorithm-in-golang/46047238#46047238", "title": "How to implement variable-byte encoding algorithm in golang", "body": "<p>Your encoding is such that the count of least-significant <code>1</code> bits in the first byte tells you how many bytes the encoded value has.</p>\n\n<p>Here's a Go implementation of your code, that avoids depending on endianness (which your C version does), and uses an <code>io.Writer</code> rather than something like <code>memcpy</code>.</p>\n\n<p>See it run at: <a href=\"https://play.golang.org/p/jr0NypSnlW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jr0NypSnlW</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bytes\"\n    \"io\"\n)\n\nfunc encode(w io.Writer, n uint64) error {\n    bytes := 0\n    switch {\n    case n &lt; 128:\n        bytes = 1\n        n = (n &lt;&lt; 1)\n    case n &lt; 16834:\n        bytes = 2\n        n = (n &lt;&lt; 2) | 1\n    case n &lt; 2097152:\n        bytes = 3\n        n = (n &lt;&lt; 3) | 3\n    default:\n        bytes = 4\n        n = (n &lt;&lt; 4) | 7\n    }\n    d := [4]byte{\n        byte(n), byte(n&gt;&gt;8), byte(n&gt;&gt;16), byte(n&gt;&gt;24),\n    }\n    _, err := w.Write(d[:bytes])\n    return err\n}\n\nfunc main() {\n    xs := []uint64{0, 32, 20003, 60006, 300009}\n    var b bytes.Buffer\n    for _, x := range xs {\n        if err := encode(&amp;b, x); err != nil {\n            panic(err)\n        }\n    }\n    fmt.Println(b.Bytes())\n}\n</code></pre>\n"}], "owner": {"reputation": 702, "user_id": 4064006, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QrdHQ.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/4064006/will"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 46047238, "answer_count": 1, "score": 0, "last_activity_date": 1504601390, "creation_date": 1504581352, "question_id": 46046491, "link": "https://stackoverflow.com/questions/46046491/how-to-implement-variable-byte-encoding-algorithm-in-golang", "title": "How to implement variable-byte encoding algorithm in golang", "body": "<p>I'm doing some work with integer compression.<br>\nI've implemented variable-byte encoding algorithm in c++ (see the snippet below).</p>\n\n<p>I wonder how to implement it in golang since I cannot convert <code>string</code> or <code>tune</code>\n type between <code>int</code> type in memory as <code>memcpy()</code> does.</p>\n\n<p>Then, I've figured out <code>binary.Write()</code> in package <code>encoding/binary</code> can do the serializing work, which can encode uint8 into one byte, unint16 into 2 bytes, uint32 in 4 types and so on.</p>\n\n<p>But how to encode a integer, which is between 2097152 and 268435456,  using only 3 bytes ?</p>\n\n<p>Is there any similar converting method like the snippet ?</p>\n\n<pre><code>void encode(int value, char* code_list, int&amp; len) {\n\n  int bit_value = 0;\n  int bit_num = 0;\n\n  if (value &lt; 128) {\n    bit_num = 1;\n  } else if (value &lt; 16384) {\n    bit_num = 2;\n    bit_value = 1;\n  } else if (value &lt; 2097152) {\n    bit_num = 3;\n    bit_value = 3;\n  } else {\n    bit_num = 4;\n    bit_value = 7;\n  }\n  value &lt;&lt;= bit_num;\n  value += bit_value;\n  memcpy(code_list + len, (char*) &amp;value, bit_num);\n  len += bit_num;\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1504682507, "post_id": 46046434, "comment_id": 79098735, "body": "None of your examples are errors in Javascript. Semicolons are not necessary in JS. Your example actually adds 2 + the result of console.log."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1504682629, "post_id": 46046434, "comment_id": 79098811, "body": "I bet your error during Run was &quot;abc is not defined&quot; because you tried to use abc in the console.log call before setting it. Not a syntax error because you might have defined it some other way."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 7169790, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b2ef49341568076eaa9ede9901d6192d?s=128&d=identicon&r=PG&f=1", "display_name": "NHa", "link": "https://stackoverflow.com/users/7169790/nha"}, "edited": false, "score": 0, "creation_date": 1504589885, "post_id": 46046527, "comment_id": 79054726, "body": "Thank you for answer. But I think you did not try what you said before you gave me the answer. I tried before I post the problem, with func (self *Otto) Compile(filename string, src interface{}) (*Script, error). The error is nil."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 1, "last_activity_date": 1504581994, "last_edit_date": 1504581994, "creation_date": 1504581604, "answer_id": 46046527, "question_id": 46046434, "link": "https://stackoverflow.com/questions/46046434/how-can-i-compile-javascript-code-in-golang-and-get-the-detail-error/46046527#46046527", "title": "how can I compile javascript code in golang and get the detail error", "body": "<p>I'm going to ding you for insufficient research. A simple Google of \"golang otto\" brought up <a href=\"https://github.com/robertkrimen/otto\" rel=\"nofollow noreferrer\">the Github page.</a> With a pretty decent README.markdown for documentation. Read it.</p>\n\n<p>Then you find out that Otto has</p>\n\n<pre><code>func (self *Otto) Compile(filename string, src interface{}) (*Script, error)\n</code></pre>\n\n<p>That is as good as it gets. Run that, see what you get in the returned error value.</p>\n\n<p><a href=\"https://github.com/robertkrimen/otto#type-error\" rel=\"nofollow noreferrer\">Also from the documentation:</a></p>\n\n<pre><code>type Error struct {\n}\n\nAn Error represents a runtime error, e.g. a TypeError, a ReferenceError, etc.\n\nfunc (err Error) Error() string\n\nError returns a description of the error\n\nfunc (err Error) String() string\n\nString returns a description of the error and a trace of where the error occurred.\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 7169790, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b2ef49341568076eaa9ede9901d6192d?s=128&d=identicon&r=PG&f=1", "display_name": "NHa", "link": "https://stackoverflow.com/users/7169790/nha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1504590680, "creation_date": 1504580797, "last_edit_date": 1504590680, "question_id": 46046434, "link": "https://stackoverflow.com/questions/46046434/how-can-i-compile-javascript-code-in-golang-and-get-the-detail-error", "title": "how can I compile javascript code in golang and get the detail error", "body": "<p>I am using go language for a project. I need run a piece of js code in go. I know there is an package which is otto. My problem is that how I get the detail error message for the js code. For example:</p>\n\n<pre><code>src :=`\n      abc = 2 + \n      console.log(\"The value of abc is \" + abc)\n `\n</code></pre>\n\n<p>and when I do something let's say <code>compile(src)</code>.<br>\nThen I will get the error that: \nMiss something at second line and miss ';' at third line.<br>\njust like a compiler doing</p>\n\n<p>I already try using the compile of otto before I post the problem, the returned error is nil. \nUsing <code>func (self Otto) Run(src interface{}) (Value, error)</code> of otto for above code will return error, but if the code became </p>\n\n<pre><code>abc = 9\nabc = 2 + \nconsole.log(\"The value of abc is \" + abc) \n</code></pre>\n\n<p>for both <code>func (self Otto) Run(src interface{}) (Value, error)</code> and <code>func (self *Otto) Compile(filename string, src interface{}) (*Script, error)</code> the error are nil</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1504574820, "post_id": 46045756, "comment_id": 79051456, "body": "<code>mux.Vars</code> is for named parameters from your route."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1504577937, "post_id": 46045756, "comment_id": 79052035, "body": "Thanks. Is there some provision for handling optional parameters?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1504579387, "post_id": 46045756, "comment_id": 79052286, "body": "<code>r.URL.Query().Get(&quot;param1&quot;)</code>?"}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1504613032, "post_id": 46045756, "comment_id": 79068369, "body": "Ah. Of course. So the basic answer is, that&#39;s not what mux is for; use the standard way of dealing with query variables."}, {"owner": {"reputation": 1502, "user_id": 619799, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f38cd99a099b3ceff8c38ed526ec4bcd?s=128&d=identicon&r=PG", "display_name": "Marek", "link": "https://stackoverflow.com/users/619799/marek"}, "edited": false, "score": 1, "creation_date": 1547461396, "post_id": 46045756, "comment_id": 95187517, "body": "@ScottDeerwester maybe add this as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "is_accepted": true, "score": 15, "last_activity_date": 1547565201, "creation_date": 1547565201, "answer_id": 54201688, "question_id": 46045756, "link": "https://stackoverflow.com/questions/46045756/retrieve-optional-query-variables-with-gorilla-mux/54201688#54201688", "title": "Retrieve optional query variables with gorilla mux?", "body": "<p>As reflected in a comment, the basic answer is \"that's not what mux is for\". <code>mux</code> is great at picking apart the <em>path</em> portion of a URL, and turning the components into variables. To give a hypothetical example, a call that gives information about a country might have a spec that looks like this:</p>\n\n<pre><code>country/{code}\n</code></pre>\n\n<p>and accept calls that look like this:</p>\n\n<pre><code>http://myhost/country/DE\n</code></pre>\n\n<p>You'd get the value of the <code>code</code> parameter like this:</p>\n\n<pre><code>code := mux.Vars(r)[\"code\"]\n</code></pre>\n\n<p>If you want to pass query variables, you don't do that with mux. Just grab them straight from the request. So given the alternative query syntax:</p>\n\n<pre><code>http://myhost/country?code=DE\n</code></pre>\n\n<p>you'd do:</p>\n\n<pre><code>code := r.URL.Query().Get(\"code\")\n</code></pre>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6205, "favorite_count": 0, "accepted_answer_id": 54201688, "answer_count": 1, "score": 8, "last_activity_date": 1547565201, "creation_date": 1504574424, "question_id": 46045756, "link": "https://stackoverflow.com/questions/46045756/retrieve-optional-query-variables-with-gorilla-mux", "title": "Retrieve optional query variables with gorilla mux?", "body": "<p>I'm writing a handler that can take either POST or GET. As such, I want the option of being able to say:</p>\n\n<pre><code>http://host/query?parm1=value&amp;parm2=value\n</code></pre>\n\n<p>I was assuming that Gorilla mux would then give me:</p>\n\n<pre><code>{\n    \"parm1\": \"value\",\n    \"parm2\": \"value\n}\n</code></pre>\n\n<p>but <code>mux.Vars(r)</code> is empty. I'm aware that using <code>.Query(\"key\", \"value\"</code> will make the parameters mandatory, which isn't what I want. What am I missing?</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "edited": false, "score": 0, "creation_date": 1504578197, "post_id": 46045141, "comment_id": 79052078, "body": "excellent answer, i would give you the star but i typically award the person with &quot;almost&quot; as good answer but with lower points. thanks again"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1504899084, "last_edit_date": 1504899084, "creation_date": 1504568347, "answer_id": 46045141, "question_id": 46044981, "link": "https://stackoverflow.com/questions/46044981/remove-last-element-in-slice/46045141#46045141", "title": "Remove last element in slice", "body": "<p>It looks like you are trying to remove all elements equal to <code>val</code>.  One way to do this is to copy values not equal to <code>val</code> to the beginning of the slice:</p>\n\n<pre><code>func removeElement(nums []int, val int) []int {\n    j := 0\n    for _, v := range nums {\n        if v != val {\n            nums[j] = v\n            j++\n        }\n    }\n    return nums[:j]\n}\n</code></pre>\n\n<p>Return the new slice instead of returning the length. It will be more convenient for the caller.</p>\n\n<p>If you only want to remove the first element equal to <code>val</code>, then use this code:</p>\n\n<pre><code>func removeElement(nums []int, val int) []int {\n    for i, v := range nums {\n        if v == val {\n            return append(nums[:i], nums[i+1:]...)\n        }\n    }\n    return nums\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504899161, "post_id": 46045232, "comment_id": 79209488, "body": "The idiomatic way to write <code>for { if i == len(nums) { break }</code> is <code>for i &lt; len(nums) {</code>."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1504879254, "last_edit_date": 1504879254, "creation_date": 1504569150, "answer_id": 46045232, "question_id": 46044981, "link": "https://stackoverflow.com/questions/46044981/remove-last-element-in-slice/46045232#46045232", "title": "Remove last element in slice", "body": "<p>Adding an index check solves your issue.  <code>Copy</code> has better performance than <code>append</code> but your original append version will still work. <a href=\"https://gist.github.com/xogeny/b819af6a0cf8ba1caaef\" rel=\"nofollow noreferrer\">https://gist.github.com/xogeny/b819af6a0cf8ba1caaef</a></p>\n\n<p>If you are working with slices this is a good page to have in your Go arsenal <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SliceTricks</a></p>\n\n<p>Also note that the function below doesn't update the slice you passed in, so while it will print how many items where removed, the original slice will not have those items removed.</p>\n\n<pre><code>func removeElement(nums []int, val int) int {\n    var i int\n    for {\n        if i == len(nums) {\n            break\n        }\n\n        if nums[i] == val {\n            nums = nums[:i+copy(nums[i:], nums[i+1:])]\n            i = 0\n        }\n        i++\n    }\n    return len(nums)\n}\n</code></pre>\n\n<p>Modified removeElements that also returns the modded list</p>\n\n<pre><code>func removeElement(nums []int, val int) (numberOfItemsRemoved int, newArr []int) {\n    var i int\n    for {\n        if i == len(nums) {\n            break\n        }\n\n        if nums[i] == val {\n            nums = nums[:i+copy(nums[i:], nums[i+1:])]\n            i = 0\n        }\n        i++\n    }\n    return len(nums), nums\n}\n</code></pre>\n\n<p><a href=\"https://goplay.space/#1yfhTkZC4o\" rel=\"nofollow noreferrer\">https://goplay.space/#1yfhTkZC4o</a></p>\n\n<p>You can also modify the original slice by reference so that it doesn't have to be returned</p>\n\n<pre><code>func removeElement(nums *[]int, val int) int {\n    var i int\n    for {\n        if i == len(*nums) {\n            break\n        }\n        slice := (*nums)\n        if slice[i] == val {\n            slice = slice[:i+copy(slice[i:], slice[i+1:])]\n            *nums = slice\n            i = 0\n        }\n        i++\n    }\n    return len(*nums)\n}\n</code></pre>\n\n<p>Example usage <a href=\"https://goplay.space/#leulqgwsjc\" rel=\"nofollow noreferrer\">https://goplay.space/#leulqgwsjc</a></p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1581, "favorite_count": 0, "accepted_answer_id": 46045232, "answer_count": 2, "score": -1, "last_activity_date": 1504899084, "creation_date": 1504566673, "question_id": 46044981, "link": "https://stackoverflow.com/questions/46044981/remove-last-element-in-slice", "title": "Remove last element in slice", "body": "<p>I have the following code:</p>\n\n<pre><code>func TestRemoveElement(t *testing.T) {\n    nums := []int{3, 2, 2, 3}\n    result := removeElement(nums, 3)\n\n    if result != 2 {\n        t.Errorf(\"Expected 2, but it was %d instead.\", result)\n    }\n}\n\nfunc removeElement(nums []int, val int) int {\n\n    for i, v := range nums {\n        if v == val {\n            nums = append(nums[:i], nums[i+1:]...)\n        }\n    }\n    return len(nums)\n}\n</code></pre>\n\n<p>The statement inside the <code>if</code> statement is the most popular way of replacing an element in a slice per this <a href=\"https://stackoverflow.com/questions/25025409/delete-element-in-a-slice\">answer</a>. But this fails deleting the last element due to <code>i+1</code>. i.e if a match is found in the last element, <code>i+1</code> is out of bounds. What better way to replace elements that considers last elements?</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 3490518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844f6d27c825a66395d2314de4d1993d?s=128&d=identicon&r=PG&f=1", "display_name": "J Atkinson", "link": "https://stackoverflow.com/users/3490518/j-atkinson"}, "edited": false, "score": 0, "creation_date": 1504625033, "post_id": 46048388, "comment_id": 79077111, "body": "Yes, I can run that successfully. The error seems to only occur when run from vscode"}], "tags": [], "owner": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "is_accepted": false, "score": 0, "last_activity_date": 1526634643, "last_edit_date": 1526634643, "creation_date": 1504593285, "answer_id": 46048388, "question_id": 46044010, "link": "https://stackoverflow.com/questions/46044010/installing-extensions-from-vscode-shell-generate-fatal-errors/46048388#46048388", "title": "installing extensions from vscode shell generate fatal errors", "body": "<p>Did you try running <code>go get -u -v github.com/cweill/gotests/...</code> ?\nDon't forget the <code>...</code> at the end. The <code>...</code> (ellipsis) tells <code>go get</code> to also fetch the package's sub-packages and its dependencies. </p>\n\n<p>Do you have the <code>$GOPATH/src/github.com/cweill/gotests</code> folder? If yes, you can try deleting it. </p>\n"}], "owner": {"reputation": 3, "user_id": 3490518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844f6d27c825a66395d2314de4d1993d?s=128&d=identicon&r=PG&f=1", "display_name": "J Atkinson", "link": "https://stackoverflow.com/users/3490518/j-atkinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535109995, "creation_date": 1504559154, "last_edit_date": 1535109995, "question_id": 46044010, "link": "https://stackoverflow.com/questions/46044010/installing-extensions-from-vscode-shell-generate-fatal-errors", "title": "installing extensions from vscode shell generate fatal errors", "body": "<p>I am encountering an error when trying to install extensions from vscode on Windows 10 x64. </p>\n\n<p>For instance, when I start up vscode, in the bottom right notification area, I see \"Analysis Tools Missing\". Clicking on this generates an info bar \"Some Go analysis tools are missing from your GOPATH. Would you like to install them?\"</p>\n\n<p>Hitting the install button generates errors:</p>\n\n<blockquote>\n  <p>Installing 1 tool   gotests</p>\n  \n  <p>Installing github.com/cweill/gotests/... FAILED</p>\n  \n  <p>1 tools failed to install.</p>\n  \n  <p>gotests: Error: Command failed: C:\\Go\\bin\\go.exe get -u -v\n  github.com/cweill/gotests/... github.com/cweill/gotests (download)</p>\n  \n  <p>cd C:\\Users\\jchat\\Documents\\Projects\\go\\src\\github.com\\cweill\\gotests;</p>\n  \n  <p>git submodule update --init --recursive </p>\n  \n  <p>fatal: 'submodule' appears to be a git command, but we were not able to execute it. Maybe git-submodule is broken? </p>\n  \n  <p>package github.com/cweill/gotests: exit\n  status 128 </p>\n  \n  <p>...</p>\n</blockquote>\n\n<p>I can execute the command <code>go get -u -v github.com/cweill/gotests/</code> successfully from Git Bash outside of vscode</p>\n\n<p>Is there some configuration I am missing to get this working seamlessly? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1504553734, "post_id": 46043091, "comment_id": 79046477, "body": "s/:=/=/ and please: Take the Tour of Go tour.golang.org."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1504553775, "post_id": 46043091, "comment_id": 79046497, "body": "You are getting this error because you are not using <code>retryValue</code> that is declared outside of <code>init</code>&#39;s scope. Declaring <code>retryValue :=</code> inside <code>init</code>&#39;s scope means that you are instantiating a new variable called <code>retryValue</code> that is accessible only inside of this function."}, {"owner": {"reputation": 25, "user_id": 2101482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VR3IN.jpg?s=128&g=1", "display_name": "tiagopotencia", "link": "https://stackoverflow.com/users/2101482/tiagopotencia"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1504554075, "post_id": 46043091, "comment_id": 79046581, "body": "@AndreaM16 there is no more elegant solution for this?"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": -2, "last_activity_date": 1504554646, "creation_date": 1504554646, "answer_id": 46043301, "question_id": 46043091, "link": "https://stackoverflow.com/questions/46043091/always-a-new-variable-when-multiple-returns/46043301#46043301", "title": "Always a new variable when multiple returns", "body": "<p>Your fix is indeed the shortest way to do this, and no there is not another way to solve the issue.</p>\n\n<p>This problem is rare enough that it is not really an issue in practice, after all it is only one more (short) line.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1504594650, "last_edit_date": 1504594650, "creation_date": 1504555471, "answer_id": 46043426, "question_id": 46043091, "link": "https://stackoverflow.com/questions/46043091/always-a-new-variable-when-multiple-returns/46043426#46043426", "title": "Always a new variable when multiple returns", "body": "<p>There are two basic ways to do this.  You found one:</p>\n\n<pre><code>var retryValue time.Duration\n\nfunc init() {\n    var err error\n    retryValue, err = time.ParseDuration(retries)\n\n    if err != nil {\n        log.Fatal(\"retries value is invalid\", err)\n    }\n}\n</code></pre>\n\n<p>A slightly shorter method would be:</p>\n\n<pre><code>var retryValue = func() time.Duration {\n    rv, err := time.ParseDuration(retries)\n    if err != nil {\n        log.Fatal(\"retries value is invalid\", err)\n    }\n    return rv\n}()\n</code></pre>\n\n<p>But better than either of these, would be to just specify the value directly, rather than parsing it:</p>\n\n<pre><code>var retryValue = 15 * time.Minute // or whatever value you want\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 2101482, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VR3IN.jpg?s=128&g=1", "display_name": "tiagopotencia", "link": "https://stackoverflow.com/users/2101482/tiagopotencia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1504594650, "creation_date": 1504553347, "last_edit_date": 1504554099, "question_id": 46043091, "link": "https://stackoverflow.com/questions/46043091/always-a-new-variable-when-multiple-returns", "title": "Always a new variable when multiple returns", "body": "<p>I'm facing a wierd problem with Golang.</p>\n\n<p>On <code>init()</code> function, i want to assign a value to my variable that was declared outside this function.</p>\n\n<p>But to assign the value to this var, i need to get\n    <code>error</code>\nto check if everything is ok.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>var retryValue time.Duration\n\nfunc init() {\n    retryValue, err := time.ParseDuration(retries)\n\n    if err != nil {\n        log.Fatal(\"retries value is invalid\", err)\n    }\n}\n\nfunc a(){\n    fmt.Println(retryValue)\n}\n</code></pre>\n\n<p>And i get the compiling error:\n    <code>retryValue declared and not used</code></p>\n\n<p>I need to change <code>init()</code> to this:</p>\n\n<pre><code>func init() {\n    var err error\n    retryValue, err = time.ParseDuration(retries)\n\nif err != nil {\n\nlog.Fatal(\"retries value is invalid\", err)\n    }\n}\n</code></pre>\n\n<p>There is another way to solve this problem?\n    <code>:=</code>\nalways create a new variable if one of the variables are already declared? It's about variable golang's sope?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504543814, "post_id": 46041294, "comment_id": 79042940, "body": "Similar types exists in <code>bytes</code> for byte slices as well."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1504543438, "creation_date": 1504543438, "answer_id": 46041294, "question_id": 46041256, "link": "https://stackoverflow.com/questions/46041256/create-a-stream-to-read-a-huge-string-in-go/46041294#46041294", "title": "Create a stream to read a huge string in GO", "body": "<p>Turn any string into an <code>io.Reader</code> with the <code>strings.NewReader</code> method:</p>\n\n<pre><code>reader := strings.NewReader(\"some string\")\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 46041294, "answer_count": 1, "score": -2, "last_activity_date": 1504543438, "creation_date": 1504543263, "question_id": 46041256, "link": "https://stackoverflow.com/questions/46041256/create-a-stream-to-read-a-huge-string-in-go", "title": "Create a stream to read a huge string in GO", "body": "<p>I have a huge xml in a variable and a function to decode this xml. I can't use unmarshal because at a certain momment I need to read an element and add it immediately in the db.</p>\n\n<p>Example:</p>\n\n<pre><code>db := mongo.Connect()\n\ndecoder := xml.NewDecoder(resp.Body)\ndefer resp.Body.Close()\n\nfor {\n    token, _ := decoder.Token()\n    if token == nil {\n        break\n    }\n\n    switch se := token.(type) {\n    case xml.StartElement:\n    ...\n}\n</code></pre>\n\n<p>But now I need to read from a string. So I don't have the resp.Body anymore but a string. The NewDecoder() function receives an io.Reader, so I think I can in read from a stream. How can I do this??</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504542050, "post_id": 46040715, "comment_id": 79042255, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41060764/golang-disable-use-of-internal-package-not-allowed\">golang disable &quot;use of internal package not allowed&quot;</a>"}, {"owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504542551, "post_id": 46040715, "comment_id": 79042460, "body": "@Flimzy I believe not, because the file api.go is certainly within &quot;the tree rooted at the parent of the internal directory&quot;."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504542938, "post_id": 46040715, "comment_id": 79042622, "body": "No, I don&#39;t think it is.  Your error says <code>eth&#47;api.go</code>. This means your code is in a directory called <code>eth</code>, but it&#39;s trying to import from somewhere called <code>go-ethereum</code>.  Perhaps you just need to re-name your directory to adhere to Go&#39;s expectations."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504547516, "post_id": 46040715, "comment_id": 79044309, "body": "What is the result of <code>go env</code> and what is the current working directory when you run <code>go test .</code>? I played around with a similar senario, and could not get it to produce that error as the result of any mistake I could think to try..."}, {"owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504578135, "post_id": 46040715, "comment_id": 79052061, "body": "@MiloChristiansen @Flimzy Apologies. I just realized that I was trying to run the codes from a forked repository <code>github.com&#47;zoonoo&#47;go-ethereum</code>."}, {"owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "edited": false, "score": 1, "creation_date": 1504578175, "post_id": 46040715, "comment_id": 79052073, "body": "Which leads me to further question : Would I have to change all the import codes to actually run the forked repository?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1504582506, "post_id": 46040715, "comment_id": 79052815, "body": "Probably, but at this point you know at least as much as I do on the topic :) Anyway, you should probably write your findings up as a self answer, this seems like an odd enough issue that you could save someone some time someday."}, {"owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504583870, "post_id": 46040715, "comment_id": 79053126, "body": "@MiloChristiansen Will do. Thank you :)"}, {"owner": {"reputation": 8826, "user_id": 10245, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a2909c1103b9ceba6c8933c85dc4f803?s=128&d=identicon&r=PG", "display_name": "Tim Abell", "link": "https://stackoverflow.com/users/10245/tim-abell"}, "edited": false, "score": 0, "creation_date": 1533800564, "post_id": 46040715, "comment_id": 90481632, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/46860546/go-use-of-internal-package-not-allowed-when-running-a-go-project-forked-fro\">Go : &#39;use of internal package not allowed &#39; when running a Go project forked from a github repository</a>"}], "owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3738, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1545804800, "creation_date": 1504540941, "last_edit_date": 1504541980, "question_id": 46040715, "link": "https://stackoverflow.com/questions/46040715/why-get-use-of-internal-package-not-allowed-error-when-importing-an-internal-p", "title": "Why get &#39;use of internal package not allowed&#39; error when importing an internal package?", "body": "<p>I'm running <a href=\"https://github.com/ethereum/go-ethereum\" rel=\"nofollow noreferrer\">go-ethereum</a> test codes for <code>eth</code> <a href=\"https://github.com/ethereum/go-ethereum/tree/master/eth\" rel=\"nofollow noreferrer\">package</a>.</p>\n\n<p>When I run <code>go test .</code> under the <code>eth</code> directory, I get the following error :</p>\n\n<blockquote>\n  <p><code>eth/api.go:37:2: use of internal package not allowed</code></p>\n</blockquote>\n\n<p>37th line of eth/api.go is as follows : \n<code>\"github.com/ethereum/go-ethereum/internal/ethapi\"</code></p>\n\n<p>From what I understand, this import should not be calling the error, as this file is within go-ethereum project directory. </p>\n\n<p>Running the same test command on others' machine does not produce this error, so I suspect that there is something wrong with my go settings.</p>\n\n<p>What would be the problem? Appreciate your help</p>\n"}, {"tags": ["google-app-engine", "firebase", "go", "firebase-authentication", "firebase-admin"], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 5456612, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-h3gOyj8CNgY/AAAAAAAAAAI/AAAAAAAAAiQ/3Jy9aCOOyYQ/photo.jpg?sz=128", "display_name": "Matti", "link": "https://stackoverflow.com/users/5456612/matti"}, "edited": false, "score": 0, "creation_date": 1504595948, "post_id": 46040324, "comment_id": 79057576, "body": "Thanks, that was a good idea. However, the library does not appear to use this http.Client for the HTTP communication with the key server; please see my edit. Bug/oversight in the library?"}, {"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1504636141, "post_id": 46040324, "comment_id": 79082803, "body": "Good catch. The Admin SDK currently uses <code>http.DefaultClient</code> when fetching public key certs. This needs to be fixed to use the client options passed when initializing an App."}, {"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1504645456, "post_id": 46040324, "comment_id": 79087432, "body": "There&#39;s a fix under development at <a href=\"https://github.com/firebase/firebase-admin-go/pull/12\" rel=\"nofollow noreferrer\">github.com/firebase/firebase-admin-go/pull/12</a>. You should be able to try it out by building against the hkj-http-client branch. Any feedback is much appreciated."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1504695993, "post_id": 46040324, "comment_id": 79107781, "body": "Have you actually tried this? It has worked with success for me being hosted in appengine."}, {"owner": {"reputation": 289, "user_id": 5456612, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-h3gOyj8CNgY/AAAAAAAAAAI/AAAAAAAAAiQ/3Jy9aCOOyYQ/photo.jpg?sz=128", "display_name": "Matti", "link": "https://stackoverflow.com/users/5456612/matti"}, "reply_to_user": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1504718579, "post_id": 46040324, "comment_id": 79123733, "body": "@Gavin Yes I did try it. @HiranyaJayathilaka any estimate when this would be in the version that you get with <code>go get</code> ?"}, {"owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "edited": false, "score": 0, "creation_date": 1504810835, "post_id": 46040324, "comment_id": 79169565, "body": "This was released today: <a href=\"https://firebase.google.com/support/release-notes/admin/go#1.0.1\" rel=\"nofollow noreferrer\">firebase.google.com/support/release-notes/admin/go#1.0.1</a>"}], "tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": false, "score": 1, "last_activity_date": 1504539365, "creation_date": 1504539365, "answer_id": 46040324, "question_id": 46038318, "link": "https://stackoverflow.com/questions/46038318/using-firebase-admin-sdk-for-go-from-appengine/46040324#46040324", "title": "Using Firebase Admin SDK for Go from AppEngine", "body": "<p>When creating a new application with the Firebase Admin SDK, you can pass in options from the \"google.golang.org/api/option\" package. The option you want to pass in is <a href=\"https://godoc.org/google.golang.org/api/option#WithHTTPClient\" rel=\"nofollow noreferrer\">WithHTTPClient</a>.</p>\n\n<pre><code>func handleRequest(w http.ResponseWriter, r *http.Request) {\n    ctx := appengine.NewContext(r)\n    opt := option.WithHTTPClient(urlfetch.Client(ctx))\n    app, err := firebase.NewApp(ctx, config, opt)\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 5456612, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-h3gOyj8CNgY/AAAAAAAAAAI/AAAAAAAAAiQ/3Jy9aCOOyYQ/photo.jpg?sz=128", "display_name": "Matti", "link": "https://stackoverflow.com/users/5456612/matti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504833678, "creation_date": 1504532301, "last_edit_date": 1504833678, "question_id": 46038318, "link": "https://stackoverflow.com/questions/46038318/using-firebase-admin-sdk-for-go-from-appengine", "title": "Using Firebase Admin SDK for Go from AppEngine", "body": "<p>while writing a AppEngine/Go backend that would want to verify firebase id tokens (jwt) I ran across this problem running it on AppEngine:</p>\n\n<pre><code>http.DefaultTransport and http.DefaultClient are not available in App Engine. See https://cloud.google.com/appengine/docs/go/urlfetch/\n</code></pre>\n\n<p>The Admin SDK is described here: <a href=\"https://firebase.google.com/docs/admin/setup\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/admin/setup</a></p>\n\n<p>The following might fix it, only if client.ks was an exported property and thus writable from the app using the lib:</p>\n\n<pre><code>client, err := app.Auth()\nif err != nil {\n    log.Errorf(ctx, \"Error getting auth client: %v\", err)\n    writeJsonResponse(ctx, w, apiResponse{Message: \"Firebase error\"},\n        http.StatusInternalServerError)\n    return\n}\n\n// Override the HTTP client by using the urlfetch client to\n// make it work under AppEngine\nclient.ks.HTTPClient = urlfetch.Client(ctx)\n</code></pre>\n\n<p>Are my options limited to a) forking this and manually adding support for urlfetch b) looking for another solutions besides the seemingly OFFICIAL one.. :o</p>\n\n<p>EDIT: As suggested by Gavin, I tried changing this to the following: </p>\n\n<pre><code>// Override the default HTTP client with AppEngine's urlfetch\nopt := option.WithHTTPClient(urlfetch.Client(ctx))\n\napp, err := firebase.NewApp(ctx, nil, opt)\nif err != nil {\n    log.Errorf(ctx, \"Error initializing firebase app: %v\", err)\n    writeJsonResponse(ctx, w, apiResponse{Message: \"Firebase error\"},\n        http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>This, however, doesn't do the trick. As far as I can see (having done some source diving in the said library <code>\"firebase.google.com/go\"</code>), the http.Client passed in through the options.Client is only used for Creds creation:</p>\n\n<pre><code>creds, err := transport.Creds(ctx, o...)\n</code></pre>\n\n<p>And the actual HTTP communication done in method <code>refreshKeys()</code> of <code>crypto.go</code> does not use this; instead, it attempts to use the HTTPClient property set in the <code>httpKeySource</code>. IMO this is never set anywhere, and therefore it always defaults to the <code>http.DefaultClient</code>.</p>\n"}, {"tags": ["arrays", "go", "multidimensional-array"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1504531219, "post_id": 46037883, "comment_id": 79036131, "body": "<i>is there an easier way?</i> Than what? You haven&#39;t shown your implementation."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 0, "last_activity_date": 1504537048, "creation_date": 1504537048, "answer_id": 46039685, "question_id": 46037883, "link": "https://stackoverflow.com/questions/46037883/append-new-row-to-multidimensional-slice/46039685#46039685", "title": "Append new row to multidimensional slice", "body": "<p>The way you present is indeed how it should be done, certainly it is the easiest way...</p>\n\n<p>There is a way to do it with <code>copy</code>, but that would require you to manually alocate a new slice, so it would often be far slower, and in every case it would require more code.</p>\n\n<p>If you need to add a new column <em>in the middle or at the beginning</em> of the existing ones, then you will need to alocate a new slice (or, if your current slice has unused space, increases it's length), copy the elements from the old slice to the new slice (in two operations so the slot you need for your new item is left empty), and finaly add your new item directly. This takes a minimum of 3 lines of code in the most compact case, more with bounds checking and optional higher efficency paths.</p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 46039685, "answer_count": 1, "score": -3, "last_activity_date": 1504537048, "creation_date": 1504530826, "last_edit_date": 1504535560, "question_id": 46037883, "link": "https://stackoverflow.com/questions/46037883/append-new-row-to-multidimensional-slice", "title": "Append new row to multidimensional slice", "body": "<p>I have a function which creates a 2d slice, one row and three columns</p>\n\n<pre><code>func threeSum(nums []int) [][]int {\n    result := make([][]int, 1)\n    result[0] = []int{1, 2, 3}\n    return result\n}\n</code></pre>\n\n<p>What if I want to dynamically add a row?</p>\n\n<p>If <code>result</code> was just a normal slice I would just append to the end of the slice, however with the 2d array it seems I have to manually do a lot of things, is there an easier way?</p>\n\n<p>EDIT: My way of doing it would be, if I need to add a new row:</p>\n\n<pre><code>result = append(result, []int{4, 2, 3})\n</code></pre>\n\n<p>Which in hindsight isn't actually bad :) If anyone has an opinion I'll be happy to accept.</p>\n"}, {"tags": ["testing", "go", "ide", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1504529682, "post_id": 46037333, "comment_id": 79035203, "body": "What are you trying to do?"}, {"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1504531263, "post_id": 46037333, "comment_id": 79036161, "body": "run my tests inside of gogland.  currently I run the tests in a shell using the following:  go test -v -cover $$(find . -name &#39;<i>test.go&#39; -not -path &#39;./vendor/</i>&#39; -exec dirname {} \\; | uniq) I think the IDE is hardcoded to always use ./... when type directory is selected for the build conf so this is probably a feature request for the team at JB"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1504533288, "post_id": 46037333, "comment_id": 79037409, "body": "Note that if you use Go 1.9 you no longer need to manually exclude the <code>.&#47;vendor&#47;</code> path, as <code>go test .&#47;...</code> will do that automatically for you (yay!) Perhaps updating to 1.9 is an easier way to fix this problem?"}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 3, "last_activity_date": 1504531738, "creation_date": 1504531738, "answer_id": 46038168, "question_id": 46037333, "link": "https://stackoverflow.com/questions/46037333/gogland-test-configuration-always-executed-with/46038168#46038168", "title": "Gogland Test Configuration always executed with ./", "body": "<p>Depending on what you need to run you can select different configuration types.</p>\n\n<p>For the one in your picture, Run Kind Directory is selected and that means the IDE will run the tests in the directory you point it at and since the working directory is in the same directory, it will run <code>./...</code> as that's what it means.</p>\n\n<p>For the Run Kind Package, it will run only the specified package and no other packages, so no <code>/...</code> appended to it.</p>\n\n<p>For the Run Kind File it will run the tests in a single file. </p>\n\n<p>The pattern that you've added, <code>./svc</code> tells the go tool how to match test names. There you should put valid patterns for test names. If you want to control for which directory / package the tests are run you can use a different run configuration per directory / package since multiple configurations are possible.</p>\n\n<p>Based on your reply you want to run the tests in your whole projects, recursive, without the vendor folder. To do so, create a Run Kind Directory, as you have one already, and make sure sure you are using Go 1.9 as it will automatically ignore the <code>vendor</code> directory when using <code>./...</code> matching.</p>\n\n<p>Please let me know if you need further details.</p>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 1, "accepted_answer_id": 46038168, "answer_count": 1, "score": 1, "last_activity_date": 1504531738, "creation_date": 1504528893, "question_id": 46037333, "link": "https://stackoverflow.com/questions/46037333/gogland-test-configuration-always-executed-with", "title": "Gogland Test Configuration always executed with ./", "body": "<p>No matter how I set my build configuration for running my tests the go test tool is always run with ./...</p>\n\n<p>E.G.</p>\n\n<p><a href=\"https://i.stack.imgur.com/AbVJ1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AbVJ1.png\" alt=\"enter image description here\"></a></p>\n\n<p>runs:</p>\n\n<p><strong>go test -v -cover ./... -run ./svs</strong></p>\n"}, {"tags": ["mongodb", "select", "go", "mgo"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1504525285, "post_id": 46035952, "comment_id": 79032562, "body": "<code>Find</code> returns a whole document that matches the conditions. In your case the conditions are: <code>fid</code> equals to some <code>id</code>, and <code>ch</code> has at least one sub-document with <code>trashed</code> equals to <code>false</code>. You need to either process the result on the client side, or use <a href=\"https://godoc.org/labix.org/v2/mgo#Collection.Pipe\" rel=\"nofollow noreferrer\">aggregation framework</a>."}, {"owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "edited": false, "score": 0, "creation_date": 1504526321, "post_id": 46035952, "comment_id": 79033218, "body": "What&#39;s the expected result ? One big array with all <code>ch</code> items where <code>trashed</code> is false ? Several documents with filtered <code>ch</code> array ? you should post the  <code>ChildParentsData</code> structure to make it clearer"}, {"owner": {"reputation": 77, "user_id": 8375461, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1107778f0c7e4e33c27b8d8ffe358b0?s=128&d=identicon&r=PG&f=1", "display_name": "Khazar Amjer", "link": "https://stackoverflow.com/users/8375461/khazar-amjer"}, "reply_to_user": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "edited": false, "score": 0, "creation_date": 1504526897, "post_id": 46035952, "comment_id": 79033539, "body": "Thank you @felix , I have already added the struct"}], "answers": [{"tags": [], "owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "is_accepted": true, "score": 2, "last_activity_date": 1504527789, "creation_date": 1504527789, "answer_id": 46036985, "question_id": 46035952, "link": "https://stackoverflow.com/questions/46035952/golang-mongodb-can-not-do-select/46036985#46036985", "title": "Golang , mongodb can not do select", "body": "<p>You can achieve this using the aggregation framework, thanks to the <strong><code>$replaceRoot</code></strong> operator introduced in <strong>MongoDB 3.4</strong></p>\n\n<p>We first get matching documents for the specific <code>fid</code>, then we unwind the array and remove docmuments where <code>ch.trashed</code> is true. Finally, we remove the <code>ch</code> field by promoting the content of <code>ch</code> as root of the document</p>\n\n<p>Here is the code to achieve this: </p>\n\n<pre><code>type ChildParentsData struct {\n        Id      bson.ObjectId `json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n        Trashed bool          `json:\"trashed\" bson:\"trashed\"`\n}\nvar tree []ChildParentsData\n\npipeline := []bson.M{\n    {\"$match\": bson.M{\"fid\": bson.ObjectIdHex(\"59ad187a6b9600120bd03a53\")}},\n    {\"$unwind\": \"$ch\"},\n    {\"$match\": bson.M{\"ch.trashed\": false}},\n    {\"$replaceRoot\": bson.M{\"newRoot\": \"$ch\"}}}\n\nerr = Connection.Session.DB(\"cctv_storage\").C(\"tree\").Pipe(pipeline).All(&amp;tree)\n\nif err != nil {\n    fmt.Printf(\"error: %v\", err)\n    os.Exit(0)\n}\nfmt.Printf(\"doc: %v\", tree)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 2727451, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J3wR4.jpg?s=128&g=1", "display_name": "yzark", "link": "https://stackoverflow.com/users/2727451/yzark"}, "is_accepted": false, "score": 0, "last_activity_date": 1577969516, "creation_date": 1577969516, "answer_id": 59563688, "question_id": 46035952, "link": "https://stackoverflow.com/questions/46035952/golang-mongodb-can-not-do-select/59563688#59563688", "title": "Golang , mongodb can not do select", "body": "<p>An quick way to get the particular fields instead of all the fileds is using projection. An example of golang is here:</p>\n\n<pre><code>    filter := bson.D{{\"_id\" , bson.ObjectIdHex(\"59ad187a6b9600120bd03a53\")}}\n    projection := bson.D{{\"ch\", 0}}\n    collection.FindOne(context.TODO(), filter, options.FindOne())\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 8375461, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e1107778f0c7e4e33c27b8d8ffe358b0?s=128&d=identicon&r=PG&f=1", "display_name": "Khazar Amjer", "link": "https://stackoverflow.com/users/8375461/khazar-amjer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 516, "favorite_count": 0, "accepted_answer_id": 46036985, "answer_count": 2, "score": 2, "last_activity_date": 1577969516, "creation_date": 1504524110, "last_edit_date": 1504526844, "question_id": 46035952, "link": "https://stackoverflow.com/questions/46035952/golang-mongodb-can-not-do-select", "title": "Golang , mongodb can not do select", "body": "<p>In my case I have a  collection where I have stored a data with a  structure that below</p>\n\n<pre><code>{ \n    \"_id\" : ObjectId(\"59ad187a0447d3617fb802b8\"), \n    \"fid\" : ObjectId(\"59ad187a6b9600120bd03a53\"), \n    \"pr\" : [\n        {\n            \"_id\" : ObjectId(\"59ad187a6b9600120bd03a53\"), \n            \"trashed\" : false\n        }\n    ], \n    \"ch\" : [\n        {\n            \"_id\" : ObjectId(\"59ad18a36b9600120bd03a57\"), \n            \"trashed\" : false\n        }, \n        {\n            \"_id\" : ObjectId(\"59ad18a36b9600120bd03a99\"), \n            \"trashed\" : false\n        }, \n        {\n            \"_id\" : ObjectId(\"59ad18a36b9600120bd03a98\"), \n            \"trashed\" : true\n        }, \n        {\n            \"_id\" : ObjectId(\"59ad18a36b9600120bd03a97\"), \n            \"trashed\" : false\n        }\n    ]\n}\n</code></pre>\n\n<p>So I want to get all objects  in <code>ch</code> where trashed is <code>false</code> </p>\n\n<p>Here is my query </p>\n\n<pre><code>       type ChildParentsData struct {\n       Id      bson.ObjectId `json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n       Trashed bool          `json:\"trashed\" bson:\"trashed\"`\n       }\n        var tree []ChildParentsData\n        err := Connection.Session.DB(\"cctv_storage\").C(\"tree\").Find(\n               bson.M{\n                  \"fid\": bson.ObjectIdHex(id), \"ch.trashed\": false\n               }).Select(\n               bson.M{\n                  \"ch.$\": 1\n                }).All(&amp;tree)\n</code></pre>\n\n<p>But as a response I am getting all data, but I need only <code>objects</code> in <code>ch</code></p>\n"}, {"tags": ["go", "govendor"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1504524727, "post_id": 46035305, "comment_id": 79032248, "body": "I cant recreate atm, but Ive had similar issues due to go not pulling in dependencies properly, try this to see if it helps: &#39;go get -u github.com/kardianos/govendor/...&#39; Note: the elipsis at the end, this should pull all dependencies of that package and ensure they are met"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 6547029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09af25c01607194472987c9494108ef?s=128&d=identicon&r=PG&f=1", "display_name": "Pelli", "link": "https://stackoverflow.com/users/6547029/pelli"}, "is_accepted": false, "score": 1, "last_activity_date": 1504536261, "creation_date": 1504536261, "answer_id": 46039472, "question_id": 46035305, "link": "https://stackoverflow.com/questions/46035305/golang-not-a-package-file-after-go-get-u-from-github/46039472#46039472", "title": "golang - &quot;not a package file&quot; after &quot;go get -u&quot; from github", "body": "<p>I have solved cleaning my <code>$GOPATH/pkg</code> folder and then re-executing:<br>\n<code>go get -u github.com/kardianos/govendor</code></p>\n"}], "owner": {"reputation": 21, "user_id": 6547029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d09af25c01607194472987c9494108ef?s=128&d=identicon&r=PG&f=1", "display_name": "Pelli", "link": "https://stackoverflow.com/users/6547029/pelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504536261, "creation_date": 1504521651, "question_id": 46035305, "link": "https://stackoverflow.com/questions/46035305/golang-not-a-package-file-after-go-get-u-from-github", "title": "golang - &quot;not a package file&quot; after &quot;go get -u&quot; from github", "body": "<p>I am tryng to install <code>govendor</code> using the command<br>\n<code>go get -u github.com/kardianos/govendor</code>  </p>\n\n<p>but everytime I get the following  </p>\n\n<pre><code># github.com/kardianos/govendor/cliprompt\ngo/src/github.com/kardianos/govendor/cliprompt/cliPrompt.go:13:2: import /home/pelli/go/pkg/linux_amd64/github.com/kardianos/govendor/prompt.a: not a package file\n\n# github.com/kardianos/govendor/context\ngo/src/github.com/kardianos/govendor/context/context.go:18:2: import /home/pelli/go/pkg/linux_amd64/github.com/kardianos/govendor/internal/pathos.a: not a package file\n</code></pre>\n\n<p>I am using golang version 1.9 linux/amd64 with the following env:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/pelli/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build215462614=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\n</code></pre>\n\n<p>What is causing these issues?\nThank you</p>\n"}, {"tags": ["go", "intellij-idea"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1504516530, "creation_date": 1504516530, "answer_id": 46033897, "question_id": 46033761, "link": "https://stackoverflow.com/questions/46033761/how-to-import-local-packages/46033897#46033897", "title": "how to import local packages?", "body": "<p>Use the full path:</p>\n\n<pre><code>import (\n    \"github.com/myname/myproject/src/cmd\"\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38, "user_id": 7847851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377837b0bf7c7c07af916ccfc863b216?s=128&d=identicon&r=PG&f=1", "display_name": "winhbb", "link": "https://stackoverflow.com/users/7847851/winhbb"}, "is_accepted": true, "score": 1, "last_activity_date": 1504522511, "last_edit_date": 1504522511, "creation_date": 1504521772, "answer_id": 46035344, "question_id": 46033761, "link": "https://stackoverflow.com/questions/46033761/how-to-import-local-packages/46035344#46035344", "title": "how to import local packages?", "body": "<p>You may change the folder name \"cmd\" to other name,because there is already an package \"cmd\" in the standard library.</p>\n"}], "owner": {"reputation": 1, "user_id": 7192294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f30ed9d2956f9943b5e7fb1c6288d53?s=128&d=identicon&r=PG&f=1", "display_name": "L.zhang", "link": "https://stackoverflow.com/users/7192294/l-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 46035344, "answer_count": 2, "score": -1, "last_activity_date": 1504522511, "creation_date": 1504516033, "last_edit_date": 1504516478, "question_id": 46033761, "link": "https://stackoverflow.com/questions/46033761/how-to-import-local-packages", "title": "how to import local packages?", "body": "My GOPATH and GOROOT\n\n<pre><code>GOPATH=\"/Users/road/IdeaProjects/MiniJVM\"\nGOROOT=\"/usr/local/go\"\n</code></pre>\n\nMy golang project structure\n\n<pre><code>Myproject\n---.idea\n---src\n   ---cmd\n      ---cmd.go\n   ---test\n      ---test.go\n</code></pre>\n\ntest.go file, I will use the imports from other packages .What is wrong with my code? Or the import path has some problem?\n\n<pre><code>package main\n\nimport (\n     \"fmt\"\n     \"cmd\"\n)\nfunc main()  {\n     command := &amp;Cmd{}//unresolved type 'Cmd'\n}\n</code></pre>\n\ncmd.go file\n\n<pre><code>package cmd\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\n/*\n    jaca [-option] class [args...]\n*/\ntype Cmd struct {\n    HelpFlag bool\n    VersionFlag bool\n    CpOption string\n    Class string\n    Args []string\n}\n</code></pre>\n"}, {"tags": ["ubuntu", "go", "build", "goland"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1504513197, "post_id": 46032811, "comment_id": 79025710, "body": "1. Never ever set GOROOT. Never. No diskussion here. 2. Probably just don&#39;t use -a. 3. Use the official installation from golang.org, not from Ubuntu."}, {"owner": {"reputation": 23, "user_id": 8557531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4fbb0bbb14ee6167847543a4321fa9d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark M", "link": "https://stackoverflow.com/users/8557531/mark-m"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1504515394, "post_id": 46032811, "comment_id": 79026877, "body": "@Volker 1. I did not set GOROOT. Perhaps gogland does it for you when you choose an SDK (I can&#39;t run a program withut choosing an SDK)? 2. It seems gogland uses -a by default. How can I change that? 3. I used the official gogland distribution (tar.gz downloaded from golang.org)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1504609416, "post_id": 46032811, "comment_id": 79066002, "body": "<a href=\"https://stackoverflow.com/q/46050568/720999\">See also</a>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8557531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4fbb0bbb14ee6167847543a4321fa9d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark M", "link": "https://stackoverflow.com/users/8557531/mark-m"}, "edited": false, "score": 0, "creation_date": 1504515758, "post_id": 46033451, "comment_id": 79027086, "body": "I did not set GOROOT. I only chose the SDK in gogland. It seems gogland uses the -a switch by default (why?), and I am nut sure how to control it."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 23, "user_id": 8557531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4fbb0bbb14ee6167847543a4321fa9d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark M", "link": "https://stackoverflow.com/users/8557531/mark-m"}, "edited": false, "score": 0, "creation_date": 1504520585, "post_id": 46033451, "comment_id": 79029954, "body": "@MarkM, based on the comment thread to <a href=\"https://stackoverflow.com/q/45961085/720999\">this recent question</a>, I&#39;d probably recommend to drop Goglang for a while -- until its authors at least learn how Go projects are supposed to be built properly.  Consider trying vscode or something lighter like LiteIDE.  Note that you can work with Go just fine from popular text editors (Vim, Emacs) inclduding hipster things like Sublime."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1504531232, "post_id": 46033451, "comment_id": 79036145, "body": "@kostix there are a number of reasons why the IDE does what it does.  For GOROOT, it needs to do that because you can actually configure it to use different Go versions for different projects, regardless of the configuration you have in your system.  For go build -a, this is done in order to help delve get better debugging information and it wasn&#39;t possible to to do reliably until Go 1.9. Any editor using delve debug package/name will automatically do so under the hood without you knowing what&#39;s happening.  So please stop mocking things you do not understand."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1504607207, "post_id": 46033451, "comment_id": 79064666, "body": "@dlsniper, thanks for your insight. I disagree on the need of setting <code>GOROOT</code> though: recent (that is, 1.4+, I reckon) versions of Go figure out <code>GOROOT</code> just out of the location of their <code>go</code> binary, so it&#39;s perfectly okay to run something like <code>~&#47;devel&#47;golang1.9&#47;bin&#47;go env</code> and see it having set <code>GOROOT</code> to <code>~&#47;devel&#47;golang1.9&#47;</code> all by itself."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 1, "creation_date": 1504607884, "post_id": 46033451, "comment_id": 79065079, "body": "Go 1.9 changed how it detects where Go is installed, not Go 1.4, making GOROOT less needed. However, there&#39;s no control over the user environment or the way go was installed. For example you can still unpack the Go 1.8 tarball from the website and it will want Go to be in /usr/local/go If by any chance it&#39;s there, it will use that. For Windows it&#39;s the same / worse as Go really doesn&#39;t play nice in a multi-version setup there. Even so, users might have that variable set, but maybe to a different location and so on. Hope this helps understanding the complexities behind this choice."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1504514998, "creation_date": 1504514998, "answer_id": 46033451, "question_id": 46032811, "link": "https://stackoverflow.com/questions/46032811/golang-build-i-a-fails-permission-denied/46033451#46033451", "title": "golang build -i -a fails (permission denied)", "body": "<p>The <code>-a</code> command-line option tells the <code>go</code> tool to rebuild <em>\"everything</em> Go\", and this includes the Go standard library and even the Go runtime itself\u2014that stuff linked to each Go program which actually implements goroutines and all the interesting bits.</p>\n\n<p>Since you have Go installed into a location not normally writable by end users (<code>/usr/local/go</code>), an attempt to recompile and update files there (<code>/usr/local/go/pkg</code>) rightfully fails with \"permission denied\".</p>\n\n<p>The main takeaway is that there is exactly zero cases you'd need to pass <code>-a</code> to <code>go build</code> until you very well understand what you want to achieve, and this will come quite later in your learning curve ;-)</p>\n\n<p>So please do what @Volker said:</p>\n\n<ul>\n<li>Don't set <code>GOROOT</code>.</li>\n<li>Don't use <code>-a</code> with <code>go build</code>.</li>\n</ul>\n\n<p>Also condier using <code>go install</code> instead of <code>go build</code> \u2014 for the reasons\nexplained <a href=\"https://dave.cheney.net/2014/06/04/what-does-go-build-build\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 4, "last_activity_date": 1504561011, "last_edit_date": 1504561011, "creation_date": 1504523691, "answer_id": 46035845, "question_id": 46032811, "link": "https://stackoverflow.com/questions/46032811/golang-build-i-a-fails-permission-denied/46035845#46035845", "title": "golang build -i -a fails (permission denied)", "body": "<p>Edit: EAP 13 was just released and it fixes this specific problem. Please see: <a href=\"https://blog.jetbrains.com/go/2017/09/04/gogland-eap-13-better-completion-new-inspections-fixed-performance-bugs-and-more/\" rel=\"nofollow noreferrer\">https://blog.jetbrains.com/go/2017/09/04/gogland-eap-13-better-completion-new-inspections-fixed-performance-bugs-and-more/</a></p>\n\n<p>Original:</p>\n\n<p>This happens because of upgraded support from Delve for Go 1.9 projects. </p>\n\n<p>The latest version of Delve will use <code>-a</code> in order to recompile all transitive dependencies and ensure none of them are included with their optimized versions instead of the debugging friendly ones so that it can remove a lot of potential bugs.</p>\n\n<p>You can remove the <code>-i</code> flag so that the dependencies are not installed, which shouldn't cause the error anymore.</p>\n\n<p>This will be improved hopefully in Go 1.10 as there are changes depending on the Go team.</p>\n\n<p>Hope this explains the issue, if not, please see the discussion here: <a href=\"https://youtrack.jetbrains.com/issue/GO-4382\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-4382</a></p>\n\n<p>Edit: this will be addressed in the EAP 13, which is bound to be released very soon, see the tracking issue here: <a href=\"https://youtrack.jetbrains.com/issue/GO-4430\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-4430</a> as it contains additional details regarding this problem</p>\n"}], "owner": {"reputation": 23, "user_id": 8557531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4fbb0bbb14ee6167847543a4321fa9d?s=128&d=identicon&r=PG&f=1", "display_name": "Mark M", "link": "https://stackoverflow.com/users/8557531/mark-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4931, "favorite_count": 0, "accepted_answer_id": 46035845, "answer_count": 2, "score": 2, "last_activity_date": 1504561011, "creation_date": 1504512590, "last_edit_date": 1504512995, "question_id": 46032811, "link": "https://stackoverflow.com/questions/46032811/golang-build-i-a-fails-permission-denied", "title": "golang build -i -a fails (permission denied)", "body": "<p>I am a go newbie.</p>\n\n<p>I have installed golang 1.9 from the official binary distribution on my ubuntu. I have also installed the Gogland IDE.</p>\n\n<p>When I try to debug the simplest go program (\"hello world\") using Gogland, I get the following error:</p>\n\n<pre><code>GOROOT=/usr/local/go\nGOPATH=/home/user/go\n/usr/local/go/bin/go build -i -o /tmp/defaultgo -gcflags \"-N -l\" -a /home/user/go/src/hello/hello.go\ngo install runtime/internal/sys: open /usr/local/go/pkg/linux_amd64/runtime/internal/sys.a: permission denied\n</code></pre>\n\n<p>When trying to build from the command line (not using Gogland), I noticed that I get the same error whenever I am using the <code>-i -a</code> switches.</p>\n"}, {"tags": ["go", "gtk3"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1504524979, "post_id": 46032434, "comment_id": 79032401, "body": "Hey Andrea, sorry I cant help with the package you are using, I just wanted to suggest this as an alternative - I have been using recently for cross-platform ui in go with great success (no affiliation) - <a href=\"https://github.com/sciter-sdk/go-sciter\" rel=\"nofollow noreferrer\">github.com/sciter-sdk/go-sciter</a> - might be worth a look, also uses gtk for mac/nix but also provides win support and comes with hundreds of examples and has a very helpful forum"}], "answers": [{"tags": [], "owner": {"reputation": 730, "user_id": 1444925, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5b2e5a98c2b0f196dc18e6304043a26c?s=128&d=identicon&r=PG", "display_name": "Andrea Iacono", "link": "https://stackoverflow.com/users/1444925/andrea-iacono"}, "is_accepted": true, "score": 0, "last_activity_date": 1504597480, "creation_date": 1504597480, "answer_id": 46049542, "question_id": 46032434, "link": "https://stackoverflow.com/questions/46032434/unable-to-create-a-menubar-in-a-gotk3-application/46049542#46049542", "title": "Unable to create a menubar in a gotk3 application", "body": "<p>OK, I found out how to do it. Following this <a href=\"https://askubuntu.com/questions/619943/creating-menu-bar-in-gtk\">example</a> I understood the steps needed to create a menu on GTK. The edited part is:</p>\n\n<pre><code>    // creates menu\n    menuBar, err := gtk.MenuBarNew()\n    if err != nil {\n        log.Fatal(\"Unable to create menubar:\", err)\n    }\n\n    fileMenu, err := gtk.MenuNew()\n    if err != nil {\n        log.Fatal(\"Unable to create menu:\", err)\n    }\n\n    fileMenuItem, err := gtk.MenuItemNewWithLabel(\"File\")\n    if err != nil {\n        log.Fatal(\"Unable to create menuitem:\", err)\n    }\n\n    openMenuItem, err := gtk.MenuItemNewWithLabel(\"Open\")\n    if err != nil {\n        log.Fatal(\"Unable to create menuitem:\", err)\n    }\n\n    fileMenuItem.SetSubmenu(fileMenu)\n    fileMenu.Append(openMenuItem)\n    menuBar.Append(fileMenuItem)\n\n    gtkGrid.Attach(menuBar, 0, 0, 200, 200)\n    win.Add(gtkGrid)\n</code></pre>\n\n<p>Now the menu is displayed over the label (on MacOsX), but at least it's displayed. </p>\n"}], "owner": {"reputation": 730, "user_id": 1444925, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5b2e5a98c2b0f196dc18e6304043a26c?s=128&d=identicon&r=PG", "display_name": "Andrea Iacono", "link": "https://stackoverflow.com/users/1444925/andrea-iacono"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 46049542, "answer_count": 1, "score": 2, "last_activity_date": 1504597480, "creation_date": 1504510929, "question_id": 46032434, "link": "https://stackoverflow.com/questions/46032434/unable-to-create-a-menubar-in-a-gotk3-application", "title": "Unable to create a menubar in a gotk3 application", "body": "<p>I'm using <a href=\"https://github.com/gotk3/gotk3\" rel=\"nofollow noreferrer\">gotk3</a> (a project that provides Go bindings for GTK+3) for writing a simple GUI application. I'd like to show a menu bar in the application but now it doesn't show any menu (tested on both MacOSX and Linux). This is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gotk3/gotk3/gtk\"\n    \"log\"\n)\n\nfunc main() {\n\n    gtk.Init(nil)\n\n    // creates window\n    win, err := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n    if err != nil {\n        log.Fatal(\"Unable to create window:\", err)\n    }\n    win.SetDefaultSize(800, 600)\n    win.Connect(\"destroy\", func() {\n        gtk.MainQuit()\n    })\n\n    // creates grid and label\n    grid, err := gtk.GridNew()\n    if err != nil {\n        log.Fatal(\"Unable to create grid:\", err)\n    }\n    label, _ := gtk.LabelNew(\"Hello, gotk3!\")\n    grid.Add(label)\n\n\n    // creates menu\n    menuBar, err := gtk.MenuBarNew()\n    if err != nil {\n        log.Fatal(\"Unable to create menubar:\", err)\n    }\n\n    menu, err := gtk.MenuNew()\n    if err != nil {\n        log.Fatal(\"Unable to create menu:\", err)\n    }\n    menu.SetName(\"File\")\n\n    menuItem, err := gtk.MenuItemNewWithLabel(\"Open\")\n    if err != nil {\n        log.Fatal(\"Unable to create menuitem:\", err)\n    }\n    menu.Append(menuItem)\n\n    // attaches menubar to grid\n    grid.Attach(menuBar, 0, 0, 200, 200)\n\n    // shows window\n    win.Add(grid)\n    win.ShowAll()\n    gtk.Main()\n}\n</code></pre>\n\n<p>Since it doesn't work I don't think that <code>Attach()</code> is the right function for doing this. I never worked with GTK+, so almost no idea of what to do or where to look. Any hint?</p>\n\n<p>Thanks,\nAndrea</p>\n"}, {"tags": ["rest", "curl", "go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 5, "last_activity_date": 1504508003, "last_edit_date": 1504508003, "creation_date": 1504488767, "answer_id": 46029254, "question_id": 46028723, "link": "https://stackoverflow.com/questions/46028723/i-cannot-get-posted-body-in-revel-go-framework/46029254#46029254", "title": "I cannot get posted body in revel go framework", "body": "<p>According to the <a href=\"https://github.com/revel/revel/blob/v0.17.1/params.go#L63\" rel=\"nofollow noreferrer\">source of Revel</a>, when the request content type is either <code>application/json</code> or <code>text/json</code>, the content of request body is automatically read from stream and stored to <a href=\"https://godoc.org/github.com/revel/revel#Params\" rel=\"nofollow noreferrer\">c.Params.JSON</a> which has type <code>[]byte</code>.</p>\n\n<p>Since the <a href=\"https://godoc.org/net/http#Request\" rel=\"nofollow noreferrer\">Request.Body</a> is a stream which can only be read once, you cannot read it again (and anyway, your code won't work even if Revel does not automatically read the stream, since <code>c.Request.Body</code> is not correctly serialiazable using<code>c.RenderJSON()</code>).</p>\n\n<p>Revel has convenient function <a href=\"https://godoc.org/github.com/revel/revel#Params.BindJSON\" rel=\"nofollow noreferrer\">Params.BindJSON</a> which converts <code>c.Params.JSON</code> to the golang object.</p>\n\n<p>Here's sample code.</p>\n\n<pre><code>type MyData struct {\n    Name string `json:\"name\"`\n}\n\nfunc (c App) Index() revel.Result {\n    data := MyData{}\n    c.Params.BindJSON(&amp;data)\n    return c.RenderJSON(data)\n}\n</code></pre>\n"}], "owner": {"reputation": 723, "user_id": 2423216, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/bwCkf.png?s=128&g=1", "display_name": "Alvaro Denis Acosta", "link": "https://stackoverflow.com/users/2423216/alvaro-denis-acosta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 930, "favorite_count": 0, "accepted_answer_id": 46029254, "answer_count": 1, "score": 2, "last_activity_date": 1504508003, "creation_date": 1504482070, "last_edit_date": 1504507914, "question_id": 46028723, "link": "https://stackoverflow.com/questions/46028723/i-cannot-get-posted-body-in-revel-go-framework", "title": "I cannot get posted body in revel go framework", "body": "<p>I am trying to implement a basic CRUD using the Rest architecture in revel, but I am not able to send the data encoded in <code>json</code> format to an endpoint, I was try multiple ways to check the body content in the request, so now I have a \"minimal compilable example\":</p>\n\n<ol>\n<li><p>create a new project using revel cli tool.</p></li>\n<li><p>Apply the following changes</p>\n\n<pre><code>diff --git a/app/controllers/app.go b/app/controllers/app.go\nindex 1e94062..651dbec 100644\n--- a/app/controllers/app.go\n+++ b/app/controllers/app.go\n@@ -9,5 +9,6 @@ type App struct {\n }\n\n func (c App) Index() revel.Result {\n-   return c.Render()\n+   defer c.Request.Body.Close()\n+   return c.RenderJSON(c.Request.Body)\n }\ndiff --git a/conf/routes b/conf/routes\nindex 35e99fa..5d6d1d6 100644\n--- a/conf/routes\n+++ b/conf/routes\n@@ -7,7 +7,7 @@ module:testrunner\n # module:jobs\n\n\n-GET     /                                       App.Index\n+POST     /                                       App.Index\n\n # Ignore favicon requests\n GET     /favicon.ico                            404\n</code></pre></li>\n<li><p>do a POST request:</p>\n\n<pre><code>curl --request POST --header \"Content-Type: application/json\" --header \"Accept: application/json\" --data '{\"name\": \"Revel framework\"}' http://localhost:9000\n</code></pre></li>\n</ol>\n\n<p>My problem; the curl call does not give me an echo back (the same <code>json</code> <code>{\"name\": \"Revel framework\"}</code>), so what I am missing to use revel correctly?</p>\n\n<p>PS: I can find some other related links to this problem but they do not work for me. For example this: <a href=\"https://github.com/revel/revel/issues/126\" rel=\"nofollow noreferrer\">https://github.com/revel/revel/issues/126</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 5, "creation_date": 1504482016, "post_id": 46028707, "comment_id": 79017446, "body": "<a href=\"https://golang.org/pkg/os/#Chdir\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Chdir</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1504482112, "post_id": 46028707, "comment_id": 79017457, "body": "You cannot change the shell&#39;s cwd from an application."}, {"owner": {"reputation": 15010, "user_id": 536890, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85530c6eefdc35e70ff1e2119eaad7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kim", "link": "https://stackoverflow.com/users/536890/jason-kim"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504483140, "post_id": 46028707, "comment_id": 79017661, "body": "@CeriseLim&#243;n Is there no way? Even a convoluted idea would be useful"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1504485684, "post_id": 46028707, "comment_id": 79018038, "body": "On workaround is to source the output of the command in the shell."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1504522518, "post_id": 46028707, "comment_id": 79031029, "body": "That&#39;s impossible because of the chicken and egg problem. Any shell distinguishes between the &quot;built-in&quot; and &quot;external&quot; commands. The former are executed directly by the shell&#39;s process and the latter are executed as child processed. A child process cannot change any property of its parent, so external processes can&#39;t change their parent&#39;s current directory (well, almost--see below). That&#39;s exactly why <code>cd</code> is a shell&#39;s <i>built-in</i> command, and you cannot implement it as an external command."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1504522587, "post_id": 46028707, "comment_id": 79031080, "body": "Well, you can resort to hacks like <code>ptrace(2)</code> on Linux to command the parent process but that would clearly violate the process separation principles."}], "answers": [{"comments": [{"owner": {"reputation": 15010, "user_id": 536890, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85530c6eefdc35e70ff1e2119eaad7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kim", "link": "https://stackoverflow.com/users/536890/jason-kim"}, "edited": false, "score": 0, "creation_date": 1504483097, "post_id": 46028772, "comment_id": 79017653, "body": "This doesn&#39;t seem to actually change the terminal location after I run the go program. When I print the error, I see that there was no error for <code>os.Chdir()</code>. I see that error is <code>&lt;nil&gt;</code>."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 15010, "user_id": 536890, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85530c6eefdc35e70ff1e2119eaad7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kim", "link": "https://stackoverflow.com/users/536890/jason-kim"}, "edited": false, "score": 5, "creation_date": 1504483280, "post_id": 46028772, "comment_id": 79017679, "body": "Of course it doesn&#39;t change the terminal location. Changing the terminal location is much more complicated. You still can&#39;t use <code>cd</code>, and there is nothing in the Go standard libary to help you. Your best bet is to look at source code for <code>cd</code> itself and work backwards from there."}, {"owner": {"reputation": 15010, "user_id": 536890, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85530c6eefdc35e70ff1e2119eaad7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kim", "link": "https://stackoverflow.com/users/536890/jason-kim"}, "edited": false, "score": 0, "creation_date": 1504483341, "post_id": 46028772, "comment_id": 79017685, "body": "Thanks for the input. I&#39;ll try to find a work around."}, {"owner": {"reputation": 2219, "user_id": 8608146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3B2gl.jpg?s=128&g=1", "display_name": "Phani Rithvij", "link": "https://stackoverflow.com/users/8608146/phani-rithvij"}, "edited": false, "score": 1, "creation_date": 1588851543, "post_id": 46028772, "comment_id": 109062098, "body": "This is very useful especially when zipping files in go."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 17, "last_activity_date": 1563858910, "last_edit_date": 1563858910, "creation_date": 1504482643, "answer_id": 46028772, "question_id": 46028707, "link": "https://stackoverflow.com/questions/46028707/how-to-change-the-current-directory-in-go/46028772#46028772", "title": "How to change the current directory in Go", "body": "<p>You want <a href=\"https://golang.org/pkg/os/#Chdir\" rel=\"noreferrer\"><code>os.Chdir</code></a>. This function will change the <em>application working directory</em>. If you need to change the <em>shell working directory</em>, your best bet is to look up how <code>cd</code> works and work back from that.</p>\n\n<p>As you have discovered, you cannot use <code>cd</code> to change your current directory from inside an application, but with <code>os.Chdir</code> there is no need for it to work :)</p>\n\n<p>Example usage:</p>\n\n<pre><code>home, _ := os.UserHomeDir()\nerr := os.Chdir(filepath.Join(home, \"goproject2\"))\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": false, "score": 24, "last_activity_date": 1601070670, "last_edit_date": 1601070670, "creation_date": 1504525652, "answer_id": 46036376, "question_id": 46028707, "link": "https://stackoverflow.com/questions/46028707/how-to-change-the-current-directory-in-go/46036376#46036376", "title": "How to change the current directory in Go", "body": "<p>Usually if you need a command to run from a specific directory, you can specify that as the <em>Dir</em> property on the <em>Command</em>, for example:</p>\n<pre><code>cmd := exec.Command(&quot;myCommand&quot;, &quot;arg1&quot;, &quot;arg2&quot;)\ncmd.Dir = &quot;/path/to/work/dir&quot;\ncmd.Run()\n</code></pre>\n"}], "owner": {"reputation": 15010, "user_id": 536890, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85530c6eefdc35e70ff1e2119eaad7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kim", "link": "https://stackoverflow.com/users/536890/jason-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17500, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1601070723, "creation_date": 1504481868, "last_edit_date": 1601070723, "question_id": 46028707, "link": "https://stackoverflow.com/questions/46028707/how-to-change-the-current-directory-in-go", "title": "How to change the current directory in Go", "body": "<p>Unlike <em><a href=\"https://stackoverflow.com/questions/44206940/golang-execute-cd-command-for-cmd\">Execute the &#39;cd&#39; command for CMD in Go</a></em>, I just want to really run <code>cd directory_location</code> using Go and change the current directory.</p>\n<p>So for example,</p>\n<p>Say I am on ~/goproject, and I run, <code>./main</code> in the terminal, I want to be at ~/goproject2 in the terminal.</p>\n<p>I tried</p>\n<pre><code>cmd := exec.Command(&quot;bash&quot;, &quot;-c&quot;, &quot;cd&quot;, &quot;~/goproject2&quot;)\ncmd.Run()\n</code></pre>\n<p>But this didn't actually change the current directory.</p>\n"}, {"tags": ["heroku", "go", "govendor", "go-iris"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504468227, "post_id": 46027061, "comment_id": 79014176, "body": "Look at this line <a href=\"https://github.com/kataras/iris/blob/master/context.go#L1\" rel=\"nofollow noreferrer\">github.com/kataras/iris/blob/master/context.go#L1</a> and compare that to heroku&#39;s <code>remote: -----&gt; Using go1.8.3</code> log output."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504468422, "post_id": 46027061, "comment_id": 79014244, "body": "Try updating this line <a href=\"https://github.com/VaccinalBowl/herokulunchhelper/blob/master/vendor/vendor.json#L4\" rel=\"nofollow noreferrer\">github.com/VaccinalBowl/herokulunchhelper/blob/master/vendor&zwnj;&#8203;/&hellip;</a> to &quot;1.9&quot;"}, {"owner": {"reputation": 790, "user_id": 1639729, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b57386592f53dc528ba2e69a176f37f2?s=128&d=identicon&r=PG", "display_name": "KennyBartMan", "link": "https://stackoverflow.com/users/1639729/kennybartman"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504477335, "post_id": 46027061, "comment_id": 79016601, "body": "I cannot use go 1.9 on heroku."}, {"owner": {"reputation": 790, "user_id": 1639729, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b57386592f53dc528ba2e69a176f37f2?s=128&d=identicon&r=PG", "display_name": "KennyBartMan", "link": "https://stackoverflow.com/users/1639729/kennybartman"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504477546, "post_id": 46027061, "comment_id": 79016635, "body": "@mkopriva Should I use an older version of Iris. How?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1504503962, "post_id": 46027061, "comment_id": 79021617, "body": "Seems like only that one file is intended for <code>1.9</code> so you should be fine if you import and use those types that that one file &quot;redefines&quot;. That is, instead of using <a href=\"https://github.com/kataras/iris/blob/80b31256608a416ab4968ae7717efe35d8096c79/context.go#L27\" rel=\"nofollow noreferrer\">iris.Context</a> in your main.go file import <code>github.com&#47;kataras&#47;iris&#47;context</code> and edit <a href=\"https://github.com/VaccinalBowl/herokulunchhelper/blob/master/main.go#L87\" rel=\"nofollow noreferrer\">this line</a> to use <code>context.Context</code>. And if you use anything else from the <code>github.com&#47;kataras&#47;iris&#47;context.go</code> file you&#39;ll need to make similar changes."}], "owner": {"reputation": 790, "user_id": 1639729, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b57386592f53dc528ba2e69a176f37f2?s=128&d=identicon&r=PG", "display_name": "KennyBartMan", "link": "https://stackoverflow.com/users/1639729/kennybartman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504466467, "creation_date": 1504466467, "question_id": 46027061, "link": "https://stackoverflow.com/questions/46027061/why-can-my-go-iris-app-not-be-deployed-to-heroku", "title": "Why can my Go Iris app not be deployed to Heroku?", "body": "<p>I have very simple Go App with Iris which I am trying to deploy to Heroku. </p>\n\n<p>To build and install locally I run the following command:</p>\n\n<pre><code>go install -v -tags heroku .\n</code></pre>\n\n<p>This works and outputs</p>\n\n<pre><code>github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/BurntSushi/toml\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/fatih/structs\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/cfg\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/ruleset\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/pio/terminal\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/iris-contrib/form-binder\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/json-iterator/go\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/satori/go.uuid\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/cpuid\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/crc32\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/pio\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/net/html/atom\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/shurcooL/sanitized_anchor_name\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/errors\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/russross/blackfriday\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/net/html\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/entry\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/compress/flate\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/golog\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/uri\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/crypto/acme\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/ast\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/token\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/lexer\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/parser\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/field\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/persistence\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/ryanuber/columnize\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/crypto/acme/autocert\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/Joker/jade\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/compress/gzip\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/ast\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/lexer\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/eknkc/amber/parser\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/juju/errors\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/microcosm-cc/bluemonday\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/memstore\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/parser\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/gopkg.in/yaml.v2\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/flosch/pongo2\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/netutil\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/host\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/eknkc/amber\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/context\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/client/rule\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/handlerconv\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/methodfunc\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/node\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/model\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/middleware/logger\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/middleware/recover\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/sessions\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/client\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/view\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc\ngithub.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris\ngithub.com/VaccinalBowl/herokulunchhelper\n</code></pre>\n\n<p>This application will run locally without issue. However when I deploy to Heroku using:</p>\n\n<pre><code>git push heroku master\n</code></pre>\n\n<p>The following is the output:</p>\n\n<pre><code>    remote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----&gt; Go app detected\nremote: -----&gt; Checking vendor/vendor.json file.\nremote: -----&gt; Using go1.8.3\nremote: -----&gt; Fetching any unsaved dependencies (govendor sync)\nremote: -----&gt; Running: go install -v -tags heroku . \nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/BurntSushi/toml\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/pio/terminal\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/pio\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/golog\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/cfg\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/ruleset\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/fatih/structs\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/iris-contrib/form-binder\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/json-iterator/go\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/satori/go.uuid\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/errors\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/memstore\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/cpuid\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/compress/flate\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/crc32\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/klauspost/compress/gzip\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/net/html/atom\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/net/html\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/shurcooL/sanitized_anchor_name\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/russross/blackfriday\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/microcosm-cc/bluemonday\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/entry\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/context\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/uri\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/crypto/acme\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/golang.org/x/crypto/acme/autocert\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/client/rule\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache/client\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/handlerconv\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/netutil\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/cache\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/ast\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/token\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/lexer\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro/interpreter/parser\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/host\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/macro\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router/node\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/field\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/methodfunc\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/model\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator/persistence\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/ryanuber/columnize\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/mvc/activator\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/middleware/logger\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/middleware/recover\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/core/router\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/Joker/jade\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/ast\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/lexer\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond/parser\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/eknkc/amber/parser\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/aymerick/raymond\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/eknkc/amber\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/juju/errors\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/gopkg.in/yaml.v2\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/flosch/pongo2\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris/view\nremote: github.com/VaccinalBowl/herokulunchhelper/vendor/github.com/kataras/iris\nremote: github.com/VaccinalBowl/herokulunchhelper\nremote: # github.com/VaccinalBowl/herokulunchhelper\nremote: ./main.go:19: undefined: iris.Context\nremote: ./main.go:28: undefined: iris.Context\n</code></pre>\n\n<p>I am using govendor and all of the files required are located within the vendor directory of my app. I added them using: </p>\n\n<pre><code>govendor add github.com/kataras/iris\ngovendor add +external\n</code></pre>\n\n<p>What is the issue? Does anybody have any ideas?</p>\n"}, {"tags": ["algorithm", "go", "quicksort"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504476703, "post_id": 46025760, "comment_id": 79016504, "body": "why don&#39;t you take a look at this implementation. ... also the reason why your run out of memory is because your recursive function SortHoare() never has it&#39;s escape logic execute <code>low &lt; high</code>   <a href=\"https://github.com/gersakbogdan/golang-hackerrank/blob/master/quicksort.go\" rel=\"nofollow noreferrer\">github.com/gersakbogdan/golang-hackerrank/blob/master/&hellip;</a> SortHoare should return <code>low</code> and <code>high</code> because the value is not being updated... primary because low and high aren&#39;t being passed by reference... also SortHoare isn&#39;t really doing anything useful."}], "answers": [{"comments": [{"owner": {"reputation": 2813, "user_id": 3600738, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/vXuZd.png?s=128&g=1", "display_name": "harsh_v", "link": "https://stackoverflow.com/users/3600738/harsh-v"}, "edited": false, "score": 0, "creation_date": 1504507467, "post_id": 46026170, "comment_id": 79022945, "body": "Thanks a million! That was it, the equality <code>=</code> operator. And very thanks for the info on <code>ascending</code>"}], "tags": [], "owner": {"reputation": 1099, "user_id": 6256521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2239849053bc950cf5b37569bea0d92?s=128&d=identicon&r=PG&f=1", "display_name": "mateuszlo", "link": "https://stackoverflow.com/users/6256521/mateuszlo"}, "is_accepted": true, "score": 1, "last_activity_date": 1504460923, "last_edit_date": 1504460923, "creation_date": 1504460463, "answer_id": 46026170, "question_id": 46025760, "link": "https://stackoverflow.com/questions/46025760/hoares-partitioning-scheme-golang/46026170#46026170", "title": "Hoare&#39;s partitioning scheme golang", "body": "<p>You should use non strict inequalities while looking for position of i and j to do the swap. So instead of</p>\n\n<pre><code>        if arr[j] &gt; pivot {\n            break\n        }\n</code></pre>\n\n<p>you should have</p>\n\n<pre><code>        if arr[j] &gt;= pivot {\n            break\n        }\n</code></pre>\n\n<p>And the same for i. Instead of </p>\n\n<pre><code>        if arr[i] &lt; pivot {\n            break\n        }\n</code></pre>\n\n<p>use</p>\n\n<pre><code>        if arr[i] &lt;= pivot {\n            break\n        }\n</code></pre>\n\n<p>Also I'm not sure if it's intentional or not, but currently your algorithm sorts in descending order. If you want to sort in ascending order swap the comparitions between i and j. So:</p>\n\n<pre><code>    if arr[j] &lt;= pivot {\n        break\n    }\n</code></pre>\n\n<p>and</p>\n\n<pre><code>    if arr[i] &gt;= pivot {\n        break\n    }\n</code></pre>\n"}], "owner": {"reputation": 2813, "user_id": 3600738, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/vXuZd.png?s=128&g=1", "display_name": "harsh_v", "link": "https://stackoverflow.com/users/3600738/harsh-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 46026170, "answer_count": 1, "score": 1, "last_activity_date": 1504794209, "creation_date": 1504457520, "last_edit_date": 1504794209, "question_id": 46025760, "link": "https://stackoverflow.com/questions/46025760/hoares-partitioning-scheme-golang", "title": "Hoare&#39;s partitioning scheme golang", "body": "<blockquote>\n  <p>Quicksort with Hoare's partitioning</p>\n</blockquote>\n\n<pre><code>// Hoare's partitioning scheme\nfunc PartitionHoare(arr []int, low, high int) int {\n    length := len(arr)\n\n    if length == 0 {\n        panic(\"Array size is 0\")\n    }\n\n    pivot := arr[low]\n    i := low - 1\n    j := high + 1\n\n    for {\n        for {\n            j--\n            if arr[j] &gt; pivot {\n                break\n            }\n        }\n\n        for {\n            i++\n            if arr[i] &lt; pivot {\n                break\n            }\n        }\n\n        if i &lt; j {\n            Swap(&amp;arr, i, j)\n        } else {\n            return j\n        }\n    }\n}\n\n// Sort\nfunc SortHoare(arr []int, low, high int) {\n    if low &lt; high {\n        p := PartitionHoare(arr, low, high)\n        SortHoare(arr, low, p)\n        SortHoare(arr, p+1, high)\n    }\n}\n\n\n// Swap i &lt;--&gt; j\nfunc Swap(arr *[]int, i, j int) {\n    (*arr)[i], (*arr)[j] = (*arr)[j], (*arr)[i]\n}\n</code></pre>\n\n<p>Trying to implement Quicksort using Hoare's partitioning but can't figure out what am I doing wrong. It is stuck in an infinite loop, always runs <strong>out of memory</strong></p>\n\n<pre><code>fatal error: runtime: out of memory\n</code></pre>\n"}, {"tags": ["go", "idioms"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1504452498, "post_id": 46024818, "comment_id": 79009326, "body": "In this case it&#39;s <a href=\"https://play.golang.org/p/PsTBFzSWQ4\" rel=\"nofollow noreferrer\">example <b>d</b></a> in my opinion. There are some cases where <b>a</b> makes sense, <b>c</b> less, and <b>b</b> is something I try to avoid."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1504462799, "post_id": 46024818, "comment_id": 79012484, "body": "Take a look at the standard library."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1504464730, "post_id": 46024818, "comment_id": 79013087, "body": "The idiomatic way to handle your example <b>D</b> would look something like this <a href=\"https://play.golang.org/p/HhSF5BXFDb\" rel=\"nofollow noreferrer\">play.golang.org/p/HhSF5BXFDb</a>."}], "answers": [{"comments": [{"owner": {"reputation": 15366, "user_id": 427673, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f246182305ce26a183a281bb15fee6c?s=128&d=identicon&r=PG", "display_name": "Gleno", "link": "https://stackoverflow.com/users/427673/gleno"}, "edited": false, "score": 0, "creation_date": 1504456777, "post_id": 46025249, "comment_id": 79010599, "body": "The problem with this construct is that you have to juggle the operator. You left the triple line operator I intended for the <i>dream</i> scenario, but I think that omission is telling - if you were to repeat the construction the compoiler would complain that there are no new variables. I&#39;ll edit my question to hopefully explain better."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 15366, "user_id": 427673, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f246182305ce26a183a281bb15fee6c?s=128&d=identicon&r=PG", "display_name": "Gleno", "link": "https://stackoverflow.com/users/427673/gleno"}, "edited": false, "score": 2, "creation_date": 1504457010, "post_id": 46025249, "comment_id": 79010684, "body": "It would only complain if you reuse <code>bytes</code> as well as <code>error</code>, which is very rare in production code. Reusing err is fine and expected, but generally you do no reuse your data values."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 6, "last_activity_date": 1504621755, "last_edit_date": 1504621755, "creation_date": 1504454161, "answer_id": 46025249, "question_id": 46024818, "link": "https://stackoverflow.com/questions/46024818/idiomatic-go-happy-path/46025249#46025249", "title": "Idiomatic Go Happy Path", "body": "<p>If you look at lots of Go code you will find the following to be the usual case:</p>\n\n<pre><code>func example(data interface{}) (interface{}, error) {\n    bytes, err := json.Marshal(data)\n    if err != nil {\n        return nil, err\n    }\n    // ... \n    return use(bytes), nil\n}\n</code></pre>\n\n<p>The declare and test if construct is nice in its place, but it is not generally apropriate here.</p>\n"}], "owner": {"reputation": 15366, "user_id": 427673, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f246182305ce26a183a281bb15fee6c?s=128&d=identicon&r=PG", "display_name": "Gleno", "link": "https://stackoverflow.com/users/427673/gleno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 46025249, "answer_count": 1, "score": 0, "last_activity_date": 1504621755, "creation_date": 1504451440, "last_edit_date": 1504457106, "question_id": 46024818, "link": "https://stackoverflow.com/questions/46024818/idiomatic-go-happy-path", "title": "Idiomatic Go Happy Path", "body": "<p>Suppose we have a function that returns some value and an error. What's the preferred way of handling the error and value declarations? </p>\n\n<pre><code>func example_a(data interface{}) (interface{}, error) {\n    var err error\n    var bytes []byte\n    if bytes, err = json.Marshal(data); err != nil {\n        return nil, err\n    }\n    // ... \n    return use(bytes), nil\n}\n\nfunc example_b(data interface{}) (interface{}, error) {\n    if bytes, err := json.Marshal(data); err != nil {\n        return nil, err\n    } else {\n        // ... \n        return use(bytes), nil\n    }\n}\n\nfunc example_c(data interface{}) (result interface{}, err error) {\n    var bytes []byte\n    if bytes, err = json.Marshal(data); err != nil {\n        return\n    }\n    // ... \n    return use(bytes), nil\n}\n\nfunc example_d(data interface{}) (interface{}, error) {\n    bytes, err := json.Marshal(data)\n    if err != nil {\n        return nil, err\n    }\n    // ... \n    return use(bytes), nil\n}\n\nfunc example_dream(data interface{}) (interface{}, error) {\n    if bytes, err \u2261 json.Marshal(data); err != nil {\n        return nil, err\n    }\n    // ... \n    return use(bytes), nil\n}\n</code></pre>\n\n<p><strong>Example A</strong> is clear, but it adds 2 extra lines. Moreover, I find that it's unclear why in this particular case we should use <code>var</code>, and at the same time <code>:=</code> is not always appropriate. Then you want to reuse the <code>err</code> declaration somewhere down the line, and I'm not a big fan of splitting declaration and assignment.</p>\n\n<p><strong>Example B</strong> is using the if-declare-test language feature, which I surmise is encouraged, but at the same time you are forced to nest function continuation violating the happy-path principle, which too is encouraged.</p>\n\n<p><strong>Example C</strong> uses the named parameter return feature, which is something between A and B. Biggest problem here, is that if your code base is using styles B and C, then it's easy to mistake <code>:=</code> and <code>=</code>, which can cause all kinds of issues.</p>\n\n<p><strong>Example D</strong> (added from suggestions) has for me the same kind of usage problem as C, because inevitably I run into the following:</p>\n\n<pre><code>func example_d(a, b interface{}) (interface{}, error) {\n    bytes, err := json.Marshal(a)\n    if err != nil {\n        return nil, err\n    }\n\n    bytes, err := json.Marshal(b) //Compilation ERROR\n    if err != nil {\n        return nil, err\n    }\n\n    // ... \n    return use(bytes), nil\n}\n</code></pre>\n\n<p>So depending on previous declarations I have to modify my code to either use <code>:=</code> or <code>=</code>, which makes it harder to see and refactor.</p>\n\n<p><strong>Example Dream</strong> is what I kind of intuitively would have expected from GO - no nesting, and quick exit without too much verbosity and variable reuse. Obviously it doesn't compile.</p>\n\n<p>Usually <code>use()</code> is inlined and repeats the pattern several times, compounding the nesting or split declaration issue.</p>\n\n<p>So what's the most idiomatic way of handling such multiple returns and declarations? Is there a pattern I'm missing?</p>\n"}, {"tags": ["go", "input"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1504451997, "post_id": 46024718, "comment_id": 79009170, "body": "If you check the errors returned by Scanf, you&#39;ll find out why. In Go, errors are returned for a reason, <b>please always check the errors</b>."}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1504453032, "post_id": 46024718, "comment_id": 79009490, "body": "i don&#39;t think the <code>%d</code> is suitable for use with variables of type <code>float64</code>"}, {"owner": {"reputation": 11, "user_id": 7128628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/126306c08f8c950a24df088068abaa19?s=128&d=identicon&r=PG&f=1", "display_name": "Whitecrystall", "link": "https://stackoverflow.com/users/7128628/whitecrystall"}, "edited": false, "score": 0, "creation_date": 1504455219, "post_id": 46024718, "comment_id": 79010122, "body": "cat, I picked that up myself and have already fixed it. Dunno why I made that one float"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7128628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/126306c08f8c950a24df088068abaa19?s=128&d=identicon&r=PG&f=1", "display_name": "Whitecrystall", "link": "https://stackoverflow.com/users/7128628/whitecrystall"}, "edited": false, "score": 0, "creation_date": 1504454857, "post_id": 46025033, "comment_id": 79010018, "body": "Thanks mate it worked! But if you have the time could you explain the difference between &amp;x and x?"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "reply_to_user": {"reputation": 11, "user_id": 7128628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/126306c08f8c950a24df088068abaa19?s=128&d=identicon&r=PG&f=1", "display_name": "Whitecrystall", "link": "https://stackoverflow.com/users/7128628/whitecrystall"}, "edited": false, "score": 0, "creation_date": 1504455418, "post_id": 46025033, "comment_id": 79010175, "body": "@Whitecrystall I&#39;ve done it, and be sure to read the linked documentation :)"}], "tags": [], "owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "is_accepted": true, "score": 0, "last_activity_date": 1504455257, "last_edit_date": 1504455257, "creation_date": 1504452957, "answer_id": 46025033, "question_id": 46024718, "link": "https://stackoverflow.com/questions/46024718/why-doesnt-scanf-work-correctly-for-me/46025033#46025033", "title": "Why doesn&#39;t Scanf() work correctly for me?", "body": "<p>The second call to Scanf, <code>Scanf(\"%d\", x, y)</code> only provides one conversion specifier but was given two variables.</p>\n\n<p>Moreover, this second call only passes the variables' values, <em>not</em> their addresses. </p>\n\n<p>It seems the correct call would be <code>Scanf(\"%d %d\", &amp;x, &amp;y)</code></p>\n\n<hr>\n\n<p>In the first call to Scanf you said: <code>Scanf(\"%d\", &amp;input)</code>. The second argument's syntax, <code>&amp; variable</code>, denotes a <em>reference</em> to the named variable.</p>\n\n<p><code>input</code> was declared global, but is only visible after its declaration. Since <code>input</code> is in scope within <code>main</code> but <em>not</em> within <code>Scanf</code>, in order for <code>Scanf</code> to change the value in another scope, the address must be given as an argument, rather than its value.</p>\n\n<p>The recipient of the address (here <code>Scanf</code>) can then change the value of the variable in the frame in which it is still in scope; in this case, <code>main</code>.</p>\n\n<p>See Go's documentation for a similar explanation: <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Address_operators</a></p>\n"}], "owner": {"reputation": 11, "user_id": 7128628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/126306c08f8c950a24df088068abaa19?s=128&d=identicon&r=PG&f=1", "display_name": "Whitecrystall", "link": "https://stackoverflow.com/users/7128628/whitecrystall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 46025033, "answer_count": 1, "score": 0, "last_activity_date": 1504455257, "creation_date": 1504450802, "question_id": 46024718, "link": "https://stackoverflow.com/questions/46024718/why-doesnt-scanf-work-correctly-for-me", "title": "Why doesn&#39;t Scanf() work correctly for me?", "body": "<p>I'm trying to move from Python to GO and with my minimal knowledge I tried to make a basic calculator. However i for some reason can't get Scanf to work properly. It only seems to accept the first scanf but the second one is completely ignored</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar x int\nvar y int\nvar result int\nvar input float64\n\nfunc add(x int, y int) int {\nsum := x + y\nreturn sum\n}\n\nfunc sub(x int, y int) int {\n    sum := x - y\n    return sum\n}\n\nfunc div(x int, y int) int {\n    sum := x / y\n    return sum\n}\n\nfunc mul(x int, y int) int {\nsum := x * y\nreturn sum\n}\n\nfunc main() {\n\n    fmt.Println(\"Which type?\\n1: Add\\n2: Subtract\\n3: Divide\\n4: \n    Multiply\")\n    fmt.Scanf(\"%d\", &amp;input)\n\n    fmt.Println(\"Input numbers seperated by space\")\n    fmt.Scanf(\"%d\", x, y)\n\n    switch input {\n    case 1:\n        result = add(x, y)\n\n    case 2:\n        result = sub(x, y)\n\n    case 3:\n        result = div(x, y)\n\n    case 4:\n       result = mul(x, y)\n    }\n\n    fmt.Println(result)\n}\n</code></pre>\n"}, {"tags": ["go", "error-handling", "compiler-errors", "null"], "answers": [{"comments": [{"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504436447, "post_id": 46022669, "comment_id": 79004699, "body": "thx! pointer it is then, as using <code>error</code> forces me to add an ugly <code>err := err.(DetailedError)</code> type assertion so I can access extra fields like <code>err.x</code>..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504437117, "post_id": 46022669, "comment_id": 79004855, "body": "A pointer allows returning it, but then it&#39;s not an &quot;error&quot; in the Go sense. Returning <code>error</code> is the only thing that makes sense here."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 4, "creation_date": 1504437347, "post_id": 46022669, "comment_id": 79004914, "body": "@NeuronQ The idiomatic way is to have <code>error</code> as the return type instead of the custom error type (<code>DetailedError</code>). And at the point where you&#39;re interested in the details of the error you do type assertion, which is also idiomatic Go, whether it&#39;s ugly or not is subjective."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504437453, "post_id": 46022669, "comment_id": 79004943, "body": "IMO, returning a non-<code>error</code> as an error is infinitely more ugly than a type assertion."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504437971, "post_id": 46022669, "comment_id": 79005076, "body": "@mkopriva @Flimzy but why?! I mean, you <i>use</i> it just as if it&#39;s an error, same <code>if err != nil</code> even if err is a <code>*DetailedError</code>. what&#39;s the bigger picture that I am missing here?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 2, "creation_date": 1504438026, "post_id": 46022669, "comment_id": 79005091, "body": "@NeuronQ I&#39;ve added an explanation to my answer above. Let me know if you need further explanation."}, {"owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 1, "creation_date": 1504548634, "post_id": 46022669, "comment_id": 79044691, "body": "Another reason not to return *DetailedError is that some caller might be tempted to treat it as a generic error and return it to their caller.  But a nil *DetailedError is not a nil error, since it includes a known type, so the caller&#39;s caller will think there was an error, even if there wasn&#39;t.  And then when they try to log the message, they&#39;ll get a panic because the value is still nil.  See <a href=\"https://play.golang.org/p/m4S7GDfb2Y\" rel=\"nofollow noreferrer\">play.golang.org/p/m4S7GDfb2Y</a>  You should just use the error type and have the smart caller check and cast it.  Typed errors are just not idiomatic in go."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1504435806, "creation_date": 1504435806, "answer_id": 46022669, "question_id": 46022517, "link": "https://stackoverflow.com/questions/46022517/return-nil-or-custom-error-in-go/46022669#46022669", "title": "Return nil or custom error in Go", "body": "<p><code>DetailedError struct</code> zero value isn't <code>nil</code> but <code>DetailedError{}</code>. You can either return <code>error</code> interface instead of <code>DetailedError</code></p>\n\n<pre><code>func foo(answer, x, y int) (int, error) {\n</code></pre>\n\n<p>or use pointer</p>\n\n<pre><code>func foo(answer, x, y int) (int, *DetailedError) {\n...\n//and\nfunc (e *DetailedError) Error() string {\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504438451, "post_id": 46022840, "comment_id": 79005230, "body": "thx, that&#39;s really thoroughly explained! though about <i>&quot;having a new custom error type for every function or use-case is unsustainable, and makes your code unreadable and impossible to reason about&quot;</i>... dunno, that&#39;s kind of what I end up doing when writing code in languages that use <b>exceptions</b>... though I wouldn&#39;t say the resulting code is anywhere close to &quot;easy to reason about&quot;, I agree ...so ok, I&#39;ll try the &quot;Go way&quot; as &quot;when in Rome&quot;... :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 1, "creation_date": 1504438549, "post_id": 46022840, "comment_id": 79005262, "body": "@NeuronQ: Exceptions are an anti-pattern in a modern language like Go. They&#39;re solving a problem that no longer exists in modern programming languages which allow multiple return values, so using obsolete patterns like that in a modern language will cause you pain :)"}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504438773, "post_id": 46022840, "comment_id": 79005332, "body": "&quot;Exceptions are an anti-pattern.&quot; got a link to any serious source supporting this pov? after last codebase I worked in, my &quot;gut&quot; tells me to agree with it too, but there&#39;s also the alternative explanation that I&#39;ve just worked with &quot;exceptions based code written by &#39;idiots&#39;&quot;..."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504438956, "post_id": 46022840, "comment_id": 79005381, "body": "also, the whole <code>panic&#47;defer&#47;recover</code> thinggy... it technically could be used as an &quot;exceptions handling mechanism&quot; if one would really want to... and if such a mechanism <i>exists</i> in Go after all, it means the language designers saw some use for it..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 1, "creation_date": 1504438988, "post_id": 46022840, "comment_id": 79005384, "body": "@NeuronQ: Exceptions were created as a way to pass out-of-band error information in languages that only allowed a single return value (like C). In such languages, it&#39;s pretty much the only option for error handling. In a language like Go, where multiple return values are possible, there&#39;s no reason to use exceptions for standard errors, so I&#39;d say that makes it an anti-pattern."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504439092, "post_id": 46022840, "comment_id": 79005415, "body": "<code>panic</code> in Go is for extreme cases where program execution literally cannot continue. It <i>could</i> be used to implement an exception pattern, but that will be very ugly (it&#39;s already ugly in languages where it&#39;s the only option), and... hard to reason about."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504439158, "post_id": 46022840, "comment_id": 79005435, "body": "ok, good point. and good answer. though the language that I most often see exceptions used in my work is <b>Python</b>, which has multiple return values same as Go has..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 1, "creation_date": 1504439572, "post_id": 46022840, "comment_id": 79005548, "body": "@NeuronQ Yes, several languages (Python, Perl, etc) allow multiple return values also use exceptions. That&#39;s one of the ugliest features of these languages, IMO."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504439593, "post_id": 46022840, "comment_id": 79005554, "body": "last note though: in theory I like the pattern of <i>&quot;exceptions for technical/implementation/infrastructure errors, and error return values for business logic errors that usually need detailed responses given to the user/client&quot;</i> which <i>could</i> work great in languages like Python and JS... and that I&#39;ve used in my code before... but I&#39;ve never managed to convince anyone else to adhere to it, dunno why :( (so team-wise I consider it a failure, and I abandoned using it)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 61, "user_id": 4546553, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mh_XQVy0vTA/AAAAAAAAAAI/AAAAAAAAABM/0_1j24wJubk/photo.jpg?sz=128", "display_name": "David Cruz", "link": "https://stackoverflow.com/users/4546553/david-cruz"}, "edited": false, "score": 0, "creation_date": 1577967448, "post_id": 46022840, "comment_id": 105294036, "body": "@DavidCruz: Casting isn&#39;t even a possibility. Go doesn&#39;t do casting at all."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 61, "user_id": 4546553, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mh_XQVy0vTA/AAAAAAAAAAI/AAAAAAAAABM/0_1j24wJubk/photo.jpg?sz=128", "display_name": "David Cruz", "link": "https://stackoverflow.com/users/4546553/david-cruz"}, "edited": false, "score": 0, "creation_date": 1578059331, "post_id": 46022840, "comment_id": 105325639, "body": "@DavidCruz: No, there aren&#39;t. Not for this case."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 16, "last_activity_date": 1504437900, "last_edit_date": 1504437900, "creation_date": 1504437075, "answer_id": 46022840, "question_id": 46022517, "link": "https://stackoverflow.com/questions/46022517/return-nil-or-custom-error-in-go/46022840#46022840", "title": "Return nil or custom error in Go", "body": "<p>Don't use <code>DetailedError</code> as a return type, always use <code>error</code>:</p>\n\n<pre><code>func foo(answer, x, y int) (int, error) {\n    if answer == 42 {\n        return 100, nil  //!! cannot use nil as type DetailedError in return argument\n    }\n    return 0, DetailedError{x: x, y: y}\n}\n</code></pre>\n\n<p>The fact that your <code>DetailedError</code> type satisfies the <code>error</code> interface is sufficient to make this work.  Then, in your caller, if you care about the extra fields, use a type assertion:</p>\n\n<pre><code>value, err := foo(...)\nif err != nil {\n    if detailedErr, ok := err.(DetailedError); ok {\n        // Do something with the detailed error values\n    } else {\n        // It's some other error type, behave accordingly\n    }\n}\n</code></pre>\n\n<p>Reasons for not returning <code>DetailedError</code>:</p>\n\n<p>It may not appear to matter right now, but in the future your code may expand to include additional error checks:</p>\n\n<pre><code>func foo(answer, x, y int) (int, error) {\n    cache, err := fetchFromCache(answer, x, y)\n    if err != nil {\n        return 0, fmt.Errorf(\"Failed to read cache: %s\", err)\n    }\n    // ... \n}\n</code></pre>\n\n<p>The additional error types won't be of <code>DetailedError</code> type, so you then <em>must</em> return <code>error</code>.</p>\n\n<p>Further, your method may be used by other callers that don't know or care about the <code>DetailedError</code> type:</p>\n\n<pre><code>func fooWrapper(answer, x, y int) (int, error) {\n    // Do something before calling foo\n    result, err := foo(answer, x, y)\n    if err != nil {\n        return 0, err\n    }\n    // Do something after calling foo\n    return result, nil\n}\n</code></pre>\n\n<p>It's unreasonable to expect every caller of a function to understand a custom error type--this is precisely why interfaces, and in particular the <code>error</code> interface, exists in Go.</p>\n\n<p>Take advantage of this, don't circumvent it.</p>\n\n<p>Even if your code never changes, having a new custom error type for every function or use-case is unsustainable, and makes your code unreadable and impossible to reason about.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577967520, "post_id": 59562931, "comment_id": 105294074, "body": "No, this is not idiomatic <i>at all</i>. The idiomatic approach is to return an <code>error</code>, which is already an interface."}, {"owner": {"reputation": 61, "user_id": 4546553, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mh_XQVy0vTA/AAAAAAAAAAI/AAAAAAAAABM/0_1j24wJubk/photo.jpg?sz=128", "display_name": "David Cruz", "link": "https://stackoverflow.com/users/4546553/david-cruz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577968022, "post_id": 59562931, "comment_id": 105294298, "body": "So you prefer to cast the custom error, rather that safely return it as an output? Is there any reason to back this decision?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577968931, "post_id": 59562931, "comment_id": 105294710, "body": "Again, there <i>is no casting in Go</i>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577968958, "post_id": 59562931, "comment_id": 105294722, "body": "Aside from that, you should <i>always, always</i> return an <code>error</code>. If you need access to custom aspects of that error, yes, you should do a type assertion."}, {"owner": {"reputation": 61, "user_id": 4546553, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mh_XQVy0vTA/AAAAAAAAAAI/AAAAAAAAABM/0_1j24wJubk/photo.jpg?sz=128", "display_name": "David Cruz", "link": "https://stackoverflow.com/users/4546553/david-cruz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577969598, "post_id": 59562931, "comment_id": 105295040, "body": "Why do we have an output signature, if we can assert any type we want? This doesn&#39;t make sense. Also, is there any logical reason to &quot;always, always&quot; return an error?"}], "tags": [], "owner": {"reputation": 61, "user_id": 4546553, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mh_XQVy0vTA/AAAAAAAAAAI/AAAAAAAAABM/0_1j24wJubk/photo.jpg?sz=128", "display_name": "David Cruz", "link": "https://stackoverflow.com/users/4546553/david-cruz"}, "is_accepted": false, "score": -1, "last_activity_date": 1577966018, "creation_date": 1577966018, "answer_id": 59562931, "question_id": 46022517, "link": "https://stackoverflow.com/questions/46022517/return-nil-or-custom-error-in-go/59562931#59562931", "title": "Return nil or custom error in Go", "body": "<p>The idiomatic way to solve your problem is to return the error interface.</p>\n\n<p>If you actually need a function that is not part of the error interface, you should create a new interface that extends the error interface.</p>\n\n<pre><code>type DetailedErrorInterface interface {\n  error\n  GetX() int //need to implement\n  GetY() int //need to implement\n}\n</code></pre>\n\n<p>Then, you must change your function to return this interface:</p>\n\n<pre><code>func foo(answer, x, y int) (int, DetailedErrorInterface) {\n  if answer == 42 {\n    return 100, nil\n  }\n  return 0, DetailedError{x: x, y: y}\n}\n</code></pre>\n"}], "owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8373, "favorite_count": 4, "accepted_answer_id": 46022840, "answer_count": 3, "score": 8, "last_activity_date": 1577966018, "creation_date": 1504434733, "question_id": 46022517, "link": "https://stackoverflow.com/questions/46022517/return-nil-or-custom-error-in-go", "title": "Return nil or custom error in Go", "body": "<p>When using a custom <code>Error</code> type in Go (with extra fields to capture some details), when trying to return <code>nil</code> as value of this type, I get compile errors like <code>cannot convert nil to type DetailedError</code> or like <code>cannot use nil as type DetailedError in return argument</code>, from code looking mostly like this:</p>\n\n<pre><code>type DetailedError struct {\n    x, y int\n}\n\nfunc (e DetailedError) Error() string {\n    return fmt.Sprintf(\"Error occured at (%s,%s)\", e.x, e.y)\n}\n\nfunc foo(answer, x, y int) (int, DetailedError) {\n    if answer == 42 {\n        return 100, nil  //!! cannot use nil as type DetailedError in return argument\n    }\n    return 0, DetailedError{x: x, y: y}\n}\n</code></pre>\n\n<p>(full snippet: <a href=\"https://play.golang.org/p/4i6bmAIbRg\" rel=\"noreferrer\">https://play.golang.org/p/4i6bmAIbRg</a>)</p>\n\n<p><strong>What would be the idiomatic way to solve this problem?</strong> (Or any way that works...)</p>\n\n<p>I actually need the extra fields on errors because I have detailed error messages constructed by complex logic from simpler ones etc., and if I would just fall back to \"string errors\" I'd basically have to <em>parse</em> those strings to pieces and have logic happen based on them and so on, which seems really ugly (I mean, why serialize to strings info you know you're gonna need to deserialize later...)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504601165, "post_id": 46024795, "comment_id": 79060682, "body": "this is my input string for the Jpg"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504608621, "post_id": 46024795, "comment_id": 79065455, "body": "If SOI marker is missing, then some bytes may be missing in your base64 string (<a href=\"https://en.wikipedia.org/wiki/JPEG_File_Interchange_Format#File_format_structure\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>) Modify your program to print the base64 string for the JPEG. And then run my program (demonstrated to work) separately with your JPEG&#39;s base64 string as input (to the <code>base64toJpg</code> function) - see if you get the JPEG back. If you get an error, see what it is and if required get the source JPEG, use the <code>getJPEGbase64</code> function from the above code to get the base64 string for it, and match the base64 string you get in the http request."}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504609089, "post_id": 46024795, "comment_id": 79065771, "body": "i have tested the base64 string online <a href=\"https://codebeautify.org/base64-to-image-converter\" rel=\"nofollow noreferrer\">codebeautify.org/base64-to-image-converter</a> . It works fine"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504613199, "post_id": 46024795, "comment_id": 79068478, "body": "Can you please try as suggested and see what&#39;s happening? Your message says that SOI marker is missing, so chances are it might be!"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504613550, "post_id": 46024795, "comment_id": 79068709, "body": "my problem is that i have to send the image via ajax as base64 data-url and have to make jpg from it.I am able to get string what you have written in base64toPng()   &quot;data const&quot; string using the string functions and encoding image using it make the png but not jpg."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504613567, "post_id": 46024795, "comment_id": 79068718, "body": "For a given JPEG file, receive it via your program, dump base64 string and also get the base64 for the same JPEG from the above code - compare!"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504613592, "post_id": 46024795, "comment_id": 79068737, "body": "what i need is convert the data-url shown in the question into the jpg again"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1504613881, "post_id": 46024795, "comment_id": 79068899, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/153685/discussion-between-mchampaneri-and-ravi\">continue this discussion in chat</a>."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504613986, "post_id": 46024795, "comment_id": 79068962, "body": "Can you please follow what has been recommended?"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504677105, "post_id": 46024795, "comment_id": 79095714, "body": "It works with your dataurl too (using the code above). If you have compared the string outputs, you would have probably found this by now. The JPEG data to be sent for decoding is however after the header &quot;data:image/jpeg;base64,&quot; in your string."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504680866, "post_id": 46024795, "comment_id": 79097691, "body": "Use the code I have shared above, strip the header from your data and you are good! One gets the <code>missing SOI error</code> as it&#39;s not finding the signature bytes. At least the problem you have mentioned seems resolved."}], "tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 4, "last_activity_date": 1504451268, "creation_date": 1504451268, "answer_id": 46024795, "question_id": 46022262, "link": "https://stackoverflow.com/questions/46022262/convert-base64-string-to-jpg/46024795#46024795", "title": "Convert base64 string to JPG", "body": "<p>Here's something which may help, demonstrates quite a few other things too (you need to have two files: flower.jpg and mouse.png to make this work, available in the repository <a href=\"https://github.com/rravishankar/golangtraining/tree/master/test/jpegencode\" rel=\"nofollow noreferrer\">https://github.com/rravishankar/golangtraining/tree/master/test/jpegencode</a>): </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"encoding/base64\"\n    \"fmt\"\n    \"image\"\n    \"image/jpeg\"\n    \"image/png\"\n    \"strings\"\n\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n\n    createJpg()\n    createPng()\n    base64toPng()\n    base64toJpg(getJPEGbase64(\"flower.jpg\"))\n}\n\n//Take an existing jpg srcFileName and decode/encode it\nfunc createJpg() {\n\n    srcFileName := \"flower.jpg\"\n    dstFileName := \"newFlower.jpg\"\n    // Decode the JPEG data. If reading from file, create a reader with\n    reader, err := os.Open(srcFileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer reader.Close()\n    //Decode from reader to image format\n    m, formatString, err := image.Decode(reader)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Got format String\", formatString)\n    fmt.Println(m.Bounds())\n\n    //Encode from image format to writer\n    f, err := os.OpenFile(dstFileName, os.O_WRONLY|os.O_CREATE, 0777)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n\n    err = jpeg.Encode(f, m, &amp;jpeg.Options{Quality: 75})\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Jpg file\", dstFileName, \"created\")\n\n}\n\n//Take an existing png srcFileName and decode/encode it\nfunc createPng() {\n    srcFileName := \"mouse.png\"\n    dstFileName := \"newMouse.png\"\n    reader, err := os.Open(srcFileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer reader.Close()\n    //Decode from reader to image format\n    m, formatString, err := image.Decode(reader)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Got format String\", formatString)\n    fmt.Println(m.Bounds())\n\n    //Encode from image format to writer\n    f, err := os.OpenFile(dstFileName, os.O_WRONLY|os.O_CREATE, 0777)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n\n    err = png.Encode(f, m)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Png file\", dstFileName, \"created\")\n\n}\n\n//Converts pre-existing base64 data (found in example of https://golang.org/pkg/image/#Decode) to test.png\nfunc base64toPng() {\n    const data = `\n/9j/4AAQSkZJRgABAQIAHAAcAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdA\nSFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2Nj\nY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCABnAJYDASIAAhEBAxEB/8QA\nHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIh\nMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVW\nV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXG\nx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQF\nBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAV\nYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOE\nhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq\n8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDlwKMD0pwzSiuK57QzGDxS7D6in8Y5ximnAPUfSlcq4m3ilUYp\n2OKXHvRcVxnTtS7c07HNFK4DQPakC4PNOA+tOx70XAjK/So5gBGP94fzqfvUVx/qxx/EP51UXqRP4WSE\ncmgjilP3jSEZqS0IO/NGDnpUiocDg/McDjvV6HTPOdVWYgsM5KcfzzQ2JySM2jp6VYu7SWzmMUwG4cgj\nkMPUVBjjtTGtRu0Zopw+lFFxhinrGzuqqMsxAA9yaXFSRv5cqSEcIwYj6GpuZ30O30fSLKzhUpbpNMv3\n5XGTn29BV28jt7pPLuIVljPBBFVreYx+VbqAjycgt3x14zRcNOxGyVFHQkIc/wA61exyKLbuzjdZ046d\nftEuTEw3Rk9SPT8P8Kpbea3tchbyVae4JkjbbGpGdwOM89Af6ViFTWUtGdcXoM2+woK1JtpNtTcoZt+l\nJt7ZqTbRtouFyPFRXI/c9D94fzqzioLsfuD/ALw/nVReqIn8LJCOTSY+tSMOTmkIpXLRu+F0t5pJxPHG\nwjjUAuBjJJz1+laD6Pai+WaK9SBX6puzn6ZP+NV/Dkdtc6ZNbyAFwxLAHDYPv6VoQ21nPNEEiQGEFRtk\nGf0NaWTOeW7Of8QwGG4MRZnEbYXPJwRnOR0zWNXW+KrqBLUWi5EjbWCgcAA9c/gRXKYqZaGlK/LqMH0F\nFLtHvRSNiYD2pSDTgpp6p0ywUHoTULXYxcktzrdCf7Xo8LP/AKyEmMNjJ46dfbFWJ5TDGNwB9lFUvDV9\nYrbfYGbyrjcWG88S57g+vtV26ZIvMlumKwwjLZ6V0WfU54yTvYwtbubea2WNWbzg4bYQeBgj8OtYeKhj\nu4y2HQxqxOD1xzxmrWAQCCGB6EGsaikndmsJxeiYzBo280/Z7UbayuaXGY5oIp+2lx9KLjIsVDeD/Rj/\nALy/zq1t96r3y4tT/vL/ADq4P3kRP4WSleTSFKkkKoCW4GaqNcMxIjXj1pxjKT0FKrGC1Nrw3vGrKkYz\n5kTAr6455/HH510UdwPtRgWCbzF5+YYUf4Vwun39xpmoR3qASMmQUJwGU9Rnt/8AWrpbrxhb8/ZdOmaQ\ngAGZwFH5ZJrpVKVlY5ZYhN6kXiu2eO/ikZlIljAAB5yM549OawSOOlPuLqe+umuLqTfM4OSOAo7ADsKh\nhl/cRsTuJHPv7mlKi3sVTxNtGP20VJhThgSQaK52mnZnUqsWrpkyeUrr5pABOAPU1AGaXUCWJISHGPfP\nP8qL7BiKnsMg46H3qrbzupbj5mPTPTpXVSglG551SpzSsXJ4/MBUgYIxyKpySyGBYJriV1D7kRpCVH4V\nbSeNJ4xchni3DeqnBI+td7F4b0mKIRjT45VbktJlzk455+n6VtYzv2PNwFZWBHBGKVJDGVC54/nXQeMN\nNttLNkba1jgWVWDmM8bhg4/nzXLSSbXVj6fyNKUdNRp21RtIRJGrjuM0u3FQ2DbodvcEkfQmrW2vLqLl\nk0ejCXNFMj2/jQV9qkxSYNRcsZiq2oI32N2CkhWXJxwOe9XMcVt6hoPn6dFaW0wgRpNzvKDlz6+/0rai\nryv2Jm9LHJai+ZRGCBjnr71ErdAxAY9B611t1Y2cunbbaOQ3FvKZI3UqGlZMbiWwfcfhV231iwvLSM3U\nlt5Uq52TuZG+hGMA12xXJGxxzjzybOQtNOvb5j9ktZJhnBIHyg+5PFX38JayqK/2eLJIBUTgkDA9q7ex\nitrSHFpGsUbndhRgc+g7VNIyfZJAoJZUbb3I46CtFJMylBo8sdWhmYMuCnylc9wef5VUT7+1chc5NS7h\nsUZO5RtIPUH3pkBDOxxxmqM9TQtn+WilhHfHaik43KTG3Z4IyPyrNVjGCsZ+dmwv6V3cXhSG8sYpJLud\nJJIwxChdoJGcYx/Wkg8DafA4knvLiQr/ALqj+VQpKw3FtnFFfvbiSMgZJ6/jXp2n3d9cQRBTFsKD96EP\noOxPU/8A68VVtbbRtMVntbePKDLTSHJH/Aj/AEqHTvE66rq72VugMMcbSGTnL4wMAfjT5n0HyW3L+s6b\nbaxaJBdzN+7bcrxkAhun0rz3VNCv7e7lgigknWI43xLu6jjIHTjtXqfkpPGVYsBkghTikgsYIN/lhgXb\ncxLkknp/ShczQ7xtY8vtEmhkj8yGRBuCnehUcnHcVtmwfJ/fQ8e7f/E12txZW91C0U6b42xlST2OR/Ko\nBo1gM/uW55/1jf41nOipu7LhV5FZHIGzI6zwj/vr/Ck+yr3uYf8Ax7/CutbQdMb71tn/ALaN/jSf8I/p\nX/PoP++2/wAan6rAr6wzkWt0II+1Rc/7Lf4Vd1eeCSKBbdZDdShYoiZNoyfY10P/AAj2lf8APmP++2/x\noPh/SjKspsozIuNrZORjp3qo0FHYPb3OZt7ae3SzjuItsiRSAgnccl/UA+3Q1yNjKLR4ZZYY5VD7tkv3\nWwO/+e1evPp9nI257aJm6bioz1z1+tY+s6Hplnot9PbWMMcqwOFcLyOO1bJWMZSTOPHi+9w3mosrlyd2\n9lCj02g9P/1e9a3hzxAbl2ikZRcdQueHHt7j864Y8Z4I4oRzG6urFWU5BHBB7HNJxTFGbR6he6Vpmtgm\neLy5zwZI/lb8fX8azIvBUUTHdfSFP4QsYB/HNZ+k+KEnRY75hHOvAk6K/v7H9K6yyvlnQBmDZ6GsnzR0\nN0oy1RzOtaN/Y1tHNFO06u+zYy4I4Jzx9KKveJblXuordSGES5b6n/62PzorKVdp2LjQTVyWz8UWEWlq\njSgyxfJt6EgdDzWTdeLIZGO7zHI/hVajGmWWP+PWL8qwlAIURrhpMAHHJA71pRcZrToZzcoEuo6heakA\nGHk245CZ6/X1qPTLq40q+W5t2QybSpDAkEEc55/zilk5k2r91eKhLDzWz2rpsczbbuemeD76fUNG865I\nMiysmQMZAAwa3a5j4ftu0ByP+fh/5CulkLLG7INzhSVHqe1Fh3uOoqn9qQQxyhndmHIxwOmSR2xQ13KD\nKoiBZOV9JBnt707MVy5RWdNdy7wRGf3bfMinnO1jg+vY03WXLaJO3mhQ20b0zwpYf0qlG7S7icrJs08U\nVwumgC+YiQyeVtZH567hzj8aSL949oGhE/2v5pJCDkksQwBHC4/+vXQ8LZ2uYxxCavY7us/xCcaBfn0h\nb+VP0bnSrb94ZMJgOecj1rl/GfidUE2k2gy5+SeQjgA/wj3rlas2jdao48qrjLAGkSKPk4Gc1WMj92I+\nlIJnU8OfxPWo5inBokmtQTmM4OOh71b0q6vbFmWCbaxHyqQGAP0PT8KhSTzVyo5ocSKA5VfTOTmqsmRd\npl99XjPzThzK3zOeOSeveirNmkgg/fIpYsTkYORxRXmzlTjJqx6EVUcU7mhkKCzdAK59QI9zYxtG1fYU\nUVtgtmY4nZEa8Ak9aqFv3rfSiiu1nMeifDv/AJF+T/r4f+QrqqKKQwzQenNFFMCOKFIgNuThdoJ5OPSk\nubeK6t3gnXdG4wwziiii/UTKMOg6dbzJLFE4dSCP3rEdeOM8805tDsGMvySgSsS6rM6gk9eAcUUVftZt\n3uyVGNthuq3Eei6DK8H7sRR7YuMgHtXkc8rzTNLM26RyWY+p70UVnLY0iEsUipG7rhZBlDkc1HgYoorM\n0HwyBXGeRjmrcUhMg2ghezd//rUUVcTKW5s2jZtY/QDaOKKKK8ip8bPRj8KP/9k=\n`\n\n    reader := base64.NewDecoder(base64.StdEncoding, strings.NewReader(data))\n    m, formatString, err := image.Decode(reader)\n    if err != nil {\n        log.Fatal(err)\n    }\n    bounds := m.Bounds()\n    fmt.Println(bounds, formatString)\n\n    //Encode from image format to writer\n    pngFilename := \"test.png\"\n    f, err := os.OpenFile(pngFilename, os.O_WRONLY|os.O_CREATE, 0777)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n\n    err = png.Encode(f, m)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Png file\", pngFilename, \"created\")\n\n}\n\n//Given a base64 string of a JPEG, encodes it into an JPEG image test.jpg\nfunc base64toJpg(data string) {\n\n    reader := base64.NewDecoder(base64.StdEncoding, strings.NewReader(data))\n    m, formatString, err := image.Decode(reader)\n    if err != nil {\n        log.Fatal(err)\n    }\n    bounds := m.Bounds()\n    fmt.Println(\"base64toJpg\", bounds, formatString)\n\n    //Encode from image format to writer\n    pngFilename := \"test.jpg\"\n    f, err := os.OpenFile(pngFilename, os.O_WRONLY|os.O_CREATE, 0777)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n\n    err = jpeg.Encode(f, m, &amp;jpeg.Options{Quality: 75})\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    fmt.Println(\"Jpg file\", pngFilename, \"created\")\n\n}\n\n//Gets base64 string of an existing JPEG file\nfunc getJPEGbase64(fileName string) string {\n\n    imgFile, err := os.Open(fileName)\n\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    defer imgFile.Close()\n\n    // create a new buffer base on file size\n    fInfo, _ := imgFile.Stat()\n    var size = fInfo.Size()\n    buf := make([]byte, size)\n\n    // read file content into buffer\n    fReader := bufio.NewReader(imgFile)\n    fReader.Read(buf)\n\n    imgBase64Str := base64.StdEncoding.EncodeToString(buf)\n    //fmt.Println(\"Base64 string is:\", imgBase64Str)\n    return imgBase64Str\n\n}\n</code></pre>\n\n<p>You may also want to read the example in <a href=\"https://golang.org/pkg/image/#Decode\" rel=\"nofollow noreferrer\">https://golang.org/pkg/image/#Decode</a>\nHope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504774388, "post_id": 46078377, "comment_id": 79145583, "body": "This worked. But It will be appreciable if you can explain a little bit more. I am beginner in golang."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504777817, "post_id": 46078377, "comment_id": 79147995, "body": "What do you want me to further explain?"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1504778995, "post_id": 46078377, "comment_id": 79148840, "body": "&quot; partly-consumed reader is passed to jpeg.Decode() &quot; . I am not  able to understand this. I am passing the res that is same for both a new reader. isnt&#39; it ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 1, "creation_date": 1504787917, "post_id": 46078377, "comment_id": 79154818, "body": "In your version, <code>png.Decode</code> reads from the reader, consuming the data.  So by the time <code>jpeg.Decode</code> gets <code>res</code>, part of the data has already been consumed, so it no longer sees a complete JPEG file, but only the latter portion of a JPEG file."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 8, "last_activity_date": 1504709858, "last_edit_date": 1504709858, "creation_date": 1504709515, "answer_id": 46078377, "question_id": 46022262, "link": "https://stackoverflow.com/questions/46022262/convert-base64-string-to-jpg/46078377#46078377", "title": "Convert base64 string to JPG", "body": "<p>You're passing your <code>io.Reader</code> to <code>png.Decode()</code>, which begins consuming the reader, only to discover that the input is not a valid PNG, so returns an error.</p>\n\n<p>Then your partly-consumed reader is passed to <code>jpeg.Decode()</code>, which reads the data not yet read, which is not a valid JPEG, and returns the error you observe.</p>\n\n<p>You need to create a new reader for each decoder:</p>\n\n<pre><code>pngI, errPng := png.Decode(bytes.NewReader(unbased))\n\n// ...\n\njpgI, errJpg := jpeg.Decode(bytes.NewReader(unbased))\n</code></pre>\n\n<p>Or better yet, consider the MIME type, and only call the proper decoder:</p>\n\n<pre><code>switch strings.TrimSuffix(image[5:coI], \";base64\") {\ncase \"image/png\":\n    pngI, err = png.Decode(res)\n    // ...\ncase \"image/jpeg\":\n    jpgI, err = jpeg.Decode(res)\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13990, "favorite_count": 4, "accepted_answer_id": 46078377, "answer_count": 2, "score": 10, "last_activity_date": 1574261362, "creation_date": 1504432968, "last_edit_date": 1574261362, "question_id": 46022262, "link": "https://stackoverflow.com/questions/46022262/convert-base64-string-to-jpg", "title": "Convert base64 string to JPG", "body": "<p>I am getting the <strong>image as base64 string ( <code>dataurl</code> )</strong>, Below is my function that converts the <code>dataurl</code> into the image,</p>\n\n<p>Now if the image is png then png library will create the image and jpg library will throw an error and vice versa.</p>\n\n<p>Problem is when i upload png it works well but when i <strong>upload jpg file<br>\n returns this error</strong></p>\n\n<blockquote>\n  <p><strong>invalid JPEG format: missing SOI marker</strong></p>\n</blockquote>\n\n<pre><code>func (ProfileController) SetProfilePic(w http.ResponseWriter, r *http.Request) {\n\n    session, _ := session.UserSession.Get(r, \"mvc-user-session\")\n\n    var fieldMapForBasic map[string]*json.RawMessage\n    var f *os.File\n\n    data, _ := ioutil.ReadAll(r.Body)\n    json.Unmarshal(data, &amp;fieldMapForBasic)\n\n    image, _ := json.Marshal(fieldMapForBasic[\"image\"])\n    coI := strings.Index(string(image), \",\")\n    rawImage := string(image)[coI+1:]\n\n    // Encoded Image DataUrl //\n    unbased, _ := base64.StdEncoding.DecodeString(string(rawImage))\n\n    res := bytes.NewReader(unbased)\n    path, _ := os.Getwd()\n\n    // Path to store the image //\n    newpath := filepath.Join(path +  \"/storage\",  strconv.Itoa(session.Values[\"id\"].(int)))\n    os.MkdirAll(newpath, os.ModePerm)\n    uid := uuid.NewV4()\n    fmt.Println(newpath)\n\n    // if image is png this function will create the image from dataurl string //\n    pngI, errPng := png.Decode(res)\n    if errPng == nil {\n        f, _ = os.OpenFile(newpath + \"/\" + uid.String() + \".png\", os.O_WRONLY | os.O_CREATE, 0777)\n        png.Encode(f, pngI)\n        fmt.Println(\"Png generated\")\n        user := model.User{}\n        user.ProfilePic = \"storage/\" + strconv.Itoa(session.Values[\"id\"].(int)) + \"/\" + uid.String()\n        session.Values[\"profile_pic\"] = user.ProfilePic\n        session.Save(r, w)\n        database.Connection.Id(session.Values[\"id\"].(int)).Update(&amp;user)\n    } else {\n        fmt.Println(errPng.Error())\n    }\n\n    // If image is Jpg this will generate the Image //\n    jpgI, errJpg := jpeg.Decode(res)\n    if errJpg == nil {\n        f, _ = os.OpenFile(newpath + \"/\" + uid.String() + \".jpg\", os.O_WRONLY | os.O_CREATE, 0777)\n        jpeg.Encode(f, jpgI, &amp;jpeg.Options{Quality: 75})\n        fmt.Println(\"Jpg created\")\n    } else {\n        fmt.Println(errJpg.Error())\n    }\n\n    defer func() {\n        f.Close()\n    }()\n\n    render.Json(w, \"ok\")\n}\n</code></pre>\n\n<p>Input <code>dataurl</code> is:</p>\n\n<pre><code>\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCADeAN4DASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDtKKKK/cD8rCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z\"\n</code></pre>\n\n<p>This might help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 6, "creation_date": 1504425100, "post_id": 46021330, "comment_id": 79002084, "body": "Have you tried <a href=\"https://golang.org/pkg/net/http/#Request.Header\" rel=\"nofollow noreferrer\">reading the Docs</a>?"}, {"owner": {"reputation": 677, "user_id": 2827098, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/510107273/picture?type=large", "display_name": "Ayman Elmubark", "link": "https://stackoverflow.com/users/2827098/ayman-elmubark"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1504425850, "post_id": 46021330, "comment_id": 79002227, "body": "Yes, I have. I kept trying to use parenthesis instead of brackets, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 15, "last_activity_date": 1504428992, "creation_date": 1504428992, "answer_id": 46021789, "question_id": 46021330, "link": "https://stackoverflow.com/questions/46021330/how-can-i-read-a-header-from-an-http-request-in-golang/46021789#46021789", "title": "How can I read a header from an http request in golang?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(http.ListenAndServe(\"localhost:8000\", nil))\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"%s %s %s \\n\", r.Method, r.URL, r.Proto)\n    //Iterate over all header fields\n    for k, v := range r.Header {\n        fmt.Fprintf(w, \"Header field %q, Value %q\\n\", k, v)\n    }\n\n    fmt.Fprintf(w, \"Host = %q\\n\", r.Host)\n    fmt.Fprintf(w, \"RemoteAddr= %q\\n\", r.RemoteAddr)\n    //Get value for a specified token\n    fmt.Fprintf(w, \"\\n\\nFinding value of \\\"Accept\\\" %q\", r.Header[\"Accept\"])\n}\n</code></pre>\n\n<hr>\n\n<p>Connecting to <a href=\"http://localhost:8000/\" rel=\"noreferrer\">http://localhost:8000/</a> from a browser will print the output in the browser.</p>\n"}, {"comments": [{"owner": {"reputation": 127, "user_id": 3354476, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4f2b89fdc186309f4dadbdd7fa6f4e9a?s=128&d=identicon&r=PG&f=1", "display_name": "pixelr", "link": "https://stackoverflow.com/users/3354476/pixelr"}, "edited": false, "score": 0, "creation_date": 1521199435, "post_id": 46022272, "comment_id": 85640105, "body": "it return string array so not useful"}, {"owner": {"reputation": 1295, "user_id": 2279765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/432916361960d8ddbb2d4bdb8369b78f?s=128&d=identicon&r=PG", "display_name": "Tomer", "link": "https://stackoverflow.com/users/2279765/tomer"}, "edited": false, "score": 2, "creation_date": 1544731952, "post_id": 46022272, "comment_id": 94390584, "body": "It is useful if there are multiple values (multiple headers with the same name)."}, {"owner": {"reputation": 2971, "user_id": 203174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2160f04d1ee1ee303eb528580e8830d7?s=128&d=identicon&r=PG", "display_name": "Daniel Vartanov", "link": "https://stackoverflow.com/users/203174/daniel-vartanov"}, "edited": false, "score": 2, "creation_date": 1561809568, "post_id": 46022272, "comment_id": 100188000, "body": "I wonder what makes you write <code>w</code>, <code>r</code> and <code>ua</code> instead of <code>responseWriter</code>, <code>request</code> and <code>userAgent</code>?"}, {"owner": {"reputation": 4246, "user_id": 1612869, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f2f6372b7311939c876b78b022796edc?s=128&d=identicon&r=PG", "display_name": "MaxPRafferty", "link": "https://stackoverflow.com/users/1612869/maxprafferty"}, "reply_to_user": {"reputation": 2971, "user_id": 203174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2160f04d1ee1ee303eb528580e8830d7?s=128&d=identicon&r=PG", "display_name": "Daniel Vartanov", "link": "https://stackoverflow.com/users/203174/daniel-vartanov"}, "edited": false, "score": 6, "creation_date": 1562014688, "post_id": 46022272, "comment_id": 100236655, "body": "@DanielVartanov Its considered idiomatic in Go to use single letter variable names: <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#variable-names\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/CodeReviewComments#variable-names</a>, &quot;Variable names in Go should be short rather than long. This is especially true for local variables with limited scope. Prefer c to lineCount. Prefer i to sliceIndex.&quot;"}, {"owner": {"reputation": 2971, "user_id": 203174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2160f04d1ee1ee303eb528580e8830d7?s=128&d=identicon&r=PG", "display_name": "Daniel Vartanov", "link": "https://stackoverflow.com/users/203174/daniel-vartanov"}, "reply_to_user": {"reputation": 4246, "user_id": 1612869, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f2f6372b7311939c876b78b022796edc?s=128&d=identicon&r=PG", "display_name": "MaxPRafferty", "link": "https://stackoverflow.com/users/1612869/maxprafferty"}, "edited": false, "score": 1, "creation_date": 1562142871, "post_id": 46022272, "comment_id": 100280965, "body": "@MaxPRafferty oh no! Thanks for sharing though"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 82, "last_activity_date": 1504433025, "creation_date": 1504433025, "answer_id": 46022272, "question_id": 46021330, "link": "https://stackoverflow.com/questions/46021330/how-can-i-read-a-header-from-an-http-request-in-golang/46022272#46022272", "title": "How can I read a header from an http request in golang?", "body": "<p>You can use the <a href=\"https://golang.org/pkg/net/http/#Header.Get\" rel=\"noreferrer\">r.Header.Get</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func yourHandler(w http.ResponseWriter, r *http.Request) {\n    ua := r.Header.Get(\"User-Agent\")\n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 531, "user_id": 3354384, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AllgV.png?s=128&g=1", "display_name": "FaaduBaalak", "link": "https://stackoverflow.com/users/3354384/faadubaalak"}, "is_accepted": false, "score": 3, "last_activity_date": 1581998568, "last_edit_date": 1581998568, "creation_date": 1581997203, "answer_id": 60273415, "question_id": 46021330, "link": "https://stackoverflow.com/questions/46021330/how-can-i-read-a-header-from-an-http-request-in-golang/60273415#60273415", "title": "How can I read a header from an http request in golang?", "body": "<p><em>Note: The accepted answer is missing some information.</em></p>\n\n<p>A Header represents the key-value pairs in an HTTP header.\nIt's defined as a map where key is of string type and value is an array of string type.</p>\n\n<pre><code>type Header map[string][]string\n</code></pre>\n\n<p>Actually, <a href=\"https://golang.org/pkg/net/http/#Header.Get\" rel=\"nofollow noreferrer\">r.Header.Get</a> gets the first value associated with the given key i.e. it just gets the first string from index 0.</p>\n\n<p>This is okay if your header just have one value but if it has multiple values, you may miss out on some information.</p>\n\n<p><strong>Eg</strong>. User-Agent header has multiple values against the same key.</p>\n\n<pre><code>user-agent: [\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6)\",  \"AppleWebKit/537.36 (KHTML, like Gecko)\", \"Chrome/80.0.3987.106 Safari/537.36\",]\n</code></pre>\n\n<p>So if you use <code>r.Header.get(\"User-Agent\")</code> , it'll return <code>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6)</code> <strong>only</strong> and not the rest of the values.</p>\n\n<p>If you want to get all the values you can use this:</p>\n\n<pre><code>req.Header[\"User-Agent\"]\n</code></pre>\n"}], "owner": {"reputation": 677, "user_id": 2827098, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/510107273/picture?type=large", "display_name": "Ayman Elmubark", "link": "https://stackoverflow.com/users/2827098/ayman-elmubark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66603, "favorite_count": 7, "accepted_answer_id": 46022272, "answer_count": 3, "score": 53, "last_activity_date": 1581998568, "creation_date": 1504424941, "last_edit_date": 1527374070, "question_id": 46021330, "link": "https://stackoverflow.com/questions/46021330/how-can-i-read-a-header-from-an-http-request-in-golang", "title": "How can I read a header from an http request in golang?", "body": "<p>If I receive a request of type <code>http.Request</code>, how can I read the value of a specific header? In this case I want to pull the value of a jwt token out of the request header.</p>\n"}, {"tags": ["function", "go", "concurrency", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 0, "creation_date": 1504412587, "post_id": 46020189, "comment_id": 79000163, "body": "Brilliant, makes sense - Thanks."}], "tags": [], "owner": {"reputation": 977, "user_id": 1320901, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ac0342cdb127610fa89ba607ed26c562?s=128&d=identicon&r=PG", "display_name": "Geoff ", "link": "https://stackoverflow.com/users/1320901/geoff"}, "is_accepted": true, "score": 3, "last_activity_date": 1504411827, "creation_date": 1504411827, "answer_id": 46020189, "question_id": 46020175, "link": "https://stackoverflow.com/questions/46020175/blocking-behaviour-of-goroutines-in-golang/46020189#46020189", "title": "Blocking Behaviour of GoRoutines in Golang", "body": "<p>runFuncTwo blocks runFuncOne only, as both are running in a separate Go routine.</p>\n\n<p>Note though that main() will therefore continue and exit, causing the program to exit.  To avoid this and all runFuncTwo to complete, you should use a sync.WaitGroup.</p>\n"}, {"comments": [{"owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "edited": false, "score": 0, "creation_date": 1504412583, "post_id": 46020190, "comment_id": 79000161, "body": "Brilliant, makes sense - Thanks."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1504412597, "last_edit_date": 1504412597, "creation_date": 1504411830, "answer_id": 46020190, "question_id": 46020175, "link": "https://stackoverflow.com/questions/46020175/blocking-behaviour-of-goroutines-in-golang/46020190#46020190", "title": "Blocking Behaviour of GoRoutines in Golang", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">Go statements</a></p>\n  \n  <p>The function value and parameters are evaluated as usual in the\n  calling goroutine, but unlike with a regular call, program execution\n  does not wait for the invoked function to complete. Instead, the\n  function begins executing independently in a new goroutine. When the\n  function terminates, its goroutine also terminates. If the function\n  has any return values, they are discarded when the function completes.</p>\n</blockquote>\n\n<pre><code>func main() {\n  go runFuncOne()\n}\n</code></pre>\n\n<p><code>main</code> will invoke <code>runFuncOne()</code> as a goroutine and then exit the program immediately, terminating <code>runFuncOne()</code> without waiting for it to complete. </p>\n\n<pre><code>func runFuncOne() bool {\n  runFuncTwo() \n  return true\n}\n\nfunc runFuncTwo() bool {\n  // Do some heavy work\n  return true\n}\n</code></pre>\n\n<p><code>runFuncOne()</code> makes a function call to <code>runFuncTwo()</code> so it will wait for <code>runFuncTwo()</code> to complete. </p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 1, "last_activity_date": 1504422681, "creation_date": 1504422681, "answer_id": 46021094, "question_id": 46020175, "link": "https://stackoverflow.com/questions/46020175/blocking-behaviour-of-goroutines-in-golang/46021094#46021094", "title": "Blocking Behaviour of GoRoutines in Golang", "body": "<p>Can also use a channel for synchronization:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    var ch chan int = make(chan int)\n    go runFuncOne(ch)\n    fmt.Println(\"Waiting..\")\n    fmt.Println(&lt;-ch)\n}\n\nfunc runFuncOne(ch chan int) {\n    runFuncTwo(ch)\n    ch &lt;- 1\n}\n\nfunc runFuncTwo(ch chan int) bool {\n    time.Sleep(1 * time.Second)\n    fmt.Println(\"Done working..\")\n    return true\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/h1S4TSdT0w\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h1S4TSdT0w</a></p>\n\n<p>Return type of <code>runFuncOne</code> won't be of consequence if you are calling it with a go routine.</p>\n"}], "owner": {"reputation": 644, "user_id": 2386745, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/61387019fb6b26f69632b01f43211eb6?s=128&d=identicon&r=PG", "display_name": "Jordan", "link": "https://stackoverflow.com/users/2386745/jordan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2225, "favorite_count": 2, "accepted_answer_id": 46020189, "answer_count": 3, "score": 1, "last_activity_date": 1504422681, "creation_date": 1504411560, "question_id": 46020175, "link": "https://stackoverflow.com/questions/46020175/blocking-behaviour-of-goroutines-in-golang", "title": "Blocking Behaviour of GoRoutines in Golang", "body": "<p>Given the following pseudo-code:</p>\n\n<pre><code>func main() {\n  go runFuncOne()\n}\n\nfunc runFuncOne() bool {\n  runFuncTwo() \n  return true\n}\n\nfunc runFuncTwo() bool {\n  // Do some heavy work\n  return true\n}\n</code></pre>\n\n<p>Would <code>runFuncTwo</code> only be blocking to <code>runFuncOne</code> (the calling goroutine) or would <code>runFuncTwo</code> also block <code>main()</code> as it is not itself running as a goroutine? </p>\n\n<p>My assumption is that <code>main()</code> will open a thread within which <code>runFuncOne()</code> and <code>runFuncTwo()</code> will then operate. Any work performed within <code>runFuncTwo()</code> will then only block this instance of <code>runFuncOne()</code>?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1504415502, "last_edit_date": 1504415502, "creation_date": 1504413970, "answer_id": 46020359, "question_id": 46020059, "link": "https://stackoverflow.com/questions/46020059/filepath-walk-only-files-dot-files/46020359#46020359", "title": "filepath.Walk only files DOT files", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\">Package filepath</a></p>\n\n<pre><code>import \"path/filepath\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">func Walk</a></p>\n  \n  <p>The files are walked in lexical order,</p>\n  \n  <p><a href=\"https://golang.org/pkg/path/filepath/#WalkFunc\" rel=\"nofollow noreferrer\">type WalkFunc</a></p>\n  \n  <p>If there was a problem walking to the file or directory named by path,\n  the incoming error will describe the problem and the function can\n  decide how to handle that error (and Walk will not descend into that\n  directory). If an error is returned, processing stops. The sole\n  exception is when the function returns the special value SkipDir. If\n  the function returns SkipDir when invoked on a directory, Walk skips\n  the directory's contents entirely. If the function returns SkipDir\n  when invoked on a non-directory file, Walk skips the remaining files\n  in the containing directory.</p>\n</blockquote>\n\n<p>In <code>Walk</code>, dot (Unicode Full Stop '.' U+002E) directory files are near first in lexical order.</p>\n\n<p>In your <code>WalkFunc</code> you return an error: \"If an error is returned, processing stops.\" For example,</p>\n\n<pre><code>if err != nil {\n    log.Println(err)\n    return err\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>open /home/peter/.cache/dconf: permission denied\n</code></pre>\n\n<p>To ignore an error <code>return nil</code>. For example,</p>\n\n<pre><code>if err != nil {\n    log.Println(err)\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 858, "favorite_count": 1, "accepted_answer_id": 46020359, "answer_count": 1, "score": 1, "last_activity_date": 1504415502, "creation_date": 1504410092, "question_id": 46020059, "link": "https://stackoverflow.com/questions/46020059/filepath-walk-only-files-dot-files", "title": "filepath.Walk only files DOT files", "body": "<p>I have a really puzzling problem with the filepath.Walk function.  It only seems to find directories with that are DOT files.  Such as .AndroidStudio or .arduino.  It does not file any files or directories other than those if I set the root to something like /home/charles</p>\n\n<pre><code>//Watches ...Recursively walk the filesystem, entrypoint to file watching\nfunc Watches(tops []string) {\n    dirSet := make(map[string]bool)\n    for _, top := range tops {\n        err := filepath.Walk(top, func(path string, f os.FileInfo, err error) error {\n            if err != nil {\n                log.Println(err)\n                return err\n            }\n            log.Println(\"File: \", path)\n            if f.IsDir() {\n                //Maps can only have one key that matches, duplicates will be overwritten\n                dirSet[path] = true\n            }\n            return nil\n        })\n        if err != nil {\n            log.Println(err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504410358, "post_id": 46019892, "comment_id": 78999870, "body": "I don&#39;t know if it&#39;s the problem or not, but the order of unmount is reversed in the deferred program."}, {"owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504415151, "post_id": 46019892, "comment_id": 79000487, "body": "but it seems that the file systems are unmounted before cmd.Run() is invoked"}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "edited": false, "score": 0, "creation_date": 1504415147, "post_id": 46020080, "comment_id": 79000486, "body": "but it seems that the file systems are unmounted before cmd.Run() is invoked"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "edited": false, "score": 0, "creation_date": 1504416189, "post_id": 46020080, "comment_id": 79000639, "body": "@KasheemLew: See my revised answer for this problem."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1504417070, "last_edit_date": 1504417070, "creation_date": 1504410350, "answer_id": 46020080, "question_id": 46019892, "link": "https://stackoverflow.com/questions/46019892/go-defer-does-not-behave-as-expected-when-unmount/46020080#46020080", "title": "Go `defer` does not behave as expected when Unmount", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Defer statements</a></p>\n  \n  <p>Each time a \"defer\" statement executes, the function value and\n  parameters to the call are evaluated as usual and saved anew but the\n  actual function is not invoked. Instead,\n  deferred functions are invoked immediately before the surrounding\n  function returns, in the <strong>reverse order</strong> they were deferred.</p>\n</blockquote>\n\n<p>For</p>\n\n<pre><code>check(cmd.Run())\ncheck(syscall.Unmount(\"proc\", 0))\ncheck(syscall.Unmount(\"temp\", 0))\n</code></pre>\n\n<p>defer in reverse order    </p>\n\n<pre><code>defer check(syscall.Unmount(\"temp\", 0))\ndefer check(syscall.Unmount(\"proc\", 0))\ncheck(cmd.Run())\n</code></pre>\n\n<hr>\n\n<p>For your second problem, \"the file systems are unmounted before <code>cmd.Run()</code> is invoked \", \"Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked.\"</p>\n"}, {"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 2, "last_activity_date": 1504415796, "creation_date": 1504415796, "answer_id": 46020509, "question_id": 46019892, "link": "https://stackoverflow.com/questions/46019892/go-defer-does-not-behave-as-expected-when-unmount/46020509#46020509", "title": "Go `defer` does not behave as expected when Unmount", "body": "<pre><code>defer check(syscall.Unmount(\"proc\", 0))\ndefer check(syscall.Unmount(\"temp\", 0))\n</code></pre>\n\n<p>You are defering the <code>check</code>-call, but it's arguments are evaluated immediately, which means, <code>syscall.Unmount</code> is not defered. See <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Defer_statements</a></p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, <strong>the function value and\n  parameters to the call are evaluated as usual and saved anew</strong> but the\n  actual function is not invoked. Instead, deferred functions are\n  invoked immediately before the surrounding function returns, in the\n  reverse order they were deferred. If a deferred function value\n  evaluates to nil, execution panics when the function is invoked, not\n  when the \"defer\" statement is executed.</p>\n</blockquote>\n\n<p>Use a anonymous function if you can't get rid of the check-call:</p>\n\n<pre><code>defer func() { check(syscall.Unmount(\"proc\", 0)) }()\ndefer func() { check(syscall.Unmount(\"temp\", 0)) }()\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 1, "accepted_answer_id": 46020509, "answer_count": 2, "score": 0, "last_activity_date": 1504417070, "creation_date": 1504407673, "last_edit_date": 1504415435, "question_id": 46019892, "link": "https://stackoverflow.com/questions/46019892/go-defer-does-not-behave-as-expected-when-unmount", "title": "Go `defer` does not behave as expected when Unmount", "body": "<p>Here is my main.go, and I use <code>go run main.go run sh</code> to create a process which runs shell in it. </p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n    \"os/exec\"\n    \"path/filepath\"\n    \"strconv\"\n    \"syscall\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        logrus.Errorf(\"missing commands\")\n        return\n    }\n    switch os.Args[1] {\n    case \"run\":\n        run()\n    case \"child\":\n        child()\n    default:\n        logrus.Errorf(\"wrong command\")\n        return\n    }\n}\n\nfunc run() {\n    logrus.Info(\"Setting up...\")\n    cmd := exec.Command(\"/proc/self/exe\", append([]string{\"child\"}, os.Args[2:]...)...)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWPID | syscall.CLONE_NEWNS,\n    }\n    check(cmd.Run())\n}\n\nfunc child() {\n    logrus.Infof(\"Running %v\", os.Args[2:])\n    cmd := exec.Command(os.Args[2], os.Args[3:]...)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    check(syscall.Sethostname([]byte(\"newhost\")))\n    check(syscall.Chroot(\"/root/busybox\"))\n    check(os.Chdir(\"/\"))\n    check(syscall.Mount(\"proc\", \"proc\", \"proc\", 0, \"\"))\n    check(syscall.Mount(\"tempdir\", \"temp\", \"tmpfs\", 0, \"\"))\n    check(cmd.Run())\n    check(syscall.Unmount(\"proc\", 0))\n    check(syscall.Unmount(\"temp\", 0))\n}\n\nfunc check(err error) {\n    if err != nil {\n        logrus.Errorln(err)\n    }\n}\n</code></pre>\n\n<p>When I run <code>mount</code> in the new shell, it returns </p>\n\n<pre><code>proc on /proc type proc (rw,relatime)\ntempdir on /temp type tmpfs (rw,relatime) \n</code></pre>\n\n<p>that just works fine.</p>\n\n<p>But when I change the child function into </p>\n\n<pre><code>func child() {\n    ...\n    check(os.Chdir(\"/\"))\n    check(syscall.Mount(\"proc\", \"proc\", \"proc\", 0, \"\"))\n    check(syscall.Mount(\"tempdir\", \"temp\", \"tmpfs\", 0, \"\"))\n    defer check(syscall.Unmount(\"proc\", 0))\n    defer check(syscall.Unmount(\"temp\", 0))\n    check(cmd.Run())\n}\n</code></pre>\n\n<p>and run <code>mount</code> again, it returns <code>mount: no /proc/mounts</code>.</p>\n\n<p><code>defer</code> is illustrated to defer the function after it to the end of the outer function. But it seems that <code>syscall.Umount()</code> is invoked before <code>cmd.Run()</code>. Thanks for your help.</p>\n"}, {"tags": ["go", "aws-sdk"], "answers": [{"comments": [{"owner": {"reputation": 1000, "user_id": 749406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/351bf1ac6360e07ad9d461a9b8bcf927?s=128&d=identicon&r=PG", "display_name": "Urjit", "link": "https://stackoverflow.com/users/749406/urjit"}, "edited": false, "score": 3, "creation_date": 1532911866, "post_id": 46019585, "comment_id": 90136994, "body": "Prefer using <code>aws.WriteAtBuffer</code> as answered by @sam rather than rolling a custom solution."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 1000, "user_id": 749406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/351bf1ac6360e07ad9d461a9b8bcf927?s=128&d=identicon&r=PG", "display_name": "Urjit", "link": "https://stackoverflow.com/users/749406/urjit"}, "edited": false, "score": 0, "creation_date": 1533002960, "post_id": 46019585, "comment_id": 90174752, "body": "If the AWS API has that baked in, then of course you should use it."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 5, "last_activity_date": 1504456419, "last_edit_date": 1504456419, "creation_date": 1504402976, "answer_id": 46019585, "question_id": 46019484, "link": "https://stackoverflow.com/questions/46019484/buffer-implementing-io-writerat-in-go/46019585#46019585", "title": "Buffer implementing io.WriterAt in go", "body": "<p>I don't know of any way to do this in the standard library, but you can write your own buffer.</p>\n\n<p>It really wouldn't be all that hard...</p>\n\n<p>EDIT: I couldn't stop thinking about this, and I ended up acidentally the whole thing, enjoy :)</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc main() {\n    buff := NewWriteBuffer(0, 10)\n\n    buff.WriteAt([]byte(\"abc\"), 5)\n    fmt.Printf(\"%#v\\n\", buff)\n}\n\n// WriteBuffer is a simple type that implements io.WriterAt on an in-memory buffer.\n// The zero value of this type is an empty buffer ready to use.\ntype WriteBuffer struct {\n    d []byte\n    m int\n}\n\n// NewWriteBuffer creates and returns a new WriteBuffer with the given initial size and\n// maximum. If maximum is &lt;= 0 it is unlimited.\nfunc NewWriteBuffer(size, max int) *WriteBuffer {\n    if max &lt; size &amp;&amp; max &gt;= 0 {\n        max = size\n    }\n    return &amp;WriteBuffer{make([]byte, size), max}\n}\n\n// SetMax sets the maximum capacity of the WriteBuffer. If the provided maximum is lower\n// than the current capacity but greater than 0 it is set to the current capacity, if\n// less than or equal to zero it is unlimited..\nfunc (wb *WriteBuffer) SetMax(max int) {\n    if max &lt; len(wb.d) &amp;&amp; max &gt;= 0 {\n        max = len(wb.d)\n    }\n    wb.m = max\n}\n\n// Bytes returns the WriteBuffer's underlying data. This value will remain valid so long\n// as no other methods are called on the WriteBuffer.\nfunc (wb *WriteBuffer) Bytes() []byte {\n    return wb.d\n}\n\n// Shape returns the current WriteBuffer size and its maximum if one was provided.\nfunc (wb *WriteBuffer) Shape() (int, int) {\n    return len(wb.d), wb.m\n}\n\nfunc (wb *WriteBuffer) WriteAt(dat []byte, off int64) (int, error) {\n    // Range/sanity checks.\n    if int(off) &lt; 0 {\n        return 0, errors.New(\"Offset out of range (too small).\")\n    }\n    if int(off)+len(dat) &gt;= wb.m &amp;&amp; wb.m &gt; 0 {\n        return 0, errors.New(\"Offset+data length out of range (too large).\")\n    }\n\n    // Check fast path extension\n    if int(off) == len(wb.d) {\n        wb.d = append(wb.d, dat...)\n        return len(dat), nil\n    }\n\n    // Check slower path extension\n    if int(off)+len(dat) &gt;= len(wb.d) {\n        nd := make([]byte, int(off)+len(dat))\n        copy(nd, wb.d)\n        wb.d = nd\n    }\n\n    // Once no extension is needed just copy bytes into place.\n    copy(wb.d[int(off):], dat)\n    return len(dat), nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "edited": false, "score": 5, "creation_date": 1568242941, "post_id": 48254996, "comment_id": 102216407, "body": "It&#39;s worth noting that this buffer will grow unboundedly (up to filesize) unless concurrently drained (read from)"}], "tags": [], "owner": {"reputation": 1526, "user_id": 150999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0b029723ccb480b525b1cf8c687685c?s=128&d=identicon&r=PG", "display_name": "Sam", "link": "https://stackoverflow.com/users/150999/sam"}, "is_accepted": true, "score": 61, "last_activity_date": 1515970539, "creation_date": 1515970539, "answer_id": 48254996, "question_id": 46019484, "link": "https://stackoverflow.com/questions/46019484/buffer-implementing-io-writerat-in-go/48254996#48254996", "title": "Buffer implementing io.WriterAt in go", "body": "<p>For cases involving the AWS SDK, use <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/#WriteAtBuffer\" rel=\"noreferrer\"><code>aws.WriteAtBuffer</code></a> to download S3 objects into memory.</p>\n\n<pre><code>requestInput := s3.GetObjectInput{\n    Bucket: aws.String(bucket),\n    Key:    aws.String(key),\n}\n\nbuf := aws.NewWriteAtBuffer([]byte{})\ndownloader.Download(buf, &amp;requestInput)\n\nfmt.Printf(\"Downloaded %v bytes\", len(buf.Bytes()))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "is_accepted": false, "score": 14, "last_activity_date": 1555901766, "creation_date": 1555901766, "answer_id": 55788634, "question_id": 46019484, "link": "https://stackoverflow.com/questions/46019484/buffer-implementing-io-writerat-in-go/55788634#55788634", "title": "Buffer implementing io.WriterAt in go", "body": "<h1>Faking AWS WriterAt with an io.Writer</h1>\n\n<p>This isn't a direct answer to the original question but rather the solution I actually used after landing here. It's a similar use case that I figure may help others.</p>\n\n<p>The AWS documentation defines the contract such that if you set <code>downloader.Concurrency</code> to 1, you get guaranteed sequential writes.</p>\n\n<pre><code>downloader.Download(FakeWriterAt{w}, s3.GetObjectInput{\n    Bucket: aws.String(bucket),\n    Key:    aws.String(key),\n})\ndownloader.Concurrency = 1\n</code></pre>\n\n<p>Therefore you can take an <code>io.Writer</code> and wrap it to fulfill the <code>io.WriterAt</code>, throwing away the <code>offset</code> that you no longer need:</p>\n\n<pre><code>type FakeWriterAt struct {\n    w io.Writer\n}\n\nfunc (fw FakeWriterAt) WriteAt(p []byte, offset int64) (n int, err error) {\n    // ignore 'offset' because we forced sequential downloads\n    return fw.w.Write(p)\n}\n</code></pre>\n"}], "owner": {"reputation": 368, "user_id": 7087081, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e22b2c8e6d5dc08f8c1f242c5b2cecb6?s=128&d=identicon&r=PG&f=1", "display_name": "Onestay", "link": "https://stackoverflow.com/users/7087081/onestay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8666, "favorite_count": 4, "accepted_answer_id": 48254996, "answer_count": 3, "score": 22, "last_activity_date": 1555901766, "creation_date": 1504401519, "question_id": 46019484, "link": "https://stackoverflow.com/questions/46019484/buffer-implementing-io-writerat-in-go", "title": "Buffer implementing io.WriterAt in go", "body": "<p>I'm using the aws-sdk to download a file from an s3 bucket. The S3 download function want's something that implements io.WriterAt however bytes.Buffer doesn't implement that. Right now I'm creating a file which implements io.WriterAt but I'd like something in memory.</p>\n"}, {"tags": ["arrays", "go", "strconv"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1504400469, "post_id": 46019359, "comment_id": 78998620, "body": "Is this honestly a bottleneck in your application? Do some experimenting with reading and writing binary data, and it should become clear to you what approach you need to take."}, {"owner": {"reputation": 377, "user_id": 964618, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/725108080fde47145f1a646312da2e95?s=128&d=identicon&r=PG", "display_name": "ansrivas", "link": "https://stackoverflow.com/users/964618/ansrivas"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1504427184, "post_id": 46019359, "comment_id": 79002539, "body": "No, this is not a bottleneck really. I have already profiled my code and found that his conversion is among the slow parts, so this was an attempt to find if this can actually be even done at all."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1504401020, "creation_date": 1504401020, "answer_id": 46019457, "question_id": 46019359, "link": "https://stackoverflow.com/questions/46019359/convert-a-byte-array-to-float64/46019457#46019457", "title": "Convert a byte array to float64", "body": "<p>No, there is no other way to do this.</p>\n\n<p>The aproach you list as a non-working alternative would be th best method <em>if</em> the float was stored in directly in binary, but since it is stored as a string <code>strconv.ParseFloat</code> is the only way.</p>\n\n<p>Sorry.</p>\n"}], "owner": {"reputation": 377, "user_id": 964618, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/725108080fde47145f1a646312da2e95?s=128&d=identicon&r=PG", "display_name": "ansrivas", "link": "https://stackoverflow.com/users/964618/ansrivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2053, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1504401020, "creation_date": 1504399296, "question_id": 46019359, "link": "https://stackoverflow.com/questions/46019359/convert-a-byte-array-to-float64", "title": "Convert a byte array to float64", "body": "<p>I am trying to convert a byte-array read from a file, which actually happens to be a float. I can go ahead and use <code>strconv.ParseFloat</code> but I am wondering if there is any <strong>faster</strong> way to achieve this, rather than this string conversion overhead?</p>\n\n<p>The following snippet is from another post : <a href=\"https://stackoverflow.com/questions/22491876/convert-byte-array-uint8-to-float64-in-golang\">here</a> but obviously it doesn't work for the scenario described above. </p>\n\n<p>Thanks in advance for your suggestions.</p>\n\n<pre><code>package main\n\nimport (\n\"encoding/binary\"\n\"fmt\"\n\"math\"\n) \n\nfunc Float64frombytes(bytes []byte) float64 {\n    bits := binary.LittleEndian.Uint64(bytes)\n    float := math.Float64frombits(bits)\n    return float\n}\n\n\nfunc main() {\n\n\n    // This is read from a file, so its avaible as a byte array\n    input := []byte(\"1.11\")\n\n    // This throws an exception obviously.\n    float := Float64frombytes()   \n    fmt.Println(float)\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 1751, "user_id": 1212336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4002e9409f235e93386772dbe71c1500?s=128&d=identicon&r=PG", "display_name": "adamliesko", "link": "https://stackoverflow.com/users/1212336/adamliesko"}, "is_accepted": true, "score": 1, "last_activity_date": 1504387373, "creation_date": 1504387373, "answer_id": 46018313, "question_id": 46017773, "link": "https://stackoverflow.com/questions/46017773/assert-called-once-or-assert-called-xyz-equivalent/46018313#46018313", "title": "assert_called_once() or assert_called_xyz().... equivalent?", "body": "<p>I've used the approach of counter on the struct and then asserting it inside the package level unit test multiple times in the past. Still, it's probably only until the level of package, when you would like to test such an internal assertions. I believe it's an accepted way of doing this in Go. Just be careful about properly synchronizing the access to the counter, if you decide to use a global variable or run the tests concurrently.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"testing\"\n)\n\ntype fakeable interface {\n    Hello()\n}\n\ntype fakeFarmService struct {\n    mu      sync.Mutex\n    counter int\n}\n\nfunc (f *fakeFarmService) Hello() {\n    f.mu.Lock()\n    f.counter++\n    f.mu.Unlock()\n}\n\nfunc helloCaller(callee fakeable) {\n    callee.Hello()\n}\n\nfunc TestCallingTheHello(t *testing.T) {\n    fakeSvc := &amp;fakeFarmService{}\n    helloCaller(fakeSvc)\n    helloCaller(fakeSvc)\n\n    // we expect that Hello method of fakeable was called 2 times\n    fakeSvc.mu.Lock()\n    defer fakeSvc.mu.Unlock()\n    if c := fakeSvc.counter; c != 2 {\n        t.Errorf(\"unexpected call count, want 2, got %d\", c)\n    }\n}\n\nfunc main() {\n    TestCallingTheHello(&amp;testing.T{})\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RXKuLKIZwc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RXKuLKIZwc</a> (test error won't work inside the playground)</p>\n\n<p>Some good material on advanced testing in Go</p>\n\n<ol>\n<li><a href=\"https://www.youtube.com/watch?v=ndmB0bj7eyw\" rel=\"nofollow noreferrer\" title=\"Testing Techniques by Andrew Gerrand\">Testing Techniques by Andrew Gerrand</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=yszygk1cpEc\" rel=\"nofollow noreferrer\" title=\"NewStore TechTalk - Advanced Testing with Go by Mitchell Hashimoto\">NewStore TechTalk - Advanced Testing with Go by Mitchell Hashimoto</a></li>\n</ol>\n"}], "owner": {"reputation": 27, "user_id": 3787772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84427b4895567fa8d6f86f7ae359224e?s=128&d=identicon&r=PG&f=1", "display_name": "shan3k", "link": "https://stackoverflow.com/users/3787772/shan3k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 46018313, "answer_count": 1, "score": 0, "last_activity_date": 1504439992, "creation_date": 1504383131, "last_edit_date": 1504439992, "question_id": 46017773, "link": "https://stackoverflow.com/questions/46017773/assert-called-once-or-assert-called-xyz-equivalent", "title": "assert_called_once() or assert_called_xyz().... equivalent?", "body": "<p>It is important to me to be able to assert how many times a fake / mocked method is called in my tests and I'm wondering what is the best way to do this without using something like testify.  In my case, the call to the mocked method is the result of some recursive call.</p>\n\n<p>Lets say I have table driven tests with various animals, I want to assert that Hello is actually called for some tests but not for others. In some cases, it should be called more than once for given test (iterating over a slice). </p>\n\n<p>Is it appropriate to just add a counter and make an assertion on that in my table driven test?  It seems to me like maybe there is a better way to do this. </p>\n\n<p>If I do add a counter to the hello method... where is it appropriate to deal with and check this. In the fake method itself or in the test etc? </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"false\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>type fakeFarmService struct {\r\n\tabc.someFarmServiceInterface\r\n}\r\n\r\nfunc (f *fakeFarmService) Hello(ctx context.Context, in *abc.FarmRequest) (*abc.FarmResponse, error) {\r\n\tif in.GetAnimal() == Monkey {\r\n\t\treturn &amp;abc.HelloResponse{}, nil\r\n\t}\r\n\treturn nil, errors.New(\"an error\")\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1504398937, "post_id": 46016970, "comment_id": 78998431, "body": "The comments at the beginning of <a href=\"https://golang.org/src/runtime/proc.go\" rel=\"nofollow noreferrer\"><code>runtime&#47;proc.go</code></a> might provide a starting point for you. What are you hoping to learn, out of curiosity?"}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1504436112, "post_id": 46016970, "comment_id": 79004598, "body": "@TimCooper I just want to get some insight into what exactly is Go runtime doing: I know that there is GC and goroutine scheduler running but what more?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1504514548, "post_id": 46016970, "comment_id": 79026411, "body": "There&#39;s no such spec because <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The spec</a> defines the language, not an implementation. Currently two full-blown implementations of Go exist: the reference one, known as &quot;gc&quot;, the one you&#39;re probably using, and another one, which is a part of GCC. The language implementation must adhere to that spec but are free to do that in whatever way they see fit."}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504376980, "creation_date": 1504376980, "question_id": 46016970, "link": "https://stackoverflow.com/questions/46016970/where-can-i-find-go-runtime-goroutines-spec", "title": "Where can I find Go runtime goroutines spec?", "body": "<p>After running a rather simple Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nfunc main() {\n    sigs := make(chan os.Signal)\n\n    signal.Notify(sigs, syscall.SIGINT, syscall.SIGTERM)\n\n    fmt.Printf(\"awaiting signal at %d\\n\", os.Getpid())\n    &lt;-sigs\n    fmt.Printf(\"\\nexiting\\n\")\n}\n</code></pre>\n\n<p>I can observe the following threads being created on my system (found by <code>top -H</code> to list threads aside processes):</p>\n\n<pre><code> 3949 USER    20   0    3232   1400   1032 S  0.0  0.0   0:00.00 goroutines1\n 3950 USER    20   0    3232   1400   1032 S  0.0  0.0   0:00.00 goroutines1\n 3951 USER    20   0    3232   1400   1032 S  0.0  0.0   0:00.00 goroutines1\n 3952 USER    20   0    3232   1400   1032 S  0.0  0.0   0:00.00 goroutines1\n 3953 USER    20   0    3232   1400   1032 S  0.0  0.0   0:00.00 goroutines1\n</code></pre>\n\n<p>Where <code>PID 3949</code> is the main thread. </p>\n\n<p>Where can I find the spec/information about the other 4 threads being run by Go runtime?</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "edited": false, "score": 0, "creation_date": 1504370949, "post_id": 46016043, "comment_id": 78991892, "body": "Also the <i>negative</i> answers are useful and acceptable. <i>&quot;There is no standard way to do that&quot;</i> is exactly an useful answer, like <i>&quot;You can do this with...&quot;</i> - I will know, I can stop the search."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504371216, "post_id": 46016043, "comment_id": 78991981, "body": "Do you control all the types in question or do you want this to work for built in types and any other type?"}, {"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504371284, "post_id": 46016043, "comment_id": 78992005, "body": "The reason of the downvote, and the close vote as &quot;go to the SU&quot; are unclear to me, but I am open for any advices."}, {"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504371347, "post_id": 46016043, "comment_id": 78992023, "body": "@KennyGrant Ideally, for both of them. I don&#39;t control all the types - it will be in a package. It will be called by mainly for not builtin types."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1504374670, "post_id": 46016043, "comment_id": 78992973, "body": "You could use a <code>Register(name string, v interface{})</code> function, similar to that of the <a href=\"https://golang.org/pkg/database/sql/#Register\" rel=\"nofollow noreferrer\"><code>database&#47;sql</code></a> or <a href=\"https://golang.org/pkg/image/#RegisterFormat\" rel=\"nofollow noreferrer\"><code>image</code></a> packages and hash the names provided."}, {"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "edited": false, "score": 0, "creation_date": 1504378365, "post_id": 46016043, "comment_id": 78994093, "body": "@ChronoKitsune Thanks. I checked these functions, but as far as I can see it, they don&#39;t compare types. How do these functions compare Types?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1504378621, "post_id": 46016043, "comment_id": 78994159, "body": "I&#39;m saying you&#39;d need to write your own Register function and store hashes of the registered type names, so you could compare them yourself."}, {"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "edited": false, "score": 0, "creation_date": 1504378744, "post_id": 46016043, "comment_id": 78994192, "body": "@ChronoKitsune Thanks again. It is the option I described in the before the last paragraph of the post. I think, it is a strong indication, that there is no quicker solution."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1580127071, "last_edit_date": 1580127071, "creation_date": 1504382171, "answer_id": 46017656, "question_id": 46016043, "link": "https://stackoverflow.com/questions/46016043/is-there-a-way-to-order-types-quickly-in-go/46017656#46017656", "title": "Is there a way to order types quickly in Go?", "body": "<h3>Using <code>Type.Name()</code> is bad</h3>\n\n<p>Using <code>Type.Name()</code> for comparison is a really bad idea as there are many anonymous types where <code>Type.Name()</code> returns the empty string such as <code>[]int</code>, <code>*int</code> etc. Also the name returned by <code>Type.Name()</code> does not include the package name, so for example names of <code>time.Time</code> and <code>foo.Time</code> will be <code>\"Time\"</code> and therefore considered equal. No more is needed to be said. Check out <a href=\"https://stackoverflow.com/questions/36310538/identify-non-builtin-types-using-reflect/37292523#37292523\">Identify non builtin-types using reflect</a> for more details.</p>\n\n<h3>With an internal registry</h3>\n\n<p>An easy and fast way would be to assign a single integer (e.g. an <code>int</code> value) to all types that need to be compared, and then you don't need any <code>string</code> comparison nor hashing, just compare the assigned <code>int</code> values.</p>\n\n<p>Only question left is how to assign and <em>remember</em> these <code>int</code> values. The assigned values may simply be continuous values, starting with 1, then 2, 3 etc. This assignment and lookup may be automatic (hidden from our eyes).</p>\n\n<p>Essentially we want a function something like this:</p>\n\n<pre><code>// Compare compares 2 types, returns a negative number\n// if t1 &lt; t2, a positive number if t1 &gt; t2, and 0 otherwise.\nfunc Compare(t1, t2 reflect.Type) int {\n}\n</code></pre>\n\n<p>And the implementation is very simple / compact:</p>\n\n<pre><code>var (\n    registry = map[reflect.Type]int{}\n    max      int\n)\n\nfunc value(t reflect.Type) int {\n    v := registry[t]\n    if v == 0 {\n        max++\n        v, registry[t] = max, max\n    }\n    return v\n}\n\n// Compare compares 2 types, returns a negative number\n// if t1 &lt; t2, a positive number if t1 &gt; t2, and 0 otherwise.\nfunc Compare(t1, t2 reflect.Type) int {\n    v1, v2 := value(t1), value(t2)\n    return v1 - v2\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>tstring := reflect.TypeOf(\"\")\ntint := reflect.TypeOf(int(1))\nttime := reflect.TypeOf(time.Time{})\n\nfmt.Println(Compare(tstring, tstring)) // 0\nfmt.Println(Compare(tint, ttime))      // -1, tint gets registered first\nfmt.Println(Compare(ttime, tint))      // 1\nfmt.Println(Compare(tint, tint))       // 0\nfmt.Println(Compare(tstring, ttime))   // -2\nfmt.Println(Compare(ttime, tstring))   // 2\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/wD2tppiKYs\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n-1\n1\n0\n-2\n2\n</code></pre>\n\n<h3>Making it safe for concurrent use</h3>\n\n<p>One weakness though: the implementation is not safe for concurrent use (by multiple goroutines). If we need safety for concurrent use, access to the <code>registry</code> map (and to the <code>max</code> variable) must be synchronized:</p>\n\n<pre><code>var mu sync.RWMutex\n\nfunc value(t reflect.Type) int {\n    mu.RLock()\n    v := registry[t]\n    mu.RUnlock()\n    if v == 0 {\n        mu.Lock()\n        max++\n        v, registry[t] = max, max\n        mu.Unlock()\n    }\n    return v\n}\n</code></pre>\n\n<p>The rest is unchanged. The output is the same. Try this one on the <a href=\"https://play.golang.org/p/Oo-YBTwBgl\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Under the hood (looking closer)</h3>\n\n<p>Now this <code>Compare()</code> implies using a lock under the hood. Also in order to get the assigned integer value of a type, we have to index a map. The type of the key in this map is <code>reflect.Type</code> which is an interface type. Current implementation of <code>reflect.Type</code> is <code>*reflect.rtype</code> which is a pointer, so it is still fast enough as only a pointer is hashed and then looked for in a bucket (the builtin map is a hashmap implementation).</p>\n\n<h3>The fastest solution (getting rid of locks and map indexing)</h3>\n\n<p>Now this <code>Compare()</code> implies using a lock under the hood (and indexing a map), so that may still be an unacceptable \"burden\" if you really seek the fastest solution. You can easily get rid of using those all the time when comparison is needed if you acquire the internal <code>int</code> value assigned for the type, and use that, even directly to compare to another type's value.</p>\n\n<p>For this, all you need to do is \"publish\" (export) the <code>value()</code> function:</p>\n\n<pre><code>func Value(t reflect.Type) int {\n    // ...\n}\n</code></pre>\n\n<p>And <code>Compare()</code> may even be removed. So libraries that need this kind of type comparison can query the integer value assigned to a type, and they can \"cache\" this value to avoid having to call it again (as it won't change during the lifetime of a process), and it can be compared to other values obtained by this <code>Value()</code> function.</p>\n\n<p>For example:</p>\n\n<pre><code>vstring := Value(reflect.TypeOf(\"\"))\nvint := Value(reflect.TypeOf(int(1)))\nvtime := Value(reflect.TypeOf(time.Time{}))\n\nfmt.Println(vstring - vstring) // 0\nfmt.Println(vint - vtime)      // -1, tint gets registered first\nfmt.Println(vtime - vint)      // 1\nfmt.Println(vint - vint)       // 0\nfmt.Println(vstring - vtime)   // -2\nfmt.Println(vtime - vstring)   // 2\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/iFFr4kPDYI\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 46017656, "answer_count": 1, "score": 0, "last_activity_date": 1580127071, "creation_date": 1504370925, "last_edit_date": 1504372289, "question_id": 46016043, "link": "https://stackoverflow.com/questions/46016043/is-there-a-way-to-order-types-quickly-in-go", "title": "Is there a way to order types quickly in Go?", "body": "<p>I have a package which has to order Go types, <em>quickly</em>.</p>\n\n<p>Currently I use <code>reflect.Type</code>s, get their name with <code>Name()</code>, and order the names as strings:</p>\n\n<pre><code>if type1.Name() &lt; type2.Name() { ...\n</code></pre>\n\n<p>However, it uses a string comparison. It works, but I am looking for a more quick solution.</p>\n\n<p><em>How</em> exactly this comparison works, is not an important thing to me - only what I need,</p>\n\n<ol>\n<li>the result of the comparison should be same in the life of process.</li>\n<li>it should be non-equal for different types, but equal for the same type.</li>\n</ol>\n\n<p>Comparing the <code>reflect.Type</code> variables directly with <code>&lt;</code> doesn't work, as this operation is not defined for <code>reflect.Type</code>s in Go.</p>\n\n<p>It would be possible to generate a hash of the type names to 64- or 128 bit integers, and then compare these integers. It is a possibility, however I am looking for a yet quicker solution.</p>\n\n<p>Another possibility would be to compare the <code>reflect.Type</code> variables by their unsafe pointers (casted to <code>int64</code>), but as far I know, there is no guarantee in Go that the <em>unsafe</em> pointer addresses won't change in the life cycle of the process. Thus, I would lose my (1) requirement.</p>\n"}, {"tags": ["go", "crash"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 7575125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e847bd16cbd64b44011284952a831fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Slacker", "link": "https://stackoverflow.com/users/7575125/slacker"}, "edited": false, "score": 0, "creation_date": 1504364609, "post_id": 46014951, "comment_id": 78990154, "body": "Thanks for your answer, I will upgrade my go."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1504364303, "last_edit_date": 1504364303, "creation_date": 1504363684, "answer_id": 46014951, "question_id": 46014717, "link": "https://stackoverflow.com/questions/46014717/golang-log-printf-crash/46014951#46014951", "title": "golang log.Printf crash", "body": "<p><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/65pdWIYga4E\" rel=\"noreferrer\">code 0x0b is 11, which is SIGSEGV.</a>.</p>\n\n<p>I have seen that error before onMac with Go 1.6.3: see \"<a href=\"https://superuser.com/a/1150283/141\">go get throws 'fatal error: unexpected signal during runtime execution'</a>\".<br>\n<a href=\"https://github.com/golang/go/issues/16585#issuecomment-237303120\" rel=\"noreferrer\">Upgrading would be ideal</a>.</p>\n\n<p>See <a href=\"https://github.com/golang/go/issues/17824\" rel=\"noreferrer\">go/go issue 17824</a> for more, and <a href=\"https://go-review.googlesource.com/c/go/+/32882\" rel=\"noreferrer\">cl 32882</a>: </p>\n\n<blockquote>\n  <p><code>doc/devel/release.html</code>: document go1.6.3 doesn't actually support macOS Sierra.</p>\n</blockquote>\n"}], "owner": {"reputation": 177, "user_id": 7575125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e847bd16cbd64b44011284952a831fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Slacker", "link": "https://stackoverflow.com/users/7575125/slacker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 1, "accepted_answer_id": 46014951, "answer_count": 1, "score": 4, "last_activity_date": 1504364303, "creation_date": 1504361998, "question_id": 46014717, "link": "https://stackoverflow.com/questions/46014717/golang-log-printf-crash", "title": "golang log.Printf crash", "body": "<p>Following code crash on my mac after running 2 or 3 seconds, but it's okay on centos 7, and, I am on go 1.6.3.</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>What caused such crash?</li>\n<li>How to avoid it? (Not recover from it)</li>\n<li><p>What does arguments of following stack means?</p>\n\n<pre><code>log.Printf(0x1068d8, 0x6, 0x0, 0x0, 0x0)\n</code></pre>\n\n<p>the signature is:</p>\n\n<pre><code>Print(v ...interface{})\n</code></pre></li>\n</ol>\n\n<p>The crashed code:</p>\n\n<pre><code>package main\nimport (\n    \"log\"\n)\n\nfunc main() {\n    for {\n       log.Printf(\"hello\")\n    }\n}\n</code></pre>\n\n<p>It will crash in 10 seconds, and prints:</p>\n\n<pre><code>2017/09/02 21:50:01 hello\n2017/09/02 21:50:01 hello\n2017/09/02 21:50:01 hello\n2017/09/02 21:50:01 hello\nfatal error: unexpected signal during runtime execution\n[signal 0xb code=0x1 addr=0x1777d0d1d11 pc=0x92f60]\n\ngoroutine 1 [running]:\nruntime.throw(0x12c000, 0x2a)\n    /usr/local/Cellar/go/1.6.3/libexec/src/runtime/panic.go:547 +0x90 fp=0xc820035da0 sp=0xc820035d88\nruntime.sigpanic()\n    /usr/local/Cellar/go/1.6.3/libexec/src/runtime/sigpanic_unix.go:12 +0x5a fp=0xc820035df0 sp=0xc820035da0\nsync.(*Pool).Get(0x1991e0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.6.3/libexec/src/sync/pool.go:102 +0x40 fp=0xc820035e40 sp=0xc820035df0\nfmt.newPrinter(0xed13cae09)\n    /usr/local/Cellar/go/1.6.3/libexec/src/fmt/print.go:133 +0x27 fp=0xc820035e80 sp=0xc820035e40\nfmt.Sprintf(0x1068d8, 0x6, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.6.3/libexec/src/fmt/print.go:202 +0x2b fp=0xc820035ed0 sp=0xc820035e80\nlog.Printf(0x1068d8, 0x6, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.6.3/libexec/src/log/log.go:289 +0x49 fp=0xc820035f20 sp=0xc820035ed0\nmain.main()\n    /Users/haoy/video_projects/rtc-xswitch2/app/recorder/src/test.go:11 +0x3d fp=0xc820035f50 sp=0xc820035f20\nruntime.main()\n    /usr/local/Cellar/go/1.6.3/libexec/src/runtime/proc.go:188 +0x2b0 fp=0xc820035fa0 sp=0xc820035f50\nruntime.goexit()\n    /usr/local/Cellar/go/1.6.3/libexec/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc820035fa8 sp=0xc820035fa0\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "types", "abstract-syntax-tree", "algebraic-data-types"], "comments": [{"owner": {"reputation": 13033, "user_id": 4029014, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ndZhu.jpg?s=128&g=1", "display_name": "aghast", "link": "https://stackoverflow.com/users/4029014/aghast"}, "edited": false, "score": 0, "creation_date": 1504351098, "post_id": 46013074, "comment_id": 78986462, "body": "Create a <code>ListHolder</code> and <code>StringHolder</code> type. Define an interface with two methods: <code>What_type_are_you</code> and <code>Give_me_your_value</code>."}], "answers": [{"comments": [{"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504352507, "post_id": 46013306, "comment_id": 78986825, "body": "two questions about this though: <i>(1)</i> why would <code>sExp()</code> empty method be even needed, since it looks like this is basically equivalent to aliasing <code>interface{}</code> to <code>sExp</code> and <i>(2)</i> why doesn&#39;t a function with type like <code>func makeSexp(parserName string, values ...sExp) sExp</code> satisfy a type defined as <code>type ASTreeMaker func(parserName string, values ...interface{}) interface{}</code>, even if we just do a <code>type sExp interface{}</code> so they should now clearly be the same ...I&#39;m more and more confused :)"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 1, "creation_date": 1504353277, "post_id": 46013306, "comment_id": 78987021, "body": "@NeuronQ The method is there as a marker. So that nobody outside your module could create a type that satisfies <code>sExp</code> interface. And you cannot assign <code>[]sExp</code> to <code>[]interface{}</code> because those types are not <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a>. There is even an <a href=\"https://golang.org/doc/faq#convert_slice_with_same_underlying_type\" rel=\"nofollow noreferrer\">FAQ entry</a> about this."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504354895, "post_id": 46013306, "comment_id": 78987470, "body": "uhm, ok, <i>&quot;you can&#39;t change the name (and method set) of elements of a composite type&quot;</i> is an eye opener, thx for pointing to that ...but I&#39;ll probably work with <code>interface{]</code> until I get to a working design, then see if there&#39;s a safer way to do it ...my actual requirements are that the <b>caller</b> of the module would be free to <i>invent</i> his own AST type (like sexp here), and the parsing module itself would accept any <code>makeTree</code> method from outside"}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504355110, "post_id": 46013306, "comment_id": 78987522, "body": "...I was hoping to be able to contrain inside the module the type of <code>makeTree</code> to be <code>type ASTreeMaker func(parserName string, values ...interface{}) interface{}</code>, but to have the user be able to pass in <b>any</b> kind of more specifically typed <code>makeTree</code> like <code>makeSexp(parserName string, values ...sExp) sExp</code> (with types like <code>sExp</code> only known to the user) and have them work by virtue of simply being more specific versions of the general <code>ASTreeMaker</code>. happen by any chance to imagine a solution for this?"}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504355305, "post_id": 46013306, "comment_id": 78987567, "body": "my use-case is actually &quot;backwards&quot; from your example :) ast-tree types are not private to the module, they are <i>unknown</i> to the module, functions producing them get passed in from the outside (they are likely <i>private to the code that uses this module</i>) ...but I wanted to be able to impose some contraints <i>inside</i> the package, about these <b>&quot;unknowable&quot;</b> types of things produced and consumed by functions passed from outside, or at least have ...anyway, I&#39;m <b>very new</b> to Go, like a few days, so I was expecting some painfully obvious solution I totally missed :)"}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504355589, "post_id": 46013306, "comment_id": 78987648, "body": "or at least let the functions passed in from outside <b>be properly typed</b> even if the code that will call them will have no access to their full actual types (either with a few <code>void*</code> casts or in a dynamic language this would work in more obvious ways than my words can describe :))"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 1, "creation_date": 1504357200, "post_id": 46013306, "comment_id": 78988093, "body": "@NeuronQ You&#39;re writing a book here :) I would suggest you to make a new question describing your use-case in better detail. E.g. &quot;Here is package p1 with type T1, package p2 with type T2, and I want package p0 to use T1 and T2 in these ways, but not those ways&quot;. You get the idea."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1504357315, "post_id": 46013306, "comment_id": 78988123, "body": "ok, I will ...but first I&#39;ll get the untyped/interface{} version going, prefer to have a piece of working code first"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 5, "last_activity_date": 1504351667, "creation_date": 1504351667, "answer_id": 46013306, "question_id": 46013074, "link": "https://stackoverflow.com/questions/46013074/how-to-express-type-of-slice-of-string-or-other-such-slice/46013306#46013306", "title": "How to express type of &quot;slice of (string or &#39;other such slice&#39;)&quot;", "body": "<p>Unfortunately, Go doesn't support algebraic data types, so your best bet to make it type-safe is to create an unexported interface, and make two implementations of it:</p>\n\n<pre><code>type sExp interface {\n    sExp()\n}\n\ntype s string\n\nfunc (s) sExp() {}\n\ntype l []sExp\n\nfunc (l) sExp() {}\n\n// ...\nvar sexp1 sExp = l{s(\"+\"), s(\"1\"), s(\"2\"), l{s(\"*\"), s(\"10\"), s(\"myVal\")}}\n</code></pre>\n\n<p>This is basically how Protobuf compilers deal with e.g. <code>oneof</code> cases. This will still need a lot of type switches or type assertions to work with, but at least you can be sure that nothing outside of your module will be able to tinker with it.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/KOvFqJEvxZ\" rel=\"noreferrer\">https://play.golang.org/p/KOvFqJEvxZ</a>.</p>\n"}], "owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1504351667, "creation_date": 1504349957, "last_edit_date": 1504350952, "question_id": 46013074, "link": "https://stackoverflow.com/questions/46013074/how-to-express-type-of-slice-of-string-or-other-such-slice", "title": "How to express type of &quot;slice of (string or &#39;other such slice&#39;)&quot;", "body": "<p><strong>How can I express in Go a type which is \"a list of (strings or other such lists)\"?</strong> Basically the good ol' \"tree represented as infinitely nested lists of lists and something as values (strings in this example)\"</p>\n\n<p>I'm looking for the simplest possible representation of an S-expression (which itself would be the simplest of an AST), which in Python would look like this:</p>\n\n<pre><code>sexp1 = [\"+\", \"x\", \"y\", [\"*\", \"10\", \"myVal\"]]\nsexp2 = [\"foo\" \"bar\" \"baz\"]\nsexp3 = [ [ [[\"gooo\"], \"moo\"] ], \"too\", [\"yoo\", \"2\"] ]\n</code></pre>\n\n<p>What type would all these expressions have in Go? Obviously <code>[][]string</code> doesn't work, as this doesn't work:</p>\n\n<pre><code>func makeSexp(parserName string, values ...[][]string) [][]string {\n    return append([]string{parserName}, values...)\n}\n</code></pre>\n\n<p>(Compile errors: 1. <code>cannot use values (type [][][]string) as type []string in append</code>, 2. <code>cannot use append([]string literal, values...) (type []string) as type [][]string in return argument</code>.)</p>\n\n<p>...while the fully untyped version works (<strong>but I don't want to completely give up type safety!</strong>):</p>\n\n<pre><code>func makeSexp(parserName string, values ...interface{}) interface{} {\n    return append([]interface{}{parserName}, values...)\n}\n</code></pre>\n"}, {"tags": ["go", "vagrant", "visual-studio-code"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504358542, "post_id": 46012704, "comment_id": 78988479, "body": "Couldn&#39;t you use <code>glide</code> to install the packages to a local vendor and export the local Go path in vscode so that vscode know&#39;s where to look and install stuff."}, {"owner": {"reputation": 2216, "user_id": 3814251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/616b613017e9f6c09760967d09c3b6a0?s=128&d=identicon&r=PG&f=1", "display_name": "therobinkim", "link": "https://stackoverflow.com/users/3814251/therobinkim"}, "edited": false, "score": 1, "creation_date": 1504415134, "post_id": 46012704, "comment_id": 79000480, "body": "I could be wrong here, but my previous research indicates this isn&#39;t (easy) to do. Just install Go on your host machine (MacOS)."}, {"owner": {"reputation": 4746, "user_id": 394572, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1572070193/picture?type=large", "display_name": "alioygur", "link": "https://stackoverflow.com/users/394572/alioygur"}, "reply_to_user": {"reputation": 2216, "user_id": 3814251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/616b613017e9f6c09760967d09c3b6a0?s=128&d=identicon&r=PG&f=1", "display_name": "therobinkim", "link": "https://stackoverflow.com/users/3814251/therobinkim"}, "edited": false, "score": 0, "creation_date": 1504439725, "post_id": 46012704, "comment_id": 79005587, "body": "@therobinkim i think so :) i wasted about 48 hours about this problem."}], "answers": [{"tags": [], "owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "is_accepted": false, "score": 1, "last_activity_date": 1555014765, "creation_date": 1555014765, "answer_id": 55640704, "question_id": 46012704, "link": "https://stackoverflow.com/questions/46012704/visual-studio-code-and-vagrant-integration/55640704#55640704", "title": "Visual studio code and vagrant integration", "body": "<p>Make a nfs share on the GOPATH environment variable in vagrant. On your Mac define also a GOPATH env variable. That way vscode can install the tools on your vagrant.</p>\n\n<p>Although not sure this covers Mac vs Linux binaries.</p>\n\n<p>Another approach might be too create bash aliases/functions which invoke the command over ssh.</p>\n\n<p>I wrote a blog post on how to set up vscode on windows. I would really recommend to install tools natively. Go tooling is small, super fast and doesn't add lot of bloat to your system. E.g. PHP ads lots of crap etc. </p>\n\n<p><a href=\"https://marcofranssen.nl/start-on-your-first-golang-project/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/start-on-your-first-golang-project/</a></p>\n\n<p>Might clarify some stuff for you.</p>\n"}], "owner": {"reputation": 4746, "user_id": 394572, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1572070193/picture?type=large", "display_name": "alioygur", "link": "https://stackoverflow.com/users/394572/alioygur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1891, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1555014765, "creation_date": 1504347256, "question_id": 46012704, "link": "https://stackoverflow.com/questions/46012704/visual-studio-code-and-vagrant-integration", "title": "Visual studio code and vagrant integration", "body": "<p>I am using MacOS and vagrant for Go development. I don't want install any development packages like Go, npm etc. on my host machine (MacOS). All of dev softwares installed on vagrant.</p>\n\n<p>But there is a problem with <a href=\"https://github.com/Microsoft/vscode-go\" rel=\"noreferrer\">vscode-go</a> plugin, Because it requires few go packages like go vet, goimport etc. those packages installed on remote host (vagrat)</p>\n\n<p>So how can I say to vscode that run these commands on remote host?</p>\n"}, {"tags": ["windows", "performance", "go", "benchmarking"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504343411, "post_id": 46012094, "comment_id": 78984576, "body": "you should be able to reproduce with a shorter version of the code and post it here. It&#39;ll be hard to guess what it might be without code. Most likely problems are your recording code not doing what you think or network stall. Are you using goroutines?"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504346119, "post_id": 46012094, "comment_id": 78985212, "body": "@KennyGrant ok, just a minute"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504346839, "post_id": 46012094, "comment_id": 78985394, "body": "@KennyGrant see the edit please"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504361532, "post_id": 46012094, "comment_id": 78989301, "body": "After your edits, now curious what output you get if you try 30 runs say, do you see the same? And if so what do you get if you fmt.Println(k) instead of fmt.Sprint ? I can&#39;t reproduce but hopefully someone else can now we have code."}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1504361891, "post_id": 46012094, "comment_id": 78989379, "body": "@KennyGrant printing the values is actually what I was doing with the original code. Tried it again now - nothing&#39;s changed. Also, running 30 iters gives only 0ns mostly, but sometimes it outputs the ~10^6 ns"}], "answers": [{"comments": [{"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504359874, "post_id": 46014292, "comment_id": 78988869, "body": "Thank you for your answer. What you say is reasonable, but as I said earlier, the issue persists for me even with the version of code I posted. I do understand that all the numbers are relatively small in this case, but I still find the issue rather weird as well as the fact that it does not happen on other people&#39;s machines... :-/"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504360278, "post_id": 46014292, "comment_id": 78988998, "body": "Perhaps edit the question with the numbers you&#39;re seeing for this code and forget the goroutines - are you saying you see some operations timed at 0ns? I saw none of those with the code you posted. Some variation is to be expected, 0ns times are odd and probably a bug."}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504360594, "post_id": 46014292, "comment_id": 78989072, "body": "Yes, I do see the 0ns output for the snippet I gave you. I will update the q with a screenshot"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504360718, "post_id": 46014292, "comment_id": 78989097, "body": "If you can get someone else to test on windows you might be able to confirm there is a problem (I&#39;m testing on Mac OS X). Also I&#39;d reduce your test case further - can you make this happen without complex operations? If so eliminate GetKeys etc."}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504361496, "post_id": 46014292, "comment_id": 78989290, "body": "this <a href=\"https://play.golang.org/p/VOk93p0M_6\" rel=\"nofollow noreferrer\">play.golang.org/p/VOk93p0M_6</a> is the simliest version of the code, for which I am still getting both zeroes and millions"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504362633, "post_id": 46014292, "comment_id": 78989578, "body": "Not reproducible on Ubuntu 17.04"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1504359121, "last_edit_date": 1504359121, "creation_date": 1504358729, "answer_id": 46014292, "question_id": 46012094, "link": "https://stackoverflow.com/questions/46012094/random-drop-in-performance/46014292#46014292", "title": "Random drop in performance", "body": "<p>Best to eliminate GC as obviously logging it is going to interfere with timings. The time pkg on playground is fake, so this won't work there. Trying it locally, I get no times of 0 ns with your code as supplied, it look like it is working as intended. </p>\n\n<p>You should of course expect some variation in times - when I try it the results are all within the same order of magnitude (very small times of 0.000003779 s), but there is an occasional blip even if you do 30 runs, sometimes up to double - but running timings at this resolution is unlikely to give you reliable results as it depends what else is running on the computer, on memory layout etc. Better to try to time long running operations this way rather than very short times like this one and to time lots of operations and average them - this is why the benchmark tool gives you an average over so many runs. </p>\n\n<p>Since the timings are for operations taking very little time, and are not wildly different, I think this is normal behaviour with the code supplied. The 0ns results are wrong but probably the result of your previous use of goroutines, hard to judge that without code as the code you provided doesn't give that result.   </p>\n"}, {"comments": [{"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504365152, "post_id": 46015142, "comment_id": 78990338, "body": "Thanks for your efforts. The outputs are pretty self-explanatory. :)"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504365221, "post_id": 46015142, "comment_id": 78990366, "body": "But still, do you think this is something that should be reported or is it a platform-specific issue that can&#39;t be worked around?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 1, "creation_date": 1504365861, "post_id": 46015142, "comment_id": 78990547, "body": "@NestorSokil: It&#39;s not a hardware issue. The results are from the same machine. It&#39;s a Microsoft Windows OS issue. Linux doesn&#39;t have the issue. Go knows about this problem and runs Go benchmarks for at least one second.  It&#39;s really your problem for running nano benchmarks."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1504368167, "post_id": 46015142, "comment_id": 78991155, "body": "@NestorSokil: Another reason not to run nano benchmarks is Moore&#39;s Law. I had to run the program on an old and slow laptop to occasionally get above zero. On a late model i7 desktop I never did get above zero."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1504365215, "last_edit_date": 1504365215, "creation_date": 1504364812, "answer_id": 46015142, "question_id": 46012094, "link": "https://stackoverflow.com/questions/46012094/random-drop-in-performance/46015142#46015142", "title": "Random drop in performance", "body": "<p>On Windows, for such a tiny duration, you don't have precise enough time stamps. Linux has more precise time stamps. By design, Go benchmarks run for at least one second. Go1.9+ uses the monotonic (m) value to compute the duration.</p>\n\n<p>On Windows:</p>\n\n<p><code>timedur.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\ntype PrefType string\n\nvar types []PrefType = []PrefType{\n    \"TYPE1\", \"TYPE2\", \"TYPE3\", \"TYPE4\", \"TYPE5\", \"TYPE6\",\n}\n\nfunc GetKeys(key string) []string {\n    var result []string\n    for _, t := range types {\n        rr := doCalculations(t)\n        for _, k := range rr {\n            result = append(result, key+\".\"+k)\n        }\n    }\n    return result\n}\n\nfunc doCalculations(prefType PrefType) []string {\n    return []string{string(prefType) + \"something\", string(prefType) + \"else\"}\n}\n\nfunc test() {\n    start := time.Now()\n    keysPrioritized := GetKeys(\"spec_key\")\n    for _, k := range keysPrioritized {\n        _ = fmt.Sprint(k)\n    }\n    end := time.Now()\n    fmt.Printf(\"test took %v ns\\n\", time.Since(start).Nanoseconds())\n    fmt.Println(start)\n    fmt.Println(end)\n    if end.Sub(start) &lt; time.Microsecond {\n        os.Exit(1)\n    }\n}\n\nfunc main() {\n    for i := 0; i &lt; 30000; i++ {\n        test()\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&gt;go run timedur.go\ntest took 1026000 ns\n2017-09-02 14:21:58.1488675 -0700 PDT m=+0.010003700\n2017-09-02 14:21:58.1498935 -0700 PDT m=+0.011029700\ntest took 0 ns\n2017-09-02 14:21:58.1538658 -0700 PDT m=+0.015002000\n2017-09-02 14:21:58.1538658 -0700 PDT m=+0.015002000\nexit status 1\n&gt;\n</code></pre>\n\n<p>On Linux:</p>\n\n<p>Output:</p>\n\n<pre><code>$ go run timedur.go\ntest took 113641 ns\n2017-09-02 14:52:02.917175333 +0000 UTC m=+0.001041249\n2017-09-02 14:52:02.917287569 +0000 UTC m=+0.001153717\ntest took 23614 ns\n2017-09-02 14:52:02.917600301 +0000 UTC m=+0.001466208\n2017-09-02 14:52:02.917623585 +0000 UTC m=+0.001489354\ntest took 22814 ns\n2017-09-02 14:52:02.917726364 +0000 UTC m=+0.001592236\n2017-09-02 14:52:02.917748805 +0000 UTC m=+0.001614575\ntest took 21139 ns\n2017-09-02 14:52:02.917818409 +0000 UTC m=+0.001684292\n2017-09-02 14:52:02.917839184 +0000 UTC m=+0.001704954\ntest took 21478 ns\n2017-09-02 14:52:02.917911899 +0000 UTC m=+0.001777712\n2017-09-02 14:52:02.917932944 +0000 UTC m=+0.001798712\ntest took 31032 ns\n&lt;SNIP&gt;\n</code></pre>\n\n<p>The results are comparable. They were run on the same machine, a dual-boot with Windows 10 and Ubuntu 16.04.</p>\n"}], "owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 46015142, "answer_count": 2, "score": 3, "last_activity_date": 1538575912, "creation_date": 1504342150, "last_edit_date": 1538575912, "question_id": 46012094, "link": "https://stackoverflow.com/questions/46012094/random-drop-in-performance", "title": "Random drop in performance", "body": "<p>I'm kind of a newbie in Go and there is something that confused me recently.</p>\n\n<p>I have a piece of code (simplified version posted below) and I was trying to measure performanc for it. I did this in two ways: 1) a bencmark with testing package 2) manually logging time</p>\n\n<p>Running the benchmark outputs a result</p>\n\n<p><code>30000         55603 ns/op</code></p>\n\n<p>which is fine, BUT... When I do the 30k runs of the same function logging the time for each iteration I get an output like this:</p>\n\n<p><code>test took 0 ns\ntest took 0 ns\n... ~10 records all the same\ntest took 1000100 ns\ntest took 0 ns\ntest took 0 ns\n... lots of zeroes again\ntest took 0 ns\ntest took 1000000 ns\ntest took 0 ns\n...</code></p>\n\n<p>Doing the math shows that the average is indeed <code>55603 ns/op</code> just as the benchmark claims.</p>\n\n<p>Ok, I said, I'm not that good in optimizing performance and not that into all the hardcore compiler stuff, but I guess that might be random garbage collection? So I turned on the gc log, made sure it shows some output, then turned off the gc for good aaand... no garbage collection, but I see the same picture - some iterations take a million times longer(?).</p>\n\n<p>It is 99% that my understanding of all this is wrong somewhere, maybe someone can point me to the right direction or maybe someone knows for sure what the hell is going on? :)</p>\n\n<p>P.S. Also, to me less that a nanosecond (0 ns) is somewhat surprising, that seems too fast, but the program does provide the result of computation, so I don't know what to think anymore. T_T</p>\n\n<p>EDIT 1: Answering  <code>Kenny Grant</code>'s question: I was using goroutines to implement sort-of generator of values to have laziness, now I removed them and simplified the code. The issue is much less frequent now, but it is still reproducible.\nPlayground link: <a href=\"https://play.golang.org/p/UQMgtT4Jrf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UQMgtT4Jrf</a>\nInteresting thing is that does not happen on playground, but still happens on my machine.</p>\n\n<p>EDIT 2: I'm running Go 1.9 on win7 x64</p>\n\n<p>EDIT 3: Thanks to the responses I now know that this code cannot possible work properly on playground. I will repost the code snippet here so that we don't loose it. :)</p>\n\n<pre><code>type PrefType string\nvar types []PrefType = []PrefType{\n    \"TYPE1\", \"TYPE2\", \"TYPE3\", \"TYPE4\", \"TYPE5\", \"TYPE6\",\n}\n\nfunc GetKeys(key string) []string {\n    var result []string\n    for _, t := range types {\n        rr := doCalculations(t)\n        for _, k := range rr {\n            result = append(result, key + \".\" + k)\n        }\n    }\n    return result\n}\n\nfunc doCalculations(prefType PrefType) []string {\n    return []string{ string(prefType) + \"something\", string(prefType) + \"else\" }\n}\n\nfunc test() {\n    start := time.Now()\n    keysPrioritized := GetKeys(\"spec_key\")\n    for _, k := range keysPrioritized {\n        _ = fmt.Sprint(k)\n    }\n    fmt.Printf(\"test took %v ns\\n\", time.Since(start).Nanoseconds())\n}\n\nfunc main() {\n    for i := 0; i &lt; 30000; i++  {\n        test()\n    }\n}\n</code></pre>\n\n<p>Here is the output on my machine:</p>\n\n<p><a href=\"https://i.stack.imgur.com/pGtLv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pGtLv.png\" alt=\"enter image description here\"></a></p>\n\n<p>EDIT 4: I have tried the same on my laptop with Ubuntu 17.04, the output is reasonable, no zeroes and millions. Seems like a Windows-specific issue in the compiler/runtime lib. Would be great if someone can verify this on their machine (Win 7/8/10).</p>\n"}, {"tags": ["csv", "go", "concurrency", "web-scraping", "goquery"], "comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1504336659, "post_id": 46011228, "comment_id": 78983096, "body": "You had the right idea, you were just simply closing the <code>fileWriter</code> before you have a chance to write to it."}], "answers": [{"comments": [{"owner": {"reputation": 379, "user_id": 3431195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/toLY1.jpg?s=128&g=1", "display_name": "credizian", "link": "https://stackoverflow.com/users/3431195/credizian"}, "edited": false, "score": 0, "creation_date": 1504366408, "post_id": 46011445, "comment_id": 78990674, "body": "I tried the following <code>fmt.Println(resTitle) err := writer.Write([]string{&quot;url&quot;, &quot;resTitle&quot;, &quot;res&quot;}) err2 := writer.Write([]string{url, resTitle, res}) checkError(&quot;Cannot write to file&quot;, err) checkError(&quot;Cannot write to file&quot;, err2)</code>  and moved <code>defer fileWrite.Close()</code> after <code>lineCount++}</code> but I just get blank csv file  Here is go playground link: <a href=\"https://play.golang.org/p/eL1Bn8Xsv6\" rel=\"nofollow noreferrer\">play.golang.org/p/eL1Bn8Xsv6</a>"}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "reply_to_user": {"reputation": 379, "user_id": 3431195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/toLY1.jpg?s=128&g=1", "display_name": "credizian", "link": "https://stackoverflow.com/users/3431195/credizian"}, "edited": false, "score": 0, "creation_date": 1504449967, "post_id": 46011445, "comment_id": 79008538, "body": "<a href=\"https://play.golang.org/p/1QwszPd7f7\" rel=\"nofollow noreferrer\">play.golang.org/p/1QwszPd7f7</a>  This updated link should avoid the error saying &quot;File already closed&quot;. I did this by removing <code>defer writer.Close()</code>.  If you want an example with <code>defer writer.Close()</code>, then you can use wait groups to wait for the concurrent functions to finish executing before the file is closed.  Here is an example: <a href=\"https://play.golang.org/p/RzLYEIW6CP\" rel=\"nofollow noreferrer\">play.golang.org/p/RzLYEIW6CP</a>"}], "tags": [], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "is_accepted": true, "score": 0, "last_activity_date": 1504336622, "creation_date": 1504336622, "answer_id": 46011445, "question_id": 46011228, "link": "https://stackoverflow.com/questions/46011228/how-to-output-results-to-csv-of-a-concurrent-web-scraper-in-go/46011445#46011445", "title": "How to output results to CSV of a concurrent web scraper in Go?", "body": "<p>In the code you supplied, you had commented the following code:</p>\n\n<pre><code>// Have been trying to output to CSV here but it's not working\nerr = writer.Write([]string{url, resTitle, res})\ncheckError(\"Cannot write to file\", err)\n</code></pre>\n\n<p>This code is correct, except you have one issue.\nEarlier in the function, you have the following code:</p>\n\n<pre><code>fileWrite, err := os.Create(\"data/result.csv\")\ncheckError(\"Cannot create file\", err)\ndefer fileWrite.Close()\n</code></pre>\n\n<p>This code causes the fileWriter to close once your <code>csvParsing()</code> func exits.\nBecause you've closed fileWriter with the defer, you are unable to write to it in your concurrent function.</p>\n\n<p><strong>Solution:</strong>\nYou'll need to use <code>defer fileWrite.Close()</code> <strong>inside your concurrent func</strong> or something similar so you do not close the fileWriter before you have written to it.</p>\n"}], "owner": {"reputation": 379, "user_id": 3431195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/toLY1.jpg?s=128&g=1", "display_name": "credizian", "link": "https://stackoverflow.com/users/3431195/credizian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 46011445, "answer_count": 1, "score": 1, "last_activity_date": 1504336622, "creation_date": 1504334530, "question_id": 46011228, "link": "https://stackoverflow.com/questions/46011228/how-to-output-results-to-csv-of-a-concurrent-web-scraper-in-go", "title": "How to output results to CSV of a concurrent web scraper in Go?", "body": "<p>I'm new to Go and am trying to take advantage of the concurrency in Go to build a basic scraper to pull extract title, meta description, and meta keywords from URLs.</p>\n\n<p>I am able to print out the results to terminal with the concurrency but can't figure out how to write output to CSV. I've tried many a variations that I could think of with limited knowledge of Go and many end up breaking the concurrency - so losing my mind a bit.</p>\n\n<p>My code and URL input file is below - Thanks in advance for any tips!</p>\n\n<pre><code>// file name: metascraper.go\npackage main\n\nimport (\n    // import standard libraries\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"time\"\n    // import third party libraries\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc csvParsing() {\n    file, err := os.Open(\"data/sample.csv\")\n    checkError(\"Cannot open file \", err)\n\n    if err != nil {\n        // err is printable\n        // elements passed are separated by space automatically\n        fmt.Println(\"Error:\", err)\n        return\n    }\n\n    // automatically call Close() at the end of current method\n    defer file.Close()\n    //\n    reader := csv.NewReader(file)\n    // options are available at:\n    // http://golang.org/src/pkg/encoding/csv/reader.go?s=3213:3671#L94\n    reader.Comma = ';'\n    lineCount := 0\n\n    fileWrite, err := os.Create(\"data/result.csv\")\n    checkError(\"Cannot create file\", err)\n    defer fileWrite.Close()\n\n    writer := csv.NewWriter(fileWrite)\n    defer writer.Flush()\n\n    for {\n        // read just one record\n        record, err := reader.Read()\n        // end-of-file is fitted into err\n        if err == io.EOF {\n            break\n        } else if err != nil {\n            fmt.Println(\"Error:\", err)\n            return\n        }\n\n        go func(url string) {\n            // fmt.Println(msg)\n            doc, err := goquery.NewDocument(url)\n            if err != nil {\n                checkError(\"No URL\", err)\n            }\n\n            metaDescription := make(chan string, 1)\n            pageTitle := make(chan string, 1)\n\n            go func() {\n                // time.Sleep(time.Second * 2)\n                // use CSS selector found with the browser inspector\n                // for each, use index and item\n                pageTitle &lt;- doc.Find(\"title\").Contents().Text()\n\n                doc.Find(\"meta\").Each(func(index int, item *goquery.Selection) {\n                    if item.AttrOr(\"name\", \"\") == \"description\" {\n                        metaDescription &lt;- item.AttrOr(\"content\", \"\")\n                    }\n                })\n            }()\n            select {\n            case res := &lt;-metaDescription:\n                resTitle := &lt;-pageTitle\n                fmt.Println(res)\n                fmt.Println(resTitle)\n\n                // Have been trying to output to CSV here but it's not working\n\n                // writer.Write([]string{url, resTitle, res})\n                // err := writer.WriteString(`res`)\n                // checkError(\"Cannot write to file\", err)\n\n            case &lt;-time.After(time.Second * 2):\n                fmt.Println(\"timeout 2\")\n            }\n\n        }(record[0])\n\n        fmt.Println()\n\n        lineCount++\n    }\n}\n\nfunc main() {\n\n    csvParsing()\n\n    //Code is to make sure there is a pause before program finishes so we can see output\n    var input string\n    fmt.Scanln(&amp;input)\n}\n\nfunc checkError(message string, err error) {\n    if err != nil {\n        log.Fatal(message, err)\n    }\n}\n</code></pre>\n\n<p>The data/sample.csv input file with URLs:</p>\n\n<pre><code>    http://jonathanmh.com\n    http://keshavmalani.com\n    http://google.com\n    http://bing.com\n    http://facebook.com\n</code></pre>\n"}, {"tags": ["go", "slice", "goroutine"], "comments": [{"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1504331587, "post_id": 46010836, "comment_id": 78982152, "body": "How is <code>newSample</code> implemented?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1504332580, "post_id": 46010836, "comment_id": 78982289, "body": "@kennytm check the answer I have explained the answer with an exmple similar to your use case"}, {"owner": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1504333270, "post_id": 46010836, "comment_id": 78982413, "body": "@kennytm newSample reads a string, chops it up, makes type conversions to int, float64... and sends a new struct <code>sample</code> to the channel"}], "answers": [{"comments": [{"owner": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 0, "creation_date": 1504332938, "post_id": 46010941, "comment_id": 78982346, "body": "Thanks. This works for my case. But what if the length of the original slice is huge, will there be a problem in creating a huge buffer?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 0, "creation_date": 1504342227, "post_id": 46010941, "comment_id": 78984325, "body": "You can create channels with upto <code>2147483647</code> buffer size. But I would rather run the consumer  function parallelly with the producers if possible"}, {"owner": {"reputation": 91, "user_id": 493778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454cb795677b8a96b70b24463bb49567?s=128&d=identicon&r=PG", "display_name": "knpercinel", "link": "https://stackoverflow.com/users/493778/knpercinel"}, "edited": false, "score": 0, "creation_date": 1557718932, "post_id": 46010941, "comment_id": 98844920, "body": "Hi, I just tried your last example (the one with collectResult function) in playground, It seems it is failing the collect the double of last element 19.  I am kind of beginner and still trying to understand things, example seems good to my eyes, If you can explain why it is failing ( or not failing ) , that would be great. Thanks !"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 91, "user_id": 493778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454cb795677b8a96b70b24463bb49567?s=128&d=identicon&r=PG", "display_name": "knpercinel", "link": "https://stackoverflow.com/users/493778/knpercinel"}, "edited": false, "score": 1, "creation_date": 1557754658, "post_id": 46010941, "comment_id": 98860635, "body": "@knpercinel thanks for noticing It was because the main was not waiting for <code>collectResult</code> to process everything"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": false, "score": 4, "last_activity_date": 1581451175, "last_edit_date": 1581451175, "creation_date": 1504332011, "answer_id": 46010941, "question_id": 46010836, "link": "https://stackoverflow.com/questions/46010836/using-goroutines-to-process-values-and-gather-results-into-a-slice/46010941#46010941", "title": "Using goroutines to process values and gather results into a slice", "body": "<p>There are two problems </p>\n\n<ol>\n<li><strong>Using unbuffered channels</strong>: Unbuffered channels block receivers until data is available on the channel and senders until a receiver is available.That caused the error</li>\n<li><strong>Not closing the channel before range</strong>: As you never close the ch channel, the range loop will never finish.</li>\n</ol>\n\n<p>You have to use a <code>buffered</code> channel and <code>close</code> the channel before range </p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc double(line int, ch chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    ch &lt;- line * 2\n\n}\n\nfunc main() {\n    contents := []int{1, 2, 3, 4, 5}\n    sampleChan := make(chan int,len(contents))\n    var wg sync.WaitGroup\n    // Read from contents list\n    for _, line := range contents {\n        wg.Add(1)\n        go double(line, sampleChan, &amp;wg)\n    }\n    wg.Wait()\n    close(sampleChan)\n    // Read from sampleChan and put into a slice\n    var sampleList []int\n\n    for s := range sampleChan {\n        sampleList = append(sampleList, s)\n    }\n\n    fmt.Println(sampleList)\n}\n</code></pre>\n\n<p>Play link : <a href=\"https://play.golang.org/p/k03vt3hd3P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/k03vt3hd3P</a></p>\n\n<p><strong>EDIT</strong>: \nAnother approach for better performance would be to run <code>producer</code> and <code>consumer</code> at  concurrently</p>\n\n<p><strong>Modified code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc doubleLines(lines []int, wg *sync.WaitGroup, sampleChan chan int) {\n    defer wg.Done()\n\n    defer close(sampleChan)\n    var w sync.WaitGroup\n    for _, line := range lines {\n        w.Add(1)\n        go double(&amp;w, line, sampleChan)\n    }\n    w.Wait()\n}\n\nfunc double(wg *sync.WaitGroup, line int, ch chan int) {\n    defer wg.Done()\n    ch &lt;- line * 2\n}\n\nfunc collectResult(wg *sync.WaitGroup, channel chan int, sampleList *[]int) {\n    defer wg.Done()\n    for s := range channel {\n        *sampleList = append(*sampleList, s)\n    }\n\n}\n\nfunc main() {\n    contents := []int{0,1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n    sampleChan := make(chan int, 1)\n    var sampleList []int\n\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go doubleLines(contents, &amp;wg, sampleChan)\n    wg.Add(1)\n    go collectResult(&amp;wg, sampleChan, &amp;sampleList)\n    wg.Wait()\n    fmt.Println(sampleList)\n}\n</code></pre>\n\n<p>play link: <a href=\"https://play.golang.org/p/VAe7Qll3iVM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VAe7Qll3iVM</a></p>\n"}, {"comments": [{"owner": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 0, "creation_date": 1504334972, "post_id": 46011183, "comment_id": 78982761, "body": "Thanks. So the deadlock happens because the <code>Wait()</code> was not asynchronous, and not because the channel was unbuffered? I&#39;m just trying to wrap my head around this so that I can make use of concurrency better"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 0, "creation_date": 1504335176, "post_id": 46011183, "comment_id": 78982800, "body": "Making the channel large enough also works, although it uses extra storage for the channel."}, {"owner": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 0, "creation_date": 1504335331, "post_id": 46011183, "comment_id": 78982819, "body": "Also just to clarify, how does <code>for s := range sampleChan</code> still work even when after <code>Wait()</code> is triggered? I though that closing an unbuffered channel will flush its contents with it. Thanks for the help"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "edited": false, "score": 1, "creation_date": 1504336314, "post_id": 46011183, "comment_id": 78983024, "body": "<code>close()</code> is like a special sort of write to the channel -- it doesn&#39;t flush the contents."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504369091, "post_id": 46011183, "comment_id": 78991407, "body": "@PaulHankin I didn&#39;t know that about <code>close</code>ing a channel. Thanks for the tidbit!"}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 10, "last_activity_date": 1504334659, "last_edit_date": 1504334659, "creation_date": 1504334199, "answer_id": 46011183, "question_id": 46010836, "link": "https://stackoverflow.com/questions/46010836/using-goroutines-to-process-values-and-gather-results-into-a-slice/46011183#46011183", "title": "Using goroutines to process values and gather results into a slice", "body": "<p>Your code is almost correct. There's a couple of problems: first, you're waiting for all the workers to finish before collecting the results, and second your <code>for</code> loop terminates when the channel is closed, but the channel is closed only after the <code>for</code> loop terminates.</p>\n\n<p>You can fix the code by asynchronously closing the channel when the workers are finished:</p>\n\n<pre><code>for i, line := range contents {\n    wg.Add(1)\n    // Process each item with a goroutine and send output to sampleChan\n    go newSample(line, *replicatePtr, *timePtr, sampleChan, &amp;wg)\n}\n\ngo func() {\n    wg.Wait()\n    close(sampleChan)\n}()\n\nfor s := range sampleChan {\n  ..\n}\n</code></pre>\n\n<p>As a note of style (and following <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#synchronous-functions\" rel=\"noreferrer\">https://github.com/golang/go/wiki/CodeReviewComments#synchronous-functions</a>), it'd be preferable if <code>newSample</code> was a simple, synchronous function that didn't take the waitgroup and channel, and simply generated its result. Then the worker code would look like:</p>\n\n<pre><code>for i, line := range contents {\n    wg.Add(1)\n    go func(line string) {\n        defer wg.Done()\n        sampleChan &lt;- newSample(line, *replicatePtr, *timePtr)\n    }(line)\n}\n</code></pre>\n\n<p>This keeps your concurrency primitives all together, which apart from simplifiying <code>newSample</code> and making it easier to test, it allows you to see what's going on with the concurrency, and visually check that <code>wg.Done()</code> is always called. And if you want to refactor the code to for example use a fixed number of workers, then your changes will all be local.</p>\n"}], "owner": {"reputation": 1643, "user_id": 434165, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e9b02731158194defd855684bfd313ac?s=128&d=identicon&r=PG", "display_name": "kentwait", "link": "https://stackoverflow.com/users/434165/kentwait"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4987, "favorite_count": 3, "accepted_answer_id": 46011183, "answer_count": 2, "score": 11, "last_activity_date": 1581451175, "creation_date": 1504330901, "question_id": 46010836, "link": "https://stackoverflow.com/questions/46010836/using-goroutines-to-process-values-and-gather-results-into-a-slice", "title": "Using goroutines to process values and gather results into a slice", "body": "<p>I'm recently exploring Go and how goroutines work confuse me.</p>\n\n<p>I tried to port code I had written before into Go using goroutines but got a <code>fatal error: all goroutines are asleep - deadlock!</code> error.</p>\n\n<p>What I'm trying to do is use goroutines to process items in a list, then gather the processed values into a new list. But I'm having problems in the \"gathering\" part.</p>\n\n<p>Code:</p>\n\n<pre><code>sampleChan := make(chan sample)\nvar wg sync.WaitGroup\n\n// Read from contents list\nfor i, line := range contents {\n    wg.Add(1)\n    // Process each item with a goroutine and send output to sampleChan\n    go newSample(line, *replicatePtr, *timePtr, sampleChan, &amp;wg)\n}\nwg.Wait()\n\n// Read from sampleChan and put into a slice\nvar sampleList []sample\nfor s := range sampleChan {\n    sampleList = append(sampleList, s)\n}\nclose(sampleChan)\n</code></pre>\n\n<p>What's the right way to gather results from goroutines?</p>\n\n<p>I know slices are not threadsafe so I can't have each goroutine just append to the slice.</p>\n"}, {"tags": ["go", "kubernetes", "go-templates", "kubernetes-helm"], "comments": [{"owner": {"reputation": 8220, "user_id": 1300730, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aaec0d2b2c153cde962c22ae39583f43?s=128&d=identicon&r=PG", "display_name": "Eldad Assis", "link": "https://stackoverflow.com/users/1300730/eldad-assis"}, "edited": false, "score": 0, "creation_date": 1504521013, "post_id": 46009933, "comment_id": 79030213, "body": "Did you manage to solve this?"}, {"owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "reply_to_user": {"reputation": 8220, "user_id": 1300730, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aaec0d2b2c153cde962c22ae39583f43?s=128&d=identicon&r=PG", "display_name": "Eldad Assis", "link": "https://stackoverflow.com/users/1300730/eldad-assis"}, "edited": false, "score": 0, "creation_date": 1504553048, "post_id": 46009933, "comment_id": 79046261, "body": "Can u help me to do type casting ?"}], "answers": [{"comments": [{"owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "edited": false, "score": 1, "creation_date": 1504553009, "post_id": 46033012, "comment_id": 79046248, "body": "I am trying with type casting option . it is not working. it is throwing error.{{- if gt !!int {{ .Values.replicaCount }} 1}}. how to type cast ?"}, {"owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "reply_to_user": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "edited": false, "score": 1, "creation_date": 1593982315, "post_id": 46033012, "comment_id": 110960234, "body": "You can also try typecasting not by yaml but by Go templates: <code>containerPort: {{ .Values.replicaCount | int }}</code>"}, {"owner": {"reputation": 658, "user_id": 2835142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911589891d48285f40a42e9ba77d4df7?s=128&d=identicon&r=PG&f=1", "display_name": "Pasha", "link": "https://stackoverflow.com/users/2835142/pasha"}, "edited": false, "score": 1, "creation_date": 1616427623, "post_id": 46033012, "comment_id": 117992662, "body": "What is the &quot;-&quot; is {{- if .Values.enable}} .. .. {{- end }} referred as?"}, {"owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "reply_to_user": {"reputation": 658, "user_id": 2835142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/911589891d48285f40a42e9ba77d4df7?s=128&d=identicon&r=PG&f=1", "display_name": "Pasha", "link": "https://stackoverflow.com/users/2835142/pasha"}, "edited": false, "score": 0, "creation_date": 1616528011, "post_id": 46033012, "comment_id": 118029709, "body": "@Pasha it is about controlling whitespace. Please see: <a href=\"https://helm.sh/docs/chart_template_guide/control_structures/#controlling-whitespace\" rel=\"nofollow noreferrer\">helm.sh/docs/chart_template_guide/control_structures/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "is_accepted": true, "score": 19, "last_activity_date": 1504513459, "creation_date": 1504513459, "answer_id": 46033012, "question_id": 46009933, "link": "https://stackoverflow.com/questions/46009933/kubernetes-helm-chart-if-condition-check/46033012#46033012", "title": "Kubernetes Helm Chart If Condition Check", "body": "<p>Try using float number in comparison instead:</p>\n\n<p><strong>deployment.yaml</strong></p>\n\n<pre><code>rollingUpdate:\n  maxSurge: 1\n  {{ if gt .Values.replicaCount 2.0}}\n  maxUnavailable: 0\n  {{ else }}\n  maxUnavailable: 1\n  {{ end }}\n</code></pre>\n\n<p>Helm (along with underlying Golang templates and Yaml) can be weird sometimes. </p>\n\n<hr>\n\n<p>Also, note that sometimes you need to typecast values in your yaml configs (e.g. port numbers).</p>\n\n<p>Example:</p>\n\n<pre><code>...\nports:\n- containerPort: !!int {{ .Values.containers.app.port }}\n...\n</code></pre>\n\n<p>More about Yaml type casting: <a href=\"https://github.com/yaml/YAML2/wiki/Type-casting\" rel=\"noreferrer\">https://github.com/yaml/YAML2/wiki/Type-casting</a></p>\n"}], "owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34514, "favorite_count": 3, "accepted_answer_id": 46033012, "answer_count": 1, "score": 8, "last_activity_date": 1504513459, "creation_date": 1504319294, "last_edit_date": 1504393801, "question_id": 46009933, "link": "https://stackoverflow.com/questions/46009933/kubernetes-helm-chart-if-condition-check", "title": "Kubernetes Helm Chart If Condition Check", "body": "<p>I am trying to add if great than condition in Helm chart. it is throwing error.</p>\n\n<p>I have defined value in values.yaml and using that value in deployment.yaml for condition.</p>\n\n<p><strong>values.yaml</strong></p>\n\n<pre><code>replicaCount: 2\n</code></pre>\n\n<p><strong>deployment.yaml</strong></p>\n\n<pre><code>rollingUpdate:\n  maxSurge: 1\n  {{ if gt .Values.replicaCount 2}}\n  maxUnavailable: 0\n  {{ else }}\n  maxUnavailable: 1\n  {{ end }}\n</code></pre>\n\n<p>I am using helm dry run option to check result. getting error</p>\n\n<pre><code>Error: render error in \"hello-world/templates/deployment.yaml\": template: hello-world/templates/deployment.yaml:16:12: executing \"hello-world/templates/deployment.yaml\" at &lt;gt .Values.replicaCo...&gt;: error calling gt: incompatible types for comparison\n</code></pre>\n\n<p>how to fix this ?</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api"], "comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 1, "creation_date": 1504375527, "post_id": 46009460, "comment_id": 78993263, "body": "You may want to check <a href=\"https://github.com/Shopify/sarama\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama</a> which is a popular library for kafka - it does allow you to specify the specific offset you wish to read from, or accept &#39;Oldest&#39; as the start point, or &#39;Newest&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "edited": false, "score": 0, "creation_date": 1504388250, "post_id": 46010070, "comment_id": 78996650, "body": "Thank you for your answer, now I have a better understanding of how Kafka works. I just realized that I have to set enable.auto.commit to false to make it work. Using my previous example, for my dog group, I perform a commit on owner_commands[0]@0 and when I disconnect my consumer and reconnect it, all the messages from [0]@0 to the most recent ones are replayed!!!   However, I want to know more about the command to move the position of consumer group. Why is it outside of the API? How can I get access to that?"}, {"owner": {"reputation": 2077, "user_id": 2796894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NTxyT.jpg?s=128&g=1", "display_name": "dawsaw", "link": "https://stackoverflow.com/users/2796894/dawsaw"}, "reply_to_user": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "edited": false, "score": 1, "creation_date": 1504393567, "post_id": 46010070, "comment_id": 78997732, "body": "The kafka-consumer-groups command is executed by a shell script and comes with the Kafka package. You can find it in the bin directory. It&#39;s more like a broker side operation so it&#39;s not in the API. It actually uses the Java consumer API to do its thing under the covers."}, {"owner": {"reputation": 341, "user_id": 1866924, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b3d548952ddcebbe9b4c722d75ca5d1c?s=128&d=identicon&r=PG", "display_name": "user1866924", "link": "https://stackoverflow.com/users/1866924/user1866924"}, "edited": false, "score": 0, "creation_date": 1571948848, "post_id": 46010070, "comment_id": 103418307, "body": "Is there a way to do the equivalent of the kafka-consumer-groups command using the api? I&#39;m working on a kafka library that multiple clients will be calling, and we&#39;d like them to be able to reset their offsets to the earliest for a particular topic and group."}, {"owner": {"reputation": 2077, "user_id": 2796894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NTxyT.jpg?s=128&g=1", "display_name": "dawsaw", "link": "https://stackoverflow.com/users/2796894/dawsaw"}, "edited": false, "score": 0, "creation_date": 1572488591, "post_id": 46010070, "comment_id": 103578921, "body": "Yeah you can hit the Kafka Admin API on the broker to do this if you need to do it from outside the consumer."}], "tags": [], "owner": {"reputation": 2077, "user_id": 2796894, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NTxyT.jpg?s=128&g=1", "display_name": "dawsaw", "link": "https://stackoverflow.com/users/2796894/dawsaw"}, "is_accepted": true, "score": 1, "last_activity_date": 1504336471, "last_edit_date": 1504336471, "creation_date": 1504321473, "answer_id": 46010070, "question_id": 46009460, "link": "https://stackoverflow.com/questions/46009460/how-to-rewind-and-look-at-previous-offset-in-a-partition-using-kafka-go-clients/46010070#46010070", "title": "How to rewind and look at previous offset in a partition using Kafka Go client&#39;s Consumer", "body": "<p>You could use CommitOffsets and just commit back to the offset you want to rewind to. The next poll will start from that offset. </p>\n\n<p>CommitOffsets is documented here:\n<a href=\"http://docs.confluent.io/current/clients/confluent-kafka-go/index.html#Consumer.CommitOffsets\" rel=\"nofollow noreferrer\">http://docs.confluent.io/current/clients/confluent-kafka-go/index.html#Consumer.CommitOffsets</a></p>\n\n<p>Outside of the API, there's functionality in the kafka-consumer-groups command to move the position of consumer groups as well. This is released with Apache Kafka 0.11.</p>\n"}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2661, "favorite_count": 0, "accepted_answer_id": 46010070, "answer_count": 1, "score": 4, "last_activity_date": 1504336471, "creation_date": 1504312671, "last_edit_date": 1504319841, "question_id": 46009460, "link": "https://stackoverflow.com/questions/46009460/how-to-rewind-and-look-at-previous-offset-in-a-partition-using-kafka-go-clients", "title": "How to rewind and look at previous offset in a partition using Kafka Go client&#39;s Consumer", "body": "<p>I am new to Kafka. Currently I am experimenting with this <a href=\"https://github.com/confluentinc/confluent-kafka-go/tree/9f5af4225f71044489783d9726429e8d911304f0/examples/consumer_channel_example\" rel=\"nofollow noreferrer\">Channel Consumer example</a> from Confluent Inc's Github repo</p>\n\n<p>From what I know, consumers are separated into groups. Each group has their own offset in the partition. Let's say I have 40 messages in a particular topic let's call it, owner_commands. A consumer, belongs to the dog group, joins and begins to consume those 40 messages. </p>\n\n<p>When I disconnected and reconnected this consumer, I noticed that messages don't show up anymore. It says that I have reached the end of file. However, if I join the cluster with another consumer, which belongs to a different group (say cat) I get to read those 40 messages again. </p>\n\n<p>Do you know if there is a way for consumers in the dog group to rewind and replay those messages again using Kafka's Go API. I looked at the source code for Kafka Golang API, I couldn't find anything that indicates to me that I can rewind and look at a particular message in the past. </p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "installation"], "answers": [{"tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": true, "score": 29, "last_activity_date": 1511793984, "last_edit_date": 1511793984, "creation_date": 1504310266, "answer_id": 46009259, "question_id": 46009258, "link": "https://stackoverflow.com/questions/46009258/go-build-fails-runtime-mstkbar-go15110-debug-gcstackbarrieroff-undefined/46009259#46009259", "title": "go build fails : runtime/mstkbar.go:151:10: debug.gcstackbarrieroff undefined", "body": "<p>SOLUTION : you must first delete previous golang install prior to installing new go version</p>\n\n<pre><code>type go    # issue this to confirm where your go lives\n</code></pre>\n\n<p>a typical output : </p>\n\n<pre><code>go is /usr/local/go/bin/go  # delete /usr/local/go not just /usr/local/go/bin/go\n</code></pre>\n\n<p>so just remove it</p>\n\n<pre><code>sudo rm -rf /usr/local/go  #  OP's missing step else above errors\n</code></pre>\n\n<p>before you install new version</p>\n\n<pre><code>export golang_ver=$(curl https://golang.org/VERSION?m=text 2&gt; /dev/null)\nwget https://storage.googleapis.com/golang/${golang_ver}.linux-amd64.tar.gz\nsudo tar -C /usr/local -xzf ${golang_ver}.linux-amd64.tar.gz\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "is_accepted": false, "score": 2, "last_activity_date": 1513445388, "creation_date": 1513445388, "answer_id": 47848270, "question_id": 46009258, "link": "https://stackoverflow.com/questions/46009258/go-build-fails-runtime-mstkbar-go15110-debug-gcstackbarrieroff-undefined/47848270#47848270", "title": "go build fails : runtime/mstkbar.go:151:10: debug.gcstackbarrieroff undefined", "body": "<p>I use Windows10. I have to uninstall go18 with Control Panel (do not trust 1.9 installer when he asks to uninstall prev version - do it by hands). After that I remove c:\\go - the default goroot and only after this - install 1.9. In my case it was 1.9.2\nAnd of course check your GOROOT &amp;&amp; GOPATH</p>\n"}], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3587, "favorite_count": 2, "accepted_answer_id": 46009259, "answer_count": 2, "score": 13, "last_activity_date": 1513445388, "creation_date": 1504310266, "last_edit_date": 1505913604, "question_id": 46009258, "link": "https://stackoverflow.com/questions/46009258/go-build-fails-runtime-mstkbar-go15110-debug-gcstackbarrieroff-undefined", "title": "go build fails : runtime/mstkbar.go:151:10: debug.gcstackbarrieroff undefined", "body": "<p>This code compiled OK using prior release of golang (1.8.3) however fails to compile after upgrading to new golang (1.9)</p>\n\n<pre><code>~/src/gopath/src/github.com/scottstensland/infosynth $ go build infosynth.go\n# runtime\n/usr/local/go/src/runtime/mstkbar.go:151:10: debug.gcstackbarrieroff undefined (type struct { allocfreetrace int32; cgocheck int32; efence int32; gccheckmark int32; gcpacertrace int32; gcshrinkstackoff int32; gcrescanstacks int32; gcstoptheworld int32; gctrace int32; invalidptr int32; sbrk int32; scavenge int32; scheddetail int32; schedtrace int32 } has no field or method gcstackbarrieroff)\n/usr/local/go/src/runtime/mstkbar.go:162:24: division by zero\n/usr/local/go/src/runtime/mstkbar.go:162:43: invalid expression unsafe.Sizeof(composite literal)\n/usr/local/go/src/runtime/mstkbar.go:162:44: undefined: stkbar\n/usr/local/go/src/runtime/mstkbar.go:212:4: gp.stkbar undefined (type *g has no field or method stkbar)\n/usr/local/go/src/runtime/mstkbar.go:213:15: gp.stkbar undefined (type *g has no field or method stkbar)\n/usr/local/go/src/runtime/mstkbar.go:216:23: undefined: stackBarrierPC\n/usr/local/go/src/runtime/mstkbar.go:226:28: gp.stkbarPos undefined (type *g has no field or method stkbarPos)\n/usr/local/go/src/runtime/mstkbar.go:227:19: gp.stkbarPos undefined (type *g has no field or method stkbarPos)\n/usr/local/go/src/runtime/mstkbar.go:248:41: undefined: stkbar\n/usr/local/go/src/runtime/mstkbar.go:227:19: too many errors\n</code></pre>\n\n<p>Any ideas ?  Actually, this error happens for any golang version upgrade not just the versions I mentioned here.</p>\n\n<p><strong>PS</strong> Also get same errors when issuing :  go get -v -t ./...</p>\n"}, {"tags": ["go", "viper-go"], "answers": [{"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504383043, "post_id": 46010194, "comment_id": 78995288, "body": "If username and passowrd for host 1 are not defined in the config file, does <code>AllSettings</code> return the value of environment variables <code>HOST1_USERNAME</code> and <code>HOST1_PASSWORD</code>? I&#39;m asking because it seems it doesn&#39;t work - see the update in my original question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504386257, "post_id": 46010194, "comment_id": 78996161, "body": "@j3d <code>viper.AutomaticEnv</code> only works for defined keys. If they&#39;re not defined, no environment variable will be magically bound to a nonexistent key. Sadly, <code>viper.AllKeys()</code> and <code>viper.AllSettings()</code> doesn&#39;t return a <code>host1</code> key, though you can still use <code>viper.Get(&quot;host1&quot;)</code> to retrieve an empty/nil <code>map[string]interface{}</code> rather than an untyped <code>nil</code>, though it won&#39;t do you any good (what about an empty <code>host238471</code> TOML table as the only host?) If you know about a particular setting, you can set a default for it and the environment variables will work. Otherwise, you&#39;re out of luck."}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504386792, "post_id": 46010194, "comment_id": 78996309, "body": "OK, I&#39;ve just set <code>HOST1_USERNAME</code> and <code>HOST1_PASSWORD</code> to an empty string in my config file and now it works. Many thanks Kitsune for your support :-)"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": true, "score": 1, "last_activity_date": 1504322994, "creation_date": 1504322994, "answer_id": 46010194, "question_id": 46008299, "link": "https://stackoverflow.com/questions/46008299/how-to-bind-config-items-in-an-array-to-environment-variables/46010194#46010194", "title": "How to bind config items in an array to environment variables", "body": "<p>From <a href=\"https://godoc.org/github.com/spf13/viper#Viper\" rel=\"nofollow noreferrer\"><code>viper.Viper</code></a>:</p>\n\n<blockquote>\n  <p>The priority of the sources is the following:</p>\n  \n  <ol>\n  <li>overrides</li>\n  <li>flags</li>\n  <li>env. variables</li>\n  <li>config file</li>\n  <li>key/value store</li>\n  <li>defaults</li>\n  </ol>\n</blockquote>\n\n<p>You might encounter a problem in determining the name of the environment variable. You essentially need a way to bind <code>hosts[0].Username</code> to the environment variable <code>HOST1_USERNAME</code>. However, there's no way to do this in viper currently. In fact, <code>viper.Get(\"hosts[0].username\")</code> returns <code>nil</code>, meaning array indices apparently cannot be used with <code>viper.BindEnv</code>. You also would need to use this function for as many hosts as can be defined, meaning if you have 20 hosts listed, you'd need to call <code>viper.BindEnv</code> 40 or 60 times, depending on whether the name of a host could be overridden by an environment variable. To work around this limitation, you'd need to dynamically work with hosts as independent tables rather than an array of tables:</p>\n\n<pre><code>[host1]\nusername = \"user1\"\npassword = \"password1\"\n\n[host2]\nusername = \"user2\"\npassword = \"password2\"\n</code></pre>\n\n<p>You can then use <a href=\"https://godoc.org/github.com/spf13/viper#SetEnvKeyReplacer\" rel=\"nofollow noreferrer\"><code>viper.SetEnvKeyReplacer</code></a> with a <code>strings.Replacer</code> to handle the environment variable issue:</p>\n\n<pre><code>// host1.username =&gt; HOST1_USERNAME\n// host2.password =&gt; HOST2_PASSWORD\n// etc.\nviper.SetEnvKeyReplacer(strings.NewReplacer(\".\", \"_\"))\n</code></pre>\n\n<p>Note that at the time of this writing <a href=\"https://github.com/spf13/viper/issues/309\" rel=\"nofollow noreferrer\">some bugs exist when it comes to the resolution order</a>. This issue affects <code>viper.Unmarshal</code> and <code>viper.Get</code>: environment variables should override config file values, but currently the config file values are still used. Strangely, <code>viper.AllSettings</code> works fine. If it didn't, you couldn't do something like the following to work with the hosts in the above format:</p>\n\n<pre><code>// Manually collect hosts for storing in config.\nfunc collectHosts() []Host {\n    hosts := make([]Host, 0, 10)\n    for key, value := range viper.AllSettings() {\n        // viper.GetStringMapString(key)\n        // won't work properly with environment vars, etc. until\n        //   https://github.com/spf13/viper/issues/309\n        // is resolved.\n        v := value.(map[string]interface{})\n        hosts = append(hosts, Host{\n            Name:     key,\n            Username: v[\"username\"].(string),\n            Password: v[\"password\"].(string),\n        })\n    }\n    return hosts\n}\n</code></pre>\n\n<p>To sum things up:</p>\n\n<ol>\n<li>Values are supposed to be taken from the first provided of: overrides, flags, environment variables, config files, key/value stores, defaults. Unfortunately, this isn't always the order followed (because bugs).</li>\n<li>You need to change your config format and use a string replacer to leverage the convenience of <a href=\"https://godoc.org/github.com/spf13/viper#AutomaticEnv\" rel=\"nofollow noreferrer\"><code>viper.AutomaticEnv</code></a>.</li>\n</ol>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5862, "favorite_count": 0, "accepted_answer_id": 46010194, "answer_count": 1, "score": 1, "last_activity_date": 1569960459, "creation_date": 1504302142, "last_edit_date": 1569960459, "question_id": 46008299, "link": "https://stackoverflow.com/questions/46008299/how-to-bind-config-items-in-an-array-to-environment-variables", "title": "How to bind config items in an array to environment variables", "body": "<p>Here below is my configuration file in toml format.</p>\n\n<pre><code>[[hosts]]\nname = \"host1\"\nusername = \"user1\"\npassword = \"password1\"\n\n[[hosts]]\nname = \"host2\"\nusername = \"user2\"\npassword = \"password2\"\n</code></pre>\n\n<p>... and here is my code to load it:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/spf13/viper\"\n    \"strings\"\n)\n\ntype Config struct {\n    Hosts []Host\n}\n\ntype Host struct {\n    Name      string `mapstructure:\"name\"`\n    Username  string `mapstructure:\"username\"`\n    Password  string `mapstructure:\"password\"`\n}\n\nfunc main() {\n    viper.AddConfigPath(\".\")\n    viper.AddConfigPath(\"./config\")\n    viper.SetConfigName(\"app\")\n\n    if err := viper.ReadInConfig(); err != nil {\n        return nil, fmt.Errorf(\"error reading config file, %v\", err)\n    }\n\n    config := new(Config)\n    if err := viper.Unmarshal(config); err != nil {\n        return nil, fmt.Errorf(\"error parsing config file, %v\", err)\n    }\n\n    var username, password string\n\n    for i, h := range config.Hosts {\n        if len(h.Name) == 0 {\n            return nil, fmt.Errorf(\"name not defined for host %d\", i)\n        }\n\n        if username = os.Getenv(strings.ToUpper(h.Name) + \"_\" + \"USERNAME\"); len(username) &gt; 0 {\n            config.Hosts[i].Username = username\n        } else if len(h.Username) == 0 {\n            return nil, fmt.Errorf(\"username not defined for %s\", e.Name)\n        }\n\n        if password = os.Getenv(strings.ToUpper(e.Name) + \"_\" + \"PASSWORD\"); len(password) &gt; 0 {\n            config.Hosts[i].Password = password\n        } else if len(h.Password) == 0 {\n            return nil, fmt.Errorf(\"password not defined for %s\", e.Name)\n        }\n\n        fmt.Printf(\"Hostname: %s\", h.name)\n        fmt.Printf(\"Username: %s\", h.Username)\n        fmt.Printf(\"Password: %s\", h.Password)\n    }\n}\n</code></pre>\n\n<p>For instance, I first check whether environment variables <code>HOST1_USERNAME1</code>, <code>HOST1_PASSWORD1</code>, <code>HOST2_USERNAME2</code>, and <code>HOST2_PASSWORD2</code> exist... if they do, then I set the configuration items to their values, otherwise I try to get the values from the configuration file.</p>\n\n<p>I know viper offers method <code>AutomaticEnv</code> to do something similar... but does it work with a collection like mine (<code>AutomaticEnv</code> shall be invoked <strong>after</strong> environment variable binding)?</p>\n\n<p>Given my code above, is it possible to use the mechanism provided by viper and remove <code>os.GetEnv</code>?</p>\n\n<p>Thanks.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Here below is my updated code. In I've defined environment variables <code>HOST1_USERNAME</code> and <code>HOST1_PASSWORD</code> and set the corresponding settings in my config file to an empty string.</p>\n\n<p>Here is my new config file:</p>\n\n<pre><code>[host1]\nusername = \"\"\npassword = \"\"\n\n[host2]\nusername = \"user2\"\npassword = \"password2\"\n</code></pre>\n\n<p>And here is my code:</p>\n\n<pre><code>package config\n\nimport (\n    \"fmt\"\n    \"github.com/spf13/viper\"\n    \"strings\"\n    \"sync\"\n)\n\ntype Config struct {\n    Hosts []Host\n}\n\ntype Host struct {\n    Name     string\n    Username string\n    Password string\n}\n\nvar config *Config\n\nfunc (c *Config) Load() (*Config, error) {\n    if config == nil {\n        viper.AddConfigPath(\".\")\n        viper.AddConfigPath(\"./config\")\n        viper.SetConfigName(\"myapp\")\n        viper.AutomaticEnv()\n        viper.SetEnvKeyReplacer(strings.NewReplacer(\".\", \"_\"))\n\n        if err := viper.ReadInConfig(); err != nil {\n            return nil, fmt.Errorf(\"error reading config file, %v\", err)\n        }\n\n        allSettings := viper.AllSettings()\n        hosts := make([]Host, 0, len(allSettings))\n\n        for key, value := range allSettings {\n            val := value.(map[string]interface{})\n\n            if val[\"username\"] == nil {\n                return nil, fmt.Errorf(\"username not defined for host %s\", key)\n            }\n\n            if val[\"password\"] == nil {\n                return nil, fmt.Errorf(\"password not defined for host %s\", key)\n            }\n\n            hosts = append(hosts, Host{\n                Name:      key,\n                Unsername: val[\"username\"].(string),\n                Password: val[\"password\"].(string),\n            })\n        }\n\n        config = &amp;Config{hosts}\n    }\n\n    return config, nil\n}\n</code></pre>\n\n<p>I works now (thanks to Chrono Kitsune) and I hope it helps,\nj3d</p>\n"}, {"tags": ["go", "vim", "tagbar"], "comments": [{"owner": {"reputation": 845, "user_id": 102250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb2e388665fb3efe70f1ba489511e068?s=128&d=identicon&r=PG", "display_name": "Jan Larres", "link": "https://stackoverflow.com/users/102250/jan-larres"}, "edited": false, "score": 0, "creation_date": 1504422842, "post_id": 46007913, "comment_id": 79001666, "body": "Please run gotags manually in a terminal to check whether its output is correct (the gotags documentation should explain how to do that). If the output is incorrect you should create an issue for that project. If the output is correct, but Tagbar&#39;s behaviour is incorrect, then please create an issue in Tagbar&#39;s issue tracker and provide debug logs as explained in <code>:h tagbar-issues</code>."}, {"owner": {"reputation": 845, "user_id": 102250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb2e388665fb3efe70f1ba489511e068?s=128&d=identicon&r=PG", "display_name": "Jan Larres", "link": "https://stackoverflow.com/users/102250/jan-larres"}, "edited": false, "score": 0, "creation_date": 1504422969, "post_id": 46007913, "comment_id": 79001681, "body": "Oh, looks like you&#39;ve just done that, so ignore this comment."}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 440, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506181323, "creation_date": 1504299719, "last_edit_date": 1506181323, "question_id": 46007913, "link": "https://stackoverflow.com/questions/46007913/golang-in-vim-tagbar-plugin-shows-incorrect-places", "title": "Golang in Vim - Tagbar plugin shows incorrect places", "body": "<p>I've installed <strong>vim-go</strong> with all needed binaries, added <strong>tagbar</strong> plugin from <code>https://github.com/majutsushi/tagbar</code>, <strong>gotags</strong> and <strong>ctags</strong> binaries exist in may $PATH.</p>\n\n<p>The problem is that some functions/variables redirect me to the absolutely wrong line (same for multiple tagbar's functions), and some of them works properly. I can't open even <strong>main()</strong> function in a current project. And I don't see the differences in <strong>tagbar</strong>/code among these functions/objects.</p>\n\n<p>This is also added to the <code>.vimrc</code>:</p>\n\n<pre><code>let g:tagbar_type_go = {  \n    \\ 'ctagstype' : 'go',\n    \\ 'kinds'     : [\n        \\ 'p:package',\n        \\ 'i:imports:1',\n        \\ 'c:constants',\n        \\ 'v:variables',\n        \\ 't:types',\n        \\ 'n:interfaces',\n        \\ 'w:fields',\n        \\ 'e:embedded',\n        \\ 'm:methods',\n        \\ 'r:constructor',\n        \\ 'f:functions'\n    \\ ],\n    \\ 'sro' : '.',\n    \\ 'kind2scope' : {\n        \\ 't' : 'ctype',\n        \\ 'n' : 'ntype'\n    \\ },\n    \\ 'scope2kind' : {\n        \\ 'ctype' : 't',\n        \\ 'ntype' : 'n'\n    \\ },\n    \\ 'ctagsbin'  : 'gotags',\n    \\ 'ctagsargs' : '-sort -silent'\n\\ }\n</code></pre>\n\n<p>Please help to make <strong>tagbar</strong> work properly, what am I missing?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1504299854, "post_id": 46007877, "comment_id": 78976882, "body": "Isn&#39;t unmarshal slow for huge xml files? I choose the decode function because it is faster"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1504299899, "post_id": 46007877, "comment_id": 78976902, "body": "Nope. The only way <code>Decode</code> is any faster than <code>Unmarshal</code> is when you can use <code>Decode</code> to stream data rather than loading all of it into memory at once. Since you already have all of it in memory, there is no advantage to be had."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1504300129, "post_id": 46007877, "comment_id": 78976965, "body": "In fact, if you <a href=\"https://golang.org/src/encoding/xml/read.go?s=5406:5454#L116\" rel=\"nofollow noreferrer\">look at the implementation of <code>Unmarshal</code></a>, all it does is wrap the input in a <code>bytes.Reader</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1504299504, "creation_date": 1504299504, "answer_id": 46007877, "question_id": 46007827, "link": "https://stackoverflow.com/questions/46007827/create-a-xml-decoder-from-a-string-or-byte-array-go/46007877#46007877", "title": "Create a XML Decoder from a string or byte array GO", "body": "<p><a href=\"https://golang.org/pkg/strings/#NewReader\" rel=\"nofollow noreferrer\">Yes there is</a>:</p>\n\n<pre><code>r := strings.NewReader(dataStr)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"nofollow noreferrer\">And likewise for byte arrays</a>:</p>\n\n<pre><code>r := bytes.NewReader(dataBytes)\n</code></pre>\n\n<p>Or, using bytes, you can skip the <code>Reader</code> and <code>NewDecoder</code> entirely and just use <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\"><code>Unmarshal</code></a> directly:</p>\n\n<pre><code>err := xml.Unmarshal(dataBytes, &amp;myobj)\n</code></pre>\n\n<p>Or with a <code>string</code>, cast and use <code>Unmarshal</code>:</p>\n\n<pre><code>err := xml.Unmarshal([]byte(dataStr), &amp;myobj)\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1878, "favorite_count": 0, "accepted_answer_id": 46007877, "answer_count": 1, "score": 2, "last_activity_date": 1504299504, "creation_date": 1504299151, "question_id": 46007827, "link": "https://stackoverflow.com/questions/46007827/create-a-xml-decoder-from-a-string-or-byte-array-go", "title": "Create a XML Decoder from a string or byte array GO", "body": "<p>I have a xml decode function in my app and I use xml.NewDecoder(resp.Body) to decode my xml. the NewDecoder functions receives an io.Reader. But the problem is that in my response from the server I receive the first 230 bytes i need to ignore and the remaining bytes are the xml encoded in base64 that I want to decode. Here an example of the response body:</p>\n\n<pre><code>    --RandomCaracteres...\n    Content-Type: application/xml; charset=UTF-8; name=response_xml\n\n    &lt;Response success=\"1\"/&gt;\n    --RandomCaracteres...\n    Content-Type: text/xml; name=report.xml\n    Content-Transfer-Encoding: base64\n    PE5leHBvc2VSZXBvcnQgdmVyc2lvbj0iMi4wIj4KPHNjYW5zPgo8c2NhbiBpZD0iNDYwMCIgbmFt......\n</code></pre>\n\n<p>I need to read only the PE5leHBvc2VSZXBv... data. With the following code I can read the xml:</p>\n\n<pre><code>    bodyBytes, _ := ioutil.ReadAll(resp.Body)\n    defer resp.Body.Close()\n    data, err := base64.StdEncoding.DecodeString(string(bodyBytes)[230:])\n    fmt.Println(data)\n</code></pre>\n\n<p>but I can't call the xml.NewDecoder() function because data is not a io.Reader type. Is there any way to creade a Decode object from a string?</p>\n"}, {"tags": ["http", "go", "multipart"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504296680, "post_id": 46007332, "comment_id": 78975668, "body": "It&#39;s in the response.Body, assuming you&#39;re using Go (based on the question tags), but you&#39;ve shown no code so there&#39;s not much help anyone can offer."}, {"owner": {"reputation": 3446, "user_id": 540981, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LTwr5.jpg?s=128&g=1", "display_name": "Danish", "link": "https://stackoverflow.com/users/540981/danish"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504297506, "post_id": 46007332, "comment_id": 78975978, "body": "@Adrian submitted the code that I&#39;m using, thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 3446, "user_id": 540981, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LTwr5.jpg?s=128&g=1", "display_name": "Danish", "link": "https://stackoverflow.com/users/540981/danish"}, "edited": false, "score": 0, "creation_date": 1504646374, "post_id": 46012507, "comment_id": 79087780, "body": "So interestingly, even my with my original code, if I check for <code>err == io. ErrUnexpectedEOF</code> and ignore it, the data downloaded is exactly like what the browser downloads"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 0, "last_activity_date": 1504688034, "last_edit_date": 1504688034, "creation_date": 1504345671, "answer_id": 46012507, "question_id": 46007332, "link": "https://stackoverflow.com/questions/46007332/how-to-read-attachment-from-a-http-response/46012507#46012507", "title": "How To Read Attachment from a HTTP Response", "body": "<p>Give a try to <a href=\"https://golang.org/pkg/net/textproto/\" rel=\"nofollow noreferrer\">net/textproto</a>, here is a small example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"net/textproto\"\n    \"os\"\n)\n\nfunc main() {\n    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"%s\\n%s\\n%s\\n%s\\n\",\n            \"col1,col2,col3\",\n            \"1,2,3\",\n            \"a,b,c\",\n            \"x,y,x\",\n        )\n    }))\n    defer ts.Close()\n\n    client := &amp;http.Client{}\n    res, err := client.Get(ts.URL)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    defer res.Body.Close()\n    reader := bufio.NewReader(res.Body)\n    tp := textproto.NewReader(reader)\n    for {\n        if line, err := tp.ReadLine(); err != nil {\n            if err == io.EOF {\n                // if file is emtpy\n                return\n            }\n            return\n        } else {\n            fmt.Printf(\"%s\\n\\n\", line)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fee4B5mh35\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fee4B5mh35</a></p>\n\n<p>Here is another example based on your original question regarding \"csv\":</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    client := &amp;http.Client{}\n    res, err := client.Get(\"http://samplecsvs.s3.amazonaws.com/Sacramentorealestatetransactions.csv\")\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    defer res.Body.Close()\n    scanner := bufio.NewScanner(res.Body)\n    scanner.Split(bufio.ScanBytes)\n    for scanner.Scan() {\n        c := scanner.Text()\n        switch c {\n        case \"\\r\":\n            fmt.Println()\n        default:\n            fmt.Printf(\"%s\", c)\n        }\n    }\n}\n</code></pre>\n\n<p>In this case, notice the <code>scanner.Split(bufio.ScanBytes)</code>, hope this can give you more ideas.</p>\n"}], "owner": {"reputation": 3446, "user_id": 540981, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/LTwr5.jpg?s=128&g=1", "display_name": "Danish", "link": "https://stackoverflow.com/users/540981/danish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1432, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504688034, "creation_date": 1504296456, "last_edit_date": 1504297408, "question_id": 46007332, "link": "https://stackoverflow.com/questions/46007332/how-to-read-attachment-from-a-http-response", "title": "How To Read Attachment from a HTTP Response", "body": "<p>I am trying to download some csv data from a URL. The raw response looks something like this</p>\n\n<pre><code>HTTP/1.1 200 OK\nServer: Europa-4\nX-Varnish: 33948791\nVary: Accept-Encoding, X-UA-Device\nX-Cache: MISS\nCache-Control: no-cache, no-cache, no-store, proxy-revalidate, must-revalidate, max-age=0\nContent-Type: application/octet-stream\nP3p: CP=\"CAO PSA OUR\"\nDate: Fri, 01 Sep 2017 19:53:27 GMT\nX-Server: web03\nExpires: Fri, 01 Sep 2017 19:53:26 GMT\nX-XSS-Protection: 1; mode=block\nTransfer-Encoding: chunked\nAccept-Ranges: bytes\nX-Content-Type-Options: nosniff\nContent-Disposition: attachment; filename=\"GooglePLAv1US.txt\"\nVia: 1.1 varnish-v4\nConnection: keep-alive\nLast-Modified: Fri, 01 Sep 2017 19:53:27 +0000\nX-Frame-Options: sameorigin\nX-UA-Device: desktop\nAge: 0\nX-Modified-Url: /amfeed/main/get/file/GooglePLAv1US/?___store=ca_en\n\nid      title   description     google_product_category  .....\n20649074       ......\n20652632       ......\n.\n.\n.\n</code></pre>\n\n<p>Now I realize this is not really a multi-part response, but it has the <code>Content-Disposition: attachment; filename=\"GooglePLAv1US.txt\"</code> header, which says it needs to be treated as a download by the browser.</p>\n\n<p>When I try to read the body of response, it throws the error <code>unexpected EOF</code>. How do I read this data, it's not really in any kind of a section?</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>http.DefaultClient.Timeout = time.Second * 30\nresp, err := http.Get(ht.Creds.AccessData.URL)\nif err != nil {\n    return nil, err\n}\ndefer resp.Body.Close()\nd, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    return nil, errors.Wrap(err, \"Error reading HTTP response body\")\n}\n</code></pre>\n\n<p>This produces the error</p>\n\n<pre><code>Error reading HTTP response body: unexpected EOF\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "edited": false, "score": 0, "creation_date": 1504296519, "post_id": 46007107, "comment_id": 78975601, "body": "Nice and perfect. Do you think that using the &quot;reflect&quot; package to find if i have a string or a map[string]interface would be a good idea?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "edited": false, "score": 1, "creation_date": 1504296611, "post_id": 46007107, "comment_id": 78975644, "body": "If you don&#39;t know what the structure will be, I would first opt for a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>, and if you need more flexibility, then fall back on reflection. Reflection is generally the worst option, in most languages, including Go."}, {"owner": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "edited": false, "score": 0, "creation_date": 1504296863, "post_id": 46007107, "comment_id": 78975738, "body": "I think i&#39;m going to use only <i>string</i> and <i>map[string]interface</i>, so type switch is very helpful. Thanks."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1504295298, "creation_date": 1504295298, "answer_id": 46007107, "question_id": 46007073, "link": "https://stackoverflow.com/questions/46007073/parsing-unknown-json-from-file-and-iterate-into-it/46007107#46007107", "title": "Parsing unknown JSON from file and iterate into it", "body": "<p>If you read <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">the documentation for <code>json.Unmarshal</code></a>, you can see what types it will use, and base your code on that; or use <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt.Printf(\"%T\",v)</code></a> to see what type it is at runtime.</p>\n\n<pre><code>err = json.Unmarshal(f, &amp;parsed)\nfor k, v := range parsed[\"foods\"].(map[string]interface{}) {\n    fmt.Println(k, v)\n}\n</code></pre>\n\n<p>Working playground example: <a href=\"https://play.golang.org/p/nczV5qA41h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nczV5qA41h</a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5035391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f759acf43231583b90fd6a87ddee071b?s=128&d=identicon&r=PG&f=1", "display_name": "J.Timblin", "link": "https://stackoverflow.com/users/5035391/j-timblin"}, "is_accepted": false, "score": 1, "last_activity_date": 1504296301, "creation_date": 1504296301, "answer_id": 46007313, "question_id": 46007073, "link": "https://stackoverflow.com/questions/46007073/parsing-unknown-json-from-file-and-iterate-into-it/46007313#46007313", "title": "Parsing unknown JSON from file and iterate into it", "body": "<p>You could just make a structure which contains a <code>map[string]string</code> and iterate over that. <a href=\"https://play.golang.org/p/IVlrTTcrVB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IVlrTTcrVB</a></p>\n\n<pre><code>type Store struct {\n    Name     string            `json:\"store_name\"`\n    Foods    map[string]string `json:\"foods\"`\n    Location string            `json:\"store_location\"`\n}\n\nfunc main() {\n    var store Store\n    data := []byte(jsonData)\n    err := json.Unmarshal(data, &amp;store)\n    if err != nil {\n       panic(err)\n    }\n    for k, v := range store.Foods {\n       fmt.Println(k + string(v))\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2246, "user_id": 274937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d848784d081501a5cba4a2fa7856e965?s=128&d=identicon&r=PG", "display_name": "valyala", "link": "https://stackoverflow.com/users/274937/valyala"}, "is_accepted": false, "score": 1, "last_activity_date": 1527766556, "creation_date": 1527766556, "answer_id": 50623361, "question_id": 46007073, "link": "https://stackoverflow.com/questions/46007073/parsing-unknown-json-from-file-and-iterate-into-it/50623361#50623361", "title": "Parsing unknown JSON from file and iterate into it", "body": "<p><a href=\"https://github.com/valyala/fastjson\" rel=\"nofollow noreferrer\">fastjson</a> may be used for parsing  unknown JSON and iterating into it:</p>\n\n<pre><code>var p fastjson.Parser\nv, err := p.Parse(input)\nif err != nil {\n    log.Fatal(err)\n}\n\n// Visit will call the callback for each item in v.foods.\nv.GetObject(\"foods\").Visit(func(foodName []byte, foodValue *fastjson.Value) {\n    fmt.Printf(\"%s = %s\\n\", foodName, foodValue)\n})\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2482, "favorite_count": 0, "accepted_answer_id": 46007107, "answer_count": 3, "score": 2, "last_activity_date": 1527766556, "creation_date": 1504295144, "last_edit_date": 1527413139, "question_id": 46007073, "link": "https://stackoverflow.com/questions/46007073/parsing-unknown-json-from-file-and-iterate-into-it", "title": "Parsing unknown JSON from file and iterate into it", "body": "<p>I have JSON like this:</p>\n\n<pre><code>{\n    \"store_name\": \"Barry's Farmer's Market\",\n    \"foods\": {\n        \"apple\": \"5.91\",\n        \"peach\": \"1.84\",\n        \"carrot\": \"6.44\",\n        \"beans\": \"3.05\",\n        \"orange\": \"5.75\",\n        \"cucumber\": \"6.42\"\n    },\n    \"store_location\": \"Corner of Elm Tree Hill and 158th Street\"\n} \n</code></pre>\n\n<p>And I want to parse it as an unknown JSON using a <code>map[string]interface{}</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    var parsed map[string]interface{}\n\n    f, err := ioutil.ReadFile(\"input.txt\")\n    if err != nil {\n        fmt.Printf(\"Error: %v\", err)\n        os.Exit(1)\n    }\n\n    err = json.Unmarshal(f, &amp;parsed)\n    for k, v := range parsed {\n        //fmt.Println(parsed[\"foods\"])\n        fmt.Println(k + string(v))\n    }\n\n}\n</code></pre>\n\n<p>Considering that \"v\" doesn't convert to string and that I want to range all the values in \"foods\", can you help me? I think i'm missing something...</p>\n"}, {"tags": ["go", "tarantool"], "comments": [{"owner": {"reputation": 369, "user_id": 2262486, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b4855dab30e8ae49d0e2d2e77050c9a6?s=128&d=identicon&r=PG", "display_name": "AntonK", "link": "https://stackoverflow.com/users/2262486/antonk"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1504293874, "post_id": 46006748, "comment_id": 78974557, "body": "<code>interface{}, error</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504294804, "post_id": 46006748, "comment_id": 78974906, "body": "What is the error message you&#39;re getting? That should shed some light."}], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": false, "score": 3, "last_activity_date": 1504294916, "creation_date": 1504294916, "answer_id": 46007027, "question_id": 46006748, "link": "https://stackoverflow.com/questions/46006748/why-i-cannot-type-assert-empty-interface/46007027#46007027", "title": "Why I cannot type assert empty interface?", "body": "<p>Your function returns a <code>map[string]map[string]uint</code>, not a <code>stat</code>. They are <em>distinct types</em> in go's type-system. Either type-assert to <code>map[string]map[string]uint</code> or, in Go 1.9, you can create an alias instead:</p>\n\n<pre><code>statRaw, _ := q.Statistic()\ntype stat = map[string]map[string]uint\n_, ok := statRaw.(stat)\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/Xf1TPjSI3_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Xf1TPjSI3_</a></p>\n"}, {"tags": [], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "is_accepted": false, "score": 0, "last_activity_date": 1566581531, "creation_date": 1566581531, "answer_id": 57630752, "question_id": 46006748, "link": "https://stackoverflow.com/questions/46006748/why-i-cannot-type-assert-empty-interface/57630752#57630752", "title": "Why I cannot type assert empty interface?", "body": "<p>Don't use a type alias for this kind of thing.</p>\n\n<p>First type check, then convert:</p>\n\n<pre><code>statRaw, _ := q.Statistic()\n\nraw, ok := statRaw.(map[string]map[string]uint)\nif !ok {\n    return\n}\n\ntype stat map[string]map[string]uint\n\nmy := stat(raw)\n</code></pre>\n\n<p>See: <a href=\"https://play.golang.org/p/_BpPqfHYgch\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_BpPqfHYgch</a></p>\n"}], "owner": {"reputation": 369, "user_id": 2262486, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b4855dab30e8ae49d0e2d2e77050c9a6?s=128&d=identicon&r=PG", "display_name": "AntonK", "link": "https://stackoverflow.com/users/2262486/antonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1566581531, "creation_date": 1504293663, "question_id": 46006748, "link": "https://stackoverflow.com/questions/46006748/why-i-cannot-type-assert-empty-interface", "title": "Why I cannot type assert empty interface?", "body": "<p>I would like to cast empty interface to map. Why is this not ok?</p>\n\n<pre><code>// q tarantool.Queue (https://github.com/tarantool/go-tarantool)\nstatRaw, _ := q.Statistic() // interface{}; map[tasks:map[taken:0 buried:0 ...] calls:map[put:1 delay:0 ...]]\ntype stat map[string]map[string]uint\n_, ok := statRaw.(stat)\n</code></pre>\n"}, {"tags": ["networking", "go", "ip", "load-balancing", "packet"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1504292536, "post_id": 46006030, "comment_id": 78974001, "body": "I read your note but your answer must be the best because i want to implement the load balancer my self"}, {"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1504292601, "post_id": 46006030, "comment_id": 78974020, "body": "so i see and listen to alot of packets coming and i forward them to my servers to handle them and open tcp right ? the balancer acts as a bridge ?"}], "tags": [], "owner": {"reputation": 3719, "user_id": 5216668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UUnxO.jpg?s=128&g=1", "display_name": "Will Barnwell", "link": "https://stackoverflow.com/users/5216668/will-barnwell"}, "is_accepted": true, "score": 2, "last_activity_date": 1504290257, "creation_date": 1504290257, "answer_id": 46006030, "question_id": 46005541, "link": "https://stackoverflow.com/questions/46005541/how-to-listen-on-l3-network-layer/46006030#46006030", "title": "how to listen on L3 network layer?", "body": "<p>After <a href=\"https://golang.org/pkg/net/#ListenIP\" rel=\"nofollow noreferrer\">reading the Docs</a>, yes this function will help you receive IP Packets.</p>\n\n<blockquote>\n  <p>ListenIP acts like ListenPacket for IP networks.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/net/#ListenIP\" rel=\"nofollow noreferrer\"><code>ListenIP</code></a> is similar to <a href=\"https://golang.org/pkg/net/#ListenPacket\" rel=\"nofollow noreferrer\"><code>ListenPacket(\"tcp\")</code></a> but for IP packets.</p>\n\n<p>As for the structure of IP packets, and working with them, the <code>net</code> package doesn't seem to have that.</p>\n\n<p>There's another package <a href=\"https://godoc.org/github.com/google/gopacket\" rel=\"nofollow noreferrer\"><code>gopacket</code></a> which looks like it will be able to help you read and modify packets from any layer.</p>\n\n<p>In <code>gopacket</code> there is a <a href=\"https://godoc.org/github.com/google/gopacket#Packet\" rel=\"nofollow noreferrer\"><code>Packet</code></a> type, which allows working with the network layer. </p>\n\n<p><code>Packet.NetworkLayer().LayerContent()</code> and <code>Packet.NetworkLayer().LayerPayload()</code> will each return <code>byte[]</code> which you can interpret by the expected <a href=\"https://en.wikipedia.org/wiki/IPv4#Packet_structure\" rel=\"nofollow noreferrer\">structure of an IP packet</a>.</p>\n\n<hr>\n\n<p><strong>Note</strong>: <em>Now that I've written this whole thing I have to imagine somebody out there has written a nice overlay/wrapper to make this easier. This is just the result of me Googling for 10 minutes. Maybe somebody else will answer with a better tool/method</em></p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1504313209, "post_id": 46007466, "comment_id": 78979854, "body": "so i see and listen to alot of packets coming and i forward them to my servers to handle them and open tcp right ? the balancer acts as a bridge ?"}], "tags": [], "owner": {"reputation": 3171, "user_id": 4844421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtVSq.jpg?s=128&g=1", "display_name": "Paul Boutes", "link": "https://stackoverflow.com/users/4844421/paul-boutes"}, "is_accepted": false, "score": 3, "last_activity_date": 1504297468, "last_edit_date": 1504297468, "creation_date": 1504297076, "answer_id": 46007466, "question_id": 46005541, "link": "https://stackoverflow.com/questions/46005541/how-to-listen-on-l3-network-layer/46007466#46007466", "title": "how to listen on L3 network layer?", "body": "<p>Personally, I use <a href=\"https://github.com/google/gopacket\" rel=\"nofollow noreferrer\">gopacket</a> in order to capture multiple network layers, and this library is very impressive.</p>\n\n<p>When you're using gopacket, you are able to capture multiple network layers by specifying them, for example <code>Ipv4</code>, <code>TCP</code>, <code>Ethernet</code>...\nFor more information, see <a href=\"https://godoc.org/github.com/google/gopacket/layers\" rel=\"nofollow noreferrer\">layers packet</a>.</p>\n\n<p>Then, you will be able to analyze your layers by using <code>packet.Data()</code>, which is a set of bytes that make up this entire packet, and then switch on the packet type to perform some actions.</p>\n\n<p>For example, capturing multiple network layers on <code>eth0</code> : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/layers\"\n    \"github.com/google/gopacket/pcap\"\n    \"time\"\n)\n\n//Layers we want to decode\nvar (\n    ip4 layers.IPv4\n    eth layers.Ethernet\n    tcp layers.TCP\n)\n\nfunc main() {\n\n    //Array to store decoded layers\n    decodedLayers := []gopacket.LayerType{}\n\n    //Create parser\n    parser := gopacket.NewDecodingLayerParser(layers.LayerTypeEthernet, &amp;eth, &amp;ip4, &amp;tcp)\n\n    //Here we use pcap to capture packet on eth0 interface, we can also use afpacket for example, which is more efficient\n    handle, err := pcap.OpenLive(\"eth0\", 65536, true, pcap.BlockForever)\n    if err != nil {\n        panic(\"Error opening pcap: \" + err.Error())\n    }\n\n    datasource := gopacket.NewPacketSource(handle, layers.LayerTypeEthernet)\n\n    //packets will be a channel of packets\n    packets := datasource.Packets()\n\n    for {\n        select {\n        case packet := &lt;-packets:\n            //We are decoding layers, and switching on the layer type\n            err := parser.DecodeLayers(packet.Data(), &amp;decodedLayers)\n            for _, typ := range decodedLayers {\n                switch typ {\n                case layers.LayerTypeIPv4:\n                    fmt.Printf(\"Source ip = %s - Destination ip = %s \\n\", ip4.SrcIP.String(), ip4.DstIP.String())\n                case layers.LayerTypeTCP:\n                    //Here, we can access tcp packet properties\n                    fmt.Println(\"Capture tcp traffic\")\n                }\n                //etc ....\n            }\n            if len(decodedLayers) == 0 {\n                fmt.Println(\"Packet truncated\")\n            }\n\n            //If the DecodeLayers is unable to decode the next layer type\n            if err != nil {\n                //fmt.Printf(\"Layer not found : %s\", err)\n            }\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 46006030, "answer_count": 2, "score": 0, "last_activity_date": 1504297468, "creation_date": 1504288045, "last_edit_date": 1504288790, "question_id": 46005541, "link": "https://stackoverflow.com/questions/46005541/how-to-listen-on-l3-network-layer", "title": "how to listen on L3 network layer?", "body": "<p>I am creating a chat application backend and want to take into consideration the scalability.</p>\n\n<p>I wanted to create a load balancer but not on the L7 layer where HTTP is located, but on the L3 layer where IP network is located to direct connections to the specific servers where I can then make <code>TCP</code>.</p>\n\n<p>Is <a href=\"https://golang.org/pkg/net/#ListenIP\" rel=\"nofollow noreferrer\"><code>net.ListenIP</code></a> the correct function to use to listen to the packets on the IP layer? </p>\n\n<p>Is it the same as the higher <a href=\"https://golang.org/pkg/net/#Listen\" rel=\"nofollow noreferrer\"><code>Listen(\"tcp\")</code></a> for example? Is it the right method that I need to implement the load balancer?</p>\n\n<p>Is there a reference to how the packet is structured so I am able get out from it the source and destination IPs to forward them?</p>\n\n<p>If not tell me which function to use to listen on the L3 network layer to balance the loads to other servers.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504283921, "post_id": 46004535, "comment_id": 78970123, "body": "You are calling the <code>func() func()</code> which is called and returns the <code>func()</code> which <code>defer</code> is calling. See the double parens at the end <code>}()()</code>. You are calling the first, <code>defer</code> is told to call the second one returned from the first."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1504284013, "creation_date": 1504284013, "answer_id": 46004640, "question_id": 46004535, "link": "https://stackoverflow.com/questions/46004535/i-defer-a-function-return-function-what-is-the-order/46004640#46004640", "title": "I defer a function return function, what is the order", "body": "<p>The <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">specification says</a>:</p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked. </p>\n</blockquote>\n\n<p>The deferred function call is the last <code>()</code> in the defer statement. The expression returning the function value is evaluated at the time of the defer statement.</p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 8202202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896214dae2c1256530b13ea49b5100df?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky", "link": "https://stackoverflow.com/users/8202202/jacky"}, "is_accepted": false, "score": 0, "last_activity_date": 1504289006, "creation_date": 1504289006, "answer_id": 46005757, "question_id": 46004535, "link": "https://stackoverflow.com/questions/46004535/i-defer-a-function-return-function-what-is-the-order/46005757#46005757", "title": "I defer a function return function, what is the order", "body": "<p>Since defer statement needs to evaluate the statement, in your code, the func() (the func() right after \"defer\"  keyword) returns a function type, defer statement needs to actually execute the func() to get the return function. So your code prints out \"start\" first.</p>\n\n<p>If your function does not return a function type, then the function body will not be executed until enclosing function returns.</p>\n"}], "owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1262, "favorite_count": 0, "accepted_answer_id": 46004640, "answer_count": 2, "score": 0, "last_activity_date": 1594797907, "creation_date": 1504283627, "last_edit_date": 1594797907, "question_id": 46004535, "link": "https://stackoverflow.com/questions/46004535/i-defer-a-function-return-function-what-is-the-order", "title": "I defer a function return function, what is the order", "body": "<p>I write the follow code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    defer func() func() {\n        fmt.Println(\"start\")\n        return func() {\n            fmt.Println(\"end\")\n        }\n\n    }()()\n    fmt.Println(\"aaaa\")\n    return\n\n}\n</code></pre>\n\n<p>and I except output is aaaa start end</p>\n\n<p>but actual output is start aaaa end</p>\n\n<p>I can't understand why output \"start\" before \"aaaa\"</p>\n"}, {"tags": ["go", "struct", "casting", "type-conversion", "type-assertion"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1504278173, "post_id": 46003028, "comment_id": 78966927, "body": "It&#39;s not about the same overall structure, type conversion requires identical underlying types: <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1504279046, "post_id": 46003028, "comment_id": 78967470, "body": "Given this scenario, the best you can do is write a function that takes that type, creates the new one, assigns all the fields manually, then returns it. Or refactor so you don&#39;t have two identical structs... just the one."}, {"owner": {"reputation": 349, "user_id": 2604150, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/9f2d02ec66c8e80f5b8490b50191544e?s=128&d=identicon&r=PG", "display_name": "user2604150", "link": "https://stackoverflow.com/users/2604150/user2604150"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504279721, "post_id": 46003028, "comment_id": 78967902, "body": "@JimB so does it mean that even though the nested structs also have the same underlying structure (TeamsKeyData and KeyData), it is not possible to convert one struct to another because the TeamsKeyData and KeyData are not same types?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1504280025, "post_id": 46003028, "comment_id": 78968063, "body": "Yes. According to the language spec, you cannot convert them."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504280291, "post_id": 46003028, "comment_id": 78968232, "body": "If you&#39;re comfortable with a dirty &amp; inefficient hack, you could always encode to something like JSON or GOB and then decode into the target type.  But I have to agree with @RayfenWindspear here - the best solution would be to have one type rather than two identical types."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1504280285, "creation_date": 1504280285, "answer_id": 46003712, "question_id": 46003028, "link": "https://stackoverflow.com/questions/46003028/how-to-convert-a-struct-which-has-another-struct-in-it-in-golang/46003712#46003712", "title": "How to convert a struct which has another struct in it in Golang?", "body": "<p>When converting an item it is not enough for them to have identical layouts, they <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">need to have the same underlying type for all their fields</a>.</p>\n\n<p>In this case the best you can do is to make a new struct of the type you want and fill out it's fields with data from the old struct.</p>\n\n<p>I played around some with this, but I was not able to do better than that.</p>\n\n<p>I assume that the two <code>KeyData</code> types need different method sets? If this is <em>not</em> the case, you should just use the same type both places.</p>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504280502, "post_id": 46003721, "comment_id": 78968357, "body": "I personally cannot condone suggesting someone bypassing the types who doesn&#39;t fully understand them."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504280966, "post_id": 46003721, "comment_id": 78968622, "body": "So should I better delete the answer? But technically we can do."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1504281041, "post_id": 46003721, "comment_id": 78968668, "body": "Add some good warnings about how this isn&#39;t a good idea and I&#39;ll remove the downvote. The big problem is that this will probably cause random panics somewhere down the line. A seemingly benign change to one struct suddenly causing panics that would be hard to track down."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504281835, "post_id": 46003721, "comment_id": 78969123, "body": "Or worse... consider this example, where there is no panic, no error, just a bad conversion. <a href=\"https://play.golang.org/p/IrBZUhhwE7\" rel=\"nofollow noreferrer\">play.golang.org/p/IrBZUhhwE7</a>"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1504282089, "last_edit_date": 1504282089, "creation_date": 1504280311, "answer_id": 46003721, "question_id": 46003028, "link": "https://stackoverflow.com/questions/46003028/how-to-convert-a-struct-which-has-another-struct-in-it-in-golang/46003721#46003721", "title": "How to convert a struct which has another struct in it in Golang?", "body": "<p>You can't convert or assign variables of different types normal way. But if it's necessary and you are certain the strutures have the same underlying layout, you can omit compiler's guarantee and do it unsafe.</p>\n\n<pre><code>import \"unsafe\"\n...\na := *((*TeamsKey)(unsafe.Pointer(&amp;k)))\n...\n</code></pre>\n\n<p>It's not recommended without serious reasons, you should well understand what you do.</p>\n"}], "owner": {"reputation": 349, "user_id": 2604150, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/9f2d02ec66c8e80f5b8490b50191544e?s=128&d=identicon&r=PG", "display_name": "user2604150", "link": "https://stackoverflow.com/users/2604150/user2604150"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3488, "favorite_count": 0, "closed_date": 1504284572, "answer_count": 2, "score": 2, "last_activity_date": 1504282089, "creation_date": 1504277965, "question_id": 46003028, "link": "https://stackoverflow.com/questions/46003028/how-to-convert-a-struct-which-has-another-struct-in-it-in-golang", "closed_reason": "Duplicate", "title": "How to convert a struct which has another struct in it in Golang?", "body": "<p>I have a model like the following: </p>\n\n<pre><code>type TeamsKey struct {\n    KeyData TeamsKeyData\n    Fingerprint string\n    Algorithm string\n    Encoding string\n    Usage string\n}\n\ntype TeamsKeyData struct {\n    KeyId string\n    Key string\n    Description string\n    ExpiresAt string\n    CreatedAt string\n }\n\ntype Key struct {\n    KeyData     KeyData\n    Fingerprint string\n    Algorithm   string\n    Encoding    string\n    Usage       string\n}\n\ntype KeyData struct {\n    KeyId       string\n    Key         string\n    Description string\n    ExpiresAt   string\n    CreatedAt   string\n}\n</code></pre>\n\n<p>I want to convert an instance of Key to TeamsKey. Although the underlying structure is same, I cannot convert it. </p>\n\n<pre><code>func main() {\n    k := Key{}\n    a := TeamsKey(k)\n}\n</code></pre>\n\n<p>The error I got: </p>\n\n<pre><code>tmp/sandbox251934449/main.go:46:15: cannot convert k (type Key) to type TeamsKey\n</code></pre>\n\n<p>When I change <code>TeamsKeyData</code> to  <code>KeyData</code> in <code>TeamsKey</code> struct, I can convert the struct without problem.</p>\n\n<p>The question is, why can't I convert the instances to each other even though the underlying structure is exactly the same? </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["sql", "sql-server", "rest", "go"], "comments": [{"owner": {"reputation": 3155, "user_id": 1426450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c61b9f354bdea5e67f662c3d6803f2?s=128&d=identicon&r=PG", "display_name": "stephen.vakil", "link": "https://stackoverflow.com/users/1426450/stephen-vakil"}, "edited": false, "score": 0, "creation_date": 1504278023, "post_id": 46002760, "comment_id": 78966832, "body": "Are you sure you are using the <code>mssql</code> driver and not <code>sqlserver</code>?  Both are in that package but the latter expects parameters in a different format."}, {"owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "reply_to_user": {"reputation": 3155, "user_id": 1426450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c61b9f354bdea5e67f662c3d6803f2?s=128&d=identicon&r=PG", "display_name": "stephen.vakil", "link": "https://stackoverflow.com/users/1426450/stephen-vakil"}, "edited": false, "score": 0, "creation_date": 1504278220, "post_id": 46002760, "comment_id": 78966959, "body": "I&#39;m using sqlserver driver, I&#39;m not on my computer right now so I&#39;ll try in a couple hours."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "edited": false, "score": 0, "creation_date": 1504277783, "post_id": 46002936, "comment_id": 78966684, "body": "Still the same error, it&#39;s definitly a problem with the placeholder but I can&#39;t find any documentation on this since it&#39;s a community based package and not actively developed i think..."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "edited": false, "score": 0, "creation_date": 1504278071, "post_id": 46002936, "comment_id": 78966864, "body": "It looks like the driver claims it accepts the style you&#39;re trying to use for mssql but not sqlserver, perhaps check that too."}, {"owner": {"reputation": 58753, "user_id": 33522, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/3MBg6.png?s=128&g=1", "display_name": "chovy", "link": "https://stackoverflow.com/users/33522/chovy"}, "edited": false, "score": 0, "creation_date": 1614872733, "post_id": 46002936, "comment_id": 117523610, "body": "how do you pass the placeholder value?"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 2, "last_activity_date": 1504277654, "creation_date": 1504277654, "answer_id": 46002936, "question_id": 46002760, "link": "https://stackoverflow.com/questions/46002760/query-with-parameter-with-golang-and-sqlserver-driver/46002936#46002936", "title": "Query with parameter with golang and sqlserver driver", "body": "<p>It seems to be a problem with the placeholders. Why not try just ? for your placeholders as you're not shifting the order or repeating them. So try this:</p>\n\n<pre><code>\"SELECT * FROM Articles WHERE Id = ?\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3979, "user_id": 6901788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f545a694bde5d3351a841a9e4f5e8dd6?s=128&d=identicon&r=PG&f=1", "display_name": "LONG", "link": "https://stackoverflow.com/users/6901788/long"}, "is_accepted": false, "score": 1, "last_activity_date": 1504277953, "creation_date": 1504277953, "answer_id": 46003025, "question_id": 46002760, "link": "https://stackoverflow.com/questions/46002760/query-with-parameter-with-golang-and-sqlserver-driver/46003025#46003025", "title": "Query with parameter with golang and sqlserver driver", "body": "<p><code>db.Query(\"SELECT * FROM t WHERE a = ?3, b = ?2, c = ?1\", \"x\", \"y\", \"z\")</code>, the question mark here works as placeholder, which later will be replaced with the value of 'x', 'y' and 'z' according to its order in the code during runtime. </p>\n\n<p>But this:</p>\n\n<p><code>SELECT * FROM Articles WHERE Id = ?1</code> is not a validate SQL statement, correct is to remove the question mark, or you could give a specific value to @Id, like:</p>\n\n<p><code>SELECT * FROM Articles WHERE Id = @Id</code></p>\n\n<p>In a short word, <code>db.Query()</code> could build your query using placeholder, but your <code>findArticlesQry</code> variable is storing plain SQL statement, that should follow the basic SQL grammar, <code>?</code> is not allowed.</p>\n"}, {"comments": [{"owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "edited": false, "score": 0, "creation_date": 1504278772, "post_id": 46003183, "comment_id": 78967309, "body": "Thanks, I never mentioned the mssql driver btw, I mentioned sqlserver driver explicitly in my question actually, but thanks ! I&#39;ll try it when I&#39;ll have access to my computer."}], "tags": [], "owner": {"reputation": 3155, "user_id": 1426450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c61b9f354bdea5e67f662c3d6803f2?s=128&d=identicon&r=PG", "display_name": "stephen.vakil", "link": "https://stackoverflow.com/users/1426450/stephen-vakil"}, "is_accepted": true, "score": 3, "last_activity_date": 1578075843, "last_edit_date": 1578075843, "creation_date": 1504278496, "answer_id": 46003183, "question_id": 46002760, "link": "https://stackoverflow.com/questions/46002760/query-with-parameter-with-golang-and-sqlserver-driver/46003183#46003183", "title": "Query with parameter with golang and sqlserver driver", "body": "<p>Per your comment, you are using the <code>sqlserver</code> driver, not the <code>mssql</code> driver, so you are using the wrong parameter format.  Per the documentation:</p>\n\n<blockquote>\n  <p>The sqlserver driver uses normal MS SQL Server syntax and expects\n  parameters in the sql query to be in the form of either <code>@Name</code> or <code>@p1</code>\n  to <code>@pN</code> (ordinal position).</p>\n  \n  <p><code>db.QueryContext(ctx, \"select * from t where ID = @ID;\", sql.Named(\"ID\", 6))</code></p>\n</blockquote>\n\n<p>You should therefore change your query to be:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var(\n    allArticlesQry string = \"SELECT * FROM Articles\"\n    findArticlesQry string = \"SELECT * FROM Articles WHERE Id = @p1\"\n)\n</code></pre>\n"}], "owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3285, "favorite_count": 1, "accepted_answer_id": 46003183, "answer_count": 3, "score": 2, "last_activity_date": 1578075843, "creation_date": 1504277084, "last_edit_date": 1504277527, "question_id": 46002760, "link": "https://stackoverflow.com/questions/46002760/query-with-parameter-with-golang-and-sqlserver-driver", "title": "Query with parameter with golang and sqlserver driver", "body": "<p>I'm trying to get a specific item by ID from my sql server database. Here's my code :</p>\n\n<pre><code>var(\n    allArticlesQry string = \"SELECT * FROM Articles\"\n    findArticlesQry string = \"SELECT * FROM Articles WHERE Id = ?1\"\n)\n\nfunc FindArticle(w http.ResponseWriter, r *http.Request){\n    vars := mux.Vars(r)\n    var id = vars[\"id\"]\n    var article Article\n\n    db := connect()\n    defer db.Close()\n\n    stmt, err := db.Prepare(findArticlesQry)    \n    if err != nil{\n        log.Fatal(err)\n    }\n    defer stmt.Close()\n\n    err = stmt.QueryRow(id).Scan(&amp;article.Title, &amp;article.Description, &amp;article.Body, &amp;article.Id)\n    if err != nil{\n        log.Fatal(err)\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n    json.NewEncoder(w).Encode(u.HttpResp{Status: 200, Body: article})\n}\n</code></pre>\n\n<p>I'm using <a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">this package</a> for the sqlserver driver and it has this example who should work fine : <code>db.Query(\"SELECT * FROM t WHERE a = ?3, b = ?2, c = ?1\", \"x\", \"y\", \"z\")</code> </p>\n\n<p>But everytime I try to call this function it fails and returns : \n<code>2017/09/01 16:31:01 mssql: Incorrect syntax near '?'.</code></p>\n\n<p>So I don't really understand why my query doesn't work..</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I tried another way, I removed the part where I prepare the query before executing and now it doesn't crash my server, I have a response but the problem is still the same : </p>\n\n<pre><code>var row = db.QueryRow(findArticlesQry, id).Scan(&amp;article.Title, &amp;article.Description, &amp;article.Body, &amp;article.Id)\n</code></pre>\n\n<p>And the response : </p>\n\n<pre><code>{\n    \"status\": 200,\n    \"description\": \"\",\n    \"body\": {\n        \"Number\": 102,\n        \"State\": 1,\n        \"Class\": 15,\n        \"Message\": \"Incorrect syntax near '?'.\",\n        \"ServerName\": \"DESKTOP-DLROBC4\\\\LOCALHOST\",\n        \"ProcName\": \"\",\n        \"LineNo\": 1\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504273855, "post_id": 46001611, "comment_id": 78964029, "body": "That&#39;s not how you declare methods. See the <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">Tour of Go #Methods</a>, <a href=\"https://golang.org/doc/effective_go.html#methods\" rel=\"nofollow noreferrer\">Effective Go</a>, or any other documentation"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 3, "last_activity_date": 1504274207, "last_edit_date": 1504274207, "creation_date": 1504273853, "answer_id": 46001702, "question_id": 46001611, "link": "https://stackoverflow.com/questions/46001611/cannot-implement-interface-methods-for-multiple-structs-placed-in-the-same-packa/46001702#46001702", "title": "Cannot implement interface methods for multiple structs placed in the same package", "body": "<p>Declaring a function that accepts a certain type does not make that function part of the type's <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> (meaning it does not help the type satisfy a particular interface).</p>\n\n<p>Instead, you need to use the proper syntax to <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">declare a function as a method</a>, like so:</p>\n\n<pre><code>type BNode struct {}\n\nfunc (ANode) AMethod(arg ArgType) bool {\n    return true\n}\n\nfunc (ANode) BMethod() bool {\n    return true\n}\n\ntype BNode struct {}\n\nfunc (BNode) AMethod(arg ArgType) bool {\n    return true\n}\n\nfunc (BNode) BMethod() bool {\n    return true\n}\n</code></pre>\n"}], "owner": {"reputation": 3885, "user_id": 5133852, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4729dc39436cac694acc61ec30f45ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Vassily", "link": "https://stackoverflow.com/users/5133852/vassily"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1504274207, "creation_date": 1504273561, "last_edit_date": 1504274117, "question_id": 46001611, "link": "https://stackoverflow.com/questions/46001611/cannot-implement-interface-methods-for-multiple-structs-placed-in-the-same-packa", "title": "Cannot implement interface methods for multiple structs placed in the same package", "body": "<p>I have three files:</p>\n\n<p>node.go:</p>\n\n<pre><code>type Node interface {\n    AMethod(arg ArgType) bool\n    BMethod() bool\n}\n</code></pre>\n\n<p>anode.go:</p>\n\n<pre><code>type aNode struct {}\n\nfunc AMethod(aNode ANode, arg ArgType) bool {\n    return true\n}\n\nfunc BMethod(aNode ANode) bool {\n    return true\n}\n</code></pre>\n\n<p>bnode.go:</p>\n\n<pre><code>type bNode struct {}\n\nfunc AMethod(bNode BNode, arg ArgType) bool {\n    return true\n}\n\nfunc BMethod(bNode BNode) bool {\n    return true\n}\n</code></pre>\n\n<p>But I'm getting the error:</p>\n\n<pre><code>Nodes/bnode.go:16:58: AMethod redeclared in this block\n    previous declaration at Nodes/anode.go:15:58\nNodes/bnode.go:20:60: BMethod redeclared in this block\n    previous declaration at Nodes/anode.go:19:60\n</code></pre>\n\n<p>How do I validly implement an interface here?</p>\n"}, {"tags": ["oracle", "go", "oracle-call-interface", "instantclient"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504269955, "post_id": 45999840, "comment_id": 78961444, "body": "This looks juts like <a href=\"https://stackoverflow.com/questions/45984239/go-giving-fatal-error-oci-h-no-such-file-or-directory\" title=\"go giving fatal error oci h no such file or directory\">stackoverflow.com/questions/45984239/&hellip;</a>, but with even less info."}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504270507, "post_id": 45999840, "comment_id": 78961795, "body": "@JimB, please suggest what else should be added to make it clear"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504270749, "post_id": 45999840, "comment_id": 78961949, "body": "pkg-config is finding the api8.pc file, but is that file correct? Where are your oracle headers and libraries located?"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504271520, "post_id": 45999840, "comment_id": 78962432, "body": "@JimB I have posted my oci8.pc in question now"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504272207, "post_id": 45999840, "comment_id": 78962934, "body": "If those paths are correct, and you&#39;ve confirmed the go tool is actually executing <code>pkg-config</code>, are you certain that output is correct? There are no path separators in the <code>pkg-config</code> you&#39;ve shown, and the example pc files for windows still seem to use forward slashes."}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504272378, "post_id": 45999840, "comment_id": 78963052, "body": "@JimB yes output of pkg-config is correct, do you want me to change the slashes in pc file to backward slashes"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504272553, "post_id": 45999840, "comment_id": 78963188, "body": "I tried changing to backward slashes, now its a different error   # gopkg.in/rana/ora.v4 gcc: warning: C:\\instantclient_12_2\\sdk\\include: linker input file unused because linking not done # gopkg.in/rana/ora.v4 gcc: warning: C:\\instantclient_12_2\\sdk\\include: linker input file unused because linking not done # gopkg.in/rana/ora.v4 C:/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/7.1.0/../../../&zwnj;&#8203;../x86_64-w64-mingw3&zwnj;&#8203;2/bin/ld.exe: cannot find C:\\instantclient_12_2\\sdk\\lib\\msvc: Permission denied collect2.exe: error: ld returned 1 exit status"}], "owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2376, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504272014, "creation_date": 1504267090, "last_edit_date": 1504272014, "question_id": 45999840, "link": "https://stackoverflow.com/questions/45999840/fatal-error-oci-h-no-such-file-or-directory", "title": "fatal error: oci.h: No such file or directory", "body": "<p>go version go1.8.1 windows/amd64\nwhen I tried go get for oracle library</p>\n\n<pre><code>go get -v gopkg.in/rana/ora.v4\noutput: \n**gopkg.in/rana/ora.v4\n# gopkg.in/rana/ora.v4\nF:\\CODING\\src\\gopkg.in\\rana\\ora.v4\\bndBfile.go:9:10: fatal error: oci.h: No such file or directory\n #include &lt;oci.h&gt;\n          ^~~~~~~\ncompilation terminated.**\n</code></pre>\n\n<p>and </p>\n\n<pre><code>**go get github.com/mattn/go-oci8\n# github.com/mattn/go-oci8\nF:\\CODING\\src\\github.com\\mattn\\go-oci8\\oci8.go:4:10: fatal error: oci.h: No such file or directory\n #include &lt;oci.h&gt;\n          ^~~~~~~\ncompilation terminated.**\n</code></pre>\n\n<p>now when I type <code>pkg-config --cflags --libs oci8</code>\nI get following result which means oci8.pc is working fine</p>\n\n<pre><code>-IC:instantclient_12_2sdkinclude -IC:mingw64include  -LC:instantclient_12_2sdklibmsvc -LC:mingw64lib -loci\n</code></pre>\n\n<p>please suggest whats going wrong\noci8.pc</p>\n\n<pre><code>prefix=/devel/target/1.0\nexec_prefix=${prefix}\noralib=C:\\instantclient_12_2\\sdk\\lib\\msvc\norainclude=C:\\instantclient_12_2\\sdk\\include\ngcclib=C:\\mingw64\\lib\ngccinclude=C:\\mingw64\\include\nglib_genmarshal=glib-genmarshal\ngobject_query=gobject-query\nglib_mkenums=glib-mkenums\n\nName: oci8\nVersion: 12.2\nDescription: oci8 library\nLibs: -L${oralib} -L${gcclib} -loci\nLibs.private: \nCflags: -I${orainclude} -I${gccinclude}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 0, "last_activity_date": 1504279493, "creation_date": 1504279493, "answer_id": 46003467, "question_id": 45999194, "link": "https://stackoverflow.com/questions/45999194/named-query-failing-to-parse-map/46003467#46003467", "title": "Named query failing to parse map", "body": "<p>This would depend on what <code>sql</code> library you are using, but when using <code>NamedQuery</code> in many libraries, you <strong>must</strong> escape any other colons, which you will find how to do in its documentation. For example, <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\"><code>sqlx</code></a> requires you to escape a colon with two e.g.</p>\n\n<pre><code>co_url = concat('https:://', :co_url)\n</code></pre>\n"}], "owner": {"reputation": 3261, "user_id": 1818847, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/fPeO9.jpg?s=128&g=1", "display_name": "Mario Stoilov", "link": "https://stackoverflow.com/users/1818847/mario-stoilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "accepted_answer_id": 46003467, "answer_count": 1, "score": 0, "last_activity_date": 1504279493, "creation_date": 1504264900, "question_id": 45999194, "link": "https://stackoverflow.com/questions/45999194/named-query-failing-to-parse-map", "title": "Named query failing to parse map", "body": "<p>I have this code segement</p>\n\n<pre><code>query := `\n        SELECT\n            co_username as username,\n            co_password as password\n        FROM\n            servers.co\n        WHERE\n            co_url = concat('https://', :co_url)\n    `\n\n    args := map[string]interface{}{\n        \"co_url\": in.Url,\n    }\n\n    rows, err := collectorsConfig.Db.NamedQueryContext(ctx, query, args)\n    if err != nil {\n        msg := \"Error getting co credentials for co '%s': %v\"\n        log.Error.Printf(msg, in.Url, err)\n        return\n    }\n</code></pre>\n\n<p>When runnig this snippet, I get an error like this:</p>\n\n<blockquote>\n  <p>Error getting co credentials for co 'some.random.fqdn': could not find\n  name  in map[string]interface {}{\"co_url\":\"some.random.fqdn\"}</p>\n</blockquote>\n\n<p>But if I rework the snippet to be</p>\n\n<pre><code>in.Url = \"https://\" + in.Url\n\nquery := `\n            SELECT\n                co_username as username,\n                co_password as password\n            FROM\n                servers.co\n            WHERE\n                co_url = :co_url\n        `\n</code></pre>\n\n<p>Everything works. Is there a reason the named input is not working with the <code>Concat</code> function?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 3, "last_activity_date": 1504276595, "creation_date": 1504276595, "answer_id": 46002617, "question_id": 45997786, "link": "https://stackoverflow.com/questions/45997786/passing-array-of-string-as-parameter-from-go-to-c-function/46002617#46002617", "title": "Passing array of string as parameter from go to C function", "body": "<p>You can build the arrays using c helper functions and then use them. </p>\n\n<p>Here is a solution to the same problem:</p>\n\n<pre><code>// C helper functions:\n\nstatic char**makeCharArray(int size) {\n        return calloc(sizeof(char*), size);\n}\n\nstatic void setArrayString(char **a, char *s, int n) {\n        a[n] = s;\n}\n\nstatic void freeCharArray(char **a, int size) {\n        int i;\n        for (i = 0; i &lt; size; i++)\n                free(a[i]);\n        free(a);\n}\n\n// Build C array in Go from sargs []string\n\ncargs := C.makeCharArray(C.int(len(sargs)))\ndefer C.freeCharArray(cargs, C.int(len(sargs)))\nfor i, s := range sargs {\n        C.setArrayString(cargs, C.CString(s), C.int(i))\n}\n</code></pre>\n\n<p><a href=\"https://groups.google.com/forum/#!searchin/golang-nuts/char**$20array%7Csort:relevance/golang-nuts/pQueMFdY0mk/OAX5-Fqus0UJ\" rel=\"nofollow noreferrer\">golangnuts</a> post by John Barham </p>\n"}], "owner": {"reputation": 39, "user_id": 8235796, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tQGMG_zhEHg/AAAAAAAAAAI/AAAAAAAAAAs/LOGX2cKkdbg/photo.jpg?sz=128", "display_name": "Raj Shrivastawa", "link": "https://stackoverflow.com/users/8235796/raj-shrivastawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1310, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504276595, "creation_date": 1504260194, "last_edit_date": 1504260367, "question_id": 45997786, "link": "https://stackoverflow.com/questions/45997786/passing-array-of-string-as-parameter-from-go-to-c-function", "title": "Passing array of string as parameter from go to C function", "body": "<p>I have one C function:</p>\n\n<pre><code>int cgroup_change_cgroup_path(const char * path, pid_t pid, const char *const  controllers[])\n</code></pre>\n\n<p>I want to call it in go language by using cgo.\nHow to pass the third parameter as it accepts a C array of string.</p>\n"}, {"tags": ["database", "go", "orm", "beego"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1504277156, "creation_date": 1504277156, "answer_id": 46002779, "question_id": 45997071, "link": "https://stackoverflow.com/questions/45997071/how-to-constrain-range-using-beego-orm/46002779#46002779", "title": "How to constrain range using beego orm", "body": "<p>The command doesn't seem to give any options for inserting CHECK, it's quite an esoteric SQL command, and there is no hint of it in the <a href=\"https://sourcegraph.com/github.com/astaxie/beego@522b3a4a70bd86c20e5d2f4ca6320b44204c0019/-/blob/orm/cmd_utils.go#L135:6\" rel=\"nofollow noreferrer\">source</a> at getDbCreateSQL or the <a href=\"https://beego.me/docs/mvc/model/orm.md\" rel=\"nofollow noreferrer\">docs</a>.  </p>\n\n<p>I suggest you just create your tables with SQL instead and insert the sql you have above, this should be a one-time task so not too onerous. </p>\n"}], "owner": {"reputation": 111, "user_id": 2670010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc9679edf30db92a6cc2c86b133307b5?s=128&d=identicon&r=PG", "display_name": "Aecturus", "link": "https://stackoverflow.com/users/2670010/aecturus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1504277156, "creation_date": 1504257956, "question_id": 45997071, "link": "https://stackoverflow.com/questions/45997071/how-to-constrain-range-using-beego-orm", "title": "How to constrain range using beego orm", "body": "<p>I would like to constrain an attribute to a certain range using beego orm, similar to </p>\n\n<pre><code>CHECK(\u201ccolumn\u201d &gt;= 0 AND \u201ccolumn\u201d &lt;= 10)\n</code></pre>\n\n<p>in the table setup. Can I do this with beego, and if yes, how?</p>\n"}, {"tags": ["go", "rust", "gtk3"], "answers": [{"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 3, "last_activity_date": 1504255463, "creation_date": 1504255463, "answer_id": 45996360, "question_id": 45996219, "link": "https://stackoverflow.com/questions/45996219/does-it-matter-what-language-i-use-for-normal-gtk3-apps-will-a-user-notice-the/45996360#45996360", "title": "Does it matter what language I use for normal GTK3 apps? Will a user notice the difference?", "body": "<blockquote>\n  <p>Will gotk3 be fast enough for a good user experience?</p>\n</blockquote>\n\n<p>Yes. Unless you write a very specific program like for low latency trading, the language in which you write your app does not matter.</p>\n\n<p>Just pick up the language you prefer: Go, Rust, C, Python, D, etc. they are all used in various GNOME application without trouble.</p>\n\n<p>The thing that matters is the algorithm you use. If you use an O(n\u00b2) instead of an O(log n) algorithm for example, it will be bad in C, Rust and Go.</p>\n"}], "owner": {"reputation": 4893, "user_id": 899227, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WHwW6.png?s=128&g=1", "display_name": "roeland", "link": "https://stackoverflow.com/users/899227/roeland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "closed_date": 1504258257, "accepted_answer_id": 45996360, "answer_count": 1, "score": 0, "last_activity_date": 1504259145, "creation_date": 1504254952, "last_edit_date": 1504259145, "question_id": 45996219, "link": "https://stackoverflow.com/questions/45996219/does-it-matter-what-language-i-use-for-normal-gtk3-apps-will-a-user-notice-the", "closed_reason": "Needs more focus", "title": "Does it matter what language I use for normal GTK3 apps? Will a user notice the difference?", "body": "<p>I want to make an application with GTK3.\nThis will be an application to manage files (copy, move, ...) but mostly some windows with settings. (normal tabs, checkbox, selects, inputs, ...)\nI may also need some custom drawn widgets.</p>\n\n<p>As a language I would like to use Go because it is fast an simple to use. I tried the gotk3 library and the example seem to work fine on my macbook.</p>\n\n<p>But I'm a bit worried about performance. Because cgo is used to use the gtk libraries, will this make the application slow? Or is this still fast enough for normal applications.</p>\n\n<p>An alternative would be to use Rust. gtk-rs seems better then gotk3 because using c libraries in Rust is easier.</p>\n\n<p>(I have no experience with GTK, C, Rust)</p>\n\n<p>Will gotk3 be fast enough for a good user experience?<br>\nWill I notice a difference between gotk3 / gtk-rs / gtk in plain C ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1504274649, "post_id": 45990335, "comment_id": 78964549, "body": "a) <i>there is no inheritance in Go</i>; and b) constructors should not be part of the interface of the type they construct, they should be functions (not methods)."}], "answers": [{"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504216823, "post_id": 45990536, "comment_id": 78941575, "body": "OK, you removed the <code>Create</code> method from the interface and put the rest in the <code>Person</code>implementation... but what if the interface has another method (i.e. <code>SayHello</code>) that is gender-specific?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504217085, "post_id": 45990536, "comment_id": 78941651, "body": "@j3d it&#39;s exactly the same. Updated answer to add a <code>SayHello</code> method. I only removed <code>Create</code> because it didn&#39;t seem useful to have to create a blank person to call the <code>Create</code> method on. I can add it back in if you wish"}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504217499, "post_id": 45990536, "comment_id": 78941784, "body": "Ok, it&#39;s clear now :-) Thank you very much for your support!"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504217646, "post_id": 45990536, "comment_id": 78941847, "body": "@j3d This includes the male/female <code>Create</code> method if you wish to keep it. <a href=\"https://play.golang.org/p/mnUWaFNxWT\" rel=\"nofollow noreferrer\">play.golang.org/p/mnUWaFNxWT</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1504278665, "post_id": 45990536, "comment_id": 78967233, "body": "Actually, leaving the <code>Create</code> method does a whole lot more harm than good... well actually it does no good and only harms the interface."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1504590988, "post_id": 45990536, "comment_id": 79055109, "body": "Just a note: <code>GetX</code> is against conventions. The convention is <code>X()</code> for getters and <code>SetX( x typeOfX)</code> for setters."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 4, "last_activity_date": 1504278838, "last_edit_date": 1504278838, "creation_date": 1504215902, "answer_id": 45990536, "question_id": 45990335, "link": "https://stackoverflow.com/questions/45990335/go-and-object-oriented-paradigm/45990536#45990536", "title": "Go and Object Oriented Paradigm", "body": "<p>Embed <code>Person</code> in the <code>Male</code> and <code>Female</code> types and push the base methods up to <code>Person</code>.</p>\n\n<pre><code>type Male struct {\n    Person\n}\n\ntype Female struct {\n    Person\n}\n\nfunc (m *Person) GetName() string {\n    return m.Name\n}\n\nfunc (m *Person) GetGender() string {\n    return m.Gender\n}\n\nfunc main() {\n    var c Citizen\n    c = CreateMale(\"Joe\")\n    fmt.Println(c.GetName(), c.GetGender(), \"\\n\", c.SayHello())\n    c = CreateFemale(\"Jane\")\n    fmt.Println(c.GetName(), c.GetGender(), \"\\n\", c.SayHello())\n}\n</code></pre>\n\n<p>See full example here: <a href=\"https://play.golang.org/p/GZcG-n_YpM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/GZcG-n_YpM</a></p>\n\n<p>This uses the interface <code>Citizen</code> instead of the type <code>Person</code> in the assignment, so let me know if that isn't what you are looking for.</p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "accepted_answer_id": 45990536, "answer_count": 1, "score": 0, "last_activity_date": 1504278838, "creation_date": 1504214885, "last_edit_date": 1504244187, "question_id": 45990335, "link": "https://stackoverflow.com/questions/45990335/go-and-object-oriented-paradigm", "title": "Go and Object Oriented Paradigm", "body": "<p>Given the following interface...</p>\n\n<pre><code>type Person struct {\n    name, gender string\n}\n\ntype Citizen interface {\n    Create(name string) Citizen\n    GetName() string\n    GetGender() String\n    SayHello() String\n}\n</code></pre>\n\n<p>... and the following <code>Male</code> and <code>Female</code> implementations:</p>\n\n<pre><code>type Male Person\n\nfunc (m *Male) Create(name) Citizen {\n    return &amp;Person{name, \"male\"}\n}\n\nfunc (m *Male) GetName() string {\n    return m.name\n}\n\nfunc (m *Male) GetGender() string {\n    return m.gender\n}\n\nfunc (m *Male) SayHello() string {\n    return \"Hello (male voice)\"\n}\n\ntype Female Person\n\nfunc (f *Female) Create(name) Citizen {\n    return &amp;Person{name, \"female\"}\n}\n\nfunc (f *Female) GetName() string {\n    return f.name\n}\n\nfunc (f *Female) GetGender() string {\n    return f.gender\n}\n\nfunc (m *Female) SayHello() string {\n    return \"Hello (female voice)\"\n}\n\nfunc main() {\n    var p1 Person = &amp;Male{}\n    var p2 Person = &amp;Female{}\n\n    p1 = p1.Create(\"Joe\")\n    p2 = p2.Create(\"Heidi\")\n\n    log.Printf(\"%s is a %s\",p1.GetName(), p1.GetGender())\n    log.Printf(\"%s says %s\",p1.GetName(), p1.SayHello())\n    log.Printf(\"%s is a %s\",p2.GetName(), p2.GetGender())\n    log.Printf(\"%s says %s\",p2.GetName(), p2.SayHello())\n}\n</code></pre>\n\n<p>As only <code>Create</code> is gender-specific, is there a way to let <code>Male</code> and <code>Female</code> inherit a common implementation of methods <code>GetName</code> and <code>GetGender</code>?</p>\n"}, {"tags": ["go", "queue"], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "edited": false, "score": 0, "creation_date": 1504212009, "post_id": 45989417, "comment_id": 78939608, "body": "That&#39;s it. Thank you. I will update the final solution in my question.."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "edited": false, "score": 0, "creation_date": 1504212105, "post_id": 45989417, "comment_id": 78939655, "body": "@dirk just marking an answer is good enough for that. You shouldn&#39;t edit the question with the answer."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 2, "last_activity_date": 1504210564, "creation_date": 1504210564, "answer_id": 45989417, "question_id": 45989127, "link": "https://stackoverflow.com/questions/45989127/polling-a-simple-queue-from-within-another-and-filling-the-first-queue-from-the/45989417#45989417", "title": "Polling a simple queue from within another, and filling the first queue from the second queue", "body": "<p>You exit the loop when it doesn't find anything. Just change your for loop to the following, but note that this makes the loop infinite, so you have to <code>break</code> out or <code>return</code> to get out.</p>\n\n<pre><code>for e, ok := q1.Next(); ok || !ok ; e, ok = q1.Next() {\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504211455, "post_id": 45989470, "comment_id": 78939362, "body": "Ah yes, just putting <code>true</code> there is better than what I did in my answer, but as a one liner answer, I wanted to make sure the var <code>ok</code> would get used and not throw a compiler error. Cheers! EDIT: I guess it gets used anyway because it is reassigned in the loop, so <code>true</code> wins out a lot better."}, {"owner": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504212564, "post_id": 45989470, "comment_id": 78939863, "body": "Thank you. I took the \u02cbtrue\u02cb from your solution. But @RayfenWindspear was quicker..."}, {"owner": {"reputation": 4494, "user_id": 3727050, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/OFrev.png?s=128&g=1", "display_name": "urban", "link": "https://stackoverflow.com/users/3727050/urban"}, "reply_to_user": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "edited": false, "score": 0, "creation_date": 1504213485, "post_id": 45989470, "comment_id": 78940254, "body": "@dirk :) no worries"}], "tags": [], "owner": {"reputation": 4494, "user_id": 3727050, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/OFrev.png?s=128&g=1", "display_name": "urban", "link": "https://stackoverflow.com/users/3727050/urban"}, "is_accepted": false, "score": 2, "last_activity_date": 1504210783, "creation_date": 1504210783, "answer_id": 45989470, "question_id": 45989127, "link": "https://stackoverflow.com/questions/45989127/polling-a-simple-queue-from-within-another-and-filling-the-first-queue-from-the/45989470#45989470", "title": "Polling a simple queue from within another, and filling the first queue from the second queue", "body": "<p>After the first iteration, the \"increment\" happens and this time <code>ok</code> is set to <code>false</code>. The next step compares <code>ok == true</code> (loop termination condition) which is not the case and thus exits. </p>\n\n<p>Now, if I understand correctly what you try to do, I would modify the loop to:</p>\n\n<pre><code>// poll first queue\nfor e, ok := q1.Next(); true; e, ok = q1.Next() {\n    // nothing in q1\n    if !ok {\n        fmt.Println(\"Nothing found in q1\")\n\n        // poll second queue\n        d, do := q2.Next()\n        if !do {\n            break\n        }\n\n        // found d in q2 and append to q1\n        fmt.Printf(\"found in q2 %v\\n\", d)\n        q1.stream = append(q1.stream, d)\n    } else {\n\n        // do some stuff to e ...\n        fmt.Printf(\"found in q1 '%v' ok=%v\\n\", e, ok)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 45989417, "answer_count": 2, "score": 0, "last_activity_date": 1504274442, "creation_date": 1504209298, "last_edit_date": 1504274442, "question_id": 45989127, "link": "https://stackoverflow.com/questions/45989127/polling-a-simple-queue-from-within-another-and-filling-the-first-queue-from-the", "title": "Polling a simple queue from within another, and filling the first queue from the second queue", "body": "<p>In other words, the flow of an event-driven queue:</p>\n\n<ul>\n<li>poll event queue</li>\n<li>if event found, process event, then next poll cycle</li>\n<li>if no event found, poll data queue</li>\n<li>if data found, push to event queue, start next cycle polling event queue</li>\n<li>if no data found, exit flow</li>\n</ul>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Queue struct {\n    stream []string\n}\n\n// Next returns first element from stream.\n// Returns false if no element is in the stream.\nfunc (q *Queue) Next() (s string, ok bool) {\n    if len(q.stream) == 0 {\n        return s, false\n    }\n    s = q.stream[0]\n    q.stream = q.stream[1:]\n    return s, true\n}\n\nfunc main() {\n    // define queues\n    events := []string{\"event\"}\n    q1 := &amp;Queue{stream: events}\n    data := []string{\"data1\", \"data2\", \"data3\"}\n    q2 := &amp;Queue{stream: data}\n\n    // poll first queue\n    for e, ok := q1.Next(); ok; e, ok = q1.Next() {\n        // nothing in q1\n        if !ok {\n            fmt.Println(\"Nothing found in q1\")\n\n            // poll second queue\n            d, ok := q2.Next()\n            if !ok {\n                return\n            }\n\n            // found d in q2 and append to q1\n            fmt.Printf(\"found in q2 %v\\n\", d)\n            q1.stream = append(q1.stream, d)\n            return\n        }\n\n        // do some stuff to e ...\n        fmt.Printf(\"found in q1 %v %v\\n\", e, ok)\n    }\n}\n</code></pre>\n\n<p>Try it in the playground <a href=\"https://play.golang.org/p/bgJzq2hCfl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bgJzq2hCfl</a>.</p>\n\n<p>All I get is the element in the first queue.</p>\n\n<pre><code>found in q1 event true\n</code></pre>\n\n<p>The code never polls the second queue and append its elements to the first queue. What do i wrong?</p>\n\n<p>If I try</p>\n\n<pre><code>// poll first queue\nfor e, ok := q1.Next() {\n    // ...\n}\n</code></pre>\n\n<p>the compiler throws</p>\n\n<pre><code>tmp/sandbox299553905/main.go:28:25: syntax error: e, ok := q1.Next() used as value\n</code></pre>\n\n<p>Any hints appreciated.</p>\n\n<hr>\n\n<p><strong>Update:</strong> Here is the solution to the loop.</p>\n\n<pre><code>// poll first queue\nfor e, ok := q1.Next(); true; e, ok = q1.Next() {\n    // nothing in q1\n    if !ok {\n        fmt.Println(\"Nothing found in q1\")\n\n        // poll second queue\n        for d, ok := q2.Next(); true; d, ok = q2.Next() {\n            if !ok {\n                fmt.Println(\"Nothing found in q2. exit\")\n                return\n            }\n\n            // found d in q2 and append to q1\n            fmt.Printf(\"found in q2: %v. append to q1\\n\", d)\n            q1.stream = append(q1.stream, d)\n            break\n        }\n        continue\n    }\n\n    // do some stuff to e ...\n    fmt.Printf(\"found in q1: %v. do stuff\\n\", e)\n}\n</code></pre>\n\n<p>You can test it in the playground <a href=\"https://play.golang.org/p/qo0zoBPROe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qo0zoBPROe</a>.</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 7, "creation_date": 1504208656, "post_id": 45988978, "comment_id": 78938186, "body": "<a href=\"https://godoc.org/os/exec\" rel=\"nofollow noreferrer\">godoc.org/os/exec</a>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1504239777, "post_id": 45988978, "comment_id": 78946340, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18420685/calling-an-external-command-in-go\">Calling an external command in GO</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504716544, "post_id": 45992315, "comment_id": 79122603, "body": "thanks!! I have another question, if I am in directory A and running the GO code, and I need to copy a file from directory B to directory C , how do it do it? I tried adding cmd.Dir = &quot;A&quot; it can copy the files back in &quot;A&quot; directory, but when I try full path for directory &quot;C&quot; it throws error &quot;exit status 1&quot;. Please help me with this"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504717545, "post_id": 45992315, "comment_id": 79123146, "body": "<code>..&#47;B</code>, <code>..&#47;C</code>? Assuming <code>x&#47;A</code>, <code>x&#47;B</code>, <code>x&#47;C</code>. <code>..</code> means &quot;the parent directory&quot;."}, {"owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504722813, "post_id": 45992315, "comment_id": 79126026, "body": "directory A = &quot;/var/www/vhosts/api/src/copy.go&quot;. directory B = &quot;/mnt/home/sftp&quot; and directory C = &quot;/tmp/nitin&quot;. All the above directory resides on the same server."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504724211, "post_id": 45992315, "comment_id": 79126789, "body": "<code>cp &#47;mnt&#47;home&#47;sftp&#47;file.name &#47;tmp&#47;nitin&#47;file.name</code> If it errors out you need to get the error message from standard error and proceed from there. Maybe figure out how to do it manually from the shell first?"}, {"owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504725103, "post_id": 45992315, "comment_id": 79127258, "body": "Manually from the shell the command works, but when I try the same from GO code the standard error it throws is &quot;exit status 1&quot;"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504731225, "post_id": 45992315, "comment_id": 79130345, "body": "Standard error, as in the IO stream, not the returned error."}, {"owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504733392, "post_id": 45992315, "comment_id": 79131302, "body": "I am new to GO and I am not sure how to get the Standard error from the IO stream by using the &quot;os/exec&quot; package"}, {"owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "edited": false, "score": 0, "creation_date": 1504734007, "post_id": 45992315, "comment_id": 79131537, "body": "When I tried with this approach, I was able to copy the file                          ` func Copy(dst, src string) error {         in, err := os.Open(src)         if err != nil {                 return err          }            defer in.Close()         out, err := os.Create(dst)         if err != nil {                 return err          }            defer out.Close()         _, err = io.Copy(out, in)          cerr := out.Close()         if err != nil {                 return err          }            return cerr }`"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1504230582, "creation_date": 1504230582, "answer_id": 45992315, "question_id": 45988978, "link": "https://stackoverflow.com/questions/45988978/how-to-copy-a-file-from-one-directory-to-another-using-os-exec-package-in-go/45992315#45992315", "title": "How to copy a file from one directory to another using &quot;os/exec&quot; package in GO", "body": "<p><a href=\"https://godoc.org/os/exec\" rel=\"nofollow noreferrer\">\"os/exec\"</a> is the Go package used to run external programs, which would include Linux utilities.</p>\n\n<pre><code>// The command name is the first arg, subsequent args are the\n// command arguments.\ncmd := exec.Command(\"tr\", \"a-z\", \"A-Z\")\n// Provide an io.Reader to use as standard input (optional)\ncmd.Stdin = strings.NewReader(\"some input\")\n// And a writer for standard output (also optional)\nvar out bytes.Buffer\ncmd.Stdout = &amp;out\n// Run the command and wait for it to finish (the are other\n// methods that allow you to launch without waiting.\nerr := cmd.Run()\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"in all caps: %q\\n\", out.String())\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 8545084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768ba9b18702fb71e489787af085d6ad?s=128&d=identicon&r=PG&f=1", "display_name": "nchauhan503", "link": "https://stackoverflow.com/users/8545084/nchauhan503"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "answer_count": 1, "score": -10, "last_activity_date": 1504725488, "creation_date": 1504208539, "last_edit_date": 1504725488, "question_id": 45988978, "link": "https://stackoverflow.com/questions/45988978/how-to-copy-a-file-from-one-directory-to-another-using-os-exec-package-in-go", "title": "How to copy a file from one directory to another using &quot;os/exec&quot; package in GO", "body": "<p>if I am in directory A and running the GO code, and I need to copy a file from directory B to directory C , how to do it? I tried adding cmd.Dir = \"B\" but it can copy the files in \"B\" directory, but when I try full path for directory \"C\" it throws error \"exit status 1\"</p>\n\n<p>basic code sample</p>\n\n<p>Currently in directory A with location \"/var/A\"\ncmd := exec.Command(\"cp\",\"/var/C/c.txt\",\"/var/B/\")\nerr := cmd.Run()</p>\n"}, {"tags": ["ssl", "go", "grpc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504208265, "post_id": 45988816, "comment_id": 78938024, "body": "The question of why an example does one thing or another is specific to that example and only truly answerable by the example&#39;s author, and generally totally irrelevant anyway. Perhaps if you post a question about your TLS issue, that&#39;s something the SO community could actually help with."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504208183, "post_id": 45988865, "comment_id": 78937981, "body": "Exactly this. A TLS version would not be an example someone could copy-paste-execute to learn how it works - they&#39;d have to set up certificates to get it working and it would add nothing to the example in terms of the gRPC functionality they&#39;re actually trying to demonstrate."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1504208094, "creation_date": 1504208094, "answer_id": 45988865, "question_id": 45988816, "link": "https://stackoverflow.com/questions/45988816/why-do-grpc-server-examples-use-net-listen-instead-of-tls-listen/45988865#45988865", "title": "Why do grpc server examples use net.Listen instead of tls.Listen", "body": "<blockquote>\n  <p>Why is this?</p>\n</blockquote>\n\n<p>Because these are examples about grpc and not about TLS?\nExamples tend to be examples: Simplifications to demonstrate something. Examples are not copy-paste samples for production code.</p>\n"}], "owner": {"reputation": 10343, "user_id": 1309332, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2CtHJ.png?s=128&g=1", "display_name": "dbn", "link": "https://stackoverflow.com/users/1309332/dbn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "closed_date": 1504263984, "answer_count": 1, "score": -2, "last_activity_date": 1504208617, "creation_date": 1504207874, "last_edit_date": 1504208617, "question_id": 45988816, "link": "https://stackoverflow.com/questions/45988816/why-do-grpc-server-examples-use-net-listen-instead-of-tls-listen", "closed_reason": "Opinion-based", "title": "Why do grpc server examples use net.Listen instead of tls.Listen", "body": "<p>I'm setting up a golang grpc server that will use TLS for client authorization/authentication. All the examples of server setup that I've seen use <code>net.Listen()</code> instead of <code>tls.Listen()</code>. Why is this?</p>\n\n<pre><code>import (\n    \"crypto/tls\"\n    \"github.com/pkg/errors\"\n    \"google.golang.org/grpc\"\n    \"google.golang.org/grpc/credentials\"\n    \"net\"\n)\n\nfunc startGRPCListener(hostport string, tlsconfig *tls.Config) (grpcServer *grpc.Server) {\n    listener, _ = net.Listen(\"tcp\", hostport)\n    cred := grpc.Creds(credentials.NewTLS(tlsconfig))\n    grpcServer := grpc.NewServer(cred)\n    go func() {\n        serveErr := grpcServer.Serve(listener)\n        log.WithError(serveErr).Info(\"GRPC server exited\")\n    }() \n\n    return\n}\n</code></pre>\n\n<p>I've noticed in a couple of working examples if I swap to tls.Listen, the connection can no longer be made. However, in other cases, this doesn't cause a problem!</p>\n\n<p>I guess my question is \"should I use net.Listen or tls.Listen, or does it not make a difference?\"</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1504208046, "post_id": 45987254, "comment_id": 78937920, "body": "<code>(?&lt;=~)\\d+</code> Unsupported Perl syntax <code>(?&lt;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 2, "last_activity_date": 1504202536, "last_edit_date": 1504202536, "creation_date": 1504202173, "answer_id": 45987490, "question_id": 45987254, "link": "https://stackoverflow.com/questions/45987254/regex-extracting-sets-of-numbers-from-string-when-prefix-occurs-while-not-match/45987490#45987490", "title": "Regex extracting sets of numbers from string when prefix occurs, while not matching said prefix", "body": "<p>You can use <a href=\"https://godoc.org/regexp#Regexp.FindAllStringSubmatch\" rel=\"nofollow noreferrer\"><code>FindAllStringSubmatch</code></a> to extract the group containing just the digits. Below is an example that finds all instances of <code>~</code> followed by numbers. It additionally converts all the matches to ints \nand inserts them into a slice:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strconv\"\n)\n\nfunc main() {\n    host := \"somestring~200~122\"\n    pattern := regexp.MustCompile(`~(\\d+)`)\n    numberStrings := pattern.FindAllStringSubmatch(host, -1)\n    numbers := make([]int, len(numberStrings))\n    for i, numberString := range numberStrings {\n        number, err := strconv.Atoi(numberString[1])\n        if err != nil {\n            panic(err)\n        }\n        numbers[i] = number\n    }\n    fmt.Println(numbers)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/09YyewtRXz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/09YyewtRXz</a></p>\n"}], "owner": {"reputation": 729, "user_id": 2737876, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/4ed49a00e66b2cbd39e55212cb2d70f2?s=128&d=identicon&r=PG&f=1", "display_name": "user2737876", "link": "https://stackoverflow.com/users/2737876/user2737876"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1504202536, "creation_date": 1504201194, "last_edit_date": 1504202462, "question_id": 45987254, "link": "https://stackoverflow.com/questions/45987254/regex-extracting-sets-of-numbers-from-string-when-prefix-occurs-while-not-match", "title": "Regex extracting sets of numbers from string when prefix occurs, while not matching said prefix", "body": "<p>As stated in the title, given a situation where I have a string like so:</p>\n\n<pre><code>\"somestring~200~122\"\n</code></pre>\n\n<p>I am wanting to regex to match the numbers when the prefix \"~\" occurs. So I can ultimately end up with [200, 122].</p>\n\n<p>Matching the prefix is necessary as I need to protect against a case where a string like the one below should not be matched</p>\n\n<pre><code>\"somestring~abc200~def122\"\n</code></pre>\n\n<p>For additional context: As stated in the title, I am using go so I am planning on using doing something like the following in order to obtain the numbers within the string:</p>\n\n<pre><code>pattern := regexp.MustCompile(\"regex i need help with\")\nnumbers := pattern.FindAllString(host, -1)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504196728, "post_id": 45986025, "comment_id": 78932217, "body": "What does <code>dirs.Watch()</code> do? Is that your recursive call?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504196730, "post_id": 45986025, "comment_id": 78932218, "body": "What does <code>dirs.Watch()</code> do is it a blocking call?  Do you get that far? Are you running out of memory?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504196772, "post_id": 45986025, "comment_id": 78932244, "body": "Get a stack trace and see exactly what code is executing when it hangs."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "edited": false, "score": 0, "creation_date": 1504197230, "post_id": 45986025, "comment_id": 78932477, "body": "I forgot to remove those actually.  I think I found the problem, or at least a symptom of the problem.  I&#39;m calling this as a goroutine and it hangs if I do that.  When it&#39;s not ran as a goroutine it completes just fine.  To answer one of the above questions, no it never finishes the loop.  It reaches a certain point and just stops."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504197944, "post_id": 45986025, "comment_id": 78932860, "body": "@gochuck: you&#39;re not using the <code>done</code> chan, so Watch can&#39;t ever return. If it does ever return, the watcher will be closed, and put your goruotine into a busy loop. That&#39;s likely your issue, but it&#39;s unclear from your example here."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "edited": false, "score": 0, "creation_date": 1504198310, "post_id": 45986025, "comment_id": 78933038, "body": "You&#39;re right, I&#39;m not being very clear.  It&#39;s actually stopping before it gets out of the first for loop.  It eventually hangs at the if f.isDir().  So if I call it like this:      go Watches(&lt;some string array&gt;)  It will reach a point where it stops adding directories to the struct.  If I don&#39;t do that, it finishes and then enters the Watch() like I desire."}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1504358298, "last_edit_date": 1504358298, "creation_date": 1504210785, "answer_id": 45989471, "question_id": 45986025, "link": "https://stackoverflow.com/questions/45986025/go-filepath-walk-hangs/45989471#45989471", "title": "Go filepath.Walk hangs", "body": "<p>I'm not 100% sure of your intent.. However the grand scheme to me seems that you want to append the path of directories to a slice.  You want to check to see if something new has been added and then add that new directory to the slice.  Here's my simple version of that. Where every second <code>defined by the ticker</code> I sync paths.  I use signals to say, \"hey, I want to stop watching for changes and print out all the paths\".. I also use a channel to listen to commands from stdin to do other stuff (something you can build on for sure).</p>\n\n<p>I couldn't tell exactly where in your original code the point of failure was.  If your <code>watching</code> for changes then the code should be blocking unless you say otherwise.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"path/filepath\"\n    \"syscall\"\n    \"time\"\n)\n\ntype Watcher struct {\n    Dirs    []DirInfo\n    Ticker  *time.Ticker\n    Stop    chan os.Signal\n    Command chan string\n}\n\ntype DirInfo struct {\n    LastMod time.Time\n    Path    string\n}\n\nfunc New() *Watcher {\n    return &amp;Watcher{\n        Stop:    make(chan os.Signal, 1),\n        Ticker:  time.NewTicker(1 * time.Second),\n        Command: make(chan string),\n    }\n}\n\nfunc (w *Watcher) addPath(path string, f os.FileInfo) {\n    shouldAppend := true\n    for i, d := range w.Dirs {\n        if d.Path == path {\n            w.Dirs[i].LastMod = f.ModTime()\n            shouldAppend = false\n            break\n        }\n    }\n    if shouldAppend {\n        w.Dirs = append(w.Dirs, DirInfo{f.ModTime(), path})\n    }\n}\n\nfunc (w *Watcher) List() {\n    if len(w.Dirs) == 0 {\n        log.Println(\"Nothing to show\")\n        return\n    }\n\n    for _, d := range w.Dirs {\n        log.Println(d.Path)\n    }\n    return\n}\n\nfunc (w *Watcher) isNew(path string, f os.FileInfo) bool {\n    for _, d := range w.Dirs {\n        if path == d.Path {\n            t := f.ModTime()\n            return t.After(d.LastMod)\n        }\n    }\n    return true\n}\n\nfunc (w *Watcher) Sync(tops []string) {\n    for _, top := range tops {\n        err := filepath.Walk(top, func(path string, f os.FileInfo, err error) error {\n            if err != nil {\n                return err\n            }\n            if f.IsDir() &amp;&amp; w.isNew(path, f) {\n                w.addPath(path, f)\n            }\n            return nil\n        })\n\n        if err != nil {\n            log.Printf(\"Error %v\\n\", err)\n        }\n    }\n}\n\n\nfunc main() {\n    w := New()\n    tops := []string{}\n\n    signal.Notify(w.Stop, syscall.SIGINT, syscall.SIGTERM)\n\n    go func() {\n        s := bufio.NewScanner(os.Stdin)\n\n        for {\n            for s.Scan() {\n                w.Command &lt;- s.Text()\n            }\n        }\n    }()\n\n    for {\n        select {\n        case &lt;-w.Ticker.C:\n            w.Sync(tops)\n        case &lt;-w.Stop:\n            log.Println(\"signalled to stop\")\n            w.List()\n            os.Exit(0)\n        case cmd := &lt;-w.Command:\n            switch cmd {\n            case \"list\":\n                w.List()\n            }\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 0, "accepted_answer_id": 45989471, "answer_count": 1, "score": 0, "last_activity_date": 1504358298, "creation_date": 1504196334, "last_edit_date": 1504197315, "question_id": 45986025, "link": "https://stackoverflow.com/questions/45986025/go-filepath-walk-hangs", "title": "Go filepath.Walk hangs", "body": "<p>I'm running into a strange problem with filepath.Walk() in go.  It starts to run then reaches a point where it just hangs.  My CPU sits at 100%, there's no error and it does not continue.  I've looked into the directory that I'm traversing and the point where it hangs has nothing special, no symlins or anything like that.  Just plain directories and files.  Here's the code that I'm using:</p>\n\n<pre><code>type WatchDirs struct {\n    Dirs []string\n}\n\n//Watches ...Recursively walk the filesystem, entrypoint to file watching\nfunc Watches(tops []string) error {\n    var dirs WatchDirs\n    for _, top := range tops {\n        err := filepath.Walk(top, func(path string, f os.FileInfo, err error) error {\n            if err != nil {\n                log.Println(err)\n                return err\n            }\n            log.Println(\"File: \", path)\n            if f.IsDir() {\n                //log.Println(\"Path: \", path)\n                dirs.Dirs = append(dirs.Dirs, path)\n            }\n            return nil\n        })\n        if err != nil {\n            log.Println(err)\n        }\n        log.Println(\"Continuing Loop\")\n    }\n    log.Println(\"Starting Dedup: \")\n    dirs.Dedup()\n    log.Println(\"Post Dedup: \")\n    for _, dir := range dirs.Dirs {\n        log.Println(dir)\n    }\n    dirs.Watch()\n    return nil\n}\n\n//Dedup ...Remove all duplicate entires from configured directories\nfunc (dirs *WatchDirs) Dedup() {\n    log.Println(\"deduping\")\n    uniqueSet := make(map[string]bool, len(dirs.Dirs))\n    for _, x := range dirs.Dirs {\n        uniqueSet[x] = true\n    }\n    result := make([]string, 0, len(uniqueSet))\n    for x := range uniqueSet {\n        result = append(result, x)\n    }\n    dirs.Dirs = result\n}\n\n//Watch ...Watch the list of created directories for changes\nfunc (dirs *WatchDirs) Watch() {\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer watcher.Close()\n\n    done := make(chan bool)\n    go func() {\n        for {\n            select {\n            case event := &lt;-watcher.Events:\n                log.Println(\"event:\", event)\n                if event.Op&amp;fsnotify.Write == fsnotify.Write {\n                    log.Println(\"modified file:\", event.Name)\n                }\n            case err := &lt;-watcher.Errors:\n                log.Println(\"error:\", err)\n            }\n        }\n    }()\n\n    for _, dir := range dirs.Dirs {\n        log.Println(\"Watching dir: \", dir)\n        err = watcher.Add(dir)\n        if err != nil {\n            log.Println(err)\n        }\n    }\n    &lt;-done\n}\n</code></pre>\n\n<p>EDIT: Added additional functions for clarity.</p>\n"}, {"tags": ["go", "pipe"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1504195352, "post_id": 45985575, "comment_id": 78931465, "body": "I don&#39;t know much about sync.Cond, but it is interesting that <code>p.rwait.L = &amp;p.l</code> and <code>p.wwait.L = &amp;p.l</code>. There&#39;s something up with the wait/signal pairs that I don&#39;t quite understand."}], "answers": [{"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504195462, "post_id": 45985776, "comment_id": 78931515, "body": "Very good catch. I finally realized what sync.Cond is good for digging into this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 2, "creation_date": 1504195681, "post_id": 45985776, "comment_id": 78931611, "body": "@captncraig: yeah, I feel a simplified version of this exact Pipe code would make a good Cond example for the sync package."}, {"owner": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "edited": false, "score": 0, "creation_date": 1504198549, "post_id": 45985776, "comment_id": 78933171, "body": "Thanks @JimB. I tried to tar &amp; stream objects to AWS using io.pipe, and gets err data truncated. It works if output to local file using io.pipe. Not sure why since io.pipe write() func is blocked till data is consumed by reader which will not cause any data leak."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1504195418, "creation_date": 1504195418, "answer_id": 45985776, "question_id": 45985575, "link": "https://stackoverflow.com/questions/45985575/how-do-the-io-pipe-write-and-read-functions-work/45985776#45985776", "title": "How do the io.Pipe Write() and Read() functions work?", "body": "<p>The mutex <code>p.l</code> is used in the read and write <a href=\"https://golang.org/pkg/sync/#Cond\" rel=\"nofollow noreferrer\"><code>sync.Cond</code></a> conditions, which will lock and unlock it as necessary. </p>\n\n<p>Calling <code>Wait</code> on the condition unlocks its lock, and waits for a corresponding <code>Signal</code> call. You can see that the pipe uses <code>p.wwait</code> and <code>p.rwait</code> to coordinate the readers and writers within the <code>Read</code> and <code>Write</code> methods.</p>\n"}], "owner": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 1, "accepted_answer_id": 45985776, "answer_count": 1, "score": 3, "last_activity_date": 1504202051, "creation_date": 1504194777, "last_edit_date": 1504202051, "question_id": 45985575, "link": "https://stackoverflow.com/questions/45985575/how-do-the-io-pipe-write-and-read-functions-work", "title": "How do the io.Pipe Write() and Read() functions work?", "body": "<p>By reading golang src <a href=\"https://golang.org/src/io/pipe.go\" rel=\"nofollow noreferrer\">pipe.go</a> to figure out how pipe works, I ran into these two write() &amp; read() functions. What confuses me is that if reader calls read() func and hold l.lock and then waiting for data, how does writer call write() func and acquire l.lock to write data in?</p>\n\n<pre><code>func (p *pipe) write(b []byte) (n int, err error) {\n    // pipe uses nil to mean not available\n    if b == nil {\n        b = zero[:]\n    }\n\n    // One writer at a time.\n    p.wl.Lock()\n    defer p.wl.Unlock()\n\n    p.l.Lock()\n    defer p.l.Unlock()\n    if p.werr != nil {\n        err = ErrClosedPipe\n        return\n    }\n    p.data = b\n    p.rwait.Signal()\n    for {\n        if p.data == nil {\n            break\n        }\n        if p.rerr != nil {\n            err = p.rerr\n            break\n        }\n        if p.werr != nil {\n            err = ErrClosedPipe\n            break\n        }\n        p.wwait.Wait()\n    }\n    n = len(b) - len(p.data)\n    p.data = nil // in case of rerr or werr\n    return\n}\n</code></pre>\n\n<p>and read:</p>\n\n<pre><code>func (p *pipe) read(b []byte) (n int, err error) {\n\n    // One reader at a time.\n    p.rl.Lock()\n    defer p.rl.Unlock()\n\n    p.l.Lock()\n    defer p.l.Unlock()\n    for {\n        if p.rerr != nil {\n            return 0, ErrClosedPipe\n        }\n        if p.data != nil {\n            break\n        }\n        if p.werr != nil {\n            return 0, p.werr\n        }\n        p.rwait.Wait()\n    }\n    n = copy(b, p.data)\n    p.data = p.data[n:]\n    if len(p.data) == 0 {\n        p.data = nil\n        p.wwait.Signal()\n    }\n    return\n}\n</code></pre>\n\n\n"}, {"tags": ["rest", "reactjs", "go", "cors", "preflight"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504194051, "post_id": 45985351, "comment_id": 78930588, "body": "Does it work if you uncomment those header setting lines? Browser extensions are absolutely the wrong way to solve this. None of your users will have them."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1504194182, "post_id": 45985351, "comment_id": 78930699, "body": "IIRC, <code>Access-Control-Allow-Methods</code> can&#39;t be <code>*</code>. It should be a list of methods."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504194259, "post_id": 45985351, "comment_id": 78930754, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12830095/setting-http-headers\">Setting HTTP headers</a>"}, {"owner": {"reputation": 117, "user_id": 6780604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00db5dc1f68169f34b4ff06ee252d927?s=128&d=identicon&r=PG&f=1", "display_name": "Mojo982", "link": "https://stackoverflow.com/users/6780604/mojo982"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504194405, "post_id": 45985351, "comment_id": 78930856, "body": "@captncraig if I uncomment those lines it still does not work. Those lines are from me attempting to fix the issue."}, {"owner": {"reputation": 117, "user_id": 6780604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00db5dc1f68169f34b4ff06ee252d927?s=128&d=identicon&r=PG&f=1", "display_name": "Mojo982", "link": "https://stackoverflow.com/users/6780604/mojo982"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504194460, "post_id": 45985351, "comment_id": 78930895, "body": "@captncraig I also found that link and that&#39;s where I got the commented out code."}, {"owner": {"reputation": 117, "user_id": 6780604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00db5dc1f68169f34b4ff06ee252d927?s=128&d=identicon&r=PG&f=1", "display_name": "Mojo982", "link": "https://stackoverflow.com/users/6780604/mojo982"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1504194776, "post_id": 45985351, "comment_id": 78931110, "body": "@Ainar-G I&#39;ll add a response to your comment in the post."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504198721, "post_id": 45985351, "comment_id": 78933250, "body": "Remove <code>headers: {                 &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,                 &#39;Access-Control-Allow-Methods&#39;: &#39;GET, POST, PATCH, PUT, DELETE, OPTIONS&#39;,                 &#39;Access-Control-Allow-Headers&#39;: &#39;Origin, Content-Type, X-Auth-Token&#39;             }</code> from your frontend JavaScript code. Those headers are all strictly <i>response</i> headers for servers to send back in response to requests. The only effect that adding to them to your frontend JavaScript code will have is to break things"}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 1, "creation_date": 1504199066, "post_id": 45985351, "comment_id": 78933425, "body": "Those headers your frontend code adds trigger your browser to automatically on its own do a COR preflight OPTIONS request before trying the GET request your code is intended to send <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/&hellip;</a> And because in the backend code of the server you\u2019re sending the request to, you have it do <code>if response.Method != http.MethodGet { http.Error(writer, http.StatusText(405), 405) \u2026}</code>, that gets hit when the browser sends the preflight OPTIONS &amp; the preflight fails &amp; your browser never moves on to trying the GET from your code"}], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 6780604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00db5dc1f68169f34b4ff06ee252d927?s=128&d=identicon&r=PG&f=1", "display_name": "Mojo982", "link": "https://stackoverflow.com/users/6780604/mojo982"}, "is_accepted": true, "score": 0, "last_activity_date": 1504205640, "creation_date": 1504205640, "answer_id": 45988296, "question_id": 45985351, "link": "https://stackoverflow.com/questions/45985351/preflight-doesnt-pass-control-check-access-control-allow-origin-not-present/45988296#45988296", "title": "Preflight Doesn&#39;t Pass Control Check Access-Control-Allow-Origin Not Present", "body": "<p>Once I commented out the headers in the React code the GET request worked. I'd like to thank <a href=\"https://stackoverflow.com/users/441757/sideshowbarker\">sideshowbarker</a> for the answer. I really appreciate it.</p>\n\n<pre><code>convertButtonPressed(event) {\n    axios({\n        method: 'GET',\n        baseURL: 'http://localhost:4000/',\n        url: '/numberconverter',\n        // headers: {\n        //     'Access-Control-Allow-Origin': '*',\n        //     'Access-Control-Allow-Methods': 'GET, POST, PATCH, PUT, DELETE, OPTIONS',\n        //     'Access-Control-Allow-Headers': 'Origin, Content-Type, X-Auth-Token'\n        // },\n        params: {\n          number: this.state.number,\n          oldBase: this.state.base,\n          newBase: this.state.newBase\n        }\n      });\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 6780604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00db5dc1f68169f34b4ff06ee252d927?s=128&d=identicon&r=PG&f=1", "display_name": "Mojo982", "link": "https://stackoverflow.com/users/6780604/mojo982"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 818, "favorite_count": 0, "accepted_answer_id": 45988296, "answer_count": 1, "score": 2, "last_activity_date": 1504205640, "creation_date": 1504193950, "last_edit_date": 1504199236, "question_id": 45985351, "link": "https://stackoverflow.com/questions/45985351/preflight-doesnt-pass-control-check-access-control-allow-origin-not-present", "title": "Preflight Doesn&#39;t Pass Control Check Access-Control-Allow-Origin Not Present", "body": "<p>I have a simple client running in React. I am trying to make a GET request using Axios to a Go server that I have running locally. The React code is running on port 3000, the Go server on 4000.</p>\n\n<p>If I paste the GET request itself in the browser window it works fine: <a href=\"http://localhost:4000/numberconverter?number=10&amp;oldBase=10&amp;newBase=2\" rel=\"nofollow noreferrer\">http://localhost:4000/numberconverter?number=10&amp;oldBase=10&amp;newBase=2</a></p>\n\n<p>I've done some research and found <a href=\"https://stackoverflow.com/questions/35588699/response-to-preflight-request-doesnt-pass-access-control-check\">this post</a>, but the plugin and the Chrome options do not help. That isn't the only research I've done, but that seemed to be the most promising. Most of the stuff I've found doesn't involve a Go server.</p>\n\n<p>I've also found <a href=\"https://stackoverflow.com/questions/12830095/setting-http-headers\">this post</a>, but that also did not solve my problem. If I uncomment the code in the server it still fails.</p>\n\n<p>If I change the allowed methods to:</p>\n\n<pre><code>writer.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, PATCH, PUT, DELETE, OPTIONS\")\n</code></pre>\n\n<p>It fails with a 405 error. The server prints out this:</p>\n\n<pre><code>&amp;{0xc4200f4000 0xc42000a500 {} 0x10ec430 true false false false 0xc4200143c0 {0xc420100000 map[Access-Control-Allow-Origin:[*] Access-Control-Allow-Methods:[GET, POST, PATCH, PUT, DELETE, OPTIONS] Content-Type:[text/plain; charset=utf-8] X-Content-Type-Options:[nosniff]] false false} map[Access-Control-Allow-Origin:[*] Access-Control-Allow-Methods:[GET, POST, PATCH, PUT, DELETE, OPTIONS] Content-Type:[text/plain; charset=utf-8] X-Content-Type-Options:[nosniff]] true 19 -1 405 false false [] 0 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0] 0xc4200620e0 0}\n</code></pre>\n\n<p>I guess my question is whether this is a problem on the server side or the client side as well as how could I fix the problem?</p>\n\n<p>Client:</p>\n\n<pre><code>import React, {Component} from 'react';\nimport axios from 'axios';\n\nclass Converter extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            // number: 0,\n            // base: 10,\n            // newBase: 10\n        };\n        this.convertButtonPressed = this.convertButtonPressed.bind(this);\n        this.handleChange = this.handleChange.bind(this);\n    }\n\n    handleChange(event) {\n        const target = event.target;\n        const value = target.value;\n        const name = target.name;\n\n        this.setState({\n        [name]: value\n        });\n    }\n\n    convertButtonPressed(event) {\n        axios({\n            method: 'GET',\n            baseURL: 'http://localhost:4000/',\n            url: '/numberconverter',\n            headers: {\n                'Access-Control-Allow-Origin': '*',\n                'Access-Control-Allow-Methods': 'GET, POST, PATCH, PUT, DELETE, OPTIONS',\n                'Access-Control-Allow-Headers': 'Origin, Content-Type, X-Auth-Token'\n            },\n            params: {\n            number: this.state.number,\n            oldBase: this.state.base,\n            newBase: this.state.newBase\n            }\n        });\n    }\n\n    render() {\n        return (\n        &lt;div className=\"App\"&gt;\n            &lt;p&gt;Number Converter&lt;/p&gt;\n            &lt;div&gt;\n            Number:\n            &lt;input name=\"number\" onChange={this.handleChange} type=\"text\" placeholder=\"Number\"&gt;&lt;/input&gt;&lt;br /&gt;\n            Base:\n            &lt;input name=\"base\" onChange={this.handleChange} type=\"text\" placeholder=\"Base\"&gt;&lt;/input&gt;&lt;br /&gt;\n            New Base:\n            &lt;input name=\"newBase\" onChange={this.handleChange} type=\"text\" placeholder=\"New Base\"&gt;&lt;/input&gt;&lt;br /&gt;\n            &lt;/div&gt;\n            &lt;button onClick={this.convertButtonPressed}&gt;Convert&lt;/button&gt;\n        &lt;/div&gt;\n        );\n    }\n}\n\nexport default Converter;\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>package rest\n\n// Example:\n// http://localhost:3000/numberconverter?number=500000&amp;oldBase=10&amp;newBase=16\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"../converter\"\n)\n\n// Start starts the server\nfunc Start() {\n    //muxRouter := http.NewServeMux()\n    //muxRouter.HandleFunc(\"/numberconverter\", numberconverter)\n    //http.Handle(\"/\", muxRouter)\n    http.HandleFunc(\"/numberconverter\", numberconverter)\n    log.Fatal(http.ListenAndServe(\":4000\", nil))\n}\n\nfunc numberconverter(writer http.ResponseWriter, response *http.Request) {\n    //writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    //writer.Header().Set(\"Access-Control-Allow-Methods\", \"*\")\n    //writer.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\n    // Check if the method is a get\n    if response.Method != http.MethodGet {\n        http.Error(writer, http.StatusText(405), 405)\n        fmt.Println(writer)\n        return\n    }\n\n    number := response.FormValue(\"number\")\n    oldBase := response.FormValue(\"oldBase\")\n    newBase := response.FormValue(\"newBase\")\n    result := converter.ConvertStringNumberToNewBase(number, oldBase, newBase)\n    fmt.Fprintf(writer, \"%s base %s is %s in base %s\", number, oldBase, result, newBase)\n}\n</code></pre>\n"}, {"tags": ["http", "go", "memory-leaks", "server", "multipart"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1504194111, "post_id": 45985238, "comment_id": 78930642, "body": "Your &quot;Release mem&quot; function doesn&#39;t do anything. You can&#39;t explicitly release memory, and you don&#39;t need to close the Body on http requests. The usual cause of a &quot;leak&quot; in Go is goroutines that haven&#39;t returned, so start by looking at a full stack trace."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504206497, "post_id": 45985238, "comment_id": 78937129, "body": "<code>pprof</code> can be a <i>huge</i> help with detecting memory hogs and goroutine leaks."}, {"owner": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504207405, "post_id": 45985238, "comment_id": 78937611, "body": "@JimB but you can force Go to do GC sooner with debug.FreeOSMemory(). I use it in some of my apps which parse large amounts of large files when I need more memory for the OS as soon as possible."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "edited": false, "score": 0, "creation_date": 1504207607, "post_id": 45985238, "comment_id": 78937712, "body": "@geek1011: FreeOSMemory forces a GC cycle (which means less and less with an increasingly concurrent GC) and &quot;advises&quot; the OS is it can reclaim some of the memory. There is no guarantee the OS will actually mark it as free or use it again, especially if there is no memory pressure on the system. There is rarely any real use to calling that, other than for debugging, since the scavenger will attempt to free memory eventually anyway."}, {"owner": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504207714, "post_id": 45985238, "comment_id": 78937759, "body": "@JimB I use it myself and it works fine, and the OP says that it uses 100% RAM, which means the system most likely try to reclaim it if it can."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "edited": false, "score": 0, "creation_date": 1504207881, "post_id": 45985238, "comment_id": 78937849, "body": "@geek1011: regardless, <code>FreeOSMemory</code> shouldn&#39;t not be relied on to do anything. If you&#39;ve reached 100% memory usage, you have other problems besides freeing &quot;unused&quot; memory. The GC is always running, and the <code>gctrace</code> output or runtime memstats would show how much memory could theoretically be freed anyway."}, {"owner": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504207983, "post_id": 45985238, "comment_id": 78937893, "body": "@JimB I agree with your first and third points. For the second one, the GC tries to spread up the freeing over a longer period of time, and it can be useful to force GC if you know there is a lot to collect.   An example is an indexer. If you are indexing a lot of large files, and are finished, it can be quite beneficial to force GC."}, {"owner": {"reputation": 510, "user_id": 5139282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed92cc217be9a873ae064b39af816962?s=128&d=identicon&r=PG", "display_name": "geek1011", "link": "https://stackoverflow.com/users/5139282/geek1011"}, "edited": false, "score": 0, "creation_date": 1504208144, "post_id": 45985238, "comment_id": 78937968, "body": "@sen-petersven what is <code>&#47;&#47; Do something with the image and save it</code>? That might be the problem."}, {"owner": {"reputation": 8181, "user_id": 115988, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5f4389b462408f1e198c2955f93710f8?s=128&d=identicon&r=PG", "display_name": "Porton", "link": "https://stackoverflow.com/users/115988/porton"}, "edited": false, "score": 0, "creation_date": 1571048083, "post_id": 45985238, "comment_id": 103098337, "body": "@sen-petersven  any fix for this? got same issue with req.ParseMultipartForm() and doing NOTHING else."}], "owner": {"reputation": 13, "user_id": 7395429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/398d069ddb9fba6e3f4f0024970c7191?s=128&d=identicon&r=PG&f=1", "display_name": "Sen Petersven", "link": "https://stackoverflow.com/users/7395429/sen-petersven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 764, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1504274460, "creation_date": 1504193644, "last_edit_date": 1504274460, "question_id": 45985238, "link": "https://stackoverflow.com/questions/45985238/request-parsemultipartform-leaks-memory", "title": "Request.ParseMultipartForm leaks memory", "body": "<p>I am writing a Go server which handles image uploading via Multipart Requests, but after a while i get really bad memory usages (up to 100% RAM).</p>\n\n<p>I am using the basic http.ListenAndServeTLS and http.HandleFunc to do so.\nBelow a snippet of my code and the svg i got from pprof after a lot of image uploads.</p>\n\n<pre><code>func HandleUploadImage(res http.ResponseWriter, req *http.Request) {\n    defer func() {\n        // Release mem\n        if req != nil {\n            fmt.Println(\"Releasing request\")\n            if req.MultipartForm != nil {\n                fmt.Println(\"Releasing MultipartForm\")\n                req.MultipartForm.RemoveAll()\n            }\n            if req.Body != nil {\n                fmt.Println(\"Closing req.Body\")\n                req.Body.Close()\n            }\n        }\n\n    }()\n\n    // parse request\n    const _2MB = 1 &lt;&lt; 20\n    if err := req.ParseMultipartForm(_2MB); nil != err {\n        u.Log(\"Error\", \"Couldn't parse MultiPartForm\", map[string]interface{}{\"Error\": err}, u.GetFile_line(), \"\")\n        return\n    }\n\n    id := req.FormValue(formValueString)\n\n    // get the json data\n    if err := json.Unmarshal([]byte(id), marshalStruct); nil != err {\n        u.Log(\"Error\", \"Couldn't Unmarshal JSON\", map[string]interface{}{\"Error\": err}, u.GetFile_line(), \"\")\n        return\n    }\n\n    // Do something with the image and save it\n\n    // Marshal the reponse to JSON.\n    resJSON, err := response.ToJSON()\n    if err != nil {\n        u.Log(\"Error\", \"Couldn't create JSON from response struct\", map[string]interface{}{\"Error\": err, \"ResponseStruct\": response}, u.GetFile_line(), username)\n        return\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/CDPBr.png\" rel=\"nofollow noreferrer\">pprof_image</a></p>\n"}]